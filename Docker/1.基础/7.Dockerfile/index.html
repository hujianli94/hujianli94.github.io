<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="stay hungry,stay foolish"><meta name=author content=hujainli94><link href=https://hujianli94.github.io/Docker/1.%E5%9F%BA%E7%A1%80/7.Dockerfile/ rel=canonical><link href=../6.Docker%E7%BD%91%E7%BB%9C/ rel=prev><link href=../8.docker-compose/ rel=next><link rel=icon href=../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.5.2, mkdocs-material-9.1.21"><title>7.Dockerfile - DevOps运维开发</title><link rel=stylesheet href=../../../assets/stylesheets/main.eebd395e.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.ecc896b0.min.css><style>:root{--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M1 7.775V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 0 1 0 2.474l-5.026 5.026a1.75 1.75 0 0 1-2.474 0l-6.25-6.25A1.752 1.752 0 0 1 1 7.775Zm1.5 0c0 .066.026.13.073.177l6.25 6.25a.25.25 0 0 0 .354 0l5.025-5.025a.25.25 0 0 0 0-.354l-6.25-6.25a.25.25 0 0 0-.177-.073H2.75a.25.25 0 0 0-.25.25ZM6 5a1 1 0 1 1 0 2 1 1 0 0 1 0-2Z"/></svg>');--md-admonition-icon--abstract:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M2.5 1.75v11.5c0 .138.112.25.25.25h3.17a.75.75 0 0 1 0 1.5H2.75A1.75 1.75 0 0 1 1 13.25V1.75C1 .784 1.784 0 2.75 0h8.5C12.216 0 13 .784 13 1.75v7.736a.75.75 0 0 1-1.5 0V1.75a.25.25 0 0 0-.25-.25h-8.5a.25.25 0 0 0-.25.25Zm13.274 9.537v-.001l-4.557 4.45a.75.75 0 0 1-1.055-.008l-1.943-1.95a.75.75 0 0 1 1.062-1.058l1.419 1.425 4.026-3.932a.75.75 0 1 1 1.048 1.074ZM4.75 4h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM4 7.75A.75.75 0 0 1 4.75 7h2a.75.75 0 0 1 0 1.5h-2A.75.75 0 0 1 4 7.75Z"/></svg>');--md-admonition-icon--info:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"/></svg>');--md-admonition-icon--tip:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M3.499.75a.75.75 0 0 1 1.5 0v.996C5.9 2.903 6.793 3.65 7.662 4.376l.24.202c-.036-.694.055-1.422.426-2.163C9.1.873 10.794-.045 12.622.26 14.408.558 16 1.94 16 4.25c0 1.278-.954 2.575-2.44 2.734l.146.508.065.22c.203.701.412 1.455.476 2.226.142 1.707-.4 3.03-1.487 3.898C11.714 14.671 10.27 15 8.75 15h-6a.75.75 0 0 1 0-1.5h1.376a4.484 4.484 0 0 1-.563-1.191 3.835 3.835 0 0 1-.05-2.063 4.647 4.647 0 0 1-2.025-.293.75.75 0 0 1 .525-1.406c1.357.507 2.376-.006 2.698-.318l.009-.01a.747.747 0 0 1 1.06 0 .748.748 0 0 1-.012 1.074c-.912.92-.992 1.835-.768 2.586.221.74.745 1.337 1.196 1.621H8.75c1.343 0 2.398-.296 3.074-.836.635-.507 1.036-1.31.928-2.602-.05-.603-.216-1.224-.422-1.93l-.064-.221c-.12-.407-.246-.84-.353-1.29a2.425 2.425 0 0 1-.507-.441 3.075 3.075 0 0 1-.633-1.248.75.75 0 0 1 1.455-.364c.046.185.144.436.31.627.146.168.353.305.712.305.738 0 1.25-.615 1.25-1.25 0-1.47-.95-2.315-2.123-2.51-1.172-.196-2.227.387-2.706 1.345-.46.92-.27 1.774.019 3.062l.042.19a.884.884 0 0 1 .01.05c.348.443.666.949.94 1.553a.75.75 0 1 1-1.365.62c-.553-1.217-1.32-1.94-2.3-2.768L6.7 5.527c-.814-.68-1.75-1.462-2.692-2.619a3.737 3.737 0 0 0-1.023.88c-.406.495-.663 1.036-.722 1.508.116.122.306.21.591.239.388.038.797-.06 1.032-.19a.75.75 0 0 1 .728 1.31c-.515.287-1.23.439-1.906.373-.682-.067-1.473-.38-1.879-1.193L.75 5.677V5.5c0-.984.48-1.94 1.077-2.664.46-.559 1.05-1.055 1.673-1.353V.75Z"/></svg>');--md-admonition-icon--success:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"/></svg>');--md-admonition-icon--question:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.92 6.085h.001a.749.749 0 1 1-1.342-.67c.169-.339.436-.701.849-.977C6.845 4.16 7.369 4 8 4a2.756 2.756 0 0 1 1.637.525c.503.377.863.965.863 1.725 0 .448-.115.83-.329 1.15-.205.307-.47.513-.692.662-.109.072-.22.138-.313.195l-.006.004a6.24 6.24 0 0 0-.26.16.952.952 0 0 0-.276.245.75.75 0 0 1-1.248-.832c.184-.264.42-.489.692-.661.103-.067.207-.132.313-.195l.007-.004c.1-.061.182-.11.258-.161a.969.969 0 0 0 .277-.245C8.96 6.514 9 6.427 9 6.25a.612.612 0 0 0-.262-.525A1.27 1.27 0 0 0 8 5.5c-.369 0-.595.09-.74.187a1.01 1.01 0 0 0-.34.398ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"/></svg>');--md-admonition-icon--warning:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"/></svg>');--md-admonition-icon--failure:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M2.344 2.343h-.001a8 8 0 0 1 11.314 11.314A8.002 8.002 0 0 1 .234 10.089a8 8 0 0 1 2.11-7.746Zm1.06 10.253a6.5 6.5 0 1 0 9.108-9.275 6.5 6.5 0 0 0-9.108 9.275ZM6.03 4.97 8 6.94l1.97-1.97a.749.749 0 0 1 1.275.326.749.749 0 0 1-.215.734L9.06 8l1.97 1.97a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215L8 9.06l-1.97 1.97a.749.749 0 0 1-1.275-.326.749.749 0 0 1 .215-.734L6.94 8 4.97 6.03a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018Z"/></svg>');--md-admonition-icon--danger:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M9.504.43a1.516 1.516 0 0 1 2.437 1.713L10.415 5.5h2.123c1.57 0 2.346 1.909 1.22 3.004l-7.34 7.142a1.249 1.249 0 0 1-.871.354h-.302a1.25 1.25 0 0 1-1.157-1.723L5.633 10.5H3.462c-1.57 0-2.346-1.909-1.22-3.004L9.503.429Zm1.047 1.074L3.286 8.571A.25.25 0 0 0 3.462 9H6.75a.75.75 0 0 1 .694 1.034l-1.713 4.188 6.982-6.793A.25.25 0 0 0 12.538 7H9.25a.75.75 0 0 1-.683-1.06l2.008-4.418.003-.006a.036.036 0 0 0-.004-.009l-.006-.006-.008-.001c-.003 0-.006.002-.009.004Z"/></svg>');--md-admonition-icon--bug:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M4.72.22a.75.75 0 0 1 1.06 0l1 .999a3.488 3.488 0 0 1 2.441 0l.999-1a.748.748 0 0 1 1.265.332.75.75 0 0 1-.205.729l-.775.776c.616.63.995 1.493.995 2.444v.327c0 .1-.009.197-.025.292.408.14.764.392 1.029.722l1.968-.787a.75.75 0 0 1 .556 1.392L13 7.258V9h2.25a.75.75 0 0 1 0 1.5H13v.5c0 .409-.049.806-.141 1.186l2.17.868a.75.75 0 0 1-.557 1.392l-2.184-.873A4.997 4.997 0 0 1 8 16a4.997 4.997 0 0 1-4.288-2.427l-2.183.873a.75.75 0 0 1-.558-1.392l2.17-.868A5.036 5.036 0 0 1 3 11v-.5H.75a.75.75 0 0 1 0-1.5H3V7.258L.971 6.446a.75.75 0 0 1 .558-1.392l1.967.787c.265-.33.62-.583 1.03-.722a1.677 1.677 0 0 1-.026-.292V4.5c0-.951.38-1.814.995-2.444L4.72 1.28a.75.75 0 0 1 0-1.06Zm.53 6.28a.75.75 0 0 0-.75.75V11a3.5 3.5 0 1 0 7 0V7.25a.75.75 0 0 0-.75-.75ZM6.173 5h3.654A.172.172 0 0 0 10 4.827V4.5a2 2 0 1 0-4 0v.327c0 .096.077.173.173.173Z"/></svg>');--md-admonition-icon--example:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M5 5.782V2.5h-.25a.75.75 0 0 1 0-1.5h6.5a.75.75 0 0 1 0 1.5H11v3.282l3.666 5.76C15.619 13.04 14.543 15 12.767 15H3.233c-1.776 0-2.852-1.96-1.899-3.458Zm-2.4 6.565a.75.75 0 0 0 .633 1.153h9.534a.75.75 0 0 0 .633-1.153L12.225 10.5h-8.45ZM9.5 2.5h-3V6c0 .143-.04.283-.117.403L4.73 9h6.54L9.617 6.403A.746.746 0 0 1 9.5 6Z"/></svg>');--md-admonition-icon--quote:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M1.75 2.5h10.5a.75.75 0 0 1 0 1.5H1.75a.75.75 0 0 1 0-1.5Zm4 5h8.5a.75.75 0 0 1 0 1.5h-8.5a.75.75 0 0 1 0-1.5Zm0 5h8.5a.75.75 0 0 1 0 1.5h-8.5a.75.75 0 0 1 0-1.5ZM2.5 7.75v6a.75.75 0 0 1-1.5 0v-6a.75.75 0 0 1 1.5 0Z"/></svg>');}</style><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../stylesheets/extra.css><link rel=stylesheet href=https://file.cdn.shafish.cn/blog/css/vssue.css><link rel=stylesheet href=https://file.cdn.shafish.cn/blog/css/video-js.min.css><link rel=stylesheet href=https://file.cdn.shafish.cn/blog/css/video.css><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script>var consent;"undefined"==typeof __md_analytics||(consent=__md_get("__consent"))&&consent.analytics&&__md_analytics()</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#7dockerfile class=md-skip> 跳转至 </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=页眉> <a href=../../.. title=DevOps运维开发 class="md-header__button md-logo" aria-label=DevOps运维开发 data-md-component=logo> <img src=../../../assets/images/logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> DevOps运维开发 </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> 7.Dockerfile </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label=切换至深色模式 type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title=切换至深色模式 for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=blue data-md-color-accent=blue aria-label=切换至浅色模式 type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title=切换至浅色模式 for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=查找> <a href=javascript:void(0) class="md-search__icon md-icon" title=分享 aria-label=分享 data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=清空当前内容 aria-label=清空当前内容 tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> 正在初始化搜索引擎 </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/hujianli94/hujianli94.github.io title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> hujianli94.github.io </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=标签 data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> 首页 </a> </li> <li class=md-tabs__item> <a href=../../../Kubernetes/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Kubernetes/ class=md-tabs__link> Kubernetes </a> </li> <li class=md-tabs__item> <a href=../../0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Docker/ class="md-tabs__link md-tabs__link--active"> Docker </a> </li> <li class=md-tabs__item> <a href=../../../Golang/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Go-Web%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98/ class=md-tabs__link> Golang </a> </li> <li class=md-tabs__item> <a href=../../../Python/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Pythjon-auto-ops/ class=md-tabs__link> Python </a> </li> <li class=md-tabs__item> <a href=../../../Python-vs-Go/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Python-vs-Go/ class=md-tabs__link> Python-vs-Go </a> </li> <li class=md-tabs__item> <a href=../../../Linux/shell/Shell%E7%AE%80%E4%BB%8B/ class=md-tabs__link> Linux </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=导航栏 data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title=DevOps运维开发 class="md-nav__button md-logo" aria-label=DevOps运维开发 data-md-component=logo> <img src=../../../assets/images/logo.png alt=logo> </a> DevOps运维开发 </label> <div class=md-nav__source> <a href=https://github.com/hujianli94/hujianli94.github.io title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> hujianli94.github.io </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> 首页 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> Kubernetes <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_1> <label class=md-nav__link for=__nav_2_1 id=__nav_2_1_label tabindex=0> 0.学习线路 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_1_label aria-expanded=false> <label class=md-nav__title for=__nav_2_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Kubernetes/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Kubernetes/ class=md-nav__link> Kubernetes </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2> <label class=md-nav__link for=__nav_2_2 id=__nav_2_2_label tabindex=0> 1.安装篇 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2> <span class="md-nav__icon md-icon"></span> 1.安装篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/1.Kubeadm%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/ class=md-nav__link> Kubeadm安装高可用集群 </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/2.%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/ class=md-nav__link> 二进制安装高可用K8s集群 </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/3.%E5%AE%89%E8%A3%85%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/ class=md-nav__link> 安装常用工具 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_3> <label class=md-nav__link for=__nav_2_3 id=__nav_2_3_label tabindex=0> 2.基础篇 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_3_label aria-expanded=false> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> 2.基础篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/3.Docker%E5%9F%BA%E7%A1%80/ class=md-nav__link> Docker基础 </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Kubernetes%E7%9A%84%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/ class=md-nav__link> Kubernetes的基础概念 </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Kubernetes%E8%B0%83%E5%BA%A6%E5%9F%BA%E7%A1%80/ class=md-nav__link> Kubernetes调度基础 </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/6.Kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83%E5%9F%BA%E7%A1%80/ class=md-nav__link> Kubernetes服务发布基础 </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/7.Kubernetes%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/ class=md-nav__link> Kubernetes配置管理 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_4> <label class=md-nav__link for=__nav_2_4 id=__nav_2_4_label tabindex=0> 3.进阶篇 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_4_label aria-expanded=false> <label class=md-nav__title for=__nav_2_4> <span class="md-nav__icon md-icon"></span> 3.进阶篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Kubernetes/3.%E8%BF%9B%E9%98%B6%E7%AF%87/8.Kubernetes%E5%AD%98%E5%82%A8%E5%85%A5%E9%97%A8/ class=md-nav__link> Kubernetes存储入门 </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/3.%E8%BF%9B%E9%98%B6%E7%AF%87/9.Kubernetes%E9%AB%98%E7%BA%A7%E8%B0%83%E5%BA%A6/ class=md-nav__link> Kubernetes高级调度 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_5> <label class=md-nav__link for=__nav_2_5 id=__nav_2_5_label tabindex=0> 4.高级篇 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_5_label aria-expanded=false> <label class=md-nav__title for=__nav_2_5> <span class="md-nav__icon md-icon"></span> 4.高级篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Kubernetes/4.%E9%AB%98%E7%BA%A7%E7%AF%87/12.%E4%BA%91%E5%8E%9F%E7%94%9F%E5%AD%98%E5%82%A8Rook/ class=md-nav__link> 云原生存储Rook </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/4.%E9%AB%98%E7%BA%A7%E7%AF%87/13.%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%AE%B9%E5%99%A8%E5%8C%96/ class=md-nav__link> 中间件容器化 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_6> <label class=md-nav__link for=__nav_2_6 id=__nav_2_6_label tabindex=0> 5.运维篇 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_6_label aria-expanded=false> <label class=md-nav__title for=__nav_2_6> <span class="md-nav__icon md-icon"></span> 5.运维篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/14.Kubernetes%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/ class=md-nav__link> Kubernetes日志收集 </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/15.Kubernetes%E7%9B%91%E6%8E%A7%E5%91%8A%E8%AD%A6/ class=md-nav__link> Kubernetes监控告警 </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/16.%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83Ingress%E8%BF%9B%E9%98%B6/ class=md-nav__link> 服务发布Ingress进阶 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_7> <label class=md-nav__link for=__nav_2_7 id=__nav_2_7_label tabindex=0> 6.DevOps篇 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_7_label aria-expanded=false> <label class=md-nav__title for=__nav_2_7> <span class="md-nav__icon md-icon"></span> 6.DevOps篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/ class=md-nav__link> DevOps实践 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> Docker <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=true> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Docker </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1> <label class=md-nav__link for=__nav_3_1 id=__nav_3_1_label tabindex=0> 0.学习线路 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_1_label aria-expanded=false> <label class=md-nav__title for=__nav_3_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Docker/ class=md-nav__link> Docker </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2 checked> <label class=md-nav__link for=__nav_3_2 id=__nav_3_2_label tabindex=0> 1.基础 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_2_label aria-expanded=true> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> 1.基础 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../1.%E5%AE%89%E8%A3%85Docker/ class=md-nav__link> 1.安装Docker </a> </li> <li class=md-nav__item> <a href=../2.Docker%E9%95%9C%E5%83%8F/ class=md-nav__link> 2.Docker镜像 </a> </li> <li class=md-nav__item> <a href=../3.Docker%E5%AE%B9%E5%99%A8/ class=md-nav__link> 3.Docker容器 </a> </li> <li class=md-nav__item> <a href=../4.%E4%BC%81%E4%B8%9A%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93harbor/ class=md-nav__link> 4.企业私有仓库harbor </a> </li> <li class=md-nav__item> <a href=../5.Docker%E6%95%B0%E6%8D%AE/ class=md-nav__link> 5.Docker数据 </a> </li> <li class=md-nav__item> <a href=../6.Docker%E7%BD%91%E7%BB%9C/ class=md-nav__link> 6.Docker网络 </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> 7.Dockerfile <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> 7.Dockerfile </a> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#1docker的基础镜像选择 class=md-nav__link> 1.Docker的基础镜像选择 </a> <nav class=md-nav aria-label=1.Docker的基础镜像选择> <ul class=md-nav__list> <li class=md-nav__item> <a href=#完整镜像 class=md-nav__link> 完整镜像 </a> </li> <li class=md-nav__item> <a href=#busterstretchjessie class=md-nav__link> buster/stretch/jessie </a> </li> <li class=md-nav__item> <a href=#slim class=md-nav__link> slim </a> </li> <li class=md-nav__item> <a href=#alpine class=md-nav__link> alpine </a> </li> <li class=md-nav__item> <a href=#如何选择镜像 class=md-nav__link> 如何选择镜像 </a> </li> <li class=md-nav__item> <a href=#关于版本的说明 class=md-nav__link> 关于版本的说明 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2dockerfile自定义镜像 class=md-nav__link> 2.Dockerfile自定义镜像 </a> <nav class=md-nav aria-label=2.Dockerfile自定义镜像> <ul class=md-nav__list> <li class=md-nav__item> <a href=#热门dockerfile示例 class=md-nav__link> 热门Dockerfile示例 </a> <nav class=md-nav aria-label=热门Dockerfile示例> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nginx class=md-nav__link> Nginx </a> </li> <li class=md-nav__item> <a href=#ubuntu class=md-nav__link> ubuntu </a> </li> <li class=md-nav__item> <a href=#nodejs class=md-nav__link> Node.js </a> </li> <li class=md-nav__item> <a href=#go class=md-nav__link> Go </a> </li> <li class=md-nav__item> <a href=#centos-nginx class=md-nav__link> Centos-Nginx </a> </li> <li class=md-nav__item> <a href=#redis class=md-nav__link> Redis </a> </li> <li class=md-nav__item> <a href=#mysql class=md-nav__link> MySQL </a> </li> <li class=md-nav__item> <a href=#mongodb class=md-nav__link> Mongodb </a> </li> <li class=md-nav__item> <a href=#postgres class=md-nav__link> Postgres </a> </li> <li class=md-nav__item> <a href=#httpd class=md-nav__link> httpd </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#3dockerfile编写优化 class=md-nav__link> 3.Dockerfile编写优化 </a> <nav class=md-nav aria-label=3.Dockerfile编写优化> <ul class=md-nav__list> <li class=md-nav__item> <a href=#31-使用小的基础镜像 class=md-nav__link> 3.1 使用小的基础镜像 </a> </li> <li class=md-nav__item> <a href=#32-指令链式运行 class=md-nav__link> 3.2 指令链式运行 </a> </li> <li class=md-nav__item> <a href=#33-变动的指令放到最后 class=md-nav__link> 3.3 变动的指令放到最后 </a> </li> <li class=md-nav__item> <a href=#34-首选数组而不是字符串语法 class=md-nav__link> 3.4 首选数组而不是字符串语法 </a> </li> <li class=md-nav__item> <a href=#35-copy而不是add class=md-nav__link> 3.5 COPY而不是ADD </a> </li> <li class=md-nav__item> <a href=#36-使用dockerignore class=md-nav__link> 3.6 使用.dockerignore </a> </li> <li class=md-nav__item> <a href=#37-利用多阶段构建 class=md-nav__link> 3.7 利用多阶段构建 </a> </li> <li class=md-nav__item> <a href=#38-写dockerfile的一些技巧 class=md-nav__link> 3.8 写Dockerfile的一些技巧 </a> <nav class=md-nav aria-label="3.8 写Dockerfile的一些技巧"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1用-python--m-pip-而不是-pip class=md-nav__link> 1.用 python -m pip 而不是 pip </a> </li> <li class=md-nav__item> <a href=#2让-apt-get-install-更安静 class=md-nav__link> 2.让 apt-get install 更安静 </a> </li> <li class=md-nav__item> <a href=#3让-curl-和-wget-更安静 class=md-nav__link> 3.让 curl 和 wget 更安静 </a> </li> <li class=md-nav__item> <a href=#4用axel而不是curl或者wget class=md-nav__link> 4.用axel而不是curl或者wget </a> </li> <li class=md-nav__item> <a href=#5设置容器时间同步 class=md-nav__link> 5.设置容器时间同步 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#39-dockerfile镜像创建 class=md-nav__link> 3.9 dockerfile镜像创建 </a> <nav class=md-nav aria-label="3.9 dockerfile镜像创建"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1创建镜像 class=md-nav__link> 1.创建镜像 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#310-dockerfile参考 class=md-nav__link> 3.10 dockerfile参考 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#4buildkit class=md-nav__link> 4.BuildKit </a> <nav class=md-nav aria-label=4.BuildKit> <ul class=md-nav__list> <li class=md-nav__item> <a href=#41-安装buildx class=md-nav__link> 4.1 安装buildx </a> </li> <li class=md-nav__item> <a href=#42-buildx示例 class=md-nav__link> 4.2 buildx示例 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#5dockerfile-实践 class=md-nav__link> 5.Dockerfile 实践 </a> <nav class=md-nav aria-label="5.Dockerfile 实践"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#51-dockerfile-for-golang class=md-nav__link> 5.1 Dockerfile for Golang </a> </li> <li class=md-nav__item> <a href=#52-dockerfile-for-python class=md-nav__link> 5.2 Dockerfile for Python </a> </li> <li class=md-nav__item> <a href=#53-构建nginxphptomcat基础镜像 class=md-nav__link> 5.3 构建Nginx，PHP，Tomcat基础镜像 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#6dockerfile工具 class=md-nav__link> 6.Dockerfile工具 </a> </li> <li class=md-nav__item> <a href=#7参考文献 class=md-nav__link> 7.参考文献 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../8.docker-compose/ class=md-nav__link> 8.docker-compose </a> </li> <li class=md-nav__item> <a href=../9.Docker%E7%9B%B8%E5%85%B3%E8%84%9A%E6%9C%AC/ class=md-nav__link> 9.Docker相关脚本 </a> </li> <li class=md-nav__item> <a href=../10.Docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/ class=md-nav__link> 10.Docker常用命令 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_3> <label class=md-nav__link for=__nav_3_3 id=__nav_3_3_label tabindex=0> 2.实战案例 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> 2.实战案例 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/1.%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/ class=md-nav__link> 1.操作系统 </a> </li> <li class=md-nav__item> <a href=../../2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/2.Web%E6%9C%8D%E5%8A%A1%E4%B8%8E%E5%BA%94%E7%94%A8/ class=md-nav__link> 2.Web服务与应用 </a> </li> <li class=md-nav__item> <a href=../../2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/3.%E6%8C%81%E7%BB%AD%E5%BC%80%E5%8F%91%E4%B8%8E%E7%AE%A1%E7%90%86/ class=md-nav__link> 3.持续开发与管理 </a> </li> <li class=md-nav__item> <a href=../../2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/4.%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BA%94%E7%94%A8/ class=md-nav__link> 4.数据库应用 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_4> <label class=md-nav__link for=__nav_3_4 id=__nav_3_4_label tabindex=0> 3.Devops <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_4_label aria-expanded=false> <label class=md-nav__title for=__nav_3_4> <span class="md-nav__icon md-icon"></span> 3.Devops </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../3.Devops/1.ConfCenter/ class=md-nav__link> ConfCenter </a> </li> <li class=md-nav__item> <a href=../../3.Devops/2.CoreDNS/ class=md-nav__link> Coredns </a> </li> <li class=md-nav__item> <a href=../../3.Devops/3.Harbor/ class=md-nav__link> Harbor </a> </li> <li class=md-nav__item> <a href=../../3.Devops/4.Python%E6%93%8D%E4%BD%9CDocker/ class=md-nav__link> Python操作Docker </a> </li> <li class=md-nav__item> <a href=../../3.Devops/5.Haproxy/ class=md-nav__link> Haproxy </a> </li> <li class=md-nav__item> <a href=../../3.Devops/6.Nexus/ class=md-nav__link> Nexus </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> Golang <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Golang </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_1> <label class=md-nav__link for=__nav_4_1 id=__nav_4_1_label tabindex=0> 0.学习线路 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_1_label aria-expanded=false> <label class=md-nav__title for=__nav_4_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Go-Web%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98/ class=md-nav__link> Go Web开发实战 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_2> <label class=md-nav__link for=__nav_4_2 id=__nav_4_2_label tabindex=0> 1.Go基础 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_2_label aria-expanded=false> <label class=md-nav__title for=__nav_4_2> <span class="md-nav__icon md-icon"></span> 1.Go基础 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/1.Go%E5%9F%BA%E7%A1%80/1.%E5%AE%89%E8%A3%85Go/ class=md-nav__link> 安装Go </a> </li> <li class=md-nav__item> <a href=../../../Golang/1.Go%E5%9F%BA%E7%A1%80/2.%E7%AC%AC%E4%B8%80%E4%B8%AAGo%E7%A8%8B%E5%BA%8F/ class=md-nav__link> 第一个Go程序 </a> </li> <li class=md-nav__item> <a href=../../../Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/ class=md-nav__link> Go基础语法 </a> </li> <li class=md-nav__item> <a href=../../../Golang/1.Go%E5%9F%BA%E7%A1%80/4.Go-Module%E6%95%99%E7%A8%8B/ class=md-nav__link> Go Module教程 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_3> <label class=md-nav__link for=__nav_4_3 id=__nav_4_3_label tabindex=0> 2.Go-Web基础 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_3_label aria-expanded=false> <label class=md-nav__title for=__nav_4_3> <span class="md-nav__icon md-icon"></span> 2.Go-Web基础 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/2.Go-Web%E5%9F%BA%E7%A1%80/5.%E7%AC%AC%E4%B8%80%E4%B8%AAGo-Web%E7%A8%8B%E5%BA%8F/ class=md-nav__link> 第一个Go Web程序 </a> </li> <li class=md-nav__item> <a href=../../../Golang/2.Go-Web%E5%9F%BA%E7%A1%80/6.Web%E7%A8%8B%E5%BA%8F%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86%E7%AE%80%E4%BB%8B/ class=md-nav__link> Web程序运行原理简介 </a> </li> <li class=md-nav__item> <a href=../../../Golang/2.Go-Web%E5%9F%BA%E7%A1%80/7.net-http%E5%8C%85/ class=md-nav__link> net/http包 </a> </li> <li class=md-nav__item> <a href=../../../Golang/2.Go-Web%E5%9F%BA%E7%A1%80/8.html-template%E5%8C%85/ class=md-nav__link> html/template包 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_4> <label class=md-nav__link for=__nav_4_4 id=__nav_4_4_label tabindex=0> 3.Go-Web请求处理 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4_4> <span class="md-nav__icon md-icon"></span> 3.Go-Web请求处理 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/3.Go-Web%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/9.%E7%AE%80%E5%8D%95Web%E6%9C%8D%E5%8A%A1%E5%99%A8/ class=md-nav__link> 简单Web服务器 </a> </li> <li class=md-nav__item> <a href=../../../Golang/3.Go-Web%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/10.%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82/ class=md-nav__link> 处理请求 </a> </li> <li class=md-nav__item> <a href=../../../Golang/3.Go-Web%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/11.session%E5%92%8Ccookie/ class=md-nav__link> session和cookie </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_5> <label class=md-nav__link for=__nav_4_5 id=__nav_4_5_label tabindex=0> 4.Go访问数据库 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_5_label aria-expanded=false> <label class=md-nav__title for=__nav_4_5> <span class="md-nav__icon md-icon"></span> 4.Go访问数据库 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/12.Go%E6%93%8D%E4%BD%9CMySQL/ class=md-nav__link> Go操作MySQL </a> </li> <li class=md-nav__item> <a href=../../../Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/13.Go%E6%93%8D%E4%BD%9CRedis/ class=md-nav__link> Go操作Redis </a> </li> <li class=md-nav__item> <a href=../../../Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/14.Go%E6%93%8D%E4%BD%9CMongoDB/ class=md-nav__link> Go操作MongoDB </a> </li> <li class=md-nav__item> <a href=../../../Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/15.Go%E7%9A%84%E5%B8%B8%E8%A7%81ORM%E5%BA%93/ class=md-nav__link> Go的常见ORM库 </a> </li> <li class=md-nav__item> <a href=../../../Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/16.Go%E6%93%8D%E4%BD%9CSQLite/ class=md-nav__link> Go操作SQLite </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_6> <label class=md-nav__link for=__nav_4_6 id=__nav_4_6_label tabindex=0> 5.Go高级网络编程 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_6_label aria-expanded=false> <label class=md-nav__title for=__nav_4_6> <span class="md-nav__icon md-icon"></span> 5.Go高级网络编程 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/5.Go%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/17.Go-Socket%E7%BC%96%E7%A8%8B/ class=md-nav__link> Go Socket编程 </a> </li> <li class=md-nav__item> <a href=../../../Golang/5.Go%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/18.Go-RPC%E7%BC%96%E7%A8%8B/ class=md-nav__link> Go RPC编程 </a> </li> <li class=md-nav__item> <a href=../../../Golang/5.Go%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/19.Go-%E5%BE%AE%E6%9C%8D%E5%8A%A1/ class=md-nav__link> Go 微服务 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_7> <label class=md-nav__link for=__nav_4_7 id=__nav_4_7_label tabindex=0> 6.Go文件处理 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_7_label aria-expanded=false> <label class=md-nav__title for=__nav_4_7> <span class="md-nav__icon md-icon"></span> 6.Go文件处理 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/20.%E5%A4%84%E7%90%86%E7%9B%AE%E5%BD%95%E4%B8%8E%E6%96%87%E4%BB%B6/ class=md-nav__link> 处理目录与文件 </a> </li> <li class=md-nav__item> <a href=../../../Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/21.%E5%A4%84%E7%90%86XML%E6%96%87%E4%BB%B6/ class=md-nav__link> 处理XML文件 </a> </li> <li class=md-nav__item> <a href=../../../Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/22.%E5%A4%84%E7%90%86JSON%E6%96%87%E4%BB%B6/ class=md-nav__link> 处理JSON文件 </a> </li> <li class=md-nav__item> <a href=../../../Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/23.%E5%A4%84%E7%90%86CSV%E6%96%87%E4%BB%B6/ class=md-nav__link> 处理CSV文件 </a> </li> <li class=md-nav__item> <a href=../../../Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/24.%E5%A4%84%E7%90%86%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95/ class=md-nav__link> 处理日志记录 </a> </li> <li class=md-nav__item> <a href=../../../Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/25.%E5%A4%84%E7%90%86%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/ class=md-nav__link> 处理正则表达式 </a> </li> <li class=md-nav__item> <a href=../../../Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/26.%E5%A4%84%E7%90%86Excel%E6%96%87%E4%BB%B6/ class=md-nav__link> 处理Excel文件 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_8> <label class=md-nav__link for=__nav_4_8 id=__nav_4_8_label tabindex=0> 7.Go并发编程 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_8_label aria-expanded=false> <label class=md-nav__title for=__nav_4_8> <span class="md-nav__icon md-icon"></span> 7.Go并发编程 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/26.%E5%B9%B6%E5%8F%91%E4%B8%8E%E5%B9%B6%E8%A1%8C/ class=md-nav__link> 并发与并行 </a> </li> <li class=md-nav__item> <a href=../../../Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/27.%E8%BF%9B%E7%A8%8B%20%E7%BA%BF%E7%A8%8B%E5%92%8C%E5%8D%8F%E7%A8%8B/ class=md-nav__link> 进程 线程和协程 </a> </li> <li class=md-nav__item> <a href=../../../Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/28.Go%E5%B9%B6%E5%8F%91%E6%A8%A1%E5%9E%8B%E7%AE%80%E4%BB%8B/ class=md-nav__link> Go并发模型简介 </a> </li> <li class=md-nav__item> <a href=../../../Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/29.gogoroutine%E5%92%8Cchannel%E5%AE%9E%E7%8E%B0%E5%B9%B6%E5%8F%91/ class=md-nav__link> gogoroutine和channel实现并发 </a> </li> <li class=md-nav__item> <a href=../../../Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/30.sync%E5%AE%9E%E7%8E%B0%E5%B9%B6%E5%8F%91/ class=md-nav__link> sync实现并发 </a> </li> <li class=md-nav__item> <a href=../../../Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/31.Go%E5%B9%B6%E5%8F%91%E7%9A%84Web%E5%BA%94%E7%94%A8/ class=md-nav__link> Go并发的Web应用 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_9> <label class=md-nav__link for=__nav_4_9 id=__nav_4_9_label tabindex=0> 8.Go标准库 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_9_label aria-expanded=false> <label class=md-nav__title for=__nav_4_9> <span class="md-nav__icon md-icon"></span> 8.Go标准库 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/32.time/ class=md-nav__link> time </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/33.strings/ class=md-nav__link> strings </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/34.bytes/ class=md-nav__link> bytes </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/35.json/ class=md-nav__link> json </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/36.io-bufio/ class=md-nav__link> io/bufio </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/37.fmt/ class=md-nav__link> fmt </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/38.strconv/ class=md-nav__link> strconv </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/39.regexp/ class=md-nav__link> regexp </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/40.log/ class=md-nav__link> log </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/41.reflect-unsafe/ class=md-nav__link> reflect/unsafe </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/42.os-path-filepath/ class=md-nav__link> os/path/filepath </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/43.unicode/ class=md-nav__link> unicode </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/44.flag/ class=md-nav__link> flag </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/45.net-url/ class=md-nav__link> net/url </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/46.net-http/ class=md-nav__link> net/http </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/47.sort/ class=md-nav__link> sort </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/48.errors/ class=md-nav__link> errors </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_10> <label class=md-nav__link for=__nav_4_10 id=__nav_4_10_label tabindex=0> 9.Go三方库 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_10_label aria-expanded=false> <label class=md-nav__title for=__nav_4_10> <span class="md-nav__icon md-icon"></span> 9.Go三方库 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/0.%E5%BC%80%E6%BA%90%E8%87%AA%E5%B7%B1%E7%9A%84Go%E5%BA%93/ class=md-nav__link> 开源自己的Go库 </a> </li> <li class=md-nav__item> <a href=../../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/1.cobra/ class=md-nav__link> Cobra </a> </li> <li class=md-nav__item> <a href=../../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/2.viper/ class=md-nav__link> Viper </a> </li> <li class=md-nav__item> <a href=../../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/3.mahonia/ class=md-nav__link> mahonia </a> </li> <li class=md-nav__item> <a href=../../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/4.ssh/ class=md-nav__link> ssh </a> </li> <li class=md-nav__item> <a href=../../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/5.fsnotify/ class=md-nav__link> fsnotify </a> </li> <li class=md-nav__item> <a href=../../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/6.yaml/ class=md-nav__link> yaml </a> </li> <li class=md-nav__item> <a href=../../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/7.tail/ class=md-nav__link> tail </a> </li> <li class=md-nav__item> <a href=../../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/8.gopsutil/ class=md-nav__link> gopsutil </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> Python <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Python </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_1> <label class=md-nav__link for=__nav_5_1 id=__nav_5_1_label tabindex=0> 0.学习线路 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_1_label aria-expanded=false> <label class=md-nav__title for=__nav_5_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Pythjon-auto-ops/ class=md-nav__link> Python linux管理与自动化运维 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_2> <label class=md-nav__link for=__nav_5_2 id=__nav_5_2_label tabindex=0> 1.基础篇 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_2_label aria-expanded=false> <label class=md-nav__title for=__nav_5_2> <span class="md-nav__icon md-icon"></span> 1.基础篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/1.Python%E7%94%9F%E6%80%81%E5%B7%A5%E5%85%B7/ class=md-nav__link> 1.Python生态工具 </a> </li> <li class=md-nav__item> <a href=../../../Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/2.Python%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E5%AE%89%E8%A3%85/ class=md-nav__link> 2.Python第三方库安装 </a> </li> <li class=md-nav__item> <a href=../../../Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/3.Python%E5%B7%A5%E4%BD%9C%E7%8E%AF%E5%A2%83%E7%AE%A1%E7%90%86/ class=md-nav__link> 3.Python工作环境管理 </a> </li> <li class=md-nav__item> <a href=../../../Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/4.VSCode%E4%B8%ADPython%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/ class=md-nav__link> 4.VSCode中Python环境配置 </a> </li> <li class=md-nav__item> <a href=../../../Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/5.%E5%85%B6%E4%BB%96%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/ class=md-nav__link> 5.其他开发工具 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_3> <label class=md-nav__link for=__nav_5_3 id=__nav_5_3_label tabindex=0> 2.高级篇 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_3_label aria-expanded=false> <label class=md-nav__title for=__nav_5_3> <span class="md-nav__icon md-icon"></span> 2.高级篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/6.%E6%89%93%E9%80%A0%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/ class=md-nav__link> 6.打造命令行工具 </a> </li> <li class=md-nav__item> <a href=../../../Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/7.%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/ class=md-nav__link> 7.文本处理 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> Python-vs-Go <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Python-vs-Go </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_1> <label class=md-nav__link for=__nav_6_1 id=__nav_6_1_label tabindex=0> 0.学习线路 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_1_label aria-expanded=false> <label class=md-nav__title for=__nav_6_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python-vs-Go/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Python-vs-Go/ class=md-nav__link> Python-vs-Go </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_2> <label class=md-nav__link for=__nav_6_2 id=__nav_6_2_label tabindex=0> 1.对比学习 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_2_label aria-expanded=false> <label class=md-nav__title for=__nav_6_2> <span class="md-nav__icon md-icon"></span> 1.对比学习 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/1.Hello-World/ class=md-nav__link> Hello-World </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/2.Print/ class=md-nav__link> Print </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/3.%E6%B3%A8%E9%87%8A/ class=md-nav__link> 注释 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/4.%E5%A4%9A%E8%A1%8C%E5%AD%97%E7%AC%A6%E4%B8%B2/ class=md-nav__link> 多行字符串 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/5.Lists/ class=md-nav__link> Lists </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/6.Map/ class=md-nav__link> Map </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/7.Booleans/ class=md-nav__link> Booleans </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/8.Forloop/ class=md-nav__link> Forloop </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/9.Range/ class=md-nav__link> Range </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/10.Switch/ class=md-nav__link> Switch </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/11.%E5%8F%AF%E5%8F%98%E5%8F%82%E6%95%B0%E5%87%BD%E6%95%B0/ class=md-nav__link> 可变参数函数 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/12.%E6%97%B6%E9%97%B4%E8%AE%A1%E7%AE%97/ class=md-nav__link> 时间计算 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/13.%E5%87%BD%E6%95%B0%E7%9A%84%E9%97%AD%E5%8C%85/ class=md-nav__link> 函数的闭包 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/14.%E9%80%80%E5%87%BA%E5%A4%84%E7%90%86/ class=md-nav__link> 退出处理 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/15.%E5%BC%82%E5%B8%B8%E6%8D%95%E8%8E%B7/ class=md-nav__link> 异常捕获 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/16.%E5%8F%AF%E5%8F%98%E9%A1%B9/ class=md-nav__link> 可变项 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/17.%E7%B1%BB/ class=md-nav__link> 类 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/18.%E6%96%B9%E6%B3%95/ class=md-nav__link> 方法 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/19.%E5%B9%B6%E5%8F%91/ class=md-nav__link> 并发 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/20.Args/ class=md-nav__link> Args </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/21.%E5%AF%BC%E5%85%A5%E6%A8%A1%E5%9D%97%E5%88%AB%E5%90%8D/ class=md-nav__link> 导入模块别名 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/22.%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%A0%BC%E5%BC%8F%E5%8C%96/ class=md-nav__link> 字符串格式化 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/23.%E5%8E%BB%E9%87%8D/ class=md-nav__link> 去重 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/24.%E5%B8%A6%E9%A2%9C%E8%89%B2%E6%89%93%E5%8D%B0/ class=md-nav__link> 带颜色打印 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_3> <label class=md-nav__link for=__nav_6_3 id=__nav_6_3_label tabindex=0> 2.进阶 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_3_label aria-expanded=false> <label class=md-nav__title for=__nav_6_3> <span class="md-nav__icon md-icon"></span> 2.进阶 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python-vs-Go/2.%E8%BF%9B%E9%98%B6/1.%E4%BD%BF%E7%94%A8RPC/ class=md-nav__link> 使用RPC </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/2.%E8%BF%9B%E9%98%B6/2.%E4%BD%BF%E7%94%A8MySQL/ class=md-nav__link> 使用MySQL </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/2.%E8%BF%9B%E9%98%B6/3.%E4%BD%BF%E7%94%A8Redis/ class=md-nav__link> 使用Redis </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/2.%E8%BF%9B%E9%98%B6/4.%E4%BD%BF%E7%94%A8MongoDB/ class=md-nav__link> 使用MongoDB </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex=0> Linux <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Linux </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_1> <label class=md-nav__link for=__nav_7_1 id=__nav_7_1_label tabindex=0> Shell <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_1_label aria-expanded=false> <label class=md-nav__title for=__nav_7_1> <span class="md-nav__icon md-icon"></span> Shell </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Linux/shell/Shell%E7%AE%80%E4%BB%8B/ class=md-nav__link> Shell 教程概述 </a> </li> <li class=md-nav__item> <a href=../../../Linux/shell/1.%E7%AC%AC%E4%B8%80%E4%B8%AAshell%E7%A8%8B%E5%BA%8F/ class=md-nav__link> 1.第一个 Shell 程序 </a> </li> <li class=md-nav__item> <a href=../../../Linux/shell/2.Shell%E5%8F%98%E9%87%8F/ class=md-nav__link> 2.Shell 变量 </a> </li> <li class=md-nav__item> <a href=../../../Linux/shell/3.Shell%E5%8F%82%E6%95%B0/ class=md-nav__link> 3.Shell 参数 </a> </li> <li class=md-nav__item> <a href=../../../Linux/shell/4.Shell%E6%95%B0%E7%BB%84/ class=md-nav__link> 4.Shell数组 </a> </li> <li class=md-nav__item> <a href=../../../Linux/shell/5.Shell%E8%BF%90%E7%AE%97%E7%AC%A6/ class=md-nav__link> 5.Shell 运算符 </a> </li> <li class=md-nav__item> <a href=../../../Linux/shell/6.Shell%20echo_printf%E5%91%BD%E4%BB%A4/ class=md-nav__link> 6.Shell echo/printf 命令 </a> </li> <li class=md-nav__item> <a href=../../../Linux/shell/7.Shell%20test%E5%91%BD%E4%BB%A4/ class=md-nav__link> 7.Shell test 命令 </a> </li> <li class=md-nav__item> <a href=../../../Linux/shell/8.Shell%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/ class=md-nav__link> 8.Shell 流程控制 </a> </li> <li class=md-nav__item> <a href=../../../Linux/shell/9.Shell%E5%87%BD%E6%95%B0/ class=md-nav__link> 8.Shell 函数 </a> </li> <li class=md-nav__item> <a href=../../../Linux/shell/10.Shell%E8%BE%93%E5%85%A5_%E8%BE%93%E5%87%BA%E9%87%8D%E5%AE%9A%E5%90%91/ class=md-nav__link> 10.Shell输入/输出重定向 </a> </li> <li class=md-nav__item> <a href=../../../Linux/shell/11.Shell%20%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/ class=md-nav__link> 11.Shell 正则表达式 </a> </li> <li class=md-nav__item> <a href=../../../Linux/shell/12.Shell%20%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bgrep/ class=md-nav__link> 12.Shell 三剑客之grep </a> </li> <li class=md-nav__item> <a href=../../../Linux/shell/13.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/ class=md-nav__link> 13.Shell三剑客之sed </a> </li> <li class=md-nav__item> <a href=../../../Linux/shell/14.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bawk/ class=md-nav__link> 14.Shell三剑客之awk </a> </li> <li class=md-nav__item> <a href=../../../Linux/shell/15.Shell%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/ class=md-nav__link> 15.Shell常用工具 </a> </li> <li class=md-nav__item> <a href=../../../Linux/shell/16.Shell%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/ class=md-nav__link> 16.Shell实战项目 </a> </li> <li class=md-nav__item> <a href=../../../Linux/shell/17.Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/ class=md-nav__link> 17.Shell脚本示例 </a> </li> <li class=md-nav__item> <a href=../../../Linux/shell/18.Shell%E8%84%9A%E6%9C%AC%E7%9A%84%E5%8F%82%E6%95%B0%E8%A7%A3%E6%9E%90%E5%B7%A5%E5%85%B7/ class=md-nav__link> 18.Shell脚本的参数解析工具 </a> </li> <li class=md-nav__item> <a href=../../../Linux/shell/19.10%E4%B8%AA%E5%AE%9E%E7%94%A8Linux-Shell%E8%84%9A%E6%9C%AC%E6%A1%88%E4%BE%8B/ class=md-nav__link> 19.10个实用Linux Shell脚本案例 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_2> <label class=md-nav__link for=__nav_7_2 id=__nav_7_2_label tabindex=0> system <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_2_label aria-expanded=false> <label class=md-nav__title for=__nav_7_2> <span class="md-nav__icon md-icon"></span> system </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Linux/system/0.Linux%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E4%B8%8B%E8%BD%BD/ class=md-nav__link> Linux操作系统镜像下载 </a> </li> <li class=md-nav__item> <a href=../../../Linux/system/1.Linux%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/ class=md-nav__link> Linux 系统安全加固最佳实践 </a> </li> <li class=md-nav__item> <a href=../../../Linux/system/2.Systemd/ class=md-nav__link> Systemd </a> </li> <li class=md-nav__item> <a href=../../../Linux/system/3.Superivisor/ class=md-nav__link> Superivisor </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_3> <label class=md-nav__link for=__nav_7_3 id=__nav_7_3_label tabindex=0> serveices <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_3_label aria-expanded=false> <label class=md-nav__title for=__nav_7_3> <span class="md-nav__icon md-icon"></span> serveices </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Linux/serveices/0.ubuntu-desktop-vmware/ class=md-nav__link> ubuntu-desktop-vmware </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_4> <label class=md-nav__link for=__nav_7_4 id=__nav_7_4_label tabindex=0> Ansible <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_4_label aria-expanded=false> <label class=md-nav__title for=__nav_7_4> <span class="md-nav__icon md-icon"></span> Ansible </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Linux/Ansible/Ansible-wiki/ class=md-nav__link> Ansible-wiki </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#1docker的基础镜像选择 class=md-nav__link> 1.Docker的基础镜像选择 </a> <nav class=md-nav aria-label=1.Docker的基础镜像选择> <ul class=md-nav__list> <li class=md-nav__item> <a href=#完整镜像 class=md-nav__link> 完整镜像 </a> </li> <li class=md-nav__item> <a href=#busterstretchjessie class=md-nav__link> buster/stretch/jessie </a> </li> <li class=md-nav__item> <a href=#slim class=md-nav__link> slim </a> </li> <li class=md-nav__item> <a href=#alpine class=md-nav__link> alpine </a> </li> <li class=md-nav__item> <a href=#如何选择镜像 class=md-nav__link> 如何选择镜像 </a> </li> <li class=md-nav__item> <a href=#关于版本的说明 class=md-nav__link> 关于版本的说明 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2dockerfile自定义镜像 class=md-nav__link> 2.Dockerfile自定义镜像 </a> <nav class=md-nav aria-label=2.Dockerfile自定义镜像> <ul class=md-nav__list> <li class=md-nav__item> <a href=#热门dockerfile示例 class=md-nav__link> 热门Dockerfile示例 </a> <nav class=md-nav aria-label=热门Dockerfile示例> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nginx class=md-nav__link> Nginx </a> </li> <li class=md-nav__item> <a href=#ubuntu class=md-nav__link> ubuntu </a> </li> <li class=md-nav__item> <a href=#nodejs class=md-nav__link> Node.js </a> </li> <li class=md-nav__item> <a href=#go class=md-nav__link> Go </a> </li> <li class=md-nav__item> <a href=#centos-nginx class=md-nav__link> Centos-Nginx </a> </li> <li class=md-nav__item> <a href=#redis class=md-nav__link> Redis </a> </li> <li class=md-nav__item> <a href=#mysql class=md-nav__link> MySQL </a> </li> <li class=md-nav__item> <a href=#mongodb class=md-nav__link> Mongodb </a> </li> <li class=md-nav__item> <a href=#postgres class=md-nav__link> Postgres </a> </li> <li class=md-nav__item> <a href=#httpd class=md-nav__link> httpd </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#3dockerfile编写优化 class=md-nav__link> 3.Dockerfile编写优化 </a> <nav class=md-nav aria-label=3.Dockerfile编写优化> <ul class=md-nav__list> <li class=md-nav__item> <a href=#31-使用小的基础镜像 class=md-nav__link> 3.1 使用小的基础镜像 </a> </li> <li class=md-nav__item> <a href=#32-指令链式运行 class=md-nav__link> 3.2 指令链式运行 </a> </li> <li class=md-nav__item> <a href=#33-变动的指令放到最后 class=md-nav__link> 3.3 变动的指令放到最后 </a> </li> <li class=md-nav__item> <a href=#34-首选数组而不是字符串语法 class=md-nav__link> 3.4 首选数组而不是字符串语法 </a> </li> <li class=md-nav__item> <a href=#35-copy而不是add class=md-nav__link> 3.5 COPY而不是ADD </a> </li> <li class=md-nav__item> <a href=#36-使用dockerignore class=md-nav__link> 3.6 使用.dockerignore </a> </li> <li class=md-nav__item> <a href=#37-利用多阶段构建 class=md-nav__link> 3.7 利用多阶段构建 </a> </li> <li class=md-nav__item> <a href=#38-写dockerfile的一些技巧 class=md-nav__link> 3.8 写Dockerfile的一些技巧 </a> <nav class=md-nav aria-label="3.8 写Dockerfile的一些技巧"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1用-python--m-pip-而不是-pip class=md-nav__link> 1.用 python -m pip 而不是 pip </a> </li> <li class=md-nav__item> <a href=#2让-apt-get-install-更安静 class=md-nav__link> 2.让 apt-get install 更安静 </a> </li> <li class=md-nav__item> <a href=#3让-curl-和-wget-更安静 class=md-nav__link> 3.让 curl 和 wget 更安静 </a> </li> <li class=md-nav__item> <a href=#4用axel而不是curl或者wget class=md-nav__link> 4.用axel而不是curl或者wget </a> </li> <li class=md-nav__item> <a href=#5设置容器时间同步 class=md-nav__link> 5.设置容器时间同步 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#39-dockerfile镜像创建 class=md-nav__link> 3.9 dockerfile镜像创建 </a> <nav class=md-nav aria-label="3.9 dockerfile镜像创建"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1创建镜像 class=md-nav__link> 1.创建镜像 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#310-dockerfile参考 class=md-nav__link> 3.10 dockerfile参考 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#4buildkit class=md-nav__link> 4.BuildKit </a> <nav class=md-nav aria-label=4.BuildKit> <ul class=md-nav__list> <li class=md-nav__item> <a href=#41-安装buildx class=md-nav__link> 4.1 安装buildx </a> </li> <li class=md-nav__item> <a href=#42-buildx示例 class=md-nav__link> 4.2 buildx示例 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#5dockerfile-实践 class=md-nav__link> 5.Dockerfile 实践 </a> <nav class=md-nav aria-label="5.Dockerfile 实践"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#51-dockerfile-for-golang class=md-nav__link> 5.1 Dockerfile for Golang </a> </li> <li class=md-nav__item> <a href=#52-dockerfile-for-python class=md-nav__link> 5.2 Dockerfile for Python </a> </li> <li class=md-nav__item> <a href=#53-构建nginxphptomcat基础镜像 class=md-nav__link> 5.3 构建Nginx，PHP，Tomcat基础镜像 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#6dockerfile工具 class=md-nav__link> 6.Dockerfile工具 </a> </li> <li class=md-nav__item> <a href=#7参考文献 class=md-nav__link> 7.参考文献 </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=7dockerfile>7.Dockerfile<a class=headerlink href=#7dockerfile title="Permanent link">&para;</a></h1> <p>Dockerfile是一个文本文件，里面包含一条条指令，每一条指令就是一层镜像。</p> <p>一般情况下，Dockerfile分为4个部分：</p> <ul> <li>基础镜像</li> <li>维护者信息</li> <li>镜像操作指令</li> <li>容器启动时执行命令</li> </ul> <p>例如：</p> <p><div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class="l l-Scalar l-Scalar-Plain">FROM docker.io/centos</span>
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class="l l-Scalar l-Scalar-Plain">LABEL &quot;auth&quot;=&quot;joker&quot; \</span>
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=w>      </span><span class="l l-Scalar l-Scalar-Plain">&quot;mail&quot;=&quot;unclejoker520@163.com&quot;</span>
<a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class="l l-Scalar l-Scalar-Plain">ENV TIME_ZOME Asia/Shanghai</span>
<a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class="l l-Scalar l-Scalar-Plain">RUN yum install -y gcc gcc-c++ make openssl-devel prce-devel</span>
<a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class="l l-Scalar l-Scalar-Plain">ADD nginx-1.14.2.tar.gz /opt/</span>
<a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a><span class="l l-Scalar l-Scalar-Plain">RUN cd /opt/nginx-1.14.2 &amp;&amp; \</span>
<a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">./configure --prefix=/usr/local/nginx &amp;&amp; \</span>
<a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">make -j 4 &amp;&amp; \</span>
<a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">make install</span>
<a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a>
<a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a><span class="l l-Scalar l-Scalar-Plain">RUN rm -rf /opt/nginx* &amp;&amp; \</span>
<a id=__codelineno-0-13 name=__codelineno-0-13 href=#__codelineno-0-13></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">yum clean all &amp;&amp; \</span>
<a id=__codelineno-0-14 name=__codelineno-0-14 href=#__codelineno-0-14></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">echo &quot;${TIME_ZOME}&quot; &gt; /etc/timezone &amp;&amp; \</span>
<a id=__codelineno-0-15 name=__codelineno-0-15 href=#__codelineno-0-15></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">ln -sf /usr/share/zoneinfo/${TIME_ZOME} /etc/localtime</span>
<a id=__codelineno-0-16 name=__codelineno-0-16 href=#__codelineno-0-16></a>
<a id=__codelineno-0-17 name=__codelineno-0-17 href=#__codelineno-0-17></a><span class="l l-Scalar l-Scalar-Plain">COPY nginx.conf /usr/local/nginx/conf/</span>
<a id=__codelineno-0-18 name=__codelineno-0-18 href=#__codelineno-0-18></a><span class="l l-Scalar l-Scalar-Plain">WORKDIR /usr/local/nginx/</span>
<a id=__codelineno-0-19 name=__codelineno-0-19 href=#__codelineno-0-19></a><span class="l l-Scalar l-Scalar-Plain">EXPOSE 80</span>
<a id=__codelineno-0-20 name=__codelineno-0-20 href=#__codelineno-0-20></a><span class="l l-Scalar l-Scalar-Plain">CMD [&quot;./sbin/nginx&quot;,&quot;-g&quot;,&quot;daemon off;&quot;]</span>
</code></pre></div> 其中FROM指令必须是开篇第一个非注释行，是必须存在的一个指令，后面所有的操作都是基于这个镜像的。</p> <p>后面的指令就是一些操作指令，指令的详情在后面介绍。最后是CMD指定，这个指令表示在容器运行是需要执行的命令。</p> <h2 id=1docker的基础镜像选择>1.Docker的基础镜像选择<a class=headerlink href=#1docker的基础镜像选择 title="Permanent link">&para;</a></h2> <p>我们在使用Docker hub挑选Docker的基础镜像的时候，发现了很多版本，包括Alpine、Slim、Stretch、Buster、Jessie、Bullseye。</p> <h3 id=完整镜像>完整镜像<a class=headerlink href=#完整镜像 title="Permanent link">&para;</a></h3> <p>我将使用python和node作为例子，因为这些是我最常用的docker镜像，这也同样适用于任何镜像。</p> <p>根据DockerHub，这是事实上的标准镜像，如果你不确定，你应该使用它。</p> <ul> <li> <p>python:3.8.3</p> </li> <li> <p>node:14.1.1</p> </li> </ul> <p>这些镜像基于最新的稳定Debian操作系统发行版。 </p> <p><strong>当我试图让一个项目快速启动和运行时，我通常会从其中的一个开始，我并不关心最终镜像的大小。完整镜像是最安全的选择</strong></p> <h3 id=busterstretchjessie>buster/stretch/jessie<a class=headerlink href=#busterstretchjessie title="Permanent link">&para;</a></h3> <ul> <li> <p>buster:Debian 10</p> </li> <li> <p>stretch:Debian 9</p> </li> <li> <p>jessie:Debian 8</p> </li> </ul> <p>带有stretch、buster或jessie标签的镜像是不同Debian发行版的代号。</p> <p>正在开发的未来版本是“bullseye ”和“bookworm”，但还不稳定。</p> <p>你可能会在DockerHub上的镜像版本列表中看到这些标签。</p> <p>如果您的代码与Debian操作系统的特定版本兼容，请选择其中一个镜像。</p> <p>在开始一个新项目时，你很少需要使用旧版本的Debian。</p> <h3 id=slim>slim<a class=headerlink href=#slim title="Permanent link">&para;</a></h3> <p>slim的镜像是完整镜像的配对版本。</p> <p>这个镜像通常只安装运行特定工具所需的最小包。</p> <p>以python为例，就是运行python的最小包，node.js同理。</p> <p>通过省去较少使用的工具，镜像会更小。如果有空间限制且不需要完整版本，请使用此镜像。</p> <p>**但是，在使用这个镜像时，一定要进行彻底的测试！**如果您遇到无法解释的错误，请尝试切换到完整的镜像，看看是否能够解决问题。</p> <h3 id=alpine>alpine<a class=headerlink href=#alpine title="Permanent link">&para;</a></h3> <p>这些是最受欢迎的镜像变体，因为它们的尺寸很小。</p> <p>然而，一些团队正在弃用alpine镜像，因为这些镜像可能会导致难以调试的兼容性问题。具体来说，如果使用python镜像，一些 wheels将被构建成与Debian兼容，并且需要重新编译，才能与基于apline的镜像一起工作。</p> <p>使用alpine镜像的主要原因是使你得到的镜像尽可能小。基础镜像将小于5MB。</p> <p>python基础镜像(将python添加到基础alpine镜像)目前是78.9MB。这仍然很小。</p> <p><strong>如果考虑到空间问题，强烈推荐使用此镜像。</strong></p> <p>它的缺点是不包含一些你可能会需要的包。</p> <p>主要是，它使用了一个更小的musl lib代替glibc。如果您的应用程序有特定的libc需求，您可能会遇到问题。</p> <p>如果你发现Alpine镜像缺少你需要的东西，你可以直接在Dockerfile中安装它，这样能确保镜像只包含你需要的内容。需要注意，如果您正在安装外部包，您的Dockerfile将会更改。</p> <p>主要的区别是，您将使用apk而不是apt-get来安装包。</p> <p>对alpine镜像的使用有很多担心之处，所以你需要充分了解它。</p> <p>需要充分阅读文档并研究。 同样，如果您在构建Dockerfile时遇到了无法解释的问题，请尝试切换到完整的镜像，看看是否能解决问题。</p> <h3 id=如何选择镜像>如何选择镜像<a class=headerlink href=#如何选择镜像 title="Permanent link">&para;</a></h3> <p>以下是我使用的通用准则：</p> <ul> <li> <p>如果我需要快速启动并运行项目，没有空间限制，并且没有时间进行太多测试，那么我就使用实际的标准镜像。 我最关心的是镜像有我需要的所有东西，镜像大小并不关心。</p> </li> <li> <p>如果空间是一个问题，并且我知道我只需要最小的包来运行特定的语言，如python，我会选择slim</p> </li> <li> <p>对于一些我有时间彻底测试的项目，并且有极端的空间限制，我将使用alpine镜像。但是要注意，这可能会导致更长的构建时间和不确定的bug。 如果您在将docker容器移植到新环境时遇到了困难，或者在添加新包时出现了故障，这可能是因为Alpine镜像。</p> </li> <li> <p>最后，滚动到特定镜像的DockerHub页面底部，阅读有关选择镜像的建议。</p> </li> </ul> <h3 id=关于版本的说明>关于版本的说明<a class=headerlink href=#关于版本的说明 title="Permanent link">&para;</a></h3> <p>不要在生产系统Dockerfile中使用<code>&lt;image&gt;:latest</code>。</p> <p>这样做将总是获取最新的镜像，并且应用程序的依赖项可能与未来的版本不兼容。</p> <p>当开始一个新项目时，我通常会从最近标记的版本开始，进行彻底的测试，然后根据需要升级，在投入生产之前进行彻底的测试。</p> <h2 id=2dockerfile自定义镜像>2.Dockerfile自定义镜像<a class=headerlink href=#2dockerfile自定义镜像 title="Permanent link">&para;</a></h2> <p>构建常用指令温习</p> <ul> <li>FROM：基础镜像 </li> <li>RUN：制作镜像时执行的命令，可以有多个，每个命令一层 </li> <li>ADD：复制文件到镜像，自动解压 (文件类型为: tar.gz 或 tar.bz2)</li> <li>COPY：复制文件到镜像，不解压 </li> <li>MAINTAINER：镜像创建者信息(新版本以弃用，可以使用LABLE )</li> <li>EXPOSE：开放的端口 </li> <li>ENV：设置变量 </li> <li>WORKDIR：定义容器默认工作目录 </li> <li>CMD: 容器启动时执行的命令，仅可以有一条CMD. </li> <li>ENTRYPOINT:类似CMD指令的功能，用于为容器指定默认运行程序，从而使得容器像是一具单独的可执行程序</li> </ul> <p>一些需要注意的事项：</p> <ul> <li> <p>当 docker run 命令中声明了参数时，Docker 守护程序会忽略 CMD 命令。</p> </li> <li> <p>与CMD不同的是，由ENTRYPOINT启动的程序不会被docker run命令行指定的参数所覆盖，而且，这些命令行参数会被当作参数传递给ENTRYPOINT指定的程序。不过，docker run 命令的<code>--entrypoint</code>选项的参数可覆盖ENTRYPOINT指令指定的程序</p> </li> <li> <p>Dockfile中，如果没有使用CMD指定启动命令，则会继承上一个镜像的默认启动命令；CMD 容器的默认启动命令，有且只能有一条；</p> </li> </ul> <p>根据Dockerfile生成新的镜像命令中,build 创建新的镜像；<code>-t</code>指定新镜像的名字和标签；<code>.</code>指定Dockerfile文件所在的目录</p> <div class=highlight><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a>docker<span class=w> </span>build<span class=w> </span>-t<span class=w> </span>imagename:latest<span class=w> </span>Dockerfile所在目录
</code></pre></div> <p>容器和镜像之间的主要区别在于顶部 可写层。对容器的所有添加新数据或修改现有数据的写入都存储在此 可写层 中。删除容器时，可写层也会被删除。基础镜像保持不变。</p> <p>这里利用了<code>写时复制技术(COW,copy on write)</code> , 对于开发的小伙伴，可以结合享元设计模式理解，对于运维的小伙伴，可以结合 Openstack 组件 Glance 原理来理解</p> <p>用通俗的话讲，当修改时，会把数据复制到容器层修改。当新增的时候直接在容器层新增，当删除时，会屏蔽镜像层。</p> <p>Docker 通过读取给定的指令来自动构建镜像。<code>遵循特定的格式和指令集，其中的 每一条指令在容器镜像中创建一个层。这些层是堆叠的，每个层都是与前一层相比的变化的增量</code></p> <p>这里我们以 redis:7 这个官方镜像为例,看看一个标准的 Dockerfile 如何书写，可以看到镜像构建了 16 层。</p> <div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a>$<span class=w> </span>docker<span class=w> </span><span class=nb>history</span><span class=w> </span>--human<span class=o>=</span><span class=nb>true</span><span class=w>  </span>redis:7
<a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a>IMAGE<span class=w>          </span>CREATED<span class=w>       </span>CREATED<span class=w> </span>BY<span class=w>                                      </span>SIZE<span class=w>      </span>COMMENT
<a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a>19c51d4327cf<span class=w>   </span><span class=m>6</span><span class=w> </span>weeks<span class=w> </span>ago<span class=w>   </span>/bin/sh<span class=w> </span>-c<span class=w> </span><span class=c1>#(nop)  CMD [&quot;redis-server&quot;]         0B</span>
<a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a>&lt;missing&gt;<span class=w>      </span><span class=m>6</span><span class=w> </span>weeks<span class=w> </span>ago<span class=w>   </span>/bin/sh<span class=w> </span>-c<span class=w> </span><span class=c1>#(nop)  EXPOSE 6379                  0B</span>
<a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a>&lt;missing&gt;<span class=w>      </span><span class=m>6</span><span class=w> </span>weeks<span class=w> </span>ago<span class=w>   </span>/bin/sh<span class=w> </span>-c<span class=w> </span><span class=c1>#(nop)  ENTRYPOINT [&quot;docker-entry…   0B</span>
<a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a>&lt;missing&gt;<span class=w>      </span><span class=m>6</span><span class=w> </span>weeks<span class=w> </span>ago<span class=w>   </span>/bin/sh<span class=w> </span>-c<span class=w> </span><span class=c1>#(nop) COPY file:e873a0e3c13001b5…   661B</span>
<a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a>&lt;missing&gt;<span class=w>      </span><span class=m>6</span><span class=w> </span>weeks<span class=w> </span>ago<span class=w>   </span>/bin/sh<span class=w> </span>-c<span class=w> </span><span class=c1>#(nop) WORKDIR /data                 0B</span>
<a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a>&lt;missing&gt;<span class=w>      </span><span class=m>6</span><span class=w> </span>weeks<span class=w> </span>ago<span class=w>   </span>/bin/sh<span class=w> </span>-c<span class=w> </span><span class=c1>#(nop)  VOLUME [/data]               0B</span>
<a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a>&lt;missing&gt;<span class=w>      </span><span class=m>6</span><span class=w> </span>weeks<span class=w> </span>ago<span class=w>   </span>/bin/sh<span class=w> </span>-c<span class=w> </span>mkdir<span class=w> </span>/data<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>chown<span class=w> </span>redis:redis<span class=w> </span>…<span class=w>   </span>0B
<a id=__codelineno-2-10 name=__codelineno-2-10 href=#__codelineno-2-10></a>&lt;missing&gt;<span class=w>      </span><span class=m>6</span><span class=w> </span>weeks<span class=w> </span>ago<span class=w>   </span>/bin/sh<span class=w> </span>-c<span class=w> </span><span class=nb>set</span><span class=w> </span>-eux<span class=p>;</span><span class=w>   </span><span class=nv>savedAptMark</span><span class=o>=</span><span class=s2>&quot;</span><span class=k>$(</span>apt-m…<span class=w>   </span>32MB
<a id=__codelineno-2-11 name=__codelineno-2-11 href=#__codelineno-2-11></a>&lt;missing&gt;<span class=w>      </span><span class=m>6</span><span class=w> </span>weeks<span class=w> </span>ago<span class=w>   </span>/bin/sh<span class=w> </span>-c<span class=w> </span><span class=c1>#(nop)  ENV REDIS_DOWNLOAD_SHA=06…   0B</span>
<a id=__codelineno-2-12 name=__codelineno-2-12 href=#__codelineno-2-12></a>&lt;missing&gt;<span class=w>      </span><span class=m>6</span><span class=w> </span>weeks<span class=w> </span>ago<span class=w>   </span>/bin/sh<span class=w> </span>-c<span class=w> </span><span class=c1>#(nop)  ENV REDIS_DOWNLOAD_URL=ht…   0B</span>
<a id=__codelineno-2-13 name=__codelineno-2-13 href=#__codelineno-2-13></a>&lt;missing&gt;<span class=w>      </span><span class=m>6</span><span class=w> </span>weeks<span class=w> </span>ago<span class=w>   </span>/bin/sh<span class=w> </span>-c<span class=w> </span><span class=c1>#(nop)  ENV REDIS_VERSION=7.0.8      0B</span>
<a id=__codelineno-2-14 name=__codelineno-2-14 href=#__codelineno-2-14></a>&lt;missing&gt;<span class=w>      </span><span class=m>7</span><span class=w> </span>weeks<span class=w> </span>ago<span class=w>   </span>/bin/sh<span class=w> </span>-c<span class=w> </span><span class=nb>set</span><span class=w> </span>-eux<span class=p>;</span><span class=w>  </span><span class=nv>savedAptMark</span><span class=o>=</span><span class=s2>&quot;</span><span class=k>$(</span>apt-ma…<span class=w>   </span><span class=m>4</span>.13MB
<a id=__codelineno-2-15 name=__codelineno-2-15 href=#__codelineno-2-15></a>&lt;missing&gt;<span class=w>      </span><span class=m>7</span><span class=w> </span>weeks<span class=w> </span>ago<span class=w>   </span>/bin/sh<span class=w> </span>-c<span class=w> </span><span class=c1>#(nop)  ENV GOSU_VERSION=1.14        0B</span>
<a id=__codelineno-2-16 name=__codelineno-2-16 href=#__codelineno-2-16></a>&lt;missing&gt;<span class=w>      </span><span class=m>7</span><span class=w> </span>weeks<span class=w> </span>ago<span class=w>   </span>/bin/sh<span class=w> </span>-c<span class=w> </span>groupadd<span class=w> </span>-r<span class=w> </span>-g<span class=w> </span><span class=m>999</span><span class=w> </span>redis<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>usera…<span class=w>   </span>329kB
<a id=__codelineno-2-17 name=__codelineno-2-17 href=#__codelineno-2-17></a>&lt;missing&gt;<span class=w>      </span><span class=m>7</span><span class=w> </span>weeks<span class=w> </span>ago<span class=w>   </span>/bin/sh<span class=w> </span>-c<span class=w> </span><span class=c1>#(nop)  CMD [&quot;bash&quot;]                 0B</span>
<a id=__codelineno-2-18 name=__codelineno-2-18 href=#__codelineno-2-18></a>&lt;missing&gt;<span class=w>      </span><span class=m>7</span><span class=w> </span>weeks<span class=w> </span>ago<span class=w>   </span>/bin/sh<span class=w> </span>-c<span class=w> </span><span class=c1>#(nop) ADD file:e2398d0bf516084b2…   80.5MB</span>
<a id=__codelineno-2-19 name=__codelineno-2-19 href=#__codelineno-2-19></a>┌──<span class=o>[</span>root@vms107.liruilongs.github.io<span class=o>]</span>-<span class=o>[</span>/etc/systemd<span class=o>]</span>
<a id=__codelineno-2-20 name=__codelineno-2-20 href=#__codelineno-2-20></a>└─<span class=nv>$docker</span><span class=w> </span><span class=nb>history</span><span class=w> </span>--human<span class=o>=</span><span class=nb>true</span><span class=w>  </span>redis:7<span class=w> </span><span class=p>|</span><span class=w> </span>wc<span class=w> </span>-l
<a id=__codelineno-2-21 name=__codelineno-2-21 href=#__codelineno-2-21></a><span class=m>17</span>
</code></pre></div> <p>涉及 两个Dockerfile文件构建的镜像</p> <p>基础镜像构建</p> <div class=highlight><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a>FROM<span class=w> </span>scratch
<a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a>ADD<span class=w> </span>rootfs.tar.xz<span class=w> </span>/
<a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a>CMD<span class=w> </span><span class=o>[</span><span class=s2>&quot;bash&quot;</span><span class=o>]</span>
</code></pre></div> <p>reids镜像构建 <div class=highlight><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=k>FROM</span><span class=w> </span><span class=s>debian:bullseye-slim</span>
<a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a>
<a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a><span class=c># add our user and group first to make sure their IDs get assigned consistently, regardless of whatever dependencies get added</span>
<a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a><span class=k>RUN</span><span class=w> </span>groupadd<span class=w> </span>-r<span class=w> </span>-g<span class=w> </span><span class=m>999</span><span class=w> </span>redis<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>useradd<span class=w> </span>-r<span class=w> </span>-g<span class=w> </span>redis<span class=w> </span>-u<span class=w> </span><span class=m>999</span><span class=w> </span>redis
<a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a>
<a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a><span class=c># grab gosu for easy step-down from root</span>
<a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a><span class=c># https://github.com/tianon/gosu/releases</span>
<a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a><span class=k>ENV</span><span class=w> </span>GOSU_VERSION<span class=w> </span><span class=m>1</span>.16
<a id=__codelineno-4-9 name=__codelineno-4-9 href=#__codelineno-4-9></a><span class=k>RUN</span><span class=w> </span><span class=nb>set</span><span class=w> </span>-eux<span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-10 name=__codelineno-4-10 href=#__codelineno-4-10></a><span class=w> </span><span class=nv>savedAptMark</span><span class=o>=</span><span class=s2>&quot;</span><span class=k>$(</span>apt-mark<span class=w> </span>showmanual<span class=k>)</span><span class=s2>&quot;</span><span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-11 name=__codelineno-4-11 href=#__codelineno-4-11></a><span class=w> </span>apt-get<span class=w> </span>update<span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-12 name=__codelineno-4-12 href=#__codelineno-4-12></a><span class=w> </span>apt-get<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>--no-install-recommends<span class=w> </span>ca-certificates<span class=w> </span>dirmngr<span class=w> </span>gnupg<span class=w> </span>wget<span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-13 name=__codelineno-4-13 href=#__codelineno-4-13></a><span class=w> </span>rm<span class=w> </span>-rf<span class=w> </span>/var/lib/apt/lists/*<span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-14 name=__codelineno-4-14 href=#__codelineno-4-14></a><span class=w> </span><span class=nv>dpkgArch</span><span class=o>=</span><span class=s2>&quot;</span><span class=k>$(</span>dpkg<span class=w> </span>--print-architecture<span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span>-F-<span class=w> </span><span class=s1>&#39;{ print $NF }&#39;</span><span class=k>)</span><span class=s2>&quot;</span><span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-15 name=__codelineno-4-15 href=#__codelineno-4-15></a><span class=w> </span>wget<span class=w> </span>-O<span class=w> </span>/usr/local/bin/gosu<span class=w> </span><span class=s2>&quot;https://github.com/tianon/gosu/releases/download/</span><span class=nv>$GOSU_VERSION</span><span class=s2>/gosu-</span><span class=nv>$dpkgArch</span><span class=s2>&quot;</span><span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-16 name=__codelineno-4-16 href=#__codelineno-4-16></a><span class=w> </span>wget<span class=w> </span>-O<span class=w> </span>/usr/local/bin/gosu.asc<span class=w> </span><span class=s2>&quot;https://github.com/tianon/gosu/releases/download/</span><span class=nv>$GOSU_VERSION</span><span class=s2>/gosu-</span><span class=nv>$dpkgArch</span><span class=s2>.asc&quot;</span><span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-17 name=__codelineno-4-17 href=#__codelineno-4-17></a><span class=w> </span><span class=nb>export</span><span class=w> </span><span class=nv>GNUPGHOME</span><span class=o>=</span><span class=s2>&quot;</span><span class=k>$(</span>mktemp<span class=w> </span>-d<span class=k>)</span><span class=s2>&quot;</span><span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-18 name=__codelineno-4-18 href=#__codelineno-4-18></a><span class=w> </span>gpg<span class=w> </span>--batch<span class=w> </span>--keyserver<span class=w> </span>hkps://keys.openpgp.org<span class=w> </span>--recv-keys<span class=w> </span>B42F6819007F00F88E364FD4036A9C25BF357DD4<span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-19 name=__codelineno-4-19 href=#__codelineno-4-19></a><span class=w> </span>gpg<span class=w> </span>--batch<span class=w> </span>--verify<span class=w> </span>/usr/local/bin/gosu.asc<span class=w> </span>/usr/local/bin/gosu<span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-20 name=__codelineno-4-20 href=#__codelineno-4-20></a><span class=w> </span>gpgconf<span class=w> </span>--kill<span class=w> </span>all<span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-21 name=__codelineno-4-21 href=#__codelineno-4-21></a><span class=w> </span>rm<span class=w> </span>-rf<span class=w> </span><span class=s2>&quot;</span><span class=nv>$GNUPGHOME</span><span class=s2>&quot;</span><span class=w> </span>/usr/local/bin/gosu.asc<span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-22 name=__codelineno-4-22 href=#__codelineno-4-22></a><span class=w> </span>apt-mark<span class=w> </span>auto<span class=w> </span><span class=s1>&#39;.*&#39;</span><span class=w> </span>&gt;<span class=w> </span>/dev/null<span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-23 name=__codelineno-4-23 href=#__codelineno-4-23></a><span class=w> </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=nv>$savedAptMark</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>||</span><span class=w> </span>apt-mark<span class=w> </span>manual<span class=w> </span><span class=nv>$savedAptMark</span><span class=w> </span>&gt;<span class=w> </span>/dev/null<span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-24 name=__codelineno-4-24 href=#__codelineno-4-24></a><span class=w> </span>apt-get<span class=w> </span>purge<span class=w> </span>-y<span class=w> </span>--auto-remove<span class=w> </span>-o<span class=w> </span>APT::AutoRemove::RecommendsImportant<span class=o>=</span>false<span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-25 name=__codelineno-4-25 href=#__codelineno-4-25></a><span class=w> </span>chmod<span class=w> </span>+x<span class=w> </span>/usr/local/bin/gosu<span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-26 name=__codelineno-4-26 href=#__codelineno-4-26></a><span class=w> </span>gosu<span class=w> </span>--version<span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-27 name=__codelineno-4-27 href=#__codelineno-4-27></a><span class=w> </span>gosu<span class=w> </span>nobody<span class=w> </span>true
<a id=__codelineno-4-28 name=__codelineno-4-28 href=#__codelineno-4-28></a>
<a id=__codelineno-4-29 name=__codelineno-4-29 href=#__codelineno-4-29></a><span class=k>ENV</span><span class=w> </span>REDIS_VERSION<span class=w> </span><span class=m>7</span>.0.9
<a id=__codelineno-4-30 name=__codelineno-4-30 href=#__codelineno-4-30></a><span class=k>ENV</span><span class=w> </span>REDIS_DOWNLOAD_URL<span class=w> </span>http://download.redis.io/releases/redis-7.0.9.tar.gz
<a id=__codelineno-4-31 name=__codelineno-4-31 href=#__codelineno-4-31></a><span class=k>ENV</span><span class=w> </span>REDIS_DOWNLOAD_SHA<span class=w> </span>f77135c2a47c9151d4028bfea3b34470ab4d324d1484f79a84c6f32a3cfb9f65
<a id=__codelineno-4-32 name=__codelineno-4-32 href=#__codelineno-4-32></a>
<a id=__codelineno-4-33 name=__codelineno-4-33 href=#__codelineno-4-33></a><span class=k>RUN</span><span class=w> </span><span class=nb>set</span><span class=w> </span>-eux<span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-34 name=__codelineno-4-34 href=#__codelineno-4-34></a><span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-35 name=__codelineno-4-35 href=#__codelineno-4-35></a><span class=w> </span><span class=nv>savedAptMark</span><span class=o>=</span><span class=s2>&quot;</span><span class=k>$(</span>apt-mark<span class=w> </span>showmanual<span class=k>)</span><span class=s2>&quot;</span><span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-36 name=__codelineno-4-36 href=#__codelineno-4-36></a><span class=w> </span>apt-get<span class=w> </span>update<span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-37 name=__codelineno-4-37 href=#__codelineno-4-37></a><span class=w> </span>apt-get<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>--no-install-recommends<span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-38 name=__codelineno-4-38 href=#__codelineno-4-38></a><span class=w>  </span>ca-certificates<span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-39 name=__codelineno-4-39 href=#__codelineno-4-39></a><span class=w>  </span>wget<span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-40 name=__codelineno-4-40 href=#__codelineno-4-40></a><span class=w>  </span><span class=se>\</span>
<a id=__codelineno-4-41 name=__codelineno-4-41 href=#__codelineno-4-41></a><span class=w>  </span>dpkg-dev<span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-42 name=__codelineno-4-42 href=#__codelineno-4-42></a><span class=w>  </span>gcc<span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-43 name=__codelineno-4-43 href=#__codelineno-4-43></a><span class=w>  </span>libc6-dev<span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-44 name=__codelineno-4-44 href=#__codelineno-4-44></a><span class=w>  </span>libssl-dev<span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-45 name=__codelineno-4-45 href=#__codelineno-4-45></a><span class=w>  </span>make<span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-46 name=__codelineno-4-46 href=#__codelineno-4-46></a><span class=w> </span><span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-47 name=__codelineno-4-47 href=#__codelineno-4-47></a><span class=w> </span>rm<span class=w> </span>-rf<span class=w> </span>/var/lib/apt/lists/*<span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-48 name=__codelineno-4-48 href=#__codelineno-4-48></a><span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-49 name=__codelineno-4-49 href=#__codelineno-4-49></a><span class=w> </span>wget<span class=w> </span>-O<span class=w> </span>redis.tar.gz<span class=w> </span><span class=s2>&quot;</span><span class=nv>$REDIS_DOWNLOAD_URL</span><span class=s2>&quot;</span><span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-50 name=__codelineno-4-50 href=#__codelineno-4-50></a><span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$REDIS_DOWNLOAD_SHA</span><span class=s2> *redis.tar.gz&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>sha256sum<span class=w> </span>-c<span class=w> </span>-<span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-51 name=__codelineno-4-51 href=#__codelineno-4-51></a><span class=w> </span>mkdir<span class=w> </span>-p<span class=w> </span>/usr/src/redis<span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-52 name=__codelineno-4-52 href=#__codelineno-4-52></a><span class=w> </span>tar<span class=w> </span>-xzf<span class=w> </span>redis.tar.gz<span class=w> </span>-C<span class=w> </span>/usr/src/redis<span class=w> </span>--strip-components<span class=o>=</span><span class=m>1</span><span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-53 name=__codelineno-4-53 href=#__codelineno-4-53></a><span class=w> </span>rm<span class=w> </span>redis.tar.gz<span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-54 name=__codelineno-4-54 href=#__codelineno-4-54></a><span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-55 name=__codelineno-4-55 href=#__codelineno-4-55></a>#<span class=w> </span>disable<span class=w> </span>Redis<span class=w> </span>protected<span class=w> </span>mode<span class=w> </span><span class=o>[</span><span class=m>1</span><span class=o>]</span><span class=w> </span>as<span class=w> </span>it<span class=w> </span>is<span class=w> </span>unnecessary<span class=w> </span><span class=k>in</span><span class=w> </span>context<span class=w> </span>of<span class=w> </span>Docker
<a id=__codelineno-4-56 name=__codelineno-4-56 href=#__codelineno-4-56></a><span class=c># (ports are not automatically exposed when running inside Docker, but rather explicitly by specifying -p / -P)</span>
<a id=__codelineno-4-57 name=__codelineno-4-57 href=#__codelineno-4-57></a><span class=c># [1]: https://github.com/redis/redis/commit/edd4d555df57dc84265fdfb4ef59a4678832f6da</span>
<a id=__codelineno-4-58 name=__codelineno-4-58 href=#__codelineno-4-58></a><span class=w> </span>grep<span class=w> </span>-E<span class=w> </span><span class=s1>&#39;^ *createBoolConfig[(]&quot;protected-mode&quot;,.*, *1 *,.*[)],$&#39;</span><span class=w> </span>/usr/src/redis/src/config.c<span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-59 name=__codelineno-4-59 href=#__codelineno-4-59></a><span class=w> </span>sed<span class=w> </span>-ri<span class=w> </span><span class=s1>&#39;s!^( *createBoolConfig[(]&quot;protected-mode&quot;,.*, *)1( *,.*[)],)$!\10\2!&#39;</span><span class=w> </span>/usr/src/redis/src/config.c<span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-60 name=__codelineno-4-60 href=#__codelineno-4-60></a><span class=w> </span>grep<span class=w> </span>-E<span class=w> </span><span class=s1>&#39;^ *createBoolConfig[(]&quot;protected-mode&quot;,.*, *0 *,.*[)],$&#39;</span><span class=w> </span>/usr/src/redis/src/config.c<span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-61 name=__codelineno-4-61 href=#__codelineno-4-61></a>#<span class=w> </span><span class=k>for</span><span class=w> </span>future<span class=w> </span>reference,<span class=w> </span>we<span class=w> </span>modify<span class=w> </span>this<span class=w> </span>directly<span class=w> </span><span class=k>in</span><span class=w> </span>the<span class=w> </span><span class=nb>source</span><span class=w> </span>instead<span class=w> </span>of<span class=w> </span>just<span class=w> </span>supplying<span class=w> </span>a<span class=w> </span>default<span class=w> </span>configuration<span class=w> </span>flag<span class=w> </span>because<span class=w> </span>apparently<span class=w> </span><span class=s2>&quot;if you specify any argument to redis-server, [it assumes] you are going to specify everything&quot;</span>
<a id=__codelineno-4-62 name=__codelineno-4-62 href=#__codelineno-4-62></a><span class=c># see also https://github.com/docker-library/redis/issues/4#issuecomment-50780840</span>
<a id=__codelineno-4-63 name=__codelineno-4-63 href=#__codelineno-4-63></a><span class=c># (more exactly, this makes sure the default behavior of &quot;save on SIGTERM&quot; stays functional by default)</span>
<a id=__codelineno-4-64 name=__codelineno-4-64 href=#__codelineno-4-64></a><span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-65 name=__codelineno-4-65 href=#__codelineno-4-65></a>#<span class=w> </span>https://github.com/jemalloc/jemalloc/issues/467<span class=w> </span>--<span class=w> </span>we<span class=w> </span>need<span class=w> </span>to<span class=w> </span>patch<span class=w> </span>the<span class=w> </span><span class=s2>&quot;./configure&quot;</span><span class=w> </span><span class=k>for</span><span class=w> </span>the<span class=w> </span>bundled<span class=w> </span>jemalloc<span class=w> </span>to<span class=w> </span>match<span class=w> </span>how<span class=w> </span>Debian<span class=w> </span>compiles,<span class=w> </span><span class=k>for</span><span class=w> </span>compatibility
<a id=__codelineno-4-66 name=__codelineno-4-66 href=#__codelineno-4-66></a><span class=c># (also, we do cross-builds, so we need to embed the appropriate &quot;--build=xxx&quot; values to that &quot;./configure&quot; invocation)</span>
<a id=__codelineno-4-67 name=__codelineno-4-67 href=#__codelineno-4-67></a><span class=w> </span><span class=nv>gnuArch</span><span class=o>=</span><span class=s2>&quot;</span><span class=k>$(</span>dpkg-architecture<span class=w> </span>--query<span class=w> </span>DEB_BUILD_GNU_TYPE<span class=k>)</span><span class=s2>&quot;</span><span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-68 name=__codelineno-4-68 href=#__codelineno-4-68></a><span class=w> </span><span class=nv>extraJemallocConfigureFlags</span><span class=o>=</span><span class=s2>&quot;--build=</span><span class=nv>$gnuArch</span><span class=s2>&quot;</span><span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-69 name=__codelineno-4-69 href=#__codelineno-4-69></a>#<span class=w> </span>https://salsa.debian.org/debian/jemalloc/-/blob/c0a88c37a551be7d12e4863435365c9a6a51525f/debian/rules#L8-23
<a id=__codelineno-4-70 name=__codelineno-4-70 href=#__codelineno-4-70></a><span class=w> </span><span class=nv>dpkgArch</span><span class=o>=</span><span class=s2>&quot;</span><span class=k>$(</span>dpkg<span class=w> </span>--print-architecture<span class=k>)</span><span class=s2>&quot;</span><span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-71 name=__codelineno-4-71 href=#__codelineno-4-71></a><span class=w> </span><span class=k>case</span><span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>dpkgArch</span><span class=p>##*-</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-72 name=__codelineno-4-72 href=#__codelineno-4-72></a><span class=w>  </span>amd64<span class=w> </span><span class=p>|</span><span class=w> </span>i386<span class=w> </span><span class=p>|</span><span class=w> </span>x32<span class=o>)</span><span class=w> </span><span class=nv>extraJemallocConfigureFlags</span><span class=o>=</span><span class=s2>&quot;</span><span class=nv>$extraJemallocConfigureFlags</span><span class=s2> --with-lg-page=12&quot;</span><span class=w> </span><span class=p>;;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-73 name=__codelineno-4-73 href=#__codelineno-4-73></a><span class=w>  </span>*<span class=o>)</span><span class=w> </span><span class=nv>extraJemallocConfigureFlags</span><span class=o>=</span><span class=s2>&quot;</span><span class=nv>$extraJemallocConfigureFlags</span><span class=s2> --with-lg-page=16&quot;</span><span class=w> </span><span class=p>;;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-74 name=__codelineno-4-74 href=#__codelineno-4-74></a><span class=w> </span><span class=k>esac</span><span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-75 name=__codelineno-4-75 href=#__codelineno-4-75></a><span class=w> </span><span class=nv>extraJemallocConfigureFlags</span><span class=o>=</span><span class=s2>&quot;</span><span class=nv>$extraJemallocConfigureFlags</span><span class=s2> --with-lg-hugepage=21&quot;</span><span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-76 name=__codelineno-4-76 href=#__codelineno-4-76></a><span class=w> </span>grep<span class=w> </span>-F<span class=w> </span><span class=s1>&#39;cd jemalloc &amp;&amp; ./configure &#39;</span><span class=w> </span>/usr/src/redis/deps/Makefile<span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-77 name=__codelineno-4-77 href=#__codelineno-4-77></a><span class=w> </span>sed<span class=w> </span>-ri<span class=w> </span><span class=s1>&#39;s!cd jemalloc &amp;&amp; ./configure !&amp;&#39;</span><span class=s2>&quot;</span><span class=nv>$extraJemallocConfigureFlags</span><span class=s2>&quot;</span><span class=s1>&#39; !&#39;</span><span class=w> </span>/usr/src/redis/deps/Makefile<span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-78 name=__codelineno-4-78 href=#__codelineno-4-78></a><span class=w> </span>grep<span class=w> </span>-F<span class=w> </span><span class=s2>&quot;cd jemalloc &amp;&amp; ./configure </span><span class=nv>$extraJemallocConfigureFlags</span><span class=s2> &quot;</span><span class=w> </span>/usr/src/redis/deps/Makefile<span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-79 name=__codelineno-4-79 href=#__codelineno-4-79></a><span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-80 name=__codelineno-4-80 href=#__codelineno-4-80></a><span class=w> </span><span class=nb>export</span><span class=w> </span><span class=nv>BUILD_TLS</span><span class=o>=</span>yes<span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-81 name=__codelineno-4-81 href=#__codelineno-4-81></a><span class=w> </span>make<span class=w> </span>-C<span class=w> </span>/usr/src/redis<span class=w> </span>-j<span class=w> </span><span class=s2>&quot;</span><span class=k>$(</span>nproc<span class=k>)</span><span class=s2>&quot;</span><span class=w> </span>all<span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-82 name=__codelineno-4-82 href=#__codelineno-4-82></a><span class=w> </span>make<span class=w> </span>-C<span class=w> </span>/usr/src/redis<span class=w> </span>install<span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-83 name=__codelineno-4-83 href=#__codelineno-4-83></a><span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-84 name=__codelineno-4-84 href=#__codelineno-4-84></a>#<span class=w> </span>TODO<span class=w> </span>https://github.com/redis/redis/pull/3494<span class=w> </span><span class=o>(</span>deduplicate<span class=w> </span><span class=s2>&quot;redis-server&quot;</span><span class=w> </span>copies<span class=o>)</span>
<a id=__codelineno-4-85 name=__codelineno-4-85 href=#__codelineno-4-85></a><span class=w> </span><span class=nv>serverMd5</span><span class=o>=</span><span class=s2>&quot;</span><span class=k>$(</span>md5sum<span class=w> </span>/usr/local/bin/redis-server<span class=w> </span><span class=p>|</span><span class=w> </span>cut<span class=w> </span>-d<span class=s1>&#39; &#39;</span><span class=w> </span>-f1<span class=k>)</span><span class=s2>&quot;</span><span class=p>;</span><span class=w> </span><span class=nb>export</span><span class=w> </span>serverMd5<span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-86 name=__codelineno-4-86 href=#__codelineno-4-86></a><span class=w> </span>find<span class=w> </span>/usr/local/bin/redis*<span class=w> </span>-maxdepth<span class=w> </span><span class=m>0</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-87 name=__codelineno-4-87 href=#__codelineno-4-87></a><span class=w>  </span>-type<span class=w> </span>f<span class=w> </span>-not<span class=w> </span>-name<span class=w> </span>redis-server<span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-88 name=__codelineno-4-88 href=#__codelineno-4-88></a><span class=w>  </span>-exec<span class=w> </span>sh<span class=w> </span>-eux<span class=w> </span>-c<span class=w> </span><span class=s1>&#39; \</span>
<a id=__codelineno-4-89 name=__codelineno-4-89 href=#__codelineno-4-89></a><span class=s1>   md5=&quot;$(md5sum &quot;$1&quot; | cut -d&quot; &quot; -f1)&quot;; \</span>
<a id=__codelineno-4-90 name=__codelineno-4-90 href=#__codelineno-4-90></a><span class=s1>   test &quot;$md5&quot; = &quot;$serverMd5&quot;; \</span>
<a id=__codelineno-4-91 name=__codelineno-4-91 href=#__codelineno-4-91></a><span class=s1>  &#39;</span><span class=w> </span>--<span class=w> </span><span class=s1>&#39;{}&#39;</span><span class=w> </span><span class=s1>&#39;;&#39;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-92 name=__codelineno-4-92 href=#__codelineno-4-92></a><span class=w>  </span>-exec<span class=w> </span>ln<span class=w> </span>-svfT<span class=w> </span><span class=s1>&#39;redis-server&#39;</span><span class=w> </span><span class=s1>&#39;{}&#39;</span><span class=w> </span><span class=s1>&#39;;&#39;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-93 name=__codelineno-4-93 href=#__codelineno-4-93></a><span class=w> </span><span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-94 name=__codelineno-4-94 href=#__codelineno-4-94></a><span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-95 name=__codelineno-4-95 href=#__codelineno-4-95></a><span class=w> </span>rm<span class=w> </span>-r<span class=w> </span>/usr/src/redis<span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-96 name=__codelineno-4-96 href=#__codelineno-4-96></a><span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-97 name=__codelineno-4-97 href=#__codelineno-4-97></a><span class=w> </span>apt-mark<span class=w> </span>auto<span class=w> </span><span class=s1>&#39;.*&#39;</span><span class=w> </span>&gt;<span class=w> </span>/dev/null<span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-98 name=__codelineno-4-98 href=#__codelineno-4-98></a><span class=w> </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=nv>$savedAptMark</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>||</span><span class=w> </span>apt-mark<span class=w> </span>manual<span class=w> </span><span class=nv>$savedAptMark</span><span class=w> </span>&gt;<span class=w> </span>/dev/null<span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-99 name=__codelineno-4-99 href=#__codelineno-4-99></a><span class=w> </span>find<span class=w> </span>/usr/local<span class=w> </span>-type<span class=w> </span>f<span class=w> </span>-executable<span class=w> </span>-exec<span class=w> </span>ldd<span class=w> </span><span class=s1>&#39;{}&#39;</span><span class=w> </span><span class=s1>&#39;;&#39;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-100 name=__codelineno-4-100 href=#__codelineno-4-100></a><span class=w>  </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span><span class=s1>&#39;/=&gt;/ { print $(NF-1) }&#39;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-101 name=__codelineno-4-101 href=#__codelineno-4-101></a><span class=w>  </span><span class=p>|</span><span class=w> </span>sort<span class=w> </span>-u<span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-102 name=__codelineno-4-102 href=#__codelineno-4-102></a><span class=w>  </span><span class=p>|</span><span class=w> </span>xargs<span class=w> </span>-r<span class=w> </span>dpkg-query<span class=w> </span>--search<span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-103 name=__codelineno-4-103 href=#__codelineno-4-103></a><span class=w>  </span><span class=p>|</span><span class=w> </span>cut<span class=w> </span>-d:<span class=w> </span>-f1<span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-104 name=__codelineno-4-104 href=#__codelineno-4-104></a><span class=w>  </span><span class=p>|</span><span class=w> </span>sort<span class=w> </span>-u<span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-105 name=__codelineno-4-105 href=#__codelineno-4-105></a><span class=w>  </span><span class=p>|</span><span class=w> </span>xargs<span class=w> </span>-r<span class=w> </span>apt-mark<span class=w> </span>manual<span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-106 name=__codelineno-4-106 href=#__codelineno-4-106></a><span class=w> </span><span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-107 name=__codelineno-4-107 href=#__codelineno-4-107></a><span class=w> </span>apt-get<span class=w> </span>purge<span class=w> </span>-y<span class=w> </span>--auto-remove<span class=w> </span>-o<span class=w> </span>APT::AutoRemove::RecommendsImportant<span class=o>=</span>false<span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-108 name=__codelineno-4-108 href=#__codelineno-4-108></a><span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-109 name=__codelineno-4-109 href=#__codelineno-4-109></a><span class=w> </span>redis-cli<span class=w> </span>--version<span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-4-110 name=__codelineno-4-110 href=#__codelineno-4-110></a><span class=w> </span>redis-server<span class=w> </span>--version
<a id=__codelineno-4-111 name=__codelineno-4-111 href=#__codelineno-4-111></a>
<a id=__codelineno-4-112 name=__codelineno-4-112 href=#__codelineno-4-112></a><span class=k>RUN</span><span class=w> </span>mkdir<span class=w> </span>/data<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>chown<span class=w> </span>redis:redis<span class=w> </span>/data
<a id=__codelineno-4-113 name=__codelineno-4-113 href=#__codelineno-4-113></a><span class=k>VOLUME</span><span class=w> </span><span class=s>/data</span>
<a id=__codelineno-4-114 name=__codelineno-4-114 href=#__codelineno-4-114></a><span class=k>WORKDIR</span><span class=w> </span><span class=s>/data</span>
<a id=__codelineno-4-115 name=__codelineno-4-115 href=#__codelineno-4-115></a>
<a id=__codelineno-4-116 name=__codelineno-4-116 href=#__codelineno-4-116></a><span class=k>COPY</span><span class=w> </span>docker-entrypoint.sh<span class=w> </span>/usr/local/bin/
<a id=__codelineno-4-117 name=__codelineno-4-117 href=#__codelineno-4-117></a><span class=k>ENTRYPOINT</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;docker-entrypoint.sh&quot;</span><span class=p>]</span>
<a id=__codelineno-4-118 name=__codelineno-4-118 href=#__codelineno-4-118></a>
<a id=__codelineno-4-119 name=__codelineno-4-119 href=#__codelineno-4-119></a><span class=k>EXPOSE</span><span class=w> </span><span class=s>6379</span>
<a id=__codelineno-4-120 name=__codelineno-4-120 href=#__codelineno-4-120></a><span class=k>CMD</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;redis-server&quot;</span><span class=p>]</span>
</code></pre></div></p> <p>运行此镜像并创建一个容器时，我们实际上在底层之上添加了一个新的可写层（容器层）。对正在运行的容器所做的所有更改（例如写入新文件、修改现有文件和删除文件）都将写入此可写容器层。</p> <p>可以看到上面的 Dockerfile 文件很庞大，通过这个文件我们来总结一些 在编写时需要注意的地方</p> <h3 id=热门dockerfile示例>热门Dockerfile示例<a class=headerlink href=#热门dockerfile示例 title="Permanent link">&para;</a></h3> <p>下面是Docker Hub上两个热门镜像nginx和Go的Dockerfile的例子，通过这两个例子。读者可以对Dockerfile结构有个基本的感知。</p> <h4 id=nginx>Nginx<a class=headerlink href=#nginx title="Permanent link">&para;</a></h4> <p>基于debian：jessie基础镜像基础上安装Nginx环境，从而创建一个新的nginx镜像：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=k>FROM</span><span class=w> </span><span class=s>debian:jessie</span>
<a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=k>LABEL</span><span class=w> </span><span class=k>maintainer</span><span class=w> </span><span class=s>docker_user&lt;docker_user@email.com&gt;</span>
<a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=k>ENV</span><span class=w> </span>NGINX_VERSION<span class=w> </span><span class=m>1</span>.10.1-1~jessie
<a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a><span class=k>RUN</span><span class=w> </span>apt-key<span class=w> </span>adv<span class=w> </span>--keyserver<span class=w> </span>hkp://pgp.mit.edu:80<span class=w> </span>--recv-keys<span class=w> </span>573BFD6B3D8FBC64107
<a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a><span class=w>    </span>9A6ABABF5BD827BD9BF62<span class=w> </span><span class=se>\</span>
<a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a><span class=w>        </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;deb http://nginx.org/packages/debian/ jessie nginx&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span>/etc/apt/sources.list<span class=w> </span><span class=se>\</span>
<a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a><span class=w>        </span><span class=o>&amp;&amp;</span><span class=w> </span>apt-get<span class=w> </span>update<span class=w> </span><span class=se>\</span>
<a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a><span class=w>        </span><span class=o>&amp;&amp;</span><span class=w> </span>apt-get<span class=w> </span>install<span class=w> </span>--no-install-recommends<span class=w> </span>--no-install-suggests<span class=w> </span>-y<span class=w> </span><span class=se>\</span>
<a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a><span class=w>        </span>ca-certificates<span class=w> </span><span class=se>\</span>
<a id=__codelineno-5-10 name=__codelineno-5-10 href=#__codelineno-5-10></a><span class=w>        </span><span class=nv>nginx</span><span class=o>=</span><span class=si>${</span><span class=nv>NGINX_VERSION</span><span class=si>}</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-5-11 name=__codelineno-5-11 href=#__codelineno-5-11></a><span class=w>        </span>nginx-module-xslt<span class=w> </span><span class=se>\</span>
<a id=__codelineno-5-12 name=__codelineno-5-12 href=#__codelineno-5-12></a><span class=w>        </span>nginx-module-geoip<span class=w> </span><span class=se>\</span>
<a id=__codelineno-5-13 name=__codelineno-5-13 href=#__codelineno-5-13></a><span class=w>        </span>nginx-module-image-filter<span class=w> </span><span class=se>\</span>
<a id=__codelineno-5-14 name=__codelineno-5-14 href=#__codelineno-5-14></a><span class=w>        </span>nginx-module-perl<span class=w> </span><span class=se>\</span>
<a id=__codelineno-5-15 name=__codelineno-5-15 href=#__codelineno-5-15></a><span class=w>        </span>nginx-module-njs<span class=w> </span><span class=se>\</span>
<a id=__codelineno-5-16 name=__codelineno-5-16 href=#__codelineno-5-16></a><span class=w>        </span>gettext-base<span class=w> </span><span class=se>\</span>
<a id=__codelineno-5-17 name=__codelineno-5-17 href=#__codelineno-5-17></a><span class=w>        </span><span class=o>&amp;&amp;</span><span class=w> </span>rm<span class=w> </span>-rf<span class=w> </span>/var/lib/apt/lists/*
<a id=__codelineno-5-18 name=__codelineno-5-18 href=#__codelineno-5-18></a><span class=c># forward request and error logs to docker log collector</span>
<a id=__codelineno-5-19 name=__codelineno-5-19 href=#__codelineno-5-19></a><span class=k>RUN</span><span class=w> </span>ln<span class=w> </span>-sf<span class=w> </span>/dev/stdout<span class=w> </span>/var/log/nginx/access.log<span class=w> </span><span class=se>\</span>
<a id=__codelineno-5-20 name=__codelineno-5-20 href=#__codelineno-5-20></a><span class=w>    </span><span class=o>&amp;&amp;</span><span class=w> </span>ln<span class=w> </span>-sf<span class=w> </span>/dev/stderr<span class=w> </span>/var/log/nginx/error.log
<a id=__codelineno-5-21 name=__codelineno-5-21 href=#__codelineno-5-21></a><span class=k>EXPOSE</span><span class=w> </span><span class=s>80 443</span>
<a id=__codelineno-5-22 name=__codelineno-5-22 href=#__codelineno-5-22></a><span class=k>CMD</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;nginx&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;-g&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;daemon off;&quot;</span><span class=p>]</span>
</code></pre></div> <p>Nginx的官方仓库还提供了Dockerfile构建Nginx镜像，目前的版本是1.7.9，其内容为：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=k>FROM</span><span class=w> </span><span class=s>debian:wheezy</span>
<a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=k>MAINTAINER</span><span class=w> </span><span class=s>NGINX Docker Maintainers &quot;docker-maint@nginx.com&quot;</span>
<a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a><span class=k>RUN</span><span class=w> </span>apt-key<span class=w> </span>adv<span class=w> </span>--keyserver<span class=w> </span>pgp.mit.edu<span class=w> </span>--recv-keys<span class=w> </span>573BFD6B3D8FBC641079A6ABABF5BD827BD9BF62
<a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a><span class=k>RUN</span><span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;deb http://nginx.org/packages/mainline/debian/ wheezy nginx&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span>/etc/apt/sources.list
<a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a><span class=k>ENV</span><span class=w> </span>NGINX_VERSION<span class=w> </span><span class=m>1</span>.7.9-1~wheezy
<a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a><span class=k>RUN</span><span class=w> </span>apt-get<span class=w> </span>update<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>apt-get<span class=w> </span>install<span class=w> </span>-y<span class=w> </span><span class=nv>nginx</span><span class=o>=</span><span class=si>${</span><span class=nv>NGINX_VERSION</span><span class=si>}</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>rm<span class=w> </span>-rf<span class=w> </span>/var/lib/apt/lists/*
<a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a><span class=c># forward request and error logs to docker log collector</span>
<a id=__codelineno-6-8 name=__codelineno-6-8 href=#__codelineno-6-8></a><span class=k>RUN</span><span class=w> </span>ln<span class=w> </span>-sf<span class=w> </span>/dev/stdout<span class=w> </span>/var/log/nginx/access.log
<a id=__codelineno-6-9 name=__codelineno-6-9 href=#__codelineno-6-9></a><span class=k>RUN</span><span class=w> </span>ln<span class=w> </span>-sf<span class=w> </span>/dev/stderr<span class=w> </span>/var/log/nginx/error.log
<a id=__codelineno-6-10 name=__codelineno-6-10 href=#__codelineno-6-10></a><span class=k>VOLUME</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;/var/cache/nginx&quot;</span><span class=p>]</span>
<a id=__codelineno-6-11 name=__codelineno-6-11 href=#__codelineno-6-11></a><span class=k>EXPOSE</span><span class=w> </span><span class=s>80 443</span>
<a id=__codelineno-6-12 name=__codelineno-6-12 href=#__codelineno-6-12></a><span class=k>CMD</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;nginx&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;-g&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;daemon off;&quot;</span><span class=p>]</span>
</code></pre></div> <p>官方提供的Dockerfile 请到<code>https://github.com/docker-library/docs/tree/master/nginx</code> 查看。</p> <h4 id=ubuntu>ubuntu<a class=headerlink href=#ubuntu title="Permanent link">&para;</a></h4> <p>官方提供的Dockerfile 请到<code>https://github.com/docker-library/docs/tree/master/ubuntu</code> 查看。</p> <p>示例</p> <div class=highlight><pre><span></span><code><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=k>FROM</span><span class=w> </span><span class=s>ubuntu:20.04</span>
<a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a><span class=k>MAINTAINER</span><span class=w> </span><span class=s>zhang</span>
<a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a>
<a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a><span class=k>RUN</span><span class=w> </span>sed<span class=w> </span>-i<span class=w> </span><span class=s2>&quot;s/archive.ubuntu.com/mirrors.aliyun.com/g&quot;</span><span class=w> </span>/etc/apt/sources.list
<a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a><span class=k>RUN</span><span class=w> </span>apt-get<span class=w> </span>update
<a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a><span class=k>RUN</span><span class=w> </span>apt-get<span class=w> </span>upgrade<span class=w> </span>-y
<a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a><span class=k>RUN</span><span class=w> </span>apt-get<span class=w> </span>install<span class=w> </span>python3<span class=w>  </span>-y
<a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a>
<a id=__codelineno-7-9 name=__codelineno-7-9 href=#__codelineno-7-9></a><span class=k>WORKDIR</span><span class=w> </span><span class=s>/root/python3/src/</span>
<a id=__codelineno-7-10 name=__codelineno-7-10 href=#__codelineno-7-10></a><span class=k>ENTRYPOINT</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;python3&quot;</span><span class=p>]</span>
</code></pre></div> <h4 id=nodejs>Node.js<a class=headerlink href=#nodejs title="Permanent link">&para;</a></h4> <p>官方提供的Dockerfile 请到<code>https://github.com/docker-library/docs/tree/master/node</code> 查看。</p> <h4 id=go>Go<a class=headerlink href=#go title="Permanent link">&para;</a></h4> <p>基于buildpack-deps：jessie-scm基础镜像，安装Golang相关环境，制作一个Go语言的运行环境镜像：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=k>FROM</span><span class=w> </span><span class=s>buildpack-deps:jessie-scm</span>
<a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a><span class=c># gcc for cgo</span>
<a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a><span class=k>RUN</span><span class=w> </span>apt-get<span class=w> </span>update<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>apt-get<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>--no-install-recommends<span class=w> </span><span class=se>\</span>
<a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a><span class=w>    </span>g++<span class=w> </span><span class=se>\</span>
<a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a><span class=w>    </span>gcc<span class=w> </span><span class=se>\</span>
<a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a><span class=w>    </span>libc6-dev<span class=w> </span><span class=se>\</span>
<a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a><span class=w>    </span>make<span class=w> </span><span class=se>\</span>
<a id=__codelineno-8-8 name=__codelineno-8-8 href=#__codelineno-8-8></a><span class=w>    </span><span class=o>&amp;&amp;</span><span class=w> </span>rm<span class=w> </span>-rf<span class=w> </span>/var/lib/apt/lists/*
<a id=__codelineno-8-9 name=__codelineno-8-9 href=#__codelineno-8-9></a><span class=k>ENV</span><span class=w> </span>GOLANG_VERSION<span class=w> </span><span class=m>1</span>.6.3
<a id=__codelineno-8-10 name=__codelineno-8-10 href=#__codelineno-8-10></a><span class=k>ENV</span><span class=w> </span>GOLANG_DOWNLOAD_URL<span class=w> </span>https://golang.org/dl/go<span class=nv>$GOLANG_VERSION</span>.linux-amd64.tar.gz
<a id=__codelineno-8-11 name=__codelineno-8-11 href=#__codelineno-8-11></a><span class=k>ENV</span><span class=w> </span>GOLANG_DOWNLOAD_SHA256<span class=w> </span>cdde5e08530c0579255d6153b08fdb3b8e47caabbe717bc7bcd7561275a87aeb
<a id=__codelineno-8-12 name=__codelineno-8-12 href=#__codelineno-8-12></a><span class=k>RUN</span><span class=w> </span>curl<span class=w> </span>-fsSL<span class=w> </span><span class=s2>&quot;</span><span class=nv>$GOLANG_DOWNLOAD_URL</span><span class=s2>&quot;</span><span class=w> </span>-o<span class=w> </span>golang.tar.gz<span class=w> </span><span class=se>\</span>
<a id=__codelineno-8-13 name=__codelineno-8-13 href=#__codelineno-8-13></a><span class=w>    </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$GOLANG_DOWNLOAD_SHA256</span><span class=s2>  golang.tar.gz&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>sha256sum<span class=w> </span>-c<span class=w> </span>-<span class=w> </span><span class=se>\</span>
<a id=__codelineno-8-14 name=__codelineno-8-14 href=#__codelineno-8-14></a><span class=w>    </span><span class=o>&amp;&amp;</span><span class=w> </span>tar<span class=w> </span>-C<span class=w> </span>/usr/local<span class=w> </span>-xzf<span class=w> </span>golang.tar.gz<span class=w> </span><span class=se>\</span>
<a id=__codelineno-8-15 name=__codelineno-8-15 href=#__codelineno-8-15></a><span class=w>    </span><span class=o>&amp;&amp;</span><span class=w> </span>rm<span class=w> </span>golang.tar.gz
<a id=__codelineno-8-16 name=__codelineno-8-16 href=#__codelineno-8-16></a><span class=k>ENV</span><span class=w> </span>GOPATH<span class=w> </span>/go
<a id=__codelineno-8-17 name=__codelineno-8-17 href=#__codelineno-8-17></a><span class=k>ENV</span><span class=w> </span>PATH<span class=w> </span><span class=nv>$GOPATH</span>/bin:/usr/local/go/bin:<span class=nv>$PATH</span>
<a id=__codelineno-8-18 name=__codelineno-8-18 href=#__codelineno-8-18></a><span class=k>RUN</span><span class=w> </span>mkdir<span class=w> </span>-p<span class=w> </span><span class=s2>&quot;</span><span class=nv>$GOPATH</span><span class=s2>/src&quot;</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$GOPATH</span><span class=s2>/bin&quot;</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>chmod<span class=w> </span>-R<span class=w> </span><span class=m>777</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$GOPATH</span><span class=s2>&quot;</span>
<a id=__codelineno-8-19 name=__codelineno-8-19 href=#__codelineno-8-19></a><span class=k>WORKDIR</span><span class=w> </span><span class=s>$GOPATH</span>
<a id=__codelineno-8-20 name=__codelineno-8-20 href=#__codelineno-8-20></a><span class=k>COPY</span><span class=w> </span>go-wrapper<span class=w> </span>/usr/local/bin/
</code></pre></div> <h4 id=centos-nginx>Centos-Nginx<a class=headerlink href=#centos-nginx title="Permanent link">&para;</a></h4> <p>centos7</p> <p>官方提供的Dockerfile 请到<code>https://github.com/docker-library/docs/tree/master/centos</code> 查看。</p> <div class=highlight><pre><span></span><code><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=k>FROM</span><span class=w> </span><span class=s>centos:7</span>
<a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a><span class=k>LABEL</span><span class=w> </span><span class=nv>auther</span><span class=o>=</span><span class=s2>&quot;hjl@oschina.com&quot;</span>
<a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a>
<a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a><span class=k>ENV</span><span class=w> </span>container<span class=w> </span>docker
<a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a><span class=k>RUN</span><span class=w> </span>yum<span class=w> </span>-y<span class=w> </span>swap<span class=w> </span>--<span class=w> </span>remove<span class=w> </span>fakesystemd<span class=w> </span>--<span class=w> </span>install<span class=w> </span>systemd<span class=w> </span>systemd-libs
<a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a><span class=k>RUN</span><span class=w> </span>yum<span class=w> </span>-y<span class=w> </span>update<span class=p>;</span><span class=w> </span>yum<span class=w> </span>clean<span class=w> </span>all<span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a><span class=w>  </span><span class=o>(</span><span class=nb>cd</span><span class=w> </span>/lib/systemd/system/sysinit.target.wants/<span class=p>;</span><span class=w> </span><span class=k>for</span><span class=w> </span>i<span class=w> </span><span class=k>in</span><span class=w> </span>*<span class=p>;</span><span class=w> </span><span class=k>do</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=nv>$i</span><span class=w> </span><span class=o>==</span>systemd-tmpfiles-setup.service<span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>||</span><span class=w> </span>rm<span class=w> </span>-f<span class=w> </span><span class=nv>$i</span><span class=p>;</span><span class=w> </span><span class=k>done</span><span class=o>)</span><span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-9-8 name=__codelineno-9-8 href=#__codelineno-9-8></a><span class=w>  </span>rm<span class=w> </span>-f<span class=w> </span>/lib/systemd/system/multi-user.target.wants/*<span class=p>;</span><span class=se>\</span>
<a id=__codelineno-9-9 name=__codelineno-9-9 href=#__codelineno-9-9></a><span class=w>  </span>rm<span class=w> </span>-f<span class=w> </span>/etc/systemd/system/*.wants/*<span class=p>;</span><span class=se>\</span>
<a id=__codelineno-9-10 name=__codelineno-9-10 href=#__codelineno-9-10></a><span class=w>  </span>rm<span class=w> </span>-f<span class=w> </span>/lib/systemd/system/local-fs.target.wants/*<span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-9-11 name=__codelineno-9-11 href=#__codelineno-9-11></a><span class=w>  </span>rm<span class=w> </span>-f<span class=w> </span>/lib/systemd/system/sockets.target.wants/*udev*<span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-9-12 name=__codelineno-9-12 href=#__codelineno-9-12></a><span class=w>  </span>rm<span class=w> </span>-f<span class=w> </span>/lib/systemd/system/sockets.target.wants/*initctl*<span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-9-13 name=__codelineno-9-13 href=#__codelineno-9-13></a><span class=w>  </span>rm<span class=w> </span>-f<span class=w> </span>/lib/systemd/system/basic.target.wants/*<span class=p>;</span><span class=se>\</span>
<a id=__codelineno-9-14 name=__codelineno-9-14 href=#__codelineno-9-14></a><span class=w>  </span>rm<span class=w> </span>-f<span class=w> </span>/lib/systemd/system/anaconda.target.wants/*<span class=p>;</span>
<a id=__codelineno-9-15 name=__codelineno-9-15 href=#__codelineno-9-15></a><span class=k>VOLUME</span><span class=w> </span><span class=p>[</span><span class=w> </span><span class=s2>&quot;/sys/fs/cgroup&quot;</span><span class=w> </span><span class=p>]</span>
<a id=__codelineno-9-16 name=__codelineno-9-16 href=#__codelineno-9-16></a><span class=k>CMD</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;/usr/sbin/init&quot;</span><span class=p>]</span>
</code></pre></div> <p>基于centos7镜像再构建nginx <div class=highlight><pre><span></span><code><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=k>FROM</span><span class=w> </span><span class=s>centos:7</span>
<a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a><span class=k>MAINTAINER</span><span class=w> </span><span class=s>www.humingzhe.com</span>
<a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a><span class=k>RUN</span><span class=w> </span>yum<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>gcc<span class=w> </span>gcc-c++<span class=w> </span>make<span class=w> </span>openssl-devel<span class=w> </span>pcre-devel<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>yum<span class=w> </span>clean<span class=w> </span>all
<a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a><span class=k>ADD</span><span class=w> </span>nginx-1.12.1.tar.gz<span class=w> </span>/tmp
<a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a>
<a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a><span class=k>RUN</span><span class=w> </span><span class=nb>cd</span><span class=w> </span>/tmp/nginx-1.12.1<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a><span class=w>    </span>./configure<span class=w> </span>--prefix<span class=o>=</span>/usr/local/nginx<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a><span class=w>    </span>make<span class=w> </span>-j<span class=w> </span><span class=m>2</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-10-9 name=__codelineno-10-9 href=#__codelineno-10-9></a><span class=w>    </span>make<span class=w> </span>install<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-10-10 name=__codelineno-10-10 href=#__codelineno-10-10></a><span class=w>    </span>rm<span class=w> </span>-rf<span class=w> </span>/tmp/nginx-1.12.1*<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-10-11 name=__codelineno-10-11 href=#__codelineno-10-11></a><span class=w>    </span>cp<span class=w> </span>/usr/share/zoneinfo/Asia/Shanghai<span class=w> </span>/etc/localtime<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-10-12 name=__codelineno-10-12 href=#__codelineno-10-12></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s1>&#39;Asia/Shanghai&#39;</span><span class=w> </span>&gt;/etc/timezone
<a id=__codelineno-10-13 name=__codelineno-10-13 href=#__codelineno-10-13></a>
<a id=__codelineno-10-14 name=__codelineno-10-14 href=#__codelineno-10-14></a><span class=k>COPY</span><span class=w> </span>nginx.conf<span class=w> </span>/usr/local/nginx/conf
<a id=__codelineno-10-15 name=__codelineno-10-15 href=#__codelineno-10-15></a><span class=k>COPY</span><span class=w> </span>vhost/<span class=w> </span>/usr/local/nginx/conf
<a id=__codelineno-10-16 name=__codelineno-10-16 href=#__codelineno-10-16></a>
<a id=__codelineno-10-17 name=__codelineno-10-17 href=#__codelineno-10-17></a><span class=k>WORKDIR</span><span class=w> </span><span class=s>/usr/local/nginx</span>
<a id=__codelineno-10-18 name=__codelineno-10-18 href=#__codelineno-10-18></a><span class=k>EXPOSE</span><span class=w> </span><span class=s>80</span>
<a id=__codelineno-10-19 name=__codelineno-10-19 href=#__codelineno-10-19></a><span class=k>CMD</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;./sbin/nginx&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;-g&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;daemon off;&quot;</span><span class=p>]</span>
</code></pre></div></p> <h4 id=redis>Redis<a class=headerlink href=#redis title="Permanent link">&para;</a></h4> <p>通过Dockerfile也可以构建和官方一样的Redis镜像。这里以2.8版本为例，其Dockerfile为： <div class=highlight><pre><span></span><code><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=k>FROM</span><span class=w> </span><span class=s>debian:wheezy</span>
<a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a><span class=c># add our user and group first to make sure their IDs get assigned consistently, regardless of whatever dependencies get added</span>
<a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a><span class=k>RUN</span><span class=w> </span>groupadd<span class=w> </span>-r<span class=w> </span>redis<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>useradd<span class=w> </span>-r<span class=w> </span>-g<span class=w> </span>redis<span class=w> </span>redis
<a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a><span class=k>RUN</span><span class=w> </span>apt-get<span class=w> </span>update<span class=w> </span><span class=se>\</span>
<a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a><span class=w>  </span><span class=o>&amp;&amp;</span><span class=w> </span>apt-get<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>curl<span class=w> </span><span class=se>\</span>
<a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a><span class=w>  </span><span class=o>&amp;&amp;</span><span class=w> </span>rm<span class=w> </span>-rf<span class=w> </span>/var/lib/apt/lists/*
<a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a><span class=c># grab gosu for easy step-down from root</span>
<a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a><span class=k>RUN</span><span class=w> </span>gpg<span class=w> </span>--keyserver<span class=w> </span>pool.sks-keyservers.net<span class=w> </span>--recv-keys<span class=w> </span>B42F6819007F00F88E364FD4036A9C25BF357DD4
<a id=__codelineno-11-9 name=__codelineno-11-9 href=#__codelineno-11-9></a>
<a id=__codelineno-11-10 name=__codelineno-11-10 href=#__codelineno-11-10></a><span class=k>RUN</span><span class=w> </span>curl<span class=w> </span>-o<span class=w> </span>/usr/local/bin/gosu<span class=w> </span>-SL<span class=w> </span><span class=s2>&quot;https://github.com/tianon/gosu/releases/download/1.2/gosu-</span><span class=k>$(</span>dpkg<span class=w> </span>--print-architecture<span class=k>)</span><span class=s2>&quot;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-11-11 name=__codelineno-11-11 href=#__codelineno-11-11></a><span class=w>  </span><span class=o>&amp;&amp;</span><span class=w> </span>curl<span class=w> </span>-o<span class=w> </span>/usr/local/bin/gosu.asc<span class=w> </span>-SL<span class=s2>&quot;https://github.com/tianon/gosu/releases/download/1.2/gosu-</span><span class=k>$(</span>dpkg<span class=w> </span>--print-architecture<span class=k>)</span><span class=s2>.asc&quot;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-11-12 name=__codelineno-11-12 href=#__codelineno-11-12></a><span class=w>  </span><span class=o>&amp;&amp;</span><span class=w> </span>gpg<span class=w> </span>--verify<span class=w> </span>/usr/local/bin/gosu.asc<span class=w> </span><span class=se>\</span>
<a id=__codelineno-11-13 name=__codelineno-11-13 href=#__codelineno-11-13></a><span class=w>  </span><span class=o>&amp;&amp;</span><span class=w> </span>rm<span class=w> </span>/usr/local/bin/gosu.asc<span class=w> </span><span class=se>\</span>
<a id=__codelineno-11-14 name=__codelineno-11-14 href=#__codelineno-11-14></a><span class=w>  </span><span class=o>&amp;&amp;</span><span class=w> </span>chmod<span class=w> </span>+x<span class=w> </span>/usr/local/bin/gosu
<a id=__codelineno-11-15 name=__codelineno-11-15 href=#__codelineno-11-15></a><span class=k>ENV</span><span class=w> </span>REDIS_VERSION<span class=w> </span><span class=m>2</span>.8.19
<a id=__codelineno-11-16 name=__codelineno-11-16 href=#__codelineno-11-16></a><span class=k>ENV</span><span class=w> </span>REDIS_DOWNLOAD_URL<span class=w> </span>http://download.redis.io/releases/redis-2.8.19.tar.gz
<a id=__codelineno-11-17 name=__codelineno-11-17 href=#__codelineno-11-17></a><span class=k>ENV</span><span class=w> </span>REDIS_DOWNLOAD_SHA1<span class=w> </span>3e362f4770ac2fdbdce58a5aa951c1967e0facc8
<a id=__codelineno-11-18 name=__codelineno-11-18 href=#__codelineno-11-18></a><span class=c># for redis-sentinel see: http://redis.io/topics/sentinel</span>
<a id=__codelineno-11-19 name=__codelineno-11-19 href=#__codelineno-11-19></a><span class=k>RUN</span><span class=w> </span><span class=nv>buildDeps</span><span class=o>=</span><span class=s1>&#39;gcc libc6-dev make&#39;</span><span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-11-20 name=__codelineno-11-20 href=#__codelineno-11-20></a><span class=w>  </span><span class=nb>set</span><span class=w> </span>-x<span class=w> </span><span class=se>\</span>
<a id=__codelineno-11-21 name=__codelineno-11-21 href=#__codelineno-11-21></a><span class=w>  </span><span class=o>&amp;&amp;</span><span class=w> </span>apt-get<span class=w> </span>update<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>apt-get<span class=w> </span>install<span class=w> </span>-y<span class=w> </span><span class=nv>$buildDeps</span><span class=w> </span>--no-install-recommends<span class=w> </span><span class=se>\</span>
<a id=__codelineno-11-22 name=__codelineno-11-22 href=#__codelineno-11-22></a><span class=w>  </span><span class=o>&amp;&amp;</span><span class=w> </span>rm<span class=w> </span>-rf<span class=w> </span>/var/lib/apt/lists/*<span class=w> </span><span class=se>\</span>
<a id=__codelineno-11-23 name=__codelineno-11-23 href=#__codelineno-11-23></a><span class=w>  </span><span class=o>&amp;&amp;</span><span class=w> </span>mkdir<span class=w> </span>-p<span class=w> </span>/usr/src/redis<span class=w> </span><span class=se>\</span>
<a id=__codelineno-11-24 name=__codelineno-11-24 href=#__codelineno-11-24></a><span class=w>  </span><span class=o>&amp;&amp;</span><span class=w> </span>curl<span class=w> </span>-sSL<span class=w> </span><span class=s2>&quot;</span><span class=nv>$REDIS_DOWNLOAD_URL</span><span class=s2>&quot;</span><span class=w> </span>-o<span class=w> </span>redis.tar.gz<span class=w> </span><span class=se>\</span>
<a id=__codelineno-11-25 name=__codelineno-11-25 href=#__codelineno-11-25></a><span class=w>  </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$REDIS_DOWNLOAD_SHA1</span><span class=s2> *redis.tar.gz&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>sha1sum<span class=w> </span>-c<span class=w> </span>-<span class=w> </span><span class=se>\</span>
<a id=__codelineno-11-26 name=__codelineno-11-26 href=#__codelineno-11-26></a><span class=w>  </span><span class=o>&amp;&amp;</span><span class=w> </span>tar<span class=w> </span>-xzf<span class=w> </span>redis.tar.gz<span class=w> </span>-C<span class=w> </span>/usr/src/redis<span class=w> </span>--strip-components<span class=o>=</span><span class=m>1</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-11-27 name=__codelineno-11-27 href=#__codelineno-11-27></a><span class=w>  </span><span class=o>&amp;&amp;</span><span class=w> </span>rm<span class=w> </span>redis.tar.gz<span class=w> </span><span class=se>\</span>
<a id=__codelineno-11-28 name=__codelineno-11-28 href=#__codelineno-11-28></a><span class=w>  </span><span class=o>&amp;&amp;</span><span class=w> </span>make<span class=w> </span>-C<span class=w> </span>/usr/src/redis<span class=w> </span><span class=se>\</span>
<a id=__codelineno-11-29 name=__codelineno-11-29 href=#__codelineno-11-29></a><span class=w>  </span><span class=o>&amp;&amp;</span><span class=w> </span>make<span class=w> </span>-C<span class=w> </span>/usr/src/redis<span class=w> </span>install<span class=w> </span><span class=se>\</span>
<a id=__codelineno-11-30 name=__codelineno-11-30 href=#__codelineno-11-30></a><span class=w>  </span><span class=o>&amp;&amp;</span><span class=w> </span>rm<span class=w> </span>-r<span class=w> </span>/usr/src/redis<span class=w> </span><span class=se>\</span>
<a id=__codelineno-11-31 name=__codelineno-11-31 href=#__codelineno-11-31></a><span class=w>  </span><span class=o>&amp;&amp;</span><span class=w> </span>apt-get<span class=w> </span>purge<span class=w> </span>-y<span class=w> </span>--auto-remove<span class=w> </span><span class=nv>$buildDeps</span>
<a id=__codelineno-11-32 name=__codelineno-11-32 href=#__codelineno-11-32></a><span class=k>RUN</span><span class=w> </span>mkdir<span class=w> </span>/data<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>chown<span class=w> </span>redis:redis<span class=w> </span>/data
<a id=__codelineno-11-33 name=__codelineno-11-33 href=#__codelineno-11-33></a><span class=k>VOLUME</span><span class=w> </span><span class=s>/data</span>
<a id=__codelineno-11-34 name=__codelineno-11-34 href=#__codelineno-11-34></a><span class=k>WORKDIR</span><span class=w> </span><span class=s>/data</span>
<a id=__codelineno-11-35 name=__codelineno-11-35 href=#__codelineno-11-35></a><span class=k>COPY</span><span class=w> </span>docker-entrypoint.sh<span class=w> </span>/entrypoint.sh
<a id=__codelineno-11-36 name=__codelineno-11-36 href=#__codelineno-11-36></a><span class=k>ENTRYPOINT</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;/entrypoint.sh&quot;</span><span class=p>]</span>
<a id=__codelineno-11-37 name=__codelineno-11-37 href=#__codelineno-11-37></a><span class=k>EXPOSE</span><span class=w> </span><span class=s>6379</span>
<a id=__codelineno-11-38 name=__codelineno-11-38 href=#__codelineno-11-38></a><span class=k>CMD</span><span class=w> </span><span class=p>[</span><span class=w> </span><span class=s2>&quot;redis-server&quot;</span><span class=w> </span><span class=p>]</span>
</code></pre></div></p> <p>官方提供的Dockerfile 请到<code>https://github.com/docker-library/docs/tree/master/redis</code> 查看。</p> <h4 id=mysql>MySQL<a class=headerlink href=#mysql title="Permanent link">&para;</a></h4> <p>通过Dockerfile来创建mysql <div class=highlight><pre><span></span><code><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=k>FROM</span><span class=w> </span><span class=s>debian:wheezy</span>
<a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a><span class=c># add our user and group first to make sure their IDs get assigned consistently, regardless of whatever dependencies get added</span>
<a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a><span class=k>RUN</span><span class=w> </span>groupadd<span class=w> </span>-r<span class=w> </span>mysql<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>useradd<span class=w> </span>-r<span class=w> </span>-g<span class=w> </span>mysql<span class=w> </span>mysql
<a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a><span class=c># FATAL ERROR: please install the following Perl modules before executing /usr/local/mysql/scripts/mysql_install_db:</span>
<a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a><span class=c># File::Basename</span>
<a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a><span class=c># File::Copy</span>
<a id=__codelineno-12-7 name=__codelineno-12-7 href=#__codelineno-12-7></a><span class=c># Sys::Hostname</span>
<a id=__codelineno-12-8 name=__codelineno-12-8 href=#__codelineno-12-8></a><span class=c># Data::Dumper</span>
<a id=__codelineno-12-9 name=__codelineno-12-9 href=#__codelineno-12-9></a><span class=k>RUN</span><span class=w> </span>apt-get<span class=w> </span>update<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>apt-get<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>perl<span class=w> </span>--no-install-recommends<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>rm<span class=w> </span>-rf<span class=w> </span>/var/lib/apt/lists/*
<a id=__codelineno-12-10 name=__codelineno-12-10 href=#__codelineno-12-10></a><span class=c># gpg: key 5072E1F5: public key &quot;MySQL Release Engineering &lt;mysql-build@oss.oracle.com&gt;&quot; imported</span>
<a id=__codelineno-12-11 name=__codelineno-12-11 href=#__codelineno-12-11></a><span class=k>RUN</span><span class=w> </span>apt-key<span class=w> </span>adv<span class=w> </span>--keyserver<span class=w> </span>pool.sks-keyservers.net<span class=w> </span>--recv-keys<span class=w> </span>A4A9406876FCBD3C456770C88C718D3B5072E1F5
<a id=__codelineno-12-12 name=__codelineno-12-12 href=#__codelineno-12-12></a><span class=k>ENV</span><span class=w> </span>MYSQL_MAJOR<span class=w> </span><span class=m>5</span>.7
<a id=__codelineno-12-13 name=__codelineno-12-13 href=#__codelineno-12-13></a><span class=k>ENV</span><span class=w> </span>MYSQL_VERSION<span class=w> </span><span class=m>5</span>.7.5-m15
<a id=__codelineno-12-14 name=__codelineno-12-14 href=#__codelineno-12-14></a><span class=k>RUN</span><span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;deb http://repo.mysql.com/apt/debian/ wheezy mysql-</span><span class=si>${</span><span class=nv>MYSQL_MAJOR</span><span class=si>}</span><span class=s2>-dmr&quot;</span><span class=w> </span>&gt;<span class=w> </span>/etc/apt/sources.list.d/mysql.list
<a id=__codelineno-12-15 name=__codelineno-12-15 href=#__codelineno-12-15></a><span class=c># the &quot;/var/lib/mysql&quot; stuff here is because the mysql-server postinst doesn&#39;t have an explicit way</span>
<a id=__codelineno-12-16 name=__codelineno-12-16 href=#__codelineno-12-16></a><span class=c># to disable the mysql_install_db codepath besides having a database already &quot;configured&quot; (ie, stuff in /var/lib/mysql/mysql)</span>
<a id=__codelineno-12-17 name=__codelineno-12-17 href=#__codelineno-12-17></a><span class=c># also, we set debconf keys to make APT a little quieter</span>
<a id=__codelineno-12-18 name=__codelineno-12-18 href=#__codelineno-12-18></a><span class=k>RUN</span><span class=w> </span><span class=o>{</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-12-19 name=__codelineno-12-19 href=#__codelineno-12-19></a><span class=w>  </span><span class=nb>echo</span><span class=w> </span>mysql-community-server<span class=w> </span>mysql-community-server/data-dir<span class=w> </span><span class=k>select</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-12-20 name=__codelineno-12-20 href=#__codelineno-12-20></a><span class=w>  </span><span class=nb>echo</span><span class=w> </span>mysql-community-server<span class=w> </span>mysql-community-server/root-pass<span class=w> </span>password<span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-12-21 name=__codelineno-12-21 href=#__codelineno-12-21></a><span class=w>  </span><span class=nb>echo</span><span class=w> </span>mysql-community-server<span class=w> </span>mysql-community-server/re-root-pass<span class=w> </span>password<span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-12-22 name=__codelineno-12-22 href=#__codelineno-12-22></a><span class=w>  </span><span class=nb>echo</span><span class=w> </span>mysql-community-server<span class=w> </span>mysql-community-server/remove-test-db<span class=w> </span><span class=k>select</span><span class=w> </span>false<span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-12-23 name=__codelineno-12-23 href=#__codelineno-12-23></a><span class=w>  </span><span class=o>}</span><span class=w> </span><span class=p>|</span><span class=w> </span>debconf-set-selections<span class=w> </span><span class=se>\</span>
<a id=__codelineno-12-24 name=__codelineno-12-24 href=#__codelineno-12-24></a><span class=w>  </span><span class=o>&amp;&amp;</span><span class=w> </span>apt-get<span class=w> </span>update<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>apt-get<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>mysql-server<span class=o>=</span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>MYSQL_VERSION</span><span class=si>}</span><span class=s2>&quot;</span>*<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>rm<span class=w> </span>-rf<span class=w> </span>/var/lib/apt/lists/*<span class=w> </span><span class=se>\</span>
<a id=__codelineno-12-25 name=__codelineno-12-25 href=#__codelineno-12-25></a><span class=w>  </span><span class=o>&amp;&amp;</span><span class=w> </span>rm<span class=w> </span>-rf<span class=w> </span>/var/lib/mysql<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>mkdir<span class=w> </span>-p<span class=w> </span>/var/lib/mysql
<a id=__codelineno-12-26 name=__codelineno-12-26 href=#__codelineno-12-26></a><span class=c># comment out a few problematic configuration values</span>
<a id=__codelineno-12-27 name=__codelineno-12-27 href=#__codelineno-12-27></a><span class=k>RUN</span><span class=w> </span>sed<span class=w> </span>-Ei<span class=w> </span><span class=s1>&#39;s/^(bind-address|log)/#&amp;/&#39;</span><span class=w> </span>/etc/mysql/my.cnf
<a id=__codelineno-12-28 name=__codelineno-12-28 href=#__codelineno-12-28></a><span class=k>VOLUME</span><span class=w> </span><span class=s>/var/lib/mysql</span>
<a id=__codelineno-12-29 name=__codelineno-12-29 href=#__codelineno-12-29></a><span class=k>COPY</span><span class=w> </span>docker-entrypoint.sh<span class=w> </span>/entrypoint.sh
<a id=__codelineno-12-30 name=__codelineno-12-30 href=#__codelineno-12-30></a><span class=k>ENTRYPOINT</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;/entrypoint.sh&quot;</span><span class=p>]</span>
<a id=__codelineno-12-31 name=__codelineno-12-31 href=#__codelineno-12-31></a><span class=k>EXPOSE</span><span class=w> </span><span class=s>3306</span>
<a id=__codelineno-12-32 name=__codelineno-12-32 href=#__codelineno-12-32></a><span class=k>CMD</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;mysqld&quot;</span><span class=p>]</span>
</code></pre></div></p> <p>官方提供的Dockerfile 请到<code>https://github.com/docker-library/docs/tree/master/mysql</code> 查看</p> <h4 id=mongodb>Mongodb<a class=headerlink href=#mongodb title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=k>FROM</span><span class=w> </span><span class=s>debian:wheezy</span>
<a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a>
<a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a><span class=k>RUN</span><span class=w> </span>groupadd<span class=w> </span>-r<span class=w> </span>mongodb<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>useradd<span class=w> </span>-r<span class=w> </span>-g<span class=w> </span>mongodb<span class=w> </span>mongodb
<a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a><span class=k>RUN</span><span class=w> </span>apt-get<span class=w> </span>update<span class=w> </span><span class=se>\</span>
<a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a><span class=w>  </span><span class=o>&amp;&amp;</span><span class=w> </span>apt-get<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>curl<span class=w> </span>numactl<span class=w> </span><span class=se>\</span>
<a id=__codelineno-13-6 name=__codelineno-13-6 href=#__codelineno-13-6></a><span class=w>  </span><span class=o>&amp;&amp;</span><span class=w> </span>rm<span class=w> </span>-rf<span class=w> </span>/var/lib/apt/lists/*
<a id=__codelineno-13-7 name=__codelineno-13-7 href=#__codelineno-13-7></a><span class=c># grab gosu for easy step-down from root</span>
<a id=__codelineno-13-8 name=__codelineno-13-8 href=#__codelineno-13-8></a><span class=k>RUN</span><span class=w> </span>gpg<span class=w> </span>--keyserver<span class=w> </span>pool.sks-keyservers.net<span class=w> </span>--recv-keys<span class=w> </span>B42F6819007F00F88E364FD4036A9C25BF357DD4
<a id=__codelineno-13-9 name=__codelineno-13-9 href=#__codelineno-13-9></a><span class=k>RUN</span><span class=w> </span>curl<span class=w> </span>-o<span class=w> </span>/usr/local/bin/gosu<span class=w> </span>-SL<span class=w> </span><span class=s2>&quot;https://github.com/tianon/gosu/releases/download/1.2/gosu-</span><span class=k>$(</span>dpkg--print-architecture<span class=k>)</span><span class=s2>&quot;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-13-10 name=__codelineno-13-10 href=#__codelineno-13-10></a><span class=w>  </span><span class=o>&amp;&amp;</span><span class=w> </span>curl<span class=w> </span>-o<span class=w> </span>/usr/local/bin/gosu.asc<span class=w> </span>-SL<span class=w> </span><span class=s2>&quot;https://github.com/tianon/gosu/releases/download/1.2/gosu-</span><span class=k>$(</span>dpkg<span class=w> </span>--print-architecture<span class=k>)</span><span class=s2>.asc&quot;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-13-11 name=__codelineno-13-11 href=#__codelineno-13-11></a><span class=w>  </span><span class=o>&amp;&amp;</span><span class=w> </span>gpg<span class=w> </span>--verify<span class=w> </span>/usr/local/bin/gosu.asc<span class=w> </span><span class=se>\</span>
<a id=__codelineno-13-12 name=__codelineno-13-12 href=#__codelineno-13-12></a><span class=w>  </span><span class=o>&amp;&amp;</span><span class=w> </span>rm<span class=w> </span>/usr/local/bin/gosu.asc<span class=w> </span><span class=se>\</span>
<a id=__codelineno-13-13 name=__codelineno-13-13 href=#__codelineno-13-13></a><span class=w>  </span><span class=o>&amp;&amp;</span><span class=w> </span>chmod<span class=w> </span>+x<span class=w> </span>/usr/local/bin/gosu
<a id=__codelineno-13-14 name=__codelineno-13-14 href=#__codelineno-13-14></a><span class=k>ENV</span><span class=w> </span>MONGO_RELEASE_FINGERPRINT<span class=w> </span>BDC0DB28022D7DEA1490DC3E7085801C857FD301
<a id=__codelineno-13-15 name=__codelineno-13-15 href=#__codelineno-13-15></a><span class=k>RUN</span><span class=w> </span>gpg<span class=w> </span>--keyserver<span class=w> </span>pool.sks-keyservers.net<span class=w> </span>--recv-keys<span class=w> </span><span class=nv>$MONGO_RELEASE_FINGERPRINT</span>
<a id=__codelineno-13-16 name=__codelineno-13-16 href=#__codelineno-13-16></a><span class=k>ENV</span><span class=w> </span>MONGO_VERSION<span class=w> </span><span class=m>3</span>.0.0-rc6
<a id=__codelineno-13-17 name=__codelineno-13-17 href=#__codelineno-13-17></a><span class=k>RUN</span><span class=w> </span>curl<span class=w> </span>-SL<span class=w> </span><span class=s2>&quot;https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-</span><span class=nv>$MONGO_VERSION</span><span class=s2>.tgz&quot;</span><span class=w> </span>-o<span class=w> </span>mongo.tgz<span class=w> </span><span class=se>\</span>
<a id=__codelineno-13-18 name=__codelineno-13-18 href=#__codelineno-13-18></a><span class=w>  </span><span class=o>&amp;&amp;</span><span class=w> </span>curl<span class=w> </span>-SL<span class=w> </span><span class=s2>&quot;https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-</span><span class=nv>$MONGO_VERSION</span><span class=s2>.tgz.sig&quot;</span><span class=w> </span>–o<span class=w> </span>mongo.tgz.sig<span class=w> </span><span class=se>\</span>
<a id=__codelineno-13-19 name=__codelineno-13-19 href=#__codelineno-13-19></a><span class=w>  </span><span class=o>&amp;&amp;</span><span class=w> </span>gpg<span class=w> </span>--verify<span class=w> </span>mongo.tgz.sig<span class=w> </span><span class=se>\</span>
<a id=__codelineno-13-20 name=__codelineno-13-20 href=#__codelineno-13-20></a><span class=w>  </span><span class=o>&amp;&amp;</span><span class=w> </span>tar<span class=w> </span>-xvf<span class=w> </span>mongo.tgz<span class=w> </span>-C<span class=w> </span>/usr/local<span class=w> </span>--strip-components<span class=o>=</span><span class=m>1</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-13-21 name=__codelineno-13-21 href=#__codelineno-13-21></a><span class=w>  </span><span class=o>&amp;&amp;</span><span class=w> </span>rm<span class=w> </span>mongo.tgz*
<a id=__codelineno-13-22 name=__codelineno-13-22 href=#__codelineno-13-22></a><span class=k>VOLUME</span><span class=w> </span><span class=s>/data/db</span>
<a id=__codelineno-13-23 name=__codelineno-13-23 href=#__codelineno-13-23></a><span class=k>COPY</span><span class=w> </span>docker-entrypoint.sh<span class=w> </span>/entrypoint.sh
<a id=__codelineno-13-24 name=__codelineno-13-24 href=#__codelineno-13-24></a><span class=k>ENTRYPOINT</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;/entrypoint.sh&quot;</span><span class=p>]</span>
<a id=__codelineno-13-25 name=__codelineno-13-25 href=#__codelineno-13-25></a><span class=k>EXPOSE</span><span class=w> </span><span class=s>27017</span>
<a id=__codelineno-13-26 name=__codelineno-13-26 href=#__codelineno-13-26></a><span class=k>CMD</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;mongod&quot;</span><span class=p>]</span>
</code></pre></div> <p>官方提供的Dockerfile 请到 <code>https://github.com/docker-library/docs/tree/master/mongo</code> 查看。</p> <h4 id=postgres>Postgres<a class=headerlink href=#postgres title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=k>FROM</span><span class=w> </span><span class=s>debian:wheezy</span>
<a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a><span class=c># add our user and group first to make sure their IDs get assigned consistently, regardless of whatever dependencies get added</span>
<a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a><span class=k>RUN</span><span class=w> </span>groupadd<span class=w> </span>-r<span class=w> </span>postgres<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>useradd<span class=w> </span>-r<span class=w> </span>-g<span class=w> </span>postgres<span class=w> </span>postgres
<a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a><span class=c># grab gosu for easy step-down from root</span>
<a id=__codelineno-14-5 name=__codelineno-14-5 href=#__codelineno-14-5></a><span class=k>RUN</span><span class=w> </span>gpg<span class=w> </span>--keyserver<span class=w> </span>pool.sks-keyservers.net<span class=w> </span>--recv-keys<span class=w> </span>B42F6819007F00F88E364FD4036A9C25BF357DD4
<a id=__codelineno-14-6 name=__codelineno-14-6 href=#__codelineno-14-6></a><span class=k>RUN</span><span class=w> </span>apt-get<span class=w> </span>update<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>apt-get<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>curl<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>rm<span class=w> </span>-rf<span class=w> </span>/var/lib/apt/lists/*<span class=w> </span><span class=se>\</span>
<a id=__codelineno-14-7 name=__codelineno-14-7 href=#__codelineno-14-7></a><span class=w>  </span><span class=o>&amp;&amp;</span><span class=w> </span>curl<span class=w> </span>-o<span class=w> </span>/usr/local/bin/gosu<span class=w> </span>–SL<span class=w> </span><span class=s2>&quot;https://github.com/tianon/gosu/releases/download/1.2/gosu-</span><span class=k>$(</span>dpkg<span class=w> </span>--print-architecture<span class=k>)</span><span class=s2>&quot;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-14-8 name=__codelineno-14-8 href=#__codelineno-14-8></a><span class=w>  </span><span class=o>&amp;&amp;</span><span class=w> </span>curl<span class=w> </span>-o<span class=w> </span>/usr/local/bin/gosu.asc<span class=w> </span>-SL<span class=w> </span><span class=s2>&quot;https://github.com/tianon/gosu/releases/download/1.2/gosu-</span><span class=k>$(</span>dpkg<span class=w> </span>--print-architecture<span class=k>)</span><span class=s2>.asc&quot;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-14-9 name=__codelineno-14-9 href=#__codelineno-14-9></a><span class=w>  </span><span class=o>&amp;&amp;</span><span class=w> </span>gpg<span class=w> </span>--verify<span class=w> </span>/usr/local/bin/gosu.asc<span class=w> </span><span class=se>\</span>
<a id=__codelineno-14-10 name=__codelineno-14-10 href=#__codelineno-14-10></a><span class=w>  </span><span class=o>&amp;&amp;</span><span class=w> </span>rm<span class=w> </span>/usr/local/bin/gosu.asc<span class=w> </span><span class=se>\</span>
<a id=__codelineno-14-11 name=__codelineno-14-11 href=#__codelineno-14-11></a><span class=w>  </span><span class=o>&amp;&amp;</span><span class=w> </span>chmod<span class=w> </span>+x<span class=w> </span>/usr/local/bin/gosu<span class=w> </span><span class=se>\</span>
<a id=__codelineno-14-12 name=__codelineno-14-12 href=#__codelineno-14-12></a><span class=w>  </span><span class=o>&amp;&amp;</span><span class=w> </span>apt-get<span class=w> </span>purge<span class=w> </span>-y<span class=w> </span>--auto-remove<span class=w> </span>curl
<a id=__codelineno-14-13 name=__codelineno-14-13 href=#__codelineno-14-13></a><span class=c># make the &quot;en_US.UTF-8&quot; locale so postgres will be utf-8 enabled by default</span>
<a id=__codelineno-14-14 name=__codelineno-14-14 href=#__codelineno-14-14></a><span class=k>RUN</span><span class=w> </span>apt-get<span class=w> </span>update<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>apt-get<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>locales<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>rm<span class=w> </span>-rf<span class=w> </span>/var/lib/apt/lists/*<span class=w> </span><span class=se>\</span>
<a id=__codelineno-14-15 name=__codelineno-14-15 href=#__codelineno-14-15></a><span class=w>  </span><span class=o>&amp;&amp;</span><span class=w> </span>localedef<span class=w> </span>-i<span class=w> </span>en_US<span class=w> </span>-c<span class=w> </span>-f<span class=w> </span>UTF-8<span class=w> </span>-A<span class=w> </span>/usr/share/locale/locale.alias<span class=w> </span>en_US.UTF-8
<a id=__codelineno-14-16 name=__codelineno-14-16 href=#__codelineno-14-16></a><span class=k>ENV</span><span class=w> </span>LANG<span class=w> </span>en_US.utf8
<a id=__codelineno-14-17 name=__codelineno-14-17 href=#__codelineno-14-17></a><span class=k>RUN</span><span class=w> </span>mkdir<span class=w> </span>/docker-entrypoint-initdb.d
<a id=__codelineno-14-18 name=__codelineno-14-18 href=#__codelineno-14-18></a><span class=k>RUN</span><span class=w> </span>apt-key<span class=w> </span>adv<span class=w> </span>--keyserver<span class=w> </span>pool.sks-keyservers.net<span class=w> </span>--recv-keys<span class=w> </span>B97B0AFCAA1A47F044F244A07FCC7D46ACCC4CF8
<a id=__codelineno-14-19 name=__codelineno-14-19 href=#__codelineno-14-19></a><span class=k>ENV</span><span class=w> </span>PG_MAJOR<span class=w> </span><span class=m>9</span>.4
<a id=__codelineno-14-20 name=__codelineno-14-20 href=#__codelineno-14-20></a><span class=k>ENV</span><span class=w> </span>PG_VERSION<span class=w> </span><span class=m>9</span>.4.0-1.pgdg70+1
<a id=__codelineno-14-21 name=__codelineno-14-21 href=#__codelineno-14-21></a><span class=k>RUN</span><span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s1>&#39;deb http://apt.postgresql.org/pub/repos/apt/ wheezy-pgdg main&#39;</span><span class=w> </span><span class=nv>$PG_MAJOR</span><span class=w> </span>&gt;<span class=w> </span>/etc/apt/sources.list.d/pgdg.list
<a id=__codelineno-14-22 name=__codelineno-14-22 href=#__codelineno-14-22></a><span class=k>RUN</span><span class=w> </span>apt-get<span class=w> </span>update<span class=w> </span><span class=se>\</span>
<a id=__codelineno-14-23 name=__codelineno-14-23 href=#__codelineno-14-23></a><span class=w>  </span><span class=o>&amp;&amp;</span><span class=w> </span>apt-get<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>postgresql-common<span class=w> </span><span class=se>\</span>
<a id=__codelineno-14-24 name=__codelineno-14-24 href=#__codelineno-14-24></a><span class=w>  </span><span class=o>&amp;&amp;</span><span class=w> </span>sed<span class=w> </span>-ri<span class=w> </span><span class=s1>&#39;s/#(create_main_cluster) .*$/\1 = false/&#39;</span><span class=w> </span>/etc/postgresql-common/createcluster.conf<span class=w> </span><span class=se>\</span>
<a id=__codelineno-14-25 name=__codelineno-14-25 href=#__codelineno-14-25></a><span class=w>  </span><span class=o>&amp;&amp;</span><span class=w> </span>apt-get<span class=w> </span>install<span class=w> </span>-y<span class=w> </span><span class=se>\</span>
<a id=__codelineno-14-26 name=__codelineno-14-26 href=#__codelineno-14-26></a><span class=w>  </span>postgresql-<span class=nv>$PG_MAJOR</span><span class=o>=</span><span class=nv>$PG_VERSION</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-14-27 name=__codelineno-14-27 href=#__codelineno-14-27></a><span class=w>  </span>postgresql-contrib-<span class=nv>$PG_MAJOR</span><span class=o>=</span><span class=nv>$PG_VERSION</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-14-28 name=__codelineno-14-28 href=#__codelineno-14-28></a><span class=w>  </span><span class=o>&amp;&amp;</span><span class=w> </span>rm<span class=w> </span>-rf<span class=w> </span>/var/lib/apt/lists/*
<a id=__codelineno-14-29 name=__codelineno-14-29 href=#__codelineno-14-29></a><span class=k>RUN</span><span class=w> </span>mkdir<span class=w> </span>-p<span class=w> </span>/var/run/postgresql<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>chown<span class=w> </span>-R<span class=w> </span>postgres<span class=w> </span>/var/run/postgresql
<a id=__codelineno-14-30 name=__codelineno-14-30 href=#__codelineno-14-30></a><span class=k>ENV</span><span class=w> </span>PATH<span class=w> </span>/usr/lib/postgresql/<span class=nv>$PG_MAJOR</span>/bin:<span class=nv>$PATH</span>
<a id=__codelineno-14-31 name=__codelineno-14-31 href=#__codelineno-14-31></a><span class=k>ENV</span><span class=w> </span>PGDATA<span class=w> </span>/var/lib/postgresql/data
<a id=__codelineno-14-32 name=__codelineno-14-32 href=#__codelineno-14-32></a><span class=k>VOLUME</span><span class=w> </span><span class=s>/var/lib/postgresql/data</span>
<a id=__codelineno-14-33 name=__codelineno-14-33 href=#__codelineno-14-33></a><span class=k>COPY</span><span class=w> </span>docker-entrypoint.sh<span class=w> </span>/
<a id=__codelineno-14-34 name=__codelineno-14-34 href=#__codelineno-14-34></a><span class=k>ENTRYPOINT</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;/docker-entrypoint.sh&quot;</span><span class=p>]</span>
<a id=__codelineno-14-35 name=__codelineno-14-35 href=#__codelineno-14-35></a><span class=k>EXPOSE</span><span class=w> </span><span class=s>5432</span>
<a id=__codelineno-14-36 name=__codelineno-14-36 href=#__codelineno-14-36></a><span class=k>CMD</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;postgres&quot;</span><span class=p>]</span>
</code></pre></div> <h4 id=httpd>httpd<a class=headerlink href=#httpd title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a><span class=k>FROM</span><span class=w> </span><span class=s>debian:jessie</span>
<a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a><span class=c># add our user and group first to make sure their IDs get assigned consistently, regardless of whatever dependencies get added</span>
<a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a><span class=c>#RUN groupadd -r www-data &amp;&amp; useradd -r --create-home -g www-data www-data</span>
<a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a><span class=k>ENV</span><span class=w> </span>HTTPD_PREFIX<span class=w> </span>/usr/local/apache2
<a id=__codelineno-15-5 name=__codelineno-15-5 href=#__codelineno-15-5></a><span class=k>ENV</span><span class=w> </span>PATH<span class=w> </span><span class=nv>$PATH</span>:<span class=nv>$HTTPD_PREFIX</span>/bin
<a id=__codelineno-15-6 name=__codelineno-15-6 href=#__codelineno-15-6></a><span class=k>RUN</span><span class=w> </span>mkdir<span class=w> </span>-p<span class=w> </span><span class=s2>&quot;</span><span class=nv>$HTTPD_PREFIX</span><span class=s2>&quot;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-15-7 name=__codelineno-15-7 href=#__codelineno-15-7></a><span class=w>  </span><span class=o>&amp;&amp;</span><span class=w> </span>chown<span class=w> </span>www-data:www-data<span class=w> </span><span class=s2>&quot;</span><span class=nv>$HTTPD_PREFIX</span><span class=s2>&quot;</span>
<a id=__codelineno-15-8 name=__codelineno-15-8 href=#__codelineno-15-8></a><span class=k>WORKDIR</span><span class=w> </span><span class=s>$HTTPD_PREFIX</span>
<a id=__codelineno-15-9 name=__codelineno-15-9 href=#__codelineno-15-9></a><span class=c># install httpd runtime dependencies</span>
<a id=__codelineno-15-10 name=__codelineno-15-10 href=#__codelineno-15-10></a><span class=c># https://httpd.apache.org/docs/2.4/install.html#requirements</span>
<a id=__codelineno-15-11 name=__codelineno-15-11 href=#__codelineno-15-11></a><span class=k>RUN</span><span class=w> </span>apt-get<span class=w> </span>update<span class=w> </span><span class=se>\</span>
<a id=__codelineno-15-12 name=__codelineno-15-12 href=#__codelineno-15-12></a><span class=w>  </span><span class=o>&amp;&amp;</span><span class=w> </span>apt-get<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>--no-install-recommends<span class=w> </span><span class=se>\</span>
<a id=__codelineno-15-13 name=__codelineno-15-13 href=#__codelineno-15-13></a><span class=w>  </span>libapr1<span class=w> </span><span class=se>\</span>
<a id=__codelineno-15-14 name=__codelineno-15-14 href=#__codelineno-15-14></a><span class=w>  </span>libaprutil1<span class=w> </span><span class=se>\</span>
<a id=__codelineno-15-15 name=__codelineno-15-15 href=#__codelineno-15-15></a><span class=w>  </span>libpcre++0<span class=w> </span><span class=se>\</span>
<a id=__codelineno-15-16 name=__codelineno-15-16 href=#__codelineno-15-16></a><span class=w>  </span>libssl1.0.0<span class=w> </span><span class=se>\</span>
<a id=__codelineno-15-17 name=__codelineno-15-17 href=#__codelineno-15-17></a><span class=w>  </span><span class=o>&amp;&amp;</span><span class=w> </span>rm<span class=w> </span>-r<span class=w> </span>/var/lib/apt/lists/*
<a id=__codelineno-15-18 name=__codelineno-15-18 href=#__codelineno-15-18></a><span class=c># see https://httpd.apache.org/download.cgi#verify</span>
<a id=__codelineno-15-19 name=__codelineno-15-19 href=#__codelineno-15-19></a><span class=k>RUN</span><span class=w> </span>gpg<span class=w> </span>--keyserver<span class=w> </span>pool.sks-keyservers.net<span class=w> </span>--recv-keys<span class=w> </span>A93D62ECC3C8EA12DB220EC934EA76E6791485A8
<a id=__codelineno-15-20 name=__codelineno-15-20 href=#__codelineno-15-20></a><span class=k>ENV</span><span class=w> </span>HTTPD_VERSION<span class=w> </span><span class=m>2</span>.4.12
<a id=__codelineno-15-21 name=__codelineno-15-21 href=#__codelineno-15-21></a><span class=k>ENV</span><span class=w> </span>HTTPD_BZ2_URL<span class=w> </span>https://www.apache.org/dist/httpd/httpd-<span class=nv>$HTTPD_VERSION</span>.tar.bz2
<a id=__codelineno-15-22 name=__codelineno-15-22 href=#__codelineno-15-22></a><span class=k>RUN</span><span class=w> </span><span class=nv>buildDeps</span><span class=o>=</span><span class=s1>&#39; \</span>
<a id=__codelineno-15-23 name=__codelineno-15-23 href=#__codelineno-15-23></a><span class=s1>  ca-certificates \</span>
<a id=__codelineno-15-24 name=__codelineno-15-24 href=#__codelineno-15-24></a><span class=s1>  curl \</span>
<a id=__codelineno-15-25 name=__codelineno-15-25 href=#__codelineno-15-25></a><span class=s1>  bzip2 \</span>
<a id=__codelineno-15-26 name=__codelineno-15-26 href=#__codelineno-15-26></a><span class=s1>  gcc \</span>
<a id=__codelineno-15-27 name=__codelineno-15-27 href=#__codelineno-15-27></a><span class=s1>  libapr1-dev \</span>
<a id=__codelineno-15-28 name=__codelineno-15-28 href=#__codelineno-15-28></a><span class=s1>  libaprutil1-dev \</span>
<a id=__codelineno-15-29 name=__codelineno-15-29 href=#__codelineno-15-29></a><span class=s1>  libc6-dev \</span>
<a id=__codelineno-15-30 name=__codelineno-15-30 href=#__codelineno-15-30></a><span class=s1>  libpcre++-dev \</span>
<a id=__codelineno-15-31 name=__codelineno-15-31 href=#__codelineno-15-31></a><span class=s1>  libssl-dev \</span>
<a id=__codelineno-15-32 name=__codelineno-15-32 href=#__codelineno-15-32></a><span class=s1>  make \</span>
<a id=__codelineno-15-33 name=__codelineno-15-33 href=#__codelineno-15-33></a><span class=s1>  &#39;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-15-34 name=__codelineno-15-34 href=#__codelineno-15-34></a><span class=w>  </span><span class=nb>set</span><span class=w> </span>-x<span class=w> </span><span class=se>\</span>
<a id=__codelineno-15-35 name=__codelineno-15-35 href=#__codelineno-15-35></a><span class=w>  </span><span class=o>&amp;&amp;</span><span class=w> </span>apt-get<span class=w> </span>update<span class=w> </span><span class=se>\</span>
<a id=__codelineno-15-36 name=__codelineno-15-36 href=#__codelineno-15-36></a><span class=w>  </span><span class=o>&amp;&amp;</span><span class=w> </span>apt-get<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>--no-install-recommends<span class=w> </span><span class=nv>$buildDeps</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-15-37 name=__codelineno-15-37 href=#__codelineno-15-37></a><span class=w>  </span><span class=o>&amp;&amp;</span><span class=w> </span>rm<span class=w> </span>-r<span class=w> </span>/var/lib/apt/lists/*<span class=w> </span><span class=se>\</span>
<a id=__codelineno-15-38 name=__codelineno-15-38 href=#__codelineno-15-38></a><span class=w>  </span><span class=o>&amp;&amp;</span><span class=w> </span>curl<span class=w> </span>-SL<span class=w> </span><span class=s2>&quot;</span><span class=nv>$HTTPD_BZ2_URL</span><span class=s2>&quot;</span><span class=w> </span>-o<span class=w> </span>httpd.tar.bz2<span class=w> </span><span class=se>\</span>
<a id=__codelineno-15-39 name=__codelineno-15-39 href=#__codelineno-15-39></a><span class=w>  </span><span class=o>&amp;&amp;</span><span class=w> </span>curl<span class=w> </span>-SL<span class=w> </span><span class=s2>&quot;</span><span class=nv>$HTTPD_BZ2_URL</span><span class=s2>.asc&quot;</span><span class=w> </span>-o<span class=w> </span>httpd.tar.bz2.asc<span class=w> </span><span class=se>\</span>
<a id=__codelineno-15-40 name=__codelineno-15-40 href=#__codelineno-15-40></a><span class=w>  </span><span class=o>&amp;&amp;</span><span class=w> </span>gpg<span class=w> </span>--verify<span class=w> </span>httpd.tar.bz2.asc<span class=w> </span><span class=se>\</span>
<a id=__codelineno-15-41 name=__codelineno-15-41 href=#__codelineno-15-41></a><span class=w>  </span><span class=o>&amp;&amp;</span><span class=w> </span>mkdir<span class=w> </span>-p<span class=w> </span>src/httpd<span class=w> </span><span class=se>\</span>
<a id=__codelineno-15-42 name=__codelineno-15-42 href=#__codelineno-15-42></a><span class=w>  </span><span class=o>&amp;&amp;</span><span class=w> </span>tar<span class=w> </span>-xvf<span class=w> </span>httpd.tar.bz2<span class=w> </span>-C<span class=w> </span>src/httpd<span class=w> </span>--strip-components<span class=o>=</span><span class=m>1</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-15-43 name=__codelineno-15-43 href=#__codelineno-15-43></a><span class=w>  </span><span class=o>&amp;&amp;</span><span class=w> </span>rm<span class=w> </span>httpd.tar.bz2*<span class=w> </span><span class=se>\</span>
<a id=__codelineno-15-44 name=__codelineno-15-44 href=#__codelineno-15-44></a><span class=w>  </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nb>cd</span><span class=w> </span>src/httpd<span class=w> </span><span class=se>\</span>
<a id=__codelineno-15-45 name=__codelineno-15-45 href=#__codelineno-15-45></a><span class=w>  </span><span class=o>&amp;&amp;</span><span class=w> </span>./configure<span class=w> </span>--enable-so<span class=w> </span>--enable-ssl<span class=w> </span>--prefix<span class=o>=</span><span class=nv>$HTTPD_PREFIX</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-15-46 name=__codelineno-15-46 href=#__codelineno-15-46></a><span class=w>  </span><span class=o>&amp;&amp;</span><span class=w> </span>make<span class=w> </span>-j<span class=s2>&quot;</span><span class=k>$(</span>nproc<span class=k>)</span><span class=s2>&quot;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-15-47 name=__codelineno-15-47 href=#__codelineno-15-47></a><span class=w>  </span><span class=o>&amp;&amp;</span><span class=w> </span>make<span class=w> </span>install<span class=w> </span><span class=se>\</span>
<a id=__codelineno-15-48 name=__codelineno-15-48 href=#__codelineno-15-48></a><span class=w>  </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nb>cd</span><span class=w> </span>../../<span class=w> </span><span class=se>\</span>
<a id=__codelineno-15-49 name=__codelineno-15-49 href=#__codelineno-15-49></a><span class=w>  </span><span class=o>&amp;&amp;</span><span class=w> </span>rm<span class=w> </span>-r<span class=w> </span>src/httpd<span class=w> </span><span class=se>\</span>
<a id=__codelineno-15-50 name=__codelineno-15-50 href=#__codelineno-15-50></a><span class=w>  </span><span class=o>&amp;&amp;</span><span class=w> </span>sed<span class=w> </span>-ri<span class=w> </span><span class=s1>&#39; \</span>
<a id=__codelineno-15-51 name=__codelineno-15-51 href=#__codelineno-15-51></a><span class=s1>  s!^(\s*CustomLog)\s+\S+!\1 /proc/self/fd/1!g; \</span>
<a id=__codelineno-15-52 name=__codelineno-15-52 href=#__codelineno-15-52></a><span class=s1>  s!^(\s*ErrorLog)\s+\S+!\1 /proc/self/fd/2!g; \</span>
<a id=__codelineno-15-53 name=__codelineno-15-53 href=#__codelineno-15-53></a><span class=s1>  &#39;</span><span class=w> </span>/usr/local/apache2/conf/httpd.conf<span class=w> </span><span class=se>\</span>
<a id=__codelineno-15-54 name=__codelineno-15-54 href=#__codelineno-15-54></a><span class=w>  </span><span class=o>&amp;&amp;</span><span class=w> </span>apt-get<span class=w> </span>purge<span class=w> </span>-y<span class=w> </span>--auto-remove<span class=w> </span><span class=nv>$buildDeps</span>
<a id=__codelineno-15-55 name=__codelineno-15-55 href=#__codelineno-15-55></a><span class=k>COPY</span><span class=w> </span>httpd-foreground<span class=w> </span>/usr/local/bin/
<a id=__codelineno-15-56 name=__codelineno-15-56 href=#__codelineno-15-56></a><span class=k>EXPOSE</span><span class=w> </span><span class=s>80</span>
<a id=__codelineno-15-57 name=__codelineno-15-57 href=#__codelineno-15-57></a><span class=k>CMD</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;httpd-foreground&quot;</span><span class=p>]</span>
</code></pre></div> <h2 id=3dockerfile编写优化>3.Dockerfile编写优化<a class=headerlink href=#3dockerfile编写优化 title="Permanent link">&para;</a></h2> <h3 id=31-使用小的基础镜像>3.1 使用小的基础镜像<a class=headerlink href=#31-使用小的基础镜像 title="Permanent link">&para;</a></h3> <p>在上面的 Dockerfile 中基础镜像使用有FROM debian:bullseye-slim, FROM scratch</p> <ul> <li>scratch 是一个空镜像，一般用不到，在构建最基础的镜像的时候会用到。</li> <li>debian:bullseye-slim 是一个 debian 系统的 bullseye 版本的精简版镜像。看的出来，使用的镜像很小。</li> </ul> <p>使用较小的镜像可以更快地构建、推送和拉取 镜像。</p> <p>往往更安全，因为只包含运行应用程序所需的必要库和系统依赖项。</p> <p>尤其是在 CI/CD 等流水线中，庞大的 基础镜像 在每个环节都要消耗一些时间，从而使流水线的时间变得很长。</p> <p>镜像之间的区别主要在于底层的操作系统</p> <p>镜像选择类型</p> <ul> <li> <p><code>Official Image</code>：官方镜像，或者叫标准镜像，一般由官方维护的镜像，它是正确的选择，但是可能不是最优的。镜像基于最新的稳定 Debian 操作系统发行版，上面的 有 Dockerfile 构建完成的镜像即为 redis:7 的一个官网镜像。</p> </li> <li> <p><code>Debian(bullseye/buster/stretch/jessie)</code>：不同的 Debian Linux 发行版镜像，jessie(8.0)，stretch(9.0) 是比较老旧的版本,buster(10.0) ,bullseye(11.0)为较新的版本</p> </li> <li> <p><code>slim</code>：精简版，它通常会安装运行特定工具所需的最小包</p> </li> <li> <p><code>alpine</code>：基于 Alpine Linux项目，专门为在容器内部使用而构建的操作系统。相比较 Debian 来说 Alpine 很小很小，但是需要考虑一些时区，兼容性问题。</p> </li> </ul> <div class="admonition info"> <p class=admonition-title>参考文献</p> <p><a href=https://blog.frognew.com/2021/07/relearning-container-25.html>编写Dockerfile的一些实践经验</a></p> </div> <ul> <li><code>scratch</code>: 一个明确的空镜像，特别是用于建立 "从头开始" 的镜像。</li> </ul> <p>在选择最小基础镜像的同时，要尽量避免安装不必要的软件包</p> <h3 id=32-指令链式运行>3.2 指令链式运行<a class=headerlink href=#32-指令链式运行 title="Permanent link">&para;</a></h3> <p>可以很明显的发现，上面 Dockerfile 中的 RUN 指令很长</p> <p>这是由于每个指令都会创建一个可缓存单元并构建一个新的中间镜像层。 所以可以通过链接所有命令来避免过多层级。此外，尽量避免链接过多的可缓存 RUN 命令，因为这会导致创建大型缓存并最终导致缓存突发。</p> <div class=highlight><pre><span></span><code><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a><span class=k>RUN</span><span class=w> </span><span class=nb>set</span><span class=w> </span>-eux<span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a><span class=w> </span><span class=se>\</span>
<a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a><span class=w> </span><span class=nv>savedAptMark</span><span class=o>=</span><span class=s2>&quot;</span><span class=k>$(</span>apt-mark<span class=w> </span>showmanual<span class=k>)</span><span class=s2>&quot;</span><span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a><span class=w> </span>apt-get<span class=w> </span>update<span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-16-5 name=__codelineno-16-5 href=#__codelineno-16-5></a><span class=w> </span>apt-get<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>--no-install-recommends<span class=w> </span><span class=se>\</span>
<a id=__codelineno-16-6 name=__codelineno-16-6 href=#__codelineno-16-6></a><span class=w>  </span>ca-certificates<span class=w> </span><span class=se>\</span>
<a id=__codelineno-16-7 name=__codelineno-16-7 href=#__codelineno-16-7></a><span class=w>  </span>wget<span class=w> </span><span class=se>\</span>
<a id=__codelineno-16-8 name=__codelineno-16-8 href=#__codelineno-16-8></a><span class=w>  </span><span class=se>\</span>
<a id=__codelineno-16-9 name=__codelineno-16-9 href=#__codelineno-16-9></a><span class=w>  </span>dpkg-dev<span class=w> </span><span class=se>\</span>
<a id=__codelineno-16-10 name=__codelineno-16-10 href=#__codelineno-16-10></a><span class=w>  </span>gcc<span class=w> </span><span class=se>\</span>
<a id=__codelineno-16-11 name=__codelineno-16-11 href=#__codelineno-16-11></a><span class=w>  </span>libc6-dev<span class=w> </span><span class=se>\</span>
<a id=__codelineno-16-12 name=__codelineno-16-12 href=#__codelineno-16-12></a><span class=w>  </span>libssl-dev<span class=w> </span><span class=se>\</span>
<a id=__codelineno-16-13 name=__codelineno-16-13 href=#__codelineno-16-13></a><span class=w>  </span>make<span class=w> </span><span class=se>\</span>
<a id=__codelineno-16-14 name=__codelineno-16-14 href=#__codelineno-16-14></a><span class=w> </span><span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-16-15 name=__codelineno-16-15 href=#__codelineno-16-15></a><span class=w> </span>rm<span class=w> </span>-rf<span class=w> </span>/var/lib/apt/lists/*<span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-16-16 name=__codelineno-16-16 href=#__codelineno-16-16></a><span class=w> </span><span class=se>\</span>
<a id=__codelineno-16-17 name=__codelineno-16-17 href=#__codelineno-16-17></a><span class=w> </span>wget<span class=w> </span>-O<span class=w> </span>redis.tar.gz<span class=w> </span><span class=s2>&quot;</span><span class=nv>$REDIS_DOWNLOAD_URL</span><span class=s2>&quot;</span><span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-16-18 name=__codelineno-16-18 href=#__codelineno-16-18></a><span class=w>  </span>..................
</code></pre></div> <h3 id=33-变动的指令放到最后>3.3 变动的指令放到最后<a class=headerlink href=#33-变动的指令放到最后 title="Permanent link">&para;</a></h3> <p>在 RUN 之后放置 COPY 在某些情况下，您对代码进行了细微的更改，并且需要反复从 dockerfile 构建镜像。 在这种情况下，将 COPY 命令放在 RUN 命令之后将有助于减小镜像大小，因为在这种情况下 docker 将能够更好地使用缓存功能。</p> <p>它将为安装了依赖项的镜像创建缓存，每次更改代码时，docker 都会使用该缓存并创建镜像。它还将减少 docker 构建时间。</p> <p>所以 <code>始终将最常更改的指令放在末尾</code>。会提高构建速度.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a><span class=k>FROM</span><span class=w> </span><span class=s>python:3.9-slim</span>
<a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a>
<a id=__codelineno-17-3 name=__codelineno-17-3 href=#__codelineno-17-3></a><span class=k>WORKDIR</span><span class=w> </span><span class=s>/app</span>
<a id=__codelineno-17-4 name=__codelineno-17-4 href=#__codelineno-17-4></a><span class=k>COPY</span><span class=w> </span>requirements.txt<span class=w> </span>.
<a id=__codelineno-17-5 name=__codelineno-17-5 href=#__codelineno-17-5></a><span class=k>RUN</span><span class=w> </span>pip<span class=w> </span>install<span class=w> </span>-r<span class=w> </span>/requirements.txt
<a id=__codelineno-17-6 name=__codelineno-17-6 href=#__codelineno-17-6></a><span class=k>COPY</span><span class=w> </span>app.py<span class=w> </span>.
</code></pre></div> <div class=highlight><pre><span></span><code><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a><span class=k>FROM</span><span class=w> </span><span class=s>ubuntu:latest</span>
<a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a><span class=k>RUN</span><span class=w> </span>apt<span class=w> </span>update<span class=w> </span>-y<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-18-3 name=__codelineno-18-3 href=#__codelineno-18-3></a>apt<span class=w> </span>install<span class=w> </span>unzip<span class=w> </span>-y<span class=w> </span>--no-install-recommends<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-18-4 name=__codelineno-18-4 href=#__codelineno-18-4></a>apt<span class=w> </span>install<span class=w> </span>curl<span class=w> </span>--no-install-recommends<span class=w> </span>-y<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-18-5 name=__codelineno-18-5 href=#__codelineno-18-5></a>apt<span class=w> </span>install<span class=w> </span>python3<span class=w> </span>-y<span class=w> </span>--no-install-recommends<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-18-6 name=__codelineno-18-6 href=#__codelineno-18-6></a>rm<span class=w> </span>-rf<span class=w> </span>/var/lib/apt/lists/*
<a id=__codelineno-18-7 name=__codelineno-18-7 href=#__codelineno-18-7></a><span class=k>COPY</span><span class=w> </span>file<span class=w> </span>/home/ubuntu
</code></pre></div> <h3 id=34-首选数组而不是字符串语法>3.4 首选数组而不是字符串语法<a class=headerlink href=#34-首选数组而不是字符串语法 title="Permanent link">&para;</a></h3> <p>我们可以通过两种不同的方式编写 最后的进程启动 命令 ENTRYPOINT</p> <p>数组：<code>ENTRYPOINT ["python","-m","http.server","33333"]</code> 字符串：<code>ENTRYPOINT "python -m http.server 33333"</code></p> <p>数组形式是首选。 这是因为使用字符串形式会导致 Docker 使用 bash 运行您的进程，这无法正确处理信号。 由于大多数 shell 不处理子进程的信号，因此如果使用 shell 格式，CTRL-C（生成 SIGTERM）可能不会停止子进程。</p> <h3 id=35-copy而不是add>3.5 COPY而不是ADD<a class=headerlink href=#35-copy而不是add title="Permanent link">&para;</a></h3> <p>如果有多个步骤使用上下文中的不同文件，请 单独复制 它们，而不是一次全部复制。</p> <p>这可确保每个步骤的生成缓存仅失效，并在特别需要的文件发生更改时强制重新运行该步骤。</p> <div class=highlight><pre><span></span><code><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a><span class=k>COPY</span><span class=w> </span>requirements.txt<span class=w> </span>/tmp/
<a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a><span class=k>RUN</span><span class=w> </span>pip<span class=w> </span>install<span class=w> </span>--requirement<span class=w> </span>/tmp/requirements.txt
<a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a><span class=k>COPY</span><span class=w> </span>.<span class=w> </span>/tmp/
</code></pre></div> <div class="admonition warning"> <p class=admonition-title>拷贝目录的一个坑</p> <p>拷贝文件不需要写目标 <div class=highlight><pre><span></span><code><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a><span class=c># 拷贝文件</span>
<a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a><span class=k>FROM</span><span class=w> </span><span class=s>centos</span>
<a id=__codelineno-20-3 name=__codelineno-20-3 href=#__codelineno-20-3></a><span class=k>COPY</span><span class=w> </span><span class=m>2</span>.txt<span class=w> </span>/usr/local/
</code></pre></div></p> <p>拷贝目录则需要这样写,目标,不然拷贝不进去</p> <div class=highlight><pre><span></span><code><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a><span class=c># 拷贝目录</span>
<a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a><span class=k>FROM</span><span class=w> </span><span class=s>centos</span>
<a id=__codelineno-21-3 name=__codelineno-21-3 href=#__codelineno-21-3></a><span class=k>COPY</span><span class=w> </span>mysql<span class=w> </span>/usr/local/mysql
</code></pre></div> </div> <h3 id=36-使用dockerignore>3.6 使用.dockerignore<a class=headerlink href=#36-使用dockerignore title="Permanent link">&para;</a></h3> <p><code>.dockerignore</code>文件的作用类似于git工程中的 .gitignore 。不同的是 .dockerignore 应用于 docker 镜像的构建，它存在于 docker 构建上下文的根目录，用来忽略不需要打入镜像的文件</p> <p><code>.dockerignore</code>文件的写法和 .gitignore 类似，支持正则和通配符，具体规则如下：</p> <ul> <li>每行为一个条目；</li> <li>以 # 开头的行为注释；</li> <li>空行被忽略；</li> <li>构建上下文路径为所有文件的根路径；</li> </ul> <div class=highlight><pre><span></span><code><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a>.git
<a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a>script
<a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a>static
<a id=__codelineno-22-4 name=__codelineno-22-4 href=#__codelineno-22-4></a>!README*.md
</code></pre></div> <h3 id=37-利用多阶段构建>3.7 利用多阶段构建<a class=headerlink href=#37-利用多阶段构建 title="Permanent link">&para;</a></h3> <p>多阶段构建可以让我们大幅度减小最终的镜像大小，而不需要去想办法减少中间层和文件的数量。因为镜像是在生成过程的最后阶段生成的，所以可以利用生成缓存来最小化镜像层。</p> <p>例如，如果你的构建包含多个层，则可以将它们从变化频率较低（以确保生成缓存可重用）到变化频率较高的顺序排序：</p> <ul> <li>安装构建应用程序所需的依赖工具</li> <li>安装或更新依赖项</li> <li>构建你的应用</li> </ul> <p>比如我们构建一个 Go 应用程序的 Dockerfile 可能类似于这样：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a><span class=k>FROM</span><span class=w> </span><span class=s>golang:1.11-alpine</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=s>build</span>
<a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a>
<a id=__codelineno-23-3 name=__codelineno-23-3 href=#__codelineno-23-3></a><span class=c># 安装项目需要的工具</span>
<a id=__codelineno-23-4 name=__codelineno-23-4 href=#__codelineno-23-4></a><span class=c># 运行 `docker build --no-cache .` 来更新依赖</span>
<a id=__codelineno-23-5 name=__codelineno-23-5 href=#__codelineno-23-5></a><span class=k>RUN</span><span class=w> </span>apk<span class=w> </span>add<span class=w> </span>--no-cache<span class=w> </span>git
<a id=__codelineno-23-6 name=__codelineno-23-6 href=#__codelineno-23-6></a><span class=k>RUN</span><span class=w> </span>go<span class=w> </span>get<span class=w> </span>github.com/golang/dep/cmd/dep
<a id=__codelineno-23-7 name=__codelineno-23-7 href=#__codelineno-23-7></a>
<a id=__codelineno-23-8 name=__codelineno-23-8 href=#__codelineno-23-8></a><span class=c># 通过 Gopkg.toml 和 Gopkg.lock 获取项目的依赖</span>
<a id=__codelineno-23-9 name=__codelineno-23-9 href=#__codelineno-23-9></a><span class=c># 仅在更新 Gopkg 文件时才重新构建这些层</span>
<a id=__codelineno-23-10 name=__codelineno-23-10 href=#__codelineno-23-10></a><span class=k>COPY</span><span class=w> </span>Gopkg.lock<span class=w> </span>Gopkg.toml<span class=w> </span>/go/src/project/
<a id=__codelineno-23-11 name=__codelineno-23-11 href=#__codelineno-23-11></a><span class=k>WORKDIR</span><span class=w> </span><span class=s>/go/src/project/</span>
<a id=__codelineno-23-12 name=__codelineno-23-12 href=#__codelineno-23-12></a><span class=c># 安装依赖库</span>
<a id=__codelineno-23-13 name=__codelineno-23-13 href=#__codelineno-23-13></a><span class=k>RUN</span><span class=w> </span>dep<span class=w> </span>ensure<span class=w> </span>-vendor-only
<a id=__codelineno-23-14 name=__codelineno-23-14 href=#__codelineno-23-14></a>
<a id=__codelineno-23-15 name=__codelineno-23-15 href=#__codelineno-23-15></a><span class=c># 拷贝整个项目进行构建</span>
<a id=__codelineno-23-16 name=__codelineno-23-16 href=#__codelineno-23-16></a><span class=c># 当项目下面有文件变化的时候该层才会重新构建</span>
<a id=__codelineno-23-17 name=__codelineno-23-17 href=#__codelineno-23-17></a><span class=k>COPY</span><span class=w> </span>.<span class=w> </span>/go/src/project/
<a id=__codelineno-23-18 name=__codelineno-23-18 href=#__codelineno-23-18></a><span class=k>RUN</span><span class=w> </span>go<span class=w> </span>build<span class=w> </span>-o<span class=w> </span>/bin/project
<a id=__codelineno-23-19 name=__codelineno-23-19 href=#__codelineno-23-19></a>
<a id=__codelineno-23-20 name=__codelineno-23-20 href=#__codelineno-23-20></a><span class=c># 将打包后的二进制文件拷贝到 scratch 镜像下面，将镜像大小降到最低</span>
<a id=__codelineno-23-21 name=__codelineno-23-21 href=#__codelineno-23-21></a><span class=k>FROM</span><span class=w> </span><span class=s>scratch</span>
<a id=__codelineno-23-22 name=__codelineno-23-22 href=#__codelineno-23-22></a><span class=k>COPY</span><span class=w> </span>--from<span class=o>=</span>build<span class=w> </span>/bin/project<span class=w> </span>/bin/project
<a id=__codelineno-23-23 name=__codelineno-23-23 href=#__codelineno-23-23></a><span class=k>ENTRYPOINT</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;/bin/project&quot;</span><span class=p>]</span>
<a id=__codelineno-23-24 name=__codelineno-23-24 href=#__codelineno-23-24></a><span class=k>CMD</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;--help&quot;</span><span class=p>]</span>
</code></pre></div> <p>其他示例Dockerfile</p> <div class=highlight><pre><span></span><code><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a><span class=c># 构建：使用golang:1.13版本</span>
<a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a><span class=k>FROM</span><span class=w> </span><span class=s>golang:1.13</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=s>build</span>
<a id=__codelineno-24-3 name=__codelineno-24-3 href=#__codelineno-24-3></a>
<a id=__codelineno-24-4 name=__codelineno-24-4 href=#__codelineno-24-4></a><span class=c># 容器环境变量添加，会覆盖默认的变量值</span>
<a id=__codelineno-24-5 name=__codelineno-24-5 href=#__codelineno-24-5></a><span class=k>ENV</span><span class=w> </span><span class=nv>GO111MODULE</span><span class=o>=</span>on
<a id=__codelineno-24-6 name=__codelineno-24-6 href=#__codelineno-24-6></a><span class=k>ENV</span><span class=w> </span><span class=nv>GOPROXY</span><span class=o>=</span>https://goproxy.cn,direct
<a id=__codelineno-24-7 name=__codelineno-24-7 href=#__codelineno-24-7></a>
<a id=__codelineno-24-8 name=__codelineno-24-8 href=#__codelineno-24-8></a><span class=c># 设置工作区</span>
<a id=__codelineno-24-9 name=__codelineno-24-9 href=#__codelineno-24-9></a><span class=k>WORKDIR</span><span class=w> </span><span class=s>/go/release</span>
<a id=__codelineno-24-10 name=__codelineno-24-10 href=#__codelineno-24-10></a>
<a id=__codelineno-24-11 name=__codelineno-24-11 href=#__codelineno-24-11></a><span class=c># 把全部文件添加到/go/release目录</span>
<a id=__codelineno-24-12 name=__codelineno-24-12 href=#__codelineno-24-12></a><span class=k>ADD</span><span class=w> </span>.<span class=w> </span>.
<a id=__codelineno-24-13 name=__codelineno-24-13 href=#__codelineno-24-13></a>
<a id=__codelineno-24-14 name=__codelineno-24-14 href=#__codelineno-24-14></a><span class=c># 编译：把cmd/main.go编译成可执行的二进制文件，命名为app</span>
<a id=__codelineno-24-15 name=__codelineno-24-15 href=#__codelineno-24-15></a><span class=k>RUN</span><span class=w> </span><span class=nv>GOOS</span><span class=o>=</span>linux<span class=w> </span><span class=nv>CGO_ENABLED</span><span class=o>=</span><span class=m>0</span><span class=w> </span><span class=nv>GOARCH</span><span class=o>=</span>amd64<span class=w> </span>go<span class=w> </span>build<span class=w> </span>-ldflags<span class=o>=</span><span class=s2>&quot;-s -w&quot;</span><span class=w> </span>-installsuffix<span class=w> </span>cgo<span class=w> </span>-o<span class=w> </span>app<span class=w> </span>cmd/main.go
<a id=__codelineno-24-16 name=__codelineno-24-16 href=#__codelineno-24-16></a>
<a id=__codelineno-24-17 name=__codelineno-24-17 href=#__codelineno-24-17></a><span class=c># 运行：使用scratch作为基础镜像</span>
<a id=__codelineno-24-18 name=__codelineno-24-18 href=#__codelineno-24-18></a><span class=k>FROM</span><span class=w> </span><span class=s>scratch</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=s>prod</span>
<a id=__codelineno-24-19 name=__codelineno-24-19 href=#__codelineno-24-19></a>
<a id=__codelineno-24-20 name=__codelineno-24-20 href=#__codelineno-24-20></a><span class=c># 在build阶段复制时区到</span>
<a id=__codelineno-24-21 name=__codelineno-24-21 href=#__codelineno-24-21></a><span class=k>COPY</span><span class=w> </span>--from<span class=o>=</span>build<span class=w> </span>/usr/share/zoneinfo/Asia/Shanghai<span class=w> </span>/etc/localtime
<a id=__codelineno-24-22 name=__codelineno-24-22 href=#__codelineno-24-22></a><span class=c># 在build阶段复制可执行的go二进制文件app</span>
<a id=__codelineno-24-23 name=__codelineno-24-23 href=#__codelineno-24-23></a><span class=k>COPY</span><span class=w> </span>--from<span class=o>=</span>build<span class=w> </span>/go/release/app<span class=w> </span>/
<a id=__codelineno-24-24 name=__codelineno-24-24 href=#__codelineno-24-24></a><span class=c># 在build阶段复制配置文件</span>
<a id=__codelineno-24-25 name=__codelineno-24-25 href=#__codelineno-24-25></a><span class=k>COPY</span><span class=w> </span>--from<span class=o>=</span>build<span class=w> </span>/go/release/config<span class=w> </span>./config
<a id=__codelineno-24-26 name=__codelineno-24-26 href=#__codelineno-24-26></a>
<a id=__codelineno-24-27 name=__codelineno-24-27 href=#__codelineno-24-27></a><span class=c># 启动服务</span>
<a id=__codelineno-24-28 name=__codelineno-24-28 href=#__codelineno-24-28></a><span class=k>CMD</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;/app&quot;</span><span class=p>]</span>
</code></pre></div> <p>可以使用多个语句。每个指令都可以使用不同的基础，并且每个指令都开始构建的新阶段。</p> <p>我们可以有选择地将伪影从一个阶段复制到另一个阶段，在最终镜像中留下我们不想要的所有内容。 <div class=highlight><pre><span></span><code><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a>#syntax=docker/dockerfile:1.4
<a id=__codelineno-25-2 name=__codelineno-25-2 href=#__codelineno-25-2></a>FROM … AS build1
<a id=__codelineno-25-3 name=__codelineno-25-3 href=#__codelineno-25-3></a>COPY –from=app1 . /src
<a id=__codelineno-25-4 name=__codelineno-25-4 href=#__codelineno-25-4></a>
<a id=__codelineno-25-5 name=__codelineno-25-5 href=#__codelineno-25-5></a>FROM … AS build2
<a id=__codelineno-25-6 name=__codelineno-25-6 href=#__codelineno-25-6></a>COPY –from=app2 . /src
<a id=__codelineno-25-7 name=__codelineno-25-7 href=#__codelineno-25-7></a>
<a id=__codelineno-25-8 name=__codelineno-25-8 href=#__codelineno-25-8></a>FROM …
<a id=__codelineno-25-9 name=__codelineno-25-9 href=#__codelineno-25-9></a>COPY --from=build1 /out/app1 /bin/
<a id=__codelineno-25-10 name=__codelineno-25-10 href=#__codelineno-25-10></a>COPY –-from=build2 /out/app2 /bin/
</code></pre></div></p> <div class="admonition info"> <p class=admonition-title>参考文献</p> <p><a href=https://www.cnblogs.com/FireworksEasyCool/p/12838875.html>多阶段构建Golang程序Docker镜像</a></p> </div> <div class=highlight><pre><span></span><code><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a><span class=c># Official docker build image, Using  node:14.17-alpine3.14 image for stage-1.</span>
<a id=__codelineno-26-2 name=__codelineno-26-2 href=#__codelineno-26-2></a><span class=c># Stage-1</span>
<a id=__codelineno-26-3 name=__codelineno-26-3 href=#__codelineno-26-3></a><span class=k>FROM</span><span class=w> </span><span class=s>node:14.17-alpine3.14</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=s>build</span>
<a id=__codelineno-26-4 name=__codelineno-26-4 href=#__codelineno-26-4></a><span class=c># Copy Required files</span>
<a id=__codelineno-26-5 name=__codelineno-26-5 href=#__codelineno-26-5></a><span class=k>COPY</span><span class=w> </span>public<span class=w> </span>/home/app/public/
<a id=__codelineno-26-6 name=__codelineno-26-6 href=#__codelineno-26-6></a><span class=k>COPY</span><span class=w> </span>src<span class=w> </span>/home/app/src/
<a id=__codelineno-26-7 name=__codelineno-26-7 href=#__codelineno-26-7></a><span class=c># dockerfile install multiple packages</span>
<a id=__codelineno-26-8 name=__codelineno-26-8 href=#__codelineno-26-8></a><span class=k>RUN</span><span class=w> </span>apk<span class=w> </span>add<span class=w> </span>g++<span class=w> </span>make<span class=w> </span>python2
<a id=__codelineno-26-9 name=__codelineno-26-9 href=#__codelineno-26-9></a><span class=k>RUN</span><span class=w> </span>npm<span class=w> </span>install<span class=w> </span>--silent
<a id=__codelineno-26-10 name=__codelineno-26-10 href=#__codelineno-26-10></a><span class=c># Create Build</span>
<a id=__codelineno-26-11 name=__codelineno-26-11 href=#__codelineno-26-11></a><span class=k>RUN</span><span class=w> </span>npm<span class=w> </span>run<span class=w> </span>build
<a id=__codelineno-26-12 name=__codelineno-26-12 href=#__codelineno-26-12></a><span class=k>RUN</span><span class=w> </span>apk<span class=w> </span>--purge<span class=w> </span>del<span class=w> </span>python2
<a id=__codelineno-26-13 name=__codelineno-26-13 href=#__codelineno-26-13></a><span class=c>#Run the build by copying the files form previous stage.</span>
<a id=__codelineno-26-14 name=__codelineno-26-14 href=#__codelineno-26-14></a><span class=c># Stage-2</span>
<a id=__codelineno-26-15 name=__codelineno-26-15 href=#__codelineno-26-15></a><span class=k>FROM</span><span class=w> </span><span class=s>nginx:stable-alpine</span>
<a id=__codelineno-26-16 name=__codelineno-26-16 href=#__codelineno-26-16></a><span class=k>COPY</span><span class=w> </span>nginx.conf<span class=w> </span>/etc/nginx/conf.d/default.conf
<a id=__codelineno-26-17 name=__codelineno-26-17 href=#__codelineno-26-17></a><span class=k>COPY</span><span class=w> </span>--from<span class=o>=</span>build<span class=w> </span>/home/app/build<span class=w> </span>/usr/share/nginx/html
<a id=__codelineno-26-18 name=__codelineno-26-18 href=#__codelineno-26-18></a><span class=k>EXPOSE</span><span class=w> </span><span class=s>80</span>
<a id=__codelineno-26-19 name=__codelineno-26-19 href=#__codelineno-26-19></a><span class=k>CMD</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;nginx&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;-g&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;daemon off;&quot;</span><span class=p>]</span>
</code></pre></div> <h3 id=38-写dockerfile的一些技巧>3.8 写Dockerfile的一些技巧<a class=headerlink href=#38-写dockerfile的一些技巧 title="Permanent link">&para;</a></h3> <h4 id=1用-python--m-pip-而不是-pip>1.用 python -m pip 而不是 pip<a class=headerlink href=#1用-python--m-pip-而不是-pip title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a><span class=c1># 升级 pip,让 pip install 更安静,--quiet 参数</span>
<a id=__codelineno-27-2 name=__codelineno-27-2 href=#__codelineno-27-2></a>$<span class=w> </span>python<span class=w> </span>-m<span class=w> </span>pip<span class=w> </span>install<span class=w> </span>--quiet<span class=w> </span>--upgrade<span class=w> </span>pip
<a id=__codelineno-27-3 name=__codelineno-27-3 href=#__codelineno-27-3></a>
<a id=__codelineno-27-4 name=__codelineno-27-4 href=#__codelineno-27-4></a><span class=c1># pip使用国内源</span>
<a id=__codelineno-27-5 name=__codelineno-27-5 href=#__codelineno-27-5></a>$<span class=w> </span>python<span class=w> </span>-m<span class=w> </span>pip<span class=w> </span>install<span class=w> </span>--quiet<span class=w> </span>--upgrade<span class=w> </span>pip<span class=w> </span><span class=se>\</span>
<a id=__codelineno-27-6 name=__codelineno-27-6 href=#__codelineno-27-6></a><span class=o>&amp;&amp;</span><span class=w> </span>pip<span class=w> </span>install<span class=w> </span>-i<span class=w> </span>https://pypi.tuna.tsinghua.edu.cn/simple<span class=w> </span>--no-cache-dir<span class=w> </span>-r<span class=w> </span>requirements.txt
</code></pre></div> <h4 id=2让-apt-get-install-更安静>2.让 apt-get install 更安静<a class=headerlink href=#2让-apt-get-install-更安静 title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a><span class=c1>#我们用 -qq 命令，甚至重定向输出到 /dev/null 让它更安静。</span>
<a id=__codelineno-28-2 name=__codelineno-28-2 href=#__codelineno-28-2></a>$<span class=w> </span>apt-get<span class=w> </span>-qq<span class=w> </span>update
<a id=__codelineno-28-3 name=__codelineno-28-3 href=#__codelineno-28-3></a>$<span class=w> </span>apt-get<span class=w> </span>-qq<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>curl<span class=w> </span>&gt;<span class=w> </span>/dev/null
</code></pre></div> <h4 id=3让-curl-和-wget-更安静>3.让 curl 和 wget 更安静<a class=headerlink href=#3让-curl-和-wget-更安静 title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><a id=__codelineno-29-1 name=__codelineno-29-1 href=#__codelineno-29-1></a><span class=c1># 首先，如果要下载文件，curl 和 wget 二选一即可。如果用 curl，可以用 --silent 参数。</span>
<a id=__codelineno-29-2 name=__codelineno-29-2 href=#__codelineno-29-2></a>$<span class=w> </span>curl<span class=w> </span>-sLO<span class=w> </span>https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64
<a id=__codelineno-29-3 name=__codelineno-29-3 href=#__codelineno-29-3></a>
<a id=__codelineno-29-4 name=__codelineno-29-4 href=#__codelineno-29-4></a><span class=c1>#wget 有 --quiet 参数。</span>
<a id=__codelineno-29-5 name=__codelineno-29-5 href=#__codelineno-29-5></a>$<span class=w> </span>wget<span class=w> </span>-q<span class=w> </span>https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64
</code></pre></div> <h4 id=4用axel而不是curl或者wget>4.用axel而不是curl或者wget<a class=headerlink href=#4用axel而不是curl或者wget title="Permanent link">&para;</a></h4> <p>对于身处国内的开发者，axel 完全可以取代 curl 以及 wget <div class=highlight><pre><span></span><code><a id=__codelineno-30-1 name=__codelineno-30-1 href=#__codelineno-30-1></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Install Go compiler ...&quot;</span>
<a id=__codelineno-30-2 name=__codelineno-30-2 href=#__codelineno-30-2></a>
<a id=__codelineno-30-3 name=__codelineno-30-3 href=#__codelineno-30-3></a><span class=nv>GO_MIRROR_0</span><span class=o>=</span><span class=s2>&quot;http://mirrors.ustc.edu.cn/golang/go1.13.4.linux-amd64.tar.gz&quot;</span>
<a id=__codelineno-30-4 name=__codelineno-30-4 href=#__codelineno-30-4></a>
<a id=__codelineno-30-5 name=__codelineno-30-5 href=#__codelineno-30-5></a><span class=nv>GO_MIRROR_1</span><span class=o>=</span><span class=s2>&quot;https://dl.google.com/go/go1.13.4.linux-amd64.tar.gz&quot;</span>
<a id=__codelineno-30-6 name=__codelineno-30-6 href=#__codelineno-30-6></a>
<a id=__codelineno-30-7 name=__codelineno-30-7 href=#__codelineno-30-7></a>axel<span class=w> </span>--quiet<span class=w> </span>--output<span class=w> </span>go.tar.gz<span class=w> </span><span class=nv>$GO_MIRROR_0</span><span class=w> </span><span class=nv>$GO_MIRROR_1</span>
</code></pre></div></p> <h4 id=5设置容器时间同步>5.设置容器时间同步<a class=headerlink href=#5设置容器时间同步 title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><a id=__codelineno-31-1 name=__codelineno-31-1 href=#__codelineno-31-1></a><span class=c1>#设置容器时间与宿主机时间同步</span>
<a id=__codelineno-31-2 name=__codelineno-31-2 href=#__codelineno-31-2></a>RUN<span class=w> </span>/bin/cp<span class=w> </span>/usr/share/zoneinfo/Asia/Shanghai<span class=w> </span>/etc/localtime<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s1>&#39;Asia/Shanghai&#39;</span><span class=w> </span>&gt;/etc/timezone
</code></pre></div> <p>Dockerfile中配置时区 <div class=highlight><pre><span></span><code><a id=__codelineno-32-1 name=__codelineno-32-1 href=#__codelineno-32-1></a><span class="l l-Scalar l-Scalar-Plain">FROM docker.io/centos</span>
<a id=__codelineno-32-2 name=__codelineno-32-2 href=#__codelineno-32-2></a><span class="l l-Scalar l-Scalar-Plain">MAINTAINER DAVID</span>
<a id=__codelineno-32-3 name=__codelineno-32-3 href=#__codelineno-32-3></a>
<a id=__codelineno-32-4 name=__codelineno-32-4 href=#__codelineno-32-4></a><span class="l l-Scalar l-Scalar-Plain"># 使用RUN命令设置时区</span>
<a id=__codelineno-32-5 name=__codelineno-32-5 href=#__codelineno-32-5></a><span class="l l-Scalar l-Scalar-Plain">RUN cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime &amp;&amp; echo &#39;Asia/Shanghai&#39;&gt;/etc/timezone</span>
</code></pre></div></p> <p>docker-compose.yaml设置时区</p> <div class=highlight><pre><span></span><code><a id=__codelineno-33-1 name=__codelineno-33-1 href=#__codelineno-33-1></a><span class="l l-Scalar l-Scalar-Plain">方式一：</span>
<a id=__codelineno-33-2 name=__codelineno-33-2 href=#__codelineno-33-2></a><span class="l l-Scalar l-Scalar-Plain">environment</span><span class="p p-Indicator">:</span>
<a id=__codelineno-33-3 name=__codelineno-33-3 href=#__codelineno-33-3></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">SET_CONTAINER_TIMEZONE=true</span>
<a id=__codelineno-33-4 name=__codelineno-33-4 href=#__codelineno-33-4></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">CONTAINER_TIMEZONE=Asia/Shanghai</span>
</code></pre></div> <div class=highlight><pre><span></span><code><a id=__codelineno-34-1 name=__codelineno-34-1 href=#__codelineno-34-1></a><span class="l l-Scalar l-Scalar-Plain">方式二：</span>
<a id=__codelineno-34-2 name=__codelineno-34-2 href=#__codelineno-34-2></a><span class="l l-Scalar l-Scalar-Plain">environment</span><span class="p p-Indicator">:</span>
<a id=__codelineno-34-3 name=__codelineno-34-3 href=#__codelineno-34-3></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">TZ=Asia/Shanghai</span>
</code></pre></div> <div class="admonition example"> <p class=admonition-title>写 Dockerfile 的一些技巧</p> <p><a href=https://zhuanlan.zhihu.com/p/147995194>https://zhuanlan.zhihu.com/p/147995194</a></p> </div> <h3 id=39-dockerfile镜像创建>3.9 dockerfile镜像创建<a class=headerlink href=#39-dockerfile镜像创建 title="Permanent link">&para;</a></h3> <h4 id=1创建镜像>1.创建镜像<a class=headerlink href=#1创建镜像 title="Permanent link">&para;</a></h4> <blockquote> <p>通过Dockerfile创建docker镜像 </p> </blockquote> <div class=highlight><pre><span></span><code><a id=__codelineno-35-1 name=__codelineno-35-1 href=#__codelineno-35-1></a>docker<span class=w> </span>build<span class=w> </span><span class=o>[</span>OPTIONS<span class=o>]</span><span class=w> </span>PATH<span class=w> </span><span class=p>|</span><span class=w> </span>URL<span class=w> </span><span class=p>|</span><span class=w> </span>-
</code></pre></div> <div class=highlight><pre><span></span><code><a id=__codelineno-36-1 name=__codelineno-36-1 href=#__codelineno-36-1></a>--build-arg=[] :设置镜像创建时的变量；
<a id=__codelineno-36-2 name=__codelineno-36-2 href=#__codelineno-36-2></a>--cpu-shares :设置 cpu 使用权重；
<a id=__codelineno-36-3 name=__codelineno-36-3 href=#__codelineno-36-3></a>--cpu-period :限制 CPU CFS周期；
<a id=__codelineno-36-4 name=__codelineno-36-4 href=#__codelineno-36-4></a>--cpu-quota :限制 CPU CFS配额；
<a id=__codelineno-36-5 name=__codelineno-36-5 href=#__codelineno-36-5></a>--cpuset-cpus :指定使用的CPU id；
<a id=__codelineno-36-6 name=__codelineno-36-6 href=#__codelineno-36-6></a>--cpuset-mems :指定使用的内存 id；
<a id=__codelineno-36-7 name=__codelineno-36-7 href=#__codelineno-36-7></a>--disable-content-trust :忽略校验，默认开启；
<a id=__codelineno-36-8 name=__codelineno-36-8 href=#__codelineno-36-8></a>-f :指定要使用的Dockerfile路径；
<a id=__codelineno-36-9 name=__codelineno-36-9 href=#__codelineno-36-9></a>--force-rm :设置镜像过程中删除中间容器；
<a id=__codelineno-36-10 name=__codelineno-36-10 href=#__codelineno-36-10></a>--isolation :使用容器隔离技术；
<a id=__codelineno-36-11 name=__codelineno-36-11 href=#__codelineno-36-11></a>--label=[] :设置镜像使用的元数据；
<a id=__codelineno-36-12 name=__codelineno-36-12 href=#__codelineno-36-12></a>-m :设置内存最大值；
<a id=__codelineno-36-13 name=__codelineno-36-13 href=#__codelineno-36-13></a>--memory-swap :设置Swap的最大值为内存+swap，&quot;-1&quot;表示不限swap；
<a id=__codelineno-36-14 name=__codelineno-36-14 href=#__codelineno-36-14></a>--no-cache :创建镜像的过程不使用缓存；
<a id=__codelineno-36-15 name=__codelineno-36-15 href=#__codelineno-36-15></a>--pull :尝试去更新镜像的新版本；
<a id=__codelineno-36-16 name=__codelineno-36-16 href=#__codelineno-36-16></a>--quiet, -q :安静模式，成功后只输出镜像 ID；
<a id=__codelineno-36-17 name=__codelineno-36-17 href=#__codelineno-36-17></a>--rm :设置镜像成功后删除中间容器；
<a id=__codelineno-36-18 name=__codelineno-36-18 href=#__codelineno-36-18></a>--shm-size :设置/dev/shm的大小，默认值是64M；
<a id=__codelineno-36-19 name=__codelineno-36-19 href=#__codelineno-36-19></a>--ulimit :Ulimit配置。
<a id=__codelineno-36-20 name=__codelineno-36-20 href=#__codelineno-36-20></a>--tag, -t: 镜像的名字及标签，通常 name:tag 或者 name 格式；可以在一次构建中为一个镜像设置多个标签。
<a id=__codelineno-36-21 name=__codelineno-36-21 href=#__codelineno-36-21></a>--network: 默认 default。在构建期间设置RUN指令的网络模式
</code></pre></div> <ul> <li>dockerfile-django</li> </ul> <div class=highlight><pre><span></span><code><a id=__codelineno-37-1 name=__codelineno-37-1 href=#__codelineno-37-1></a><span class="l l-Scalar l-Scalar-Plain">FROM python:3.4</span>
<a id=__codelineno-37-2 name=__codelineno-37-2 href=#__codelineno-37-2></a>
<a id=__codelineno-37-3 name=__codelineno-37-3 href=#__codelineno-37-3></a><span class="l l-Scalar l-Scalar-Plain">RUN apt-get update \</span>
<a id=__codelineno-37-4 name=__codelineno-37-4 href=#__codelineno-37-4></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">&amp;&amp; apt-get install -y --no-install-recommends \</span>
<a id=__codelineno-37-5 name=__codelineno-37-5 href=#__codelineno-37-5></a><span class=w>        </span><span class="l l-Scalar l-Scalar-Plain">postgresql-client \</span>
<a id=__codelineno-37-6 name=__codelineno-37-6 href=#__codelineno-37-6></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">&amp;&amp; rm -rf /var/lib/apt/lists/*</span>
<a id=__codelineno-37-7 name=__codelineno-37-7 href=#__codelineno-37-7></a>
<a id=__codelineno-37-8 name=__codelineno-37-8 href=#__codelineno-37-8></a><span class="l l-Scalar l-Scalar-Plain">WORKDIR /usr/src/app</span>
<a id=__codelineno-37-9 name=__codelineno-37-9 href=#__codelineno-37-9></a><span class="l l-Scalar l-Scalar-Plain">COPY requirements.txt ./</span>
<a id=__codelineno-37-10 name=__codelineno-37-10 href=#__codelineno-37-10></a><span class="l l-Scalar l-Scalar-Plain">RUN pip install -r requirements.txt</span>
<a id=__codelineno-37-11 name=__codelineno-37-11 href=#__codelineno-37-11></a><span class="l l-Scalar l-Scalar-Plain">COPY . .</span>
<a id=__codelineno-37-12 name=__codelineno-37-12 href=#__codelineno-37-12></a>
<a id=__codelineno-37-13 name=__codelineno-37-13 href=#__codelineno-37-13></a><span class="l l-Scalar l-Scalar-Plain">EXPOSE 8000</span>
<a id=__codelineno-37-14 name=__codelineno-37-14 href=#__codelineno-37-14></a><span class="l l-Scalar l-Scalar-Plain">CMD [&quot;python&quot;, &quot;manage.py&quot;, &quot;runserver&quot;, &quot;0.0.0.0:8000&quot;]</span>
</code></pre></div> <ul> <li>通过dockerfile创建镜像 <div class=highlight><pre><span></span><code><a id=__codelineno-38-1 name=__codelineno-38-1 href=#__codelineno-38-1></a>docker<span class=w> </span>build<span class=w> </span>-t<span class=w> </span>python:3.5<span class=w> </span>.
</code></pre></div></li> </ul> <h3 id=310-dockerfile参考>3.10 dockerfile参考<a class=headerlink href=#310-dockerfile参考 title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-39-1 name=__codelineno-39-1 href=#__codelineno-39-1></a><span class="l l-Scalar l-Scalar-Plain">FROM buildpack-deps:jessie</span>
<a id=__codelineno-39-2 name=__codelineno-39-2 href=#__codelineno-39-2></a>
<a id=__codelineno-39-3 name=__codelineno-39-3 href=#__codelineno-39-3></a><span class="l l-Scalar l-Scalar-Plain"># remove several traces of debian python</span>
<a id=__codelineno-39-4 name=__codelineno-39-4 href=#__codelineno-39-4></a><span class="l l-Scalar l-Scalar-Plain">RUN apt-get purge -y python.*</span>
<a id=__codelineno-39-5 name=__codelineno-39-5 href=#__codelineno-39-5></a>
<a id=__codelineno-39-6 name=__codelineno-39-6 href=#__codelineno-39-6></a><span class="l l-Scalar l-Scalar-Plain"># http://bugs.python.org/issue19846</span>
<a id=__codelineno-39-7 name=__codelineno-39-7 href=#__codelineno-39-7></a><span class="l l-Scalar l-Scalar-Plain"># &gt; At the moment, setting &quot;LANG=C&quot; on a Linux system *fundamentally breaks Python 3*, and that&#39;s not OK.</span>
<a id=__codelineno-39-8 name=__codelineno-39-8 href=#__codelineno-39-8></a><span class="l l-Scalar l-Scalar-Plain">ENV LANG C.UTF-8</span>
<a id=__codelineno-39-9 name=__codelineno-39-9 href=#__codelineno-39-9></a>
<a id=__codelineno-39-10 name=__codelineno-39-10 href=#__codelineno-39-10></a><span class="l l-Scalar l-Scalar-Plain"># gpg</span><span class=nt>: key F73C700D</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">public key &quot;Larry Hastings &lt;larry@hastings.org&gt;&quot; imported</span>
<a id=__codelineno-39-11 name=__codelineno-39-11 href=#__codelineno-39-11></a><span class="l l-Scalar l-Scalar-Plain">ENV GPG_KEY 97FC712E4C024BBEA48A61ED3A5CA953F73C700D</span>
<a id=__codelineno-39-12 name=__codelineno-39-12 href=#__codelineno-39-12></a>
<a id=__codelineno-39-13 name=__codelineno-39-13 href=#__codelineno-39-13></a><span class="l l-Scalar l-Scalar-Plain">ENV PYTHON_VERSION 3.5.1</span>
<a id=__codelineno-39-14 name=__codelineno-39-14 href=#__codelineno-39-14></a>
<a id=__codelineno-39-15 name=__codelineno-39-15 href=#__codelineno-39-15></a><span class=c1># if this is called &quot;PIP_VERSION&quot;, pip explodes with &quot;ValueError: invalid truth value &#39;&lt;VERSION&gt;&#39;&quot;</span>
<a id=__codelineno-39-16 name=__codelineno-39-16 href=#__codelineno-39-16></a><span class="l l-Scalar l-Scalar-Plain">ENV PYTHON_PIP_VERSION 8.1.2</span>
<a id=__codelineno-39-17 name=__codelineno-39-17 href=#__codelineno-39-17></a>
<a id=__codelineno-39-18 name=__codelineno-39-18 href=#__codelineno-39-18></a><span class="l l-Scalar l-Scalar-Plain">RUN set -ex \</span>
<a id=__codelineno-39-19 name=__codelineno-39-19 href=#__codelineno-39-19></a><span class=w>        </span><span class="l l-Scalar l-Scalar-Plain">&amp;&amp; curl -fSL &quot;https://www.python.org/ftp/python/${PYTHON_VERSION%%[a-z]*}/Python-$PYTHON_VERSION.tar.xz&quot; -o python.tar.xz \</span>
<a id=__codelineno-39-20 name=__codelineno-39-20 href=#__codelineno-39-20></a><span class=w>        </span><span class="l l-Scalar l-Scalar-Plain">&amp;&amp; curl -fSL &quot;https://www.python.org/ftp/python/${PYTHON_VERSION%%[a-z]*}/Python-$PYTHON_VERSION.tar.xz.asc&quot; -o python.tar.xz.asc \</span>
<a id=__codelineno-39-21 name=__codelineno-39-21 href=#__codelineno-39-21></a><span class=w>        </span><span class="l l-Scalar l-Scalar-Plain">&amp;&amp; export GNUPGHOME=&quot;$(mktemp -d)&quot; \</span>
<a id=__codelineno-39-22 name=__codelineno-39-22 href=#__codelineno-39-22></a><span class=w>        </span><span class="l l-Scalar l-Scalar-Plain">&amp;&amp; gpg --keyserver ha.pool.sks-keyservers.net --recv-keys &quot;$GPG_KEY&quot; \</span>
<a id=__codelineno-39-23 name=__codelineno-39-23 href=#__codelineno-39-23></a><span class=w>        </span><span class="l l-Scalar l-Scalar-Plain">&amp;&amp; gpg --batch --verify python.tar.xz.asc python.tar.xz \</span>
<a id=__codelineno-39-24 name=__codelineno-39-24 href=#__codelineno-39-24></a><span class=w>        </span><span class="l l-Scalar l-Scalar-Plain">&amp;&amp; rm -r &quot;$GNUPGHOME&quot; python.tar.xz.asc \</span>
<a id=__codelineno-39-25 name=__codelineno-39-25 href=#__codelineno-39-25></a><span class=w>        </span><span class="l l-Scalar l-Scalar-Plain">&amp;&amp; mkdir -p /usr/src/python \</span>
<a id=__codelineno-39-26 name=__codelineno-39-26 href=#__codelineno-39-26></a><span class=w>        </span><span class="l l-Scalar l-Scalar-Plain">&amp;&amp; tar -xJC /usr/src/python --strip-components=1 -f python.tar.xz \</span>
<a id=__codelineno-39-27 name=__codelineno-39-27 href=#__codelineno-39-27></a><span class=w>        </span><span class="l l-Scalar l-Scalar-Plain">&amp;&amp; rm python.tar.xz \</span>
<a id=__codelineno-39-28 name=__codelineno-39-28 href=#__codelineno-39-28></a><span class=w>        </span><span class="l l-Scalar l-Scalar-Plain">\</span>
<a id=__codelineno-39-29 name=__codelineno-39-29 href=#__codelineno-39-29></a><span class=w>        </span><span class="l l-Scalar l-Scalar-Plain">&amp;&amp; cd /usr/src/python \</span>
<a id=__codelineno-39-30 name=__codelineno-39-30 href=#__codelineno-39-30></a><span class=w>        </span><span class="l l-Scalar l-Scalar-Plain">&amp;&amp; ./configure --enable-shared --enable-unicode=ucs4 \</span>
<a id=__codelineno-39-31 name=__codelineno-39-31 href=#__codelineno-39-31></a><span class=w>        </span><span class="l l-Scalar l-Scalar-Plain">&amp;&amp; make -j$(nproc) \</span>
<a id=__codelineno-39-32 name=__codelineno-39-32 href=#__codelineno-39-32></a><span class=w>        </span><span class="l l-Scalar l-Scalar-Plain">&amp;&amp; make install \</span>
<a id=__codelineno-39-33 name=__codelineno-39-33 href=#__codelineno-39-33></a><span class=w>        </span><span class="l l-Scalar l-Scalar-Plain">&amp;&amp; ldconfig \</span>
<a id=__codelineno-39-34 name=__codelineno-39-34 href=#__codelineno-39-34></a><span class=w>        </span><span class="l l-Scalar l-Scalar-Plain">&amp;&amp; pip3 install --no-cache-dir --upgrade --ignore-installed pip==$PYTHON_PIP_VERSION \</span>
<a id=__codelineno-39-35 name=__codelineno-39-35 href=#__codelineno-39-35></a><span class=w>        </span><span class="l l-Scalar l-Scalar-Plain">&amp;&amp; find /usr/local -depth \</span>
<a id=__codelineno-39-36 name=__codelineno-39-36 href=#__codelineno-39-36></a><span class=w>                </span><span class="l l-Scalar l-Scalar-Plain">\( \</span>
<a id=__codelineno-39-37 name=__codelineno-39-37 href=#__codelineno-39-37></a><span class=w>                    </span><span class="l l-Scalar l-Scalar-Plain">\( -type d -a -name test -o -name tests \) \</span>
<a id=__codelineno-39-38 name=__codelineno-39-38 href=#__codelineno-39-38></a><span class=w>                    </span><span class="l l-Scalar l-Scalar-Plain">-o \</span>
<a id=__codelineno-39-39 name=__codelineno-39-39 href=#__codelineno-39-39></a><span class=w>                    </span><span class="l l-Scalar l-Scalar-Plain">\( -type f -a -name &#39;*.pyc&#39; -o -name &#39;*.pyo&#39; \) \</span>
<a id=__codelineno-39-40 name=__codelineno-39-40 href=#__codelineno-39-40></a><span class=w>                </span><span class="l l-Scalar l-Scalar-Plain">\) -exec rm -rf &#39;{}&#39; + \</span>
<a id=__codelineno-39-41 name=__codelineno-39-41 href=#__codelineno-39-41></a><span class=w>        </span><span class="l l-Scalar l-Scalar-Plain">&amp;&amp; rm -rf /usr/src/python ~/.cache</span>
<a id=__codelineno-39-42 name=__codelineno-39-42 href=#__codelineno-39-42></a>
<a id=__codelineno-39-43 name=__codelineno-39-43 href=#__codelineno-39-43></a><span class=c1># make some useful symlinks that are expected to exist</span>
<a id=__codelineno-39-44 name=__codelineno-39-44 href=#__codelineno-39-44></a><span class="l l-Scalar l-Scalar-Plain">RUN cd /usr/local/bin \</span>
<a id=__codelineno-39-45 name=__codelineno-39-45 href=#__codelineno-39-45></a><span class=w>        </span><span class="l l-Scalar l-Scalar-Plain">&amp;&amp; ln -s easy_install-3.5 easy_install \</span>
<a id=__codelineno-39-46 name=__codelineno-39-46 href=#__codelineno-39-46></a><span class=w>        </span><span class="l l-Scalar l-Scalar-Plain">&amp;&amp; ln -s idle3 idle \</span>
<a id=__codelineno-39-47 name=__codelineno-39-47 href=#__codelineno-39-47></a><span class=w>        </span><span class="l l-Scalar l-Scalar-Plain">&amp;&amp; ln -s pydoc3 pydoc \</span>
<a id=__codelineno-39-48 name=__codelineno-39-48 href=#__codelineno-39-48></a><span class=w>        </span><span class="l l-Scalar l-Scalar-Plain">&amp;&amp; ln -s python3 python \</span>
<a id=__codelineno-39-49 name=__codelineno-39-49 href=#__codelineno-39-49></a><span class=w>        </span><span class="l l-Scalar l-Scalar-Plain">&amp;&amp; ln -s python3-config python-config</span>
<a id=__codelineno-39-50 name=__codelineno-39-50 href=#__codelineno-39-50></a>
<a id=__codelineno-39-51 name=__codelineno-39-51 href=#__codelineno-39-51></a><span class="l l-Scalar l-Scalar-Plain">CMD [&quot;python3&quot;]</span>
</code></pre></div> <h2 id=4buildkit>4.BuildKit<a class=headerlink href=#4buildkit title="Permanent link">&para;</a></h2> <p>简单的说就是：</p> <p>BuildKit或DOCKER_BUILDKIT=1 特性可以将docker build完成的数据输出到本地</p> <p>基于BuildKit优化Dockerfile的构建</p> <blockquote> <p><a href=https://mp.weixin.qq.com/s/OjeQsalkthe-YksIe0HtVg>https://mp.weixin.qq.com/s/OjeQsalkthe-YksIe0HtVg</a> </p> </blockquote> <h3 id=41-安装buildx>4.1 安装buildx<a class=headerlink href=#41-安装buildx title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-40-1 name=__codelineno-40-1 href=#__codelineno-40-1></a><span class=c1># Buildx 0.6+</span>
<a id=__codelineno-40-2 name=__codelineno-40-2 href=#__codelineno-40-2></a>$<span class=w> </span>docker<span class=w> </span>buildx<span class=w> </span>bake<span class=w> </span><span class=s2>&quot;https://github.com/docker/buildx.git&quot;</span>
<a id=__codelineno-40-3 name=__codelineno-40-3 href=#__codelineno-40-3></a>$<span class=w> </span>mkdir<span class=w> </span>-p<span class=w> </span>~/.docker/cli-plugins
<a id=__codelineno-40-4 name=__codelineno-40-4 href=#__codelineno-40-4></a>$<span class=w> </span>mv<span class=w> </span>./bin/buildx<span class=w> </span>~/.docker/cli-plugins/docker-buildx
<a id=__codelineno-40-5 name=__codelineno-40-5 href=#__codelineno-40-5></a>
<a id=__codelineno-40-6 name=__codelineno-40-6 href=#__codelineno-40-6></a><span class=c1># Docker 19.03+</span>
<a id=__codelineno-40-7 name=__codelineno-40-7 href=#__codelineno-40-7></a>$<span class=w> </span><span class=nv>DOCKER_BUILDKIT</span><span class=o>=</span><span class=m>1</span><span class=w> </span>docker<span class=w> </span>build<span class=w> </span>--platform<span class=o>=</span><span class=nb>local</span><span class=w> </span>-o<span class=w> </span>.<span class=w> </span><span class=s2>&quot;https://github.com/docker/buildx.git&quot;</span>
<a id=__codelineno-40-8 name=__codelineno-40-8 href=#__codelineno-40-8></a>$<span class=w> </span>mkdir<span class=w> </span>-p<span class=w> </span>~/.docker/cli-plugins
<a id=__codelineno-40-9 name=__codelineno-40-9 href=#__codelineno-40-9></a>$<span class=w> </span>mv<span class=w> </span>buildx<span class=w> </span>~/.docker/cli-plugins/docker-buildx
<a id=__codelineno-40-10 name=__codelineno-40-10 href=#__codelineno-40-10></a>
<a id=__codelineno-40-11 name=__codelineno-40-11 href=#__codelineno-40-11></a><span class=c1># Local</span>
<a id=__codelineno-40-12 name=__codelineno-40-12 href=#__codelineno-40-12></a>$<span class=w> </span>git<span class=w> </span>clone<span class=w> </span>https://github.com/docker/buildx.git<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nb>cd</span><span class=w> </span>buildx
<a id=__codelineno-40-13 name=__codelineno-40-13 href=#__codelineno-40-13></a>$<span class=w> </span>make<span class=w> </span>install
</code></pre></div> <p>① 第一种方式使用BuildKit特性，设置环境变量</p> <div class=highlight><pre><span></span><code><a id=__codelineno-41-1 name=__codelineno-41-1 href=#__codelineno-41-1></a><span class=nv>DOCKER_BUILDKIT</span><span class=o>=</span><span class=m>1</span><span class=w> </span>docker<span class=w> </span>build<span class=w> </span>.
</code></pre></div> <p>下面的示例Dockerfile使用一个单独的阶段来收集要导出的生成文件：</p> <p>示例1 <div class=highlight><pre><span></span><code><a id=__codelineno-42-1 name=__codelineno-42-1 href=#__codelineno-42-1></a>FROM
<a id=__codelineno-42-2 name=__codelineno-42-2 href=#__codelineno-42-2></a>Learn<span class=w> </span>more<span class=w> </span>about<span class=w> </span>the<span class=w> </span><span class=s2>&quot;FROM&quot;</span><span class=w> </span>Dockerfile<span class=w> </span>command.
<a id=__codelineno-42-3 name=__codelineno-42-3 href=#__codelineno-42-3></a><span class=w> </span>golang<span class=w> </span>AS<span class=w> </span>build-stage
<a id=__codelineno-42-4 name=__codelineno-42-4 href=#__codelineno-42-4></a>RUN<span class=w> </span>go<span class=w> </span>get<span class=w> </span>-u<span class=w> </span>github.com/LK4D4/vndr
<a id=__codelineno-42-5 name=__codelineno-42-5 href=#__codelineno-42-5></a>
<a id=__codelineno-42-6 name=__codelineno-42-6 href=#__codelineno-42-6></a>FROM<span class=w> </span>scratch<span class=w> </span>AS<span class=w> </span>export-stage
<a id=__codelineno-42-7 name=__codelineno-42-7 href=#__codelineno-42-7></a>COPY<span class=w> </span>--from<span class=o>=</span>build-stage<span class=w> </span>/go/bin/vndr<span class=w> </span>/
</code></pre></div></p> <p>示例2 <div class=highlight><pre><span></span><code><a id=__codelineno-43-1 name=__codelineno-43-1 href=#__codelineno-43-1></a>FROM<span class=w> </span>nodejs:buster-slimv1.0<span class=w> </span>AS<span class=w> </span>builder
<a id=__codelineno-43-2 name=__codelineno-43-2 href=#__codelineno-43-2></a>MAINTAINER<span class=w> </span><span class=m>1879324764</span>@qq.com
<a id=__codelineno-43-3 name=__codelineno-43-3 href=#__codelineno-43-3></a>
<a id=__codelineno-43-4 name=__codelineno-43-4 href=#__codelineno-43-4></a>COPY<span class=w> </span>sources.list<span class=w> </span>/etc/apt/sources.list
<a id=__codelineno-43-5 name=__codelineno-43-5 href=#__codelineno-43-5></a>COPY<span class=w> </span>gitee-ent-web<span class=w> </span>/home/gitee-ent-web
<a id=__codelineno-43-6 name=__codelineno-43-6 href=#__codelineno-43-6></a>
<a id=__codelineno-43-7 name=__codelineno-43-7 href=#__codelineno-43-7></a>RUN<span class=w> </span><span class=nb>set</span><span class=w> </span>-eux<span class=p>;</span><span class=se>\</span>
<a id=__codelineno-43-8 name=__codelineno-43-8 href=#__codelineno-43-8></a><span class=w>    </span>apt-get<span class=w> </span>update<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-43-9 name=__codelineno-43-9 href=#__codelineno-43-9></a><span class=w>    </span>apt-get<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>wget<span class=w> </span>git<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-43-10 name=__codelineno-43-10 href=#__codelineno-43-10></a><span class=w>    </span><span class=nb>cd</span><span class=w> </span>/home/gitee-ent-web<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-43-11 name=__codelineno-43-11 href=#__codelineno-43-11></a><span class=w>    </span>yarn<span class=w> </span>install<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-43-12 name=__codelineno-43-12 href=#__codelineno-43-12></a><span class=w>    </span>yarn<span class=w> </span>run<span class=w> </span>build-i18n<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-43-13 name=__codelineno-43-13 href=#__codelineno-43-13></a><span class=w>    </span>yarn<span class=w> </span>run<span class=w> </span>build-vendor<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-43-14 name=__codelineno-43-14 href=#__codelineno-43-14></a><span class=w>    </span>yarn<span class=w> </span>web:prod-ci-runjs
<a id=__codelineno-43-15 name=__codelineno-43-15 href=#__codelineno-43-15></a>
<a id=__codelineno-43-16 name=__codelineno-43-16 href=#__codelineno-43-16></a>FROM<span class=w> </span>scratch<span class=w> </span>AS<span class=w> </span>export-stage
<a id=__codelineno-43-17 name=__codelineno-43-17 href=#__codelineno-43-17></a>COPY<span class=w> </span>--from<span class=o>=</span>builder<span class=w> </span>/home/gitee-ent-web/dist<span class=w> </span>./dist
</code></pre></div></p> <p>② 第二种方式使用BuildKit特性</p> <p><div class=highlight><pre><span></span><code><a id=__codelineno-44-1 name=__codelineno-44-1 href=#__codelineno-44-1></a>docker<span class=w> </span>buildx<span class=w> </span>build<span class=w> </span>-o<span class=w> </span>out<span class=w> </span>.
</code></pre></div> 下面命令会在当前out目录下生成输出的文件，out如果不存在会自动创建</p> <p><div class=highlight><pre><span></span><code><a id=__codelineno-45-1 name=__codelineno-45-1 href=#__codelineno-45-1></a><span class=nv>DOCKER_BUILDKIT</span><span class=o>=</span><span class=m>1</span><span class=w> </span>docker<span class=w> </span>build<span class=w> </span>-o<span class=w> </span>out<span class=w> </span>.
</code></pre></div> 或者 <div class=highlight><pre><span></span><code><a id=__codelineno-46-1 name=__codelineno-46-1 href=#__codelineno-46-1></a><span class=c1># 直接使用 docker buildx build 命令构建镜像。</span>
<a id=__codelineno-46-2 name=__codelineno-46-2 href=#__codelineno-46-2></a>docker<span class=w> </span>buildx<span class=w> </span>build<span class=w> </span>-o<span class=w> </span>out<span class=w> </span>.
</code></pre></div></p> <h3 id=42-buildx示例>4.2 buildx示例<a class=headerlink href=#42-buildx示例 title="Permanent link">&para;</a></h3> <p>一个go编译环境的例子 <div class=highlight><pre><span></span><code><a id=__codelineno-47-1 name=__codelineno-47-1 href=#__codelineno-47-1></a>$<span class=w> </span>ls
<a id=__codelineno-47-2 name=__codelineno-47-2 href=#__codelineno-47-2></a>Dockerfile<span class=w>  </span>go.mod<span class=w>  </span>main.go
<a id=__codelineno-47-3 name=__codelineno-47-3 href=#__codelineno-47-3></a>
<a id=__codelineno-47-4 name=__codelineno-47-4 href=#__codelineno-47-4></a>$<span class=w> </span>cat<span class=w> </span>Dockerfile
<a id=__codelineno-47-5 name=__codelineno-47-5 href=#__codelineno-47-5></a>FROM<span class=w> </span>golang:1.12-alpine<span class=w> </span>as<span class=w> </span>dev
<a id=__codelineno-47-6 name=__codelineno-47-6 href=#__codelineno-47-6></a>RUN<span class=w> </span>apk<span class=w> </span>add<span class=w> </span>--no-cache<span class=w> </span>git<span class=w> </span>ca-certificates
<a id=__codelineno-47-7 name=__codelineno-47-7 href=#__codelineno-47-7></a>RUN<span class=w> </span>adduser<span class=w> </span>-D<span class=w> </span>appuser
<a id=__codelineno-47-8 name=__codelineno-47-8 href=#__codelineno-47-8></a>WORKDIR<span class=w> </span>/src
<a id=__codelineno-47-9 name=__codelineno-47-9 href=#__codelineno-47-9></a>COPY<span class=w> </span>.<span class=w> </span>/src/
<a id=__codelineno-47-10 name=__codelineno-47-10 href=#__codelineno-47-10></a>CMD<span class=w> </span><span class=nv>CGO_ENABLED</span><span class=o>=</span><span class=m>0</span><span class=w> </span>go<span class=w> </span>build<span class=w> </span>-o<span class=w> </span>app<span class=w> </span>.<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>./app
<a id=__codelineno-47-11 name=__codelineno-47-11 href=#__codelineno-47-11></a>
<a id=__codelineno-47-12 name=__codelineno-47-12 href=#__codelineno-47-12></a>FROM<span class=w> </span>dev<span class=w> </span>as<span class=w> </span>build
<a id=__codelineno-47-13 name=__codelineno-47-13 href=#__codelineno-47-13></a>RUN<span class=w> </span><span class=nv>CGO_ENABLED</span><span class=o>=</span><span class=m>0</span><span class=w> </span>go<span class=w> </span>build<span class=w> </span>-o<span class=w> </span>app<span class=w> </span>.
<a id=__codelineno-47-14 name=__codelineno-47-14 href=#__codelineno-47-14></a>USER<span class=w> </span>appuser
<a id=__codelineno-47-15 name=__codelineno-47-15 href=#__codelineno-47-15></a>CMD<span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;./app&quot;</span><span class=w> </span><span class=o>]</span>
<a id=__codelineno-47-16 name=__codelineno-47-16 href=#__codelineno-47-16></a>
<a id=__codelineno-47-17 name=__codelineno-47-17 href=#__codelineno-47-17></a>FROM<span class=w> </span>scratch<span class=w> </span>as<span class=w> </span>release
<a id=__codelineno-47-18 name=__codelineno-47-18 href=#__codelineno-47-18></a>COPY<span class=w> </span>--from<span class=o>=</span>build<span class=w> </span>/etc/passwd<span class=w> </span>/etc/group<span class=w> </span>/etc/
<a id=__codelineno-47-19 name=__codelineno-47-19 href=#__codelineno-47-19></a>COPY<span class=w> </span>--from<span class=o>=</span>build<span class=w> </span>/src/app<span class=w> </span>/app
<a id=__codelineno-47-20 name=__codelineno-47-20 href=#__codelineno-47-20></a>USER<span class=w> </span>appuser
<a id=__codelineno-47-21 name=__codelineno-47-21 href=#__codelineno-47-21></a>CMD<span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;/app&quot;</span><span class=w> </span><span class=o>]</span>
<a id=__codelineno-47-22 name=__codelineno-47-22 href=#__codelineno-47-22></a>
<a id=__codelineno-47-23 name=__codelineno-47-23 href=#__codelineno-47-23></a>FROM<span class=w> </span>scratch<span class=w> </span>as<span class=w> </span>artifact
<a id=__codelineno-47-24 name=__codelineno-47-24 href=#__codelineno-47-24></a>COPY<span class=w> </span>--from<span class=o>=</span>build<span class=w> </span>/src/app<span class=w> </span>/app
<a id=__codelineno-47-25 name=__codelineno-47-25 href=#__codelineno-47-25></a>
<a id=__codelineno-47-26 name=__codelineno-47-26 href=#__codelineno-47-26></a>FROM<span class=w> </span>release
<a id=__codelineno-47-27 name=__codelineno-47-27 href=#__codelineno-47-27></a>$<span class=w> </span><span class=nv>DOCKER_BUILDKIT</span><span class=o>=</span><span class=m>1</span><span class=w> </span>docker<span class=w> </span>build<span class=w> </span>--target<span class=w> </span>artifact<span class=w> </span>--output<span class=w> </span><span class=nv>type</span><span class=o>=</span>local,dest<span class=o>=</span>.<span class=w> </span>.
<a id=__codelineno-47-28 name=__codelineno-47-28 href=#__codelineno-47-28></a>或者
<a id=__codelineno-47-29 name=__codelineno-47-29 href=#__codelineno-47-29></a>$<span class=w> </span>docker<span class=w> </span>buildx<span class=w> </span>build<span class=w>  </span>--output<span class=w> </span><span class=nv>type</span><span class=o>=</span>local,dest<span class=o>=</span>path/to/output-dir
<a id=__codelineno-47-30 name=__codelineno-47-30 href=#__codelineno-47-30></a>After<span class=w> </span>the<span class=w> </span>build<span class=w> </span>was<span class=w> </span><span class=nb>complete</span><span class=w> </span>the<span class=w> </span>app<span class=w> </span>binary<span class=w> </span>was<span class=w> </span>exported:
<a id=__codelineno-47-31 name=__codelineno-47-31 href=#__codelineno-47-31></a>
<a id=__codelineno-47-32 name=__codelineno-47-32 href=#__codelineno-47-32></a>$<span class=w> </span>ls
<a id=__codelineno-47-33 name=__codelineno-47-33 href=#__codelineno-47-33></a>Dockerfile<span class=w>  </span>app<span class=w>  </span>go.mod<span class=w>  </span>main.go
<a id=__codelineno-47-34 name=__codelineno-47-34 href=#__codelineno-47-34></a>
<a id=__codelineno-47-35 name=__codelineno-47-35 href=#__codelineno-47-35></a>$<span class=w> </span>./app
<a id=__codelineno-47-36 name=__codelineno-47-36 href=#__codelineno-47-36></a>Ready<span class=w> </span>to<span class=w> </span>receive<span class=w> </span>requests<span class=w> </span>on<span class=w> </span>port<span class=w> </span><span class=m>8080</span>
</code></pre></div></p> <div class="admonition example"> <p class=admonition-title>参考文献</p> <p><a href=https://www.yuque.com/morlay/me/docker-buildx>https://www.yuque.com/morlay/me/docker-buildx</a></p> <p>参考文献：<a href=https://www.cnblogs.com/yance-dev/p/16499553.html>https://www.cnblogs.com/yance-dev/p/16499553.html</a></p> </div> <h2 id=5dockerfile-实践>5.Dockerfile 实践<a class=headerlink href=#5dockerfile-实践 title="Permanent link">&para;</a></h2> <div class="admonition info"> <p class=admonition-title>Golang/Python应用部署到Docker</p> </div> <h3 id=51-dockerfile-for-golang>5.1 Dockerfile for Golang<a class=headerlink href=#51-dockerfile-for-golang title="Permanent link">&para;</a></h3> <p>这里我先直接给出Goalng的Dockerfile</p> <div class=highlight><pre><span></span><code><a id=__codelineno-48-1 name=__codelineno-48-1 href=#__codelineno-48-1></a><span class="l l-Scalar l-Scalar-Plain">FROM golang:alpine AS builder</span>
<a id=__codelineno-48-2 name=__codelineno-48-2 href=#__codelineno-48-2></a><span class="l l-Scalar l-Scalar-Plain"># Set necessary environmet variables needed for our image</span>
<a id=__codelineno-48-3 name=__codelineno-48-3 href=#__codelineno-48-3></a><span class="l l-Scalar l-Scalar-Plain">ENV GO111MODULE=on \</span>
<a id=__codelineno-48-4 name=__codelineno-48-4 href=#__codelineno-48-4></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">GOPROXY=https://goproxy.cn,direct \</span>
<a id=__codelineno-48-5 name=__codelineno-48-5 href=#__codelineno-48-5></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">CGO_ENABLED=0 \</span>
<a id=__codelineno-48-6 name=__codelineno-48-6 href=#__codelineno-48-6></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">GOOS=linux \</span>
<a id=__codelineno-48-7 name=__codelineno-48-7 href=#__codelineno-48-7></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">GOARCH=amd64</span>
<a id=__codelineno-48-8 name=__codelineno-48-8 href=#__codelineno-48-8></a><span class="l l-Scalar l-Scalar-Plain"># Move to working directory /build</span>
<a id=__codelineno-48-9 name=__codelineno-48-9 href=#__codelineno-48-9></a>
<a id=__codelineno-48-10 name=__codelineno-48-10 href=#__codelineno-48-10></a><span class="l l-Scalar l-Scalar-Plain">WORKDIR /build</span>
<a id=__codelineno-48-11 name=__codelineno-48-11 href=#__codelineno-48-11></a><span class="l l-Scalar l-Scalar-Plain"># Copy and download dependency using go mod</span>
<a id=__codelineno-48-12 name=__codelineno-48-12 href=#__codelineno-48-12></a><span class="l l-Scalar l-Scalar-Plain">COPY go.mod .</span>
<a id=__codelineno-48-13 name=__codelineno-48-13 href=#__codelineno-48-13></a><span class="l l-Scalar l-Scalar-Plain">COPY go.sum .</span>
<a id=__codelineno-48-14 name=__codelineno-48-14 href=#__codelineno-48-14></a><span class="l l-Scalar l-Scalar-Plain">RUN go mod download</span>
<a id=__codelineno-48-15 name=__codelineno-48-15 href=#__codelineno-48-15></a><span class="l l-Scalar l-Scalar-Plain"># Copy the code into the container</span>
<a id=__codelineno-48-16 name=__codelineno-48-16 href=#__codelineno-48-16></a><span class="l l-Scalar l-Scalar-Plain">COPY . .</span>
<a id=__codelineno-48-17 name=__codelineno-48-17 href=#__codelineno-48-17></a><span class="l l-Scalar l-Scalar-Plain"># Run test</span>
<a id=__codelineno-48-18 name=__codelineno-48-18 href=#__codelineno-48-18></a><span class="l l-Scalar l-Scalar-Plain">#RUN go test ./...</span>
<a id=__codelineno-48-19 name=__codelineno-48-19 href=#__codelineno-48-19></a>
<a id=__codelineno-48-20 name=__codelineno-48-20 href=#__codelineno-48-20></a><span class="l l-Scalar l-Scalar-Plain"># Build the application</span>
<a id=__codelineno-48-21 name=__codelineno-48-21 href=#__codelineno-48-21></a><span class="l l-Scalar l-Scalar-Plain">RUN go build -o main .</span>
<a id=__codelineno-48-22 name=__codelineno-48-22 href=#__codelineno-48-22></a>
<a id=__codelineno-48-23 name=__codelineno-48-23 href=#__codelineno-48-23></a><span class="l l-Scalar l-Scalar-Plain"># Move to /dist directory as the place for resulting binary folder</span>
<a id=__codelineno-48-24 name=__codelineno-48-24 href=#__codelineno-48-24></a><span class="l l-Scalar l-Scalar-Plain">WORKDIR /dist</span>
<a id=__codelineno-48-25 name=__codelineno-48-25 href=#__codelineno-48-25></a>
<a id=__codelineno-48-26 name=__codelineno-48-26 href=#__codelineno-48-26></a><span class="l l-Scalar l-Scalar-Plain"># Copy binary from build to main folder</span>
<a id=__codelineno-48-27 name=__codelineno-48-27 href=#__codelineno-48-27></a><span class="l l-Scalar l-Scalar-Plain">RUN cp /build/main .</span>
<a id=__codelineno-48-28 name=__codelineno-48-28 href=#__codelineno-48-28></a>
<a id=__codelineno-48-29 name=__codelineno-48-29 href=#__codelineno-48-29></a><span class="l l-Scalar l-Scalar-Plain">############################</span>
<a id=__codelineno-48-30 name=__codelineno-48-30 href=#__codelineno-48-30></a><span class="l l-Scalar l-Scalar-Plain"># STEP 2 build a small image</span>
<a id=__codelineno-48-31 name=__codelineno-48-31 href=#__codelineno-48-31></a><span class="l l-Scalar l-Scalar-Plain">############################</span>
<a id=__codelineno-48-32 name=__codelineno-48-32 href=#__codelineno-48-32></a><span class="l l-Scalar l-Scalar-Plain">FROM scratch</span>
<a id=__codelineno-48-33 name=__codelineno-48-33 href=#__codelineno-48-33></a><span class="l l-Scalar l-Scalar-Plain">COPY --from=builder /dist/main /</span>
<a id=__codelineno-48-34 name=__codelineno-48-34 href=#__codelineno-48-34></a><span class="l l-Scalar l-Scalar-Plain">COPY ./env/demo.env /env/demo.env</span>
<a id=__codelineno-48-35 name=__codelineno-48-35 href=#__codelineno-48-35></a><span class="l l-Scalar l-Scalar-Plain">COPY ./logs /logs</span>
<a id=__codelineno-48-36 name=__codelineno-48-36 href=#__codelineno-48-36></a>
<a id=__codelineno-48-37 name=__codelineno-48-37 href=#__codelineno-48-37></a><span class="l l-Scalar l-Scalar-Plain"># Command to run the executable</span>
<a id=__codelineno-48-38 name=__codelineno-48-38 href=#__codelineno-48-38></a><span class="l l-Scalar l-Scalar-Plain">ENTRYPOINT [&quot;/main&quot;]</span>
</code></pre></div> <h3 id=52-dockerfile-for-python>5.2 Dockerfile for Python<a class=headerlink href=#52-dockerfile-for-python title="Permanent link">&para;</a></h3> <p>因而在我看到一些高star数的开源软件的Dockerfile中，Python程序一般直接在运行在python:3.7-alpine的基础镜像之上。比如:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-49-1 name=__codelineno-49-1 href=#__codelineno-49-1></a><span class="l l-Scalar l-Scalar-Plain">FROM python:3.7-alpine</span>
<a id=__codelineno-49-2 name=__codelineno-49-2 href=#__codelineno-49-2></a><span class="l l-Scalar l-Scalar-Plain">ENV PYTHONUNBUFFERED 1</span>
<a id=__codelineno-49-3 name=__codelineno-49-3 href=#__codelineno-49-3></a><span class="l l-Scalar l-Scalar-Plain">RUN apk update \</span>
<a id=__codelineno-49-4 name=__codelineno-49-4 href=#__codelineno-49-4></a><span class=w>  </span><span class="l l-Scalar l-Scalar-Plain"># psycopg2 dependencies</span>
<a id=__codelineno-49-5 name=__codelineno-49-5 href=#__codelineno-49-5></a><span class=w>  </span><span class="l l-Scalar l-Scalar-Plain">&amp;&amp; apk add --virtual build-deps gcc python3-dev musl-dev \</span>
<a id=__codelineno-49-6 name=__codelineno-49-6 href=#__codelineno-49-6></a><span class=w>  </span><span class="l l-Scalar l-Scalar-Plain">&amp;&amp; apk add postgresql-dev \</span>
<a id=__codelineno-49-7 name=__codelineno-49-7 href=#__codelineno-49-7></a><span class=w>  </span><span class="l l-Scalar l-Scalar-Plain"># Pillow dependencies</span>
<a id=__codelineno-49-8 name=__codelineno-49-8 href=#__codelineno-49-8></a><span class=w>  </span><span class="l l-Scalar l-Scalar-Plain">&amp;&amp; apk add jpeg-dev zlib-dev freetype-dev lcms2-dev openjpeg-dev tiff-dev tk-dev tcl-dev \</span>
<a id=__codelineno-49-9 name=__codelineno-49-9 href=#__codelineno-49-9></a><span class=w>  </span><span class="l l-Scalar l-Scalar-Plain"># CFFI dependencies</span>
<a id=__codelineno-49-10 name=__codelineno-49-10 href=#__codelineno-49-10></a><span class=w>  </span><span class="l l-Scalar l-Scalar-Plain">&amp;&amp; apk add libffi-dev py-cffi</span>
<a id=__codelineno-49-11 name=__codelineno-49-11 href=#__codelineno-49-11></a>
<a id=__codelineno-49-12 name=__codelineno-49-12 href=#__codelineno-49-12></a><span class="l l-Scalar l-Scalar-Plain">RUN addgroup -S django \</span>
<a id=__codelineno-49-13 name=__codelineno-49-13 href=#__codelineno-49-13></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">&amp;&amp; adduser -S -G django django</span>
<a id=__codelineno-49-14 name=__codelineno-49-14 href=#__codelineno-49-14></a><span class="l l-Scalar l-Scalar-Plain"># Requirements are installed here to ensure they will be cached.</span>
<a id=__codelineno-49-15 name=__codelineno-49-15 href=#__codelineno-49-15></a><span class="l l-Scalar l-Scalar-Plain">COPY ./requirements /requirements</span>
<a id=__codelineno-49-16 name=__codelineno-49-16 href=#__codelineno-49-16></a><span class="l l-Scalar l-Scalar-Plain">RUN pip install --no-cache-dir -r /requirements/production.txt \</span>
<a id=__codelineno-49-17 name=__codelineno-49-17 href=#__codelineno-49-17></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">&amp;&amp; rm -rf /requirements</span>
<a id=__codelineno-49-18 name=__codelineno-49-18 href=#__codelineno-49-18></a><span class="l l-Scalar l-Scalar-Plain">COPY ./compose/production/django/entrypoint /entrypoint</span>
<a id=__codelineno-49-19 name=__codelineno-49-19 href=#__codelineno-49-19></a><span class="l l-Scalar l-Scalar-Plain">RUN sed -i &#39;s/\r$//g&#39; /entrypoint</span>
<a id=__codelineno-49-20 name=__codelineno-49-20 href=#__codelineno-49-20></a><span class="l l-Scalar l-Scalar-Plain">RUN chmod +x /entrypoint</span>
<a id=__codelineno-49-21 name=__codelineno-49-21 href=#__codelineno-49-21></a><span class="l l-Scalar l-Scalar-Plain">RUN chown django /entrypoint</span>
<a id=__codelineno-49-22 name=__codelineno-49-22 href=#__codelineno-49-22></a><span class="l l-Scalar l-Scalar-Plain">COPY ./compose/production/django/start /start</span>
<a id=__codelineno-49-23 name=__codelineno-49-23 href=#__codelineno-49-23></a><span class="l l-Scalar l-Scalar-Plain">RUN sed -i &#39;s/\r$//g&#39; /start</span>
<a id=__codelineno-49-24 name=__codelineno-49-24 href=#__codelineno-49-24></a><span class="l l-Scalar l-Scalar-Plain">RUN chmod +x /start</span>
<a id=__codelineno-49-25 name=__codelineno-49-25 href=#__codelineno-49-25></a><span class="l l-Scalar l-Scalar-Plain">RUN chown django /start</span>
<a id=__codelineno-49-26 name=__codelineno-49-26 href=#__codelineno-49-26></a><span class="l l-Scalar l-Scalar-Plain">COPY ./compose/production/django/celery/worker/start /start-celeryworker</span>
<a id=__codelineno-49-27 name=__codelineno-49-27 href=#__codelineno-49-27></a><span class="l l-Scalar l-Scalar-Plain">RUN sed -i &#39;s/\r$//g&#39; /start-celeryworker</span>
<a id=__codelineno-49-28 name=__codelineno-49-28 href=#__codelineno-49-28></a><span class="l l-Scalar l-Scalar-Plain">RUN chmod +x /start-celeryworker</span>
<a id=__codelineno-49-29 name=__codelineno-49-29 href=#__codelineno-49-29></a><span class="l l-Scalar l-Scalar-Plain">RUN chown django /start-celeryworker</span>
<a id=__codelineno-49-30 name=__codelineno-49-30 href=#__codelineno-49-30></a><span class="l l-Scalar l-Scalar-Plain">COPY ./compose/production/django/celery/beat/start /start-celerybeat</span>
<a id=__codelineno-49-31 name=__codelineno-49-31 href=#__codelineno-49-31></a><span class="l l-Scalar l-Scalar-Plain">RUN sed -i &#39;s/\r$//g&#39; /start-celerybeat</span>
<a id=__codelineno-49-32 name=__codelineno-49-32 href=#__codelineno-49-32></a><span class="l l-Scalar l-Scalar-Plain">RUN chmod +x /start-celerybeat</span>
<a id=__codelineno-49-33 name=__codelineno-49-33 href=#__codelineno-49-33></a><span class="l l-Scalar l-Scalar-Plain">RUN chown django /start-celerybeat</span>
<a id=__codelineno-49-34 name=__codelineno-49-34 href=#__codelineno-49-34></a><span class="l l-Scalar l-Scalar-Plain">COPY ./compose/production/django/celery/flower/start /start-flower</span>
<a id=__codelineno-49-35 name=__codelineno-49-35 href=#__codelineno-49-35></a><span class="l l-Scalar l-Scalar-Plain">RUN sed -i &#39;s/\r$//g&#39; /start-flower</span>
<a id=__codelineno-49-36 name=__codelineno-49-36 href=#__codelineno-49-36></a><span class="l l-Scalar l-Scalar-Plain">RUN chmod +x /start-flower</span>
<a id=__codelineno-49-37 name=__codelineno-49-37 href=#__codelineno-49-37></a><span class="l l-Scalar l-Scalar-Plain">COPY . /app</span>
<a id=__codelineno-49-38 name=__codelineno-49-38 href=#__codelineno-49-38></a><span class="l l-Scalar l-Scalar-Plain">RUN chown -R django /app</span>
<a id=__codelineno-49-39 name=__codelineno-49-39 href=#__codelineno-49-39></a><span class="l l-Scalar l-Scalar-Plain">USER django</span>
<a id=__codelineno-49-40 name=__codelineno-49-40 href=#__codelineno-49-40></a>
<a id=__codelineno-49-41 name=__codelineno-49-41 href=#__codelineno-49-41></a><span class="l l-Scalar l-Scalar-Plain">WORKDIR /app</span>
<a id=__codelineno-49-42 name=__codelineno-49-42 href=#__codelineno-49-42></a><span class="l l-Scalar l-Scalar-Plain">ENTRYPOINT [&quot;/entrypoint&quot;]</span>
</code></pre></div> <h3 id=53-构建nginxphptomcat基础镜像>5.3 构建Nginx，PHP，Tomcat基础镜像<a class=headerlink href=#53-构建nginxphptomcat基础镜像 title="Permanent link">&para;</a></h3> <p>构建Nginx基础镜像</p> <div class=highlight><pre><span></span><code><a id=__codelineno-50-1 name=__codelineno-50-1 href=#__codelineno-50-1></a><span class="l l-Scalar l-Scalar-Plain">FROM centos:7</span>
<a id=__codelineno-50-2 name=__codelineno-50-2 href=#__codelineno-50-2></a><span class="l l-Scalar l-Scalar-Plain">LABEL wenlong</span>
<a id=__codelineno-50-3 name=__codelineno-50-3 href=#__codelineno-50-3></a><span class="l l-Scalar l-Scalar-Plain">RUN yum install -y gcc gcc-c++ make \</span>
<a id=__codelineno-50-4 name=__codelineno-50-4 href=#__codelineno-50-4></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">openssl-devel pcre-devel gd-devel \</span>
<a id=__codelineno-50-5 name=__codelineno-50-5 href=#__codelineno-50-5></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">iproute net-tools telnet wget curl &amp;&amp; \</span>
<a id=__codelineno-50-6 name=__codelineno-50-6 href=#__codelineno-50-6></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">yum clean all &amp;&amp; \</span>
<a id=__codelineno-50-7 name=__codelineno-50-7 href=#__codelineno-50-7></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">rm -rf /var/cache/yum/*</span>
<a id=__codelineno-50-8 name=__codelineno-50-8 href=#__codelineno-50-8></a><span class="l l-Scalar l-Scalar-Plain">RUN wget http://nginx.org/download/nginx-1.15.5.tar.gz &amp;&amp; \</span>
<a id=__codelineno-50-9 name=__codelineno-50-9 href=#__codelineno-50-9></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">tar zxf nginx-1.15.5.tar.gz &amp;&amp; \</span>
<a id=__codelineno-50-10 name=__codelineno-50-10 href=#__codelineno-50-10></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">cd nginx-1.15.5 &amp;&amp; \</span>
<a id=__codelineno-50-11 name=__codelineno-50-11 href=#__codelineno-50-11></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">./configure --prefix=/usr/local/nginx \</span>
<a id=__codelineno-50-12 name=__codelineno-50-12 href=#__codelineno-50-12></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">--with-http_ssl_module \</span>
<a id=__codelineno-50-13 name=__codelineno-50-13 href=#__codelineno-50-13></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">--with-http_stub_status_module &amp;&amp; \</span>
<a id=__codelineno-50-14 name=__codelineno-50-14 href=#__codelineno-50-14></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">make -j 4 &amp;&amp; make install &amp;&amp; \</span>
<a id=__codelineno-50-15 name=__codelineno-50-15 href=#__codelineno-50-15></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">rm -rf /usr/local/nginx/html/* &amp;&amp; \</span>
<a id=__codelineno-50-16 name=__codelineno-50-16 href=#__codelineno-50-16></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">echo &quot;ok&quot; &gt;&gt; /usr/local/nginx/html/status.html &amp;&amp; \</span>
<a id=__codelineno-50-17 name=__codelineno-50-17 href=#__codelineno-50-17></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">cd / &amp;&amp; rm -rf nginx-1.15.5* &amp;&amp; \</span>
<a id=__codelineno-50-18 name=__codelineno-50-18 href=#__codelineno-50-18></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span>
<a id=__codelineno-50-19 name=__codelineno-50-19 href=#__codelineno-50-19></a>
<a id=__codelineno-50-20 name=__codelineno-50-20 href=#__codelineno-50-20></a><span class="l l-Scalar l-Scalar-Plain">ENV PATH $PATH:/usr/local/nginx/sbin</span>
<a id=__codelineno-50-21 name=__codelineno-50-21 href=#__codelineno-50-21></a><span class="l l-Scalar l-Scalar-Plain">COPY nginx.conf /usr/local/nginx/conf/nginx.conf</span>
<a id=__codelineno-50-22 name=__codelineno-50-22 href=#__codelineno-50-22></a><span class="l l-Scalar l-Scalar-Plain">WORKDIR /usr/local/nginx</span>
<a id=__codelineno-50-23 name=__codelineno-50-23 href=#__codelineno-50-23></a><span class="l l-Scalar l-Scalar-Plain">EXPOSE 80</span>
<a id=__codelineno-50-24 name=__codelineno-50-24 href=#__codelineno-50-24></a><span class="l l-Scalar l-Scalar-Plain">CMD [&quot;nginx&quot;, &quot;-g&quot;, &quot;daemon off;&quot;]</span>
</code></pre></div> <p>构建PHP基础镜像</p> <div class=highlight><pre><span></span><code><a id=__codelineno-51-1 name=__codelineno-51-1 href=#__codelineno-51-1></a><span class="l l-Scalar l-Scalar-Plain">复制代码</span>
<a id=__codelineno-51-2 name=__codelineno-51-2 href=#__codelineno-51-2></a><span class="l l-Scalar l-Scalar-Plain">FROM centos:7</span>
<a id=__codelineno-51-3 name=__codelineno-51-3 href=#__codelineno-51-3></a><span class="l l-Scalar l-Scalar-Plain">LABEL maintainer wenlong</span>
<a id=__codelineno-51-4 name=__codelineno-51-4 href=#__codelineno-51-4></a><span class="l l-Scalar l-Scalar-Plain">RUN yum install epel-release -y &amp;&amp; \</span>
<a id=__codelineno-51-5 name=__codelineno-51-5 href=#__codelineno-51-5></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">yum install -y gcc gcc-c++ make gd-devel libxml2-devel \</span>
<a id=__codelineno-51-6 name=__codelineno-51-6 href=#__codelineno-51-6></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">libcurl-devel libjpeg-devel libpng-devel openssl-devel \</span>
<a id=__codelineno-51-7 name=__codelineno-51-7 href=#__codelineno-51-7></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">libmcrypt-devel libxslt-devel libtidy-devel autoconf \</span>
<a id=__codelineno-51-8 name=__codelineno-51-8 href=#__codelineno-51-8></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">iproute net-tools telnet wget curl &amp;&amp; \</span>
<a id=__codelineno-51-9 name=__codelineno-51-9 href=#__codelineno-51-9></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">yum clean all &amp;&amp; \</span>
<a id=__codelineno-51-10 name=__codelineno-51-10 href=#__codelineno-51-10></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">rm -rf /var/cache/yum/*</span>
<a id=__codelineno-51-11 name=__codelineno-51-11 href=#__codelineno-51-11></a>
<a id=__codelineno-51-12 name=__codelineno-51-12 href=#__codelineno-51-12></a><span class="l l-Scalar l-Scalar-Plain">RUN wget http://docs.php.net/distributions/php-5.6.36.tar.gz &amp;&amp; \</span>
<a id=__codelineno-51-13 name=__codelineno-51-13 href=#__codelineno-51-13></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">tar zxf php-5.6.36.tar.gz &amp;&amp; \</span>
<a id=__codelineno-51-14 name=__codelineno-51-14 href=#__codelineno-51-14></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">cd php-5.6.36 &amp;&amp; \</span>
<a id=__codelineno-51-15 name=__codelineno-51-15 href=#__codelineno-51-15></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">./configure --prefix=/usr/local/php \</span>
<a id=__codelineno-51-16 name=__codelineno-51-16 href=#__codelineno-51-16></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">--with-config-file-path=/usr/local/php/etc \</span>
<a id=__codelineno-51-17 name=__codelineno-51-17 href=#__codelineno-51-17></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">--enable-fpm --enable-opcache \</span>
<a id=__codelineno-51-18 name=__codelineno-51-18 href=#__codelineno-51-18></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">--with-mysql --with-mysqli --with-pdo-mysql \</span>
<a id=__codelineno-51-19 name=__codelineno-51-19 href=#__codelineno-51-19></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">--with-openssl --with-zlib --with-curl --with-gd \</span>
<a id=__codelineno-51-20 name=__codelineno-51-20 href=#__codelineno-51-20></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">--with-jpeg-dir --with-png-dir --with-freetype-dir \</span>
<a id=__codelineno-51-21 name=__codelineno-51-21 href=#__codelineno-51-21></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">--enable-mbstring --with-mcrypt --enable-hash &amp;&amp; \</span>
<a id=__codelineno-51-22 name=__codelineno-51-22 href=#__codelineno-51-22></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">make -j 4 &amp;&amp; make install &amp;&amp; \</span>
<a id=__codelineno-51-23 name=__codelineno-51-23 href=#__codelineno-51-23></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">cp php.ini-production /usr/local/php/etc/php.ini &amp;&amp; \</span>
<a id=__codelineno-51-24 name=__codelineno-51-24 href=#__codelineno-51-24></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">cp sapi/fpm/php-fpm.conf /usr/local/php/etc/php-fpm.conf &amp;&amp; \</span>
<a id=__codelineno-51-25 name=__codelineno-51-25 href=#__codelineno-51-25></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">sed -i &quot;90a \daemonize = no&quot; /usr/local/php/etc/php-fpm.conf &amp;&amp; \</span>
<a id=__codelineno-51-26 name=__codelineno-51-26 href=#__codelineno-51-26></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">mkdir /usr/local/php/log &amp;&amp; \</span>
<a id=__codelineno-51-27 name=__codelineno-51-27 href=#__codelineno-51-27></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">cd / &amp;&amp; rm -rf php* &amp;&amp; \</span>
<a id=__codelineno-51-28 name=__codelineno-51-28 href=#__codelineno-51-28></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span>
<a id=__codelineno-51-29 name=__codelineno-51-29 href=#__codelineno-51-29></a>
<a id=__codelineno-51-30 name=__codelineno-51-30 href=#__codelineno-51-30></a><span class="l l-Scalar l-Scalar-Plain">ENV PATH $PATH:/usr/local/php/sbin</span>
<a id=__codelineno-51-31 name=__codelineno-51-31 href=#__codelineno-51-31></a><span class="l l-Scalar l-Scalar-Plain">COPY php.ini /usr/local/php/etc/</span>
<a id=__codelineno-51-32 name=__codelineno-51-32 href=#__codelineno-51-32></a><span class="l l-Scalar l-Scalar-Plain">COPY php-fpm.conf /usr/local/php/etc/</span>
<a id=__codelineno-51-33 name=__codelineno-51-33 href=#__codelineno-51-33></a><span class="l l-Scalar l-Scalar-Plain">WORKDIR /usr/local/php</span>
<a id=__codelineno-51-34 name=__codelineno-51-34 href=#__codelineno-51-34></a><span class="l l-Scalar l-Scalar-Plain">EXPOSE 9000</span>
<a id=__codelineno-51-35 name=__codelineno-51-35 href=#__codelineno-51-35></a><span class="l l-Scalar l-Scalar-Plain">CMD [&quot;php-fpm&quot;]</span>
</code></pre></div> <p>构建Tomcat基础镜像</p> <div class=highlight><pre><span></span><code><a id=__codelineno-52-1 name=__codelineno-52-1 href=#__codelineno-52-1></a><span class="l l-Scalar l-Scalar-Plain">FROM centos:7</span>
<a id=__codelineno-52-2 name=__codelineno-52-2 href=#__codelineno-52-2></a><span class="l l-Scalar l-Scalar-Plain">LABEL maintainer wenlong</span>
<a id=__codelineno-52-3 name=__codelineno-52-3 href=#__codelineno-52-3></a>
<a id=__codelineno-52-4 name=__codelineno-52-4 href=#__codelineno-52-4></a><span class="l l-Scalar l-Scalar-Plain">ENV VERSION=8.0.52</span>
<a id=__codelineno-52-5 name=__codelineno-52-5 href=#__codelineno-52-5></a>
<a id=__codelineno-52-6 name=__codelineno-52-6 href=#__codelineno-52-6></a><span class="l l-Scalar l-Scalar-Plain">RUN yum install java-1.8.0-openjdk wget curl unzip iproute net-tools -y &amp;&amp; \</span>
<a id=__codelineno-52-7 name=__codelineno-52-7 href=#__codelineno-52-7></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">yum clean all &amp;&amp; \</span>
<a id=__codelineno-52-8 name=__codelineno-52-8 href=#__codelineno-52-8></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">rm -rf /var/cache/yum/*</span>
<a id=__codelineno-52-9 name=__codelineno-52-9 href=#__codelineno-52-9></a>
<a id=__codelineno-52-10 name=__codelineno-52-10 href=#__codelineno-52-10></a><span class="l l-Scalar l-Scalar-Plain">RUN wget http://mirrors.shu.edu.cn/apache/tomcat/tomcat-8/v${VERSION}/bin/apache-tomcat-${VERSION}.tar.gz &amp;&amp; \</span>
<a id=__codelineno-52-11 name=__codelineno-52-11 href=#__codelineno-52-11></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">tar zxf apache-tomcat-${VERSION}.tar.gz &amp;&amp; \</span>
<a id=__codelineno-52-12 name=__codelineno-52-12 href=#__codelineno-52-12></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">mv apache-tomcat-${VERSION} /usr/local/tomcat &amp;&amp; \</span>
<a id=__codelineno-52-13 name=__codelineno-52-13 href=#__codelineno-52-13></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">rm -rf apache-tomcat-${VERSION}.tar.gz /usr/local/tomcat/webapps/* &amp;&amp; \</span>
<a id=__codelineno-52-14 name=__codelineno-52-14 href=#__codelineno-52-14></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">mkdir /usr/local/tomcat/webapps/test &amp;&amp; \</span>
<a id=__codelineno-52-15 name=__codelineno-52-15 href=#__codelineno-52-15></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">echo &quot;ok&quot; &gt; /usr/local/tomcat/webapps/test/status.html &amp;&amp; \</span>
<a id=__codelineno-52-16 name=__codelineno-52-16 href=#__codelineno-52-16></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">sed -i &#39;1a JAVA_OPTS=&quot;-Djava.security.egd=file:/dev/./urandom&quot;&#39; /usr/local/tomcat/bin/catalina.sh &amp;&amp; \</span>
<a id=__codelineno-52-17 name=__codelineno-52-17 href=#__codelineno-52-17></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span>
<a id=__codelineno-52-18 name=__codelineno-52-18 href=#__codelineno-52-18></a>
<a id=__codelineno-52-19 name=__codelineno-52-19 href=#__codelineno-52-19></a><span class="l l-Scalar l-Scalar-Plain">ENV PATH $PATH:/usr/local/tomcat/bin</span>
<a id=__codelineno-52-20 name=__codelineno-52-20 href=#__codelineno-52-20></a>
<a id=__codelineno-52-21 name=__codelineno-52-21 href=#__codelineno-52-21></a><span class="l l-Scalar l-Scalar-Plain">WORKDIR /usr/local/tomcat</span>
<a id=__codelineno-52-22 name=__codelineno-52-22 href=#__codelineno-52-22></a>
<a id=__codelineno-52-23 name=__codelineno-52-23 href=#__codelineno-52-23></a><span class="l l-Scalar l-Scalar-Plain">EXPOSE 8080</span>
<a id=__codelineno-52-24 name=__codelineno-52-24 href=#__codelineno-52-24></a><span class="l l-Scalar l-Scalar-Plain">CMD [&quot;catalina.sh&quot;, &quot;run&quot;]</span>
</code></pre></div> <div class="admonition info"> <p class=admonition-title>总结</p> <p>上面可以看出python的应用一般直接跑在某个python版本的alpine基础环境下的，而Gloang则是在GO的alpine环境下完成编译与测试后，然后通过多阶段构建的策略， 最后将编译完成Gloang程序运行在scratch镜像中，这样可以减小Golang程序最终的镜像大小，避免浪费资源。</p> </div> <div class="admonition example"> <p class=admonition-title>参考文献</p> <p><a href=https://www.bococ.cn/Docker/106.html>https://www.bococ.cn/Docker/106.html</a></p> </div> <h2 id=6dockerfile工具>6.Dockerfile工具<a class=headerlink href=#6dockerfile工具 title="Permanent link">&para;</a></h2> <div class="admonition info"> <p class=admonition-title>查看运行容器的Dockerfile工具</p> <p>项目地址：<a href=https://github.com/P3GLEG/Whaler>Whaler(opens new window)</a></p> <p>项目说明：能够查看在运行容器的Dockerfile的工具，有时候我们可能会维护一个没有Dockerfile的容器，即可借助此工具。</p> <p>相关文章：<a href=https://samaritan.ai/blog/reversing-docker-images-into-dockerfiles/ >博文介绍</a></p> </div> <div class="admonition info"> <p class=admonition-title>查看docker容器运行命令的所有参数</p> <p>项目地址：<a href=https://github.com/lavie/runlike>runlike(opens new window)</a></p> <p>项目说明：给定一个现有的 docker 容器，打印运行它的副本所需的命令行。</p> <p>相关文章：README</p> </div> <p>可以将运行的docker 推导反写为docker-compose文件</p> <h2 id=7参考文献>7.参考文献<a class=headerlink href=#7参考文献 title="Permanent link">&para;</a></h2> <div class="admonition info"> <p class=admonition-title>推荐阅读</p> <p><a href=https://vuepress.mirror.docker-practice.com/appendix/best_practices/#>Dockerfile 最佳实践</a> <a href=https://www.qikqiak.com/k8strain2/docker/dockerfile-practice/ >Dockerfile 实践</a></p> </div> <hr> <div class=md-source-file> <small> 最后更新: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime">August 4, 2023 22:46:52</span> <br> 创建日期: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime">March 30, 2023 11:29:10</span> </small> </div> <form class=md-feedback name=feedback hidden> <fieldset> <legend class=md-feedback__title> Was this page helpful? </legend> <div class=md-feedback__inner> <div class=md-feedback__list> <button class="md-feedback__icon md-icon" type=submit title="This page was helpful" data-md-value=1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m7 0c0 .8-.7 1.5-1.5 1.5S14 10.3 14 9.5 14.7 8 15.5 8s1.5.7 1.5 1.5m-5 7.73c-1.75 0-3.29-.73-4.19-1.81L9.23 14c.45.72 1.52 1.23 2.77 1.23s2.32-.51 2.77-1.23l1.42 1.42c-.9 1.08-2.44 1.81-4.19 1.81Z"/></svg> </button> <button class="md-feedback__icon md-icon" type=submit title="This page could be improved" data-md-value=0> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10m-6.5-4c.8 0 1.5.7 1.5 1.5s-.7 1.5-1.5 1.5-1.5-.7-1.5-1.5.7-1.5 1.5-1.5M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m2 4.5c1.75 0 3.29.72 4.19 1.81l-1.42 1.42C14.32 16.5 13.25 16 12 16s-2.32.5-2.77 1.23l-1.42-1.42C8.71 14.72 10.25 14 12 14Z"/></svg> </button> </div> <div class=md-feedback__note> <div data-md-value=1 hidden> Thanks for your feedback! </div> <div data-md-value=0 hidden> Thanks for your feedback! Help us improve this page by using our <a href="https://github.com/hujianli94/hujianli94.github.io/issues/new/?title=[Feedback]+7.Dockerfile+-+/Docker/1.%E5%9F%BA%E7%A1%80/7.Dockerfile/" target=_blank>feedback form</a>. </div> </div> </div> </fieldset> </form> </article> </div> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> 回到页面顶部 </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=页脚> <a href=../6.Docker%E7%BD%91%E7%BB%9C/ class="md-footer__link md-footer__link--prev" aria-label="上一页: 6.Docker网络" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> 上一页 </span> <div class=md-ellipsis> 6.Docker网络 </div> </div> </a> <a href=../8.docker-compose/ class="md-footer__link md-footer__link--next" aria-label="下一页: 8.docker-compose" rel=next> <div class=md-footer__title> <span class=md-footer__direction> 下一页 </span> <div class=md-ellipsis> 8.docker-compose </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2023 - 2024 hujainli94 </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/hujianli94 target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> <a href=https://kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com/blog_img/20220125122524.png target=_blank rel=noopener title=kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 576 512"><!-- Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M385.2 167.6c6.4 0 12.6.3 18.8 1.1C387.4 90.3 303.3 32 207.7 32 100.5 32 13 104.8 13 197.4c0 53.4 29.3 97.5 77.9 131.6l-19.3 58.6 68-34.1c24.4 4.8 43.8 9.7 68.2 9.7 6.2 0 12.1-.3 18.3-.8-4-12.9-6.2-26.6-6.2-40.8-.1-84.9 72.9-154 165.3-154zm-104.5-52.9c14.5 0 24.2 9.7 24.2 24.4 0 14.5-9.7 24.2-24.2 24.2-14.8 0-29.3-9.7-29.3-24.2.1-14.7 14.6-24.4 29.3-24.4zm-136.4 48.6c-14.5 0-29.3-9.7-29.3-24.2 0-14.8 14.8-24.4 29.3-24.4 14.8 0 24.4 9.7 24.4 24.4 0 14.6-9.6 24.2-24.4 24.2zM563 319.4c0-77.9-77.9-141.3-165.4-141.3-92.7 0-165.4 63.4-165.4 141.3S305 460.7 397.6 460.7c19.3 0 38.9-5.1 58.6-9.9l53.4 29.3-14.8-48.6C534 402.1 563 363.2 563 319.4zm-219.1-24.5c-9.7 0-19.3-9.7-19.3-19.6 0-9.7 9.7-19.3 19.3-19.3 14.8 0 24.4 9.7 24.4 19.3 0 10-9.7 19.6-24.4 19.6zm107.1 0c-9.7 0-19.3-9.7-19.3-19.6 0-9.7 9.7-19.3 19.3-19.3 14.5 0 24.4 9.7 24.4 19.3.1 10-9.9 19.6-24.4 19.6z"/></svg> </a> <a href="mailto:<1879324764@qq.com>" target=_blank rel=noopener title=发送邮件 class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M498.1 5.6c10.1 7 15.4 19.1 13.5 31.2l-64 416c-1.5 9.7-7.4 18.2-16 23s-18.9 5.4-28 1.6L284 427.7l-68.5 74.1c-8.9 9.7-22.9 12.9-35.2 8.1S160 493.2 160 480v-83.6c0-4 1.5-7.8 4.2-10.7l167.6-182.9c5.8-6.3 5.6-16-.4-22s-15.7-6.4-22-.7L106 360.8l-88.3-44.2C7.1 311.3.3 300.7 0 288.9s5.9-22.8 16.1-28.7l448-256c10.7-6.1 23.9-5.5 34 1.4z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-consent data-md-component=consent id=__consent hidden> <div class=md-consent__overlay></div> <aside class=md-consent__inner> <form class="md-consent__form md-grid md-typeset" name=consent> <h4>Cookie consent</h4> <p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p> <input class=md-toggle type=checkbox id=__settings> <div class=md-consent__settings> <ul class=task-list> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=analytics checked> <span class=task-list-indicator></span> Google Analytics </label> </li> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=github checked> <span class=task-list-indicator></span> GitHub </label> </li> </ul> </div> <div class=md-consent__controls> <button class="md-button md-button--primary">同意</button> <label class=md-button for=__settings>管理设定</label> </div> </form> </aside> </div> <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout(function(){document.querySelector("[data-md-component=consent]").hidden=!1},250);var action,form=document.forms.consent;for(action of["submit","reset"])form.addEventListener(action,function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map(function(e){return[e,!0]}))),location.hash="",location.reload()})</script> <script id=__config type=application/json>{"base": "../../..", "features": ["content.action.edit", "content.action.view", "content.code.copy", "content.code.annotate", "navigation.indexes", "navigation.footer", "navigation.indexes", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest"], "search": "../../../assets/javascripts/workers/search.74e28a9f.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script> <script src=../../../assets/javascripts/bundle.220ee61c.min.js></script> <script src=../../../javascripts/extra.js></script> <script src=https://file.cdn.shafish.cn/blog/js/video.min.js></script> </body> </html>