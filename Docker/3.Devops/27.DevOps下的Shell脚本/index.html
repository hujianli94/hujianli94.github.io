<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="stay hungry,stay foolish #magic___^_^___line"><meta name=author content=hujainli94><link href=https://hujianli94.github.io/Docker/3.Devops/27.DevOps%E4%B8%8B%E7%9A%84Shell%E8%84%9A%E6%9C%AC/ rel=canonical><link href=../26.docker-compose-devops/ rel=prev><link href=../28.Devops%E4%B8%8B%E7%9A%84Python%E8%84%9A%E6%9C%AC/ rel=next><link rel=icon href=../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.0, mkdocs-material-9.5.21"><title>27.DevOps下的Shell脚本 - DevOps运维开发</title><link rel=stylesheet href=../../../assets/stylesheets/main.66ac8b77.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.06af60db.min.css><style>:root{--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M1 7.775V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 0 1 0 2.474l-5.026 5.026a1.75 1.75 0 0 1-2.474 0l-6.25-6.25A1.752 1.752 0 0 1 1 7.775Zm1.5 0c0 .066.026.13.073.177l6.25 6.25a.25.25 0 0 0 .354 0l5.025-5.025a.25.25 0 0 0 0-.354l-6.25-6.25a.25.25 0 0 0-.177-.073H2.75a.25.25 0 0 0-.25.25ZM6 5a1 1 0 1 1 0 2 1 1 0 0 1 0-2Z"/></svg>');--md-admonition-icon--abstract:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M2.5 1.75v11.5c0 .138.112.25.25.25h3.17a.75.75 0 0 1 0 1.5H2.75A1.75 1.75 0 0 1 1 13.25V1.75C1 .784 1.784 0 2.75 0h8.5C12.216 0 13 .784 13 1.75v7.736a.75.75 0 0 1-1.5 0V1.75a.25.25 0 0 0-.25-.25h-8.5a.25.25 0 0 0-.25.25Zm13.274 9.537v-.001l-4.557 4.45a.75.75 0 0 1-1.055-.008l-1.943-1.95a.75.75 0 0 1 1.062-1.058l1.419 1.425 4.026-3.932a.75.75 0 1 1 1.048 1.074ZM4.75 4h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM4 7.75A.75.75 0 0 1 4.75 7h2a.75.75 0 0 1 0 1.5h-2A.75.75 0 0 1 4 7.75Z"/></svg>');--md-admonition-icon--info:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"/></svg>');--md-admonition-icon--tip:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M3.499.75a.75.75 0 0 1 1.5 0v.996C5.9 2.903 6.793 3.65 7.662 4.376l.24.202c-.036-.694.055-1.422.426-2.163C9.1.873 10.794-.045 12.622.26 14.408.558 16 1.94 16 4.25c0 1.278-.954 2.575-2.44 2.734l.146.508.065.22c.203.701.412 1.455.476 2.226.142 1.707-.4 3.03-1.487 3.898C11.714 14.671 10.27 15 8.75 15h-6a.75.75 0 0 1 0-1.5h1.376a4.484 4.484 0 0 1-.563-1.191 3.835 3.835 0 0 1-.05-2.063 4.647 4.647 0 0 1-2.025-.293.75.75 0 0 1 .525-1.406c1.357.507 2.376-.006 2.698-.318l.009-.01a.747.747 0 0 1 1.06 0 .748.748 0 0 1-.012 1.074c-.912.92-.992 1.835-.768 2.586.221.74.745 1.337 1.196 1.621H8.75c1.343 0 2.398-.296 3.074-.836.635-.507 1.036-1.31.928-2.602-.05-.603-.216-1.224-.422-1.93l-.064-.221c-.12-.407-.246-.84-.353-1.29a2.425 2.425 0 0 1-.507-.441 3.075 3.075 0 0 1-.633-1.248.75.75 0 0 1 1.455-.364c.046.185.144.436.31.627.146.168.353.305.712.305.738 0 1.25-.615 1.25-1.25 0-1.47-.95-2.315-2.123-2.51-1.172-.196-2.227.387-2.706 1.345-.46.92-.27 1.774.019 3.062l.042.19a.884.884 0 0 1 .01.05c.348.443.666.949.94 1.553a.75.75 0 1 1-1.365.62c-.553-1.217-1.32-1.94-2.3-2.768L6.7 5.527c-.814-.68-1.75-1.462-2.692-2.619a3.737 3.737 0 0 0-1.023.88c-.406.495-.663 1.036-.722 1.508.116.122.306.21.591.239.388.038.797-.06 1.032-.19a.75.75 0 0 1 .728 1.31c-.515.287-1.23.439-1.906.373-.682-.067-1.473-.38-1.879-1.193L.75 5.677V5.5c0-.984.48-1.94 1.077-2.664.46-.559 1.05-1.055 1.673-1.353V.75Z"/></svg>');--md-admonition-icon--success:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"/></svg>');--md-admonition-icon--question:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.92 6.085h.001a.749.749 0 1 1-1.342-.67c.169-.339.436-.701.849-.977C6.845 4.16 7.369 4 8 4a2.756 2.756 0 0 1 1.637.525c.503.377.863.965.863 1.725 0 .448-.115.83-.329 1.15-.205.307-.47.513-.692.662-.109.072-.22.138-.313.195l-.006.004a6.24 6.24 0 0 0-.26.16.952.952 0 0 0-.276.245.75.75 0 0 1-1.248-.832c.184-.264.42-.489.692-.661.103-.067.207-.132.313-.195l.007-.004c.1-.061.182-.11.258-.161a.969.969 0 0 0 .277-.245C8.96 6.514 9 6.427 9 6.25a.612.612 0 0 0-.262-.525A1.27 1.27 0 0 0 8 5.5c-.369 0-.595.09-.74.187a1.01 1.01 0 0 0-.34.398ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"/></svg>');--md-admonition-icon--warning:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"/></svg>');--md-admonition-icon--failure:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M2.344 2.343h-.001a8 8 0 0 1 11.314 11.314A8.002 8.002 0 0 1 .234 10.089a8 8 0 0 1 2.11-7.746Zm1.06 10.253a6.5 6.5 0 1 0 9.108-9.275 6.5 6.5 0 0 0-9.108 9.275ZM6.03 4.97 8 6.94l1.97-1.97a.749.749 0 0 1 1.275.326.749.749 0 0 1-.215.734L9.06 8l1.97 1.97a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215L8 9.06l-1.97 1.97a.749.749 0 0 1-1.275-.326.749.749 0 0 1 .215-.734L6.94 8 4.97 6.03a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018Z"/></svg>');--md-admonition-icon--danger:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M9.504.43a1.516 1.516 0 0 1 2.437 1.713L10.415 5.5h2.123c1.57 0 2.346 1.909 1.22 3.004l-7.34 7.142a1.249 1.249 0 0 1-.871.354h-.302a1.25 1.25 0 0 1-1.157-1.723L5.633 10.5H3.462c-1.57 0-2.346-1.909-1.22-3.004L9.503.429Zm1.047 1.074L3.286 8.571A.25.25 0 0 0 3.462 9H6.75a.75.75 0 0 1 .694 1.034l-1.713 4.188 6.982-6.793A.25.25 0 0 0 12.538 7H9.25a.75.75 0 0 1-.683-1.06l2.008-4.418.003-.006a.036.036 0 0 0-.004-.009l-.006-.006-.008-.001c-.003 0-.006.002-.009.004Z"/></svg>');--md-admonition-icon--bug:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M4.72.22a.75.75 0 0 1 1.06 0l1 .999a3.488 3.488 0 0 1 2.441 0l.999-1a.748.748 0 0 1 1.265.332.75.75 0 0 1-.205.729l-.775.776c.616.63.995 1.493.995 2.444v.327c0 .1-.009.197-.025.292.408.14.764.392 1.029.722l1.968-.787a.75.75 0 0 1 .556 1.392L13 7.258V9h2.25a.75.75 0 0 1 0 1.5H13v.5c0 .409-.049.806-.141 1.186l2.17.868a.75.75 0 0 1-.557 1.392l-2.184-.873A4.997 4.997 0 0 1 8 16a4.997 4.997 0 0 1-4.288-2.427l-2.183.873a.75.75 0 0 1-.558-1.392l2.17-.868A5.036 5.036 0 0 1 3 11v-.5H.75a.75.75 0 0 1 0-1.5H3V7.258L.971 6.446a.75.75 0 0 1 .558-1.392l1.967.787c.265-.33.62-.583 1.03-.722a1.677 1.677 0 0 1-.026-.292V4.5c0-.951.38-1.814.995-2.444L4.72 1.28a.75.75 0 0 1 0-1.06Zm.53 6.28a.75.75 0 0 0-.75.75V11a3.5 3.5 0 1 0 7 0V7.25a.75.75 0 0 0-.75-.75ZM6.173 5h3.654A.172.172 0 0 0 10 4.827V4.5a2 2 0 1 0-4 0v.327c0 .096.077.173.173.173Z"/></svg>');--md-admonition-icon--example:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M5 5.782V2.5h-.25a.75.75 0 0 1 0-1.5h6.5a.75.75 0 0 1 0 1.5H11v3.282l3.666 5.76C15.619 13.04 14.543 15 12.767 15H3.233c-1.776 0-2.852-1.96-1.899-3.458Zm-2.4 6.565a.75.75 0 0 0 .633 1.153h9.534a.75.75 0 0 0 .633-1.153L12.225 10.5h-8.45ZM9.5 2.5h-3V6c0 .143-.04.283-.117.403L4.73 9h6.54L9.617 6.403A.746.746 0 0 1 9.5 6Z"/></svg>');--md-admonition-icon--quote:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M1.75 2.5h10.5a.75.75 0 0 1 0 1.5H1.75a.75.75 0 0 1 0-1.5Zm4 5h8.5a.75.75 0 0 1 0 1.5h-8.5a.75.75 0 0 1 0-1.5Zm0 5h8.5a.75.75 0 0 1 0 1.5h-8.5a.75.75 0 0 1 0-1.5ZM2.5 7.75v6a.75.75 0 0 1-1.5 0v-6a.75.75 0 0 1 1.5 0Z"/></svg>');}</style><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../stylesheets/extra.css><link rel=stylesheet href=https://file.cdn.shafish.cn/blog/css/vssue.css><link rel=stylesheet href=https://file.cdn.shafish.cn/blog/css/video-js.min.css><link rel=stylesheet href=https://file.cdn.shafish.cn/blog/css/video.css><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","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"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","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",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=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",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script><script>var consent;"undefined"==typeof __md_analytics||(consent=__md_get("__consent"))&&consent.analytics&&__md_analytics()</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#27devops下的shell脚本 class=md-skip> 跳转至 </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=页眉> <a href=../../.. title=DevOps运维开发 class="md-header__button md-logo" aria-label=DevOps运维开发 data-md-component=logo> <img src=../../../assets/images/logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> DevOps运维开发 </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> 27.DevOps下的Shell脚本 </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label=切换至深色模式 type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title=切换至深色模式 for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=blue data-md-color-accent=blue aria-label=切换至浅色模式 type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title=切换至浅色模式 for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg> </label> </form> <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=查找> <a href=javascript:void(0) class="md-search__icon md-icon" title=分享 aria-label=分享 data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=清空当前内容 aria-label=清空当前内容 tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> 正在初始化搜索引擎 </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/hujianli94/hujianli94.github.io title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> hujianli94.github.io </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=标签 data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> 首页 </a> </li> <li class=md-tabs__item> <a href=../../../k8s/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.k8s/ class=md-tabs__link> k8s </a> </li> <li class=md-tabs__item> <a href=../../../K8s-network/0.network-namespace/1.network-namespace/ class=md-tabs__link> K8s-network </a> </li> <li class=md-tabs__item> <a href=../../../Kubernetes/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Kubernetes/ class=md-tabs__link> Kubernetes </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../../0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Docker/ class=md-tabs__link> Docker </a> </li> <li class=md-tabs__item> <a href=../../../Golang/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Go-Web%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98/ class=md-tabs__link> Golang </a> </li> <li class=md-tabs__item> <a href=../../../Python/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Pythjon-auto-ops/ class=md-tabs__link> Python </a> </li> <li class=md-tabs__item> <a href=../../../Openstack/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.OpenStack/ class=md-tabs__link> Openstack </a> </li> <li class=md-tabs__item> <a href=../../../Python-vs-Go/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Python-vs-Go/ class=md-tabs__link> Python-vs-Go </a> </li> <li class=md-tabs__item> <a href=../../../Linux/Shell/Shell%E7%AE%80%E4%BB%8B/ class=md-tabs__link> Linux </a> </li> <li class=md-tabs__item> <a href=../../../Other/tools/1.PicGo%E5%9B%BE%E5%BA%8A/ class=md-tabs__link> Other </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=导航栏 data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title=DevOps运维开发 class="md-nav__button md-logo" aria-label=DevOps运维开发 data-md-component=logo> <img src=../../../assets/images/logo.png alt=logo> </a> DevOps运维开发 </label> <div class=md-nav__source> <a href=https://github.com/hujianli94/hujianli94.github.io title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> hujianli94.github.io </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> <span class=md-ellipsis> 首页 </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> k8s </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> k8s </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_1> <label class=md-nav__link for=__nav_2_1 id=__nav_2_1_label tabindex=0> <span class=md-ellipsis> 0.学习线路 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_1_label aria-expanded=false> <label class=md-nav__title for=__nav_2_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.k8s/ class=md-nav__link> <span class=md-ellipsis> Kubernetes从入门到实践 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2> <label class=md-nav__link for=__nav_2_2 id=__nav_2_2_label tabindex=0> <span class=md-ellipsis> 1.容器的发展史 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2> <span class="md-nav__icon md-icon"></span> 1.容器的发展史 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/1.%E5%AE%B9%E5%99%A8%E7%9A%84%E5%8F%91%E5%B1%95%E5%8F%B2/1.1%E5%BC%80%E5%8F%91%E8%BF%87%E7%A8%8B%E7%9A%84%E5%8F%91%E5%B1%95/ class=md-nav__link> <span class=md-ellipsis> 1.1开发过程的发展 </span> </a> </li> <li class=md-nav__item> <a href=../../../k8s/1.%E5%AE%B9%E5%99%A8%E7%9A%84%E5%8F%91%E5%B1%95%E5%8F%B2/1.2%E5%BA%94%E7%94%A8%E6%9E%B6%E6%9E%84%E7%9A%84%E5%8F%91%E5%B1%95/ class=md-nav__link> <span class=md-ellipsis> 1.2应用架构的发展 </span> </a> </li> <li class=md-nav__item> <a href=../../../k8s/1.%E5%AE%B9%E5%99%A8%E7%9A%84%E5%8F%91%E5%B1%95%E5%8F%B2/1.3%E9%83%A8%E7%BD%B2%E6%89%93%E5%8C%85%E7%9A%84%E5%8F%91%E5%B1%95/ class=md-nav__link> <span class=md-ellipsis> 1.3部署打包的发展 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_3> <label class=md-nav__link for=__nav_2_3 id=__nav_2_3_label tabindex=0> <span class=md-ellipsis> 2.Kubernetes的核心概念 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_3_label aria-expanded=false> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> 2.Kubernetes的核心概念 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/2.Kubernetes%E7%9A%84%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/2.1Kubernetes%E7%9A%84%E8%AE%BE%E8%AE%A1%E6%9E%B6%E6%9E%84/ class=md-nav__link> <span class=md-ellipsis> 2.1Kubernetes的设计架构 </span> </a> </li> <li class=md-nav__item> <a href=../../../k8s/2.Kubernetes%E7%9A%84%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/2.2Kubernetes%E7%9A%84%E6%A0%B8%E5%BF%83%E5%AF%B9%E8%B1%A1/ class=md-nav__link> <span class=md-ellipsis> 2.2Kubernetes的核心对象 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_4> <label class=md-nav__link for=__nav_2_4 id=__nav_2_4_label tabindex=0> <span class=md-ellipsis> 3.Kubernetes的安装和部署 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_4_label aria-expanded=false> <label class=md-nav__title for=__nav_2_4> <span class="md-nav__icon md-icon"></span> 3.Kubernetes的安装和部署 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/3.Kubernetes%E7%9A%84%E5%AE%89%E8%A3%85%E5%92%8C%E9%83%A8%E7%BD%B2/3.1kubeadm%E6%90%AD%E5%BB%BA%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/ class=md-nav__link> <span class=md-ellipsis> 3.1kubeadm搭建开发环境 </span> </a> </li> <li class=md-nav__item> <a href=../../../k8s/3.Kubernetes%E7%9A%84%E5%AE%89%E8%A3%85%E5%92%8C%E9%83%A8%E7%BD%B2/3.2kubeadm%E6%90%AD%E5%BB%BA%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83/ class=md-nav__link> <span class=md-ellipsis> 3.2kubeadm搭建生产环境 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_5> <label class=md-nav__link for=__nav_2_5 id=__nav_2_5_label tabindex=0> <span class=md-ellipsis> 4.Pod </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_5_label aria-expanded=false> <label class=md-nav__title for=__nav_2_5> <span class="md-nav__icon md-icon"></span> 4.Pod </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/4.Pod/4.1Pod%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/ class=md-nav__link> <span class=md-ellipsis> 4.1Pod的基本操作 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_6> <label class=md-nav__link for=__nav_2_6 id=__nav_2_6_label tabindex=0> <span class=md-ellipsis> 5.控制器 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_6_label aria-expanded=false> <label class=md-nav__title for=__nav_2_6> <span class="md-nav__icon md-icon"></span> 5.控制器 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/5.%E6%8E%A7%E5%88%B6%E5%99%A8/5.1Deployment/ class=md-nav__link> <span class=md-ellipsis> 5.1Deployment </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> K8s-network </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> K8s-network </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1> <label class=md-nav__link for=__nav_3_1 id=__nav_3_1_label tabindex=0> <span class=md-ellipsis> 0.network-namespace </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_1_label aria-expanded=false> <label class=md-nav__title for=__nav_3_1> <span class="md-nav__icon md-icon"></span> 0.network-namespace </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../K8s-network/0.network-namespace/1.network-namespace/ class=md-nav__link> <span class=md-ellipsis> 1.network-namespace </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> Kubernetes </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_1> <label class=md-nav__link for=__nav_4_1 id=__nav_4_1_label tabindex=0> <span class=md-ellipsis> 0.学习线路 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_1_label aria-expanded=false> <label class=md-nav__title for=__nav_4_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Kubernetes/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Kubernetes/ class=md-nav__link> <span class=md-ellipsis> Kubernetes </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_2> <label class=md-nav__link for=__nav_4_2 id=__nav_4_2_label tabindex=0> <span class=md-ellipsis> 1.安装篇 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_2_label aria-expanded=false> <label class=md-nav__title for=__nav_4_2> <span class="md-nav__icon md-icon"></span> 1.安装篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/1.Kubeadm%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/ class=md-nav__link> <span class=md-ellipsis> Kubeadm安装高可用集群 </span> </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/2.%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/ class=md-nav__link> <span class=md-ellipsis> 二进制安装高可用K8s集群 </span> </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/3.%E5%AE%89%E8%A3%85%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/ class=md-nav__link> <span class=md-ellipsis> 安装常用工具 </span> </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/4.Kubeadm%E5%AE%89%E8%A3%85%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/ class=md-nav__link> <span class=md-ellipsis> Kubeadm安装开发环境 </span> </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/5.K3s%E5%92%8CMinikube/ class=md-nav__link> <span class=md-ellipsis> K3s和Minikube </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_3> <label class=md-nav__link for=__nav_4_3 id=__nav_4_3_label tabindex=0> <span class=md-ellipsis> 2.基础篇 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_3_label aria-expanded=false> <label class=md-nav__title for=__nav_4_3> <span class="md-nav__icon md-icon"></span> 2.基础篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/3.Docker%E5%9F%BA%E7%A1%80/ class=md-nav__link> <span class=md-ellipsis> Docker基础 </span> </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Kubernetes%E7%9A%84%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/ class=md-nav__link> <span class=md-ellipsis> Kubernetes的基础概念 </span> </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Kubernetes%E8%B0%83%E5%BA%A6%E5%9F%BA%E7%A1%80/ class=md-nav__link> <span class=md-ellipsis> Kubernetes调度基础 </span> </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/6.Kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83%E5%9F%BA%E7%A1%80/ class=md-nav__link> <span class=md-ellipsis> Kubernetes服务发布基础 </span> </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/7.Kubernetes%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> Kubernetes配置管理 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_4> <label class=md-nav__link for=__nav_4_4 id=__nav_4_4_label tabindex=0> <span class=md-ellipsis> 3.进阶篇 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4_4> <span class="md-nav__icon md-icon"></span> 3.进阶篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Kubernetes/3.%E8%BF%9B%E9%98%B6%E7%AF%87/8.Kubernetes%E5%AD%98%E5%82%A8%E5%85%A5%E9%97%A8/ class=md-nav__link> <span class=md-ellipsis> Kubernetes存储入门 </span> </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/3.%E8%BF%9B%E9%98%B6%E7%AF%87/9.Kubernetes%E9%AB%98%E7%BA%A7%E8%B0%83%E5%BA%A6/ class=md-nav__link> <span class=md-ellipsis> Kubernetes高级调度 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_5> <label class=md-nav__link for=__nav_4_5 id=__nav_4_5_label tabindex=0> <span class=md-ellipsis> 4.高级篇 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_5_label aria-expanded=false> <label class=md-nav__title for=__nav_4_5> <span class="md-nav__icon md-icon"></span> 4.高级篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Kubernetes/4.%E9%AB%98%E7%BA%A7%E7%AF%87/12.%E4%BA%91%E5%8E%9F%E7%94%9F%E5%AD%98%E5%82%A8Rook/ class=md-nav__link> <span class=md-ellipsis> 云原生存储Rook </span> </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/4.%E9%AB%98%E7%BA%A7%E7%AF%87/13.%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%AE%B9%E5%99%A8%E5%8C%96/ class=md-nav__link> <span class=md-ellipsis> 中间件容器化 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_6> <label class=md-nav__link for=__nav_4_6 id=__nav_4_6_label tabindex=0> <span class=md-ellipsis> 5.运维篇 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_6_label aria-expanded=false> <label class=md-nav__title for=__nav_4_6> <span class="md-nav__icon md-icon"></span> 5.运维篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/14.Kubernetes%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/ class=md-nav__link> <span class=md-ellipsis> Kubernetes日志收集 </span> </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/15.Kubernetes%E7%9B%91%E6%8E%A7%E5%91%8A%E8%AD%A6/ class=md-nav__link> <span class=md-ellipsis> Kubernetes监控告警 </span> </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/16.%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83Ingress%E8%BF%9B%E9%98%B6/ class=md-nav__link> <span class=md-ellipsis> 服务发布Ingress进阶 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_7> <label class=md-nav__link for=__nav_4_7 id=__nav_4_7_label tabindex=0> <span class=md-ellipsis> 6.DevOps篇 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_7_label aria-expanded=false> <label class=md-nav__title for=__nav_4_7> <span class="md-nav__icon md-icon"></span> 6.DevOps篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/ class=md-nav__link> <span class=md-ellipsis> DevOps实践 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5 checked> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex> <span class=md-ellipsis> Docker </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=true> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Docker </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_1> <label class=md-nav__link for=__nav_5_1 id=__nav_5_1_label tabindex=0> <span class=md-ellipsis> 0.学习线路 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_1_label aria-expanded=false> <label class=md-nav__title for=__nav_5_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Docker/ class=md-nav__link> <span class=md-ellipsis> Docker </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_2> <label class=md-nav__link for=__nav_5_2 id=__nav_5_2_label tabindex=0> <span class=md-ellipsis> 1.基础 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_2_label aria-expanded=false> <label class=md-nav__title for=__nav_5_2> <span class="md-nav__icon md-icon"></span> 1.基础 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../1.%E5%9F%BA%E7%A1%80/1.%E5%AE%89%E8%A3%85Docker/ class=md-nav__link> <span class=md-ellipsis> 1.安装Docker </span> </a> </li> <li class=md-nav__item> <a href=../../1.%E5%9F%BA%E7%A1%80/2.Docker%E9%95%9C%E5%83%8F/ class=md-nav__link> <span class=md-ellipsis> 2.Docker 镜像 </span> </a> </li> <li class=md-nav__item> <a href=../../1.%E5%9F%BA%E7%A1%80/3.Docker%E5%AE%B9%E5%99%A8/ class=md-nav__link> <span class=md-ellipsis> 3.Docker容器 </span> </a> </li> <li class=md-nav__item> <a href=../../1.%E5%9F%BA%E7%A1%80/4.%E4%BC%81%E4%B8%9A%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93harbor/ class=md-nav__link> <span class=md-ellipsis> 4.企业私有仓库harbor </span> </a> </li> <li class=md-nav__item> <a href=../../1.%E5%9F%BA%E7%A1%80/5.Docker%E6%95%B0%E6%8D%AE/ class=md-nav__link> <span class=md-ellipsis> 5.Docker数据 </span> </a> </li> <li class=md-nav__item> <a href=../../1.%E5%9F%BA%E7%A1%80/6.Docker%E7%BD%91%E7%BB%9C/ class=md-nav__link> <span class=md-ellipsis> 6.Docker网络 </span> </a> </li> <li class=md-nav__item> <a href=../../1.%E5%9F%BA%E7%A1%80/7.Dockerfile/ class=md-nav__link> <span class=md-ellipsis> 7.Dockerfile </span> </a> </li> <li class=md-nav__item> <a href=../../1.%E5%9F%BA%E7%A1%80/8.docker-compose/ class=md-nav__link> <span class=md-ellipsis> 8.docker-compose </span> </a> </li> <li class=md-nav__item> <a href=../../1.%E5%9F%BA%E7%A1%80/9.Docker%E7%9B%B8%E5%85%B3%E8%84%9A%E6%9C%AC/ class=md-nav__link> <span class=md-ellipsis> 9.Docker相关脚本 </span> </a> </li> <li class=md-nav__item> <a href=../../1.%E5%9F%BA%E7%A1%80/10.Docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/ class=md-nav__link> <span class=md-ellipsis> 10.Docker常用命令 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_3> <label class=md-nav__link for=__nav_5_3 id=__nav_5_3_label tabindex=0> <span class=md-ellipsis> 2.实战案例 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_3_label aria-expanded=false> <label class=md-nav__title for=__nav_5_3> <span class="md-nav__icon md-icon"></span> 2.实战案例 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/1.%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/ class=md-nav__link> <span class=md-ellipsis> 1.操作系统 </span> </a> </li> <li class=md-nav__item> <a href=../../2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/2.Web%E6%9C%8D%E5%8A%A1%E4%B8%8E%E5%BA%94%E7%94%A8/ class=md-nav__link> <span class=md-ellipsis> 2.Web服务与应用 </span> </a> </li> <li class=md-nav__item> <a href=../../2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/3.%E6%8C%81%E7%BB%AD%E5%BC%80%E5%8F%91%E4%B8%8E%E7%AE%A1%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 3.持续开发与管理 </span> </a> </li> <li class=md-nav__item> <a href=../../2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/4.%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BA%94%E7%94%A8/ class=md-nav__link> <span class=md-ellipsis> 4.数据库应用 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_4 checked> <label class=md-nav__link for=__nav_5_4 id=__nav_5_4_label tabindex=0> <span class=md-ellipsis> 3.Devops </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_4_label aria-expanded=true> <label class=md-nav__title for=__nav_5_4> <span class="md-nav__icon md-icon"></span> 3.Devops </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../1.confcenter-docker/ class=md-nav__link> <span class=md-ellipsis> 1.confcenter-docker </span> </a> </li> <li class=md-nav__item> <a href=../2.simaple-jenkins/ class=md-nav__link> <span class=md-ellipsis> 2.simaple-jenkins </span> </a> </li> <li class=md-nav__item> <a href=../3.docker-nginx-spa/ class=md-nav__link> <span class=md-ellipsis> 3.docker-nginx-spa </span> </a> </li> <li class=md-nav__item> <a href=../4.fileserver-docker/ class=md-nav__link> <span class=md-ellipsis> 4.fileserver-docker </span> </a> </li> <li class=md-nav__item> <a href=../5.haproxy-docker/ class=md-nav__link> <span class=md-ellipsis> 5.haproxy-docker </span> </a> </li> <li class=md-nav__item> <a href=../6.mysql-docker/ class=md-nav__link> <span class=md-ellipsis> 6.mysql-docker </span> </a> </li> <li class=md-nav__item> <a href=../7.frp-docker/ class=md-nav__link> <span class=md-ellipsis> 7.frp-docker </span> </a> </li> <li class=md-nav__item> <a href=../8.coredns-docker/ class=md-nav__link> <span class=md-ellipsis> 8.coredns-docker </span> </a> </li> <li class=md-nav__item> <a href=../9.simple-harbor/ class=md-nav__link> <span class=md-ellipsis> 9.simple-harbor </span> </a> </li> <li class=md-nav__item> <a href=../10.redis-docker/ class=md-nav__link> <span class=md-ellipsis> 10.redis-docker </span> </a> </li> <li class=md-nav__item> <a href=../11.nexus3-docker/ class=md-nav__link> <span class=md-ellipsis> 11.nexus3-docker </span> </a> </li> <li class=md-nav__item> <a href=../12.openvpn-docker/ class=md-nav__link> <span class=md-ellipsis> 12.openvpn-docker.md </span> </a> </li> <li class=md-nav__item> <a href=../13.nfs-docker/ class=md-nav__link> <span class=md-ellipsis> 13.nfs-docker </span> </a> </li> <li class=md-nav__item> <a href=../14.jumpserver-docker/ class=md-nav__link> <span class=md-ellipsis> 14.jumpserver-docker.md </span> </a> </li> <li class=md-nav__item> <a href=../15.ansible-docker/ class=md-nav__link> <span class=md-ellipsis> 15.ansible-docker </span> </a> </li> <li class=md-nav__item> <a href=../16.minio-docker/ class=md-nav__link> <span class=md-ellipsis> 16.minio-docker </span> </a> </li> <li class=md-nav__item> <a href=../17.vaultwarden-docker/ class=md-nav__link> <span class=md-ellipsis> 17.vaultwarden-docker </span> </a> </li> <li class=md-nav__item> <a href=../18.kasm-docker/ class=md-nav__link> <span class=md-ellipsis> 18.kasm-docker </span> </a> </li> <li class=md-nav__item> <a href=../19.nginx-docker/ class=md-nav__link> <span class=md-ellipsis> 19.nginx-docker </span> </a> </li> <li class=md-nav__item> <a href=../20.kafka-docker/ class=md-nav__link> <span class=md-ellipsis> 20.kafka-docker </span> </a> </li> <li class=md-nav__item> <a href=../21.golang-docker/ class=md-nav__link> <span class=md-ellipsis> 21.golang-docker </span> </a> </li> <li class=md-nav__item> <a href=../22.postgres-docker/ class=md-nav__link> <span class=md-ellipsis> 22.postgres-docker </span> </a> </li> <li class=md-nav__item> <a href=../23.nginx-download-docker/ class=md-nav__link> <span class=md-ellipsis> 23.nginx-download-docker </span> </a> </li> <li class=md-nav__item> <a href=../24.helm%E9%83%A8%E7%BD%B2%E5%B8%B8%E7%94%A8%E6%9C%8D%E5%8A%A1/ class=md-nav__link> <span class=md-ellipsis> 24.helm部署常用服务 </span> </a> </li> <li class=md-nav__item> <a href=../25.Python%E6%93%8D%E4%BD%9CDocker/ class=md-nav__link> <span class=md-ellipsis> 25.Python操作Docker </span> </a> </li> <li class=md-nav__item> <a href=../26.docker-compose-devops/ class=md-nav__link> <span class=md-ellipsis> 26.docker-compose-devops </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> 27.DevOps下的Shell脚本 </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> 27.DevOps下的Shell脚本 </span> </a> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#生产环境下的备份类脚本 class=md-nav__link> <span class=md-ellipsis> 生产环境下的备份类脚本 </span> </a> <nav class=md-nav aria-label=生产环境下的备份类脚本> <ul class=md-nav__list> <li class=md-nav__item> <a href=#版本控制软件svn的代码库的备份脚本 class=md-nav__link> <span class=md-ellipsis> 版本控制软件SVN的代码库的备份脚本 </span> </a> </li> <li class=md-nav__item> <a href=#备份文件shell脚本 class=md-nav__link> <span class=md-ellipsis> 备份文件shell脚本 </span> </a> </li> <li class=md-nav__item> <a href=#mysql数据库备份至s3文件系统 class=md-nav__link> <span class=md-ellipsis> Mysql数据库备份至S3文件系统 </span> </a> </li> <li class=md-nav__item> <a href=#mysql定时备份脚本 class=md-nav__link> <span class=md-ellipsis> mysql定时备份脚本 </span> </a> </li> <li class=md-nav__item> <a href=#mysql数据库分库备份 class=md-nav__link> <span class=md-ellipsis> MySQL数据库分库备份 </span> </a> </li> <li class=md-nav__item> <a href=#mysql数据库分库分表备份 class=md-nav__link> <span class=md-ellipsis> MySQL数据库分库分表备份 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#生产环境下的统计类脚本 class=md-nav__link> <span class=md-ellipsis> 生产环境下的统计类脚本 </span> </a> <nav class=md-nav aria-label=生产环境下的统计类脚本> <ul class=md-nav__list> <li class=md-nav__item> <a href=#统计设备资产明细脚本 class=md-nav__link> <span class=md-ellipsis> 统计设备资产明细脚本 </span> </a> </li> <li class=md-nav__item> <a href=#统计重要业务程序是否正常运行 class=md-nav__link> <span class=md-ellipsis> 统计重要业务程序是否正常运行 </span> </a> </li> <li class=md-nav__item> <a href=#统计机器的ip连接数 class=md-nav__link> <span class=md-ellipsis> 统计机器的IP连接数 </span> </a> </li> <li class=md-nav__item> <a href=#修改ip_主机名_网卡信息脚本 class=md-nav__link> <span class=md-ellipsis> 修改IP_主机名_网卡信息脚本 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#生产环境下的监控类脚本 class=md-nav__link> <span class=md-ellipsis> 生产环境下的监控类脚本 </span> </a> <nav class=md-nav aria-label=生产环境下的监控类脚本> <ul class=md-nav__list> <li class=md-nav__item> <a href=#监控nginx进程的脚本 class=md-nav__link> <span class=md-ellipsis> 监控Nginx进程的脚本 </span> </a> </li> <li class=md-nav__item> <a href=#监控httpd服务状态脚本 class=md-nav__link> <span class=md-ellipsis> 监控httpd服务状态脚本 </span> </a> </li> <li class=md-nav__item> <a href=#监控mysql数据库示例 class=md-nav__link> <span class=md-ellipsis> 监控mysql数据库示例 </span> </a> </li> <li class=md-nav__item> <a href=#系统文件数打开监控脚本 class=md-nav__link> <span class=md-ellipsis> 系统文件数打开监控脚本 </span> </a> </li> <li class=md-nav__item> <a href=#监控机器cpu利用率脚本 class=md-nav__link> <span class=md-ellipsis> 监控机器CPU利用率脚本 </span> </a> </li> <li class=md-nav__item> <a href=#monitor_linux系统性能 class=md-nav__link> <span class=md-ellipsis> monitor_Linux系统性能 </span> </a> </li> <li class=md-nav__item> <a href=#监控服务器主要性能参数指标 class=md-nav__link> <span class=md-ellipsis> 监控服务器主要性能参数指标 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#生产环境下运维开发类脚本 class=md-nav__link> <span class=md-ellipsis> 生产环境下运维开发类脚本 </span> </a> <nav class=md-nav aria-label=生产环境下运维开发类脚本> <ul class=md-nav__list> <li class=md-nav__item> <a href=#系统初始化脚本centos6 class=md-nav__link> <span class=md-ellipsis> 系统初始化脚本Centos6 </span> </a> </li> <li class=md-nav__item> <a href=#系统初始化脚本centos7 class=md-nav__link> <span class=md-ellipsis> 系统初始化脚本Centos7 </span> </a> </li> <li class=md-nav__item> <a href=#控制shell多进程数量的脚本 class=md-nav__link> <span class=md-ellipsis> 控制shell多进程数量的脚本 </span> </a> </li> <li class=md-nav__item> <a href=#手动建立软raid级别需求 class=md-nav__link> <span class=md-ellipsis> 手动建立软Raid级别需求 </span> </a> </li> <li class=md-nav__item> <a href=#在脚本中修改crontab class=md-nav__link> <span class=md-ellipsis> 在脚本中修改crontab </span> </a> </li> <li class=md-nav__item> <a href=#字符串处理完整脚本 class=md-nav__link> <span class=md-ellipsis> 字符串处理完整脚本 </span> </a> </li> <li class=md-nav__item> <a href=#设置锁文件防止脚本重复执行 class=md-nav__link> <span class=md-ellipsis> 设置锁文件防止脚本重复执行 </span> </a> </li> <li class=md-nav__item> <a href=#修改sshd配置文件 class=md-nav__link> <span class=md-ellipsis> 修改sshd配置文件 </span> </a> </li> <li class=md-nav__item> <a href=#多种test的写法 class=md-nav__link> <span class=md-ellipsis> 多种test的写法 </span> </a> </li> <li class=md-nav__item> <a href=#color输出 class=md-nav__link> <span class=md-ellipsis> color输出 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#一些常用的函数 class=md-nav__link> <span class=md-ellipsis> 一些常用的函数 </span> </a> </li> <li class=md-nav__item> <a href=#linux下function函数库参考 class=md-nav__link> <span class=md-ellipsis> Linux下function函数库参考 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../28.Devops%E4%B8%8B%E7%9A%84Python%E8%84%9A%E6%9C%AC/ class=md-nav__link> <span class=md-ellipsis> 28.Devops下的Python脚本 </span> </a> </li> <li class=md-nav__item> <a href=../29.Vagrant%E8%99%9A%E6%8B%9F%E6%9C%BA/ class=md-nav__link> <span class=md-ellipsis> 29.Vagrant虚拟机 </span> </a> </li> <li class=md-nav__item> <a href=../30.VMware-workstation/ class=md-nav__link> <span class=md-ellipsis> 30.VMware Workstation </span> </a> </li> <li class=md-nav__item> <a href=../31.VirtualBox/ class=md-nav__link> <span class=md-ellipsis> 31.VirtualBox </span> </a> </li> <li class=md-nav__item> <a href=../32.Devops%E7%9B%B8%E5%85%B3%E5%AD%98%E5%82%A8%E5%BA%93/ class=md-nav__link> <span class=md-ellipsis> 32.Devops相关存储库 </span> </a> </li> <li class=md-nav__item> <a href=../33.terraform%E6%A6%82%E8%BF%B0/ class=md-nav__link> <span class=md-ellipsis> 33.terraform概述 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> <span class=md-ellipsis> Golang </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Golang </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_1> <label class=md-nav__link for=__nav_6_1 id=__nav_6_1_label tabindex=0> <span class=md-ellipsis> 0.学习线路 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_1_label aria-expanded=false> <label class=md-nav__title for=__nav_6_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Go-Web%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98/ class=md-nav__link> <span class=md-ellipsis> Go Web开发实战 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_2> <label class=md-nav__link for=__nav_6_2 id=__nav_6_2_label tabindex=0> <span class=md-ellipsis> 1.Go基础 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_2_label aria-expanded=false> <label class=md-nav__title for=__nav_6_2> <span class="md-nav__icon md-icon"></span> 1.Go基础 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/1.Go%E5%9F%BA%E7%A1%80/1.%E5%AE%89%E8%A3%85Go/ class=md-nav__link> <span class=md-ellipsis> 安装 Go </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/1.Go%E5%9F%BA%E7%A1%80/2.%E7%AC%AC%E4%B8%80%E4%B8%AAGo%E7%A8%8B%E5%BA%8F/ class=md-nav__link> <span class=md-ellipsis> 第一个Go程序 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/ class=md-nav__link> <span class=md-ellipsis> Go 基础语法 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/1.Go%E5%9F%BA%E7%A1%80/4.Go-Module/ class=md-nav__link> <span class=md-ellipsis> Go Module </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/1.Go%E5%9F%BA%E7%A1%80/5.Go-%E6%A0%87%E5%87%86%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84/ class=md-nav__link> <span class=md-ellipsis> Go 标准目录结构 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_3> <label class=md-nav__link for=__nav_6_3 id=__nav_6_3_label tabindex=0> <span class=md-ellipsis> 2.Go-Web基础 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_3_label aria-expanded=false> <label class=md-nav__title for=__nav_6_3> <span class="md-nav__icon md-icon"></span> 2.Go-Web基础 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/2.Go-Web%E5%9F%BA%E7%A1%80/5.%E7%AC%AC%E4%B8%80%E4%B8%AAGo-Web%E7%A8%8B%E5%BA%8F/ class=md-nav__link> <span class=md-ellipsis> 第一个Go Web程序 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/2.Go-Web%E5%9F%BA%E7%A1%80/6.Web%E7%A8%8B%E5%BA%8F%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86%E7%AE%80%E4%BB%8B/ class=md-nav__link> <span class=md-ellipsis> Web程序运行原理简介 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/2.Go-Web%E5%9F%BA%E7%A1%80/7.net-http%E5%8C%85/ class=md-nav__link> <span class=md-ellipsis> net/http包 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/2.Go-Web%E5%9F%BA%E7%A1%80/8.html-template%E5%8C%85/ class=md-nav__link> <span class=md-ellipsis> html/template包 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_4> <label class=md-nav__link for=__nav_6_4 id=__nav_6_4_label tabindex=0> <span class=md-ellipsis> 3.Go-Web请求处理 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_4_label aria-expanded=false> <label class=md-nav__title for=__nav_6_4> <span class="md-nav__icon md-icon"></span> 3.Go-Web请求处理 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/3.Go-Web%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/9.%E7%AE%80%E5%8D%95Web%E6%9C%8D%E5%8A%A1%E5%99%A8/ class=md-nav__link> <span class=md-ellipsis> 简单Web服务器 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/3.Go-Web%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/10.%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82/ class=md-nav__link> <span class=md-ellipsis> 处理请求 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/3.Go-Web%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/11.session%E5%92%8Ccookie/ class=md-nav__link> <span class=md-ellipsis> session和cookie </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_5> <label class=md-nav__link for=__nav_6_5 id=__nav_6_5_label tabindex=0> <span class=md-ellipsis> 4.Go访问数据库 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_5_label aria-expanded=false> <label class=md-nav__title for=__nav_6_5> <span class="md-nav__icon md-icon"></span> 4.Go访问数据库 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/12.Go%E6%93%8D%E4%BD%9CMySQL/ class=md-nav__link> <span class=md-ellipsis> Go操作MySQL </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/13.Go%E6%93%8D%E4%BD%9CRedis/ class=md-nav__link> <span class=md-ellipsis> Go操作Redis </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/14.Go%E6%93%8D%E4%BD%9CMongoDB/ class=md-nav__link> <span class=md-ellipsis> Go操作MongoDB </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/15.Go%E7%9A%84%E5%B8%B8%E8%A7%81ORM%E5%BA%93/ class=md-nav__link> <span class=md-ellipsis> Go的常见ORM库 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/16.Go%E6%93%8D%E4%BD%9CSQLite/ class=md-nav__link> <span class=md-ellipsis> Go操作SQLite </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_6> <label class=md-nav__link for=__nav_6_6 id=__nav_6_6_label tabindex=0> <span class=md-ellipsis> 5.Go高级网络编程 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6_6> <span class="md-nav__icon md-icon"></span> 5.Go高级网络编程 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/5.Go%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/17.Go-Socket%E7%BC%96%E7%A8%8B/ class=md-nav__link> <span class=md-ellipsis> Go Socket编程 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/5.Go%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/18.Go-RPC%E7%BC%96%E7%A8%8B/ class=md-nav__link> <span class=md-ellipsis> Go RPC编程 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/5.Go%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/19.Go-%E5%BE%AE%E6%9C%8D%E5%8A%A1/ class=md-nav__link> <span class=md-ellipsis> Go 微服务 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_7> <label class=md-nav__link for=__nav_6_7 id=__nav_6_7_label tabindex=0> <span class=md-ellipsis> 6.Go文件处理 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_7_label aria-expanded=false> <label class=md-nav__title for=__nav_6_7> <span class="md-nav__icon md-icon"></span> 6.Go文件处理 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/20.%E5%A4%84%E7%90%86%E7%9B%AE%E5%BD%95%E4%B8%8E%E6%96%87%E4%BB%B6/ class=md-nav__link> <span class=md-ellipsis> 处理目录与文件 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/21.%E5%A4%84%E7%90%86XML%E6%96%87%E4%BB%B6/ class=md-nav__link> <span class=md-ellipsis> 处理XML文件 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/22.%E5%A4%84%E7%90%86JSON%E6%96%87%E4%BB%B6/ class=md-nav__link> <span class=md-ellipsis> 处理JSON文件 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/23.%E5%A4%84%E7%90%86CSV%E6%96%87%E4%BB%B6/ class=md-nav__link> <span class=md-ellipsis> 处理CSV文件 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/24.%E5%A4%84%E7%90%86Go%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95/ class=md-nav__link> <span class=md-ellipsis> 处理Go日志记录 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/25.%E5%A4%84%E7%90%86%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 处理正则表达式 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/26.%E5%A4%84%E7%90%86Excel%E6%96%87%E4%BB%B6/ class=md-nav__link> <span class=md-ellipsis> 处理Excel文件 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_8> <label class=md-nav__link for=__nav_6_8 id=__nav_6_8_label tabindex=0> <span class=md-ellipsis> 7.Go并发编程 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_8_label aria-expanded=false> <label class=md-nav__title for=__nav_6_8> <span class="md-nav__icon md-icon"></span> 7.Go并发编程 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/26.%E5%B9%B6%E5%8F%91-%E5%B9%B6%E8%A1%8C/ class=md-nav__link> <span class=md-ellipsis> 并发 并行 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/27.%E8%BF%9B%E7%A8%8B-%E7%BA%BF%E7%A8%8B-%E5%8D%8F%E7%A8%8B/ class=md-nav__link> <span class=md-ellipsis> 进程 线程 协程 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/28.Go%E5%B9%B6%E5%8F%91%E6%A8%A1%E5%9E%8B/ class=md-nav__link> <span class=md-ellipsis> Go并发模型 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/29.goroutine%E5%92%8Cchannel/ class=md-nav__link> <span class=md-ellipsis> goroutine和channel </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/30.sync%E5%AE%9E%E7%8E%B0%E5%B9%B6%E5%8F%91/ class=md-nav__link> <span class=md-ellipsis> sync实现并发 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/31.Go%E5%B9%B6%E5%8F%91%E7%9A%84Web%E5%BA%94%E7%94%A8/ class=md-nav__link> <span class=md-ellipsis> Go并发的Web应用 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_9> <label class=md-nav__link for=__nav_6_9 id=__nav_6_9_label tabindex=0> <span class=md-ellipsis> 8.Go标准库 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_9_label aria-expanded=false> <label class=md-nav__title for=__nav_6_9> <span class="md-nav__icon md-icon"></span> 8.Go标准库 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/32.time/ class=md-nav__link> <span class=md-ellipsis> time </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/33.strings/ class=md-nav__link> <span class=md-ellipsis> strings </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/34.bytes/ class=md-nav__link> <span class=md-ellipsis> bytes </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/35.json/ class=md-nav__link> <span class=md-ellipsis> json </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/36.io-bufio/ class=md-nav__link> <span class=md-ellipsis> io/bufio </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/37.fmt/ class=md-nav__link> <span class=md-ellipsis> fmt </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/38.strconv/ class=md-nav__link> <span class=md-ellipsis> strconv </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/39.regexp/ class=md-nav__link> <span class=md-ellipsis> regexp </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/40.log/ class=md-nav__link> <span class=md-ellipsis> log </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/41.reflect-unsafe/ class=md-nav__link> <span class=md-ellipsis> reflect/unsafe </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/42.os-path-filepath/ class=md-nav__link> <span class=md-ellipsis> os/path/filepath </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/43.unicode/ class=md-nav__link> <span class=md-ellipsis> unicode </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/44.flag/ class=md-nav__link> <span class=md-ellipsis> flag </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/45.net-url/ class=md-nav__link> <span class=md-ellipsis> net/url </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/46.net-http/ class=md-nav__link> <span class=md-ellipsis> net/http </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/47.sort/ class=md-nav__link> <span class=md-ellipsis> sort </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/48.errors/ class=md-nav__link> <span class=md-ellipsis> errors </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_10> <label class=md-nav__link for=__nav_6_10 id=__nav_6_10_label tabindex=0> <span class=md-ellipsis> 9.Go三方库 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_10_label aria-expanded=false> <label class=md-nav__title for=__nav_6_10> <span class="md-nav__icon md-icon"></span> 9.Go三方库 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/0.%E5%BC%80%E6%BA%90%E8%87%AA%E5%B7%B1%E7%9A%84Go%E5%BA%93/ class=md-nav__link> <span class=md-ellipsis> 开源自己的Go库 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/1.cobra/ class=md-nav__link> <span class=md-ellipsis> Cobra </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/2.viper/ class=md-nav__link> <span class=md-ellipsis> Viper </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/3.Zap/ class=md-nav__link> <span class=md-ellipsis> Zap </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/4.mahonia/ class=md-nav__link> <span class=md-ellipsis> mahonia </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/5.ssh/ class=md-nav__link> <span class=md-ellipsis> ssh </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/6.fsnotify/ class=md-nav__link> <span class=md-ellipsis> fsnotify </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/7.yaml/ class=md-nav__link> <span class=md-ellipsis> yaml </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/8.tail/ class=md-nav__link> <span class=md-ellipsis> tail </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/9.gRPC/ class=md-nav__link> <span class=md-ellipsis> gRPC </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/10.gopsutil/ class=md-nav__link> <span class=md-ellipsis> gopsutil </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/11.go-awesome/ class=md-nav__link> <span class=md-ellipsis> go-awesome </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/12.dmidecode/ class=md-nav__link> <span class=md-ellipsis> dmidecode </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/13.toml/ class=md-nav__link> <span class=md-ellipsis> toml </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_11> <label class=md-nav__link for=__nav_6_11 id=__nav_6_11_label tabindex=0> <span class=md-ellipsis> 10.Go-RESTful-API接口开发 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_11_label aria-expanded=false> <label class=md-nav__title for=__nav_6_11> <span class="md-nav__icon md-icon"></span> 10.Go-RESTful-API接口开发 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/10.Go-RESTful-API%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91/1.%E4%BB%80%E4%B9%88%E6%98%AFRESTful-API/ class=md-nav__link> <span class=md-ellipsis> 1.什么是RESTful-API </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/10.Go-RESTful-API%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91/2.GORMv2/ class=md-nav__link> <span class=md-ellipsis> 2.GORMv2 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/10.Go-RESTful-API%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91/3.Gin%E6%A1%86%E6%9E%B6%E7%9A%84%E4%BD%BF%E7%94%A8/ class=md-nav__link> <span class=md-ellipsis> 3.Gin 框架的使用 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/10.Go-RESTful-API%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91/4.%E5%9B%BE%E4%B9%A6%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-%E5%89%8D%E7%AB%AF/ class=md-nav__link> <span class=md-ellipsis> 4.图书管理系统-前端 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/10.Go-RESTful-API%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91/5.%E5%9B%BE%E4%B9%A6%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-%E5%90%8E%E7%AB%AF/ class=md-nav__link> <span class=md-ellipsis> 5.图书管理系统-后端 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/10.Go-RESTful-API%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91/6.Gin%2BVue%E5%85%A5%E9%97%A8%E9%A1%B9%E7%9B%AE/ class=md-nav__link> <span class=md-ellipsis> 6.Gin+Vue入门项目 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_12> <label class=md-nav__link for=__nav_6_12 id=__nav_6_12_label tabindex=0> <span class=md-ellipsis> 11.Web前端 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_12_label aria-expanded=false> <label class=md-nav__title for=__nav_6_12> <span class="md-nav__icon md-icon"></span> 11.Web前端 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/11.Web%E5%89%8D%E7%AB%AF/1.HTML%E6%A0%87%E8%AE%B0%E8%AF%AD%E8%A8%80/ class=md-nav__link> <span class=md-ellipsis> 1.HTML标记语言 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/11.Web%E5%89%8D%E7%AB%AF/2.CSS%E6%A0%B7%E5%BC%8F%E8%AF%AD%E8%A8%80/ class=md-nav__link> <span class=md-ellipsis> 2.CSS样式语言 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/11.Web%E5%89%8D%E7%AB%AF/3.JavaScript%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%84%9A%E6%9C%AC%E8%AF%AD%E8%A8%80/ class=md-nav__link> <span class=md-ellipsis> 3.JavaScript客户端脚本语言 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/11.Web%E5%89%8D%E7%AB%AF/4.JavaScript%E5%BA%93-JQuery/ class=md-nav__link> <span class=md-ellipsis> 4.JavaScript库:JQuery </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_13> <label class=md-nav__link for=__nav_6_13 id=__nav_6_13_label tabindex=0> <span class=md-ellipsis> 12.Vue前端开发 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_13_label aria-expanded=false> <label class=md-nav__title for=__nav_6_13> <span class="md-nav__icon md-icon"></span> 12.Vue前端开发 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/1.%E8%AE%A4%E8%AF%86Vue.js/ class=md-nav__link> <span class=md-ellipsis> 1.认识Vue.js.md </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/2.Vue%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4/ class=md-nav__link> <span class=md-ellipsis> 2.Vue常用指令 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/3.Vue%E5%B8%B8%E7%94%A8%E5%B1%9E%E6%80%A7/ class=md-nav__link> <span class=md-ellipsis> 3.Vue常用属性 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/4.Vue%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4%E4%B9%8B%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/ class=md-nav__link> <span class=md-ellipsis> 4.Vue常用指令之流程控制 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/5.Vue%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4%E4%B9%8B%E6%95%B0%E6%8D%AE%E5%8F%8C%E5%90%91%E7%BB%91%E5%AE%9A/ class=md-nav__link> <span class=md-ellipsis> 5.Vue常用指令之数据双向绑定 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/6.Vue%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E9%92%A9%E5%AD%90/ class=md-nav__link> <span class=md-ellipsis> 6.Vue生命周期钩子 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/7.VueCli%E8%84%9A%E6%89%8B%E6%9E%B6/ class=md-nav__link> <span class=md-ellipsis> 7.VueCli脚手架 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/8.Vue%E7%BB%84%E4%BB%B6/ class=md-nav__link> <span class=md-ellipsis> 8.Vue组件 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/9.Vue%E8%B7%AF%E7%94%B1/ class=md-nav__link> <span class=md-ellipsis> 9.Vue路由 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/10.Vuex%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 10.Vuex状态管理 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/11.%E5%89%8D%E5%90%8E%E7%AB%AF%E6%95%B0%E6%8D%AE%E4%BA%A4%E4%BA%92-Axios/ class=md-nav__link> <span class=md-ellipsis> 11.前后端数据交互 Axios </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/12.Element-Plus/ class=md-nav__link> <span class=md-ellipsis> 12.Element Plus </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_14> <label class=md-nav__link for=__nav_6_14 id=__nav_6_14_label tabindex=0> <span class=md-ellipsis> 13.K8s管理系统项目实战 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_14_label aria-expanded=false> <label class=md-nav__title for=__nav_6_14> <span class="md-nav__icon md-icon"></span> 13.K8s管理系统项目实战 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/13.K8s%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/1.K8s%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/ class=md-nav__link> <span class=md-ellipsis> K8s 管理系统-后端开发 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/13.K8s%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/2.K8s%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/ class=md-nav__link> <span class=md-ellipsis> K8s管理系统-前端开发 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_15> <label class=md-nav__link for=__nav_6_15 id=__nav_6_15_label tabindex=0> <span class=md-ellipsis> 14.Go开发的三方平台 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_15_label aria-expanded=false> <label class=md-nav__title for=__nav_6_15> <span class="md-nav__icon md-icon"></span> 14.Go开发的三方平台 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/14.Go%E5%BC%80%E5%8F%91%E7%9A%84%E4%B8%89%E6%96%B9%E5%B9%B3%E5%8F%B0/0.%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%BF%E7%94%A8Go%E5%81%9A%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/ class=md-nav__link> <span class=md-ellipsis> 为什么使用Go做后端开发 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/14.Go%E5%BC%80%E5%8F%91%E7%9A%84%E4%B8%89%E6%96%B9%E5%B9%B3%E5%8F%B0/1.TBak-System%E5%A4%87%E4%BB%BD%E5%B9%B3%E5%8F%B0/ class=md-nav__link> <span class=md-ellipsis> TBak System备份平台 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/14.Go%E5%BC%80%E5%8F%91%E7%9A%84%E4%B8%89%E6%96%B9%E5%B9%B3%E5%8F%B0/2.kubernetes%E5%AE%B9%E5%99%A8%E4%BA%91%E7%AE%A1%E7%90%86%E5%B9%B3%E5%8F%B0/ class=md-nav__link> <span class=md-ellipsis> kubernetes容器云管理平台 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/14.Go%E5%BC%80%E5%8F%91%E7%9A%84%E4%B8%89%E6%96%B9%E5%B9%B3%E5%8F%B0/3.Go%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/ class=md-nav__link> <span class=md-ellipsis> Go命令行工具 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/14.Go%E5%BC%80%E5%8F%91%E7%9A%84%E4%B8%89%E6%96%B9%E5%B9%B3%E5%8F%B0/4.%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/ class=md-nav__link> <span class=md-ellipsis> nps </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/14.Go%E5%BC%80%E5%8F%91%E7%9A%84%E4%B8%89%E6%96%B9%E5%B9%B3%E5%8F%B0/5.go-web%E9%A1%B9%E7%9B%AE/ class=md-nav__link> <span class=md-ellipsis> go-web项目 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/14.Go%E5%BC%80%E5%8F%91%E7%9A%84%E4%B8%89%E6%96%B9%E5%B9%B3%E5%8F%B0/6.go-%E4%B8%89%E6%96%B9%E5%B7%A5%E5%85%B7%E7%AE%80%E5%8D%95%E5%85%A5%E9%97%A8/ class=md-nav__link> <span class=md-ellipsis> go-三方工具简单入门 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_16> <label class=md-nav__link for=__nav_6_16 id=__nav_6_16_label tabindex=0> <span class=md-ellipsis> 15.容器化Go </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_16_label aria-expanded=false> <label class=md-nav__title for=__nav_6_16> <span class="md-nav__icon md-icon"></span> 15.容器化Go </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/15.%E5%AE%B9%E5%99%A8%E5%8C%96Go/0.%E6%9E%84%E5%BB%BAGo%E5%BA%94%E7%94%A8docker%E9%95%9C%E5%83%8F/ class=md-nav__link> <span class=md-ellipsis> 构建Go应用docker镜像 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex=0> <span class=md-ellipsis> Python </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Python </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_1> <label class=md-nav__link for=__nav_7_1 id=__nav_7_1_label tabindex=0> <span class=md-ellipsis> 0.学习线路 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_1_label aria-expanded=false> <label class=md-nav__title for=__nav_7_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Pythjon-auto-ops/ class=md-nav__link> <span class=md-ellipsis> Python Linux管理与自动化运维 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_2> <label class=md-nav__link for=__nav_7_2 id=__nav_7_2_label tabindex=0> <span class=md-ellipsis> 1.Python基础篇 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_2_label aria-expanded=false> <label class=md-nav__title for=__nav_7_2> <span class="md-nav__icon md-icon"></span> 1.Python基础篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/1.Python%E7%94%9F%E6%80%81%E5%B7%A5%E5%85%B7/ class=md-nav__link> <span class=md-ellipsis> 1.Python 生态工具 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/2.Python%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E5%AE%89%E8%A3%85/ class=md-nav__link> <span class=md-ellipsis> 2.Python 第三方库安装 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/3.Python%E5%B7%A5%E4%BD%9C%E7%8E%AF%E5%A2%83%E7%AE%A1%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 3.Python 工作环境管理 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/4.Python%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/ class=md-nav__link> <span class=md-ellipsis> 4.Python 开发环境 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/5.Python%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/ class=md-nav__link> <span class=md-ellipsis> 5.Python 数据结构 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/6.Python%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84/ class=md-nav__link> <span class=md-ellipsis> 6.Python 项目的组织结构 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/7.Python%E4%BB%A3%E7%A0%81%E8%A7%84%E8%8C%83/ class=md-nav__link> <span class=md-ellipsis> 7.Python 代码规范 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/8.Python%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/ class=md-nav__link> <span class=md-ellipsis> 8.Python 基础知识 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/9.Python%E5%AD%97%E7%AC%A6%E4%B8%B2/ class=md-nav__link> <span class=md-ellipsis> 9.Python 字符串 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/10.Python%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/ class=md-nav__link> <span class=md-ellipsis> 10.Python 数据类型 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/11.Python%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C/ class=md-nav__link> <span class=md-ellipsis> 11.Python 文件操作 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/12.Python%E5%87%BD%E6%95%B0/ class=md-nav__link> <span class=md-ellipsis> 12.Python 函数 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/13.Python%E5%B8%B8%E7%94%A8%E5%86%85%E5%BB%BA%E5%87%BD%E6%95%B0/ class=md-nav__link> <span class=md-ellipsis> 13.Python 常用内建函数 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/14.Python%E7%B1%BB/ class=md-nav__link> <span class=md-ellipsis> 14.Python 类 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/15.Python%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 15.Python 异常处理 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/16.Python%E6%A8%A1%E5%9D%97%E4%B8%8E%E5%8C%85/ class=md-nav__link> <span class=md-ellipsis> 16.Python 模块与包 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/17.Python%E6%A0%87%E5%87%86%E5%BA%93/ class=md-nav__link> <span class=md-ellipsis> 17.Python 标准库 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/18.Python%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 18.Python 正则表达式 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/19.Python%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BC%96%E7%A8%8B/ class=md-nav__link> <span class=md-ellipsis> 19.Python 数据库编程 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/20.Python%E6%89%B9%E9%87%8F%E7%AE%A1%E7%90%86%E4%B8%BB%E6%9C%BA/ class=md-nav__link> <span class=md-ellipsis> 20.Python 批量管理主机 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/21.Python%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%9A%E8%BF%9B%E7%A8%8B%E5%8D%8F%E7%A8%8B/ class=md-nav__link> <span class=md-ellipsis> 21.Python 多线程多进程协程 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_3> <label class=md-nav__link for=__nav_7_3 id=__nav_7_3_label tabindex=0> <span class=md-ellipsis> 2.Python运维开发 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_3_label aria-expanded=false> <label class=md-nav__title for=__nav_7_3> <span class="md-nav__icon md-icon"></span> 2.Python运维开发 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/1.%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/ class=md-nav__link> <span class=md-ellipsis> 1.命令行工具 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/2.%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 2.文本处理 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/3.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 3.Linux 系统管理 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/4.%E7%9B%91%E6%8E%A7Linux/ class=md-nav__link> <span class=md-ellipsis> 4.监控 Linux </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/5.%E6%96%87%E6%A1%A3%E4%B8%8E%E6%8A%A5%E5%91%8A/ class=md-nav__link> <span class=md-ellipsis> 5.文档与报告 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/6.%E7%BD%91%E7%BB%9C/ class=md-nav__link> <span class=md-ellipsis> 6.网络 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/7.%E8%87%AA%E5%8A%A8%E5%8C%96%E7%AE%A1%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 7.自动化管理 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/8.%E5%B8%B8%E7%94%A8%E6%A8%A1%E5%9D%97/ class=md-nav__link> <span class=md-ellipsis> 8.常用模块 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/9.Python%E6%89%93%E9%80%A0MySQL%E4%B8%93%E5%AE%B6%E7%B3%BB%E7%BB%9F/ class=md-nav__link> <span class=md-ellipsis> 9.Python打造MySQL专家系统 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/10.%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%BC%80%E5%8F%91/ class=md-nav__link> <span class=md-ellipsis> 10.自动化运维系统的开发 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/11.%E5%8D%8E%E4%B8%BA%E4%BA%91Python%E6%BC%94%E7%A4%BA%E4%BB%A3%E7%A0%81/ class=md-nav__link> <span class=md-ellipsis> 11.华为云Python演示代码 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/12.%E5%8D%8E%E4%B8%BA%E4%BA%91Go%E6%BC%94%E7%A4%BA%E4%BB%A3%E7%A0%81/ class=md-nav__link> <span class=md-ellipsis> 12.华为云Go演示代码 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/%E9%99%84-%E8%BF%90%E7%BB%B4%E7%9B%B8%E5%85%B3%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE/ class=md-nav__link> <span class=md-ellipsis> 附-运维相关开源项目 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/%E9%99%84-awesome-python-cn/ class=md-nav__link> <span class=md-ellipsis> 附-awesome-python-cn </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/%E9%99%84-CMDB/ class=md-nav__link> <span class=md-ellipsis> 附-CMDB </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/%E9%99%84-Django-web%E5%BC%80%E5%8F%91/ class=md-nav__link> <span class=md-ellipsis> 附-Django-web开发 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_4> <label class=md-nav__link for=__nav_7_4 id=__nav_7_4_label tabindex=0> <span class=md-ellipsis> 3.Python测试开发 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_4_label aria-expanded=false> <label class=md-nav__title for=__nav_7_4> <span class="md-nav__icon md-icon"></span> 3.Python测试开发 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/1.Python2%E4%B8%8EPython3%E5%8C%BA%E5%88%AB/ class=md-nav__link> <span class=md-ellipsis> 1.Python2 与 Python3 区别 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/2.Windows%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85Python/ class=md-nav__link> <span class=md-ellipsis> 2.Windows环境安装Python </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/3.Linux%E5%A4%9A%E7%89%88%E6%9C%ACPython%E5%AE%89%E8%A3%85/ class=md-nav__link> <span class=md-ellipsis> 3.Linux多版本Python安装 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/4.Python%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85/ class=md-nav__link> <span class=md-ellipsis> 4.Python虚拟环境安装 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/5.Pycharm%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8/ class=md-nav__link> <span class=md-ellipsis> 5.Pycharm安装与使用 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/6.Python%E9%97%B4%E6%8E%A5%E5%AE%9A%E4%B9%89%E5%B8%B8%E9%87%8F/ class=md-nav__link> <span class=md-ellipsis> 6.Python间接定义常量 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/7.Python%E8%BF%90%E7%AE%97%E7%AC%A6%E4%B8%8E%E8%A1%A8%E8%BE%BE%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 7.Python运算符与表达式 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/8.%E9%80%BB%E8%BE%91%E6%8E%A7%E5%88%B6%E8%AF%AD%E5%8F%A5/ class=md-nav__link> <span class=md-ellipsis> 8.逻辑控制语句 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/9.%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%BB%8B%E7%BB%8D/ class=md-nav__link> <span class=md-ellipsis> 9.数据结构 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/10.%E5%87%BD%E6%95%B0%E4%BB%8B%E7%BB%8D/ class=md-nav__link> <span class=md-ellipsis> 10.函数介绍 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/11.%E7%B1%BB%E4%B8%8E%E5%AF%B9%E8%B1%A1/ class=md-nav__link> <span class=md-ellipsis> 11.类与对象 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/12.%E6%89%93%E5%8C%85%E4%B8%8E%E5%8F%91%E5%B8%83/ class=md-nav__link> <span class=md-ellipsis> 12.打包与发布 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/13.%E5%BC%82%E5%B8%B8%E6%8D%95%E8%8E%B7%E4%B8%8E%E5%A4%84%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 13.异常捕获与处理 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/14.%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/ class=md-nav__link> <span class=md-ellipsis> 14.并发编程 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/15.%E6%A0%87%E5%87%86%E5%BA%93%E5%92%8C%E4%B8%89%E6%96%B9%E5%BA%93/ class=md-nav__link> <span class=md-ellipsis> 15.标准库和三方库 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/16.vue-cli%E8%84%9A%E6%89%8B%E6%9E%B6/ class=md-nav__link> <span class=md-ellipsis> 16.vue-cli脚手架 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/17.%E6%A1%88%E4%BE%8B%E5%AE%9E%E8%B7%B5-%E4%BB%BB%E5%8A%A1%E5%88%97%E8%A1%A8/ class=md-nav__link> <span class=md-ellipsis> 17.案例实践-任务列表 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_5> <label class=md-nav__link for=__nav_7_5 id=__nav_7_5_label tabindex=0> <span class=md-ellipsis> 4.Flask-Web全栈开发 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_5_label aria-expanded=false> <label class=md-nav__title for=__nav_7_5> <span class="md-nav__icon md-icon"></span> 4.Flask-Web全栈开发 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/1.Flask%E5%89%8D%E5%A5%8F/ class=md-nav__link> <span class=md-ellipsis> 1.Flask 前缀 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/2.%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AE/ class=md-nav__link> <span class=md-ellipsis> 2.项目配置 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/3.URL%E4%B8%8E%E8%A7%86%E5%9B%BE/ class=md-nav__link> <span class=md-ellipsis> 3.URL与视图 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/4.Jinja2%E6%A8%A1%E6%9D%BF/ class=md-nav__link> <span class=md-ellipsis> 4.Jinja2模板 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/5.%E6%95%B0%E6%8D%AE%E5%BA%93/ class=md-nav__link> <span class=md-ellipsis> 5.数据库 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/6.%E8%A1%A8%E5%8D%95/ class=md-nav__link> <span class=md-ellipsis> 6.表单 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/7.Flask%E8%BF%9B%E9%98%B6/ class=md-nav__link> <span class=md-ellipsis> 7.Flask进阶 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/8.%E7%BC%93%E5%AD%98%E7%B3%BB%E7%BB%9F/ class=md-nav__link> <span class=md-ellipsis> 8.缓存系统 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/9.Flask%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/ class=md-nav__link> <span class=md-ellipsis> 9.Flask 项目实战 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/10.WebSock%E5%AE%9E%E6%88%98/ class=md-nav__link> <span class=md-ellipsis> 10.WebSock实战 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/11.Flask%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B/ class=md-nav__link> <span class=md-ellipsis> 11.Flask异步编程 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/%E9%99%84-%E4%BD%BF%E7%94%A8Pytest%E6%B5%8B%E8%AF%95Flask/ class=md-nav__link> <span class=md-ellipsis> 附-使用 Pytest 测试 Flask </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/%E9%99%84-%E5%9B%BE%E4%B9%A6%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/ class=md-nav__link> <span class=md-ellipsis> 附-图书管理系统 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/%E9%99%84-Flask%E5%B8%B8%E7%94%A8%E6%89%A9%E5%B1%95/ class=md-nav__link> <span class=md-ellipsis> 附-Flask常用扩展 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/%E9%99%84-Flask%E5%92%8CRedis%E9%98%9F%E5%88%97%E7%9A%84%E5%BC%82%E6%AD%A5%E4%BB%BB%E5%8A%A1/ class=md-nav__link> <span class=md-ellipsis> 附-Flask和Redis队列的异步任务 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/%E9%99%84-Flask%E5%92%8CVue.js%E5%BC%80%E5%8F%91%E5%8D%95%E9%A1%B5%E5%BA%94%E7%94%A8/ class=md-nav__link> <span class=md-ellipsis> 附-Flask 和 Vue.js 开发单页应用 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/%E9%99%84-Flask%E5%AE%B9%E5%99%A8%E5%8C%96%E5%AE%9E%E8%B7%B5/ class=md-nav__link> <span class=md-ellipsis> 附-Flask容器化实践 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/%E9%99%84-Flask%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B/ class=md-nav__link> <span class=md-ellipsis> 附-Flask数据模型 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_6> <label class=md-nav__link for=__nav_7_6 id=__nav_7_6_label tabindex=0> <span class=md-ellipsis> 5.DevOps和自动化运维实践 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_6_label aria-expanded=false> <label class=md-nav__title for=__nav_7_6> <span class="md-nav__icon md-icon"></span> 5.DevOps和自动化运维实践 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python/5.DevOps%E5%92%8C%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%AE%9E%E8%B7%B5/1.Devops%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E7%9A%84%E6%84%8F%E4%B9%89/ class=md-nav__link> <span class=md-ellipsis> 1.Devops 与自动化运维的意义 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/5.DevOps%E5%92%8C%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%AE%9E%E8%B7%B5/2.Shell%E8%84%9A%E6%9C%AC%E5%9C%A8Devops%E4%B8%8B%E7%9A%84%E5%BA%94%E7%94%A8/ class=md-nav__link> <span class=md-ellipsis> 2.Shell脚本在Devops下的应用 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/5.DevOps%E5%92%8C%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%AE%9E%E8%B7%B5/3.%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E4%B8%8B%E7%9A%84Shell%E8%84%9A%E6%9C%AC/ class=md-nav__link> <span class=md-ellipsis> 3.生产环境下的 Shell 脚本 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/5.DevOps%E5%92%8C%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%AE%9E%E8%B7%B5/4.%E5%B7%A5%E4%BD%9C%E4%B8%AD%E7%9A%84Python%E8%84%9A%E6%9C%AC%E5%88%86%E4%BA%AB/ class=md-nav__link> <span class=md-ellipsis> 4.工作中的 Python 脚本分享 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_7> <label class=md-nav__link for=__nav_7_7 id=__nav_7_7_label tabindex=0> <span class=md-ellipsis> 6.CMDB项目实战 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7_7> <span class="md-nav__icon md-icon"></span> 6.CMDB项目实战 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python/6.CMDB%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/0.DRF%E5%89%8D%E5%A5%8F/ class=md-nav__link> <span class=md-ellipsis> 0.DRF前奏 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/6.CMDB%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/1.DRF%E5%85%A5%E9%97%A8/ class=md-nav__link> <span class=md-ellipsis> 1.DRF入门 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/6.CMDB%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/2.DRF%E8%BF%9B%E9%98%B6/ class=md-nav__link> <span class=md-ellipsis> 2.DRF进阶 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/6.CMDB%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/3.CMDB%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/ class=md-nav__link> <span class=md-ellipsis> 3.CMDB后端开发 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/6.CMDB%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/4.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91-%E4%B8%8A/ class=md-nav__link> <span class=md-ellipsis> 4.Vue前端开发-上 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/6.CMDB%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/5.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91-%E4%B8%8B/ class=md-nav__link> <span class=md-ellipsis> 5.Vue前端开发-下 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/6.CMDB%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/6.Element-Plus%E5%89%8D%E7%AB%AF%E7%BB%84%E4%BB%B6%E5%BA%93/ class=md-nav__link> <span class=md-ellipsis> 6.Element-Plus前端组件库 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/6.CMDB%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/7.CMDB%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91-%E4%B8%8A/ class=md-nav__link> <span class=md-ellipsis> 7.CMDB前端开发-上 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/6.CMDB%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/8.CMDB%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91-%E4%B8%8B/ class=md-nav__link> <span class=md-ellipsis> 8.CMDB前端开发-下 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_8> <label class=md-nav__link for=__nav_7_8 id=__nav_7_8_label tabindex=0> <span class=md-ellipsis> 7.Python网络编程攻略 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_8_label aria-expanded=false> <label class=md-nav__title for=__nav_7_8> <span class="md-nav__icon md-icon"></span> 7.Python网络编程攻略 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python/7.Python%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E6%94%BB%E7%95%A5/1.IPv4%E5%92%8C%E7%AE%80%E5%8D%95%E7%9A%84%E5%AE%A2%E6%88%B7%E7%AB%AF-%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B/ class=md-nav__link> <span class=md-ellipsis> 1.IPv4 和简单的客户端-服务器编程 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/7.Python%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E6%94%BB%E7%95%A5/2.%E4%BD%BF%E7%94%A8%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8%E5%A5%97%E6%8E%A5%E5%AD%97-IO%E6%8F%90%E5%8D%87%E6%80%A7%E8%83%BD/ class=md-nav__link> <span class=md-ellipsis> 2.使用多路复用套接字-IO 提升性能 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/7.Python%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E6%94%BB%E7%95%A5/3.IPv6-Unix%E5%9F%9F%E5%A5%97%E6%8E%A5%E5%AD%97%E5%92%8C%E7%BD%91%E7%BB%9C%E6%8E%A5%E5%8F%A3/ class=md-nav__link> <span class=md-ellipsis> 3.IPv6-Unix 域套接字和网络接口 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_9> <label class=md-nav__link for=__nav_7_9 id=__nav_7_9_label tabindex=0> <span class=md-ellipsis> 8.Python自动化运维实战 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_9_label aria-expanded=false> <label class=md-nav__title for=__nav_7_9> <span class="md-nav__icon md-icon"></span> 8.Python自动化运维实战 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python/8.Python%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%AE%9E%E6%88%98/1.%E6%90%AD%E5%BB%BAPython%E7%8E%AF%E5%A2%83/ class=md-nav__link> <span class=md-ellipsis> 1.搭建 Python 环境 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/8.Python%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%AE%9E%E6%88%98/2.%E5%B8%B8%E7%94%A8%E7%9A%84%E8%87%AA%E5%8A%A8%E5%8C%96%E5%BA%93/ class=md-nav__link> <span class=md-ellipsis> 2.常用的自动化库 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/8.Python%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%AE%9E%E6%88%98/3.%E6%90%AD%E5%BB%BA%E7%BD%91%E7%BB%9C%E5%AE%9E%E9%AA%8C%E5%AE%A4%E7%8E%AF%E5%A2%83/ class=md-nav__link> <span class=md-ellipsis> 3.搭建网络实验室环境 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8> <label class=md-nav__link for=__nav_8 id=__nav_8_label tabindex=0> <span class=md-ellipsis> Openstack </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_8_label aria-expanded=false> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> Openstack </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8_1> <label class=md-nav__link for=__nav_8_1 id=__nav_8_1_label tabindex=0> <span class=md-ellipsis> 0.学习线路 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_8_1_label aria-expanded=false> <label class=md-nav__title for=__nav_8_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Openstack/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.OpenStack/ class=md-nav__link> <span class=md-ellipsis> 基于 OpenStack 组件开发 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8_2> <label class=md-nav__link for=__nav_8_2 id=__nav_8_2_label tabindex=0> <span class=md-ellipsis> 1.OpenStack工程师工作 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_8_2_label aria-expanded=false> <label class=md-nav__title for=__nav_8_2> <span class="md-nav__icon md-icon"></span> 1.OpenStack工程师工作 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Openstack/1.OpenStack%E5%B7%A5%E7%A8%8B%E5%B8%88%E5%B7%A5%E4%BD%9C/1.Horizon%E7%95%8C%E9%9D%A2%E5%B7%A5%E7%A8%8B%E5%B8%88%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%86%85%E5%AE%B9/ class=md-nav__link> <span class=md-ellipsis> 1.Horizon 界面工程师的工作内容 </span> </a> </li> <li class=md-nav__item> <a href=../../../Openstack/1.OpenStack%E5%B7%A5%E7%A8%8B%E5%B8%88%E5%B7%A5%E4%BD%9C/2.Neutron%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E5%B8%88%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%86%85%E5%AE%B9/ class=md-nav__link> <span class=md-ellipsis> 2.Neutron 网络工程师的工作内容 </span> </a> </li> <li class=md-nav__item> <a href=../../../Openstack/1.OpenStack%E5%B7%A5%E7%A8%8B%E5%B8%88%E5%B7%A5%E4%BD%9C/3.Nova%E8%B5%84%E6%B7%B1%E5%B7%A5%E7%A8%8B%E5%B8%88%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%86%85%E5%AE%B9/ class=md-nav__link> <span class=md-ellipsis> 3.Nova 资深工程师的工作内容 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8_3> <label class=md-nav__link for=__nav_8_3 id=__nav_8_3_label tabindex=0> <span class=md-ellipsis> 2.开发环境的搭建 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_8_3_label aria-expanded=false> <label class=md-nav__title for=__nav_8_3> <span class="md-nav__icon md-icon"></span> 2.开发环境的搭建 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Openstack/2.%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/1.Windows%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/ class=md-nav__link> <span class=md-ellipsis> 1.Windows 开发环境的搭建 </span> </a> </li> <li class=md-nav__item> <a href=../../../Openstack/2.%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/2.Linux%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/ class=md-nav__link> <span class=md-ellipsis> 2.Linux 开发环境的搭建 </span> </a> </li> <li class=md-nav__item> <a href=../../../Openstack/2.%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/3.Launchpad%E8%B4%A6%E5%8F%B7/ class=md-nav__link> <span class=md-ellipsis> 3.Launchpad 账号 </span> </a> </li> <li class=md-nav__item> <a href=../../../Openstack/2.%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/4.Git%E7%9A%84%E4%BD%BF%E7%94%A8/ class=md-nav__link> <span class=md-ellipsis> 4.Git 的使用 </span> </a> </li> <li class=md-nav__item> <a href=../../../Openstack/2.%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/5.OpenStack%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%BF%AE%E6%94%B9/ class=md-nav__link> <span class=md-ellipsis> 5.OpenStack配置文件修改 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8_4> <label class=md-nav__link for=__nav_8_4 id=__nav_8_4_label tabindex=0> <span class=md-ellipsis> 3.Python模块 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_8_4_label aria-expanded=false> <label class=md-nav__title for=__nav_8_4> <span class="md-nav__icon md-icon"></span> 3.Python模块 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Openstack/3.Python%E6%A8%A1%E5%9D%97/0.Python%E5%8C%85%E7%9A%84%E6%9E%84%E5%BB%BA%E4%B8%8E%E5%88%86%E5%8F%91/ class=md-nav__link> <span class=md-ellipsis> 0.Python 包的构建与分发 </span> </a> </li> <li class=md-nav__item> <a href=../../../Openstack/3.Python%E6%A8%A1%E5%9D%97/1.SQLAlchemy/ class=md-nav__link> <span class=md-ellipsis> 1.SQLAlchemy </span> </a> </li> <li class=md-nav__item> <a href=../../../Openstack/3.Python%E6%A8%A1%E5%9D%97/2.logging/ class=md-nav__link> <span class=md-ellipsis> 2.logging </span> </a> </li> <li class=md-nav__item> <a href=../../../Openstack/3.Python%E6%A8%A1%E5%9D%97/3.cliff/ class=md-nav__link> <span class=md-ellipsis> 3.cliff </span> </a> </li> <li class=md-nav__item> <a href=../../../Openstack/3.Python%E6%A8%A1%E5%9D%97/4.Eventlet/ class=md-nav__link> <span class=md-ellipsis> 4.Eventlet </span> </a> </li> <li class=md-nav__item> <a href=../../../Openstack/3.Python%E6%A8%A1%E5%9D%97/5.WSGI/ class=md-nav__link> <span class=md-ellipsis> 5.WSGI </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_9> <label class=md-nav__link for=__nav_9 id=__nav_9_label tabindex=0> <span class=md-ellipsis> Python-vs-Go </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_9_label aria-expanded=false> <label class=md-nav__title for=__nav_9> <span class="md-nav__icon md-icon"></span> Python-vs-Go </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_9_1> <label class=md-nav__link for=__nav_9_1 id=__nav_9_1_label tabindex=0> <span class=md-ellipsis> 0.学习线路 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_9_1_label aria-expanded=false> <label class=md-nav__title for=__nav_9_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python-vs-Go/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Python-vs-Go/ class=md-nav__link> <span class=md-ellipsis> Python-vs-Go </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_9_2> <label class=md-nav__link for=__nav_9_2 id=__nav_9_2_label tabindex=0> <span class=md-ellipsis> 1.对比 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_9_2_label aria-expanded=false> <label class=md-nav__title for=__nav_9_2> <span class="md-nav__icon md-icon"></span> 1.对比 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/1.Hello-World/ class=md-nav__link> <span class=md-ellipsis> Hello-World </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/2.Print/ class=md-nav__link> <span class=md-ellipsis> Print </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/3.%E6%B3%A8%E9%87%8A/ class=md-nav__link> <span class=md-ellipsis> 注释 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/4.%E5%A4%9A%E8%A1%8C%E5%AD%97%E7%AC%A6%E4%B8%B2/ class=md-nav__link> <span class=md-ellipsis> 多行字符串 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/5.Lists/ class=md-nav__link> <span class=md-ellipsis> Lists </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/6.Map/ class=md-nav__link> <span class=md-ellipsis> Map </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/7.Booleans/ class=md-nav__link> <span class=md-ellipsis> Booleans </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/8.Forloop/ class=md-nav__link> <span class=md-ellipsis> Forloop </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/9.Range/ class=md-nav__link> <span class=md-ellipsis> Range </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/10.Switch/ class=md-nav__link> <span class=md-ellipsis> Switch </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/11.%E5%8F%AF%E5%8F%98%E5%8F%82%E6%95%B0%E5%87%BD%E6%95%B0/ class=md-nav__link> <span class=md-ellipsis> 可变参数函数 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/12.%E6%97%B6%E9%97%B4%E8%AE%A1%E7%AE%97/ class=md-nav__link> <span class=md-ellipsis> 时间计算 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/13.%E5%87%BD%E6%95%B0%E7%9A%84%E9%97%AD%E5%8C%85/ class=md-nav__link> <span class=md-ellipsis> 函数的闭包 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/14.%E9%80%80%E5%87%BA%E5%A4%84%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 退出处理 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/15.%E5%BC%82%E5%B8%B8%E6%8D%95%E8%8E%B7/ class=md-nav__link> <span class=md-ellipsis> 异常捕获 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/16.%E5%8F%AF%E5%8F%98%E9%A1%B9/ class=md-nav__link> <span class=md-ellipsis> 可变项 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/17.%E7%B1%BB/ class=md-nav__link> <span class=md-ellipsis> 类 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/18.%E6%96%B9%E6%B3%95/ class=md-nav__link> <span class=md-ellipsis> 方法 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/19.%E5%B9%B6%E5%8F%91/ class=md-nav__link> <span class=md-ellipsis> 并发 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/20.Args/ class=md-nav__link> <span class=md-ellipsis> Args </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/21.%E5%AF%BC%E5%85%A5%E6%A8%A1%E5%9D%97%E5%88%AB%E5%90%8D/ class=md-nav__link> <span class=md-ellipsis> 导入模块别名 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/22.%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%A0%BC%E5%BC%8F%E5%8C%96/ class=md-nav__link> <span class=md-ellipsis> 字符串格式化 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/23.%E5%8E%BB%E9%87%8D/ class=md-nav__link> <span class=md-ellipsis> 去重 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/24.%E5%B8%A6%E9%A2%9C%E8%89%B2%E6%89%93%E5%8D%B0/ class=md-nav__link> <span class=md-ellipsis> 带颜色打印 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/25.python-example/ class=md-nav__link> <span class=md-ellipsis> Python By Example </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/26.go-example/ class=md-nav__link> <span class=md-ellipsis> Go By Example </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_9_3> <label class=md-nav__link for=__nav_9_3 id=__nav_9_3_label tabindex=0> <span class=md-ellipsis> 2.进阶 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_9_3_label aria-expanded=false> <label class=md-nav__title for=__nav_9_3> <span class="md-nav__icon md-icon"></span> 2.进阶 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python-vs-Go/2.%E8%BF%9B%E9%98%B6/1.%E4%BD%BF%E7%94%A8RPC/ class=md-nav__link> <span class=md-ellipsis> 使用RPC </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/2.%E8%BF%9B%E9%98%B6/2.%E4%BD%BF%E7%94%A8MySQL/ class=md-nav__link> <span class=md-ellipsis> 使用MySQL </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/2.%E8%BF%9B%E9%98%B6/3.%E4%BD%BF%E7%94%A8Redis/ class=md-nav__link> <span class=md-ellipsis> 使用Redis </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/2.%E8%BF%9B%E9%98%B6/4.%E4%BD%BF%E7%94%A8MongoDB/ class=md-nav__link> <span class=md-ellipsis> 使用MongoDB </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/2.%E8%BF%9B%E9%98%B6/5.%E7%BB%83%E6%89%8B%E9%A1%B9%E7%9B%AE%E6%8E%A8%E8%8D%90/ class=md-nav__link> <span class=md-ellipsis> 练手项目推荐 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_10> <label class=md-nav__link for=__nav_10 id=__nav_10_label tabindex=0> <span class=md-ellipsis> Linux </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_10_label aria-expanded=false> <label class=md-nav__title for=__nav_10> <span class="md-nav__icon md-icon"></span> Linux </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_10_1> <label class=md-nav__link for=__nav_10_1 id=__nav_10_1_label tabindex=0> <span class=md-ellipsis> Shell </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_10_1_label aria-expanded=false> <label class=md-nav__title for=__nav_10_1> <span class="md-nav__icon md-icon"></span> Shell </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Linux/Shell/Shell%E7%AE%80%E4%BB%8B/ class=md-nav__link> <span class=md-ellipsis> Shell 教程概述 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/1.%E7%AC%AC%E4%B8%80%E4%B8%AAshell%E7%A8%8B%E5%BA%8F/ class=md-nav__link> <span class=md-ellipsis> 1.第一个 Shell 程序 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/2.Shell%E5%8F%98%E9%87%8F%E5%92%8C%E5%AD%97%E7%AC%A6%E4%B8%B2/ class=md-nav__link> <span class=md-ellipsis> 2.Shell变量和字符串 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/3.Shell%E5%8F%82%E6%95%B0/ class=md-nav__link> <span class=md-ellipsis> 3.Shell参数 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/4.Shell%E6%95%B0%E7%BB%84/ class=md-nav__link> <span class=md-ellipsis> 4.Shell数组 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/5.Shell%E8%BF%90%E7%AE%97%E7%AC%A6/ class=md-nav__link> <span class=md-ellipsis> 5.Shell运算符 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/6.Shell-echo_printf%E5%91%BD%E4%BB%A4/ class=md-nav__link> <span class=md-ellipsis> 6.Shell echo/printf 命令 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/7.Shell-test%E5%91%BD%E4%BB%A4/ class=md-nav__link> <span class=md-ellipsis> 7.Shell test命令 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/8.Shell%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/ class=md-nav__link> <span class=md-ellipsis> 8.Shell流程控制 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/9.Shell%E5%87%BD%E6%95%B0/ class=md-nav__link> <span class=md-ellipsis> 9.Shell函数 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/10.Shell%E8%BE%93%E5%85%A5_%E8%BE%93%E5%87%BA%E9%87%8D%E5%AE%9A%E5%90%91/ class=md-nav__link> <span class=md-ellipsis> 10.Shell输入/输出重定向 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/11.Shell%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 11.Shell正则表达式 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/12.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bgrep/ class=md-nav__link> <span class=md-ellipsis> 12.Shell三剑客之grep </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/13.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/ class=md-nav__link> <span class=md-ellipsis> 13.Shell三剑客之sed </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/14.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bawk/ class=md-nav__link> <span class=md-ellipsis> 14.Shell三剑客之awk </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/15.Shell%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/ class=md-nav__link> <span class=md-ellipsis> 15.Shell常用工具 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/16.Shell%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/ class=md-nav__link> <span class=md-ellipsis> 16.Shell实战项目 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/17.Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/ class=md-nav__link> <span class=md-ellipsis> 17.Shell脚本示例 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/18.Shell%E8%84%9A%E6%9C%AC%E7%9A%84%E5%8F%82%E6%95%B0%E8%A7%A3%E6%9E%90%E5%B7%A5%E5%85%B7/ class=md-nav__link> <span class=md-ellipsis> 18.Shell脚本的参数解析工具 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/19.%E5%AE%9E%E7%94%A8Shell%E8%84%9A%E6%9C%AC%E6%A1%88%E4%BE%8B/ class=md-nav__link> <span class=md-ellipsis> 19.实用 Shell 脚本案例 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/20.Shell%E8%84%9A%E6%9C%AC%E7%9A%84%E8%A7%84%E8%8C%83/ class=md-nav__link> <span class=md-ellipsis> 20.Shell脚本的规范 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/21.Shell%E5%A4%9A%E8%BF%9B%E7%A8%8B%E5%B9%B6%E5%8F%91/ class=md-nav__link> <span class=md-ellipsis> 21.Shell多进程并发 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/22.Bash_Library/ class=md-nav__link> <span class=md-ellipsis> 22.Bash Library </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/%E9%99%84-shell%E5%85%B6%E5%AE%83%E8%B5%84%E6%BA%90/ class=md-nav__link> <span class=md-ellipsis> 附-shell 其它资源 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/%E9%99%84-vim%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/ class=md-nav__link> <span class=md-ellipsis> 附-vim常用操作 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_10_2> <label class=md-nav__link for=__nav_10_2 id=__nav_10_2_label tabindex=0> <span class=md-ellipsis> Ansible </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_10_2_label aria-expanded=false> <label class=md-nav__title for=__nav_10_2> <span class="md-nav__icon md-icon"></span> Ansible </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/ class=md-nav__link> <span class=md-ellipsis> 1.Ansible 入门和实践 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Ansible/2.Ansible-wiki/ class=md-nav__link> <span class=md-ellipsis> 2.Ansible-wiki </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_10_3> <label class=md-nav__link for=__nav_10_3 id=__nav_10_3_label tabindex=0> <span class=md-ellipsis> Git </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_10_3_label aria-expanded=false> <label class=md-nav__title for=__nav_10_3> <span class="md-nav__icon md-icon"></span> Git </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Linux/Git/1.Git%E5%9F%BA%E7%A1%80/ class=md-nav__link> <span class=md-ellipsis> 1.Git基础 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Git/2.%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93/ class=md-nav__link> <span class=md-ellipsis> 2.远程仓库 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Git/3.%E5%88%86%E6%94%AF%E7%AE%A1%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 3.分支管理 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Git/4.%E5%88%86%E6%94%AF%E7%AE%A1%E7%90%86%E7%AD%96%E7%95%A5/ class=md-nav__link> <span class=md-ellipsis> 4.分支管理策略 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Git/7.%E4%BD%BF%E7%94%A8Github/ class=md-nav__link> <span class=md-ellipsis> 7.使用Github </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Git/8.%E5%AE%9E%E8%B7%B5GitHub-Flow/ class=md-nav__link> <span class=md-ellipsis> 8.实践GitHub Flow </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Git/9.%E5%AE%9E%E8%B7%B5Git-Flow/ class=md-nav__link> <span class=md-ellipsis> 9.实践Git Flow </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Git/10.%E9%A1%B9%E7%9B%AE%E8%A7%84%E8%8C%83/ class=md-nav__link> <span class=md-ellipsis> 10.项目规范 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_10_4> <label class=md-nav__link for=__nav_10_4 id=__nav_10_4_label tabindex=0> <span class=md-ellipsis> KVM </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_10_4_label aria-expanded=false> <label class=md-nav__title for=__nav_10_4> <span class="md-nav__icon md-icon"></span> KVM </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Linux/KVM/1.kvm%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4/ class=md-nav__link> <span class=md-ellipsis> 1.kvm相关命令 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/KVM/2.kvm%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%88%9B%E5%BB%BA/ class=md-nav__link> <span class=md-ellipsis> 2.kvm虚拟机创建 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/KVM/3.kvm%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE/ class=md-nav__link> <span class=md-ellipsis> 3.kvm网络配置 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_10_5> <label class=md-nav__link for=__nav_10_5 id=__nav_10_5_label tabindex=0> <span class=md-ellipsis> Nginx </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_10_5_label aria-expanded=false> <label class=md-nav__title for=__nav_10_5> <span class="md-nav__icon md-icon"></span> Nginx </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Linux/Nginx/1.Nginx%E7%AE%80%E4%BB%8B/ class=md-nav__link> <span class=md-ellipsis> 1.Nginx简介 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/2.Nginx%E5%AE%89%E8%A3%85%E5%8F%8A%E5%90%AF%E5%8A%A8/ class=md-nav__link> <span class=md-ellipsis> 2.Nginx安装及启动 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/3.Nginx%E9%85%8D%E7%BD%AE/ class=md-nav__link> <span class=md-ellipsis> 3.Nginx配置 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/4.Nginx%E9%85%8D%E7%BD%AE%E4%B8%8B%E8%BD%BD%E7%AB%99%E7%82%B9/ class=md-nav__link> <span class=md-ellipsis> 4.Nginx配置下载站点 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/5.Nginx%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6/ class=md-nav__link> <span class=md-ellipsis> 5.Nginx访问控制 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/6.Nginx%E8%99%9A%E6%8B%9F%E4%B8%BB%E6%9C%BA/ class=md-nav__link> <span class=md-ellipsis> 6.Nginx虚拟主机 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/7.Nginx%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90/ class=md-nav__link> <span class=md-ellipsis> 7.Nginx静态资源 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/8.Nginx%E7%BC%93%E5%AD%98%E9%85%8D%E7%BD%AE/ class=md-nav__link> <span class=md-ellipsis> 8.Nginx缓存配置 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/9.Nginx%E6%AD%A3%E5%8F%8D%E4%BB%A3%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 9.Nginx正反向代理 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/10.Nginx%E9%98%B2%E7%9B%97%E9%93%BE/ class=md-nav__link> <span class=md-ellipsis> 10.Nginx防盗链 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/11.Nginx%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/ class=md-nav__link> <span class=md-ellipsis> 11.Nginx负载均衡 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/12.Nginx%E5%8A%A8%E9%9D%99%E5%88%86%E7%A6%BB/ class=md-nav__link> <span class=md-ellipsis> 12.Nginx动静分离 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/13.Nginx%E8%B7%A8%E5%9F%9F%E9%85%8D%E7%BD%AE/ class=md-nav__link> <span class=md-ellipsis> 13.Nginx跨域配置 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/14.Nginx%E9%87%8D%E5%AE%9A%E5%90%91/ class=md-nav__link> <span class=md-ellipsis> 14.Nginx重定向 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/15.Nginx-HTTPS/ class=md-nav__link> <span class=md-ellipsis> 15.Nginx HTTPS </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/16.%E9%99%84-Nginx-location%E8%AF%AD%E6%B3%95/ class=md-nav__link> <span class=md-ellipsis> 16.附-Nginx-location语法 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/17.%E9%99%84-Nginx%E4%BB%A3%E7%90%86%E7%9B%B8%E5%85%B3%E6%A8%A1%E5%9D%97%E8%A7%A3%E6%9E%90/ class=md-nav__link> <span class=md-ellipsis> 17.附-Nginx代理相关模块解析 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_10_6> <label class=md-nav__link for=__nav_10_6 id=__nav_10_6_label tabindex=0> <span class=md-ellipsis> System </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_10_6_label aria-expanded=false> <label class=md-nav__title for=__nav_10_6> <span class="md-nav__icon md-icon"></span> System </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Linux/System/1.%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E5%92%8C%E8%BD%AF%E4%BB%B6%E6%BA%90/ class=md-nav__link> <span class=md-ellipsis> 1.系统镜像和软件源 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/System/2.Linux%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA/ class=md-nav__link> <span class=md-ellipsis> 2.Linux安全加固 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/System/3.Systemd/ class=md-nav__link> <span class=md-ellipsis> 3.Systemd </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/System/4.Superivisor/ class=md-nav__link> <span class=md-ellipsis> 4.Superivisor </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/System/5.SSH%E7%99%BB%E5%BD%95Linux%E6%98%BE%E7%A4%BA%E6%A8%AA%E5%B9%85/ class=md-nav__link> <span class=md-ellipsis> 5.SSH登录Linux显示横幅 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/System/6.Linux%E4%B8%AD%E7%AB%AF%E5%8F%A3%E5%8D%A0%E7%94%A8%E6%8E%92%E6%9F%A5/ class=md-nav__link> <span class=md-ellipsis> 6.Linux中端口占用排查 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/System/7.%E4%BD%BF%E7%94%A8curl%E5%8F%91%E9%80%81REST-API%E8%AF%B7%E6%B1%82/ class=md-nav__link> <span class=md-ellipsis> 7.使用curl发送REST API请求 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/System/8.%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%A8%A1%E7%B3%8A%E6%9F%A5%E6%89%BE%E5%99%A8fzf/ class=md-nav__link> <span class=md-ellipsis> 8.命令行模糊查找器fzf </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/System/9.Centos7.9%E7%B3%BB%E7%BB%9F%E7%9B%98%E6%89%A9%E5%AE%B9/ class=md-nav__link> <span class=md-ellipsis> 9.Centos7.9系统盘扩容 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/System/10.Centos%E5%9C%A8%E7%BA%BF-%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96/ class=md-nav__link> <span class=md-ellipsis> 10.Centos在线-离线安装依赖 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/System/11.rsync-ssh/ class=md-nav__link> <span class=md-ellipsis> 11.rsync ssh使用 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/System/12.%E5%90%84%E5%A4%A7%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%81%9ARAID/ class=md-nav__link> <span class=md-ellipsis> 12.各大服务器做RAID </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/System/13.Linux%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84%E4%B8%8E%E8%BF%90%E7%BB%B4%E5%AE%9E%E6%88%98/ class=md-nav__link> <span class=md-ellipsis> 13.Linux 系统架构与运维实战 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_10_7> <label class=md-nav__link for=__nav_10_7 id=__nav_10_7_label tabindex=0> <span class=md-ellipsis> Serveices </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_10_7_label aria-expanded=false> <label class=md-nav__title for=__nav_10_7> <span class="md-nav__icon md-icon"></span> Serveices </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Linux/Serveices/0.ubuntu-desktop-vmware/ class=md-nav__link> <span class=md-ellipsis> ubuntu-desktop-vmware </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_11> <label class=md-nav__link for=__nav_11 id=__nav_11_label tabindex=0> <span class=md-ellipsis> Other </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_11_label aria-expanded=false> <label class=md-nav__title for=__nav_11> <span class="md-nav__icon md-icon"></span> Other </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_11_1> <label class=md-nav__link for=__nav_11_1 id=__nav_11_1_label tabindex=0> <span class=md-ellipsis> tools </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_11_1_label aria-expanded=false> <label class=md-nav__title for=__nav_11_1> <span class="md-nav__icon md-icon"></span> tools </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Other/tools/1.PicGo%E5%9B%BE%E5%BA%8A/ class=md-nav__link> <span class=md-ellipsis> 1.PicGo图床 </span> </a> </li> <li class=md-nav__item> <a href=../../../Other/tools/2.PicX%E5%9B%BE%E5%BA%8A/ class=md-nav__link> <span class=md-ellipsis> 2.Picx图床 </span> </a> </li> <li class=md-nav__item> <a href=../../../Other/tools/3.Markdown%E8%AF%AD%E6%B3%95/ class=md-nav__link> <span class=md-ellipsis> 3.Markdown语法 </span> </a> </li> <li class=md-nav__item> <a href=../../../Other/tools/4.KeyManager/ class=md-nav__link> <span class=md-ellipsis> 4.KeyManager </span> </a> </li> <li class=md-nav__item> <a href=../../../Other/tools/5.mkdocs-material%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2/ class=md-nav__link> <span class=md-ellipsis> 5.mkdocs-material搭建博客 </span> </a> </li> <li class=md-nav__item> <a href=../../../Other/tools/6.sphinx%E6%9E%84%E5%BB%BA%E5%8D%9A%E5%AE%A2/ class=md-nav__link> <span class=md-ellipsis> 6.sphinx构建博客 </span> </a> </li> <li class=md-nav__item> <a href=../../../Other/tools/7.%E4%BC%81%E4%B8%9A%E7%BA%A7VPN%E8%BD%AF%E4%BB%B6AnyLink/ class=md-nav__link> <span class=md-ellipsis> 7.企业级VPN软件AnyLink </span> </a> </li> <li class=md-nav__item> <a href=../../../Other/tools/8.%E5%B9%B3%E5%8F%B0%E5%8F%8A%E5%B7%A5%E5%85%B7%E6%B1%87%E6%80%BB/ class=md-nav__link> <span class=md-ellipsis> 8.平台及工具汇总 </span> </a> </li> <li class=md-nav__item> <a href=../../../Other/tools/9.%E8%87%AA%E5%8A%A8%E6%9B%B4%E6%96%B0%E7%B3%BB%E7%BB%9F%E4%BB%A3%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 9.自动更新系统代理 </span> </a> </li> <li class=md-nav__item> <a href=../../../Other/tools/10.Bash-to-Bat-Converter/ class=md-nav__link> <span class=md-ellipsis> 10.Bash-to-Bat-Converter </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_11_2> <label class=md-nav__link for=__nav_11_2 id=__nav_11_2_label tabindex=0> <span class=md-ellipsis> windows </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_11_2_label aria-expanded=false> <label class=md-nav__title for=__nav_11_2> <span class="md-nav__icon md-icon"></span> windows </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Other/windows/1.%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6%E4%B8%8B%E8%BD%BD/ class=md-nav__link> <span class=md-ellipsis> 1.常用软件下载 </span> </a> </li> <li class=md-nav__item> <a href=../../../Other/windows/2.windows%E5%BF%AB%E6%8D%B7%E6%8C%87%E4%BB%A4/ class=md-nav__link> <span class=md-ellipsis> 2.windows 快捷指令 </span> </a> </li> <li class=md-nav__item> <a href=../../../Other/windows/3.DOS/ class=md-nav__link> <span class=md-ellipsis> 3.DOS </span> </a> </li> <li class=md-nav__item> <a href=../../../Other/windows/4.win11%E9%95%9C%E5%83%8F%E4%B8%8B%E8%BD%BD-%E6%BF%80%E6%B4%BB/ class=md-nav__link> <span class=md-ellipsis> 4.win11镜像下载-激活 </span> </a> </li> <li class=md-nav__item> <a href=../../../Other/windows/5.windows%E4%B8%8Bnetcat%E5%AE%89%E8%A3%85/ class=md-nav__link> <span class=md-ellipsis> 5.windows下netcat安装 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_11_3> <label class=md-nav__link for=__nav_11_3 id=__nav_11_3_label tabindex=0> <span class=md-ellipsis> Interview </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_11_3_label aria-expanded=false> <label class=md-nav__title for=__nav_11_3> <span class="md-nav__icon md-icon"></span> Interview </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Other/Interview/0.%E9%9D%A2%E8%AF%95%E5%AE%9D%E5%85%B8/ class=md-nav__link> <span class=md-ellipsis> 面试宝典 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#生产环境下的备份类脚本 class=md-nav__link> <span class=md-ellipsis> 生产环境下的备份类脚本 </span> </a> <nav class=md-nav aria-label=生产环境下的备份类脚本> <ul class=md-nav__list> <li class=md-nav__item> <a href=#版本控制软件svn的代码库的备份脚本 class=md-nav__link> <span class=md-ellipsis> 版本控制软件SVN的代码库的备份脚本 </span> </a> </li> <li class=md-nav__item> <a href=#备份文件shell脚本 class=md-nav__link> <span class=md-ellipsis> 备份文件shell脚本 </span> </a> </li> <li class=md-nav__item> <a href=#mysql数据库备份至s3文件系统 class=md-nav__link> <span class=md-ellipsis> Mysql数据库备份至S3文件系统 </span> </a> </li> <li class=md-nav__item> <a href=#mysql定时备份脚本 class=md-nav__link> <span class=md-ellipsis> mysql定时备份脚本 </span> </a> </li> <li class=md-nav__item> <a href=#mysql数据库分库备份 class=md-nav__link> <span class=md-ellipsis> MySQL数据库分库备份 </span> </a> </li> <li class=md-nav__item> <a href=#mysql数据库分库分表备份 class=md-nav__link> <span class=md-ellipsis> MySQL数据库分库分表备份 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#生产环境下的统计类脚本 class=md-nav__link> <span class=md-ellipsis> 生产环境下的统计类脚本 </span> </a> <nav class=md-nav aria-label=生产环境下的统计类脚本> <ul class=md-nav__list> <li class=md-nav__item> <a href=#统计设备资产明细脚本 class=md-nav__link> <span class=md-ellipsis> 统计设备资产明细脚本 </span> </a> </li> <li class=md-nav__item> <a href=#统计重要业务程序是否正常运行 class=md-nav__link> <span class=md-ellipsis> 统计重要业务程序是否正常运行 </span> </a> </li> <li class=md-nav__item> <a href=#统计机器的ip连接数 class=md-nav__link> <span class=md-ellipsis> 统计机器的IP连接数 </span> </a> </li> <li class=md-nav__item> <a href=#修改ip_主机名_网卡信息脚本 class=md-nav__link> <span class=md-ellipsis> 修改IP_主机名_网卡信息脚本 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#生产环境下的监控类脚本 class=md-nav__link> <span class=md-ellipsis> 生产环境下的监控类脚本 </span> </a> <nav class=md-nav aria-label=生产环境下的监控类脚本> <ul class=md-nav__list> <li class=md-nav__item> <a href=#监控nginx进程的脚本 class=md-nav__link> <span class=md-ellipsis> 监控Nginx进程的脚本 </span> </a> </li> <li class=md-nav__item> <a href=#监控httpd服务状态脚本 class=md-nav__link> <span class=md-ellipsis> 监控httpd服务状态脚本 </span> </a> </li> <li class=md-nav__item> <a href=#监控mysql数据库示例 class=md-nav__link> <span class=md-ellipsis> 监控mysql数据库示例 </span> </a> </li> <li class=md-nav__item> <a href=#系统文件数打开监控脚本 class=md-nav__link> <span class=md-ellipsis> 系统文件数打开监控脚本 </span> </a> </li> <li class=md-nav__item> <a href=#监控机器cpu利用率脚本 class=md-nav__link> <span class=md-ellipsis> 监控机器CPU利用率脚本 </span> </a> </li> <li class=md-nav__item> <a href=#monitor_linux系统性能 class=md-nav__link> <span class=md-ellipsis> monitor_Linux系统性能 </span> </a> </li> <li class=md-nav__item> <a href=#监控服务器主要性能参数指标 class=md-nav__link> <span class=md-ellipsis> 监控服务器主要性能参数指标 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#生产环境下运维开发类脚本 class=md-nav__link> <span class=md-ellipsis> 生产环境下运维开发类脚本 </span> </a> <nav class=md-nav aria-label=生产环境下运维开发类脚本> <ul class=md-nav__list> <li class=md-nav__item> <a href=#系统初始化脚本centos6 class=md-nav__link> <span class=md-ellipsis> 系统初始化脚本Centos6 </span> </a> </li> <li class=md-nav__item> <a href=#系统初始化脚本centos7 class=md-nav__link> <span class=md-ellipsis> 系统初始化脚本Centos7 </span> </a> </li> <li class=md-nav__item> <a href=#控制shell多进程数量的脚本 class=md-nav__link> <span class=md-ellipsis> 控制shell多进程数量的脚本 </span> </a> </li> <li class=md-nav__item> <a href=#手动建立软raid级别需求 class=md-nav__link> <span class=md-ellipsis> 手动建立软Raid级别需求 </span> </a> </li> <li class=md-nav__item> <a href=#在脚本中修改crontab class=md-nav__link> <span class=md-ellipsis> 在脚本中修改crontab </span> </a> </li> <li class=md-nav__item> <a href=#字符串处理完整脚本 class=md-nav__link> <span class=md-ellipsis> 字符串处理完整脚本 </span> </a> </li> <li class=md-nav__item> <a href=#设置锁文件防止脚本重复执行 class=md-nav__link> <span class=md-ellipsis> 设置锁文件防止脚本重复执行 </span> </a> </li> <li class=md-nav__item> <a href=#修改sshd配置文件 class=md-nav__link> <span class=md-ellipsis> 修改sshd配置文件 </span> </a> </li> <li class=md-nav__item> <a href=#多种test的写法 class=md-nav__link> <span class=md-ellipsis> 多种test的写法 </span> </a> </li> <li class=md-nav__item> <a href=#color输出 class=md-nav__link> <span class=md-ellipsis> color输出 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#一些常用的函数 class=md-nav__link> <span class=md-ellipsis> 一些常用的函数 </span> </a> </li> <li class=md-nav__item> <a href=#linux下function函数库参考 class=md-nav__link> <span class=md-ellipsis> Linux下function函数库参考 </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=27devops下的shell脚本>27.DevOps下的Shell脚本<a class=headerlink href=#27devops下的shell脚本 title="Permanent link">&para;</a></h1> <h2 id=生产环境下的备份类脚本>生产环境下的备份类脚本<a class=headerlink href=#生产环境下的备份类脚本 title="Permanent link">&para;</a></h2> <h3 id=版本控制软件svn的代码库的备份脚本>版本控制软件SVN的代码库的备份脚本<a class=headerlink href=#版本控制软件svn的代码库的备份脚本 title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=ch>#!/bin/sh</span>
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=nv>SVNDIR</span><span class=o>=</span>/data/svn
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=nv>SVNADMIN</span><span class=o>=</span>/usr/bin/svnadmin
<a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=nv>DATE</span><span class=o>=</span><span class=sb>`</span>date<span class=w> </span>+%Y-%m-%d<span class=sb>`</span>
<a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=nv>OLDDATE</span><span class=o>=</span><span class=sb>`</span>date<span class=w> </span>+%Y-%m-%d<span class=w> </span>-d<span class=w> </span><span class=s1>&#39;30 days&#39;</span><span class=sb>`</span>
<a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=nv>BACKDIR</span><span class=o>=</span>/data/backup/svn-backup
<a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a>
<a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a><span class=o>[</span><span class=w> </span>-d<span class=w> </span><span class=si>${</span><span class=nv>BACKDIR</span><span class=si>}</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>||</span><span class=w> </span>mkdir<span class=w> </span>-p<span class=w> </span><span class=si>${</span><span class=nv>BACKDIR</span><span class=si>}</span>
<a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a><span class=nv>LogFile</span><span class=o>=</span><span class=si>${</span><span class=nv>BACKDIR</span><span class=si>}</span>/svnbak.log
<a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a><span class=o>[</span><span class=w> </span>-f<span class=w> </span><span class=si>${</span><span class=nv>LogFile</span><span class=si>}</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>||</span><span class=w> </span>touch<span class=w> </span><span class=si>${</span><span class=nv>LogFile</span><span class=si>}</span>
<a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a>mkdir<span class=w> </span><span class=si>${</span><span class=nv>BACKDIR</span><span class=si>}</span>/<span class=si>${</span><span class=nv>DATE</span><span class=si>}</span>
<a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a>
<a id=__codelineno-0-13 name=__codelineno-0-13 href=#__codelineno-0-13></a>
<a id=__codelineno-0-14 name=__codelineno-0-14 href=#__codelineno-0-14></a><span class=k>for</span><span class=w> </span>PROJECT<span class=w> </span><span class=k>in</span><span class=w> </span>myproject<span class=w> </span>official<span class=w> </span>analysis<span class=w> </span>mypharma
<a id=__codelineno-0-15 name=__codelineno-0-15 href=#__codelineno-0-15></a><span class=k>do</span>
<a id=__codelineno-0-16 name=__codelineno-0-16 href=#__codelineno-0-16></a><span class=w>  </span><span class=nb>cd</span><span class=w> </span><span class=nv>$SVNDIR</span>
<a id=__codelineno-0-17 name=__codelineno-0-17 href=#__codelineno-0-17></a><span class=w>  </span><span class=nv>$SVNADMIN</span><span class=w> </span>hotcopy<span class=w> </span><span class=nv>$PROJECT</span><span class=w>  </span><span class=nv>$BACKDIR</span>/<span class=nv>$DATE</span>/<span class=nv>$PROJECT</span><span class=w> </span>--clean-logs
<a id=__codelineno-0-18 name=__codelineno-0-18 href=#__codelineno-0-18></a><span class=w>  </span><span class=nb>cd</span><span class=w> </span><span class=nv>$BACKDIR</span>/<span class=nv>$DATE</span>
<a id=__codelineno-0-19 name=__codelineno-0-19 href=#__codelineno-0-19></a><span class=w>  </span>tar<span class=w> </span>zcvf<span class=w> </span><span class=si>${</span><span class=nv>PROJECT</span><span class=si>}</span>_svn_<span class=si>${</span><span class=nv>DATE</span><span class=si>}</span>.tar.gz<span class=w> </span><span class=nv>$PROJECT</span><span class=w>  </span>&gt;<span class=w> </span>/dev/null
<a id=__codelineno-0-20 name=__codelineno-0-20 href=#__codelineno-0-20></a><span class=w>  </span>rm<span class=w> </span>-rf<span class=w> </span><span class=nv>$PROJECT</span>
<a id=__codelineno-0-21 name=__codelineno-0-21 href=#__codelineno-0-21></a>sleep<span class=w> </span><span class=m>2</span>
<a id=__codelineno-0-22 name=__codelineno-0-22 href=#__codelineno-0-22></a><span class=k>done</span>
<a id=__codelineno-0-23 name=__codelineno-0-23 href=#__codelineno-0-23></a>
<a id=__codelineno-0-24 name=__codelineno-0-24 href=#__codelineno-0-24></a><span class=nv>HOST</span><span class=o>=</span><span class=m>192</span>.168.2.112
<a id=__codelineno-0-25 name=__codelineno-0-25 href=#__codelineno-0-25></a><span class=nv>FTP_USERNAME</span><span class=o>=</span>svn
<a id=__codelineno-0-26 name=__codelineno-0-26 href=#__codelineno-0-26></a><span class=nv>FTP_PASSWORD</span><span class=o>=</span>svn101
<a id=__codelineno-0-27 name=__codelineno-0-27 href=#__codelineno-0-27></a>
<a id=__codelineno-0-28 name=__codelineno-0-28 href=#__codelineno-0-28></a><span class=nb>cd</span><span class=w> </span><span class=si>${</span><span class=nv>BACKDIR</span><span class=si>}</span>/<span class=si>${</span><span class=nv>DATE</span><span class=si>}</span>
<a id=__codelineno-0-29 name=__codelineno-0-29 href=#__codelineno-0-29></a>
<a id=__codelineno-0-30 name=__codelineno-0-30 href=#__codelineno-0-30></a>ftp<span class=w> </span>-i<span class=w> </span>-n<span class=w> </span>-v<span class=w> </span>&lt;&lt;<span class=w> </span>!
<a id=__codelineno-0-31 name=__codelineno-0-31 href=#__codelineno-0-31></a>open<span class=w> </span><span class=si>${</span><span class=nv>HOST</span><span class=si>}</span>
<a id=__codelineno-0-32 name=__codelineno-0-32 href=#__codelineno-0-32></a>user<span class=w> </span><span class=si>${</span><span class=nv>FTP_USERNAME</span><span class=si>}</span><span class=w> </span><span class=si>${</span><span class=nv>FTP_PASSWORD</span><span class=si>}</span>
<a id=__codelineno-0-33 name=__codelineno-0-33 href=#__codelineno-0-33></a>bin
<a id=__codelineno-0-34 name=__codelineno-0-34 href=#__codelineno-0-34></a><span class=nb>cd</span><span class=w> </span><span class=si>${</span><span class=nv>OLDDATE</span><span class=si>}</span>
<a id=__codelineno-0-35 name=__codelineno-0-35 href=#__codelineno-0-35></a>mdelete<span class=w> </span>*
<a id=__codelineno-0-36 name=__codelineno-0-36 href=#__codelineno-0-36></a><span class=nb>cd</span><span class=w> </span>..
<a id=__codelineno-0-37 name=__codelineno-0-37 href=#__codelineno-0-37></a>rmdir<span class=w> </span><span class=si>${</span><span class=nv>OLDDATE</span><span class=si>}</span>
<a id=__codelineno-0-38 name=__codelineno-0-38 href=#__codelineno-0-38></a>mkdir<span class=w> </span><span class=si>${</span><span class=nv>DATE</span><span class=si>}</span>
<a id=__codelineno-0-39 name=__codelineno-0-39 href=#__codelineno-0-39></a><span class=nb>cd</span><span class=w> </span><span class=si>${</span><span class=nv>DATE</span><span class=si>}</span>
<a id=__codelineno-0-40 name=__codelineno-0-40 href=#__codelineno-0-40></a>mput<span class=w> </span>*
<a id=__codelineno-0-41 name=__codelineno-0-41 href=#__codelineno-0-41></a>bye
<a id=__codelineno-0-42 name=__codelineno-0-42 href=#__codelineno-0-42></a>!
</code></pre></div> <h3 id=备份文件shell脚本>备份文件shell脚本<a class=headerlink href=#备份文件shell脚本 title="Permanent link">&para;</a></h3> <p>Auto_Backup_Linux_System_Files.sh</p> <div class=highlight><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=ch>#!/usr/bin/env bash</span>
<a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=c1>#usage:xxx</span>
<a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=c1>#scripts_name:xxx.sh</span>
<a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a><span class=nv>SOURCE_DIR</span><span class=o>=(</span>
<a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a><span class=w>    </span><span class=nv>$*</span>
<a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a><span class=o>)</span>
<a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a><span class=nv>TARGET_DIR</span><span class=o>=</span>/data/backup/
<a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a><span class=nv>YEAR</span><span class=o>=</span><span class=sb>`</span>date<span class=w> </span>+%Y<span class=sb>`</span>
<a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a><span class=nv>MONTH</span><span class=o>=</span><span class=sb>`</span>date<span class=w> </span>+%m<span class=sb>`</span>
<a id=__codelineno-1-10 name=__codelineno-1-10 href=#__codelineno-1-10></a><span class=nv>DAY</span><span class=o>=</span><span class=sb>`</span>date<span class=w> </span>+%d<span class=sb>`</span>
<a id=__codelineno-1-11 name=__codelineno-1-11 href=#__codelineno-1-11></a><span class=nv>WEEK</span><span class=o>=</span><span class=sb>`</span>date<span class=w> </span>+%u<span class=sb>`</span>
<a id=__codelineno-1-12 name=__codelineno-1-12 href=#__codelineno-1-12></a><span class=nv>FILES</span><span class=o>=</span>system_backup.tgz
<a id=__codelineno-1-13 name=__codelineno-1-13 href=#__codelineno-1-13></a><span class=nv>CODE</span><span class=o>=</span><span class=nv>$?</span>
<a id=__codelineno-1-14 name=__codelineno-1-14 href=#__codelineno-1-14></a>
<a id=__codelineno-1-15 name=__codelineno-1-15 href=#__codelineno-1-15></a>
<a id=__codelineno-1-16 name=__codelineno-1-16 href=#__codelineno-1-16></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=nv>$*</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-1-17 name=__codelineno-1-17 href=#__codelineno-1-17></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;\033[32mUsage:\nPlease Ebter Your Backup Files or Directories\n--------------------------------------------\n</span>
<a id=__codelineno-1-18 name=__codelineno-1-18 href=#__codelineno-1-18></a><span class=s2>    \nUsage:{ </span><span class=nv>$0</span><span class=s2> /boot/etc}\033[0m&quot;</span>
<a id=__codelineno-1-19 name=__codelineno-1-19 href=#__codelineno-1-19></a><span class=w>    </span><span class=nb>exit</span>
<a id=__codelineno-1-20 name=__codelineno-1-20 href=#__codelineno-1-20></a><span class=k>fi</span>
<a id=__codelineno-1-21 name=__codelineno-1-21 href=#__codelineno-1-21></a>
<a id=__codelineno-1-22 name=__codelineno-1-22 href=#__codelineno-1-22></a><span class=c1># Deternube Wgether the Target Directory Exists</span>
<a id=__codelineno-1-23 name=__codelineno-1-23 href=#__codelineno-1-23></a>
<a id=__codelineno-1-24 name=__codelineno-1-24 href=#__codelineno-1-24></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>!<span class=w> </span>-d<span class=w> </span><span class=nv>$TARGET_DIR</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-1-25 name=__codelineno-1-25 href=#__codelineno-1-25></a><span class=w>    </span>mkdir<span class=w> </span>-p<span class=w> </span><span class=nv>$TARGET_DIR</span>/<span class=nv>$YEAR</span>/<span class=nv>$MONTH</span>/<span class=nv>$DAY</span>
<a id=__codelineno-1-26 name=__codelineno-1-26 href=#__codelineno-1-26></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;\033[32mThe </span><span class=nv>$TARGET_DIR</span><span class=s2> Create Successfully ! \033[0m&quot;</span>
<a id=__codelineno-1-27 name=__codelineno-1-27 href=#__codelineno-1-27></a><span class=k>fi</span>
<a id=__codelineno-1-28 name=__codelineno-1-28 href=#__codelineno-1-28></a>
<a id=__codelineno-1-29 name=__codelineno-1-29 href=#__codelineno-1-29></a><span class=c1>#EXEC Full_Backup Function Command</span>
<a id=__codelineno-1-30 name=__codelineno-1-30 href=#__codelineno-1-30></a><span class=c1>#EXEC Full_Backup Function Command</span>
<a id=__codelineno-1-31 name=__codelineno-1-31 href=#__codelineno-1-31></a>Full_Backup<span class=o>()</span>
<a id=__codelineno-1-32 name=__codelineno-1-32 href=#__codelineno-1-32></a><span class=o>{</span>
<a id=__codelineno-1-33 name=__codelineno-1-33 href=#__codelineno-1-33></a><span class=k>if</span>
<a id=__codelineno-1-34 name=__codelineno-1-34 href=#__codelineno-1-34></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$WEEK</span><span class=s2>&quot;</span><span class=w> </span>-eq<span class=w> </span><span class=s2>&quot;7&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=k>then</span>
<a id=__codelineno-1-35 name=__codelineno-1-35 href=#__codelineno-1-35></a><span class=w>    </span>rm<span class=w> </span>-rf<span class=w> </span><span class=nv>$TARGET_DIR</span>/snapshot
<a id=__codelineno-1-36 name=__codelineno-1-36 href=#__codelineno-1-36></a><span class=w>    </span><span class=nb>cd</span><span class=w> </span><span class=nv>$TARGET_DIR</span>/<span class=nv>$YEAR</span>/<span class=nv>$MONTH</span>/<span class=nv>$DAY</span><span class=w> </span><span class=p>;</span>tar<span class=w> </span>-g<span class=w> </span><span class=nv>$TARGET_DIR</span>/snapshot<span class=w> </span>-czvf<span class=w> </span><span class=nv>$FILES</span><span class=w> </span><span class=sb>`</span><span class=nb>echo</span><span class=w> </span><span class=si>${</span><span class=nv>SOURCE_DIR</span><span class=p>[@]</span><span class=si>}</span><span class=sb>`</span>
<a id=__codelineno-1-37 name=__codelineno-1-37 href=#__codelineno-1-37></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$CODE</span><span class=s2>&quot;</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s2>&quot;0&quot;</span><span class=w> </span><span class=o>]&amp;&amp;</span><span class=nb>echo</span><span class=w> </span>-e<span class=w>  </span><span class=s2>&quot;--------------------------------------------\nFull_Backup System Files Backup Successfully !&quot;</span>
<a id=__codelineno-1-38 name=__codelineno-1-38 href=#__codelineno-1-38></a><span class=k>fi</span>
<a id=__codelineno-1-39 name=__codelineno-1-39 href=#__codelineno-1-39></a><span class=o>}</span>
<a id=__codelineno-1-40 name=__codelineno-1-40 href=#__codelineno-1-40></a><span class=c1>#Perform incremental BACKUP Function Command</span>
<a id=__codelineno-1-41 name=__codelineno-1-41 href=#__codelineno-1-41></a>Add_Backup<span class=o>()</span>
<a id=__codelineno-1-42 name=__codelineno-1-42 href=#__codelineno-1-42></a><span class=o>{</span>
<a id=__codelineno-1-43 name=__codelineno-1-43 href=#__codelineno-1-43></a><span class=w>   </span><span class=nb>cd</span><span class=w> </span><span class=nv>$TARGET_DIR</span>/<span class=nv>$YEAR</span>/<span class=nv>$MONTH</span>/<span class=nv>$DAY</span><span class=w> </span><span class=p>;</span>
<a id=__codelineno-1-44 name=__codelineno-1-44 href=#__codelineno-1-44></a><span class=k>if</span>
<a id=__codelineno-1-45 name=__codelineno-1-45 href=#__codelineno-1-45></a><span class=w>    </span><span class=o>[</span><span class=w> </span>-f<span class=w> </span><span class=nv>$TARGET_DIR</span>/<span class=nv>$YEAR</span>/<span class=nv>$MONTH</span>/<span class=nv>$DAY</span>/<span class=nv>$FILES</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=k>then</span>
<a id=__codelineno-1-46 name=__codelineno-1-46 href=#__codelineno-1-46></a><span class=w>    </span><span class=nb>read</span><span class=w> </span>-p<span class=w> </span><span class=s2>&quot;</span><span class=nv>$FILES</span><span class=s2> Already Exists, overwrite confirmation yes or no ? : &quot;</span><span class=w> </span>SURE
<a id=__codelineno-1-47 name=__codelineno-1-47 href=#__codelineno-1-47></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=nv>$SURE</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s2>&quot;no&quot;</span><span class=w> </span>-o<span class=w> </span><span class=nv>$SURE</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s2>&quot;n&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=k>then</span>
<a id=__codelineno-1-48 name=__codelineno-1-48 href=#__codelineno-1-48></a><span class=w>    </span>sleep<span class=w> </span><span class=m>1</span><span class=p>;</span><span class=nb>exit</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-1-49 name=__codelineno-1-49 href=#__codelineno-1-49></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-1-50 name=__codelineno-1-50 href=#__codelineno-1-50></a><span class=c1>#Add_Backup Files System</span>
<a id=__codelineno-1-51 name=__codelineno-1-51 href=#__codelineno-1-51></a><span class=w>    </span><span class=k>if</span>
<a id=__codelineno-1-52 name=__codelineno-1-52 href=#__codelineno-1-52></a><span class=w>        </span><span class=o>[</span><span class=w> </span><span class=nv>$WEEK</span><span class=w> </span>-ne<span class=w> </span><span class=s2>&quot;7&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=k>then</span>
<a id=__codelineno-1-53 name=__codelineno-1-53 href=#__codelineno-1-53></a><span class=w>        </span><span class=nb>cd</span><span class=w> </span><span class=nv>$TARGET_DIR</span>/<span class=nv>$YEAR</span>/<span class=nv>$MONTH</span>/<span class=nv>$DAY</span><span class=p>;</span>tar<span class=w> </span>-g<span class=w> </span><span class=nv>$TARGET_DIR</span>/snapshot<span class=w> </span>-czvf<span class=w> </span><span class=nv>$$</span>_<span class=nv>$FILES</span><span class=w> </span><span class=sb>`</span><span class=nb>echo</span><span class=w> </span><span class=si>${</span><span class=nv>SOURCE_DIR</span><span class=p>[@]</span><span class=si>}</span><span class=sb>`</span>
<a id=__codelineno-1-54 name=__codelineno-1-54 href=#__codelineno-1-54></a><span class=w>        </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$CODE</span><span class=s2>&quot;</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s2>&quot;0&quot;</span><span class=w> </span><span class=o>]&amp;&amp;</span><span class=nb>echo</span><span class=w> </span>-e<span class=w>  </span><span class=s2>&quot;-----------------------------------------\n\033[32mAdd_Backup System Files Backup Successfully !\033[0m&quot;</span>
<a id=__codelineno-1-55 name=__codelineno-1-55 href=#__codelineno-1-55></a><span class=w>   </span><span class=k>fi</span>
<a id=__codelineno-1-56 name=__codelineno-1-56 href=#__codelineno-1-56></a><span class=k>else</span>
<a id=__codelineno-1-57 name=__codelineno-1-57 href=#__codelineno-1-57></a><span class=w>   </span><span class=k>if</span>
<a id=__codelineno-1-58 name=__codelineno-1-58 href=#__codelineno-1-58></a><span class=w>      </span><span class=o>[</span><span class=w> </span><span class=nv>$WEEK</span><span class=w> </span>-ne<span class=w> </span><span class=s2>&quot;7&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=k>then</span>
<a id=__codelineno-1-59 name=__codelineno-1-59 href=#__codelineno-1-59></a><span class=w>      </span><span class=nb>cd</span><span class=w> </span><span class=nv>$TARGET_DIR</span>/<span class=nv>$YEAR</span>/<span class=nv>$MONTH</span>/<span class=nv>$DAY</span><span class=w> </span><span class=p>;</span>tar<span class=w> </span>-g<span class=w> </span><span class=nv>$TARGET_DIR</span>/snapshot<span class=w> </span>-czvf<span class=w> </span><span class=nv>$FILES</span><span class=w> </span><span class=sb>`</span><span class=nb>echo</span><span class=w> </span><span class=si>${</span><span class=nv>SOURCE_DIR</span><span class=p>[@]</span><span class=si>}</span><span class=sb>`</span>
<a id=__codelineno-1-60 name=__codelineno-1-60 href=#__codelineno-1-60></a><span class=w>      </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$CODE</span><span class=s2>&quot;</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s2>&quot;0&quot;</span><span class=w> </span><span class=o>]&amp;&amp;</span><span class=nb>echo</span><span class=w> </span>-e<span class=w>  </span><span class=s2>&quot;-------------------------------------------\n\033[32mAdd_Backup System Files Backup Successfully !\033[0m&quot;</span>
<a id=__codelineno-1-61 name=__codelineno-1-61 href=#__codelineno-1-61></a><span class=w>   </span><span class=k>fi</span>
<a id=__codelineno-1-62 name=__codelineno-1-62 href=#__codelineno-1-62></a><span class=k>fi</span>
<a id=__codelineno-1-63 name=__codelineno-1-63 href=#__codelineno-1-63></a><span class=o>}</span>
<a id=__codelineno-1-64 name=__codelineno-1-64 href=#__codelineno-1-64></a>Full_Backup
<a id=__codelineno-1-65 name=__codelineno-1-65 href=#__codelineno-1-65></a>Add_Backup
<a id=__codelineno-1-66 name=__codelineno-1-66 href=#__codelineno-1-66></a>
<a id=__codelineno-1-67 name=__codelineno-1-67 href=#__codelineno-1-67></a>
<a id=__codelineno-1-68 name=__codelineno-1-68 href=#__codelineno-1-68></a><span class=c1># crontab计划任务中加入如下语句，每天凌晨1点整执行备份脚本。</span>
<a id=__codelineno-1-69 name=__codelineno-1-69 href=#__codelineno-1-69></a><span class=c1># 0 1 *  *  * /bin/sh /data/sh/Auto_Backup_Linux_System_Files.sh /boot /etc/ &gt;&gt; /tmp/back.log 2&gt;&amp;1</span>
</code></pre></div> <h3 id=mysql数据库备份至s3文件系统>Mysql数据库备份至S3文件系统<a class=headerlink href=#mysql数据库备份至s3文件系统 title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=c1>#</span>
<a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a><span class=c1># Filename:</span>
<a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a><span class=c1># backupdatabase.sh</span>
<a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a><span class=c1># Description:</span>
<a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a><span class=c1># backup cms database and remove backup data before 7 days</span>
<a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a><span class=c1># crontab</span>
<a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a><span class=c1># 55 23 * * * /bin/sh /yundisk/cms/crontab/backupdatabase.sh &gt;&gt; /yundisk/cms/crontab/backupdatabase.log 2&gt;&amp;1</span>
<a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a>
<a id=__codelineno-2-10 name=__codelineno-2-10 href=#__codelineno-2-10></a><span class=nv>DATE</span><span class=o>=</span><span class=sb>`</span>date<span class=w> </span>+%Y-%m-%d<span class=sb>`</span>
<a id=__codelineno-2-11 name=__codelineno-2-11 href=#__codelineno-2-11></a><span class=nv>OLDDATE</span><span class=o>=</span><span class=sb>`</span>date<span class=w> </span>+%Y-%m-%d<span class=w> </span>-d<span class=w> </span><span class=s1>&#39;-7 days&#39;</span><span class=sb>`</span>
<a id=__codelineno-2-12 name=__codelineno-2-12 href=#__codelineno-2-12></a>
<a id=__codelineno-2-13 name=__codelineno-2-13 href=#__codelineno-2-13></a><span class=c1>#MYSQL=/usr/local/mysql/bin/mysql</span>
<a id=__codelineno-2-14 name=__codelineno-2-14 href=#__codelineno-2-14></a><span class=c1>#MYSQLDUMP=/usr/local/mysql/bin/mysqldump</span>
<a id=__codelineno-2-15 name=__codelineno-2-15 href=#__codelineno-2-15></a><span class=c1>#MYSQLADMIN=/usr/local/mysql/bin/mysqladmin</span>
<a id=__codelineno-2-16 name=__codelineno-2-16 href=#__codelineno-2-16></a>
<a id=__codelineno-2-17 name=__codelineno-2-17 href=#__codelineno-2-17></a><span class=nv>BACKDIR</span><span class=o>=</span>/yundisk/cms/database
<a id=__codelineno-2-18 name=__codelineno-2-18 href=#__codelineno-2-18></a><span class=o>[</span><span class=w> </span>-d<span class=w> </span><span class=si>${</span><span class=nv>BACKDIR</span><span class=si>}</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>||</span><span class=w> </span>mkdir<span class=w> </span>-p<span class=w> </span><span class=si>${</span><span class=nv>BACKDIR</span><span class=si>}</span>
<a id=__codelineno-2-19 name=__codelineno-2-19 href=#__codelineno-2-19></a><span class=o>[</span><span class=w> </span>-d<span class=w> </span><span class=si>${</span><span class=nv>BACKDIR</span><span class=si>}</span>/<span class=si>${</span><span class=nv>DATE</span><span class=si>}</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>||</span><span class=w> </span>mkdir<span class=w> </span><span class=si>${</span><span class=nv>BACKDIR</span><span class=si>}</span>/<span class=si>${</span><span class=nv>DATE</span><span class=si>}</span>
<a id=__codelineno-2-20 name=__codelineno-2-20 href=#__codelineno-2-20></a><span class=o>[</span><span class=w> </span>!<span class=w> </span>-d<span class=w> </span><span class=si>${</span><span class=nv>BACKDIR</span><span class=si>}</span>/<span class=si>${</span><span class=nv>OLDDATE</span><span class=si>}</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>||</span><span class=w> </span>rm<span class=w> </span>-rf<span class=w> </span><span class=si>${</span><span class=nv>BACKDIR</span><span class=si>}</span>/<span class=si>${</span><span class=nv>OLDDATE</span><span class=si>}</span>
<a id=__codelineno-2-21 name=__codelineno-2-21 href=#__codelineno-2-21></a>
<a id=__codelineno-2-22 name=__codelineno-2-22 href=#__codelineno-2-22></a>mysqldump<span class=w> </span>--default-character-set<span class=o>=</span>utf8<span class=w> </span>--no-autocommit<span class=w> </span>--quick<span class=w> </span>--hex-blob<span class=w> </span>--single-transaction<span class=w> </span>-uroot<span class=w>  </span>cms_production<span class=w>  </span><span class=p>|</span><span class=w> </span>gzip<span class=w> </span>&gt;<span class=w> </span><span class=si>${</span><span class=nv>BACKDIR</span><span class=si>}</span>/<span class=si>${</span><span class=nv>DATE</span><span class=si>}</span>/cms-backup-<span class=si>${</span><span class=nv>DATE</span><span class=si>}</span>.sql.gz
<a id=__codelineno-2-23 name=__codelineno-2-23 href=#__codelineno-2-23></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Database cms_production and bbs has been backup successful&quot;</span>
<a id=__codelineno-2-24 name=__codelineno-2-24 href=#__codelineno-2-24></a>/bin/sleep<span class=w> </span><span class=m>5</span>
<a id=__codelineno-2-25 name=__codelineno-2-25 href=#__codelineno-2-25></a>
<a id=__codelineno-2-26 name=__codelineno-2-26 href=#__codelineno-2-26></a>aws<span class=w> </span>s3<span class=w> </span>cp<span class=w> </span><span class=si>${</span><span class=nv>BACKDIR</span><span class=si>}</span>/<span class=si>${</span><span class=nv>DATE</span><span class=si>}</span>/*<span class=w> </span>s3://example-share/cms/databackup/
</code></pre></div> <h3 id=mysql定时备份脚本>mysql定时备份脚本<a class=headerlink href=#mysql定时备份脚本 title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=c1># 初始化时，创建相应目录</span>
<a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a><span class=c1># mkdir /home/node/bakmysql/sql/</span>
<a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a>
<a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a><span class=c1># 定时任务</span>
<a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a><span class=c1># 每天凌晨1:00执行备份脚本</span>
<a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a><span class=c1>#0 1 * * * /bin/bash -x /home/node/bakmysql/backup.sh &gt;/dev/null 2&gt;&amp;1</span>
<a id=__codelineno-3-8 name=__codelineno-3-8 href=#__codelineno-3-8></a><span class=c1>#2分钟运行一次-测试用</span>
<a id=__codelineno-3-9 name=__codelineno-3-9 href=#__codelineno-3-9></a><span class=c1>#*/2 * * * * /bin/bash -x /home/node/bakmysql/backup.sh &gt;/dev/null 2&gt;&amp;1</span>
<a id=__codelineno-3-10 name=__codelineno-3-10 href=#__codelineno-3-10></a>
<a id=__codelineno-3-11 name=__codelineno-3-11 href=#__codelineno-3-11></a><span class=nv>BakDir</span><span class=o>=</span>/home/node/bakmysql/sql
<a id=__codelineno-3-12 name=__codelineno-3-12 href=#__codelineno-3-12></a><span class=nv>LogFile</span><span class=o>=</span>/home/node/bakmysql/sql/bak.log
<a id=__codelineno-3-13 name=__codelineno-3-13 href=#__codelineno-3-13></a><span class=nv>Date</span><span class=o>=</span><span class=sb>`</span>date<span class=w> </span>+%Y%m%d<span class=sb>`</span>
<a id=__codelineno-3-14 name=__codelineno-3-14 href=#__codelineno-3-14></a><span class=nv>Begin</span><span class=o>=</span><span class=sb>`</span>date<span class=w> </span>+<span class=s2>&quot;%Y年%m月%d日 %H:%M:%S&quot;</span><span class=sb>`</span>
<a id=__codelineno-3-15 name=__codelineno-3-15 href=#__codelineno-3-15></a><span class=nb>cd</span><span class=w> </span><span class=nv>$BakDir</span>
<a id=__codelineno-3-16 name=__codelineno-3-16 href=#__codelineno-3-16></a><span class=nv>DumpFile</span><span class=o>=</span><span class=nv>$Date</span>.sql
<a id=__codelineno-3-17 name=__codelineno-3-17 href=#__codelineno-3-17></a>
<a id=__codelineno-3-18 name=__codelineno-3-18 href=#__codelineno-3-18></a>
<a id=__codelineno-3-19 name=__codelineno-3-19 href=#__codelineno-3-19></a><span class=c1># 导出到本地</span>
<a id=__codelineno-3-20 name=__codelineno-3-20 href=#__codelineno-3-20></a>mysqldump<span class=w> </span>-uroot<span class=w> </span>-p123456<span class=w> </span><span class=nb>test</span><span class=w> </span>--quick<span class=w> </span>--single-transaction<span class=w> </span><span class=p>|</span><span class=w> </span>gzip<span class=w> </span>&gt;<span class=w> </span><span class=nv>$DumpFile</span>.gz
<a id=__codelineno-3-21 name=__codelineno-3-21 href=#__codelineno-3-21></a><span class=nv>Last</span><span class=o>=</span><span class=sb>`</span>date<span class=w> </span>+<span class=s2>&quot;%Y年%m月%d日 %H:%M:%S&quot;</span><span class=sb>`</span>
<a id=__codelineno-3-22 name=__codelineno-3-22 href=#__codelineno-3-22></a><span class=nb>echo</span><span class=w> </span><span class=o>[</span>FullBack<span class=o>]</span><span class=w> </span>开始:<span class=nv>$Begin</span><span class=w> </span>结束:<span class=nv>$Last</span><span class=w> </span><span class=nv>$DumpFile</span>.gz<span class=w> </span>successful<span class=w> </span>&gt;&gt;<span class=w> </span><span class=nv>$LogFile</span>
<a id=__codelineno-3-23 name=__codelineno-3-23 href=#__codelineno-3-23></a>
<a id=__codelineno-3-24 name=__codelineno-3-24 href=#__codelineno-3-24></a>
<a id=__codelineno-3-25 name=__codelineno-3-25 href=#__codelineno-3-25></a><span class=c1># 删除7天前的备份文件</span>
<a id=__codelineno-3-26 name=__codelineno-3-26 href=#__codelineno-3-26></a>find<span class=w> </span><span class=nv>$BakDir</span><span class=w> </span>-mtime<span class=w> </span>+7<span class=w> </span>-type<span class=w> </span>f<span class=w> </span>-name<span class=w> </span><span class=s2>&quot;*.sql.gz&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>xargs<span class=w> </span>rm<span class=w> </span>-f
</code></pre></div> <h3 id=mysql数据库分库备份>MySQL数据库分库备份<a class=headerlink href=#mysql数据库分库备份 title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=c1># author: xiongminghao</span>
<a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a><span class=c1># mail: jasonminghao@163.com</span>
<a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a><span class=c1># describe：Mysql database backup</span>
<a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a><span class=c1># 定义变量</span>
<a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a><span class=nv>IP</span><span class=o>=</span><span class=k>$(</span>ifconfig<span class=w> </span>eth1<span class=w> </span><span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;NR==2{print $2}&#39;</span><span class=k>)</span>
<a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a><span class=nv>Path</span><span class=o>=</span>/backup/database<span class=w>  </span><span class=c1># 备份目录路径</span>
<a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a><span class=nv>Time</span><span class=o>=</span><span class=k>$(</span>date<span class=w> </span>+%F<span class=k>)</span>
<a id=__codelineno-4-9 name=__codelineno-4-9 href=#__codelineno-4-9></a><span class=nv>Ba_Path</span><span class=o>=</span><span class=nv>$Path</span>/<span class=nv>$Time</span>
<a id=__codelineno-4-10 name=__codelineno-4-10 href=#__codelineno-4-10></a><span class=nv>Ba_Logs</span><span class=o>=</span>/var/log/db_database_<span class=nv>$Time</span><span class=w> </span><span class=c1># 定义一个存放日志的文件</span>
<a id=__codelineno-4-11 name=__codelineno-4-11 href=#__codelineno-4-11></a><span class=nv>Md5_Path</span><span class=o>=</span><span class=nv>$Path</span>/<span class=nv>$Time</span>/md5<span class=w> </span><span class=c1># 定义一个存放md5校验的目录</span>
<a id=__codelineno-4-12 name=__codelineno-4-12 href=#__codelineno-4-12></a>
<a id=__codelineno-4-13 name=__codelineno-4-13 href=#__codelineno-4-13></a>
<a id=__codelineno-4-14 name=__codelineno-4-14 href=#__codelineno-4-14></a><span class=c1># 创建两个目录以当天时间为命名</span>
<a id=__codelineno-4-15 name=__codelineno-4-15 href=#__codelineno-4-15></a><span class=o>[</span><span class=w> </span>!<span class=w> </span>-d<span class=w> </span><span class=nv>$Ba_Path</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>mkdir<span class=w> </span><span class=nv>$Ba_Path</span>
<a id=__codelineno-4-16 name=__codelineno-4-16 href=#__codelineno-4-16></a><span class=o>[</span><span class=w> </span>!<span class=w> </span>-d<span class=w> </span><span class=nv>$Md5_Path</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>mkdir<span class=w> </span><span class=nv>$Md5_Path</span>
<a id=__codelineno-4-17 name=__codelineno-4-17 href=#__codelineno-4-17></a>
<a id=__codelineno-4-18 name=__codelineno-4-18 href=#__codelineno-4-18></a><span class=c1># 循环获取数据库名进行备份和生成MD5校验文件</span>
<a id=__codelineno-4-19 name=__codelineno-4-19 href=#__codelineno-4-19></a><span class=k>for</span><span class=w> </span>dbname<span class=w> </span><span class=k>in</span><span class=w> </span><span class=sb>`</span>mysql<span class=w>  </span>-e<span class=w> </span><span class=s1>&#39;show databases&#39;</span><span class=w> </span><span class=p>|</span>sed<span class=w> </span><span class=s1>&#39;1d&#39;</span><span class=w> </span><span class=p>|</span>grep<span class=w> </span>-v<span class=w> </span><span class=s2>&quot;_schema&quot;</span><span class=sb>`</span>
<a id=__codelineno-4-20 name=__codelineno-4-20 href=#__codelineno-4-20></a><span class=k>do</span>
<a id=__codelineno-4-21 name=__codelineno-4-21 href=#__codelineno-4-21></a><span class=c1># 判断是否有数据库已经备份了,如果备份了则continue 调出当次循环，否则进行备份</span>
<a id=__codelineno-4-22 name=__codelineno-4-22 href=#__codelineno-4-22></a>
<a id=__codelineno-4-23 name=__codelineno-4-23 href=#__codelineno-4-23></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>!<span class=w> </span>-f<span class=w> </span><span class=nv>$Ba_Path</span>/<span class=si>${</span><span class=nv>dbname</span><span class=si>}</span>.sql.gz<span class=w> </span><span class=o>]</span><span class=p>;</span><span class=k>then</span>
<a id=__codelineno-4-24 name=__codelineno-4-24 href=#__codelineno-4-24></a>
<a id=__codelineno-4-25 name=__codelineno-4-25 href=#__codelineno-4-25></a><span class=w>   </span><span class=c1># 备份参数</span>
<a id=__codelineno-4-26 name=__codelineno-4-26 href=#__codelineno-4-26></a><span class=w>   </span><span class=c1># -B 增加use[name]语句, -R 备份存储过程和函数数据</span>
<a id=__codelineno-4-27 name=__codelineno-4-27 href=#__codelineno-4-27></a><span class=w>   </span><span class=c1># --master=data2 记录备份时刻的binlog位置点，2表示将其位置点注释</span>
<a id=__codelineno-4-28 name=__codelineno-4-28 href=#__codelineno-4-28></a><span class=w>   </span><span class=c1># --single-ransaction 对innodb引擎进行热备（对数据进行快照）</span>
<a id=__codelineno-4-29 name=__codelineno-4-29 href=#__codelineno-4-29></a><span class=w>   </span><span class=c1># gzip 对备份的数据进行gzip压缩</span>
<a id=__codelineno-4-30 name=__codelineno-4-30 href=#__codelineno-4-30></a><span class=w>   </span>mysqldump<span class=w>  </span>-B<span class=w> </span>-R<span class=w> </span>--master-data<span class=o>=</span><span class=m>2</span><span class=w> </span>--single-transaction<span class=w>  </span><span class=p>|</span>gzip<span class=w> </span>&gt;<span class=nv>$Ba_Path</span>/<span class=si>${</span><span class=nv>dbname</span><span class=si>}</span>.sql.gz
<a id=__codelineno-4-31 name=__codelineno-4-31 href=#__codelineno-4-31></a><span class=w>   </span><span class=nv>RETVAL</span><span class=o>=</span><span class=nv>$?</span>
<a id=__codelineno-4-32 name=__codelineno-4-32 href=#__codelineno-4-32></a>
<a id=__codelineno-4-33 name=__codelineno-4-33 href=#__codelineno-4-33></a><span class=w>   </span><span class=c1># 通过返回值判断备份是否执行成功,把执行的成功与否纪录到日志中</span>
<a id=__codelineno-4-34 name=__codelineno-4-34 href=#__codelineno-4-34></a><span class=w>   </span><span class=o>[</span><span class=w> </span><span class=nv>$?</span><span class=w> </span>-eq<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>dbname</span><span class=si>}</span><span class=s2> successful&quot;</span><span class=w> </span>&gt;&gt;<span class=nv>$Ba_Logs</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>dbname</span><span class=si>}</span><span class=s2> failed&quot;</span><span class=w> </span>&gt;&gt;<span class=nv>$Ba_Logs</span>
<a id=__codelineno-4-35 name=__codelineno-4-35 href=#__codelineno-4-35></a>
<a id=__codelineno-4-36 name=__codelineno-4-36 href=#__codelineno-4-36></a><span class=w>   </span><span class=c1># 对数据库的数据完整性做MD5校验</span>
<a id=__codelineno-4-37 name=__codelineno-4-37 href=#__codelineno-4-37></a><span class=w>   </span>md5sum<span class=w> </span><span class=nv>$Ba_Path</span>/<span class=si>${</span><span class=nv>dbname</span><span class=si>}</span>.sql.gz<span class=w>  </span>&gt;<span class=nv>$Md5_Path</span>/<span class=si>${</span><span class=nv>dbname</span><span class=si>}</span>_md5.log
<a id=__codelineno-4-38 name=__codelineno-4-38 href=#__codelineno-4-38></a>
<a id=__codelineno-4-39 name=__codelineno-4-39 href=#__codelineno-4-39></a><span class=w> </span><span class=k>else</span>
<a id=__codelineno-4-40 name=__codelineno-4-40 href=#__codelineno-4-40></a><span class=w>    </span><span class=c1># 如果备份已存在则跳出当次循环,进行下次循环</span>
<a id=__codelineno-4-41 name=__codelineno-4-41 href=#__codelineno-4-41></a><span class=w>    </span><span class=k>continue</span>
<a id=__codelineno-4-42 name=__codelineno-4-42 href=#__codelineno-4-42></a>
<a id=__codelineno-4-43 name=__codelineno-4-43 href=#__codelineno-4-43></a><span class=w>  </span><span class=k>fi</span>
<a id=__codelineno-4-44 name=__codelineno-4-44 href=#__codelineno-4-44></a><span class=k>done</span>
<a id=__codelineno-4-45 name=__codelineno-4-45 href=#__codelineno-4-45></a>
<a id=__codelineno-4-46 name=__codelineno-4-46 href=#__codelineno-4-46></a><span class=c1># 将备份日志结果邮件方式发送给管理员</span>
<a id=__codelineno-4-47 name=__codelineno-4-47 href=#__codelineno-4-47></a><span class=w> </span>mail<span class=w> </span>-s<span class=w> </span><span class=s2>&quot;</span><span class=nv>$HOSTNAME</span><span class=s2> </span><span class=nv>$IP</span><span class=s2>&quot;</span><span class=w> </span>jasonminghao@163.com<span class=w> </span>&lt;<span class=w> </span><span class=nv>$Ba_Logs</span>
</code></pre></div> <h3 id=mysql数据库分库分表备份>MySQL数据库分库分表备份<a class=headerlink href=#mysql数据库分库分表备份 title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=c1># author: xiongminghao</span>
<a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=c1># mail: jasonminghao@163.com</span>
<a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a><span class=c1># describe：Mysql database table backup</span>
<a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a><span class=c1># 定义变量</span>
<a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a><span class=nv>IP</span><span class=o>=</span><span class=k>$(</span>ifconfig<span class=w> </span>eth1<span class=w> </span><span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;NR==2{print $2}&#39;</span><span class=k>)</span>
<a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a><span class=nv>Path</span><span class=o>=</span>/backup/table<span class=w> </span><span class=c1># 备份目录</span>
<a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a><span class=nv>Time</span><span class=o>=</span><span class=k>$(</span>date<span class=w> </span>+%F<span class=k>)</span>
<a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a><span class=nv>Ba_Path</span><span class=o>=</span><span class=nv>$Path</span>/<span class=nv>$Time</span>
<a id=__codelineno-5-10 name=__codelineno-5-10 href=#__codelineno-5-10></a><span class=nv>Ba_Logs</span><span class=o>=</span>/var/log/db_table_<span class=nv>$Time</span><span class=w>  </span><span class=c1># 定义一个存放日志的文件</span>
<a id=__codelineno-5-11 name=__codelineno-5-11 href=#__codelineno-5-11></a><span class=nv>Md5_Path</span><span class=o>=</span><span class=nv>$Path</span>/<span class=nv>$Time</span>/md5<span class=w> </span><span class=c1># 定义一个存放md5校验的目录</span>
<a id=__codelineno-5-12 name=__codelineno-5-12 href=#__codelineno-5-12></a>
<a id=__codelineno-5-13 name=__codelineno-5-13 href=#__codelineno-5-13></a><span class=c1># 创建两个目录以当天时间为命名</span>
<a id=__codelineno-5-14 name=__codelineno-5-14 href=#__codelineno-5-14></a><span class=o>[</span><span class=w> </span>!<span class=w> </span>-d<span class=w> </span><span class=nv>$Ba_Path</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>mkdir<span class=w> </span><span class=nv>$Ba_Path</span>
<a id=__codelineno-5-15 name=__codelineno-5-15 href=#__codelineno-5-15></a><span class=o>[</span><span class=w> </span>!<span class=w> </span>-d<span class=w> </span><span class=nv>$Md5_Path</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>mkdir<span class=w> </span><span class=nv>$Md5_Path</span>
<a id=__codelineno-5-16 name=__codelineno-5-16 href=#__codelineno-5-16></a>
<a id=__codelineno-5-17 name=__codelineno-5-17 href=#__codelineno-5-17></a><span class=c1># 循环获取数据库名</span>
<a id=__codelineno-5-18 name=__codelineno-5-18 href=#__codelineno-5-18></a><span class=k>for</span><span class=w> </span>dbname<span class=w> </span><span class=k>in</span><span class=w> </span><span class=sb>`</span>mysql<span class=w>  </span>-e<span class=w> </span><span class=s1>&#39;show databases&#39;</span><span class=w> </span><span class=p>|</span>sed<span class=w> </span><span class=s1>&#39;1d&#39;</span><span class=w> </span><span class=p>|</span>grep<span class=w> </span>-v<span class=w> </span><span class=s2>&quot;_schema&quot;</span><span class=sb>`</span>
<a id=__codelineno-5-19 name=__codelineno-5-19 href=#__codelineno-5-19></a><span class=k>do</span>
<a id=__codelineno-5-20 name=__codelineno-5-20 href=#__codelineno-5-20></a>
<a id=__codelineno-5-21 name=__codelineno-5-21 href=#__codelineno-5-21></a><span class=w>  </span><span class=c1># 循环获取到数据库名后再次循环获取到该库名下的表，进行备份和MD5校验</span>
<a id=__codelineno-5-22 name=__codelineno-5-22 href=#__codelineno-5-22></a><span class=w>  </span><span class=k>for</span><span class=w> </span>tablename<span class=w> </span><span class=k>in</span><span class=w> </span><span class=sb>`</span>mysql<span class=w> </span>-e<span class=w> </span><span class=s2>&quot;show tables from </span><span class=nv>$dbname</span><span class=s2>&quot;</span><span class=w> </span><span class=p>|</span>sed<span class=w> </span><span class=s1>&#39;1d&#39;</span><span class=sb>`</span>
<a id=__codelineno-5-23 name=__codelineno-5-23 href=#__codelineno-5-23></a><span class=w>  </span><span class=k>do</span>
<a id=__codelineno-5-24 name=__codelineno-5-24 href=#__codelineno-5-24></a>
<a id=__codelineno-5-25 name=__codelineno-5-25 href=#__codelineno-5-25></a><span class=w>  </span><span class=c1># 判断是否有表已经备份了,如果备份了则continue 调出当次循环，否则进行备份</span>
<a id=__codelineno-5-26 name=__codelineno-5-26 href=#__codelineno-5-26></a><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>!<span class=w> </span>-f<span class=w> </span><span class=nv>$Ba_Path</span>/<span class=si>${</span><span class=nv>dbname</span><span class=si>}</span>_<span class=si>${</span><span class=nv>tablename</span><span class=si>}</span>.sql.gz<span class=w> </span><span class=o>]</span><span class=p>;</span><span class=k>then</span>
<a id=__codelineno-5-27 name=__codelineno-5-27 href=#__codelineno-5-27></a>
<a id=__codelineno-5-28 name=__codelineno-5-28 href=#__codelineno-5-28></a><span class=w>   </span>mysqldump<span class=w> </span>-R<span class=w> </span>--master-data<span class=o>=</span><span class=m>2</span><span class=w> </span>--single-transaction<span class=w>  </span><span class=si>${</span><span class=nv>dbname</span><span class=si>}</span><span class=w> </span><span class=si>${</span><span class=nv>tablename</span><span class=si>}</span><span class=w> </span><span class=p>|</span>gzip<span class=w> </span>&gt;<span class=nv>$Ba_Path</span>/<span class=si>${</span><span class=nv>dbname</span><span class=si>}</span>_<span class=si>${</span><span class=nv>tablename</span><span class=si>}</span>.sql.gz
<a id=__codelineno-5-29 name=__codelineno-5-29 href=#__codelineno-5-29></a><span class=w>   </span><span class=nv>RETVAL</span><span class=o>=</span><span class=nv>$?</span>
<a id=__codelineno-5-30 name=__codelineno-5-30 href=#__codelineno-5-30></a>
<a id=__codelineno-5-31 name=__codelineno-5-31 href=#__codelineno-5-31></a><span class=w>   </span><span class=c1># 通过返回值判断备份是否执行成功,把执行的成功与否纪录到日志中</span>
<a id=__codelineno-5-32 name=__codelineno-5-32 href=#__codelineno-5-32></a><span class=w>   </span><span class=o>[</span><span class=w> </span><span class=nv>$?</span><span class=w> </span>-eq<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>dbname</span><span class=si>}</span><span class=s2>_</span><span class=si>${</span><span class=nv>tablename</span><span class=si>}</span><span class=s2> successful&quot;</span><span class=w> </span>&gt;&gt;<span class=nv>$Ba_Logs</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>dbname</span><span class=si>}</span><span class=s2>_</span><span class=si>${</span><span class=nv>tablename</span><span class=si>}</span><span class=s2> failed&quot;</span><span class=w> </span>&gt;&gt;<span class=nv>$Ba_Logs</span>
<a id=__codelineno-5-33 name=__codelineno-5-33 href=#__codelineno-5-33></a><span class=w>   </span><span class=c1># 对表的数据完整性做MD5校验</span>
<a id=__codelineno-5-34 name=__codelineno-5-34 href=#__codelineno-5-34></a><span class=w>   </span>md5sum<span class=w> </span><span class=nv>$Ba_Path</span>/<span class=si>${</span><span class=nv>dbname</span><span class=si>}</span>_<span class=si>${</span><span class=nv>tablename</span><span class=si>}</span>.sql.gz<span class=w>  </span>&gt;<span class=nv>$Md5_Path</span>/<span class=si>${</span><span class=nv>dbname</span><span class=si>}</span>_<span class=si>${</span><span class=nv>tablename</span><span class=si>}</span>_md5.log
<a id=__codelineno-5-35 name=__codelineno-5-35 href=#__codelineno-5-35></a>
<a id=__codelineno-5-36 name=__codelineno-5-36 href=#__codelineno-5-36></a><span class=w> </span><span class=k>else</span>
<a id=__codelineno-5-37 name=__codelineno-5-37 href=#__codelineno-5-37></a><span class=w>    </span><span class=k>continue</span>
<a id=__codelineno-5-38 name=__codelineno-5-38 href=#__codelineno-5-38></a>
<a id=__codelineno-5-39 name=__codelineno-5-39 href=#__codelineno-5-39></a><span class=w>  </span><span class=k>fi</span>
<a id=__codelineno-5-40 name=__codelineno-5-40 href=#__codelineno-5-40></a><span class=w> </span><span class=k>done</span>
<a id=__codelineno-5-41 name=__codelineno-5-41 href=#__codelineno-5-41></a><span class=k>done</span>
<a id=__codelineno-5-42 name=__codelineno-5-42 href=#__codelineno-5-42></a><span class=c1># 将备份日志结果邮件方式发送给管理员</span>
<a id=__codelineno-5-43 name=__codelineno-5-43 href=#__codelineno-5-43></a>mail<span class=w> </span>-s<span class=w> </span><span class=s2>&quot;</span><span class=nv>$HOSTNAME</span><span class=s2> </span><span class=nv>$IP</span><span class=s2>&quot;</span><span class=w> </span>jasonminghao@163.com<span class=w> </span>&lt;<span class=w> </span><span class=nv>$Ba_Logs</span>
</code></pre></div> <h2 id=生产环境下的统计类脚本>生产环境下的统计类脚本<a class=headerlink href=#生产环境下的统计类脚本 title="Permanent link">&para;</a></h2> <h3 id=统计设备资产明细脚本>统计设备资产明细脚本<a class=headerlink href=#统计设备资产明细脚本 title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a>
<a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a><span class=c1>#####get cpu info#####</span>
<a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a><span class=nv>cpu_num</span><span class=o>=</span><span class=sb>`</span>cat<span class=w> </span>/proc/cpuinfo<span class=p>|</span><span class=w> </span>grep<span class=w> </span><span class=s2>&quot;physical id&quot;</span><span class=p>|</span><span class=w> </span>sort<span class=p>|</span><span class=w> </span>uniq<span class=p>|</span><span class=w> </span>wc<span class=w> </span>-l<span class=sb>`</span>
<a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a><span class=nv>cpu_sum</span><span class=o>=</span><span class=sb>`</span>cat<span class=w> </span>/proc/cpuinfo<span class=w> </span><span class=p>|</span>grep<span class=w> </span>processor<span class=w> </span><span class=p>|</span>wc<span class=w> </span>-l<span class=sb>`</span>
<a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a><span class=nv>cpu_hz</span><span class=o>=</span><span class=sb>`</span>cat<span class=w> </span>/proc/cpuinfo<span class=w> </span><span class=p>|</span>grep<span class=w> </span><span class=s1>&#39;model name&#39;</span><span class=w> </span><span class=p>|</span>uniq<span class=w> </span>-c<span class=w> </span><span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;{print $NF}&#39;</span><span class=sb>`</span>
<a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a>
<a id=__codelineno-6-8 name=__codelineno-6-8 href=#__codelineno-6-8></a><span class=c1>#####get mem info#####</span>
<a id=__codelineno-6-9 name=__codelineno-6-9 href=#__codelineno-6-9></a><span class=nv>mem_m</span><span class=o>=</span><span class=m>0</span>
<a id=__codelineno-6-10 name=__codelineno-6-10 href=#__codelineno-6-10></a><span class=k>for</span><span class=w> </span>i<span class=w> </span><span class=k>in</span><span class=w> </span><span class=sb>`</span>dmidecode<span class=w> </span>-t<span class=w> </span>memory<span class=w> </span><span class=p>|</span>grep<span class=w> </span>Size:<span class=w> </span><span class=p>|</span>grep<span class=w> </span>-v<span class=w> </span><span class=s2>&quot;No Module Installed&quot;</span><span class=w> </span><span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;{print $2}&#39;</span><span class=sb>`</span>
<a id=__codelineno-6-11 name=__codelineno-6-11 href=#__codelineno-6-11></a><span class=k>do</span>
<a id=__codelineno-6-12 name=__codelineno-6-12 href=#__codelineno-6-12></a><span class=w>    </span><span class=nv>mem_m</span><span class=o>=</span><span class=sb>`</span>expr<span class=w> </span><span class=nv>$mem_m</span><span class=w> </span>+<span class=w> </span><span class=nv>$i</span><span class=sb>`</span>
<a id=__codelineno-6-13 name=__codelineno-6-13 href=#__codelineno-6-13></a><span class=k>done</span>
<a id=__codelineno-6-14 name=__codelineno-6-14 href=#__codelineno-6-14></a><span class=nv>mem_sum</span><span class=o>=</span><span class=sb>`</span><span class=nb>echo</span><span class=w> </span><span class=nv>$mem_m</span><span class=w> </span>/<span class=w> </span><span class=m>1024</span><span class=w> </span><span class=p>|</span><span class=w> </span>bc<span class=sb>`</span>
<a id=__codelineno-6-15 name=__codelineno-6-15 href=#__codelineno-6-15></a>
<a id=__codelineno-6-16 name=__codelineno-6-16 href=#__codelineno-6-16></a><span class=c1>#####get nic info#####</span>
<a id=__codelineno-6-17 name=__codelineno-6-17 href=#__codelineno-6-17></a><span class=nv>qian_num</span><span class=o>=</span><span class=sb>`</span>lspci<span class=w> </span><span class=p>|</span>grep<span class=w> </span>Ethernet<span class=w> </span><span class=p>|</span>egrep<span class=w> </span>-v<span class=w> </span><span class=s1>&#39;10-Gigabit|10 Gigabit&#39;</span><span class=w> </span><span class=p>|</span>wc<span class=w> </span>-l<span class=sb>`</span>
<a id=__codelineno-6-18 name=__codelineno-6-18 href=#__codelineno-6-18></a><span class=nv>wan_num</span><span class=o>=</span><span class=sb>`</span>lspci<span class=w> </span><span class=p>|</span>grep<span class=w> </span>Ethernet<span class=w> </span><span class=p>|</span>egrep<span class=w>  </span><span class=s1>&#39;10-Gigabit|10 Gigabit&#39;</span><span class=w> </span><span class=p>|</span>wc<span class=w> </span>-l<span class=sb>`</span>
<a id=__codelineno-6-19 name=__codelineno-6-19 href=#__codelineno-6-19></a>
<a id=__codelineno-6-20 name=__codelineno-6-20 href=#__codelineno-6-20></a><span class=c1>#####get disk num#####</span>
<a id=__codelineno-6-21 name=__codelineno-6-21 href=#__codelineno-6-21></a><span class=nv>B</span><span class=o>=</span><span class=sb>`</span>date<span class=w> </span>+%s<span class=sb>`</span>
<a id=__codelineno-6-22 name=__codelineno-6-22 href=#__codelineno-6-22></a><span class=nv>ssd_num</span><span class=o>=</span><span class=nv>0</span><span class=o>=</span>
<a id=__codelineno-6-23 name=__codelineno-6-23 href=#__codelineno-6-23></a><span class=nv>sata_num</span><span class=o>=</span><span class=m>0</span>
<a id=__codelineno-6-24 name=__codelineno-6-24 href=#__codelineno-6-24></a><span class=k>for</span><span class=w> </span>i<span class=w> </span><span class=k>in</span><span class=w> </span><span class=sb>`</span>lsblk<span class=w> </span><span class=p>|</span>grep<span class=w> </span><span class=s2>&quot;disk&quot;</span><span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;{print $1}&#39;</span><span class=p>|</span>egrep<span class=w> </span>-v<span class=w> </span><span class=s2>&quot;ram&quot;</span><span class=p>|</span>sort<span class=sb>`</span><span class=p>;</span>
<a id=__codelineno-6-25 name=__codelineno-6-25 href=#__codelineno-6-25></a><span class=k>do</span>
<a id=__codelineno-6-26 name=__codelineno-6-26 href=#__codelineno-6-26></a><span class=w>    </span><span class=nv>code</span><span class=o>=</span><span class=sb>`</span>cat<span class=w> </span>/sys/block/<span class=nv>$i</span>/queue/rotational<span class=sb>`</span>
<a id=__codelineno-6-27 name=__codelineno-6-27 href=#__codelineno-6-27></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$code</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;0&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=k>then</span>
<a id=__codelineno-6-28 name=__codelineno-6-28 href=#__codelineno-6-28></a><span class=w>       </span><span class=nv>ssd_num</span><span class=o>=</span><span class=sb>`</span>expr<span class=w> </span><span class=nv>$ssd_num</span><span class=w> </span>+<span class=w> </span><span class=m>1</span><span class=sb>`</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=nv>$i</span><span class=w> </span>&gt;&gt;/tmp/<span class=nv>$B</span>.ssd
<a id=__codelineno-6-29 name=__codelineno-6-29 href=#__codelineno-6-29></a><span class=w>    </span><span class=k>else</span>
<a id=__codelineno-6-30 name=__codelineno-6-30 href=#__codelineno-6-30></a><span class=w>       </span><span class=nv>sata_num</span><span class=o>=</span><span class=sb>`</span>expr<span class=w> </span><span class=nv>$sata_num</span><span class=w> </span>+<span class=w> </span><span class=m>1</span><span class=sb>`</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=nv>$i</span><span class=w> </span>&gt;&gt;/tmp/<span class=nv>$B</span>.sata
<a id=__codelineno-6-31 name=__codelineno-6-31 href=#__codelineno-6-31></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-6-32 name=__codelineno-6-32 href=#__codelineno-6-32></a><span class=k>done</span>
<a id=__codelineno-6-33 name=__codelineno-6-33 href=#__codelineno-6-33></a>
<a id=__codelineno-6-34 name=__codelineno-6-34 href=#__codelineno-6-34></a><span class=c1>#####get disk sum#####</span>
<a id=__codelineno-6-35 name=__codelineno-6-35 href=#__codelineno-6-35></a><span class=nv>C</span><span class=o>=</span><span class=sb>`</span>date<span class=w> </span>+%N<span class=sb>`</span>
<a id=__codelineno-6-36 name=__codelineno-6-36 href=#__codelineno-6-36></a><span class=nv>ssd_sum</span><span class=o>=</span><span class=m>0</span>
<a id=__codelineno-6-37 name=__codelineno-6-37 href=#__codelineno-6-37></a><span class=nv>sata_sum</span><span class=o>=</span><span class=m>0</span>
<a id=__codelineno-6-38 name=__codelineno-6-38 href=#__codelineno-6-38></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-f<span class=w> </span>/tmp/<span class=nv>$B</span>.ssd<span class=w> </span><span class=o>]</span><span class=p>;</span><span class=k>then</span>
<a id=__codelineno-6-39 name=__codelineno-6-39 href=#__codelineno-6-39></a><span class=w>    </span><span class=k>for</span><span class=w> </span>n<span class=w> </span><span class=k>in</span><span class=w> </span><span class=sb>`</span>cat<span class=w> </span>/tmp/<span class=nv>$B</span>.ssd<span class=sb>`</span><span class=p>;</span><span class=k>do</span>
<a id=__codelineno-6-40 name=__codelineno-6-40 href=#__codelineno-6-40></a><span class=w>        </span>fdisk<span class=w> </span>-l<span class=w> </span>/dev/<span class=nv>$n</span><span class=w> </span>&gt;&gt;/tmp/<span class=nv>$C</span>.ssd<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-6-41 name=__codelineno-6-41 href=#__codelineno-6-41></a><span class=w>        </span><span class=k>for</span><span class=w> </span>x<span class=w> </span><span class=k>in</span><span class=w> </span><span class=sb>`</span>grep<span class=w> </span><span class=s2>&quot;Disk /dev&quot;</span><span class=w> </span>/tmp/<span class=nv>$C</span>.ssd<span class=w> </span><span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;{print $3}&#39;</span><span class=sb>`</span><span class=p>;</span><span class=k>do</span>
<a id=__codelineno-6-42 name=__codelineno-6-42 href=#__codelineno-6-42></a><span class=w>            </span><span class=nv>u</span><span class=o>=</span><span class=sb>`</span><span class=nb>echo</span><span class=w> </span><span class=nv>$x</span><span class=w> </span>/<span class=w> </span><span class=m>1</span><span class=p>|</span>bc<span class=sb>`</span>
<a id=__codelineno-6-43 name=__codelineno-6-43 href=#__codelineno-6-43></a><span class=w>        </span><span class=k>done</span>
<a id=__codelineno-6-44 name=__codelineno-6-44 href=#__codelineno-6-44></a><span class=w>     </span><span class=nv>ssd_sum</span><span class=o>=</span><span class=sb>`</span>expr<span class=w> </span><span class=nv>$ssd_sum</span><span class=w> </span>+<span class=w> </span><span class=nv>$u</span><span class=w> </span>+<span class=w> </span><span class=m>1</span><span class=sb>`</span>
<a id=__codelineno-6-45 name=__codelineno-6-45 href=#__codelineno-6-45></a><span class=w>    </span><span class=k>done</span>
<a id=__codelineno-6-46 name=__codelineno-6-46 href=#__codelineno-6-46></a><span class=k>fi</span>
<a id=__codelineno-6-47 name=__codelineno-6-47 href=#__codelineno-6-47></a>
<a id=__codelineno-6-48 name=__codelineno-6-48 href=#__codelineno-6-48></a><span class=k>for</span><span class=w> </span>m<span class=w> </span><span class=k>in</span><span class=w> </span><span class=sb>`</span>cat<span class=w> </span>/tmp/<span class=nv>$B</span>.sata<span class=sb>`</span><span class=p>;</span><span class=k>do</span>
<a id=__codelineno-6-49 name=__codelineno-6-49 href=#__codelineno-6-49></a><span class=w>   </span>fdisk<span class=w> </span>-l<span class=w> </span>/dev/<span class=nv>$m</span><span class=w> </span>&gt;&gt;/tmp/<span class=nv>$C</span>.sata<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-6-50 name=__codelineno-6-50 href=#__codelineno-6-50></a><span class=w>   </span><span class=k>for</span><span class=w> </span>y<span class=w> </span><span class=k>in</span><span class=w> </span><span class=sb>`</span>grep<span class=w> </span><span class=s2>&quot;Disk /dev&quot;</span><span class=w> </span>/tmp/<span class=nv>$C</span>.sata<span class=w> </span><span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;{print $3}&#39;</span><span class=sb>`</span><span class=p>;</span><span class=k>do</span>
<a id=__codelineno-6-51 name=__codelineno-6-51 href=#__codelineno-6-51></a><span class=w>      </span><span class=nv>v</span><span class=o>=</span><span class=sb>`</span><span class=nb>echo</span><span class=w> </span><span class=nv>$y</span><span class=w> </span>/<span class=w> </span><span class=m>1</span><span class=p>|</span>bc<span class=sb>`</span>
<a id=__codelineno-6-52 name=__codelineno-6-52 href=#__codelineno-6-52></a><span class=w>   </span><span class=k>done</span>
<a id=__codelineno-6-53 name=__codelineno-6-53 href=#__codelineno-6-53></a><span class=w>   </span><span class=nv>sata_sum</span><span class=o>=</span><span class=sb>`</span>expr<span class=w> </span><span class=nv>$sata_sum</span><span class=w> </span>+<span class=w> </span><span class=nv>$v</span><span class=w> </span>+<span class=w> </span><span class=m>1</span><span class=sb>`</span>
<a id=__codelineno-6-54 name=__codelineno-6-54 href=#__codelineno-6-54></a><span class=k>done</span>
<a id=__codelineno-6-55 name=__codelineno-6-55 href=#__codelineno-6-55></a>
<a id=__codelineno-6-56 name=__codelineno-6-56 href=#__codelineno-6-56></a><span class=c1>#####show dev info#####</span>
<a id=__codelineno-6-57 name=__codelineno-6-57 href=#__codelineno-6-57></a><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=nv>$ip</span><span class=s2> `hostname` </span><span class=nv>$plat</span><span class=s2> </span><span class=nv>$pop</span><span class=s2> </span><span class=nv>$prov</span><span class=s2> &quot;</span>
<a id=__codelineno-6-58 name=__codelineno-6-58 href=#__codelineno-6-58></a><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;CPU(物理核数,逻辑核数,频率): </span><span class=nv>$cpu_num</span><span class=s2> </span><span class=nv>$cpu_sum</span><span class=s2> </span><span class=nv>$cpu_hz</span><span class=s2> &quot;</span>
<a id=__codelineno-6-59 name=__codelineno-6-59 href=#__codelineno-6-59></a><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;内存(GB): </span><span class=nv>$mem_sum</span><span class=s2> &quot;</span>
<a id=__codelineno-6-60 name=__codelineno-6-60 href=#__codelineno-6-60></a><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;网卡数量(千兆,万兆): </span><span class=nv>$qian_num</span><span class=s2> </span><span class=nv>$wan_num</span><span class=s2> &quot;</span>
<a id=__codelineno-6-61 name=__codelineno-6-61 href=#__codelineno-6-61></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;SSD数量: </span><span class=si>${</span><span class=nv>ssd_num</span><span class=si>}</span><span class=s2> SSD容量: </span><span class=si>${</span><span class=nv>ssd_sum</span><span class=si>}</span><span class=s2>GB SATA数量: </span><span class=si>${</span><span class=nv>sata_num</span><span class=si>}</span><span class=s2> SATA容量 </span><span class=si>${</span><span class=nv>sata_sum</span><span class=si>}</span><span class=s2>GB &quot;</span>
</code></pre></div> <h3 id=统计重要业务程序是否正常运行>统计重要业务程序是否正常运行<a class=headerlink href=#统计重要业务程序是否正常运行 title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a><span class=nv>sync_redis_status</span><span class=o>=</span><span class=sb>`</span>ps<span class=w> </span>aux<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>sync_redis.py<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>-v<span class=w> </span>grep<span class=w> </span><span class=p>|</span><span class=w> </span>wc<span class=w> </span>-l<span class=w> </span><span class=sb>`</span>
<a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=si>${</span><span class=nv>sync_redis_status</span><span class=si>}</span><span class=w> </span>!<span class=o>=</span><span class=w> </span><span class=m>1</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Critical! sync_redis is Died&quot;</span>
<a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a><span class=w>    </span><span class=nb>exit</span><span class=w> </span><span class=m>2</span>
<a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a><span class=k>else</span>
<a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;OK! sync_redis is Alive&quot;</span>
<a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a><span class=w>    </span><span class=nb>exit</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-7-9 name=__codelineno-7-9 href=#__codelineno-7-9></a><span class=k>fi</span>
</code></pre></div> <h3 id=统计机器的ip连接数>统计机器的IP连接数<a class=headerlink href=#统计机器的ip连接数 title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a><span class=c1>#脚本的$1和$2报警阀值可以根据业务的实际情况调整。</span>
<a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a><span class=c1>#$1 = 15000，$2 = 20000</span>
<a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a><span class=nv>ip_conns</span><span class=o>=</span><span class=sb>`</span>netstat<span class=w> </span>-an<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>tcp<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>EST<span class=w> </span><span class=p>|</span><span class=w> </span>wc<span class=w> </span>-l<span class=sb>`</span>
<a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a><span class=nv>messages</span><span class=o>=</span><span class=sb>`</span>netstat<span class=w> </span>-ant<span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span><span class=s1>&#39;/^tcp/ <ins class=critic>S[$NF]} END {for(a in S) print a, S[a]}&#39;</span><span class=p>|</span>tr<span class=w> </span>-s<span class=w> </span><span class=s1>&#39;\n&#39;</span><span class=w> </span><span class=s1>&#39;,&#39;</span><span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span>-r<span class=w> </span><span class=s1>&#39;s/(.*),/\1\n/g&#39;</span><span class=w> </span><span class=sb>`</span>
<a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a>
<a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=nv>$ip_conns</span><span class=w> </span>-lt<span class=w> </span><span class=nv>$1</span><span class=w> </span><span class=o>]</span>
<a id=__codelineno-8-8 name=__codelineno-8-8 href=#__codelineno-8-8></a><span class=k>then</span>
<a id=__codelineno-8-9 name=__codelineno-8-9 href=#__codelineno-8-9></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$messages</span><span class=s2>,OK -connect counts is </span><span class=nv>$ip_conns</span><span class=s2>&quot;</span>
<a id=__codelineno-8-10 name=__codelineno-8-10 href=#__codelineno-8-10></a><span class=w>    </span><span class=nb>exit</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-8-11 name=__codelineno-8-11 href=#__codelineno-8-11></a><span class=k>fi</span>
<a id=__codelineno-8-12 name=__codelineno-8-12 href=#__codelineno-8-12></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=nv>$ip_conns</span><span class=w> </span>-gt<span class=w> </span><span class=nv>$1</span><span class=w> </span>-a<span class=w> </span><span class=nv>$ip_conns</span><span class=w> </span>-lt<span class=w> </span><span class=nv>$2</span><span class=w> </span><span class=o>]</span>
<a id=__codelineno-8-13 name=__codelineno-8-13 href=#__codelineno-8-13></a><span class=k>then</span>
<a id=__codelineno-8-14 name=__codelineno-8-14 href=#__codelineno-8-14></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$messages</span><span class=s2>,Warning -connect counts is </span><span class=nv>$ip_conns</span><span class=s2>&quot;</span>
<a id=__codelineno-8-15 name=__codelineno-8-15 href=#__codelineno-8-15></a><span class=w>    </span><span class=nb>exit</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-8-16 name=__codelineno-8-16 href=#__codelineno-8-16></a><span class=k>fi</span>
<a id=__codelineno-8-17 name=__codelineno-8-17 href=#__codelineno-8-17></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=nv>$ip_conns</span><span class=w> </span>-gt<span class=w> </span><span class=nv>$2</span><span class=w> </span><span class=o>]</span>
<a id=__codelineno-8-18 name=__codelineno-8-18 href=#__codelineno-8-18></a><span class=k>then</span>
<a id=__codelineno-8-19 name=__codelineno-8-19 href=#__codelineno-8-19></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$messages</span><span class=s2>,Critical -connect counts is </span><span class=nv>$ip_conns</span><span class=s2>&quot;</span>
<a id=__codelineno-8-20 name=__codelineno-8-20 href=#__codelineno-8-20></a><span class=w>    </span><span class=nb>exit</span><span class=w> </span><span class=m>2</span>
<a id=__codelineno-8-21 name=__codelineno-8-21 href=#__codelineno-8-21></a><span class=k>fi</span>
</code></pre></div> <h3 id=修改ip_主机名_网卡信息脚本>修改IP_主机名_网卡信息脚本<a class=headerlink href=#修改ip_主机名_网卡信息脚本 title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=ch>#!/usr/bin/env bash</span>
<a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a><span class=c1>#usage:xxx</span>
<a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a><span class=c1>#scripts_name:xxx.sh</span>
<a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a>
<a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a><span class=c1>#静态IP修改</span>
<a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a><span class=c1>#动态IP修改</span>
<a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a><span class=c1>#根据IP生产主机名并配置</span>
<a id=__codelineno-9-8 name=__codelineno-9-8 href=#__codelineno-9-8></a><span class=c1>#修改DNS域名解析</span>
<a id=__codelineno-9-9 name=__codelineno-9-9 href=#__codelineno-9-9></a><span class=nv>ETHCONF</span><span class=o>=</span>/etc/sysconfig/network-scripts/ifcfg-ens32
<a id=__codelineno-9-10 name=__codelineno-9-10 href=#__codelineno-9-10></a><span class=nv>HOSTS</span><span class=o>=</span>/etc/hosts
<a id=__codelineno-9-11 name=__codelineno-9-11 href=#__codelineno-9-11></a><span class=nv>NETWORK</span><span class=o>=</span>/etc/sysconfig/network
<a id=__codelineno-9-12 name=__codelineno-9-12 href=#__codelineno-9-12></a><span class=nv>DIR</span><span class=o>=</span>/data/backup/<span class=sb>`</span>date<span class=w> </span>+%Y%m%d<span class=sb>`</span>
<a id=__codelineno-9-13 name=__codelineno-9-13 href=#__codelineno-9-13></a><span class=nv>NETMASK</span><span class=o>=</span><span class=m>255</span>.255.255.0
<a id=__codelineno-9-14 name=__codelineno-9-14 href=#__codelineno-9-14></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;------------------------------------------------------------------&quot;</span>
<a id=__codelineno-9-15 name=__codelineno-9-15 href=#__codelineno-9-15></a>judeg_ip<span class=o>(){</span>
<a id=__codelineno-9-16 name=__codelineno-9-16 href=#__codelineno-9-16></a><span class=w>    </span><span class=nb>read</span><span class=w> </span>-p<span class=w> </span><span class=s2>&quot;Please enter ip Address,example 192.168.0.11 ip&quot;</span>:IPADDR
<a id=__codelineno-9-17 name=__codelineno-9-17 href=#__codelineno-9-17></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=nv>$IPADDR</span><span class=p>|</span>grep<span class=w> </span>-v<span class=w> </span><span class=s2>&quot;[Az-Zz]&quot;</span><span class=p>|</span>grep<span class=w> </span>--color<span class=w> </span>-E<span class=w> </span><span class=s2>&quot;([0-9]{1,3}\.){3}[0-9]{1,3}&quot;</span>
<a id=__codelineno-9-18 name=__codelineno-9-18 href=#__codelineno-9-18></a><span class=o>}</span>
<a id=__codelineno-9-19 name=__codelineno-9-19 href=#__codelineno-9-19></a>
<a id=__codelineno-9-20 name=__codelineno-9-20 href=#__codelineno-9-20></a>count_ip<span class=o>(){</span>
<a id=__codelineno-9-21 name=__codelineno-9-21 href=#__codelineno-9-21></a><span class=w>    </span><span class=nv>count</span><span class=o>=(</span><span class=sb>`</span><span class=nb>echo</span><span class=w> </span><span class=si>${</span><span class=nv>IPADDR</span><span class=si>}</span><span class=p>|</span>awk<span class=w> </span>-F.<span class=w> </span><span class=s1>&#39;{print $1,$2,$3,$4}&#39;</span><span class=sb>`</span><span class=o>)</span>
<a id=__codelineno-9-22 name=__codelineno-9-22 href=#__codelineno-9-22></a><span class=w>    </span><span class=nv>IP1</span><span class=o>=</span><span class=si>${</span><span class=nv>count</span><span class=p>[0]</span><span class=si>}</span>
<a id=__codelineno-9-23 name=__codelineno-9-23 href=#__codelineno-9-23></a><span class=w>    </span><span class=nv>IP2</span><span class=o>=</span><span class=si>${</span><span class=nv>count</span><span class=p>[1]</span><span class=si>}</span>
<a id=__codelineno-9-24 name=__codelineno-9-24 href=#__codelineno-9-24></a><span class=w>    </span><span class=nv>IP3</span><span class=o>=</span><span class=si>${</span><span class=nv>count</span><span class=p>[2]</span><span class=si>}</span>
<a id=__codelineno-9-25 name=__codelineno-9-25 href=#__codelineno-9-25></a><span class=w>    </span><span class=nv>IP4</span><span class=o>=</span><span class=si>${</span><span class=nv>count</span><span class=p>[3]</span><span class=si>}</span>
<a id=__codelineno-9-26 name=__codelineno-9-26 href=#__codelineno-9-26></a><span class=o>}</span>
<a id=__codelineno-9-27 name=__codelineno-9-27 href=#__codelineno-9-27></a>
<a id=__codelineno-9-28 name=__codelineno-9-28 href=#__codelineno-9-28></a>
<a id=__codelineno-9-29 name=__codelineno-9-29 href=#__codelineno-9-29></a>ip_check<span class=o>(){</span>
<a id=__codelineno-9-30 name=__codelineno-9-30 href=#__codelineno-9-30></a>judeg_ip
<a id=__codelineno-9-31 name=__codelineno-9-31 href=#__codelineno-9-31></a>
<a id=__codelineno-9-32 name=__codelineno-9-32 href=#__codelineno-9-32></a><span class=k>while</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$?</span><span class=s2>&quot;</span><span class=w> </span>-ne<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>do</span>
<a id=__codelineno-9-33 name=__codelineno-9-33 href=#__codelineno-9-33></a><span class=w>    </span>judeg_ip
<a id=__codelineno-9-34 name=__codelineno-9-34 href=#__codelineno-9-34></a><span class=k>done</span>
<a id=__codelineno-9-35 name=__codelineno-9-35 href=#__codelineno-9-35></a>
<a id=__codelineno-9-36 name=__codelineno-9-36 href=#__codelineno-9-36></a>count_ip
<a id=__codelineno-9-37 name=__codelineno-9-37 href=#__codelineno-9-37></a><span class=k>while</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$IP1</span><span class=s2>&quot;</span><span class=w> </span>-lt<span class=w> </span><span class=m>0</span><span class=w> </span>-o<span class=w> </span><span class=s2>&quot;</span><span class=nv>$IP1</span><span class=s2>&quot;</span><span class=w> </span>-ge<span class=w> </span><span class=m>255</span><span class=w> </span>-o<span class=w> </span><span class=s2>&quot;</span><span class=nv>$IP2</span><span class=s2>&quot;</span><span class=w> </span>-ge<span class=w> </span><span class=m>255</span><span class=w> </span>-o<span class=w> </span><span class=s2>&quot;</span><span class=nv>$IP3</span><span class=s2>&quot;</span><span class=w> </span>-ge<span class=w> </span><span class=m>255</span><span class=w> </span>-o<span class=w> </span><span class=s2>&quot;</span><span class=nv>$IP4</span><span class=s2>&quot;</span><span class=w> </span>-ge<span class=w> </span><span class=m>255</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>do</span>
<a id=__codelineno-9-38 name=__codelineno-9-38 href=#__codelineno-9-38></a><span class=w>    </span>judeg_ip
<a id=__codelineno-9-39 name=__codelineno-9-39 href=#__codelineno-9-39></a><span class=w>    </span><span class=k>while</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$?</span><span class=s2>&quot;</span><span class=w> </span>-ne<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>do</span>
<a id=__codelineno-9-40 name=__codelineno-9-40 href=#__codelineno-9-40></a><span class=w>        </span>judeg_ip
<a id=__codelineno-9-41 name=__codelineno-9-41 href=#__codelineno-9-41></a><span class=w>    </span><span class=k>done</span>
<a id=__codelineno-9-42 name=__codelineno-9-42 href=#__codelineno-9-42></a><span class=w>    </span>count_ip
<a id=__codelineno-9-43 name=__codelineno-9-43 href=#__codelineno-9-43></a><span class=k>done</span>
<a id=__codelineno-9-44 name=__codelineno-9-44 href=#__codelineno-9-44></a><span class=o>}</span>
<a id=__codelineno-9-45 name=__codelineno-9-45 href=#__codelineno-9-45></a>
<a id=__codelineno-9-46 name=__codelineno-9-46 href=#__codelineno-9-46></a>
<a id=__codelineno-9-47 name=__codelineno-9-47 href=#__codelineno-9-47></a>change_ip<span class=o>(){</span>
<a id=__codelineno-9-48 name=__codelineno-9-48 href=#__codelineno-9-48></a>
<a id=__codelineno-9-49 name=__codelineno-9-49 href=#__codelineno-9-49></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>!<span class=w> </span>-d<span class=w> </span><span class=nv>$DIR</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-9-50 name=__codelineno-9-50 href=#__codelineno-9-50></a><span class=w>    </span>mkdir<span class=w> </span>-p<span class=w> </span><span class=nv>$DIR</span>
<a id=__codelineno-9-51 name=__codelineno-9-51 href=#__codelineno-9-51></a><span class=k>fi</span>
<a id=__codelineno-9-52 name=__codelineno-9-52 href=#__codelineno-9-52></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;The Change ip address to Backup Interface eth0&quot;</span>
<a id=__codelineno-9-53 name=__codelineno-9-53 href=#__codelineno-9-53></a>cp<span class=w> </span><span class=nv>$ETHCONF</span><span class=w> </span><span class=nv>$DIR</span>
<a id=__codelineno-9-54 name=__codelineno-9-54 href=#__codelineno-9-54></a>grep<span class=w> </span><span class=s2>&quot;dhcp&quot;</span><span class=w> </span><span class=nv>$ETHCONF</span>
<a id=__codelineno-9-55 name=__codelineno-9-55 href=#__codelineno-9-55></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$?</span><span class=s2>&quot;</span><span class=w> </span>-eq<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-9-56 name=__codelineno-9-56 href=#__codelineno-9-56></a><span class=w>    </span><span class=nb>read</span><span class=w> </span>-p<span class=w> </span><span class=s2>&quot;Please enter ip Address:&quot;</span><span class=w> </span>IPADDR
<a id=__codelineno-9-57 name=__codelineno-9-57 href=#__codelineno-9-57></a><span class=w>    </span>sed<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;s/dhcp/static/g&#39;</span><span class=w> </span><span class=nv>$ETHCONF</span>
<a id=__codelineno-9-58 name=__codelineno-9-58 href=#__codelineno-9-58></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;IPADDR=</span><span class=nv>$IPADDR</span><span class=s2>\nNERMASK=</span><span class=nv>$NETMASK</span><span class=s2>\nGATEWAY=`echo </span><span class=nv>$IPADDR</span><span class=s2>|awk -F. &#39;{print </span><span class=nv>$1</span><span class=s2>&quot;</span>.<span class=s2>&quot;</span><span class=nv>$2</span><span class=s2>&quot;</span>.<span class=s2>&quot;</span><span class=nv>$3</span><span class=s2>}&#39;`.2&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span><span class=nv>$ETHCONF</span>
<a id=__codelineno-9-59 name=__codelineno-9-59 href=#__codelineno-9-59></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;The IP configuration success. !&quot;</span>
<a id=__codelineno-9-60 name=__codelineno-9-60 href=#__codelineno-9-60></a><span class=k>else</span>
<a id=__codelineno-9-61 name=__codelineno-9-61 href=#__codelineno-9-61></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;Static IP has been configured,please confirm whether to modify,yes or No&quot;</span><span class=p>;</span>
<a id=__codelineno-9-62 name=__codelineno-9-62 href=#__codelineno-9-62></a><span class=w>    </span><span class=nb>read</span><span class=w> </span>i
<a id=__codelineno-9-63 name=__codelineno-9-63 href=#__codelineno-9-63></a><span class=k>fi</span>
<a id=__codelineno-9-64 name=__codelineno-9-64 href=#__codelineno-9-64></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$i</span><span class=s2>&quot;</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s2>&quot;y&quot;</span><span class=w> </span>-o<span class=w> </span><span class=s2>&quot;</span><span class=nv>$i</span><span class=s2>&quot;</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s2>&quot;yes&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-9-65 name=__codelineno-9-65 href=#__codelineno-9-65></a><span class=w>    </span>ip_check
<a id=__codelineno-9-66 name=__codelineno-9-66 href=#__codelineno-9-66></a><span class=w>    </span>sed<span class=w> </span>-i<span class=w> </span>-e<span class=w> </span><span class=s1>&#39;/IPADDR/d&#39;</span><span class=w> </span>-e<span class=w> </span><span class=s1>&#39;/NETMASK/d&#39;</span><span class=w> </span>-e<span class=w> </span><span class=s1>&#39;/GATEWAY/d&#39;</span><span class=w> </span><span class=nv>$ETHCONF</span>
<a id=__codelineno-9-67 name=__codelineno-9-67 href=#__codelineno-9-67></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;IPADDR=</span><span class=nv>$IPADDR</span><span class=s2>\nNETMASK=</span><span class=nv>$NETMASK</span><span class=s2>\nGATEWAY=`echo  </span><span class=nv>$IPADDR</span><span class=s2>|awk -F. &#39;{print </span><span class=nv>$1</span><span class=s2>&quot;</span>.<span class=s2>&quot;</span><span class=nv>$2</span><span class=s2>&quot;</span>.<span class=s2>&quot;</span><span class=nv>$3</span><span class=s2>}&#39;`.2&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span><span class=nv>$ETHCONF</span>
<a id=__codelineno-9-68 name=__codelineno-9-68 href=#__codelineno-9-68></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;The IP configuration success. !&quot;</span>
<a id=__codelineno-9-69 name=__codelineno-9-69 href=#__codelineno-9-69></a><span class=w>    </span><span class=nb>echo</span>
<a id=__codelineno-9-70 name=__codelineno-9-70 href=#__codelineno-9-70></a><span class=k>else</span>
<a id=__codelineno-9-71 name=__codelineno-9-71 href=#__codelineno-9-71></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Static IP already exists,please exit.&quot;</span>
<a id=__codelineno-9-72 name=__codelineno-9-72 href=#__codelineno-9-72></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=nv>$?</span>
<a id=__codelineno-9-73 name=__codelineno-9-73 href=#__codelineno-9-73></a><span class=k>fi</span>
<a id=__codelineno-9-74 name=__codelineno-9-74 href=#__codelineno-9-74></a><span class=o>}</span>
<a id=__codelineno-9-75 name=__codelineno-9-75 href=#__codelineno-9-75></a>
<a id=__codelineno-9-76 name=__codelineno-9-76 href=#__codelineno-9-76></a>change_hosts<span class=o>(){</span>
<a id=__codelineno-9-77 name=__codelineno-9-77 href=#__codelineno-9-77></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>!<span class=w> </span>-d<span class=w> </span><span class=nv>$DIR</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-9-78 name=__codelineno-9-78 href=#__codelineno-9-78></a><span class=w>        </span>mkdir<span class=w> </span>-p<span class=w> </span><span class=nv>$DIR</span>
<a id=__codelineno-9-79 name=__codelineno-9-79 href=#__codelineno-9-79></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-9-80 name=__codelineno-9-80 href=#__codelineno-9-80></a><span class=w>    </span>cp<span class=w> </span><span class=nv>$HOSTS</span><span class=w> </span><span class=nv>$DIR</span>
<a id=__codelineno-9-81 name=__codelineno-9-81 href=#__codelineno-9-81></a><span class=w>    </span>ip_check
<a id=__codelineno-9-82 name=__codelineno-9-82 href=#__codelineno-9-82></a><span class=w>    </span><span class=nv>host</span><span class=o>=</span><span class=sb>`</span><span class=nb>echo</span><span class=w> </span><span class=nv>$IPADDR</span><span class=p>|</span>sed<span class=w> </span><span class=s1>&#39;s/\./-/g&#39;</span><span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;{print &quot;BJ-IDC-&quot; $0 &quot;-Hujianli.net&quot;}&#39;</span><span class=sb>`</span>
<a id=__codelineno-9-83 name=__codelineno-9-83 href=#__codelineno-9-83></a><span class=w>    </span>cat<span class=w> </span><span class=nv>$HOSTS</span><span class=p>|</span>grep<span class=w> </span><span class=s2>&quot;</span><span class=nv>$host</span><span class=s2>&quot;</span>
<a id=__codelineno-9-84 name=__codelineno-9-84 href=#__codelineno-9-84></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$?</span><span class=s2>&quot;</span><span class=w> </span>-ne<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-9-85 name=__codelineno-9-85 href=#__codelineno-9-85></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$IPADDR</span><span class=s2>    </span><span class=nv>$host</span><span class=s2>&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span><span class=nv>$HOSTS</span>
<a id=__codelineno-9-86 name=__codelineno-9-86 href=#__codelineno-9-86></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;The hosts modify success&quot;</span>
<a id=__codelineno-9-87 name=__codelineno-9-87 href=#__codelineno-9-87></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-9-88 name=__codelineno-9-88 href=#__codelineno-9-88></a><span class=w>    </span>grep<span class=w> </span><span class=s2>&quot;</span><span class=nv>$host</span><span class=s2>&quot;</span><span class=w> </span><span class=nv>$NETWORK</span>
<a id=__codelineno-9-89 name=__codelineno-9-89 href=#__codelineno-9-89></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$?</span><span class=s2>&quot;</span><span class=w> </span>-ne<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-9-90 name=__codelineno-9-90 href=#__codelineno-9-90></a><span class=w>        </span>sed<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;s/^HOSTNAME/#HOSTNAME/g&#39;</span><span class=w> </span><span class=nv>$NETWORK</span>
<a id=__codelineno-9-91 name=__codelineno-9-91 href=#__codelineno-9-91></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;NETWORK=</span><span class=nv>$host</span><span class=s2>&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span><span class=nv>$NETWORK</span>
<a id=__codelineno-9-92 name=__codelineno-9-92 href=#__codelineno-9-92></a><span class=w>        </span>hostname<span class=w> </span><span class=nv>$host</span><span class=p>;</span>su
<a id=__codelineno-9-93 name=__codelineno-9-93 href=#__codelineno-9-93></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-9-94 name=__codelineno-9-94 href=#__codelineno-9-94></a><span class=o>}</span>
<a id=__codelineno-9-95 name=__codelineno-9-95 href=#__codelineno-9-95></a>
<a id=__codelineno-9-96 name=__codelineno-9-96 href=#__codelineno-9-96></a>
<a id=__codelineno-9-97 name=__codelineno-9-97 href=#__codelineno-9-97></a><span class=nv>PS3</span><span class=o>=</span><span class=s2>&quot;Please Select configuration ip or configuration host:&quot;</span>
<a id=__codelineno-9-98 name=__codelineno-9-98 href=#__codelineno-9-98></a><span class=k>select</span><span class=w> </span>i<span class=w> </span><span class=k>in</span><span class=w> </span><span class=s2>&quot;modify_ip&quot;</span><span class=w> </span><span class=s2>&quot;modify_hosts&quot;</span><span class=w> </span><span class=s2>&quot;exit&quot;</span>
<a id=__codelineno-9-99 name=__codelineno-9-99 href=#__codelineno-9-99></a><span class=k>do</span>
<a id=__codelineno-9-100 name=__codelineno-9-100 href=#__codelineno-9-100></a><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$i</span><span class=s2>&quot;</span><span class=w> </span><span class=k>in</span>
<a id=__codelineno-9-101 name=__codelineno-9-101 href=#__codelineno-9-101></a><span class=w>    </span>modify_ip<span class=o>)</span>
<a id=__codelineno-9-102 name=__codelineno-9-102 href=#__codelineno-9-102></a><span class=w>        </span>change_ip
<a id=__codelineno-9-103 name=__codelineno-9-103 href=#__codelineno-9-103></a><span class=w>       </span><span class=p>;;</span>
<a id=__codelineno-9-104 name=__codelineno-9-104 href=#__codelineno-9-104></a><span class=w>    </span>modify_hosts<span class=o>)</span>
<a id=__codelineno-9-105 name=__codelineno-9-105 href=#__codelineno-9-105></a><span class=w>        </span>change_hosts
<a id=__codelineno-9-106 name=__codelineno-9-106 href=#__codelineno-9-106></a><span class=w>       </span><span class=p>;;</span>
<a id=__codelineno-9-107 name=__codelineno-9-107 href=#__codelineno-9-107></a><span class=w>    </span><span class=nb>exit</span><span class=o>)</span>
<a id=__codelineno-9-108 name=__codelineno-9-108 href=#__codelineno-9-108></a><span class=w>        </span><span class=nb>exit</span>
<a id=__codelineno-9-109 name=__codelineno-9-109 href=#__codelineno-9-109></a><span class=w>       </span><span class=p>;;</span>
<a id=__codelineno-9-110 name=__codelineno-9-110 href=#__codelineno-9-110></a><span class=w>    </span>*<span class=o>)</span>
<a id=__codelineno-9-111 name=__codelineno-9-111 href=#__codelineno-9-111></a><span class=w>       </span><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;1)modify_ip\n2)modify_host\n3)exit&quot;</span>
<a id=__codelineno-9-112 name=__codelineno-9-112 href=#__codelineno-9-112></a><span class=w>    </span><span class=k>esac</span>
<a id=__codelineno-9-113 name=__codelineno-9-113 href=#__codelineno-9-113></a><span class=k>done</span>
</code></pre></div> <h2 id=生产环境下的监控类脚本>生产环境下的监控类脚本<a class=headerlink href=#生产环境下的监控类脚本 title="Permanent link">&para;</a></h2> <h3 id=监控nginx进程的脚本>监控Nginx进程的脚本<a class=headerlink href=#监控nginx进程的脚本 title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a><span class=k>while</span><span class=w> </span>:
<a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a><span class=k>do</span>
<a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a><span class=w> </span><span class=nv>nginxpid</span><span class=o>=</span><span class=sb>`</span>ps<span class=w> </span>-C<span class=w> </span>nginx<span class=w> </span>--no-header<span class=w> </span><span class=p>|</span><span class=w> </span>wc<span class=w> </span>-l<span class=sb>`</span>
<a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a><span class=w> </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=nv>$nginxpid</span><span class=w> </span>-eq<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=k>then</span>
<a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a><span class=w>    </span><span class=nb>ulimit</span><span class=w> </span>-SHn<span class=w> </span><span class=m>65535</span>
<a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a><span class=w>    </span>/usr/local/nginx/sbin/nginx
<a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a><span class=w>    </span>sleep<span class=w> </span><span class=m>5</span>
<a id=__codelineno-10-9 name=__codelineno-10-9 href=#__codelineno-10-9></a><span class=w>   </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=nv>$nginxpid</span><span class=w> </span>-eq<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=k>then</span>
<a id=__codelineno-10-10 name=__codelineno-10-10 href=#__codelineno-10-10></a><span class=w>     </span>/etc/init.d/keepalived<span class=w> </span>stop
<a id=__codelineno-10-11 name=__codelineno-10-11 href=#__codelineno-10-11></a><span class=w>   </span><span class=k>fi</span>
<a id=__codelineno-10-12 name=__codelineno-10-12 href=#__codelineno-10-12></a><span class=w> </span><span class=k>fi</span>
<a id=__codelineno-10-13 name=__codelineno-10-13 href=#__codelineno-10-13></a><span class=w> </span>sleep<span class=w> </span><span class=m>5</span>
<a id=__codelineno-10-14 name=__codelineno-10-14 href=#__codelineno-10-14></a><span class=k>done</span>
</code></pre></div> <h3 id=监控httpd服务状态脚本>监控httpd服务状态脚本<a class=headerlink href=#监控httpd服务状态脚本 title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=ch>#!/usr/bin/env bash</span>
<a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a><span class=c1>#usage:xxx</span>
<a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a><span class=c1>#scripts_name:xxx.sh</span>
<a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a><span class=c1># author：xiaojian</span>
<a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a>
<a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a><span class=nv>LogTime</span><span class=o>=</span><span class=k>$(</span>date<span class=w> </span>+%Y%m%d-%T<span class=k>)</span>
<a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a><span class=nv>Log_File</span><span class=o>=</span><span class=s2>&quot;/home/check_httpd.log&quot;</span>
<a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a>
<a id=__codelineno-11-9 name=__codelineno-11-9 href=#__codelineno-11-9></a><span class=k>while</span><span class=w> </span>true<span class=p>;</span><span class=w> </span><span class=k>do</span>
<a id=__codelineno-11-10 name=__codelineno-11-10 href=#__codelineno-11-10></a><span class=w>    </span><span class=nv>HTTPD_STATUS</span><span class=o>=</span><span class=sb>`</span>service<span class=w> </span>httpd<span class=w> </span>status<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>running<span class=sb>`</span>
<a id=__codelineno-11-11 name=__codelineno-11-11 href=#__codelineno-11-11></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nb>test</span><span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=nv>$HTTPD_STATUS</span><span class=s2>&quot;</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-11-12 name=__codelineno-11-12 href=#__codelineno-11-12></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$LogTime</span><span class=s2>  HTTPD is stopped, try to restart&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span><span class=nv>$Log_File</span>
<a id=__codelineno-11-13 name=__codelineno-11-13 href=#__codelineno-11-13></a><span class=w>        </span>service<span class=w> </span>httpd<span class=w> </span>restart
<a id=__codelineno-11-14 name=__codelineno-11-14 href=#__codelineno-11-14></a><span class=w>    </span><span class=k>else</span>
<a id=__codelineno-11-15 name=__codelineno-11-15 href=#__codelineno-11-15></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;HTTPD is running ,wait 2 sec until next check&quot;</span><span class=w> </span><span class=p>&amp;</span>&gt;/dev/null
<a id=__codelineno-11-16 name=__codelineno-11-16 href=#__codelineno-11-16></a><span class=w>        </span>sleep<span class=w> </span><span class=m>2</span>
<a id=__codelineno-11-17 name=__codelineno-11-17 href=#__codelineno-11-17></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-11-18 name=__codelineno-11-18 href=#__codelineno-11-18></a><span class=k>done</span>
</code></pre></div> <h3 id=监控mysql数据库示例>监控mysql数据库示例<a class=headerlink href=#监控mysql数据库示例 title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=ch>#!/usr/bin/env bash</span>
<a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a><span class=c1>#方法1</span>
<a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=sb>`</span>lsof<span class=w> </span>-i<span class=w> </span>tcp:3306<span class=p>|</span>wc<span class=w> </span>-l<span class=sb>`</span><span class=w> </span>-gt<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=c1>#&lt;==过滤端口转成数字，很优秀的取值判断方法。</span>
<a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a><span class=k>then</span>
<a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;MySQL is Running.&quot;</span>
<a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a><span class=k>else</span>
<a id=__codelineno-12-7 name=__codelineno-12-7 href=#__codelineno-12-7></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;MySQL is Stopped.&quot;</span>
<a id=__codelineno-12-8 name=__codelineno-12-8 href=#__codelineno-12-8></a><span class=w>    </span>/etc/init.d/mysqld<span class=w> </span>start
<a id=__codelineno-12-9 name=__codelineno-12-9 href=#__codelineno-12-9></a><span class=k>fi</span>
<a id=__codelineno-12-10 name=__codelineno-12-10 href=#__codelineno-12-10></a>
<a id=__codelineno-12-11 name=__codelineno-12-11 href=#__codelineno-12-11></a><span class=c1>#方法2</span>
<a id=__codelineno-12-12 name=__codelineno-12-12 href=#__codelineno-12-12></a>
<a id=__codelineno-12-13 name=__codelineno-12-13 href=#__codelineno-12-13></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=sb>`</span>ps<span class=w> </span>aux<span class=p>|</span><span class=w> </span>grep<span class=w> </span>-v<span class=w> </span>grep<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>mysql<span class=w> </span><span class=p>|</span>wc<span class=w> </span>-<span class=w> </span>l<span class=sb>`</span><span class=w>  </span>-gt<span class=w> </span><span class=m>0</span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-12-14 name=__codelineno-12-14 href=#__codelineno-12-14></a><span class=w>    </span><span class=nb>echo</span><span class=w>  </span><span class=s2>&quot;Mysql is Running&quot;</span>
<a id=__codelineno-12-15 name=__codelineno-12-15 href=#__codelineno-12-15></a><span class=k>else</span>
<a id=__codelineno-12-16 name=__codelineno-12-16 href=#__codelineno-12-16></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Mysql is Stopped. &quot;</span>
<a id=__codelineno-12-17 name=__codelineno-12-17 href=#__codelineno-12-17></a><span class=w>    </span>/etc/init.d/mysqld<span class=w> </span>start
<a id=__codelineno-12-18 name=__codelineno-12-18 href=#__codelineno-12-18></a><span class=k>fi</span>
</code></pre></div> <h3 id=系统文件数打开监控脚本>系统文件数打开监控脚本<a class=headerlink href=#系统文件数打开监控脚本 title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a><span class=k>for</span><span class=w> </span>pid<span class=w> </span><span class=k>in</span><span class=w> </span><span class=sb>`</span>ps<span class=w> </span>aux<span class=w> </span><span class=p>|</span>grep<span class=w> </span>nginx<span class=w> </span><span class=p>|</span>grep<span class=w> </span>-v<span class=w> </span>grep<span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;{print $2}&#39;</span><span class=sb>`</span>
<a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a><span class=k>do</span>
<a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a>cat<span class=w> </span>/proc/<span class=si>${</span><span class=nv>pid</span><span class=si>}</span>/limits<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span><span class=s1>&#39;Max open files&#39;</span>
<a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a><span class=k>done</span>
</code></pre></div> <h3 id=监控机器cpu利用率脚本>监控机器CPU利用率脚本<a class=headerlink href=#监控机器cpu利用率脚本 title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a><span class=c1># CPU Utilization Statistics plugin for Nagios</span>
<a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a><span class=c1>#</span>
<a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a><span class=c1># USAGE     :   ./check_cpu_utili.sh [-w &lt;user,system,iowait&gt;] [-c &lt;user,system,iowait&gt;] ( [ -i &lt;intervals in second&gt; ] [ -n &lt;report number&gt; ])</span>
<a id=__codelineno-14-5 name=__codelineno-14-5 href=#__codelineno-14-5></a><span class=c1>#</span>
<a id=__codelineno-14-6 name=__codelineno-14-6 href=#__codelineno-14-6></a><span class=c1># Exemple: ./check_cpu_utili.sh</span>
<a id=__codelineno-14-7 name=__codelineno-14-7 href=#__codelineno-14-7></a><span class=c1>#          ./check_cpu_utili.sh -w 70,40,30 -c 90,60,40</span>
<a id=__codelineno-14-8 name=__codelineno-14-8 href=#__codelineno-14-8></a><span class=c1>#          ./check_cpu_utili.sh -w 70,40,30 -c 90,60,40 -i 3 -n 5</span>
<a id=__codelineno-14-9 name=__codelineno-14-9 href=#__codelineno-14-9></a><span class=c1># Paths to commands used in this script.  These may have to be modified to match your system setup.</span>
<a id=__codelineno-14-10 name=__codelineno-14-10 href=#__codelineno-14-10></a><span class=nv>IOSTAT</span><span class=o>=</span><span class=s2>&quot;/usr/bin/iostat&quot;</span>
<a id=__codelineno-14-11 name=__codelineno-14-11 href=#__codelineno-14-11></a>
<a id=__codelineno-14-12 name=__codelineno-14-12 href=#__codelineno-14-12></a><span class=c1># Nagios return codes</span>
<a id=__codelineno-14-13 name=__codelineno-14-13 href=#__codelineno-14-13></a><span class=nv>STATE_OK</span><span class=o>=</span><span class=m>0</span>
<a id=__codelineno-14-14 name=__codelineno-14-14 href=#__codelineno-14-14></a><span class=nv>STATE_WARNING</span><span class=o>=</span><span class=m>1</span>
<a id=__codelineno-14-15 name=__codelineno-14-15 href=#__codelineno-14-15></a><span class=nv>STATE_CRITICAL</span><span class=o>=</span><span class=m>2</span>
<a id=__codelineno-14-16 name=__codelineno-14-16 href=#__codelineno-14-16></a><span class=nv>STATE_UNKNOWN</span><span class=o>=</span><span class=m>3</span>
<a id=__codelineno-14-17 name=__codelineno-14-17 href=#__codelineno-14-17></a>
<a id=__codelineno-14-18 name=__codelineno-14-18 href=#__codelineno-14-18></a><span class=c1># Plugin parameters value if not define</span>
<a id=__codelineno-14-19 name=__codelineno-14-19 href=#__codelineno-14-19></a><span class=nv>LIST_WARNING_THRESHOLD</span><span class=o>=</span><span class=s2>&quot;70,40,30&quot;</span>
<a id=__codelineno-14-20 name=__codelineno-14-20 href=#__codelineno-14-20></a><span class=nv>LIST_CRITICAL_THRESHOLD</span><span class=o>=</span><span class=s2>&quot;90,60,40&quot;</span>
<a id=__codelineno-14-21 name=__codelineno-14-21 href=#__codelineno-14-21></a><span class=nv>INTERVAL_SEC</span><span class=o>=</span><span class=m>1</span>
<a id=__codelineno-14-22 name=__codelineno-14-22 href=#__codelineno-14-22></a><span class=nv>NUM_REPORT</span><span class=o>=</span><span class=m>1</span>
<a id=__codelineno-14-23 name=__codelineno-14-23 href=#__codelineno-14-23></a><span class=c1># Plugin variable description</span>
<a id=__codelineno-14-24 name=__codelineno-14-24 href=#__codelineno-14-24></a><span class=nv>PROGNAME</span><span class=o>=</span><span class=k>$(</span>basename<span class=w> </span><span class=nv>$0</span><span class=k>)</span>
<a id=__codelineno-14-25 name=__codelineno-14-25 href=#__codelineno-14-25></a>
<a id=__codelineno-14-26 name=__codelineno-14-26 href=#__codelineno-14-26></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>!<span class=w> </span>-x<span class=w> </span><span class=nv>$IOSTAT</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-14-27 name=__codelineno-14-27 href=#__codelineno-14-27></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;UNKNOWN: iostat not found or is not executable by the nagios user.&quot;</span>
<a id=__codelineno-14-28 name=__codelineno-14-28 href=#__codelineno-14-28></a><span class=w>    </span><span class=nb>exit</span><span class=w> </span><span class=nv>$STATE_UNKNOWN</span>
<a id=__codelineno-14-29 name=__codelineno-14-29 href=#__codelineno-14-29></a><span class=k>fi</span>
<a id=__codelineno-14-30 name=__codelineno-14-30 href=#__codelineno-14-30></a>
<a id=__codelineno-14-31 name=__codelineno-14-31 href=#__codelineno-14-31></a>print_usage<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-14-32 name=__codelineno-14-32 href=#__codelineno-14-32></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;&quot;</span>
<a id=__codelineno-14-33 name=__codelineno-14-33 href=#__codelineno-14-33></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$PROGNAME</span><span class=s2> </span><span class=nv>$RELEASE</span><span class=s2> - CPU Utilization check script for Nagios&quot;</span>
<a id=__codelineno-14-34 name=__codelineno-14-34 href=#__codelineno-14-34></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;&quot;</span>
<a id=__codelineno-14-35 name=__codelineno-14-35 href=#__codelineno-14-35></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Usage: check_cpu_utili.sh -w -c (-i -n)&quot;</span>
<a id=__codelineno-14-36 name=__codelineno-14-36 href=#__codelineno-14-36></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;&quot;</span>
<a id=__codelineno-14-37 name=__codelineno-14-37 href=#__codelineno-14-37></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;  -w  Warning threshold in % for warn_user,warn_system,warn_iowait CPU (default : 70,40,30)&quot;</span>
<a id=__codelineno-14-38 name=__codelineno-14-38 href=#__codelineno-14-38></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;  Exit with WARNING status if cpu exceeds warn_n&quot;</span>
<a id=__codelineno-14-39 name=__codelineno-14-39 href=#__codelineno-14-39></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;  -c  Critical threshold in % for crit_user,crit_system,crit_iowait CPU (default : 90,60,40)&quot;</span>
<a id=__codelineno-14-40 name=__codelineno-14-40 href=#__codelineno-14-40></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;  Exit with CRITICAL status if cpu exceeds crit_n&quot;</span>
<a id=__codelineno-14-41 name=__codelineno-14-41 href=#__codelineno-14-41></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;  -i  Interval in seconds for iostat (default : 1)&quot;</span>
<a id=__codelineno-14-42 name=__codelineno-14-42 href=#__codelineno-14-42></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;  -n  Number report for iostat (default : 3)&quot;</span>
<a id=__codelineno-14-43 name=__codelineno-14-43 href=#__codelineno-14-43></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;  -h  Show this page&quot;</span>
<a id=__codelineno-14-44 name=__codelineno-14-44 href=#__codelineno-14-44></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;&quot;</span>
<a id=__codelineno-14-45 name=__codelineno-14-45 href=#__codelineno-14-45></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Usage: </span><span class=nv>$PROGNAME</span><span class=s2>&quot;</span>
<a id=__codelineno-14-46 name=__codelineno-14-46 href=#__codelineno-14-46></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Usage: </span><span class=nv>$PROGNAME</span><span class=s2> --help&quot;</span>
<a id=__codelineno-14-47 name=__codelineno-14-47 href=#__codelineno-14-47></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;&quot;</span>
<a id=__codelineno-14-48 name=__codelineno-14-48 href=#__codelineno-14-48></a><span class=w>    </span><span class=nb>exit</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-14-49 name=__codelineno-14-49 href=#__codelineno-14-49></a><span class=o>}</span>
<a id=__codelineno-14-50 name=__codelineno-14-50 href=#__codelineno-14-50></a>
<a id=__codelineno-14-51 name=__codelineno-14-51 href=#__codelineno-14-51></a>print_help<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-14-52 name=__codelineno-14-52 href=#__codelineno-14-52></a><span class=w>    </span>print_usage
<a id=__codelineno-14-53 name=__codelineno-14-53 href=#__codelineno-14-53></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;&quot;</span>
<a id=__codelineno-14-54 name=__codelineno-14-54 href=#__codelineno-14-54></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;This plugin will check cpu utilization (user,system,CPU_Iowait in %)&quot;</span>
<a id=__codelineno-14-55 name=__codelineno-14-55 href=#__codelineno-14-55></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;&quot;</span>
<a id=__codelineno-14-56 name=__codelineno-14-56 href=#__codelineno-14-56></a><span class=w>    </span><span class=nb>exit</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-14-57 name=__codelineno-14-57 href=#__codelineno-14-57></a><span class=o>}</span>
<a id=__codelineno-14-58 name=__codelineno-14-58 href=#__codelineno-14-58></a>
<a id=__codelineno-14-59 name=__codelineno-14-59 href=#__codelineno-14-59></a><span class=c1># Parse parameters</span>
<a id=__codelineno-14-60 name=__codelineno-14-60 href=#__codelineno-14-60></a><span class=k>while</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=nv>$#</span><span class=w> </span>-gt<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>do</span>
<a id=__codelineno-14-61 name=__codelineno-14-61 href=#__codelineno-14-61></a><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=k>in</span>
<a id=__codelineno-14-62 name=__codelineno-14-62 href=#__codelineno-14-62></a><span class=w>        </span>-h<span class=w> </span><span class=p>|</span><span class=w> </span>--help<span class=o>)</span>
<a id=__codelineno-14-63 name=__codelineno-14-63 href=#__codelineno-14-63></a><span class=w>            </span>print_help
<a id=__codelineno-14-64 name=__codelineno-14-64 href=#__codelineno-14-64></a><span class=w>            </span><span class=nb>exit</span><span class=w> </span><span class=nv>$STATE_OK</span>
<a id=__codelineno-14-65 name=__codelineno-14-65 href=#__codelineno-14-65></a><span class=w>            </span><span class=p>;;</span>
<a id=__codelineno-14-66 name=__codelineno-14-66 href=#__codelineno-14-66></a><span class=w>        </span>-v<span class=w> </span><span class=p>|</span><span class=w> </span>--version<span class=o>)</span>
<a id=__codelineno-14-67 name=__codelineno-14-67 href=#__codelineno-14-67></a><span class=w>                </span>print_release
<a id=__codelineno-14-68 name=__codelineno-14-68 href=#__codelineno-14-68></a><span class=w>                </span><span class=nb>exit</span><span class=w> </span><span class=nv>$STATE_OK</span>
<a id=__codelineno-14-69 name=__codelineno-14-69 href=#__codelineno-14-69></a><span class=w>                </span><span class=p>;;</span>
<a id=__codelineno-14-70 name=__codelineno-14-70 href=#__codelineno-14-70></a><span class=w>        </span>-w<span class=w> </span><span class=p>|</span><span class=w> </span>--warning<span class=o>)</span>
<a id=__codelineno-14-71 name=__codelineno-14-71 href=#__codelineno-14-71></a><span class=w>                </span><span class=nb>shift</span>
<a id=__codelineno-14-72 name=__codelineno-14-72 href=#__codelineno-14-72></a><span class=w>                </span><span class=nv>LIST_WARNING_THRESHOLD</span><span class=o>=</span><span class=nv>$1</span>
<a id=__codelineno-14-73 name=__codelineno-14-73 href=#__codelineno-14-73></a><span class=w>                </span><span class=p>;;</span>
<a id=__codelineno-14-74 name=__codelineno-14-74 href=#__codelineno-14-74></a><span class=w>        </span>-c<span class=w> </span><span class=p>|</span><span class=w> </span>--critical<span class=o>)</span>
<a id=__codelineno-14-75 name=__codelineno-14-75 href=#__codelineno-14-75></a><span class=w>               </span><span class=nb>shift</span>
<a id=__codelineno-14-76 name=__codelineno-14-76 href=#__codelineno-14-76></a><span class=w>                </span><span class=nv>LIST_CRITICAL_THRESHOLD</span><span class=o>=</span><span class=nv>$1</span>
<a id=__codelineno-14-77 name=__codelineno-14-77 href=#__codelineno-14-77></a><span class=w>                </span><span class=p>;;</span>
<a id=__codelineno-14-78 name=__codelineno-14-78 href=#__codelineno-14-78></a><span class=w>        </span>-i<span class=w> </span><span class=p>|</span><span class=w> </span>--interval<span class=o>)</span>
<a id=__codelineno-14-79 name=__codelineno-14-79 href=#__codelineno-14-79></a><span class=w>               </span><span class=nb>shift</span>
<a id=__codelineno-14-80 name=__codelineno-14-80 href=#__codelineno-14-80></a><span class=w>               </span><span class=nv>INTERVAL_SEC</span><span class=o>=</span><span class=nv>$1</span>
<a id=__codelineno-14-81 name=__codelineno-14-81 href=#__codelineno-14-81></a><span class=w>                </span><span class=p>;;</span>
<a id=__codelineno-14-82 name=__codelineno-14-82 href=#__codelineno-14-82></a><span class=w>        </span>-n<span class=w> </span><span class=p>|</span><span class=w> </span>--number<span class=o>)</span>
<a id=__codelineno-14-83 name=__codelineno-14-83 href=#__codelineno-14-83></a><span class=w>               </span><span class=nb>shift</span>
<a id=__codelineno-14-84 name=__codelineno-14-84 href=#__codelineno-14-84></a><span class=w>               </span><span class=nv>NUM_REPORT</span><span class=o>=</span><span class=nv>$1</span>
<a id=__codelineno-14-85 name=__codelineno-14-85 href=#__codelineno-14-85></a><span class=w>                </span><span class=p>;;</span>
<a id=__codelineno-14-86 name=__codelineno-14-86 href=#__codelineno-14-86></a><span class=w>        </span>*<span class=o>)</span><span class=w>  </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Unknown argument: </span><span class=nv>$1</span><span class=s2>&quot;</span>
<a id=__codelineno-14-87 name=__codelineno-14-87 href=#__codelineno-14-87></a><span class=w>            </span>print_usage
<a id=__codelineno-14-88 name=__codelineno-14-88 href=#__codelineno-14-88></a><span class=w>            </span><span class=nb>exit</span><span class=w> </span><span class=nv>$STATE_UNKNOWN</span>
<a id=__codelineno-14-89 name=__codelineno-14-89 href=#__codelineno-14-89></a><span class=w>            </span><span class=p>;;</span>
<a id=__codelineno-14-90 name=__codelineno-14-90 href=#__codelineno-14-90></a><span class=w>        </span><span class=k>esac</span>
<a id=__codelineno-14-91 name=__codelineno-14-91 href=#__codelineno-14-91></a><span class=nb>shift</span>
<a id=__codelineno-14-92 name=__codelineno-14-92 href=#__codelineno-14-92></a><span class=k>done</span>
<a id=__codelineno-14-93 name=__codelineno-14-93 href=#__codelineno-14-93></a>
<a id=__codelineno-14-94 name=__codelineno-14-94 href=#__codelineno-14-94></a><span class=c1># List to Table for warning threshold (compatibility with</span>
<a id=__codelineno-14-95 name=__codelineno-14-95 href=#__codelineno-14-95></a><span class=nv>TAB_WARNING_THRESHOLD</span><span class=o>=(</span><span class=sb>`</span><span class=nb>echo</span><span class=w> </span><span class=nv>$LIST_WARNING_THRESHOLD</span><span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span><span class=s1>&#39;s/,/ /g&#39;</span><span class=sb>`</span><span class=o>)</span>
<a id=__codelineno-14-96 name=__codelineno-14-96 href=#__codelineno-14-96></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=si>${#</span><span class=nv>TAB_WARNING_THRESHOLD</span><span class=p>[@]</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span>-ne<span class=w> </span><span class=s2>&quot;3&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-14-97 name=__codelineno-14-97 href=#__codelineno-14-97></a><span class=w>  </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;ERROR : Bad count parameter in Warning Threshold&quot;</span>
<a id=__codelineno-14-98 name=__codelineno-14-98 href=#__codelineno-14-98></a><span class=w>  </span><span class=nb>exit</span><span class=w> </span><span class=nv>$STATE_WARNING</span>
<a id=__codelineno-14-99 name=__codelineno-14-99 href=#__codelineno-14-99></a><span class=k>else</span>
<a id=__codelineno-14-100 name=__codelineno-14-100 href=#__codelineno-14-100></a><span class=nv>USER_WARNING_THRESHOLD</span><span class=o>=</span><span class=sb>`</span><span class=nb>echo</span><span class=w> </span><span class=si>${</span><span class=nv>TAB_WARNING_THRESHOLD</span><span class=p>[0]</span><span class=si>}</span><span class=sb>`</span>
<a id=__codelineno-14-101 name=__codelineno-14-101 href=#__codelineno-14-101></a><span class=nv>SYSTEM_WARNING_THRESHOLD</span><span class=o>=</span><span class=sb>`</span><span class=nb>echo</span><span class=w> </span><span class=si>${</span><span class=nv>TAB_WARNING_THRESHOLD</span><span class=p>[1]</span><span class=si>}</span><span class=sb>`</span>
<a id=__codelineno-14-102 name=__codelineno-14-102 href=#__codelineno-14-102></a><span class=nv>IOWAIT_WARNING_THRESHOLD</span><span class=o>=</span><span class=sb>`</span><span class=nb>echo</span><span class=w> </span><span class=si>${</span><span class=nv>TAB_WARNING_THRESHOLD</span><span class=p>[2]</span><span class=si>}</span><span class=sb>`</span>
<a id=__codelineno-14-103 name=__codelineno-14-103 href=#__codelineno-14-103></a><span class=k>fi</span>
<a id=__codelineno-14-104 name=__codelineno-14-104 href=#__codelineno-14-104></a>
<a id=__codelineno-14-105 name=__codelineno-14-105 href=#__codelineno-14-105></a><span class=c1># List to Table for critical threshold</span>
<a id=__codelineno-14-106 name=__codelineno-14-106 href=#__codelineno-14-106></a><span class=nv>TAB_CRITICAL_THRESHOLD</span><span class=o>=(</span><span class=sb>`</span><span class=nb>echo</span><span class=w> </span><span class=nv>$LIST_CRITICAL_THRESHOLD</span><span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span><span class=s1>&#39;s/,/ /g&#39;</span><span class=sb>`</span><span class=o>)</span>
<a id=__codelineno-14-107 name=__codelineno-14-107 href=#__codelineno-14-107></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=si>${#</span><span class=nv>TAB_CRITICAL_THRESHOLD</span><span class=p>[@]</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span>-ne<span class=w> </span><span class=s2>&quot;3&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-14-108 name=__codelineno-14-108 href=#__codelineno-14-108></a><span class=w>  </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;ERROR : Bad count parameter in CRITICAL Threshold&quot;</span>
<a id=__codelineno-14-109 name=__codelineno-14-109 href=#__codelineno-14-109></a><span class=w>  </span><span class=nb>exit</span><span class=w> </span><span class=nv>$STATE_WARNING</span>
<a id=__codelineno-14-110 name=__codelineno-14-110 href=#__codelineno-14-110></a><span class=k>else</span>
<a id=__codelineno-14-111 name=__codelineno-14-111 href=#__codelineno-14-111></a><span class=nv>USER_CRITICAL_THRESHOLD</span><span class=o>=</span><span class=sb>`</span><span class=nb>echo</span><span class=w> </span><span class=si>${</span><span class=nv>TAB_CRITICAL_THRESHOLD</span><span class=p>[0]</span><span class=si>}</span><span class=sb>`</span>
<a id=__codelineno-14-112 name=__codelineno-14-112 href=#__codelineno-14-112></a><span class=nv>SYSTEM_CRITICAL_THRESHOLD</span><span class=o>=</span><span class=sb>`</span><span class=nb>echo</span><span class=w> </span><span class=si>${</span><span class=nv>TAB_CRITICAL_THRESHOLD</span><span class=p>[1]</span><span class=si>}</span><span class=sb>`</span>
<a id=__codelineno-14-113 name=__codelineno-14-113 href=#__codelineno-14-113></a><span class=nv>IOWAIT_CRITICAL_THRESHOLD</span><span class=o>=</span><span class=sb>`</span><span class=nb>echo</span><span class=w> </span><span class=si>${</span><span class=nv>TAB_CRITICAL_THRESHOLD</span><span class=p>[2]</span><span class=si>}</span><span class=sb>`</span>
<a id=__codelineno-14-114 name=__codelineno-14-114 href=#__codelineno-14-114></a><span class=k>fi</span>
<a id=__codelineno-14-115 name=__codelineno-14-115 href=#__codelineno-14-115></a>
<a id=__codelineno-14-116 name=__codelineno-14-116 href=#__codelineno-14-116></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=si>${</span><span class=nv>TAB_WARNING_THRESHOLD</span><span class=p>[0]</span><span class=si>}</span><span class=w> </span>-ge<span class=w> </span><span class=si>${</span><span class=nv>TAB_CRITICAL_THRESHOLD</span><span class=p>[0]</span><span class=si>}</span><span class=w> </span>-o<span class=w> </span><span class=si>${</span><span class=nv>TAB_WARNING_THRESHOLD</span><span class=p>[1]</span><span class=si>}</span><span class=w> </span>-ge<span class=w> </span><span class=si>${</span><span class=nv>TAB_CRITICAL_THRESHOLD</span><span class=p>[1]</span><span class=si>}</span><span class=w> </span>-o<span class=w> </span><span class=si>${</span><span class=nv>TAB_WARNING_THRESHOLD</span><span class=p>[2]</span><span class=si>}</span><span class=w> </span>-ge<span class=w> </span><span class=si>${</span><span class=nv>TAB_CRITICAL_THRESHOLD</span><span class=p>[2]</span><span class=si>}</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-14-117 name=__codelineno-14-117 href=#__codelineno-14-117></a><span class=w>  </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;ERROR : Critical CPU Threshold lower as Warning CPU Threshold &quot;</span>
<a id=__codelineno-14-118 name=__codelineno-14-118 href=#__codelineno-14-118></a><span class=w>  </span><span class=nb>exit</span><span class=w> </span><span class=nv>$STATE_WARNING</span>
<a id=__codelineno-14-119 name=__codelineno-14-119 href=#__codelineno-14-119></a><span class=k>fi</span>
<a id=__codelineno-14-120 name=__codelineno-14-120 href=#__codelineno-14-120></a>
<a id=__codelineno-14-121 name=__codelineno-14-121 href=#__codelineno-14-121></a><span class=nv>CPU_REPORT</span><span class=o>=</span><span class=sb>`</span>iostat<span class=w> </span>-c<span class=w> </span><span class=nv>$INTERVAL_SEC</span><span class=w> </span><span class=nv>$NUM_REPORT</span><span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span>-e<span class=w> </span><span class=s1>&#39;s/,/./g&#39;</span><span class=w> </span><span class=p>|</span><span class=w> </span>tr<span class=w> </span>-s<span class=w> </span><span class=s1>&#39; &#39;</span><span class=w> </span><span class=s1>&#39;;&#39;</span><span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span><span class=s1>&#39;/^$/d&#39;</span><span class=w> </span><span class=p>|</span><span class=w> </span>tail<span class=w> </span>-1<span class=sb>`</span>
<a id=__codelineno-14-122 name=__codelineno-14-122 href=#__codelineno-14-122></a><span class=nv>CPU_REPORT_SECTIONS</span><span class=o>=</span><span class=sb>`</span><span class=nb>echo</span><span class=w> </span><span class=si>${</span><span class=nv>CPU_REPORT</span><span class=si>}</span><span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span><span class=s1>&#39;;&#39;</span><span class=w> </span>-o<span class=w> </span><span class=p>|</span><span class=w> </span>wc<span class=w> </span>-l<span class=sb>`</span>
<a id=__codelineno-14-123 name=__codelineno-14-123 href=#__codelineno-14-123></a><span class=nv>CPU_USER</span><span class=o>=</span><span class=sb>`</span><span class=nb>echo</span><span class=w> </span><span class=nv>$CPU_REPORT</span><span class=w> </span><span class=p>|</span><span class=w> </span>cut<span class=w> </span>-d<span class=w> </span><span class=s2>&quot;;&quot;</span><span class=w> </span>-f<span class=w> </span><span class=m>2</span><span class=sb>`</span>
<a id=__codelineno-14-124 name=__codelineno-14-124 href=#__codelineno-14-124></a><span class=nv>CPU_SYSTEM</span><span class=o>=</span><span class=sb>`</span><span class=nb>echo</span><span class=w> </span><span class=nv>$CPU_REPORT</span><span class=w> </span><span class=p>|</span><span class=w> </span>cut<span class=w> </span>-d<span class=w> </span><span class=s2>&quot;;&quot;</span><span class=w> </span>-f<span class=w> </span><span class=m>4</span><span class=sb>`</span>
<a id=__codelineno-14-125 name=__codelineno-14-125 href=#__codelineno-14-125></a><span class=nv>CPU_IOWAIT</span><span class=o>=</span><span class=sb>`</span><span class=nb>echo</span><span class=w> </span><span class=nv>$CPU_REPORT</span><span class=w> </span><span class=p>|</span><span class=w> </span>cut<span class=w> </span>-d<span class=w> </span><span class=s2>&quot;;&quot;</span><span class=w> </span>-f<span class=w> </span><span class=m>5</span><span class=sb>`</span>
<a id=__codelineno-14-126 name=__codelineno-14-126 href=#__codelineno-14-126></a><span class=nv>CPU_STEAL</span><span class=o>=</span><span class=sb>`</span><span class=nb>echo</span><span class=w> </span><span class=nv>$CPU_REPORT</span><span class=w> </span><span class=p>|</span><span class=w> </span>cut<span class=w> </span>-d<span class=w> </span><span class=s2>&quot;;&quot;</span><span class=w> </span>-f<span class=w> </span><span class=m>6</span><span class=sb>`</span>
<a id=__codelineno-14-127 name=__codelineno-14-127 href=#__codelineno-14-127></a><span class=nv>CPU_IDLE</span><span class=o>=</span><span class=sb>`</span><span class=nb>echo</span><span class=w> </span><span class=nv>$CPU_REPORT</span><span class=w> </span><span class=p>|</span><span class=w> </span>cut<span class=w> </span>-d<span class=w> </span><span class=s2>&quot;;&quot;</span><span class=w> </span>-f<span class=w> </span><span class=m>7</span><span class=sb>`</span>
<a id=__codelineno-14-128 name=__codelineno-14-128 href=#__codelineno-14-128></a><span class=nv>NAGIOS_STATUS</span><span class=o>=</span><span class=s2>&quot;user=</span><span class=si>${</span><span class=nv>CPU_USER</span><span class=si>}</span><span class=s2>%,system=</span><span class=si>${</span><span class=nv>CPU_SYSTEM</span><span class=si>}</span><span class=s2>%,iowait=</span><span class=si>${</span><span class=nv>CPU_IOWAIT</span><span class=si>}</span><span class=s2>%,idle=</span><span class=si>${</span><span class=nv>CPU_IDLE</span><span class=si>}</span><span class=s2>%&quot;</span>
<a id=__codelineno-14-129 name=__codelineno-14-129 href=#__codelineno-14-129></a><span class=nv>NAGIOS_DATA</span><span class=o>=</span><span class=s2>&quot;CpuUser=</span><span class=si>${</span><span class=nv>CPU_USER</span><span class=si>}</span><span class=s2>;</span><span class=si>${</span><span class=nv>TAB_WARNING_THRESHOLD</span><span class=p>[0]</span><span class=si>}</span><span class=s2>;</span><span class=si>${</span><span class=nv>TAB_CRITICAL_THRESHOLD</span><span class=p>[0]</span><span class=si>}</span><span class=s2>;0&quot;</span>
<a id=__codelineno-14-130 name=__codelineno-14-130 href=#__codelineno-14-130></a>
<a id=__codelineno-14-131 name=__codelineno-14-131 href=#__codelineno-14-131></a><span class=nv>CPU_USER_MAJOR</span><span class=o>=</span><span class=sb>`</span><span class=nb>echo</span><span class=w> </span><span class=nv>$CPU_USER</span><span class=p>|</span><span class=w> </span>cut<span class=w> </span>-d<span class=w> </span><span class=s2>&quot;.&quot;</span><span class=w> </span>-f<span class=w> </span><span class=m>1</span><span class=sb>`</span>
<a id=__codelineno-14-132 name=__codelineno-14-132 href=#__codelineno-14-132></a><span class=nv>CPU_SYSTEM_MAJOR</span><span class=o>=</span><span class=sb>`</span><span class=nb>echo</span><span class=w> </span><span class=nv>$CPU_SYSTEM</span><span class=w> </span><span class=p>|</span><span class=w> </span>cut<span class=w> </span>-d<span class=w> </span><span class=s2>&quot;.&quot;</span><span class=w> </span>-f<span class=w> </span><span class=m>1</span><span class=sb>`</span>
<a id=__codelineno-14-133 name=__codelineno-14-133 href=#__codelineno-14-133></a><span class=nv>CPU_IOWAIT_MAJOR</span><span class=o>=</span><span class=sb>`</span><span class=nb>echo</span><span class=w> </span><span class=nv>$CPU_IOWAIT</span><span class=w> </span><span class=p>|</span><span class=w> </span>cut<span class=w> </span>-d<span class=w> </span><span class=s2>&quot;.&quot;</span><span class=w> </span>-f<span class=w> </span><span class=m>1</span><span class=sb>`</span>
<a id=__codelineno-14-134 name=__codelineno-14-134 href=#__codelineno-14-134></a><span class=nv>CPU_IDLE_MAJOR</span><span class=o>=</span><span class=sb>`</span><span class=nb>echo</span><span class=w> </span><span class=nv>$CPU_IDLE</span><span class=w> </span><span class=p>|</span><span class=w> </span>cut<span class=w> </span>-d<span class=w> </span><span class=s2>&quot;.&quot;</span><span class=w> </span>-f<span class=w> </span><span class=m>1</span><span class=sb>`</span>
<a id=__codelineno-14-135 name=__codelineno-14-135 href=#__codelineno-14-135></a>
<a id=__codelineno-14-136 name=__codelineno-14-136 href=#__codelineno-14-136></a>
<a id=__codelineno-14-137 name=__codelineno-14-137 href=#__codelineno-14-137></a>
<a id=__codelineno-14-138 name=__codelineno-14-138 href=#__codelineno-14-138></a><span class=c1># Return</span>
<a id=__codelineno-14-139 name=__codelineno-14-139 href=#__codelineno-14-139></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=si>${</span><span class=nv>CPU_USER_MAJOR</span><span class=si>}</span><span class=w> </span>-ge<span class=w> </span><span class=nv>$USER_CRITICAL_THRESHOLD</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-14-140 name=__codelineno-14-140 href=#__codelineno-14-140></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;CPU STATISTICS OK:</span><span class=si>${</span><span class=nv>NAGIOS_STATUS</span><span class=si>}</span><span class=s2> | CPU_USER=</span><span class=si>${</span><span class=nv>CPU_USER</span><span class=si>}</span><span class=s2>%;70;90;0;100&quot;</span>
<a id=__codelineno-14-141 name=__codelineno-14-141 href=#__codelineno-14-141></a><span class=w>        </span><span class=nb>exit</span><span class=w> </span><span class=nv>$STATE_CRITICAL</span>
<a id=__codelineno-14-142 name=__codelineno-14-142 href=#__codelineno-14-142></a><span class=w>    </span><span class=k>elif</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=si>${</span><span class=nv>CPU_SYSTEM_MAJOR</span><span class=si>}</span><span class=w> </span>-ge<span class=w> </span><span class=nv>$SYSTEM_CRITICAL_THRESHOLD</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-14-143 name=__codelineno-14-143 href=#__codelineno-14-143></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;CPU STATISTICS OK:</span><span class=si>${</span><span class=nv>NAGIOS_STATUS</span><span class=si>}</span><span class=s2> | CPU_USER=</span><span class=si>${</span><span class=nv>CPU_USER</span><span class=si>}</span><span class=s2>%;70;90;0;100&quot;</span>
<a id=__codelineno-14-144 name=__codelineno-14-144 href=#__codelineno-14-144></a><span class=w>        </span><span class=nb>exit</span><span class=w> </span><span class=nv>$STATE_CRITICAL</span>
<a id=__codelineno-14-145 name=__codelineno-14-145 href=#__codelineno-14-145></a><span class=w>    </span><span class=k>elif</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=si>${</span><span class=nv>CPU_IOWAIT_MAJOR</span><span class=si>}</span><span class=w> </span>-ge<span class=w> </span><span class=nv>$IOWAIT_CRITICAL_THRESHOLD</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-14-146 name=__codelineno-14-146 href=#__codelineno-14-146></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;CPU STATISTICS OK:</span><span class=si>${</span><span class=nv>NAGIOS_STATUS</span><span class=si>}</span><span class=s2> | CPU_USER=</span><span class=si>${</span><span class=nv>CPU_USER</span><span class=si>}</span><span class=s2>%;70;90;0;100&quot;</span>
<a id=__codelineno-14-147 name=__codelineno-14-147 href=#__codelineno-14-147></a><span class=w>        </span><span class=nb>exit</span><span class=w> </span><span class=nv>$STATE_CRITICAL</span>
<a id=__codelineno-14-148 name=__codelineno-14-148 href=#__codelineno-14-148></a><span class=w>    </span><span class=k>elif</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=si>${</span><span class=nv>CPU_USER_MAJOR</span><span class=si>}</span><span class=w> </span>-ge<span class=w> </span><span class=nv>$USER_WARNING_THRESHOLD</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=si>${</span><span class=nv>CPU_USER_MAJOR</span><span class=si>}</span><span class=w> </span>-lt<span class=w> </span><span class=nv>$USER_CRITICAL_THRESHOLD</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-14-149 name=__codelineno-14-149 href=#__codelineno-14-149></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;CPU STATISTICS OK:</span><span class=si>${</span><span class=nv>NAGIOS_STATUS</span><span class=si>}</span><span class=s2> | CPU_USER=</span><span class=si>${</span><span class=nv>CPU_USER</span><span class=si>}</span><span class=s2>%;70;90;0;100&quot;</span>
<a id=__codelineno-14-150 name=__codelineno-14-150 href=#__codelineno-14-150></a><span class=w>        </span><span class=nb>exit</span><span class=w> </span><span class=nv>$STATE_WARNING</span>
<a id=__codelineno-14-151 name=__codelineno-14-151 href=#__codelineno-14-151></a><span class=w>      </span><span class=k>elif</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=si>${</span><span class=nv>CPU_SYSTEM_MAJOR</span><span class=si>}</span><span class=w> </span>-ge<span class=w> </span><span class=nv>$SYSTEM_WARNING_THRESHOLD</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=si>${</span><span class=nv>CPU_SYSTEM_MAJOR</span><span class=si>}</span><span class=w> </span>-lt<span class=w> </span><span class=nv>$SYSTEM_CRITICAL_THRESHOLD</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-14-152 name=__codelineno-14-152 href=#__codelineno-14-152></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;CPU STATISTICS OK:</span><span class=si>${</span><span class=nv>NAGIOS_STATUS</span><span class=si>}</span><span class=s2> | CPU_USER=</span><span class=si>${</span><span class=nv>CPU_USER</span><span class=si>}</span><span class=s2>%;70;90;0;100&quot;</span>
<a id=__codelineno-14-153 name=__codelineno-14-153 href=#__codelineno-14-153></a><span class=w>        </span><span class=nb>exit</span><span class=w> </span><span class=nv>$STATE_WARNING</span>
<a id=__codelineno-14-154 name=__codelineno-14-154 href=#__codelineno-14-154></a><span class=w>      </span><span class=k>elif</span><span class=w>  </span><span class=o>[</span><span class=w> </span><span class=si>${</span><span class=nv>CPU_IOWAIT_MAJOR</span><span class=si>}</span><span class=w> </span>-ge<span class=w> </span><span class=nv>$IOWAIT_WARNING_THRESHOLD</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=si>${</span><span class=nv>CPU_IOWAIT_MAJOR</span><span class=si>}</span><span class=w> </span>-lt<span class=w> </span><span class=nv>$IOWAIT_CRITICAL_THRESHOLD</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-14-155 name=__codelineno-14-155 href=#__codelineno-14-155></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;CPU STATISTICS OK:</span><span class=si>${</span><span class=nv>NAGIOS_STATUS</span><span class=si>}</span><span class=s2> | CPU_USER=</span><span class=si>${</span><span class=nv>CPU_USER</span><span class=si>}</span><span class=s2>%;70;90;0;100&quot;</span>
<a id=__codelineno-14-156 name=__codelineno-14-156 href=#__codelineno-14-156></a><span class=w>        </span><span class=nb>exit</span><span class=w> </span><span class=nv>$STATE_WARNING</span>
<a id=__codelineno-14-157 name=__codelineno-14-157 href=#__codelineno-14-157></a><span class=k>else</span>
<a id=__codelineno-14-158 name=__codelineno-14-158 href=#__codelineno-14-158></a>
<a id=__codelineno-14-159 name=__codelineno-14-159 href=#__codelineno-14-159></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;CPU STATISTICS OK:</span><span class=si>${</span><span class=nv>NAGIOS_STATUS</span><span class=si>}</span><span class=s2> | CPU_USER=</span><span class=si>${</span><span class=nv>CPU_USER</span><span class=si>}</span><span class=s2>%;70;90;0;100&quot;</span>
<a id=__codelineno-14-160 name=__codelineno-14-160 href=#__codelineno-14-160></a><span class=w>        </span><span class=nb>exit</span><span class=w> </span><span class=nv>$STATE_OK</span>
<a id=__codelineno-14-161 name=__codelineno-14-161 href=#__codelineno-14-161></a><span class=k>fi</span>
</code></pre></div> <h3 id=monitor_linux系统性能>monitor_Linux系统性能<a class=headerlink href=#monitor_linux系统性能 title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a><span class=ch>#!/usr/bin/env bash</span>
<a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a><span class=c1>#usage:xxx</span>
<a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a><span class=c1>#scripts_name:xxx.sh</span>
<a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;\033[34m \033[1m&quot;</span>
<a id=__codelineno-15-5 name=__codelineno-15-5 href=#__codelineno-15-5></a>cat<span class=w> </span><span class=s>&lt;&lt;EOF</span>
<a id=__codelineno-15-6 name=__codelineno-15-6 href=#__codelineno-15-6></a><span class=s>++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>
<a id=__codelineno-15-7 name=__codelineno-15-7 href=#__codelineno-15-7></a><span class=s>++++++++++++++++ Wellcom to use system Collect ++++++++++++++++++++++++++</span>
<a id=__codelineno-15-8 name=__codelineno-15-8 href=#__codelineno-15-8></a><span class=s>EOF</span>
<a id=__codelineno-15-9 name=__codelineno-15-9 href=#__codelineno-15-9></a><span class=c1>#定义常量</span>
<a id=__codelineno-15-10 name=__codelineno-15-10 href=#__codelineno-15-10></a><span class=nv>Mysql_ROOT</span><span class=o>=</span>root
<a id=__codelineno-15-11 name=__codelineno-15-11 href=#__codelineno-15-11></a><span class=nv>Mysql_password</span><span class=o>=</span>admin#123
<a id=__codelineno-15-12 name=__codelineno-15-12 href=#__codelineno-15-12></a><span class=nv>DB_name</span><span class=o>=</span>App1
<a id=__codelineno-15-13 name=__codelineno-15-13 href=#__codelineno-15-13></a>
<a id=__codelineno-15-14 name=__codelineno-15-14 href=#__codelineno-15-14></a><span class=nv>ip_info</span><span class=o>=</span><span class=k>$(</span>ifconfig<span class=p>|</span>grep<span class=w> </span><span class=s2>&quot;broadcast&quot;</span><span class=p>|</span>tail<span class=w> </span>-1<span class=p>|</span>awk<span class=w>  </span><span class=s1>&#39;{print $2}&#39;</span><span class=k>)</span>
<a id=__codelineno-15-15 name=__codelineno-15-15 href=#__codelineno-15-15></a><span class=nv>cpu_info1</span><span class=o>=</span><span class=k>$(</span>cat<span class=w> </span>/proc/cpuinfo<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span><span class=s1>&#39;model name&#39;</span><span class=p>|</span>tail<span class=w> </span>-1<span class=p>|</span>awk<span class=w> </span>-F:<span class=w> </span><span class=s1>&#39;{print $2}&#39;</span><span class=p>|</span>sed<span class=w> </span><span class=s1>&#39;s/^//g&#39;</span><span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;{print $1,$3,$4,$NF}&#39;</span><span class=k>)</span>
<a id=__codelineno-15-16 name=__codelineno-15-16 href=#__codelineno-15-16></a><span class=nv>cpu_info2</span><span class=o>=</span><span class=k>$(</span>cat<span class=w> </span>/proc/cpuinfo<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span><span class=s1>&#39;physical id&#39;</span><span class=p>|</span>sort<span class=p>|</span>uniq<span class=w> </span>-c<span class=p>|</span>wc<span class=w> </span>-l<span class=k>)</span>
<a id=__codelineno-15-17 name=__codelineno-15-17 href=#__codelineno-15-17></a><span class=nv>serv_info</span><span class=o>=</span><span class=k>$(</span><span class=w> </span>hostname<span class=p>|</span><span class=w> </span>tail<span class=w> </span>-1<span class=k>)</span>
<a id=__codelineno-15-18 name=__codelineno-15-18 href=#__codelineno-15-18></a><span class=nv>disk_info</span><span class=o>=</span><span class=k>$(</span>fdisk<span class=w> </span>-l<span class=p>|</span><span class=w> </span>grep<span class=w> </span><span class=s2>&quot;磁盘&quot;</span><span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;{print $2,$3,$4}&#39;</span><span class=p>|</span>sed<span class=w> </span><span class=s1>&#39;s/,//g&#39;</span><span class=k>)</span>
<a id=__codelineno-15-19 name=__codelineno-15-19 href=#__codelineno-15-19></a><span class=nv>mem_info</span><span class=o>=</span><span class=k>$(</span><span class=w> </span>free<span class=w> </span>-m<span class=p>|</span>grep<span class=w> </span><span class=s2>&quot;Mem&quot;</span><span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;{print &quot;Total&quot;,$1,$2}&#39;</span><span class=k>)</span>
<a id=__codelineno-15-20 name=__codelineno-15-20 href=#__codelineno-15-20></a><span class=nv>load_info</span><span class=o>=</span><span class=k>$(</span>uptime<span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;{print &quot;Current load: &quot; $(NF-2),$(NF-1),$NF}&#39;</span><span class=p>|</span>sed<span class=w> </span><span class=s1>&#39;s/\,//g&#39;</span><span class=k>)</span>
<a id=__codelineno-15-21 name=__codelineno-15-21 href=#__codelineno-15-21></a><span class=nv>makr_info</span><span class=o>=</span><span class=s2>&quot;BeiJing_IDC&quot;</span>
<a id=__codelineno-15-22 name=__codelineno-15-22 href=#__codelineno-15-22></a><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;\033[32m -------------------------------------- \033[1m&quot;</span>
<a id=__codelineno-15-23 name=__codelineno-15-23 href=#__codelineno-15-23></a><span class=nb>echo</span><span class=w> </span>IPADDR:<span class=si>${</span><span class=nv>ip_info</span><span class=si>}</span>
<a id=__codelineno-15-24 name=__codelineno-15-24 href=#__codelineno-15-24></a><span class=nb>echo</span><span class=w> </span>HOSTNAME:<span class=si>${</span><span class=nv>serv_info</span><span class=si>}</span>
<a id=__codelineno-15-25 name=__codelineno-15-25 href=#__codelineno-15-25></a><span class=nb>echo</span><span class=w> </span>CUP_INFO:<span class=si>${</span><span class=nv>cpu_info1</span><span class=si>}</span><span class=w> </span>X<span class=si>${</span><span class=nv>cpu_info2</span><span class=si>}</span>
<a id=__codelineno-15-26 name=__codelineno-15-26 href=#__codelineno-15-26></a><span class=nb>echo</span><span class=w> </span>DISK_INFO:<span class=si>${</span><span class=nv>disk_info</span><span class=si>}</span>
<a id=__codelineno-15-27 name=__codelineno-15-27 href=#__codelineno-15-27></a><span class=nb>echo</span><span class=w> </span>MEM_INFO:<span class=si>${</span><span class=nv>mem_info</span><span class=si>}</span><span class=s2>&quot;M&quot;</span>
<a id=__codelineno-15-28 name=__codelineno-15-28 href=#__codelineno-15-28></a><span class=nb>echo</span><span class=w> </span>LOAD_INFO:<span class=si>${</span><span class=nv>load_info</span><span class=si>}</span>
<a id=__codelineno-15-29 name=__codelineno-15-29 href=#__codelineno-15-29></a><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;\033[32m -------------------------------------- \033[0m&quot;</span>
<a id=__codelineno-15-30 name=__codelineno-15-30 href=#__codelineno-15-30></a>
<a id=__codelineno-15-31 name=__codelineno-15-31 href=#__codelineno-15-31></a>
<a id=__codelineno-15-32 name=__codelineno-15-32 href=#__codelineno-15-32></a>monitor_jk<span class=w> </span><span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-15-33 name=__codelineno-15-33 href=#__codelineno-15-33></a><span class=w>    </span>mysql<span class=w> </span>-u<span class=si>${</span><span class=nv>Mysql_ROOT</span><span class=si>}</span><span class=w> </span>-p<span class=si>${</span><span class=nv>Mysql_password</span><span class=si>}</span><span class=w> </span>-D<span class=w> </span><span class=nv>$DB_name</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;</span>
<a id=__codelineno-15-34 name=__codelineno-15-34 href=#__codelineno-15-34></a><span class=s2>    INSERT INTO system_info VALUES (&#39;&#39;,&#39;</span><span class=nv>$ip_info</span><span class=s2>&#39; , &#39;</span><span class=nv>$serv_info</span><span class=s2>&#39;, &#39;</span><span class=si>${</span><span class=nv>cpu_info1</span><span class=si>}</span><span class=s2> X</span><span class=si>${</span><span class=nv>cpu_info2</span><span class=si>}</span><span class=s2>&#39;, &#39;</span><span class=nv>$disk_info</span><span class=s2>&#39;, &#39;</span><span class=nv>$mem_info</span><span class=s2>&#39;, &#39;</span><span class=nv>$load_info</span><span class=s2>&#39;);</span>
<a id=__codelineno-15-35 name=__codelineno-15-35 href=#__codelineno-15-35></a><span class=s2>    &quot;</span>
<a id=__codelineno-15-36 name=__codelineno-15-36 href=#__codelineno-15-36></a><span class=o>}</span>
<a id=__codelineno-15-37 name=__codelineno-15-37 href=#__codelineno-15-37></a>
<a id=__codelineno-15-38 name=__codelineno-15-38 href=#__codelineno-15-38></a><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span>-n<span class=w> </span><span class=s2>&quot;\033[36m *******You want to write the data to the databases? 【yes|y|Y】: \033[1m&quot;</span><span class=p>;</span><span class=w> </span><span class=nb>read</span><span class=w> </span>ensure
<a id=__codelineno-15-39 name=__codelineno-15-39 href=#__codelineno-15-39></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$ensure</span><span class=s2>&quot;</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s2>&quot;yes&quot;</span><span class=w> </span>-o<span class=w> </span><span class=s2>&quot;</span><span class=nv>$ensure</span><span class=s2>&quot;</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s2>&quot;y&quot;</span><span class=w> </span>-o<span class=w> </span><span class=s2>&quot;</span><span class=nv>$ensure</span><span class=s2>&quot;</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s2>&quot;Y&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-15-40 name=__codelineno-15-40 href=#__codelineno-15-40></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;-------------------------------------------------------------&quot;</span>
<a id=__codelineno-15-41 name=__codelineno-15-41 href=#__codelineno-15-41></a>
<a id=__codelineno-15-42 name=__codelineno-15-42 href=#__codelineno-15-42></a><span class=w>    </span>mysql<span class=w> </span>-uroot<span class=w> </span>-padmin#123<span class=w> </span>-D<span class=w> </span>App1<span class=w> </span>-e<span class=w> </span><span class=s2>&quot;select count(*) from system_info;&quot;</span><span class=w> </span>&gt;<span class=w> </span>/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-15-43 name=__codelineno-15-43 href=#__codelineno-15-43></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$?</span><span class=s2>&quot;</span><span class=w> </span>-eq<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-15-44 name=__codelineno-15-44 href=#__codelineno-15-44></a><span class=w>        </span>monitor_jk
<a id=__codelineno-15-45 name=__codelineno-15-45 href=#__codelineno-15-45></a><span class=w>    </span><span class=k>else</span>
<a id=__codelineno-15-46 name=__codelineno-15-46 href=#__codelineno-15-46></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;</span><span class=nv>$DB_name</span><span class=s2> is not exists! Create </span><span class=nv>$DB_name</span><span class=s2>&quot;</span>
<a id=__codelineno-15-47 name=__codelineno-15-47 href=#__codelineno-15-47></a><span class=w>        </span>mysql<span class=w> </span>-u<span class=si>${</span><span class=nv>Mysql_ROOT</span><span class=si>}</span><span class=w> </span>-p<span class=si>${</span><span class=nv>Mysql_password</span><span class=si>}</span><span class=w> </span>-D<span class=w> </span><span class=nv>$DB_name</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;</span>
<a id=__codelineno-15-48 name=__codelineno-15-48 href=#__codelineno-15-48></a><span class=s2>         CREATE TABLE `system_info` (</span>
<a id=__codelineno-15-49 name=__codelineno-15-49 href=#__codelineno-15-49></a><span class=s2>          `id` int(10) NOT NULL AUTO_INCREMENT,</span>
<a id=__codelineno-15-50 name=__codelineno-15-50 href=#__codelineno-15-50></a><span class=s2>          `address` varchar(15) DEFAULT NULL COMMENT &#39;IP address&#39;,</span>
<a id=__codelineno-15-51 name=__codelineno-15-51 href=#__codelineno-15-51></a><span class=s2>          `Hostname` varchar(30) DEFAULT NULL COMMENT &#39;hostname&#39;,</span>
<a id=__codelineno-15-52 name=__codelineno-15-52 href=#__codelineno-15-52></a><span class=s2>          `CPU_info` varchar(100) DEFAULT NULL COMMENT &#39;cpu_info&#39;,</span>
<a id=__codelineno-15-53 name=__codelineno-15-53 href=#__codelineno-15-53></a><span class=s2>          `Disk_info` varchar(200) DEFAULT NULL COMMENT &#39;disk_info&#39;,</span>
<a id=__codelineno-15-54 name=__codelineno-15-54 href=#__codelineno-15-54></a><span class=s2>          `Mem_info` int(8) DEFAULT NULL COMMENT &#39;mem_info&#39;,</span>
<a id=__codelineno-15-55 name=__codelineno-15-55 href=#__codelineno-15-55></a><span class=s2>          `Load_info` varchar(80) DEFAULT NULL COMMENT &#39;load_info&#39;,</span>
<a id=__codelineno-15-56 name=__codelineno-15-56 href=#__codelineno-15-56></a><span class=s2>          PRIMARY KEY (`id`)</span>
<a id=__codelineno-15-57 name=__codelineno-15-57 href=#__codelineno-15-57></a><span class=s2>        ) ENGINE=InnoDB DEFAULT CHARSET=utf8;;</span>
<a id=__codelineno-15-58 name=__codelineno-15-58 href=#__codelineno-15-58></a>
<a id=__codelineno-15-59 name=__codelineno-15-59 href=#__codelineno-15-59></a><span class=s2>        &quot;</span>
<a id=__codelineno-15-60 name=__codelineno-15-60 href=#__codelineno-15-60></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-15-61 name=__codelineno-15-61 href=#__codelineno-15-61></a><span class=w>    </span>monitor_jk
<a id=__codelineno-15-62 name=__codelineno-15-62 href=#__codelineno-15-62></a>
<a id=__codelineno-15-63 name=__codelineno-15-63 href=#__codelineno-15-63></a><span class=k>fi</span>
<a id=__codelineno-15-64 name=__codelineno-15-64 href=#__codelineno-15-64></a>
<a id=__codelineno-15-65 name=__codelineno-15-65 href=#__codelineno-15-65></a>mysql<span class=w> </span>-u<span class=si>${</span><span class=nv>Mysql_ROOT</span><span class=si>}</span><span class=w> </span>-p<span class=si>${</span><span class=nv>Mysql_password</span><span class=si>}</span><span class=w> </span>-D<span class=w> </span><span class=nv>$DB_name</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;select * from system_info;&quot;</span>
</code></pre></div> <h3 id=监控服务器主要性能参数指标>监控服务器主要性能参数指标<a class=headerlink href=#监控服务器主要性能参数指标 title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a><span class=c1>#功能描述(Description):监控服务器主要性能参数指标.</span>
<a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a><span class=c1>#监控项目:内核信息,主机名称,IP地址,登陆账户,内存与swap信息,磁盘信息,CPU负载.</span>
<a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a>
<a id=__codelineno-16-5 name=__codelineno-16-5 href=#__codelineno-16-5></a><span class=nv>kernel</span><span class=o>=</span><span class=k>$(</span>uname<span class=w> </span>-r<span class=k>)</span><span class=w>                                         </span><span class=c1>#内核信息</span>
<a id=__codelineno-16-6 name=__codelineno-16-6 href=#__codelineno-16-6></a><span class=nv>release</span><span class=o>=</span><span class=k>$(</span>cat<span class=w> </span>/etc/redhat-release<span class=k>)</span><span class=w>                         </span><span class=c1>#操作系统版本</span>
<a id=__codelineno-16-7 name=__codelineno-16-7 href=#__codelineno-16-7></a><span class=nv>hostname</span><span class=o>=</span><span class=nv>$HOSTNAME</span><span class=w>                                         </span><span class=c1>#主机名称</span>
<a id=__codelineno-16-8 name=__codelineno-16-8 href=#__codelineno-16-8></a><span class=nv>localip</span><span class=o>=</span><span class=k>$(</span>ip<span class=w> </span>a<span class=w> </span>s<span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span><span class=s1>&#39;/inet /{print $2}&#39;</span><span class=k>)</span><span class=w>                </span><span class=c1>#本地IP地址列表</span>
<a id=__codelineno-16-9 name=__codelineno-16-9 href=#__codelineno-16-9></a><span class=nv>mem_total</span><span class=o>=</span><span class=k>$(</span>free<span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span><span class=s1>&#39;/Mem/{print $2}&#39;</span><span class=k>)</span><span class=w>                  </span><span class=c1>#总内存容量</span>
<a id=__codelineno-16-10 name=__codelineno-16-10 href=#__codelineno-16-10></a><span class=nv>mem_free</span><span class=o>=</span><span class=k>$(</span>free<span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span><span class=s1>&#39;/Mem/{print $NF}&#39;</span><span class=k>)</span><span class=w>                  </span><span class=c1>#剩余内存容量</span>
<a id=__codelineno-16-11 name=__codelineno-16-11 href=#__codelineno-16-11></a><span class=nv>swap_total</span><span class=o>=</span><span class=k>$(</span>free<span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span><span class=s1>&#39;/Swap/{print $2}&#39;</span><span class=k>)</span><span class=w>                </span><span class=c1>#总swap容量</span>
<a id=__codelineno-16-12 name=__codelineno-16-12 href=#__codelineno-16-12></a><span class=nv>swap_free</span><span class=o>=</span><span class=k>$(</span>free<span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span><span class=s1>&#39;/Swap/{print $NF}&#39;</span><span class=k>)</span><span class=w>                </span><span class=c1>#剩余swap容量</span>
<a id=__codelineno-16-13 name=__codelineno-16-13 href=#__codelineno-16-13></a><span class=nv>disk</span><span class=o>=</span><span class=k>$(</span>df<span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span><span class=s1>&#39;/^\/dev/{print $1,$2,$4}&#39;</span><span class=p>|</span>column<span class=w> </span>-t<span class=k>)</span><span class=w>      </span><span class=c1>#磁盘信息</span>
<a id=__codelineno-16-14 name=__codelineno-16-14 href=#__codelineno-16-14></a><span class=nv>load1</span><span class=o>=</span><span class=k>$(</span>uptime<span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span><span class=s1>&#39;s/,//g&#39;</span><span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span><span class=s1>&#39;{print $(NF-2)}&#39;</span><span class=k>)</span><span class=w>     </span><span class=c1>#CPU最近1分钟平均负载</span>
<a id=__codelineno-16-15 name=__codelineno-16-15 href=#__codelineno-16-15></a><span class=nv>load5</span><span class=o>=</span><span class=k>$(</span>uptime<span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span><span class=s1>&#39;s/,//g&#39;</span><span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span><span class=s1>&#39;{print $(NF-1)}&#39;</span><span class=k>)</span><span class=w>     </span><span class=c1>#CPU最近5分钟平均负载</span>
<a id=__codelineno-16-16 name=__codelineno-16-16 href=#__codelineno-16-16></a><span class=nv>load15</span><span class=o>=</span><span class=k>$(</span>uptime<span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span><span class=s1>&#39;s/,//g&#39;</span><span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span><span class=s1>&#39;{print $NF}&#39;</span><span class=k>)</span><span class=w>        </span><span class=c1>#CPU最近15分钟平均负载</span>
<a id=__codelineno-16-17 name=__codelineno-16-17 href=#__codelineno-16-17></a><span class=nv>login_users</span><span class=o>=</span><span class=k>$(</span>who<span class=w> </span><span class=p>|</span><span class=w> </span>wc<span class=w> </span>-l<span class=k>)</span><span class=w>                                 </span><span class=c1>#登陆用户数量</span>
<a id=__codelineno-16-18 name=__codelineno-16-18 href=#__codelineno-16-18></a><span class=nv>procs</span><span class=o>=</span><span class=k>$(</span>ps<span class=w> </span>aux<span class=w> </span><span class=p>|</span><span class=w> </span>wc<span class=w> </span>-l<span class=k>)</span><span class=w>                                    </span><span class=c1>#进程数量</span>
<a id=__codelineno-16-19 name=__codelineno-16-19 href=#__codelineno-16-19></a><span class=nv>users</span><span class=o>=</span><span class=k>$(</span>sed<span class=w> </span>-n<span class=w> </span><span class=s1>&#39;$=&#39;</span><span class=w> </span>/etc/passwd<span class=k>)</span><span class=w>                           </span><span class=c1>#系统总账户数量</span>
<a id=__codelineno-16-20 name=__codelineno-16-20 href=#__codelineno-16-20></a><span class=nv>cpu_info</span><span class=o>=</span><span class=k>$(</span><span class=nv>LANG</span><span class=o>=</span>C<span class=w> </span>lscpu<span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span>-F:<span class=w> </span><span class=s1>&#39;/Model name/ {print $2}&#39;</span><span class=k>)</span><span class=w>         </span><span class=c1>#CPU型号</span>
<a id=__codelineno-16-21 name=__codelineno-16-21 href=#__codelineno-16-21></a><span class=nv>cpu_core</span><span class=o>=</span><span class=k>$(</span>awk<span class=w> </span><span class=s1>&#39;/processor/{core</ins> END{print core}&#39;</span><span class=w> </span>/proc/cpuinfo<span class=k>)</span><span class=w>  </span><span class=c1>#CPU内核数量</span>
<a id=__codelineno-16-22 name=__codelineno-16-22 href=#__codelineno-16-22></a>
<a id=__codelineno-16-23 name=__codelineno-16-23 href=#__codelineno-16-23></a>yum<span class=w> </span>-y<span class=w> </span>-q<span class=w> </span>install<span class=w> </span>sysstat<span class=w> </span><span class=p>&amp;</span>&gt;/dev/null<span class=w>                                </span><span class=c1>#安装性能监控软件</span>
<a id=__codelineno-16-24 name=__codelineno-16-24 href=#__codelineno-16-24></a><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;\033[34m提取磁盘性能指标,请稍后...\033[0m&quot;</span>
<a id=__codelineno-16-25 name=__codelineno-16-25 href=#__codelineno-16-25></a><span class=nv>tps</span><span class=o>=</span><span class=k>$(</span><span class=nv>LANG</span><span class=o>=</span>C<span class=w> </span>sar<span class=w> </span>-d<span class=w> </span>-p<span class=w> </span><span class=m>1</span><span class=w> </span><span class=m>6</span><span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span><span class=s1>&#39;/Average/&#39;</span><span class=w> </span><span class=p>|</span><span class=w> </span>tail<span class=w> </span>-n<span class=w> </span>+2<span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span><span class=s1>&#39;{print &quot;[&quot;$2&quot;]磁盘平均IO数量:&quot;$3}&#39;</span><span class=k>)</span><span class=w> </span><span class=p>&amp;</span>
<a id=__codelineno-16-26 name=__codelineno-16-26 href=#__codelineno-16-26></a><span class=nv>read_write</span><span class=o>=</span><span class=k>$(</span><span class=nv>LANG</span><span class=o>=</span>C<span class=w> </span>sar<span class=w> </span>-d<span class=w> </span>-p<span class=w> </span><span class=m>1</span><span class=w> </span><span class=m>6</span><span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span><span class=s1>&#39;/Average/&#39;</span><span class=w> </span><span class=p>|</span><span class=w> </span>tail<span class=w> </span>-n<span class=w> </span>+2<span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span><span class=s1>&#39;{print &quot;[&quot;$2&quot;]平均每秒读写扇区量:&quot;$4,$5}&#39;</span><span class=k>)</span><span class=w> </span><span class=p>&amp;</span>
<a id=__codelineno-16-27 name=__codelineno-16-27 href=#__codelineno-16-27></a>
<a id=__codelineno-16-28 name=__codelineno-16-28 href=#__codelineno-16-28></a><span class=nv>irq</span><span class=o>=</span><span class=k>$(</span>vmstat<span class=w> </span><span class=m>1</span><span class=w> </span><span class=m>2</span><span class=w> </span><span class=p>|</span><span class=w> </span>tail<span class=w> </span>-n<span class=w> </span>+4<span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span><span class=s1>&#39;{print $11}&#39;</span><span class=k>)</span><span class=w>         </span><span class=c1>#中断数量</span>
<a id=__codelineno-16-29 name=__codelineno-16-29 href=#__codelineno-16-29></a><span class=nv>cs</span><span class=o>=</span><span class=k>$(</span>vmstat<span class=w> </span><span class=m>1</span><span class=w> </span><span class=m>2</span><span class=w> </span><span class=p>|</span><span class=w> </span>tail<span class=w> </span>-n<span class=w> </span>+4<span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span><span class=s1>&#39;{print $12}&#39;</span><span class=k>)</span><span class=w>          </span><span class=c1>#上下文切换数量</span>
<a id=__codelineno-16-30 name=__codelineno-16-30 href=#__codelineno-16-30></a>
<a id=__codelineno-16-31 name=__codelineno-16-31 href=#__codelineno-16-31></a><span class=nv>top_proc_mem</span><span class=o>=</span><span class=k>$(</span>ps<span class=w> </span>--no-headers<span class=w> </span>-eo<span class=w> </span>comm,rss<span class=w> </span><span class=p>|</span><span class=w> </span>sort<span class=w> </span>-k2<span class=w> </span>-n<span class=w> </span><span class=p>|</span><span class=w> </span>tail<span class=w> </span>-10<span class=k>)</span><span class=w> </span><span class=c1>#占用内存资源最多的10个进程列表</span>
<a id=__codelineno-16-32 name=__codelineno-16-32 href=#__codelineno-16-32></a><span class=nv>top_proc_cpu</span><span class=o>=</span><span class=k>$(</span>ps<span class=w> </span>--no-headers<span class=w> </span>-eo<span class=w> </span>comm,pcpu<span class=w> </span><span class=p>|</span><span class=w> </span>sort<span class=w> </span>-k2<span class=w> </span>-n<span class=w> </span><span class=p>|</span><span class=w> </span>tail<span class=w> </span>-5<span class=k>)</span><span class=w> </span><span class=c1>#占用CPU资源最多的5个进程列表</span>
<a id=__codelineno-16-33 name=__codelineno-16-33 href=#__codelineno-16-33></a>
<a id=__codelineno-16-34 name=__codelineno-16-34 href=#__codelineno-16-34></a><span class=c1>#获取网卡流量,接收|发送的数据流量,单位为字节bytes).</span>
<a id=__codelineno-16-35 name=__codelineno-16-35 href=#__codelineno-16-35></a><span class=nv>net_monitor</span><span class=o>=</span><span class=k>$(</span>cat<span class=w> </span>/proc/net/dev<span class=w> </span><span class=p>|</span><span class=w> </span>tail<span class=w> </span>-n<span class=w> </span>+3<span class=w> </span><span class=p>|</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-16-36 name=__codelineno-16-36 href=#__codelineno-16-36></a><span class=w>              </span>awk<span class=w> </span><span class=s1>&#39;BEGIN{ print &quot;网卡名称 入站数据流量(bytes) 出站数据流量(bytes)&quot; } \</span>
<a id=__codelineno-16-37 name=__codelineno-16-37 href=#__codelineno-16-37></a><span class=s1>                   { print $1,$2,$10 }&#39;</span><span class=w> </span><span class=p>|</span><span class=w> </span>column<span class=w> </span>-t<span class=k>)</span>
<a id=__codelineno-16-38 name=__codelineno-16-38 href=#__codelineno-16-38></a>
<a id=__codelineno-16-39 name=__codelineno-16-39 href=#__codelineno-16-39></a><span class=c1>#输出数据信息.</span>
<a id=__codelineno-16-40 name=__codelineno-16-40 href=#__codelineno-16-40></a><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;\033[32m--------------本机主要数据参数表-----------------\033[0m&quot;</span>
<a id=__codelineno-16-41 name=__codelineno-16-41 href=#__codelineno-16-41></a><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;本机IP地址列表:\033[32m</span><span class=nv>$localip</span><span class=s2>\033[0m&quot;</span>
<a id=__codelineno-16-42 name=__codelineno-16-42 href=#__codelineno-16-42></a><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;本机主机名称:\033[32m</span><span class=nv>$hostname</span><span class=s2>\033[0m&quot;</span>
<a id=__codelineno-16-43 name=__codelineno-16-43 href=#__codelineno-16-43></a><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;操作系统版本:\033[32m</span><span class=nv>$release</span><span class=s2>\033[0m,内核版本:\033[32m</span><span class=nv>$kernel</span><span class=s2>\033[0m&quot;</span>
<a id=__codelineno-16-44 name=__codelineno-16-44 href=#__codelineno-16-44></a><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;CPU型号为:\033[32m</span><span class=nv>$cpu_info</span><span class=s2>\033[0m,CPU内核数量:\033[32m</span><span class=nv>$cpu_core</span><span class=s2>\033[0m&quot;</span>
<a id=__codelineno-16-45 name=__codelineno-16-45 href=#__codelineno-16-45></a><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;本机总内存容量:\033[32m</span><span class=nv>$mem_total</span><span class=s2>\033[0m,剩余可用内存容量:\033[32m</span><span class=nv>$mem_free</span><span class=s2>\033[0m&quot;</span>
<a id=__codelineno-16-46 name=__codelineno-16-46 href=#__codelineno-16-46></a><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;本机swap总容量:\033[32m</span><span class=nv>$swap_total</span><span class=s2>\033[0m,剩余容量:\033[32m</span><span class=nv>$swap_free</span><span class=s2>\033[0m&quot;</span>
<a id=__codelineno-16-47 name=__codelineno-16-47 href=#__codelineno-16-47></a><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;CPU最近1分钟,5分钟,15分钟的平均负载分别为:\033[32m</span><span class=nv>$load1</span><span class=s2> </span><span class=nv>$load5</span><span class=s2> </span><span class=nv>$load15</span><span class=s2>\033[0m&quot;</span>
<a id=__codelineno-16-48 name=__codelineno-16-48 href=#__codelineno-16-48></a><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;本机总账户数量为:\033[32m</span><span class=nv>$users</span><span class=s2>\033[0m,当前登陆系统的账户数量:\033[32m</span><span class=nv>$login_users</span><span class=s2>\033[0m&quot;</span>
<a id=__codelineno-16-49 name=__codelineno-16-49 href=#__codelineno-16-49></a><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;当前系统中启动的进程数量:\033[32m</span><span class=nv>$procs</span><span class=s2>\033[0m&quot;</span>
<a id=__codelineno-16-50 name=__codelineno-16-50 href=#__codelineno-16-50></a><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;占用CPU资源最多的5个进程列表为:&quot;</span>
<a id=__codelineno-16-51 name=__codelineno-16-51 href=#__codelineno-16-51></a><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;\033[32m</span><span class=nv>$top_proc_cpu</span><span class=s2>\033[0m&quot;</span>
<a id=__codelineno-16-52 name=__codelineno-16-52 href=#__codelineno-16-52></a><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;占用内存资源最多的10个进程列表为:&quot;</span>
<a id=__codelineno-16-53 name=__codelineno-16-53 href=#__codelineno-16-53></a><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;\033[32m</span><span class=nv>$top_proc_mem</span><span class=s2>\033[0m&quot;</span>
<a id=__codelineno-16-54 name=__codelineno-16-54 href=#__codelineno-16-54></a><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;CPU中断数量:\033[32m</span><span class=nv>$irq</span><span class=s2>\033[0m,CPU上下文切换数量:\033[32m</span><span class=nv>$cs</span><span class=s2>\033[0m&quot;</span>
<a id=__codelineno-16-55 name=__codelineno-16-55 href=#__codelineno-16-55></a><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;每个磁盘分区的总容量与剩余容量信息如下:&quot;</span>
<a id=__codelineno-16-56 name=__codelineno-16-56 href=#__codelineno-16-56></a><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;</span><span class=nv>$disk</span><span class=s2>&quot;</span>
<a id=__codelineno-16-57 name=__codelineno-16-57 href=#__codelineno-16-57></a><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;</span><span class=nv>$tps</span><span class=s2>&quot;</span>
<a id=__codelineno-16-58 name=__codelineno-16-58 href=#__codelineno-16-58></a><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;</span><span class=nv>$read_write</span><span class=s2>&quot;</span>
<a id=__codelineno-16-59 name=__codelineno-16-59 href=#__codelineno-16-59></a><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;</span><span class=nv>$net_monitor</span><span class=s2>&quot;</span>
<a id=__codelineno-16-60 name=__codelineno-16-60 href=#__codelineno-16-60></a><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;\033[32m------------------The End------------------------\033[0m&quot;</span>
</code></pre></div> <h2 id=生产环境下运维开发类脚本>生产环境下运维开发类脚本<a class=headerlink href=#生产环境下运维开发类脚本 title="Permanent link">&para;</a></h2> <h3 id=系统初始化脚本centos6>系统初始化脚本Centos6<a class=headerlink href=#系统初始化脚本centos6 title="Permanent link">&para;</a></h3> <p>系统初始化脚本用于新装Linux的相关配置工作，</p> <p>比如禁掉iptables和SELinux及IPv6、优化系统内核、停掉一些没必要启动的系统服务等。</p> <p>我们将系统初始化脚本应用于公司内部的运维开发机器的批量部署（比如用Ansible来下发）上。事实上，复杂的系统业务初始化initial脚本由于涉及了多条产品线和多个业务平台，因此远比这里列出的开发环境下的初始化脚本复杂得多，而且其代码量也极大，基本上都是6000～7000行的Shell脚本，各功能模块以函数的形式进行封装。下面的脚本只是涉及一些基础部分，希望大家注意这点。</p> <p>脚本代码如下所示（此脚本已在CentOS 6.8 x86_x64下测试通过）：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a>
<a id=__codelineno-17-3 name=__codelineno-17-3 href=#__codelineno-17-3></a><span class=c1>#添加epel外部yum扩展源</span>
<a id=__codelineno-17-4 name=__codelineno-17-4 href=#__codelineno-17-4></a><span class=nb>cd</span><span class=w> </span>/usr/local/src
<a id=__codelineno-17-5 name=__codelineno-17-5 href=#__codelineno-17-5></a>wget<span class=w> </span>http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm
<a id=__codelineno-17-6 name=__codelineno-17-6 href=#__codelineno-17-6></a>rpm<span class=w> </span>-ivh<span class=w> </span>epel-release-6-8.noarch.rpm
<a id=__codelineno-17-7 name=__codelineno-17-7 href=#__codelineno-17-7></a>
<a id=__codelineno-17-8 name=__codelineno-17-8 href=#__codelineno-17-8></a><span class=c1>#安装gcc基础库文件以及sysstat工具</span>
<a id=__codelineno-17-9 name=__codelineno-17-9 href=#__codelineno-17-9></a>yum<span class=w> </span>-y<span class=w> </span>install<span class=w> </span>gcc<span class=w> </span>gcc-c++<span class=w> </span>vim-enhanced<span class=w> </span>unzip<span class=w> </span>unrar<span class=w> </span>sysstat
<a id=__codelineno-17-10 name=__codelineno-17-10 href=#__codelineno-17-10></a>
<a id=__codelineno-17-11 name=__codelineno-17-11 href=#__codelineno-17-11></a><span class=c1>#配置ntpdate自动对时</span>
<a id=__codelineno-17-12 name=__codelineno-17-12 href=#__codelineno-17-12></a>yum<span class=w> </span>-y<span class=w> </span>install<span class=w> </span>ntp
<a id=__codelineno-17-13 name=__codelineno-17-13 href=#__codelineno-17-13></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;01 01 * * * /usr/sbin/ntpdate ntp.api.bz    &gt;&gt; /dev/null 2&gt;&amp;1&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span>/etc/crontab
<a id=__codelineno-17-14 name=__codelineno-17-14 href=#__codelineno-17-14></a>ntpdate<span class=w> </span>ntp.api.bz
<a id=__codelineno-17-15 name=__codelineno-17-15 href=#__codelineno-17-15></a>service<span class=w> </span>crond<span class=w> </span>restart
<a id=__codelineno-17-16 name=__codelineno-17-16 href=#__codelineno-17-16></a>
<a id=__codelineno-17-17 name=__codelineno-17-17 href=#__codelineno-17-17></a><span class=c1>#配置文件的ulimit值</span>
<a id=__codelineno-17-18 name=__codelineno-17-18 href=#__codelineno-17-18></a><span class=nb>ulimit</span><span class=w> </span>-SHn<span class=w> </span><span class=m>65535</span>
<a id=__codelineno-17-19 name=__codelineno-17-19 href=#__codelineno-17-19></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;ulimit -SHn 65535&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span>/etc/rc.local
<a id=__codelineno-17-20 name=__codelineno-17-20 href=#__codelineno-17-20></a>cat<span class=w> </span>&gt;&gt;<span class=w> </span>/etc/security/limits.conf<span class=w> </span><span class=s>&lt;&lt; EOF</span>
<a id=__codelineno-17-21 name=__codelineno-17-21 href=#__codelineno-17-21></a><span class=s>*                     soft     nofile             65535</span>
<a id=__codelineno-17-22 name=__codelineno-17-22 href=#__codelineno-17-22></a><span class=s>*                     hard     nofile             65535</span>
<a id=__codelineno-17-23 name=__codelineno-17-23 href=#__codelineno-17-23></a><span class=s>EOF</span>
<a id=__codelineno-17-24 name=__codelineno-17-24 href=#__codelineno-17-24></a>
<a id=__codelineno-17-25 name=__codelineno-17-25 href=#__codelineno-17-25></a><span class=c1>#基础系统内核优化</span>
<a id=__codelineno-17-26 name=__codelineno-17-26 href=#__codelineno-17-26></a>cat<span class=w> </span>&gt;&gt;<span class=w> </span>/etc/sysctl.conf<span class=w> </span><span class=s>&lt;&lt; EOF</span>
<a id=__codelineno-17-27 name=__codelineno-17-27 href=#__codelineno-17-27></a><span class=s>fs.file-max=419430</span>
<a id=__codelineno-17-28 name=__codelineno-17-28 href=#__codelineno-17-28></a><span class=s>net.ipv4.tcp_syncookies = 1</span>
<a id=__codelineno-17-29 name=__codelineno-17-29 href=#__codelineno-17-29></a><span class=s>net.ipv4.tcp_syn_retries = 1</span>
<a id=__codelineno-17-30 name=__codelineno-17-30 href=#__codelineno-17-30></a><span class=s>net.ipv4.tcp_tw_recycle = 1</span>
<a id=__codelineno-17-31 name=__codelineno-17-31 href=#__codelineno-17-31></a><span class=s>net.ipv4.tcp_tw_reuse = 1</span>
<a id=__codelineno-17-32 name=__codelineno-17-32 href=#__codelineno-17-32></a><span class=s>net.ipv4.tcp_fin_timeout = 1</span>
<a id=__codelineno-17-33 name=__codelineno-17-33 href=#__codelineno-17-33></a><span class=s>net.ipv4.tcp_keepalive_time = 1200</span>
<a id=__codelineno-17-34 name=__codelineno-17-34 href=#__codelineno-17-34></a><span class=s>net.ipv4.ip_local_port_range = 1024 65535</span>
<a id=__codelineno-17-35 name=__codelineno-17-35 href=#__codelineno-17-35></a><span class=s>net.ipv4.tcp_max_syn_backlog = 16384</span>
<a id=__codelineno-17-36 name=__codelineno-17-36 href=#__codelineno-17-36></a><span class=s>net.ipv4.tcp_max_tw_buckets = 36000</span>
<a id=__codelineno-17-37 name=__codelineno-17-37 href=#__codelineno-17-37></a><span class=s>net.ipv4.route.gc_timeout = 100</span>
<a id=__codelineno-17-38 name=__codelineno-17-38 href=#__codelineno-17-38></a><span class=s>net.ipv4.tcp_syn_retries = 1</span>
<a id=__codelineno-17-39 name=__codelineno-17-39 href=#__codelineno-17-39></a><span class=s>net.ipv4.tcp_synack_retries = 1</span>
<a id=__codelineno-17-40 name=__codelineno-17-40 href=#__codelineno-17-40></a><span class=s>net.core.somaxconn = 16384</span>
<a id=__codelineno-17-41 name=__codelineno-17-41 href=#__codelineno-17-41></a><span class=s>net.core.netdev_max_backlog = 16384</span>
<a id=__codelineno-17-42 name=__codelineno-17-42 href=#__codelineno-17-42></a><span class=s>net.ipv4.tcp_max_orphans = 16384</span>
<a id=__codelineno-17-43 name=__codelineno-17-43 href=#__codelineno-17-43></a><span class=s>EOF</span>
<a id=__codelineno-17-44 name=__codelineno-17-44 href=#__codelineno-17-44></a>/sbin/sysctl<span class=w> </span>-p
<a id=__codelineno-17-45 name=__codelineno-17-45 href=#__codelineno-17-45></a>
<a id=__codelineno-17-46 name=__codelineno-17-46 href=#__codelineno-17-46></a><span class=c1>#禁用control-alt-delete组合键以防止误操作</span>
<a id=__codelineno-17-47 name=__codelineno-17-47 href=#__codelineno-17-47></a>sed<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;s@ca::ctrlaltdel:/sbin/shutdown -t3 -r now@#ca::ctrlaltdel:/sbin/shutdown -t3 -r now@&#39;</span><span class=w> </span>/etc/inittab
<a id=__codelineno-17-48 name=__codelineno-17-48 href=#__codelineno-17-48></a>
<a id=__codelineno-17-49 name=__codelineno-17-49 href=#__codelineno-17-49></a><span class=c1>#关闭SELinux</span>
<a id=__codelineno-17-50 name=__codelineno-17-50 href=#__codelineno-17-50></a>sed<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;s@SELINUX=enforcing@SELINUX=disabled@&#39;</span><span class=w> </span>/etc/selinux/config
<a id=__codelineno-17-51 name=__codelineno-17-51 href=#__codelineno-17-51></a>
<a id=__codelineno-17-52 name=__codelineno-17-52 href=#__codelineno-17-52></a><span class=c1>#关闭iptables</span>
<a id=__codelineno-17-53 name=__codelineno-17-53 href=#__codelineno-17-53></a>service<span class=w> </span>iptables<span class=w> </span>stop
<a id=__codelineno-17-54 name=__codelineno-17-54 href=#__codelineno-17-54></a>chkconfig<span class=w> </span>iptables<span class=w> </span>off
<a id=__codelineno-17-55 name=__codelineno-17-55 href=#__codelineno-17-55></a>
<a id=__codelineno-17-56 name=__codelineno-17-56 href=#__codelineno-17-56></a><span class=c1>#ssh服务配置优化,请至少保持机器中至少有一个具有sudo权限的用户，下面的配置会禁止root远程登录</span>
<a id=__codelineno-17-57 name=__codelineno-17-57 href=#__codelineno-17-57></a>sed<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;s@#PermitRootLogin yes@PermitRootLogin no@&#39;</span><span class=w> </span>/etc/ssh/sshd_config<span class=w> </span><span class=c1>#禁止root远程登录</span>
<a id=__codelineno-17-58 name=__codelineno-17-58 href=#__codelineno-17-58></a>sed<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;s@#PermitEmptyPasswords no@PermitEmptyPasswords no@&#39;</span><span class=w> </span>/etc/ssh/sshd_config<span class=w> </span><span class=c1>#禁止空密码登录</span>
<a id=__codelineno-17-59 name=__codelineno-17-59 href=#__codelineno-17-59></a>sed<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;s@#UseDNS yes@UseDNS no@&#39;</span><span class=w> </span>/etc/ssh/sshd_config<span class=w> </span>/etc/ssh/sshd_config
<a id=__codelineno-17-60 name=__codelineno-17-60 href=#__codelineno-17-60></a>service<span class=w> </span>sshd<span class=w> </span>restart
<a id=__codelineno-17-61 name=__codelineno-17-61 href=#__codelineno-17-61></a>
<a id=__codelineno-17-62 name=__codelineno-17-62 href=#__codelineno-17-62></a><span class=c1>#禁用IPv6地址</span>
<a id=__codelineno-17-63 name=__codelineno-17-63 href=#__codelineno-17-63></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;alias net-pf-10 off&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span>/etc/modprobe.d/dist.conf
<a id=__codelineno-17-64 name=__codelineno-17-64 href=#__codelineno-17-64></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;alias ipv6 off&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span>/etc/modprobe.d/dist.conf
<a id=__codelineno-17-65 name=__codelineno-17-65 href=#__codelineno-17-65></a>chkconfig<span class=w> </span>ip6tables<span class=w> </span>off
<a id=__codelineno-17-66 name=__codelineno-17-66 href=#__codelineno-17-66></a>
<a id=__codelineno-17-67 name=__codelineno-17-67 href=#__codelineno-17-67></a><span class=c1>#vim基础语法优化</span>
<a id=__codelineno-17-68 name=__codelineno-17-68 href=#__codelineno-17-68></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;syntax on&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span>/root/.vimrc
<a id=__codelineno-17-69 name=__codelineno-17-69 href=#__codelineno-17-69></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;set nohlsearch&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span>/root/.vimrc
<a id=__codelineno-17-70 name=__codelineno-17-70 href=#__codelineno-17-70></a>
<a id=__codelineno-17-71 name=__codelineno-17-71 href=#__codelineno-17-71></a><span class=c1>#精简开机自启动服务，安装最小化服务的机器初始可以只保留crond，network，rsyslog，sshd这四个服务。</span>
<a id=__codelineno-17-72 name=__codelineno-17-72 href=#__codelineno-17-72></a><span class=k>for</span><span class=w> </span>i<span class=w> </span><span class=k>in</span><span class=w> </span><span class=sb>`</span>chkconfig<span class=w> </span>--list<span class=p>|</span>grep<span class=w> </span><span class=m>3</span>:on<span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;{print $1}&#39;</span><span class=sb>`</span><span class=p>;</span><span class=k>do</span><span class=w> </span>chkconfig<span class=w> </span>--level<span class=w> </span><span class=m>3</span><span class=w> </span><span class=nv>$i</span><span class=w> </span>off<span class=p>;</span><span class=k>done</span>
<a id=__codelineno-17-73 name=__codelineno-17-73 href=#__codelineno-17-73></a><span class=k>for</span><span class=w> </span>CURSRV<span class=w>  </span><span class=k>in</span><span class=w> </span>crond<span class=w> </span>rsyslog<span class=w> </span>sshd<span class=w> </span>network<span class=p>;</span><span class=k>do</span><span class=w> </span>chkconfig<span class=w> </span>--level<span class=w> </span><span class=m>3</span><span class=w> </span><span class=nv>$CURSRV</span><span class=w> </span>on<span class=p>;</span><span class=k>done</span>
<a id=__codelineno-17-74 name=__codelineno-17-74 href=#__codelineno-17-74></a>
<a id=__codelineno-17-75 name=__codelineno-17-75 href=#__codelineno-17-75></a><span class=c1>#重启服务器</span>
<a id=__codelineno-17-76 name=__codelineno-17-76 href=#__codelineno-17-76></a>reboot
</code></pre></div> <h3 id=系统初始化脚本centos7>系统初始化脚本Centos7<a class=headerlink href=#系统初始化脚本centos7 title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a><span class=c1>#author shunxin by</span>
<a id=__codelineno-18-3 name=__codelineno-18-3 href=#__codelineno-18-3></a><span class=c1>#this script is only for CentOS 7.x</span>
<a id=__codelineno-18-4 name=__codelineno-18-4 href=#__codelineno-18-4></a><span class=c1>#check the OS</span>
<a id=__codelineno-18-5 name=__codelineno-18-5 href=#__codelineno-18-5></a><span class=nv>platform</span><span class=o>=</span><span class=sb>`</span>uname<span class=w> </span>-i<span class=sb>`</span>
<a id=__codelineno-18-6 name=__codelineno-18-6 href=#__codelineno-18-6></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=nv>$platform</span><span class=w> </span>!<span class=o>=</span><span class=w> </span><span class=s2>&quot;x86_64&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=k>then</span>
<a id=__codelineno-18-7 name=__codelineno-18-7 href=#__codelineno-18-7></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;this script is only for 64bit Operating System !&quot;</span>
<a id=__codelineno-18-8 name=__codelineno-18-8 href=#__codelineno-18-8></a><span class=nb>exit</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-18-9 name=__codelineno-18-9 href=#__codelineno-18-9></a><span class=k>fi</span>
<a id=__codelineno-18-10 name=__codelineno-18-10 href=#__codelineno-18-10></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;the platform is ok&quot;</span>
<a id=__codelineno-18-11 name=__codelineno-18-11 href=#__codelineno-18-11></a>cat<span class=w> </span><span class=s>&lt;&lt; EOF</span>
<a id=__codelineno-18-12 name=__codelineno-18-12 href=#__codelineno-18-12></a><span class=s>+---------------------------------------+</span>
<a id=__codelineno-18-13 name=__codelineno-18-13 href=#__codelineno-18-13></a><span class=s>|   your system is CentOS 7 x86_64      |</span>
<a id=__codelineno-18-14 name=__codelineno-18-14 href=#__codelineno-18-14></a><span class=s>|      start optimizing.......          |</span>
<a id=__codelineno-18-15 name=__codelineno-18-15 href=#__codelineno-18-15></a><span class=s>+---------------------------------------</span>
<a id=__codelineno-18-16 name=__codelineno-18-16 href=#__codelineno-18-16></a><span class=s>EOF</span>
<a id=__codelineno-18-17 name=__codelineno-18-17 href=#__codelineno-18-17></a><span class=c1>#Yum源更换为国内阿里源</span>
<a id=__codelineno-18-18 name=__codelineno-18-18 href=#__codelineno-18-18></a>yum<span class=w> </span>install<span class=w> </span>wget<span class=w> </span>-y
<a id=__codelineno-18-19 name=__codelineno-18-19 href=#__codelineno-18-19></a>mv<span class=w> </span>/etc/yum.repos.d/CentOS-Base.repo<span class=w> </span>/etc/yum.repos.d/CentOS-Base.repo.backup
<a id=__codelineno-18-20 name=__codelineno-18-20 href=#__codelineno-18-20></a>wget<span class=w> </span>-O<span class=w> </span>/etc/yum.repos.d/CentOS-Base.repo<span class=w> </span>http://mirrors.aliyun.com/repo/Centos-7.repo
<a id=__codelineno-18-21 name=__codelineno-18-21 href=#__codelineno-18-21></a><span class=c1>#添加阿里的epel源</span>
<a id=__codelineno-18-22 name=__codelineno-18-22 href=#__codelineno-18-22></a><span class=c1>#add the epel</span>
<a id=__codelineno-18-23 name=__codelineno-18-23 href=#__codelineno-18-23></a>wget<span class=w> </span>-O<span class=w> </span>/etc/yum.repos.d/epel.repo<span class=w> </span>http://mirrors.aliyun.com/repo/epel-7.repo
<a id=__codelineno-18-24 name=__codelineno-18-24 href=#__codelineno-18-24></a><span class=c1>#yum重新建立缓存</span>
<a id=__codelineno-18-25 name=__codelineno-18-25 href=#__codelineno-18-25></a>yum<span class=w> </span>clean<span class=w> </span>all
<a id=__codelineno-18-26 name=__codelineno-18-26 href=#__codelineno-18-26></a>yum<span class=w> </span>makecache
<a id=__codelineno-18-27 name=__codelineno-18-27 href=#__codelineno-18-27></a><span class=c1>#同步时间</span>
<a id=__codelineno-18-28 name=__codelineno-18-28 href=#__codelineno-18-28></a>yum<span class=w> </span>-y<span class=w> </span>install<span class=w> </span>ntp
<a id=__codelineno-18-29 name=__codelineno-18-29 href=#__codelineno-18-29></a>/usr/sbin/ntpdate<span class=w> </span>ntp1.aliyun.com
<a id=__codelineno-18-30 name=__codelineno-18-30 href=#__codelineno-18-30></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;* 3 * * * /usr/sbin/ntpdate ntp1.aliyun.com &gt; /dev/null 2&gt;&amp;1&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span>/var/spool/cron/root
<a id=__codelineno-18-31 name=__codelineno-18-31 href=#__codelineno-18-31></a>systemctl<span class=w>  </span>restart<span class=w> </span>crond.service
<a id=__codelineno-18-32 name=__codelineno-18-32 href=#__codelineno-18-32></a><span class=c1>#设置主机名</span>
<a id=__codelineno-18-33 name=__codelineno-18-33 href=#__codelineno-18-33></a>hostnamectl<span class=w>   </span>set-hostname<span class=w> </span>qiuyuetao
<a id=__codelineno-18-34 name=__codelineno-18-34 href=#__codelineno-18-34></a><span class=c1>#设置字符集</span>
<a id=__codelineno-18-35 name=__codelineno-18-35 href=#__codelineno-18-35></a><span class=c1>#设置最大打开文件描述符数</span>
<a id=__codelineno-18-36 name=__codelineno-18-36 href=#__codelineno-18-36></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;ulimit -SHn 102400&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span>/etc/rc.local
<a id=__codelineno-18-37 name=__codelineno-18-37 href=#__codelineno-18-37></a>cat<span class=w> </span>&gt;&gt;<span class=w> </span>/etc/security/limits.conf<span class=w> </span><span class=s>&lt;&lt; EOF</span>
<a id=__codelineno-18-38 name=__codelineno-18-38 href=#__codelineno-18-38></a><span class=s>*           soft   nofile       655350</span>
<a id=__codelineno-18-39 name=__codelineno-18-39 href=#__codelineno-18-39></a><span class=s>*           hard   nofile       655350</span>
<a id=__codelineno-18-40 name=__codelineno-18-40 href=#__codelineno-18-40></a><span class=s>EOF</span>
<a id=__codelineno-18-41 name=__codelineno-18-41 href=#__codelineno-18-41></a><span class=c1>#禁用selinux</span>
<a id=__codelineno-18-42 name=__codelineno-18-42 href=#__codelineno-18-42></a>sed<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;s/SELINUX=enforcing/SELINUX=disabled/&#39;</span><span class=w> </span>/etc/selinux/config
<a id=__codelineno-18-43 name=__codelineno-18-43 href=#__codelineno-18-43></a>setenforce<span class=w> </span><span class=m>0</span>
<a id=__codelineno-18-44 name=__codelineno-18-44 href=#__codelineno-18-44></a><span class=c1>#关闭防火墙</span>
<a id=__codelineno-18-45 name=__codelineno-18-45 href=#__codelineno-18-45></a>systemctl<span class=w> </span>disable<span class=w> </span>firewalld.service
<a id=__codelineno-18-46 name=__codelineno-18-46 href=#__codelineno-18-46></a>systemctl<span class=w> </span>stop<span class=w> </span>firewalld.service
<a id=__codelineno-18-47 name=__codelineno-18-47 href=#__codelineno-18-47></a><span class=c1>#set ssh</span>
<a id=__codelineno-18-48 name=__codelineno-18-48 href=#__codelineno-18-48></a>sed<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;s/^GSSAPIAuthentication yes$/GSSAPIAuthentication no/&#39;</span><span class=w> </span>/etc/ssh/sshd_config
<a id=__codelineno-18-49 name=__codelineno-18-49 href=#__codelineno-18-49></a>sed<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;s/#UseDNS yes/UseDNS no/&#39;</span><span class=w> </span>/etc/ssh/sshd_config
<a id=__codelineno-18-50 name=__codelineno-18-50 href=#__codelineno-18-50></a>systemctl<span class=w>  </span>restart<span class=w> </span>sshd.service
<a id=__codelineno-18-51 name=__codelineno-18-51 href=#__codelineno-18-51></a><span class=c1>#内核参数优化</span>
<a id=__codelineno-18-52 name=__codelineno-18-52 href=#__codelineno-18-52></a>cat<span class=w> </span>&gt;&gt;<span class=w> </span>/etc/sysctl.conf<span class=w> </span><span class=s>&lt;&lt; EOF</span>
<a id=__codelineno-18-53 name=__codelineno-18-53 href=#__codelineno-18-53></a><span class=s>#CTCDN系统优化参数</span>
<a id=__codelineno-18-54 name=__codelineno-18-54 href=#__codelineno-18-54></a><span class=s>#关闭ipv6</span>
<a id=__codelineno-18-55 name=__codelineno-18-55 href=#__codelineno-18-55></a><span class=s>net.ipv6.conf.all.disable_ipv6 = 1</span>
<a id=__codelineno-18-56 name=__codelineno-18-56 href=#__codelineno-18-56></a><span class=s>net.ipv6.conf.default.disable_ipv6 = 1</span>
<a id=__codelineno-18-57 name=__codelineno-18-57 href=#__codelineno-18-57></a><span class=s>#决定检查过期多久邻居条目</span>
<a id=__codelineno-18-58 name=__codelineno-18-58 href=#__codelineno-18-58></a><span class=s>net.ipv4.neigh.default.gc_stale_time=120</span>
<a id=__codelineno-18-59 name=__codelineno-18-59 href=#__codelineno-18-59></a><span class=s>#使用arp_announce / arp_ignore解决ARP映射问题</span>
<a id=__codelineno-18-60 name=__codelineno-18-60 href=#__codelineno-18-60></a><span class=s>net.ipv4.conf.default.arp_announce = 2</span>
<a id=__codelineno-18-61 name=__codelineno-18-61 href=#__codelineno-18-61></a><span class=s>net.ipv4.conf.all.arp_announce=2</span>
<a id=__codelineno-18-62 name=__codelineno-18-62 href=#__codelineno-18-62></a><span class=s>net.ipv4.conf.lo.arp_announce=2</span>
<a id=__codelineno-18-63 name=__codelineno-18-63 href=#__codelineno-18-63></a><span class=s># 避免放大攻击</span>
<a id=__codelineno-18-64 name=__codelineno-18-64 href=#__codelineno-18-64></a><span class=s>net.ipv4.icmp_echo_ignore_broadcasts = 1</span>
<a id=__codelineno-18-65 name=__codelineno-18-65 href=#__codelineno-18-65></a><span class=s># 开启恶意icmp错误消息保护</span>
<a id=__codelineno-18-66 name=__codelineno-18-66 href=#__codelineno-18-66></a><span class=s>net.ipv4.icmp_ignore_bogus_error_responses = 1</span>
<a id=__codelineno-18-67 name=__codelineno-18-67 href=#__codelineno-18-67></a><span class=s>#开启路由转发</span>
<a id=__codelineno-18-68 name=__codelineno-18-68 href=#__codelineno-18-68></a><span class=s>net.ipv4.ip_forward = 1</span>
<a id=__codelineno-18-69 name=__codelineno-18-69 href=#__codelineno-18-69></a><span class=s>net.ipv4.conf.all.send_redirects = 1</span>
<a id=__codelineno-18-70 name=__codelineno-18-70 href=#__codelineno-18-70></a><span class=s>net.ipv4.conf.default.send_redirects = 1</span>
<a id=__codelineno-18-71 name=__codelineno-18-71 href=#__codelineno-18-71></a><span class=s>#开启反向路径过滤</span>
<a id=__codelineno-18-72 name=__codelineno-18-72 href=#__codelineno-18-72></a><span class=s>net.ipv4.conf.all.rp_filter = 1</span>
<a id=__codelineno-18-73 name=__codelineno-18-73 href=#__codelineno-18-73></a><span class=s>net.ipv4.conf.default.rp_filter = 1</span>
<a id=__codelineno-18-74 name=__codelineno-18-74 href=#__codelineno-18-74></a><span class=s>#处理无源路由的包</span>
<a id=__codelineno-18-75 name=__codelineno-18-75 href=#__codelineno-18-75></a><span class=s>net.ipv4.conf.all.accept_source_route = 0</span>
<a id=__codelineno-18-76 name=__codelineno-18-76 href=#__codelineno-18-76></a><span class=s>net.ipv4.conf.default.accept_source_route = 0</span>
<a id=__codelineno-18-77 name=__codelineno-18-77 href=#__codelineno-18-77></a><span class=s>#关闭sysrq功能</span>
<a id=__codelineno-18-78 name=__codelineno-18-78 href=#__codelineno-18-78></a><span class=s>kernel.sysrq = 0</span>
<a id=__codelineno-18-79 name=__codelineno-18-79 href=#__codelineno-18-79></a><span class=s>#core文件名中添加pid作为扩展名</span>
<a id=__codelineno-18-80 name=__codelineno-18-80 href=#__codelineno-18-80></a><span class=s>kernel.core_uses_pid = 1</span>
<a id=__codelineno-18-81 name=__codelineno-18-81 href=#__codelineno-18-81></a><span class=s># 开启SYN洪水攻击保护</span>
<a id=__codelineno-18-82 name=__codelineno-18-82 href=#__codelineno-18-82></a><span class=s>net.ipv4.tcp_syncookies = 1</span>
<a id=__codelineno-18-83 name=__codelineno-18-83 href=#__codelineno-18-83></a><span class=s>#修改消息队列长度</span>
<a id=__codelineno-18-84 name=__codelineno-18-84 href=#__codelineno-18-84></a><span class=s>kernel.msgmnb = 65536</span>
<a id=__codelineno-18-85 name=__codelineno-18-85 href=#__codelineno-18-85></a><span class=s>kernel.msgmax = 65536</span>
<a id=__codelineno-18-86 name=__codelineno-18-86 href=#__codelineno-18-86></a><span class=s>#设置最大内存共享段大小bytes</span>
<a id=__codelineno-18-87 name=__codelineno-18-87 href=#__codelineno-18-87></a><span class=s>kernel.shmmax = 68719476736</span>
<a id=__codelineno-18-88 name=__codelineno-18-88 href=#__codelineno-18-88></a><span class=s>kernel.shmall = 4294967296</span>
<a id=__codelineno-18-89 name=__codelineno-18-89 href=#__codelineno-18-89></a><span class=s>#timewait的数量，默认180000</span>
<a id=__codelineno-18-90 name=__codelineno-18-90 href=#__codelineno-18-90></a><span class=s>net.ipv4.tcp_max_tw_buckets = 6000</span>
<a id=__codelineno-18-91 name=__codelineno-18-91 href=#__codelineno-18-91></a><span class=s>net.ipv4.tcp_sack = 1</span>
<a id=__codelineno-18-92 name=__codelineno-18-92 href=#__codelineno-18-92></a><span class=s>net.ipv4.tcp_window_scaling = 1</span>
<a id=__codelineno-18-93 name=__codelineno-18-93 href=#__codelineno-18-93></a><span class=s>net.ipv4.tcp_rmem = 4096        87380   4194304</span>
<a id=__codelineno-18-94 name=__codelineno-18-94 href=#__codelineno-18-94></a><span class=s>net.ipv4.tcp_wmem = 4096        16384   4194304</span>
<a id=__codelineno-18-95 name=__codelineno-18-95 href=#__codelineno-18-95></a><span class=s>net.core.wmem_default = 8388608</span>
<a id=__codelineno-18-96 name=__codelineno-18-96 href=#__codelineno-18-96></a><span class=s>net.core.rmem_default = 8388608</span>
<a id=__codelineno-18-97 name=__codelineno-18-97 href=#__codelineno-18-97></a><span class=s>net.core.rmem_max = 16777216</span>
<a id=__codelineno-18-98 name=__codelineno-18-98 href=#__codelineno-18-98></a><span class=s>net.core.wmem_max = 16777216</span>
<a id=__codelineno-18-99 name=__codelineno-18-99 href=#__codelineno-18-99></a><span class=s>#每个网络接口接收数据包的速率比内核处理这些包的速率快时，允许送到队列的数据包的最大数目</span>
<a id=__codelineno-18-100 name=__codelineno-18-100 href=#__codelineno-18-100></a><span class=s>net.core.netdev_max_backlog = 262144</span>
<a id=__codelineno-18-101 name=__codelineno-18-101 href=#__codelineno-18-101></a><span class=s>#限制仅仅是为了防止简单的DoS 攻击</span>
<a id=__codelineno-18-102 name=__codelineno-18-102 href=#__codelineno-18-102></a><span class=s>net.ipv4.tcp_max_orphans = 3276800</span>
<a id=__codelineno-18-103 name=__codelineno-18-103 href=#__codelineno-18-103></a><span class=s>#未收到客户端确认信息的连接请求的最大值</span>
<a id=__codelineno-18-104 name=__codelineno-18-104 href=#__codelineno-18-104></a><span class=s>net.ipv4.tcp_max_syn_backlog = 262144</span>
<a id=__codelineno-18-105 name=__codelineno-18-105 href=#__codelineno-18-105></a><span class=s>net.ipv4.tcp_timestamps = 0</span>
<a id=__codelineno-18-106 name=__codelineno-18-106 href=#__codelineno-18-106></a><span class=s>#内核放弃建立连接之前发送SYNACK 包的数量</span>
<a id=__codelineno-18-107 name=__codelineno-18-107 href=#__codelineno-18-107></a><span class=s>net.ipv4.tcp_synack_retries = 1</span>
<a id=__codelineno-18-108 name=__codelineno-18-108 href=#__codelineno-18-108></a><span class=s>#内核放弃建立连接之前发送SYN 包的数量</span>
<a id=__codelineno-18-109 name=__codelineno-18-109 href=#__codelineno-18-109></a><span class=s>net.ipv4.tcp_syn_retries = 1</span>
<a id=__codelineno-18-110 name=__codelineno-18-110 href=#__codelineno-18-110></a><span class=s>#启用timewait 快速回收</span>
<a id=__codelineno-18-111 name=__codelineno-18-111 href=#__codelineno-18-111></a><span class=s>net.ipv4.tcp_tw_recycle = 0</span>
<a id=__codelineno-18-112 name=__codelineno-18-112 href=#__codelineno-18-112></a><span class=s>#开启重用。允许将TIME-WAIT sockets 重新用于新的TCP 连接</span>
<a id=__codelineno-18-113 name=__codelineno-18-113 href=#__codelineno-18-113></a><span class=s>net.ipv4.tcp_tw_reuse = 1</span>
<a id=__codelineno-18-114 name=__codelineno-18-114 href=#__codelineno-18-114></a><span class=s>net.ipv4.tcp_mem = 94500000 915000000 927000000</span>
<a id=__codelineno-18-115 name=__codelineno-18-115 href=#__codelineno-18-115></a><span class=s>net.ipv4.tcp_fin_timeout = 1</span>
<a id=__codelineno-18-116 name=__codelineno-18-116 href=#__codelineno-18-116></a><span class=s>#当keepalive 起用的时候，TCP 发送keepalive 消息的频度。缺省是2 小时</span>
<a id=__codelineno-18-117 name=__codelineno-18-117 href=#__codelineno-18-117></a><span class=s>net.ipv4.tcp_keepalive_time = 1800</span>
<a id=__codelineno-18-118 name=__codelineno-18-118 href=#__codelineno-18-118></a><span class=s>net.ipv4.tcp_keepalive_probes = 3</span>
<a id=__codelineno-18-119 name=__codelineno-18-119 href=#__codelineno-18-119></a><span class=s>net.ipv4.tcp_keepalive_intvl = 15</span>
<a id=__codelineno-18-120 name=__codelineno-18-120 href=#__codelineno-18-120></a><span class=s>#允许系统打开的端口范围</span>
<a id=__codelineno-18-121 name=__codelineno-18-121 href=#__codelineno-18-121></a><span class=s>net.ipv4.ip_local_port_range = 1024    65000</span>
<a id=__codelineno-18-122 name=__codelineno-18-122 href=#__codelineno-18-122></a><span class=s>#修改防火墙表大小，默认65536</span>
<a id=__codelineno-18-123 name=__codelineno-18-123 href=#__codelineno-18-123></a><span class=s>net.netfilter.nf_conntrack_max=655350</span>
<a id=__codelineno-18-124 name=__codelineno-18-124 href=#__codelineno-18-124></a><span class=s>net.netfilter.nf_conntrack_tcp_timeout_established=1200</span>
<a id=__codelineno-18-125 name=__codelineno-18-125 href=#__codelineno-18-125></a><span class=s># 确保无人能修改路由表</span>
<a id=__codelineno-18-126 name=__codelineno-18-126 href=#__codelineno-18-126></a><span class=s>net.ipv4.conf.all.accept_redirects = 0</span>
<a id=__codelineno-18-127 name=__codelineno-18-127 href=#__codelineno-18-127></a><span class=s>net.ipv4.conf.default.accept_redirects = 0</span>
<a id=__codelineno-18-128 name=__codelineno-18-128 href=#__codelineno-18-128></a><span class=s>net.ipv4.conf.all.secure_redirects = 0</span>
<a id=__codelineno-18-129 name=__codelineno-18-129 href=#__codelineno-18-129></a><span class=s>net.ipv4.conf.default.secure_redirects = 0</span>
<a id=__codelineno-18-130 name=__codelineno-18-130 href=#__codelineno-18-130></a><span class=s>EOF</span>
<a id=__codelineno-18-131 name=__codelineno-18-131 href=#__codelineno-18-131></a>/sbin/sysctl<span class=w> </span>-p
<a id=__codelineno-18-132 name=__codelineno-18-132 href=#__codelineno-18-132></a><span class=c1>#vim定义退格键可删除最后一个字符类型</span>
<a id=__codelineno-18-133 name=__codelineno-18-133 href=#__codelineno-18-133></a><span class=nb>echo</span><span class=w> </span><span class=s1>&#39;alias vi=vim&#39;</span><span class=w> </span>&gt;&gt;<span class=w> </span>/etc/profile
<a id=__codelineno-18-134 name=__codelineno-18-134 href=#__codelineno-18-134></a><span class=nb>echo</span><span class=w> </span><span class=s1>&#39;stty erase ^H&#39;</span><span class=w> </span>&gt;&gt;<span class=w> </span>/etc/profile
<a id=__codelineno-18-135 name=__codelineno-18-135 href=#__codelineno-18-135></a><span class=nb>echo</span><span class=w> </span><span class=s1>&#39;curl ip.6655.com/ip.aspx&amp;&amp;echo&#39;</span><span class=w> </span>&gt;&gt;<span class=w> </span>/etc/profile
<a id=__codelineno-18-136 name=__codelineno-18-136 href=#__codelineno-18-136></a>cat<span class=w> </span>&gt;&gt;<span class=w> </span>/root/.vimrc<span class=w> </span><span class=s>&lt;&lt; EOF</span>
<a id=__codelineno-18-137 name=__codelineno-18-137 href=#__codelineno-18-137></a><span class=s>set tabstop=4</span>
<a id=__codelineno-18-138 name=__codelineno-18-138 href=#__codelineno-18-138></a><span class=s>set shiftwidth=4</span>
<a id=__codelineno-18-139 name=__codelineno-18-139 href=#__codelineno-18-139></a><span class=s>set expandtab</span>
<a id=__codelineno-18-140 name=__codelineno-18-140 href=#__codelineno-18-140></a><span class=s>syntax on</span>
<a id=__codelineno-18-141 name=__codelineno-18-141 href=#__codelineno-18-141></a><span class=s>&quot;set number</span>
<a id=__codelineno-18-142 name=__codelineno-18-142 href=#__codelineno-18-142></a><span class=s>EOF</span>
<a id=__codelineno-18-143 name=__codelineno-18-143 href=#__codelineno-18-143></a><span class=c1>#update soft</span>
<a id=__codelineno-18-144 name=__codelineno-18-144 href=#__codelineno-18-144></a>yum<span class=w> </span>-y<span class=w> </span>update
<a id=__codelineno-18-145 name=__codelineno-18-145 href=#__codelineno-18-145></a>cat<span class=w> </span><span class=s>&lt;&lt; EOF</span>
<a id=__codelineno-18-146 name=__codelineno-18-146 href=#__codelineno-18-146></a><span class=s>+-------------------------------------------------+</span>
<a id=__codelineno-18-147 name=__codelineno-18-147 href=#__codelineno-18-147></a><span class=s>|                优 化 已 完 成             |</span>
<a id=__codelineno-18-148 name=__codelineno-18-148 href=#__codelineno-18-148></a><span class=s>|             5s 后 重启 这台服务器 !       |</span>
<a id=__codelineno-18-149 name=__codelineno-18-149 href=#__codelineno-18-149></a><span class=s>+-------------------------------------------------+</span>
<a id=__codelineno-18-150 name=__codelineno-18-150 href=#__codelineno-18-150></a><span class=s>EOF</span>
<a id=__codelineno-18-151 name=__codelineno-18-151 href=#__codelineno-18-151></a>sleep<span class=w> </span><span class=m>5</span>
<a id=__codelineno-18-152 name=__codelineno-18-152 href=#__codelineno-18-152></a><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;\n\033[31m请重启机器 使内核修改生效！！！\033[0m\n&quot;</span><span class=w>  </span><span class=c1>##重启加载内核修改</span>
</code></pre></div> <h3 id=控制shell多进程数量的脚本>控制shell多进程数量的脚本<a class=headerlink href=#控制shell多进程数量的脚本 title="Permanent link">&para;</a></h3> <p>下面的run.py是爬虫程序，经测试，在机器上运行8个run.py进程是机器性能最好的时候，该进程数量既能充分发挥机器的性能又不会导致机器响度速度过慢。</p> <p>而且有时为了避免并发进程数过多导致机器卡死，<strong>需要限制并发的数量</strong>。下面的脚本可以实现这个需求，其代码如下所示：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a><span class=ch>#!/usr/bin/env bash</span>
<a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a><span class=c1>#usage:xxx</span>
<a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a><span class=c1>#scripts_name:${NAME}.sh</span>
<a id=__codelineno-19-4 name=__codelineno-19-4 href=#__codelineno-19-4></a><span class=c1># author：xiaojian</span>
<a id=__codelineno-19-5 name=__codelineno-19-5 href=#__codelineno-19-5></a>
<a id=__codelineno-19-6 name=__codelineno-19-6 href=#__codelineno-19-6></a><span class=nv>CE_HOME</span><span class=o>=</span><span class=s2>&quot;/data/ContentEnginne&quot;</span>
<a id=__codelineno-19-7 name=__codelineno-19-7 href=#__codelineno-19-7></a><span class=nv>LOG_PATH</span><span class=o>=</span><span class=s2>&quot;/data/logs&quot;</span>
<a id=__codelineno-19-8 name=__codelineno-19-8 href=#__codelineno-19-8></a>
<a id=__codelineno-19-9 name=__codelineno-19-9 href=#__codelineno-19-9></a><span class=c1># 控制爬虫数量为8</span>
<a id=__codelineno-19-10 name=__codelineno-19-10 href=#__codelineno-19-10></a><span class=nv>MAX_SPIDER_COUNT</span><span class=o>=</span><span class=m>8</span>
<a id=__codelineno-19-11 name=__codelineno-19-11 href=#__codelineno-19-11></a>
<a id=__codelineno-19-12 name=__codelineno-19-12 href=#__codelineno-19-12></a><span class=nv>count</span><span class=o>=</span><span class=sb>`</span>ps<span class=w> </span>-ef<span class=p>|</span>grep<span class=w> </span>-v<span class=w> </span>grep<span class=p>|</span>grep<span class=w> </span>run.py<span class=p>|</span>wc<span class=w> </span>-l<span class=sb>`</span>
<a id=__codelineno-19-13 name=__codelineno-19-13 href=#__codelineno-19-13></a><span class=nv>try_time</span><span class=o>=</span><span class=m>0</span>
<a id=__codelineno-19-14 name=__codelineno-19-14 href=#__codelineno-19-14></a>
<a id=__codelineno-19-15 name=__codelineno-19-15 href=#__codelineno-19-15></a><span class=nb>cd</span><span class=w> </span><span class=nv>$CE_HOME</span>
<a id=__codelineno-19-16 name=__codelineno-19-16 href=#__codelineno-19-16></a>
<a id=__codelineno-19-17 name=__codelineno-19-17 href=#__codelineno-19-17></a><span class=c1># 限制并发的数量</span>
<a id=__codelineno-19-18 name=__codelineno-19-18 href=#__codelineno-19-18></a><span class=k>while</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=nv>$count</span><span class=w> </span>-lt<span class=w> </span><span class=nv>$MAX_SPIDER_COUNT</span><span class=w> </span>-a<span class=w> </span><span class=nv>$try_time</span><span class=w> </span>-lt<span class=w> </span><span class=nv>$MAX_SPIDER_COUNT</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>do</span>
<a id=__codelineno-19-19 name=__codelineno-19-19 href=#__codelineno-19-19></a><span class=w>    </span><span class=nb>let</span><span class=w> </span><span class=nv>try_time</span><span class=w> </span><span class=o>+=</span><span class=m>1</span>
<a id=__codelineno-19-20 name=__codelineno-19-20 href=#__codelineno-19-20></a><span class=w>    </span>python<span class=w> </span>run.py<span class=w> </span>&gt;&gt;<span class=w> </span><span class=si>${</span><span class=nv>LOG_PATH</span><span class=si>}</span>/spider.log<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span><span class=w> </span><span class=p>&amp;</span>
<a id=__codelineno-19-21 name=__codelineno-19-21 href=#__codelineno-19-21></a><span class=w>    </span><span class=nv>count</span><span class=o>=</span><span class=sb>`</span>ps<span class=w> </span>-ef<span class=p>|</span>grep<span class=w> </span>-v<span class=w> </span>grep<span class=p>|</span>grep<span class=w> </span>run.py<span class=p>|</span>wc<span class=w> </span>-l<span class=sb>`</span>
<a id=__codelineno-19-22 name=__codelineno-19-22 href=#__codelineno-19-22></a><span class=k>done</span>
</code></pre></div> <h3 id=手动建立软raid级别需求>手动建立软Raid级别需求<a class=headerlink href=#手动建立软raid级别需求 title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a><span class=k>function</span><span class=w> </span>rg_mkfs_interac<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-20-3 name=__codelineno-20-3 href=#__codelineno-20-3></a><span class=w>    </span><span class=nb>read</span><span class=w> </span>-p<span class=w> </span><span class=s2>&quot;请输入您要做的RAID级别，可选择项为0|1|5|10:&quot;</span><span class=w> </span>raid
<a id=__codelineno-20-4 name=__codelineno-20-4 href=#__codelineno-20-4></a><span class=w>    </span><span class=nb>read</span><span class=w> </span>-p<span class=w> </span><span class=s2>&quot;请输入哪些磁盘需要并进RAID，磁盘之间请用空格格开，例如sdb sdc等&quot;</span><span class=w> </span>mydev
<a id=__codelineno-20-5 name=__codelineno-20-5 href=#__codelineno-20-5></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=nv>$raid</span>
<a id=__codelineno-20-6 name=__codelineno-20-6 href=#__codelineno-20-6></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=nv>$mydev</span>
<a id=__codelineno-20-7 name=__codelineno-20-7 href=#__codelineno-20-7></a><span class=w>    </span><span class=c1># create md0</span>
<a id=__codelineno-20-8 name=__codelineno-20-8 href=#__codelineno-20-8></a><span class=w>        </span>rg_info<span class=w> </span><span class=s2>&quot;Create RAID...&quot;</span>
<a id=__codelineno-20-9 name=__codelineno-20-9 href=#__codelineno-20-9></a><span class=w>        </span>mdadm<span class=w> </span>-Ss
<a id=__codelineno-20-10 name=__codelineno-20-10 href=#__codelineno-20-10></a><span class=w>        </span>yes<span class=w> </span><span class=p>|</span><span class=w> </span>mdadm<span class=w> </span>-C<span class=w> </span>/dev/md0<span class=w> </span>--level<span class=o>=</span><span class=nv>$raid</span><span class=w> </span>--auto<span class=o>=</span>yes<span class=w> </span><span class=nv>$mydev</span><span class=w> </span>&gt;/dev/null
<a id=__codelineno-20-11 name=__codelineno-20-11 href=#__codelineno-20-11></a><span class=w>        </span>mdadm<span class=w> </span>-D<span class=w> </span>/dev/md0<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=o>||</span><span class=w> </span>rg_info<span class=w> </span><span class=m>58</span><span class=w> </span><span class=s2>&quot;Create RAID /dev/md0 failed.&quot;</span>
<a id=__codelineno-20-12 name=__codelineno-20-12 href=#__codelineno-20-12></a><span class=w>            </span><span class=c1># public</span>
<a id=__codelineno-20-13 name=__codelineno-20-13 href=#__codelineno-20-13></a><span class=w>            </span>partprobe<span class=w> </span>/dev/<span class=nv>$DISK_SYS</span><span class=w> </span><span class=m>2</span>&gt;/dev/null
<a id=__codelineno-20-14 name=__codelineno-20-14 href=#__codelineno-20-14></a><span class=w>            </span>sleep<span class=w> </span><span class=m>3</span>
<a id=__codelineno-20-15 name=__codelineno-20-15 href=#__codelineno-20-15></a><span class=w>            </span><span class=c1># mkfs</span>
<a id=__codelineno-20-16 name=__codelineno-20-16 href=#__codelineno-20-16></a><span class=w>            </span><span class=k>for</span><span class=w> </span>i<span class=w> </span><span class=k>in</span><span class=w> </span><span class=o>{</span><span class=si>${</span><span class=nv>DISK_SYS</span><span class=si>}</span><span class=m>4</span>,md0<span class=o>}</span><span class=p>;</span><span class=w> </span><span class=k>do</span>
<a id=__codelineno-20-17 name=__codelineno-20-17 href=#__codelineno-20-17></a><span class=w>                </span><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=nv>$MKFS</span><span class=s2> /dev/</span><span class=nv>$i</span><span class=s2>... &quot;</span>
<a id=__codelineno-20-18 name=__codelineno-20-18 href=#__codelineno-20-18></a><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=nv>$MKFS</span><span class=w> </span>/dev/<span class=nv>$i</span><span class=w> </span><span class=p>&amp;</span>&gt;/dev/null<span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-20-19 name=__codelineno-20-19 href=#__codelineno-20-19></a><span class=w>                </span><span class=nb>echo</span><span class=w> </span>OK
<a id=__codelineno-20-20 name=__codelineno-20-20 href=#__codelineno-20-20></a><span class=w>                </span><span class=k>else</span>
<a id=__codelineno-20-21 name=__codelineno-20-21 href=#__codelineno-20-21></a><span class=w>                </span><span class=nb>echo</span><span class=w> </span>failed<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>rg_info<span class=w> </span><span class=m>55</span><span class=w> </span><span class=s2>&quot;mkfs </span><span class=nv>$i</span><span class=s2> failed&quot;</span>
<a id=__codelineno-20-22 name=__codelineno-20-22 href=#__codelineno-20-22></a><span class=w>                </span><span class=k>fi</span>
<a id=__codelineno-20-23 name=__codelineno-20-23 href=#__codelineno-20-23></a><span class=w>            </span><span class=k>done</span>
<a id=__codelineno-20-24 name=__codelineno-20-24 href=#__codelineno-20-24></a><span class=w>            </span>rg_info<span class=w> </span><span class=s2>&quot;Create cache direcotry...&quot;</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>mkdir<span class=w> </span>-p<span class=w> </span>/cache/<span class=o>{</span>cache,logs<span class=o>}</span>
<a id=__codelineno-20-25 name=__codelineno-20-25 href=#__codelineno-20-25></a><span class=w>            </span><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;/dev/</span><span class=si>${</span><span class=nv>DISK_SYS</span><span class=si>}</span><span class=s2>4 \t\t/cache/logs \t\t</span><span class=nv>$FS</span><span class=s2> \tdefaults \t0 0&quot;</span><span class=w> </span>&gt;&gt;/etc/fstab
<a id=__codelineno-20-26 name=__codelineno-20-26 href=#__codelineno-20-26></a><span class=w>            </span><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;/dev/md0 \t\t/cache/cache \t\t</span><span class=nv>$FS</span><span class=s2> \t</span><span class=nv>$MOUNT_OPTS</span><span class=s2> \t0 0&quot;</span><span class=w> </span>&gt;&gt;/etc/fstab
<a id=__codelineno-20-27 name=__codelineno-20-27 href=#__codelineno-20-27></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;--&quot;</span>
<a id=__codelineno-20-28 name=__codelineno-20-28 href=#__codelineno-20-28></a><span class=c1>#save mdadm.conf</span>
<a id=__codelineno-20-29 name=__codelineno-20-29 href=#__codelineno-20-29></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=o>(</span>mdadm<span class=w> </span>-Ds<span class=w> </span><span class=m>2</span>&gt;/dev/null<span class=w> </span><span class=p>|</span>grep<span class=w> </span>-q<span class=w> </span>.<span class=o>)</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-20-30 name=__codelineno-20-30 href=#__codelineno-20-30></a><span class=w>            </span><span class=o>[</span><span class=w> </span>-f<span class=w> </span>/etc/mdadm.conf<span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>rg_info<span class=w> </span><span class=s2>&quot;Backup old mdadm.conf...&quot;</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>/bin/cp<span class=w> </span>/etc/mdadm.conf<span class=w> </span>/etc/mdadm.conf.bak
<a id=__codelineno-20-31 name=__codelineno-20-31 href=#__codelineno-20-31></a><span class=w>            </span>rg_info<span class=w> </span><span class=s2>&quot;Save RAID configration (mdadm.conf)...&quot;</span>
<a id=__codelineno-20-32 name=__codelineno-20-32 href=#__codelineno-20-32></a><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$VER6</span><span class=s2>&quot;</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s1>&#39;yes&#39;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-20-33 name=__codelineno-20-33 href=#__codelineno-20-33></a><span class=w>                    </span>mdadm<span class=w> </span>-Ds<span class=w> </span><span class=p>|</span>sed<span class=w> </span><span class=s1>&#39;s!/dev/md[^ ]*:\([0-9]\)!/dev/md\1!; s!metadata[^ ]* !!; s/$/ auto=yes/&#39;</span><span class=w> </span>&gt;/etc/mdadm.conf
<a id=__codelineno-20-34 name=__codelineno-20-34 href=#__codelineno-20-34></a><span class=w>                </span><span class=k>else</span>
<a id=__codelineno-20-35 name=__codelineno-20-35 href=#__codelineno-20-35></a><span class=w>                    </span>mdadm<span class=w> </span>-Ds<span class=w> </span><span class=p>|</span>sed<span class=w> </span><span class=s1>&#39;s/$/ auto=yes/&#39;</span><span class=w> </span>&gt;/etc/mdadm.conf
<a id=__codelineno-20-36 name=__codelineno-20-36 href=#__codelineno-20-36></a><span class=w>                </span><span class=k>fi</span>
<a id=__codelineno-20-37 name=__codelineno-20-37 href=#__codelineno-20-37></a><span class=w>        </span><span class=k>fi</span>
<a id=__codelineno-20-38 name=__codelineno-20-38 href=#__codelineno-20-38></a><span class=c1>#mount all</span>
<a id=__codelineno-20-39 name=__codelineno-20-39 href=#__codelineno-20-39></a><span class=w>        </span>fgrep<span class=w> </span>-q<span class=w> </span>/cache<span class=w> </span>/etc/fstab<span class=w> </span><span class=o>||</span><span class=w> </span>rg_info<span class=w> </span><span class=m>48</span><span class=w> </span><span class=s2>&quot;Internal error: f_mkfs has BUG!&quot;</span>
<a id=__codelineno-20-40 name=__codelineno-20-40 href=#__codelineno-20-40></a><span class=w>        </span>rg_info<span class=w> </span><span class=s2>&quot;挂载所有分区...&quot;</span>
<a id=__codelineno-20-41 name=__codelineno-20-41 href=#__codelineno-20-41></a><span class=w>        </span><span class=k>if</span><span class=w> </span>mount<span class=w> </span>-a<span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-20-42 name=__codelineno-20-42 href=#__codelineno-20-42></a><span class=w>            </span>rg_info<span class=w> </span><span class=s2>&quot;创建mkpart锁...&quot;</span>
<a id=__codelineno-20-43 name=__codelineno-20-43 href=#__codelineno-20-43></a><span class=w>            </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$VERSION</span><span class=s2>&quot;</span><span class=w> </span>&gt;<span class=nv>$MKFS_LOCK</span><span class=w> </span><span class=m>2</span>&gt;/dev/null<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>chattr<span class=w> </span>+i<span class=w> </span><span class=nv>$MKFS_LOCK</span>
<a id=__codelineno-20-44 name=__codelineno-20-44 href=#__codelineno-20-44></a><span class=w>            </span><span class=nv>ret</span><span class=o>=</span><span class=m>0</span>
<a id=__codelineno-20-45 name=__codelineno-20-45 href=#__codelineno-20-45></a><span class=w>        </span><span class=k>else</span>
<a id=__codelineno-20-46 name=__codelineno-20-46 href=#__codelineno-20-46></a><span class=w>            </span>rg_info<span class=w> </span><span class=m>49</span><span class=w> </span><span class=s2>&quot;mount -a 出错&quot;</span>
<a id=__codelineno-20-47 name=__codelineno-20-47 href=#__codelineno-20-47></a><span class=w>        </span><span class=k>fi</span>
<a id=__codelineno-20-48 name=__codelineno-20-48 href=#__codelineno-20-48></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nv>$ret</span>
<a id=__codelineno-20-49 name=__codelineno-20-49 href=#__codelineno-20-49></a><span class=o>}</span>
</code></pre></div> <h3 id=在脚本中修改crontab>在脚本中修改crontab<a class=headerlink href=#在脚本中修改crontab title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a><span class=o>(</span>crontab<span class=w> </span>-l<span class=w> </span><span class=m>2</span>&gt;/dev/null<span class=p>;</span><span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s1>&#39;*/2 * * * * bash /usr/local/src/kestrel.openfiles.check &gt; /usr/local/src/logs/kestrel_openfiles.check.$(date &quot;+\%Y\%m\%d-\%H\%M\%S&quot;).details 2&gt;&amp;1&#39;</span><span class=o>)</span><span class=w> </span><span class=p>|</span><span class=w> </span>crontab<span class=w> </span>-
</code></pre></div> <h3 id=字符串处理完整脚本>字符串处理完整脚本<a class=headerlink href=#字符串处理完整脚本 title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a>
<a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a><span class=nv>string</span><span class=o>=</span><span class=s2>&quot;Bigdata process framework is Hadoop,Hadoop is an open source project&quot;</span>
<a id=__codelineno-22-4 name=__codelineno-22-4 href=#__codelineno-22-4></a>
<a id=__codelineno-22-5 name=__codelineno-22-5 href=#__codelineno-22-5></a><span class=k>function</span><span class=w> </span>print_tips
<a id=__codelineno-22-6 name=__codelineno-22-6 href=#__codelineno-22-6></a><span class=o>{</span>
<a id=__codelineno-22-7 name=__codelineno-22-7 href=#__codelineno-22-7></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;******************************&quot;</span>
<a id=__codelineno-22-8 name=__codelineno-22-8 href=#__codelineno-22-8></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;(1)打印string长度&quot;</span>
<a id=__codelineno-22-9 name=__codelineno-22-9 href=#__codelineno-22-9></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;(2)删除字符串中所有的Hadoop&quot;</span>
<a id=__codelineno-22-10 name=__codelineno-22-10 href=#__codelineno-22-10></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;(3)替换第一个Hadoop为Mapreduce&quot;</span>
<a id=__codelineno-22-11 name=__codelineno-22-11 href=#__codelineno-22-11></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;(4)替换全部Hadoop为Mapreduce&quot;</span>
<a id=__codelineno-22-12 name=__codelineno-22-12 href=#__codelineno-22-12></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;*******************************&quot;</span>
<a id=__codelineno-22-13 name=__codelineno-22-13 href=#__codelineno-22-13></a><span class=o>}</span>
<a id=__codelineno-22-14 name=__codelineno-22-14 href=#__codelineno-22-14></a>
<a id=__codelineno-22-15 name=__codelineno-22-15 href=#__codelineno-22-15></a><span class=k>function</span><span class=w> </span>len_of_string
<a id=__codelineno-22-16 name=__codelineno-22-16 href=#__codelineno-22-16></a><span class=o>{</span>
<a id=__codelineno-22-17 name=__codelineno-22-17 href=#__codelineno-22-17></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;</span><span class=si>${#</span><span class=nv>string</span><span class=si>}</span><span class=s2>&quot;</span>
<a id=__codelineno-22-18 name=__codelineno-22-18 href=#__codelineno-22-18></a><span class=o>}</span>
<a id=__codelineno-22-19 name=__codelineno-22-19 href=#__codelineno-22-19></a>
<a id=__codelineno-22-20 name=__codelineno-22-20 href=#__codelineno-22-20></a><span class=k>function</span><span class=w> </span>del_hadoop
<a id=__codelineno-22-21 name=__codelineno-22-21 href=#__codelineno-22-21></a><span class=o>{</span>
<a id=__codelineno-22-22 name=__codelineno-22-22 href=#__codelineno-22-22></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>string</span><span class=p>//Hadoop/</span><span class=si>}</span><span class=s2>&quot;</span>
<a id=__codelineno-22-23 name=__codelineno-22-23 href=#__codelineno-22-23></a><span class=o>}</span>
<a id=__codelineno-22-24 name=__codelineno-22-24 href=#__codelineno-22-24></a>
<a id=__codelineno-22-25 name=__codelineno-22-25 href=#__codelineno-22-25></a><span class=k>function</span><span class=w> </span>rep_hadoop_mapreduce_first
<a id=__codelineno-22-26 name=__codelineno-22-26 href=#__codelineno-22-26></a><span class=o>{</span>
<a id=__codelineno-22-27 name=__codelineno-22-27 href=#__codelineno-22-27></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>string</span><span class=p>/Hadoop/Mapreduce</span><span class=si>}</span><span class=s2>&quot;</span>
<a id=__codelineno-22-28 name=__codelineno-22-28 href=#__codelineno-22-28></a><span class=o>}</span>
<a id=__codelineno-22-29 name=__codelineno-22-29 href=#__codelineno-22-29></a>
<a id=__codelineno-22-30 name=__codelineno-22-30 href=#__codelineno-22-30></a><span class=k>function</span><span class=w> </span>rep_hadoop_mapreduce_all
<a id=__codelineno-22-31 name=__codelineno-22-31 href=#__codelineno-22-31></a><span class=o>{</span>
<a id=__codelineno-22-32 name=__codelineno-22-32 href=#__codelineno-22-32></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>string</span><span class=p>//Hadoop/Mapreduce</span><span class=si>}</span><span class=s2>&quot;</span>
<a id=__codelineno-22-33 name=__codelineno-22-33 href=#__codelineno-22-33></a><span class=o>}</span>
<a id=__codelineno-22-34 name=__codelineno-22-34 href=#__codelineno-22-34></a>
<a id=__codelineno-22-35 name=__codelineno-22-35 href=#__codelineno-22-35></a><span class=k>while</span><span class=w> </span><span class=nb>true</span>
<a id=__codelineno-22-36 name=__codelineno-22-36 href=#__codelineno-22-36></a><span class=k>do</span>
<a id=__codelineno-22-37 name=__codelineno-22-37 href=#__codelineno-22-37></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;[string=</span><span class=nv>$string</span><span class=s2>]&quot;</span>
<a id=__codelineno-22-38 name=__codelineno-22-38 href=#__codelineno-22-38></a><span class=w>    </span><span class=nb>echo</span>
<a id=__codelineno-22-39 name=__codelineno-22-39 href=#__codelineno-22-39></a><span class=w>    </span>print_tips
<a id=__codelineno-22-40 name=__codelineno-22-40 href=#__codelineno-22-40></a><span class=w>    </span><span class=nb>read</span><span class=w> </span>-p<span class=w> </span><span class=s2>&quot;Pls input your choice(1|2|3|4|q|Q): &quot;</span><span class=w> </span>choice
<a id=__codelineno-22-41 name=__codelineno-22-41 href=#__codelineno-22-41></a>
<a id=__codelineno-22-42 name=__codelineno-22-42 href=#__codelineno-22-42></a><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=nv>$choice</span><span class=w> </span><span class=k>in</span>
<a id=__codelineno-22-43 name=__codelineno-22-43 href=#__codelineno-22-43></a><span class=w>        </span><span class=m>1</span><span class=o>)</span>
<a id=__codelineno-22-44 name=__codelineno-22-44 href=#__codelineno-22-44></a><span class=w>            </span>len_of_string
<a id=__codelineno-22-45 name=__codelineno-22-45 href=#__codelineno-22-45></a><span class=w>            </span><span class=p>;;</span>
<a id=__codelineno-22-46 name=__codelineno-22-46 href=#__codelineno-22-46></a><span class=w>        </span><span class=m>2</span><span class=o>)</span>
<a id=__codelineno-22-47 name=__codelineno-22-47 href=#__codelineno-22-47></a><span class=w>            </span>del_hadoop
<a id=__codelineno-22-48 name=__codelineno-22-48 href=#__codelineno-22-48></a><span class=w>            </span><span class=p>;;</span>
<a id=__codelineno-22-49 name=__codelineno-22-49 href=#__codelineno-22-49></a><span class=w>        </span><span class=m>3</span><span class=o>)</span>
<a id=__codelineno-22-50 name=__codelineno-22-50 href=#__codelineno-22-50></a><span class=w>            </span>rep_hadoop_mapreduce_first
<a id=__codelineno-22-51 name=__codelineno-22-51 href=#__codelineno-22-51></a><span class=w>            </span><span class=p>;;</span>
<a id=__codelineno-22-52 name=__codelineno-22-52 href=#__codelineno-22-52></a><span class=w>        </span><span class=m>4</span><span class=o>)</span>
<a id=__codelineno-22-53 name=__codelineno-22-53 href=#__codelineno-22-53></a><span class=w>            </span>rep_hadoop_mapreduce_all
<a id=__codelineno-22-54 name=__codelineno-22-54 href=#__codelineno-22-54></a><span class=w>            </span><span class=p>;;</span>
<a id=__codelineno-22-55 name=__codelineno-22-55 href=#__codelineno-22-55></a><span class=w>        </span>q<span class=p>|</span>Q<span class=o>)</span>
<a id=__codelineno-22-56 name=__codelineno-22-56 href=#__codelineno-22-56></a><span class=w>            </span><span class=nb>exit</span>
<a id=__codelineno-22-57 name=__codelineno-22-57 href=#__codelineno-22-57></a><span class=w>            </span><span class=p>;;</span>
<a id=__codelineno-22-58 name=__codelineno-22-58 href=#__codelineno-22-58></a><span class=w>        </span>*<span class=o>)</span>
<a id=__codelineno-22-59 name=__codelineno-22-59 href=#__codelineno-22-59></a><span class=w>            </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Error,input only in {1|2|3|4|q|Q|}&quot;</span>
<a id=__codelineno-22-60 name=__codelineno-22-60 href=#__codelineno-22-60></a><span class=w>            </span><span class=p>;;</span>
<a id=__codelineno-22-61 name=__codelineno-22-61 href=#__codelineno-22-61></a><span class=w>    </span><span class=k>esac</span>
<a id=__codelineno-22-62 name=__codelineno-22-62 href=#__codelineno-22-62></a><span class=k>done</span>
</code></pre></div> <h3 id=设置锁文件防止脚本重复执行>设置锁文件防止脚本重复执行<a class=headerlink href=#设置锁文件防止脚本重复执行 title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a><span class=c1>#功能描述(Description):通过设置锁文件防止脚本重复执行.</span>
<a id=__codelineno-23-3 name=__codelineno-23-3 href=#__codelineno-23-3></a>
<a id=__codelineno-23-4 name=__codelineno-23-4 href=#__codelineno-23-4></a><span class=c1>#使用Ctrl+C中断脚本时,删除锁文件.</span>
<a id=__codelineno-23-5 name=__codelineno-23-5 href=#__codelineno-23-5></a><span class=nb>trap</span><span class=w> </span><span class=s1>&#39;rm -rf /tmp/lockfile;exit&#39;</span><span class=w> </span>HUP<span class=w> </span>INT
<a id=__codelineno-23-6 name=__codelineno-23-6 href=#__codelineno-23-6></a>
<a id=__codelineno-23-7 name=__codelineno-23-7 href=#__codelineno-23-7></a><span class=c1>#检查是否存在锁文件,没有锁文件就执行backup备份函数,如果有锁文件脚本则脚本直接退出.</span>
<a id=__codelineno-23-8 name=__codelineno-23-8 href=#__codelineno-23-8></a>lock_check<span class=o>(){</span>
<a id=__codelineno-23-9 name=__codelineno-23-9 href=#__codelineno-23-9></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>(</span><span class=nb>set</span><span class=w> </span>-C<span class=p>;</span><span class=w> </span>:&gt;<span class=w> </span>/tmp/lockfile<span class=o>)</span><span class=w> </span><span class=m>2</span>&gt;/dev/null<span class=w> </span><span class=p>;</span><span class=k>then</span>
<a id=__codelineno-23-10 name=__codelineno-23-10 href=#__codelineno-23-10></a><span class=w>        </span>backup
<a id=__codelineno-23-11 name=__codelineno-23-11 href=#__codelineno-23-11></a><span class=w>    </span><span class=k>else</span>
<a id=__codelineno-23-12 name=__codelineno-23-12 href=#__codelineno-23-12></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;\033[91mWarning:其他用户在执行该脚本.\033[0m&quot;</span>
<a id=__codelineno-23-13 name=__codelineno-23-13 href=#__codelineno-23-13></a><span class=w>        </span><span class=nb>exit</span><span class=w> </span><span class=m>66</span>
<a id=__codelineno-23-14 name=__codelineno-23-14 href=#__codelineno-23-14></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-23-15 name=__codelineno-23-15 href=#__codelineno-23-15></a><span class=o>}</span>
<a id=__codelineno-23-16 name=__codelineno-23-16 href=#__codelineno-23-16></a>
<a id=__codelineno-23-17 name=__codelineno-23-17 href=#__codelineno-23-17></a><span class=c1>#执行备份前创建所文件,然后执行备份数据库的操作,备份完成后删除锁文件.</span>
<a id=__codelineno-23-18 name=__codelineno-23-18 href=#__codelineno-23-18></a><span class=c1>#sleep 10实验测试时使用,为了防止小数据库备份太快,无法验证重复执行脚本的效果.</span>
<a id=__codelineno-23-19 name=__codelineno-23-19 href=#__codelineno-23-19></a>backup<span class=o>(){</span>
<a id=__codelineno-23-20 name=__codelineno-23-20 href=#__codelineno-23-20></a><span class=w>    </span>touch<span class=w> </span>/tmp/lockfile
<a id=__codelineno-23-21 name=__codelineno-23-21 href=#__codelineno-23-21></a><span class=w>    </span>mysqldump<span class=w> </span>--all-database<span class=w> </span>&gt;<span class=w> </span>/var/log/mysql-<span class=k>$(</span>date<span class=w> </span>+%Y%m%d<span class=k>)</span>.bak
<a id=__codelineno-23-22 name=__codelineno-23-22 href=#__codelineno-23-22></a><span class=w>    </span>sleep<span class=w> </span><span class=m>10</span>
<a id=__codelineno-23-23 name=__codelineno-23-23 href=#__codelineno-23-23></a><span class=w>    </span>rm<span class=w> </span>-rf<span class=w> </span>/tmp/lockfile
<a id=__codelineno-23-24 name=__codelineno-23-24 href=#__codelineno-23-24></a><span class=o>}</span>
<a id=__codelineno-23-25 name=__codelineno-23-25 href=#__codelineno-23-25></a>
<a id=__codelineno-23-26 name=__codelineno-23-26 href=#__codelineno-23-26></a>lock_check
<a id=__codelineno-23-27 name=__codelineno-23-27 href=#__codelineno-23-27></a>backup
</code></pre></div> <h3 id=修改sshd配置文件>修改sshd配置文件<a class=headerlink href=#修改sshd配置文件 title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a><span class=c1>#功能描述(Description):修改SSHD配置文件,提升SSH安全性.</span>
<a id=__codelineno-24-3 name=__codelineno-24-3 href=#__codelineno-24-3></a>
<a id=__codelineno-24-4 name=__codelineno-24-4 href=#__codelineno-24-4></a><span class=nv>config_file</span><span class=o>=</span><span class=s2>&quot;/etc/ssh/sshd_config&quot;</span>
<a id=__codelineno-24-5 name=__codelineno-24-5 href=#__codelineno-24-5></a><span class=nv>PORT</span><span class=o>=</span><span class=m>12345</span>
<a id=__codelineno-24-6 name=__codelineno-24-6 href=#__codelineno-24-6></a>
<a id=__codelineno-24-7 name=__codelineno-24-7 href=#__codelineno-24-7></a><span class=c1>#将默认端口号修改为自定义端口号.</span>
<a id=__codelineno-24-8 name=__codelineno-24-8 href=#__codelineno-24-8></a><span class=k>if</span><span class=w> </span>grep<span class=w> </span>-q<span class=w> </span><span class=s2>&quot;^Port&quot;</span><span class=w> </span><span class=nv>$config_file</span><span class=p>;</span><span class=k>then</span>
<a id=__codelineno-24-9 name=__codelineno-24-9 href=#__codelineno-24-9></a><span class=w>    </span>sed<span class=w> </span>-i<span class=w> </span><span class=s2>&quot;/^Port/c Port </span><span class=nv>$PORT</span><span class=s2>&quot;</span><span class=w> </span><span class=nv>$config_file</span>
<a id=__codelineno-24-10 name=__codelineno-24-10 href=#__codelineno-24-10></a><span class=k>else</span>
<a id=__codelineno-24-11 name=__codelineno-24-11 href=#__codelineno-24-11></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Port </span><span class=nv>$PORT</span><span class=s2>&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span><span class=nv>$config_file</span>
<a id=__codelineno-24-12 name=__codelineno-24-12 href=#__codelineno-24-12></a><span class=k>fi</span>
<a id=__codelineno-24-13 name=__codelineno-24-13 href=#__codelineno-24-13></a>
<a id=__codelineno-24-14 name=__codelineno-24-14 href=#__codelineno-24-14></a><span class=c1>#禁止root远程登陆SSH服务器.</span>
<a id=__codelineno-24-15 name=__codelineno-24-15 href=#__codelineno-24-15></a><span class=k>if</span><span class=w> </span>grep<span class=w> </span>-q<span class=w> </span><span class=s2>&quot;^PermitRootLogin&quot;</span><span class=w> </span><span class=nv>$config_file</span><span class=p>;</span><span class=k>then</span>
<a id=__codelineno-24-16 name=__codelineno-24-16 href=#__codelineno-24-16></a><span class=w>    </span>sed<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;/^PermitRootLogin/s/yes/no/&#39;</span><span class=w> </span><span class=nv>$config_file</span>
<a id=__codelineno-24-17 name=__codelineno-24-17 href=#__codelineno-24-17></a><span class=k>else</span>
<a id=__codelineno-24-18 name=__codelineno-24-18 href=#__codelineno-24-18></a><span class=w>    </span>sed<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;$a PermitRootLogin no&#39;</span><span class=w> </span><span class=nv>$config_file</span>
<a id=__codelineno-24-19 name=__codelineno-24-19 href=#__codelineno-24-19></a><span class=k>fi</span>
<a id=__codelineno-24-20 name=__codelineno-24-20 href=#__codelineno-24-20></a>
<a id=__codelineno-24-21 name=__codelineno-24-21 href=#__codelineno-24-21></a><span class=c1>#禁止使用密码远程登陆SSH服务器.</span>
<a id=__codelineno-24-22 name=__codelineno-24-22 href=#__codelineno-24-22></a><span class=k>if</span><span class=w> </span>grep<span class=w> </span>-q<span class=w> </span><span class=s2>&quot;^PasswordAuthentication&quot;</span><span class=w> </span><span class=nv>$config_file</span><span class=p>;</span><span class=k>then</span>
<a id=__codelineno-24-23 name=__codelineno-24-23 href=#__codelineno-24-23></a><span class=w>    </span>sed<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;/^PasswordAuthentication/s/yes/no/&#39;</span><span class=w> </span><span class=nv>$config_file</span>
<a id=__codelineno-24-24 name=__codelineno-24-24 href=#__codelineno-24-24></a><span class=k>else</span>
<a id=__codelineno-24-25 name=__codelineno-24-25 href=#__codelineno-24-25></a><span class=w>    </span>sed<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;$a PasswordAuthentication no&#39;</span><span class=w> </span><span class=nv>$config_file</span>
<a id=__codelineno-24-26 name=__codelineno-24-26 href=#__codelineno-24-26></a><span class=k>fi</span>
<a id=__codelineno-24-27 name=__codelineno-24-27 href=#__codelineno-24-27></a>
<a id=__codelineno-24-28 name=__codelineno-24-28 href=#__codelineno-24-28></a><span class=c1>#禁止X11图形转发功能.</span>
<a id=__codelineno-24-29 name=__codelineno-24-29 href=#__codelineno-24-29></a><span class=k>if</span><span class=w> </span>grep<span class=w> </span>-q<span class=w> </span><span class=s2>&quot;^X11Forwarding&quot;</span><span class=w> </span><span class=nv>$config_file</span><span class=p>;</span><span class=k>then</span>
<a id=__codelineno-24-30 name=__codelineno-24-30 href=#__codelineno-24-30></a><span class=w>    </span>sed<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;/^X11Forwarding/s/yes/no/&#39;</span><span class=w> </span><span class=nv>$config_file</span>
<a id=__codelineno-24-31 name=__codelineno-24-31 href=#__codelineno-24-31></a><span class=k>else</span>
<a id=__codelineno-24-32 name=__codelineno-24-32 href=#__codelineno-24-32></a><span class=w>    </span>sed<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;$a X11Forwarding no&#39;</span><span class=w> </span><span class=nv>$config_file</span>
<a id=__codelineno-24-33 name=__codelineno-24-33 href=#__codelineno-24-33></a><span class=k>fi</span>
<a id=__codelineno-24-34 name=__codelineno-24-34 href=#__codelineno-24-34></a>
<a id=__codelineno-24-35 name=__codelineno-24-35 href=#__codelineno-24-35></a><span class=c1>#禁止DNS查询.</span>
<a id=__codelineno-24-36 name=__codelineno-24-36 href=#__codelineno-24-36></a><span class=k>if</span><span class=w> </span>grep<span class=w> </span>-q<span class=w> </span><span class=s2>&quot;^UseDNS&quot;</span><span class=w> </span><span class=nv>$config_file</span><span class=p>;</span><span class=k>then</span>
<a id=__codelineno-24-37 name=__codelineno-24-37 href=#__codelineno-24-37></a><span class=w>    </span>sed<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;/^UseDNS/s/yes/no/&#39;</span><span class=w> </span><span class=nv>$config_file</span>
<a id=__codelineno-24-38 name=__codelineno-24-38 href=#__codelineno-24-38></a><span class=k>else</span>
<a id=__codelineno-24-39 name=__codelineno-24-39 href=#__codelineno-24-39></a><span class=w>    </span>sed<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;$a UseDNS no&#39;</span><span class=w> </span><span class=nv>$config_file</span>
<a id=__codelineno-24-40 name=__codelineno-24-40 href=#__codelineno-24-40></a><span class=k>fi</span>
</code></pre></div> <h3 id=多种test的写法>多种test的写法<a class=headerlink href=#多种test的写法 title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a><span class=ch>#!/usr/bin/env bash</span>
<a id=__codelineno-25-2 name=__codelineno-25-2 href=#__codelineno-25-2></a><span class=nv>FreeMem</span><span class=o>=</span><span class=sb>`</span>free<span class=w> </span>-m<span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;NR==3 {print $NF}&#39;</span><span class=sb>`</span>
<a id=__codelineno-25-3 name=__codelineno-25-3 href=#__codelineno-25-3></a><span class=k>if</span><span class=w> </span><span class=o>((</span><span class=w> </span><span class=nv>$FreeMem</span><span class=w> </span>&lt;<span class=w> </span><span class=m>1000</span><span class=w> </span><span class=o>))</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-25-4 name=__codelineno-25-4 href=#__codelineno-25-4></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;xxxxxxxxxx&quot;</span>
<a id=__codelineno-25-5 name=__codelineno-25-5 href=#__codelineno-25-5></a><span class=k>fi</span>
<a id=__codelineno-25-6 name=__codelineno-25-6 href=#__codelineno-25-6></a>
<a id=__codelineno-25-7 name=__codelineno-25-7 href=#__codelineno-25-7></a><span class=k>if</span><span class=w> </span><span class=o>[[</span><span class=w> </span><span class=nv>$FreeMem</span><span class=w> </span>-lt<span class=w> </span><span class=m>1000</span><span class=w> </span><span class=o>]]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-25-8 name=__codelineno-25-8 href=#__codelineno-25-8></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;xxxxxxxx&quot;</span>
<a id=__codelineno-25-9 name=__codelineno-25-9 href=#__codelineno-25-9></a><span class=k>fi</span>
<a id=__codelineno-25-10 name=__codelineno-25-10 href=#__codelineno-25-10></a>
<a id=__codelineno-25-11 name=__codelineno-25-11 href=#__codelineno-25-11></a><span class=k>if</span><span class=w> </span><span class=nb>test</span><span class=w> </span><span class=nv>$FreeMem</span><span class=w> </span>-lt<span class=w> </span><span class=m>1000</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-25-12 name=__codelineno-25-12 href=#__codelineno-25-12></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;xxxxxxxxxxxx&quot;</span>
<a id=__codelineno-25-13 name=__codelineno-25-13 href=#__codelineno-25-13></a><span class=k>fi</span>
<a id=__codelineno-25-14 name=__codelineno-25-14 href=#__codelineno-25-14></a>
<a id=__codelineno-25-15 name=__codelineno-25-15 href=#__codelineno-25-15></a><span class=k>if</span><span class=w> </span>grep<span class=w>  </span>/etc/passwd<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-25-16 name=__codelineno-25-16 href=#__codelineno-25-16></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;xxxxxxxxxx&quot;</span>
<a id=__codelineno-25-17 name=__codelineno-25-17 href=#__codelineno-25-17></a><span class=k>fi</span>
</code></pre></div> <h3 id=color输出>color输出<a class=headerlink href=#color输出 title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a><span class=ch>#!/usr/bin/env bash</span>
<a id=__codelineno-26-2 name=__codelineno-26-2 href=#__codelineno-26-2></a><span class=c1>#方法1</span>
<a id=__codelineno-26-3 name=__codelineno-26-3 href=#__codelineno-26-3></a>color_printf1<span class=o>(){</span>
<a id=__codelineno-26-4 name=__codelineno-26-4 href=#__codelineno-26-4></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[[</span><span class=w> </span><span class=nv>$1</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s2>&quot;red&quot;</span><span class=w> </span><span class=o>]]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-26-5 name=__codelineno-26-5 href=#__codelineno-26-5></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;\033[32;40m</span><span class=nv>$2</span><span class=s2>\033[0m&quot;</span>
<a id=__codelineno-26-6 name=__codelineno-26-6 href=#__codelineno-26-6></a><span class=w>    </span><span class=k>elif</span><span class=w> </span><span class=o>[[</span><span class=w> </span><span class=nv>$1</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s2>&quot;green&quot;</span><span class=w> </span><span class=o>]]</span><span class=p>;</span><span class=k>then</span>
<a id=__codelineno-26-7 name=__codelineno-26-7 href=#__codelineno-26-7></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;\033[31;40m</span><span class=nv>$2</span><span class=s2>\033[0m&quot;</span>
<a id=__codelineno-26-8 name=__codelineno-26-8 href=#__codelineno-26-8></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-26-9 name=__codelineno-26-9 href=#__codelineno-26-9></a><span class=o>}</span>
<a id=__codelineno-26-10 name=__codelineno-26-10 href=#__codelineno-26-10></a>
<a id=__codelineno-26-11 name=__codelineno-26-11 href=#__codelineno-26-11></a><span class=c1>#方法2</span>
<a id=__codelineno-26-12 name=__codelineno-26-12 href=#__codelineno-26-12></a>color_printf2<span class=o>(){</span>
<a id=__codelineno-26-13 name=__codelineno-26-13 href=#__codelineno-26-13></a><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=k>in</span>
<a id=__codelineno-26-14 name=__codelineno-26-14 href=#__codelineno-26-14></a><span class=w>    </span><span class=s2>&quot;red&quot;</span><span class=o>)</span>
<a id=__codelineno-26-15 name=__codelineno-26-15 href=#__codelineno-26-15></a><span class=w>       </span><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;\033[32;40m</span><span class=nv>$2</span><span class=s2>\033[0m&quot;</span>
<a id=__codelineno-26-16 name=__codelineno-26-16 href=#__codelineno-26-16></a><span class=w>       </span><span class=p>;;</span>
<a id=__codelineno-26-17 name=__codelineno-26-17 href=#__codelineno-26-17></a><span class=w>    </span><span class=s2>&quot;green&quot;</span><span class=o>)</span>
<a id=__codelineno-26-18 name=__codelineno-26-18 href=#__codelineno-26-18></a><span class=w>       </span><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;\033[31;40m</span><span class=nv>$2</span><span class=s2>\033[0m&quot;</span>
<a id=__codelineno-26-19 name=__codelineno-26-19 href=#__codelineno-26-19></a><span class=w>       </span><span class=p>;;</span>
<a id=__codelineno-26-20 name=__codelineno-26-20 href=#__codelineno-26-20></a><span class=w>    </span>*<span class=o>)</span>
<a id=__codelineno-26-21 name=__codelineno-26-21 href=#__codelineno-26-21></a><span class=w>       </span><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;Example: color_printf2 red xxxxxx&quot;</span>
<a id=__codelineno-26-22 name=__codelineno-26-22 href=#__codelineno-26-22></a><span class=w>       </span><span class=p>;;</span>
<a id=__codelineno-26-23 name=__codelineno-26-23 href=#__codelineno-26-23></a><span class=w>    </span><span class=k>esac</span>
<a id=__codelineno-26-24 name=__codelineno-26-24 href=#__codelineno-26-24></a>
<a id=__codelineno-26-25 name=__codelineno-26-25 href=#__codelineno-26-25></a><span class=o>}</span>
<a id=__codelineno-26-26 name=__codelineno-26-26 href=#__codelineno-26-26></a>
<a id=__codelineno-26-27 name=__codelineno-26-27 href=#__codelineno-26-27></a><span class=c1># 方法3</span>
<a id=__codelineno-26-28 name=__codelineno-26-28 href=#__codelineno-26-28></a><span class=k>function</span><span class=w> </span>echo_r<span class=w> </span><span class=o>(){</span>
<a id=__codelineno-26-29 name=__codelineno-26-29 href=#__codelineno-26-29></a><span class=w>    </span><span class=c1># Color red: Error, Failed</span>
<a id=__codelineno-26-30 name=__codelineno-26-30 href=#__codelineno-26-30></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=nv>$#</span><span class=w> </span>-ne<span class=w> </span><span class=m>1</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-26-31 name=__codelineno-26-31 href=#__codelineno-26-31></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;\033[31m</span><span class=nv>$1</span><span class=s2>\033[0m&quot;</span>
<a id=__codelineno-26-32 name=__codelineno-26-32 href=#__codelineno-26-32></a><span class=o>}</span>
<a id=__codelineno-26-33 name=__codelineno-26-33 href=#__codelineno-26-33></a>
<a id=__codelineno-26-34 name=__codelineno-26-34 href=#__codelineno-26-34></a><span class=k>function</span><span class=w> </span>echo_g<span class=w> </span><span class=o>(){</span>
<a id=__codelineno-26-35 name=__codelineno-26-35 href=#__codelineno-26-35></a><span class=w>    </span><span class=c1># Color green: Success</span>
<a id=__codelineno-26-36 name=__codelineno-26-36 href=#__codelineno-26-36></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=nv>$#</span><span class=w> </span>-ne<span class=w> </span><span class=m>1</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-26-37 name=__codelineno-26-37 href=#__codelineno-26-37></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;\033[32m</span><span class=nv>$1</span><span class=s2>\033[0m&quot;</span>
<a id=__codelineno-26-38 name=__codelineno-26-38 href=#__codelineno-26-38></a><span class=o>}</span>
</code></pre></div> <h2 id=一些常用的函数>一些常用的函数<a class=headerlink href=#一些常用的函数 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a><span class=c1>#判断是否是false</span>
<a id=__codelineno-27-2 name=__codelineno-27-2 href=#__codelineno-27-2></a>is_false<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-27-3 name=__codelineno-27-3 href=#__codelineno-27-3></a><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=k>in</span>
<a id=__codelineno-27-4 name=__codelineno-27-4 href=#__codelineno-27-4></a><span class=w>    </span><span class=o>[</span>fF<span class=o>]</span><span class=w> </span><span class=p>|</span><span class=w> </span><span class=o>[</span>nN<span class=o>]</span><span class=w> </span><span class=p>|</span><span class=w> </span><span class=o>[</span>nN<span class=o>][</span>oO<span class=o>]</span><span class=w> </span><span class=p>|</span><span class=w> </span><span class=o>[</span>fF<span class=o>][</span>aA<span class=o>][</span>lL<span class=o>][</span>sS<span class=o>][</span>eE<span class=o>]</span><span class=w> </span><span class=p>|</span><span class=w> </span><span class=m>0</span><span class=o>)</span>
<a id=__codelineno-27-5 name=__codelineno-27-5 href=#__codelineno-27-5></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-27-6 name=__codelineno-27-6 href=#__codelineno-27-6></a><span class=w>        </span><span class=p>;;</span>
<a id=__codelineno-27-7 name=__codelineno-27-7 href=#__codelineno-27-7></a><span class=w>    </span><span class=k>esac</span>
<a id=__codelineno-27-8 name=__codelineno-27-8 href=#__codelineno-27-8></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-27-9 name=__codelineno-27-9 href=#__codelineno-27-9></a><span class=o>}</span>
<a id=__codelineno-27-10 name=__codelineno-27-10 href=#__codelineno-27-10></a>
<a id=__codelineno-27-11 name=__codelineno-27-11 href=#__codelineno-27-11></a><span class=c1>#判断进程是否运行</span>
<a id=__codelineno-27-12 name=__codelineno-27-12 href=#__codelineno-27-12></a>is_running<span class=o>()</span>
<a id=__codelineno-27-13 name=__codelineno-27-13 href=#__codelineno-27-13></a><span class=o>{</span>
<a id=__codelineno-27-14 name=__codelineno-27-14 href=#__codelineno-27-14></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-f<span class=w> </span><span class=nv>$1</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-27-15 name=__codelineno-27-15 href=#__codelineno-27-15></a><span class=w>        </span><span class=nb>read</span><span class=w> </span>pid<span class=w> </span>&lt;<span class=w> </span><span class=nv>$1</span>
<a id=__codelineno-27-16 name=__codelineno-27-16 href=#__codelineno-27-16></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-d<span class=w> </span><span class=s2>&quot;/proc/</span><span class=nv>$pid</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-27-17 name=__codelineno-27-17 href=#__codelineno-27-17></a><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-27-18 name=__codelineno-27-18 href=#__codelineno-27-18></a><span class=w>        </span><span class=k>fi</span>
<a id=__codelineno-27-19 name=__codelineno-27-19 href=#__codelineno-27-19></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-27-20 name=__codelineno-27-20 href=#__codelineno-27-20></a><span class=w>    </span><span class=k>return</span><span class=w> </span>-1
<a id=__codelineno-27-21 name=__codelineno-27-21 href=#__codelineno-27-21></a><span class=o>}</span>
<a id=__codelineno-27-22 name=__codelineno-27-22 href=#__codelineno-27-22></a>
<a id=__codelineno-27-23 name=__codelineno-27-23 href=#__codelineno-27-23></a><span class=c1>#安装epel源</span>
<a id=__codelineno-27-24 name=__codelineno-27-24 href=#__codelineno-27-24></a><span class=k>function</span><span class=w> </span>_install_epel<span class=w> </span><span class=o>{</span>
<a id=__codelineno-27-25 name=__codelineno-27-25 href=#__codelineno-27-25></a><span class=w>    </span><span class=c1># NOTE: We always remove and install latest -- some environments</span>
<a id=__codelineno-27-26 name=__codelineno-27-26 href=#__codelineno-27-26></a><span class=w>    </span><span class=c1># use snapshot images, and if EPEL version updates they break</span>
<a id=__codelineno-27-27 name=__codelineno-27-27 href=#__codelineno-27-27></a><span class=w>    </span><span class=c1># unless we update them to latest version.</span>
<a id=__codelineno-27-28 name=__codelineno-27-28 href=#__codelineno-27-28></a><span class=w>    </span><span class=k>if</span><span class=w> </span>sudo<span class=w> </span>yum<span class=w> </span>repolist<span class=w> </span>enabled<span class=w> </span>epel<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>-q<span class=w> </span><span class=s1>&#39;epel&#39;</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-27-29 name=__codelineno-27-29 href=#__codelineno-27-29></a><span class=w>        </span>uninstall_package<span class=w> </span>epel-release<span class=w> </span><span class=o>||</span><span class=w> </span><span class=nb>true</span>
<a id=__codelineno-27-30 name=__codelineno-27-30 href=#__codelineno-27-30></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-27-31 name=__codelineno-27-31 href=#__codelineno-27-31></a>
<a id=__codelineno-27-32 name=__codelineno-27-32 href=#__codelineno-27-32></a><span class=w>    </span><span class=c1># This trick installs the latest epel-release from a bootstrap</span>
<a id=__codelineno-27-33 name=__codelineno-27-33 href=#__codelineno-27-33></a><span class=w>    </span><span class=c1># repo, then removes itself (as epel-release installed the</span>
<a id=__codelineno-27-34 name=__codelineno-27-34 href=#__codelineno-27-34></a><span class=w>    </span><span class=c1># &quot;real&quot; repo).</span>
<a id=__codelineno-27-35 name=__codelineno-27-35 href=#__codelineno-27-35></a><span class=w>    </span><span class=c1>#</span>
<a id=__codelineno-27-36 name=__codelineno-27-36 href=#__codelineno-27-36></a><span class=w>    </span><span class=c1># You would think that rather than this, you could use</span>
<a id=__codelineno-27-37 name=__codelineno-27-37 href=#__codelineno-27-37></a><span class=w>    </span><span class=c1># $releasever directly in .repo file we create below.  However</span>
<a id=__codelineno-27-38 name=__codelineno-27-38 href=#__codelineno-27-38></a><span class=w>    </span><span class=c1># RHEL gives a $releasever of &quot;6Server&quot; which breaks the path;</span>
<a id=__codelineno-27-39 name=__codelineno-27-39 href=#__codelineno-27-39></a><span class=w>    </span><span class=c1># see https://bugzilla.redhat.com/show_bug.cgi?id=1150759</span>
<a id=__codelineno-27-40 name=__codelineno-27-40 href=#__codelineno-27-40></a><span class=w>    </span>cat<span class=w> </span><span class=s>&lt;&lt;EOF | sudo tee /etc/yum.repos.d/epel-bootstrap.repo</span>
<a id=__codelineno-27-41 name=__codelineno-27-41 href=#__codelineno-27-41></a><span class=s>[epel-bootstrap]</span>
<a id=__codelineno-27-42 name=__codelineno-27-42 href=#__codelineno-27-42></a><span class=s>name=Bootstrap EPEL</span>
<a id=__codelineno-27-43 name=__codelineno-27-43 href=#__codelineno-27-43></a><span class=s>mirrorlist=http://mirrors.fedoraproject.org/mirrorlist?repo=epel-7&amp;arch=\$basearch</span>
<a id=__codelineno-27-44 name=__codelineno-27-44 href=#__codelineno-27-44></a><span class=s>failovermethod=priority</span>
<a id=__codelineno-27-45 name=__codelineno-27-45 href=#__codelineno-27-45></a><span class=s>enabled=0</span>
<a id=__codelineno-27-46 name=__codelineno-27-46 href=#__codelineno-27-46></a><span class=s>gpgcheck=0</span>
<a id=__codelineno-27-47 name=__codelineno-27-47 href=#__codelineno-27-47></a><span class=s>EOF</span>
<a id=__codelineno-27-48 name=__codelineno-27-48 href=#__codelineno-27-48></a><span class=w>    </span><span class=c1># Enable a bootstrap repo.  It is removed after finishing</span>
<a id=__codelineno-27-49 name=__codelineno-27-49 href=#__codelineno-27-49></a><span class=w>    </span><span class=c1># the epel-release installation.</span>
<a id=__codelineno-27-50 name=__codelineno-27-50 href=#__codelineno-27-50></a><span class=w>    </span>is_package_installed<span class=w> </span>yum-utils<span class=w> </span><span class=o>||</span><span class=w> </span>install_package<span class=w> </span>yum-utils
<a id=__codelineno-27-51 name=__codelineno-27-51 href=#__codelineno-27-51></a><span class=w>    </span>sudo<span class=w> </span>yum-config-manager<span class=w> </span>--enable<span class=w> </span>epel-bootstrap
<a id=__codelineno-27-52 name=__codelineno-27-52 href=#__codelineno-27-52></a><span class=w>    </span>yum_install<span class=w> </span>epel-release<span class=w> </span><span class=o>||</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-27-53 name=__codelineno-27-53 href=#__codelineno-27-53></a><span class=w>        </span>die<span class=w> </span><span class=nv>$LINENO</span><span class=w> </span><span class=s2>&quot;Error installing EPEL repo, cannot continue&quot;</span>
<a id=__codelineno-27-54 name=__codelineno-27-54 href=#__codelineno-27-54></a><span class=w>    </span>sudo<span class=w> </span>rm<span class=w> </span>-f<span class=w> </span>/etc/yum.repos.d/epel-bootstrap.repo
<a id=__codelineno-27-55 name=__codelineno-27-55 href=#__codelineno-27-55></a><span class=o>}</span>
<a id=__codelineno-27-56 name=__codelineno-27-56 href=#__codelineno-27-56></a>
<a id=__codelineno-27-57 name=__codelineno-27-57 href=#__codelineno-27-57></a><span class=c1>#记录日志的function</span>
<a id=__codelineno-27-58 name=__codelineno-27-58 href=#__codelineno-27-58></a><span class=k>function</span><span class=w> </span>fnLogInfo<span class=o>()</span>
<a id=__codelineno-27-59 name=__codelineno-27-59 href=#__codelineno-27-59></a><span class=o>{</span>
<a id=__codelineno-27-60 name=__codelineno-27-60 href=#__codelineno-27-60></a><span class=w>        </span><span class=nb>local</span><span class=w> </span><span class=nv>infomsg</span><span class=o>=</span><span class=nv>$1</span>
<a id=__codelineno-27-61 name=__codelineno-27-61 href=#__codelineno-27-61></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=si>${</span><span class=nv>infomsg</span><span class=si>}</span>
<a id=__codelineno-27-62 name=__codelineno-27-62 href=#__codelineno-27-62></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=sb>`</span>date<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>data_format</span><span class=si>}</span><span class=s2>&quot;</span><span class=sb>`</span><span class=w> </span><span class=s2>&quot;Info:</span><span class=si>${</span><span class=nv>infomsg</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span><span class=si>${</span><span class=nv>log_file</span><span class=si>}</span>
<a id=__codelineno-27-63 name=__codelineno-27-63 href=#__codelineno-27-63></a><span class=o>}</span>
<a id=__codelineno-27-64 name=__codelineno-27-64 href=#__codelineno-27-64></a>
<a id=__codelineno-27-65 name=__codelineno-27-65 href=#__codelineno-27-65></a>
<a id=__codelineno-27-66 name=__codelineno-27-66 href=#__codelineno-27-66></a><span class=c1>#备份文件的function</span>
<a id=__codelineno-27-67 name=__codelineno-27-67 href=#__codelineno-27-67></a>fnBackupBeforeModify<span class=o>()</span>
<a id=__codelineno-27-68 name=__codelineno-27-68 href=#__codelineno-27-68></a><span class=o>{</span>
<a id=__codelineno-27-69 name=__codelineno-27-69 href=#__codelineno-27-69></a><span class=w>        </span><span class=nb>local</span><span class=w> </span><span class=nv>file</span><span class=o>=</span><span class=nv>$1</span>
<a id=__codelineno-27-70 name=__codelineno-27-70 href=#__codelineno-27-70></a><span class=w>        </span><span class=nb>local</span><span class=w> </span><span class=nv>backupFile</span><span class=o>=</span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>file</span><span class=si>}</span><span class=s2>.bak&quot;</span>
<a id=__codelineno-27-71 name=__codelineno-27-71 href=#__codelineno-27-71></a>
<a id=__codelineno-27-72 name=__codelineno-27-72 href=#__codelineno-27-72></a><span class=w>        </span>fnLogInfo<span class=w> </span><span class=s2>&quot;Start to backup file </span><span class=nv>$file</span><span class=s2>&quot;</span>
<a id=__codelineno-27-73 name=__codelineno-27-73 href=#__codelineno-27-73></a>
<a id=__codelineno-27-74 name=__codelineno-27-74 href=#__codelineno-27-74></a><span class=w>        </span>cp<span class=w> </span><span class=si>${</span><span class=nv>file</span><span class=si>}</span><span class=w> </span>-p<span class=w> </span><span class=si>${</span><span class=nv>backupFile</span><span class=si>}</span>
<a id=__codelineno-27-75 name=__codelineno-27-75 href=#__codelineno-27-75></a>
<a id=__codelineno-27-76 name=__codelineno-27-76 href=#__codelineno-27-76></a><span class=w>        </span>fnLogInfo<span class=w> </span><span class=s2>&quot;End to backup file </span><span class=nv>$file</span><span class=s2>&quot;</span>
<a id=__codelineno-27-77 name=__codelineno-27-77 href=#__codelineno-27-77></a><span class=o>}</span>
<a id=__codelineno-27-78 name=__codelineno-27-78 href=#__codelineno-27-78></a>
<a id=__codelineno-27-79 name=__codelineno-27-79 href=#__codelineno-27-79></a><span class=c1># 1. change the network config as DHCP</span>
<a id=__codelineno-27-80 name=__codelineno-27-80 href=#__codelineno-27-80></a><span class=c1># 2. delete the 70-persistent-net.rules file</span>
<a id=__codelineno-27-81 name=__codelineno-27-81 href=#__codelineno-27-81></a>fnModifyNetworkConfig<span class=o>()</span>
<a id=__codelineno-27-82 name=__codelineno-27-82 href=#__codelineno-27-82></a><span class=o>{</span>
<a id=__codelineno-27-83 name=__codelineno-27-83 href=#__codelineno-27-83></a><span class=w>        </span>fnLogInfo<span class=w> </span><span class=s2>&quot;----------------------------------------&quot;</span>
<a id=__codelineno-27-84 name=__codelineno-27-84 href=#__codelineno-27-84></a><span class=w>        </span>fnLogInfo<span class=w> </span><span class=s2>&quot;Start to modify the network configuration&quot;</span>
<a id=__codelineno-27-85 name=__codelineno-27-85 href=#__codelineno-27-85></a>
<a id=__codelineno-27-86 name=__codelineno-27-86 href=#__codelineno-27-86></a><span class=w>        </span><span class=nb>local</span><span class=w> </span><span class=nv>files</span><span class=o>=</span><span class=s1>&#39;&#39;</span>
<a id=__codelineno-27-87 name=__codelineno-27-87 href=#__codelineno-27-87></a>
<a id=__codelineno-27-88 name=__codelineno-27-88 href=#__codelineno-27-88></a><span class=w>        </span><span class=c1>#1. change the network config as DHCP</span>
<a id=__codelineno-27-89 name=__codelineno-27-89 href=#__codelineno-27-89></a><span class=w>        </span><span class=k>case</span><span class=w> </span><span class=nv>$os_type</span><span class=w> </span><span class=k>in</span>
<a id=__codelineno-27-90 name=__codelineno-27-90 href=#__codelineno-27-90></a>
<a id=__codelineno-27-91 name=__codelineno-27-91 href=#__codelineno-27-91></a><span class=w>        </span><span class=c1>#/etc/sysconfig/network-scripts</span>
<a id=__codelineno-27-92 name=__codelineno-27-92 href=#__codelineno-27-92></a><span class=w>        </span><span class=s2>&quot;redhat&quot;</span><span class=o>)</span>
<a id=__codelineno-27-93 name=__codelineno-27-93 href=#__codelineno-27-93></a><span class=w>        </span><span class=nv>files</span><span class=o>=</span><span class=s2>&quot;`ls /etc/sysconfig/network-scripts/ifcfg-eth* |grep -v .bak`&quot;</span>
<a id=__codelineno-27-94 name=__codelineno-27-94 href=#__codelineno-27-94></a><span class=w>        </span><span class=nv>files</span><span class=o>=</span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>files</span><span class=si>}</span><span class=s2> `ls /etc/sysconfig/network-scripts/ifcfg-ens* |grep -v .bak`&quot;</span>
<a id=__codelineno-27-95 name=__codelineno-27-95 href=#__codelineno-27-95></a><span class=w>        </span><span class=k>for</span><span class=w> </span>file<span class=w> </span><span class=k>in</span><span class=w> </span><span class=nv>$files</span>
<a id=__codelineno-27-96 name=__codelineno-27-96 href=#__codelineno-27-96></a><span class=w>        </span><span class=k>do</span>
<a id=__codelineno-27-97 name=__codelineno-27-97 href=#__codelineno-27-97></a><span class=w>            </span>fnLogInfo<span class=w> </span><span class=s2>&quot;Start to modify the network configuration: </span><span class=nv>$file</span><span class=s2>&quot;</span>
<a id=__codelineno-27-98 name=__codelineno-27-98 href=#__codelineno-27-98></a><span class=w>            </span><span class=c1>#backup  the file</span>
<a id=__codelineno-27-99 name=__codelineno-27-99 href=#__codelineno-27-99></a><span class=w>            </span>fnBackupBeforeModify<span class=w> </span><span class=nv>$file</span>
<a id=__codelineno-27-100 name=__codelineno-27-100 href=#__codelineno-27-100></a><span class=w>            </span><span class=c1>#modify the file</span>
<a id=__codelineno-27-101 name=__codelineno-27-101 href=#__codelineno-27-101></a><span class=w>            </span>sed<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;/PERSISTENT_DHCLIENT/d&#39;</span><span class=w> </span><span class=nv>$file</span>
<a id=__codelineno-27-102 name=__codelineno-27-102 href=#__codelineno-27-102></a><span class=w>            </span>sed<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;$a\PERSISTENT_DHCLIENT=yes&#39;</span><span class=w> </span><span class=nv>$file</span>
<a id=__codelineno-27-103 name=__codelineno-27-103 href=#__codelineno-27-103></a><span class=w>            </span>fnLogInfo<span class=w> </span><span class=s2>&quot;End to modify the network configuration: </span><span class=nv>$file</span><span class=s2>&quot;</span>
<a id=__codelineno-27-104 name=__codelineno-27-104 href=#__codelineno-27-104></a><span class=w>        </span><span class=k>done</span>
<a id=__codelineno-27-105 name=__codelineno-27-105 href=#__codelineno-27-105></a><span class=w>        </span><span class=p>;;</span>
<a id=__codelineno-27-106 name=__codelineno-27-106 href=#__codelineno-27-106></a>
<a id=__codelineno-27-107 name=__codelineno-27-107 href=#__codelineno-27-107></a><span class=w>        </span><span class=c1>#/etc/sysconfig/network/dhcp</span>
<a id=__codelineno-27-108 name=__codelineno-27-108 href=#__codelineno-27-108></a><span class=w>        </span><span class=s2>&quot;suse&quot;</span><span class=o>)</span>
<a id=__codelineno-27-109 name=__codelineno-27-109 href=#__codelineno-27-109></a><span class=w>        </span><span class=nv>file</span><span class=o>=</span><span class=s1>&#39;/etc/sysconfig/network/dhcp&#39;</span>
<a id=__codelineno-27-110 name=__codelineno-27-110 href=#__codelineno-27-110></a>
<a id=__codelineno-27-111 name=__codelineno-27-111 href=#__codelineno-27-111></a><span class=w>        </span><span class=c1>#first backup file</span>
<a id=__codelineno-27-112 name=__codelineno-27-112 href=#__codelineno-27-112></a><span class=w>        </span>fnBackupBeforeModify<span class=w> </span><span class=nv>$file</span>
<a id=__codelineno-27-113 name=__codelineno-27-113 href=#__codelineno-27-113></a>
<a id=__codelineno-27-114 name=__codelineno-27-114 href=#__codelineno-27-114></a><span class=w>        </span>sed<span class=w> </span>-i<span class=w> </span><span class=s2>&quot;s/DHCLIENT_USE_LAST_LEASE=yes\|DHCLIENT_USE_LAST_LEASE=&#39;yes&#39;\|DHCLIENT_USE_LAST_LEASE=\&quot;yes\&quot;/DHCLIENT_USE_LAST_LEASE=\&quot;no\&quot;/g&quot;</span><span class=w> </span><span class=nv>$file</span>
<a id=__codelineno-27-115 name=__codelineno-27-115 href=#__codelineno-27-115></a><span class=w>        </span><span class=p>;;</span>
<a id=__codelineno-27-116 name=__codelineno-27-116 href=#__codelineno-27-116></a>
<a id=__codelineno-27-117 name=__codelineno-27-117 href=#__codelineno-27-117></a><span class=w>        </span><span class=c1>#/etc/network/interfaces</span>
<a id=__codelineno-27-118 name=__codelineno-27-118 href=#__codelineno-27-118></a><span class=w>        </span><span class=s2>&quot;debian&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span><span class=s2>&quot;ubuntu&quot;</span><span class=o>)</span>
<a id=__codelineno-27-119 name=__codelineno-27-119 href=#__codelineno-27-119></a><span class=w>        </span><span class=nv>file</span><span class=o>=</span><span class=s1>&#39;/etc/network/interfaces&#39;</span>
<a id=__codelineno-27-120 name=__codelineno-27-120 href=#__codelineno-27-120></a>
<a id=__codelineno-27-121 name=__codelineno-27-121 href=#__codelineno-27-121></a><span class=w>        </span><span class=c1>#backup the file</span>
<a id=__codelineno-27-122 name=__codelineno-27-122 href=#__codelineno-27-122></a><span class=w>        </span>fnBackupBeforeModify<span class=w> </span><span class=nv>$file</span>
<a id=__codelineno-27-123 name=__codelineno-27-123 href=#__codelineno-27-123></a>
<a id=__codelineno-27-124 name=__codelineno-27-124 href=#__codelineno-27-124></a><span class=w>        </span>sed<span class=w> </span>-i<span class=w> </span><span class=s2>&quot;s/static\| manual/ dhcp/g&quot;</span><span class=w> </span><span class=nv>$file</span>
<a id=__codelineno-27-125 name=__codelineno-27-125 href=#__codelineno-27-125></a><span class=w>        </span>sed<span class=w> </span>-i<span class=w> </span><span class=s2>&quot;s/address /#address /g&quot;</span><span class=w> </span><span class=nv>$file</span>
<a id=__codelineno-27-126 name=__codelineno-27-126 href=#__codelineno-27-126></a><span class=w>        </span>sed<span class=w> </span>-i<span class=w> </span><span class=s2>&quot;s/netmask /#netmask /g&quot;</span><span class=w> </span><span class=nv>$file</span>
<a id=__codelineno-27-127 name=__codelineno-27-127 href=#__codelineno-27-127></a><span class=w>        </span>sed<span class=w> </span>-i<span class=w> </span><span class=s2>&quot;s/gateway /#gateway /g&quot;</span><span class=w> </span><span class=nv>$file</span>
<a id=__codelineno-27-128 name=__codelineno-27-128 href=#__codelineno-27-128></a>
<a id=__codelineno-27-129 name=__codelineno-27-129 href=#__codelineno-27-129></a><span class=w>        </span><span class=p>;;</span>
<a id=__codelineno-27-130 name=__codelineno-27-130 href=#__codelineno-27-130></a>
<a id=__codelineno-27-131 name=__codelineno-27-131 href=#__codelineno-27-131></a><span class=w>        </span>*<span class=o>)</span>
<a id=__codelineno-27-132 name=__codelineno-27-132 href=#__codelineno-27-132></a><span class=w>        </span>fnLogInfo<span class=w> </span><span class=s2>&quot;Other Linux, network configuration cannot be modified.&quot;</span>
<a id=__codelineno-27-133 name=__codelineno-27-133 href=#__codelineno-27-133></a><span class=w>        </span><span class=p>;;</span>
<a id=__codelineno-27-134 name=__codelineno-27-134 href=#__codelineno-27-134></a><span class=w>        </span><span class=k>esac</span>
<a id=__codelineno-27-135 name=__codelineno-27-135 href=#__codelineno-27-135></a>
<a id=__codelineno-27-136 name=__codelineno-27-136 href=#__codelineno-27-136></a><span class=w>        </span><span class=c1>#2. delete the 70-persistent-net.rules file</span>
<a id=__codelineno-27-137 name=__codelineno-27-137 href=#__codelineno-27-137></a><span class=w>        </span>rm<span class=w> </span>-rf<span class=w> </span>/etc/udev/rules.d/70-persistent-net.rules
<a id=__codelineno-27-138 name=__codelineno-27-138 href=#__codelineno-27-138></a>
<a id=__codelineno-27-139 name=__codelineno-27-139 href=#__codelineno-27-139></a><span class=w>        </span>fnLogInfo<span class=w> </span><span class=s2>&quot;Delete 70-persistent-net.rules file, resut: </span><span class=nv>$?</span><span class=s2>&quot;</span>
<a id=__codelineno-27-140 name=__codelineno-27-140 href=#__codelineno-27-140></a>
<a id=__codelineno-27-141 name=__codelineno-27-141 href=#__codelineno-27-141></a><span class=w>        </span>fnLogInfo<span class=w> </span><span class=s2>&quot;End to modify the network configuration&quot;</span>
<a id=__codelineno-27-142 name=__codelineno-27-142 href=#__codelineno-27-142></a><span class=o>}</span>
<a id=__codelineno-27-143 name=__codelineno-27-143 href=#__codelineno-27-143></a><span class=c1>#check OS的function</span>
<a id=__codelineno-27-144 name=__codelineno-27-144 href=#__codelineno-27-144></a>fnGetOSType<span class=o>()</span>
<a id=__codelineno-27-145 name=__codelineno-27-145 href=#__codelineno-27-145></a><span class=o>{</span>
<a id=__codelineno-27-146 name=__codelineno-27-146 href=#__codelineno-27-146></a><span class=w>        </span>fnLogInfo<span class=w> </span><span class=s2>&quot;---------------------------&quot;</span>
<a id=__codelineno-27-147 name=__codelineno-27-147 href=#__codelineno-27-147></a><span class=w>        </span>fnLogInfo<span class=w> </span><span class=s2>&quot;Start to get the os type&quot;</span>
<a id=__codelineno-27-148 name=__codelineno-27-148 href=#__codelineno-27-148></a>
<a id=__codelineno-27-149 name=__codelineno-27-149 href=#__codelineno-27-149></a><span class=w>        </span><span class=nb>local</span><span class=w> </span><span class=nv>version</span><span class=o>=</span><span class=s2>&quot;/proc/version&quot;</span>
<a id=__codelineno-27-150 name=__codelineno-27-150 href=#__codelineno-27-150></a><span class=w>        </span><span class=k>if</span><span class=w> </span>!<span class=w> </span><span class=o>[</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>version</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=k>then</span>
<a id=__codelineno-27-151 name=__codelineno-27-151 href=#__codelineno-27-151></a><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-27-152 name=__codelineno-27-152 href=#__codelineno-27-152></a><span class=w>        </span><span class=k>elif</span><span class=w> </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=k>$(</span>grep<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;suse&#39;</span><span class=w> </span><span class=si>${</span><span class=nv>version</span><span class=si>}</span><span class=k>)</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=k>then</span>
<a id=__codelineno-27-153 name=__codelineno-27-153 href=#__codelineno-27-153></a><span class=w>            </span><span class=nv>os_type</span><span class=o>=</span><span class=s1>&#39;suse&#39;</span>
<a id=__codelineno-27-154 name=__codelineno-27-154 href=#__codelineno-27-154></a><span class=w>        </span><span class=k>elif</span><span class=w> </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=k>$(</span>grep<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;ubuntu&#39;</span><span class=w> </span><span class=si>${</span><span class=nv>version</span><span class=si>}</span><span class=k>)</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=k>then</span>
<a id=__codelineno-27-155 name=__codelineno-27-155 href=#__codelineno-27-155></a><span class=w>            </span><span class=nv>os_type</span><span class=o>=</span><span class=s1>&#39;ubuntu&#39;</span>
<a id=__codelineno-27-156 name=__codelineno-27-156 href=#__codelineno-27-156></a><span class=w>        </span><span class=k>elif</span><span class=w> </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=k>$(</span>grep<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;Red Hat&#39;</span><span class=w> </span><span class=si>${</span><span class=nv>version</span><span class=si>}</span><span class=k>)</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=k>then</span>
<a id=__codelineno-27-157 name=__codelineno-27-157 href=#__codelineno-27-157></a><span class=w>            </span><span class=nv>os_type</span><span class=o>=</span><span class=s1>&#39;redhat&#39;</span>
<a id=__codelineno-27-158 name=__codelineno-27-158 href=#__codelineno-27-158></a><span class=w>                </span><span class=k>elif</span><span class=w> </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=k>$(</span>grep<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;debian&#39;</span><span class=w> </span><span class=si>${</span><span class=nv>version</span><span class=si>}</span><span class=k>)</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=k>then</span>
<a id=__codelineno-27-159 name=__codelineno-27-159 href=#__codelineno-27-159></a><span class=w>            </span><span class=nv>os_type</span><span class=o>=</span><span class=s1>&#39;debian&#39;</span>
<a id=__codelineno-27-160 name=__codelineno-27-160 href=#__codelineno-27-160></a><span class=w>        </span><span class=k>fi</span>
<a id=__codelineno-27-161 name=__codelineno-27-161 href=#__codelineno-27-161></a>
<a id=__codelineno-27-162 name=__codelineno-27-162 href=#__codelineno-27-162></a>
<a id=__codelineno-27-163 name=__codelineno-27-163 href=#__codelineno-27-163></a><span class=w>        </span>fnLogInfo<span class=w> </span><span class=s2>&quot;End to get the os type: </span><span class=nv>$os_type</span><span class=s2>&quot;</span>
<a id=__codelineno-27-164 name=__codelineno-27-164 href=#__codelineno-27-164></a><span class=o>}</span>
<a id=__codelineno-27-165 name=__codelineno-27-165 href=#__codelineno-27-165></a>
<a id=__codelineno-27-166 name=__codelineno-27-166 href=#__codelineno-27-166></a><span class=c1>#输入选择Yes和No函数</span>
<a id=__codelineno-27-167 name=__codelineno-27-167 href=#__codelineno-27-167></a>YES_NO_choice<span class=o>(){</span>
<a id=__codelineno-27-168 name=__codelineno-27-168 href=#__codelineno-27-168></a><span class=nb>read</span><span class=w> </span>-t<span class=w> </span><span class=m>10</span><span class=w> </span>-p<span class=w> </span><span class=s2>&quot;Please input you commit ,wait 5.....to exit: &quot;</span><span class=w> </span>input
<a id=__codelineno-27-169 name=__codelineno-27-169 href=#__codelineno-27-169></a>
<a id=__codelineno-27-170 name=__codelineno-27-170 href=#__codelineno-27-170></a><span class=k>case</span><span class=w> </span><span class=nv>$input</span><span class=w> </span><span class=k>in</span>
<a id=__codelineno-27-171 name=__codelineno-27-171 href=#__codelineno-27-171></a><span class=w>    </span><span class=o>[</span>yY<span class=o>]</span><span class=p>|</span><span class=o>[</span>yY<span class=o>][</span>eE<span class=o>][</span>sS<span class=o>]</span><span class=w> </span><span class=o>)</span>
<a id=__codelineno-27-172 name=__codelineno-27-172 href=#__codelineno-27-172></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;YES!!!!!&quot;</span>
<a id=__codelineno-27-173 name=__codelineno-27-173 href=#__codelineno-27-173></a><span class=w>        </span><span class=p>;;</span>
<a id=__codelineno-27-174 name=__codelineno-27-174 href=#__codelineno-27-174></a><span class=w>    </span><span class=o>[</span>nN<span class=o>]</span><span class=p>|</span><span class=o>[</span>nN<span class=o>][</span>oO<span class=o>]</span><span class=w> </span><span class=o>)</span>
<a id=__codelineno-27-175 name=__codelineno-27-175 href=#__codelineno-27-175></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;NO  Error!!!!!&quot;</span>
<a id=__codelineno-27-176 name=__codelineno-27-176 href=#__codelineno-27-176></a><span class=w>        </span><span class=p>;;</span>
<a id=__codelineno-27-177 name=__codelineno-27-177 href=#__codelineno-27-177></a><span class=w>        </span>*<span class=o>)</span>
<a id=__codelineno-27-178 name=__codelineno-27-178 href=#__codelineno-27-178></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;============================&quot;</span>
<a id=__codelineno-27-179 name=__codelineno-27-179 href=#__codelineno-27-179></a><span class=w>        </span><span class=p>;;</span>
<a id=__codelineno-27-180 name=__codelineno-27-180 href=#__codelineno-27-180></a>
<a id=__codelineno-27-181 name=__codelineno-27-181 href=#__codelineno-27-181></a><span class=k>esac</span>
<a id=__codelineno-27-182 name=__codelineno-27-182 href=#__codelineno-27-182></a>
<a id=__codelineno-27-183 name=__codelineno-27-183 href=#__codelineno-27-183></a><span class=c1>#错误提示函数</span>
<a id=__codelineno-27-184 name=__codelineno-27-184 href=#__codelineno-27-184></a>die<span class=w> </span><span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-27-185 name=__codelineno-27-185 href=#__codelineno-27-185></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;ERROR: </span><span class=nv>$1</span><span class=s2>. Aborting!&quot;</span>
<a id=__codelineno-27-186 name=__codelineno-27-186 href=#__codelineno-27-186></a><span class=w>    </span><span class=nb>exit</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-27-187 name=__codelineno-27-187 href=#__codelineno-27-187></a><span class=o>}</span>
<a id=__codelineno-27-188 name=__codelineno-27-188 href=#__codelineno-27-188></a>
<a id=__codelineno-27-189 name=__codelineno-27-189 href=#__codelineno-27-189></a><span class=c1>#判断用户输入如果没有输入，选择默认值 redis为例</span>
<a id=__codelineno-27-190 name=__codelineno-27-190 href=#__codelineno-27-190></a><span class=nv>_REDIS_PORT</span><span class=o>=</span><span class=m>6379</span>
<a id=__codelineno-27-191 name=__codelineno-27-191 href=#__codelineno-27-191></a><span class=nv>_MANUAL_EXECUTION</span><span class=o>=</span><span class=nb>false</span><span class=w>     </span><span class=c1>#标志信息</span>
<a id=__codelineno-27-192 name=__codelineno-27-192 href=#__codelineno-27-192></a>check_input_redis_port<span class=o>(){</span>
<a id=__codelineno-27-193 name=__codelineno-27-193 href=#__codelineno-27-193></a><span class=k>if</span><span class=w> </span>!<span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=nv>$REDIS_PORT</span><span class=w> </span><span class=p>|</span><span class=w> </span>egrep<span class=w> </span>-q<span class=w> </span><span class=s1>&#39;^[0-9]+$&#39;</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-27-194 name=__codelineno-27-194 href=#__codelineno-27-194></a><span class=w>    </span><span class=nv>_MANUAL_EXECUTION</span><span class=o>=</span><span class=nb>true</span><span class=w>      </span><span class=c1>#重置标志信息</span>
<a id=__codelineno-27-195 name=__codelineno-27-195 href=#__codelineno-27-195></a><span class=w>    </span><span class=c1>#Read the redis port</span>
<a id=__codelineno-27-196 name=__codelineno-27-196 href=#__codelineno-27-196></a><span class=w>    </span><span class=nb>read</span><span class=w>  </span>-p<span class=w> </span><span class=s2>&quot;Please select the redis port for this instance: [</span><span class=nv>$_REDIS_PORT</span><span class=s2>] &quot;</span><span class=w> </span>REDIS_PORT
<a id=__codelineno-27-197 name=__codelineno-27-197 href=#__codelineno-27-197></a><span class=w>    </span><span class=k>if</span><span class=w> </span>!<span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=nv>$REDIS_PORT</span><span class=w> </span><span class=p>|</span><span class=w> </span>egrep<span class=w> </span>-q<span class=w> </span><span class=s1>&#39;^[0-9]+$&#39;</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-27-198 name=__codelineno-27-198 href=#__codelineno-27-198></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Selecting default: </span><span class=nv>$_REDIS_PORT</span><span class=s2>&quot;</span>
<a id=__codelineno-27-199 name=__codelineno-27-199 href=#__codelineno-27-199></a><span class=w>        </span><span class=nv>REDIS_PORT</span><span class=o>=</span><span class=nv>$_REDIS_PORT</span>
<a id=__codelineno-27-200 name=__codelineno-27-200 href=#__codelineno-27-200></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-27-201 name=__codelineno-27-201 href=#__codelineno-27-201></a><span class=k>fi</span>
<a id=__codelineno-27-202 name=__codelineno-27-202 href=#__codelineno-27-202></a><span class=o>}</span>
<a id=__codelineno-27-203 name=__codelineno-27-203 href=#__codelineno-27-203></a>
<a id=__codelineno-27-204 name=__codelineno-27-204 href=#__codelineno-27-204></a>
<a id=__codelineno-27-205 name=__codelineno-27-205 href=#__codelineno-27-205></a>Get_OS_Bit<span class=o>()</span>
<a id=__codelineno-27-206 name=__codelineno-27-206 href=#__codelineno-27-206></a><span class=o>{</span>
<a id=__codelineno-27-207 name=__codelineno-27-207 href=#__codelineno-27-207></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[[</span><span class=w> </span><span class=sb>`</span>getconf<span class=w> </span>WORD_BIT<span class=sb>`</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;32&#39;</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=sb>`</span>getconf<span class=w> </span>LONG_BIT<span class=sb>`</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;64&#39;</span><span class=w> </span><span class=o>]]</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-27-208 name=__codelineno-27-208 href=#__codelineno-27-208></a><span class=w>        </span><span class=nv>Is_64bit</span><span class=o>=</span><span class=s1>&#39;y&#39;</span>
<a id=__codelineno-27-209 name=__codelineno-27-209 href=#__codelineno-27-209></a><span class=w>    </span><span class=k>else</span>
<a id=__codelineno-27-210 name=__codelineno-27-210 href=#__codelineno-27-210></a><span class=w>        </span><span class=nv>Is_64bit</span><span class=o>=</span><span class=s1>&#39;n&#39;</span>
<a id=__codelineno-27-211 name=__codelineno-27-211 href=#__codelineno-27-211></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-27-212 name=__codelineno-27-212 href=#__codelineno-27-212></a><span class=o>}</span>
<a id=__codelineno-27-213 name=__codelineno-27-213 href=#__codelineno-27-213></a>
<a id=__codelineno-27-214 name=__codelineno-27-214 href=#__codelineno-27-214></a>
<a id=__codelineno-27-215 name=__codelineno-27-215 href=#__codelineno-27-215></a>Download_Files<span class=o>()</span>
<a id=__codelineno-27-216 name=__codelineno-27-216 href=#__codelineno-27-216></a><span class=o>{</span>
<a id=__codelineno-27-217 name=__codelineno-27-217 href=#__codelineno-27-217></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>URL</span><span class=o>=</span><span class=nv>$1</span>
<a id=__codelineno-27-218 name=__codelineno-27-218 href=#__codelineno-27-218></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>FileName</span><span class=o>=</span><span class=nv>$2</span>
<a id=__codelineno-27-219 name=__codelineno-27-219 href=#__codelineno-27-219></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-s<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>FileName</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-27-220 name=__codelineno-27-220 href=#__codelineno-27-220></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>FileName</span><span class=si>}</span><span class=s2> [found]&quot;</span>
<a id=__codelineno-27-221 name=__codelineno-27-221 href=#__codelineno-27-221></a><span class=w>    </span><span class=k>else</span>
<a id=__codelineno-27-222 name=__codelineno-27-222 href=#__codelineno-27-222></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Notice: </span><span class=si>${</span><span class=nv>FileName</span><span class=si>}</span><span class=s2> not found!!!download now...&quot;</span>
<a id=__codelineno-27-223 name=__codelineno-27-223 href=#__codelineno-27-223></a><span class=w>        </span>wget<span class=w> </span>-c<span class=w> </span>--progress<span class=o>=</span>bar:force<span class=w> </span>--prefer-family<span class=o>=</span>IPv4<span class=w> </span>--no-check-certificate<span class=w> </span><span class=si>${</span><span class=nv>URL</span><span class=si>}</span>
<a id=__codelineno-27-224 name=__codelineno-27-224 href=#__codelineno-27-224></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-27-225 name=__codelineno-27-225 href=#__codelineno-27-225></a><span class=o>}</span>
<a id=__codelineno-27-226 name=__codelineno-27-226 href=#__codelineno-27-226></a>
<a id=__codelineno-27-227 name=__codelineno-27-227 href=#__codelineno-27-227></a><span class=c1>#批量安装基础包</span>
<a id=__codelineno-27-228 name=__codelineno-27-228 href=#__codelineno-27-228></a>CentOS_Dependent<span class=o>()</span>
<a id=__codelineno-27-229 name=__codelineno-27-229 href=#__codelineno-27-229></a><span class=o>{</span>
<a id=__codelineno-27-230 name=__codelineno-27-230 href=#__codelineno-27-230></a><span class=w>    </span><span class=se>\c</span>p<span class=w> </span>/etc/yum.conf<span class=w> </span>/etc/yum.conf.lnmp
<a id=__codelineno-27-231 name=__codelineno-27-231 href=#__codelineno-27-231></a><span class=w>    </span>sed<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;s:exclude=.*:exclude=:g&#39;</span><span class=w> </span>/etc/yum.conf
<a id=__codelineno-27-232 name=__codelineno-27-232 href=#__codelineno-27-232></a>
<a id=__codelineno-27-233 name=__codelineno-27-233 href=#__codelineno-27-233></a><span class=w>    </span>Echo_Blue<span class=w> </span><span class=s2>&quot;[+] Yum installing dependent packages...&quot;</span>
<a id=__codelineno-27-234 name=__codelineno-27-234 href=#__codelineno-27-234></a><span class=w>    </span><span class=k>for</span><span class=w> </span>packages<span class=w> </span><span class=k>in</span><span class=w> </span>make<span class=w> </span>cmake<span class=w> </span>gcc<span class=w> </span>gcc-c++<span class=w> </span>gcc-g77<span class=w> </span>flex<span class=w> </span>bison<span class=w> </span>file<span class=w> </span>libtool<span class=w> </span>libtool-libs<span class=w> </span>autoconf<span class=w> </span>kernel-devel<span class=w> </span>patch<span class=w> </span>wget<span class=w> </span>crontabs<span class=w> </span>libjpeg<span class=w> </span>libjpeg-devel<span class=w> </span>libpng<span class=w> </span>libpng-devel<span class=w> </span>libpng10<span class=w> </span>libpng10-devel<span class=w> </span>gd<span class=w> </span>gd-devel<span class=w> </span>libxml2<span class=w> </span>libxml2-devel<span class=w> </span>zlib<span class=w> </span>zlib-devel<span class=w> </span>glib2<span class=w> </span>glib2-devel<span class=w> </span>unzip<span class=w> </span>tar<span class=w> </span>bzip2<span class=w> </span>bzip2-devel<span class=w> </span>libevent<span class=w> </span>libevent-devel<span class=w> </span>ncurses<span class=w> </span>ncurses-devel<span class=w> </span>curl<span class=w> </span>curl-devel<span class=w> </span>libcurl<span class=w> </span>libcurl-devel<span class=w> </span>e2fsprogs<span class=w> </span>e2fsprogs-devel<span class=w> </span>krb5<span class=w> </span>krb5-devel<span class=w> </span>libidn<span class=w> </span>libidn-devel<span class=w> </span>openssl<span class=w> </span>openssl-devel<span class=w> </span>vim-minimal<span class=w> </span>gettext<span class=w> </span>gettext-devel<span class=w> </span>ncurses-devel<span class=w> </span>gmp-devel<span class=w> </span>pspell-devel<span class=w> </span>unzip<span class=w> </span>libcap<span class=w> </span>diffutils<span class=w> </span>ca-certificates<span class=w> </span>net-tools<span class=w> </span>libc-client-devel<span class=w> </span>psmisc<span class=w> </span>libXpm-devel<span class=w> </span>git-core<span class=w> </span>c-ares-devel<span class=w> </span>libicu-devel<span class=w> </span>libxslt<span class=w> </span>libxslt-devel<span class=w> </span>xz<span class=p>;</span>
<a id=__codelineno-27-235 name=__codelineno-27-235 href=#__codelineno-27-235></a><span class=w>    </span><span class=k>do</span><span class=w> </span>yum<span class=w> </span>-y<span class=w> </span>install<span class=w> </span><span class=nv>$packages</span><span class=p>;</span><span class=w> </span><span class=k>done</span>
<a id=__codelineno-27-236 name=__codelineno-27-236 href=#__codelineno-27-236></a>
<a id=__codelineno-27-237 name=__codelineno-27-237 href=#__codelineno-27-237></a><span class=w>    </span>mv<span class=w> </span>-f<span class=w> </span>/etc/yum.conf.lnmp<span class=w> </span>/etc/yum.conf
<a id=__codelineno-27-238 name=__codelineno-27-238 href=#__codelineno-27-238></a><span class=o>}</span>
<a id=__codelineno-27-239 name=__codelineno-27-239 href=#__codelineno-27-239></a>
<a id=__codelineno-27-240 name=__codelineno-27-240 href=#__codelineno-27-240></a>
<a id=__codelineno-27-241 name=__codelineno-27-241 href=#__codelineno-27-241></a><span class=c1>#设置cron计划任务</span>
<a id=__codelineno-27-242 name=__codelineno-27-242 href=#__codelineno-27-242></a>Crontab_func<span class=o>(){</span>
<a id=__codelineno-27-243 name=__codelineno-27-243 href=#__codelineno-27-243></a><span class=c1>#!/bin/bash</span>
<a id=__codelineno-27-244 name=__codelineno-27-244 href=#__codelineno-27-244></a>cat<span class=w>  </span><span class=s>&lt;&lt;EOF &gt; /var/spool/cron/root</span>
<a id=__codelineno-27-245 name=__codelineno-27-245 href=#__codelineno-27-245></a><span class=s>*/30 * * * * sh /home/cheungssh/mysite/mysite/cheungssh/cheungssh_demo.sh 2&gt;&gt;/home/cheungssh/logs/demo.log  &gt;&gt; /home/cheungssh/logs/demo.log</span>
<a id=__codelineno-27-246 name=__codelineno-27-246 href=#__codelineno-27-246></a><span class=s>EOF</span>
<a id=__codelineno-27-247 name=__codelineno-27-247 href=#__codelineno-27-247></a><span class=o>}</span>
<a id=__codelineno-27-248 name=__codelineno-27-248 href=#__codelineno-27-248></a>
<a id=__codelineno-27-249 name=__codelineno-27-249 href=#__codelineno-27-249></a>
<a id=__codelineno-27-250 name=__codelineno-27-250 href=#__codelineno-27-250></a>
<a id=__codelineno-27-251 name=__codelineno-27-251 href=#__codelineno-27-251></a><span class=c1>#判断进程信息，杀掉进程</span>
<a id=__codelineno-27-252 name=__codelineno-27-252 href=#__codelineno-27-252></a>kill_Process<span class=o>(){</span>
<a id=__codelineno-27-253 name=__codelineno-27-253 href=#__codelineno-27-253></a>ps<span class=w> </span>-fel<span class=p>|</span>grep<span class=w> </span>websocket_server_cheung.py<span class=p>|</span>grep<span class=w>  </span>-v<span class=w> </span><span class=s2>&quot;</span><span class=nv>$$</span><span class=s2>&quot;</span><span class=p>|</span>awk<span class=w>  </span><span class=s1>&#39;{print  $4}&#39;</span><span class=p>|</span>xargs<span class=w> </span>-i<span class=w> </span><span class=nb>kill</span><span class=w>  </span>-9<span class=w> </span><span class=o>{}</span>
<a id=__codelineno-27-254 name=__codelineno-27-254 href=#__codelineno-27-254></a><span class=o>}</span>
<a id=__codelineno-27-255 name=__codelineno-27-255 href=#__codelineno-27-255></a>
<a id=__codelineno-27-256 name=__codelineno-27-256 href=#__codelineno-27-256></a><span class=c1>#获取MD5值</span>
<a id=__codelineno-27-257 name=__codelineno-27-257 href=#__codelineno-27-257></a>MD5_value<span class=o>(){</span>
<a id=__codelineno-27-258 name=__codelineno-27-258 href=#__codelineno-27-258></a>md5sum<span class=w> </span>/etc/hosts<span class=w> </span><span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;{print $1}&#39;</span>
<a id=__codelineno-27-259 name=__codelineno-27-259 href=#__codelineno-27-259></a>
<a id=__codelineno-27-260 name=__codelineno-27-260 href=#__codelineno-27-260></a><span class=o>}</span>
<a id=__codelineno-27-261 name=__codelineno-27-261 href=#__codelineno-27-261></a>
<a id=__codelineno-27-262 name=__codelineno-27-262 href=#__codelineno-27-262></a><span class=nv>data_format</span><span class=o>=</span><span class=s2>&quot;+%Y-%m-%d %H:%M:%S&quot;</span>
<a id=__codelineno-27-263 name=__codelineno-27-263 href=#__codelineno-27-263></a>
<a id=__codelineno-27-264 name=__codelineno-27-264 href=#__codelineno-27-264></a><span class=c1>#记录日志的function</span>
<a id=__codelineno-27-265 name=__codelineno-27-265 href=#__codelineno-27-265></a><span class=k>function</span><span class=w> </span>fnLogInfo<span class=o>()</span>
<a id=__codelineno-27-266 name=__codelineno-27-266 href=#__codelineno-27-266></a><span class=o>{</span>
<a id=__codelineno-27-267 name=__codelineno-27-267 href=#__codelineno-27-267></a><span class=w>        </span><span class=nb>local</span><span class=w> </span><span class=nv>infomsg</span><span class=o>=</span><span class=nv>$1</span>
<a id=__codelineno-27-268 name=__codelineno-27-268 href=#__codelineno-27-268></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=si>${</span><span class=nv>infomsg</span><span class=si>}</span>
<a id=__codelineno-27-269 name=__codelineno-27-269 href=#__codelineno-27-269></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=sb>`</span>date<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>data_format</span><span class=si>}</span><span class=s2>&quot;</span><span class=sb>`</span><span class=w> </span><span class=s2>&quot;Info:</span><span class=si>${</span><span class=nv>infomsg</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span><span class=si>${</span><span class=nv>log_file</span><span class=si>}</span>
<a id=__codelineno-27-270 name=__codelineno-27-270 href=#__codelineno-27-270></a><span class=o>}</span>
<a id=__codelineno-27-271 name=__codelineno-27-271 href=#__codelineno-27-271></a>
<a id=__codelineno-27-272 name=__codelineno-27-272 href=#__codelineno-27-272></a>
<a id=__codelineno-27-273 name=__codelineno-27-273 href=#__codelineno-27-273></a><span class=c1>#scritps path</span>
<a id=__codelineno-27-274 name=__codelineno-27-274 href=#__codelineno-27-274></a>dir_path<span class=o>(){</span>
<a id=__codelineno-27-275 name=__codelineno-27-275 href=#__codelineno-27-275></a><span class=nv>pwd</span><span class=o>=</span><span class=sb>`</span>dirname<span class=w> </span><span class=nv>$0</span><span class=sb>`</span>
<a id=__codelineno-27-276 name=__codelineno-27-276 href=#__codelineno-27-276></a><span class=o>}</span>
</code></pre></div> <h2 id=linux下function函数库参考>Linux下function函数库参考<a class=headerlink href=#linux下function函数库参考 title="Permanent link">&para;</a></h2> <ul> <li> <p>在cenntos7 中 <code>/etc/init.d/functions</code> 是系统自带的函数库。</p> </li> <li> <p>在 Ubuntu 20.04 中，类似于 <code>/etc/init.d/functions</code> 的系统自带的函数库 functions.sh 可以在 <code>/lib/lsb/init-functions</code>路径下找到。</p> </li> </ul> <div class=highlight><pre><span></span><code><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a><span class=ch>#!/usr/bin/env bash</span>
<a id=__codelineno-28-2 name=__codelineno-28-2 href=#__codelineno-28-2></a><span class=c1># -*-Shell-script-*-</span>
<a id=__codelineno-28-3 name=__codelineno-28-3 href=#__codelineno-28-3></a><span class=c1>#</span>
<a id=__codelineno-28-4 name=__codelineno-28-4 href=#__codelineno-28-4></a><span class=c1># functions This file contains functions to be used by most or all</span>
<a id=__codelineno-28-5 name=__codelineno-28-5 href=#__codelineno-28-5></a><span class=c1>#       shell scripts in the /etc/init.d directory.</span>
<a id=__codelineno-28-6 name=__codelineno-28-6 href=#__codelineno-28-6></a><span class=c1>#</span>
<a id=__codelineno-28-7 name=__codelineno-28-7 href=#__codelineno-28-7></a>
<a id=__codelineno-28-8 name=__codelineno-28-8 href=#__codelineno-28-8></a>:<span class=s>&lt;&lt;EOF</span>
<a id=__codelineno-28-9 name=__codelineno-28-9 href=#__codelineno-28-9></a>
<a id=__codelineno-28-10 name=__codelineno-28-10 href=#__codelineno-28-10></a><span class=s>checkpid():检查是否已存在pid，如果有一个存在，返回0（通过查看/proc目录）</span>
<a id=__codelineno-28-11 name=__codelineno-28-11 href=#__codelineno-28-11></a>
<a id=__codelineno-28-12 name=__codelineno-28-12 href=#__codelineno-28-12></a><span class=s>daemon:启动某个服务。/etc/init.d目录部分脚本的start使用到这个</span>
<a id=__codelineno-28-13 name=__codelineno-28-13 href=#__codelineno-28-13></a>
<a id=__codelineno-28-14 name=__codelineno-28-14 href=#__codelineno-28-14></a><span class=s>killproc():杀死某个进程。/etc/init.d目录部分脚本的stop使用到这个</span>
<a id=__codelineno-28-15 name=__codelineno-28-15 href=#__codelineno-28-15></a>
<a id=__codelineno-28-16 name=__codelineno-28-16 href=#__codelineno-28-16></a><span class=s>pidfileofproc():寻找某个进程的pid</span>
<a id=__codelineno-28-17 name=__codelineno-28-17 href=#__codelineno-28-17></a>
<a id=__codelineno-28-18 name=__codelineno-28-18 href=#__codelineno-28-18></a><span class=s>pidofproc():类似上面的，只是还查找了pidof命令</span>
<a id=__codelineno-28-19 name=__codelineno-28-19 href=#__codelineno-28-19></a>
<a id=__codelineno-28-20 name=__codelineno-28-20 href=#__codelineno-28-20></a><span class=s>status():返回一个服务的状态</span>
<a id=__codelineno-28-21 name=__codelineno-28-21 href=#__codelineno-28-21></a>
<a id=__codelineno-28-22 name=__codelineno-28-22 href=#__codelineno-28-22></a><span class=s>echo_success():打印OK</span>
<a id=__codelineno-28-23 name=__codelineno-28-23 href=#__codelineno-28-23></a>
<a id=__codelineno-28-24 name=__codelineno-28-24 href=#__codelineno-28-24></a><span class=s>echo_failure():打印FAILED</span>
<a id=__codelineno-28-25 name=__codelineno-28-25 href=#__codelineno-28-25></a>
<a id=__codelineno-28-26 name=__codelineno-28-26 href=#__codelineno-28-26></a><span class=s>echo_passed():打印PASSED</span>
<a id=__codelineno-28-27 name=__codelineno-28-27 href=#__codelineno-28-27></a>
<a id=__codelineno-28-28 name=__codelineno-28-28 href=#__codelineno-28-28></a><span class=s>echo_warning():打印WARNING</span>
<a id=__codelineno-28-29 name=__codelineno-28-29 href=#__codelineno-28-29></a>
<a id=__codelineno-28-30 name=__codelineno-28-30 href=#__codelineno-28-30></a><span class=s>success():打印OK并记录日志</span>
<a id=__codelineno-28-31 name=__codelineno-28-31 href=#__codelineno-28-31></a>
<a id=__codelineno-28-32 name=__codelineno-28-32 href=#__codelineno-28-32></a><span class=s>failure():打印FAILED并记录日志</span>
<a id=__codelineno-28-33 name=__codelineno-28-33 href=#__codelineno-28-33></a>
<a id=__codelineno-28-34 name=__codelineno-28-34 href=#__codelineno-28-34></a><span class=s>passed():打印PASSED并记录日志</span>
<a id=__codelineno-28-35 name=__codelineno-28-35 href=#__codelineno-28-35></a>
<a id=__codelineno-28-36 name=__codelineno-28-36 href=#__codelineno-28-36></a><span class=s>action():打印某个信息并执行给定的命令，它会根据命令执行的结果来调用 success,failure方法</span>
<a id=__codelineno-28-37 name=__codelineno-28-37 href=#__codelineno-28-37></a>
<a id=__codelineno-28-38 name=__codelineno-28-38 href=#__codelineno-28-38></a><span class=s>strstr():判断$1是否含有$2</span>
<a id=__codelineno-28-39 name=__codelineno-28-39 href=#__codelineno-28-39></a>
<a id=__codelineno-28-40 name=__codelineno-28-40 href=#__codelineno-28-40></a><span class=s>confirm:显示 “Start service $1 (Y)es/(N)o/(C)ontinue? [Y]“的提示信息，并返回选择结果</span>
<a id=__codelineno-28-41 name=__codelineno-28-41 href=#__codelineno-28-41></a>
<a id=__codelineno-28-42 name=__codelineno-28-42 href=#__codelineno-28-42></a><span class=s>is_ignored_file():检查$1文件是否是*.bak、*.orig、*.rpmnew....等文件</span>
<a id=__codelineno-28-43 name=__codelineno-28-43 href=#__codelineno-28-43></a>
<a id=__codelineno-28-44 name=__codelineno-28-44 href=#__codelineno-28-44></a><span class=s>is_true()/is_false():交互式yes|no的选项</span>
<a id=__codelineno-28-45 name=__codelineno-28-45 href=#__codelineno-28-45></a>
<a id=__codelineno-28-46 name=__codelineno-28-46 href=#__codelineno-28-46></a><span class=s>apply_sysctl()应用sysctl设置，包括/etc/sysctl.d中的文件</span>
<a id=__codelineno-28-47 name=__codelineno-28-47 href=#__codelineno-28-47></a>
<a id=__codelineno-28-48 name=__codelineno-28-48 href=#__codelineno-28-48></a><span class=s>EOF</span>
<a id=__codelineno-28-49 name=__codelineno-28-49 href=#__codelineno-28-49></a>
<a id=__codelineno-28-50 name=__codelineno-28-50 href=#__codelineno-28-50></a>
<a id=__codelineno-28-51 name=__codelineno-28-51 href=#__codelineno-28-51></a><span class=nv>TEXTDOMAIN</span><span class=o>=</span>initscripts
<a id=__codelineno-28-52 name=__codelineno-28-52 href=#__codelineno-28-52></a>
<a id=__codelineno-28-53 name=__codelineno-28-53 href=#__codelineno-28-53></a><span class=c1># Make sure umask is sane</span>
<a id=__codelineno-28-54 name=__codelineno-28-54 href=#__codelineno-28-54></a><span class=nb>umask</span><span class=w> </span><span class=m>022</span>
<a id=__codelineno-28-55 name=__codelineno-28-55 href=#__codelineno-28-55></a>
<a id=__codelineno-28-56 name=__codelineno-28-56 href=#__codelineno-28-56></a><span class=c1># Set up a default search path.</span>
<a id=__codelineno-28-57 name=__codelineno-28-57 href=#__codelineno-28-57></a><span class=nv>PATH</span><span class=o>=</span><span class=s2>&quot;/sbin:/usr/sbin:/bin:/usr/bin&quot;</span>
<a id=__codelineno-28-58 name=__codelineno-28-58 href=#__codelineno-28-58></a>
<a id=__codelineno-28-59 name=__codelineno-28-59 href=#__codelineno-28-59></a><span class=c1>#导出环境变量</span>
<a id=__codelineno-28-60 name=__codelineno-28-60 href=#__codelineno-28-60></a><span class=nb>export</span><span class=w> </span>PATH
<a id=__codelineno-28-61 name=__codelineno-28-61 href=#__codelineno-28-61></a>
<a id=__codelineno-28-62 name=__codelineno-28-62 href=#__codelineno-28-62></a>
<a id=__codelineno-28-63 name=__codelineno-28-63 href=#__codelineno-28-63></a><span class=c1>#判断PPID和字符串否为空</span>
<a id=__codelineno-28-64 name=__codelineno-28-64 href=#__codelineno-28-64></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=nv>$PPID</span><span class=w> </span>-ne<span class=w> </span><span class=m>1</span><span class=w> </span>-a<span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=nv>$SYSTEMCTL_SKIP_REDIRECT</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-28-65 name=__codelineno-28-65 href=#__codelineno-28-65></a><span class=w>        </span><span class=o>[</span><span class=w> </span>-d<span class=w> </span>/run/systemd/system<span class=w> </span><span class=o>]</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-28-66 name=__codelineno-28-66 href=#__codelineno-28-66></a><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$0</span><span class=s2>&quot;</span><span class=w> </span><span class=k>in</span>
<a id=__codelineno-28-67 name=__codelineno-28-67 href=#__codelineno-28-67></a><span class=w>    </span>/etc/init.d/*<span class=p>|</span>/etc/rc.d/init.d/*<span class=o>)</span>
<a id=__codelineno-28-68 name=__codelineno-28-68 href=#__codelineno-28-68></a><span class=w>        </span><span class=nv>_use_systemctl</span><span class=o>=</span><span class=m>1</span>
<a id=__codelineno-28-69 name=__codelineno-28-69 href=#__codelineno-28-69></a><span class=w>        </span><span class=p>;;</span>
<a id=__codelineno-28-70 name=__codelineno-28-70 href=#__codelineno-28-70></a><span class=w>    </span><span class=k>esac</span>
<a id=__codelineno-28-71 name=__codelineno-28-71 href=#__codelineno-28-71></a><span class=k>fi</span>
<a id=__codelineno-28-72 name=__codelineno-28-72 href=#__codelineno-28-72></a>
<a id=__codelineno-28-73 name=__codelineno-28-73 href=#__codelineno-28-73></a>systemctl_redirect<span class=w> </span><span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-28-74 name=__codelineno-28-74 href=#__codelineno-28-74></a><span class=w>    </span><span class=nb>local</span><span class=w> </span>s
<a id=__codelineno-28-75 name=__codelineno-28-75 href=#__codelineno-28-75></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>prog</span><span class=o>=</span><span class=si>${</span><span class=nv>1</span><span class=p>##*/</span><span class=si>}</span>
<a id=__codelineno-28-76 name=__codelineno-28-76 href=#__codelineno-28-76></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>command</span><span class=o>=</span><span class=nv>$2</span>
<a id=__codelineno-28-77 name=__codelineno-28-77 href=#__codelineno-28-77></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>options</span><span class=o>=</span><span class=s2>&quot;&quot;</span>
<a id=__codelineno-28-78 name=__codelineno-28-78 href=#__codelineno-28-78></a>
<a id=__codelineno-28-79 name=__codelineno-28-79 href=#__codelineno-28-79></a><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$command</span><span class=s2>&quot;</span><span class=w> </span><span class=k>in</span>
<a id=__codelineno-28-80 name=__codelineno-28-80 href=#__codelineno-28-80></a><span class=w>    </span>start<span class=o>)</span>
<a id=__codelineno-28-81 name=__codelineno-28-81 href=#__codelineno-28-81></a><span class=w>        </span><span class=nv>s</span><span class=o>=</span>$<span class=s2>&quot;Starting </span><span class=nv>$prog</span><span class=s2> (via systemctl): &quot;</span>
<a id=__codelineno-28-82 name=__codelineno-28-82 href=#__codelineno-28-82></a><span class=w>        </span><span class=p>;;</span>
<a id=__codelineno-28-83 name=__codelineno-28-83 href=#__codelineno-28-83></a><span class=w>    </span>stop<span class=o>)</span>
<a id=__codelineno-28-84 name=__codelineno-28-84 href=#__codelineno-28-84></a><span class=w>        </span><span class=nv>s</span><span class=o>=</span>$<span class=s2>&quot;Stopping </span><span class=nv>$prog</span><span class=s2> (via systemctl): &quot;</span>
<a id=__codelineno-28-85 name=__codelineno-28-85 href=#__codelineno-28-85></a><span class=w>        </span><span class=p>;;</span>
<a id=__codelineno-28-86 name=__codelineno-28-86 href=#__codelineno-28-86></a><span class=w>    </span>reload<span class=p>|</span>try-reload<span class=o>)</span>
<a id=__codelineno-28-87 name=__codelineno-28-87 href=#__codelineno-28-87></a><span class=w>        </span><span class=nv>s</span><span class=o>=</span>$<span class=s2>&quot;Reloading </span><span class=nv>$prog</span><span class=s2> configuration (via systemctl): &quot;</span>
<a id=__codelineno-28-88 name=__codelineno-28-88 href=#__codelineno-28-88></a><span class=w>        </span><span class=p>;;</span>
<a id=__codelineno-28-89 name=__codelineno-28-89 href=#__codelineno-28-89></a><span class=w>    </span>restart<span class=p>|</span>try-restart<span class=p>|</span>condrestart<span class=o>)</span>
<a id=__codelineno-28-90 name=__codelineno-28-90 href=#__codelineno-28-90></a><span class=w>        </span><span class=nv>s</span><span class=o>=</span>$<span class=s2>&quot;Restarting </span><span class=nv>$prog</span><span class=s2> (via systemctl): &quot;</span>
<a id=__codelineno-28-91 name=__codelineno-28-91 href=#__codelineno-28-91></a><span class=w>        </span><span class=p>;;</span>
<a id=__codelineno-28-92 name=__codelineno-28-92 href=#__codelineno-28-92></a><span class=w>    </span><span class=k>esac</span>
<a id=__codelineno-28-93 name=__codelineno-28-93 href=#__codelineno-28-93></a>
<a id=__codelineno-28-94 name=__codelineno-28-94 href=#__codelineno-28-94></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=nv>$SYSTEMCTL_IGNORE_DEPENDENCIES</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-28-95 name=__codelineno-28-95 href=#__codelineno-28-95></a><span class=w>        </span><span class=nv>options</span><span class=o>=</span><span class=s2>&quot;--ignore-dependencies&quot;</span>
<a id=__codelineno-28-96 name=__codelineno-28-96 href=#__codelineno-28-96></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-28-97 name=__codelineno-28-97 href=#__codelineno-28-97></a>
<a id=__codelineno-28-98 name=__codelineno-28-98 href=#__codelineno-28-98></a><span class=w>    </span><span class=k>if</span><span class=w> </span>!<span class=w> </span>systemctl<span class=w> </span>show<span class=w> </span><span class=s2>&quot;</span><span class=nv>$prog</span><span class=s2>.service&quot;</span><span class=w> </span>&gt;<span class=w> </span>/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-28-99 name=__codelineno-28-99 href=#__codelineno-28-99></a><span class=w>            </span>systemctl<span class=w> </span>show<span class=w> </span>-p<span class=w> </span>LoadState<span class=w> </span><span class=s2>&quot;</span><span class=nv>$prog</span><span class=s2>.service&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>-q<span class=w> </span><span class=s1>&#39;not-found&#39;</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-28-100 name=__codelineno-28-100 href=#__codelineno-28-100></a><span class=w>        </span>action<span class=w> </span><span class=s2>$&quot;Reloading systemd: &quot;</span><span class=w> </span>/bin/systemctl<span class=w> </span>daemon-reload
<a id=__codelineno-28-101 name=__codelineno-28-101 href=#__codelineno-28-101></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-28-102 name=__codelineno-28-102 href=#__codelineno-28-102></a>
<a id=__codelineno-28-103 name=__codelineno-28-103 href=#__codelineno-28-103></a><span class=w>    </span>action<span class=w> </span><span class=s2>&quot;</span><span class=nv>$s</span><span class=s2>&quot;</span><span class=w> </span>/bin/systemctl<span class=w> </span><span class=nv>$options</span><span class=w> </span><span class=nv>$command</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$prog</span><span class=s2>.service&quot;</span>
<a id=__codelineno-28-104 name=__codelineno-28-104 href=#__codelineno-28-104></a><span class=o>}</span>
<a id=__codelineno-28-105 name=__codelineno-28-105 href=#__codelineno-28-105></a>
<a id=__codelineno-28-106 name=__codelineno-28-106 href=#__codelineno-28-106></a><span class=c1># Get a sane screen width</span>
<a id=__codelineno-28-107 name=__codelineno-28-107 href=#__codelineno-28-107></a><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>COLUMNS</span><span class=k>:-</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nv>COLUMNS</span><span class=o>=</span><span class=m>80</span>
<a id=__codelineno-28-108 name=__codelineno-28-108 href=#__codelineno-28-108></a>
<a id=__codelineno-28-109 name=__codelineno-28-109 href=#__codelineno-28-109></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>CONSOLETYPE</span><span class=k>:-</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-28-110 name=__codelineno-28-110 href=#__codelineno-28-110></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-c<span class=w> </span><span class=s2>&quot;/dev/stderr&quot;</span><span class=w> </span>-a<span class=w> </span>-r<span class=w> </span><span class=s2>&quot;/dev/stderr&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-28-111 name=__codelineno-28-111 href=#__codelineno-28-111></a><span class=w>        </span><span class=nv>CONSOLETYPE</span><span class=o>=</span><span class=s2>&quot;</span><span class=k>$(</span>/sbin/consoletype<span class=w> </span>&lt;<span class=w> </span>/dev/stderr<span class=w> </span><span class=m>2</span>&gt;/dev/null<span class=k>)</span><span class=s2>&quot;</span>
<a id=__codelineno-28-112 name=__codelineno-28-112 href=#__codelineno-28-112></a><span class=w>    </span><span class=k>else</span>
<a id=__codelineno-28-113 name=__codelineno-28-113 href=#__codelineno-28-113></a><span class=w>        </span><span class=nv>CONSOLETYPE</span><span class=o>=</span><span class=s2>&quot;serial&quot;</span>
<a id=__codelineno-28-114 name=__codelineno-28-114 href=#__codelineno-28-114></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-28-115 name=__codelineno-28-115 href=#__codelineno-28-115></a><span class=k>fi</span>
<a id=__codelineno-28-116 name=__codelineno-28-116 href=#__codelineno-28-116></a>
<a id=__codelineno-28-117 name=__codelineno-28-117 href=#__codelineno-28-117></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>NOLOCALE</span><span class=k>:-</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>LANGSH_SOURCED</span><span class=k>:-</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-28-118 name=__codelineno-28-118 href=#__codelineno-28-118></a><span class=w>        </span><span class=o>[</span><span class=w> </span>-f<span class=w> </span>/etc/sysconfig/i18n<span class=w> </span>-o<span class=w> </span>-f<span class=w> </span>/etc/locale.conf<span class=w> </span><span class=o>]</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-28-119 name=__codelineno-28-119 href=#__codelineno-28-119></a><span class=w>    </span>.<span class=w> </span>/etc/profile.d/lang.sh<span class=w> </span><span class=m>2</span>&gt;/dev/null
<a id=__codelineno-28-120 name=__codelineno-28-120 href=#__codelineno-28-120></a><span class=w>    </span><span class=c1># avoid propagating LANGSH_SOURCED any further</span>
<a id=__codelineno-28-121 name=__codelineno-28-121 href=#__codelineno-28-121></a><span class=w>    </span><span class=nb>unset</span><span class=w> </span>LANGSH_SOURCED
<a id=__codelineno-28-122 name=__codelineno-28-122 href=#__codelineno-28-122></a><span class=k>fi</span>
<a id=__codelineno-28-123 name=__codelineno-28-123 href=#__codelineno-28-123></a>
<a id=__codelineno-28-124 name=__codelineno-28-124 href=#__codelineno-28-124></a><span class=c1># Read in our configuration</span>
<a id=__codelineno-28-125 name=__codelineno-28-125 href=#__codelineno-28-125></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>BOOTUP</span><span class=k>:-</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-28-126 name=__codelineno-28-126 href=#__codelineno-28-126></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-f<span class=w> </span>/etc/sysconfig/init<span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-28-127 name=__codelineno-28-127 href=#__codelineno-28-127></a><span class=w>        </span>.<span class=w> </span>/etc/sysconfig/init
<a id=__codelineno-28-128 name=__codelineno-28-128 href=#__codelineno-28-128></a><span class=w>    </span><span class=k>else</span>
<a id=__codelineno-28-129 name=__codelineno-28-129 href=#__codelineno-28-129></a><span class=w>        </span><span class=c1># This all seem confusing? Look in /etc/sysconfig/init,</span>
<a id=__codelineno-28-130 name=__codelineno-28-130 href=#__codelineno-28-130></a><span class=w>        </span><span class=c1># or in /usr/share/doc/initscripts-*/sysconfig.txt</span>
<a id=__codelineno-28-131 name=__codelineno-28-131 href=#__codelineno-28-131></a><span class=w>        </span><span class=nv>BOOTUP</span><span class=o>=</span>color
<a id=__codelineno-28-132 name=__codelineno-28-132 href=#__codelineno-28-132></a><span class=w>        </span><span class=nv>RES_COL</span><span class=o>=</span><span class=m>60</span>
<a id=__codelineno-28-133 name=__codelineno-28-133 href=#__codelineno-28-133></a><span class=w>        </span><span class=nv>MOVE_TO_COL</span><span class=o>=</span><span class=s2>&quot;echo -en \\033[</span><span class=si>${</span><span class=nv>RES_COL</span><span class=si>}</span><span class=s2>G&quot;</span>
<a id=__codelineno-28-134 name=__codelineno-28-134 href=#__codelineno-28-134></a><span class=w>        </span><span class=nv>SETCOLOR_SUCCESS</span><span class=o>=</span><span class=s2>&quot;echo -en \\033[1;32m&quot;</span>
<a id=__codelineno-28-135 name=__codelineno-28-135 href=#__codelineno-28-135></a><span class=w>        </span><span class=nv>SETCOLOR_FAILURE</span><span class=o>=</span><span class=s2>&quot;echo -en \\033[1;31m&quot;</span>
<a id=__codelineno-28-136 name=__codelineno-28-136 href=#__codelineno-28-136></a><span class=w>        </span><span class=nv>SETCOLOR_WARNING</span><span class=o>=</span><span class=s2>&quot;echo -en \\033[1;33m&quot;</span>
<a id=__codelineno-28-137 name=__codelineno-28-137 href=#__codelineno-28-137></a><span class=w>        </span><span class=nv>SETCOLOR_NORMAL</span><span class=o>=</span><span class=s2>&quot;echo -en \\033[0;39m&quot;</span>
<a id=__codelineno-28-138 name=__codelineno-28-138 href=#__codelineno-28-138></a><span class=w>        </span><span class=nv>LOGLEVEL</span><span class=o>=</span><span class=m>1</span>
<a id=__codelineno-28-139 name=__codelineno-28-139 href=#__codelineno-28-139></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-28-140 name=__codelineno-28-140 href=#__codelineno-28-140></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$CONSOLETYPE</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;serial&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-28-141 name=__codelineno-28-141 href=#__codelineno-28-141></a><span class=w>        </span><span class=nv>BOOTUP</span><span class=o>=</span>serial
<a id=__codelineno-28-142 name=__codelineno-28-142 href=#__codelineno-28-142></a><span class=w>        </span><span class=nv>MOVE_TO_COL</span><span class=o>=</span>
<a id=__codelineno-28-143 name=__codelineno-28-143 href=#__codelineno-28-143></a><span class=w>        </span><span class=nv>SETCOLOR_SUCCESS</span><span class=o>=</span>
<a id=__codelineno-28-144 name=__codelineno-28-144 href=#__codelineno-28-144></a><span class=w>        </span><span class=nv>SETCOLOR_FAILURE</span><span class=o>=</span>
<a id=__codelineno-28-145 name=__codelineno-28-145 href=#__codelineno-28-145></a><span class=w>        </span><span class=nv>SETCOLOR_WARNING</span><span class=o>=</span>
<a id=__codelineno-28-146 name=__codelineno-28-146 href=#__codelineno-28-146></a><span class=w>        </span><span class=nv>SETCOLOR_NORMAL</span><span class=o>=</span>
<a id=__codelineno-28-147 name=__codelineno-28-147 href=#__codelineno-28-147></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-28-148 name=__codelineno-28-148 href=#__codelineno-28-148></a><span class=k>fi</span>
<a id=__codelineno-28-149 name=__codelineno-28-149 href=#__codelineno-28-149></a>
<a id=__codelineno-28-150 name=__codelineno-28-150 href=#__codelineno-28-150></a><span class=c1># Check if any of $pid (could be plural) are running</span>
<a id=__codelineno-28-151 name=__codelineno-28-151 href=#__codelineno-28-151></a>checkpid<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-28-152 name=__codelineno-28-152 href=#__codelineno-28-152></a><span class=w>    </span><span class=nb>local</span><span class=w> </span>i
<a id=__codelineno-28-153 name=__codelineno-28-153 href=#__codelineno-28-153></a>
<a id=__codelineno-28-154 name=__codelineno-28-154 href=#__codelineno-28-154></a><span class=w>    </span><span class=k>for</span><span class=w> </span>i<span class=w> </span><span class=k>in</span><span class=w> </span><span class=nv>$*</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>do</span>
<a id=__codelineno-28-155 name=__codelineno-28-155 href=#__codelineno-28-155></a><span class=w>        </span><span class=o>[</span><span class=w> </span>-d<span class=w> </span><span class=s2>&quot;/proc/</span><span class=nv>$i</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-28-156 name=__codelineno-28-156 href=#__codelineno-28-156></a><span class=w>    </span><span class=k>done</span>
<a id=__codelineno-28-157 name=__codelineno-28-157 href=#__codelineno-28-157></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-28-158 name=__codelineno-28-158 href=#__codelineno-28-158></a><span class=o>}</span>
<a id=__codelineno-28-159 name=__codelineno-28-159 href=#__codelineno-28-159></a>
<a id=__codelineno-28-160 name=__codelineno-28-160 href=#__codelineno-28-160></a>__kill_pids_term_kill_checkpids<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-28-161 name=__codelineno-28-161 href=#__codelineno-28-161></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>base_stime</span><span class=o>=</span><span class=nv>$1</span>
<a id=__codelineno-28-162 name=__codelineno-28-162 href=#__codelineno-28-162></a><span class=w>    </span><span class=nb>shift</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-28-163 name=__codelineno-28-163 href=#__codelineno-28-163></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>pid</span><span class=o>=</span>
<a id=__codelineno-28-164 name=__codelineno-28-164 href=#__codelineno-28-164></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>pids</span><span class=o>=</span><span class=nv>$*</span>
<a id=__codelineno-28-165 name=__codelineno-28-165 href=#__codelineno-28-165></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>remaining</span><span class=o>=</span>
<a id=__codelineno-28-166 name=__codelineno-28-166 href=#__codelineno-28-166></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>stat</span><span class=o>=</span>
<a id=__codelineno-28-167 name=__codelineno-28-167 href=#__codelineno-28-167></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>stime</span><span class=o>=</span>
<a id=__codelineno-28-168 name=__codelineno-28-168 href=#__codelineno-28-168></a>
<a id=__codelineno-28-169 name=__codelineno-28-169 href=#__codelineno-28-169></a><span class=w>    </span><span class=k>for</span><span class=w> </span>pid<span class=w> </span><span class=k>in</span><span class=w> </span><span class=nv>$pids</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>do</span>
<a id=__codelineno-28-170 name=__codelineno-28-170 href=#__codelineno-28-170></a><span class=w>        </span><span class=o>[</span><span class=w> </span>!<span class=w> </span>-e<span class=w>  </span><span class=s2>&quot;/proc/</span><span class=nv>$pid</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>continue</span>
<a id=__codelineno-28-171 name=__codelineno-28-171 href=#__codelineno-28-171></a><span class=w>        </span><span class=nb>read</span><span class=w> </span>-r<span class=w> </span>line<span class=w> </span>&lt;<span class=w> </span><span class=s2>&quot;/proc/</span><span class=nv>$pid</span><span class=s2>/stat&quot;</span><span class=w> </span><span class=m>2</span>&gt;<span class=w> </span>/dev/null
<a id=__codelineno-28-172 name=__codelineno-28-172 href=#__codelineno-28-172></a>
<a id=__codelineno-28-173 name=__codelineno-28-173 href=#__codelineno-28-173></a><span class=w>        </span><span class=nv>stat</span><span class=o>=(</span><span class=nv>$line</span><span class=o>)</span>
<a id=__codelineno-28-174 name=__codelineno-28-174 href=#__codelineno-28-174></a><span class=w>        </span><span class=nv>stime</span><span class=o>=</span><span class=si>${</span><span class=nv>stat</span><span class=p>[21]</span><span class=si>}</span>
<a id=__codelineno-28-175 name=__codelineno-28-175 href=#__codelineno-28-175></a>
<a id=__codelineno-28-176 name=__codelineno-28-176 href=#__codelineno-28-176></a><span class=w>        </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=nv>$stime</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$base_stime</span><span class=s2>&quot;</span><span class=w> </span>-lt<span class=w> </span><span class=s2>&quot;</span><span class=nv>$stime</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>continue</span>
<a id=__codelineno-28-177 name=__codelineno-28-177 href=#__codelineno-28-177></a><span class=w>        </span><span class=nv>remaining</span><span class=o>+=</span><span class=s2>&quot;</span><span class=nv>$pid</span><span class=s2> &quot;</span>
<a id=__codelineno-28-178 name=__codelineno-28-178 href=#__codelineno-28-178></a><span class=w>    </span><span class=k>done</span>
<a id=__codelineno-28-179 name=__codelineno-28-179 href=#__codelineno-28-179></a>
<a id=__codelineno-28-180 name=__codelineno-28-180 href=#__codelineno-28-180></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$remaining</span><span class=s2>&quot;</span>
<a id=__codelineno-28-181 name=__codelineno-28-181 href=#__codelineno-28-181></a><span class=w>    </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=nv>$remaining</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-28-182 name=__codelineno-28-182 href=#__codelineno-28-182></a>
<a id=__codelineno-28-183 name=__codelineno-28-183 href=#__codelineno-28-183></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-28-184 name=__codelineno-28-184 href=#__codelineno-28-184></a><span class=o>}</span>
<a id=__codelineno-28-185 name=__codelineno-28-185 href=#__codelineno-28-185></a>
<a id=__codelineno-28-186 name=__codelineno-28-186 href=#__codelineno-28-186></a>__kill_pids_term_kill<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-28-187 name=__codelineno-28-187 href=#__codelineno-28-187></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>try</span><span class=o>=</span><span class=m>0</span>
<a id=__codelineno-28-188 name=__codelineno-28-188 href=#__codelineno-28-188></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>delay</span><span class=o>=</span><span class=m>3</span><span class=p>;</span>
<a id=__codelineno-28-189 name=__codelineno-28-189 href=#__codelineno-28-189></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>pid</span><span class=o>=</span>
<a id=__codelineno-28-190 name=__codelineno-28-190 href=#__codelineno-28-190></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>stat</span><span class=o>=(</span><span class=k>$(</span>&lt;<span class=w> </span>/proc/self/stat<span class=k>)</span><span class=o>)</span>
<a id=__codelineno-28-191 name=__codelineno-28-191 href=#__codelineno-28-191></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>base_stime</span><span class=o>=</span><span class=si>${</span><span class=nv>stat</span><span class=p>[21]</span><span class=si>}</span>
<a id=__codelineno-28-192 name=__codelineno-28-192 href=#__codelineno-28-192></a>
<a id=__codelineno-28-193 name=__codelineno-28-193 href=#__codelineno-28-193></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;-d&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-28-194 name=__codelineno-28-194 href=#__codelineno-28-194></a><span class=w>        </span><span class=nv>delay</span><span class=o>=</span><span class=nv>$2</span>
<a id=__codelineno-28-195 name=__codelineno-28-195 href=#__codelineno-28-195></a><span class=w>        </span><span class=nb>shift</span><span class=w> </span><span class=m>2</span>
<a id=__codelineno-28-196 name=__codelineno-28-196 href=#__codelineno-28-196></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-28-197 name=__codelineno-28-197 href=#__codelineno-28-197></a>
<a id=__codelineno-28-198 name=__codelineno-28-198 href=#__codelineno-28-198></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>kill_list</span><span class=o>=</span><span class=nv>$*</span>
<a id=__codelineno-28-199 name=__codelineno-28-199 href=#__codelineno-28-199></a>
<a id=__codelineno-28-200 name=__codelineno-28-200 href=#__codelineno-28-200></a><span class=w>    </span><span class=nv>kill_list</span><span class=o>=</span><span class=k>$(</span>__kill_pids_term_kill_checkpids<span class=w> </span><span class=nv>$base_stime</span><span class=w> </span><span class=nv>$kill_list</span><span class=k>)</span>
<a id=__codelineno-28-201 name=__codelineno-28-201 href=#__codelineno-28-201></a>
<a id=__codelineno-28-202 name=__codelineno-28-202 href=#__codelineno-28-202></a><span class=w>    </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=nv>$kill_list</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-28-203 name=__codelineno-28-203 href=#__codelineno-28-203></a>
<a id=__codelineno-28-204 name=__codelineno-28-204 href=#__codelineno-28-204></a><span class=w>    </span><span class=nb>kill</span><span class=w> </span>-TERM<span class=w> </span><span class=nv>$kill_list</span><span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-28-205 name=__codelineno-28-205 href=#__codelineno-28-205></a><span class=w>    </span>usleep<span class=w> </span><span class=m>100000</span>
<a id=__codelineno-28-206 name=__codelineno-28-206 href=#__codelineno-28-206></a>
<a id=__codelineno-28-207 name=__codelineno-28-207 href=#__codelineno-28-207></a><span class=w>    </span><span class=nv>kill_list</span><span class=o>=</span><span class=k>$(</span>__kill_pids_term_kill_checkpids<span class=w> </span><span class=nv>$base_stime</span><span class=w> </span><span class=nv>$kill_list</span><span class=k>)</span>
<a id=__codelineno-28-208 name=__codelineno-28-208 href=#__codelineno-28-208></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=nv>$kill_list</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-28-209 name=__codelineno-28-209 href=#__codelineno-28-209></a><span class=w>        </span><span class=k>while</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=nv>$try</span><span class=w> </span>-lt<span class=w> </span><span class=nv>$delay</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>do</span>
<a id=__codelineno-28-210 name=__codelineno-28-210 href=#__codelineno-28-210></a><span class=w>            </span>sleep<span class=w> </span><span class=m>1</span>
<a id=__codelineno-28-211 name=__codelineno-28-211 href=#__codelineno-28-211></a><span class=w>            </span><span class=nv>kill_list</span><span class=o>=</span><span class=k>$(</span>__kill_pids_term_kill_checkpids<span class=w> </span><span class=nv>$base_stime</span><span class=w> </span><span class=nv>$kill_list</span><span class=k>)</span>
<a id=__codelineno-28-212 name=__codelineno-28-212 href=#__codelineno-28-212></a><span class=w>            </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=nv>$kill_list</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>break</span>
<a id=__codelineno-28-213 name=__codelineno-28-213 href=#__codelineno-28-213></a><span class=w>            </span><span class=nb>let</span><span class=w> </span><span class=nv>try</span><span class=o>+=</span><span class=m>1</span>
<a id=__codelineno-28-214 name=__codelineno-28-214 href=#__codelineno-28-214></a><span class=w>        </span><span class=k>done</span>
<a id=__codelineno-28-215 name=__codelineno-28-215 href=#__codelineno-28-215></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=nv>$kill_list</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-28-216 name=__codelineno-28-216 href=#__codelineno-28-216></a><span class=w>            </span><span class=nb>kill</span><span class=w> </span>-KILL<span class=w> </span><span class=nv>$kill_list</span><span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-28-217 name=__codelineno-28-217 href=#__codelineno-28-217></a><span class=w>            </span>usleep<span class=w> </span><span class=m>100000</span>
<a id=__codelineno-28-218 name=__codelineno-28-218 href=#__codelineno-28-218></a><span class=w>            </span><span class=nv>kill_list</span><span class=o>=</span><span class=k>$(</span>__kill_pids_term_kill_checkpids<span class=w> </span><span class=nv>$base_stime</span><span class=w> </span><span class=nv>$kill_list</span><span class=k>)</span>
<a id=__codelineno-28-219 name=__codelineno-28-219 href=#__codelineno-28-219></a><span class=w>        </span><span class=k>fi</span>
<a id=__codelineno-28-220 name=__codelineno-28-220 href=#__codelineno-28-220></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-28-221 name=__codelineno-28-221 href=#__codelineno-28-221></a>
<a id=__codelineno-28-222 name=__codelineno-28-222 href=#__codelineno-28-222></a><span class=w>    </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=nv>$kill_list</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-28-223 name=__codelineno-28-223 href=#__codelineno-28-223></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-28-224 name=__codelineno-28-224 href=#__codelineno-28-224></a><span class=o>}</span>
<a id=__codelineno-28-225 name=__codelineno-28-225 href=#__codelineno-28-225></a>
<a id=__codelineno-28-226 name=__codelineno-28-226 href=#__codelineno-28-226></a><span class=c1># __proc_pids {program} [pidfile]</span>
<a id=__codelineno-28-227 name=__codelineno-28-227 href=#__codelineno-28-227></a><span class=c1># Set $pid to pids from /var/run* for {program}.  $pid should be declared</span>
<a id=__codelineno-28-228 name=__codelineno-28-228 href=#__codelineno-28-228></a><span class=c1># local in the caller.</span>
<a id=__codelineno-28-229 name=__codelineno-28-229 href=#__codelineno-28-229></a><span class=c1># Returns LSB exit code for the &#39;status&#39; action.</span>
<a id=__codelineno-28-230 name=__codelineno-28-230 href=#__codelineno-28-230></a>__pids_var_run<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-28-231 name=__codelineno-28-231 href=#__codelineno-28-231></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>base</span><span class=o>=</span><span class=si>${</span><span class=nv>1</span><span class=p>##*/</span><span class=si>}</span>
<a id=__codelineno-28-232 name=__codelineno-28-232 href=#__codelineno-28-232></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>pid_file</span><span class=o>=</span><span class=si>${</span><span class=nv>2</span><span class=k>:-</span><span class=p>/var/run/</span><span class=nv>$base</span><span class=p>.pid</span><span class=si>}</span>
<a id=__codelineno-28-233 name=__codelineno-28-233 href=#__codelineno-28-233></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>pid_dir</span><span class=o>=</span><span class=k>$(</span>/usr/bin/dirname<span class=w> </span><span class=nv>$pid_file</span><span class=w> </span>&gt;<span class=w> </span>/dev/null<span class=k>)</span>
<a id=__codelineno-28-234 name=__codelineno-28-234 href=#__codelineno-28-234></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>binary</span><span class=o>=</span><span class=nv>$3</span>
<a id=__codelineno-28-235 name=__codelineno-28-235 href=#__codelineno-28-235></a>
<a id=__codelineno-28-236 name=__codelineno-28-236 href=#__codelineno-28-236></a><span class=w>    </span><span class=o>[</span><span class=w> </span>-d<span class=w> </span><span class=s2>&quot;</span><span class=nv>$pid_dir</span><span class=s2>&quot;</span><span class=w> </span>-a<span class=w> </span>!<span class=w> </span>-r<span class=w> </span><span class=s2>&quot;</span><span class=nv>$pid_dir</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=m>4</span>
<a id=__codelineno-28-237 name=__codelineno-28-237 href=#__codelineno-28-237></a>
<a id=__codelineno-28-238 name=__codelineno-28-238 href=#__codelineno-28-238></a><span class=w>    </span><span class=nv>pid</span><span class=o>=</span>
<a id=__codelineno-28-239 name=__codelineno-28-239 href=#__codelineno-28-239></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-f<span class=w> </span><span class=s2>&quot;</span><span class=nv>$pid_file</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-28-240 name=__codelineno-28-240 href=#__codelineno-28-240></a><span class=w>            </span><span class=nb>local</span><span class=w> </span>line<span class=w> </span>p
<a id=__codelineno-28-241 name=__codelineno-28-241 href=#__codelineno-28-241></a>
<a id=__codelineno-28-242 name=__codelineno-28-242 href=#__codelineno-28-242></a><span class=w>        </span><span class=o>[</span><span class=w> </span>!<span class=w> </span>-r<span class=w> </span><span class=s2>&quot;</span><span class=nv>$pid_file</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=m>4</span><span class=w> </span><span class=c1># &quot;user had insufficient privilege&quot;</span>
<a id=__codelineno-28-243 name=__codelineno-28-243 href=#__codelineno-28-243></a><span class=w>        </span><span class=k>while</span><span class=w> </span>:<span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>do</span>
<a id=__codelineno-28-244 name=__codelineno-28-244 href=#__codelineno-28-244></a><span class=w>            </span><span class=nb>read</span><span class=w> </span>line
<a id=__codelineno-28-245 name=__codelineno-28-245 href=#__codelineno-28-245></a><span class=w>            </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=nv>$line</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>break</span>
<a id=__codelineno-28-246 name=__codelineno-28-246 href=#__codelineno-28-246></a><span class=w>            </span><span class=k>for</span><span class=w> </span>p<span class=w> </span><span class=k>in</span><span class=w> </span><span class=nv>$line</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>do</span>
<a id=__codelineno-28-247 name=__codelineno-28-247 href=#__codelineno-28-247></a><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>p</span><span class=p>//[0-9]/</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=o>[</span><span class=w> </span>-d<span class=w> </span><span class=s2>&quot;/proc/</span><span class=nv>$p</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-28-248 name=__codelineno-28-248 href=#__codelineno-28-248></a><span class=w>                    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=nv>$binary</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-28-249 name=__codelineno-28-249 href=#__codelineno-28-249></a><span class=w>                        </span><span class=nb>local</span><span class=w> </span><span class=nv>b</span><span class=o>=</span><span class=k>$(</span>readlink<span class=w> </span>/proc/<span class=nv>$p</span>/exe<span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span>-e<span class=w> </span><span class=s1>&#39;s/\s*(deleted)$//&#39;</span><span class=k>)</span>
<a id=__codelineno-28-250 name=__codelineno-28-250 href=#__codelineno-28-250></a><span class=w>                        </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$b</span><span class=s2>&quot;</span><span class=w> </span>!<span class=o>=</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$binary</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>continue</span>
<a id=__codelineno-28-251 name=__codelineno-28-251 href=#__codelineno-28-251></a><span class=w>                    </span><span class=k>fi</span>
<a id=__codelineno-28-252 name=__codelineno-28-252 href=#__codelineno-28-252></a><span class=w>                    </span><span class=nv>pid</span><span class=o>=</span><span class=s2>&quot;</span><span class=nv>$pid</span><span class=s2> </span><span class=nv>$p</span><span class=s2>&quot;</span>
<a id=__codelineno-28-253 name=__codelineno-28-253 href=#__codelineno-28-253></a><span class=w>                </span><span class=k>fi</span>
<a id=__codelineno-28-254 name=__codelineno-28-254 href=#__codelineno-28-254></a><span class=w>            </span><span class=k>done</span>
<a id=__codelineno-28-255 name=__codelineno-28-255 href=#__codelineno-28-255></a><span class=w>        </span><span class=k>done</span><span class=w> </span>&lt;<span class=w> </span><span class=s2>&quot;</span><span class=nv>$pid_file</span><span class=s2>&quot;</span>
<a id=__codelineno-28-256 name=__codelineno-28-256 href=#__codelineno-28-256></a>
<a id=__codelineno-28-257 name=__codelineno-28-257 href=#__codelineno-28-257></a><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=nv>$pid</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-28-258 name=__codelineno-28-258 href=#__codelineno-28-258></a><span class=w>                    </span><span class=k>return</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-28-259 name=__codelineno-28-259 href=#__codelineno-28-259></a><span class=w>            </span><span class=k>fi</span>
<a id=__codelineno-28-260 name=__codelineno-28-260 href=#__codelineno-28-260></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=m>1</span><span class=w> </span><span class=c1># &quot;Program is dead and /var/run pid file exists&quot;</span>
<a id=__codelineno-28-261 name=__codelineno-28-261 href=#__codelineno-28-261></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-28-262 name=__codelineno-28-262 href=#__codelineno-28-262></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=m>3</span><span class=w> </span><span class=c1># &quot;Program is not running&quot;</span>
<a id=__codelineno-28-263 name=__codelineno-28-263 href=#__codelineno-28-263></a><span class=o>}</span>
<a id=__codelineno-28-264 name=__codelineno-28-264 href=#__codelineno-28-264></a>
<a id=__codelineno-28-265 name=__codelineno-28-265 href=#__codelineno-28-265></a><span class=c1># Output PIDs of matching processes, found using pidof</span>
<a id=__codelineno-28-266 name=__codelineno-28-266 href=#__codelineno-28-266></a>__pids_pidof<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-28-267 name=__codelineno-28-267 href=#__codelineno-28-267></a><span class=w>    </span>pidof<span class=w> </span>-c<span class=w> </span>-m<span class=w> </span>-o<span class=w> </span><span class=nv>$$</span><span class=w> </span>-o<span class=w> </span><span class=nv>$PPID</span><span class=w> </span>-o<span class=w> </span>%PPID<span class=w> </span>-x<span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-28-268 name=__codelineno-28-268 href=#__codelineno-28-268></a><span class=w>        </span>pidof<span class=w> </span>-c<span class=w> </span>-m<span class=w> </span>-o<span class=w> </span><span class=nv>$$</span><span class=w> </span>-o<span class=w> </span><span class=nv>$PPID</span><span class=w> </span>-o<span class=w> </span>%PPID<span class=w> </span>-x<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>1</span><span class=p>##*/</span><span class=si>}</span><span class=s2>&quot;</span>
<a id=__codelineno-28-269 name=__codelineno-28-269 href=#__codelineno-28-269></a><span class=o>}</span>
<a id=__codelineno-28-270 name=__codelineno-28-270 href=#__codelineno-28-270></a>
<a id=__codelineno-28-271 name=__codelineno-28-271 href=#__codelineno-28-271></a>
<a id=__codelineno-28-272 name=__codelineno-28-272 href=#__codelineno-28-272></a><span class=c1># A function to start a program.</span>
<a id=__codelineno-28-273 name=__codelineno-28-273 href=#__codelineno-28-273></a>daemon<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-28-274 name=__codelineno-28-274 href=#__codelineno-28-274></a><span class=w>    </span><span class=c1># Test syntax.</span>
<a id=__codelineno-28-275 name=__codelineno-28-275 href=#__codelineno-28-275></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>gotbase</span><span class=o>=</span><span class=w> </span><span class=nv>force</span><span class=o>=</span><span class=w> </span>nicelevel<span class=w> </span>corelimit
<a id=__codelineno-28-276 name=__codelineno-28-276 href=#__codelineno-28-276></a><span class=w>    </span><span class=nb>local</span><span class=w> </span>pid<span class=w> </span><span class=nv>base</span><span class=o>=</span><span class=w> </span><span class=nv>user</span><span class=o>=</span><span class=w> </span><span class=nv>nice</span><span class=o>=</span><span class=w> </span><span class=nv>bg</span><span class=o>=</span><span class=w> </span><span class=nv>pid_file</span><span class=o>=</span>
<a id=__codelineno-28-277 name=__codelineno-28-277 href=#__codelineno-28-277></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>cgroup</span><span class=o>=</span>
<a id=__codelineno-28-278 name=__codelineno-28-278 href=#__codelineno-28-278></a><span class=w>    </span><span class=nv>nicelevel</span><span class=o>=</span><span class=m>0</span>
<a id=__codelineno-28-279 name=__codelineno-28-279 href=#__codelineno-28-279></a><span class=w>    </span><span class=k>while</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span>!<span class=o>=</span><span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>1</span><span class=p>##[-+]</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>do</span>
<a id=__codelineno-28-280 name=__codelineno-28-280 href=#__codelineno-28-280></a><span class=w>        </span><span class=k>case</span><span class=w> </span><span class=nv>$1</span><span class=w> </span><span class=k>in</span>
<a id=__codelineno-28-281 name=__codelineno-28-281 href=#__codelineno-28-281></a><span class=w>        </span><span class=s1>&#39;&#39;</span><span class=o>)</span>
<a id=__codelineno-28-282 name=__codelineno-28-282 href=#__codelineno-28-282></a><span class=w>            </span><span class=nb>echo</span><span class=w> </span>$<span class=s2>&quot;</span><span class=nv>$0</span><span class=s2>: Usage: daemon [+/-nicelevel] {program}&quot;</span><span class=w> </span><span class=s2>&quot;[arg1]...&quot;</span>
<a id=__codelineno-28-283 name=__codelineno-28-283 href=#__codelineno-28-283></a><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-28-284 name=__codelineno-28-284 href=#__codelineno-28-284></a><span class=w>            </span><span class=p>;;</span>
<a id=__codelineno-28-285 name=__codelineno-28-285 href=#__codelineno-28-285></a><span class=w>        </span>--check<span class=o>)</span>
<a id=__codelineno-28-286 name=__codelineno-28-286 href=#__codelineno-28-286></a><span class=w>            </span><span class=nv>base</span><span class=o>=</span><span class=nv>$2</span>
<a id=__codelineno-28-287 name=__codelineno-28-287 href=#__codelineno-28-287></a><span class=w>            </span><span class=nv>gotbase</span><span class=o>=</span><span class=s2>&quot;yes&quot;</span>
<a id=__codelineno-28-288 name=__codelineno-28-288 href=#__codelineno-28-288></a><span class=w>            </span><span class=nb>shift</span><span class=w> </span><span class=m>2</span>
<a id=__codelineno-28-289 name=__codelineno-28-289 href=#__codelineno-28-289></a><span class=w>            </span><span class=p>;;</span>
<a id=__codelineno-28-290 name=__codelineno-28-290 href=#__codelineno-28-290></a><span class=w>        </span>--check<span class=o>=</span>?*<span class=o>)</span>
<a id=__codelineno-28-291 name=__codelineno-28-291 href=#__codelineno-28-291></a><span class=w>            </span><span class=nv>base</span><span class=o>=</span><span class=si>${</span><span class=nv>1</span><span class=p>#--check=</span><span class=si>}</span>
<a id=__codelineno-28-292 name=__codelineno-28-292 href=#__codelineno-28-292></a><span class=w>            </span><span class=nv>gotbase</span><span class=o>=</span><span class=s2>&quot;yes&quot;</span>
<a id=__codelineno-28-293 name=__codelineno-28-293 href=#__codelineno-28-293></a><span class=w>            </span><span class=nb>shift</span>
<a id=__codelineno-28-294 name=__codelineno-28-294 href=#__codelineno-28-294></a><span class=w>            </span><span class=p>;;</span>
<a id=__codelineno-28-295 name=__codelineno-28-295 href=#__codelineno-28-295></a><span class=w>        </span>--user<span class=o>)</span>
<a id=__codelineno-28-296 name=__codelineno-28-296 href=#__codelineno-28-296></a><span class=w>            </span><span class=nv>user</span><span class=o>=</span><span class=nv>$2</span>
<a id=__codelineno-28-297 name=__codelineno-28-297 href=#__codelineno-28-297></a><span class=w>            </span><span class=nb>shift</span><span class=w> </span><span class=m>2</span>
<a id=__codelineno-28-298 name=__codelineno-28-298 href=#__codelineno-28-298></a><span class=w>            </span><span class=p>;;</span>
<a id=__codelineno-28-299 name=__codelineno-28-299 href=#__codelineno-28-299></a><span class=w>        </span>--user<span class=o>=</span>?*<span class=o>)</span>
<a id=__codelineno-28-300 name=__codelineno-28-300 href=#__codelineno-28-300></a><span class=w>            </span><span class=nv>user</span><span class=o>=</span><span class=si>${</span><span class=nv>1</span><span class=p>#--user=</span><span class=si>}</span>
<a id=__codelineno-28-301 name=__codelineno-28-301 href=#__codelineno-28-301></a><span class=w>            </span><span class=nb>shift</span>
<a id=__codelineno-28-302 name=__codelineno-28-302 href=#__codelineno-28-302></a><span class=w>            </span><span class=p>;;</span>
<a id=__codelineno-28-303 name=__codelineno-28-303 href=#__codelineno-28-303></a><span class=w>        </span>--pidfile<span class=o>)</span>
<a id=__codelineno-28-304 name=__codelineno-28-304 href=#__codelineno-28-304></a><span class=w>            </span><span class=nv>pid_file</span><span class=o>=</span><span class=nv>$2</span>
<a id=__codelineno-28-305 name=__codelineno-28-305 href=#__codelineno-28-305></a><span class=w>            </span><span class=nb>shift</span><span class=w> </span><span class=m>2</span>
<a id=__codelineno-28-306 name=__codelineno-28-306 href=#__codelineno-28-306></a><span class=w>            </span><span class=p>;;</span>
<a id=__codelineno-28-307 name=__codelineno-28-307 href=#__codelineno-28-307></a><span class=w>        </span>--pidfile<span class=o>=</span>?*<span class=o>)</span>
<a id=__codelineno-28-308 name=__codelineno-28-308 href=#__codelineno-28-308></a><span class=w>            </span><span class=nv>pid_file</span><span class=o>=</span><span class=si>${</span><span class=nv>1</span><span class=p>#--pidfile=</span><span class=si>}</span>
<a id=__codelineno-28-309 name=__codelineno-28-309 href=#__codelineno-28-309></a><span class=w>            </span><span class=nb>shift</span>
<a id=__codelineno-28-310 name=__codelineno-28-310 href=#__codelineno-28-310></a><span class=w>            </span><span class=p>;;</span>
<a id=__codelineno-28-311 name=__codelineno-28-311 href=#__codelineno-28-311></a><span class=w>        </span>--force<span class=o>)</span>
<a id=__codelineno-28-312 name=__codelineno-28-312 href=#__codelineno-28-312></a><span class=w>            </span><span class=nv>force</span><span class=o>=</span><span class=s2>&quot;force&quot;</span>
<a id=__codelineno-28-313 name=__codelineno-28-313 href=#__codelineno-28-313></a><span class=w>            </span><span class=nb>shift</span>
<a id=__codelineno-28-314 name=__codelineno-28-314 href=#__codelineno-28-314></a><span class=w>            </span><span class=p>;;</span>
<a id=__codelineno-28-315 name=__codelineno-28-315 href=#__codelineno-28-315></a><span class=w>        </span><span class=o>[</span>-+<span class=o>][</span><span class=m>0</span>-9<span class=o>]</span>*<span class=o>)</span>
<a id=__codelineno-28-316 name=__codelineno-28-316 href=#__codelineno-28-316></a><span class=w>            </span><span class=nv>nice</span><span class=o>=</span><span class=s2>&quot;nice -n </span><span class=nv>$1</span><span class=s2>&quot;</span>
<a id=__codelineno-28-317 name=__codelineno-28-317 href=#__codelineno-28-317></a><span class=w>            </span><span class=nb>shift</span>
<a id=__codelineno-28-318 name=__codelineno-28-318 href=#__codelineno-28-318></a><span class=w>            </span><span class=p>;;</span>
<a id=__codelineno-28-319 name=__codelineno-28-319 href=#__codelineno-28-319></a><span class=w>        </span>*<span class=o>)</span>
<a id=__codelineno-28-320 name=__codelineno-28-320 href=#__codelineno-28-320></a><span class=w>            </span><span class=nb>echo</span><span class=w> </span>$<span class=s2>&quot;</span><span class=nv>$0</span><span class=s2>: Usage: daemon [+/-nicelevel] {program}&quot;</span><span class=w> </span><span class=s2>&quot;[arg1]...&quot;</span>
<a id=__codelineno-28-321 name=__codelineno-28-321 href=#__codelineno-28-321></a><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-28-322 name=__codelineno-28-322 href=#__codelineno-28-322></a><span class=w>            </span><span class=p>;;</span>
<a id=__codelineno-28-323 name=__codelineno-28-323 href=#__codelineno-28-323></a><span class=w>      </span><span class=k>esac</span>
<a id=__codelineno-28-324 name=__codelineno-28-324 href=#__codelineno-28-324></a><span class=w>    </span><span class=k>done</span>
<a id=__codelineno-28-325 name=__codelineno-28-325 href=#__codelineno-28-325></a>
<a id=__codelineno-28-326 name=__codelineno-28-326 href=#__codelineno-28-326></a><span class=w>    </span><span class=c1># Save basename.</span>
<a id=__codelineno-28-327 name=__codelineno-28-327 href=#__codelineno-28-327></a><span class=w>    </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=nv>$gotbase</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nv>base</span><span class=o>=</span><span class=si>${</span><span class=nv>1</span><span class=p>##*/</span><span class=si>}</span>
<a id=__codelineno-28-328 name=__codelineno-28-328 href=#__codelineno-28-328></a>
<a id=__codelineno-28-329 name=__codelineno-28-329 href=#__codelineno-28-329></a><span class=w>    </span><span class=c1># See if it&#39;s already running. Look *only* at the pid file.</span>
<a id=__codelineno-28-330 name=__codelineno-28-330 href=#__codelineno-28-330></a><span class=w>    </span>__pids_var_run<span class=w> </span><span class=s2>&quot;</span><span class=nv>$base</span><span class=s2>&quot;</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$pid_file</span><span class=s2>&quot;</span>
<a id=__codelineno-28-331 name=__codelineno-28-331 href=#__codelineno-28-331></a>
<a id=__codelineno-28-332 name=__codelineno-28-332 href=#__codelineno-28-332></a><span class=w>    </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=nv>$pid</span><span class=s2>&quot;</span><span class=w> </span>-a<span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=nv>$force</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>return</span>
<a id=__codelineno-28-333 name=__codelineno-28-333 href=#__codelineno-28-333></a>
<a id=__codelineno-28-334 name=__codelineno-28-334 href=#__codelineno-28-334></a><span class=w>    </span><span class=c1># make sure it doesn&#39;t core dump anywhere unless requested</span>
<a id=__codelineno-28-335 name=__codelineno-28-335 href=#__codelineno-28-335></a><span class=w>    </span><span class=nv>corelimit</span><span class=o>=</span><span class=s2>&quot;ulimit -S -c </span><span class=si>${</span><span class=nv>DAEMON_COREFILE_LIMIT</span><span class=k>:-</span><span class=nv>0</span><span class=si>}</span><span class=s2>&quot;</span>
<a id=__codelineno-28-336 name=__codelineno-28-336 href=#__codelineno-28-336></a>
<a id=__codelineno-28-337 name=__codelineno-28-337 href=#__codelineno-28-337></a><span class=w>    </span><span class=c1># if they set NICELEVEL in /etc/sysconfig/foo, honor it</span>
<a id=__codelineno-28-338 name=__codelineno-28-338 href=#__codelineno-28-338></a><span class=w>    </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>NICELEVEL</span><span class=k>:-</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nv>nice</span><span class=o>=</span><span class=s2>&quot;nice -n </span><span class=nv>$NICELEVEL</span><span class=s2>&quot;</span>
<a id=__codelineno-28-339 name=__codelineno-28-339 href=#__codelineno-28-339></a>
<a id=__codelineno-28-340 name=__codelineno-28-340 href=#__codelineno-28-340></a><span class=w>    </span><span class=c1># if they set CGROUP_DAEMON in /etc/sysconfig/foo, honor it</span>
<a id=__codelineno-28-341 name=__codelineno-28-341 href=#__codelineno-28-341></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>CGROUP_DAEMON</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-28-342 name=__codelineno-28-342 href=#__codelineno-28-342></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>!<span class=w> </span>-x<span class=w> </span>/bin/cgexec<span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-28-343 name=__codelineno-28-343 href=#__codelineno-28-343></a><span class=w>            </span><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;Cgroups not installed&quot;</span><span class=p>;</span><span class=w> </span>warning
<a id=__codelineno-28-344 name=__codelineno-28-344 href=#__codelineno-28-344></a><span class=w>            </span><span class=nb>echo</span>
<a id=__codelineno-28-345 name=__codelineno-28-345 href=#__codelineno-28-345></a><span class=w>        </span><span class=k>else</span>
<a id=__codelineno-28-346 name=__codelineno-28-346 href=#__codelineno-28-346></a><span class=w>            </span><span class=nv>cgroup</span><span class=o>=</span><span class=s2>&quot;/bin/cgexec&quot;</span><span class=p>;</span>
<a id=__codelineno-28-347 name=__codelineno-28-347 href=#__codelineno-28-347></a><span class=w>            </span><span class=k>for</span><span class=w> </span>i<span class=w> </span><span class=k>in</span><span class=w> </span><span class=nv>$CGROUP_DAEMON</span><span class=p>;</span><span class=w> </span><span class=k>do</span>
<a id=__codelineno-28-348 name=__codelineno-28-348 href=#__codelineno-28-348></a><span class=w>                </span><span class=nv>cgroup</span><span class=o>=</span><span class=s2>&quot;</span><span class=nv>$cgroup</span><span class=s2> -g </span><span class=nv>$i</span><span class=s2>&quot;</span><span class=p>;</span>
<a id=__codelineno-28-349 name=__codelineno-28-349 href=#__codelineno-28-349></a><span class=w>            </span><span class=k>done</span>
<a id=__codelineno-28-350 name=__codelineno-28-350 href=#__codelineno-28-350></a><span class=w>        </span><span class=k>fi</span>
<a id=__codelineno-28-351 name=__codelineno-28-351 href=#__codelineno-28-351></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-28-352 name=__codelineno-28-352 href=#__codelineno-28-352></a>
<a id=__codelineno-28-353 name=__codelineno-28-353 href=#__codelineno-28-353></a><span class=w>    </span><span class=c1># Echo daemon</span>
<a id=__codelineno-28-354 name=__codelineno-28-354 href=#__codelineno-28-354></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>BOOTUP</span><span class=k>:-</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;verbose&quot;</span><span class=w> </span>-a<span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>LSB</span><span class=k>:-</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot; </span><span class=nv>$base</span><span class=s2>&quot;</span>
<a id=__codelineno-28-355 name=__codelineno-28-355 href=#__codelineno-28-355></a>
<a id=__codelineno-28-356 name=__codelineno-28-356 href=#__codelineno-28-356></a><span class=w>    </span><span class=c1># And start it up.</span>
<a id=__codelineno-28-357 name=__codelineno-28-357 href=#__codelineno-28-357></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=nv>$user</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-28-358 name=__codelineno-28-358 href=#__codelineno-28-358></a><span class=w>       </span><span class=nv>$cgroup</span><span class=w> </span><span class=nv>$nice</span><span class=w> </span>/bin/bash<span class=w> </span>-c<span class=w> </span><span class=s2>&quot;</span><span class=nv>$corelimit</span><span class=s2> &gt;/dev/null 2&gt;&amp;1 ; </span><span class=nv>$*</span><span class=s2>&quot;</span>
<a id=__codelineno-28-359 name=__codelineno-28-359 href=#__codelineno-28-359></a><span class=w>    </span><span class=k>else</span>
<a id=__codelineno-28-360 name=__codelineno-28-360 href=#__codelineno-28-360></a><span class=w>       </span><span class=nv>$cgroup</span><span class=w> </span><span class=nv>$nice</span><span class=w> </span>runuser<span class=w> </span>-s<span class=w> </span>/bin/bash<span class=w> </span><span class=nv>$user</span><span class=w> </span>-c<span class=w> </span><span class=s2>&quot;</span><span class=nv>$corelimit</span><span class=s2> &gt;/dev/null 2&gt;&amp;1 ; </span><span class=nv>$*</span><span class=s2>&quot;</span>
<a id=__codelineno-28-361 name=__codelineno-28-361 href=#__codelineno-28-361></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-28-362 name=__codelineno-28-362 href=#__codelineno-28-362></a>
<a id=__codelineno-28-363 name=__codelineno-28-363 href=#__codelineno-28-363></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$?</span><span class=s2>&quot;</span><span class=w> </span>-eq<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>success<span class=w> </span>$<span class=s2>&quot;</span><span class=nv>$base</span><span class=s2> startup&quot;</span><span class=w> </span><span class=o>||</span><span class=w> </span>failure<span class=w> </span>$<span class=s2>&quot;</span><span class=nv>$base</span><span class=s2> startup&quot;</span>
<a id=__codelineno-28-364 name=__codelineno-28-364 href=#__codelineno-28-364></a><span class=o>}</span>
<a id=__codelineno-28-365 name=__codelineno-28-365 href=#__codelineno-28-365></a>
<a id=__codelineno-28-366 name=__codelineno-28-366 href=#__codelineno-28-366></a><span class=c1># A function to stop a program.</span>
<a id=__codelineno-28-367 name=__codelineno-28-367 href=#__codelineno-28-367></a>killproc<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-28-368 name=__codelineno-28-368 href=#__codelineno-28-368></a><span class=w>    </span><span class=nb>local</span><span class=w> </span>RC<span class=w> </span><span class=nv>killlevel</span><span class=o>=</span><span class=w> </span>base<span class=w> </span>pid<span class=w> </span><span class=nv>pid_file</span><span class=o>=</span><span class=w> </span>delay<span class=w> </span>try<span class=w> </span><span class=nv>binary</span><span class=o>=</span>
<a id=__codelineno-28-369 name=__codelineno-28-369 href=#__codelineno-28-369></a>
<a id=__codelineno-28-370 name=__codelineno-28-370 href=#__codelineno-28-370></a><span class=w>    </span><span class=nv>RC</span><span class=o>=</span><span class=m>0</span><span class=p>;</span><span class=w> </span><span class=nv>delay</span><span class=o>=</span><span class=m>3</span><span class=p>;</span><span class=w> </span><span class=nv>try</span><span class=o>=</span><span class=m>0</span>
<a id=__codelineno-28-371 name=__codelineno-28-371 href=#__codelineno-28-371></a><span class=w>    </span><span class=c1># Test syntax.</span>
<a id=__codelineno-28-372 name=__codelineno-28-372 href=#__codelineno-28-372></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$#</span><span class=s2>&quot;</span><span class=w> </span>-eq<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-28-373 name=__codelineno-28-373 href=#__codelineno-28-373></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>$&quot;Usage: killproc [-p pidfile] [ -d delay] {program} [-signal]&quot;</span>
<a id=__codelineno-28-374 name=__codelineno-28-374 href=#__codelineno-28-374></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-28-375 name=__codelineno-28-375 href=#__codelineno-28-375></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-28-376 name=__codelineno-28-376 href=#__codelineno-28-376></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;-p&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-28-377 name=__codelineno-28-377 href=#__codelineno-28-377></a><span class=w>        </span><span class=nv>pid_file</span><span class=o>=</span><span class=nv>$2</span>
<a id=__codelineno-28-378 name=__codelineno-28-378 href=#__codelineno-28-378></a><span class=w>        </span><span class=nb>shift</span><span class=w> </span><span class=m>2</span>
<a id=__codelineno-28-379 name=__codelineno-28-379 href=#__codelineno-28-379></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-28-380 name=__codelineno-28-380 href=#__codelineno-28-380></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;-b&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-28-381 name=__codelineno-28-381 href=#__codelineno-28-381></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=nv>$pid_file</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-28-382 name=__codelineno-28-382 href=#__codelineno-28-382></a><span class=w>            </span><span class=nb>echo</span><span class=w> </span><span class=s2>$&quot;-b option can be used only with -p&quot;</span>
<a id=__codelineno-28-383 name=__codelineno-28-383 href=#__codelineno-28-383></a><span class=w>            </span><span class=nb>echo</span><span class=w> </span><span class=s2>$&quot;Usage: killproc -p pidfile -b binary program&quot;</span>
<a id=__codelineno-28-384 name=__codelineno-28-384 href=#__codelineno-28-384></a><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-28-385 name=__codelineno-28-385 href=#__codelineno-28-385></a><span class=w>        </span><span class=k>fi</span>
<a id=__codelineno-28-386 name=__codelineno-28-386 href=#__codelineno-28-386></a><span class=w>        </span><span class=nv>binary</span><span class=o>=</span><span class=nv>$2</span>
<a id=__codelineno-28-387 name=__codelineno-28-387 href=#__codelineno-28-387></a><span class=w>        </span><span class=nb>shift</span><span class=w> </span><span class=m>2</span>
<a id=__codelineno-28-388 name=__codelineno-28-388 href=#__codelineno-28-388></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-28-389 name=__codelineno-28-389 href=#__codelineno-28-389></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;-d&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-28-390 name=__codelineno-28-390 href=#__codelineno-28-390></a><span class=w>        </span><span class=nv>delay</span><span class=o>=</span><span class=k>$(</span><span class=nb>echo</span><span class=w> </span><span class=nv>$2</span><span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span>-v<span class=w> </span><span class=nv>RS</span><span class=o>=</span><span class=s1>&#39; &#39;</span><span class=w> </span>-v<span class=w> </span><span class=nv>IGNORECASE</span><span class=o>=</span><span class=m>1</span><span class=w> </span><span class=s1>&#39;{if($1!~/^[0-9.]+[smhd]?$/) exit 1;d=$1~/s$|^[0-9.]*$/?1:$1~/m$/?60:$1~/h$/?60*60:$1~/d$/?24*60*60:-1;if(d==-1) exit 1;delay+=d*$1} END {printf(&quot;%d&quot;,delay+0.5)}&#39;</span><span class=k>)</span>
<a id=__codelineno-28-391 name=__codelineno-28-391 href=#__codelineno-28-391></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$?</span><span class=s2>&quot;</span><span class=w> </span>-eq<span class=w> </span><span class=m>1</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-28-392 name=__codelineno-28-392 href=#__codelineno-28-392></a><span class=w>            </span><span class=nb>echo</span><span class=w> </span><span class=s2>$&quot;Usage: killproc [-p pidfile] [ -d delay] {program} [-signal]&quot;</span>
<a id=__codelineno-28-393 name=__codelineno-28-393 href=#__codelineno-28-393></a><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-28-394 name=__codelineno-28-394 href=#__codelineno-28-394></a><span class=w>        </span><span class=k>fi</span>
<a id=__codelineno-28-395 name=__codelineno-28-395 href=#__codelineno-28-395></a><span class=w>        </span><span class=nb>shift</span><span class=w> </span><span class=m>2</span>
<a id=__codelineno-28-396 name=__codelineno-28-396 href=#__codelineno-28-396></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-28-397 name=__codelineno-28-397 href=#__codelineno-28-397></a>
<a id=__codelineno-28-398 name=__codelineno-28-398 href=#__codelineno-28-398></a>
<a id=__codelineno-28-399 name=__codelineno-28-399 href=#__codelineno-28-399></a><span class=w>    </span><span class=c1># check for second arg to be kill level</span>
<a id=__codelineno-28-400 name=__codelineno-28-400 href=#__codelineno-28-400></a><span class=w>    </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>2</span><span class=k>:-</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nv>killlevel</span><span class=o>=</span><span class=nv>$2</span>
<a id=__codelineno-28-401 name=__codelineno-28-401 href=#__codelineno-28-401></a>
<a id=__codelineno-28-402 name=__codelineno-28-402 href=#__codelineno-28-402></a><span class=w>    </span><span class=c1># Save basename.</span>
<a id=__codelineno-28-403 name=__codelineno-28-403 href=#__codelineno-28-403></a><span class=w>    </span><span class=nv>base</span><span class=o>=</span><span class=si>${</span><span class=nv>1</span><span class=p>##*/</span><span class=si>}</span>
<a id=__codelineno-28-404 name=__codelineno-28-404 href=#__codelineno-28-404></a>
<a id=__codelineno-28-405 name=__codelineno-28-405 href=#__codelineno-28-405></a><span class=w>    </span><span class=c1># Find pid.</span>
<a id=__codelineno-28-406 name=__codelineno-28-406 href=#__codelineno-28-406></a><span class=w>    </span>__pids_var_run<span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$pid_file</span><span class=s2>&quot;</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$binary</span><span class=s2>&quot;</span>
<a id=__codelineno-28-407 name=__codelineno-28-407 href=#__codelineno-28-407></a><span class=w>    </span><span class=nv>RC</span><span class=o>=</span><span class=nv>$?</span>
<a id=__codelineno-28-408 name=__codelineno-28-408 href=#__codelineno-28-408></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=nv>$pid</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-28-409 name=__codelineno-28-409 href=#__codelineno-28-409></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=nv>$pid_file</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-28-410 name=__codelineno-28-410 href=#__codelineno-28-410></a><span class=w>            </span><span class=nv>pid</span><span class=o>=</span><span class=s2>&quot;</span><span class=k>$(</span>__pids_pidof<span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=k>)</span><span class=s2>&quot;</span>
<a id=__codelineno-28-411 name=__codelineno-28-411 href=#__codelineno-28-411></a><span class=w>        </span><span class=k>else</span>
<a id=__codelineno-28-412 name=__codelineno-28-412 href=#__codelineno-28-412></a><span class=w>            </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$RC</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;4&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=o>{</span><span class=w> </span>failure<span class=w> </span>$<span class=s2>&quot;</span><span class=nv>$base</span><span class=s2> shutdown&quot;</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=nv>$RC</span><span class=w> </span><span class=p>;</span><span class=o>}</span>
<a id=__codelineno-28-413 name=__codelineno-28-413 href=#__codelineno-28-413></a><span class=w>        </span><span class=k>fi</span>
<a id=__codelineno-28-414 name=__codelineno-28-414 href=#__codelineno-28-414></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-28-415 name=__codelineno-28-415 href=#__codelineno-28-415></a>
<a id=__codelineno-28-416 name=__codelineno-28-416 href=#__codelineno-28-416></a><span class=w>    </span><span class=c1># Kill it.</span>
<a id=__codelineno-28-417 name=__codelineno-28-417 href=#__codelineno-28-417></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=nv>$pid</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-28-418 name=__codelineno-28-418 href=#__codelineno-28-418></a><span class=w>        </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$BOOTUP</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;verbose&quot;</span><span class=w> </span>-a<span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>LSB</span><span class=k>:-</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=nv>$base</span><span class=s2> &quot;</span>
<a id=__codelineno-28-419 name=__codelineno-28-419 href=#__codelineno-28-419></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=nv>$killlevel</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-28-420 name=__codelineno-28-420 href=#__codelineno-28-420></a><span class=w>            </span>__kill_pids_term_kill<span class=w> </span>-d<span class=w> </span><span class=nv>$delay</span><span class=w> </span><span class=nv>$pid</span>
<a id=__codelineno-28-421 name=__codelineno-28-421 href=#__codelineno-28-421></a><span class=w>            </span><span class=nv>RC</span><span class=o>=</span><span class=nv>$?</span>
<a id=__codelineno-28-422 name=__codelineno-28-422 href=#__codelineno-28-422></a><span class=w>            </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$RC</span><span class=s2>&quot;</span><span class=w> </span>-eq<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>success<span class=w> </span>$<span class=s2>&quot;</span><span class=nv>$base</span><span class=s2> shutdown&quot;</span><span class=w> </span><span class=o>||</span><span class=w> </span>failure<span class=w> </span>$<span class=s2>&quot;</span><span class=nv>$base</span><span class=s2> shutdown&quot;</span>
<a id=__codelineno-28-423 name=__codelineno-28-423 href=#__codelineno-28-423></a><span class=w>        </span><span class=c1># use specified level only</span>
<a id=__codelineno-28-424 name=__codelineno-28-424 href=#__codelineno-28-424></a><span class=w>        </span><span class=k>else</span>
<a id=__codelineno-28-425 name=__codelineno-28-425 href=#__codelineno-28-425></a><span class=w>            </span><span class=k>if</span><span class=w> </span>checkpid<span class=w> </span><span class=nv>$pid</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-28-426 name=__codelineno-28-426 href=#__codelineno-28-426></a><span class=w>                </span><span class=nb>kill</span><span class=w> </span><span class=nv>$killlevel</span><span class=w> </span><span class=nv>$pid</span><span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-28-427 name=__codelineno-28-427 href=#__codelineno-28-427></a><span class=w>                </span><span class=nv>RC</span><span class=o>=</span><span class=nv>$?</span>
<a id=__codelineno-28-428 name=__codelineno-28-428 href=#__codelineno-28-428></a><span class=w>                </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$RC</span><span class=s2>&quot;</span><span class=w> </span>-eq<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>success<span class=w> </span>$<span class=s2>&quot;</span><span class=nv>$base</span><span class=s2> </span><span class=nv>$killlevel</span><span class=s2>&quot;</span><span class=w> </span><span class=o>||</span><span class=w> </span>failure<span class=w> </span>$<span class=s2>&quot;</span><span class=nv>$base</span><span class=s2> </span><span class=nv>$killlevel</span><span class=s2>&quot;</span>
<a id=__codelineno-28-429 name=__codelineno-28-429 href=#__codelineno-28-429></a><span class=w>            </span><span class=k>elif</span><span class=w> </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>LSB</span><span class=k>:-</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-28-430 name=__codelineno-28-430 href=#__codelineno-28-430></a><span class=w>                </span><span class=nv>RC</span><span class=o>=</span><span class=m>7</span><span class=w> </span><span class=c1># Program is not running</span>
<a id=__codelineno-28-431 name=__codelineno-28-431 href=#__codelineno-28-431></a><span class=w>            </span><span class=k>fi</span>
<a id=__codelineno-28-432 name=__codelineno-28-432 href=#__codelineno-28-432></a><span class=w>        </span><span class=k>fi</span>
<a id=__codelineno-28-433 name=__codelineno-28-433 href=#__codelineno-28-433></a><span class=w>    </span><span class=k>else</span>
<a id=__codelineno-28-434 name=__codelineno-28-434 href=#__codelineno-28-434></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>LSB</span><span class=k>:-</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span>-a<span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=nv>$killlevel</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-28-435 name=__codelineno-28-435 href=#__codelineno-28-435></a><span class=w>            </span><span class=nv>RC</span><span class=o>=</span><span class=m>7</span><span class=w> </span><span class=c1># Program is not running</span>
<a id=__codelineno-28-436 name=__codelineno-28-436 href=#__codelineno-28-436></a><span class=w>        </span><span class=k>else</span>
<a id=__codelineno-28-437 name=__codelineno-28-437 href=#__codelineno-28-437></a><span class=w>            </span>failure<span class=w> </span>$<span class=s2>&quot;</span><span class=nv>$base</span><span class=s2> shutdown&quot;</span>
<a id=__codelineno-28-438 name=__codelineno-28-438 href=#__codelineno-28-438></a><span class=w>            </span><span class=nv>RC</span><span class=o>=</span><span class=m>0</span>
<a id=__codelineno-28-439 name=__codelineno-28-439 href=#__codelineno-28-439></a><span class=w>        </span><span class=k>fi</span>
<a id=__codelineno-28-440 name=__codelineno-28-440 href=#__codelineno-28-440></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-28-441 name=__codelineno-28-441 href=#__codelineno-28-441></a>
<a id=__codelineno-28-442 name=__codelineno-28-442 href=#__codelineno-28-442></a><span class=w>    </span><span class=c1># Remove pid file if any.</span>
<a id=__codelineno-28-443 name=__codelineno-28-443 href=#__codelineno-28-443></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=nv>$killlevel</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-28-444 name=__codelineno-28-444 href=#__codelineno-28-444></a><span class=w>        </span>rm<span class=w> </span>-f<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>pid_file</span><span class=k>:-</span><span class=p>/var/run/</span><span class=nv>$base</span><span class=p>.pid</span><span class=si>}</span><span class=s2>&quot;</span>
<a id=__codelineno-28-445 name=__codelineno-28-445 href=#__codelineno-28-445></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-28-446 name=__codelineno-28-446 href=#__codelineno-28-446></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nv>$RC</span>
<a id=__codelineno-28-447 name=__codelineno-28-447 href=#__codelineno-28-447></a><span class=o>}</span>
<a id=__codelineno-28-448 name=__codelineno-28-448 href=#__codelineno-28-448></a>
<a id=__codelineno-28-449 name=__codelineno-28-449 href=#__codelineno-28-449></a><span class=c1># A function to find the pid of a program. Looks *only* at the pidfile</span>
<a id=__codelineno-28-450 name=__codelineno-28-450 href=#__codelineno-28-450></a>pidfileofproc<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-28-451 name=__codelineno-28-451 href=#__codelineno-28-451></a><span class=w>    </span><span class=nb>local</span><span class=w> </span>pid
<a id=__codelineno-28-452 name=__codelineno-28-452 href=#__codelineno-28-452></a>
<a id=__codelineno-28-453 name=__codelineno-28-453 href=#__codelineno-28-453></a><span class=w>    </span><span class=c1># Test syntax.</span>
<a id=__codelineno-28-454 name=__codelineno-28-454 href=#__codelineno-28-454></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$#</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-28-455 name=__codelineno-28-455 href=#__codelineno-28-455></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>$&quot;Usage: pidfileofproc {program}&quot;</span>
<a id=__codelineno-28-456 name=__codelineno-28-456 href=#__codelineno-28-456></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-28-457 name=__codelineno-28-457 href=#__codelineno-28-457></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-28-458 name=__codelineno-28-458 href=#__codelineno-28-458></a>
<a id=__codelineno-28-459 name=__codelineno-28-459 href=#__codelineno-28-459></a><span class=w>    </span>__pids_var_run<span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span>
<a id=__codelineno-28-460 name=__codelineno-28-460 href=#__codelineno-28-460></a><span class=w>    </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=nv>$pid</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=nv>$pid</span>
<a id=__codelineno-28-461 name=__codelineno-28-461 href=#__codelineno-28-461></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-28-462 name=__codelineno-28-462 href=#__codelineno-28-462></a><span class=o>}</span>
<a id=__codelineno-28-463 name=__codelineno-28-463 href=#__codelineno-28-463></a>
<a id=__codelineno-28-464 name=__codelineno-28-464 href=#__codelineno-28-464></a><span class=c1># A function to find the pid of a program.</span>
<a id=__codelineno-28-465 name=__codelineno-28-465 href=#__codelineno-28-465></a>pidofproc<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-28-466 name=__codelineno-28-466 href=#__codelineno-28-466></a><span class=w>    </span><span class=nb>local</span><span class=w> </span>RC<span class=w> </span>pid<span class=w> </span><span class=nv>pid_file</span><span class=o>=</span>
<a id=__codelineno-28-467 name=__codelineno-28-467 href=#__codelineno-28-467></a>
<a id=__codelineno-28-468 name=__codelineno-28-468 href=#__codelineno-28-468></a><span class=w>    </span><span class=c1># Test syntax.</span>
<a id=__codelineno-28-469 name=__codelineno-28-469 href=#__codelineno-28-469></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$#</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-28-470 name=__codelineno-28-470 href=#__codelineno-28-470></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>$&quot;Usage: pidofproc [-p pidfile] {program}&quot;</span>
<a id=__codelineno-28-471 name=__codelineno-28-471 href=#__codelineno-28-471></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-28-472 name=__codelineno-28-472 href=#__codelineno-28-472></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-28-473 name=__codelineno-28-473 href=#__codelineno-28-473></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;-p&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-28-474 name=__codelineno-28-474 href=#__codelineno-28-474></a><span class=w>        </span><span class=nv>pid_file</span><span class=o>=</span><span class=nv>$2</span>
<a id=__codelineno-28-475 name=__codelineno-28-475 href=#__codelineno-28-475></a><span class=w>        </span><span class=nb>shift</span><span class=w> </span><span class=m>2</span>
<a id=__codelineno-28-476 name=__codelineno-28-476 href=#__codelineno-28-476></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-28-477 name=__codelineno-28-477 href=#__codelineno-28-477></a><span class=w>    </span><span class=nv>fail_code</span><span class=o>=</span><span class=m>3</span><span class=w> </span><span class=c1># &quot;Program is not running&quot;</span>
<a id=__codelineno-28-478 name=__codelineno-28-478 href=#__codelineno-28-478></a>
<a id=__codelineno-28-479 name=__codelineno-28-479 href=#__codelineno-28-479></a><span class=w>    </span><span class=c1># First try &quot;/var/run/*.pid&quot; files</span>
<a id=__codelineno-28-480 name=__codelineno-28-480 href=#__codelineno-28-480></a><span class=w>    </span>__pids_var_run<span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$pid_file</span><span class=s2>&quot;</span>
<a id=__codelineno-28-481 name=__codelineno-28-481 href=#__codelineno-28-481></a><span class=w>    </span><span class=nv>RC</span><span class=o>=</span><span class=nv>$?</span>
<a id=__codelineno-28-482 name=__codelineno-28-482 href=#__codelineno-28-482></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=nv>$pid</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-28-483 name=__codelineno-28-483 href=#__codelineno-28-483></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=nv>$pid</span>
<a id=__codelineno-28-484 name=__codelineno-28-484 href=#__codelineno-28-484></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-28-485 name=__codelineno-28-485 href=#__codelineno-28-485></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-28-486 name=__codelineno-28-486 href=#__codelineno-28-486></a>
<a id=__codelineno-28-487 name=__codelineno-28-487 href=#__codelineno-28-487></a><span class=w>    </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=nv>$pid_file</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=nv>$RC</span>
<a id=__codelineno-28-488 name=__codelineno-28-488 href=#__codelineno-28-488></a><span class=w>    </span>__pids_pidof<span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=nv>$RC</span>
<a id=__codelineno-28-489 name=__codelineno-28-489 href=#__codelineno-28-489></a><span class=o>}</span>
<a id=__codelineno-28-490 name=__codelineno-28-490 href=#__codelineno-28-490></a>
<a id=__codelineno-28-491 name=__codelineno-28-491 href=#__codelineno-28-491></a>status<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-28-492 name=__codelineno-28-492 href=#__codelineno-28-492></a><span class=w>    </span><span class=nb>local</span><span class=w> </span>base<span class=w> </span>pid<span class=w> </span><span class=nv>lock_file</span><span class=o>=</span><span class=w> </span><span class=nv>pid_file</span><span class=o>=</span><span class=w> </span><span class=nv>binary</span><span class=o>=</span>
<a id=__codelineno-28-493 name=__codelineno-28-493 href=#__codelineno-28-493></a>
<a id=__codelineno-28-494 name=__codelineno-28-494 href=#__codelineno-28-494></a><span class=w>    </span><span class=c1># Test syntax.</span>
<a id=__codelineno-28-495 name=__codelineno-28-495 href=#__codelineno-28-495></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$#</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-28-496 name=__codelineno-28-496 href=#__codelineno-28-496></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>$&quot;Usage: status [-p pidfile] {program}&quot;</span>
<a id=__codelineno-28-497 name=__codelineno-28-497 href=#__codelineno-28-497></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-28-498 name=__codelineno-28-498 href=#__codelineno-28-498></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-28-499 name=__codelineno-28-499 href=#__codelineno-28-499></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;-p&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-28-500 name=__codelineno-28-500 href=#__codelineno-28-500></a><span class=w>        </span><span class=nv>pid_file</span><span class=o>=</span><span class=nv>$2</span>
<a id=__codelineno-28-501 name=__codelineno-28-501 href=#__codelineno-28-501></a><span class=w>        </span><span class=nb>shift</span><span class=w> </span><span class=m>2</span>
<a id=__codelineno-28-502 name=__codelineno-28-502 href=#__codelineno-28-502></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-28-503 name=__codelineno-28-503 href=#__codelineno-28-503></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;-l&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-28-504 name=__codelineno-28-504 href=#__codelineno-28-504></a><span class=w>        </span><span class=nv>lock_file</span><span class=o>=</span><span class=nv>$2</span>
<a id=__codelineno-28-505 name=__codelineno-28-505 href=#__codelineno-28-505></a><span class=w>        </span><span class=nb>shift</span><span class=w> </span><span class=m>2</span>
<a id=__codelineno-28-506 name=__codelineno-28-506 href=#__codelineno-28-506></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-28-507 name=__codelineno-28-507 href=#__codelineno-28-507></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;-b&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-28-508 name=__codelineno-28-508 href=#__codelineno-28-508></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=nv>$pid_file</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-28-509 name=__codelineno-28-509 href=#__codelineno-28-509></a><span class=w>            </span><span class=nb>echo</span><span class=w> </span><span class=s2>$&quot;-b option can be used only with -p&quot;</span>
<a id=__codelineno-28-510 name=__codelineno-28-510 href=#__codelineno-28-510></a><span class=w>            </span><span class=nb>echo</span><span class=w> </span><span class=s2>$&quot;Usage: status -p pidfile -b binary program&quot;</span>
<a id=__codelineno-28-511 name=__codelineno-28-511 href=#__codelineno-28-511></a><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-28-512 name=__codelineno-28-512 href=#__codelineno-28-512></a><span class=w>        </span><span class=k>fi</span>
<a id=__codelineno-28-513 name=__codelineno-28-513 href=#__codelineno-28-513></a><span class=w>        </span><span class=nv>binary</span><span class=o>=</span><span class=nv>$2</span>
<a id=__codelineno-28-514 name=__codelineno-28-514 href=#__codelineno-28-514></a><span class=w>        </span><span class=nb>shift</span><span class=w> </span><span class=m>2</span>
<a id=__codelineno-28-515 name=__codelineno-28-515 href=#__codelineno-28-515></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-28-516 name=__codelineno-28-516 href=#__codelineno-28-516></a><span class=w>    </span><span class=nv>base</span><span class=o>=</span><span class=si>${</span><span class=nv>1</span><span class=p>##*/</span><span class=si>}</span>
<a id=__codelineno-28-517 name=__codelineno-28-517 href=#__codelineno-28-517></a>
<a id=__codelineno-28-518 name=__codelineno-28-518 href=#__codelineno-28-518></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$_use_systemctl</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;1&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-28-519 name=__codelineno-28-519 href=#__codelineno-28-519></a><span class=w>        </span>systemctl<span class=w> </span>status<span class=w> </span><span class=si>${</span><span class=nv>0</span><span class=p>##*/</span><span class=si>}</span>.service
<a id=__codelineno-28-520 name=__codelineno-28-520 href=#__codelineno-28-520></a><span class=w>        </span><span class=nv>ret</span><span class=o>=</span><span class=nv>$?</span>
<a id=__codelineno-28-521 name=__codelineno-28-521 href=#__codelineno-28-521></a><span class=w>        </span><span class=c1># LSB daemons that dies abnormally in systemd looks alive in systemd&#39;s eyes due to RemainAfterExit=yes</span>
<a id=__codelineno-28-522 name=__codelineno-28-522 href=#__codelineno-28-522></a><span class=w>        </span><span class=c1># lets adjust the reality a little bit</span>
<a id=__codelineno-28-523 name=__codelineno-28-523 href=#__codelineno-28-523></a><span class=w>        </span><span class=k>if</span><span class=w> </span>systemctl<span class=w> </span>show<span class=w> </span>-p<span class=w> </span>ActiveState<span class=w> </span><span class=si>${</span><span class=nv>0</span><span class=p>##*/</span><span class=si>}</span>.service<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>-q<span class=w> </span><span class=s1>&#39;=active$&#39;</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-28-524 name=__codelineno-28-524 href=#__codelineno-28-524></a><span class=w>        </span>systemctl<span class=w> </span>show<span class=w> </span>-p<span class=w> </span>SubState<span class=w> </span><span class=si>${</span><span class=nv>0</span><span class=p>##*/</span><span class=si>}</span>.service<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>-q<span class=w> </span><span class=s1>&#39;=exited$&#39;</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-28-525 name=__codelineno-28-525 href=#__codelineno-28-525></a><span class=w>            </span><span class=nv>ret</span><span class=o>=</span><span class=m>3</span>
<a id=__codelineno-28-526 name=__codelineno-28-526 href=#__codelineno-28-526></a><span class=w>        </span><span class=k>fi</span>
<a id=__codelineno-28-527 name=__codelineno-28-527 href=#__codelineno-28-527></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nv>$ret</span>
<a id=__codelineno-28-528 name=__codelineno-28-528 href=#__codelineno-28-528></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-28-529 name=__codelineno-28-529 href=#__codelineno-28-529></a>
<a id=__codelineno-28-530 name=__codelineno-28-530 href=#__codelineno-28-530></a><span class=w>    </span><span class=c1># First try &quot;pidof&quot;</span>
<a id=__codelineno-28-531 name=__codelineno-28-531 href=#__codelineno-28-531></a><span class=w>    </span>__pids_var_run<span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$pid_file</span><span class=s2>&quot;</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$binary</span><span class=s2>&quot;</span>
<a id=__codelineno-28-532 name=__codelineno-28-532 href=#__codelineno-28-532></a><span class=w>    </span><span class=nv>RC</span><span class=o>=</span><span class=nv>$?</span>
<a id=__codelineno-28-533 name=__codelineno-28-533 href=#__codelineno-28-533></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=nv>$pid_file</span><span class=s2>&quot;</span><span class=w> </span>-a<span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=nv>$pid</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-28-534 name=__codelineno-28-534 href=#__codelineno-28-534></a><span class=w>        </span><span class=nv>pid</span><span class=o>=</span><span class=s2>&quot;</span><span class=k>$(</span>__pids_pidof<span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=k>)</span><span class=s2>&quot;</span>
<a id=__codelineno-28-535 name=__codelineno-28-535 href=#__codelineno-28-535></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-28-536 name=__codelineno-28-536 href=#__codelineno-28-536></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=nv>$pid</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-28-537 name=__codelineno-28-537 href=#__codelineno-28-537></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span>$<span class=s2>&quot;</span><span class=si>${</span><span class=nv>base</span><span class=si>}</span><span class=s2> (pid </span><span class=nv>$pid</span><span class=s2>) is running...&quot;</span>
<a id=__codelineno-28-538 name=__codelineno-28-538 href=#__codelineno-28-538></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-28-539 name=__codelineno-28-539 href=#__codelineno-28-539></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-28-540 name=__codelineno-28-540 href=#__codelineno-28-540></a>
<a id=__codelineno-28-541 name=__codelineno-28-541 href=#__codelineno-28-541></a><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$RC</span><span class=s2>&quot;</span><span class=w> </span><span class=k>in</span>
<a id=__codelineno-28-542 name=__codelineno-28-542 href=#__codelineno-28-542></a><span class=w>    </span><span class=m>0</span><span class=o>)</span>
<a id=__codelineno-28-543 name=__codelineno-28-543 href=#__codelineno-28-543></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span>$<span class=s2>&quot;</span><span class=si>${</span><span class=nv>base</span><span class=si>}</span><span class=s2> (pid </span><span class=nv>$pid</span><span class=s2>) is running...&quot;</span>
<a id=__codelineno-28-544 name=__codelineno-28-544 href=#__codelineno-28-544></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-28-545 name=__codelineno-28-545 href=#__codelineno-28-545></a><span class=w>        </span><span class=p>;;</span>
<a id=__codelineno-28-546 name=__codelineno-28-546 href=#__codelineno-28-546></a><span class=w>    </span><span class=m>1</span><span class=o>)</span>
<a id=__codelineno-28-547 name=__codelineno-28-547 href=#__codelineno-28-547></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span>$<span class=s2>&quot;</span><span class=si>${</span><span class=nv>base</span><span class=si>}</span><span class=s2> dead but pid file exists&quot;</span>
<a id=__codelineno-28-548 name=__codelineno-28-548 href=#__codelineno-28-548></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-28-549 name=__codelineno-28-549 href=#__codelineno-28-549></a><span class=w>        </span><span class=p>;;</span>
<a id=__codelineno-28-550 name=__codelineno-28-550 href=#__codelineno-28-550></a><span class=w>    </span><span class=m>4</span><span class=o>)</span>
<a id=__codelineno-28-551 name=__codelineno-28-551 href=#__codelineno-28-551></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span>$<span class=s2>&quot;</span><span class=si>${</span><span class=nv>base</span><span class=si>}</span><span class=s2> status unknown due to insufficient privileges.&quot;</span>
<a id=__codelineno-28-552 name=__codelineno-28-552 href=#__codelineno-28-552></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=m>4</span>
<a id=__codelineno-28-553 name=__codelineno-28-553 href=#__codelineno-28-553></a><span class=w>        </span><span class=p>;;</span>
<a id=__codelineno-28-554 name=__codelineno-28-554 href=#__codelineno-28-554></a><span class=w>    </span><span class=k>esac</span>
<a id=__codelineno-28-555 name=__codelineno-28-555 href=#__codelineno-28-555></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>lock_file</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-28-556 name=__codelineno-28-556 href=#__codelineno-28-556></a><span class=w>        </span><span class=nv>lock_file</span><span class=o>=</span><span class=si>${</span><span class=nv>base</span><span class=si>}</span>
<a id=__codelineno-28-557 name=__codelineno-28-557 href=#__codelineno-28-557></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-28-558 name=__codelineno-28-558 href=#__codelineno-28-558></a><span class=w>    </span><span class=c1># See if /var/lock/subsys/${lock_file} exists</span>
<a id=__codelineno-28-559 name=__codelineno-28-559 href=#__codelineno-28-559></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-f<span class=w> </span>/var/lock/subsys/<span class=si>${</span><span class=nv>lock_file</span><span class=si>}</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-28-560 name=__codelineno-28-560 href=#__codelineno-28-560></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span>$<span class=s2>&quot;</span><span class=si>${</span><span class=nv>base</span><span class=si>}</span><span class=s2> dead but subsys locked&quot;</span>
<a id=__codelineno-28-561 name=__codelineno-28-561 href=#__codelineno-28-561></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=m>2</span>
<a id=__codelineno-28-562 name=__codelineno-28-562 href=#__codelineno-28-562></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-28-563 name=__codelineno-28-563 href=#__codelineno-28-563></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>$<span class=s2>&quot;</span><span class=si>${</span><span class=nv>base</span><span class=si>}</span><span class=s2> is stopped&quot;</span>
<a id=__codelineno-28-564 name=__codelineno-28-564 href=#__codelineno-28-564></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=m>3</span>
<a id=__codelineno-28-565 name=__codelineno-28-565 href=#__codelineno-28-565></a><span class=o>}</span>
<a id=__codelineno-28-566 name=__codelineno-28-566 href=#__codelineno-28-566></a>
<a id=__codelineno-28-567 name=__codelineno-28-567 href=#__codelineno-28-567></a>echo_success<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-28-568 name=__codelineno-28-568 href=#__codelineno-28-568></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$BOOTUP</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;color&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nv>$MOVE_TO_COL</span>
<a id=__codelineno-28-569 name=__codelineno-28-569 href=#__codelineno-28-569></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;[&quot;</span>
<a id=__codelineno-28-570 name=__codelineno-28-570 href=#__codelineno-28-570></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$BOOTUP</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;color&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nv>$SETCOLOR_SUCCESS</span>
<a id=__codelineno-28-571 name=__codelineno-28-571 href=#__codelineno-28-571></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s2>$&quot;  OK  &quot;</span>
<a id=__codelineno-28-572 name=__codelineno-28-572 href=#__codelineno-28-572></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$BOOTUP</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;color&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nv>$SETCOLOR_NORMAL</span>
<a id=__codelineno-28-573 name=__codelineno-28-573 href=#__codelineno-28-573></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;]&quot;</span>
<a id=__codelineno-28-574 name=__codelineno-28-574 href=#__codelineno-28-574></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-ne<span class=w> </span><span class=s2>&quot;\r&quot;</span>
<a id=__codelineno-28-575 name=__codelineno-28-575 href=#__codelineno-28-575></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-28-576 name=__codelineno-28-576 href=#__codelineno-28-576></a><span class=o>}</span>
<a id=__codelineno-28-577 name=__codelineno-28-577 href=#__codelineno-28-577></a>
<a id=__codelineno-28-578 name=__codelineno-28-578 href=#__codelineno-28-578></a>echo_failure<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-28-579 name=__codelineno-28-579 href=#__codelineno-28-579></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$BOOTUP</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;color&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nv>$MOVE_TO_COL</span>
<a id=__codelineno-28-580 name=__codelineno-28-580 href=#__codelineno-28-580></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;[&quot;</span>
<a id=__codelineno-28-581 name=__codelineno-28-581 href=#__codelineno-28-581></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$BOOTUP</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;color&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nv>$SETCOLOR_FAILURE</span>
<a id=__codelineno-28-582 name=__codelineno-28-582 href=#__codelineno-28-582></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s2>$&quot;FAILED&quot;</span>
<a id=__codelineno-28-583 name=__codelineno-28-583 href=#__codelineno-28-583></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$BOOTUP</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;color&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nv>$SETCOLOR_NORMAL</span>
<a id=__codelineno-28-584 name=__codelineno-28-584 href=#__codelineno-28-584></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;]&quot;</span>
<a id=__codelineno-28-585 name=__codelineno-28-585 href=#__codelineno-28-585></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-ne<span class=w> </span><span class=s2>&quot;\r&quot;</span>
<a id=__codelineno-28-586 name=__codelineno-28-586 href=#__codelineno-28-586></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-28-587 name=__codelineno-28-587 href=#__codelineno-28-587></a><span class=o>}</span>
<a id=__codelineno-28-588 name=__codelineno-28-588 href=#__codelineno-28-588></a>
<a id=__codelineno-28-589 name=__codelineno-28-589 href=#__codelineno-28-589></a>echo_passed<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-28-590 name=__codelineno-28-590 href=#__codelineno-28-590></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$BOOTUP</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;color&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nv>$MOVE_TO_COL</span>
<a id=__codelineno-28-591 name=__codelineno-28-591 href=#__codelineno-28-591></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;[&quot;</span>
<a id=__codelineno-28-592 name=__codelineno-28-592 href=#__codelineno-28-592></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$BOOTUP</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;color&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nv>$SETCOLOR_WARNING</span>
<a id=__codelineno-28-593 name=__codelineno-28-593 href=#__codelineno-28-593></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s2>$&quot;PASSED&quot;</span>
<a id=__codelineno-28-594 name=__codelineno-28-594 href=#__codelineno-28-594></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$BOOTUP</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;color&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nv>$SETCOLOR_NORMAL</span>
<a id=__codelineno-28-595 name=__codelineno-28-595 href=#__codelineno-28-595></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;]&quot;</span>
<a id=__codelineno-28-596 name=__codelineno-28-596 href=#__codelineno-28-596></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-ne<span class=w> </span><span class=s2>&quot;\r&quot;</span>
<a id=__codelineno-28-597 name=__codelineno-28-597 href=#__codelineno-28-597></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-28-598 name=__codelineno-28-598 href=#__codelineno-28-598></a><span class=o>}</span>
<a id=__codelineno-28-599 name=__codelineno-28-599 href=#__codelineno-28-599></a>
<a id=__codelineno-28-600 name=__codelineno-28-600 href=#__codelineno-28-600></a>echo_warning<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-28-601 name=__codelineno-28-601 href=#__codelineno-28-601></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$BOOTUP</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;color&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nv>$MOVE_TO_COL</span>
<a id=__codelineno-28-602 name=__codelineno-28-602 href=#__codelineno-28-602></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;[&quot;</span>
<a id=__codelineno-28-603 name=__codelineno-28-603 href=#__codelineno-28-603></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$BOOTUP</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;color&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nv>$SETCOLOR_WARNING</span>
<a id=__codelineno-28-604 name=__codelineno-28-604 href=#__codelineno-28-604></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s2>$&quot;WARNING&quot;</span>
<a id=__codelineno-28-605 name=__codelineno-28-605 href=#__codelineno-28-605></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$BOOTUP</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;color&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nv>$SETCOLOR_NORMAL</span>
<a id=__codelineno-28-606 name=__codelineno-28-606 href=#__codelineno-28-606></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;]&quot;</span>
<a id=__codelineno-28-607 name=__codelineno-28-607 href=#__codelineno-28-607></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-ne<span class=w> </span><span class=s2>&quot;\r&quot;</span>
<a id=__codelineno-28-608 name=__codelineno-28-608 href=#__codelineno-28-608></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-28-609 name=__codelineno-28-609 href=#__codelineno-28-609></a><span class=o>}</span>
<a id=__codelineno-28-610 name=__codelineno-28-610 href=#__codelineno-28-610></a>
<a id=__codelineno-28-611 name=__codelineno-28-611 href=#__codelineno-28-611></a><span class=c1># Inform the graphical boot of our current state</span>
<a id=__codelineno-28-612 name=__codelineno-28-612 href=#__codelineno-28-612></a>update_boot_stage<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-28-613 name=__codelineno-28-613 href=#__codelineno-28-613></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-x<span class=w> </span>/bin/plymouth<span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-28-614 name=__codelineno-28-614 href=#__codelineno-28-614></a><span class=w>        </span>/bin/plymouth<span class=w> </span>--update<span class=o>=</span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span>
<a id=__codelineno-28-615 name=__codelineno-28-615 href=#__codelineno-28-615></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-28-616 name=__codelineno-28-616 href=#__codelineno-28-616></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-28-617 name=__codelineno-28-617 href=#__codelineno-28-617></a><span class=o>}</span>
<a id=__codelineno-28-618 name=__codelineno-28-618 href=#__codelineno-28-618></a>
<a id=__codelineno-28-619 name=__codelineno-28-619 href=#__codelineno-28-619></a><span class=c1># Log that something succeeded</span>
<a id=__codelineno-28-620 name=__codelineno-28-620 href=#__codelineno-28-620></a>success<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-28-621 name=__codelineno-28-621 href=#__codelineno-28-621></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$BOOTUP</span><span class=s2>&quot;</span><span class=w> </span>!<span class=o>=</span><span class=w> </span><span class=s2>&quot;verbose&quot;</span><span class=w> </span>-a<span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>LSB</span><span class=k>:-</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>echo_success
<a id=__codelineno-28-622 name=__codelineno-28-622 href=#__codelineno-28-622></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-28-623 name=__codelineno-28-623 href=#__codelineno-28-623></a><span class=o>}</span>
<a id=__codelineno-28-624 name=__codelineno-28-624 href=#__codelineno-28-624></a>
<a id=__codelineno-28-625 name=__codelineno-28-625 href=#__codelineno-28-625></a><span class=c1># Log that something failed</span>
<a id=__codelineno-28-626 name=__codelineno-28-626 href=#__codelineno-28-626></a>failure<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-28-627 name=__codelineno-28-627 href=#__codelineno-28-627></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>rc</span><span class=o>=</span><span class=nv>$?</span>
<a id=__codelineno-28-628 name=__codelineno-28-628 href=#__codelineno-28-628></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$BOOTUP</span><span class=s2>&quot;</span><span class=w> </span>!<span class=o>=</span><span class=w> </span><span class=s2>&quot;verbose&quot;</span><span class=w> </span>-a<span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>LSB</span><span class=k>:-</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>echo_failure
<a id=__codelineno-28-629 name=__codelineno-28-629 href=#__codelineno-28-629></a><span class=w>    </span><span class=o>[</span><span class=w> </span>-x<span class=w> </span>/bin/plymouth<span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>/bin/plymouth<span class=w> </span>--details
<a id=__codelineno-28-630 name=__codelineno-28-630 href=#__codelineno-28-630></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nv>$rc</span>
<a id=__codelineno-28-631 name=__codelineno-28-631 href=#__codelineno-28-631></a><span class=o>}</span>
<a id=__codelineno-28-632 name=__codelineno-28-632 href=#__codelineno-28-632></a>
<a id=__codelineno-28-633 name=__codelineno-28-633 href=#__codelineno-28-633></a><span class=c1># Log that something passed, but may have had errors. Useful for fsck</span>
<a id=__codelineno-28-634 name=__codelineno-28-634 href=#__codelineno-28-634></a>passed<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-28-635 name=__codelineno-28-635 href=#__codelineno-28-635></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>rc</span><span class=o>=</span><span class=nv>$?</span>
<a id=__codelineno-28-636 name=__codelineno-28-636 href=#__codelineno-28-636></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$BOOTUP</span><span class=s2>&quot;</span><span class=w> </span>!<span class=o>=</span><span class=w> </span><span class=s2>&quot;verbose&quot;</span><span class=w> </span>-a<span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>LSB</span><span class=k>:-</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>echo_passed
<a id=__codelineno-28-637 name=__codelineno-28-637 href=#__codelineno-28-637></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nv>$rc</span>
<a id=__codelineno-28-638 name=__codelineno-28-638 href=#__codelineno-28-638></a><span class=o>}</span>
<a id=__codelineno-28-639 name=__codelineno-28-639 href=#__codelineno-28-639></a>
<a id=__codelineno-28-640 name=__codelineno-28-640 href=#__codelineno-28-640></a><span class=c1># Log a warning</span>
<a id=__codelineno-28-641 name=__codelineno-28-641 href=#__codelineno-28-641></a>warning<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-28-642 name=__codelineno-28-642 href=#__codelineno-28-642></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>rc</span><span class=o>=</span><span class=nv>$?</span>
<a id=__codelineno-28-643 name=__codelineno-28-643 href=#__codelineno-28-643></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$BOOTUP</span><span class=s2>&quot;</span><span class=w> </span>!<span class=o>=</span><span class=w> </span><span class=s2>&quot;verbose&quot;</span><span class=w> </span>-a<span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>LSB</span><span class=k>:-</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>echo_warning
<a id=__codelineno-28-644 name=__codelineno-28-644 href=#__codelineno-28-644></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nv>$rc</span>
<a id=__codelineno-28-645 name=__codelineno-28-645 href=#__codelineno-28-645></a><span class=o>}</span>
<a id=__codelineno-28-646 name=__codelineno-28-646 href=#__codelineno-28-646></a>
<a id=__codelineno-28-647 name=__codelineno-28-647 href=#__codelineno-28-647></a><span class=c1># Run some action. Log its output.</span>
<a id=__codelineno-28-648 name=__codelineno-28-648 href=#__codelineno-28-648></a>action<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-28-649 name=__codelineno-28-649 href=#__codelineno-28-649></a><span class=w>    </span><span class=nb>local</span><span class=w> </span>STRING<span class=w> </span>rc
<a id=__codelineno-28-650 name=__codelineno-28-650 href=#__codelineno-28-650></a>
<a id=__codelineno-28-651 name=__codelineno-28-651 href=#__codelineno-28-651></a><span class=w>    </span><span class=nv>STRING</span><span class=o>=</span><span class=nv>$1</span>
<a id=__codelineno-28-652 name=__codelineno-28-652 href=#__codelineno-28-652></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=nv>$STRING</span><span class=s2> &quot;</span>
<a id=__codelineno-28-653 name=__codelineno-28-653 href=#__codelineno-28-653></a><span class=w>    </span><span class=nb>shift</span>
<a id=__codelineno-28-654 name=__codelineno-28-654 href=#__codelineno-28-654></a><span class=w>    </span><span class=s2>&quot;</span><span class=nv>$@</span><span class=s2>&quot;</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>success<span class=w> </span>$<span class=s2>&quot;</span><span class=nv>$STRING</span><span class=s2>&quot;</span><span class=w> </span><span class=o>||</span><span class=w> </span>failure<span class=w> </span>$<span class=s2>&quot;</span><span class=nv>$STRING</span><span class=s2>&quot;</span>
<a id=__codelineno-28-655 name=__codelineno-28-655 href=#__codelineno-28-655></a><span class=w>    </span><span class=nv>rc</span><span class=o>=</span><span class=nv>$?</span>
<a id=__codelineno-28-656 name=__codelineno-28-656 href=#__codelineno-28-656></a><span class=w>    </span><span class=nb>echo</span>
<a id=__codelineno-28-657 name=__codelineno-28-657 href=#__codelineno-28-657></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nv>$rc</span>
<a id=__codelineno-28-658 name=__codelineno-28-658 href=#__codelineno-28-658></a><span class=o>}</span>
<a id=__codelineno-28-659 name=__codelineno-28-659 href=#__codelineno-28-659></a>
<a id=__codelineno-28-660 name=__codelineno-28-660 href=#__codelineno-28-660></a><span class=c1># returns OK if $1 contains $2</span>
<a id=__codelineno-28-661 name=__codelineno-28-661 href=#__codelineno-28-661></a>strstr<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-28-662 name=__codelineno-28-662 href=#__codelineno-28-662></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>1</span><span class=p>#*</span><span class=nv>$2</span><span class=p>*</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-28-663 name=__codelineno-28-663 href=#__codelineno-28-663></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-28-664 name=__codelineno-28-664 href=#__codelineno-28-664></a><span class=o>}</span>
<a id=__codelineno-28-665 name=__codelineno-28-665 href=#__codelineno-28-665></a>
<a id=__codelineno-28-666 name=__codelineno-28-666 href=#__codelineno-28-666></a><span class=c1># Check whether file $1 is a backup or rpm-generated file and should be ignored</span>
<a id=__codelineno-28-667 name=__codelineno-28-667 href=#__codelineno-28-667></a>is_ignored_file<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-28-668 name=__codelineno-28-668 href=#__codelineno-28-668></a><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=k>in</span>
<a id=__codelineno-28-669 name=__codelineno-28-669 href=#__codelineno-28-669></a><span class=w>    </span>*~<span class=w> </span><span class=p>|</span><span class=w> </span>*.bak<span class=w> </span><span class=p>|</span><span class=w> </span>*.orig<span class=w> </span><span class=p>|</span><span class=w> </span>*.rpmnew<span class=w> </span><span class=p>|</span><span class=w> </span>*.rpmorig<span class=w> </span><span class=p>|</span><span class=w> </span>*.rpmsave<span class=o>)</span>
<a id=__codelineno-28-670 name=__codelineno-28-670 href=#__codelineno-28-670></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-28-671 name=__codelineno-28-671 href=#__codelineno-28-671></a><span class=w>        </span><span class=p>;;</span>
<a id=__codelineno-28-672 name=__codelineno-28-672 href=#__codelineno-28-672></a><span class=w>    </span><span class=k>esac</span>
<a id=__codelineno-28-673 name=__codelineno-28-673 href=#__codelineno-28-673></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-28-674 name=__codelineno-28-674 href=#__codelineno-28-674></a><span class=o>}</span>
<a id=__codelineno-28-675 name=__codelineno-28-675 href=#__codelineno-28-675></a>
<a id=__codelineno-28-676 name=__codelineno-28-676 href=#__codelineno-28-676></a><span class=c1># Evaluate shvar-style booleans</span>
<a id=__codelineno-28-677 name=__codelineno-28-677 href=#__codelineno-28-677></a>is_true<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-28-678 name=__codelineno-28-678 href=#__codelineno-28-678></a><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=k>in</span>
<a id=__codelineno-28-679 name=__codelineno-28-679 href=#__codelineno-28-679></a><span class=w>    </span><span class=o>[</span>tT<span class=o>]</span><span class=w> </span><span class=p>|</span><span class=w> </span><span class=o>[</span>yY<span class=o>]</span><span class=w> </span><span class=p>|</span><span class=w> </span><span class=o>[</span>yY<span class=o>][</span>eE<span class=o>][</span>sS<span class=o>]</span><span class=w> </span><span class=p>|</span><span class=w> </span><span class=o>[</span>tT<span class=o>][</span>rR<span class=o>][</span>uU<span class=o>][</span>eE<span class=o>]</span><span class=w> </span><span class=p>|</span><span class=w> </span><span class=m>1</span><span class=o>)</span>
<a id=__codelineno-28-680 name=__codelineno-28-680 href=#__codelineno-28-680></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-28-681 name=__codelineno-28-681 href=#__codelineno-28-681></a><span class=w>        </span><span class=p>;;</span>
<a id=__codelineno-28-682 name=__codelineno-28-682 href=#__codelineno-28-682></a><span class=w>    </span><span class=k>esac</span>
<a id=__codelineno-28-683 name=__codelineno-28-683 href=#__codelineno-28-683></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-28-684 name=__codelineno-28-684 href=#__codelineno-28-684></a><span class=o>}</span>
<a id=__codelineno-28-685 name=__codelineno-28-685 href=#__codelineno-28-685></a>
<a id=__codelineno-28-686 name=__codelineno-28-686 href=#__codelineno-28-686></a><span class=c1># Evaluate shvar-style booleans</span>
<a id=__codelineno-28-687 name=__codelineno-28-687 href=#__codelineno-28-687></a>is_false<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-28-688 name=__codelineno-28-688 href=#__codelineno-28-688></a><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=k>in</span>
<a id=__codelineno-28-689 name=__codelineno-28-689 href=#__codelineno-28-689></a><span class=w>    </span><span class=o>[</span>fF<span class=o>]</span><span class=w> </span><span class=p>|</span><span class=w> </span><span class=o>[</span>nN<span class=o>]</span><span class=w> </span><span class=p>|</span><span class=w> </span><span class=o>[</span>nN<span class=o>][</span>oO<span class=o>]</span><span class=w> </span><span class=p>|</span><span class=w> </span><span class=o>[</span>fF<span class=o>][</span>aA<span class=o>][</span>lL<span class=o>][</span>sS<span class=o>][</span>eE<span class=o>]</span><span class=w> </span><span class=p>|</span><span class=w> </span><span class=m>0</span><span class=o>)</span>
<a id=__codelineno-28-690 name=__codelineno-28-690 href=#__codelineno-28-690></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-28-691 name=__codelineno-28-691 href=#__codelineno-28-691></a><span class=w>        </span><span class=p>;;</span>
<a id=__codelineno-28-692 name=__codelineno-28-692 href=#__codelineno-28-692></a><span class=w>    </span><span class=k>esac</span>
<a id=__codelineno-28-693 name=__codelineno-28-693 href=#__codelineno-28-693></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-28-694 name=__codelineno-28-694 href=#__codelineno-28-694></a><span class=o>}</span>
<a id=__codelineno-28-695 name=__codelineno-28-695 href=#__codelineno-28-695></a>
<a id=__codelineno-28-696 name=__codelineno-28-696 href=#__codelineno-28-696></a><span class=c1># Apply sysctl settings, including files in /etc/sysctl.d</span>
<a id=__codelineno-28-697 name=__codelineno-28-697 href=#__codelineno-28-697></a>apply_sysctl<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-28-698 name=__codelineno-28-698 href=#__codelineno-28-698></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-x<span class=w> </span>/lib/systemd/systemd-sysctl<span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-28-699 name=__codelineno-28-699 href=#__codelineno-28-699></a><span class=w>    </span>/lib/systemd/systemd-sysctl
<a id=__codelineno-28-700 name=__codelineno-28-700 href=#__codelineno-28-700></a><span class=w>    </span><span class=k>else</span>
<a id=__codelineno-28-701 name=__codelineno-28-701 href=#__codelineno-28-701></a><span class=w>        </span><span class=k>for</span><span class=w> </span>file<span class=w> </span><span class=k>in</span><span class=w> </span>/usr/lib/sysctl.d/*.conf<span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>do</span>
<a id=__codelineno-28-702 name=__codelineno-28-702 href=#__codelineno-28-702></a><span class=w>            </span>is_ignored_file<span class=w> </span><span class=s2>&quot;</span><span class=nv>$file</span><span class=s2>&quot;</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>continue</span>
<a id=__codelineno-28-703 name=__codelineno-28-703 href=#__codelineno-28-703></a><span class=w>            </span><span class=o>[</span><span class=w> </span>-f<span class=w> </span>/run/sysctl.d/<span class=si>${</span><span class=nv>file</span><span class=p>##*/</span><span class=si>}</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>continue</span>
<a id=__codelineno-28-704 name=__codelineno-28-704 href=#__codelineno-28-704></a><span class=w>            </span><span class=o>[</span><span class=w> </span>-f<span class=w> </span>/etc/sysctl.d/<span class=si>${</span><span class=nv>file</span><span class=p>##*/</span><span class=si>}</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>continue</span>
<a id=__codelineno-28-705 name=__codelineno-28-705 href=#__codelineno-28-705></a><span class=w>            </span><span class=nb>test</span><span class=w> </span>-f<span class=w> </span><span class=s2>&quot;</span><span class=nv>$file</span><span class=s2>&quot;</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>sysctl<span class=w> </span>-e<span class=w> </span>-p<span class=w> </span><span class=s2>&quot;</span><span class=nv>$file</span><span class=s2>&quot;</span><span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-28-706 name=__codelineno-28-706 href=#__codelineno-28-706></a><span class=w>        </span><span class=k>done</span>
<a id=__codelineno-28-707 name=__codelineno-28-707 href=#__codelineno-28-707></a><span class=w>        </span><span class=k>for</span><span class=w> </span>file<span class=w> </span><span class=k>in</span><span class=w> </span>/run/sysctl.d/*.conf<span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>do</span>
<a id=__codelineno-28-708 name=__codelineno-28-708 href=#__codelineno-28-708></a><span class=w>            </span>is_ignored_file<span class=w> </span><span class=s2>&quot;</span><span class=nv>$file</span><span class=s2>&quot;</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>continue</span>
<a id=__codelineno-28-709 name=__codelineno-28-709 href=#__codelineno-28-709></a><span class=w>            </span><span class=o>[</span><span class=w> </span>-f<span class=w> </span>/etc/sysctl.d/<span class=si>${</span><span class=nv>file</span><span class=p>##*/</span><span class=si>}</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>continue</span>
<a id=__codelineno-28-710 name=__codelineno-28-710 href=#__codelineno-28-710></a><span class=w>            </span><span class=nb>test</span><span class=w> </span>-f<span class=w> </span><span class=s2>&quot;</span><span class=nv>$file</span><span class=s2>&quot;</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>sysctl<span class=w> </span>-e<span class=w> </span>-p<span class=w> </span><span class=s2>&quot;</span><span class=nv>$file</span><span class=s2>&quot;</span><span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-28-711 name=__codelineno-28-711 href=#__codelineno-28-711></a><span class=w>        </span><span class=k>done</span>
<a id=__codelineno-28-712 name=__codelineno-28-712 href=#__codelineno-28-712></a><span class=w>        </span><span class=k>for</span><span class=w> </span>file<span class=w> </span><span class=k>in</span><span class=w> </span>/etc/sysctl.d/*.conf<span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>do</span>
<a id=__codelineno-28-713 name=__codelineno-28-713 href=#__codelineno-28-713></a><span class=w>            </span>is_ignored_file<span class=w> </span><span class=s2>&quot;</span><span class=nv>$file</span><span class=s2>&quot;</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>continue</span>
<a id=__codelineno-28-714 name=__codelineno-28-714 href=#__codelineno-28-714></a><span class=w>            </span><span class=nb>test</span><span class=w> </span>-f<span class=w> </span><span class=s2>&quot;</span><span class=nv>$file</span><span class=s2>&quot;</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>sysctl<span class=w> </span>-e<span class=w> </span>-p<span class=w> </span><span class=s2>&quot;</span><span class=nv>$file</span><span class=s2>&quot;</span><span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-28-715 name=__codelineno-28-715 href=#__codelineno-28-715></a><span class=w>        </span><span class=k>done</span>
<a id=__codelineno-28-716 name=__codelineno-28-716 href=#__codelineno-28-716></a><span class=w>        </span>sysctl<span class=w> </span>-e<span class=w> </span>-p<span class=w> </span>/etc/sysctl.conf<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-28-717 name=__codelineno-28-717 href=#__codelineno-28-717></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-28-718 name=__codelineno-28-718 href=#__codelineno-28-718></a><span class=o>}</span>
<a id=__codelineno-28-719 name=__codelineno-28-719 href=#__codelineno-28-719></a>
<a id=__codelineno-28-720 name=__codelineno-28-720 href=#__codelineno-28-720></a><span class=c1># A sed expression to filter out the files that is_ignored_file recognizes</span>
<a id=__codelineno-28-721 name=__codelineno-28-721 href=#__codelineno-28-721></a><span class=nv>__sed_discard_ignored_files</span><span class=o>=</span><span class=s1>&#39;/\(~\|\.bak\|\.orig\|\.rpmnew\|\.rpmorig\|\.rpmsave\)$/d&#39;</span>
<a id=__codelineno-28-722 name=__codelineno-28-722 href=#__codelineno-28-722></a>
<a id=__codelineno-28-723 name=__codelineno-28-723 href=#__codelineno-28-723></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$_use_systemctl</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;1&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-28-724 name=__codelineno-28-724 href=#__codelineno-28-724></a><span class=w>        </span><span class=k>if</span><span class=w>  </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;x</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span>xstart<span class=w> </span>-o<span class=w> </span><span class=se>\</span>
<a id=__codelineno-28-725 name=__codelineno-28-725 href=#__codelineno-28-725></a><span class=w>              </span><span class=s2>&quot;x</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span>xstop<span class=w> </span>-o<span class=w> </span><span class=se>\</span>
<a id=__codelineno-28-726 name=__codelineno-28-726 href=#__codelineno-28-726></a><span class=w>              </span><span class=s2>&quot;x</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span>xrestart<span class=w> </span>-o<span class=w> </span><span class=se>\</span>
<a id=__codelineno-28-727 name=__codelineno-28-727 href=#__codelineno-28-727></a><span class=w>              </span><span class=s2>&quot;x</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span>xreload<span class=w> </span>-o<span class=w> </span><span class=se>\</span>
<a id=__codelineno-28-728 name=__codelineno-28-728 href=#__codelineno-28-728></a><span class=w>              </span><span class=s2>&quot;x</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span>xtry-restart<span class=w> </span>-o<span class=w> </span><span class=se>\</span>
<a id=__codelineno-28-729 name=__codelineno-28-729 href=#__codelineno-28-729></a><span class=w>              </span><span class=s2>&quot;x</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span>xforce-reload<span class=w> </span>-o<span class=w> </span><span class=se>\</span>
<a id=__codelineno-28-730 name=__codelineno-28-730 href=#__codelineno-28-730></a><span class=w>              </span><span class=s2>&quot;x</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span>xcondrestart<span class=w> </span><span class=o>]</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-28-731 name=__codelineno-28-731 href=#__codelineno-28-731></a>
<a id=__codelineno-28-732 name=__codelineno-28-732 href=#__codelineno-28-732></a><span class=w>        </span>systemctl_redirect<span class=w> </span><span class=nv>$0</span><span class=w> </span><span class=nv>$1</span>
<a id=__codelineno-28-733 name=__codelineno-28-733 href=#__codelineno-28-733></a><span class=w>        </span><span class=nb>exit</span><span class=w> </span><span class=nv>$?</span>
<a id=__codelineno-28-734 name=__codelineno-28-734 href=#__codelineno-28-734></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-28-735 name=__codelineno-28-735 href=#__codelineno-28-735></a><span class=k>fi</span>
<a id=__codelineno-28-736 name=__codelineno-28-736 href=#__codelineno-28-736></a>
<a id=__codelineno-28-737 name=__codelineno-28-737 href=#__codelineno-28-737></a>strstr<span class=w> </span><span class=s2>&quot;</span><span class=k>$(</span>cat<span class=w> </span>/proc/cmdline<span class=k>)</span><span class=s2>&quot;</span><span class=w> </span><span class=s2>&quot;rc.debug&quot;</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nb>set</span><span class=w> </span>-x
<a id=__codelineno-28-738 name=__codelineno-28-738 href=#__codelineno-28-738></a><span class=k>return</span><span class=w> </span><span class=m>0</span>
</code></pre></div> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title=最后更新> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1-2.1-2M12.5 7v5.2l4 2.4-1 1L11 13V7h1.5M11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2v1.8Z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime">August 28, 2023 14:08:49</span> </span> <span class=md-source-file__fact> <span class=md-icon title=创建日期> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3h-2Z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime">April 18, 2023 18:29:24</span> </span> </aside> <form class=md-feedback name=feedback hidden> <fieldset> <legend class=md-feedback__title> Was this page helpful? </legend> <div class=md-feedback__inner> <div class=md-feedback__list> <button class="md-feedback__icon md-icon" type=submit title="This page was helpful" data-md-value=1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m7 0c0 .8-.7 1.5-1.5 1.5S14 10.3 14 9.5 14.7 8 15.5 8s1.5.7 1.5 1.5m-5 7.73c-1.75 0-3.29-.73-4.19-1.81L9.23 14c.45.72 1.52 1.23 2.77 1.23s2.32-.51 2.77-1.23l1.42 1.42c-.9 1.08-2.44 1.81-4.19 1.81Z"/></svg> </button> <button class="md-feedback__icon md-icon" type=submit title="This page could be improved" data-md-value=0> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10m-6.5-4c.8 0 1.5.7 1.5 1.5s-.7 1.5-1.5 1.5-1.5-.7-1.5-1.5.7-1.5 1.5-1.5M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m2 4.5c1.75 0 3.29.72 4.19 1.81l-1.42 1.42C14.32 16.5 13.25 16 12 16s-2.32.5-2.77 1.23l-1.42-1.42C8.71 14.72 10.25 14 12 14Z"/></svg> </button> </div> <div class=md-feedback__note> <div data-md-value=1 hidden> Thanks for your feedback! </div> <div data-md-value=0 hidden> Thanks for your feedback! Help us improve this page by using our <a href="https://github.com/hujianli94/hujianli94.github.io/issues/new/?title=[Feedback]+27.DevOps%E4%B8%8B%E7%9A%84Shell%E8%84%9A%E6%9C%AC+-+/Docker/3.Devops/27.DevOps%E4%B8%8B%E7%9A%84Shell%E8%84%9A%E6%9C%AC/" target=_blank>feedback form</a>. </div> </div> </div> </fieldset> </form> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> 回到页面顶部 </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=页脚> <a href=../26.docker-compose-devops/ class="md-footer__link md-footer__link--prev" aria-label="上一页: 26.docker-compose-devops"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> 上一页 </span> <div class=md-ellipsis> 26.docker-compose-devops </div> </div> </a> <a href=../28.Devops%E4%B8%8B%E7%9A%84Python%E8%84%9A%E6%9C%AC/ class="md-footer__link md-footer__link--next" aria-label="下一页: 28.Devops下的Python脚本"> <div class=md-footer__title> <span class=md-footer__direction> 下一页 </span> <div class=md-ellipsis> 28.Devops下的Python脚本 </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2023 - 2024 hujainli94 </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/hujianli94 target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> <a href=https://kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com/blog_img/20220125122524.png target=_blank rel=noopener title=kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 576 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M385.2 167.6c6.4 0 12.6.3 18.8 1.1C387.4 90.3 303.3 32 207.7 32 100.5 32 13 104.8 13 197.4c0 53.4 29.3 97.5 77.9 131.6l-19.3 58.6 68-34.1c24.4 4.8 43.8 9.7 68.2 9.7 6.2 0 12.1-.3 18.3-.8-4-12.9-6.2-26.6-6.2-40.8-.1-84.9 72.9-154 165.3-154zm-104.5-52.9c14.5 0 24.2 9.7 24.2 24.4 0 14.5-9.7 24.2-24.2 24.2-14.8 0-29.3-9.7-29.3-24.2.1-14.7 14.6-24.4 29.3-24.4zm-136.4 48.6c-14.5 0-29.3-9.7-29.3-24.2 0-14.8 14.8-24.4 29.3-24.4 14.8 0 24.4 9.7 24.4 24.4 0 14.6-9.6 24.2-24.4 24.2zM563 319.4c0-77.9-77.9-141.3-165.4-141.3-92.7 0-165.4 63.4-165.4 141.3S305 460.7 397.6 460.7c19.3 0 38.9-5.1 58.6-9.9l53.4 29.3-14.8-48.6C534 402.1 563 363.2 563 319.4zm-219.1-24.5c-9.7 0-19.3-9.7-19.3-19.6 0-9.7 9.7-19.3 19.3-19.3 14.8 0 24.4 9.7 24.4 19.3 0 10-9.7 19.6-24.4 19.6zm107.1 0c-9.7 0-19.3-9.7-19.3-19.6 0-9.7 9.7-19.3 19.3-19.3 14.5 0 24.4 9.7 24.4 19.3.1 10-9.9 19.6-24.4 19.6z"/></svg> </a> <a href="mailto:<1879324764@qq.com>" target=_blank rel=noopener title=发送邮件 class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M498.1 5.6c10.1 7 15.4 19.1 13.5 31.2l-64 416c-1.5 9.7-7.4 18.2-16 23s-18.9 5.4-28 1.6L284 427.7l-68.5 74.1c-8.9 9.7-22.9 12.9-35.2 8.1S160 493.2 160 480v-83.6c0-4 1.5-7.8 4.2-10.7l167.6-182.9c5.8-6.3 5.6-16-.4-22s-15.7-6.4-22-.7L106 360.8l-88.3-44.2C7.1 311.3.3 300.7 0 288.9s5.9-22.8 16.1-28.7l448-256c10.7-6.1 23.9-5.5 34 1.4z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-consent data-md-component=consent id=__consent hidden> <div class=md-consent__overlay></div> <aside class=md-consent__inner> <form class="md-consent__form md-grid md-typeset" name=consent> <h4>Cookie consent</h4> <p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p> <input class=md-toggle type=checkbox id=__settings> <div class=md-consent__settings> <ul class=task-list> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=analytics checked> <span class=task-list-indicator></span> Google Analytics </label> </li> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=github checked> <span class=task-list-indicator></span> GitHub </label> </li> </ul> </div> <div class=md-consent__controls> <button class="md-button md-button--primary">同意</button> <label class=md-button for=__settings>管理设定</label> </div> </form> </aside> </div> <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout(function(){document.querySelector("[data-md-component=consent]").hidden=!1},250);var action,form=document.forms.consent;for(action of["submit","reset"])form.addEventListener(action,function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map(function(e){return[e,!0]}))),location.hash="",location.reload()})</script> <script id=__config type=application/json>{"base": "../../..", "features": ["content.action.edit", "content.action.view", "content.code.copy", "content.code.annotate", "navigation.indexes", "navigation.footer", "navigation.indexes", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest"], "search": "../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script> <script src=../../../assets/javascripts/bundle.a7c05c9e.min.js></script> <script src=../../../javascripts/extra.js></script> <script src=https://file.cdn.shafish.cn/blog/js/video.min.js></script> </body> </html>