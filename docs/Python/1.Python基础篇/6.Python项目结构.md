# 6.Python项目的组织结构


## 脚本描述头信息

如果不是编写的项目，而是脚本文件，则需要为脚本添加一些基本信息，方便读者快速了解脚本的功能。

也可直接加入到PyChrm的文件和代码模板中。


```python
# -*- coding:utf8 -*-
# @Time    : ${DATE} ${TIME}
# @Author  : ${USER}
# @File    : ${NAME}.py
# @Software: ${PRODUCT_NAME}
# @Desc    :   
```




## Python项目结构

项目结构为统一的组织原则。

组织原则可以总结为一句话：让一切更简单更轻松

我们来看一个通用的结构



```shell
download_demo
├── LICENSE
├── MANIFEST.in
├── README.md
├── conf
├── fabfile
├── others
├── src
├── setup.py
└── .gitignore
├── requirements.txt
└── venv
└── img
```


这是python项目最外层的一个结构：


- LICENSE: 表示开源协议
- README.md：项目介绍
- conf：存放项目的配置文件，如部署时用到的Nginx的配置、Supervisor的配置或者其他配置
- fabfile：针对Fabric的配置，可以是一个fabfile.py文件。如果功能较多，可以拆分多个模块，放到fabfile包下，用`__init__.py`进行暴露
- src：项目源码目录
- requirements.txt：项目依赖模块，通过pip install -r requirements.txt就可以安装好项目的所有依赖
- setup.py：用来打包项目
- others：其他一些有必要放到源码管理的文件。
- .gitignore: 忽略一些不需要被纳管的管理文件，如pyc和log、env、.swp等文件或目录，常用过滤掉的还有dist/和 build/等目录，如加入常见的build、dist、.so、.pyc。
- MANIFEST.in：跟setup.py配合使用
- venv：虚拟环境目录。
- img：README.md说明文档中引用图片图标的放置目录




## Django项目的组织结构

```shell
project(src)
├── app1
│   ├── __init__.py
│   ├── admin.py
│   ├── apps.py
│   ├── migrations
│   ├── models.py
│   ├── script
│   ├── serializers.py
│   ├── tests.py
│   └── views.py
├── app2
├── db.sqlite3
├── project
│   ├── asgi.py
│   ├── settings.py
│   ├── urls.py
│   └── wsgi.py
├── manage.py
├── requirements.txt
├── templates
├── upload
└── venv
    ├── Lib
    ├── pyvenv.cfg
    └── Scripts
```


Django中的文件及说明

|文件|说明|
|------|--------|
|manage.py|Django程序执行的入口|
|db.sqlite3|SQLite的数据文件，Django默认用这种小型数据库存储数据，非必须|
|templates|Django生成的HTML文件夹，也可以在每个APP中使用模板文件夹|
|project|Django生成的和项目同名的配置文件夹|
|settings.py|Django总的配置文件，可以配置APP、数据库、中间件、模板等诸多选项|
|urls.py|Django默认的路由配置文件|
|wsgi.py|Django实现的WSGI接口的文件，用来处理Web请求|



### settings的拆分


正常情况下Django会为我们创建一个settings.py文件，我们需要区分开发环境和线上环境。

具体的做法是在之前 settings目录中新建settings包，把之前settings.py的内容放置到`settings/base.py`中，删除原来的`settings.py`文件，同时新增`__init__.py`、`develop.py`、`product.py`文件。


目录结构如下：


```shell
project(src)
├── app1
├── app2
├── db.sqlite3
├── project
├── __init__.py
├── asgi.py
├── settings
│   ├── base.py
│   ├── develop.py
│   └── product.py
├── urls.py
└── wsgi.py
├── manage.py
├── requirements.txt
├── templates
```

base.py的内容和之前settings.py的内容一致。




develop.py(开发)环境配置


```python
from .base import *

SECRET_KEY = '这里是你pycharm自己生成的秘钥'

# 开发环境数据库
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.mysql',
        'NAME': 'mytest',
        'USER': 'root',
        'PASSWORD': 'OSChina@2020',
        'HOST': '127.0.0.1',
        # 第三方登录功能必须加上
        "OPTIONS": {"init_command": "SET default_storage_engine=INNODB;"}
    }
}

# 线下开发模式是True
DEBUG = True

ALLOWED_HOSTS = ["*"]
```


product.py(生产)环境配置


```python
from .base import *

SECRET_KEY = '这里是你pycharm自己生成的秘钥'

# 线上数据库
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.mysql',
        'NAME': 'openvpndb',
        'USER': 'root',
        'PASSWORD': 'OSChina@2020',
        'HOST': '192.168.1.132',
        # 第三方登录功能必须加上
        'CONN_MAX_AGE': 5*60,
        "OPTIONS": {"init_command": "SET default_storage_engine=INNODB;"}
    }
}

# 线上调试模式是False
DEBUG = False

ALLOWED_HOSTS = [www.hujianlirunjs.com]
```


拆分完settings.py后，我们需要修改两个文件：manage.py、wsgi.py



manage.py和wsgi.py都更改为

```python
profile = os.environ.get('PROJECT_PROFILE', 'develop')
os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'download_demo.settings.{}'.format(profile))
```


pychrm中修改运行按钮为：

```shell
PYTHONUNBUFFERED=1;DJANGO_SETTINGS_MODULE=project.settings.develop
```



拆分`settings.py`的作用是保证开发的组织合理性，降低后期开发维护的成本






## Django 生产开发配置分离


[Django 生产开发配置分离](https://www.yuque.com/cuiliang0302/python/diu0vh)






## Flask项目结构


项目结构

```shell
flasky     # 程序根目录
├── app     # 核心模块目录
│   ├── email.py     # 邮件发送模版
│   ├── __init__.py
│   ├── main     # 蓝图模块目录
│   │   ├── errors.py     # 错误处理模块
│   │   ├── forms.py     # 页面表单模块
│   │   ├── __init__.py
│   │   └── views.py     # 正常处理模块
│   ├── models.py     # 对象关系映射模块
│   ├── static     # 页面静态资源目录
│   │   └── favicon.ico     # 页面收藏夹图标
│   └── templates     # 默认存放页面模版目录
│       ├── 404.html
│       ├── base.html
│       ├── index.html
│       ├── mail     # 邮件模块目录
│       │   ├── new_user.html
│       │   └── new_user.txt
│       └── user.html
├── config.py     # 程序配置文件
├── data-dev.sqlite     # 程序数据库文件
├── manage.py     # 程序管理启动文件
├── migrations     # 数据库迁移目录
│   ├── alembic.ini
│   ├── env.py
│   ├── README
│   ├── script.py.mako
│   └── versions
├── requirements.txt     # 所有依赖包文件
└── tests     # 测试文件目录
    ├── __init__.py
    └── test_basics.py
```