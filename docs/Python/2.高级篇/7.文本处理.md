# 7.文本处理


正是由于系统管理员需要经常处理文本，Linux才有了许多与文本处理相关的工具，如grep、awk、sed、wc、tr、cut、cat等。

文本处理是一个如此常见的需求，因此，我们应该掌握一种强大的文本处理工具并将其应用在日常的所有工作当中。



## 1.字符串

Python可以使用单引号或双引号来定义字符串


```shell
In [1]: greet = "Hello, world"

In [2]: greet = 'Hello, world'
```

使用“\”加上一个可以显示的字符来定义。

```shell

In [5]: intro = 'He\'s a teacher'

In [6]: statement = "John said to me: \"Can you do me a favour tonight\""
```

除了使用转义符以外，还可以使用原始字符串（raw string）。

```python
import os

path = r"c:\next"
print(path)
print(os.path.isdir(path))
```

Python的三引号定义字符串

```python
In [1]: message = ''' Type "copyright", "credits" or "license" for more information.
   ...: object?   -> Details about 'object', use 'object??' for extra details.'''
In [2]: message = """ Type "copyright", "credits" or "license" for more information.
   ...: object?   -> Details about 'object', use 'object??' for extra details."""
```

### 1.1 字符串是不可变的有序集合

Python字符串的不可变性.所以操作字符串时需要避免产生太多的中间结果.错误的操作.

用for循环和字符串的“+”操作连接字符串
```shell
In [1]: fruits = ['orange', 'apple', 'banana', 'pear']

In [2]: statement = fruits[0]

In [3]: for item in fruits[1:]:
   ...:     statement = statement + ", " + item
   ...:

In [4]: print(statement)
orange, apple, banana, pear
```

正确的操作
```shell
In [5]: ", ".join(fruits)
Out[5]: 'orange, apple, banana, pear'
```


字符串的索引
```shell
In [6]: s = "Hello,world"

In [7]: s[:5]
Out[7]: 'Hello'

In [8]: s[0:5]
Out[8]: 'Hello'

In [9]: s[6:]
Out[9]: 'world'

In [10]: s[::-1]
Out[10]: 'dlrow,olleH'

In [11]: s[0:5:2]
Out[11]: 'Hlo'


#置逆一个字符串
In [12]: s[::-1]
Out[12]: 'dlrow,olleH'

#使用reversed函数
In [13]: ''.join(reversed(s))
Out[13]: 'dlrow,olleH'
```

### 1.2 字符串函数


#### 1.通用操作


```shell
In [1]: s = "Hello,world"

In [2]: len(s)
Out[2]: 11

In [3]: "Hello" in s
Out[3]: True

In [4]: "Hello" not in s
Out[4]: False
```



#### 2.与大小写相关的方法

以下几个函数是与字符大小写相关的字符串处理函数：

|函数|功能|
|-----|-----------------|
|s.upper|将字符串转换为大写|
|s.lower|将字符串转换为小写|
|s.isupper|判断字符串是否都为大写|
|s.islower|判断字符串是否都为小写|
|s.swapcase|将字符串中的大写转换为小写、小写转换为大写|
|s.capitalize|将首字母转换为大写|
|s.istitle|判断字符串是不是一个标题|


由于Python设计优秀，并拥有清晰的命名，所以，通过名字就能知道函数的作用。

如果通过名字无法知道函数的具体作用，则可以使用第二章介绍的IPython获取函数的帮助信息，如下所示：
```shell
In [1]: s = "hello, world"

In [2]: s.capitalize?
Signature: s.capitalize()
Docstring:
Return a capitalized version of the string.

More specifically, make the first character have upper case and the rest lower
case.
Type:      builtin_function_or_method
```

下面是使用IPython对Python中的字符串处理函数进行测试的例子：

```shell
In [1]: "lai ming xing".upper()
Out[1]: 'LAI MING XING'

In [2]: "Lai Ming Xing".upper()
Out[2]: 'LAI MING XING'

In [3]: "Lai Ming Xing".lower()
Out[3]: 'lai ming xing'

In [4]: "lai ming xing".isupper()
Out[4]: False

In [5]: "LAI MING XING".isupper()
Out[5]: True

In [6]: "Lai Ming Xing".swapcase()
Out[6]: 'lAI mING xING'

In [7]: "lai ming xing".capitalize()
Out[7]: 'Lai ming xing'

In [8]: "Lai ming xing".istitle()
Out[8]: False

In [9]: "Lai Ming Xing".istitle()
Out[9]: True
```

将字符串转换为大写或者小写是很实用的方法。例如，程序等待用户输入，在用户输入“yes”的时候，执行某项操作，否则就退出程序。
为了对用户更加友好，增强用户的体验感，程序应该在用户输入“yes”，“Yes”，“YES”，“yES”，“YeS”时都判断为真。
这个时候，我们可以将用户的输入全部转换为小写，然后与“yes”进行比较。如下所示：

```python
yes_or_no = input('Plese input yes or no : ')
if yes_or_no.lower() == "yes":
    print("continue do something")
else:
    print("exit...")
```

#### 3.判断类方法

Python的字符串有很多以“is”开头的方法，如前面介绍的istitle、isupper和islower。

这类方法都是判断类的方法，它们不会产生新的字符串，并且总是返回True或者False。

其他常见的字符串判断类方法有：

|方法|功能|
|---------|----------------------|
|s.isalpha|如果字符串只包含字母，并且非空，则返回True，否则返回False|
|s.isalnum|如果字符串值包含字母和数字，并且非空，则返回True，否则返回False|
|s.isspace|如果字符串值包含空格、制表符、换行符，并且非空，则返回True，否则返回False|
|s.isdecimal|如果字符串只包含数字字符，并且非空，则返回True，否则返回False|


下面是在IPython中测试的例子：

```shell
In [1]: "Python".isalpha()
Out[1]: True

In [2]: "Python 3.6".isalpha()
Out[2]: False

In [3]: "Python 3.6".isalnum()
Out[3]: False

In [4]: " \t\n".isspace()
Out[4]: True

In [5]: "Python 3.6".isdecimal()
Out[5]: False

In [6]: "3.6".isdecimal()
Out[6]: False

In [7]: "36".isdecimal()
Out[7]: True
```

#### 4.字符串方法startswith和endswith


|方法|功能|
|---------|----------------------|
|s.startswith|判断方法的参数是否为字符串的前缀|
|s.endswith|判断方法的参数是否为字符串的后缀|

```shell
In [5]: s = "hu jian li"

In [6]: s.startswith('hu')
Out[6]: True

In [7]: s.startswith('hua')
Out[7]: False

In [8]: s.startswith('hu j')
Out[8]: True

In [9]: s.endswith('li')
Out[9]: True
```

找出所有文本文件或Python文件，在Python中使用内置的字符串方法即可，非常方便。如下所示：

```shell
In [1]: import os

In [2]: [ item for item in os.listdir('.') if item.endswith('.py') ]
Out[2]: ['e.py', 'f.py', 'g.py']

In [3]: [ item for item in os.listdir('.') if item.endswith('.txt') ]
Out[3]: ['a.txt', 'b.txt', 'c.txt', 'd.txt']
```

下面就以MongoDB的日志为例演示Python中的前缀匹配。一个典型的MongoDB日志目录如下所示：
```shell
$ ls
mongod.log  mongod.log.2017-03-01T12-52-22  mongod.log.2017-03-01T12-52-23
mongod.log.2017-03-01T12-52-26  mongod.log.2017-03-01T12-52-27
```


这个时候，如果我们想要知道所有MongoDB日志文件占用的磁盘大小，可以使用如下命令：

```python
import os
mongod_logs = [item for item in os.listdir('/var/mongo/log') if item.startswith('mongod.log')]
sum_size = sum(os.path.getsize(os.path.join('/var/mongo/log', item)) for item in mongod_logs)
```



#### 5.查找类函数

|方法|功能|
|---------|----------------------|
|s.find|查找子串出现在字符串中的位置，如果查找失败，返回-1|
|s.index|与find函数类似，如果查找失败，抛出ValueError异常|
|s.rfind|与find函数类似，区别在于rfind是从后向前查找|
|s.rindex|与index函数类似，区别在于rindex是从后向前查找。|


```shell
In [1]:  s = "Return the lowest index in S where substring sub is found"

In [2]: s.find("in")
Out[2]: 18

In [3]: s.find("in",19)
Out[3]: 24

In [4]: s.find("not exists")
Out[4]: -1
```
对于判断一个字符串是否是另一个字符串的子串，正确的做法是使用in和not in：

```shell
In [5]: 'in' in s
Out[5]: True

In [6]: 'not exists' in s
Out[6]: False

In [7]: 'not exists' not in s
Out[7]: True
```
find函数最容易被错用的地方在于使用find函数判断一个子串是否出现在字符串中。如下所示：
 
**错误的用法**

```shell
In [1]: if "hello, world".find("not exists"):
   ...:     print(True)
   ...: else:
   ...:     print(False)
   ...: 
True
```