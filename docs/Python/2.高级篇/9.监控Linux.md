# 9.监控Linux


## 1. Python编写的监控工具


### 1.1 多功能系统资源统计工具dstat

综合了 vmstat, iostat, ifstat, netstat 等监控工具的功能，并且提供了更多的监控信息；

实时显示监控数据；

在问题分析和故障排查时，可以监视最重要的计数器，也可以对计数器进行排序；


安装

```shell
yum install -y dstat
dstat --version
dstat --listi

# dstat输出默认监控、报表输出的时间间隔为3秒钟,并且报表中输出10个结果：
dstat 3 10
```

```shell
# 1.查看全部内存都有谁在占用
dstat -g -l -m -s --top-mem


# 2.显示一些关于CPU资源损耗的数据：
dstat -c -y -l --proc-count --top-cpu


# 3.查看当前占用I/O、CPU、内存等最高的进程信息
dstat --top-mem --top-io --top-cpu


# 4.将结果输出到CSV文件，并输出到桌面
dstat --output dstat_output.csv
```

### 1.2 交互性监控工具glances

```shell
sudo apt update
sudo apt install glances
```

1. glances的使用

glances的使用非常简单，直接输入glances命令便进入了一个类似于top命令的交互式界面。

在这个界面中，显示了比top更加全面，更加具有可读性的信息。

为了增加可读性，glances会以不同的颜色表示不同的状态。
其中，

- 绿色表示性能良好，元须做任何额外工作；

- 蓝色表示系统性能有一些小问题，用户应当开始关注系统性能；

- 紫色表示性能报警，应当采取措施；

- 红色表示性能问题严重，应当立即处理。　　


glances是一个交互式的工具．因此，我们也可以输入命令来控制glances的行为。



2. glances中常见的命令

```sh
h：显示帮助信息；

q：离开程序退出；

c：按照 CPU 实时负载对系统进程排序；

m：按照内存使用状况对系统进程排序；

i：按照 I/O 使用状况对系统进程排序；

p：按照进程名称排序；

d：显示或隐藏磁盘读写状况；

f：显示或隐藏文件系统信息；1：分开显示每个 CPU 的使用情况。

```

3. 如果我们安装了 Bottle 这个 web 框架，还能够通过 web 浏览器显示和命令行终端相同的监控界面

```shell
pip install bottle

# glances-w ##默认端口是61208，访问地址没有限制
# Glances web server started on http://0.0.0.0:61208
```

glances还支持将采集的数据导人到其他服务中心，包括InfluxDB,Cassandra,CouchDB,OpenTSDB,Prometheus,StatsD,ElasticSearch,RabbitMQ/ActiveMQ,ZeroMQ,Kafka和Riemann。



## 2.使用Python编写自己的监控工具

