# 10.文档与报告

## 1. 使用csv读写CSV文件

### 1.1 写入CSV数据

- 写入元祖序列的数据

```python
#!/usr/bin/env python
# -*- coding:utf8 -*-

import csv

headers = ['ID', 'UserName', 'Password', 'Age', 'Country']
rows = [(1001, "qiye", "qiye_pass", 24, "China"),
        (1002, "Mary", "Mary_pass", 20, "USA"),
        (1003, "Jack", "Jack_pass", 20, "USA"),
        ]

with open('qiye.csv', 'w', newline="") as f:
    f_csv = csv.writer(f)
    f_csv.writerow(headers)
    f_csv.writerows(rows)
```



- 写入字典序列的数据

```python
import csv

headers = ['ID', 'UserName', 'Password', 'Age', 'Country']
rows = [{'ID': 1001, 'UserName': "qiye", 'Password': "qiye_pass", 'Age': 24, 'Country': " China"},
        {'ID': 1002, 'UserName': "Mary", 'Password': "Mary_pass", 'Age': 20, 'Country': "USA"},
        {'ID': 1003, 'UserName': "Jack", 'Password': "Jack_pass", 'Age': 20, 'Country': "USA"},
        ]

with open('qiye2.csv', 'w') as f:
    f_csv = csv.DictWriter(f, headers)
    f_csv.writeheader()
    f_csv.writerows(rows)
```


- 写入普通数据

```python
import csv

with open("sr.csv", "w") as f:
    w = csv.writer(f, delimiter=",")
    w.writerow(["one", "two", "three"])
    w.writerow(["four", "five", "six"])
```






### 1.2 读取CSV数据


```python
#!/usr/bin/env python
# -*- coding:utf8 -*-
# auther; 18793
# Date：2020/5/6 13:11
# filename: sample03.py

import csv

with open('qiye.csv') as f:
    f_csv = csv.reader(f)
    headers = next(f_csv)
    print(headers)
    for row in f_csv:
        print(row)
```


- 以列表形式输出

```python
import csv
csvfile = open('csv_test.csv', 'r')
# 
reader = csv.reader(csvfile)
for row in reader:
    if '小P' in row:
        print(row)
```


- 以字典形式输出

```python
# 以字典形式输出，第一行作为字典的键
reader = csv.DictReader(csvfile)
for row in reader:
    if row['姓名']== '小P':
        print(row)
```



### 1.3 读写csv文件

```python


import csv

with open('pingan.csv', 'r') as rf:
    reader = csv.reader(rf)
    with open('pingan2.csv', 'w') as wf:
        writer = csv.writer(wf)
        headers = next(reader)
        writer.writerow(headers)
        for row in reader:
            if row[0] < '2016-01-01':
                break
            if int(row[5]) >= int(50000000):
                writer.writerow(row)
```


读取-写入-读取

```python
# writer()函数
# 先读取csv文件，再将读取的数据处理后写入新的csv中
import csv

headers = ['编号', '书名', '作者', '出版社', '出版时间', '级别']
rows = [
    "10,软件工程1,胡建力,机械工业出版社,199407226517,2",
    "11,汇编语言1,胡建力2,北京工业大学出版社,199407126517,2",
    "12,计算机语言1,胡建力3,经济科学出版社,199417126517,1",
    "13,FLASH精选1,胡建力4,中国纺织出版社,199417126511,3",
    "14,JAVA基础1,胡建力5,电子工业出版社,199117126511,3",
    "15,JAVA程序设计1,胡建力6,世界出版社,199117126512,2",
    "16,新东方英语1,胡建力7,外语出版社,192117126512,1"
]

with open("test.csv", "r", encoding="utf-8") as rf:
    reader = csv.reader(rf)
    print("开始读取test.csv文件内容......................")
    with open("test_bak.csv", "w", newline="", encoding="utf-8") as wf:
        writer = csv.writer(wf, delimiter=",")
        header = ["|".join(headers)]
        print("开始写入标题header 到test_bak.csv文件......................")
        writer.writerow(header)
        print("开始写入文件旧数据 到test_bak.csv文件......................")
        for row in reader:
            # print(row)
            writer.writerow(row)
        rows_list = [str(row).split(",") for row in rows]
        print("开始写入新的数据 到test_bak.csv文件......................")
        for row_new in rows_list:
            writer.writerow(row_new)
    print("读写完毕，查看写入后的内容................")

with open("test_bak.csv", "r", encoding="utf-8") as rf:
    reader = csv.reader(rf)
    for info in reader:
        print("|".join(info))
```



python3写入csv文件中文乱码的解决

```python

# 加入encoding='utf-8-sig'就不会乱码了
with open("haha.csv",'w',newline='',encoding='utf-8-sig') as csvfile:
    writer = csv.writer(csvfile)
    writer.writerow(["飞机转场记录号", "登机口"])

```


csv操作函数

```python
#!/usr/bin/env python
#-*- coding:utf8 -*-
import csv

# 将数据写入csv文件
def write_csv_file(path, head, data):
    '''
    :param path: CSV文件的路径和文件名
    :param head: 生成的CSV文件的文件头
    :param data: data为需要写入CSV文件的数据，也需要传入一个列表
    :return:
    '''
    try:
        with open(path, "w", newline='') as csv_file:
            writer = csv.writer(csv_file, dialect='excel')
            if head is not None:
                writer.writerow(head)
            for row in data:
                writer.writerow(row)
            print("Write a CSV file to path %s Successful." % path)

    except Exception as e:
        print("Write an CSV file to path: %s, Case: %s" % (path, e))
```

## 2. 使用Python处理Excel文档


Python操作的Excel包有`xlrd、xlwt、pyExcelerator和openpyxl`。

其中，pyExcelerator只支持2003版本，openpyxl只支持2007版本，xlrd支持Excel任何版本的读取，xlwt支持Excel任何版本的写入。



### 2.1 使用xlrd和xlwt读写Excel

为了版本的兼容性，大多数开发人员选择使用xlrd和xlwt操作Excel。xlrd和xlwt的安装如下：

```shell
pip install xlrd
pip install xlwt
```


完成安装后，在Python交互式命令行查看xlrd和xlwt模块的版本信息：

```shell
import xlwt
import xlrd
xlrd.__VERSION__
'2.0.1'
xlwt.__VERSION__
'1.3.0'
```

Excel的写入相对比CVS复杂，但Excel可以实现设置数据格式、合并单元格、设置公式和插入图片等功能。使用xlwt实现上述功能的代码如下：








### 2.2 使用openpyxl读写Excel





!!!info "扩展阅读"


        [Python 操作 Excel库对比](https://www.yuque.com/fcant/python/dgofgp#kE9F7)
        
        [Python 操作 Excel库对比总结整理](https://www.yuque.com/fcant/python/fpmbgy#4UX38)
        
        [用Python自动化操作Excel制作报表](https://www.yuque.com/fcant/python/kwuqai#KeCxK)
        
        [Python实现数据写入 Excel 的三种模块](https://www.yuque.com/fcant/python/ckep3q#EwRGy)
