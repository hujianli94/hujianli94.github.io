# kvm网络配置


## 1.创建桥接网络

在 KVM 中，CentOS 7 和 Ubuntu 20.04 的配置步骤略有不同。下面分别列出了在 CentOS 7 和 Ubuntu 20.04 上创建桥接网络的配置步骤：



=== "CentOS 7"


    1. 安装必要的软件包：


    ```shell
    sudo yum install bridge-utils
    ```

    2. 编辑`/etc/sysconfig/network-scripts/ifcfg-eth0`文件，并将其配置更改如下

    ```shell
    DEVICE=eth0
    BOOTPROTO=none
    ONBOOT=yes
    TYPE=Ethernet
    IPADDR=<实际 IP 地址>
    NETMASK=<实际子网掩码>
    GATEWAY=<实际网关>
    ```


    3. 创建桥接网络的配置文件`/etc/sysconfig/network-scripts/ifcfg-br0`，并将其内容设置如下：

    ```shell
      DEVICE=br0
      TYPE=Bridge
      BOOTPROTO=static
      ONBOOT=yes
      IPADDR=<与 eth0 同一网段，但不要与 eth0 的 IP 地址相同>
      NETMASK=<与 eth0 同一网段的子网掩码>
      GATEWAY=<实际网关>
      DNS1=<实际 DNS 服务器>
      DNS2=<备用 DNS 服务器>
      DELAY=0
      STP=on
    ```

    4. 编辑`/etc/sysctl.conf`文件，在末尾添加以下内容以启用 IP 转发和桥接功能：


    ```shell
    net.ipv4.ip_forward=1
    net.bridge.bridge-nf-call-ip6tables=0
    net.bridge.bridge-nf-call-iptables=0
    net.bridge.bridge-nf-call-arptables=0
    ```

    5. 重新加载 `/etc/sysctl.conf` 文件以应用更改：


    ```shell
    sudo sysctl -p
    sudo systemctl restart network
    ```


=== "Ubuntu 20.04"


    1. 安装必要的软件包：


    ```shell
    sudo apt update
    sudo apt install bridge-utils
    ```

    2. 编辑 `/etc/netplan/00-installer-config.yaml` 文件，并将其内容更改为如下所示：


    ```shell
    network:
      ethernets:
        eth0:
          dhcp4: false
      bridges:
        br0:
          interfaces: [eth0]
          addresses: [<实际 IP 地址/子网掩码>]
          gateway4: <实际网关>
          nameservers:
              addresses: [<实际 DNS 服务器>, <备用 DNS 服务器>]
          dhcp4: false
    ```

    替换 `<实际 IP 地址/子网掩码>`、`<实际网关>`、`<实际 DNS 服务器>` 和 `<备用 DNS 服务器>` 为相应的值。


    3. 应用配置更改、重启网络：


    ```shell
    sudo netplan apply
    sudo systemctl restart systemd-networkd
    ```

