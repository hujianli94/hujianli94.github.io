# Python工作环境管理

## 1.使用pyenv管理不同的Python版本


1.pyenv的安装

我们直接从GitHub下载项目到本地，然后，分别执行以下命令进行安装即可：

```shell
$ git clone https://github.com/yyuu/pyenv.git ~/.pyenv
正克隆到 '/home/hujianli/.pyenv'...
remote: Enumerating objects: 22935, done.
remote: Counting objects: 100% (481/481), done.
remote: Compressing objects: 100% (159/159), done.
remote: Total 22935 (delta 391), reused 346 (delta 316), pack-reused 22454
接收对象中: 100% (22935/22935), 4.66 MiB | 1.82 MiB/s, 完成.
处理 delta 中: 100% (15532/15532), 完成.

$ echo 'export PYENV_ROOT="$HOME/.pyenv"' >> ~/.bashrc
$ echo 'export PATH="$PYENV_ROOT/bin:$PATH"' >> ~/.bashrc
$ echo 'eval "$(pyenv init -)"' >> ~/.bashrc
```

安装完成以后需要重新载入配置文件，或者退出以后重新登录，以使~/.bash_profile中的配置生效。笔者一般选择使用source命令重新载入配置文件，如下所示：
```shell
$ source ~/.bashrc
```

至此，pyenv就安装完成了，我们可以通过下面的命令验证pyenv是否正确安装并获取pyenv的帮助信息：

```shell
$ pyenv --help
Usage: pyenv <command> [<args>]

Some useful pyenv commands are:
    commands    List all available pyenv commands
    local       Set or show the local application-specific Python version
    global      Set or show the global Python version
    shell       Set or show the shell-specific Python version
    install     Install a Python version using python-build
    uninstall   Uninstall a specific Python version
    rehash      Rehash pyenv shims (run this after installing executables)
    version     Show the current Python version and its origin
    versions    List all Python versions available to pyenv
    which       Display the full path to an executable
    whence      List all Python versions that contain the given executable

See 'pyenv help <command>' for information on a specific command.
For full documentation, see: https://github.com/yyuu/pyenv#readme
```

2.pyenv的使用

我们通过pyenv的install命令，可以查看pyenv当前支持哪些Python版本，如下所示：
```shell
$ pyenv  install --list
Available versions:
    3.6.0
    3.6-dev
    3.7-dev
    ...
```

由于pyenv可以安装的Python版本列表非常长，所以，这里进行了省略。读者可以在自己电脑上安装pyenv，然后执行pyenv install--list命令进行查看。可以看到，pyenv不但可以安装不同的Python版本，而且还可以安装不同的Python实现，也可以安装最新版本的Python用以学习。


使用pyenv安装不同的Python版本：

```shell
$ pyenv install -v 3.6.0
$ pyenv install -v 2.7.13
```

查看当前系统中包含的Python版本：
```shell
$ pyenv versions
* system (set by /home/lmx/.pyenv/version)
    2.7.13
    3.6.0
```


由于我们安装了2个Python版本，加上我们系统自身的Python，当前系统中存在3个不同的Python版本。

其中，输出结果前面的“*”表示当前正在使用的版本。我们也可以通过pyenv global选择不同的Python版本，如下所示：

```shell
$ pyenv global 3.6.0
$ pyenv versions
    system
    2.7.13
* 3.6.0 (set by /home/lmx/.pyenv/version)

$ python
Python 3.6.0 (default, Feb  8 2017, 15:53:33)
[GCC 4.7.2] on linux
Type "help", "copyright", "credits" or "license" for more information.
>>> exit()
$ pyenv global 2.7.13
$ python
Python 2.7.13 (default, Feb  8 2017, 16:03:42)
[GCC 4.7.2] on linux2
Type "help", "copyright", "credits" or "license" for more information.
```

使用pyenv以后，可以快速切换Python的版本。切换Python版本以后，与版本相关的依赖也会一起切换。

因此，我们不用担心不同的版本在系统中是否会相互干扰。

例如，切换Python版本以后，相应的pip也会跟着切换，所以不用担心自己使用的pip版本和Python版本不匹配的问题，如下所示：

```shell
$ pyenv global 3.6.0
$ pip --version
pip 9.0.1 from /home/lmx/.pyenv/versions/3.6.0/lib/python3.6/site-packages (python 3.6)
$ pyenv global 2.7.13
$ pip --version
pip 9.0.1 from /home/lmx/.pyenv/versions/2.7.13/lib/python2.7/site-packages (python 2.7)
```

如果想要删除Python版本，使用uninstall命令即可。如下所示：

```shell
$ pyenv uninstall 2.7.10
```


## 2.创建虚拟环境

=== "Python2"

    ```shell
    $ sudo pip install virtualenv
    $ pip install virtualenv

    $ virtualenv venv
    New python executable in venv/bin/python2.7
    Also creating executable in venv/bin/python
    Installing setuptools, pip, wheel...done.
    ```

=== "Python3"

    ```shell
    $ sudo apt-get install python3-venv

    # 创建虚拟环境的命令格式如下：
    $ python3 -m venv virtual-environment-name -m venv 

    $ python3 -m venv venv
    ```


使用虚拟环境

```shell
# 如果你使用的是 Linux 或 macOS，可以通过下面的命令激活虚拟环境：
$ source venv/bin/activate

# 如果使用微软 Windows 系统，激活命令是：
$ venv\Scripts\activate
```


虽然多数情况下，为了方便，应该激活虚拟环境，但是不激活也能使用虚拟环境。

> 例如，为了启动 venv 虚拟环境中的 Python 控制台， 
> 在Linux或macOS中可以执行`venv/bin/python`命令， 
> 在微软Windows中可以执行`venv\Scripts\python`命令。

虚拟环境中的工作结束后，在命令提示符中输入 deactivate ，还原当前终端会话的 PATH 环境变量，把命令提示符重置为最初的状态。




## 3.使用virtualenv管理不同的项目

virtualenv本身是一个独立的项目，用以隔离不同项目的工作环境。
例如，用户lmx希望在项目A中使用Flask0.8这个版本，与此同时，又想在项目B中使用Flask0.9这个版本。

如果我们全局安装Flask，必然无法满足用户的需求。这个时候，我们就可以使用virtualenv。


1.pyenv-virtualenv的安装

安装和使用pyenv-virtualenv插件如下所示：
```shell
$ git clone https://github.com/yyuu/pyenv-virtualenv.git $(pyenv root)/plugins/pyenv-virtualenv
Cloning into '/home/lmx/.pyenv/plugins/pyenv-virtualenv'...
remote: Counting objects: 1860, done.
remote: Total 1860 (delta 0), reused 0 (delta 0), pack-reused 1860
Receiving objects: 100% (1860/1860), 530.62 KiB | 213 KiB/s, done.
Resolving deltas: 100% (1274/1274), done.

$ echo 'eval "$(pyenv virtualenv-init -)"' >> ~/.bashrc
```

与安装pyenv类似，安装完成以后需要重新载入配置文件，或者退出用户再登录，以使得配置文件生效：

```shell
$ source  ~/.bashrc
```


2.pyenv-virtualenv的使用

有了pyenv-virtualenv以后，我们可以为同一个Python解释器，创建多个不同的工作环境。
例如，我们新建两个工作环境：
```shell
$ pyenv virtualenv 2.7.13 first_project
$ pyenv virtualenv 2.7.13 second_project
```


可以使用virtualenvs子命令查看工作环境：
```shell
$ pyenv virtualenvs
  2.7.13/envs/first_project (created from /home/lmx/.pyenv/versions/2.7.13)
  2.7.13/envs/second_project (created from /home/lmx/.pyenv/versions/2.7.13)
  first_project (created from /home/lmx/.pyenv/versions/2.7.13)
  second_project (created from /home/lmx/.pyenv/versions/2.7.13)
```


创建完工作环境以后，可以通过activate和deactivate子命令进入或退出一个工作环境。进入工作环境以后，左边的提示符会显示你当前所在的工作环境，以免因为环境太多导致操作错误。

```shell
$ pyenv activate first_project
(first_project) $ pip install flask==0.8
(first_project) $ pyenv deactivate
```
接下来，我们看一下在不同的工作环境安装不同的Flask版本：

```shell
$ pyenv activate first_project
(first_project) $ pip install flask==0.8
(first_project) $ pyenv deactivate
$ pyenv activate second_project
(second_project) $ pip install flask==0.9
```

如果想要删除虚拟环境，则使用：

```shell
$ pyenv virtualenv-delete first_project
```

使用pyenv和python-virtualenv插件，我们就能够自由地在不同的版本之间进行切换，相比管理Python版本，不但节省了时间，也避免了工作过程中的相互干扰。


