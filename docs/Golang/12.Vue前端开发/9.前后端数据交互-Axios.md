# 9.前后端数据交互 Axios



## 9.1 介绍


在前端页面展示的数据大多数都是通过访问一个API获取的，做这件事的方法由好几种，例如jquery ajax、vue-resource、axios，

而vue-resource是一个vue插件，但3版本不再更新，目前官方推荐主流的axios，axios是一个http请求库。

官方文档：http://www.axios-js.com/zh-cn/docs/



## 9.2 使用

使用流程：


### 1.安装axios

```shell
npm install axios -save
```

package.json中可查看版本信息

```json
  "dependencies": {
    "axios": "^1.5.1",
    "core-js": "^3.8.3",
    "vue": "^3.2.13"
  },
```

### 2.在main.js文件中全局注册


```js
import {createApp} from "vue";
import App from "./App.vue";
import axios from "axios"; //导入

const app = createApp(App);
//注册
app.config.globalProperties.$axios = axios;
app.mount("#app");
```

### 3.在组件中使用

#### GET

从api获取用户数据，在前端展示：


```html
<template>
  <p class="greeting">{{ greeting }}</p>
  <button type="button" @click="getData">获取后端数据</button>
  {{ data }}
  <table border="1">
    <thead>
    <tr>
      <td>ID</td>
      <td>用户名</td>
      <td>邮箱</td>
      <td>性别</td>
      <td>城市</td>
    </tr>
    </thead>
    <tbody>
    <tr v-for="row in data" :key="row.id">
      <td>{{ row.id }}</td>
      <td>{{ row.username }}</td>
      <td>{{ row.email }}</td>
      <td>{{ row.sex }}</td>
      <td>{{ row.city }}</td>
    </tr>
    </tbody>
  </table>
</template>

<script>
export default {
  name: "TestDemo",
  props: {
    greeting: String,
  },
  data() {
    return {
      data: ""
    }
  },
  methods: {
    getData() {
      // this.$axios.get('http://aliangedu.cn/test-table/user.json')
      // 本地模拟数据
      this.$axios.get("user.json").then((response) => {
        if (response.data && response.data.code === 0) {
          this.data = response.data.data;
        }
      })
          .catch((err) => {
            console.error(err);
          });
    },
  }
}
</script>

<style scoped>
.greeting {
  color: red;
  font-weight: bold;
}
</style>
```



由于没有后端API接口，我们手工模拟一些数据，`/public/user.json`

```json
{
  "code": 0,
  "message": "",
  "data": [
    {"id": 1, "username": "张三", "email": "zhangsan@example.com", "sex": "男", "city": "北京"},
    {"id": 2, "username": "李四", "email": "lisi@example.com", "sex": "女", "city": "上海"},
    {"id": 3, "username": "王五", "email": "wangwu@example.com", "sex": "男", "city": "广州"},
    {"id": 4, "username": "赵六", "email": "zhaoliu@example.com", "sex": "女", "city": "深圳"}
  ]
}
```

![](https://cdn.jsdelivr.net/gh/hujianli94/Picgo-atlas@main/img/1697533485495.7gtcrcq50cw0.webp)



如果想打开页面就自动渲染，可以放到mounted生命周期钩子中获取数据并赋值（mounted：把组件内容渲染到页面之后自动执行的函数）：

```html
<template>
  <p class="greeting">{{ greeting }}</p>
  <button type="button" @click="getData">获取后端数据</button>
  {{ data }}
  <table border="1">
    <thead>
    <tr>
      <td>ID</td>
      <td>用户名</td>
      <td>邮箱</td>
      <td>性别</td>
      <td>城市</td>
    </tr>
    </thead>
    <tbody>
    <tr v-for="row in data" :key="row.id">
      <td>{{ row.id }}</td>
      <td>{{ row.username }}</td>
      <td>{{ row.email }}</td>
      <td>{{ row.sex }}</td>
      <td>{{ row.city }}</td>
    </tr>
    </tbody>
  </table>
</template>

<script>
export default {
  name: "TestDemo",
  props: {
    greeting: String,
  },
  data() {
    return {
      data: ""
    }
  },
  mounted: function () {
    this.getData();
  },
  methods: {
    getData() {
      // this.$axios.get('http://aliangedu.cn/test-table/user.json')
      // 本地模拟数据
      this.$axios.get("user.json").then((response) => {
        if (response.data && response.data.code === 0) {
          this.data = response.data.data;
        }
      })
          .catch((err) => {
            console.error(err);
          });
    },
  }
}
</script>

<style scoped>
.greeting {
  color: red;
  font-weight: bold;
}
</style>
```


#### POST

登陆时提交表单数据案例：

```html
<template>
<div class="home">
  <img alt="Vue logo" src="../assets/logo.png"/>
  <h1>欢迎访问管理后台</h1>
  <form action="#">
    用户名：<input type="text" v-model="form.username">
    密  码：<input type="text" v-model="form.password">
    <button @click="loginBtn">登录</button>
  </form>
  <p style="color:red;" v-if="notice">用户名或者密码不能为空！</p>
  </div>
</template>

<script>
  export default {
    name: "Login",
    data(){
      return{
        form:{
          username:"",
          password:"",
        },
        notice:false,
      }
    },
    methods:{
      loginBtn(){
        if(this.form.username==''||this.form.password==''){
          this.notice=true;
        }else{
          this.notice=false;
          this.$axios.post("http://127.0.0.1:8000/api",this.form)
        }
      }
    }
  }
</script>

<style scoped>
  
</style>
```


## 9.3 异常处理

很多时候我们可能并没有从API获取想要的数据。这可能是由于很多种因素引起的，比如axios调用可能由于多种原因而失败，包括但不限于：

- API不工作了；
- 请求发作了；
- API没有按我们预期的格式返回信息


可以使用catch异常处理这些问题。

```html
<template>
  <p class="greeting">{{greeting}}</p>
  <button type="button" @click="getData">获取后端数据</button>
  {{data}}
  <table border="1">
    <thead>
      <tr>
        <td>ID</td>
        <td>用户名</td>
        <td>邮箱</td>
        <td>性别</td>
        <td>城市</td>
      </tr>
    </thead>
    <tbody >
      <tr v-for="row in data" :key="row.id">
        <td>{{ row.id }}</td>
        <td>{{ row.username }}</td>
        <td>{{ row.email }}</td>
        <td>{{ row.sex }}</td>
        <td>{{ row.city }}</td>
      </tr>
    </tbody>
  </table>
</template>

<script>
export default {
  name: "TestDemo",
  props:{
    greeting:String,
  },
  data(){
    return{
      data:""
    }
  },
  mounted:function () {
    this.getData();
  },
  methods:{
    getData(){
      this.$axios.get('http://aliangedu.cn/test-table/user1.json')
          .then(response=>(this.data=response.data.data))
          .catch(error=>{
            console.log("error"+error);
              })
    },
  },
}
</script>

<style scoped>
  .greeting{
    color:red;
    font-weight:bold;
  }
</style>
```


## 9.4 全局默认值


在实际开发中，几乎每个组件都会用到axios发起数据请求，如果每次都填写完整的请求路径，不利于后期维护。这时可以设置全局axios默认值。

`main.js`

```js
import {createApp} from "vue";
import App from "./App.vue";
import axios from "axios"; //导入

const app = createApp(App);
//设置默认值
axios.defaults.baseURL = "http://www.aliangedu.cn/";
axios.defaults.timeout = 5000;
//注册
app.config.globalProperties.$axios = axios;
app.mount("#app");
```



`src/components/TestDemo.vue`

```html
<template>
  <p class="greeting">{{greeting}}</p>
  <button type="button" @click="getData">获取后端数据</button>
  {{data}}
  <table border="1">
    <thead>
    <tr>
      <td>ID</td>
      <td>用户名</td>
      <td>邮箱</td>
      <td>性别</td>
      <td>城市</td>
    </tr>
    </thead>
    <tbody >
    <tr v-for="row in data" :key="row.id">
      <td>{{ row.id }}</td>
      <td>{{ row.username }}</td>
      <td>{{ row.email }}</td>
      <td>{{ row.sex }}</td>
      <td>{{ row.city }}</td>
    </tr>
    </tbody>
  </table>
</template>

<script>
export default {
  name: "TestDemo",
  props:{
    greeting:String,
  },
  data(){
    return{
      data:""
    }
  },
  mounted:function () {
    this.getData();
  },
  methods:{
    getData(){
      this.$axios.get('/test-table/user.json')
          .then(response=>(this.data=response.data.data))
          .catch(error=>{
            console.log("error"+error);
          })
    },
  },
}
</script>

<style scoped>
.greeting{
  color:red;
  font-weight:bold;
}
</style>
```


## 9.5 自定义实例默认值

有时候服务端接口有多个地址，就会涉及请求的域名不同、配置不同等，这时自定义实例可以很好解决。


### 1.定义实例

创建`src/api/http.js`文件


```js
import axios from "axios";

const instance =axios.create({
    baseURL:"http://www.aliangedu.cn/",
    timeout:5000,

});
//导出实例
export default instance;
```


### 2.全局配置

`main.js`

```js
import {createApp} from "vue";
import App from "./App.vue";
import axios from "./api/http"; //导入axios配置

const app = createApp(App);

//注册
app.config.globalProperties.$http = axios;
app.mount("#app");
```


### 3.组件使用


`src/components/TestDemo.vue`

```html
<template>
  <p class="greeting">{{greeting}}</p>
  <button type="button" @click="getData">获取后端数据</button>
  {{data}}
  <table border="1">
    <thead>
    <tr>
      <td>ID</td>
      <td>用户名</td>
      <td>邮箱</td>
      <td>性别</td>
      <td>城市</td>
    </tr>
    </thead>
    <tbody >
    <tr v-for="row in data" :key="row.id">
      <td>{{ row.id }}</td>
      <td>{{ row.username }}</td>
      <td>{{ row.email }}</td>
      <td>{{ row.sex }}</td>
      <td>{{ row.city }}</td>
    </tr>
    </tbody>
  </table>
</template>

<script>
export default {
  name: "TestDemo",
  props:{
    greeting:String,
  },
  data(){
    return{
      data:""
    }
  },
  mounted:function () {
    this.getData();
  },
  methods:{
    getData(){
      this.$http.get('/test-table/user.json')
          .then(response=>(this.data=response.data.data))
          .catch(error=>{
            console.log("error"+error);
          })
    },
  },
}
</script>

<style scoped>
.greeting{
  color:red;
  font-weight:bold;
}
</style>
```



## 9.6 拦截器


拦截器可以拦截每一次请求和响应，然后进行相应的处理。

请求拦截应用的场景：
-  发起请求前添加header




响应拦截应用场景：
- 统一处理API响应状态码200或非200的提示消息
- 统一处理catch异常提示信息


`src/api/http.js`


```js
import axios from "axios";

const instance =axios.create({
    baseURL:"http://www.aliangedu.cn/",
    timeout:5000,

});

//拦截器，请求拦截
instance.interceptors.request.use(config=>{
    //在请求被发送之前做些什么
    //例如添加请求头
    // config.headers['Test-Header']='123456';//加上就会跨域报错
    return config;
},error=>{
    //处理请求错误
    return Promise.reject(error)
});

//拦截器，响应拦截
instance.interceptors.response.use(response=>{
    //处理响应数据
    if(response.data.code==200){
        alert("数据请求成功！")//这里应根据后端返回消息显示
    }
    return response
},error=>{
    //处理响应错误(catch)
    alert('请求服务端接口错误！');
    return Promise.reject(error)
});

//导出实例
export default instance;
```