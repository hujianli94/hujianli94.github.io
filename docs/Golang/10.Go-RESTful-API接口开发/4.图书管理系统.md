# 4.图书管理系统


## 1 初始化项目环境

### 1.1 go常用项目结构


bookManage项目结构

```shell
.
├── README.md               # 项目说明（帮助你快速的属性和了解项目） 
├── config                  # 配置文件（mysql配置 ip 端口 用户名 密码，不能写死到代码中） 
├── controller              # CLD：服务入口，负责处理路由、参数校验、请求转发 
├── service                 # CLD：逻辑（服务）层，负责业务逻辑处理 
├── dao                     # CLD：负责数据与存储相关功能（mysql、redis、ES等） 
│	├── mysql 
├── model                   # 模型（定义表结构） 
├── logging                 # 日志处理 
├── main.go                 # 项目启动入口
├── middleware              # 中间件 
├── pkg                     # 公共服务（所有模块都能访问的服务） 
├── router                  # 路由（路由分发
```

### 1.2 创建数据库
```shell
mysql> create database books charset utf8;
```


### 1.3 当前项目架构

```shell
go mod init bookManage
```
图书管理服务:

1. 用户服务：登录，注册 
2. 书籍服务：对书籍的增删改查的操作

```shell
.
├── controller    # CLD：服务入口，负责处理路由、参数校验、请求转发 
│ 	├── book.go 
│ 	└── user.go 
├── dao           # CLD：负责数据与存储相关功能（mysql、redis、ES等） 
│ 	└── mysql 
│	 └── mysql.go 
├── main.go       # 项目启动入口 
├── middleware    # 中间件: token验证 
│ 	└── auth.go 
├── model         # 模型 
│	 ├── book.go 
│	 ├── user.go 
│ 	└── user_m2m_book.go 
└── router        # 路由 
  ├── api_router.go 
  ├── init_router.go 
  └── test_router.go
```


## 2 添加路由分层


### 2.1 main.go

```go
// bookManage project main.go
package main

import "bookManage/router"

/**
 * @author hujianli
 */
func main() {
	//1、初始化路由分层，将实例化router服务的方法拆分到router文件下
	r := router.InitRouter()
	r.Run(":8888")
}

```


### 2.2 router/init_router.go

```go
package router

import (
	"github.com/gin-gonic/gin"
)

/**
 * @author hujianli
 * 加载其他路由文件中的路由
 */

// 这个方法作用：初始化其他文件中的路由
func InitRouter() *gin.Engine {
	//初始化gin服务
	r := gin.Default()
	TestRouters(r)
	//SetupApiRouters(r)
	return r
}
```


### 2.3 router/test_router.go


```go
package router

import "github.com/gin-gonic/gin"

/**
 * @author hujianli
 */
func TestRouters(r *gin.Engine) {
	v1 := r.Group("/api/v1")
	v1.GET("test", TestHandler)
}

// 测试路由访问，http://127.0.0.1:8888/api/v1/test
func TestHandler(c *gin.Context) {
	c.String(200, "ok")
}
```

测试路由访问，`http://127.0.0.1:8888/api/v1/test`说明路由分组已经跑通了。



## 3 初始化mysql连接


### 3.1 main.go


```go
// bookManage project main.go
package main

import (
	"bookManage/dao/mysql"
	"bookManage/router"
)

/**
 * @author hujianli
 */
func main() {
	// 初始化mysql连接
	mysql.InitMysql()

	//初始化路由分层，将实例化router服务的方法拆分到router文件下
	r := router.InitRouter()
	r.Run(":8888")
}

```

### 3.2 dao/mysql/mysql.go

```go
// mysql project mysql.go
package mysql

import (
	"fmt"

	gmysql "gorm.io/driver/mysql"
	"gorm.io/gorm"
)

/**
 * @author hujianli
 */
var DB *gorm.DB

func InitMysql() {
	//1、连接数据库
	dsn := "root:124456@tcp(127.0.0.1:4406)/books?charset=utf8mb4&parseTime=True&loc=Local"
	db, err := gorm.Open(gmysql.Open(dsn), &gorm.Config{})
	if err != nil {
		fmt.Println("初始化mysql连接错误", err)
	}
	DB = db
}
```


## 4 定义多对多表结构

书和用户是多对多的关系。

书可以供多个用户借阅,一个用户也可以借阅过多本书，所以是多对多

