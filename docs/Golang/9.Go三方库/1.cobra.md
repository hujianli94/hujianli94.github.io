# Cobra

在日常生活和工作中，我们经常会看到一些以单词命名的字符串，然后将其转为各种格式的命名。

例如，在程序中，我们原本已经定义了某个命名，但可能需要将其转为一个或多个const常量，这时如果手动一个个地修改，那就太烦琐了，不仅有可能改错，而且工作效率低下。

实际上，我们可以通过编写一个小工具来实现这个功能，一来能够满足自己的需求，二来也能不断迭代，甚至满足一些定制化需求。

下面我们就开始打造属于自己的工具集，首先搭建工具的项目架子，然后实现一个工具，使其可以实现多种单词格式转换的功能。



## 1.安装Cobra
安装本项目依赖的基础库 Cobra，以便快速搭建 CLI 应用程序。在项目根目录中执行如下命令：
```sh
go get -u github.com/spf13/cobra@v1.7.0
```



## 2.初始化cmd和word子命令
下面对项目目录进行初始化，目录结构如下所示：
```sh
D:\GOLANG\GO\SRC\GITHUB\tool
├─cmd
    └─root.go
    └─word.go
├─main.go
├─go.mod
├─go.sum
└─internal
    └─word
```


## 3.实现
在本项目中创建入口文件main.go，并新增三个目录，分别是cmd、internal。

首先，在cmd目录下新建word.go文件，用于放置单词格式转换的子命令word，并在其中写入如下代码：

cmd/word.go

```go
package cmd

import (
	"log"
	"strings"

	"tour/internal/word"

	"github.com/spf13/cobra"
)

// 定义iota常量，数字递增+1
// 定义目前单词所支持的转换模式枚举值，
const (
	ModeUpper                      = iota + 1 // 全部转大写
	ModeLower                                 // 全部转小写
	ModeUnderscoreToUpperCamelCase            // 下划线转大写驼峰
	ModeUnderscoreToLowerCamelCase            // 下线线转小写驼峰
	ModeCamelCaseToUnderscore                 // 驼峰转下划线
)

var str string
var mode int8

// help命令输出帮助信息
var desc = strings.Join([]string{
	"该子命令支持各种单词格式转换，模式如下：",
	"1：全部转大写",
	"2：全部转小写",
	"3：下划线转大写驼峰",
	"4：下划线转小写驼峰",
	"5：驼峰转下划线",
}, "\n")


var wordCmd = &cobra.Command{
	Use:   "word",
	Short: "单词格式转换",
	Long:  desc,
	Run: func(cmd *cobra.Command, args []string) {
		var content string
		switch mode {
		case ModeUpper:
			content = word.ToUpper(str)
		case ModeLower:
			content = word.ToLower(str)
		case ModeUnderscoreToUpperCamelCase:
			content = word.UnderscoreToUpperCamelCase(str)
		case ModeUnderscoreToLowerCamelCase:
			content = word.UnderscoreToLowerCamelCase(str)
		case ModeCamelCaseToUnderscore:
			content = word.CamelCaseToUnderscore(str)
		default:
			log.Fatalf("暂不支持该转换模式，请执行 help word 查看帮助文档")
		}

		log.Printf("输出结果: %s", content)
	},
}

func init() {
	wordCmd.Flags().StringVarP(&str, "str", "s", "", "请输入单词内容")
	wordCmd.Flags().Int8VarP(&mode, "mode", "m", 0, "请输入单词转换的模式")
}
```

在上述代码中，其核心在于子命令word的 cobra.Command 调用和设置，其一共包含如下三个常用选项，分别是：

- Use：子命令的命令标识。
- Short：简短说明，在help命令输出的帮助信息中展示。
- Long：完整说明，在help命令输出的帮助信息中展示。



init() 函数解读：

在VarP系列的方法中，第一个参数为需要绑定的变量，第二个参数为接收该参数的完整的命令标志，第三个参数为对应的短标识，第四个参数为默认值，第五个参数为使用说明。




然后，在cmd目录下新建root.go文件，用于放置根命令，并在其中写入如下代码：

cmd/root.go

```go
var rootCmd = &cobra.Command{
	Use:   "",
	Short: "",
	Long:  "",
}

func Execute() error {
	return rootCmd.Execute()
}

func init() {
	rootCmd.AddCommand(wordCmd)
}
```

最后，在启动main.go文件中，写入如下运行代码：

```go
func main() {
	err := cmd.Execute()
	if err != nil {
		log.Fatalf("cmd.Execute err: %v", err)
	}
}
```


在项目的internal目录下，新建word目录及文件，并在word.go中写入具体实现

功能如下：
1. 单词全部转为小写。
2. 单词全部转为大写。
3. 下画线单词转为大写驼峰单词。
4. 下画线单词转为小写驼峰单词。
5. 驼峰单词转为下画线单词。


internal/word/word.go

```go
package word

import (
	"strings"
	"unicode"
)

// 单词全部转为小写。
func ToUpper(s string) string {
	return strings.ToUpper(s)
}

// 单词全部转为大写。
func ToLower(s string) string {
	return strings.ToLower(s)
}

// 下画线单词转为大写驼峰单词。
func UnderscoreToUpperCamelCase(s string) string {
	s = strings.Replace(s, "_", " ", -1)
	s = strings.Title(s)
	return strings.Replace(s, " ", "", -1)
}

// 下画线单词转为小写驼峰单词。
func UnderscoreToLowerCamelCase(s string) string {
	s = UnderscoreToUpperCamelCase(s)
	return string(unicode.ToLower(rune(s[0]))) + s[1:]
}

// 驼峰单词转为下画线单词。
func CamelCaseToUnderscore(s string) string {
	var output []rune
	for i, r := range s {
		if i == 0 {
			output = append(output, unicode.ToLower(r))
			continue
		}
		if unicode.IsUpper(r) {
			output = append(output, '_')
		}
		output = append(output, unicode.ToLower(r))
	}
	return string(output)
}
```


## 4.验证

