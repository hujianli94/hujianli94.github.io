# 4.Git 的使用

OpenStack 的代码托管在 GitHub 网站上，各组件代码的下载地址是 https://github.com/openstack/加上组件名称，

比如 keystone 的代码下载地址为：https://github.com/openstack/keystone 。

## 4.1 设置 Git 全局配置

打开一个 Linux 终端，可以建立一个单独的文件夹，运行：

```sh
git config --global user.name "FirstnameLastname"
git config --global user.email "your_email@youremail.com"
```

这些信息需要从 https://review.opendev.org/settings/ 中获取，如图

![1713365759771](https://cdn.jsdelivr.net/gh/hujianli94/picx-images-hosting@master/1713365759771.2h83iuxepg.webp){: .zoom}

## 4.2 安装 git-review 工具并验证

对于 Ubuntu12.04 或更高版本，在一个终端中运行

```sh
sudo apt-get install git-review
```

对于 Ubunu12.04 之前的版本，则运行

```sh
sudo pip install git-review
```

### 1.配置您的项目

打开一个终端并转到项目目录，然后下载 Keystone 的代码：

```sh
git clone git://github.com/openstack/keystone.git

git remote add gerrit https://username@review.openstack.org/openstack/keystone.git
```

### 2.添加远程仓库

运行 `git review -s` 命令。

系统会要求输入 gerrit 用户名。

输入 Launchpad id 并按下回车键即可完成 `git-review` 工具的安装并验证。

## 4.3 提交代码步骤

### 1.在 launchpad 的页面提交 bug report

例如：
https://bugs.launchpad.net/keystone

### 2.建立分支

打开一个终端，进入 keystone 目录。注意，确保位于主版本中，且代码最新。

```sh
git remote update
git checkout master
git pull --ff-only origin master
```

为 bug 建立一个分支，执行如下命令：

```sh
git checkout -b bug/333333
```

需要注意的是，如果对于同一个问题，有多次Commit,最好不要多次提交，应该使用下面命令
把所有的Commit一次提交：
```sh
git checkout master
git pull origin master
git checkout TOPIC-BRANCH
git rebase -i master
```

更不要使用同一个Commit ID修改多个问题。


### 3.在分支 Bug333333 中修改代码

将代码提交给 Gerrit：

```sh
git add .
```

添加全部修改或新增的文件：

```sh
git commit -a
git review
```

在使用 HTTP 方式 review 时，有可能会遇见未认证错误，此时可以换成 SSH 连接，前提是配置好 SSH。

在社区账户里需要填写 contact 信息：

https://review.openstack.org/#/settings/contact

填写完毕后可以提交。

之后即可在 My change 里查看自己提交的信息了。

### 4.提交信息规范

第一段是一句话的简介（标题形式，不需要标点），空一行，第二段可以是详细说明，最后一段为 `Closes-Bug：#xxxxxx` 或 `Blueprint xxxx。`

> 注意
> 如果在提交信息中增加一个 DocImpact 标志，在此提交合并后可以自动生成一个 bug，所有提交信息都会包含在 bug 描述内。

### 5.第二次提交修改

```sh
git commit --amend -a
```

### 6.如果提交发生冲突，解决方法如下：

```sh
# 解决冲突
git rebase --abort

# 暂存到栈中
git stash

# 切到主分支
git checkout master

# 解决权限问题
sudo chown -Rc $UID .git/

# 拉取
git pull

# 切回自己的分支
git checkout <branch>
git rebase master

# 如果出现问题解决后，继续
git rebase –continue

# 从栈中取出修改
git stash pop

# 提交并上传
git commit -a --amend
git review
```

## 4.4 Git 管理流程图

Git 管理流程图
![1713366183070](https://cdn.jsdelivr.net/gh/hujianli94/picx-images-hosting@master/1713366183070.4xubxsdes5.webp){: .zoom}
