<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="stay hungry,stay foolish"><meta name=author content=hujainli94><link href=https://hujianli94.github.io/Golang/13.K8s%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/1.K8s%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-%E5%90%8E%E7%AB%AFAPI%E5%BC%80%E5%8F%91/ rel=canonical><link href=../../12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/12.Element-Plus/ rel=prev><link href=../2.K8s%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/ rel=next><link rel=icon href=../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.5.3, mkdocs-material-9.4.10"><title>K8s管理系统-后端API开发 - DevOps运维开发</title><link rel=stylesheet href=../../../assets/stylesheets/main.fad675c6.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.356b1318.min.css><style>:root{--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M1 7.775V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 0 1 0 2.474l-5.026 5.026a1.75 1.75 0 0 1-2.474 0l-6.25-6.25A1.752 1.752 0 0 1 1 7.775Zm1.5 0c0 .066.026.13.073.177l6.25 6.25a.25.25 0 0 0 .354 0l5.025-5.025a.25.25 0 0 0 0-.354l-6.25-6.25a.25.25 0 0 0-.177-.073H2.75a.25.25 0 0 0-.25.25ZM6 5a1 1 0 1 1 0 2 1 1 0 0 1 0-2Z"/></svg>');--md-admonition-icon--abstract:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M2.5 1.75v11.5c0 .138.112.25.25.25h3.17a.75.75 0 0 1 0 1.5H2.75A1.75 1.75 0 0 1 1 13.25V1.75C1 .784 1.784 0 2.75 0h8.5C12.216 0 13 .784 13 1.75v7.736a.75.75 0 0 1-1.5 0V1.75a.25.25 0 0 0-.25-.25h-8.5a.25.25 0 0 0-.25.25Zm13.274 9.537v-.001l-4.557 4.45a.75.75 0 0 1-1.055-.008l-1.943-1.95a.75.75 0 0 1 1.062-1.058l1.419 1.425 4.026-3.932a.75.75 0 1 1 1.048 1.074ZM4.75 4h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM4 7.75A.75.75 0 0 1 4.75 7h2a.75.75 0 0 1 0 1.5h-2A.75.75 0 0 1 4 7.75Z"/></svg>');--md-admonition-icon--info:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"/></svg>');--md-admonition-icon--tip:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M3.499.75a.75.75 0 0 1 1.5 0v.996C5.9 2.903 6.793 3.65 7.662 4.376l.24.202c-.036-.694.055-1.422.426-2.163C9.1.873 10.794-.045 12.622.26 14.408.558 16 1.94 16 4.25c0 1.278-.954 2.575-2.44 2.734l.146.508.065.22c.203.701.412 1.455.476 2.226.142 1.707-.4 3.03-1.487 3.898C11.714 14.671 10.27 15 8.75 15h-6a.75.75 0 0 1 0-1.5h1.376a4.484 4.484 0 0 1-.563-1.191 3.835 3.835 0 0 1-.05-2.063 4.647 4.647 0 0 1-2.025-.293.75.75 0 0 1 .525-1.406c1.357.507 2.376-.006 2.698-.318l.009-.01a.747.747 0 0 1 1.06 0 .748.748 0 0 1-.012 1.074c-.912.92-.992 1.835-.768 2.586.221.74.745 1.337 1.196 1.621H8.75c1.343 0 2.398-.296 3.074-.836.635-.507 1.036-1.31.928-2.602-.05-.603-.216-1.224-.422-1.93l-.064-.221c-.12-.407-.246-.84-.353-1.29a2.425 2.425 0 0 1-.507-.441 3.075 3.075 0 0 1-.633-1.248.75.75 0 0 1 1.455-.364c.046.185.144.436.31.627.146.168.353.305.712.305.738 0 1.25-.615 1.25-1.25 0-1.47-.95-2.315-2.123-2.51-1.172-.196-2.227.387-2.706 1.345-.46.92-.27 1.774.019 3.062l.042.19a.884.884 0 0 1 .01.05c.348.443.666.949.94 1.553a.75.75 0 1 1-1.365.62c-.553-1.217-1.32-1.94-2.3-2.768L6.7 5.527c-.814-.68-1.75-1.462-2.692-2.619a3.737 3.737 0 0 0-1.023.88c-.406.495-.663 1.036-.722 1.508.116.122.306.21.591.239.388.038.797-.06 1.032-.19a.75.75 0 0 1 .728 1.31c-.515.287-1.23.439-1.906.373-.682-.067-1.473-.38-1.879-1.193L.75 5.677V5.5c0-.984.48-1.94 1.077-2.664.46-.559 1.05-1.055 1.673-1.353V.75Z"/></svg>');--md-admonition-icon--success:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"/></svg>');--md-admonition-icon--question:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.92 6.085h.001a.749.749 0 1 1-1.342-.67c.169-.339.436-.701.849-.977C6.845 4.16 7.369 4 8 4a2.756 2.756 0 0 1 1.637.525c.503.377.863.965.863 1.725 0 .448-.115.83-.329 1.15-.205.307-.47.513-.692.662-.109.072-.22.138-.313.195l-.006.004a6.24 6.24 0 0 0-.26.16.952.952 0 0 0-.276.245.75.75 0 0 1-1.248-.832c.184-.264.42-.489.692-.661.103-.067.207-.132.313-.195l.007-.004c.1-.061.182-.11.258-.161a.969.969 0 0 0 .277-.245C8.96 6.514 9 6.427 9 6.25a.612.612 0 0 0-.262-.525A1.27 1.27 0 0 0 8 5.5c-.369 0-.595.09-.74.187a1.01 1.01 0 0 0-.34.398ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"/></svg>');--md-admonition-icon--warning:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"/></svg>');--md-admonition-icon--failure:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M2.344 2.343h-.001a8 8 0 0 1 11.314 11.314A8.002 8.002 0 0 1 .234 10.089a8 8 0 0 1 2.11-7.746Zm1.06 10.253a6.5 6.5 0 1 0 9.108-9.275 6.5 6.5 0 0 0-9.108 9.275ZM6.03 4.97 8 6.94l1.97-1.97a.749.749 0 0 1 1.275.326.749.749 0 0 1-.215.734L9.06 8l1.97 1.97a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215L8 9.06l-1.97 1.97a.749.749 0 0 1-1.275-.326.749.749 0 0 1 .215-.734L6.94 8 4.97 6.03a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018Z"/></svg>');--md-admonition-icon--danger:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M9.504.43a1.516 1.516 0 0 1 2.437 1.713L10.415 5.5h2.123c1.57 0 2.346 1.909 1.22 3.004l-7.34 7.142a1.249 1.249 0 0 1-.871.354h-.302a1.25 1.25 0 0 1-1.157-1.723L5.633 10.5H3.462c-1.57 0-2.346-1.909-1.22-3.004L9.503.429Zm1.047 1.074L3.286 8.571A.25.25 0 0 0 3.462 9H6.75a.75.75 0 0 1 .694 1.034l-1.713 4.188 6.982-6.793A.25.25 0 0 0 12.538 7H9.25a.75.75 0 0 1-.683-1.06l2.008-4.418.003-.006a.036.036 0 0 0-.004-.009l-.006-.006-.008-.001c-.003 0-.006.002-.009.004Z"/></svg>');--md-admonition-icon--bug:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M4.72.22a.75.75 0 0 1 1.06 0l1 .999a3.488 3.488 0 0 1 2.441 0l.999-1a.748.748 0 0 1 1.265.332.75.75 0 0 1-.205.729l-.775.776c.616.63.995 1.493.995 2.444v.327c0 .1-.009.197-.025.292.408.14.764.392 1.029.722l1.968-.787a.75.75 0 0 1 .556 1.392L13 7.258V9h2.25a.75.75 0 0 1 0 1.5H13v.5c0 .409-.049.806-.141 1.186l2.17.868a.75.75 0 0 1-.557 1.392l-2.184-.873A4.997 4.997 0 0 1 8 16a4.997 4.997 0 0 1-4.288-2.427l-2.183.873a.75.75 0 0 1-.558-1.392l2.17-.868A5.036 5.036 0 0 1 3 11v-.5H.75a.75.75 0 0 1 0-1.5H3V7.258L.971 6.446a.75.75 0 0 1 .558-1.392l1.967.787c.265-.33.62-.583 1.03-.722a1.677 1.677 0 0 1-.026-.292V4.5c0-.951.38-1.814.995-2.444L4.72 1.28a.75.75 0 0 1 0-1.06Zm.53 6.28a.75.75 0 0 0-.75.75V11a3.5 3.5 0 1 0 7 0V7.25a.75.75 0 0 0-.75-.75ZM6.173 5h3.654A.172.172 0 0 0 10 4.827V4.5a2 2 0 1 0-4 0v.327c0 .096.077.173.173.173Z"/></svg>');--md-admonition-icon--example:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M5 5.782V2.5h-.25a.75.75 0 0 1 0-1.5h6.5a.75.75 0 0 1 0 1.5H11v3.282l3.666 5.76C15.619 13.04 14.543 15 12.767 15H3.233c-1.776 0-2.852-1.96-1.899-3.458Zm-2.4 6.565a.75.75 0 0 0 .633 1.153h9.534a.75.75 0 0 0 .633-1.153L12.225 10.5h-8.45ZM9.5 2.5h-3V6c0 .143-.04.283-.117.403L4.73 9h6.54L9.617 6.403A.746.746 0 0 1 9.5 6Z"/></svg>');--md-admonition-icon--quote:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M1.75 2.5h10.5a.75.75 0 0 1 0 1.5H1.75a.75.75 0 0 1 0-1.5Zm4 5h8.5a.75.75 0 0 1 0 1.5h-8.5a.75.75 0 0 1 0-1.5Zm0 5h8.5a.75.75 0 0 1 0 1.5h-8.5a.75.75 0 0 1 0-1.5ZM2.5 7.75v6a.75.75 0 0 1-1.5 0v-6a.75.75 0 0 1 1.5 0Z"/></svg>');}</style><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../stylesheets/extra.css><link rel=stylesheet href=https://file.cdn.shafish.cn/blog/css/vssue.css><link rel=stylesheet href=https://file.cdn.shafish.cn/blog/css/video-js.min.css><link rel=stylesheet href=https://file.cdn.shafish.cn/blog/css/video.css><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","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"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","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",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=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",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script><script>var consent;"undefined"==typeof __md_analytics||(consent=__md_get("__consent"))&&consent.analytics&&__md_analytics()</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#k8s管理系统-后端api开发 class=md-skip> 跳转至 </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=页眉> <a href=../../.. title=DevOps运维开发 class="md-header__button md-logo" aria-label=DevOps运维开发 data-md-component=logo> <img src=../../../assets/images/logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> DevOps运维开发 </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> K8s管理系统-后端API开发 </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label=切换至深色模式 type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title=切换至深色模式 for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=blue data-md-color-accent=blue aria-label=切换至浅色模式 type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title=切换至浅色模式 for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=查找> <a href=javascript:void(0) class="md-search__icon md-icon" title=分享 aria-label=分享 data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=清空当前内容 aria-label=清空当前内容 tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> 正在初始化搜索引擎 </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/hujianli94/hujianli94.github.io title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> hujianli94.github.io </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=标签 data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> 首页 </a> </li> <li class=md-tabs__item> <a href=../../../Kubernetes/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Kubernetes/ class=md-tabs__link> Kubernetes </a> </li> <li class=md-tabs__item> <a href=../../../Docker/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Docker/ class=md-tabs__link> Docker </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../../0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Go-Web%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98/ class=md-tabs__link> Golang </a> </li> <li class=md-tabs__item> <a href=../../../Python/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Pythjon-auto-ops/ class=md-tabs__link> Python </a> </li> <li class=md-tabs__item> <a href=../../../Python-vs-Go/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Python-vs-Go/ class=md-tabs__link> Python-vs-Go </a> </li> <li class=md-tabs__item> <a href=../../../Linux/Shell/Shell%E7%AE%80%E4%BB%8B/ class=md-tabs__link> Linux </a> </li> <li class=md-tabs__item> <a href=../../../Other/tools/1.PicGo%E5%9B%BE%E5%BA%8A/ class=md-tabs__link> Other </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=导航栏 data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title=DevOps运维开发 class="md-nav__button md-logo" aria-label=DevOps运维开发 data-md-component=logo> <img src=../../../assets/images/logo.png alt=logo> </a> DevOps运维开发 </label> <div class=md-nav__source> <a href=https://github.com/hujianli94/hujianli94.github.io title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> hujianli94.github.io </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> <span class=md-ellipsis> 首页 </span> </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex> <span class=md-ellipsis> Kubernetes </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_1> <label class=md-nav__link for=__nav_2_1 id=__nav_2_1_label tabindex=0> <span class=md-ellipsis> 0.学习线路 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_1_label aria-expanded=false> <label class=md-nav__title for=__nav_2_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Kubernetes/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Kubernetes/ class=md-nav__link> <span class=md-ellipsis> Kubernetes </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2> <label class=md-nav__link for=__nav_2_2 id=__nav_2_2_label tabindex=0> <span class=md-ellipsis> 1.安装篇 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2> <span class="md-nav__icon md-icon"></span> 1.安装篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/1.Kubeadm%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/ class=md-nav__link> <span class=md-ellipsis> Kubeadm安装高可用集群 </span> </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/2.%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/ class=md-nav__link> <span class=md-ellipsis> 二进制安装高可用K8s集群 </span> </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/3.%E5%AE%89%E8%A3%85%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/ class=md-nav__link> <span class=md-ellipsis> 安装常用工具 </span> </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/4.Kubeadm%E5%AE%89%E8%A3%85%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/ class=md-nav__link> <span class=md-ellipsis> Kubeadm安装开发环境 </span> </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/5.K3s%E5%92%8CMinikube/ class=md-nav__link> <span class=md-ellipsis> K3s和Minikube </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_3> <label class=md-nav__link for=__nav_2_3 id=__nav_2_3_label tabindex=0> <span class=md-ellipsis> 2.基础篇 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_3_label aria-expanded=false> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> 2.基础篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/3.Docker%E5%9F%BA%E7%A1%80/ class=md-nav__link> <span class=md-ellipsis> Docker基础 </span> </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Kubernetes%E7%9A%84%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/ class=md-nav__link> <span class=md-ellipsis> Kubernetes的基础概念 </span> </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Kubernetes%E8%B0%83%E5%BA%A6%E5%9F%BA%E7%A1%80/ class=md-nav__link> <span class=md-ellipsis> Kubernetes调度基础 </span> </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/6.Kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83%E5%9F%BA%E7%A1%80/ class=md-nav__link> <span class=md-ellipsis> Kubernetes服务发布基础 </span> </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/7.Kubernetes%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> Kubernetes配置管理 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_4> <label class=md-nav__link for=__nav_2_4 id=__nav_2_4_label tabindex=0> <span class=md-ellipsis> 3.进阶篇 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_4_label aria-expanded=false> <label class=md-nav__title for=__nav_2_4> <span class="md-nav__icon md-icon"></span> 3.进阶篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Kubernetes/3.%E8%BF%9B%E9%98%B6%E7%AF%87/8.Kubernetes%E5%AD%98%E5%82%A8%E5%85%A5%E9%97%A8/ class=md-nav__link> <span class=md-ellipsis> Kubernetes存储入门 </span> </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/3.%E8%BF%9B%E9%98%B6%E7%AF%87/9.Kubernetes%E9%AB%98%E7%BA%A7%E8%B0%83%E5%BA%A6/ class=md-nav__link> <span class=md-ellipsis> Kubernetes高级调度 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_5> <label class=md-nav__link for=__nav_2_5 id=__nav_2_5_label tabindex=0> <span class=md-ellipsis> 4.高级篇 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_5_label aria-expanded=false> <label class=md-nav__title for=__nav_2_5> <span class="md-nav__icon md-icon"></span> 4.高级篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Kubernetes/4.%E9%AB%98%E7%BA%A7%E7%AF%87/12.%E4%BA%91%E5%8E%9F%E7%94%9F%E5%AD%98%E5%82%A8Rook/ class=md-nav__link> <span class=md-ellipsis> 云原生存储Rook </span> </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/4.%E9%AB%98%E7%BA%A7%E7%AF%87/13.%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%AE%B9%E5%99%A8%E5%8C%96/ class=md-nav__link> <span class=md-ellipsis> 中间件容器化 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_6> <label class=md-nav__link for=__nav_2_6 id=__nav_2_6_label tabindex=0> <span class=md-ellipsis> 5.运维篇 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_6_label aria-expanded=false> <label class=md-nav__title for=__nav_2_6> <span class="md-nav__icon md-icon"></span> 5.运维篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/14.Kubernetes%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/ class=md-nav__link> <span class=md-ellipsis> Kubernetes日志收集 </span> </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/15.Kubernetes%E7%9B%91%E6%8E%A7%E5%91%8A%E8%AD%A6/ class=md-nav__link> <span class=md-ellipsis> Kubernetes监控告警 </span> </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/16.%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83Ingress%E8%BF%9B%E9%98%B6/ class=md-nav__link> <span class=md-ellipsis> 服务发布Ingress进阶 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_7> <label class=md-nav__link for=__nav_2_7 id=__nav_2_7_label tabindex=0> <span class=md-ellipsis> 6.DevOps篇 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_7_label aria-expanded=false> <label class=md-nav__title for=__nav_2_7> <span class="md-nav__icon md-icon"></span> 6.DevOps篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/ class=md-nav__link> <span class=md-ellipsis> DevOps实践 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex> <span class=md-ellipsis> Docker </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Docker </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1> <label class=md-nav__link for=__nav_3_1 id=__nav_3_1_label tabindex=0> <span class=md-ellipsis> 0.学习线路 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_1_label aria-expanded=false> <label class=md-nav__title for=__nav_3_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Docker/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Docker/ class=md-nav__link> <span class=md-ellipsis> Docker </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2> <label class=md-nav__link for=__nav_3_2 id=__nav_3_2_label tabindex=0> <span class=md-ellipsis> 1.基础 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> 1.基础 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Docker/1.%E5%9F%BA%E7%A1%80/1.%E5%AE%89%E8%A3%85Docker/ class=md-nav__link> <span class=md-ellipsis> 1.安装Docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.%E5%9F%BA%E7%A1%80/2.Docker%E9%95%9C%E5%83%8F/ class=md-nav__link> <span class=md-ellipsis> 2.Docker镜像 </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.%E5%9F%BA%E7%A1%80/3.Docker%E5%AE%B9%E5%99%A8/ class=md-nav__link> <span class=md-ellipsis> 3.Docker容器 </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.%E5%9F%BA%E7%A1%80/4.%E4%BC%81%E4%B8%9A%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93harbor/ class=md-nav__link> <span class=md-ellipsis> 4.企业私有仓库harbor </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.%E5%9F%BA%E7%A1%80/5.Docker%E6%95%B0%E6%8D%AE/ class=md-nav__link> <span class=md-ellipsis> 5.Docker数据 </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.%E5%9F%BA%E7%A1%80/6.Docker%E7%BD%91%E7%BB%9C/ class=md-nav__link> <span class=md-ellipsis> 6.Docker网络 </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.%E5%9F%BA%E7%A1%80/7.Dockerfile/ class=md-nav__link> <span class=md-ellipsis> 7.Dockerfile </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.%E5%9F%BA%E7%A1%80/8.docker-compose/ class=md-nav__link> <span class=md-ellipsis> 8.docker-compose </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.%E5%9F%BA%E7%A1%80/9.Docker%E7%9B%B8%E5%85%B3%E8%84%9A%E6%9C%AC/ class=md-nav__link> <span class=md-ellipsis> 9.Docker相关脚本 </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.%E5%9F%BA%E7%A1%80/10.Docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/ class=md-nav__link> <span class=md-ellipsis> 10.Docker常用命令 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_3> <label class=md-nav__link for=__nav_3_3 id=__nav_3_3_label tabindex=0> <span class=md-ellipsis> 2.实战案例 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> 2.实战案例 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/1.%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/ class=md-nav__link> <span class=md-ellipsis> 1.操作系统 </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/2.Web%E6%9C%8D%E5%8A%A1%E4%B8%8E%E5%BA%94%E7%94%A8/ class=md-nav__link> <span class=md-ellipsis> 2.Web服务与应用 </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/3.%E6%8C%81%E7%BB%AD%E5%BC%80%E5%8F%91%E4%B8%8E%E7%AE%A1%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 3.持续开发与管理 </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/4.%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BA%94%E7%94%A8/ class=md-nav__link> <span class=md-ellipsis> 4.数据库应用 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_4> <label class=md-nav__link for=__nav_3_4 id=__nav_3_4_label tabindex=0> <span class=md-ellipsis> 3.Devops </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_4_label aria-expanded=false> <label class=md-nav__title for=__nav_3_4> <span class="md-nav__icon md-icon"></span> 3.Devops </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Docker/3.Devops/1.confcenter-docker/ class=md-nav__link> <span class=md-ellipsis> 1.confcenter-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/2.simaple-jenkins/ class=md-nav__link> <span class=md-ellipsis> 2.simaple-jenkins </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/3.docker-nginx-spa/ class=md-nav__link> <span class=md-ellipsis> 3.docker-nginx-spa </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/4.fileserver-docker/ class=md-nav__link> <span class=md-ellipsis> 4.fileserver-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/5.haproxy-docker/ class=md-nav__link> <span class=md-ellipsis> 5.haproxy-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/6.mysql-docker/ class=md-nav__link> <span class=md-ellipsis> 6.mysql-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/7.frp-docker/ class=md-nav__link> <span class=md-ellipsis> 7.frp-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/8.coredns-docker/ class=md-nav__link> <span class=md-ellipsis> 8.coredns-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/9.simple-harbor/ class=md-nav__link> <span class=md-ellipsis> 9.simple-harbor </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/10.redis-docker/ class=md-nav__link> <span class=md-ellipsis> 10.redis-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/11.nexus3-docker/ class=md-nav__link> <span class=md-ellipsis> 11.nexus3-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/12.openvpn-docker/ class=md-nav__link> <span class=md-ellipsis> 12.openvpn-docker.md </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/13.nfs-docker/ class=md-nav__link> <span class=md-ellipsis> 13.nfs-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/14.jumpserver-docker/ class=md-nav__link> <span class=md-ellipsis> 14.jumpserver-docker.md </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/15.ansible-docker/ class=md-nav__link> <span class=md-ellipsis> 15.ansible-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/16.minio-docker/ class=md-nav__link> <span class=md-ellipsis> 16.minio-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/17.vaultwarden-docker/ class=md-nav__link> <span class=md-ellipsis> 17.vaultwarden-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/18.kasm-docker/ class=md-nav__link> <span class=md-ellipsis> 18.kasm-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/19.nginx-docker/ class=md-nav__link> <span class=md-ellipsis> 19.nginx-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/20.kafka-docker/ class=md-nav__link> <span class=md-ellipsis> 20.kafka-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/21.golang-docker/ class=md-nav__link> <span class=md-ellipsis> 21.golang-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/22.postgres-docker/ class=md-nav__link> <span class=md-ellipsis> 22.postgres-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/23.nginx-download-docker/ class=md-nav__link> <span class=md-ellipsis> 23.nginx-download-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/24.helm%E9%83%A8%E7%BD%B2%E5%B8%B8%E7%94%A8%E6%9C%8D%E5%8A%A1/ class=md-nav__link> <span class=md-ellipsis> 24.helm部署常用服务 </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/25.Python%E6%93%8D%E4%BD%9CDocker/ class=md-nav__link> <span class=md-ellipsis> 25.Python操作Docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/26.docker-compose-devops/ class=md-nav__link> <span class=md-ellipsis> 26.docker-compose-devops </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/27.DevOps%E4%B8%8B%E7%9A%84Shell%E8%84%9A%E6%9C%AC/ class=md-nav__link> <span class=md-ellipsis> 27.DevOps下的Shell脚本 </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/28.Devops%E4%B8%8B%E7%9A%84Python%E8%84%9A%E6%9C%AC/ class=md-nav__link> <span class=md-ellipsis> 28.Devops下的Python脚本 </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/29.Vagrant%E8%99%9A%E6%8B%9F%E6%9C%BA/ class=md-nav__link> <span class=md-ellipsis> 29.Vagrant虚拟机 </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/30.VMware-workstation/ class=md-nav__link> <span class=md-ellipsis> 30.VMware Workstation </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/31.VirtualBox/ class=md-nav__link> <span class=md-ellipsis> 31.VirtualBox </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4 checked> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex> <span class=md-ellipsis> Golang </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=true> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Golang </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_1> <label class=md-nav__link for=__nav_4_1 id=__nav_4_1_label tabindex=0> <span class=md-ellipsis> 0.学习线路 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_1_label aria-expanded=false> <label class=md-nav__title for=__nav_4_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Go-Web%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98/ class=md-nav__link> <span class=md-ellipsis> Go Web开发实战 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_2> <label class=md-nav__link for=__nav_4_2 id=__nav_4_2_label tabindex=0> <span class=md-ellipsis> 1.Go基础 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_2_label aria-expanded=false> <label class=md-nav__title for=__nav_4_2> <span class="md-nav__icon md-icon"></span> 1.Go基础 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../1.Go%E5%9F%BA%E7%A1%80/1.%E5%AE%89%E8%A3%85Go/ class=md-nav__link> <span class=md-ellipsis> 安装Go </span> </a> </li> <li class=md-nav__item> <a href=../../1.Go%E5%9F%BA%E7%A1%80/2.%E7%AC%AC%E4%B8%80%E4%B8%AAGo%E7%A8%8B%E5%BA%8F/ class=md-nav__link> <span class=md-ellipsis> 第一个Go程序 </span> </a> </li> <li class=md-nav__item> <a href=../../1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/ class=md-nav__link> <span class=md-ellipsis> Go基础语法 </span> </a> </li> <li class=md-nav__item> <a href=../../1.Go%E5%9F%BA%E7%A1%80/4.Go-Module/ class=md-nav__link> <span class=md-ellipsis> Go Module </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_3> <label class=md-nav__link for=__nav_4_3 id=__nav_4_3_label tabindex=0> <span class=md-ellipsis> 2.Go-Web基础 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_3_label aria-expanded=false> <label class=md-nav__title for=__nav_4_3> <span class="md-nav__icon md-icon"></span> 2.Go-Web基础 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../2.Go-Web%E5%9F%BA%E7%A1%80/5.%E7%AC%AC%E4%B8%80%E4%B8%AAGo-Web%E7%A8%8B%E5%BA%8F/ class=md-nav__link> <span class=md-ellipsis> 第一个Go Web程序 </span> </a> </li> <li class=md-nav__item> <a href=../../2.Go-Web%E5%9F%BA%E7%A1%80/6.Web%E7%A8%8B%E5%BA%8F%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86%E7%AE%80%E4%BB%8B/ class=md-nav__link> <span class=md-ellipsis> Web程序运行原理简介 </span> </a> </li> <li class=md-nav__item> <a href=../../2.Go-Web%E5%9F%BA%E7%A1%80/7.net-http%E5%8C%85/ class=md-nav__link> <span class=md-ellipsis> net/http包 </span> </a> </li> <li class=md-nav__item> <a href=../../2.Go-Web%E5%9F%BA%E7%A1%80/8.html-template%E5%8C%85/ class=md-nav__link> <span class=md-ellipsis> html/template包 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_4> <label class=md-nav__link for=__nav_4_4 id=__nav_4_4_label tabindex=0> <span class=md-ellipsis> 3.Go-Web请求处理 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4_4> <span class="md-nav__icon md-icon"></span> 3.Go-Web请求处理 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../3.Go-Web%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/9.%E7%AE%80%E5%8D%95Web%E6%9C%8D%E5%8A%A1%E5%99%A8/ class=md-nav__link> <span class=md-ellipsis> 简单Web服务器 </span> </a> </li> <li class=md-nav__item> <a href=../../3.Go-Web%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/10.%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82/ class=md-nav__link> <span class=md-ellipsis> 处理请求 </span> </a> </li> <li class=md-nav__item> <a href=../../3.Go-Web%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/11.session%E5%92%8Ccookie/ class=md-nav__link> <span class=md-ellipsis> session和cookie </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_5> <label class=md-nav__link for=__nav_4_5 id=__nav_4_5_label tabindex=0> <span class=md-ellipsis> 4.Go访问数据库 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_5_label aria-expanded=false> <label class=md-nav__title for=__nav_4_5> <span class="md-nav__icon md-icon"></span> 4.Go访问数据库 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/12.Go%E6%93%8D%E4%BD%9CMySQL/ class=md-nav__link> <span class=md-ellipsis> Go操作MySQL </span> </a> </li> <li class=md-nav__item> <a href=../../4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/13.Go%E6%93%8D%E4%BD%9CRedis/ class=md-nav__link> <span class=md-ellipsis> Go操作Redis </span> </a> </li> <li class=md-nav__item> <a href=../../4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/14.Go%E6%93%8D%E4%BD%9CMongoDB/ class=md-nav__link> <span class=md-ellipsis> Go操作MongoDB </span> </a> </li> <li class=md-nav__item> <a href=../../4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/15.Go%E7%9A%84%E5%B8%B8%E8%A7%81ORM%E5%BA%93/ class=md-nav__link> <span class=md-ellipsis> Go的常见ORM库 </span> </a> </li> <li class=md-nav__item> <a href=../../4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/16.Go%E6%93%8D%E4%BD%9CSQLite/ class=md-nav__link> <span class=md-ellipsis> Go操作SQLite </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_6> <label class=md-nav__link for=__nav_4_6 id=__nav_4_6_label tabindex=0> <span class=md-ellipsis> 5.Go高级网络编程 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_6_label aria-expanded=false> <label class=md-nav__title for=__nav_4_6> <span class="md-nav__icon md-icon"></span> 5.Go高级网络编程 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../5.Go%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/17.Go-Socket%E7%BC%96%E7%A8%8B/ class=md-nav__link> <span class=md-ellipsis> Go Socket编程 </span> </a> </li> <li class=md-nav__item> <a href=../../5.Go%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/18.Go-RPC%E7%BC%96%E7%A8%8B/ class=md-nav__link> <span class=md-ellipsis> Go RPC编程 </span> </a> </li> <li class=md-nav__item> <a href=../../5.Go%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/19.Go-%E5%BE%AE%E6%9C%8D%E5%8A%A1/ class=md-nav__link> <span class=md-ellipsis> Go 微服务 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_7> <label class=md-nav__link for=__nav_4_7 id=__nav_4_7_label tabindex=0> <span class=md-ellipsis> 6.Go文件处理 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_7_label aria-expanded=false> <label class=md-nav__title for=__nav_4_7> <span class="md-nav__icon md-icon"></span> 6.Go文件处理 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/20.%E5%A4%84%E7%90%86%E7%9B%AE%E5%BD%95%E4%B8%8E%E6%96%87%E4%BB%B6/ class=md-nav__link> <span class=md-ellipsis> 处理目录与文件 </span> </a> </li> <li class=md-nav__item> <a href=../../6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/21.%E5%A4%84%E7%90%86XML%E6%96%87%E4%BB%B6/ class=md-nav__link> <span class=md-ellipsis> 处理XML文件 </span> </a> </li> <li class=md-nav__item> <a href=../../6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/22.%E5%A4%84%E7%90%86JSON%E6%96%87%E4%BB%B6/ class=md-nav__link> <span class=md-ellipsis> 处理JSON文件 </span> </a> </li> <li class=md-nav__item> <a href=../../6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/23.%E5%A4%84%E7%90%86CSV%E6%96%87%E4%BB%B6/ class=md-nav__link> <span class=md-ellipsis> 处理CSV文件 </span> </a> </li> <li class=md-nav__item> <a href=../../6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/24.%E5%A4%84%E7%90%86Go%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95/ class=md-nav__link> <span class=md-ellipsis> 处理Go日志记录 </span> </a> </li> <li class=md-nav__item> <a href=../../6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/25.%E5%A4%84%E7%90%86%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 处理正则表达式 </span> </a> </li> <li class=md-nav__item> <a href=../../6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/26.%E5%A4%84%E7%90%86Excel%E6%96%87%E4%BB%B6/ class=md-nav__link> <span class=md-ellipsis> 处理Excel文件 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_8> <label class=md-nav__link for=__nav_4_8 id=__nav_4_8_label tabindex=0> <span class=md-ellipsis> 7.Go并发编程 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_8_label aria-expanded=false> <label class=md-nav__title for=__nav_4_8> <span class="md-nav__icon md-icon"></span> 7.Go并发编程 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/26.%E5%B9%B6%E5%8F%91-%E5%B9%B6%E8%A1%8C/ class=md-nav__link> <span class=md-ellipsis> 并发 并行 </span> </a> </li> <li class=md-nav__item> <a href=../../7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/27.%E8%BF%9B%E7%A8%8B-%E7%BA%BF%E7%A8%8B-%E5%8D%8F%E7%A8%8B/ class=md-nav__link> <span class=md-ellipsis> 进程 线程 协程 </span> </a> </li> <li class=md-nav__item> <a href=../../7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/28.Go%E5%B9%B6%E5%8F%91%E6%A8%A1%E5%9E%8B/ class=md-nav__link> <span class=md-ellipsis> Go并发模型 </span> </a> </li> <li class=md-nav__item> <a href=../../7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/29.goroutine%E5%92%8Cchannel/ class=md-nav__link> <span class=md-ellipsis> goroutine和channel </span> </a> </li> <li class=md-nav__item> <a href=../../7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/30.sync%E5%AE%9E%E7%8E%B0%E5%B9%B6%E5%8F%91/ class=md-nav__link> <span class=md-ellipsis> sync实现并发 </span> </a> </li> <li class=md-nav__item> <a href=../../7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/31.Go%E5%B9%B6%E5%8F%91%E7%9A%84Web%E5%BA%94%E7%94%A8/ class=md-nav__link> <span class=md-ellipsis> Go并发的Web应用 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_9> <label class=md-nav__link for=__nav_4_9 id=__nav_4_9_label tabindex=0> <span class=md-ellipsis> 8.Go标准库 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_9_label aria-expanded=false> <label class=md-nav__title for=__nav_4_9> <span class="md-nav__icon md-icon"></span> 8.Go标准库 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../8.Go%E6%A0%87%E5%87%86%E5%BA%93/32.time/ class=md-nav__link> <span class=md-ellipsis> time </span> </a> </li> <li class=md-nav__item> <a href=../../8.Go%E6%A0%87%E5%87%86%E5%BA%93/33.strings/ class=md-nav__link> <span class=md-ellipsis> strings </span> </a> </li> <li class=md-nav__item> <a href=../../8.Go%E6%A0%87%E5%87%86%E5%BA%93/34.bytes/ class=md-nav__link> <span class=md-ellipsis> bytes </span> </a> </li> <li class=md-nav__item> <a href=../../8.Go%E6%A0%87%E5%87%86%E5%BA%93/35.json/ class=md-nav__link> <span class=md-ellipsis> json </span> </a> </li> <li class=md-nav__item> <a href=../../8.Go%E6%A0%87%E5%87%86%E5%BA%93/36.io-bufio/ class=md-nav__link> <span class=md-ellipsis> io/bufio </span> </a> </li> <li class=md-nav__item> <a href=../../8.Go%E6%A0%87%E5%87%86%E5%BA%93/37.fmt/ class=md-nav__link> <span class=md-ellipsis> fmt </span> </a> </li> <li class=md-nav__item> <a href=../../8.Go%E6%A0%87%E5%87%86%E5%BA%93/38.strconv/ class=md-nav__link> <span class=md-ellipsis> strconv </span> </a> </li> <li class=md-nav__item> <a href=../../8.Go%E6%A0%87%E5%87%86%E5%BA%93/39.regexp/ class=md-nav__link> <span class=md-ellipsis> regexp </span> </a> </li> <li class=md-nav__item> <a href=../../8.Go%E6%A0%87%E5%87%86%E5%BA%93/40.log/ class=md-nav__link> <span class=md-ellipsis> log </span> </a> </li> <li class=md-nav__item> <a href=../../8.Go%E6%A0%87%E5%87%86%E5%BA%93/41.reflect-unsafe/ class=md-nav__link> <span class=md-ellipsis> reflect/unsafe </span> </a> </li> <li class=md-nav__item> <a href=../../8.Go%E6%A0%87%E5%87%86%E5%BA%93/42.os-path-filepath/ class=md-nav__link> <span class=md-ellipsis> os/path/filepath </span> </a> </li> <li class=md-nav__item> <a href=../../8.Go%E6%A0%87%E5%87%86%E5%BA%93/43.unicode/ class=md-nav__link> <span class=md-ellipsis> unicode </span> </a> </li> <li class=md-nav__item> <a href=../../8.Go%E6%A0%87%E5%87%86%E5%BA%93/44.flag/ class=md-nav__link> <span class=md-ellipsis> flag </span> </a> </li> <li class=md-nav__item> <a href=../../8.Go%E6%A0%87%E5%87%86%E5%BA%93/45.net-url/ class=md-nav__link> <span class=md-ellipsis> net/url </span> </a> </li> <li class=md-nav__item> <a href=../../8.Go%E6%A0%87%E5%87%86%E5%BA%93/46.net-http/ class=md-nav__link> <span class=md-ellipsis> net/http </span> </a> </li> <li class=md-nav__item> <a href=../../8.Go%E6%A0%87%E5%87%86%E5%BA%93/47.sort/ class=md-nav__link> <span class=md-ellipsis> sort </span> </a> </li> <li class=md-nav__item> <a href=../../8.Go%E6%A0%87%E5%87%86%E5%BA%93/48.errors/ class=md-nav__link> <span class=md-ellipsis> errors </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_10> <label class=md-nav__link for=__nav_4_10 id=__nav_4_10_label tabindex=0> <span class=md-ellipsis> 9.Go三方库 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_10_label aria-expanded=false> <label class=md-nav__title for=__nav_4_10> <span class="md-nav__icon md-icon"></span> 9.Go三方库 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../9.Go%E4%B8%89%E6%96%B9%E5%BA%93/0.%E5%BC%80%E6%BA%90%E8%87%AA%E5%B7%B1%E7%9A%84Go%E5%BA%93/ class=md-nav__link> <span class=md-ellipsis> 开源自己的Go库 </span> </a> </li> <li class=md-nav__item> <a href=../../9.Go%E4%B8%89%E6%96%B9%E5%BA%93/1.cobra/ class=md-nav__link> <span class=md-ellipsis> Cobra </span> </a> </li> <li class=md-nav__item> <a href=../../9.Go%E4%B8%89%E6%96%B9%E5%BA%93/2.viper/ class=md-nav__link> <span class=md-ellipsis> Viper </span> </a> </li> <li class=md-nav__item> <a href=../../9.Go%E4%B8%89%E6%96%B9%E5%BA%93/3.mahonia/ class=md-nav__link> <span class=md-ellipsis> mahonia </span> </a> </li> <li class=md-nav__item> <a href=../../9.Go%E4%B8%89%E6%96%B9%E5%BA%93/4.ssh/ class=md-nav__link> <span class=md-ellipsis> ssh </span> </a> </li> <li class=md-nav__item> <a href=../../9.Go%E4%B8%89%E6%96%B9%E5%BA%93/5.fsnotify/ class=md-nav__link> <span class=md-ellipsis> fsnotify </span> </a> </li> <li class=md-nav__item> <a href=../../9.Go%E4%B8%89%E6%96%B9%E5%BA%93/6.yaml/ class=md-nav__link> <span class=md-ellipsis> yaml </span> </a> </li> <li class=md-nav__item> <a href=../../9.Go%E4%B8%89%E6%96%B9%E5%BA%93/7.tail/ class=md-nav__link> <span class=md-ellipsis> tail </span> </a> </li> <li class=md-nav__item> <a href=../../9.Go%E4%B8%89%E6%96%B9%E5%BA%93/8.gopsutil/ class=md-nav__link> <span class=md-ellipsis> gopsutil </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_11> <label class=md-nav__link for=__nav_4_11 id=__nav_4_11_label tabindex=0> <span class=md-ellipsis> 10.Go-RESTful-API接口开发 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_11_label aria-expanded=false> <label class=md-nav__title for=__nav_4_11> <span class="md-nav__icon md-icon"></span> 10.Go-RESTful-API接口开发 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../10.Go-RESTful-API%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91/1.%E4%BB%80%E4%B9%88%E6%98%AFRESTful-API/ class=md-nav__link> <span class=md-ellipsis> 1.什么是RESTful-API </span> </a> </li> <li class=md-nav__item> <a href=../../10.Go-RESTful-API%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91/2.GORMv2/ class=md-nav__link> <span class=md-ellipsis> 2.GORMv2 </span> </a> </li> <li class=md-nav__item> <a href=../../10.Go-RESTful-API%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91/3.Gin%E6%A1%86%E6%9E%B6%E7%9A%84%E4%BD%BF%E7%94%A8/ class=md-nav__link> <span class=md-ellipsis> 3.Gin框架的使用 </span> </a> </li> <li class=md-nav__item> <a href=../../10.Go-RESTful-API%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91/4.%E5%9B%BE%E4%B9%A6%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-%E5%89%8D%E7%AB%AF/ class=md-nav__link> <span class=md-ellipsis> 4.图书管理系统-前端 </span> </a> </li> <li class=md-nav__item> <a href=../../10.Go-RESTful-API%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91/5.%E5%9B%BE%E4%B9%A6%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-%E5%90%8E%E7%AB%AF/ class=md-nav__link> <span class=md-ellipsis> 5.图书管理系统-后端 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_12> <label class=md-nav__link for=__nav_4_12 id=__nav_4_12_label tabindex=0> <span class=md-ellipsis> 11.Web前端 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_12_label aria-expanded=false> <label class=md-nav__title for=__nav_4_12> <span class="md-nav__icon md-icon"></span> 11.Web前端 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../11.Web%E5%89%8D%E7%AB%AF/1.HTML%E6%A0%87%E8%AE%B0%E8%AF%AD%E8%A8%80/ class=md-nav__link> <span class=md-ellipsis> 1.HTML标记语言 </span> </a> </li> <li class=md-nav__item> <a href=../../11.Web%E5%89%8D%E7%AB%AF/2.CSS%E6%A0%B7%E5%BC%8F%E8%AF%AD%E8%A8%80/ class=md-nav__link> <span class=md-ellipsis> 2.CSS样式语言 </span> </a> </li> <li class=md-nav__item> <a href=../../11.Web%E5%89%8D%E7%AB%AF/3.JavaScript%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%84%9A%E6%9C%AC%E8%AF%AD%E8%A8%80/ class=md-nav__link> <span class=md-ellipsis> 3.JavaScript客户端脚本语言 </span> </a> </li> <li class=md-nav__item> <a href=../../11.Web%E5%89%8D%E7%AB%AF/4.JavaScript%E5%BA%93-JQuery/ class=md-nav__link> <span class=md-ellipsis> 4.JavaScript库:JQuery </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_13> <label class=md-nav__link for=__nav_4_13 id=__nav_4_13_label tabindex=0> <span class=md-ellipsis> 12.Vue前端开发 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_13_label aria-expanded=false> <label class=md-nav__title for=__nav_4_13> <span class="md-nav__icon md-icon"></span> 12.Vue前端开发 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/1.%E8%AE%A4%E8%AF%86Vue.js/ class=md-nav__link> <span class=md-ellipsis> 1.认识Vue.js.md </span> </a> </li> <li class=md-nav__item> <a href=../../12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/2.Vue%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4/ class=md-nav__link> <span class=md-ellipsis> 2.Vue常用指令 </span> </a> </li> <li class=md-nav__item> <a href=../../12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/3.Vue%E5%B8%B8%E7%94%A8%E5%B1%9E%E6%80%A7/ class=md-nav__link> <span class=md-ellipsis> 3.Vue常用属性 </span> </a> </li> <li class=md-nav__item> <a href=../../12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/4.Vue%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4%E4%B9%8B%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/ class=md-nav__link> <span class=md-ellipsis> 4.Vue常用指令之流程控制 </span> </a> </li> <li class=md-nav__item> <a href=../../12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/5.Vue%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4%E4%B9%8B%E6%95%B0%E6%8D%AE%E5%8F%8C%E5%90%91%E7%BB%91%E5%AE%9A/ class=md-nav__link> <span class=md-ellipsis> 5.Vue常用指令之数据双向绑定 </span> </a> </li> <li class=md-nav__item> <a href=../../12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/6.Vue%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E9%92%A9%E5%AD%90/ class=md-nav__link> <span class=md-ellipsis> 6.Vue生命周期钩子 </span> </a> </li> <li class=md-nav__item> <a href=../../12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/7.VueCli%E8%84%9A%E6%89%8B%E6%9E%B6/ class=md-nav__link> <span class=md-ellipsis> 7.VueCli脚手架 </span> </a> </li> <li class=md-nav__item> <a href=../../12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/8.Vue%E7%BB%84%E4%BB%B6/ class=md-nav__link> <span class=md-ellipsis> 8.Vue组件 </span> </a> </li> <li class=md-nav__item> <a href=../../12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/9.Vue%E8%B7%AF%E7%94%B1/ class=md-nav__link> <span class=md-ellipsis> 9.Vue路由 </span> </a> </li> <li class=md-nav__item> <a href=../../12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/10.Vuex%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 10.Vuex状态管理 </span> </a> </li> <li class=md-nav__item> <a href=../../12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/11.%E5%89%8D%E5%90%8E%E7%AB%AF%E6%95%B0%E6%8D%AE%E4%BA%A4%E4%BA%92-Axios/ class=md-nav__link> <span class=md-ellipsis> 11.前后端数据交互 Axios </span> </a> </li> <li class=md-nav__item> <a href=../../12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/12.Element-Plus/ class=md-nav__link> <span class=md-ellipsis> 12.Element Plus </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_14 checked> <label class=md-nav__link for=__nav_4_14 id=__nav_4_14_label tabindex=0> <span class=md-ellipsis> 13.K8s管理系统项目实战 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_14_label aria-expanded=true> <label class=md-nav__title for=__nav_4_14> <span class="md-nav__icon md-icon"></span> 13.K8s管理系统项目实战 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> K8s管理系统-后端API开发 </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> K8s管理系统-后端API开发 </span> </a> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#1-项目背景 class=md-nav__link> <span class=md-ellipsis> 1. 项目背景 </span> </a> </li> <li class=md-nav__item> <a href=#2-前后端分离概述 class=md-nav__link> <span class=md-ellipsis> 2. 前后端分离概述 </span> </a> </li> <li class=md-nav__item> <a href=#3-功能设计 class=md-nav__link> <span class=md-ellipsis> 3. 功能设计 </span> </a> </li> <li class=md-nav__item> <a href=#4-client-go介绍 class=md-nav__link> <span class=md-ellipsis> 4. Client-go介绍 </span> </a> <nav class=md-nav aria-label="4. Client-go介绍"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#41-简介 class=md-nav__link> <span class=md-ellipsis> 4.1 简介 </span> </a> </li> <li class=md-nav__item> <a href=#42-环境搭建 class=md-nav__link> <span class=md-ellipsis> 4.2 环境搭建 </span> </a> <nav class=md-nav aria-label="4.2 环境搭建"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#安装精简版k8sk3s环境 class=md-nav__link> <span class=md-ellipsis> 安装精简版K8S(K3S)环境 </span> </a> </li> <li class=md-nav__item> <a href=#安装golang环境 class=md-nav__link> <span class=md-ellipsis> 安装golang环境 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#43-代码示例 class=md-nav__link> <span class=md-ellipsis> 4.3 代码示例 </span> </a> <nav class=md-nav aria-label="4.3 代码示例"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#创建一个测试pod class=md-nav__link> <span class=md-ellipsis> 创建一个测试pod </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#44-常用方法 class=md-nav__link> <span class=md-ellipsis> 4.4 常用方法 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#5-项目目录结构 class=md-nav__link> <span class=md-ellipsis> 5. 项目目录结构 </span> </a> </li> <li class=md-nav__item> <a href=#6-框架搭建 class=md-nav__link> <span class=md-ellipsis> 6. 框架搭建 </span> </a> <nav class=md-nav aria-label="6. 框架搭建"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-创建go项目 class=md-nav__link> <span class=md-ellipsis> 1. 创建go项目 </span> </a> </li> <li class=md-nav__item> <a href=#2-初始化gin工程 class=md-nav__link> <span class=md-ellipsis> 2. 初始化Gin工程 </span> </a> </li> <li class=md-nav__item> <a href=#3-初始化k8s-client class=md-nav__link> <span class=md-ellipsis> 3. 初始化K8s Client </span> </a> </li> <li class=md-nav__item> <a href=#4-测试api接口 class=md-nav__link> <span class=md-ellipsis> 4. 测试API接口 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#7-api开发 class=md-nav__link> <span class=md-ellipsis> 7. API开发 </span> </a> <nav class=md-nav aria-label="7. API开发"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-开发响应流程 class=md-nav__link> <span class=md-ellipsis> 1. 开发&amp;响应流程 </span> </a> </li> <li class=md-nav__item> <a href=#2-工作负载 class=md-nav__link> <span class=md-ellipsis> 2. 工作负载 </span> </a> <nav class=md-nav aria-label="2. 工作负载"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#21-数组的排序过滤分页 class=md-nav__link> <span class=md-ellipsis> 2.1 数组的排序、过滤、分页 </span> </a> </li> <li class=md-nav__item> <a href=#22-pod class=md-nav__link> <span class=md-ellipsis> 2.2 Pod </span> </a> </li> <li class=md-nav__item> <a href=#23-deployment class=md-nav__link> <span class=md-ellipsis> 2.3 Deployment </span> </a> </li> <li class=md-nav__item> <a href=#24-daemonset class=md-nav__link> <span class=md-ellipsis> 2.4 DaemonSet </span> </a> </li> <li class=md-nav__item> <a href=#25-statefulset class=md-nav__link> <span class=md-ellipsis> 2.5 StatefulSet </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#3-集群 class=md-nav__link> <span class=md-ellipsis> 3. 集群 </span> </a> <nav class=md-nav aria-label="3. 集群"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#31-node class=md-nav__link> <span class=md-ellipsis> 3.1 Node </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../2.K8s%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/ class=md-nav__link> <span class=md-ellipsis> K8s管理系统-前端开发 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex> <span class=md-ellipsis> Python </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Python </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_1> <label class=md-nav__link for=__nav_5_1 id=__nav_5_1_label tabindex=0> <span class=md-ellipsis> 0.学习线路 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_1_label aria-expanded=false> <label class=md-nav__title for=__nav_5_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Pythjon-auto-ops/ class=md-nav__link> <span class=md-ellipsis> Python Linux管理与自动化运维 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_2> <label class=md-nav__link for=__nav_5_2 id=__nav_5_2_label tabindex=0> <span class=md-ellipsis> 1.Python基础篇 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_2_label aria-expanded=false> <label class=md-nav__title for=__nav_5_2> <span class="md-nav__icon md-icon"></span> 1.Python基础篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/1.Python%E7%94%9F%E6%80%81%E5%B7%A5%E5%85%B7/ class=md-nav__link> <span class=md-ellipsis> 1.Python生态工具 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/2.Python%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E5%AE%89%E8%A3%85/ class=md-nav__link> <span class=md-ellipsis> 2.Python第三方库安装 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/3.Python%E5%B7%A5%E4%BD%9C%E7%8E%AF%E5%A2%83%E7%AE%A1%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 3.Python工作环境管理 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/4.Python%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/ class=md-nav__link> <span class=md-ellipsis> 4.Python开发环境 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/5.Python%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/ class=md-nav__link> <span class=md-ellipsis> 5.Python数据结构 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/6.Python%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84/ class=md-nav__link> <span class=md-ellipsis> 6.Python项目的组织结构 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/7.Python%E4%BB%A3%E7%A0%81%E8%A7%84%E8%8C%83/ class=md-nav__link> <span class=md-ellipsis> 7.Python代码规范 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/8.Python%E5%86%85%E7%BD%AE%E5%87%BD%E6%95%B0/ class=md-nav__link> <span class=md-ellipsis> 8.Python内置函数 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_3> <label class=md-nav__link for=__nav_5_3 id=__nav_5_3_label tabindex=0> <span class=md-ellipsis> 2.Python运维开发 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_3_label aria-expanded=false> <label class=md-nav__title for=__nav_5_3> <span class="md-nav__icon md-icon"></span> 2.Python运维开发 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/1.%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/ class=md-nav__link> <span class=md-ellipsis> 1.命令行工具 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/2.%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 2.文本处理 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/3.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 3.Linux系统管理 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/4.%E7%9B%91%E6%8E%A7Linux/ class=md-nav__link> <span class=md-ellipsis> 4.监控Linux </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/5.%E6%96%87%E6%A1%A3%E4%B8%8E%E6%8A%A5%E5%91%8A/ class=md-nav__link> <span class=md-ellipsis> 5.文档与报告 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/6.%E7%BD%91%E7%BB%9C/ class=md-nav__link> <span class=md-ellipsis> 6.网络 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/7.%E8%87%AA%E5%8A%A8%E5%8C%96%E7%AE%A1%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 7.自动化管理 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/8.%E5%B8%B8%E7%94%A8%E6%A8%A1%E5%9D%97/ class=md-nav__link> <span class=md-ellipsis> 8.常用模块 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/9.Python%E6%89%93%E9%80%A0MySQL%E4%B8%93%E5%AE%B6%E7%B3%BB%E7%BB%9F/ class=md-nav__link> <span class=md-ellipsis> 9.Python打造MySQL专家系统 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/%E9%99%84-CMDB/ class=md-nav__link> <span class=md-ellipsis> 附-CMDB </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/%E9%99%84-DRF/ class=md-nav__link> <span class=md-ellipsis> 附-DRF </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_4> <label class=md-nav__link for=__nav_5_4 id=__nav_5_4_label tabindex=0> <span class=md-ellipsis> 3.Python测试开发 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_4_label aria-expanded=false> <label class=md-nav__title for=__nav_5_4> <span class="md-nav__icon md-icon"></span> 3.Python测试开发 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/1.Python2%E4%B8%8EPython3%E5%8C%BA%E5%88%AB/ class=md-nav__link> <span class=md-ellipsis> 1.Python2与Python3区别 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/2.Windows%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85Python/ class=md-nav__link> <span class=md-ellipsis> 2.Windows环境安装Python </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/3.Linux%E5%A4%9A%E7%89%88%E6%9C%ACPython%E5%AE%89%E8%A3%85/ class=md-nav__link> <span class=md-ellipsis> 3.Linux多版本Python安装 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/4.Python%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85/ class=md-nav__link> <span class=md-ellipsis> 4.Python虚拟环境安装 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/5.Pycharm%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8/ class=md-nav__link> <span class=md-ellipsis> 5.Pycharm安装与使用 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/6.Python%E9%97%B4%E6%8E%A5%E5%AE%9A%E4%B9%89%E5%B8%B8%E9%87%8F/ class=md-nav__link> <span class=md-ellipsis> 6.Python间接定义常量 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/7.Python%E8%BF%90%E7%AE%97%E7%AC%A6%E4%B8%8E%E8%A1%A8%E8%BE%BE%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 7.Python运算符与表达式 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/8.%E9%80%BB%E8%BE%91%E6%8E%A7%E5%88%B6%E8%AF%AD%E5%8F%A5/ class=md-nav__link> <span class=md-ellipsis> 8.逻辑控制语句 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/9.%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%BB%8B%E7%BB%8D/ class=md-nav__link> <span class=md-ellipsis> 9.数据结构 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/10.%E5%87%BD%E6%95%B0%E4%BB%8B%E7%BB%8D/ class=md-nav__link> <span class=md-ellipsis> 10.函数介绍 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/11.%E7%B1%BB%E4%B8%8E%E5%AF%B9%E8%B1%A1/ class=md-nav__link> <span class=md-ellipsis> 11.类与对象 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/12.%E6%89%93%E5%8C%85%E4%B8%8E%E5%8F%91%E5%B8%83/ class=md-nav__link> <span class=md-ellipsis> 12.打包与发布 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/13.%E5%BC%82%E5%B8%B8%E6%8D%95%E8%8E%B7%E4%B8%8E%E5%A4%84%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 13.异常捕获与处理 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/14.%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/ class=md-nav__link> <span class=md-ellipsis> 14.并发编程 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/15.%E6%A0%87%E5%87%86%E5%BA%93%E5%92%8C%E4%B8%89%E6%96%B9%E5%BA%93/ class=md-nav__link> <span class=md-ellipsis> 15.标准库和三方库 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/16.vue-cli%E8%84%9A%E6%89%8B%E6%9E%B6/ class=md-nav__link> <span class=md-ellipsis> 16.vue-cli脚手架 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/17.%E6%A1%88%E4%BE%8B%E5%AE%9E%E8%B7%B5-%E4%BB%BB%E5%8A%A1%E5%88%97%E8%A1%A8/ class=md-nav__link> <span class=md-ellipsis> 17.案例实践-任务列表 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_5> <label class=md-nav__link for=__nav_5_5 id=__nav_5_5_label tabindex=0> <span class=md-ellipsis> 4.Flask-Web全栈开发 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5_5> <span class="md-nav__icon md-icon"></span> 4.Flask-Web全栈开发 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/1.Flask%E5%89%8D%E5%A5%8F/ class=md-nav__link> <span class=md-ellipsis> 1.Flask前缀 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/2.%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AE/ class=md-nav__link> <span class=md-ellipsis> 2.项目配置 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/3.URL%E4%B8%8E%E8%A7%86%E5%9B%BE/ class=md-nav__link> <span class=md-ellipsis> 3.URL与视图 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/4.Jinja2%E6%A8%A1%E6%9D%BF/ class=md-nav__link> <span class=md-ellipsis> 4.Jinja2模板 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/5.%E6%95%B0%E6%8D%AE%E5%BA%93/ class=md-nav__link> <span class=md-ellipsis> 5.数据库 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/6.%E8%A1%A8%E5%8D%95/ class=md-nav__link> <span class=md-ellipsis> 6.表单 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/7.Flask%E8%BF%9B%E9%98%B6/ class=md-nav__link> <span class=md-ellipsis> 7.Flask进阶 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/8.%E7%BC%93%E5%AD%98%E7%B3%BB%E7%BB%9F/ class=md-nav__link> <span class=md-ellipsis> 8.缓存系统 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/9.Flask%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/ class=md-nav__link> <span class=md-ellipsis> 9.Flask项目实战 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/10.WebSock%E5%AE%9E%E6%88%98/ class=md-nav__link> <span class=md-ellipsis> 10.WebSock实战 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/11.Flask%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B/ class=md-nav__link> <span class=md-ellipsis> 11.Flask异步编程 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/%E9%99%84-%E4%BD%BF%E7%94%A8Pytest%E6%B5%8B%E8%AF%95Flask/ class=md-nav__link> <span class=md-ellipsis> 附-使用Pytest测试Flask </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/%E9%99%84-Flask%E5%B8%B8%E7%94%A8%E6%89%A9%E5%B1%95/ class=md-nav__link> <span class=md-ellipsis> 附-Flask常用扩展 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/%E9%99%84-Flask%E5%92%8CRedis%E9%98%9F%E5%88%97%E7%9A%84%E5%BC%82%E6%AD%A5%E4%BB%BB%E5%8A%A1/ class=md-nav__link> <span class=md-ellipsis> 附-Flask和Redis队列的异步任务 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/%E9%99%84-Flask%E5%92%8CVue.js%E5%BC%80%E5%8F%91%E5%8D%95%E9%A1%B5%E5%BA%94%E7%94%A8/ class=md-nav__link> <span class=md-ellipsis> 附-Flask和Vue.js开发单页应用 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/%E9%99%84-Flask%E5%AE%B9%E5%99%A8%E5%8C%96%E5%AE%9E%E8%B7%B5/ class=md-nav__link> <span class=md-ellipsis> 附-Flask容器化实践 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/%E9%99%84-Flask%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B/ class=md-nav__link> <span class=md-ellipsis> 附-Flask数据模型 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex> <span class=md-ellipsis> Python-vs-Go </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Python-vs-Go </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_1> <label class=md-nav__link for=__nav_6_1 id=__nav_6_1_label tabindex=0> <span class=md-ellipsis> 0.线路 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_1_label aria-expanded=false> <label class=md-nav__title for=__nav_6_1> <span class="md-nav__icon md-icon"></span> 0.线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python-vs-Go/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Python-vs-Go/ class=md-nav__link> <span class=md-ellipsis> Python-vs-Go </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_2> <label class=md-nav__link for=__nav_6_2 id=__nav_6_2_label tabindex=0> <span class=md-ellipsis> 1.对比 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_2_label aria-expanded=false> <label class=md-nav__title for=__nav_6_2> <span class="md-nav__icon md-icon"></span> 1.对比 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/1.Hello-World/ class=md-nav__link> <span class=md-ellipsis> Hello-World </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/2.Print/ class=md-nav__link> <span class=md-ellipsis> Print </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/3.%E6%B3%A8%E9%87%8A/ class=md-nav__link> <span class=md-ellipsis> 注释 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/4.%E5%A4%9A%E8%A1%8C%E5%AD%97%E7%AC%A6%E4%B8%B2/ class=md-nav__link> <span class=md-ellipsis> 多行字符串 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/5.Lists/ class=md-nav__link> <span class=md-ellipsis> Lists </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/6.Map/ class=md-nav__link> <span class=md-ellipsis> Map </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/7.Booleans/ class=md-nav__link> <span class=md-ellipsis> Booleans </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/8.Forloop/ class=md-nav__link> <span class=md-ellipsis> Forloop </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/9.Range/ class=md-nav__link> <span class=md-ellipsis> Range </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/10.Switch/ class=md-nav__link> <span class=md-ellipsis> Switch </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/11.%E5%8F%AF%E5%8F%98%E5%8F%82%E6%95%B0%E5%87%BD%E6%95%B0/ class=md-nav__link> <span class=md-ellipsis> 可变参数函数 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/12.%E6%97%B6%E9%97%B4%E8%AE%A1%E7%AE%97/ class=md-nav__link> <span class=md-ellipsis> 时间计算 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/13.%E5%87%BD%E6%95%B0%E7%9A%84%E9%97%AD%E5%8C%85/ class=md-nav__link> <span class=md-ellipsis> 函数的闭包 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/14.%E9%80%80%E5%87%BA%E5%A4%84%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 退出处理 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/15.%E5%BC%82%E5%B8%B8%E6%8D%95%E8%8E%B7/ class=md-nav__link> <span class=md-ellipsis> 异常捕获 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/16.%E5%8F%AF%E5%8F%98%E9%A1%B9/ class=md-nav__link> <span class=md-ellipsis> 可变项 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/17.%E7%B1%BB/ class=md-nav__link> <span class=md-ellipsis> 类 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/18.%E6%96%B9%E6%B3%95/ class=md-nav__link> <span class=md-ellipsis> 方法 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/19.%E5%B9%B6%E5%8F%91/ class=md-nav__link> <span class=md-ellipsis> 并发 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/20.Args/ class=md-nav__link> <span class=md-ellipsis> Args </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/21.%E5%AF%BC%E5%85%A5%E6%A8%A1%E5%9D%97%E5%88%AB%E5%90%8D/ class=md-nav__link> <span class=md-ellipsis> 导入模块别名 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/22.%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%A0%BC%E5%BC%8F%E5%8C%96/ class=md-nav__link> <span class=md-ellipsis> 字符串格式化 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/23.%E5%8E%BB%E9%87%8D/ class=md-nav__link> <span class=md-ellipsis> 去重 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/24.%E5%B8%A6%E9%A2%9C%E8%89%B2%E6%89%93%E5%8D%B0/ class=md-nav__link> <span class=md-ellipsis> 带颜色打印 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_3> <label class=md-nav__link for=__nav_6_3 id=__nav_6_3_label tabindex=0> <span class=md-ellipsis> 2.进阶 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_3_label aria-expanded=false> <label class=md-nav__title for=__nav_6_3> <span class="md-nav__icon md-icon"></span> 2.进阶 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python-vs-Go/2.%E8%BF%9B%E9%98%B6/1.%E4%BD%BF%E7%94%A8RPC/ class=md-nav__link> <span class=md-ellipsis> 使用RPC </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/2.%E8%BF%9B%E9%98%B6/2.%E4%BD%BF%E7%94%A8MySQL/ class=md-nav__link> <span class=md-ellipsis> 使用MySQL </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/2.%E8%BF%9B%E9%98%B6/3.%E4%BD%BF%E7%94%A8Redis/ class=md-nav__link> <span class=md-ellipsis> 使用Redis </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/2.%E8%BF%9B%E9%98%B6/4.%E4%BD%BF%E7%94%A8MongoDB/ class=md-nav__link> <span class=md-ellipsis> 使用MongoDB </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex> <span class=md-ellipsis> Linux </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Linux </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_1> <label class=md-nav__link for=__nav_7_1 id=__nav_7_1_label tabindex=0> <span class=md-ellipsis> Shell </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_1_label aria-expanded=false> <label class=md-nav__title for=__nav_7_1> <span class="md-nav__icon md-icon"></span> Shell </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Linux/Shell/Shell%E7%AE%80%E4%BB%8B/ class=md-nav__link> <span class=md-ellipsis> Shell 教程概述 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/1.%E7%AC%AC%E4%B8%80%E4%B8%AAshell%E7%A8%8B%E5%BA%8F/ class=md-nav__link> <span class=md-ellipsis> 1.第一个 Shell 程序 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/2.Shell%E5%8F%98%E9%87%8F%E5%92%8C%E5%AD%97%E7%AC%A6%E4%B8%B2/ class=md-nav__link> <span class=md-ellipsis> 2.Shell变量和字符串 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/3.Shell%E5%8F%82%E6%95%B0/ class=md-nav__link> <span class=md-ellipsis> 3.Shell参数 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/4.Shell%E6%95%B0%E7%BB%84/ class=md-nav__link> <span class=md-ellipsis> 4.Shell数组 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/5.Shell%E8%BF%90%E7%AE%97%E7%AC%A6/ class=md-nav__link> <span class=md-ellipsis> 5.Shell运算符 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/6.Shell-echo_printf%E5%91%BD%E4%BB%A4/ class=md-nav__link> <span class=md-ellipsis> 6.Shell echo/printf 命令 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/7.Shell-test%E5%91%BD%E4%BB%A4/ class=md-nav__link> <span class=md-ellipsis> 7.Shell test命令 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/8.Shell%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/ class=md-nav__link> <span class=md-ellipsis> 8.Shell流程控制 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/9.Shell%E5%87%BD%E6%95%B0/ class=md-nav__link> <span class=md-ellipsis> 9.Shell函数 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/10.Shell%E8%BE%93%E5%85%A5_%E8%BE%93%E5%87%BA%E9%87%8D%E5%AE%9A%E5%90%91/ class=md-nav__link> <span class=md-ellipsis> 10.Shell输入/输出重定向 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/11.Shell%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 11.Shell正则表达式 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/12.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bgrep/ class=md-nav__link> <span class=md-ellipsis> 12.Shell三剑客之grep </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/13.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/ class=md-nav__link> <span class=md-ellipsis> 13.Shell三剑客之sed </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/14.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bawk/ class=md-nav__link> <span class=md-ellipsis> 14.Shell三剑客之awk </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/15.Shell%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/ class=md-nav__link> <span class=md-ellipsis> 15.Shell常用工具 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/16.Shell%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/ class=md-nav__link> <span class=md-ellipsis> 16.Shell实战项目 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/17.Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/ class=md-nav__link> <span class=md-ellipsis> 17.Shell脚本示例 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/18.Shell%E8%84%9A%E6%9C%AC%E7%9A%84%E5%8F%82%E6%95%B0%E8%A7%A3%E6%9E%90%E5%B7%A5%E5%85%B7/ class=md-nav__link> <span class=md-ellipsis> 18.Shell脚本的参数解析工具 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/19.%E5%AE%9E%E7%94%A8Linux-Shell%E8%84%9A%E6%9C%AC%E6%A1%88%E4%BE%8B/ class=md-nav__link> <span class=md-ellipsis> 19.实用Linux Shell脚本案例 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/20.Shell%E8%84%9A%E6%9C%AC%E7%9A%84%E8%A7%84%E8%8C%83/ class=md-nav__link> <span class=md-ellipsis> 20.Shell脚本的规范 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/21.Shell%E5%A4%9A%E8%BF%9B%E7%A8%8B%E5%B9%B6%E5%8F%91/ class=md-nav__link> <span class=md-ellipsis> 21.Shell多进程并发 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_2> <label class=md-nav__link for=__nav_7_2 id=__nav_7_2_label tabindex=0> <span class=md-ellipsis> Ansible </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_2_label aria-expanded=false> <label class=md-nav__title for=__nav_7_2> <span class="md-nav__icon md-icon"></span> Ansible </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/ class=md-nav__link> <span class=md-ellipsis> 1.Ansible入门和实践 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Ansible/2.Ansible-wiki/ class=md-nav__link> <span class=md-ellipsis> 2.Ansible-wiki </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_3> <label class=md-nav__link for=__nav_7_3 id=__nav_7_3_label tabindex=0> <span class=md-ellipsis> Git </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_3_label aria-expanded=false> <label class=md-nav__title for=__nav_7_3> <span class="md-nav__icon md-icon"></span> Git </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Linux/Git/1.Git%E5%9F%BA%E7%A1%80/ class=md-nav__link> <span class=md-ellipsis> 1.Git基础 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Git/2.%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93/ class=md-nav__link> <span class=md-ellipsis> 2.远程仓库 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Git/3.%E5%88%86%E6%94%AF%E7%AE%A1%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 3.分支管理 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Git/4.%E5%88%86%E6%94%AF%E7%AE%A1%E7%90%86%E7%AD%96%E7%95%A5/ class=md-nav__link> <span class=md-ellipsis> 4.分支管理策略 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Git/7.%E4%BD%BF%E7%94%A8Github/ class=md-nav__link> <span class=md-ellipsis> 7.使用Github </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Git/8.%E5%AE%9E%E8%B7%B5GitHub-Flow/ class=md-nav__link> <span class=md-ellipsis> 8.实践GitHub Flow </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Git/9.%E5%AE%9E%E8%B7%B5Git-Flow/ class=md-nav__link> <span class=md-ellipsis> 9.实践Git Flow </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Git/10.%E9%A1%B9%E7%9B%AE%E8%A7%84%E8%8C%83/ class=md-nav__link> <span class=md-ellipsis> 10.项目规范 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_4> <label class=md-nav__link for=__nav_7_4 id=__nav_7_4_label tabindex=0> <span class=md-ellipsis> KVM </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_4_label aria-expanded=false> <label class=md-nav__title for=__nav_7_4> <span class="md-nav__icon md-icon"></span> KVM </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Linux/KVM/1.kvm%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4/ class=md-nav__link> <span class=md-ellipsis> 1.kvm相关命令 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/KVM/2.kvm%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%88%9B%E5%BB%BA/ class=md-nav__link> <span class=md-ellipsis> 2.kvm虚拟机创建 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/KVM/3.kvm%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE/ class=md-nav__link> <span class=md-ellipsis> 3.kvm网络配置 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_5> <label class=md-nav__link for=__nav_7_5 id=__nav_7_5_label tabindex=0> <span class=md-ellipsis> Nginx </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_5_label aria-expanded=false> <label class=md-nav__title for=__nav_7_5> <span class="md-nav__icon md-icon"></span> Nginx </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Linux/Nginx/1.Nginx%E7%AE%80%E4%BB%8B/ class=md-nav__link> <span class=md-ellipsis> 1.Nginx简介 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/2.Nginx%E5%AE%89%E8%A3%85%E5%8F%8A%E5%90%AF%E5%8A%A8/ class=md-nav__link> <span class=md-ellipsis> 2.Nginx安装及启动 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/3.Nginx%E9%85%8D%E7%BD%AE/ class=md-nav__link> <span class=md-ellipsis> 3.Nginx配置 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/4.Nginx%E9%85%8D%E7%BD%AE%E4%B8%8B%E8%BD%BD%E7%AB%99%E7%82%B9/ class=md-nav__link> <span class=md-ellipsis> 4.Nginx配置下载站点 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/5.Nginx%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6/ class=md-nav__link> <span class=md-ellipsis> 5.Nginx访问控制 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/6.Nginx%E8%99%9A%E6%8B%9F%E4%B8%BB%E6%9C%BA/ class=md-nav__link> <span class=md-ellipsis> 6.Nginx虚拟主机 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/7.Nginx%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90/ class=md-nav__link> <span class=md-ellipsis> 7.Nginx静态资源 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/8.Nginx%E7%BC%93%E5%AD%98%E9%85%8D%E7%BD%AE/ class=md-nav__link> <span class=md-ellipsis> 8.Nginx缓存配置 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/9.Nginx%E6%AD%A3%E5%8F%8D%E4%BB%A3%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 9.Nginx正反向代理 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/10.Nginx%E9%98%B2%E7%9B%97%E9%93%BE/ class=md-nav__link> <span class=md-ellipsis> 10.Nginx防盗链 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/11.Nginx%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/ class=md-nav__link> <span class=md-ellipsis> 11.Nginx负载均衡 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/12.Nginx%E5%8A%A8%E9%9D%99%E5%88%86%E7%A6%BB/ class=md-nav__link> <span class=md-ellipsis> 12.Nginx动静分离 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/13.Nginx%E8%B7%A8%E5%9F%9F%E9%85%8D%E7%BD%AE/ class=md-nav__link> <span class=md-ellipsis> 13.Nginx跨域配置 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/14.Nginx%E9%87%8D%E5%AE%9A%E5%90%91/ class=md-nav__link> <span class=md-ellipsis> 14.Nginx重定向 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/15.Nginx-HTTPS/ class=md-nav__link> <span class=md-ellipsis> 15.Nginx HttPS </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_6> <label class=md-nav__link for=__nav_7_6 id=__nav_7_6_label tabindex=0> <span class=md-ellipsis> System </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_6_label aria-expanded=false> <label class=md-nav__title for=__nav_7_6> <span class="md-nav__icon md-icon"></span> System </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Linux/System/1.%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E5%92%8C%E8%BD%AF%E4%BB%B6%E6%BA%90/ class=md-nav__link> <span class=md-ellipsis> 1.系统镜像和软件源 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/System/2.Linux%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA/ class=md-nav__link> <span class=md-ellipsis> 2.Linux安全加固 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/System/3.Systemd/ class=md-nav__link> <span class=md-ellipsis> 3.Systemd </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/System/4.Superivisor/ class=md-nav__link> <span class=md-ellipsis> 4.Superivisor </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/System/5.SSH%E7%99%BB%E5%BD%95Linux%E6%98%BE%E7%A4%BA%E6%A8%AA%E5%B9%85/ class=md-nav__link> <span class=md-ellipsis> 5.SSH登录Linux显示横幅.md </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/System/6.Linux%E4%B8%AD%E7%AB%AF%E5%8F%A3%E5%8D%A0%E7%94%A8%E6%8E%92%E6%9F%A5/ class=md-nav__link> <span class=md-ellipsis> 6.Linux中端口占用排查 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/System/7.%E4%BD%BF%E7%94%A8curl%E5%8F%91%E9%80%81REST-API%E8%AF%B7%E6%B1%82/ class=md-nav__link> <span class=md-ellipsis> 7.使用curl发送REST API请求 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/System/8.%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%A8%A1%E7%B3%8A%E6%9F%A5%E6%89%BE%E5%99%A8fzf/ class=md-nav__link> <span class=md-ellipsis> 8.命令行模糊查找器fzf </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/System/9.Centos7.9%E7%B3%BB%E7%BB%9F%E7%9B%98%E6%89%A9%E5%AE%B9/ class=md-nav__link> <span class=md-ellipsis> 9.Centos7.9系统盘扩容 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/System/10.Centos%E5%9C%A8%E7%BA%BF-%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96/ class=md-nav__link> <span class=md-ellipsis> 10.Centos在线-离线安装依赖 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/System/11.rsync-ssh/ class=md-nav__link> <span class=md-ellipsis> 11.rsync ssh使用 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_7> <label class=md-nav__link for=__nav_7_7 id=__nav_7_7_label tabindex=0> <span class=md-ellipsis> Serveices </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7_7> <span class="md-nav__icon md-icon"></span> Serveices </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Linux/Serveices/0.ubuntu-desktop-vmware/ class=md-nav__link> <span class=md-ellipsis> ubuntu-desktop-vmware </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8> <label class=md-nav__link for=__nav_8 id=__nav_8_label tabindex> <span class=md-ellipsis> Other </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_8_label aria-expanded=false> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> Other </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8_1> <label class=md-nav__link for=__nav_8_1 id=__nav_8_1_label tabindex=0> <span class=md-ellipsis> tools </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_8_1_label aria-expanded=false> <label class=md-nav__title for=__nav_8_1> <span class="md-nav__icon md-icon"></span> tools </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Other/tools/1.PicGo%E5%9B%BE%E5%BA%8A/ class=md-nav__link> <span class=md-ellipsis> 1.PicGo图床 </span> </a> </li> <li class=md-nav__item> <a href=../../../Other/tools/2.PicX%E5%9B%BE%E5%BA%8A/ class=md-nav__link> <span class=md-ellipsis> 2.Picx图床 </span> </a> </li> <li class=md-nav__item> <a href=../../../Other/tools/3.Markdown%E8%AF%AD%E6%B3%95/ class=md-nav__link> <span class=md-ellipsis> 3.Markdown语法 </span> </a> </li> <li class=md-nav__item> <a href=../../../Other/tools/4.KeyManager/ class=md-nav__link> <span class=md-ellipsis> 4.KeyManager </span> </a> </li> <li class=md-nav__item> <a href=../../../Other/tools/5.mkdocs-material%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2/ class=md-nav__link> <span class=md-ellipsis> 5.mkdocs-material搭建博客 </span> </a> </li> <li class=md-nav__item> <a href=../../../Other/tools/6.sphinx%E6%9E%84%E5%BB%BA%E5%8D%9A%E5%AE%A2/ class=md-nav__link> <span class=md-ellipsis> 6.sphinx构建博客 </span> </a> </li> <li class=md-nav__item> <a href=../../../Other/tools/7.%E4%BC%81%E4%B8%9A%E7%BA%A7VPN%E8%BD%AF%E4%BB%B6AnyLink/ class=md-nav__link> <span class=md-ellipsis> 7.企业级VPN软件AnyLink </span> </a> </li> <li class=md-nav__item> <a href=../../../Other/tools/8.%E5%B9%B3%E5%8F%B0%E5%8F%8A%E5%B7%A5%E5%85%B7%E6%B1%87%E6%80%BB/ class=md-nav__link> <span class=md-ellipsis> 8.平台及工具汇总 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8_2> <label class=md-nav__link for=__nav_8_2 id=__nav_8_2_label tabindex=0> <span class=md-ellipsis> windows </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_8_2_label aria-expanded=false> <label class=md-nav__title for=__nav_8_2> <span class="md-nav__icon md-icon"></span> windows </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Other/windows/1.%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6%E4%B8%8B%E8%BD%BD/ class=md-nav__link> <span class=md-ellipsis> 1.常用软件下载 </span> </a> </li> <li class=md-nav__item> <a href=../../../Other/windows/2.windows%E6%9F%A5%E7%9C%8B%E7%AB%AF%E5%8F%A3%E5%8D%A0%E7%94%A8/ class=md-nav__link> <span class=md-ellipsis> 2.windows查看端口占用 </span> </a> </li> <li class=md-nav__item> <a href=../../../Other/windows/3.Win11%E9%95%9C%E5%83%8F%E4%B8%8B%E8%BD%BD%E3%80%81%E5%A3%81%E7%BA%B8%E5%8F%8AKMS%E6%BF%80%E6%B4%BB/ class=md-nav__link> <span class=md-ellipsis> 3.Win11镜像下载、壁纸及KMS激活 </span> </a> </li> <li class=md-nav__item> <a href=../../../Other/windows/4.windows%E4%B8%8Bnetcat%E5%AE%89%E8%A3%85/ class=md-nav__link> <span class=md-ellipsis> 4.windows下netcat安装 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#1-项目背景 class=md-nav__link> <span class=md-ellipsis> 1. 项目背景 </span> </a> </li> <li class=md-nav__item> <a href=#2-前后端分离概述 class=md-nav__link> <span class=md-ellipsis> 2. 前后端分离概述 </span> </a> </li> <li class=md-nav__item> <a href=#3-功能设计 class=md-nav__link> <span class=md-ellipsis> 3. 功能设计 </span> </a> </li> <li class=md-nav__item> <a href=#4-client-go介绍 class=md-nav__link> <span class=md-ellipsis> 4. Client-go介绍 </span> </a> <nav class=md-nav aria-label="4. Client-go介绍"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#41-简介 class=md-nav__link> <span class=md-ellipsis> 4.1 简介 </span> </a> </li> <li class=md-nav__item> <a href=#42-环境搭建 class=md-nav__link> <span class=md-ellipsis> 4.2 环境搭建 </span> </a> <nav class=md-nav aria-label="4.2 环境搭建"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#安装精简版k8sk3s环境 class=md-nav__link> <span class=md-ellipsis> 安装精简版K8S(K3S)环境 </span> </a> </li> <li class=md-nav__item> <a href=#安装golang环境 class=md-nav__link> <span class=md-ellipsis> 安装golang环境 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#43-代码示例 class=md-nav__link> <span class=md-ellipsis> 4.3 代码示例 </span> </a> <nav class=md-nav aria-label="4.3 代码示例"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#创建一个测试pod class=md-nav__link> <span class=md-ellipsis> 创建一个测试pod </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#44-常用方法 class=md-nav__link> <span class=md-ellipsis> 4.4 常用方法 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#5-项目目录结构 class=md-nav__link> <span class=md-ellipsis> 5. 项目目录结构 </span> </a> </li> <li class=md-nav__item> <a href=#6-框架搭建 class=md-nav__link> <span class=md-ellipsis> 6. 框架搭建 </span> </a> <nav class=md-nav aria-label="6. 框架搭建"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-创建go项目 class=md-nav__link> <span class=md-ellipsis> 1. 创建go项目 </span> </a> </li> <li class=md-nav__item> <a href=#2-初始化gin工程 class=md-nav__link> <span class=md-ellipsis> 2. 初始化Gin工程 </span> </a> </li> <li class=md-nav__item> <a href=#3-初始化k8s-client class=md-nav__link> <span class=md-ellipsis> 3. 初始化K8s Client </span> </a> </li> <li class=md-nav__item> <a href=#4-测试api接口 class=md-nav__link> <span class=md-ellipsis> 4. 测试API接口 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#7-api开发 class=md-nav__link> <span class=md-ellipsis> 7. API开发 </span> </a> <nav class=md-nav aria-label="7. API开发"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-开发响应流程 class=md-nav__link> <span class=md-ellipsis> 1. 开发&amp;响应流程 </span> </a> </li> <li class=md-nav__item> <a href=#2-工作负载 class=md-nav__link> <span class=md-ellipsis> 2. 工作负载 </span> </a> <nav class=md-nav aria-label="2. 工作负载"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#21-数组的排序过滤分页 class=md-nav__link> <span class=md-ellipsis> 2.1 数组的排序、过滤、分页 </span> </a> </li> <li class=md-nav__item> <a href=#22-pod class=md-nav__link> <span class=md-ellipsis> 2.2 Pod </span> </a> </li> <li class=md-nav__item> <a href=#23-deployment class=md-nav__link> <span class=md-ellipsis> 2.3 Deployment </span> </a> </li> <li class=md-nav__item> <a href=#24-daemonset class=md-nav__link> <span class=md-ellipsis> 2.4 DaemonSet </span> </a> </li> <li class=md-nav__item> <a href=#25-statefulset class=md-nav__link> <span class=md-ellipsis> 2.5 StatefulSet </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#3-集群 class=md-nav__link> <span class=md-ellipsis> 3. 集群 </span> </a> <nav class=md-nav aria-label="3. 集群"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#31-node class=md-nav__link> <span class=md-ellipsis> 3.1 Node </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=k8s管理系统-后端api开发>K8s管理系统-后端API开发<a class=headerlink href=#k8s管理系统-后端api开发 title="Permanent link">&para;</a></h1> <p>本文档为后端服务器部分</p> <p>kubernetes客户端库文档：</p> <p><a href=https://kubernetes.io/zh-cn/docs/reference/using-api/client-libraries/ >https://kubernetes.io/zh-cn/docs/reference/using-api/client-libraries/</a></p> <p><a href=https://gitee.com/wangzilong9570/k8s-platform>gitee仓库地址</a></p> <blockquote> <p>提示：需要配置k8s集群和MySQL数据库</p> </blockquote> <h2 id=1-项目背景>1. 项目背景<a class=headerlink href=#1-项目背景 title="Permanent link">&para;</a></h2> <p>随着容器技术的广泛应用，kubernetes逐渐成为业内的核心技术，是容器编排技术的首选工具。</p> <p>而k8s管理平台在日常的容器维护中也发挥着举足轻重的作用，但随着k8s的定制化功能越来越多，dashboard 已经无法满足日常的维护需求，且 dashboard 的源码学习成本较高，抽象程度较高，二次开发成本也就比较高。</p> <p>本项目使用当下较主流的前端 vue+element plus 及后端 go+gin 框架，打造与dashboard对标的k8s管理功能，且可定制化程度高，</p> <p>同学们在入门后可根据自身需求，进行灵活定制开发，且本课程除了学习相关知识点外，会带着大家逐渐掌握开发习惯与技巧，让大家在日常工作中高效、高质量的进行开发作业。</p> <h2 id=2-前后端分离概述>2. 前后端分离概述<a class=headerlink href=#2-前后端分离概述 title="Permanent link">&para;</a></h2> <p>前后端分离已成为互联网项目开发的业界标准使用方式，通过 nginx+tomcat 的方式（也可以中间加一个node.js）有效的进行解耦，</p> <p>并且前后端分离会为以后的大型分布式架构、弹性计算架构、微服务架构、多段话服务（多种客户端，例如：浏览器，车载终端，安卓IOS等）打下坚实的基础。</p> <p>这个步骤是系统架构学习的必经之路。</p> <p><img alt=1698135577748 class=zoom src=https://cdn.jsdelivr.net/gh/hujianli94/Picgo-atlas@main/img/1698135577748.6u24tknnt9w0.png></p> <p>前后分离的优势：</p> <ol> <li>可以实现真正的前后端解耦，前端服务器使用nginx</li> <li>发现bug，可以快速定位是谁的问题，不会出现互相踢皮球的现象</li> <li>在大并发情况下，可以同时水平扩展前后端服务器。</li> <li>增加代码的维护性&amp;易读性（前后端耦合在一起的代码阅读比较费劲）</li> <li>提升开发效率，因为可以前后端并行开发，而不是像以前的强依赖</li> </ol> <h2 id=3-功能设计>3. 功能设计<a class=headerlink href=#3-功能设计 title="Permanent link">&para;</a></h2> <p><img alt=1698135709154 class=zoom src=https://cdn.jsdelivr.net/gh/hujianli94/Picgo-atlas@main/img/1698135709154.3anyxowdo8m.webp></p> <h2 id=4-client-go介绍>4. Client-go介绍<a class=headerlink href=#4-client-go介绍 title="Permanent link">&para;</a></h2> <h3 id=41-简介>4.1 简介<a class=headerlink href=#41-简介 title="Permanent link">&para;</a></h3> <blockquote> <p>​client-go官方文档：<a href=https://github.com/kubernetes/client-go>https://github.com/kubernetes/client-go</a></p> <p><a href=https://www.bookstack.cn/read/huweihuang-kubernetes-notes/develop-client-go.md>https://www.bookstack.cn/read/huweihuang-kubernetes-notes/develop-client-go.md</a></p> </blockquote> <p>client-go 是 kubernetes 官方提供的 go 语言的客户端库，go 应用使用该库可以访问 kubernetes 的 API Server，这样我们就能通过编程来对 kubernetes 资源进行增删改查操作。</p> <p>除了提供丰富的 API 用于操作 kubernetes 资源，client-go 还为 controller 和 operator 提供了重要支持 client-go 的 informer 机制，可以将 controller 关注的资源变化及时带给此 controller，使 controller 能够及时响应变化。</p> <p>通过 client-go 提供的客户端对象与 kubernetes 的 API Server 进行交互，而 client-go 提供了以下四种客户端对象：</p> <ol> <li>RESTClient这是最基础的客户端对象，仅为HTTPRequest进行了封装，实现RESTFul风格API，这个对象的使用并不方便，因为很多参数都要使用者来设置，于是client-go基于RESTClient又实现了三种新的客户端对象。</li> <li>ClientSet把Resource和Version也封装成了方法，用起来更简单直接，一个资源是一个客户端，多个资源就对应了多个客户端，所以ClientSet就是多个客户端的集合了，这样就好理解了，不过ClientSet只能访问内置资源，访问不了自定义资源</li> <li>DynamicClient可以访问内置资源和自定义资源，个人感觉有点像java的集合操作，拿出的内容是Object类型，按实际情况自己去做强制转换，当然了也会有强制转换失败的风险</li> <li>DiscoveryClient用于发现kubernetes的API Server支持的Group、Version、Resources等信息 //kubectl api-resources</li> </ol> <h3 id=42-环境搭建>4.2 环境搭建<a class=headerlink href=#42-环境搭建 title="Permanent link">&para;</a></h3> <h4 id=安装精简版k8sk3s环境>安装精简版K8S(K3S)环境<a class=headerlink href=#安装精简版k8sk3s环境 title="Permanent link">&para;</a></h4> <p>k3s的官方网址: <a href=https://k3s.io>https://k3s.io</a></p> <p>github地址：<a href=https://github.com/k3s-io/k3s>https://github.com/k3s-io/k3s</a></p> <blockquote> <p>前提</p> </blockquote> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled checked><span class=task-list-indicator></span></label> 安装centos7</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled checked><span class=task-list-indicator></span></label> 安装docker</li> </ul> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a>yum<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>yum-utils<span class=w> </span>device-mapper-persistent-data<span class=w> </span>lvm2
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=c1># 阿里源或者清华源 </span>
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a>sudo<span class=w> </span>yum-config-manager<span class=w> </span>--add-repo<span class=w> </span>https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
<a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=c1># sudo yum-config-manager --add-repo https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/centos/docker-ce.repo</span>
<a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a>yum<span class=w> </span>list<span class=w> </span>docker-ce<span class=w> </span>--showduplicates<span class=w> </span><span class=p>|</span><span class=w> </span>sort<span class=w> </span>-r
<a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a>yum<span class=w> </span>install<span class=w> </span>docker-ce<span class=w> </span>docker-ce-cli<span class=w> </span>containerd.io
<a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a>
<a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a>systemctl<span class=w> </span>start<span class=w> </span>docker
<a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a>systemctl<span class=w> </span>daemon-reload
<a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a>systemctl<span class=w> </span>restart<span class=w> </span>docker
<a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a>
<a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a>docker<span class=w> </span>run<span class=w> </span>-itd<span class=w> </span>-p<span class=w> </span><span class=m>80</span>:80<span class=w>  </span>nginx:1.18-alpine
</code></pre></div> <blockquote> <p>安装</p> </blockquote> <p>k3s的三个文件：</p> <ul> <li>k3s</li> <li>k3s-airgap-images-amd64.tar</li> <li>k3s-install.sh</li> </ul> <p>对于国内用户来说，访问Github超级慢，为了方便下载，可以直接使用下面百度云盘方式下载：</p> <p>百度网盘下载：</p> <p><a href=https://pan.baidu.com/s/1Ca1mxigeXOB7QaFLl5xM6A>https://pan.baidu.com/s/1Ca1mxigeXOB7QaFLl5xM6A</a> 提取码：8888</p> <div class=highlight><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a>chmod<span class=w> </span>+x<span class=w> </span>k3s
<a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a>cp<span class=w> </span>k3s<span class=w> </span>/usr/local/bin/
<a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a>
<a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a>docker<span class=w> </span>load<span class=w> </span>-i<span class=w> </span>k3s-airgap-images-amd64.tar
<a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a>
<a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a><span class=nb>export</span><span class=w> </span><span class=nv>INSTALL_K3S_SKIP_DOWNLOAD</span><span class=o>=</span><span class=nb>true</span>
<a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a>
<a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a><span class=nb>export</span><span class=w> </span><span class=nv>INSTALL_K3S_EXEC</span><span class=o>=</span><span class=s2>&quot;--docker --bind-address=192.168.1.147 \</span>
<a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a><span class=s2>  --cluster-cidr=10.128.0.0/16 --service-cidr=10.129.0.0/16  \</span>
<a id=__codelineno-1-10 name=__codelineno-1-10 href=#__codelineno-1-10></a><span class=s2>  --kube-apiserver-arg service-node-port-range=30000-50000 \</span>
<a id=__codelineno-1-11 name=__codelineno-1-11 href=#__codelineno-1-11></a><span class=s2>  --no-deploy traefik --no-deploy servicelb \</span>
<a id=__codelineno-1-12 name=__codelineno-1-12 href=#__codelineno-1-12></a><span class=s2>  --write-kubeconfig ~/.kube/config --write-kubeconfig-mode 666&quot;</span>
<a id=__codelineno-1-13 name=__codelineno-1-13 href=#__codelineno-1-13></a>
<a id=__codelineno-1-14 name=__codelineno-1-14 href=#__codelineno-1-14></a>sh<span class=w> </span>k3s-install.sh
<a id=__codelineno-1-15 name=__codelineno-1-15 href=#__codelineno-1-15></a>
<a id=__codelineno-1-16 name=__codelineno-1-16 href=#__codelineno-1-16></a>kubectl<span class=w> </span>get<span class=w> </span>pod<span class=w> </span>-A
<a id=__codelineno-1-17 name=__codelineno-1-17 href=#__codelineno-1-17></a>NAMESPACE<span class=w>     </span>NAME<span class=w>                                      </span>READY<span class=w>   </span>STATUS<span class=w>    </span>RESTARTS<span class=w>   </span>AGE
<a id=__codelineno-1-18 name=__codelineno-1-18 href=#__codelineno-1-18></a>kube-system<span class=w>   </span>local-path-provisioner-58fb86bdfd-dgjdm<span class=w>   </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>62s
<a id=__codelineno-1-19 name=__codelineno-1-19 href=#__codelineno-1-19></a>kube-system<span class=w>   </span>metrics-server-6d684c7b5-mcfv4<span class=w>            </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>62s
<a id=__codelineno-1-20 name=__codelineno-1-20 href=#__codelineno-1-20></a>kube-system<span class=w>   </span>coredns-6c6bb68b64-x9p6c<span class=w>                  </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>62s
<a id=__codelineno-1-21 name=__codelineno-1-21 href=#__codelineno-1-21></a>
<a id=__codelineno-1-22 name=__codelineno-1-22 href=#__codelineno-1-22></a>
<a id=__codelineno-1-23 name=__codelineno-1-23 href=#__codelineno-1-23></a><span class=c1># kubectl补全</span>
<a id=__codelineno-1-24 name=__codelineno-1-24 href=#__codelineno-1-24></a><span class=c1># centos7上</span>
<a id=__codelineno-1-25 name=__codelineno-1-25 href=#__codelineno-1-25></a>yum<span class=w> </span>-y<span class=w> </span>install<span class=w> </span>bash-completion
<a id=__codelineno-1-26 name=__codelineno-1-26 href=#__codelineno-1-26></a><span class=c1># ubuntu上</span>
<a id=__codelineno-1-27 name=__codelineno-1-27 href=#__codelineno-1-27></a>sudo<span class=w> </span>apt<span class=w> </span>install<span class=w> </span>bash-completion
<a id=__codelineno-1-28 name=__codelineno-1-28 href=#__codelineno-1-28></a>
<a id=__codelineno-1-29 name=__codelineno-1-29 href=#__codelineno-1-29></a>
<a id=__codelineno-1-30 name=__codelineno-1-30 href=#__codelineno-1-30></a><span class=c1># 在 bash 中设置当前 shell 的自动补全</span>
<a id=__codelineno-1-31 name=__codelineno-1-31 href=#__codelineno-1-31></a><span class=nb>source</span><span class=w> </span>&lt;<span class=o>(</span>kubectl<span class=w> </span>completion<span class=w> </span>bash<span class=o>)</span><span class=w> </span>
<a id=__codelineno-1-32 name=__codelineno-1-32 href=#__codelineno-1-32></a><span class=c1># 在你的 bash shell 中永久地添加自动补全</span>
<a id=__codelineno-1-33 name=__codelineno-1-33 href=#__codelineno-1-33></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;source &lt;(kubectl completion bash)&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span>~/.bashrc<span class=w> </span>
<a id=__codelineno-1-34 name=__codelineno-1-34 href=#__codelineno-1-34></a><span class=nb>source</span><span class=w> </span>/usr/share/bash-completion/bash_completion
<a id=__codelineno-1-35 name=__codelineno-1-35 href=#__codelineno-1-35></a>
<a id=__codelineno-1-36 name=__codelineno-1-36 href=#__codelineno-1-36></a>
<a id=__codelineno-1-37 name=__codelineno-1-37 href=#__codelineno-1-37></a><span class=c1># 快捷键</span>
<a id=__codelineno-1-38 name=__codelineno-1-38 href=#__codelineno-1-38></a>cat<span class=w> </span>&gt;&gt;<span class=w> </span>~/.bashrc<span class=w> </span><span class=s>&lt;&lt;EOF</span>
<a id=__codelineno-1-39 name=__codelineno-1-39 href=#__codelineno-1-39></a><span class=s>alias k=kubectl</span>
<a id=__codelineno-1-40 name=__codelineno-1-40 href=#__codelineno-1-40></a><span class=s>complete -o default -F __start_kubectl k</span>
<a id=__codelineno-1-41 name=__codelineno-1-41 href=#__codelineno-1-41></a><span class=s>EOF</span>
<a id=__codelineno-1-42 name=__codelineno-1-42 href=#__codelineno-1-42></a>
<a id=__codelineno-1-43 name=__codelineno-1-43 href=#__codelineno-1-43></a><span class=nb>source</span><span class=w> </span>~/.bashrc
</code></pre></div> <p><a href=https://www.yuque.com/leryn/wiki/cloud.k8s.k3s>k3s安装</a></p> <p><a href=https://jueee.github.io/2021/09/2021-09-15-%E7%A6%BB%E7%BA%BF%E6%90%AD%E5%BB%BA%E9%83%A8%E7%BD%B2%E9%AB%98%E5%8F%AF%E7%94%A8k3s%E9%9B%86%E7%BE%A4/ >离线搭建部署高可用 k3s 集群</a></p> <p><a href=https://imroc.cc/kubernetes/deploy/k3s/offline-installation>k3s 国内离线安装方法</a></p> <p><a href=https://docs.k3s.io/zh/installation/airgap#%E5%AE%89%E8%A3%85-k3s>k3s 官方离线安装方法</a></p> <p><a href=https://www.linuxbuzz.com/install-k3s-kubernetes-cluster-on-ubuntu/ >How to Install k3s Kubernetes Cluster on Ubuntu 22.04</a></p> <h4 id=安装golang环境>安装golang环境<a class=headerlink href=#安装golang环境 title="Permanent link">&para;</a></h4> <p>在k8s-master节点上</p> <div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=c1># 一：yum安装</span>
<a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a>yum<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>epel-release
<a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a>yum<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>golang
<a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a>
<a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a>
<a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a><span class=c1># 二：手动配置 去官网下载安装包手动编译安装</span>
<a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a>mkdir<span class=w> </span>~/go<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nb>cd</span><span class=w> </span>~/go
<a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a>wget<span class=w> </span>https://dl.google.com/go/go1.17.8.linux-amd64.tar.gz
<a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a><span class=c1># 解压到/usr/local目录下</span>
<a id=__codelineno-2-10 name=__codelineno-2-10 href=#__codelineno-2-10></a>tar<span class=w> </span>-C<span class=w> </span>/usr/local<span class=w> </span>-zxvf<span class=w> </span>go1.17.8.linux-amd64.tar.gz
<a id=__codelineno-2-11 name=__codelineno-2-11 href=#__codelineno-2-11></a>
<a id=__codelineno-2-12 name=__codelineno-2-12 href=#__codelineno-2-12></a><span class=c1># 添加/usr/local/go/bin目录到PATH变量中</span>
<a id=__codelineno-2-13 name=__codelineno-2-13 href=#__codelineno-2-13></a>vi<span class=w> </span>~/.bashrc
<a id=__codelineno-2-14 name=__codelineno-2-14 href=#__codelineno-2-14></a><span class=nb>export</span><span class=w> </span><span class=nv>GOROOT</span><span class=o>=</span>/usr/local/go
<a id=__codelineno-2-15 name=__codelineno-2-15 href=#__codelineno-2-15></a><span class=nb>export</span><span class=w> </span><span class=nv>PATH</span><span class=o>=</span><span class=nv>$PATH</span>:<span class=nv>$GOROOT</span>/bin
<a id=__codelineno-2-16 name=__codelineno-2-16 href=#__codelineno-2-16></a>
<a id=__codelineno-2-17 name=__codelineno-2-17 href=#__codelineno-2-17></a><span class=c1># 刷新配置</span>
<a id=__codelineno-2-18 name=__codelineno-2-18 href=#__codelineno-2-18></a><span class=nb>source</span><span class=w> </span>~/.bashrc
</code></pre></div> <p>新建k8s-platform项目，设置goland远程环境运行</p> <p><img alt=1698201779063 class=zoom src=https://cdn.jsdelivr.net/gh/hujianli94/Picgo-atlas@main/img/1698201779063.10verb6egj5c.png></p> <p><img alt=1698202043803 class=zoom src=https://cdn.jsdelivr.net/gh/hujianli94/Picgo-atlas@main/img/1698202043803.56pntwrwyyg0.png></p> <p>户名，填写密钥</p> <h3 id=43-代码示例>4.3 代码示例<a class=headerlink href=#43-代码示例 title="Permanent link">&para;</a></h3> <h4 id=创建一个测试pod>创建一个测试pod<a class=headerlink href=#创建一个测试pod title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a>kubectl<span class=w> </span>run<span class=w> </span>-i<span class=w> </span>--tty<span class=w> </span>alpine-<span class=nv>$RANDOM</span><span class=w> </span>--image<span class=o>=</span>alpine:latest<span class=w> </span>--<span class=w> </span>sh
<a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=c1># -restart=Never 意味着这个 Pod 不会被重启。</span>
<a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a>
<a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a><span class=c1># --rm 会在退出时自动删除这个 Pod</span>
<a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a><span class=c1># kubectl run -it --rm test-pod --image=appropriate/curl --restart=Never -- /bin/sh</span>
<a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a>
<a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a>kubectl<span class=w> </span>run<span class=w> </span>-i<span class=w> </span>--tty<span class=w> </span>busybox<span class=w> </span>--image<span class=o>=</span>busybox<span class=w> </span>--<span class=w> </span>sh
<a id=__codelineno-3-8 name=__codelineno-3-8 href=#__codelineno-3-8></a>
<a id=__codelineno-3-9 name=__codelineno-3-9 href=#__codelineno-3-9></a>kubectl<span class=w> </span>run<span class=w> </span>ubuntu<span class=w> </span>--image<span class=o>=</span>ubuntu:20.04<span class=w> </span>--restart<span class=o>=</span>Always<span class=w> </span>--<span class=w> </span>/bin/bash<span class=w> </span>-c<span class=w> </span><span class=s2>&quot;while true; do sleep 30; done;&quot;</span>
<a id=__codelineno-3-10 name=__codelineno-3-10 href=#__codelineno-3-10></a><span class=c1># kubectl run -i --tty ubuntu --image=ubuntu:20.04 --restart=Never -- bash -il</span>
</code></pre></div> <p>我们这里在default名称空间下运行3个测试pod</p> <div class=highlight><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a>kubectl<span class=w> </span>get<span class=w> </span>pod
<a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a>NAME<span class=w>                           </span>READY<span class=w>   </span>STATUS<span class=w>    </span>RESTARTS<span class=w>   </span>AGE
<a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a>alpine-9594-7997b99597-z2k6m<span class=w>   </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>1</span><span class=w>          </span>14m
<a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a>busybox-6cd57fd969-5sxvp<span class=w>       </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>1</span><span class=w>          </span>13m
<a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a>ubuntu-797bd794cf-bv75b<span class=w>        </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>3s
</code></pre></div> <p>main.go</p> <div class=highlight><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=kn>package</span><span class=w> </span><span class=nx>main</span>
<a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a>
<a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=kn>import</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a><span class=w>    </span><span class=s>&quot;context&quot;</span>
<a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a><span class=w>    </span><span class=s>&quot;flag&quot;</span>
<a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a><span class=w>    </span><span class=s>&quot;fmt&quot;</span>
<a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a><span class=w>    </span><span class=s>&quot;os&quot;</span>
<a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a><span class=w>    </span><span class=s>&quot;path/filepath&quot;</span>
<a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a>
<a id=__codelineno-5-10 name=__codelineno-5-10 href=#__codelineno-5-10></a><span class=w>    </span><span class=nx>metav1</span><span class=w> </span><span class=s>&quot;k8s.io/apimachinery/pkg/apis/meta/v1&quot;</span>
<a id=__codelineno-5-11 name=__codelineno-5-11 href=#__codelineno-5-11></a>
<a id=__codelineno-5-12 name=__codelineno-5-12 href=#__codelineno-5-12></a><span class=w>    </span><span class=s>&quot;k8s.io/client-go/kubernetes&quot;</span>
<a id=__codelineno-5-13 name=__codelineno-5-13 href=#__codelineno-5-13></a><span class=w>    </span><span class=s>&quot;k8s.io/client-go/tools/clientcmd&quot;</span><span class=w> </span><span class=c1>//可能需要挂vpn,留意版本问题</span>
<a id=__codelineno-5-14 name=__codelineno-5-14 href=#__codelineno-5-14></a><span class=p>)</span>
<a id=__codelineno-5-15 name=__codelineno-5-15 href=#__codelineno-5-15></a>
<a id=__codelineno-5-16 name=__codelineno-5-16 href=#__codelineno-5-16></a><span class=kd>func</span><span class=w> </span><span class=nx>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-5-17 name=__codelineno-5-17 href=#__codelineno-5-17></a><span class=w>    </span><span class=c1>//声明kubeconfig配置文件</span>
<a id=__codelineno-5-18 name=__codelineno-5-18 href=#__codelineno-5-18></a><span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=nx>kubeconfig</span><span class=w> </span><span class=o>*</span><span class=kt>string</span>
<a id=__codelineno-5-19 name=__codelineno-5-19 href=#__codelineno-5-19></a><span class=w>    </span><span class=c1>//获取home环境变量，拿到$HOME/.kube/config配置文件</span>
<a id=__codelineno-5-20 name=__codelineno-5-20 href=#__codelineno-5-20></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>home</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>homeDir</span><span class=p>();</span><span class=w> </span><span class=nx>home</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=s>&quot;&quot;</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-5-21 name=__codelineno-5-21 href=#__codelineno-5-21></a><span class=w>        </span><span class=nx>kubeconfig</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>flag</span><span class=p>.</span><span class=nx>String</span><span class=p>(</span><span class=s>&quot;kubeconfig&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>filepath</span><span class=p>.</span><span class=nx>Join</span><span class=p>(</span><span class=nx>home</span><span class=p>,</span><span class=w> </span><span class=s>&quot;.kube&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;config&quot;</span><span class=p>),</span>
<a id=__codelineno-5-22 name=__codelineno-5-22 href=#__codelineno-5-22></a><span class=w>            </span><span class=s>&quot;(optional) absolute path to the kubeconfig file&quot;</span><span class=p>)</span>
<a id=__codelineno-5-23 name=__codelineno-5-23 href=#__codelineno-5-23></a><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-5-24 name=__codelineno-5-24 href=#__codelineno-5-24></a><span class=w>        </span><span class=c1>//否则就根据kubeconfig传到获得config的路径</span>
<a id=__codelineno-5-25 name=__codelineno-5-25 href=#__codelineno-5-25></a><span class=w>        </span><span class=nx>kubeconfig</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>flag</span><span class=p>.</span><span class=nx>String</span><span class=p>(</span><span class=s>&quot;kubeconfig&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;absolute path to the kubeconfig file&quot;</span><span class=p>)</span>
<a id=__codelineno-5-26 name=__codelineno-5-26 href=#__codelineno-5-26></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-5-27 name=__codelineno-5-27 href=#__codelineno-5-27></a><span class=w>    </span><span class=nx>flag</span><span class=p>.</span><span class=nx>Parse</span><span class=p>()</span>
<a id=__codelineno-5-28 name=__codelineno-5-28 href=#__codelineno-5-28></a><span class=w>    </span><span class=c1>//将kubeconfig文件转换成rest.config类型文件</span>
<a id=__codelineno-5-29 name=__codelineno-5-29 href=#__codelineno-5-29></a><span class=w>    </span><span class=c1>//*kubeconfig其实就是kubeconfig文件的默认位置地址，直接填入地址字符串也可</span>
<a id=__codelineno-5-30 name=__codelineno-5-30 href=#__codelineno-5-30></a><span class=w>    </span><span class=nx>config</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>clientcmd</span><span class=p>.</span><span class=nx>BuildConfigFromFlags</span><span class=p>(</span><span class=s>&quot;&quot;</span><span class=p>,</span><span class=w> </span><span class=o>*</span><span class=nx>kubeconfig</span><span class=p>)</span>
<a id=__codelineno-5-31 name=__codelineno-5-31 href=#__codelineno-5-31></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-5-32 name=__codelineno-5-32 href=#__codelineno-5-32></a><span class=w>        </span><span class=nb>panic</span><span class=p>(</span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-5-33 name=__codelineno-5-33 href=#__codelineno-5-33></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-5-34 name=__codelineno-5-34 href=#__codelineno-5-34></a><span class=w>    </span><span class=c1>//根据rest.config类型的对象，new一个clientset出来</span>
<a id=__codelineno-5-35 name=__codelineno-5-35 href=#__codelineno-5-35></a><span class=w>    </span><span class=nx>clientset</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>kubernetes</span><span class=p>.</span><span class=nx>NewForConfig</span><span class=p>(</span><span class=nx>config</span><span class=p>)</span>
<a id=__codelineno-5-36 name=__codelineno-5-36 href=#__codelineno-5-36></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-5-37 name=__codelineno-5-37 href=#__codelineno-5-37></a><span class=w>        </span><span class=nb>panic</span><span class=p>(</span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-5-38 name=__codelineno-5-38 href=#__codelineno-5-38></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-5-39 name=__codelineno-5-39 href=#__codelineno-5-39></a><span class=w>    </span><span class=c1>//通过client-go sdk获取pods列表，命名空间是default</span>
<a id=__codelineno-5-40 name=__codelineno-5-40 href=#__codelineno-5-40></a><span class=w>    </span><span class=nx>pods</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>clientset</span><span class=p>.</span><span class=nx>CoreV1</span><span class=p>().</span><span class=nx>Pods</span><span class=p>(</span><span class=s>&quot;default&quot;</span><span class=p>).</span><span class=nx>List</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>ListOptions</span><span class=p>{})</span>
<a id=__codelineno-5-41 name=__codelineno-5-41 href=#__codelineno-5-41></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-5-42 name=__codelineno-5-42 href=#__codelineno-5-42></a><span class=w>        </span><span class=nb>panic</span><span class=p>(</span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-5-43 name=__codelineno-5-43 href=#__codelineno-5-43></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-5-44 name=__codelineno-5-44 href=#__codelineno-5-44></a><span class=w>    </span><span class=c1>//打印pod测试</span>
<a id=__codelineno-5-45 name=__codelineno-5-45 href=#__codelineno-5-45></a><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>pod</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>pods</span><span class=p>.</span><span class=nx>Items</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-5-46 name=__codelineno-5-46 href=#__codelineno-5-46></a><span class=w>        </span><span class=nx>fmt</span><span class=p>.</span><span class=nx>Println</span><span class=p>(</span><span class=nx>pod</span><span class=p>.</span><span class=nx>Name</span><span class=p>,</span><span class=w> </span><span class=nx>pod</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>)</span>
<a id=__codelineno-5-47 name=__codelineno-5-47 href=#__codelineno-5-47></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-5-48 name=__codelineno-5-48 href=#__codelineno-5-48></a><span class=p>}</span>
<a id=__codelineno-5-49 name=__codelineno-5-49 href=#__codelineno-5-49></a>
<a id=__codelineno-5-50 name=__codelineno-5-50 href=#__codelineno-5-50></a><span class=kd>func</span><span class=w> </span><span class=nx>homeDir</span><span class=p>()</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-5-51 name=__codelineno-5-51 href=#__codelineno-5-51></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>h</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>os</span><span class=p>.</span><span class=nx>Getenv</span><span class=p>(</span><span class=s>&quot;HOME&quot;</span><span class=p>);</span><span class=w> </span><span class=nx>h</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=s>&quot;&quot;</span><span class=w> </span><span class=p>{</span><span class=c1>//linux</span>
<a id=__codelineno-5-52 name=__codelineno-5-52 href=#__codelineno-5-52></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>h</span>
<a id=__codelineno-5-53 name=__codelineno-5-53 href=#__codelineno-5-53></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-5-54 name=__codelineno-5-54 href=#__codelineno-5-54></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>os</span><span class=p>.</span><span class=nx>Getenv</span><span class=p>(</span><span class=s>&quot;USERPROFILE&quot;</span><span class=p>)</span><span class=w> </span><span class=c1>//windows</span>
<a id=__codelineno-5-55 name=__codelineno-5-55 href=#__codelineno-5-55></a><span class=p>}</span>
</code></pre></div> <p>运行结果</p> <div class=highlight><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a>alpine-9594-7997b99597-z2k6m<span class=w> </span>default
<a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a>busybox-6cd57fd969-5sxvp<span class=w> </span>default
<a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a>ubuntu-797bd794cf-bv75b<span class=w> </span>default
</code></pre></div> <p>获取到了pod名和命名空间</p> <h3 id=44-常用方法>4.4 常用方法<a class=headerlink href=#44-常用方法 title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=c1>//获取pod列表 </span>
<a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a><span class=nx>podList</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>CoreV1</span><span class=p>().</span><span class=nx>Pods</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span><span class=nx>List</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>ListOptions</span><span class=p>{})</span><span class=w> </span>
<a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a>
<a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a><span class=c1>//获取pod详情 </span>
<a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a><span class=nx>pod</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>CoreV1</span><span class=p>().</span><span class=nx>Pods</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span><span class=nx>Get</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>podName</span><span class=p>,</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>GetOptions</span><span class=p>{})</span><span class=w> </span>
<a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a>
<a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a><span class=c1>//删除pod </span>
<a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>CoreV1</span><span class=p>().</span><span class=nx>Pods</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span><span class=nx>Delete</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>podName</span><span class=p>,</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>DeleteOptions</span><span class=p>{})</span><span class=w> </span>
<a id=__codelineno-7-9 name=__codelineno-7-9 href=#__codelineno-7-9></a>
<a id=__codelineno-7-10 name=__codelineno-7-10 href=#__codelineno-7-10></a><span class=c1>//更新pod（完整yaml） </span>
<a id=__codelineno-7-11 name=__codelineno-7-11 href=#__codelineno-7-11></a><span class=nx>pod</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>CoreV1</span><span class=p>().</span><span class=nx>Pods</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span><span class=nx>Update</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>pod</span><span class=p>,</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>UpdateOptions</span><span class=p>{})</span><span class=w> </span>
<a id=__codelineno-7-12 name=__codelineno-7-12 href=#__codelineno-7-12></a>
<a id=__codelineno-7-13 name=__codelineno-7-13 href=#__codelineno-7-13></a><span class=c1>//获取deployment副本数 </span>
<a id=__codelineno-7-14 name=__codelineno-7-14 href=#__codelineno-7-14></a><span class=nx>scale</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>AppsV1</span><span class=p>().</span><span class=nx>Deployments</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span><span class=nx>GetScale</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>deploymentName</span><span class=p>,</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>GetOptions</span><span class=p>{})</span><span class=w> </span>
<a id=__codelineno-7-15 name=__codelineno-7-15 href=#__codelineno-7-15></a>
<a id=__codelineno-7-16 name=__codelineno-7-16 href=#__codelineno-7-16></a><span class=c1>//创建deployment </span>
<a id=__codelineno-7-17 name=__codelineno-7-17 href=#__codelineno-7-17></a><span class=nx>deployment</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>AppsV1</span><span class=p>().</span><span class=nx>Deployments</span><span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>).</span><span class=nx>Create</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>deployment</span><span class=p>,</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>CreateOptions</span><span class=p>{})</span><span class=w> </span>
<a id=__codelineno-7-18 name=__codelineno-7-18 href=#__codelineno-7-18></a>
<a id=__codelineno-7-19 name=__codelineno-7-19 href=#__codelineno-7-19></a><span class=c1>//更新deployment（部分yaml） </span>
<a id=__codelineno-7-20 name=__codelineno-7-20 href=#__codelineno-7-20></a><span class=nx>deployment</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>AppsV1</span><span class=p>().</span><span class=nx>Deployments</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span><span class=nx>Patch</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>deploymentName</span><span class=p>,</span><span class=w> </span><span class=s>&quot;application/strategic-merge-patch+json&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>patchByte</span><span class=p>,</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>PatchOptions</span><span class=p>{})</span>
</code></pre></div> <h2 id=5-项目目录结构>5. 项目目录结构<a class=headerlink href=#5-项目目录结构 title="Permanent link">&para;</a></h2> <p><img alt=1698204465060 class=zoom src=https://cdn.jsdelivr.net/gh/hujianli94/Picgo-atlas@main/img/1698204465060.6qcpqwmfgyo0.png></p> <ul> <li>config：定义全局配置，如监听地址、管理员账号等。</li> <li>controller：controller层，定义路由规则，及接口入参和响应。</li> <li>service：服务层，处理接口的业务逻辑。</li> <li>dao：数据库操作，包含数据库的增删改查。</li> <li>model：定义数据库的表的字段。</li> <li>db: 用于初始化数据库连接以及配置。</li> <li>middle：中间件层，添加全局的逻辑处理，如跨域、jwt验证等。</li> <li>utils：工具目录，定义常用工具，如token解析，文件操作等。</li> <li>go.mod：定义项目的依赖包以及版本。</li> <li>main.go：项目的主入口 main函数。</li> </ul> <h2 id=6-框架搭建>6. 框架搭建<a class=headerlink href=#6-框架搭建 title="Permanent link">&para;</a></h2> <h3 id=1-创建go项目>1. 创建go项目<a class=headerlink href=#1-创建go项目 title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a>/d/coder/go/src/gitee.com/k8s-platform<span class=w> </span>tree
<a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a>+---<span class=w> </span>config
<a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a>+---<span class=w> </span>controller
<a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a>+---<span class=w> </span>dao
<a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a>+---<span class=w> </span>db
<a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a>+---<span class=w> </span>go.mod
<a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a>+---<span class=w> </span>main.go
<a id=__codelineno-8-8 name=__codelineno-8-8 href=#__codelineno-8-8></a>+---<span class=w> </span>middle
<a id=__codelineno-8-9 name=__codelineno-8-9 href=#__codelineno-8-9></a>+---<span class=w> </span>model
<a id=__codelineno-8-10 name=__codelineno-8-10 href=#__codelineno-8-10></a>+---<span class=w> </span>service
<a id=__codelineno-8-11 name=__codelineno-8-11 href=#__codelineno-8-11></a>+---<span class=w> </span>utils
</code></pre></div> <h3 id=2-初始化gin工程>2. 初始化Gin工程<a class=headerlink href=#2-初始化gin工程 title="Permanent link">&para;</a></h3> <p>（1）创建项目目录结构</p> <p>（2）创建config/config.go文件，配置启动监听端口</p> <div class=highlight><pre><span></span><code><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=kn>package</span><span class=w> </span><span class=nx>config</span>
<a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a>
<a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a><span class=kd>const</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a><span class=w>    </span><span class=c1>// ListenAddr 配置启动监听端口</span>
<a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a><span class=w>    </span><span class=nx>ListenAddr</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=s>&quot;0.0.0.0:9090&quot;</span>
<a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a><span class=p>)</span>
</code></pre></div> <p>（3）创建controller/router.go文件，初始化api路由规则，编写测试api接口</p> <div class=highlight><pre><span></span><code><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=kn>package</span><span class=w> </span><span class=nx>controller</span>
<a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a>
<a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a><span class=kn>import</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a><span class=w>    </span><span class=s>&quot;github.com/gin-gonic/gin&quot;</span>
<a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a><span class=w>    </span><span class=s>&quot;net/http&quot;</span>
<a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a><span class=p>)</span>
<a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a>
<a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a><span class=c1>// Router 实例化router结构体，可使用该对象点出首字母大写的方法（包外调用）</span>
<a id=__codelineno-10-9 name=__codelineno-10-9 href=#__codelineno-10-9></a><span class=kd>var</span><span class=w> </span><span class=nx>Router</span><span class=w> </span><span class=nx>router</span>
<a id=__codelineno-10-10 name=__codelineno-10-10 href=#__codelineno-10-10></a>
<a id=__codelineno-10-11 name=__codelineno-10-11 href=#__codelineno-10-11></a><span class=c1>// 创建router结构体</span>
<a id=__codelineno-10-12 name=__codelineno-10-12 href=#__codelineno-10-12></a><span class=kd>type</span><span class=w> </span><span class=nx>router</span><span class=w> </span><span class=kd>struct</span><span class=p>{}</span>
<a id=__codelineno-10-13 name=__codelineno-10-13 href=#__codelineno-10-13></a>
<a id=__codelineno-10-14 name=__codelineno-10-14 href=#__codelineno-10-14></a><span class=c1>// InitApiRouter 初始化路由规则，创建测试api接口</span>
<a id=__codelineno-10-15 name=__codelineno-10-15 href=#__codelineno-10-15></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>r</span><span class=w> </span><span class=o>*</span><span class=nx>router</span><span class=p>)</span><span class=w> </span><span class=nx>InitApiRouter</span><span class=p>(</span><span class=nx>router</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Engine</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-10-16 name=__codelineno-10-16 href=#__codelineno-10-16></a><span class=w>    </span><span class=nx>router</span><span class=p>.</span><span class=nx>GET</span><span class=p>(</span><span class=s>&quot;/testapi&quot;</span><span class=p>,</span><span class=w> </span><span class=kd>func</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-10-17 name=__codelineno-10-17 href=#__codelineno-10-17></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-10-18 name=__codelineno-10-18 href=#__codelineno-10-18></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;testapi success!&quot;</span><span class=p>,</span>
<a id=__codelineno-10-19 name=__codelineno-10-19 href=#__codelineno-10-19></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-10-20 name=__codelineno-10-20 href=#__codelineno-10-20></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-10-21 name=__codelineno-10-21 href=#__codelineno-10-21></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-10-22 name=__codelineno-10-22 href=#__codelineno-10-22></a><span class=p>}</span>
</code></pre></div> <p>（4）main.go文件中，启动gin程序</p> <div class=highlight><pre><span></span><code><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=kn>package</span><span class=w> </span><span class=nx>main</span>
<a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a>
<a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a><span class=kn>import</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a><span class=w>    </span><span class=s>&quot;gitee.com/k8s-platform/config&quot;</span>
<a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a><span class=w>    </span><span class=s>&quot;gitee.com/k8s-platform/controller&quot;</span>
<a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a>
<a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a><span class=w>    </span><span class=s>&quot;github.com/gin-gonic/gin&quot;</span>
<a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a><span class=p>)</span>
<a id=__codelineno-11-9 name=__codelineno-11-9 href=#__codelineno-11-9></a>
<a id=__codelineno-11-10 name=__codelineno-11-10 href=#__codelineno-11-10></a><span class=kd>func</span><span class=w> </span><span class=nx>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-11-11 name=__codelineno-11-11 href=#__codelineno-11-11></a><span class=w>    </span><span class=c1>//初始化gin对象</span>
<a id=__codelineno-11-12 name=__codelineno-11-12 href=#__codelineno-11-12></a><span class=w>    </span><span class=nx>r</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>Default</span><span class=p>()</span>
<a id=__codelineno-11-13 name=__codelineno-11-13 href=#__codelineno-11-13></a><span class=w>    </span><span class=c1>//初始化路由规则</span>
<a id=__codelineno-11-14 name=__codelineno-11-14 href=#__codelineno-11-14></a><span class=w>    </span><span class=nx>controller</span><span class=p>.</span><span class=nx>Router</span><span class=p>.</span><span class=nx>InitApiRouter</span><span class=p>(</span><span class=nx>r</span><span class=p>)</span>
<a id=__codelineno-11-15 name=__codelineno-11-15 href=#__codelineno-11-15></a><span class=w>    </span><span class=c1>//gin程序启动</span>
<a id=__codelineno-11-16 name=__codelineno-11-16 href=#__codelineno-11-16></a><span class=w>    </span><span class=nx>r</span><span class=p>.</span><span class=nx>Run</span><span class=p>(</span><span class=nx>config</span><span class=p>.</span><span class=nx>ListenAddr</span><span class=p>)</span>
<a id=__codelineno-11-17 name=__codelineno-11-17 href=#__codelineno-11-17></a><span class=p>}</span>
</code></pre></div> <div class=highlight><pre><span></span><code><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a>curl<span class=w> </span>http://127.0.0.1:9090/testapi
<a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a><span class=o>{</span><span class=s2>&quot;data&quot;</span>:null,<span class=s2>&quot;msg&quot;</span>:<span class=s2>&quot;testapi success!&quot;</span><span class=o>}</span><span class=w>    </span>
</code></pre></div> <h3 id=3-初始化k8s-client>3. 初始化K8s Client<a class=headerlink href=#3-初始化k8s-client title="Permanent link">&para;</a></h3> <p>（1）在config.go中添加kubeconfig文件路径</p> <div class=highlight><pre><span></span><code><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=kn>package</span><span class=w> </span><span class=nx>config</span>
<a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a>
<a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a><span class=kd>const</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a><span class=c1>// 配置启动监听端口</span>
<a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a><span class=nx>ListenAddr</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=s>&quot;0.0.0.0:9090&quot;</span>
<a id=__codelineno-13-6 name=__codelineno-13-6 href=#__codelineno-13-6></a>
<a id=__codelineno-13-7 name=__codelineno-13-7 href=#__codelineno-13-7></a><span class=c1>// Linux上配置</span>
<a id=__codelineno-13-8 name=__codelineno-13-8 href=#__codelineno-13-8></a><span class=c1>// Kubeconfig = &quot;/root/.kube/config&quot;</span>
<a id=__codelineno-13-9 name=__codelineno-13-9 href=#__codelineno-13-9></a><span class=c1>// Windows上配置</span>
<a id=__codelineno-13-10 name=__codelineno-13-10 href=#__codelineno-13-10></a><span class=nx>Kubeconfig</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=s>&quot;C:\\Users/18793/.kube/config&quot;</span>
<a id=__codelineno-13-11 name=__codelineno-13-11 href=#__codelineno-13-11></a><span class=p>)</span>
</code></pre></div> <p>（2）创建service/init.go文件，初始化k8s client</p> <div class=highlight><pre><span></span><code><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=kn>package</span><span class=w> </span><span class=nx>service</span>
<a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a>
<a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a><span class=kn>import</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a><span class=s>&quot;gitee.com/k8s-platform/config&quot;</span>
<a id=__codelineno-14-5 name=__codelineno-14-5 href=#__codelineno-14-5></a>
<a id=__codelineno-14-6 name=__codelineno-14-6 href=#__codelineno-14-6></a><span class=s>&quot;github.com/wonderivan/logger&quot;</span>
<a id=__codelineno-14-7 name=__codelineno-14-7 href=#__codelineno-14-7></a><span class=s>&quot;k8s.io/client-go/kubernetes&quot;</span>
<a id=__codelineno-14-8 name=__codelineno-14-8 href=#__codelineno-14-8></a><span class=s>&quot;k8s.io/client-go/tools/clientcmd&quot;</span>
<a id=__codelineno-14-9 name=__codelineno-14-9 href=#__codelineno-14-9></a><span class=p>)</span>
<a id=__codelineno-14-10 name=__codelineno-14-10 href=#__codelineno-14-10></a>
<a id=__codelineno-14-11 name=__codelineno-14-11 href=#__codelineno-14-11></a><span class=kd>type</span><span class=w> </span><span class=nx>k8s</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-14-12 name=__codelineno-14-12 href=#__codelineno-14-12></a><span class=nx>ClientSet</span><span class=w> </span><span class=o>*</span><span class=nx>kubernetes</span><span class=p>.</span><span class=nx>Clientset</span>
<a id=__codelineno-14-13 name=__codelineno-14-13 href=#__codelineno-14-13></a><span class=p>}</span>
<a id=__codelineno-14-14 name=__codelineno-14-14 href=#__codelineno-14-14></a>
<a id=__codelineno-14-15 name=__codelineno-14-15 href=#__codelineno-14-15></a><span class=kd>var</span><span class=w> </span><span class=nx>K8s</span><span class=w> </span><span class=nx>k8s</span>
<a id=__codelineno-14-16 name=__codelineno-14-16 href=#__codelineno-14-16></a>
<a id=__codelineno-14-17 name=__codelineno-14-17 href=#__codelineno-14-17></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>k</span><span class=w> </span><span class=o>*</span><span class=nx>k8s</span><span class=p>)</span><span class=w> </span><span class=nx>Init</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-14-18 name=__codelineno-14-18 href=#__codelineno-14-18></a><span class=nx>conf</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>clientcmd</span><span class=p>.</span><span class=nx>BuildConfigFromFlags</span><span class=p>(</span><span class=s>&quot;&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>config</span><span class=p>.</span><span class=nx>Kubeconfig</span><span class=p>)</span>
<a id=__codelineno-14-19 name=__codelineno-14-19 href=#__codelineno-14-19></a><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-14-20 name=__codelineno-14-20 href=#__codelineno-14-20></a><span class=w>  </span><span class=nb>panic</span><span class=p>(</span><span class=s>&quot;创建k8s配置失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-14-21 name=__codelineno-14-21 href=#__codelineno-14-21></a><span class=p>}</span>
<a id=__codelineno-14-22 name=__codelineno-14-22 href=#__codelineno-14-22></a><span class=nx>clientSet</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>kubernetes</span><span class=p>.</span><span class=nx>NewForConfig</span><span class=p>(</span><span class=nx>conf</span><span class=p>)</span>
<a id=__codelineno-14-23 name=__codelineno-14-23 href=#__codelineno-14-23></a><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-14-24 name=__codelineno-14-24 href=#__codelineno-14-24></a><span class=w>  </span><span class=nb>panic</span><span class=p>(</span><span class=s>&quot;创建K8s clientSet失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-14-25 name=__codelineno-14-25 href=#__codelineno-14-25></a><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-14-26 name=__codelineno-14-26 href=#__codelineno-14-26></a><span class=w>  </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Info</span><span class=p>(</span><span class=s>&quot;创建k8s clientSet成功&quot;</span><span class=p>)</span>
<a id=__codelineno-14-27 name=__codelineno-14-27 href=#__codelineno-14-27></a><span class=p>}</span>
<a id=__codelineno-14-28 name=__codelineno-14-28 href=#__codelineno-14-28></a><span class=nx>k</span><span class=p>.</span><span class=nx>ClientSet</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>clientSet</span>
<a id=__codelineno-14-29 name=__codelineno-14-29 href=#__codelineno-14-29></a><span class=p>}</span>
</code></pre></div> <p>（3）main.go中添加k8s client启动项</p> <div class=highlight><pre><span></span><code><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a><span class=kn>package</span><span class=w> </span><span class=nx>main</span>
<a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a>
<a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a><span class=kn>import</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a><span class=s>&quot;gitee.com/k8s-platform/config&quot;</span>
<a id=__codelineno-15-5 name=__codelineno-15-5 href=#__codelineno-15-5></a><span class=s>&quot;gitee.com/k8s-platform/controller&quot;</span>
<a id=__codelineno-15-6 name=__codelineno-15-6 href=#__codelineno-15-6></a><span class=s>&quot;gitee.com/k8s-platform/service&quot;</span>
<a id=__codelineno-15-7 name=__codelineno-15-7 href=#__codelineno-15-7></a>
<a id=__codelineno-15-8 name=__codelineno-15-8 href=#__codelineno-15-8></a><span class=s>&quot;github.com/gin-gonic/gin&quot;</span>
<a id=__codelineno-15-9 name=__codelineno-15-9 href=#__codelineno-15-9></a><span class=p>)</span>
<a id=__codelineno-15-10 name=__codelineno-15-10 href=#__codelineno-15-10></a>
<a id=__codelineno-15-11 name=__codelineno-15-11 href=#__codelineno-15-11></a><span class=kd>func</span><span class=w> </span><span class=nx>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-15-12 name=__codelineno-15-12 href=#__codelineno-15-12></a><span class=c1>//初始化gin对象</span>
<a id=__codelineno-15-13 name=__codelineno-15-13 href=#__codelineno-15-13></a><span class=nx>r</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>Default</span><span class=p>()</span>
<a id=__codelineno-15-14 name=__codelineno-15-14 href=#__codelineno-15-14></a><span class=c1>//初始化k8s client</span>
<a id=__codelineno-15-15 name=__codelineno-15-15 href=#__codelineno-15-15></a><span class=nx>service</span><span class=p>.</span><span class=nx>K8s</span><span class=p>.</span><span class=nx>Init</span><span class=p>()</span>
<a id=__codelineno-15-16 name=__codelineno-15-16 href=#__codelineno-15-16></a><span class=c1>//初始化路由规则</span>
<a id=__codelineno-15-17 name=__codelineno-15-17 href=#__codelineno-15-17></a><span class=nx>controller</span><span class=p>.</span><span class=nx>Router</span><span class=p>.</span><span class=nx>InitApiRouter</span><span class=p>(</span><span class=nx>r</span><span class=p>)</span>
<a id=__codelineno-15-18 name=__codelineno-15-18 href=#__codelineno-15-18></a><span class=c1>//gin程序启动</span>
<a id=__codelineno-15-19 name=__codelineno-15-19 href=#__codelineno-15-19></a><span class=nx>r</span><span class=p>.</span><span class=nx>Run</span><span class=p>(</span><span class=nx>config</span><span class=p>.</span><span class=nx>ListenAddr</span><span class=p>)</span>
<a id=__codelineno-15-20 name=__codelineno-15-20 href=#__codelineno-15-20></a><span class=p>}</span>
</code></pre></div> <h3 id=4-测试api接口>4. 测试API接口<a class=headerlink href=#4-测试api接口 title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a>curl<span class=w> </span>http://127.0.0.1:9090/testapi
<a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a><span class=o>{</span><span class=s2>&quot;data&quot;</span>:null,<span class=s2>&quot;msg&quot;</span>:<span class=s2>&quot;testapi success!&quot;</span><span class=o>}</span><span class=w>    </span>
</code></pre></div> <h2 id=7-api开发>7. API开发<a class=headerlink href=#7-api开发 title="Permanent link">&para;</a></h2> <h3 id=1-开发响应流程>1. 开发&amp;响应流程<a class=headerlink href=#1-开发响应流程 title="Permanent link">&para;</a></h3> <p><img alt=1700452058796 class=zoom src=https://cdn.jsdelivr.net/gh/hujianli94/Picgo-atlas@main/img/1700452058796.77vrr972us00.png></p> <ol> <li>Model层：实体层 &gt;&gt; 表数据与类的映射关系，这里的类是strcut </li> <li>Dao层：持久层/数据访问层 &gt;&gt; 主要与数据库交互，增删改查</li> <li>Service层：业务层 &gt;&gt; 控制业务逻辑，主要处理业务模块的功能逻辑</li> <li>Controller层：控制层 &gt;&gt; 接收请求参数，调用不同的Service层代码来控制业务流程</li> </ol> <p><img alt=1700458875460 class=zoom src=https://cdn.jsdelivr.net/gh/hujianli94/Picgo-atlas@main/img/1700458875460.3ok9s1egqvk0.webp></p> <h3 id=2-工作负载>2. 工作负载<a class=headerlink href=#2-工作负载 title="Permanent link">&para;</a></h3> <h4 id=21-数组的排序过滤分页>2.1 数组的排序、过滤、分页<a class=headerlink href=#21-数组的排序过滤分页 title="Permanent link">&para;</a></h4> <p><code>service/dataselector.go</code></p> <p>(1)定义数据结构</p> <div class=highlight><pre><span></span><code><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a><span class=kn>package</span><span class=w> </span><span class=nx>service</span>
<a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a>
<a id=__codelineno-17-3 name=__codelineno-17-3 href=#__codelineno-17-3></a><span class=kn>import</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-17-4 name=__codelineno-17-4 href=#__codelineno-17-4></a><span class=w>    </span><span class=nx>corev1</span><span class=w> </span><span class=s>&quot;k8s.io/api/core/v1&quot;</span>
<a id=__codelineno-17-5 name=__codelineno-17-5 href=#__codelineno-17-5></a><span class=w>    </span><span class=s>&quot;sort&quot;</span>
<a id=__codelineno-17-6 name=__codelineno-17-6 href=#__codelineno-17-6></a><span class=w>    </span><span class=s>&quot;strings&quot;</span>
<a id=__codelineno-17-7 name=__codelineno-17-7 href=#__codelineno-17-7></a><span class=w>    </span><span class=s>&quot;time&quot;</span>
<a id=__codelineno-17-8 name=__codelineno-17-8 href=#__codelineno-17-8></a><span class=p>)</span>
<a id=__codelineno-17-9 name=__codelineno-17-9 href=#__codelineno-17-9></a>
<a id=__codelineno-17-10 name=__codelineno-17-10 href=#__codelineno-17-10></a><span class=c1>// dataSelector 用于封装排序、过滤、分页的数据类型</span>
<a id=__codelineno-17-11 name=__codelineno-17-11 href=#__codelineno-17-11></a><span class=kd>type</span><span class=w> </span><span class=nx>dataSelector</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-17-12 name=__codelineno-17-12 href=#__codelineno-17-12></a><span class=w>    </span><span class=nx>GenericDataList</span><span class=w> </span><span class=p>[]</span><span class=nx>DataCell</span>
<a id=__codelineno-17-13 name=__codelineno-17-13 href=#__codelineno-17-13></a><span class=w>    </span><span class=nx>dataSelectQuery</span><span class=w> </span><span class=o>*</span><span class=nx>DataSelectQuery</span>
<a id=__codelineno-17-14 name=__codelineno-17-14 href=#__codelineno-17-14></a><span class=p>}</span>
<a id=__codelineno-17-15 name=__codelineno-17-15 href=#__codelineno-17-15></a>
<a id=__codelineno-17-16 name=__codelineno-17-16 href=#__codelineno-17-16></a><span class=c1>// DataCell 接口，用于各种资源list的类型转换，转换后可以使用dataSelector的自定义排序方法</span>
<a id=__codelineno-17-17 name=__codelineno-17-17 href=#__codelineno-17-17></a><span class=kd>type</span><span class=w> </span><span class=nx>DataCell</span><span class=w> </span><span class=kd>interface</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-17-18 name=__codelineno-17-18 href=#__codelineno-17-18></a><span class=w>    </span><span class=nx>GetCreation</span><span class=p>()</span><span class=w> </span><span class=nx>time</span><span class=p>.</span><span class=nx>Time</span>
<a id=__codelineno-17-19 name=__codelineno-17-19 href=#__codelineno-17-19></a><span class=w>    </span><span class=nx>GetName</span><span class=p>()</span><span class=w> </span><span class=kt>string</span>
<a id=__codelineno-17-20 name=__codelineno-17-20 href=#__codelineno-17-20></a><span class=p>}</span>
<a id=__codelineno-17-21 name=__codelineno-17-21 href=#__codelineno-17-21></a>
<a id=__codelineno-17-22 name=__codelineno-17-22 href=#__codelineno-17-22></a><span class=c1>// DataSelectQuery 定义过滤和分页的属性，过滤：Name，分页：Limit和Page</span>
<a id=__codelineno-17-23 name=__codelineno-17-23 href=#__codelineno-17-23></a><span class=c1>// Limit是单页的数据条数</span>
<a id=__codelineno-17-24 name=__codelineno-17-24 href=#__codelineno-17-24></a><span class=c1>// Page是第几页</span>
<a id=__codelineno-17-25 name=__codelineno-17-25 href=#__codelineno-17-25></a><span class=kd>type</span><span class=w> </span><span class=nx>DataSelectQuery</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-17-26 name=__codelineno-17-26 href=#__codelineno-17-26></a><span class=w>    </span><span class=nx>FilterQuery</span><span class=w>   </span><span class=o>*</span><span class=nx>FilterQuery</span>
<a id=__codelineno-17-27 name=__codelineno-17-27 href=#__codelineno-17-27></a><span class=w>    </span><span class=nx>PaginateQuery</span><span class=w> </span><span class=o>*</span><span class=nx>PaginateQuery</span>
<a id=__codelineno-17-28 name=__codelineno-17-28 href=#__codelineno-17-28></a><span class=p>}</span>
<a id=__codelineno-17-29 name=__codelineno-17-29 href=#__codelineno-17-29></a><span class=kd>type</span><span class=w> </span><span class=nx>FilterQuery</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-17-30 name=__codelineno-17-30 href=#__codelineno-17-30></a><span class=w>    </span><span class=nx>Name</span><span class=w> </span><span class=kt>string</span>
<a id=__codelineno-17-31 name=__codelineno-17-31 href=#__codelineno-17-31></a><span class=p>}</span>
<a id=__codelineno-17-32 name=__codelineno-17-32 href=#__codelineno-17-32></a><span class=kd>type</span><span class=w> </span><span class=nx>PaginateQuery</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-17-33 name=__codelineno-17-33 href=#__codelineno-17-33></a><span class=w>    </span><span class=nx>Limit</span><span class=w> </span><span class=kt>int</span>
<a id=__codelineno-17-34 name=__codelineno-17-34 href=#__codelineno-17-34></a><span class=w>    </span><span class=nx>Page</span><span class=w>  </span><span class=kt>int</span>
<a id=__codelineno-17-35 name=__codelineno-17-35 href=#__codelineno-17-35></a><span class=p>}</span>
</code></pre></div> <p>(2)排序</p> <p>自定义类型排序参考文档：<a href=https://segmentfault.com/a/1190000008062661>https://segmentfault.com/a/1190000008062661</a></p> <div class=highlight><pre><span></span><code><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a><span class=c1>//实现自定义结构的排序，需要重写Len、Swap、Less方法</span>
<a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a><span class=c1>//Len方法用于获取数组长度</span>
<a id=__codelineno-18-3 name=__codelineno-18-3 href=#__codelineno-18-3></a><span class=kd>func</span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>dataSelector</span><span class=p>)</span><span class=nx>Len</span><span class=p>()</span><span class=kt>int</span><span class=p>{</span>
<a id=__codelineno-18-4 name=__codelineno-18-4 href=#__codelineno-18-4></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>d</span><span class=p>.</span><span class=nx>GenericDataList</span><span class=p>)</span>
<a id=__codelineno-18-5 name=__codelineno-18-5 href=#__codelineno-18-5></a><span class=p>}</span>
<a id=__codelineno-18-6 name=__codelineno-18-6 href=#__codelineno-18-6></a><span class=c1>//Swap方法用于数组中的元素在比较大小后的位置交换，可定义升序或降序</span>
<a id=__codelineno-18-7 name=__codelineno-18-7 href=#__codelineno-18-7></a><span class=kd>func</span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>dataSelector</span><span class=p>)</span><span class=nx>Swap</span><span class=p>(</span><span class=nx>i</span><span class=p>,</span><span class=nx>j</span><span class=w> </span><span class=kt>int</span><span class=p>){</span>
<a id=__codelineno-18-8 name=__codelineno-18-8 href=#__codelineno-18-8></a><span class=w>    </span><span class=nx>d</span><span class=p>.</span><span class=nx>GenericDataList</span><span class=p>[</span><span class=nx>i</span><span class=p>],</span><span class=nx>d</span><span class=p>.</span><span class=nx>GenericDataList</span><span class=p>[</span><span class=nx>j</span><span class=p>]=</span><span class=nx>d</span><span class=p>.</span><span class=nx>GenericDataList</span><span class=p>[</span><span class=nx>j</span><span class=p>],</span><span class=nx>d</span><span class=p>.</span><span class=nx>GenericDataList</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span>
<a id=__codelineno-18-9 name=__codelineno-18-9 href=#__codelineno-18-9></a><span class=p>}</span>
<a id=__codelineno-18-10 name=__codelineno-18-10 href=#__codelineno-18-10></a><span class=c1>//Less方法用于定义数组中元素排序的“大小”的比较方式</span>
<a id=__codelineno-18-11 name=__codelineno-18-11 href=#__codelineno-18-11></a><span class=kd>func</span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>dataSelector</span><span class=p>)</span><span class=nx>Less</span><span class=p>(</span><span class=nx>i</span><span class=p>,</span><span class=nx>j</span><span class=w> </span><span class=kt>int</span><span class=p>)</span><span class=kt>bool</span><span class=p>{</span>
<a id=__codelineno-18-12 name=__codelineno-18-12 href=#__codelineno-18-12></a><span class=w>    </span><span class=nx>a</span><span class=o>:=</span><span class=nx>d</span><span class=p>.</span><span class=nx>GenericDataList</span><span class=p>[</span><span class=nx>i</span><span class=p>].</span><span class=nx>GetCreation</span><span class=p>()</span>
<a id=__codelineno-18-13 name=__codelineno-18-13 href=#__codelineno-18-13></a><span class=w>    </span><span class=nx>b</span><span class=o>:=</span><span class=nx>d</span><span class=p>.</span><span class=nx>GenericDataList</span><span class=p>[</span><span class=nx>j</span><span class=p>].</span><span class=nx>GetCreation</span><span class=p>()</span>
<a id=__codelineno-18-14 name=__codelineno-18-14 href=#__codelineno-18-14></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>b</span><span class=p>.</span><span class=nx>Before</span><span class=p>(</span><span class=nx>a</span><span class=p>)</span>
<a id=__codelineno-18-15 name=__codelineno-18-15 href=#__codelineno-18-15></a><span class=p>}</span>
<a id=__codelineno-18-16 name=__codelineno-18-16 href=#__codelineno-18-16></a><span class=c1>//重写以上3个方法使用sort.Sort进行排序</span>
<a id=__codelineno-18-17 name=__codelineno-18-17 href=#__codelineno-18-17></a><span class=kd>func</span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>dataSelector</span><span class=p>)</span><span class=nx>Sort</span><span class=p>()</span><span class=w> </span><span class=o>*</span><span class=nx>dataSelector</span><span class=p>{</span>
<a id=__codelineno-18-18 name=__codelineno-18-18 href=#__codelineno-18-18></a><span class=w>    </span><span class=nx>sort</span><span class=p>.</span><span class=nx>Sort</span><span class=p>(</span><span class=nx>d</span><span class=p>)</span>
<a id=__codelineno-18-19 name=__codelineno-18-19 href=#__codelineno-18-19></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>d</span>
<a id=__codelineno-18-20 name=__codelineno-18-20 href=#__codelineno-18-20></a><span class=p>}</span>
</code></pre></div> <p>(3)过滤</p> <div class=highlight><pre><span></span><code><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a><span class=c1>//Filter方法用于过滤元素，比较元素的Name属性，若包含，再返回</span>
<a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>dataSelector</span><span class=p>)</span><span class=w> </span><span class=nx>Filter</span><span class=p>()</span><span class=w> </span><span class=o>*</span><span class=nx>dataSelector</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a><span class=w>    </span><span class=c1>//若Name的传参为空，则返回所有元素</span>
<a id=__codelineno-19-4 name=__codelineno-19-4 href=#__codelineno-19-4></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>d</span><span class=p>.</span><span class=nx>dataSelectQuery</span><span class=p>.</span><span class=nx>FilterQuery</span><span class=p>.</span><span class=nx>Name</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&quot;&quot;</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-19-5 name=__codelineno-19-5 href=#__codelineno-19-5></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>d</span>
<a id=__codelineno-19-6 name=__codelineno-19-6 href=#__codelineno-19-6></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-19-7 name=__codelineno-19-7 href=#__codelineno-19-7></a><span class=w>    </span><span class=c1>//若Name的传参不为空，则返回元素名中包含Name的所有元素</span>
<a id=__codelineno-19-8 name=__codelineno-19-8 href=#__codelineno-19-8></a><span class=w>    </span><span class=nx>filteredList</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=p>[]</span><span class=nx>DataCell</span><span class=p>{}</span>
<a id=__codelineno-19-9 name=__codelineno-19-9 href=#__codelineno-19-9></a><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>value</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>d</span><span class=p>.</span><span class=nx>GenericDataList</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-19-10 name=__codelineno-19-10 href=#__codelineno-19-10></a><span class=w>        </span><span class=nx>matches</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kc>true</span>
<a id=__codelineno-19-11 name=__codelineno-19-11 href=#__codelineno-19-11></a><span class=w>        </span><span class=nx>objName</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>value</span><span class=p>.</span><span class=nx>GetName</span><span class=p>()</span>
<a id=__codelineno-19-12 name=__codelineno-19-12 href=#__codelineno-19-12></a><span class=w>        </span><span class=c1>//判断字符串s中是否包含子串str</span>
<a id=__codelineno-19-13 name=__codelineno-19-13 href=#__codelineno-19-13></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>!</span><span class=nx>strings</span><span class=p>.</span><span class=nx>Contains</span><span class=p>(</span><span class=nx>objName</span><span class=p>,</span><span class=w> </span><span class=nx>d</span><span class=p>.</span><span class=nx>dataSelectQuery</span><span class=p>.</span><span class=nx>FilterQuery</span><span class=p>.</span><span class=nx>Name</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-19-14 name=__codelineno-19-14 href=#__codelineno-19-14></a><span class=w>            </span><span class=nx>matches</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=kc>false</span>
<a id=__codelineno-19-15 name=__codelineno-19-15 href=#__codelineno-19-15></a><span class=w>            </span><span class=k>continue</span>
<a id=__codelineno-19-16 name=__codelineno-19-16 href=#__codelineno-19-16></a><span class=w>        </span><span class=p>}</span>
<a id=__codelineno-19-17 name=__codelineno-19-17 href=#__codelineno-19-17></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=nx>matches</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-19-18 name=__codelineno-19-18 href=#__codelineno-19-18></a><span class=w>            </span><span class=nx>filteredList</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nb>append</span><span class=p>(</span><span class=nx>filteredList</span><span class=p>,</span><span class=w> </span><span class=nx>value</span><span class=p>)</span>
<a id=__codelineno-19-19 name=__codelineno-19-19 href=#__codelineno-19-19></a><span class=w>        </span><span class=p>}</span>
<a id=__codelineno-19-20 name=__codelineno-19-20 href=#__codelineno-19-20></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-19-21 name=__codelineno-19-21 href=#__codelineno-19-21></a><span class=w>    </span><span class=nx>d</span><span class=p>.</span><span class=nx>GenericDataList</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>filteredList</span>
<a id=__codelineno-19-22 name=__codelineno-19-22 href=#__codelineno-19-22></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>d</span>
<a id=__codelineno-19-23 name=__codelineno-19-23 href=#__codelineno-19-23></a><span class=p>}</span>
</code></pre></div> <p>(4)分页</p> <div class=highlight><pre><span></span><code><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a><span class=c1>//Paginate方法用于数组分页，根据Limit和Page的传参，返回数据</span>
<a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>dataSelector</span><span class=p>)</span><span class=w> </span><span class=nx>Paginate</span><span class=p>()</span><span class=w> </span><span class=o>*</span><span class=nx>dataSelector</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-20-3 name=__codelineno-20-3 href=#__codelineno-20-3></a><span class=w>    </span><span class=nx>limit</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>d</span><span class=p>.</span><span class=nx>dataSelectQuery</span><span class=p>.</span><span class=nx>PaginateQuery</span><span class=p>.</span><span class=nx>Limit</span>
<a id=__codelineno-20-4 name=__codelineno-20-4 href=#__codelineno-20-4></a><span class=w>    </span><span class=nx>page</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>d</span><span class=p>.</span><span class=nx>dataSelectQuery</span><span class=p>.</span><span class=nx>PaginateQuery</span><span class=p>.</span><span class=nx>Page</span>
<a id=__codelineno-20-5 name=__codelineno-20-5 href=#__codelineno-20-5></a><span class=w>    </span><span class=c1>//验证参数合法，若参数不合法，则返回所有数据</span>
<a id=__codelineno-20-6 name=__codelineno-20-6 href=#__codelineno-20-6></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>limit</span><span class=w> </span><span class=o>&lt;=</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=nx>page</span><span class=w> </span><span class=o>&lt;=</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-20-7 name=__codelineno-20-7 href=#__codelineno-20-7></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>d</span>
<a id=__codelineno-20-8 name=__codelineno-20-8 href=#__codelineno-20-8></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-20-9 name=__codelineno-20-9 href=#__codelineno-20-9></a><span class=w>    </span><span class=c1>//定义取数范围</span>
<a id=__codelineno-20-10 name=__codelineno-20-10 href=#__codelineno-20-10></a><span class=w>    </span><span class=c1>//举例：25个元素的数组，limit是10，page是3，startIndex是20，endIndex是30（实际上endIndex是25）</span>
<a id=__codelineno-20-11 name=__codelineno-20-11 href=#__codelineno-20-11></a><span class=w>    </span><span class=nx>startIndex</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>limit</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=p>(</span><span class=nx>page</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mi>1</span><span class=p>)</span>
<a id=__codelineno-20-12 name=__codelineno-20-12 href=#__codelineno-20-12></a><span class=w>    </span><span class=nx>endIndex</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>limit</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=nx>page</span>
<a id=__codelineno-20-13 name=__codelineno-20-13 href=#__codelineno-20-13></a><span class=w>    </span><span class=c1>//处理最后一页，这时候就把endIndex由30改为25了</span>
<a id=__codelineno-20-14 name=__codelineno-20-14 href=#__codelineno-20-14></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>d</span><span class=p>.</span><span class=nx>GenericDataList</span><span class=p>)</span><span class=w> </span><span class=p>&lt;</span><span class=w> </span><span class=nx>endIndex</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-20-15 name=__codelineno-20-15 href=#__codelineno-20-15></a><span class=w>        </span><span class=nx>endIndex</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>d</span><span class=p>.</span><span class=nx>GenericDataList</span><span class=p>)</span>
<a id=__codelineno-20-16 name=__codelineno-20-16 href=#__codelineno-20-16></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-20-17 name=__codelineno-20-17 href=#__codelineno-20-17></a><span class=w>    </span><span class=nx>d</span><span class=p>.</span><span class=nx>GenericDataList</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>d</span><span class=p>.</span><span class=nx>GenericDataList</span><span class=p>[</span><span class=nx>startIndex</span><span class=p>:</span><span class=nx>endIndex</span><span class=p>]</span>
<a id=__codelineno-20-18 name=__codelineno-20-18 href=#__codelineno-20-18></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>d</span>
<a id=__codelineno-20-19 name=__codelineno-20-19 href=#__codelineno-20-19></a><span class=p>}</span>
</code></pre></div> <p>(5)定义podCell类型，实现DataCell接口，用于类型转换</p> <div class=highlight><pre><span></span><code><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a><span class=c1>//定义podCell类型，实现GetCreation和getName方法后，可进行类型转换</span>
<a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a><span class=kd>type</span><span class=w> </span><span class=nx>podCell</span><span class=w> </span><span class=nx>corev1</span><span class=p>.</span><span class=nx>Pod</span>
<a id=__codelineno-21-3 name=__codelineno-21-3 href=#__codelineno-21-3></a>
<a id=__codelineno-21-4 name=__codelineno-21-4 href=#__codelineno-21-4></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=nx>podCell</span><span class=p>)</span><span class=w> </span><span class=nx>GetCreation</span><span class=p>()</span><span class=w> </span><span class=nx>time</span><span class=p>.</span><span class=nx>Time</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-21-5 name=__codelineno-21-5 href=#__codelineno-21-5></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>p</span><span class=p>.</span><span class=nx>CreationTimestamp</span><span class=p>.</span><span class=nx>Time</span>
<a id=__codelineno-21-6 name=__codelineno-21-6 href=#__codelineno-21-6></a><span class=p>}</span>
<a id=__codelineno-21-7 name=__codelineno-21-7 href=#__codelineno-21-7></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=nx>podCell</span><span class=p>)</span><span class=w> </span><span class=nx>GetName</span><span class=p>()</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-21-8 name=__codelineno-21-8 href=#__codelineno-21-8></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>p</span><span class=p>.</span><span class=nx>Name</span>
<a id=__codelineno-21-9 name=__codelineno-21-9 href=#__codelineno-21-9></a><span class=p>}</span>
</code></pre></div> <p>(6)定义DataCell到Pod类型转换的方法</p> <p>断言：判断一个变量是否属于某一种类型，前提是这一类型实现了这一变量类型接口</p> <p><code>service/pod.go</code></p> <div class=highlight><pre><span></span><code><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a><span class=kn>package</span><span class=w> </span><span class=nx>service</span>
<a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a>
<a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a><span class=kn>import</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-22-4 name=__codelineno-22-4 href=#__codelineno-22-4></a><span class=w>    </span><span class=s>&quot;bytes&quot;</span>
<a id=__codelineno-22-5 name=__codelineno-22-5 href=#__codelineno-22-5></a><span class=w>    </span><span class=s>&quot;context&quot;</span>
<a id=__codelineno-22-6 name=__codelineno-22-6 href=#__codelineno-22-6></a><span class=w>    </span><span class=s>&quot;encoding/json&quot;</span>
<a id=__codelineno-22-7 name=__codelineno-22-7 href=#__codelineno-22-7></a><span class=w>    </span><span class=s>&quot;errors&quot;</span>
<a id=__codelineno-22-8 name=__codelineno-22-8 href=#__codelineno-22-8></a><span class=w>    </span><span class=s>&quot;gitee.com/k8s-platform/config&quot;</span>
<a id=__codelineno-22-9 name=__codelineno-22-9 href=#__codelineno-22-9></a><span class=w>    </span><span class=s>&quot;github.com/wonderivan/logger&quot;</span>
<a id=__codelineno-22-10 name=__codelineno-22-10 href=#__codelineno-22-10></a><span class=w>    </span><span class=s>&quot;io&quot;</span>
<a id=__codelineno-22-11 name=__codelineno-22-11 href=#__codelineno-22-11></a><span class=w>    </span><span class=nx>corev1</span><span class=w> </span><span class=s>&quot;k8s.io/api/core/v1&quot;</span>
<a id=__codelineno-22-12 name=__codelineno-22-12 href=#__codelineno-22-12></a><span class=w>    </span><span class=nx>metav1</span><span class=w> </span><span class=s>&quot;k8s.io/apimachinery/pkg/apis/meta/v1&quot;</span>
<a id=__codelineno-22-13 name=__codelineno-22-13 href=#__codelineno-22-13></a><span class=p>)</span>
<a id=__codelineno-22-14 name=__codelineno-22-14 href=#__codelineno-22-14></a>
<a id=__codelineno-22-15 name=__codelineno-22-15 href=#__codelineno-22-15></a><span class=c1>// Pod 定义pod类型和Pod对象，用于包外的调用(包是指service目录)，例如Controller</span>
<a id=__codelineno-22-16 name=__codelineno-22-16 href=#__codelineno-22-16></a><span class=kd>var</span><span class=w> </span><span class=nx>Pod</span><span class=w> </span><span class=nx>pod</span>
<a id=__codelineno-22-17 name=__codelineno-22-17 href=#__codelineno-22-17></a>
<a id=__codelineno-22-18 name=__codelineno-22-18 href=#__codelineno-22-18></a><span class=kd>type</span><span class=w> </span><span class=nx>pod</span><span class=w> </span><span class=kd>struct</span><span class=p>{}</span>
<a id=__codelineno-22-19 name=__codelineno-22-19 href=#__codelineno-22-19></a>
<a id=__codelineno-22-20 name=__codelineno-22-20 href=#__codelineno-22-20></a><span class=c1>// toCells方法用于将pod类型数组，转换成DataCell类型数组</span>
<a id=__codelineno-22-21 name=__codelineno-22-21 href=#__codelineno-22-21></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=o>*</span><span class=nx>pod</span><span class=p>)</span><span class=w> </span><span class=nx>toCells</span><span class=p>(</span><span class=nx>std</span><span class=w> </span><span class=p>[]</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>Pod</span><span class=p>)</span><span class=w> </span><span class=p>[]</span><span class=nx>DataCell</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-22-22 name=__codelineno-22-22 href=#__codelineno-22-22></a><span class=w>    </span><span class=nx>cells</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>make</span><span class=p>([]</span><span class=nx>DataCell</span><span class=p>,</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>std</span><span class=p>))</span>
<a id=__codelineno-22-23 name=__codelineno-22-23 href=#__codelineno-22-23></a><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=nx>i</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>std</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-22-24 name=__codelineno-22-24 href=#__codelineno-22-24></a><span class=w>        </span><span class=nx>cells</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>podCell</span><span class=p>(</span><span class=nx>std</span><span class=p>[</span><span class=nx>i</span><span class=p>])</span>
<a id=__codelineno-22-25 name=__codelineno-22-25 href=#__codelineno-22-25></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-22-26 name=__codelineno-22-26 href=#__codelineno-22-26></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>cells</span>
<a id=__codelineno-22-27 name=__codelineno-22-27 href=#__codelineno-22-27></a><span class=p>}</span>
<a id=__codelineno-22-28 name=__codelineno-22-28 href=#__codelineno-22-28></a>
<a id=__codelineno-22-29 name=__codelineno-22-29 href=#__codelineno-22-29></a><span class=c1>// fromCells方法用于将DataCell类型数组，转换成pod类型数组</span>
<a id=__codelineno-22-30 name=__codelineno-22-30 href=#__codelineno-22-30></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=o>*</span><span class=nx>pod</span><span class=p>)</span><span class=w> </span><span class=nx>fromCells</span><span class=p>(</span><span class=nx>cells</span><span class=w> </span><span class=p>[]</span><span class=nx>DataCell</span><span class=p>)</span><span class=w> </span><span class=p>[]</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>Pod</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-22-31 name=__codelineno-22-31 href=#__codelineno-22-31></a><span class=w>    </span><span class=nx>pods</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>make</span><span class=p>([]</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>Pod</span><span class=p>,</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>cells</span><span class=p>))</span>
<a id=__codelineno-22-32 name=__codelineno-22-32 href=#__codelineno-22-32></a><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=nx>i</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>cells</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-22-33 name=__codelineno-22-33 href=#__codelineno-22-33></a><span class=w>        </span><span class=c1>//cells[i].(podCell)就使用到了断言，断言后转换成了podCell类型，然后又转换成了Pod类型</span>
<a id=__codelineno-22-34 name=__codelineno-22-34 href=#__codelineno-22-34></a><span class=w>        </span><span class=nx>pods</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>corev1</span><span class=p>.</span><span class=nx>Pod</span><span class=p>(</span><span class=nx>cells</span><span class=p>[</span><span class=nx>i</span><span class=p>].(</span><span class=nx>podCell</span><span class=p>))</span>
<a id=__codelineno-22-35 name=__codelineno-22-35 href=#__codelineno-22-35></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-22-36 name=__codelineno-22-36 href=#__codelineno-22-36></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>pods</span>
<a id=__codelineno-22-37 name=__codelineno-22-37 href=#__codelineno-22-37></a><span class=p>}</span>
</code></pre></div> <h4 id=22-pod>2.2 Pod<a class=headerlink href=#22-pod title="Permanent link">&para;</a></h4> <p>开发 pod 功能</p> <table> <thead> <tr> <th>功能</th> <th>是否实现</th> </tr> </thead> <tbody> <tr> <td>获取所有pod信息</td> <td>√</td> </tr> <tr> <td>获取pod的详细信息</td> <td>√</td> </tr> <tr> <td>删除pod</td> <td>√</td> </tr> <tr> <td>更新pod</td> <td>√</td> </tr> <tr> <td>获取pod容器名称</td> <td>√</td> </tr> <tr> <td>获取pod中容器日志</td> <td>√</td> </tr> <tr> <td>获取每个namespace的pod数量</td> <td>√</td> </tr> </tbody> </table> <p><code>service/pod.go</code></p> <p>(1)定义数据类型</p> <p>看情况创建结构体</p> <div class=highlight><pre><span></span><code><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a><span class=c1>//定义列表的返回内容，Item是pod元素列表，Total为pod元素数量</span>
<a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a><span class=kd>type</span><span class=w> </span><span class=nx>PodsResp</span><span class=w> </span><span class=kd>struct</span><span class=p>{</span>
<a id=__codelineno-23-3 name=__codelineno-23-3 href=#__codelineno-23-3></a><span class=w>    </span><span class=nx>Items</span><span class=w> </span><span class=p>[]</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>Pod</span><span class=w> </span><span class=s>`json:&quot;items&quot;`</span>
<a id=__codelineno-23-4 name=__codelineno-23-4 href=#__codelineno-23-4></a><span class=w>    </span><span class=nx>Total</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=s>`json:&quot;total&quot;`</span>
<a id=__codelineno-23-5 name=__codelineno-23-5 href=#__codelineno-23-5></a><span class=p>}</span>
<a id=__codelineno-23-6 name=__codelineno-23-6 href=#__codelineno-23-6></a><span class=c1>//定义PodsNp类型，用于返回namespace中pod的数量</span>
<a id=__codelineno-23-7 name=__codelineno-23-7 href=#__codelineno-23-7></a><span class=kd>type</span><span class=w> </span><span class=nx>PodsNp</span><span class=w> </span><span class=kd>struct</span><span class=p>{</span>
<a id=__codelineno-23-8 name=__codelineno-23-8 href=#__codelineno-23-8></a><span class=w>    </span><span class=nx>Namespace</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;namespace&quot;`</span>
<a id=__codelineno-23-9 name=__codelineno-23-9 href=#__codelineno-23-9></a><span class=w>    </span><span class=nx>PodNum</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=s>`json:&quot;pod_num&quot;`</span>
<a id=__codelineno-23-10 name=__codelineno-23-10 href=#__codelineno-23-10></a><span class=p>}</span>
</code></pre></div> <p>(2)获取pod列表</p> <div class=highlight><pre><span></span><code><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a><span class=c1>// GetPods 获取pod列表，支持过滤、排序、分页</span>
<a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=o>*</span><span class=nx>pod</span><span class=p>)</span><span class=w> </span><span class=nx>GetPods</span><span class=p>(</span><span class=nx>filterName</span><span class=p>,</span><span class=w> </span><span class=nx>namespace</span><span class=w> </span><span class=kt>string</span><span class=p>,</span><span class=w> </span><span class=nx>limit</span><span class=p>,</span><span class=w> </span><span class=nx>page</span><span class=w> </span><span class=kt>int</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>podsResp</span><span class=w> </span><span class=o>*</span><span class=nx>PodsResp</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-24-3 name=__codelineno-24-3 href=#__codelineno-24-3></a><span class=w>    </span><span class=c1>//获取podList类型的pod列表</span>
<a id=__codelineno-24-4 name=__codelineno-24-4 href=#__codelineno-24-4></a><span class=w>    </span><span class=c1>//context.TODO() 用于声明一个空的context上下文，用于List方法内设置这个请求的超时(3)，这里的常用用法</span>
<a id=__codelineno-24-5 name=__codelineno-24-5 href=#__codelineno-24-5></a><span class=w>    </span><span class=c1>//metav1.ListOptions{}用于过滤List数据，如使用label，field等</span>
<a id=__codelineno-24-6 name=__codelineno-24-6 href=#__codelineno-24-6></a><span class=w>    </span><span class=c1>//kubectl get services --all-namespace --field-seletor metadata.namespace != default</span>
<a id=__codelineno-24-7 name=__codelineno-24-7 href=#__codelineno-24-7></a><span class=w>    </span><span class=nx>podList</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>CoreV1</span><span class=p>().</span><span class=nx>Pods</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span><span class=nx>List</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span>
<a id=__codelineno-24-8 name=__codelineno-24-8 href=#__codelineno-24-8></a><span class=w>        </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>ListOptions</span><span class=p>{})</span>
<a id=__codelineno-24-9 name=__codelineno-24-9 href=#__codelineno-24-9></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-24-10 name=__codelineno-24-10 href=#__codelineno-24-10></a><span class=w>        </span><span class=c1>//logger用于打印日志</span>
<a id=__codelineno-24-11 name=__codelineno-24-11 href=#__codelineno-24-11></a><span class=w>        </span><span class=c1>//return用于返回response内容</span>
<a id=__codelineno-24-12 name=__codelineno-24-12 href=#__codelineno-24-12></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取Pod列表失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-24-13 name=__codelineno-24-13 href=#__codelineno-24-13></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取Pod列表失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-24-14 name=__codelineno-24-14 href=#__codelineno-24-14></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-24-15 name=__codelineno-24-15 href=#__codelineno-24-15></a><span class=w>    </span><span class=c1>//实例化dataSelector对象</span>
<a id=__codelineno-24-16 name=__codelineno-24-16 href=#__codelineno-24-16></a><span class=w>    </span><span class=nx>selectableData</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>dataSelector</span><span class=p>{</span>
<a id=__codelineno-24-17 name=__codelineno-24-17 href=#__codelineno-24-17></a><span class=w>        </span><span class=nx>GenericDataList</span><span class=p>:</span><span class=w> </span><span class=nx>p</span><span class=p>.</span><span class=nx>toCells</span><span class=p>(</span><span class=nx>podList</span><span class=p>.</span><span class=nx>Items</span><span class=p>),</span>
<a id=__codelineno-24-18 name=__codelineno-24-18 href=#__codelineno-24-18></a><span class=w>        </span><span class=nx>dataSelectQuery</span><span class=p>:</span><span class=w> </span><span class=o>&amp;</span><span class=nx>DataSelectQuery</span><span class=p>{</span>
<a id=__codelineno-24-19 name=__codelineno-24-19 href=#__codelineno-24-19></a><span class=w>            </span><span class=nx>FilterQuery</span><span class=p>:</span><span class=w> </span><span class=o>&amp;</span><span class=nx>FilterQuery</span><span class=p>{</span><span class=nx>Name</span><span class=p>:</span><span class=w> </span><span class=nx>filterName</span><span class=p>},</span>
<a id=__codelineno-24-20 name=__codelineno-24-20 href=#__codelineno-24-20></a><span class=w>            </span><span class=nx>PaginateQuery</span><span class=p>:</span><span class=w> </span><span class=o>&amp;</span><span class=nx>PaginateQuery</span><span class=p>{</span>
<a id=__codelineno-24-21 name=__codelineno-24-21 href=#__codelineno-24-21></a><span class=w>                </span><span class=nx>Limit</span><span class=p>:</span><span class=w> </span><span class=nx>limit</span><span class=p>,</span>
<a id=__codelineno-24-22 name=__codelineno-24-22 href=#__codelineno-24-22></a><span class=w>                </span><span class=nx>Page</span><span class=p>:</span><span class=w>  </span><span class=nx>page</span><span class=p>,</span>
<a id=__codelineno-24-23 name=__codelineno-24-23 href=#__codelineno-24-23></a><span class=w>            </span><span class=p>},</span>
<a id=__codelineno-24-24 name=__codelineno-24-24 href=#__codelineno-24-24></a><span class=w>        </span><span class=p>},</span>
<a id=__codelineno-24-25 name=__codelineno-24-25 href=#__codelineno-24-25></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-24-26 name=__codelineno-24-26 href=#__codelineno-24-26></a><span class=w>    </span><span class=c1>//先过滤</span>
<a id=__codelineno-24-27 name=__codelineno-24-27 href=#__codelineno-24-27></a><span class=w>    </span><span class=nx>filtered</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>selectableData</span><span class=p>.</span><span class=nx>Filter</span><span class=p>()</span>
<a id=__codelineno-24-28 name=__codelineno-24-28 href=#__codelineno-24-28></a><span class=w>    </span><span class=nx>total</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>filtered</span><span class=p>.</span><span class=nx>GenericDataList</span><span class=p>)</span>
<a id=__codelineno-24-29 name=__codelineno-24-29 href=#__codelineno-24-29></a><span class=w>    </span><span class=c1>//再排序和分页</span>
<a id=__codelineno-24-30 name=__codelineno-24-30 href=#__codelineno-24-30></a><span class=w>    </span><span class=nx>data</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>filtered</span><span class=p>.</span><span class=nx>Sort</span><span class=p>().</span><span class=nx>Paginate</span><span class=p>()</span>
<a id=__codelineno-24-31 name=__codelineno-24-31 href=#__codelineno-24-31></a><span class=w>    </span><span class=c1>//将[]DataCell类型的pod列表转为v1.pod列表</span>
<a id=__codelineno-24-32 name=__codelineno-24-32 href=#__codelineno-24-32></a><span class=w>    </span><span class=nx>pods</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>p</span><span class=p>.</span><span class=nx>fromCells</span><span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>GenericDataList</span><span class=p>)</span>
<a id=__codelineno-24-33 name=__codelineno-24-33 href=#__codelineno-24-33></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=o>&amp;</span><span class=nx>PodsResp</span><span class=p>{</span>
<a id=__codelineno-24-34 name=__codelineno-24-34 href=#__codelineno-24-34></a><span class=w>        </span><span class=nx>Items</span><span class=p>:</span><span class=w> </span><span class=nx>pods</span><span class=p>,</span>
<a id=__codelineno-24-35 name=__codelineno-24-35 href=#__codelineno-24-35></a><span class=w>        </span><span class=nx>Total</span><span class=p>:</span><span class=w> </span><span class=nx>total</span><span class=p>,</span>
<a id=__codelineno-24-36 name=__codelineno-24-36 href=#__codelineno-24-36></a><span class=w>    </span><span class=p>},</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-24-37 name=__codelineno-24-37 href=#__codelineno-24-37></a><span class=p>}</span>
</code></pre></div> <p>(3)获取Pod详情</p> <div class=highlight><pre><span></span><code><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a><span class=c1>// GetPodDetail 获取pod详情</span>
<a id=__codelineno-25-2 name=__codelineno-25-2 href=#__codelineno-25-2></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=o>*</span><span class=nx>pod</span><span class=p>)</span><span class=w> </span><span class=nx>GetPodDetail</span><span class=p>(</span><span class=nx>podName</span><span class=p>,</span><span class=w> </span><span class=nx>namespace</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>pod</span><span class=w> </span><span class=o>*</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>Pod</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-25-3 name=__codelineno-25-3 href=#__codelineno-25-3></a><span class=w>    </span><span class=nx>pod</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>CoreV1</span><span class=p>().</span><span class=nx>Pods</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span>
<a id=__codelineno-25-4 name=__codelineno-25-4 href=#__codelineno-25-4></a><span class=w>        </span><span class=nx>Get</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>podName</span><span class=p>,</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>GetOptions</span><span class=p>{})</span>
<a id=__codelineno-25-5 name=__codelineno-25-5 href=#__codelineno-25-5></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-25-6 name=__codelineno-25-6 href=#__codelineno-25-6></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取Pod详情失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-25-7 name=__codelineno-25-7 href=#__codelineno-25-7></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取Pod详情失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-25-8 name=__codelineno-25-8 href=#__codelineno-25-8></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-25-9 name=__codelineno-25-9 href=#__codelineno-25-9></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>pod</span><span class=p>,</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-25-10 name=__codelineno-25-10 href=#__codelineno-25-10></a><span class=p>}</span>
</code></pre></div> <p>(4)删除Pod</p> <div class=highlight><pre><span></span><code><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a><span class=c1>// DeletePod 删除pod</span>
<a id=__codelineno-26-2 name=__codelineno-26-2 href=#__codelineno-26-2></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=o>*</span><span class=nx>pod</span><span class=p>)</span><span class=w> </span><span class=nx>DeletePod</span><span class=p>(</span><span class=nx>podName</span><span class=p>,</span><span class=w> </span><span class=nx>namespace</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-26-3 name=__codelineno-26-3 href=#__codelineno-26-3></a><span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>CoreV1</span><span class=p>().</span><span class=nx>Pods</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span>
<a id=__codelineno-26-4 name=__codelineno-26-4 href=#__codelineno-26-4></a><span class=w>        </span><span class=nx>Delete</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>podName</span><span class=p>,</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>DeleteOptions</span><span class=p>{})</span>
<a id=__codelineno-26-5 name=__codelineno-26-5 href=#__codelineno-26-5></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-26-6 name=__codelineno-26-6 href=#__codelineno-26-6></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;删除pod失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-26-7 name=__codelineno-26-7 href=#__codelineno-26-7></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;删除pod失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-26-8 name=__codelineno-26-8 href=#__codelineno-26-8></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-26-9 name=__codelineno-26-9 href=#__codelineno-26-9></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-26-10 name=__codelineno-26-10 href=#__codelineno-26-10></a><span class=p>}</span>
</code></pre></div> <p>(5)更新pod</p> <div class=highlight><pre><span></span><code><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a><span class=c1>// UpdatePod 更新pod</span>
<a id=__codelineno-27-2 name=__codelineno-27-2 href=#__codelineno-27-2></a><span class=c1>// content参数是请求中传入的pod对象的json数据</span>
<a id=__codelineno-27-3 name=__codelineno-27-3 href=#__codelineno-27-3></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=o>*</span><span class=nx>pod</span><span class=p>)</span><span class=w> </span><span class=nx>UpdatePod</span><span class=p>(</span><span class=nx>namespace</span><span class=p>,</span><span class=w> </span><span class=nx>content</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-27-4 name=__codelineno-27-4 href=#__codelineno-27-4></a><span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=nx>pod</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>Pod</span><span class=p>{}</span>
<a id=__codelineno-27-5 name=__codelineno-27-5 href=#__codelineno-27-5></a><span class=w>    </span><span class=c1>//反序列化为pod对象</span>
<a id=__codelineno-27-6 name=__codelineno-27-6 href=#__codelineno-27-6></a><span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>json</span><span class=p>.</span><span class=nx>Unmarshal</span><span class=p>([]</span><span class=nb>byte</span><span class=p>(</span><span class=nx>content</span><span class=p>),</span><span class=w> </span><span class=nx>pod</span><span class=p>)</span>
<a id=__codelineno-27-7 name=__codelineno-27-7 href=#__codelineno-27-7></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-27-8 name=__codelineno-27-8 href=#__codelineno-27-8></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;反序列化失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-27-9 name=__codelineno-27-9 href=#__codelineno-27-9></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;反序列化失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-27-10 name=__codelineno-27-10 href=#__codelineno-27-10></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-27-11 name=__codelineno-27-11 href=#__codelineno-27-11></a><span class=w>    </span><span class=c1>//更新pod</span>
<a id=__codelineno-27-12 name=__codelineno-27-12 href=#__codelineno-27-12></a><span class=w>    </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>CoreV1</span><span class=p>().</span><span class=nx>Pods</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span>
<a id=__codelineno-27-13 name=__codelineno-27-13 href=#__codelineno-27-13></a><span class=w>        </span><span class=nx>Update</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>pod</span><span class=p>,</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>UpdateOptions</span><span class=p>{})</span>
<a id=__codelineno-27-14 name=__codelineno-27-14 href=#__codelineno-27-14></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-27-15 name=__codelineno-27-15 href=#__codelineno-27-15></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;更新Pod失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-27-16 name=__codelineno-27-16 href=#__codelineno-27-16></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;更新Pod失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-27-17 name=__codelineno-27-17 href=#__codelineno-27-17></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-27-18 name=__codelineno-27-18 href=#__codelineno-27-18></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-27-19 name=__codelineno-27-19 href=#__codelineno-27-19></a><span class=p>}</span>
</code></pre></div> <p>(6)获取Pod中的容器名</p> <div class=highlight><pre><span></span><code><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a><span class=c1>// GetPodContainer 获取Pod中的容器名</span>
<a id=__codelineno-28-2 name=__codelineno-28-2 href=#__codelineno-28-2></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=o>*</span><span class=nx>pod</span><span class=p>)</span><span class=w> </span><span class=nx>GetPodContainer</span><span class=p>(</span><span class=nx>podName</span><span class=p>,</span><span class=w> </span><span class=nx>namespace</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>containers</span><span class=w> </span><span class=p>[]</span><span class=kt>string</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-28-3 name=__codelineno-28-3 href=#__codelineno-28-3></a><span class=w>    </span><span class=c1>//获取pod详情</span>
<a id=__codelineno-28-4 name=__codelineno-28-4 href=#__codelineno-28-4></a><span class=w>    </span><span class=nx>pod</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>p</span><span class=p>.</span><span class=nx>GetPodDetail</span><span class=p>(</span><span class=nx>podName</span><span class=p>,</span><span class=w> </span><span class=nx>namespace</span><span class=p>)</span>
<a id=__codelineno-28-5 name=__codelineno-28-5 href=#__codelineno-28-5></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-28-6 name=__codelineno-28-6 href=#__codelineno-28-6></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>err</span>
<a id=__codelineno-28-7 name=__codelineno-28-7 href=#__codelineno-28-7></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-28-8 name=__codelineno-28-8 href=#__codelineno-28-8></a><span class=w>    </span><span class=c1>//从pod对象中拿到容器名</span>
<a id=__codelineno-28-9 name=__codelineno-28-9 href=#__codelineno-28-9></a><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>container</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>pod</span><span class=p>.</span><span class=nx>Spec</span><span class=p>.</span><span class=nx>Containers</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-28-10 name=__codelineno-28-10 href=#__codelineno-28-10></a><span class=w>        </span><span class=nx>containers</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nb>append</span><span class=p>(</span><span class=nx>containers</span><span class=p>,</span><span class=w> </span><span class=nx>container</span><span class=p>.</span><span class=nx>Name</span><span class=p>)</span>
<a id=__codelineno-28-11 name=__codelineno-28-11 href=#__codelineno-28-11></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-28-12 name=__codelineno-28-12 href=#__codelineno-28-12></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>containers</span><span class=p>,</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-28-13 name=__codelineno-28-13 href=#__codelineno-28-13></a><span class=p>}</span>
</code></pre></div> <p>(7)获取容器日志</p> <div class=highlight><pre><span></span><code><a id=__codelineno-29-1 name=__codelineno-29-1 href=#__codelineno-29-1></a><span class=c1>// GetPodLog 获取pod内容器日志</span>
<a id=__codelineno-29-2 name=__codelineno-29-2 href=#__codelineno-29-2></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=o>*</span><span class=nx>pod</span><span class=p>)</span><span class=w> </span><span class=nx>GetPodLog</span><span class=p>(</span><span class=nx>containerName</span><span class=p>,</span><span class=w> </span><span class=nx>podName</span><span class=p>,</span><span class=w> </span><span class=nx>namespace</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>log</span><span class=w> </span><span class=kt>string</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-29-3 name=__codelineno-29-3 href=#__codelineno-29-3></a><span class=w>    </span><span class=c1>//设置日志的配置，容器名、tail的行数</span>
<a id=__codelineno-29-4 name=__codelineno-29-4 href=#__codelineno-29-4></a><span class=w>    </span><span class=nx>lineLimit</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>int64</span><span class=p>(</span><span class=nx>config</span><span class=p>.</span><span class=nx>PodLogTailLine</span><span class=p>)</span>
<a id=__codelineno-29-5 name=__codelineno-29-5 href=#__codelineno-29-5></a><span class=w>    </span><span class=nx>option</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>PodLogOptions</span><span class=p>{</span>
<a id=__codelineno-29-6 name=__codelineno-29-6 href=#__codelineno-29-6></a><span class=w>        </span><span class=nx>Container</span><span class=p>:</span><span class=w> </span><span class=nx>containerName</span><span class=p>,</span>
<a id=__codelineno-29-7 name=__codelineno-29-7 href=#__codelineno-29-7></a><span class=w>        </span><span class=nx>TailLines</span><span class=p>:</span><span class=w> </span><span class=o>&amp;</span><span class=nx>lineLimit</span><span class=p>,</span>
<a id=__codelineno-29-8 name=__codelineno-29-8 href=#__codelineno-29-8></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-29-9 name=__codelineno-29-9 href=#__codelineno-29-9></a><span class=w>    </span><span class=c1>//获取request实例</span>
<a id=__codelineno-29-10 name=__codelineno-29-10 href=#__codelineno-29-10></a><span class=w>    </span><span class=nx>req</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>CoreV1</span><span class=p>().</span><span class=nx>Pods</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span><span class=nx>GetLogs</span><span class=p>(</span><span class=nx>podName</span><span class=p>,</span><span class=w> </span><span class=nx>option</span><span class=p>)</span>
<a id=__codelineno-29-11 name=__codelineno-29-11 href=#__codelineno-29-11></a><span class=w>    </span><span class=c1>//发起request请求，返回一个io.ReadCloser类型（等同于response.boby)</span>
<a id=__codelineno-29-12 name=__codelineno-29-12 href=#__codelineno-29-12></a><span class=w>    </span><span class=nx>podLogs</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>req</span><span class=p>.</span><span class=nx>Stream</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>())</span>
<a id=__codelineno-29-13 name=__codelineno-29-13 href=#__codelineno-29-13></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-29-14 name=__codelineno-29-14 href=#__codelineno-29-14></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取PodLog失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-29-15 name=__codelineno-29-15 href=#__codelineno-29-15></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=s>&quot;&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取PodLog失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-29-16 name=__codelineno-29-16 href=#__codelineno-29-16></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-29-17 name=__codelineno-29-17 href=#__codelineno-29-17></a><span class=w>    </span><span class=k>defer</span><span class=w> </span><span class=nx>podLogs</span><span class=p>.</span><span class=nx>Close</span><span class=p>()</span>
<a id=__codelineno-29-18 name=__codelineno-29-18 href=#__codelineno-29-18></a><span class=w>    </span><span class=c1>//将response body写入到缓冲区，目的是为了转成string返回</span>
<a id=__codelineno-29-19 name=__codelineno-29-19 href=#__codelineno-29-19></a><span class=w>    </span><span class=nx>buf</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=nx>bytes</span><span class=p>.</span><span class=nx>Buffer</span><span class=p>)</span>
<a id=__codelineno-29-20 name=__codelineno-29-20 href=#__codelineno-29-20></a><span class=w>    </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>io</span><span class=p>.</span><span class=nx>Copy</span><span class=p>(</span><span class=nx>buf</span><span class=p>,</span><span class=w> </span><span class=nx>podLogs</span><span class=p>)</span>
<a id=__codelineno-29-21 name=__codelineno-29-21 href=#__codelineno-29-21></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-29-22 name=__codelineno-29-22 href=#__codelineno-29-22></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;复制PodList失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-29-23 name=__codelineno-29-23 href=#__codelineno-29-23></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=s>&quot;&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;复制PodList失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-29-24 name=__codelineno-29-24 href=#__codelineno-29-24></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-29-25 name=__codelineno-29-25 href=#__codelineno-29-25></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>buf</span><span class=p>.</span><span class=nx>String</span><span class=p>(),</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-29-26 name=__codelineno-29-26 href=#__codelineno-29-26></a><span class=p>}</span>
</code></pre></div> <p>(8)获取每个namespace的pod数量</p> <div class=highlight><pre><span></span><code><a id=__codelineno-30-1 name=__codelineno-30-1 href=#__codelineno-30-1></a><span class=c1>// GetPodNumPerNp 获取每个namespace的pod数量</span>
<a id=__codelineno-30-2 name=__codelineno-30-2 href=#__codelineno-30-2></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=o>*</span><span class=nx>pod</span><span class=p>)</span><span class=w> </span><span class=nx>GetPodNumPerNp</span><span class=p>()</span><span class=w> </span><span class=p>(</span><span class=nx>podsNps</span><span class=w> </span><span class=p>[]</span><span class=o>*</span><span class=nx>PodsNp</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-30-3 name=__codelineno-30-3 href=#__codelineno-30-3></a><span class=w>    </span><span class=c1>//获取namespace列表</span>
<a id=__codelineno-30-4 name=__codelineno-30-4 href=#__codelineno-30-4></a><span class=w>    </span><span class=nx>namespaceList</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>CoreV1</span><span class=p>().</span><span class=nx>Namespaces</span><span class=p>().</span><span class=nx>List</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>ListOptions</span><span class=p>{})</span>
<a id=__codelineno-30-5 name=__codelineno-30-5 href=#__codelineno-30-5></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-30-6 name=__codelineno-30-6 href=#__codelineno-30-6></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>err</span>
<a id=__codelineno-30-7 name=__codelineno-30-7 href=#__codelineno-30-7></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-30-8 name=__codelineno-30-8 href=#__codelineno-30-8></a><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>namespace</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>namespaceList</span><span class=p>.</span><span class=nx>Items</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-30-9 name=__codelineno-30-9 href=#__codelineno-30-9></a><span class=w>        </span><span class=c1>//获取pod列表</span>
<a id=__codelineno-30-10 name=__codelineno-30-10 href=#__codelineno-30-10></a><span class=w>        </span><span class=nx>podList</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>CoreV1</span><span class=p>().</span><span class=nx>Pods</span><span class=p>(</span><span class=nx>namespace</span><span class=p>.</span><span class=nx>Name</span><span class=p>).</span>
<a id=__codelineno-30-11 name=__codelineno-30-11 href=#__codelineno-30-11></a><span class=w>            </span><span class=nx>List</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>ListOptions</span><span class=p>{})</span>
<a id=__codelineno-30-12 name=__codelineno-30-12 href=#__codelineno-30-12></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-30-13 name=__codelineno-30-13 href=#__codelineno-30-13></a><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>err</span>
<a id=__codelineno-30-14 name=__codelineno-30-14 href=#__codelineno-30-14></a><span class=w>        </span><span class=p>}</span>
<a id=__codelineno-30-15 name=__codelineno-30-15 href=#__codelineno-30-15></a><span class=w>        </span><span class=c1>//组装数据</span>
<a id=__codelineno-30-16 name=__codelineno-30-16 href=#__codelineno-30-16></a><span class=w>        </span><span class=nx>PodsNp</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>PodsNp</span><span class=p>{</span>
<a id=__codelineno-30-17 name=__codelineno-30-17 href=#__codelineno-30-17></a><span class=w>            </span><span class=nx>Namespace</span><span class=p>:</span><span class=w> </span><span class=nx>namespace</span><span class=p>.</span><span class=nx>Name</span><span class=p>,</span>
<a id=__codelineno-30-18 name=__codelineno-30-18 href=#__codelineno-30-18></a><span class=w>            </span><span class=nx>PodNum</span><span class=p>:</span><span class=w>    </span><span class=nb>len</span><span class=p>(</span><span class=nx>podList</span><span class=p>.</span><span class=nx>Items</span><span class=p>),</span>
<a id=__codelineno-30-19 name=__codelineno-30-19 href=#__codelineno-30-19></a><span class=w>        </span><span class=p>}</span>
<a id=__codelineno-30-20 name=__codelineno-30-20 href=#__codelineno-30-20></a><span class=w>        </span><span class=c1>//添加到podsNps数组中</span>
<a id=__codelineno-30-21 name=__codelineno-30-21 href=#__codelineno-30-21></a><span class=w>        </span><span class=nx>podsNps</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nb>append</span><span class=p>(</span><span class=nx>podsNps</span><span class=p>,</span><span class=w> </span><span class=nx>PodsNp</span><span class=p>)</span>
<a id=__codelineno-30-22 name=__codelineno-30-22 href=#__codelineno-30-22></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-30-23 name=__codelineno-30-23 href=#__codelineno-30-23></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>podsNps</span><span class=p>,</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-30-24 name=__codelineno-30-24 href=#__codelineno-30-24></a><span class=p>}</span>
</code></pre></div> <p>(9)编写Controller层的pod代码</p> <p><code>controller/pod.go</code></p> <div class=highlight><pre><span></span><code><a id=__codelineno-31-1 name=__codelineno-31-1 href=#__codelineno-31-1></a><span class=kn>package</span><span class=w> </span><span class=nx>controller</span>
<a id=__codelineno-31-2 name=__codelineno-31-2 href=#__codelineno-31-2></a>
<a id=__codelineno-31-3 name=__codelineno-31-3 href=#__codelineno-31-3></a><span class=kn>import</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-31-4 name=__codelineno-31-4 href=#__codelineno-31-4></a><span class=w>    </span><span class=s>&quot;gitee.com/k8s-platform/service&quot;</span>
<a id=__codelineno-31-5 name=__codelineno-31-5 href=#__codelineno-31-5></a><span class=w>    </span><span class=s>&quot;net/http&quot;</span>
<a id=__codelineno-31-6 name=__codelineno-31-6 href=#__codelineno-31-6></a>
<a id=__codelineno-31-7 name=__codelineno-31-7 href=#__codelineno-31-7></a><span class=w>    </span><span class=s>&quot;github.com/gin-gonic/gin&quot;</span>
<a id=__codelineno-31-8 name=__codelineno-31-8 href=#__codelineno-31-8></a><span class=w>    </span><span class=s>&quot;github.com/wonderivan/logger&quot;</span>
<a id=__codelineno-31-9 name=__codelineno-31-9 href=#__codelineno-31-9></a><span class=p>)</span>
<a id=__codelineno-31-10 name=__codelineno-31-10 href=#__codelineno-31-10></a>
<a id=__codelineno-31-11 name=__codelineno-31-11 href=#__codelineno-31-11></a><span class=kd>var</span><span class=w> </span><span class=nx>Pod</span><span class=w> </span><span class=nx>pod</span>
<a id=__codelineno-31-12 name=__codelineno-31-12 href=#__codelineno-31-12></a>
<a id=__codelineno-31-13 name=__codelineno-31-13 href=#__codelineno-31-13></a><span class=kd>type</span><span class=w> </span><span class=nx>pod</span><span class=w> </span><span class=kd>struct</span><span class=p>{}</span>
<a id=__codelineno-31-14 name=__codelineno-31-14 href=#__codelineno-31-14></a>
<a id=__codelineno-31-15 name=__codelineno-31-15 href=#__codelineno-31-15></a><span class=c1>//Controller中的方法入参是gin.Context，用于从上下文中获取请求参数及定义响应内容</span>
<a id=__codelineno-31-16 name=__codelineno-31-16 href=#__codelineno-31-16></a><span class=c1>//流程：绑定参数-&gt;调用service代码-&gt;根据调用结果响应具体内容</span>
<a id=__codelineno-31-17 name=__codelineno-31-17 href=#__codelineno-31-17></a>
<a id=__codelineno-31-18 name=__codelineno-31-18 href=#__codelineno-31-18></a><span class=c1>// GetPods 获取pod列表，支持过滤、排序、分页</span>
<a id=__codelineno-31-19 name=__codelineno-31-19 href=#__codelineno-31-19></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=o>*</span><span class=nx>pod</span><span class=p>)</span><span class=w> </span><span class=nx>GetPods</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-31-20 name=__codelineno-31-20 href=#__codelineno-31-20></a><span class=w>    </span><span class=c1>//匿名结构体，用于声明入参，get请求为form格式，其他请求为json格式</span>
<a id=__codelineno-31-21 name=__codelineno-31-21 href=#__codelineno-31-21></a><span class=w>    </span><span class=nx>params</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-31-22 name=__codelineno-31-22 href=#__codelineno-31-22></a><span class=w>        </span><span class=nx>FilterName</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`form:&quot;filter_name&quot;`</span>
<a id=__codelineno-31-23 name=__codelineno-31-23 href=#__codelineno-31-23></a><span class=w>        </span><span class=nx>Namespace</span><span class=w>  </span><span class=kt>string</span><span class=w> </span><span class=s>`form:&quot;namespace&quot;`</span>
<a id=__codelineno-31-24 name=__codelineno-31-24 href=#__codelineno-31-24></a><span class=w>        </span><span class=nx>Page</span><span class=w>       </span><span class=kt>int</span><span class=w>    </span><span class=s>`form:&quot;page&quot;`</span>
<a id=__codelineno-31-25 name=__codelineno-31-25 href=#__codelineno-31-25></a><span class=w>        </span><span class=nx>Limit</span><span class=w>      </span><span class=kt>int</span><span class=w>    </span><span class=s>`form:&quot;limit&quot;`</span>
<a id=__codelineno-31-26 name=__codelineno-31-26 href=#__codelineno-31-26></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-31-27 name=__codelineno-31-27 href=#__codelineno-31-27></a><span class=w>    </span><span class=c1>//绑定参数，给匿名结构体中的属性赋值，值是入参</span>
<a id=__codelineno-31-28 name=__codelineno-31-28 href=#__codelineno-31-28></a><span class=w>    </span><span class=c1>//form格式(Get)使用ctx.Bind方法，json格式使用ctx.ShouldBindJSON方法</span>
<a id=__codelineno-31-29 name=__codelineno-31-29 href=#__codelineno-31-29></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>Bind</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-31-30 name=__codelineno-31-30 href=#__codelineno-31-30></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-31-31 name=__codelineno-31-31 href=#__codelineno-31-31></a><span class=w>        </span><span class=c1>//ctx.JSON方法用于返回响应内容，入参是状态码和响应内容，响应内容放入gin.H的map中</span>
<a id=__codelineno-31-32 name=__codelineno-31-32 href=#__codelineno-31-32></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-31-33 name=__codelineno-31-33 href=#__codelineno-31-33></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-31-34 name=__codelineno-31-34 href=#__codelineno-31-34></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-31-35 name=__codelineno-31-35 href=#__codelineno-31-35></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-31-36 name=__codelineno-31-36 href=#__codelineno-31-36></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-31-37 name=__codelineno-31-37 href=#__codelineno-31-37></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-31-38 name=__codelineno-31-38 href=#__codelineno-31-38></a><span class=w>    </span><span class=c1>//service中的的方法通过 包名.结构体变量名.方法名 使用，serivce.Pod.GetPods()</span>
<a id=__codelineno-31-39 name=__codelineno-31-39 href=#__codelineno-31-39></a><span class=w>    </span><span class=nx>data</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>Pod</span><span class=p>.</span><span class=nx>GetPods</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>FilterName</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Limit</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Page</span><span class=p>)</span>
<a id=__codelineno-31-40 name=__codelineno-31-40 href=#__codelineno-31-40></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-31-41 name=__codelineno-31-41 href=#__codelineno-31-41></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-31-42 name=__codelineno-31-42 href=#__codelineno-31-42></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-31-43 name=__codelineno-31-43 href=#__codelineno-31-43></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-31-44 name=__codelineno-31-44 href=#__codelineno-31-44></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-31-45 name=__codelineno-31-45 href=#__codelineno-31-45></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-31-46 name=__codelineno-31-46 href=#__codelineno-31-46></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-31-47 name=__codelineno-31-47 href=#__codelineno-31-47></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-31-48 name=__codelineno-31-48 href=#__codelineno-31-48></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;获取Pod列表成功&quot;</span><span class=p>,</span>
<a id=__codelineno-31-49 name=__codelineno-31-49 href=#__codelineno-31-49></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=nx>data</span><span class=p>,</span>
<a id=__codelineno-31-50 name=__codelineno-31-50 href=#__codelineno-31-50></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-31-51 name=__codelineno-31-51 href=#__codelineno-31-51></a><span class=p>}</span>
<a id=__codelineno-31-52 name=__codelineno-31-52 href=#__codelineno-31-52></a>
<a id=__codelineno-31-53 name=__codelineno-31-53 href=#__codelineno-31-53></a><span class=c1>// GetPodDetail 获取pod详情</span>
<a id=__codelineno-31-54 name=__codelineno-31-54 href=#__codelineno-31-54></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=o>*</span><span class=nx>pod</span><span class=p>)</span><span class=w> </span><span class=nx>GetPodDetail</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-31-55 name=__codelineno-31-55 href=#__codelineno-31-55></a><span class=w>    </span><span class=nx>params</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-31-56 name=__codelineno-31-56 href=#__codelineno-31-56></a><span class=w>        </span><span class=nx>PodName</span><span class=w>   </span><span class=kt>string</span><span class=w> </span><span class=s>`form:&quot;pod_name&quot;`</span>
<a id=__codelineno-31-57 name=__codelineno-31-57 href=#__codelineno-31-57></a><span class=w>        </span><span class=nx>Namespace</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`form:&quot;namespace&quot;`</span>
<a id=__codelineno-31-58 name=__codelineno-31-58 href=#__codelineno-31-58></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-31-59 name=__codelineno-31-59 href=#__codelineno-31-59></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>Bind</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-31-60 name=__codelineno-31-60 href=#__codelineno-31-60></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-31-61 name=__codelineno-31-61 href=#__codelineno-31-61></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-31-62 name=__codelineno-31-62 href=#__codelineno-31-62></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-31-63 name=__codelineno-31-63 href=#__codelineno-31-63></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-31-64 name=__codelineno-31-64 href=#__codelineno-31-64></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-31-65 name=__codelineno-31-65 href=#__codelineno-31-65></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-31-66 name=__codelineno-31-66 href=#__codelineno-31-66></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-31-67 name=__codelineno-31-67 href=#__codelineno-31-67></a><span class=w>    </span><span class=nx>data</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>Pod</span><span class=p>.</span><span class=nx>GetPodDetail</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>PodName</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>)</span>
<a id=__codelineno-31-68 name=__codelineno-31-68 href=#__codelineno-31-68></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-31-69 name=__codelineno-31-69 href=#__codelineno-31-69></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-31-70 name=__codelineno-31-70 href=#__codelineno-31-70></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-31-71 name=__codelineno-31-71 href=#__codelineno-31-71></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-31-72 name=__codelineno-31-72 href=#__codelineno-31-72></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-31-73 name=__codelineno-31-73 href=#__codelineno-31-73></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-31-74 name=__codelineno-31-74 href=#__codelineno-31-74></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-31-75 name=__codelineno-31-75 href=#__codelineno-31-75></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-31-76 name=__codelineno-31-76 href=#__codelineno-31-76></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;获取Pod详情成功&quot;</span><span class=p>,</span>
<a id=__codelineno-31-77 name=__codelineno-31-77 href=#__codelineno-31-77></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=nx>data</span><span class=p>,</span>
<a id=__codelineno-31-78 name=__codelineno-31-78 href=#__codelineno-31-78></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-31-79 name=__codelineno-31-79 href=#__codelineno-31-79></a><span class=p>}</span>
<a id=__codelineno-31-80 name=__codelineno-31-80 href=#__codelineno-31-80></a>
<a id=__codelineno-31-81 name=__codelineno-31-81 href=#__codelineno-31-81></a><span class=c1>// DeletePod 删除Pod</span>
<a id=__codelineno-31-82 name=__codelineno-31-82 href=#__codelineno-31-82></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=o>*</span><span class=nx>pod</span><span class=p>)</span><span class=w> </span><span class=nx>DeletePod</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-31-83 name=__codelineno-31-83 href=#__codelineno-31-83></a><span class=w>    </span><span class=nx>params</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-31-84 name=__codelineno-31-84 href=#__codelineno-31-84></a><span class=w>        </span><span class=nx>PodName</span><span class=w>   </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;pod_name&quot;`</span>
<a id=__codelineno-31-85 name=__codelineno-31-85 href=#__codelineno-31-85></a><span class=w>        </span><span class=nx>Namespace</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;namespace&quot;`</span>
<a id=__codelineno-31-86 name=__codelineno-31-86 href=#__codelineno-31-86></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-31-87 name=__codelineno-31-87 href=#__codelineno-31-87></a><span class=w>    </span><span class=c1>//PUT请求，绑定参数方法改为ctx.ShouldBindJSON</span>
<a id=__codelineno-31-88 name=__codelineno-31-88 href=#__codelineno-31-88></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>ShouldBindJSON</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-31-89 name=__codelineno-31-89 href=#__codelineno-31-89></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-31-90 name=__codelineno-31-90 href=#__codelineno-31-90></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-31-91 name=__codelineno-31-91 href=#__codelineno-31-91></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-31-92 name=__codelineno-31-92 href=#__codelineno-31-92></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-31-93 name=__codelineno-31-93 href=#__codelineno-31-93></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-31-94 name=__codelineno-31-94 href=#__codelineno-31-94></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-31-95 name=__codelineno-31-95 href=#__codelineno-31-95></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-31-96 name=__codelineno-31-96 href=#__codelineno-31-96></a><span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>Pod</span><span class=p>.</span><span class=nx>DeletePod</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>PodName</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>)</span>
<a id=__codelineno-31-97 name=__codelineno-31-97 href=#__codelineno-31-97></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-31-98 name=__codelineno-31-98 href=#__codelineno-31-98></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-31-99 name=__codelineno-31-99 href=#__codelineno-31-99></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-31-100 name=__codelineno-31-100 href=#__codelineno-31-100></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-31-101 name=__codelineno-31-101 href=#__codelineno-31-101></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-31-102 name=__codelineno-31-102 href=#__codelineno-31-102></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-31-103 name=__codelineno-31-103 href=#__codelineno-31-103></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-31-104 name=__codelineno-31-104 href=#__codelineno-31-104></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-31-105 name=__codelineno-31-105 href=#__codelineno-31-105></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;删除Pod成功&quot;</span><span class=p>,</span>
<a id=__codelineno-31-106 name=__codelineno-31-106 href=#__codelineno-31-106></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-31-107 name=__codelineno-31-107 href=#__codelineno-31-107></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-31-108 name=__codelineno-31-108 href=#__codelineno-31-108></a><span class=p>}</span>
<a id=__codelineno-31-109 name=__codelineno-31-109 href=#__codelineno-31-109></a>
<a id=__codelineno-31-110 name=__codelineno-31-110 href=#__codelineno-31-110></a><span class=c1>// UpdatePod 更新pod</span>
<a id=__codelineno-31-111 name=__codelineno-31-111 href=#__codelineno-31-111></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=o>*</span><span class=nx>pod</span><span class=p>)</span><span class=w> </span><span class=nx>UpdatePod</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-31-112 name=__codelineno-31-112 href=#__codelineno-31-112></a><span class=w>    </span><span class=nx>params</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-31-113 name=__codelineno-31-113 href=#__codelineno-31-113></a><span class=w>        </span><span class=nx>Namespace</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;namespace&quot;`</span>
<a id=__codelineno-31-114 name=__codelineno-31-114 href=#__codelineno-31-114></a><span class=w>        </span><span class=nx>Content</span><span class=w>   </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;content&quot;`</span>
<a id=__codelineno-31-115 name=__codelineno-31-115 href=#__codelineno-31-115></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-31-116 name=__codelineno-31-116 href=#__codelineno-31-116></a><span class=w>    </span><span class=c1>//PUT请求，绑定参数方法改为ctx.ShouldBindJSON</span>
<a id=__codelineno-31-117 name=__codelineno-31-117 href=#__codelineno-31-117></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>ShouldBindJSON</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-31-118 name=__codelineno-31-118 href=#__codelineno-31-118></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-31-119 name=__codelineno-31-119 href=#__codelineno-31-119></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-31-120 name=__codelineno-31-120 href=#__codelineno-31-120></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-31-121 name=__codelineno-31-121 href=#__codelineno-31-121></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-31-122 name=__codelineno-31-122 href=#__codelineno-31-122></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-31-123 name=__codelineno-31-123 href=#__codelineno-31-123></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-31-124 name=__codelineno-31-124 href=#__codelineno-31-124></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-31-125 name=__codelineno-31-125 href=#__codelineno-31-125></a><span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>Pod</span><span class=p>.</span><span class=nx>UpdatePod</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Content</span><span class=p>)</span>
<a id=__codelineno-31-126 name=__codelineno-31-126 href=#__codelineno-31-126></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-31-127 name=__codelineno-31-127 href=#__codelineno-31-127></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-31-128 name=__codelineno-31-128 href=#__codelineno-31-128></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-31-129 name=__codelineno-31-129 href=#__codelineno-31-129></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-31-130 name=__codelineno-31-130 href=#__codelineno-31-130></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-31-131 name=__codelineno-31-131 href=#__codelineno-31-131></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-31-132 name=__codelineno-31-132 href=#__codelineno-31-132></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-31-133 name=__codelineno-31-133 href=#__codelineno-31-133></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-31-134 name=__codelineno-31-134 href=#__codelineno-31-134></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;更新Pod成功&quot;</span><span class=p>,</span>
<a id=__codelineno-31-135 name=__codelineno-31-135 href=#__codelineno-31-135></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-31-136 name=__codelineno-31-136 href=#__codelineno-31-136></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-31-137 name=__codelineno-31-137 href=#__codelineno-31-137></a><span class=p>}</span>
<a id=__codelineno-31-138 name=__codelineno-31-138 href=#__codelineno-31-138></a>
<a id=__codelineno-31-139 name=__codelineno-31-139 href=#__codelineno-31-139></a><span class=c1>// GetPodContainer 获取pod容量</span>
<a id=__codelineno-31-140 name=__codelineno-31-140 href=#__codelineno-31-140></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=o>*</span><span class=nx>pod</span><span class=p>)</span><span class=w> </span><span class=nx>GetPodContainer</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-31-141 name=__codelineno-31-141 href=#__codelineno-31-141></a><span class=w>    </span><span class=nx>params</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-31-142 name=__codelineno-31-142 href=#__codelineno-31-142></a><span class=w>        </span><span class=nx>PodName</span><span class=w>   </span><span class=kt>string</span><span class=w> </span><span class=s>`form:&quot;pod_name&quot;`</span>
<a id=__codelineno-31-143 name=__codelineno-31-143 href=#__codelineno-31-143></a><span class=w>        </span><span class=nx>Namespace</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`form:&quot;namespace&quot;`</span>
<a id=__codelineno-31-144 name=__codelineno-31-144 href=#__codelineno-31-144></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-31-145 name=__codelineno-31-145 href=#__codelineno-31-145></a><span class=w>    </span><span class=c1>//GET请求，绑定参数方法改为ctx.Bind</span>
<a id=__codelineno-31-146 name=__codelineno-31-146 href=#__codelineno-31-146></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>Bind</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-31-147 name=__codelineno-31-147 href=#__codelineno-31-147></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-31-148 name=__codelineno-31-148 href=#__codelineno-31-148></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-31-149 name=__codelineno-31-149 href=#__codelineno-31-149></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-31-150 name=__codelineno-31-150 href=#__codelineno-31-150></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-31-151 name=__codelineno-31-151 href=#__codelineno-31-151></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-31-152 name=__codelineno-31-152 href=#__codelineno-31-152></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-31-153 name=__codelineno-31-153 href=#__codelineno-31-153></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-31-154 name=__codelineno-31-154 href=#__codelineno-31-154></a><span class=w>    </span><span class=nx>data</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>Pod</span><span class=p>.</span><span class=nx>GetPodContainer</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>PodName</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>)</span>
<a id=__codelineno-31-155 name=__codelineno-31-155 href=#__codelineno-31-155></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-31-156 name=__codelineno-31-156 href=#__codelineno-31-156></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-31-157 name=__codelineno-31-157 href=#__codelineno-31-157></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-31-158 name=__codelineno-31-158 href=#__codelineno-31-158></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-31-159 name=__codelineno-31-159 href=#__codelineno-31-159></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-31-160 name=__codelineno-31-160 href=#__codelineno-31-160></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-31-161 name=__codelineno-31-161 href=#__codelineno-31-161></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-31-162 name=__codelineno-31-162 href=#__codelineno-31-162></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-31-163 name=__codelineno-31-163 href=#__codelineno-31-163></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;获取Pod容器成功&quot;</span><span class=p>,</span>
<a id=__codelineno-31-164 name=__codelineno-31-164 href=#__codelineno-31-164></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=nx>data</span><span class=p>,</span>
<a id=__codelineno-31-165 name=__codelineno-31-165 href=#__codelineno-31-165></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-31-166 name=__codelineno-31-166 href=#__codelineno-31-166></a><span class=p>}</span>
<a id=__codelineno-31-167 name=__codelineno-31-167 href=#__codelineno-31-167></a>
<a id=__codelineno-31-168 name=__codelineno-31-168 href=#__codelineno-31-168></a><span class=c1>// GetPodLog 获取pod中容器日志</span>
<a id=__codelineno-31-169 name=__codelineno-31-169 href=#__codelineno-31-169></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=o>*</span><span class=nx>pod</span><span class=p>)</span><span class=w> </span><span class=nx>GetPodLog</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-31-170 name=__codelineno-31-170 href=#__codelineno-31-170></a><span class=w>    </span><span class=nx>params</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-31-171 name=__codelineno-31-171 href=#__codelineno-31-171></a><span class=w>        </span><span class=nx>ContainerName</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`form:&quot;container_name&quot;`</span>
<a id=__codelineno-31-172 name=__codelineno-31-172 href=#__codelineno-31-172></a><span class=w>        </span><span class=nx>PodName</span><span class=w>       </span><span class=kt>string</span><span class=w> </span><span class=s>`form:&quot;pod_name&quot;`</span>
<a id=__codelineno-31-173 name=__codelineno-31-173 href=#__codelineno-31-173></a><span class=w>        </span><span class=nx>Namespace</span><span class=w>     </span><span class=kt>string</span><span class=w> </span><span class=s>`form:&quot;namespace&quot;`</span>
<a id=__codelineno-31-174 name=__codelineno-31-174 href=#__codelineno-31-174></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-31-175 name=__codelineno-31-175 href=#__codelineno-31-175></a><span class=w>    </span><span class=c1>//GET请求，绑定参数方法改为ctx.Bind</span>
<a id=__codelineno-31-176 name=__codelineno-31-176 href=#__codelineno-31-176></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>Bind</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-31-177 name=__codelineno-31-177 href=#__codelineno-31-177></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-31-178 name=__codelineno-31-178 href=#__codelineno-31-178></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-31-179 name=__codelineno-31-179 href=#__codelineno-31-179></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-31-180 name=__codelineno-31-180 href=#__codelineno-31-180></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-31-181 name=__codelineno-31-181 href=#__codelineno-31-181></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-31-182 name=__codelineno-31-182 href=#__codelineno-31-182></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-31-183 name=__codelineno-31-183 href=#__codelineno-31-183></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-31-184 name=__codelineno-31-184 href=#__codelineno-31-184></a><span class=w>    </span><span class=nx>data</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>Pod</span><span class=p>.</span><span class=nx>GetPodLog</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>ContainerName</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>PodName</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>)</span>
<a id=__codelineno-31-185 name=__codelineno-31-185 href=#__codelineno-31-185></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-31-186 name=__codelineno-31-186 href=#__codelineno-31-186></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-31-187 name=__codelineno-31-187 href=#__codelineno-31-187></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-31-188 name=__codelineno-31-188 href=#__codelineno-31-188></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-31-189 name=__codelineno-31-189 href=#__codelineno-31-189></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-31-190 name=__codelineno-31-190 href=#__codelineno-31-190></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-31-191 name=__codelineno-31-191 href=#__codelineno-31-191></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-31-192 name=__codelineno-31-192 href=#__codelineno-31-192></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-31-193 name=__codelineno-31-193 href=#__codelineno-31-193></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;获取Pod中容器日志成功&quot;</span><span class=p>,</span>
<a id=__codelineno-31-194 name=__codelineno-31-194 href=#__codelineno-31-194></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=nx>data</span><span class=p>,</span>
<a id=__codelineno-31-195 name=__codelineno-31-195 href=#__codelineno-31-195></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-31-196 name=__codelineno-31-196 href=#__codelineno-31-196></a><span class=p>}</span>
<a id=__codelineno-31-197 name=__codelineno-31-197 href=#__codelineno-31-197></a>
<a id=__codelineno-31-198 name=__codelineno-31-198 href=#__codelineno-31-198></a><span class=c1>// GetPodNumPerNp 获取每个namespace的pod数量</span>
<a id=__codelineno-31-199 name=__codelineno-31-199 href=#__codelineno-31-199></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=o>*</span><span class=nx>pod</span><span class=p>)</span><span class=w> </span><span class=nx>GetPodNumPerNp</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-31-200 name=__codelineno-31-200 href=#__codelineno-31-200></a><span class=w>    </span><span class=nx>data</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>Pod</span><span class=p>.</span><span class=nx>GetPodNumPerNp</span><span class=p>()</span>
<a id=__codelineno-31-201 name=__codelineno-31-201 href=#__codelineno-31-201></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-31-202 name=__codelineno-31-202 href=#__codelineno-31-202></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-31-203 name=__codelineno-31-203 href=#__codelineno-31-203></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-31-204 name=__codelineno-31-204 href=#__codelineno-31-204></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-31-205 name=__codelineno-31-205 href=#__codelineno-31-205></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-31-206 name=__codelineno-31-206 href=#__codelineno-31-206></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-31-207 name=__codelineno-31-207 href=#__codelineno-31-207></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-31-208 name=__codelineno-31-208 href=#__codelineno-31-208></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-31-209 name=__codelineno-31-209 href=#__codelineno-31-209></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;获取每个namespace的pod数量成功&quot;</span><span class=p>,</span>
<a id=__codelineno-31-210 name=__codelineno-31-210 href=#__codelineno-31-210></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=nx>data</span><span class=p>,</span>
<a id=__codelineno-31-211 name=__codelineno-31-211 href=#__codelineno-31-211></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-31-212 name=__codelineno-31-212 href=#__codelineno-31-212></a><span class=p>}</span>
</code></pre></div> <p>(10)定义路由规则</p> <p><code>controller/router.go</code></p> <div class=highlight><pre><span></span><code><a id=__codelineno-32-1 name=__codelineno-32-1 href=#__codelineno-32-1></a><span class=kn>package</span><span class=w> </span><span class=nx>controller</span>
<a id=__codelineno-32-2 name=__codelineno-32-2 href=#__codelineno-32-2></a>
<a id=__codelineno-32-3 name=__codelineno-32-3 href=#__codelineno-32-3></a><span class=kn>import</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-32-4 name=__codelineno-32-4 href=#__codelineno-32-4></a><span class=w>    </span><span class=s>&quot;github.com/gin-gonic/gin&quot;</span>
<a id=__codelineno-32-5 name=__codelineno-32-5 href=#__codelineno-32-5></a><span class=w>    </span><span class=s>&quot;net/http&quot;</span>
<a id=__codelineno-32-6 name=__codelineno-32-6 href=#__codelineno-32-6></a><span class=p>)</span>
<a id=__codelineno-32-7 name=__codelineno-32-7 href=#__codelineno-32-7></a>
<a id=__codelineno-32-8 name=__codelineno-32-8 href=#__codelineno-32-8></a><span class=c1>// Router 实例化router结构体，可使用该对象点出首字母大写的方法（包外调用）</span>
<a id=__codelineno-32-9 name=__codelineno-32-9 href=#__codelineno-32-9></a><span class=kd>var</span><span class=w> </span><span class=nx>Router</span><span class=w> </span><span class=nx>router</span>
<a id=__codelineno-32-10 name=__codelineno-32-10 href=#__codelineno-32-10></a>
<a id=__codelineno-32-11 name=__codelineno-32-11 href=#__codelineno-32-11></a><span class=c1>// 创建router结构体</span>
<a id=__codelineno-32-12 name=__codelineno-32-12 href=#__codelineno-32-12></a><span class=kd>type</span><span class=w> </span><span class=nx>router</span><span class=w> </span><span class=kd>struct</span><span class=p>{}</span>
<a id=__codelineno-32-13 name=__codelineno-32-13 href=#__codelineno-32-13></a>
<a id=__codelineno-32-14 name=__codelineno-32-14 href=#__codelineno-32-14></a><span class=c1>// InitApiRouter 初始化路由规则</span>
<a id=__codelineno-32-15 name=__codelineno-32-15 href=#__codelineno-32-15></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>r</span><span class=w> </span><span class=o>*</span><span class=nx>router</span><span class=p>)</span><span class=w> </span><span class=nx>InitApiRouter</span><span class=p>(</span><span class=nx>router</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Engine</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-32-16 name=__codelineno-32-16 href=#__codelineno-32-16></a><span class=w>    </span><span class=c1>//创建测试api接口</span>
<a id=__codelineno-32-17 name=__codelineno-32-17 href=#__codelineno-32-17></a><span class=w>    </span><span class=nx>router</span><span class=p>.</span><span class=nx>GET</span><span class=p>(</span><span class=s>&quot;/testapi&quot;</span><span class=p>,</span><span class=w> </span><span class=kd>func</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-32-18 name=__codelineno-32-18 href=#__codelineno-32-18></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-32-19 name=__codelineno-32-19 href=#__codelineno-32-19></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;testapi success!&quot;</span><span class=p>,</span>
<a id=__codelineno-32-20 name=__codelineno-32-20 href=#__codelineno-32-20></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-32-21 name=__codelineno-32-21 href=#__codelineno-32-21></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-32-22 name=__codelineno-32-22 href=#__codelineno-32-22></a><span class=w>    </span><span class=p>}).</span>
<a id=__codelineno-32-23 name=__codelineno-32-23 href=#__codelineno-32-23></a><span class=w>        </span><span class=c1>// pod操作</span>
<a id=__codelineno-32-24 name=__codelineno-32-24 href=#__codelineno-32-24></a><span class=w>        </span><span class=nx>GET</span><span class=p>(</span><span class=s>&quot;/api/k8s/pods&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Pod</span><span class=p>.</span><span class=nx>GetPods</span><span class=p>).</span>
<a id=__codelineno-32-25 name=__codelineno-32-25 href=#__codelineno-32-25></a><span class=w>        </span><span class=nx>GET</span><span class=p>(</span><span class=s>&quot;/api/k8s/pod/detail&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Pod</span><span class=p>.</span><span class=nx>GetPodDetail</span><span class=p>).</span>
<a id=__codelineno-32-26 name=__codelineno-32-26 href=#__codelineno-32-26></a><span class=w>        </span><span class=nx>DELETE</span><span class=p>(</span><span class=s>&quot;/api/k8s/pod/del&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Pod</span><span class=p>.</span><span class=nx>DeletePod</span><span class=p>).</span>
<a id=__codelineno-32-27 name=__codelineno-32-27 href=#__codelineno-32-27></a><span class=w>        </span><span class=nx>PUT</span><span class=p>(</span><span class=s>&quot;/api/k8s/pod/update&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Pod</span><span class=p>.</span><span class=nx>UpdatePod</span><span class=p>).</span>
<a id=__codelineno-32-28 name=__codelineno-32-28 href=#__codelineno-32-28></a><span class=w>        </span><span class=nx>GET</span><span class=p>(</span><span class=s>&quot;/api/k8s/pod/container&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Pod</span><span class=p>.</span><span class=nx>GetPodContainer</span><span class=p>).</span>
<a id=__codelineno-32-29 name=__codelineno-32-29 href=#__codelineno-32-29></a><span class=w>        </span><span class=nx>GET</span><span class=p>(</span><span class=s>&quot;/api/k8s/pod/log&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Pod</span><span class=p>.</span><span class=nx>GetPodLog</span><span class=p>).</span>
<a id=__codelineno-32-30 name=__codelineno-32-30 href=#__codelineno-32-30></a><span class=w>        </span><span class=nx>GET</span><span class=p>(</span><span class=s>&quot;/api/k8s/pod/numnp&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Pod</span><span class=p>.</span><span class=nx>GetPodNumPerNp</span><span class=p>)</span>
<a id=__codelineno-32-31 name=__codelineno-32-31 href=#__codelineno-32-31></a><span class=p>}</span>
</code></pre></div> <p>(11)做接口测试</p> <ul> <li>获取所有pod信息</li> </ul> <p><img alt=1700558387506 class=zoom src=https://cdn.jsdelivr.net/gh/hujianli94/Picgo-atlas@main/img/1700558387506.5wwy3ial69c0.webp></p> <ul> <li>获取pod详细内容</li> </ul> <p><img alt=1700558473846 class=zoom src=https://cdn.jsdelivr.net/gh/hujianli94/Picgo-atlas@main/img/1700558473846.3h9rliiwuhs0.webp></p> <ul> <li>删除pod</li> </ul> <p><img alt=1700558519334 class=zoom src=https://cdn.jsdelivr.net/gh/hujianli94/Picgo-atlas@main/img/1700558519334.723iphdn21o0.webp></p> <h4 id=23-deployment>2.3 Deployment<a class=headerlink href=#23-deployment title="Permanent link">&para;</a></h4> <p><code>service/dataselector.go</code></p> <div class=highlight><pre><span></span><code><a id=__codelineno-33-1 name=__codelineno-33-1 href=#__codelineno-33-1></a><span class=c1>// 实现 Deployment的 DataCell接口</span>
<a id=__codelineno-33-2 name=__codelineno-33-2 href=#__codelineno-33-2></a><span class=kd>type</span><span class=w> </span><span class=nx>deploymentCell</span><span class=w> </span><span class=nx>appsv1</span><span class=p>.</span><span class=nx>Deployment</span><span class=w> </span><span class=c1>//appsv1 &quot;k8s.io/api/apps/v1&quot;</span>
<a id=__codelineno-33-3 name=__codelineno-33-3 href=#__codelineno-33-3></a>
<a id=__codelineno-33-4 name=__codelineno-33-4 href=#__codelineno-33-4></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=nx>deploymentCell</span><span class=p>)</span><span class=w> </span><span class=nx>GetCreation</span><span class=p>()</span><span class=w> </span><span class=nx>time</span><span class=p>.</span><span class=nx>Time</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-33-5 name=__codelineno-33-5 href=#__codelineno-33-5></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>d</span><span class=p>.</span><span class=nx>CreationTimestamp</span><span class=p>.</span><span class=nx>Time</span>
<a id=__codelineno-33-6 name=__codelineno-33-6 href=#__codelineno-33-6></a><span class=p>}</span>
<a id=__codelineno-33-7 name=__codelineno-33-7 href=#__codelineno-33-7></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=nx>deploymentCell</span><span class=p>)</span><span class=w> </span><span class=nx>GetName</span><span class=p>()</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-33-8 name=__codelineno-33-8 href=#__codelineno-33-8></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>d</span><span class=p>.</span><span class=nx>Name</span>
<a id=__codelineno-33-9 name=__codelineno-33-9 href=#__codelineno-33-9></a><span class=p>}</span>
</code></pre></div> <p><code>service/deployment.go</code></p> <p>开发deployment功能</p> <table> <thead> <tr> <th>功能</th> <th>是否实现</th> </tr> </thead> <tbody> <tr> <td>deployment列表</td> <td>√</td> </tr> <tr> <td>获取Deployment详情</td> <td>√</td> </tr> <tr> <td>修改Deployment副本数</td> <td>√</td> </tr> <tr> <td>创建Deployment</td> <td>√</td> </tr> <tr> <td>删除Deployment</td> <td>√</td> </tr> <tr> <td>重启Deployment</td> <td>√</td> </tr> <tr> <td>更新Deployment</td> <td>√</td> </tr> <tr> <td>获取每个namespace的Deployment数量</td> <td>√</td> </tr> </tbody> </table> <div class=highlight><pre><span></span><code><a id=__codelineno-34-1 name=__codelineno-34-1 href=#__codelineno-34-1></a><span class=kn>package</span><span class=w> </span><span class=nx>service</span>
<a id=__codelineno-34-2 name=__codelineno-34-2 href=#__codelineno-34-2></a>
<a id=__codelineno-34-3 name=__codelineno-34-3 href=#__codelineno-34-3></a><span class=kn>import</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-34-4 name=__codelineno-34-4 href=#__codelineno-34-4></a><span class=w>    </span><span class=s>&quot;context&quot;</span>
<a id=__codelineno-34-5 name=__codelineno-34-5 href=#__codelineno-34-5></a><span class=w>    </span><span class=s>&quot;encoding/json&quot;</span>
<a id=__codelineno-34-6 name=__codelineno-34-6 href=#__codelineno-34-6></a><span class=w>    </span><span class=s>&quot;errors&quot;</span>
<a id=__codelineno-34-7 name=__codelineno-34-7 href=#__codelineno-34-7></a><span class=w>    </span><span class=s>&quot;strconv&quot;</span>
<a id=__codelineno-34-8 name=__codelineno-34-8 href=#__codelineno-34-8></a><span class=w>    </span><span class=s>&quot;time&quot;</span>
<a id=__codelineno-34-9 name=__codelineno-34-9 href=#__codelineno-34-9></a>
<a id=__codelineno-34-10 name=__codelineno-34-10 href=#__codelineno-34-10></a><span class=w>    </span><span class=nx>corev1</span><span class=w> </span><span class=s>&quot;k8s.io/api/core/v1&quot;</span>
<a id=__codelineno-34-11 name=__codelineno-34-11 href=#__codelineno-34-11></a><span class=w>    </span><span class=s>&quot;k8s.io/apimachinery/pkg/api/resource&quot;</span>
<a id=__codelineno-34-12 name=__codelineno-34-12 href=#__codelineno-34-12></a><span class=w>    </span><span class=s>&quot;k8s.io/apimachinery/pkg/util/intstr&quot;</span>
<a id=__codelineno-34-13 name=__codelineno-34-13 href=#__codelineno-34-13></a>
<a id=__codelineno-34-14 name=__codelineno-34-14 href=#__codelineno-34-14></a><span class=w>    </span><span class=s>&quot;github.com/wonderivan/logger&quot;</span>
<a id=__codelineno-34-15 name=__codelineno-34-15 href=#__codelineno-34-15></a><span class=w>    </span><span class=nx>appsv1</span><span class=w> </span><span class=s>&quot;k8s.io/api/apps/v1&quot;</span>
<a id=__codelineno-34-16 name=__codelineno-34-16 href=#__codelineno-34-16></a><span class=w>    </span><span class=nx>metav1</span><span class=w> </span><span class=s>&quot;k8s.io/apimachinery/pkg/apis/meta/v1&quot;</span>
<a id=__codelineno-34-17 name=__codelineno-34-17 href=#__codelineno-34-17></a><span class=p>)</span>
<a id=__codelineno-34-18 name=__codelineno-34-18 href=#__codelineno-34-18></a>
<a id=__codelineno-34-19 name=__codelineno-34-19 href=#__codelineno-34-19></a><span class=kd>var</span><span class=w> </span><span class=nx>Deployment</span><span class=w> </span><span class=nx>deployment</span>
<a id=__codelineno-34-20 name=__codelineno-34-20 href=#__codelineno-34-20></a>
<a id=__codelineno-34-21 name=__codelineno-34-21 href=#__codelineno-34-21></a><span class=kd>type</span><span class=w> </span><span class=nx>deployment</span><span class=w> </span><span class=kd>struct</span><span class=p>{}</span>
<a id=__codelineno-34-22 name=__codelineno-34-22 href=#__codelineno-34-22></a>
<a id=__codelineno-34-23 name=__codelineno-34-23 href=#__codelineno-34-23></a><span class=c1>// DeploymentsResp 定义列表的返回内容，Items是deployment元素列表，Total为deployment元素数量</span>
<a id=__codelineno-34-24 name=__codelineno-34-24 href=#__codelineno-34-24></a><span class=kd>type</span><span class=w> </span><span class=nx>DeploymentsResp</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-34-25 name=__codelineno-34-25 href=#__codelineno-34-25></a><span class=w>    </span><span class=nx>Items</span><span class=w> </span><span class=p>[]</span><span class=nx>appsv1</span><span class=p>.</span><span class=nx>Deployment</span><span class=w> </span><span class=s>`json:&quot;items&quot;`</span>
<a id=__codelineno-34-26 name=__codelineno-34-26 href=#__codelineno-34-26></a><span class=w>    </span><span class=nx>Total</span><span class=w> </span><span class=kt>int</span><span class=w>                 </span><span class=s>`json:&quot;total&quot;`</span>
<a id=__codelineno-34-27 name=__codelineno-34-27 href=#__codelineno-34-27></a><span class=p>}</span>
<a id=__codelineno-34-28 name=__codelineno-34-28 href=#__codelineno-34-28></a>
<a id=__codelineno-34-29 name=__codelineno-34-29 href=#__codelineno-34-29></a><span class=c1>// DeployCreate 结构体，用于创建deployment需要的参数属性的定义</span>
<a id=__codelineno-34-30 name=__codelineno-34-30 href=#__codelineno-34-30></a><span class=kd>type</span><span class=w> </span><span class=nx>DeployCreate</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-34-31 name=__codelineno-34-31 href=#__codelineno-34-31></a><span class=w>    </span><span class=nx>Name</span><span class=w>          </span><span class=kt>string</span><span class=w>            </span><span class=s>`json:&quot;name&quot;`</span>
<a id=__codelineno-34-32 name=__codelineno-34-32 href=#__codelineno-34-32></a><span class=w>    </span><span class=nx>Namespace</span><span class=w>     </span><span class=kt>string</span><span class=w>            </span><span class=s>`json:&quot;namespace&quot;`</span>
<a id=__codelineno-34-33 name=__codelineno-34-33 href=#__codelineno-34-33></a><span class=w>    </span><span class=nx>Replicas</span><span class=w>      </span><span class=kt>int32</span><span class=w>             </span><span class=s>`json:&quot;replicas&quot;`</span>
<a id=__codelineno-34-34 name=__codelineno-34-34 href=#__codelineno-34-34></a><span class=w>    </span><span class=nx>Image</span><span class=w>         </span><span class=kt>string</span><span class=w>            </span><span class=s>`json:&quot;image&quot;`</span>
<a id=__codelineno-34-35 name=__codelineno-34-35 href=#__codelineno-34-35></a><span class=w>    </span><span class=nx>Label</span><span class=w>         </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;label&quot;`</span>
<a id=__codelineno-34-36 name=__codelineno-34-36 href=#__codelineno-34-36></a><span class=w>    </span><span class=nx>Cpu</span><span class=w>           </span><span class=kt>string</span><span class=w>            </span><span class=s>`json:&quot;cpu&quot;`</span>
<a id=__codelineno-34-37 name=__codelineno-34-37 href=#__codelineno-34-37></a><span class=w>    </span><span class=nx>Memory</span><span class=w>        </span><span class=kt>string</span><span class=w>            </span><span class=s>`json:&quot;memory&quot;`</span>
<a id=__codelineno-34-38 name=__codelineno-34-38 href=#__codelineno-34-38></a><span class=w>    </span><span class=nx>ContainerPort</span><span class=w> </span><span class=kt>int32</span><span class=w>             </span><span class=s>`json:&quot;container_port&quot;`</span>
<a id=__codelineno-34-39 name=__codelineno-34-39 href=#__codelineno-34-39></a><span class=w>    </span><span class=nx>HealthCheck</span><span class=w>   </span><span class=kt>bool</span><span class=w>              </span><span class=s>`json:&quot;health_check&quot;`</span>
<a id=__codelineno-34-40 name=__codelineno-34-40 href=#__codelineno-34-40></a><span class=w>    </span><span class=nx>HealthPath</span><span class=w>    </span><span class=kt>string</span><span class=w>            </span><span class=s>`json:&quot;health_path&quot;`</span>
<a id=__codelineno-34-41 name=__codelineno-34-41 href=#__codelineno-34-41></a><span class=p>}</span>
<a id=__codelineno-34-42 name=__codelineno-34-42 href=#__codelineno-34-42></a>
<a id=__codelineno-34-43 name=__codelineno-34-43 href=#__codelineno-34-43></a><span class=c1>// DeploysNp 类型，用于返回namespace中deployment的数量</span>
<a id=__codelineno-34-44 name=__codelineno-34-44 href=#__codelineno-34-44></a><span class=kd>type</span><span class=w> </span><span class=nx>DeploysNp</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-34-45 name=__codelineno-34-45 href=#__codelineno-34-45></a><span class=w>    </span><span class=nx>Namespace</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;namespace&quot;`</span>
<a id=__codelineno-34-46 name=__codelineno-34-46 href=#__codelineno-34-46></a><span class=w>    </span><span class=nx>DeployNum</span><span class=w> </span><span class=kt>int</span><span class=w>    </span><span class=s>`json:&quot;deployment_num&quot;`</span>
<a id=__codelineno-34-47 name=__codelineno-34-47 href=#__codelineno-34-47></a><span class=p>}</span>
<a id=__codelineno-34-48 name=__codelineno-34-48 href=#__codelineno-34-48></a>
<a id=__codelineno-34-49 name=__codelineno-34-49 href=#__codelineno-34-49></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>deployment</span><span class=p>)</span><span class=w> </span><span class=nx>toCells</span><span class=p>(</span><span class=nx>std</span><span class=w> </span><span class=p>[]</span><span class=nx>appsv1</span><span class=p>.</span><span class=nx>Deployment</span><span class=p>)</span><span class=w> </span><span class=p>[]</span><span class=nx>DataCell</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-34-50 name=__codelineno-34-50 href=#__codelineno-34-50></a><span class=w>    </span><span class=nx>cells</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>make</span><span class=p>([]</span><span class=nx>DataCell</span><span class=p>,</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>std</span><span class=p>))</span>
<a id=__codelineno-34-51 name=__codelineno-34-51 href=#__codelineno-34-51></a><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=nx>i</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>std</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-34-52 name=__codelineno-34-52 href=#__codelineno-34-52></a><span class=w>        </span><span class=nx>cells</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>deploymentCell</span><span class=p>(</span><span class=nx>std</span><span class=p>[</span><span class=nx>i</span><span class=p>])</span>
<a id=__codelineno-34-53 name=__codelineno-34-53 href=#__codelineno-34-53></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-34-54 name=__codelineno-34-54 href=#__codelineno-34-54></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>cells</span>
<a id=__codelineno-34-55 name=__codelineno-34-55 href=#__codelineno-34-55></a><span class=p>}</span>
<a id=__codelineno-34-56 name=__codelineno-34-56 href=#__codelineno-34-56></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>deployment</span><span class=p>)</span><span class=w> </span><span class=nx>fromCells</span><span class=p>(</span><span class=nx>cells</span><span class=w> </span><span class=p>[]</span><span class=nx>DataCell</span><span class=p>)</span><span class=w> </span><span class=p>[]</span><span class=nx>appsv1</span><span class=p>.</span><span class=nx>Deployment</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-34-57 name=__codelineno-34-57 href=#__codelineno-34-57></a><span class=w>    </span><span class=nx>deployments</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>make</span><span class=p>([]</span><span class=nx>appsv1</span><span class=p>.</span><span class=nx>Deployment</span><span class=p>,</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>cells</span><span class=p>))</span>
<a id=__codelineno-34-58 name=__codelineno-34-58 href=#__codelineno-34-58></a><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=nx>i</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>cells</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-34-59 name=__codelineno-34-59 href=#__codelineno-34-59></a><span class=w>        </span><span class=nx>deployments</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>appsv1</span><span class=p>.</span><span class=nx>Deployment</span><span class=p>(</span><span class=nx>cells</span><span class=p>[</span><span class=nx>i</span><span class=p>].(</span><span class=nx>deploymentCell</span><span class=p>))</span>
<a id=__codelineno-34-60 name=__codelineno-34-60 href=#__codelineno-34-60></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-34-61 name=__codelineno-34-61 href=#__codelineno-34-61></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>deployments</span>
<a id=__codelineno-34-62 name=__codelineno-34-62 href=#__codelineno-34-62></a><span class=p>}</span>
<a id=__codelineno-34-63 name=__codelineno-34-63 href=#__codelineno-34-63></a>
<a id=__codelineno-34-64 name=__codelineno-34-64 href=#__codelineno-34-64></a><span class=c1>// GetDeployments 获取deployment列表，支持过滤、排序、分页</span>
<a id=__codelineno-34-65 name=__codelineno-34-65 href=#__codelineno-34-65></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>deployment</span><span class=p>)</span><span class=w> </span><span class=nx>GetDeployments</span><span class=p>(</span><span class=nx>filterName</span><span class=p>,</span><span class=w> </span><span class=nx>namespace</span><span class=w> </span><span class=kt>string</span><span class=p>,</span><span class=w> </span><span class=nx>limit</span><span class=p>,</span><span class=w> </span><span class=nx>page</span><span class=w> </span><span class=kt>int</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>deploymentsResp</span><span class=w> </span><span class=o>*</span><span class=nx>DeploymentsResp</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-34-66 name=__codelineno-34-66 href=#__codelineno-34-66></a><span class=w>    </span><span class=c1>//获取deploymentList类型的deployment列表</span>
<a id=__codelineno-34-67 name=__codelineno-34-67 href=#__codelineno-34-67></a><span class=w>    </span><span class=nx>deploymentList</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>AppsV1</span><span class=p>().</span><span class=nx>Deployments</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span><span class=nx>List</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>ListOptions</span><span class=p>{})</span>
<a id=__codelineno-34-68 name=__codelineno-34-68 href=#__codelineno-34-68></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-34-69 name=__codelineno-34-69 href=#__codelineno-34-69></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取Deployment列表失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-34-70 name=__codelineno-34-70 href=#__codelineno-34-70></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取Deployment列表失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-34-71 name=__codelineno-34-71 href=#__codelineno-34-71></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-34-72 name=__codelineno-34-72 href=#__codelineno-34-72></a><span class=w>    </span><span class=c1>//将deploymentList中的deployment列表(Items),放进dataselector对象中，进行排序</span>
<a id=__codelineno-34-73 name=__codelineno-34-73 href=#__codelineno-34-73></a><span class=w>    </span><span class=nx>selectableData</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>dataSelector</span><span class=p>{</span>
<a id=__codelineno-34-74 name=__codelineno-34-74 href=#__codelineno-34-74></a><span class=w>        </span><span class=nx>GenericDataList</span><span class=p>:</span><span class=w> </span><span class=nx>d</span><span class=p>.</span><span class=nx>toCells</span><span class=p>(</span><span class=nx>deploymentList</span><span class=p>.</span><span class=nx>Items</span><span class=p>),</span>
<a id=__codelineno-34-75 name=__codelineno-34-75 href=#__codelineno-34-75></a><span class=w>        </span><span class=nx>dataSelectQuery</span><span class=p>:</span><span class=w> </span><span class=o>&amp;</span><span class=nx>DataSelectQuery</span><span class=p>{</span>
<a id=__codelineno-34-76 name=__codelineno-34-76 href=#__codelineno-34-76></a><span class=w>            </span><span class=nx>FilterQuery</span><span class=p>:</span><span class=w> </span><span class=o>&amp;</span><span class=nx>FilterQuery</span><span class=p>{</span><span class=nx>Name</span><span class=p>:</span><span class=w> </span><span class=nx>filterName</span><span class=p>},</span>
<a id=__codelineno-34-77 name=__codelineno-34-77 href=#__codelineno-34-77></a><span class=w>            </span><span class=nx>PaginateQuery</span><span class=p>:</span><span class=w> </span><span class=o>&amp;</span><span class=nx>PaginateQuery</span><span class=p>{</span>
<a id=__codelineno-34-78 name=__codelineno-34-78 href=#__codelineno-34-78></a><span class=w>                </span><span class=nx>Limit</span><span class=p>:</span><span class=w> </span><span class=nx>limit</span><span class=p>,</span>
<a id=__codelineno-34-79 name=__codelineno-34-79 href=#__codelineno-34-79></a><span class=w>                </span><span class=nx>Page</span><span class=p>:</span><span class=w>  </span><span class=nx>page</span><span class=p>,</span>
<a id=__codelineno-34-80 name=__codelineno-34-80 href=#__codelineno-34-80></a><span class=w>            </span><span class=p>},</span>
<a id=__codelineno-34-81 name=__codelineno-34-81 href=#__codelineno-34-81></a><span class=w>        </span><span class=p>},</span>
<a id=__codelineno-34-82 name=__codelineno-34-82 href=#__codelineno-34-82></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-34-83 name=__codelineno-34-83 href=#__codelineno-34-83></a><span class=w>    </span><span class=nx>filtered</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>selectableData</span><span class=p>.</span><span class=nx>Filter</span><span class=p>()</span>
<a id=__codelineno-34-84 name=__codelineno-34-84 href=#__codelineno-34-84></a><span class=w>    </span><span class=nx>total</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>filtered</span><span class=p>.</span><span class=nx>GenericDataList</span><span class=p>)</span>
<a id=__codelineno-34-85 name=__codelineno-34-85 href=#__codelineno-34-85></a><span class=w>    </span><span class=nx>data</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>filtered</span><span class=p>.</span><span class=nx>Sort</span><span class=p>().</span><span class=nx>Paginate</span><span class=p>()</span>
<a id=__codelineno-34-86 name=__codelineno-34-86 href=#__codelineno-34-86></a><span class=w>    </span><span class=c1>//将[]DataCell类型的deployment列表转为appsv1.deployment列表</span>
<a id=__codelineno-34-87 name=__codelineno-34-87 href=#__codelineno-34-87></a><span class=w>    </span><span class=nx>deployments</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>d</span><span class=p>.</span><span class=nx>fromCells</span><span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>GenericDataList</span><span class=p>)</span>
<a id=__codelineno-34-88 name=__codelineno-34-88 href=#__codelineno-34-88></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=o>&amp;</span><span class=nx>DeploymentsResp</span><span class=p>{</span>
<a id=__codelineno-34-89 name=__codelineno-34-89 href=#__codelineno-34-89></a><span class=w>        </span><span class=nx>Items</span><span class=p>:</span><span class=w> </span><span class=nx>deployments</span><span class=p>,</span>
<a id=__codelineno-34-90 name=__codelineno-34-90 href=#__codelineno-34-90></a><span class=w>        </span><span class=nx>Total</span><span class=p>:</span><span class=w> </span><span class=nx>total</span><span class=p>,</span>
<a id=__codelineno-34-91 name=__codelineno-34-91 href=#__codelineno-34-91></a><span class=w>    </span><span class=p>},</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-34-92 name=__codelineno-34-92 href=#__codelineno-34-92></a><span class=p>}</span>
<a id=__codelineno-34-93 name=__codelineno-34-93 href=#__codelineno-34-93></a>
<a id=__codelineno-34-94 name=__codelineno-34-94 href=#__codelineno-34-94></a><span class=c1>// GetDeploymentDetail 获取deployment详情</span>
<a id=__codelineno-34-95 name=__codelineno-34-95 href=#__codelineno-34-95></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>deployment</span><span class=p>)</span><span class=w> </span><span class=nx>GetDeploymentDetail</span><span class=p>(</span><span class=nx>deploymentName</span><span class=p>,</span><span class=w> </span><span class=nx>namespace</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>deployment</span><span class=w> </span><span class=o>*</span><span class=nx>appsv1</span><span class=p>.</span><span class=nx>Deployment</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-34-96 name=__codelineno-34-96 href=#__codelineno-34-96></a><span class=w>    </span><span class=nx>deployment</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>AppsV1</span><span class=p>().</span><span class=nx>Deployments</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span><span class=nx>Get</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>deploymentName</span><span class=p>,</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>GetOptions</span><span class=p>{})</span>
<a id=__codelineno-34-97 name=__codelineno-34-97 href=#__codelineno-34-97></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-34-98 name=__codelineno-34-98 href=#__codelineno-34-98></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取Deployment详情失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-34-99 name=__codelineno-34-99 href=#__codelineno-34-99></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取Deployment详情失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-34-100 name=__codelineno-34-100 href=#__codelineno-34-100></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-34-101 name=__codelineno-34-101 href=#__codelineno-34-101></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>deployment</span><span class=p>,</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-34-102 name=__codelineno-34-102 href=#__codelineno-34-102></a><span class=p>}</span>
<a id=__codelineno-34-103 name=__codelineno-34-103 href=#__codelineno-34-103></a>
<a id=__codelineno-34-104 name=__codelineno-34-104 href=#__codelineno-34-104></a><span class=c1>// ScaleDeployment 设置deployment副本数</span>
<a id=__codelineno-34-105 name=__codelineno-34-105 href=#__codelineno-34-105></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>deployment</span><span class=p>)</span><span class=w> </span><span class=nx>ScaleDeployment</span><span class=p>(</span><span class=nx>deploymentName</span><span class=p>,</span><span class=w> </span><span class=nx>namespace</span><span class=w> </span><span class=kt>string</span><span class=p>,</span><span class=w> </span><span class=nx>scaleNum</span><span class=w> </span><span class=kt>int</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>replica</span><span class=w> </span><span class=kt>int32</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-34-106 name=__codelineno-34-106 href=#__codelineno-34-106></a><span class=w>    </span><span class=c1>//获取autoscalingv1.Scale类型的对象，能点出当前的副本数</span>
<a id=__codelineno-34-107 name=__codelineno-34-107 href=#__codelineno-34-107></a><span class=w>    </span><span class=nx>scale</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>AppsV1</span><span class=p>().</span><span class=nx>Deployments</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span><span class=nx>GetScale</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>deploymentName</span><span class=p>,</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>GetOptions</span><span class=p>{})</span>
<a id=__codelineno-34-108 name=__codelineno-34-108 href=#__codelineno-34-108></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-34-109 name=__codelineno-34-109 href=#__codelineno-34-109></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取Deployment副本数信息失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-34-110 name=__codelineno-34-110 href=#__codelineno-34-110></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取Deployment副本数信息失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-34-111 name=__codelineno-34-111 href=#__codelineno-34-111></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-34-112 name=__codelineno-34-112 href=#__codelineno-34-112></a><span class=w>    </span><span class=c1>//修改副本数</span>
<a id=__codelineno-34-113 name=__codelineno-34-113 href=#__codelineno-34-113></a><span class=w>    </span><span class=nx>scale</span><span class=p>.</span><span class=nx>Spec</span><span class=p>.</span><span class=nx>Replicas</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nb>int32</span><span class=p>(</span><span class=nx>scaleNum</span><span class=p>)</span>
<a id=__codelineno-34-114 name=__codelineno-34-114 href=#__codelineno-34-114></a><span class=w>    </span><span class=c1>//更新副本数，传入scale对象</span>
<a id=__codelineno-34-115 name=__codelineno-34-115 href=#__codelineno-34-115></a><span class=w>    </span><span class=nx>newScale</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>AppsV1</span><span class=p>().</span><span class=nx>Deployments</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span><span class=nx>UpdateScale</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>deploymentName</span><span class=p>,</span><span class=w> </span><span class=nx>scale</span><span class=p>,</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>UpdateOptions</span><span class=p>{})</span>
<a id=__codelineno-34-116 name=__codelineno-34-116 href=#__codelineno-34-116></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-34-117 name=__codelineno-34-117 href=#__codelineno-34-117></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;更新Deployment副本数信息失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-34-118 name=__codelineno-34-118 href=#__codelineno-34-118></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;更新Deployment副本数信息失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-34-119 name=__codelineno-34-119 href=#__codelineno-34-119></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-34-120 name=__codelineno-34-120 href=#__codelineno-34-120></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>newScale</span><span class=p>.</span><span class=nx>Spec</span><span class=p>.</span><span class=nx>Replicas</span><span class=p>,</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-34-121 name=__codelineno-34-121 href=#__codelineno-34-121></a><span class=p>}</span>
<a id=__codelineno-34-122 name=__codelineno-34-122 href=#__codelineno-34-122></a>
<a id=__codelineno-34-123 name=__codelineno-34-123 href=#__codelineno-34-123></a><span class=c1>// CreateDeployment 创建deployment，接收DeployCreate对象</span>
<a id=__codelineno-34-124 name=__codelineno-34-124 href=#__codelineno-34-124></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>deployment</span><span class=p>)</span><span class=w> </span><span class=nx>CreateDeployment</span><span class=p>(</span><span class=nx>data</span><span class=w> </span><span class=o>*</span><span class=nx>DeployCreate</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-34-125 name=__codelineno-34-125 href=#__codelineno-34-125></a><span class=w>    </span><span class=c1>//将data中的数据组装成appsv1.Deployment对象</span>
<a id=__codelineno-34-126 name=__codelineno-34-126 href=#__codelineno-34-126></a><span class=w>    </span><span class=nx>deployment</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>appsv1</span><span class=p>.</span><span class=nx>Deployment</span><span class=p>{</span>
<a id=__codelineno-34-127 name=__codelineno-34-127 href=#__codelineno-34-127></a><span class=w>        </span><span class=c1>//ObjectMeta中定义资源名、命名空间以及标签</span>
<a id=__codelineno-34-128 name=__codelineno-34-128 href=#__codelineno-34-128></a><span class=w>        </span><span class=nx>ObjectMeta</span><span class=p>:</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>ObjectMeta</span><span class=p>{</span>
<a id=__codelineno-34-129 name=__codelineno-34-129 href=#__codelineno-34-129></a><span class=w>            </span><span class=nx>Name</span><span class=p>:</span><span class=w>      </span><span class=nx>data</span><span class=p>.</span><span class=nx>Name</span><span class=p>,</span>
<a id=__codelineno-34-130 name=__codelineno-34-130 href=#__codelineno-34-130></a><span class=w>            </span><span class=nx>Namespace</span><span class=p>:</span><span class=w> </span><span class=nx>data</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>,</span>
<a id=__codelineno-34-131 name=__codelineno-34-131 href=#__codelineno-34-131></a><span class=w>            </span><span class=nx>Labels</span><span class=p>:</span><span class=w>    </span><span class=nx>data</span><span class=p>.</span><span class=nx>Label</span><span class=p>,</span>
<a id=__codelineno-34-132 name=__codelineno-34-132 href=#__codelineno-34-132></a><span class=w>        </span><span class=p>},</span>
<a id=__codelineno-34-133 name=__codelineno-34-133 href=#__codelineno-34-133></a><span class=w>        </span><span class=c1>//Spec中定义副本数、选择器、以及pod属性</span>
<a id=__codelineno-34-134 name=__codelineno-34-134 href=#__codelineno-34-134></a><span class=w>        </span><span class=nx>Spec</span><span class=p>:</span><span class=w> </span><span class=nx>appsv1</span><span class=p>.</span><span class=nx>DeploymentSpec</span><span class=p>{</span>
<a id=__codelineno-34-135 name=__codelineno-34-135 href=#__codelineno-34-135></a><span class=w>            </span><span class=nx>Replicas</span><span class=p>:</span><span class=w> </span><span class=o>&amp;</span><span class=nx>data</span><span class=p>.</span><span class=nx>Replicas</span><span class=p>,</span>
<a id=__codelineno-34-136 name=__codelineno-34-136 href=#__codelineno-34-136></a><span class=w>            </span><span class=nx>Selector</span><span class=p>:</span><span class=w> </span><span class=o>&amp;</span><span class=nx>metav1</span><span class=p>.</span><span class=nx>LabelSelector</span><span class=p>{</span>
<a id=__codelineno-34-137 name=__codelineno-34-137 href=#__codelineno-34-137></a><span class=w>                </span><span class=nx>MatchLabels</span><span class=p>:</span><span class=w> </span><span class=nx>data</span><span class=p>.</span><span class=nx>Label</span><span class=p>,</span>
<a id=__codelineno-34-138 name=__codelineno-34-138 href=#__codelineno-34-138></a><span class=w>            </span><span class=p>},</span>
<a id=__codelineno-34-139 name=__codelineno-34-139 href=#__codelineno-34-139></a><span class=w>            </span><span class=nx>Template</span><span class=p>:</span><span class=w> </span><span class=nx>corev1</span><span class=p>.</span><span class=nx>PodTemplateSpec</span><span class=p>{</span>
<a id=__codelineno-34-140 name=__codelineno-34-140 href=#__codelineno-34-140></a><span class=w>                </span><span class=c1>//定义pod名和标签</span>
<a id=__codelineno-34-141 name=__codelineno-34-141 href=#__codelineno-34-141></a><span class=w>                </span><span class=nx>ObjectMeta</span><span class=p>:</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>ObjectMeta</span><span class=p>{</span>
<a id=__codelineno-34-142 name=__codelineno-34-142 href=#__codelineno-34-142></a><span class=w>                    </span><span class=nx>Name</span><span class=p>:</span><span class=w>   </span><span class=nx>data</span><span class=p>.</span><span class=nx>Name</span><span class=p>,</span>
<a id=__codelineno-34-143 name=__codelineno-34-143 href=#__codelineno-34-143></a><span class=w>                    </span><span class=nx>Labels</span><span class=p>:</span><span class=w> </span><span class=nx>data</span><span class=p>.</span><span class=nx>Label</span><span class=p>,</span>
<a id=__codelineno-34-144 name=__codelineno-34-144 href=#__codelineno-34-144></a><span class=w>                </span><span class=p>},</span>
<a id=__codelineno-34-145 name=__codelineno-34-145 href=#__codelineno-34-145></a><span class=w>                </span><span class=c1>//定义容器名、镜像和端口</span>
<a id=__codelineno-34-146 name=__codelineno-34-146 href=#__codelineno-34-146></a><span class=w>                </span><span class=nx>Spec</span><span class=p>:</span><span class=w> </span><span class=nx>corev1</span><span class=p>.</span><span class=nx>PodSpec</span><span class=p>{</span>
<a id=__codelineno-34-147 name=__codelineno-34-147 href=#__codelineno-34-147></a><span class=w>                    </span><span class=nx>Containers</span><span class=p>:</span><span class=w> </span><span class=p>[]</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>Container</span><span class=p>{</span>
<a id=__codelineno-34-148 name=__codelineno-34-148 href=#__codelineno-34-148></a><span class=w>                        </span><span class=p>{</span>
<a id=__codelineno-34-149 name=__codelineno-34-149 href=#__codelineno-34-149></a><span class=w>                            </span><span class=nx>Name</span><span class=p>:</span><span class=w>  </span><span class=nx>data</span><span class=p>.</span><span class=nx>Name</span><span class=p>,</span>
<a id=__codelineno-34-150 name=__codelineno-34-150 href=#__codelineno-34-150></a><span class=w>                            </span><span class=nx>Image</span><span class=p>:</span><span class=w> </span><span class=nx>data</span><span class=p>.</span><span class=nx>Image</span><span class=p>,</span>
<a id=__codelineno-34-151 name=__codelineno-34-151 href=#__codelineno-34-151></a><span class=w>                            </span><span class=nx>Ports</span><span class=p>:</span><span class=w> </span><span class=p>[]</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>ContainerPort</span><span class=p>{</span>
<a id=__codelineno-34-152 name=__codelineno-34-152 href=#__codelineno-34-152></a><span class=w>                                </span><span class=p>{</span>
<a id=__codelineno-34-153 name=__codelineno-34-153 href=#__codelineno-34-153></a><span class=w>                                    </span><span class=nx>Name</span><span class=p>:</span><span class=w>          </span><span class=s>&quot;http&quot;</span><span class=p>,</span>
<a id=__codelineno-34-154 name=__codelineno-34-154 href=#__codelineno-34-154></a><span class=w>                                    </span><span class=nx>Protocol</span><span class=p>:</span><span class=w>      </span><span class=nx>corev1</span><span class=p>.</span><span class=nx>ProtocolTCP</span><span class=p>,</span>
<a id=__codelineno-34-155 name=__codelineno-34-155 href=#__codelineno-34-155></a><span class=w>                                    </span><span class=nx>ContainerPort</span><span class=p>:</span><span class=w> </span><span class=nx>data</span><span class=p>.</span><span class=nx>ContainerPort</span><span class=p>,</span>
<a id=__codelineno-34-156 name=__codelineno-34-156 href=#__codelineno-34-156></a><span class=w>                                </span><span class=p>},</span>
<a id=__codelineno-34-157 name=__codelineno-34-157 href=#__codelineno-34-157></a><span class=w>                            </span><span class=p>},</span>
<a id=__codelineno-34-158 name=__codelineno-34-158 href=#__codelineno-34-158></a><span class=w>                        </span><span class=p>},</span>
<a id=__codelineno-34-159 name=__codelineno-34-159 href=#__codelineno-34-159></a><span class=w>                    </span><span class=p>},</span>
<a id=__codelineno-34-160 name=__codelineno-34-160 href=#__codelineno-34-160></a><span class=w>                </span><span class=p>},</span>
<a id=__codelineno-34-161 name=__codelineno-34-161 href=#__codelineno-34-161></a><span class=w>            </span><span class=p>},</span>
<a id=__codelineno-34-162 name=__codelineno-34-162 href=#__codelineno-34-162></a><span class=w>        </span><span class=p>},</span>
<a id=__codelineno-34-163 name=__codelineno-34-163 href=#__codelineno-34-163></a><span class=w>        </span><span class=c1>//Status定义资源的运行状态，这里由于是新建，传入空的appsv1.DeploymentStatus{}对象即可</span>
<a id=__codelineno-34-164 name=__codelineno-34-164 href=#__codelineno-34-164></a><span class=w>        </span><span class=nx>Status</span><span class=p>:</span><span class=w> </span><span class=nx>appsv1</span><span class=p>.</span><span class=nx>DeploymentStatus</span><span class=p>{},</span>
<a id=__codelineno-34-165 name=__codelineno-34-165 href=#__codelineno-34-165></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-34-166 name=__codelineno-34-166 href=#__codelineno-34-166></a><span class=w>    </span><span class=c1>//判断是否打开健康检查功能，若打开，则定义ReadinessProbe和LivenessProbe</span>
<a id=__codelineno-34-167 name=__codelineno-34-167 href=#__codelineno-34-167></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>data</span><span class=p>.</span><span class=nx>HealthCheck</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-34-168 name=__codelineno-34-168 href=#__codelineno-34-168></a><span class=w>        </span><span class=c1>//设置第一个容器的ReadinessProbe,因为我们pod中只有一个容器，所以直接使用index 0即可</span>
<a id=__codelineno-34-169 name=__codelineno-34-169 href=#__codelineno-34-169></a><span class=w>        </span><span class=c1>//若pod中有多个容器，则这里需要使用for循环去定义了</span>
<a id=__codelineno-34-170 name=__codelineno-34-170 href=#__codelineno-34-170></a><span class=w>        </span><span class=nx>deployment</span><span class=p>.</span><span class=nx>Spec</span><span class=p>.</span><span class=nx>Template</span><span class=p>.</span><span class=nx>Spec</span><span class=p>.</span><span class=nx>Containers</span><span class=p>[</span><span class=mi>0</span><span class=p>].</span><span class=nx>ReadinessProbe</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>Probe</span><span class=p>{</span>
<a id=__codelineno-34-171 name=__codelineno-34-171 href=#__codelineno-34-171></a><span class=w>            </span><span class=nx>ProbeHandler</span><span class=p>:</span><span class=w> </span><span class=nx>corev1</span><span class=p>.</span><span class=nx>ProbeHandler</span><span class=p>{</span>
<a id=__codelineno-34-172 name=__codelineno-34-172 href=#__codelineno-34-172></a><span class=w>                </span><span class=nx>HTTPGet</span><span class=p>:</span><span class=w> </span><span class=o>&amp;</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>HTTPGetAction</span><span class=p>{</span>
<a id=__codelineno-34-173 name=__codelineno-34-173 href=#__codelineno-34-173></a><span class=w>                    </span><span class=nx>Path</span><span class=p>:</span><span class=w> </span><span class=nx>data</span><span class=p>.</span><span class=nx>HealthPath</span><span class=p>,</span>
<a id=__codelineno-34-174 name=__codelineno-34-174 href=#__codelineno-34-174></a><span class=w>                    </span><span class=c1>//intstr.IntOrString的作用是端口可以定义为整型，也可以定义为字符串</span>
<a id=__codelineno-34-175 name=__codelineno-34-175 href=#__codelineno-34-175></a><span class=w>                    </span><span class=c1>//Type=0则表示该结构体实例内的数据为整型，转json时只使用IntVal的数据</span>
<a id=__codelineno-34-176 name=__codelineno-34-176 href=#__codelineno-34-176></a><span class=w>                    </span><span class=c1>//Type=1则表示该结构体实例内的数据为字符串，转json时只使用StrVal的数据</span>
<a id=__codelineno-34-177 name=__codelineno-34-177 href=#__codelineno-34-177></a><span class=w>                    </span><span class=nx>Port</span><span class=p>:</span><span class=w> </span><span class=nx>intstr</span><span class=p>.</span><span class=nx>IntOrString</span><span class=p>{</span>
<a id=__codelineno-34-178 name=__codelineno-34-178 href=#__codelineno-34-178></a><span class=w>                        </span><span class=nx>Type</span><span class=p>:</span><span class=w>   </span><span class=mi>0</span><span class=p>,</span>
<a id=__codelineno-34-179 name=__codelineno-34-179 href=#__codelineno-34-179></a><span class=w>                        </span><span class=nx>IntVal</span><span class=p>:</span><span class=w> </span><span class=nx>data</span><span class=p>.</span><span class=nx>ContainerPort</span><span class=p>,</span>
<a id=__codelineno-34-180 name=__codelineno-34-180 href=#__codelineno-34-180></a><span class=w>                    </span><span class=p>},</span>
<a id=__codelineno-34-181 name=__codelineno-34-181 href=#__codelineno-34-181></a><span class=w>                </span><span class=p>},</span>
<a id=__codelineno-34-182 name=__codelineno-34-182 href=#__codelineno-34-182></a><span class=w>            </span><span class=p>},</span>
<a id=__codelineno-34-183 name=__codelineno-34-183 href=#__codelineno-34-183></a><span class=w>            </span><span class=c1>//初始化等待时间</span>
<a id=__codelineno-34-184 name=__codelineno-34-184 href=#__codelineno-34-184></a><span class=w>            </span><span class=nx>InitialDelaySeconds</span><span class=p>:</span><span class=w> </span><span class=mi>5</span><span class=p>,</span>
<a id=__codelineno-34-185 name=__codelineno-34-185 href=#__codelineno-34-185></a><span class=w>            </span><span class=c1>//超时时间</span>
<a id=__codelineno-34-186 name=__codelineno-34-186 href=#__codelineno-34-186></a><span class=w>            </span><span class=nx>TimeoutSeconds</span><span class=p>:</span><span class=w> </span><span class=mi>5</span><span class=p>,</span>
<a id=__codelineno-34-187 name=__codelineno-34-187 href=#__codelineno-34-187></a><span class=w>            </span><span class=c1>//执行间隔</span>
<a id=__codelineno-34-188 name=__codelineno-34-188 href=#__codelineno-34-188></a><span class=w>            </span><span class=nx>PeriodSeconds</span><span class=p>:</span><span class=w> </span><span class=mi>5</span><span class=p>,</span>
<a id=__codelineno-34-189 name=__codelineno-34-189 href=#__codelineno-34-189></a><span class=w>        </span><span class=p>}</span>
<a id=__codelineno-34-190 name=__codelineno-34-190 href=#__codelineno-34-190></a><span class=w>        </span><span class=nx>deployment</span><span class=p>.</span><span class=nx>Spec</span><span class=p>.</span><span class=nx>Template</span><span class=p>.</span><span class=nx>Spec</span><span class=p>.</span><span class=nx>Containers</span><span class=p>[</span><span class=mi>0</span><span class=p>].</span><span class=nx>LivenessProbe</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>Probe</span><span class=p>{</span>
<a id=__codelineno-34-191 name=__codelineno-34-191 href=#__codelineno-34-191></a><span class=w>            </span><span class=nx>ProbeHandler</span><span class=p>:</span><span class=w> </span><span class=nx>corev1</span><span class=p>.</span><span class=nx>ProbeHandler</span><span class=p>{</span>
<a id=__codelineno-34-192 name=__codelineno-34-192 href=#__codelineno-34-192></a><span class=w>                </span><span class=nx>HTTPGet</span><span class=p>:</span><span class=w> </span><span class=o>&amp;</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>HTTPGetAction</span><span class=p>{</span>
<a id=__codelineno-34-193 name=__codelineno-34-193 href=#__codelineno-34-193></a><span class=w>                    </span><span class=nx>Path</span><span class=p>:</span><span class=w> </span><span class=nx>data</span><span class=p>.</span><span class=nx>HealthPath</span><span class=p>,</span>
<a id=__codelineno-34-194 name=__codelineno-34-194 href=#__codelineno-34-194></a><span class=w>                    </span><span class=nx>Port</span><span class=p>:</span><span class=w> </span><span class=nx>intstr</span><span class=p>.</span><span class=nx>IntOrString</span><span class=p>{</span>
<a id=__codelineno-34-195 name=__codelineno-34-195 href=#__codelineno-34-195></a><span class=w>                        </span><span class=nx>Type</span><span class=p>:</span><span class=w>   </span><span class=mi>0</span><span class=p>,</span>
<a id=__codelineno-34-196 name=__codelineno-34-196 href=#__codelineno-34-196></a><span class=w>                        </span><span class=nx>IntVal</span><span class=p>:</span><span class=w> </span><span class=nx>data</span><span class=p>.</span><span class=nx>ContainerPort</span><span class=p>,</span>
<a id=__codelineno-34-197 name=__codelineno-34-197 href=#__codelineno-34-197></a><span class=w>                    </span><span class=p>},</span>
<a id=__codelineno-34-198 name=__codelineno-34-198 href=#__codelineno-34-198></a><span class=w>                </span><span class=p>},</span>
<a id=__codelineno-34-199 name=__codelineno-34-199 href=#__codelineno-34-199></a><span class=w>            </span><span class=p>},</span>
<a id=__codelineno-34-200 name=__codelineno-34-200 href=#__codelineno-34-200></a><span class=w>            </span><span class=nx>InitialDelaySeconds</span><span class=p>:</span><span class=w> </span><span class=mi>15</span><span class=p>,</span>
<a id=__codelineno-34-201 name=__codelineno-34-201 href=#__codelineno-34-201></a><span class=w>            </span><span class=nx>TimeoutSeconds</span><span class=p>:</span><span class=w>      </span><span class=mi>5</span><span class=p>,</span>
<a id=__codelineno-34-202 name=__codelineno-34-202 href=#__codelineno-34-202></a><span class=w>            </span><span class=nx>PeriodSeconds</span><span class=p>:</span><span class=w>       </span><span class=mi>5</span><span class=p>,</span>
<a id=__codelineno-34-203 name=__codelineno-34-203 href=#__codelineno-34-203></a><span class=w>        </span><span class=p>}</span>
<a id=__codelineno-34-204 name=__codelineno-34-204 href=#__codelineno-34-204></a><span class=w>        </span><span class=c1>//定义容器的limit和request资源</span>
<a id=__codelineno-34-205 name=__codelineno-34-205 href=#__codelineno-34-205></a><span class=w>        </span><span class=nx>deployment</span><span class=p>.</span><span class=nx>Spec</span><span class=p>.</span><span class=nx>Template</span><span class=p>.</span><span class=nx>Spec</span><span class=p>.</span><span class=nx>Containers</span><span class=p>[</span><span class=mi>0</span><span class=p>].</span><span class=nx>Resources</span><span class=p>.</span><span class=nx>Limits</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>ResourceName</span><span class=p>]</span><span class=nx>resource</span><span class=p>.</span><span class=nx>Quantity</span><span class=p>{</span>
<a id=__codelineno-34-206 name=__codelineno-34-206 href=#__codelineno-34-206></a><span class=w>            </span><span class=nx>corev1</span><span class=p>.</span><span class=nx>ResourceCPU</span><span class=p>:</span><span class=w>    </span><span class=nx>resource</span><span class=p>.</span><span class=nx>MustParse</span><span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>Cpu</span><span class=p>),</span>
<a id=__codelineno-34-207 name=__codelineno-34-207 href=#__codelineno-34-207></a><span class=w>            </span><span class=nx>corev1</span><span class=p>.</span><span class=nx>ResourceMemory</span><span class=p>:</span><span class=w> </span><span class=nx>resource</span><span class=p>.</span><span class=nx>MustParse</span><span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>Memory</span><span class=p>),</span>
<a id=__codelineno-34-208 name=__codelineno-34-208 href=#__codelineno-34-208></a><span class=w>        </span><span class=p>}</span>
<a id=__codelineno-34-209 name=__codelineno-34-209 href=#__codelineno-34-209></a><span class=w>        </span><span class=nx>deployment</span><span class=p>.</span><span class=nx>Spec</span><span class=p>.</span><span class=nx>Template</span><span class=p>.</span><span class=nx>Spec</span><span class=p>.</span><span class=nx>Containers</span><span class=p>[</span><span class=mi>0</span><span class=p>].</span><span class=nx>Resources</span><span class=p>.</span><span class=nx>Requests</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>ResourceName</span><span class=p>]</span><span class=nx>resource</span><span class=p>.</span><span class=nx>Quantity</span><span class=p>{</span>
<a id=__codelineno-34-210 name=__codelineno-34-210 href=#__codelineno-34-210></a><span class=w>            </span><span class=nx>corev1</span><span class=p>.</span><span class=nx>ResourceCPU</span><span class=p>:</span><span class=w>    </span><span class=nx>resource</span><span class=p>.</span><span class=nx>MustParse</span><span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>Cpu</span><span class=p>),</span>
<a id=__codelineno-34-211 name=__codelineno-34-211 href=#__codelineno-34-211></a><span class=w>            </span><span class=nx>corev1</span><span class=p>.</span><span class=nx>ResourceMemory</span><span class=p>:</span><span class=w> </span><span class=nx>resource</span><span class=p>.</span><span class=nx>MustParse</span><span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>Memory</span><span class=p>),</span>
<a id=__codelineno-34-212 name=__codelineno-34-212 href=#__codelineno-34-212></a><span class=w>        </span><span class=p>}</span>
<a id=__codelineno-34-213 name=__codelineno-34-213 href=#__codelineno-34-213></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-34-214 name=__codelineno-34-214 href=#__codelineno-34-214></a><span class=w>    </span><span class=c1>//调用sdk创建deployment</span>
<a id=__codelineno-34-215 name=__codelineno-34-215 href=#__codelineno-34-215></a><span class=w>    </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>AppsV1</span><span class=p>().</span><span class=nx>Deployments</span><span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>).</span><span class=nx>Create</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>deployment</span><span class=p>,</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>CreateOptions</span><span class=p>{})</span>
<a id=__codelineno-34-216 name=__codelineno-34-216 href=#__codelineno-34-216></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-34-217 name=__codelineno-34-217 href=#__codelineno-34-217></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;创建Deployment失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-34-218 name=__codelineno-34-218 href=#__codelineno-34-218></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;创建Deployment失败,&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-34-219 name=__codelineno-34-219 href=#__codelineno-34-219></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-34-220 name=__codelineno-34-220 href=#__codelineno-34-220></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-34-221 name=__codelineno-34-221 href=#__codelineno-34-221></a><span class=p>}</span>
<a id=__codelineno-34-222 name=__codelineno-34-222 href=#__codelineno-34-222></a>
<a id=__codelineno-34-223 name=__codelineno-34-223 href=#__codelineno-34-223></a><span class=c1>// DeleteDeployment 删除deployment</span>
<a id=__codelineno-34-224 name=__codelineno-34-224 href=#__codelineno-34-224></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>deployment</span><span class=p>)</span><span class=w> </span><span class=nx>DeleteDeployment</span><span class=p>(</span><span class=nx>deploymentName</span><span class=p>,</span><span class=w> </span><span class=nx>namespace</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-34-225 name=__codelineno-34-225 href=#__codelineno-34-225></a><span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>AppsV1</span><span class=p>().</span><span class=nx>Deployments</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span><span class=nx>Delete</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>deploymentName</span><span class=p>,</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>DeleteOptions</span><span class=p>{})</span>
<a id=__codelineno-34-226 name=__codelineno-34-226 href=#__codelineno-34-226></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-34-227 name=__codelineno-34-227 href=#__codelineno-34-227></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;删除Deployment失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-34-228 name=__codelineno-34-228 href=#__codelineno-34-228></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;删除Deployment失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-34-229 name=__codelineno-34-229 href=#__codelineno-34-229></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-34-230 name=__codelineno-34-230 href=#__codelineno-34-230></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-34-231 name=__codelineno-34-231 href=#__codelineno-34-231></a><span class=p>}</span>
<a id=__codelineno-34-232 name=__codelineno-34-232 href=#__codelineno-34-232></a>
<a id=__codelineno-34-233 name=__codelineno-34-233 href=#__codelineno-34-233></a><span class=c1>// RestartDeployment 重启deployment</span>
<a id=__codelineno-34-234 name=__codelineno-34-234 href=#__codelineno-34-234></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>deployment</span><span class=p>)</span><span class=w> </span><span class=nx>RestartDeployment</span><span class=p>(</span><span class=nx>deploymentName</span><span class=p>,</span><span class=w> </span><span class=nx>namespace</span><span class=p>,</span><span class=w> </span><span class=nx>imageName</span><span class=p>,</span><span class=w> </span><span class=nx>image</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-34-235 name=__codelineno-34-235 href=#__codelineno-34-235></a><span class=w>    </span><span class=c1>//此功能等同于以下kubectl命令</span>
<a id=__codelineno-34-236 name=__codelineno-34-236 href=#__codelineno-34-236></a><span class=w>    </span><span class=c1>//kubectl deployment ${service} -p \</span>
<a id=__codelineno-34-237 name=__codelineno-34-237 href=#__codelineno-34-237></a><span class=w>    </span><span class=c1>//&#39;{&quot;spec&quot;:{&quot;template&quot;:{&quot;spec&quot;:{&quot;containers&quot;:[{&quot;name&quot;:&quot;&#39;&quot;${service}&quot;&#39;&quot;,&quot;env&quot;:</span>
<a id=__codelineno-34-238 name=__codelineno-34-238 href=#__codelineno-34-238></a><span class=w>    </span><span class=c1>//[{&quot;name&quot;:&quot;RESTART_&quot;,&quot;value&quot;:&quot;&#39;$(date +%s)&#39;&quot;}]}]}}}}&#39;</span>
<a id=__codelineno-34-239 name=__codelineno-34-239 href=#__codelineno-34-239></a>
<a id=__codelineno-34-240 name=__codelineno-34-240 href=#__codelineno-34-240></a><span class=w>    </span><span class=c1>//使用patchData Map组装数据</span>
<a id=__codelineno-34-241 name=__codelineno-34-241 href=#__codelineno-34-241></a><span class=w>    </span><span class=nx>patchData</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kd>interface</span><span class=p>{}{</span>
<a id=__codelineno-34-242 name=__codelineno-34-242 href=#__codelineno-34-242></a><span class=w>        </span><span class=s>&quot;metadata&quot;</span><span class=p>:</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kd>interface</span><span class=p>{}{</span>
<a id=__codelineno-34-243 name=__codelineno-34-243 href=#__codelineno-34-243></a><span class=w>            </span><span class=s>&quot;name&quot;</span><span class=p>:</span><span class=w>      </span><span class=nx>deploymentName</span><span class=p>,</span>
<a id=__codelineno-34-244 name=__codelineno-34-244 href=#__codelineno-34-244></a><span class=w>            </span><span class=s>&quot;namespace&quot;</span><span class=p>:</span><span class=w> </span><span class=nx>namespace</span><span class=p>,</span>
<a id=__codelineno-34-245 name=__codelineno-34-245 href=#__codelineno-34-245></a><span class=w>        </span><span class=p>},</span>
<a id=__codelineno-34-246 name=__codelineno-34-246 href=#__codelineno-34-246></a><span class=w>        </span><span class=s>&quot;spec&quot;</span><span class=p>:</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kd>interface</span><span class=p>{}{</span>
<a id=__codelineno-34-247 name=__codelineno-34-247 href=#__codelineno-34-247></a><span class=w>            </span><span class=s>&quot;template&quot;</span><span class=p>:</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kd>interface</span><span class=p>{}{</span>
<a id=__codelineno-34-248 name=__codelineno-34-248 href=#__codelineno-34-248></a><span class=w>                </span><span class=s>&quot;spec&quot;</span><span class=p>:</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kd>interface</span><span class=p>{}{</span>
<a id=__codelineno-34-249 name=__codelineno-34-249 href=#__codelineno-34-249></a><span class=w>                    </span><span class=s>&quot;containers&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[]</span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kd>interface</span><span class=p>{}{</span>
<a id=__codelineno-34-250 name=__codelineno-34-250 href=#__codelineno-34-250></a><span class=w>                        </span><span class=p>{</span>
<a id=__codelineno-34-251 name=__codelineno-34-251 href=#__codelineno-34-251></a><span class=w>                            </span><span class=s>&quot;name&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>imageName</span><span class=p>,</span>
<a id=__codelineno-34-252 name=__codelineno-34-252 href=#__codelineno-34-252></a><span class=w>                            </span><span class=s>&quot;image&quot;</span><span class=p>:</span><span class=w> </span><span class=nx>image</span><span class=p>,</span>
<a id=__codelineno-34-253 name=__codelineno-34-253 href=#__codelineno-34-253></a><span class=w>                            </span><span class=s>&quot;env&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[]</span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>string</span><span class=p>{{</span>
<a id=__codelineno-34-254 name=__codelineno-34-254 href=#__codelineno-34-254></a><span class=w>                                </span><span class=s>&quot;name&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;RESTART_&quot;</span><span class=p>,</span>
<a id=__codelineno-34-255 name=__codelineno-34-255 href=#__codelineno-34-255></a><span class=w>                                </span><span class=s>&quot;value&quot;</span><span class=p>:</span><span class=w> </span><span class=nx>strconv</span><span class=p>.</span><span class=nx>FormatInt</span><span class=p>(</span><span class=nx>time</span><span class=p>.</span><span class=nx>Now</span><span class=p>().</span><span class=nx>Unix</span><span class=p>(),</span><span class=w> </span><span class=mi>10</span><span class=p>),</span>
<a id=__codelineno-34-256 name=__codelineno-34-256 href=#__codelineno-34-256></a><span class=w>                            </span><span class=p>}},</span>
<a id=__codelineno-34-257 name=__codelineno-34-257 href=#__codelineno-34-257></a><span class=w>                        </span><span class=p>},</span>
<a id=__codelineno-34-258 name=__codelineno-34-258 href=#__codelineno-34-258></a><span class=w>                    </span><span class=p>},</span>
<a id=__codelineno-34-259 name=__codelineno-34-259 href=#__codelineno-34-259></a><span class=w>                </span><span class=p>},</span>
<a id=__codelineno-34-260 name=__codelineno-34-260 href=#__codelineno-34-260></a><span class=w>            </span><span class=p>},</span>
<a id=__codelineno-34-261 name=__codelineno-34-261 href=#__codelineno-34-261></a><span class=w>        </span><span class=p>},</span>
<a id=__codelineno-34-262 name=__codelineno-34-262 href=#__codelineno-34-262></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-34-263 name=__codelineno-34-263 href=#__codelineno-34-263></a><span class=w>    </span><span class=c1>//序列化为字节，因为patch方法只接收字节类型参数</span>
<a id=__codelineno-34-264 name=__codelineno-34-264 href=#__codelineno-34-264></a><span class=w>    </span><span class=nx>patchByte</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>json</span><span class=p>.</span><span class=nx>Marshal</span><span class=p>(</span><span class=nx>patchData</span><span class=p>)</span>
<a id=__codelineno-34-265 name=__codelineno-34-265 href=#__codelineno-34-265></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-34-266 name=__codelineno-34-266 href=#__codelineno-34-266></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;json序列化失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-34-267 name=__codelineno-34-267 href=#__codelineno-34-267></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;json序列化失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-34-268 name=__codelineno-34-268 href=#__codelineno-34-268></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-34-269 name=__codelineno-34-269 href=#__codelineno-34-269></a><span class=w>    </span><span class=c1>//调用patch方法更新deployment</span>
<a id=__codelineno-34-270 name=__codelineno-34-270 href=#__codelineno-34-270></a><span class=w>    </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>AppsV1</span><span class=p>().</span><span class=nx>Deployments</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span><span class=nx>Patch</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>deploymentName</span><span class=p>,</span><span class=w> </span><span class=s>&quot;application/strategic-merge-patch+json&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>patchByte</span><span class=p>,</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>PatchOptions</span><span class=p>{})</span>
<a id=__codelineno-34-271 name=__codelineno-34-271 href=#__codelineno-34-271></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-34-272 name=__codelineno-34-272 href=#__codelineno-34-272></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;重启Deployment失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-34-273 name=__codelineno-34-273 href=#__codelineno-34-273></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;重启Deployment失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-34-274 name=__codelineno-34-274 href=#__codelineno-34-274></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-34-275 name=__codelineno-34-275 href=#__codelineno-34-275></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-34-276 name=__codelineno-34-276 href=#__codelineno-34-276></a><span class=p>}</span>
<a id=__codelineno-34-277 name=__codelineno-34-277 href=#__codelineno-34-277></a>
<a id=__codelineno-34-278 name=__codelineno-34-278 href=#__codelineno-34-278></a><span class=c1>// UpdateDeployment 更新deployment</span>
<a id=__codelineno-34-279 name=__codelineno-34-279 href=#__codelineno-34-279></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>deployment</span><span class=p>)</span><span class=w> </span><span class=nx>UpdateDeployment</span><span class=p>(</span><span class=nx>namespace</span><span class=p>,</span><span class=w> </span><span class=nx>content</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-34-280 name=__codelineno-34-280 href=#__codelineno-34-280></a><span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=nx>deploy</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>appsv1</span><span class=p>.</span><span class=nx>Deployment</span><span class=p>{}</span>
<a id=__codelineno-34-281 name=__codelineno-34-281 href=#__codelineno-34-281></a>
<a id=__codelineno-34-282 name=__codelineno-34-282 href=#__codelineno-34-282></a><span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>json</span><span class=p>.</span><span class=nx>Unmarshal</span><span class=p>([]</span><span class=nb>byte</span><span class=p>(</span><span class=nx>content</span><span class=p>),</span><span class=w> </span><span class=nx>deploy</span><span class=p>)</span>
<a id=__codelineno-34-283 name=__codelineno-34-283 href=#__codelineno-34-283></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-34-284 name=__codelineno-34-284 href=#__codelineno-34-284></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;反序列化失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-34-285 name=__codelineno-34-285 href=#__codelineno-34-285></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;反序列化失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-34-286 name=__codelineno-34-286 href=#__codelineno-34-286></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-34-287 name=__codelineno-34-287 href=#__codelineno-34-287></a>
<a id=__codelineno-34-288 name=__codelineno-34-288 href=#__codelineno-34-288></a><span class=w>    </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>AppsV1</span><span class=p>().</span><span class=nx>Deployments</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span><span class=nx>Update</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>deploy</span><span class=p>,</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>UpdateOptions</span><span class=p>{})</span>
<a id=__codelineno-34-289 name=__codelineno-34-289 href=#__codelineno-34-289></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-34-290 name=__codelineno-34-290 href=#__codelineno-34-290></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;更新Deployment失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-34-291 name=__codelineno-34-291 href=#__codelineno-34-291></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;更新Deployment失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-34-292 name=__codelineno-34-292 href=#__codelineno-34-292></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-34-293 name=__codelineno-34-293 href=#__codelineno-34-293></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-34-294 name=__codelineno-34-294 href=#__codelineno-34-294></a><span class=p>}</span>
<a id=__codelineno-34-295 name=__codelineno-34-295 href=#__codelineno-34-295></a>
<a id=__codelineno-34-296 name=__codelineno-34-296 href=#__codelineno-34-296></a><span class=c1>// GetDeployNumPerNp 获取每个namespace的deployment数量</span>
<a id=__codelineno-34-297 name=__codelineno-34-297 href=#__codelineno-34-297></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>deployment</span><span class=p>)</span><span class=w> </span><span class=nx>GetDeployNumPerNp</span><span class=p>()</span><span class=w> </span><span class=p>(</span><span class=nx>deploysNps</span><span class=w> </span><span class=p>[]</span><span class=o>*</span><span class=nx>DeploysNp</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-34-298 name=__codelineno-34-298 href=#__codelineno-34-298></a><span class=w>    </span><span class=nx>namespaceList</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>CoreV1</span><span class=p>().</span><span class=nx>Namespaces</span><span class=p>().</span><span class=nx>List</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>ListOptions</span><span class=p>{})</span>
<a id=__codelineno-34-299 name=__codelineno-34-299 href=#__codelineno-34-299></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-34-300 name=__codelineno-34-300 href=#__codelineno-34-300></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>err</span>
<a id=__codelineno-34-301 name=__codelineno-34-301 href=#__codelineno-34-301></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-34-302 name=__codelineno-34-302 href=#__codelineno-34-302></a><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>namespace</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>namespaceList</span><span class=p>.</span><span class=nx>Items</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-34-303 name=__codelineno-34-303 href=#__codelineno-34-303></a><span class=w>        </span><span class=nx>deploymentList</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>AppsV1</span><span class=p>().</span><span class=nx>Deployments</span><span class=p>(</span><span class=nx>namespace</span><span class=p>.</span><span class=nx>Name</span><span class=p>).</span><span class=nx>List</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>ListOptions</span><span class=p>{})</span>
<a id=__codelineno-34-304 name=__codelineno-34-304 href=#__codelineno-34-304></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-34-305 name=__codelineno-34-305 href=#__codelineno-34-305></a><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>err</span>
<a id=__codelineno-34-306 name=__codelineno-34-306 href=#__codelineno-34-306></a><span class=w>        </span><span class=p>}</span>
<a id=__codelineno-34-307 name=__codelineno-34-307 href=#__codelineno-34-307></a><span class=w>        </span><span class=nx>DeploysNp</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>DeploysNp</span><span class=p>{</span>
<a id=__codelineno-34-308 name=__codelineno-34-308 href=#__codelineno-34-308></a><span class=w>            </span><span class=nx>Namespace</span><span class=p>:</span><span class=w> </span><span class=nx>namespace</span><span class=p>.</span><span class=nx>Name</span><span class=p>,</span>
<a id=__codelineno-34-309 name=__codelineno-34-309 href=#__codelineno-34-309></a><span class=w>            </span><span class=nx>DeployNum</span><span class=p>:</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>deploymentList</span><span class=p>.</span><span class=nx>Items</span><span class=p>),</span>
<a id=__codelineno-34-310 name=__codelineno-34-310 href=#__codelineno-34-310></a><span class=w>        </span><span class=p>}</span>
<a id=__codelineno-34-311 name=__codelineno-34-311 href=#__codelineno-34-311></a><span class=w>        </span><span class=nx>deploysNps</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nb>append</span><span class=p>(</span><span class=nx>deploysNps</span><span class=p>,</span><span class=w> </span><span class=nx>DeploysNp</span><span class=p>)</span>
<a id=__codelineno-34-312 name=__codelineno-34-312 href=#__codelineno-34-312></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-34-313 name=__codelineno-34-313 href=#__codelineno-34-313></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>deploysNps</span><span class=p>,</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-34-314 name=__codelineno-34-314 href=#__codelineno-34-314></a><span class=p>}</span>
</code></pre></div> <p><code>controller/deployment.go</code></p> <div class=highlight><pre><span></span><code><a id=__codelineno-35-1 name=__codelineno-35-1 href=#__codelineno-35-1></a><span class=kn>package</span><span class=w> </span><span class=nx>controller</span>
<a id=__codelineno-35-2 name=__codelineno-35-2 href=#__codelineno-35-2></a>
<a id=__codelineno-35-3 name=__codelineno-35-3 href=#__codelineno-35-3></a><span class=kn>import</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-35-4 name=__codelineno-35-4 href=#__codelineno-35-4></a><span class=w>    </span><span class=s>&quot;fmt&quot;</span>
<a id=__codelineno-35-5 name=__codelineno-35-5 href=#__codelineno-35-5></a><span class=w>    </span><span class=s>&quot;gitee.com/k8s-platform/service&quot;</span>
<a id=__codelineno-35-6 name=__codelineno-35-6 href=#__codelineno-35-6></a><span class=w>    </span><span class=s>&quot;net/http&quot;</span>
<a id=__codelineno-35-7 name=__codelineno-35-7 href=#__codelineno-35-7></a>
<a id=__codelineno-35-8 name=__codelineno-35-8 href=#__codelineno-35-8></a><span class=w>    </span><span class=s>&quot;github.com/gin-gonic/gin&quot;</span>
<a id=__codelineno-35-9 name=__codelineno-35-9 href=#__codelineno-35-9></a><span class=w>    </span><span class=s>&quot;github.com/wonderivan/logger&quot;</span>
<a id=__codelineno-35-10 name=__codelineno-35-10 href=#__codelineno-35-10></a><span class=p>)</span>
<a id=__codelineno-35-11 name=__codelineno-35-11 href=#__codelineno-35-11></a>
<a id=__codelineno-35-12 name=__codelineno-35-12 href=#__codelineno-35-12></a><span class=kd>type</span><span class=w> </span><span class=nx>deployment</span><span class=w> </span><span class=kd>struct</span><span class=p>{}</span>
<a id=__codelineno-35-13 name=__codelineno-35-13 href=#__codelineno-35-13></a>
<a id=__codelineno-35-14 name=__codelineno-35-14 href=#__codelineno-35-14></a><span class=kd>var</span><span class=w> </span><span class=nx>Deployment</span><span class=w> </span><span class=nx>deployment</span>
<a id=__codelineno-35-15 name=__codelineno-35-15 href=#__codelineno-35-15></a>
<a id=__codelineno-35-16 name=__codelineno-35-16 href=#__codelineno-35-16></a><span class=c1>// GetDeployments 获取deployment列表，支持过滤、排序、分页</span>
<a id=__codelineno-35-17 name=__codelineno-35-17 href=#__codelineno-35-17></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>deployment</span><span class=p>)</span><span class=w> </span><span class=nx>GetDeployments</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-35-18 name=__codelineno-35-18 href=#__codelineno-35-18></a><span class=w>    </span><span class=nx>params</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-35-19 name=__codelineno-35-19 href=#__codelineno-35-19></a><span class=w>        </span><span class=nx>FilterName</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`form:&quot;filter_name&quot;`</span>
<a id=__codelineno-35-20 name=__codelineno-35-20 href=#__codelineno-35-20></a><span class=w>        </span><span class=nx>Namespace</span><span class=w>  </span><span class=kt>string</span><span class=w> </span><span class=s>`form:&quot;namespace&quot;`</span>
<a id=__codelineno-35-21 name=__codelineno-35-21 href=#__codelineno-35-21></a><span class=w>        </span><span class=nx>Page</span><span class=w>       </span><span class=kt>int</span><span class=w>    </span><span class=s>`form:&quot;page&quot;`</span>
<a id=__codelineno-35-22 name=__codelineno-35-22 href=#__codelineno-35-22></a><span class=w>        </span><span class=nx>Limit</span><span class=w>      </span><span class=kt>int</span><span class=w>    </span><span class=s>`form:&quot;limit&quot;`</span>
<a id=__codelineno-35-23 name=__codelineno-35-23 href=#__codelineno-35-23></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-35-24 name=__codelineno-35-24 href=#__codelineno-35-24></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>Bind</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-35-25 name=__codelineno-35-25 href=#__codelineno-35-25></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-35-26 name=__codelineno-35-26 href=#__codelineno-35-26></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-35-27 name=__codelineno-35-27 href=#__codelineno-35-27></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-35-28 name=__codelineno-35-28 href=#__codelineno-35-28></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-35-29 name=__codelineno-35-29 href=#__codelineno-35-29></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-35-30 name=__codelineno-35-30 href=#__codelineno-35-30></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-35-31 name=__codelineno-35-31 href=#__codelineno-35-31></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-35-32 name=__codelineno-35-32 href=#__codelineno-35-32></a><span class=w>    </span><span class=nx>data</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>Deployment</span><span class=p>.</span><span class=nx>GetDeployments</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>FilterName</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Limit</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Page</span><span class=p>)</span>
<a id=__codelineno-35-33 name=__codelineno-35-33 href=#__codelineno-35-33></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-35-34 name=__codelineno-35-34 href=#__codelineno-35-34></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-35-35 name=__codelineno-35-35 href=#__codelineno-35-35></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-35-36 name=__codelineno-35-36 href=#__codelineno-35-36></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-35-37 name=__codelineno-35-37 href=#__codelineno-35-37></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-35-38 name=__codelineno-35-38 href=#__codelineno-35-38></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-35-39 name=__codelineno-35-39 href=#__codelineno-35-39></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-35-40 name=__codelineno-35-40 href=#__codelineno-35-40></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-35-41 name=__codelineno-35-41 href=#__codelineno-35-41></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;获取Deployment列表成功&quot;</span><span class=p>,</span>
<a id=__codelineno-35-42 name=__codelineno-35-42 href=#__codelineno-35-42></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=nx>data</span><span class=p>,</span>
<a id=__codelineno-35-43 name=__codelineno-35-43 href=#__codelineno-35-43></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-35-44 name=__codelineno-35-44 href=#__codelineno-35-44></a><span class=p>}</span>
<a id=__codelineno-35-45 name=__codelineno-35-45 href=#__codelineno-35-45></a>
<a id=__codelineno-35-46 name=__codelineno-35-46 href=#__codelineno-35-46></a><span class=c1>// GetDeploymentDetail 获取deployment详情</span>
<a id=__codelineno-35-47 name=__codelineno-35-47 href=#__codelineno-35-47></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>deployment</span><span class=p>)</span><span class=w> </span><span class=nx>GetDeploymentDetail</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-35-48 name=__codelineno-35-48 href=#__codelineno-35-48></a><span class=w>    </span><span class=nx>params</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-35-49 name=__codelineno-35-49 href=#__codelineno-35-49></a><span class=w>        </span><span class=nx>DeploymentName</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`form:&quot;deployment_name&quot;`</span>
<a id=__codelineno-35-50 name=__codelineno-35-50 href=#__codelineno-35-50></a><span class=w>        </span><span class=nx>Namespace</span><span class=w>      </span><span class=kt>string</span><span class=w> </span><span class=s>`form:&quot;namespace&quot;`</span>
<a id=__codelineno-35-51 name=__codelineno-35-51 href=#__codelineno-35-51></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-35-52 name=__codelineno-35-52 href=#__codelineno-35-52></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>Bind</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-35-53 name=__codelineno-35-53 href=#__codelineno-35-53></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-35-54 name=__codelineno-35-54 href=#__codelineno-35-54></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-35-55 name=__codelineno-35-55 href=#__codelineno-35-55></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-35-56 name=__codelineno-35-56 href=#__codelineno-35-56></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-35-57 name=__codelineno-35-57 href=#__codelineno-35-57></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-35-58 name=__codelineno-35-58 href=#__codelineno-35-58></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-35-59 name=__codelineno-35-59 href=#__codelineno-35-59></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-35-60 name=__codelineno-35-60 href=#__codelineno-35-60></a><span class=w>    </span><span class=nx>data</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>Deployment</span><span class=p>.</span><span class=nx>GetDeploymentDetail</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>DeploymentName</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>)</span>
<a id=__codelineno-35-61 name=__codelineno-35-61 href=#__codelineno-35-61></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-35-62 name=__codelineno-35-62 href=#__codelineno-35-62></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-35-63 name=__codelineno-35-63 href=#__codelineno-35-63></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-35-64 name=__codelineno-35-64 href=#__codelineno-35-64></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-35-65 name=__codelineno-35-65 href=#__codelineno-35-65></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-35-66 name=__codelineno-35-66 href=#__codelineno-35-66></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-35-67 name=__codelineno-35-67 href=#__codelineno-35-67></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-35-68 name=__codelineno-35-68 href=#__codelineno-35-68></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-35-69 name=__codelineno-35-69 href=#__codelineno-35-69></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;获取Deployment详情成功&quot;</span><span class=p>,</span>
<a id=__codelineno-35-70 name=__codelineno-35-70 href=#__codelineno-35-70></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=nx>data</span><span class=p>,</span>
<a id=__codelineno-35-71 name=__codelineno-35-71 href=#__codelineno-35-71></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-35-72 name=__codelineno-35-72 href=#__codelineno-35-72></a><span class=p>}</span>
<a id=__codelineno-35-73 name=__codelineno-35-73 href=#__codelineno-35-73></a>
<a id=__codelineno-35-74 name=__codelineno-35-74 href=#__codelineno-35-74></a><span class=c1>// CreateDeployment 创建deployment</span>
<a id=__codelineno-35-75 name=__codelineno-35-75 href=#__codelineno-35-75></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>deployment</span><span class=p>)</span><span class=w> </span><span class=nx>CreateDeployment</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-35-76 name=__codelineno-35-76 href=#__codelineno-35-76></a><span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-35-77 name=__codelineno-35-77 href=#__codelineno-35-77></a><span class=w>        </span><span class=nx>deployCreate</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=nx>service</span><span class=p>.</span><span class=nx>DeployCreate</span><span class=p>)</span>
<a id=__codelineno-35-78 name=__codelineno-35-78 href=#__codelineno-35-78></a><span class=w>        </span><span class=nx>err</span><span class=w>          </span><span class=kt>error</span>
<a id=__codelineno-35-79 name=__codelineno-35-79 href=#__codelineno-35-79></a><span class=w>    </span><span class=p>)</span>
<a id=__codelineno-35-80 name=__codelineno-35-80 href=#__codelineno-35-80></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>ShouldBindJSON</span><span class=p>(</span><span class=nx>deployCreate</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-35-81 name=__codelineno-35-81 href=#__codelineno-35-81></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-35-82 name=__codelineno-35-82 href=#__codelineno-35-82></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-35-83 name=__codelineno-35-83 href=#__codelineno-35-83></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-35-84 name=__codelineno-35-84 href=#__codelineno-35-84></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-35-85 name=__codelineno-35-85 href=#__codelineno-35-85></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-35-86 name=__codelineno-35-86 href=#__codelineno-35-86></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-35-87 name=__codelineno-35-87 href=#__codelineno-35-87></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-35-88 name=__codelineno-35-88 href=#__codelineno-35-88></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>Deployment</span><span class=p>.</span><span class=nx>CreateDeployment</span><span class=p>(</span><span class=nx>deployCreate</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-35-89 name=__codelineno-35-89 href=#__codelineno-35-89></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-35-90 name=__codelineno-35-90 href=#__codelineno-35-90></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-35-91 name=__codelineno-35-91 href=#__codelineno-35-91></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-35-92 name=__codelineno-35-92 href=#__codelineno-35-92></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-35-93 name=__codelineno-35-93 href=#__codelineno-35-93></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-35-94 name=__codelineno-35-94 href=#__codelineno-35-94></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-35-95 name=__codelineno-35-95 href=#__codelineno-35-95></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;创建Deployment成功&quot;</span><span class=p>,</span>
<a id=__codelineno-35-96 name=__codelineno-35-96 href=#__codelineno-35-96></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-35-97 name=__codelineno-35-97 href=#__codelineno-35-97></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-35-98 name=__codelineno-35-98 href=#__codelineno-35-98></a><span class=p>}</span>
<a id=__codelineno-35-99 name=__codelineno-35-99 href=#__codelineno-35-99></a>
<a id=__codelineno-35-100 name=__codelineno-35-100 href=#__codelineno-35-100></a><span class=c1>// ScaleDeployment 设置deployment副本数</span>
<a id=__codelineno-35-101 name=__codelineno-35-101 href=#__codelineno-35-101></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>deployment</span><span class=p>)</span><span class=w> </span><span class=nx>ScaleDeployment</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-35-102 name=__codelineno-35-102 href=#__codelineno-35-102></a><span class=w>    </span><span class=nx>params</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-35-103 name=__codelineno-35-103 href=#__codelineno-35-103></a><span class=w>        </span><span class=nx>DeploymentName</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;deployment_name&quot;`</span>
<a id=__codelineno-35-104 name=__codelineno-35-104 href=#__codelineno-35-104></a><span class=w>        </span><span class=nx>Namespace</span><span class=w>      </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;namespace&quot;`</span>
<a id=__codelineno-35-105 name=__codelineno-35-105 href=#__codelineno-35-105></a><span class=w>        </span><span class=nx>ScaleNum</span><span class=w>       </span><span class=kt>int</span><span class=w>    </span><span class=s>`json:&quot;scale_num&quot;`</span>
<a id=__codelineno-35-106 name=__codelineno-35-106 href=#__codelineno-35-106></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-35-107 name=__codelineno-35-107 href=#__codelineno-35-107></a><span class=w>    </span><span class=c1>//PUT请求，绑定参数方法为ctx.ShouldBindJSON</span>
<a id=__codelineno-35-108 name=__codelineno-35-108 href=#__codelineno-35-108></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>ShouldBindJSON</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-35-109 name=__codelineno-35-109 href=#__codelineno-35-109></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-35-110 name=__codelineno-35-110 href=#__codelineno-35-110></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-35-111 name=__codelineno-35-111 href=#__codelineno-35-111></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-35-112 name=__codelineno-35-112 href=#__codelineno-35-112></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-35-113 name=__codelineno-35-113 href=#__codelineno-35-113></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-35-114 name=__codelineno-35-114 href=#__codelineno-35-114></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-35-115 name=__codelineno-35-115 href=#__codelineno-35-115></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-35-116 name=__codelineno-35-116 href=#__codelineno-35-116></a><span class=w>    </span><span class=nx>data</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>Deployment</span><span class=p>.</span><span class=nx>ScaleDeployment</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>DeploymentName</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>ScaleNum</span><span class=p>)</span>
<a id=__codelineno-35-117 name=__codelineno-35-117 href=#__codelineno-35-117></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-35-118 name=__codelineno-35-118 href=#__codelineno-35-118></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-35-119 name=__codelineno-35-119 href=#__codelineno-35-119></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-35-120 name=__codelineno-35-120 href=#__codelineno-35-120></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-35-121 name=__codelineno-35-121 href=#__codelineno-35-121></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-35-122 name=__codelineno-35-122 href=#__codelineno-35-122></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-35-123 name=__codelineno-35-123 href=#__codelineno-35-123></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-35-124 name=__codelineno-35-124 href=#__codelineno-35-124></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-35-125 name=__codelineno-35-125 href=#__codelineno-35-125></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;设置Deployment副本数成功&quot;</span><span class=p>,</span>
<a id=__codelineno-35-126 name=__codelineno-35-126 href=#__codelineno-35-126></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=nx>fmt</span><span class=p>.</span><span class=nx>Sprintf</span><span class=p>(</span><span class=s>&quot;最新副本数：%d&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>data</span><span class=p>),</span>
<a id=__codelineno-35-127 name=__codelineno-35-127 href=#__codelineno-35-127></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-35-128 name=__codelineno-35-128 href=#__codelineno-35-128></a><span class=p>}</span>
<a id=__codelineno-35-129 name=__codelineno-35-129 href=#__codelineno-35-129></a>
<a id=__codelineno-35-130 name=__codelineno-35-130 href=#__codelineno-35-130></a><span class=c1>// DeleteDeployment 删除deployment</span>
<a id=__codelineno-35-131 name=__codelineno-35-131 href=#__codelineno-35-131></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>deployment</span><span class=p>)</span><span class=w> </span><span class=nx>DeleteDeployment</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-35-132 name=__codelineno-35-132 href=#__codelineno-35-132></a><span class=w>    </span><span class=nx>params</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-35-133 name=__codelineno-35-133 href=#__codelineno-35-133></a><span class=w>        </span><span class=nx>DeploymentName</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;deployment_name&quot;`</span>
<a id=__codelineno-35-134 name=__codelineno-35-134 href=#__codelineno-35-134></a><span class=w>        </span><span class=nx>Namespace</span><span class=w>      </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;namespace&quot;`</span>
<a id=__codelineno-35-135 name=__codelineno-35-135 href=#__codelineno-35-135></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-35-136 name=__codelineno-35-136 href=#__codelineno-35-136></a><span class=w>    </span><span class=c1>//DELETE请求，绑定参数方法改为ctx.ShouldBindJSON</span>
<a id=__codelineno-35-137 name=__codelineno-35-137 href=#__codelineno-35-137></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>ShouldBindJSON</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-35-138 name=__codelineno-35-138 href=#__codelineno-35-138></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-35-139 name=__codelineno-35-139 href=#__codelineno-35-139></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-35-140 name=__codelineno-35-140 href=#__codelineno-35-140></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-35-141 name=__codelineno-35-141 href=#__codelineno-35-141></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-35-142 name=__codelineno-35-142 href=#__codelineno-35-142></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-35-143 name=__codelineno-35-143 href=#__codelineno-35-143></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-35-144 name=__codelineno-35-144 href=#__codelineno-35-144></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-35-145 name=__codelineno-35-145 href=#__codelineno-35-145></a><span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>Deployment</span><span class=p>.</span><span class=nx>DeleteDeployment</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>DeploymentName</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>)</span>
<a id=__codelineno-35-146 name=__codelineno-35-146 href=#__codelineno-35-146></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-35-147 name=__codelineno-35-147 href=#__codelineno-35-147></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-35-148 name=__codelineno-35-148 href=#__codelineno-35-148></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-35-149 name=__codelineno-35-149 href=#__codelineno-35-149></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-35-150 name=__codelineno-35-150 href=#__codelineno-35-150></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-35-151 name=__codelineno-35-151 href=#__codelineno-35-151></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-35-152 name=__codelineno-35-152 href=#__codelineno-35-152></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-35-153 name=__codelineno-35-153 href=#__codelineno-35-153></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-35-154 name=__codelineno-35-154 href=#__codelineno-35-154></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;删除Deployment成功&quot;</span><span class=p>,</span>
<a id=__codelineno-35-155 name=__codelineno-35-155 href=#__codelineno-35-155></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-35-156 name=__codelineno-35-156 href=#__codelineno-35-156></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-35-157 name=__codelineno-35-157 href=#__codelineno-35-157></a><span class=p>}</span>
<a id=__codelineno-35-158 name=__codelineno-35-158 href=#__codelineno-35-158></a>
<a id=__codelineno-35-159 name=__codelineno-35-159 href=#__codelineno-35-159></a><span class=c1>// RestartDeployment 重启deployment</span>
<a id=__codelineno-35-160 name=__codelineno-35-160 href=#__codelineno-35-160></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>deployment</span><span class=p>)</span><span class=w> </span><span class=nx>RestartDeployment</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-35-161 name=__codelineno-35-161 href=#__codelineno-35-161></a><span class=w>    </span><span class=nx>params</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-35-162 name=__codelineno-35-162 href=#__codelineno-35-162></a><span class=w>        </span><span class=nx>DeploymentName</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;deployment_name&quot;`</span>
<a id=__codelineno-35-163 name=__codelineno-35-163 href=#__codelineno-35-163></a><span class=w>        </span><span class=nx>Namespace</span><span class=w>      </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;namespace&quot;`</span>
<a id=__codelineno-35-164 name=__codelineno-35-164 href=#__codelineno-35-164></a><span class=w>        </span><span class=nx>ImageName</span><span class=w>      </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;image_name&quot;`</span>
<a id=__codelineno-35-165 name=__codelineno-35-165 href=#__codelineno-35-165></a><span class=w>        </span><span class=nx>Image</span><span class=w>          </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;image&quot;`</span>
<a id=__codelineno-35-166 name=__codelineno-35-166 href=#__codelineno-35-166></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-35-167 name=__codelineno-35-167 href=#__codelineno-35-167></a><span class=w>    </span><span class=c1>//PUT请求，绑定参数方法为ctx.ShouldBindJSON</span>
<a id=__codelineno-35-168 name=__codelineno-35-168 href=#__codelineno-35-168></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>ShouldBindJSON</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-35-169 name=__codelineno-35-169 href=#__codelineno-35-169></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-35-170 name=__codelineno-35-170 href=#__codelineno-35-170></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-35-171 name=__codelineno-35-171 href=#__codelineno-35-171></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-35-172 name=__codelineno-35-172 href=#__codelineno-35-172></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-35-173 name=__codelineno-35-173 href=#__codelineno-35-173></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-35-174 name=__codelineno-35-174 href=#__codelineno-35-174></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-35-175 name=__codelineno-35-175 href=#__codelineno-35-175></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-35-176 name=__codelineno-35-176 href=#__codelineno-35-176></a><span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>Deployment</span><span class=p>.</span><span class=nx>RestartDeployment</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>DeploymentName</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>ImageName</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Image</span><span class=p>)</span>
<a id=__codelineno-35-177 name=__codelineno-35-177 href=#__codelineno-35-177></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-35-178 name=__codelineno-35-178 href=#__codelineno-35-178></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-35-179 name=__codelineno-35-179 href=#__codelineno-35-179></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-35-180 name=__codelineno-35-180 href=#__codelineno-35-180></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-35-181 name=__codelineno-35-181 href=#__codelineno-35-181></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-35-182 name=__codelineno-35-182 href=#__codelineno-35-182></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-35-183 name=__codelineno-35-183 href=#__codelineno-35-183></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-35-184 name=__codelineno-35-184 href=#__codelineno-35-184></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-35-185 name=__codelineno-35-185 href=#__codelineno-35-185></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;重启Deployment成功&quot;</span><span class=p>,</span>
<a id=__codelineno-35-186 name=__codelineno-35-186 href=#__codelineno-35-186></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-35-187 name=__codelineno-35-187 href=#__codelineno-35-187></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-35-188 name=__codelineno-35-188 href=#__codelineno-35-188></a><span class=p>}</span>
<a id=__codelineno-35-189 name=__codelineno-35-189 href=#__codelineno-35-189></a>
<a id=__codelineno-35-190 name=__codelineno-35-190 href=#__codelineno-35-190></a><span class=c1>// UpdateDeployment 更新deployment</span>
<a id=__codelineno-35-191 name=__codelineno-35-191 href=#__codelineno-35-191></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>deployment</span><span class=p>)</span><span class=w> </span><span class=nx>UpdateDeployment</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-35-192 name=__codelineno-35-192 href=#__codelineno-35-192></a><span class=w>    </span><span class=nx>params</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-35-193 name=__codelineno-35-193 href=#__codelineno-35-193></a><span class=w>        </span><span class=nx>Namespace</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;namespace&quot;`</span>
<a id=__codelineno-35-194 name=__codelineno-35-194 href=#__codelineno-35-194></a><span class=w>        </span><span class=nx>Content</span><span class=w>   </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;content&quot;`</span>
<a id=__codelineno-35-195 name=__codelineno-35-195 href=#__codelineno-35-195></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-35-196 name=__codelineno-35-196 href=#__codelineno-35-196></a><span class=w>    </span><span class=c1>//PUT请求，绑定参数方法为ctx.ShouldBindJSON</span>
<a id=__codelineno-35-197 name=__codelineno-35-197 href=#__codelineno-35-197></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>ShouldBindJSON</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-35-198 name=__codelineno-35-198 href=#__codelineno-35-198></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-35-199 name=__codelineno-35-199 href=#__codelineno-35-199></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-35-200 name=__codelineno-35-200 href=#__codelineno-35-200></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-35-201 name=__codelineno-35-201 href=#__codelineno-35-201></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-35-202 name=__codelineno-35-202 href=#__codelineno-35-202></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-35-203 name=__codelineno-35-203 href=#__codelineno-35-203></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-35-204 name=__codelineno-35-204 href=#__codelineno-35-204></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-35-205 name=__codelineno-35-205 href=#__codelineno-35-205></a><span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>Deployment</span><span class=p>.</span><span class=nx>UpdateDeployment</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Content</span><span class=p>)</span>
<a id=__codelineno-35-206 name=__codelineno-35-206 href=#__codelineno-35-206></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-35-207 name=__codelineno-35-207 href=#__codelineno-35-207></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-35-208 name=__codelineno-35-208 href=#__codelineno-35-208></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-35-209 name=__codelineno-35-209 href=#__codelineno-35-209></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-35-210 name=__codelineno-35-210 href=#__codelineno-35-210></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-35-211 name=__codelineno-35-211 href=#__codelineno-35-211></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-35-212 name=__codelineno-35-212 href=#__codelineno-35-212></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-35-213 name=__codelineno-35-213 href=#__codelineno-35-213></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-35-214 name=__codelineno-35-214 href=#__codelineno-35-214></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;更新Deployment成功&quot;</span><span class=p>,</span>
<a id=__codelineno-35-215 name=__codelineno-35-215 href=#__codelineno-35-215></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-35-216 name=__codelineno-35-216 href=#__codelineno-35-216></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-35-217 name=__codelineno-35-217 href=#__codelineno-35-217></a><span class=p>}</span>
<a id=__codelineno-35-218 name=__codelineno-35-218 href=#__codelineno-35-218></a>
<a id=__codelineno-35-219 name=__codelineno-35-219 href=#__codelineno-35-219></a><span class=c1>// GetDeployNumPerNp 获取每个namespace的pod数量</span>
<a id=__codelineno-35-220 name=__codelineno-35-220 href=#__codelineno-35-220></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>deployment</span><span class=p>)</span><span class=w> </span><span class=nx>GetDeployNumPerNp</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-35-221 name=__codelineno-35-221 href=#__codelineno-35-221></a><span class=w>    </span><span class=nx>data</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>Deployment</span><span class=p>.</span><span class=nx>GetDeployNumPerNp</span><span class=p>()</span>
<a id=__codelineno-35-222 name=__codelineno-35-222 href=#__codelineno-35-222></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-35-223 name=__codelineno-35-223 href=#__codelineno-35-223></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-35-224 name=__codelineno-35-224 href=#__codelineno-35-224></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-35-225 name=__codelineno-35-225 href=#__codelineno-35-225></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-35-226 name=__codelineno-35-226 href=#__codelineno-35-226></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-35-227 name=__codelineno-35-227 href=#__codelineno-35-227></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-35-228 name=__codelineno-35-228 href=#__codelineno-35-228></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-35-229 name=__codelineno-35-229 href=#__codelineno-35-229></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-35-230 name=__codelineno-35-230 href=#__codelineno-35-230></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;获取每个namespace的deployment数量成功&quot;</span><span class=p>,</span>
<a id=__codelineno-35-231 name=__codelineno-35-231 href=#__codelineno-35-231></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=nx>data</span><span class=p>,</span>
<a id=__codelineno-35-232 name=__codelineno-35-232 href=#__codelineno-35-232></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-35-233 name=__codelineno-35-233 href=#__codelineno-35-233></a><span class=p>}</span>
</code></pre></div> <p><code>controller/router.go</code></p> <p>定义路由规则</p> <div class=highlight><pre><span></span><code><a id=__codelineno-36-1 name=__codelineno-36-1 href=#__codelineno-36-1></a><span class=kn>package</span><span class=w> </span><span class=nx>controller</span>
<a id=__codelineno-36-2 name=__codelineno-36-2 href=#__codelineno-36-2></a>
<a id=__codelineno-36-3 name=__codelineno-36-3 href=#__codelineno-36-3></a><span class=kn>import</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-36-4 name=__codelineno-36-4 href=#__codelineno-36-4></a><span class=w>    </span><span class=s>&quot;github.com/gin-gonic/gin&quot;</span>
<a id=__codelineno-36-5 name=__codelineno-36-5 href=#__codelineno-36-5></a><span class=w>    </span><span class=s>&quot;net/http&quot;</span>
<a id=__codelineno-36-6 name=__codelineno-36-6 href=#__codelineno-36-6></a><span class=p>)</span>
<a id=__codelineno-36-7 name=__codelineno-36-7 href=#__codelineno-36-7></a>
<a id=__codelineno-36-8 name=__codelineno-36-8 href=#__codelineno-36-8></a><span class=c1>// Router 实例化router结构体，可使用该对象点出首字母大写的方法（包外调用）</span>
<a id=__codelineno-36-9 name=__codelineno-36-9 href=#__codelineno-36-9></a><span class=kd>var</span><span class=w> </span><span class=nx>Router</span><span class=w> </span><span class=nx>router</span>
<a id=__codelineno-36-10 name=__codelineno-36-10 href=#__codelineno-36-10></a>
<a id=__codelineno-36-11 name=__codelineno-36-11 href=#__codelineno-36-11></a><span class=c1>// 创建router结构体</span>
<a id=__codelineno-36-12 name=__codelineno-36-12 href=#__codelineno-36-12></a><span class=kd>type</span><span class=w> </span><span class=nx>router</span><span class=w> </span><span class=kd>struct</span><span class=p>{}</span>
<a id=__codelineno-36-13 name=__codelineno-36-13 href=#__codelineno-36-13></a>
<a id=__codelineno-36-14 name=__codelineno-36-14 href=#__codelineno-36-14></a><span class=c1>// InitApiRouter 初始化路由规则</span>
<a id=__codelineno-36-15 name=__codelineno-36-15 href=#__codelineno-36-15></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>r</span><span class=w> </span><span class=o>*</span><span class=nx>router</span><span class=p>)</span><span class=w> </span><span class=nx>InitApiRouter</span><span class=p>(</span><span class=nx>router</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Engine</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-36-16 name=__codelineno-36-16 href=#__codelineno-36-16></a><span class=w>    </span><span class=c1>// 创建测试api接口</span>
<a id=__codelineno-36-17 name=__codelineno-36-17 href=#__codelineno-36-17></a><span class=w>    </span><span class=nx>router</span><span class=p>.</span><span class=nx>GET</span><span class=p>(</span><span class=s>&quot;/testapi&quot;</span><span class=p>,</span><span class=w> </span><span class=kd>func</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-36-18 name=__codelineno-36-18 href=#__codelineno-36-18></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-36-19 name=__codelineno-36-19 href=#__codelineno-36-19></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;testapi success!&quot;</span><span class=p>,</span>
<a id=__codelineno-36-20 name=__codelineno-36-20 href=#__codelineno-36-20></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-36-21 name=__codelineno-36-21 href=#__codelineno-36-21></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-36-22 name=__codelineno-36-22 href=#__codelineno-36-22></a><span class=w>    </span><span class=p>}).</span>
<a id=__codelineno-36-23 name=__codelineno-36-23 href=#__codelineno-36-23></a><span class=w>        </span><span class=c1>// pod操作</span>
<a id=__codelineno-36-24 name=__codelineno-36-24 href=#__codelineno-36-24></a><span class=w>        </span><span class=nx>GET</span><span class=p>(</span><span class=s>&quot;/api/k8s/pods&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Pod</span><span class=p>.</span><span class=nx>GetPods</span><span class=p>).</span>
<a id=__codelineno-36-25 name=__codelineno-36-25 href=#__codelineno-36-25></a><span class=w>        </span><span class=nx>GET</span><span class=p>(</span><span class=s>&quot;/api/k8s/pod/detail&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Pod</span><span class=p>.</span><span class=nx>GetPodDetail</span><span class=p>).</span>
<a id=__codelineno-36-26 name=__codelineno-36-26 href=#__codelineno-36-26></a><span class=w>        </span><span class=nx>DELETE</span><span class=p>(</span><span class=s>&quot;/api/k8s/pod/del&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Pod</span><span class=p>.</span><span class=nx>DeletePod</span><span class=p>).</span>
<a id=__codelineno-36-27 name=__codelineno-36-27 href=#__codelineno-36-27></a><span class=w>        </span><span class=nx>PUT</span><span class=p>(</span><span class=s>&quot;/api/k8s/pod/update&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Pod</span><span class=p>.</span><span class=nx>UpdatePod</span><span class=p>).</span>
<a id=__codelineno-36-28 name=__codelineno-36-28 href=#__codelineno-36-28></a><span class=w>        </span><span class=nx>GET</span><span class=p>(</span><span class=s>&quot;/api/k8s/pod/container&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Pod</span><span class=p>.</span><span class=nx>GetPodContainer</span><span class=p>).</span>
<a id=__codelineno-36-29 name=__codelineno-36-29 href=#__codelineno-36-29></a><span class=w>        </span><span class=nx>GET</span><span class=p>(</span><span class=s>&quot;/api/k8s/pod/log&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Pod</span><span class=p>.</span><span class=nx>GetPodLog</span><span class=p>).</span>
<a id=__codelineno-36-30 name=__codelineno-36-30 href=#__codelineno-36-30></a><span class=w>        </span><span class=nx>GET</span><span class=p>(</span><span class=s>&quot;/api/k8s/pod/numnp&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Pod</span><span class=p>.</span><span class=nx>GetPodNumPerNp</span><span class=p>).</span>
<a id=__codelineno-36-31 name=__codelineno-36-31 href=#__codelineno-36-31></a><span class=w>        </span><span class=c1>// deployment操作</span>
<a id=__codelineno-36-32 name=__codelineno-36-32 href=#__codelineno-36-32></a><span class=w>        </span><span class=nx>GET</span><span class=p>(</span><span class=s>&quot;/api/k8s/deployments&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Deployment</span><span class=p>.</span><span class=nx>GetDeployments</span><span class=p>).</span>
<a id=__codelineno-36-33 name=__codelineno-36-33 href=#__codelineno-36-33></a><span class=w>        </span><span class=nx>GET</span><span class=p>(</span><span class=s>&quot;/api/k8s/deployment/detail&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Deployment</span><span class=p>.</span><span class=nx>GetDeploymentDetail</span><span class=p>).</span>
<a id=__codelineno-36-34 name=__codelineno-36-34 href=#__codelineno-36-34></a><span class=w>        </span><span class=nx>PUT</span><span class=p>(</span><span class=s>&quot;/api/k8s/deployment/scale&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Deployment</span><span class=p>.</span><span class=nx>ScaleDeployment</span><span class=p>).</span>
<a id=__codelineno-36-35 name=__codelineno-36-35 href=#__codelineno-36-35></a><span class=w>        </span><span class=nx>DELETE</span><span class=p>(</span><span class=s>&quot;/api/k8s/deployment/del&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Deployment</span><span class=p>.</span><span class=nx>DeleteDeployment</span><span class=p>).</span>
<a id=__codelineno-36-36 name=__codelineno-36-36 href=#__codelineno-36-36></a><span class=w>        </span><span class=nx>PUT</span><span class=p>(</span><span class=s>&quot;/api/k8s/deployment/restart&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Deployment</span><span class=p>.</span><span class=nx>RestartDeployment</span><span class=p>).</span>
<a id=__codelineno-36-37 name=__codelineno-36-37 href=#__codelineno-36-37></a><span class=w>        </span><span class=nx>PUT</span><span class=p>(</span><span class=s>&quot;/api/k8s/deployment/update&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Deployment</span><span class=p>.</span><span class=nx>UpdateDeployment</span><span class=p>).</span>
<a id=__codelineno-36-38 name=__codelineno-36-38 href=#__codelineno-36-38></a><span class=w>        </span><span class=nx>GET</span><span class=p>(</span><span class=s>&quot;/api/k8s/deployment/numnp&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Deployment</span><span class=p>.</span><span class=nx>GetDeployNumPerNp</span><span class=p>).</span>
<a id=__codelineno-36-39 name=__codelineno-36-39 href=#__codelineno-36-39></a><span class=w>        </span><span class=nx>POST</span><span class=p>(</span><span class=s>&quot;/api/k8s/deployment/create&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Deployment</span><span class=p>.</span><span class=nx>CreateDeployment</span><span class=p>)</span>
<a id=__codelineno-36-40 name=__codelineno-36-40 href=#__codelineno-36-40></a><span class=p>}</span>
</code></pre></div> <h4 id=24-daemonset>2.4 DaemonSet<a class=headerlink href=#24-daemonset title="Permanent link">&para;</a></h4> <blockquote> <p>注意：以下功能与Pod和Deployment是实现方式一致</p> </blockquote> <table> <thead> <tr> <th>功能</th> <th>是否实现</th> </tr> </thead> <tbody> <tr> <td>DaemonSet列表</td> <td>√</td> </tr> <tr> <td>获取DaemonSet详情</td> <td>√</td> </tr> <tr> <td>删除DaemonSet</td> <td>√</td> </tr> <tr> <td>更新DaemonSet</td> <td>√</td> </tr> </tbody> </table> <p><code>service/dataselector.go</code></p> <div class=highlight><pre><span></span><code><a id=__codelineno-37-1 name=__codelineno-37-1 href=#__codelineno-37-1></a><span class=c1>// 实现 DaemonSet 的 DataCell接口</span>
<a id=__codelineno-37-2 name=__codelineno-37-2 href=#__codelineno-37-2></a><span class=kd>type</span><span class=w> </span><span class=nx>daemonSetCell</span><span class=w> </span><span class=nx>appsv1</span><span class=p>.</span><span class=nx>DaemonSet</span>
<a id=__codelineno-37-3 name=__codelineno-37-3 href=#__codelineno-37-3></a>
<a id=__codelineno-37-4 name=__codelineno-37-4 href=#__codelineno-37-4></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=nx>daemonSetCell</span><span class=p>)</span><span class=w> </span><span class=nx>GetCreation</span><span class=p>()</span><span class=w> </span><span class=nx>time</span><span class=p>.</span><span class=nx>Time</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-37-5 name=__codelineno-37-5 href=#__codelineno-37-5></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>d</span><span class=p>.</span><span class=nx>CreationTimestamp</span><span class=p>.</span><span class=nx>Time</span>
<a id=__codelineno-37-6 name=__codelineno-37-6 href=#__codelineno-37-6></a><span class=p>}</span>
<a id=__codelineno-37-7 name=__codelineno-37-7 href=#__codelineno-37-7></a>
<a id=__codelineno-37-8 name=__codelineno-37-8 href=#__codelineno-37-8></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=nx>daemonSetCell</span><span class=p>)</span><span class=w> </span><span class=nx>GetName</span><span class=p>()</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-37-9 name=__codelineno-37-9 href=#__codelineno-37-9></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>d</span><span class=p>.</span><span class=nx>Name</span>
<a id=__codelineno-37-10 name=__codelineno-37-10 href=#__codelineno-37-10></a><span class=p>}</span>
</code></pre></div> <p><code>service/daemonset.go</code></p> <div class=highlight><pre><span></span><code><a id=__codelineno-38-1 name=__codelineno-38-1 href=#__codelineno-38-1></a><span class=kn>package</span><span class=w> </span><span class=nx>service</span>
<a id=__codelineno-38-2 name=__codelineno-38-2 href=#__codelineno-38-2></a>
<a id=__codelineno-38-3 name=__codelineno-38-3 href=#__codelineno-38-3></a><span class=kn>import</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-38-4 name=__codelineno-38-4 href=#__codelineno-38-4></a><span class=w>    </span><span class=s>&quot;context&quot;</span>
<a id=__codelineno-38-5 name=__codelineno-38-5 href=#__codelineno-38-5></a><span class=w>    </span><span class=s>&quot;encoding/json&quot;</span>
<a id=__codelineno-38-6 name=__codelineno-38-6 href=#__codelineno-38-6></a><span class=w>    </span><span class=s>&quot;errors&quot;</span>
<a id=__codelineno-38-7 name=__codelineno-38-7 href=#__codelineno-38-7></a>
<a id=__codelineno-38-8 name=__codelineno-38-8 href=#__codelineno-38-8></a><span class=w>    </span><span class=s>&quot;github.com/wonderivan/logger&quot;</span>
<a id=__codelineno-38-9 name=__codelineno-38-9 href=#__codelineno-38-9></a><span class=w>    </span><span class=nx>appsv1</span><span class=w> </span><span class=s>&quot;k8s.io/api/apps/v1&quot;</span>
<a id=__codelineno-38-10 name=__codelineno-38-10 href=#__codelineno-38-10></a><span class=w>    </span><span class=nx>metav1</span><span class=w> </span><span class=s>&quot;k8s.io/apimachinery/pkg/apis/meta/v1&quot;</span>
<a id=__codelineno-38-11 name=__codelineno-38-11 href=#__codelineno-38-11></a><span class=p>)</span>
<a id=__codelineno-38-12 name=__codelineno-38-12 href=#__codelineno-38-12></a>
<a id=__codelineno-38-13 name=__codelineno-38-13 href=#__codelineno-38-13></a><span class=kd>var</span><span class=w> </span><span class=nx>DaemonSet</span><span class=w> </span><span class=nx>daemonSet</span>
<a id=__codelineno-38-14 name=__codelineno-38-14 href=#__codelineno-38-14></a>
<a id=__codelineno-38-15 name=__codelineno-38-15 href=#__codelineno-38-15></a><span class=kd>type</span><span class=w> </span><span class=nx>daemonSet</span><span class=w> </span><span class=kd>struct</span><span class=p>{}</span>
<a id=__codelineno-38-16 name=__codelineno-38-16 href=#__codelineno-38-16></a>
<a id=__codelineno-38-17 name=__codelineno-38-17 href=#__codelineno-38-17></a><span class=kd>type</span><span class=w> </span><span class=nx>DaemonSetsResp</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-38-18 name=__codelineno-38-18 href=#__codelineno-38-18></a><span class=w>    </span><span class=nx>Items</span><span class=w> </span><span class=p>[]</span><span class=nx>appsv1</span><span class=p>.</span><span class=nx>DaemonSet</span><span class=w> </span><span class=s>`json:&quot;items&quot;`</span>
<a id=__codelineno-38-19 name=__codelineno-38-19 href=#__codelineno-38-19></a><span class=w>    </span><span class=nx>Total</span><span class=w> </span><span class=kt>int</span><span class=w>                </span><span class=s>`json:&quot;total&quot;`</span>
<a id=__codelineno-38-20 name=__codelineno-38-20 href=#__codelineno-38-20></a><span class=p>}</span>
<a id=__codelineno-38-21 name=__codelineno-38-21 href=#__codelineno-38-21></a>
<a id=__codelineno-38-22 name=__codelineno-38-22 href=#__codelineno-38-22></a><span class=c1>// GetDaemonSets 获取daemonset列表，支持过滤、排序、分页</span>
<a id=__codelineno-38-23 name=__codelineno-38-23 href=#__codelineno-38-23></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>daemonSet</span><span class=p>)</span><span class=w> </span><span class=nx>GetDaemonSets</span><span class=p>(</span><span class=nx>filterName</span><span class=p>,</span><span class=w> </span><span class=nx>namespace</span><span class=w> </span><span class=kt>string</span><span class=p>,</span><span class=w> </span><span class=nx>limit</span><span class=p>,</span><span class=w> </span><span class=nx>page</span><span class=w> </span><span class=kt>int</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>daemonSetsResp</span><span class=w> </span><span class=o>*</span><span class=nx>DaemonSetsResp</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-38-24 name=__codelineno-38-24 href=#__codelineno-38-24></a><span class=w>    </span><span class=c1>//获取daemonSetList类型的daemonSet列表</span>
<a id=__codelineno-38-25 name=__codelineno-38-25 href=#__codelineno-38-25></a><span class=w>    </span><span class=nx>daemonSetList</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>AppsV1</span><span class=p>().</span><span class=nx>DaemonSets</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span><span class=nx>List</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>ListOptions</span><span class=p>{})</span>
<a id=__codelineno-38-26 name=__codelineno-38-26 href=#__codelineno-38-26></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-38-27 name=__codelineno-38-27 href=#__codelineno-38-27></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取DaemonSet列表失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-38-28 name=__codelineno-38-28 href=#__codelineno-38-28></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取DaemonSet列表失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-38-29 name=__codelineno-38-29 href=#__codelineno-38-29></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-38-30 name=__codelineno-38-30 href=#__codelineno-38-30></a><span class=w>    </span><span class=c1>//将daemonSetList中的daemonSet列表(Items)，放进dataselector对象中，进行排序</span>
<a id=__codelineno-38-31 name=__codelineno-38-31 href=#__codelineno-38-31></a><span class=w>    </span><span class=nx>selectableData</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>dataSelector</span><span class=p>{</span>
<a id=__codelineno-38-32 name=__codelineno-38-32 href=#__codelineno-38-32></a><span class=w>        </span><span class=nx>GenericDataList</span><span class=p>:</span><span class=w> </span><span class=nx>d</span><span class=p>.</span><span class=nx>toCells</span><span class=p>(</span><span class=nx>daemonSetList</span><span class=p>.</span><span class=nx>Items</span><span class=p>),</span>
<a id=__codelineno-38-33 name=__codelineno-38-33 href=#__codelineno-38-33></a><span class=w>        </span><span class=nx>dataSelectQuery</span><span class=p>:</span><span class=w> </span><span class=o>&amp;</span><span class=nx>DataSelectQuery</span><span class=p>{</span>
<a id=__codelineno-38-34 name=__codelineno-38-34 href=#__codelineno-38-34></a><span class=w>            </span><span class=nx>FilterQuery</span><span class=p>:</span><span class=w> </span><span class=o>&amp;</span><span class=nx>FilterQuery</span><span class=p>{</span><span class=nx>Name</span><span class=p>:</span><span class=w> </span><span class=nx>filterName</span><span class=p>},</span>
<a id=__codelineno-38-35 name=__codelineno-38-35 href=#__codelineno-38-35></a><span class=w>            </span><span class=nx>PaginateQuery</span><span class=p>:</span><span class=w> </span><span class=o>&amp;</span><span class=nx>PaginateQuery</span><span class=p>{</span>
<a id=__codelineno-38-36 name=__codelineno-38-36 href=#__codelineno-38-36></a><span class=w>                </span><span class=nx>Limit</span><span class=p>:</span><span class=w> </span><span class=nx>limit</span><span class=p>,</span>
<a id=__codelineno-38-37 name=__codelineno-38-37 href=#__codelineno-38-37></a><span class=w>                </span><span class=nx>Page</span><span class=p>:</span><span class=w>  </span><span class=nx>page</span><span class=p>,</span>
<a id=__codelineno-38-38 name=__codelineno-38-38 href=#__codelineno-38-38></a><span class=w>            </span><span class=p>},</span>
<a id=__codelineno-38-39 name=__codelineno-38-39 href=#__codelineno-38-39></a><span class=w>        </span><span class=p>},</span>
<a id=__codelineno-38-40 name=__codelineno-38-40 href=#__codelineno-38-40></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-38-41 name=__codelineno-38-41 href=#__codelineno-38-41></a>
<a id=__codelineno-38-42 name=__codelineno-38-42 href=#__codelineno-38-42></a><span class=w>    </span><span class=nx>filtered</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>selectableData</span><span class=p>.</span><span class=nx>Filter</span><span class=p>()</span>
<a id=__codelineno-38-43 name=__codelineno-38-43 href=#__codelineno-38-43></a><span class=w>    </span><span class=nx>total</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>filtered</span><span class=p>.</span><span class=nx>GenericDataList</span><span class=p>)</span>
<a id=__codelineno-38-44 name=__codelineno-38-44 href=#__codelineno-38-44></a><span class=w>    </span><span class=nx>data</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>filtered</span><span class=p>.</span><span class=nx>Sort</span><span class=p>().</span><span class=nx>Paginate</span><span class=p>()</span>
<a id=__codelineno-38-45 name=__codelineno-38-45 href=#__codelineno-38-45></a>
<a id=__codelineno-38-46 name=__codelineno-38-46 href=#__codelineno-38-46></a><span class=w>    </span><span class=c1>//将[]DataCell类型的daemonset列表转为v1.daemonset列表</span>
<a id=__codelineno-38-47 name=__codelineno-38-47 href=#__codelineno-38-47></a><span class=w>    </span><span class=nx>daemonSets</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>d</span><span class=p>.</span><span class=nx>fromCells</span><span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>GenericDataList</span><span class=p>)</span>
<a id=__codelineno-38-48 name=__codelineno-38-48 href=#__codelineno-38-48></a>
<a id=__codelineno-38-49 name=__codelineno-38-49 href=#__codelineno-38-49></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=o>&amp;</span><span class=nx>DaemonSetsResp</span><span class=p>{</span>
<a id=__codelineno-38-50 name=__codelineno-38-50 href=#__codelineno-38-50></a><span class=w>        </span><span class=nx>Items</span><span class=p>:</span><span class=w> </span><span class=nx>daemonSets</span><span class=p>,</span>
<a id=__codelineno-38-51 name=__codelineno-38-51 href=#__codelineno-38-51></a><span class=w>        </span><span class=nx>Total</span><span class=p>:</span><span class=w> </span><span class=nx>total</span><span class=p>,</span>
<a id=__codelineno-38-52 name=__codelineno-38-52 href=#__codelineno-38-52></a><span class=w>    </span><span class=p>},</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-38-53 name=__codelineno-38-53 href=#__codelineno-38-53></a><span class=p>}</span>
<a id=__codelineno-38-54 name=__codelineno-38-54 href=#__codelineno-38-54></a>
<a id=__codelineno-38-55 name=__codelineno-38-55 href=#__codelineno-38-55></a><span class=c1>// GetDaemonSetDetail 获取daemonset详情</span>
<a id=__codelineno-38-56 name=__codelineno-38-56 href=#__codelineno-38-56></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>daemonSet</span><span class=p>)</span><span class=w> </span><span class=nx>GetDaemonSetDetail</span><span class=p>(</span><span class=nx>daemonSetName</span><span class=p>,</span><span class=w> </span><span class=nx>namespace</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>daemonSet</span><span class=w> </span><span class=o>*</span><span class=nx>appsv1</span><span class=p>.</span><span class=nx>DaemonSet</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-38-57 name=__codelineno-38-57 href=#__codelineno-38-57></a><span class=w>    </span><span class=nx>daemonSet</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>AppsV1</span><span class=p>().</span><span class=nx>DaemonSets</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span><span class=nx>Get</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>daemonSetName</span><span class=p>,</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>GetOptions</span><span class=p>{})</span>
<a id=__codelineno-38-58 name=__codelineno-38-58 href=#__codelineno-38-58></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-38-59 name=__codelineno-38-59 href=#__codelineno-38-59></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取DaemonSet详情失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-38-60 name=__codelineno-38-60 href=#__codelineno-38-60></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取DaemonSet详情失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-38-61 name=__codelineno-38-61 href=#__codelineno-38-61></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-38-62 name=__codelineno-38-62 href=#__codelineno-38-62></a>
<a id=__codelineno-38-63 name=__codelineno-38-63 href=#__codelineno-38-63></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>daemonSet</span><span class=p>,</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-38-64 name=__codelineno-38-64 href=#__codelineno-38-64></a><span class=p>}</span>
<a id=__codelineno-38-65 name=__codelineno-38-65 href=#__codelineno-38-65></a>
<a id=__codelineno-38-66 name=__codelineno-38-66 href=#__codelineno-38-66></a><span class=c1>// DeleteDaemonSet 删除daemonset</span>
<a id=__codelineno-38-67 name=__codelineno-38-67 href=#__codelineno-38-67></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>daemonSet</span><span class=p>)</span><span class=w> </span><span class=nx>DeleteDaemonSet</span><span class=p>(</span><span class=nx>daemonSetName</span><span class=p>,</span><span class=w> </span><span class=nx>namespace</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-38-68 name=__codelineno-38-68 href=#__codelineno-38-68></a><span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>AppsV1</span><span class=p>().</span><span class=nx>DaemonSets</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span><span class=nx>Delete</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>daemonSetName</span><span class=p>,</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>DeleteOptions</span><span class=p>{})</span>
<a id=__codelineno-38-69 name=__codelineno-38-69 href=#__codelineno-38-69></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-38-70 name=__codelineno-38-70 href=#__codelineno-38-70></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;删除DaemonSet失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-38-71 name=__codelineno-38-71 href=#__codelineno-38-71></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;删除DaemonSet失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-38-72 name=__codelineno-38-72 href=#__codelineno-38-72></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-38-73 name=__codelineno-38-73 href=#__codelineno-38-73></a>
<a id=__codelineno-38-74 name=__codelineno-38-74 href=#__codelineno-38-74></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-38-75 name=__codelineno-38-75 href=#__codelineno-38-75></a><span class=p>}</span>
<a id=__codelineno-38-76 name=__codelineno-38-76 href=#__codelineno-38-76></a>
<a id=__codelineno-38-77 name=__codelineno-38-77 href=#__codelineno-38-77></a><span class=c1>// UpdateDaemonSet 更新daemonset</span>
<a id=__codelineno-38-78 name=__codelineno-38-78 href=#__codelineno-38-78></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>daemonSet</span><span class=p>)</span><span class=w> </span><span class=nx>UpdateDaemonSet</span><span class=p>(</span><span class=nx>namespace</span><span class=p>,</span><span class=w> </span><span class=nx>content</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-38-79 name=__codelineno-38-79 href=#__codelineno-38-79></a><span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=nx>daemonSet</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>appsv1</span><span class=p>.</span><span class=nx>DaemonSet</span><span class=p>{}</span>
<a id=__codelineno-38-80 name=__codelineno-38-80 href=#__codelineno-38-80></a>
<a id=__codelineno-38-81 name=__codelineno-38-81 href=#__codelineno-38-81></a><span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>json</span><span class=p>.</span><span class=nx>Unmarshal</span><span class=p>([]</span><span class=nb>byte</span><span class=p>(</span><span class=nx>content</span><span class=p>),</span><span class=w> </span><span class=nx>daemonSet</span><span class=p>)</span>
<a id=__codelineno-38-82 name=__codelineno-38-82 href=#__codelineno-38-82></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-38-83 name=__codelineno-38-83 href=#__codelineno-38-83></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;反序列化失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-38-84 name=__codelineno-38-84 href=#__codelineno-38-84></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;反序列化失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-38-85 name=__codelineno-38-85 href=#__codelineno-38-85></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-38-86 name=__codelineno-38-86 href=#__codelineno-38-86></a>
<a id=__codelineno-38-87 name=__codelineno-38-87 href=#__codelineno-38-87></a><span class=w>    </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>AppsV1</span><span class=p>().</span><span class=nx>DaemonSets</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span><span class=nx>Update</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>daemonSet</span><span class=p>,</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>UpdateOptions</span><span class=p>{})</span>
<a id=__codelineno-38-88 name=__codelineno-38-88 href=#__codelineno-38-88></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-38-89 name=__codelineno-38-89 href=#__codelineno-38-89></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;更新DaemonSet失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-38-90 name=__codelineno-38-90 href=#__codelineno-38-90></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;更新DaemonSet失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-38-91 name=__codelineno-38-91 href=#__codelineno-38-91></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-38-92 name=__codelineno-38-92 href=#__codelineno-38-92></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-38-93 name=__codelineno-38-93 href=#__codelineno-38-93></a><span class=p>}</span>
<a id=__codelineno-38-94 name=__codelineno-38-94 href=#__codelineno-38-94></a>
<a id=__codelineno-38-95 name=__codelineno-38-95 href=#__codelineno-38-95></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>daemonSet</span><span class=p>)</span><span class=w> </span><span class=nx>toCells</span><span class=p>(</span><span class=nx>std</span><span class=w> </span><span class=p>[]</span><span class=nx>appsv1</span><span class=p>.</span><span class=nx>DaemonSet</span><span class=p>)</span><span class=w> </span><span class=p>[]</span><span class=nx>DataCell</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-38-96 name=__codelineno-38-96 href=#__codelineno-38-96></a><span class=w>    </span><span class=nx>cells</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>make</span><span class=p>([]</span><span class=nx>DataCell</span><span class=p>,</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>std</span><span class=p>))</span>
<a id=__codelineno-38-97 name=__codelineno-38-97 href=#__codelineno-38-97></a><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=nx>i</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>std</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-38-98 name=__codelineno-38-98 href=#__codelineno-38-98></a><span class=w>        </span><span class=nx>cells</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>daemonSetCell</span><span class=p>(</span><span class=nx>std</span><span class=p>[</span><span class=nx>i</span><span class=p>])</span>
<a id=__codelineno-38-99 name=__codelineno-38-99 href=#__codelineno-38-99></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-38-100 name=__codelineno-38-100 href=#__codelineno-38-100></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>cells</span>
<a id=__codelineno-38-101 name=__codelineno-38-101 href=#__codelineno-38-101></a><span class=p>}</span>
<a id=__codelineno-38-102 name=__codelineno-38-102 href=#__codelineno-38-102></a>
<a id=__codelineno-38-103 name=__codelineno-38-103 href=#__codelineno-38-103></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>daemonSet</span><span class=p>)</span><span class=w> </span><span class=nx>fromCells</span><span class=p>(</span><span class=nx>cells</span><span class=w> </span><span class=p>[]</span><span class=nx>DataCell</span><span class=p>)</span><span class=w> </span><span class=p>[]</span><span class=nx>appsv1</span><span class=p>.</span><span class=nx>DaemonSet</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-38-104 name=__codelineno-38-104 href=#__codelineno-38-104></a><span class=w>    </span><span class=nx>daemonSets</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>make</span><span class=p>([]</span><span class=nx>appsv1</span><span class=p>.</span><span class=nx>DaemonSet</span><span class=p>,</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>cells</span><span class=p>))</span>
<a id=__codelineno-38-105 name=__codelineno-38-105 href=#__codelineno-38-105></a><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=nx>i</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>cells</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-38-106 name=__codelineno-38-106 href=#__codelineno-38-106></a><span class=w>        </span><span class=nx>daemonSets</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>appsv1</span><span class=p>.</span><span class=nx>DaemonSet</span><span class=p>(</span><span class=nx>cells</span><span class=p>[</span><span class=nx>i</span><span class=p>].(</span><span class=nx>daemonSetCell</span><span class=p>))</span>
<a id=__codelineno-38-107 name=__codelineno-38-107 href=#__codelineno-38-107></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-38-108 name=__codelineno-38-108 href=#__codelineno-38-108></a>
<a id=__codelineno-38-109 name=__codelineno-38-109 href=#__codelineno-38-109></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>daemonSets</span>
<a id=__codelineno-38-110 name=__codelineno-38-110 href=#__codelineno-38-110></a><span class=p>}</span>
</code></pre></div> <p><code>controller/daemonset.go</code></p> <div class=highlight><pre><span></span><code><a id=__codelineno-39-1 name=__codelineno-39-1 href=#__codelineno-39-1></a><span class=kn>package</span><span class=w> </span><span class=nx>controller</span>
<a id=__codelineno-39-2 name=__codelineno-39-2 href=#__codelineno-39-2></a>
<a id=__codelineno-39-3 name=__codelineno-39-3 href=#__codelineno-39-3></a><span class=kn>import</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-39-4 name=__codelineno-39-4 href=#__codelineno-39-4></a><span class=w>    </span><span class=s>&quot;gitee.com/k8s-platform/service&quot;</span>
<a id=__codelineno-39-5 name=__codelineno-39-5 href=#__codelineno-39-5></a><span class=w>    </span><span class=s>&quot;net/http&quot;</span>
<a id=__codelineno-39-6 name=__codelineno-39-6 href=#__codelineno-39-6></a>
<a id=__codelineno-39-7 name=__codelineno-39-7 href=#__codelineno-39-7></a><span class=w>    </span><span class=s>&quot;github.com/gin-gonic/gin&quot;</span>
<a id=__codelineno-39-8 name=__codelineno-39-8 href=#__codelineno-39-8></a><span class=w>    </span><span class=s>&quot;github.com/wonderivan/logger&quot;</span>
<a id=__codelineno-39-9 name=__codelineno-39-9 href=#__codelineno-39-9></a><span class=p>)</span>
<a id=__codelineno-39-10 name=__codelineno-39-10 href=#__codelineno-39-10></a>
<a id=__codelineno-39-11 name=__codelineno-39-11 href=#__codelineno-39-11></a><span class=kd>var</span><span class=w> </span><span class=nx>DaemonSet</span><span class=w> </span><span class=nx>daemonSet</span>
<a id=__codelineno-39-12 name=__codelineno-39-12 href=#__codelineno-39-12></a>
<a id=__codelineno-39-13 name=__codelineno-39-13 href=#__codelineno-39-13></a><span class=kd>type</span><span class=w> </span><span class=nx>daemonSet</span><span class=w> </span><span class=kd>struct</span><span class=p>{}</span>
<a id=__codelineno-39-14 name=__codelineno-39-14 href=#__codelineno-39-14></a>
<a id=__codelineno-39-15 name=__codelineno-39-15 href=#__codelineno-39-15></a><span class=c1>// GetDaemonSets 获取daemonset列表，支持过滤、排序、分页</span>
<a id=__codelineno-39-16 name=__codelineno-39-16 href=#__codelineno-39-16></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>daemonSet</span><span class=p>)</span><span class=w> </span><span class=nx>GetDaemonSets</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-39-17 name=__codelineno-39-17 href=#__codelineno-39-17></a><span class=w>    </span><span class=nx>params</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-39-18 name=__codelineno-39-18 href=#__codelineno-39-18></a><span class=w>        </span><span class=nx>FilterName</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`form:&quot;filter_name&quot;`</span>
<a id=__codelineno-39-19 name=__codelineno-39-19 href=#__codelineno-39-19></a><span class=w>        </span><span class=nx>Namespace</span><span class=w>  </span><span class=kt>string</span><span class=w> </span><span class=s>`form:&quot;namespace&quot;`</span>
<a id=__codelineno-39-20 name=__codelineno-39-20 href=#__codelineno-39-20></a><span class=w>        </span><span class=nx>Page</span><span class=w>       </span><span class=kt>int</span><span class=w>    </span><span class=s>`form:&quot;page&quot;`</span>
<a id=__codelineno-39-21 name=__codelineno-39-21 href=#__codelineno-39-21></a><span class=w>        </span><span class=nx>Limit</span><span class=w>      </span><span class=kt>int</span><span class=w>    </span><span class=s>`form:&quot;limit&quot;`</span>
<a id=__codelineno-39-22 name=__codelineno-39-22 href=#__codelineno-39-22></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-39-23 name=__codelineno-39-23 href=#__codelineno-39-23></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>Bind</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-39-24 name=__codelineno-39-24 href=#__codelineno-39-24></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-39-25 name=__codelineno-39-25 href=#__codelineno-39-25></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-39-26 name=__codelineno-39-26 href=#__codelineno-39-26></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-39-27 name=__codelineno-39-27 href=#__codelineno-39-27></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-39-28 name=__codelineno-39-28 href=#__codelineno-39-28></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-39-29 name=__codelineno-39-29 href=#__codelineno-39-29></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-39-30 name=__codelineno-39-30 href=#__codelineno-39-30></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-39-31 name=__codelineno-39-31 href=#__codelineno-39-31></a>
<a id=__codelineno-39-32 name=__codelineno-39-32 href=#__codelineno-39-32></a><span class=w>    </span><span class=nx>data</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>DaemonSet</span><span class=p>.</span><span class=nx>GetDaemonSets</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>FilterName</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Limit</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Page</span><span class=p>)</span>
<a id=__codelineno-39-33 name=__codelineno-39-33 href=#__codelineno-39-33></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-39-34 name=__codelineno-39-34 href=#__codelineno-39-34></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-39-35 name=__codelineno-39-35 href=#__codelineno-39-35></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-39-36 name=__codelineno-39-36 href=#__codelineno-39-36></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-39-37 name=__codelineno-39-37 href=#__codelineno-39-37></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-39-38 name=__codelineno-39-38 href=#__codelineno-39-38></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-39-39 name=__codelineno-39-39 href=#__codelineno-39-39></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-39-40 name=__codelineno-39-40 href=#__codelineno-39-40></a>
<a id=__codelineno-39-41 name=__codelineno-39-41 href=#__codelineno-39-41></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-39-42 name=__codelineno-39-42 href=#__codelineno-39-42></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;获取DaemonSet列表成功&quot;</span><span class=p>,</span>
<a id=__codelineno-39-43 name=__codelineno-39-43 href=#__codelineno-39-43></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=nx>data</span><span class=p>,</span>
<a id=__codelineno-39-44 name=__codelineno-39-44 href=#__codelineno-39-44></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-39-45 name=__codelineno-39-45 href=#__codelineno-39-45></a><span class=p>}</span>
<a id=__codelineno-39-46 name=__codelineno-39-46 href=#__codelineno-39-46></a>
<a id=__codelineno-39-47 name=__codelineno-39-47 href=#__codelineno-39-47></a><span class=c1>// GetDaemonSetDetail 获取daemonset详情</span>
<a id=__codelineno-39-48 name=__codelineno-39-48 href=#__codelineno-39-48></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>daemonSet</span><span class=p>)</span><span class=w> </span><span class=nx>GetDaemonSetDetail</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-39-49 name=__codelineno-39-49 href=#__codelineno-39-49></a><span class=w>    </span><span class=nx>params</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-39-50 name=__codelineno-39-50 href=#__codelineno-39-50></a><span class=w>        </span><span class=nx>DaemonSetName</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`form:&quot;daemonset_name&quot;`</span>
<a id=__codelineno-39-51 name=__codelineno-39-51 href=#__codelineno-39-51></a><span class=w>        </span><span class=nx>Namespace</span><span class=w>     </span><span class=kt>string</span><span class=w> </span><span class=s>`form:&quot;namespace&quot;`</span>
<a id=__codelineno-39-52 name=__codelineno-39-52 href=#__codelineno-39-52></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-39-53 name=__codelineno-39-53 href=#__codelineno-39-53></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>Bind</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-39-54 name=__codelineno-39-54 href=#__codelineno-39-54></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-39-55 name=__codelineno-39-55 href=#__codelineno-39-55></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-39-56 name=__codelineno-39-56 href=#__codelineno-39-56></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-39-57 name=__codelineno-39-57 href=#__codelineno-39-57></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-39-58 name=__codelineno-39-58 href=#__codelineno-39-58></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-39-59 name=__codelineno-39-59 href=#__codelineno-39-59></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-39-60 name=__codelineno-39-60 href=#__codelineno-39-60></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-39-61 name=__codelineno-39-61 href=#__codelineno-39-61></a>
<a id=__codelineno-39-62 name=__codelineno-39-62 href=#__codelineno-39-62></a><span class=w>    </span><span class=nx>data</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>DaemonSet</span><span class=p>.</span><span class=nx>GetDaemonSetDetail</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>DaemonSetName</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>)</span>
<a id=__codelineno-39-63 name=__codelineno-39-63 href=#__codelineno-39-63></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-39-64 name=__codelineno-39-64 href=#__codelineno-39-64></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-39-65 name=__codelineno-39-65 href=#__codelineno-39-65></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-39-66 name=__codelineno-39-66 href=#__codelineno-39-66></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-39-67 name=__codelineno-39-67 href=#__codelineno-39-67></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-39-68 name=__codelineno-39-68 href=#__codelineno-39-68></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-39-69 name=__codelineno-39-69 href=#__codelineno-39-69></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-39-70 name=__codelineno-39-70 href=#__codelineno-39-70></a>
<a id=__codelineno-39-71 name=__codelineno-39-71 href=#__codelineno-39-71></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-39-72 name=__codelineno-39-72 href=#__codelineno-39-72></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;获取DaemonSet详情成功&quot;</span><span class=p>,</span>
<a id=__codelineno-39-73 name=__codelineno-39-73 href=#__codelineno-39-73></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=nx>data</span><span class=p>,</span>
<a id=__codelineno-39-74 name=__codelineno-39-74 href=#__codelineno-39-74></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-39-75 name=__codelineno-39-75 href=#__codelineno-39-75></a><span class=p>}</span>
<a id=__codelineno-39-76 name=__codelineno-39-76 href=#__codelineno-39-76></a>
<a id=__codelineno-39-77 name=__codelineno-39-77 href=#__codelineno-39-77></a><span class=c1>// DeleteDaemonSet 删除daemonset</span>
<a id=__codelineno-39-78 name=__codelineno-39-78 href=#__codelineno-39-78></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>daemonSet</span><span class=p>)</span><span class=w> </span><span class=nx>DeleteDaemonSet</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-39-79 name=__codelineno-39-79 href=#__codelineno-39-79></a><span class=w>    </span><span class=nx>params</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-39-80 name=__codelineno-39-80 href=#__codelineno-39-80></a><span class=w>        </span><span class=nx>DaemonSetName</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;daemonset_name&quot;`</span>
<a id=__codelineno-39-81 name=__codelineno-39-81 href=#__codelineno-39-81></a><span class=w>        </span><span class=nx>Namespace</span><span class=w>     </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;namespace&quot;`</span>
<a id=__codelineno-39-82 name=__codelineno-39-82 href=#__codelineno-39-82></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-39-83 name=__codelineno-39-83 href=#__codelineno-39-83></a><span class=w>    </span><span class=c1>//DELETE请求，绑定参数方法改为ctx.ShouldBindJSON</span>
<a id=__codelineno-39-84 name=__codelineno-39-84 href=#__codelineno-39-84></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>ShouldBindJSON</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-39-85 name=__codelineno-39-85 href=#__codelineno-39-85></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-39-86 name=__codelineno-39-86 href=#__codelineno-39-86></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-39-87 name=__codelineno-39-87 href=#__codelineno-39-87></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-39-88 name=__codelineno-39-88 href=#__codelineno-39-88></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-39-89 name=__codelineno-39-89 href=#__codelineno-39-89></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-39-90 name=__codelineno-39-90 href=#__codelineno-39-90></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-39-91 name=__codelineno-39-91 href=#__codelineno-39-91></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-39-92 name=__codelineno-39-92 href=#__codelineno-39-92></a>
<a id=__codelineno-39-93 name=__codelineno-39-93 href=#__codelineno-39-93></a><span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>DaemonSet</span><span class=p>.</span><span class=nx>DeleteDaemonSet</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>DaemonSetName</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>)</span>
<a id=__codelineno-39-94 name=__codelineno-39-94 href=#__codelineno-39-94></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-39-95 name=__codelineno-39-95 href=#__codelineno-39-95></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-39-96 name=__codelineno-39-96 href=#__codelineno-39-96></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-39-97 name=__codelineno-39-97 href=#__codelineno-39-97></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-39-98 name=__codelineno-39-98 href=#__codelineno-39-98></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-39-99 name=__codelineno-39-99 href=#__codelineno-39-99></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-39-100 name=__codelineno-39-100 href=#__codelineno-39-100></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-39-101 name=__codelineno-39-101 href=#__codelineno-39-101></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-39-102 name=__codelineno-39-102 href=#__codelineno-39-102></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;删除DaemonSet成功&quot;</span><span class=p>,</span>
<a id=__codelineno-39-103 name=__codelineno-39-103 href=#__codelineno-39-103></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-39-104 name=__codelineno-39-104 href=#__codelineno-39-104></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-39-105 name=__codelineno-39-105 href=#__codelineno-39-105></a><span class=p>}</span>
<a id=__codelineno-39-106 name=__codelineno-39-106 href=#__codelineno-39-106></a>
<a id=__codelineno-39-107 name=__codelineno-39-107 href=#__codelineno-39-107></a><span class=c1>// UpdateDaemonSet 更新daemonset</span>
<a id=__codelineno-39-108 name=__codelineno-39-108 href=#__codelineno-39-108></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>daemonSet</span><span class=p>)</span><span class=w> </span><span class=nx>UpdateDaemonSet</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-39-109 name=__codelineno-39-109 href=#__codelineno-39-109></a><span class=w>    </span><span class=nx>params</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-39-110 name=__codelineno-39-110 href=#__codelineno-39-110></a><span class=w>        </span><span class=nx>Namespace</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;namespace&quot;`</span>
<a id=__codelineno-39-111 name=__codelineno-39-111 href=#__codelineno-39-111></a><span class=w>        </span><span class=nx>Content</span><span class=w>   </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;content&quot;`</span>
<a id=__codelineno-39-112 name=__codelineno-39-112 href=#__codelineno-39-112></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-39-113 name=__codelineno-39-113 href=#__codelineno-39-113></a><span class=w>    </span><span class=c1>//PUT请求，绑定参数方法改为ctx.ShouldBindJSON</span>
<a id=__codelineno-39-114 name=__codelineno-39-114 href=#__codelineno-39-114></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>ShouldBindJSON</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-39-115 name=__codelineno-39-115 href=#__codelineno-39-115></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-39-116 name=__codelineno-39-116 href=#__codelineno-39-116></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-39-117 name=__codelineno-39-117 href=#__codelineno-39-117></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-39-118 name=__codelineno-39-118 href=#__codelineno-39-118></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-39-119 name=__codelineno-39-119 href=#__codelineno-39-119></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-39-120 name=__codelineno-39-120 href=#__codelineno-39-120></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-39-121 name=__codelineno-39-121 href=#__codelineno-39-121></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-39-122 name=__codelineno-39-122 href=#__codelineno-39-122></a>
<a id=__codelineno-39-123 name=__codelineno-39-123 href=#__codelineno-39-123></a><span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>DaemonSet</span><span class=p>.</span><span class=nx>UpdateDaemonSet</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Content</span><span class=p>)</span>
<a id=__codelineno-39-124 name=__codelineno-39-124 href=#__codelineno-39-124></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-39-125 name=__codelineno-39-125 href=#__codelineno-39-125></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-39-126 name=__codelineno-39-126 href=#__codelineno-39-126></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-39-127 name=__codelineno-39-127 href=#__codelineno-39-127></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-39-128 name=__codelineno-39-128 href=#__codelineno-39-128></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-39-129 name=__codelineno-39-129 href=#__codelineno-39-129></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-39-130 name=__codelineno-39-130 href=#__codelineno-39-130></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-39-131 name=__codelineno-39-131 href=#__codelineno-39-131></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-39-132 name=__codelineno-39-132 href=#__codelineno-39-132></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;更新DaemonSet成功&quot;</span><span class=p>,</span>
<a id=__codelineno-39-133 name=__codelineno-39-133 href=#__codelineno-39-133></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-39-134 name=__codelineno-39-134 href=#__codelineno-39-134></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-39-135 name=__codelineno-39-135 href=#__codelineno-39-135></a><span class=p>}</span>
</code></pre></div> <h4 id=25-statefulset>2.5 StatefulSet<a class=headerlink href=#25-statefulset title="Permanent link">&para;</a></h4> <blockquote> <p>注意：以下功能与Pod和Deployment是实现方式一致</p> </blockquote> <table> <thead> <tr> <th>功能</th> <th>是否实现</th> </tr> </thead> <tbody> <tr> <td>StatefulSet列表</td> <td>√</td> </tr> <tr> <td>获取StatefulSet详情</td> <td>√</td> </tr> <tr> <td>删除StatefulSet</td> <td>√</td> </tr> <tr> <td>更新StatefulSet</td> <td>√</td> </tr> </tbody> </table> <h3 id=3-集群>3. 集群<a class=headerlink href=#3-集群 title="Permanent link">&para;</a></h3> <blockquote> <p>注意：以下3个资源是集群维度的，没有Namespace的概念</p> </blockquote> <h4 id=31-node>3.1 Node<a class=headerlink href=#31-node title="Permanent link">&para;</a></h4> <table> <thead> <tr> <th>功能</th> <th>是否实现</th> </tr> </thead> <tbody> <tr> <td>Node列表</td> <td>√</td> </tr> <tr> <td>获取Node详情</td> <td>√</td> </tr> </tbody> </table> <hr> <div class=md-source-file> <small> 最后更新: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime">November 21, 2023 19:12:28</span> <br> 创建日期: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime">October 24, 2023 16:47:51</span> </small> </div> <form class=md-feedback name=feedback hidden> <fieldset> <legend class=md-feedback__title> Was this page helpful? </legend> <div class=md-feedback__inner> <div class=md-feedback__list> <button class="md-feedback__icon md-icon" type=submit title="This page was helpful" data-md-value=1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m7 0c0 .8-.7 1.5-1.5 1.5S14 10.3 14 9.5 14.7 8 15.5 8s1.5.7 1.5 1.5m-5 7.73c-1.75 0-3.29-.73-4.19-1.81L9.23 14c.45.72 1.52 1.23 2.77 1.23s2.32-.51 2.77-1.23l1.42 1.42c-.9 1.08-2.44 1.81-4.19 1.81Z"/></svg> </button> <button class="md-feedback__icon md-icon" type=submit title="This page could be improved" data-md-value=0> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10m-6.5-4c.8 0 1.5.7 1.5 1.5s-.7 1.5-1.5 1.5-1.5-.7-1.5-1.5.7-1.5 1.5-1.5M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m2 4.5c1.75 0 3.29.72 4.19 1.81l-1.42 1.42C14.32 16.5 13.25 16 12 16s-2.32.5-2.77 1.23l-1.42-1.42C8.71 14.72 10.25 14 12 14Z"/></svg> </button> </div> <div class=md-feedback__note> <div data-md-value=1 hidden> Thanks for your feedback! </div> <div data-md-value=0 hidden> Thanks for your feedback! Help us improve this page by using our <a href="https://github.com/hujianli94/hujianli94.github.io/issues/new/?title=[Feedback]+K8s%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-%E5%90%8E%E7%AB%AFAPI%E5%BC%80%E5%8F%91+-+/Golang/13.K8s%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/1.K8s%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-%E5%90%8E%E7%AB%AFAPI%E5%BC%80%E5%8F%91/" target=_blank>feedback form</a>. </div> </div> </div> </fieldset> </form> </article> </div> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> 回到页面顶部 </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=页脚> <a href=../../12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/12.Element-Plus/ class="md-footer__link md-footer__link--prev" aria-label="上一页: 12.Element Plus"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> 上一页 </span> <div class=md-ellipsis> 12.Element Plus </div> </div> </a> <a href=../2.K8s%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/ class="md-footer__link md-footer__link--next" aria-label="下一页: K8s管理系统-前端开发"> <div class=md-footer__title> <span class=md-footer__direction> 下一页 </span> <div class=md-ellipsis> K8s管理系统-前端开发 </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2023 - 2024 hujainli94 </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/hujianli94 target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> <a href=https://kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com/blog_img/20220125122524.png target=_blank rel=noopener title=kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 576 512"><!-- Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M385.2 167.6c6.4 0 12.6.3 18.8 1.1C387.4 90.3 303.3 32 207.7 32 100.5 32 13 104.8 13 197.4c0 53.4 29.3 97.5 77.9 131.6l-19.3 58.6 68-34.1c24.4 4.8 43.8 9.7 68.2 9.7 6.2 0 12.1-.3 18.3-.8-4-12.9-6.2-26.6-6.2-40.8-.1-84.9 72.9-154 165.3-154zm-104.5-52.9c14.5 0 24.2 9.7 24.2 24.4 0 14.5-9.7 24.2-24.2 24.2-14.8 0-29.3-9.7-29.3-24.2.1-14.7 14.6-24.4 29.3-24.4zm-136.4 48.6c-14.5 0-29.3-9.7-29.3-24.2 0-14.8 14.8-24.4 29.3-24.4 14.8 0 24.4 9.7 24.4 24.4 0 14.6-9.6 24.2-24.4 24.2zM563 319.4c0-77.9-77.9-141.3-165.4-141.3-92.7 0-165.4 63.4-165.4 141.3S305 460.7 397.6 460.7c19.3 0 38.9-5.1 58.6-9.9l53.4 29.3-14.8-48.6C534 402.1 563 363.2 563 319.4zm-219.1-24.5c-9.7 0-19.3-9.7-19.3-19.6 0-9.7 9.7-19.3 19.3-19.3 14.8 0 24.4 9.7 24.4 19.3 0 10-9.7 19.6-24.4 19.6zm107.1 0c-9.7 0-19.3-9.7-19.3-19.6 0-9.7 9.7-19.3 19.3-19.3 14.5 0 24.4 9.7 24.4 19.3.1 10-9.9 19.6-24.4 19.6z"/></svg> </a> <a href="mailto:<1879324764@qq.com>" target=_blank rel=noopener title=发送邮件 class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M498.1 5.6c10.1 7 15.4 19.1 13.5 31.2l-64 416c-1.5 9.7-7.4 18.2-16 23s-18.9 5.4-28 1.6L284 427.7l-68.5 74.1c-8.9 9.7-22.9 12.9-35.2 8.1S160 493.2 160 480v-83.6c0-4 1.5-7.8 4.2-10.7l167.6-182.9c5.8-6.3 5.6-16-.4-22s-15.7-6.4-22-.7L106 360.8l-88.3-44.2C7.1 311.3.3 300.7 0 288.9s5.9-22.8 16.1-28.7l448-256c10.7-6.1 23.9-5.5 34 1.4z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-consent data-md-component=consent id=__consent hidden> <div class=md-consent__overlay></div> <aside class=md-consent__inner> <form class="md-consent__form md-grid md-typeset" name=consent> <h4>Cookie consent</h4> <p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p> <input class=md-toggle type=checkbox id=__settings> <div class=md-consent__settings> <ul class=task-list> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=analytics checked> <span class=task-list-indicator></span> Google Analytics </label> </li> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=github checked> <span class=task-list-indicator></span> GitHub </label> </li> </ul> </div> <div class=md-consent__controls> <button class="md-button md-button--primary">同意</button> <label class=md-button for=__settings>管理设定</label> </div> </form> </aside> </div> <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout(function(){document.querySelector("[data-md-component=consent]").hidden=!1},250);var action,form=document.forms.consent;for(action of["submit","reset"])form.addEventListener(action,function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map(function(e){return[e,!0]}))),location.hash="",location.reload()})</script> <script id=__config type=application/json>{"base": "../../..", "features": ["content.action.edit", "content.action.view", "content.code.copy", "content.code.annotate", "navigation.indexes", "navigation.footer", "navigation.indexes", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest"], "search": "../../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script> <script src=../../../assets/javascripts/bundle.6c14ae12.min.js></script> <script src=../../../javascripts/extra.js></script> <script src=https://file.cdn.shafish.cn/blog/js/video.min.js></script> </body> </html>