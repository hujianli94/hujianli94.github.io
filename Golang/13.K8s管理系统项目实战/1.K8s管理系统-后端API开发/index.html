<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="stay hungry,stay foolish"><meta name=author content=hujainli94><link href=https://hujianli94.github.io/Golang/13.K8s%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/1.K8s%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-%E5%90%8E%E7%AB%AFAPI%E5%BC%80%E5%8F%91/ rel=canonical><link href=../../12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/12.Element-Plus/ rel=prev><link href=../2.K8s%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/ rel=next><link rel=icon href=../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.5.3, mkdocs-material-9.5.12"><title>K8s管理系统-后端API开发 - DevOps运维开发</title><link rel=stylesheet href=../../../assets/stylesheets/main.7e359304.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.06af60db.min.css><style>:root{--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M1 7.775V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 0 1 0 2.474l-5.026 5.026a1.75 1.75 0 0 1-2.474 0l-6.25-6.25A1.752 1.752 0 0 1 1 7.775Zm1.5 0c0 .066.026.13.073.177l6.25 6.25a.25.25 0 0 0 .354 0l5.025-5.025a.25.25 0 0 0 0-.354l-6.25-6.25a.25.25 0 0 0-.177-.073H2.75a.25.25 0 0 0-.25.25ZM6 5a1 1 0 1 1 0 2 1 1 0 0 1 0-2Z"/></svg>');--md-admonition-icon--abstract:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M2.5 1.75v11.5c0 .138.112.25.25.25h3.17a.75.75 0 0 1 0 1.5H2.75A1.75 1.75 0 0 1 1 13.25V1.75C1 .784 1.784 0 2.75 0h8.5C12.216 0 13 .784 13 1.75v7.736a.75.75 0 0 1-1.5 0V1.75a.25.25 0 0 0-.25-.25h-8.5a.25.25 0 0 0-.25.25Zm13.274 9.537v-.001l-4.557 4.45a.75.75 0 0 1-1.055-.008l-1.943-1.95a.75.75 0 0 1 1.062-1.058l1.419 1.425 4.026-3.932a.75.75 0 1 1 1.048 1.074ZM4.75 4h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM4 7.75A.75.75 0 0 1 4.75 7h2a.75.75 0 0 1 0 1.5h-2A.75.75 0 0 1 4 7.75Z"/></svg>');--md-admonition-icon--info:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"/></svg>');--md-admonition-icon--tip:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M3.499.75a.75.75 0 0 1 1.5 0v.996C5.9 2.903 6.793 3.65 7.662 4.376l.24.202c-.036-.694.055-1.422.426-2.163C9.1.873 10.794-.045 12.622.26 14.408.558 16 1.94 16 4.25c0 1.278-.954 2.575-2.44 2.734l.146.508.065.22c.203.701.412 1.455.476 2.226.142 1.707-.4 3.03-1.487 3.898C11.714 14.671 10.27 15 8.75 15h-6a.75.75 0 0 1 0-1.5h1.376a4.484 4.484 0 0 1-.563-1.191 3.835 3.835 0 0 1-.05-2.063 4.647 4.647 0 0 1-2.025-.293.75.75 0 0 1 .525-1.406c1.357.507 2.376-.006 2.698-.318l.009-.01a.747.747 0 0 1 1.06 0 .748.748 0 0 1-.012 1.074c-.912.92-.992 1.835-.768 2.586.221.74.745 1.337 1.196 1.621H8.75c1.343 0 2.398-.296 3.074-.836.635-.507 1.036-1.31.928-2.602-.05-.603-.216-1.224-.422-1.93l-.064-.221c-.12-.407-.246-.84-.353-1.29a2.425 2.425 0 0 1-.507-.441 3.075 3.075 0 0 1-.633-1.248.75.75 0 0 1 1.455-.364c.046.185.144.436.31.627.146.168.353.305.712.305.738 0 1.25-.615 1.25-1.25 0-1.47-.95-2.315-2.123-2.51-1.172-.196-2.227.387-2.706 1.345-.46.92-.27 1.774.019 3.062l.042.19a.884.884 0 0 1 .01.05c.348.443.666.949.94 1.553a.75.75 0 1 1-1.365.62c-.553-1.217-1.32-1.94-2.3-2.768L6.7 5.527c-.814-.68-1.75-1.462-2.692-2.619a3.737 3.737 0 0 0-1.023.88c-.406.495-.663 1.036-.722 1.508.116.122.306.21.591.239.388.038.797-.06 1.032-.19a.75.75 0 0 1 .728 1.31c-.515.287-1.23.439-1.906.373-.682-.067-1.473-.38-1.879-1.193L.75 5.677V5.5c0-.984.48-1.94 1.077-2.664.46-.559 1.05-1.055 1.673-1.353V.75Z"/></svg>');--md-admonition-icon--success:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"/></svg>');--md-admonition-icon--question:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.92 6.085h.001a.749.749 0 1 1-1.342-.67c.169-.339.436-.701.849-.977C6.845 4.16 7.369 4 8 4a2.756 2.756 0 0 1 1.637.525c.503.377.863.965.863 1.725 0 .448-.115.83-.329 1.15-.205.307-.47.513-.692.662-.109.072-.22.138-.313.195l-.006.004a6.24 6.24 0 0 0-.26.16.952.952 0 0 0-.276.245.75.75 0 0 1-1.248-.832c.184-.264.42-.489.692-.661.103-.067.207-.132.313-.195l.007-.004c.1-.061.182-.11.258-.161a.969.969 0 0 0 .277-.245C8.96 6.514 9 6.427 9 6.25a.612.612 0 0 0-.262-.525A1.27 1.27 0 0 0 8 5.5c-.369 0-.595.09-.74.187a1.01 1.01 0 0 0-.34.398ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"/></svg>');--md-admonition-icon--warning:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"/></svg>');--md-admonition-icon--failure:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M2.344 2.343h-.001a8 8 0 0 1 11.314 11.314A8.002 8.002 0 0 1 .234 10.089a8 8 0 0 1 2.11-7.746Zm1.06 10.253a6.5 6.5 0 1 0 9.108-9.275 6.5 6.5 0 0 0-9.108 9.275ZM6.03 4.97 8 6.94l1.97-1.97a.749.749 0 0 1 1.275.326.749.749 0 0 1-.215.734L9.06 8l1.97 1.97a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215L8 9.06l-1.97 1.97a.749.749 0 0 1-1.275-.326.749.749 0 0 1 .215-.734L6.94 8 4.97 6.03a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018Z"/></svg>');--md-admonition-icon--danger:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M9.504.43a1.516 1.516 0 0 1 2.437 1.713L10.415 5.5h2.123c1.57 0 2.346 1.909 1.22 3.004l-7.34 7.142a1.249 1.249 0 0 1-.871.354h-.302a1.25 1.25 0 0 1-1.157-1.723L5.633 10.5H3.462c-1.57 0-2.346-1.909-1.22-3.004L9.503.429Zm1.047 1.074L3.286 8.571A.25.25 0 0 0 3.462 9H6.75a.75.75 0 0 1 .694 1.034l-1.713 4.188 6.982-6.793A.25.25 0 0 0 12.538 7H9.25a.75.75 0 0 1-.683-1.06l2.008-4.418.003-.006a.036.036 0 0 0-.004-.009l-.006-.006-.008-.001c-.003 0-.006.002-.009.004Z"/></svg>');--md-admonition-icon--bug:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M4.72.22a.75.75 0 0 1 1.06 0l1 .999a3.488 3.488 0 0 1 2.441 0l.999-1a.748.748 0 0 1 1.265.332.75.75 0 0 1-.205.729l-.775.776c.616.63.995 1.493.995 2.444v.327c0 .1-.009.197-.025.292.408.14.764.392 1.029.722l1.968-.787a.75.75 0 0 1 .556 1.392L13 7.258V9h2.25a.75.75 0 0 1 0 1.5H13v.5c0 .409-.049.806-.141 1.186l2.17.868a.75.75 0 0 1-.557 1.392l-2.184-.873A4.997 4.997 0 0 1 8 16a4.997 4.997 0 0 1-4.288-2.427l-2.183.873a.75.75 0 0 1-.558-1.392l2.17-.868A5.036 5.036 0 0 1 3 11v-.5H.75a.75.75 0 0 1 0-1.5H3V7.258L.971 6.446a.75.75 0 0 1 .558-1.392l1.967.787c.265-.33.62-.583 1.03-.722a1.677 1.677 0 0 1-.026-.292V4.5c0-.951.38-1.814.995-2.444L4.72 1.28a.75.75 0 0 1 0-1.06Zm.53 6.28a.75.75 0 0 0-.75.75V11a3.5 3.5 0 1 0 7 0V7.25a.75.75 0 0 0-.75-.75ZM6.173 5h3.654A.172.172 0 0 0 10 4.827V4.5a2 2 0 1 0-4 0v.327c0 .096.077.173.173.173Z"/></svg>');--md-admonition-icon--example:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M5 5.782V2.5h-.25a.75.75 0 0 1 0-1.5h6.5a.75.75 0 0 1 0 1.5H11v3.282l3.666 5.76C15.619 13.04 14.543 15 12.767 15H3.233c-1.776 0-2.852-1.96-1.899-3.458Zm-2.4 6.565a.75.75 0 0 0 .633 1.153h9.534a.75.75 0 0 0 .633-1.153L12.225 10.5h-8.45ZM9.5 2.5h-3V6c0 .143-.04.283-.117.403L4.73 9h6.54L9.617 6.403A.746.746 0 0 1 9.5 6Z"/></svg>');--md-admonition-icon--quote:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M1.75 2.5h10.5a.75.75 0 0 1 0 1.5H1.75a.75.75 0 0 1 0-1.5Zm4 5h8.5a.75.75 0 0 1 0 1.5h-8.5a.75.75 0 0 1 0-1.5Zm0 5h8.5a.75.75 0 0 1 0 1.5h-8.5a.75.75 0 0 1 0-1.5ZM2.5 7.75v6a.75.75 0 0 1-1.5 0v-6a.75.75 0 0 1 1.5 0Z"/></svg>');}</style><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../stylesheets/extra.css><link rel=stylesheet href=https://file.cdn.shafish.cn/blog/css/vssue.css><link rel=stylesheet href=https://file.cdn.shafish.cn/blog/css/video-js.min.css><link rel=stylesheet href=https://file.cdn.shafish.cn/blog/css/video.css><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","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"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","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",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=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",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script><script>var consent;"undefined"==typeof __md_analytics||(consent=__md_get("__consent"))&&consent.analytics&&__md_analytics()</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#k8s管理系统-后端api开发 class=md-skip> 跳转至 </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=页眉> <a href=../../.. title=DevOps运维开发 class="md-header__button md-logo" aria-label=DevOps运维开发 data-md-component=logo> <img src=../../../assets/images/logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> DevOps运维开发 </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> K8s管理系统-后端API开发 </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label=切换至深色模式 type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title=切换至深色模式 for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=blue data-md-color-accent=blue aria-label=切换至浅色模式 type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title=切换至浅色模式 for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg> </label> </form> <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=查找> <a href=javascript:void(0) class="md-search__icon md-icon" title=分享 aria-label=分享 data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=清空当前内容 aria-label=清空当前内容 tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> 正在初始化搜索引擎 </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/hujianli94/hujianli94.github.io title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> hujianli94.github.io </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=标签 data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> 首页 </a> </li> <li class=md-tabs__item> <a href=../../../k8s/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.k8s/ class=md-tabs__link> k8s </a> </li> <li class=md-tabs__item> <a href=../../../Kubernetes/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Kubernetes/ class=md-tabs__link> Kubernetes </a> </li> <li class=md-tabs__item> <a href=../../../Docker/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Docker/ class=md-tabs__link> Docker </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../../0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Go-Web%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98/ class=md-tabs__link> Golang </a> </li> <li class=md-tabs__item> <a href=../../../Python/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Pythjon-auto-ops/ class=md-tabs__link> Python </a> </li> <li class=md-tabs__item> <a href=../../../Python-vs-Go/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Python-vs-Go/ class=md-tabs__link> Python-vs-Go </a> </li> <li class=md-tabs__item> <a href=../../../Linux/Shell/Shell%E7%AE%80%E4%BB%8B/ class=md-tabs__link> Linux </a> </li> <li class=md-tabs__item> <a href=../../../Other/tools/1.PicGo%E5%9B%BE%E5%BA%8A/ class=md-tabs__link> Other </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=导航栏 data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title=DevOps运维开发 class="md-nav__button md-logo" aria-label=DevOps运维开发 data-md-component=logo> <img src=../../../assets/images/logo.png alt=logo> </a> DevOps运维开发 </label> <div class=md-nav__source> <a href=https://github.com/hujianli94/hujianli94.github.io title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> hujianli94.github.io </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> <span class=md-ellipsis> 首页 </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> k8s </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> k8s </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_1> <label class=md-nav__link for=__nav_2_1 id=__nav_2_1_label tabindex=0> <span class=md-ellipsis> 0.学习线路 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_1_label aria-expanded=false> <label class=md-nav__title for=__nav_2_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.k8s/ class=md-nav__link> <span class=md-ellipsis> Kubernetes从入门到实践 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2> <label class=md-nav__link for=__nav_2_2 id=__nav_2_2_label tabindex=0> <span class=md-ellipsis> 1.容器的发展史 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2> <span class="md-nav__icon md-icon"></span> 1.容器的发展史 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/1.%E5%AE%B9%E5%99%A8%E7%9A%84%E5%8F%91%E5%B1%95%E5%8F%B2/1.1%E5%BC%80%E5%8F%91%E8%BF%87%E7%A8%8B%E7%9A%84%E5%8F%91%E5%B1%95/ class=md-nav__link> <span class=md-ellipsis> 1.1开发过程的发展 </span> </a> </li> <li class=md-nav__item> <a href=../../../k8s/1.%E5%AE%B9%E5%99%A8%E7%9A%84%E5%8F%91%E5%B1%95%E5%8F%B2/1.2%E5%BA%94%E7%94%A8%E6%9E%B6%E6%9E%84%E7%9A%84%E5%8F%91%E5%B1%95/ class=md-nav__link> <span class=md-ellipsis> 1.2应用架构的发展 </span> </a> </li> <li class=md-nav__item> <a href=../../../k8s/1.%E5%AE%B9%E5%99%A8%E7%9A%84%E5%8F%91%E5%B1%95%E5%8F%B2/1.3%E9%83%A8%E7%BD%B2%E6%89%93%E5%8C%85%E7%9A%84%E5%8F%91%E5%B1%95/ class=md-nav__link> <span class=md-ellipsis> 1.3部署打包的发展 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_3> <label class=md-nav__link for=__nav_2_3 id=__nav_2_3_label tabindex=0> <span class=md-ellipsis> 2.Kubernetes的核心概念 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_3_label aria-expanded=false> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> 2.Kubernetes的核心概念 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/2.Kubernetes%E7%9A%84%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/2.1Kubernetes%E7%9A%84%E8%AE%BE%E8%AE%A1%E6%9E%B6%E6%9E%84/ class=md-nav__link> <span class=md-ellipsis> 2.1Kubernetes的设计架构 </span> </a> </li> <li class=md-nav__item> <a href=../../../k8s/2.Kubernetes%E7%9A%84%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/2.2Kubernetes%E7%9A%84%E6%A0%B8%E5%BF%83%E5%AF%B9%E8%B1%A1/ class=md-nav__link> <span class=md-ellipsis> 2.2Kubernetes的核心对象 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_4> <label class=md-nav__link for=__nav_2_4 id=__nav_2_4_label tabindex=0> <span class=md-ellipsis> 3.Kubernetes的安装和部署 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_4_label aria-expanded=false> <label class=md-nav__title for=__nav_2_4> <span class="md-nav__icon md-icon"></span> 3.Kubernetes的安装和部署 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/3.Kubernetes%E7%9A%84%E5%AE%89%E8%A3%85%E5%92%8C%E9%83%A8%E7%BD%B2/3.1kubeadm%E6%90%AD%E5%BB%BA%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/ class=md-nav__link> <span class=md-ellipsis> 3.1kubeadm搭建开发环境 </span> </a> </li> <li class=md-nav__item> <a href=../../../k8s/3.Kubernetes%E7%9A%84%E5%AE%89%E8%A3%85%E5%92%8C%E9%83%A8%E7%BD%B2/3.2kubeadm%E6%90%AD%E5%BB%BA%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83/ class=md-nav__link> <span class=md-ellipsis> 3.2kubeadm搭建生产环境 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_5> <label class=md-nav__link for=__nav_2_5 id=__nav_2_5_label tabindex=0> <span class=md-ellipsis> 4.Pod </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_5_label aria-expanded=false> <label class=md-nav__title for=__nav_2_5> <span class="md-nav__icon md-icon"></span> 4.Pod </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/4.Pod/4.1Pod%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/ class=md-nav__link> <span class=md-ellipsis> 4.1Pod的基本操作 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_6> <label class=md-nav__link for=__nav_2_6 id=__nav_2_6_label tabindex=0> <span class=md-ellipsis> 5.控制器 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_6_label aria-expanded=false> <label class=md-nav__title for=__nav_2_6> <span class="md-nav__icon md-icon"></span> 5.控制器 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/5.%E6%8E%A7%E5%88%B6%E5%99%A8/5.1Deployment/ class=md-nav__link> <span class=md-ellipsis> 5.1Deployment </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> Kubernetes </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1> <label class=md-nav__link for=__nav_3_1 id=__nav_3_1_label tabindex=0> <span class=md-ellipsis> 0.学习线路 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_1_label aria-expanded=false> <label class=md-nav__title for=__nav_3_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Kubernetes/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Kubernetes/ class=md-nav__link> <span class=md-ellipsis> Kubernetes </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2> <label class=md-nav__link for=__nav_3_2 id=__nav_3_2_label tabindex=0> <span class=md-ellipsis> 1.安装篇 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> 1.安装篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/1.Kubeadm%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/ class=md-nav__link> <span class=md-ellipsis> Kubeadm安装高可用集群 </span> </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/2.%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/ class=md-nav__link> <span class=md-ellipsis> 二进制安装高可用K8s集群 </span> </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/3.%E5%AE%89%E8%A3%85%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/ class=md-nav__link> <span class=md-ellipsis> 安装常用工具 </span> </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/4.Kubeadm%E5%AE%89%E8%A3%85%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/ class=md-nav__link> <span class=md-ellipsis> Kubeadm安装开发环境 </span> </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/5.K3s%E5%92%8CMinikube/ class=md-nav__link> <span class=md-ellipsis> K3s和Minikube </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_3> <label class=md-nav__link for=__nav_3_3 id=__nav_3_3_label tabindex=0> <span class=md-ellipsis> 2.基础篇 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> 2.基础篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/3.Docker%E5%9F%BA%E7%A1%80/ class=md-nav__link> <span class=md-ellipsis> Docker基础 </span> </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Kubernetes%E7%9A%84%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/ class=md-nav__link> <span class=md-ellipsis> Kubernetes的基础概念 </span> </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Kubernetes%E8%B0%83%E5%BA%A6%E5%9F%BA%E7%A1%80/ class=md-nav__link> <span class=md-ellipsis> Kubernetes调度基础 </span> </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/6.Kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83%E5%9F%BA%E7%A1%80/ class=md-nav__link> <span class=md-ellipsis> Kubernetes服务发布基础 </span> </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/7.Kubernetes%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> Kubernetes配置管理 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_4> <label class=md-nav__link for=__nav_3_4 id=__nav_3_4_label tabindex=0> <span class=md-ellipsis> 3.进阶篇 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_4_label aria-expanded=false> <label class=md-nav__title for=__nav_3_4> <span class="md-nav__icon md-icon"></span> 3.进阶篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Kubernetes/3.%E8%BF%9B%E9%98%B6%E7%AF%87/8.Kubernetes%E5%AD%98%E5%82%A8%E5%85%A5%E9%97%A8/ class=md-nav__link> <span class=md-ellipsis> Kubernetes存储入门 </span> </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/3.%E8%BF%9B%E9%98%B6%E7%AF%87/9.Kubernetes%E9%AB%98%E7%BA%A7%E8%B0%83%E5%BA%A6/ class=md-nav__link> <span class=md-ellipsis> Kubernetes高级调度 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_5> <label class=md-nav__link for=__nav_3_5 id=__nav_3_5_label tabindex=0> <span class=md-ellipsis> 4.高级篇 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_5_label aria-expanded=false> <label class=md-nav__title for=__nav_3_5> <span class="md-nav__icon md-icon"></span> 4.高级篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Kubernetes/4.%E9%AB%98%E7%BA%A7%E7%AF%87/12.%E4%BA%91%E5%8E%9F%E7%94%9F%E5%AD%98%E5%82%A8Rook/ class=md-nav__link> <span class=md-ellipsis> 云原生存储Rook </span> </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/4.%E9%AB%98%E7%BA%A7%E7%AF%87/13.%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%AE%B9%E5%99%A8%E5%8C%96/ class=md-nav__link> <span class=md-ellipsis> 中间件容器化 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_6> <label class=md-nav__link for=__nav_3_6 id=__nav_3_6_label tabindex=0> <span class=md-ellipsis> 5.运维篇 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_6_label aria-expanded=false> <label class=md-nav__title for=__nav_3_6> <span class="md-nav__icon md-icon"></span> 5.运维篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/14.Kubernetes%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/ class=md-nav__link> <span class=md-ellipsis> Kubernetes日志收集 </span> </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/15.Kubernetes%E7%9B%91%E6%8E%A7%E5%91%8A%E8%AD%A6/ class=md-nav__link> <span class=md-ellipsis> Kubernetes监控告警 </span> </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/16.%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83Ingress%E8%BF%9B%E9%98%B6/ class=md-nav__link> <span class=md-ellipsis> 服务发布Ingress进阶 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_7> <label class=md-nav__link for=__nav_3_7 id=__nav_3_7_label tabindex=0> <span class=md-ellipsis> 6.DevOps篇 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_7_label aria-expanded=false> <label class=md-nav__title for=__nav_3_7> <span class="md-nav__icon md-icon"></span> 6.DevOps篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/ class=md-nav__link> <span class=md-ellipsis> DevOps实践 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> Docker </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Docker </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_1> <label class=md-nav__link for=__nav_4_1 id=__nav_4_1_label tabindex=0> <span class=md-ellipsis> 0.学习线路 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_1_label aria-expanded=false> <label class=md-nav__title for=__nav_4_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Docker/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Docker/ class=md-nav__link> <span class=md-ellipsis> Docker </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_2> <label class=md-nav__link for=__nav_4_2 id=__nav_4_2_label tabindex=0> <span class=md-ellipsis> 1.基础 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_2_label aria-expanded=false> <label class=md-nav__title for=__nav_4_2> <span class="md-nav__icon md-icon"></span> 1.基础 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Docker/1.%E5%9F%BA%E7%A1%80/1.%E5%AE%89%E8%A3%85Docker/ class=md-nav__link> <span class=md-ellipsis> 1.安装Docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.%E5%9F%BA%E7%A1%80/2.Docker%E9%95%9C%E5%83%8F/ class=md-nav__link> <span class=md-ellipsis> 2.Docker镜像 </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.%E5%9F%BA%E7%A1%80/3.Docker%E5%AE%B9%E5%99%A8/ class=md-nav__link> <span class=md-ellipsis> 3.Docker容器 </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.%E5%9F%BA%E7%A1%80/4.%E4%BC%81%E4%B8%9A%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93harbor/ class=md-nav__link> <span class=md-ellipsis> 4.企业私有仓库harbor </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.%E5%9F%BA%E7%A1%80/5.Docker%E6%95%B0%E6%8D%AE/ class=md-nav__link> <span class=md-ellipsis> 5.Docker数据 </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.%E5%9F%BA%E7%A1%80/6.Docker%E7%BD%91%E7%BB%9C/ class=md-nav__link> <span class=md-ellipsis> 6.Docker网络 </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.%E5%9F%BA%E7%A1%80/7.Dockerfile/ class=md-nav__link> <span class=md-ellipsis> 7.Dockerfile </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.%E5%9F%BA%E7%A1%80/8.docker-compose/ class=md-nav__link> <span class=md-ellipsis> 8.docker-compose </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.%E5%9F%BA%E7%A1%80/9.Docker%E7%9B%B8%E5%85%B3%E8%84%9A%E6%9C%AC/ class=md-nav__link> <span class=md-ellipsis> 9.Docker相关脚本 </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.%E5%9F%BA%E7%A1%80/10.Docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/ class=md-nav__link> <span class=md-ellipsis> 10.Docker常用命令 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_3> <label class=md-nav__link for=__nav_4_3 id=__nav_4_3_label tabindex=0> <span class=md-ellipsis> 2.实战案例 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_3_label aria-expanded=false> <label class=md-nav__title for=__nav_4_3> <span class="md-nav__icon md-icon"></span> 2.实战案例 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/1.%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/ class=md-nav__link> <span class=md-ellipsis> 1.操作系统 </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/2.Web%E6%9C%8D%E5%8A%A1%E4%B8%8E%E5%BA%94%E7%94%A8/ class=md-nav__link> <span class=md-ellipsis> 2.Web服务与应用 </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/3.%E6%8C%81%E7%BB%AD%E5%BC%80%E5%8F%91%E4%B8%8E%E7%AE%A1%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 3.持续开发与管理 </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/4.%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BA%94%E7%94%A8/ class=md-nav__link> <span class=md-ellipsis> 4.数据库应用 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_4> <label class=md-nav__link for=__nav_4_4 id=__nav_4_4_label tabindex=0> <span class=md-ellipsis> 3.Devops </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4_4> <span class="md-nav__icon md-icon"></span> 3.Devops </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Docker/3.Devops/1.confcenter-docker/ class=md-nav__link> <span class=md-ellipsis> 1.confcenter-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/2.simaple-jenkins/ class=md-nav__link> <span class=md-ellipsis> 2.simaple-jenkins </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/3.docker-nginx-spa/ class=md-nav__link> <span class=md-ellipsis> 3.docker-nginx-spa </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/4.fileserver-docker/ class=md-nav__link> <span class=md-ellipsis> 4.fileserver-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/5.haproxy-docker/ class=md-nav__link> <span class=md-ellipsis> 5.haproxy-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/6.mysql-docker/ class=md-nav__link> <span class=md-ellipsis> 6.mysql-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/7.frp-docker/ class=md-nav__link> <span class=md-ellipsis> 7.frp-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/8.coredns-docker/ class=md-nav__link> <span class=md-ellipsis> 8.coredns-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/9.simple-harbor/ class=md-nav__link> <span class=md-ellipsis> 9.simple-harbor </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/10.redis-docker/ class=md-nav__link> <span class=md-ellipsis> 10.redis-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/11.nexus3-docker/ class=md-nav__link> <span class=md-ellipsis> 11.nexus3-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/12.openvpn-docker/ class=md-nav__link> <span class=md-ellipsis> 12.openvpn-docker.md </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/13.nfs-docker/ class=md-nav__link> <span class=md-ellipsis> 13.nfs-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/14.jumpserver-docker/ class=md-nav__link> <span class=md-ellipsis> 14.jumpserver-docker.md </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/15.ansible-docker/ class=md-nav__link> <span class=md-ellipsis> 15.ansible-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/16.minio-docker/ class=md-nav__link> <span class=md-ellipsis> 16.minio-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/17.vaultwarden-docker/ class=md-nav__link> <span class=md-ellipsis> 17.vaultwarden-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/18.kasm-docker/ class=md-nav__link> <span class=md-ellipsis> 18.kasm-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/19.nginx-docker/ class=md-nav__link> <span class=md-ellipsis> 19.nginx-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/20.kafka-docker/ class=md-nav__link> <span class=md-ellipsis> 20.kafka-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/21.golang-docker/ class=md-nav__link> <span class=md-ellipsis> 21.golang-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/22.postgres-docker/ class=md-nav__link> <span class=md-ellipsis> 22.postgres-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/23.nginx-download-docker/ class=md-nav__link> <span class=md-ellipsis> 23.nginx-download-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/24.helm%E9%83%A8%E7%BD%B2%E5%B8%B8%E7%94%A8%E6%9C%8D%E5%8A%A1/ class=md-nav__link> <span class=md-ellipsis> 24.helm部署常用服务 </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/25.Python%E6%93%8D%E4%BD%9CDocker/ class=md-nav__link> <span class=md-ellipsis> 25.Python操作Docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/26.docker-compose-devops/ class=md-nav__link> <span class=md-ellipsis> 26.docker-compose-devops </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/27.DevOps%E4%B8%8B%E7%9A%84Shell%E8%84%9A%E6%9C%AC/ class=md-nav__link> <span class=md-ellipsis> 27.DevOps下的Shell脚本 </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/28.Devops%E4%B8%8B%E7%9A%84Python%E8%84%9A%E6%9C%AC/ class=md-nav__link> <span class=md-ellipsis> 28.Devops下的Python脚本 </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/29.Vagrant%E8%99%9A%E6%8B%9F%E6%9C%BA/ class=md-nav__link> <span class=md-ellipsis> 29.Vagrant虚拟机 </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/30.VMware-workstation/ class=md-nav__link> <span class=md-ellipsis> 30.VMware Workstation </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/31.VirtualBox/ class=md-nav__link> <span class=md-ellipsis> 31.VirtualBox </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/32.Devops%E7%9B%B8%E5%85%B3%E5%AD%98%E5%82%A8%E5%BA%93/ class=md-nav__link> <span class=md-ellipsis> 32.Devops相关存储库 </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/33.terraform%E6%A6%82%E8%BF%B0/ class=md-nav__link> <span class=md-ellipsis> 33.terraform概述 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5 checked> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex> <span class=md-ellipsis> Golang </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=true> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Golang </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_1> <label class=md-nav__link for=__nav_5_1 id=__nav_5_1_label tabindex=0> <span class=md-ellipsis> 0.学习线路 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_1_label aria-expanded=false> <label class=md-nav__title for=__nav_5_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Go-Web%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98/ class=md-nav__link> <span class=md-ellipsis> Go Web开发实战 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_2> <label class=md-nav__link for=__nav_5_2 id=__nav_5_2_label tabindex=0> <span class=md-ellipsis> 1.Go基础 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_2_label aria-expanded=false> <label class=md-nav__title for=__nav_5_2> <span class="md-nav__icon md-icon"></span> 1.Go基础 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../1.Go%E5%9F%BA%E7%A1%80/1.%E5%AE%89%E8%A3%85Go/ class=md-nav__link> <span class=md-ellipsis> 安装Go </span> </a> </li> <li class=md-nav__item> <a href=../../1.Go%E5%9F%BA%E7%A1%80/2.%E7%AC%AC%E4%B8%80%E4%B8%AAGo%E7%A8%8B%E5%BA%8F/ class=md-nav__link> <span class=md-ellipsis> 第一个Go程序 </span> </a> </li> <li class=md-nav__item> <a href=../../1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/ class=md-nav__link> <span class=md-ellipsis> Go基础语法 </span> </a> </li> <li class=md-nav__item> <a href=../../1.Go%E5%9F%BA%E7%A1%80/4.Go-Module/ class=md-nav__link> <span class=md-ellipsis> Go Module </span> </a> </li> <li class=md-nav__item> <a href=../../1.Go%E5%9F%BA%E7%A1%80/5.Go-%E6%A0%87%E5%87%86%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84/ class=md-nav__link> <span class=md-ellipsis> Go 标准目录结构 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_3> <label class=md-nav__link for=__nav_5_3 id=__nav_5_3_label tabindex=0> <span class=md-ellipsis> 2.Go-Web基础 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_3_label aria-expanded=false> <label class=md-nav__title for=__nav_5_3> <span class="md-nav__icon md-icon"></span> 2.Go-Web基础 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../2.Go-Web%E5%9F%BA%E7%A1%80/5.%E7%AC%AC%E4%B8%80%E4%B8%AAGo-Web%E7%A8%8B%E5%BA%8F/ class=md-nav__link> <span class=md-ellipsis> 第一个Go Web程序 </span> </a> </li> <li class=md-nav__item> <a href=../../2.Go-Web%E5%9F%BA%E7%A1%80/6.Web%E7%A8%8B%E5%BA%8F%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86%E7%AE%80%E4%BB%8B/ class=md-nav__link> <span class=md-ellipsis> Web程序运行原理简介 </span> </a> </li> <li class=md-nav__item> <a href=../../2.Go-Web%E5%9F%BA%E7%A1%80/7.net-http%E5%8C%85/ class=md-nav__link> <span class=md-ellipsis> net/http包 </span> </a> </li> <li class=md-nav__item> <a href=../../2.Go-Web%E5%9F%BA%E7%A1%80/8.html-template%E5%8C%85/ class=md-nav__link> <span class=md-ellipsis> html/template包 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_4> <label class=md-nav__link for=__nav_5_4 id=__nav_5_4_label tabindex=0> <span class=md-ellipsis> 3.Go-Web请求处理 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_4_label aria-expanded=false> <label class=md-nav__title for=__nav_5_4> <span class="md-nav__icon md-icon"></span> 3.Go-Web请求处理 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../3.Go-Web%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/9.%E7%AE%80%E5%8D%95Web%E6%9C%8D%E5%8A%A1%E5%99%A8/ class=md-nav__link> <span class=md-ellipsis> 简单Web服务器 </span> </a> </li> <li class=md-nav__item> <a href=../../3.Go-Web%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/10.%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82/ class=md-nav__link> <span class=md-ellipsis> 处理请求 </span> </a> </li> <li class=md-nav__item> <a href=../../3.Go-Web%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/11.session%E5%92%8Ccookie/ class=md-nav__link> <span class=md-ellipsis> session和cookie </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_5> <label class=md-nav__link for=__nav_5_5 id=__nav_5_5_label tabindex=0> <span class=md-ellipsis> 4.Go访问数据库 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5_5> <span class="md-nav__icon md-icon"></span> 4.Go访问数据库 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/12.Go%E6%93%8D%E4%BD%9CMySQL/ class=md-nav__link> <span class=md-ellipsis> Go操作MySQL </span> </a> </li> <li class=md-nav__item> <a href=../../4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/13.Go%E6%93%8D%E4%BD%9CRedis/ class=md-nav__link> <span class=md-ellipsis> Go操作Redis </span> </a> </li> <li class=md-nav__item> <a href=../../4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/14.Go%E6%93%8D%E4%BD%9CMongoDB/ class=md-nav__link> <span class=md-ellipsis> Go操作MongoDB </span> </a> </li> <li class=md-nav__item> <a href=../../4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/15.Go%E7%9A%84%E5%B8%B8%E8%A7%81ORM%E5%BA%93/ class=md-nav__link> <span class=md-ellipsis> Go的常见ORM库 </span> </a> </li> <li class=md-nav__item> <a href=../../4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/16.Go%E6%93%8D%E4%BD%9CSQLite/ class=md-nav__link> <span class=md-ellipsis> Go操作SQLite </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_6> <label class=md-nav__link for=__nav_5_6 id=__nav_5_6_label tabindex=0> <span class=md-ellipsis> 5.Go高级网络编程 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_6_label aria-expanded=false> <label class=md-nav__title for=__nav_5_6> <span class="md-nav__icon md-icon"></span> 5.Go高级网络编程 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../5.Go%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/17.Go-Socket%E7%BC%96%E7%A8%8B/ class=md-nav__link> <span class=md-ellipsis> Go Socket编程 </span> </a> </li> <li class=md-nav__item> <a href=../../5.Go%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/18.Go-RPC%E7%BC%96%E7%A8%8B/ class=md-nav__link> <span class=md-ellipsis> Go RPC编程 </span> </a> </li> <li class=md-nav__item> <a href=../../5.Go%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/19.Go-%E5%BE%AE%E6%9C%8D%E5%8A%A1/ class=md-nav__link> <span class=md-ellipsis> Go 微服务 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_7> <label class=md-nav__link for=__nav_5_7 id=__nav_5_7_label tabindex=0> <span class=md-ellipsis> 6.Go文件处理 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_7_label aria-expanded=false> <label class=md-nav__title for=__nav_5_7> <span class="md-nav__icon md-icon"></span> 6.Go文件处理 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/20.%E5%A4%84%E7%90%86%E7%9B%AE%E5%BD%95%E4%B8%8E%E6%96%87%E4%BB%B6/ class=md-nav__link> <span class=md-ellipsis> 处理目录与文件 </span> </a> </li> <li class=md-nav__item> <a href=../../6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/21.%E5%A4%84%E7%90%86XML%E6%96%87%E4%BB%B6/ class=md-nav__link> <span class=md-ellipsis> 处理XML文件 </span> </a> </li> <li class=md-nav__item> <a href=../../6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/22.%E5%A4%84%E7%90%86JSON%E6%96%87%E4%BB%B6/ class=md-nav__link> <span class=md-ellipsis> 处理JSON文件 </span> </a> </li> <li class=md-nav__item> <a href=../../6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/23.%E5%A4%84%E7%90%86CSV%E6%96%87%E4%BB%B6/ class=md-nav__link> <span class=md-ellipsis> 处理CSV文件 </span> </a> </li> <li class=md-nav__item> <a href=../../6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/24.%E5%A4%84%E7%90%86Go%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95/ class=md-nav__link> <span class=md-ellipsis> 处理Go日志记录 </span> </a> </li> <li class=md-nav__item> <a href=../../6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/25.%E5%A4%84%E7%90%86%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 处理正则表达式 </span> </a> </li> <li class=md-nav__item> <a href=../../6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/26.%E5%A4%84%E7%90%86Excel%E6%96%87%E4%BB%B6/ class=md-nav__link> <span class=md-ellipsis> 处理Excel文件 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_8> <label class=md-nav__link for=__nav_5_8 id=__nav_5_8_label tabindex=0> <span class=md-ellipsis> 7.Go并发编程 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_8_label aria-expanded=false> <label class=md-nav__title for=__nav_5_8> <span class="md-nav__icon md-icon"></span> 7.Go并发编程 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/26.%E5%B9%B6%E5%8F%91-%E5%B9%B6%E8%A1%8C/ class=md-nav__link> <span class=md-ellipsis> 并发 并行 </span> </a> </li> <li class=md-nav__item> <a href=../../7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/27.%E8%BF%9B%E7%A8%8B-%E7%BA%BF%E7%A8%8B-%E5%8D%8F%E7%A8%8B/ class=md-nav__link> <span class=md-ellipsis> 进程 线程 协程 </span> </a> </li> <li class=md-nav__item> <a href=../../7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/28.Go%E5%B9%B6%E5%8F%91%E6%A8%A1%E5%9E%8B/ class=md-nav__link> <span class=md-ellipsis> Go并发模型 </span> </a> </li> <li class=md-nav__item> <a href=../../7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/29.goroutine%E5%92%8Cchannel/ class=md-nav__link> <span class=md-ellipsis> goroutine和channel </span> </a> </li> <li class=md-nav__item> <a href=../../7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/30.sync%E5%AE%9E%E7%8E%B0%E5%B9%B6%E5%8F%91/ class=md-nav__link> <span class=md-ellipsis> sync实现并发 </span> </a> </li> <li class=md-nav__item> <a href=../../7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/31.Go%E5%B9%B6%E5%8F%91%E7%9A%84Web%E5%BA%94%E7%94%A8/ class=md-nav__link> <span class=md-ellipsis> Go并发的Web应用 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_9> <label class=md-nav__link for=__nav_5_9 id=__nav_5_9_label tabindex=0> <span class=md-ellipsis> 8.Go标准库 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_9_label aria-expanded=false> <label class=md-nav__title for=__nav_5_9> <span class="md-nav__icon md-icon"></span> 8.Go标准库 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../8.Go%E6%A0%87%E5%87%86%E5%BA%93/32.time/ class=md-nav__link> <span class=md-ellipsis> time </span> </a> </li> <li class=md-nav__item> <a href=../../8.Go%E6%A0%87%E5%87%86%E5%BA%93/33.strings/ class=md-nav__link> <span class=md-ellipsis> strings </span> </a> </li> <li class=md-nav__item> <a href=../../8.Go%E6%A0%87%E5%87%86%E5%BA%93/34.bytes/ class=md-nav__link> <span class=md-ellipsis> bytes </span> </a> </li> <li class=md-nav__item> <a href=../../8.Go%E6%A0%87%E5%87%86%E5%BA%93/35.json/ class=md-nav__link> <span class=md-ellipsis> json </span> </a> </li> <li class=md-nav__item> <a href=../../8.Go%E6%A0%87%E5%87%86%E5%BA%93/36.io-bufio/ class=md-nav__link> <span class=md-ellipsis> io/bufio </span> </a> </li> <li class=md-nav__item> <a href=../../8.Go%E6%A0%87%E5%87%86%E5%BA%93/37.fmt/ class=md-nav__link> <span class=md-ellipsis> fmt </span> </a> </li> <li class=md-nav__item> <a href=../../8.Go%E6%A0%87%E5%87%86%E5%BA%93/38.strconv/ class=md-nav__link> <span class=md-ellipsis> strconv </span> </a> </li> <li class=md-nav__item> <a href=../../8.Go%E6%A0%87%E5%87%86%E5%BA%93/39.regexp/ class=md-nav__link> <span class=md-ellipsis> regexp </span> </a> </li> <li class=md-nav__item> <a href=../../8.Go%E6%A0%87%E5%87%86%E5%BA%93/40.log/ class=md-nav__link> <span class=md-ellipsis> log </span> </a> </li> <li class=md-nav__item> <a href=../../8.Go%E6%A0%87%E5%87%86%E5%BA%93/41.reflect-unsafe/ class=md-nav__link> <span class=md-ellipsis> reflect/unsafe </span> </a> </li> <li class=md-nav__item> <a href=../../8.Go%E6%A0%87%E5%87%86%E5%BA%93/42.os-path-filepath/ class=md-nav__link> <span class=md-ellipsis> os/path/filepath </span> </a> </li> <li class=md-nav__item> <a href=../../8.Go%E6%A0%87%E5%87%86%E5%BA%93/43.unicode/ class=md-nav__link> <span class=md-ellipsis> unicode </span> </a> </li> <li class=md-nav__item> <a href=../../8.Go%E6%A0%87%E5%87%86%E5%BA%93/44.flag/ class=md-nav__link> <span class=md-ellipsis> flag </span> </a> </li> <li class=md-nav__item> <a href=../../8.Go%E6%A0%87%E5%87%86%E5%BA%93/45.net-url/ class=md-nav__link> <span class=md-ellipsis> net/url </span> </a> </li> <li class=md-nav__item> <a href=../../8.Go%E6%A0%87%E5%87%86%E5%BA%93/46.net-http/ class=md-nav__link> <span class=md-ellipsis> net/http </span> </a> </li> <li class=md-nav__item> <a href=../../8.Go%E6%A0%87%E5%87%86%E5%BA%93/47.sort/ class=md-nav__link> <span class=md-ellipsis> sort </span> </a> </li> <li class=md-nav__item> <a href=../../8.Go%E6%A0%87%E5%87%86%E5%BA%93/48.errors/ class=md-nav__link> <span class=md-ellipsis> errors </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_10> <label class=md-nav__link for=__nav_5_10 id=__nav_5_10_label tabindex=0> <span class=md-ellipsis> 9.Go三方库 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_10_label aria-expanded=false> <label class=md-nav__title for=__nav_5_10> <span class="md-nav__icon md-icon"></span> 9.Go三方库 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../9.Go%E4%B8%89%E6%96%B9%E5%BA%93/0.%E5%BC%80%E6%BA%90%E8%87%AA%E5%B7%B1%E7%9A%84Go%E5%BA%93/ class=md-nav__link> <span class=md-ellipsis> 开源自己的Go库 </span> </a> </li> <li class=md-nav__item> <a href=../../9.Go%E4%B8%89%E6%96%B9%E5%BA%93/1.cobra/ class=md-nav__link> <span class=md-ellipsis> Cobra </span> </a> </li> <li class=md-nav__item> <a href=../../9.Go%E4%B8%89%E6%96%B9%E5%BA%93/2.viper/ class=md-nav__link> <span class=md-ellipsis> Viper </span> </a> </li> <li class=md-nav__item> <a href=../../9.Go%E4%B8%89%E6%96%B9%E5%BA%93/3.Zap/ class=md-nav__link> <span class=md-ellipsis> Zap </span> </a> </li> <li class=md-nav__item> <a href=../../9.Go%E4%B8%89%E6%96%B9%E5%BA%93/4.mahonia/ class=md-nav__link> <span class=md-ellipsis> mahonia </span> </a> </li> <li class=md-nav__item> <a href=../../9.Go%E4%B8%89%E6%96%B9%E5%BA%93/5.ssh/ class=md-nav__link> <span class=md-ellipsis> ssh </span> </a> </li> <li class=md-nav__item> <a href=../../9.Go%E4%B8%89%E6%96%B9%E5%BA%93/6.fsnotify/ class=md-nav__link> <span class=md-ellipsis> fsnotify </span> </a> </li> <li class=md-nav__item> <a href=../../9.Go%E4%B8%89%E6%96%B9%E5%BA%93/7.yaml/ class=md-nav__link> <span class=md-ellipsis> yaml </span> </a> </li> <li class=md-nav__item> <a href=../../9.Go%E4%B8%89%E6%96%B9%E5%BA%93/8.tail/ class=md-nav__link> <span class=md-ellipsis> tail </span> </a> </li> <li class=md-nav__item> <a href=../../9.Go%E4%B8%89%E6%96%B9%E5%BA%93/9.gRPC/ class=md-nav__link> <span class=md-ellipsis> gRPC </span> </a> </li> <li class=md-nav__item> <a href=../../9.Go%E4%B8%89%E6%96%B9%E5%BA%93/10.gopsutil/ class=md-nav__link> <span class=md-ellipsis> gopsutil </span> </a> </li> <li class=md-nav__item> <a href=../../9.Go%E4%B8%89%E6%96%B9%E5%BA%93/11.go-awesome/ class=md-nav__link> <span class=md-ellipsis> go-awesome </span> </a> </li> <li class=md-nav__item> <a href=../../9.Go%E4%B8%89%E6%96%B9%E5%BA%93/12.dmidecode/ class=md-nav__link> <span class=md-ellipsis> dmidecode </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_11> <label class=md-nav__link for=__nav_5_11 id=__nav_5_11_label tabindex=0> <span class=md-ellipsis> 10.Go-RESTful-API接口开发 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_11_label aria-expanded=false> <label class=md-nav__title for=__nav_5_11> <span class="md-nav__icon md-icon"></span> 10.Go-RESTful-API接口开发 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../10.Go-RESTful-API%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91/1.%E4%BB%80%E4%B9%88%E6%98%AFRESTful-API/ class=md-nav__link> <span class=md-ellipsis> 1.什么是RESTful-API </span> </a> </li> <li class=md-nav__item> <a href=../../10.Go-RESTful-API%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91/2.GORMv2/ class=md-nav__link> <span class=md-ellipsis> 2.GORMv2 </span> </a> </li> <li class=md-nav__item> <a href=../../10.Go-RESTful-API%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91/3.Gin%E6%A1%86%E6%9E%B6%E7%9A%84%E4%BD%BF%E7%94%A8/ class=md-nav__link> <span class=md-ellipsis> 3.Gin框架的使用 </span> </a> </li> <li class=md-nav__item> <a href=../../10.Go-RESTful-API%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91/4.%E5%9B%BE%E4%B9%A6%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-%E5%89%8D%E7%AB%AF/ class=md-nav__link> <span class=md-ellipsis> 4.图书管理系统-前端 </span> </a> </li> <li class=md-nav__item> <a href=../../10.Go-RESTful-API%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91/5.%E5%9B%BE%E4%B9%A6%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-%E5%90%8E%E7%AB%AF/ class=md-nav__link> <span class=md-ellipsis> 5.图书管理系统-后端 </span> </a> </li> <li class=md-nav__item> <a href=../../10.Go-RESTful-API%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91/6.Gin%2BVue%E5%85%A5%E9%97%A8%E9%A1%B9%E7%9B%AE/ class=md-nav__link> <span class=md-ellipsis> 6.Gin+Vue入门项目 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_12> <label class=md-nav__link for=__nav_5_12 id=__nav_5_12_label tabindex=0> <span class=md-ellipsis> 11.Web前端 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_12_label aria-expanded=false> <label class=md-nav__title for=__nav_5_12> <span class="md-nav__icon md-icon"></span> 11.Web前端 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../11.Web%E5%89%8D%E7%AB%AF/1.HTML%E6%A0%87%E8%AE%B0%E8%AF%AD%E8%A8%80/ class=md-nav__link> <span class=md-ellipsis> 1.HTML标记语言 </span> </a> </li> <li class=md-nav__item> <a href=../../11.Web%E5%89%8D%E7%AB%AF/2.CSS%E6%A0%B7%E5%BC%8F%E8%AF%AD%E8%A8%80/ class=md-nav__link> <span class=md-ellipsis> 2.CSS样式语言 </span> </a> </li> <li class=md-nav__item> <a href=../../11.Web%E5%89%8D%E7%AB%AF/3.JavaScript%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%84%9A%E6%9C%AC%E8%AF%AD%E8%A8%80/ class=md-nav__link> <span class=md-ellipsis> 3.JavaScript客户端脚本语言 </span> </a> </li> <li class=md-nav__item> <a href=../../11.Web%E5%89%8D%E7%AB%AF/4.JavaScript%E5%BA%93-JQuery/ class=md-nav__link> <span class=md-ellipsis> 4.JavaScript库:JQuery </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_13> <label class=md-nav__link for=__nav_5_13 id=__nav_5_13_label tabindex=0> <span class=md-ellipsis> 12.Vue前端开发 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_13_label aria-expanded=false> <label class=md-nav__title for=__nav_5_13> <span class="md-nav__icon md-icon"></span> 12.Vue前端开发 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/1.%E8%AE%A4%E8%AF%86Vue.js/ class=md-nav__link> <span class=md-ellipsis> 1.认识Vue.js.md </span> </a> </li> <li class=md-nav__item> <a href=../../12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/2.Vue%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4/ class=md-nav__link> <span class=md-ellipsis> 2.Vue常用指令 </span> </a> </li> <li class=md-nav__item> <a href=../../12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/3.Vue%E5%B8%B8%E7%94%A8%E5%B1%9E%E6%80%A7/ class=md-nav__link> <span class=md-ellipsis> 3.Vue常用属性 </span> </a> </li> <li class=md-nav__item> <a href=../../12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/4.Vue%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4%E4%B9%8B%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/ class=md-nav__link> <span class=md-ellipsis> 4.Vue常用指令之流程控制 </span> </a> </li> <li class=md-nav__item> <a href=../../12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/5.Vue%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4%E4%B9%8B%E6%95%B0%E6%8D%AE%E5%8F%8C%E5%90%91%E7%BB%91%E5%AE%9A/ class=md-nav__link> <span class=md-ellipsis> 5.Vue常用指令之数据双向绑定 </span> </a> </li> <li class=md-nav__item> <a href=../../12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/6.Vue%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E9%92%A9%E5%AD%90/ class=md-nav__link> <span class=md-ellipsis> 6.Vue生命周期钩子 </span> </a> </li> <li class=md-nav__item> <a href=../../12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/7.VueCli%E8%84%9A%E6%89%8B%E6%9E%B6/ class=md-nav__link> <span class=md-ellipsis> 7.VueCli脚手架 </span> </a> </li> <li class=md-nav__item> <a href=../../12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/8.Vue%E7%BB%84%E4%BB%B6/ class=md-nav__link> <span class=md-ellipsis> 8.Vue组件 </span> </a> </li> <li class=md-nav__item> <a href=../../12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/9.Vue%E8%B7%AF%E7%94%B1/ class=md-nav__link> <span class=md-ellipsis> 9.Vue路由 </span> </a> </li> <li class=md-nav__item> <a href=../../12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/10.Vuex%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 10.Vuex状态管理 </span> </a> </li> <li class=md-nav__item> <a href=../../12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/11.%E5%89%8D%E5%90%8E%E7%AB%AF%E6%95%B0%E6%8D%AE%E4%BA%A4%E4%BA%92-Axios/ class=md-nav__link> <span class=md-ellipsis> 11.前后端数据交互 Axios </span> </a> </li> <li class=md-nav__item> <a href=../../12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/12.Element-Plus/ class=md-nav__link> <span class=md-ellipsis> 12.Element Plus </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_14 checked> <label class=md-nav__link for=__nav_5_14 id=__nav_5_14_label tabindex=0> <span class=md-ellipsis> 13.K8s管理系统项目实战 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_14_label aria-expanded=true> <label class=md-nav__title for=__nav_5_14> <span class="md-nav__icon md-icon"></span> 13.K8s管理系统项目实战 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> K8s管理系统-后端API开发 </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> K8s管理系统-后端API开发 </span> </a> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#1-项目背景 class=md-nav__link> <span class=md-ellipsis> 1. 项目背景 </span> </a> </li> <li class=md-nav__item> <a href=#2-前后端分离概述 class=md-nav__link> <span class=md-ellipsis> 2. 前后端分离概述 </span> </a> </li> <li class=md-nav__item> <a href=#3-功能设计 class=md-nav__link> <span class=md-ellipsis> 3. 功能设计 </span> </a> </li> <li class=md-nav__item> <a href=#4-client-go介绍 class=md-nav__link> <span class=md-ellipsis> 4. Client-go介绍 </span> </a> <nav class=md-nav aria-label="4. Client-go介绍"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#41-简介 class=md-nav__link> <span class=md-ellipsis> 4.1 简介 </span> </a> </li> <li class=md-nav__item> <a href=#42-环境搭建 class=md-nav__link> <span class=md-ellipsis> 4.2 环境搭建 </span> </a> <nav class=md-nav aria-label="4.2 环境搭建"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#安装精简版k8sk3s环境 class=md-nav__link> <span class=md-ellipsis> 安装精简版K8S(K3S)环境 </span> </a> </li> <li class=md-nav__item> <a href=#安装golang环境 class=md-nav__link> <span class=md-ellipsis> 安装golang环境 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#43-代码示例 class=md-nav__link> <span class=md-ellipsis> 4.3 代码示例 </span> </a> <nav class=md-nav aria-label="4.3 代码示例"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#创建一个测试pod class=md-nav__link> <span class=md-ellipsis> 创建一个测试pod </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#44-常用方法 class=md-nav__link> <span class=md-ellipsis> 4.4 常用方法 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#5-项目目录结构 class=md-nav__link> <span class=md-ellipsis> 5. 项目目录结构 </span> </a> </li> <li class=md-nav__item> <a href=#6-框架搭建 class=md-nav__link> <span class=md-ellipsis> 6. 框架搭建 </span> </a> <nav class=md-nav aria-label="6. 框架搭建"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-创建go项目 class=md-nav__link> <span class=md-ellipsis> 1. 创建go项目 </span> </a> </li> <li class=md-nav__item> <a href=#2-初始化gin工程 class=md-nav__link> <span class=md-ellipsis> 2. 初始化Gin工程 </span> </a> </li> <li class=md-nav__item> <a href=#3-初始化k8s-client class=md-nav__link> <span class=md-ellipsis> 3. 初始化K8s Client </span> </a> </li> <li class=md-nav__item> <a href=#4-测试api接口 class=md-nav__link> <span class=md-ellipsis> 4. 测试API接口 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#7-api开发 class=md-nav__link> <span class=md-ellipsis> 7. API开发 </span> </a> <nav class=md-nav aria-label="7. API开发"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-开发响应流程 class=md-nav__link> <span class=md-ellipsis> 1. 开发&amp;响应流程 </span> </a> </li> <li class=md-nav__item> <a href=#2-工作负载 class=md-nav__link> <span class=md-ellipsis> 2. 工作负载 </span> </a> <nav class=md-nav aria-label="2. 工作负载"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#21-数组的排序过滤分页 class=md-nav__link> <span class=md-ellipsis> 2.1 数组的排序、过滤、分页 </span> </a> </li> <li class=md-nav__item> <a href=#22-pod class=md-nav__link> <span class=md-ellipsis> 2.2 Pod </span> </a> <nav class=md-nav aria-label="2.2 Pod"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#servicepodgo class=md-nav__link> <span class=md-ellipsis> service/pod.go </span> </a> </li> <li class=md-nav__item> <a href=#controllerpodgo class=md-nav__link> <span class=md-ellipsis> controller/pod.go </span> </a> </li> <li class=md-nav__item> <a href=#controllerroutergo class=md-nav__link> <span class=md-ellipsis> controller/router.go </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#23-deployment class=md-nav__link> <span class=md-ellipsis> 2.3 Deployment </span> </a> <nav class=md-nav aria-label="2.3 Deployment"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#servicedataselectorgo class=md-nav__link> <span class=md-ellipsis> service/dataselector.go </span> </a> </li> <li class=md-nav__item> <a href=#servicedeploymentgo class=md-nav__link> <span class=md-ellipsis> service/deployment.go </span> </a> </li> <li class=md-nav__item> <a href=#controllerdeploymentgo class=md-nav__link> <span class=md-ellipsis> controller/deployment.go </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#24-daemonset class=md-nav__link> <span class=md-ellipsis> 2.4 DaemonSet </span> </a> <nav class=md-nav aria-label="2.4 DaemonSet"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#servicedataselectorgo_1 class=md-nav__link> <span class=md-ellipsis> service/dataselector.go </span> </a> </li> <li class=md-nav__item> <a href=#servicedaemonsetgo class=md-nav__link> <span class=md-ellipsis> service/daemonset.go </span> </a> </li> <li class=md-nav__item> <a href=#controllerdaemonsetgo class=md-nav__link> <span class=md-ellipsis> controller/daemonset.go </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#25-statefulset class=md-nav__link> <span class=md-ellipsis> 2.5 StatefulSet </span> </a> <nav class=md-nav aria-label="2.5 StatefulSet"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#servicedataselectorgo_2 class=md-nav__link> <span class=md-ellipsis> service/dataselector.go </span> </a> </li> <li class=md-nav__item> <a href=#servicestatefulsetgo class=md-nav__link> <span class=md-ellipsis> service/statefulset.go </span> </a> </li> <li class=md-nav__item> <a href=#controllerstatefulsetgo class=md-nav__link> <span class=md-ellipsis> controller/statefulset.go </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#3-集群 class=md-nav__link> <span class=md-ellipsis> 3. 集群 </span> </a> <nav class=md-nav aria-label="3. 集群"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#31-node class=md-nav__link> <span class=md-ellipsis> 3.1 Node </span> </a> <nav class=md-nav aria-label="3.1 Node"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#servicedataselectorgo_3 class=md-nav__link> <span class=md-ellipsis> service/dataselector.go </span> </a> </li> <li class=md-nav__item> <a href=#servicenodego class=md-nav__link> <span class=md-ellipsis> service/node.go </span> </a> </li> <li class=md-nav__item> <a href=#controllernodego class=md-nav__link> <span class=md-ellipsis> controller/node.go </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#32-namespace class=md-nav__link> <span class=md-ellipsis> 3.2 Namespace </span> </a> <nav class=md-nav aria-label="3.2 Namespace"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#servicedataselectorgo_4 class=md-nav__link> <span class=md-ellipsis> service/dataselector.go </span> </a> </li> <li class=md-nav__item> <a href=#servicenamespacego class=md-nav__link> <span class=md-ellipsis> service/namespace.go </span> </a> </li> <li class=md-nav__item> <a href=#controllernamespacego class=md-nav__link> <span class=md-ellipsis> controller/namespace.go </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#33-persistentvolume class=md-nav__link> <span class=md-ellipsis> 3.3 PersistentVolume </span> </a> <nav class=md-nav aria-label="3.3 PersistentVolume"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#servicedataselectorgo_5 class=md-nav__link> <span class=md-ellipsis> service/dataselector.go </span> </a> </li> <li class=md-nav__item> <a href=#servicepvgo class=md-nav__link> <span class=md-ellipsis> service/pv.go </span> </a> </li> <li class=md-nav__item> <a href=#controllerpvgo class=md-nav__link> <span class=md-ellipsis> controller/pv.go </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#4-负载均衡 class=md-nav__link> <span class=md-ellipsis> 4. 负载均衡 </span> </a> <nav class=md-nav aria-label="4. 负载均衡"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#41-service class=md-nav__link> <span class=md-ellipsis> 4.1 Service </span> </a> <nav class=md-nav aria-label="4.1 Service"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#servicedataselectorgo_6 class=md-nav__link> <span class=md-ellipsis> service/dataselector.go </span> </a> </li> <li class=md-nav__item> <a href=#serviceservicego class=md-nav__link> <span class=md-ellipsis> service/service.go </span> </a> </li> <li class=md-nav__item> <a href=#controllerservicego class=md-nav__link> <span class=md-ellipsis> controller/service.go </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#42-ingress class=md-nav__link> <span class=md-ellipsis> 4.2 Ingress </span> </a> <nav class=md-nav aria-label="4.2 Ingress"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#servicedataselectorgo_7 class=md-nav__link> <span class=md-ellipsis> service/dataselector.go </span> </a> </li> <li class=md-nav__item> <a href=#serviceingressgo class=md-nav__link> <span class=md-ellipsis> service/ingress.go </span> </a> </li> <li class=md-nav__item> <a href=#controlleringressgo class=md-nav__link> <span class=md-ellipsis> controller/ingress.go </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#5-存储与配置 class=md-nav__link> <span class=md-ellipsis> 5. 存储与配置 </span> </a> <nav class=md-nav aria-label="5. 存储与配置"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#51-configmap class=md-nav__link> <span class=md-ellipsis> 5.1 ConfigMap </span> </a> <nav class=md-nav aria-label="5.1 ConfigMap"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#servicedataselectorgo_8 class=md-nav__link> <span class=md-ellipsis> service/dataselector.go </span> </a> </li> <li class=md-nav__item> <a href=#serviceconfigmapgo class=md-nav__link> <span class=md-ellipsis> service/configmap.go </span> </a> </li> <li class=md-nav__item> <a href=#controllerconfigmapgo class=md-nav__link> <span class=md-ellipsis> controller/configmap.go </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#52-secret class=md-nav__link> <span class=md-ellipsis> 5.2 Secret </span> </a> <nav class=md-nav aria-label="5.2 Secret"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#servicedataselectorgo_9 class=md-nav__link> <span class=md-ellipsis> service/dataselector.go </span> </a> </li> <li class=md-nav__item> <a href=#servicesecretgo class=md-nav__link> <span class=md-ellipsis> service/secret.go </span> </a> </li> <li class=md-nav__item> <a href=#contrllersecretgo class=md-nav__link> <span class=md-ellipsis> contrller/secret.go </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#53-persistentvolumeclaim class=md-nav__link> <span class=md-ellipsis> 5.3 PersistentVolumeClaim </span> </a> <nav class=md-nav aria-label="5.3 PersistentVolumeClaim"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#servicedataselectorgo_10 class=md-nav__link> <span class=md-ellipsis> service/dataselector.go </span> </a> </li> <li class=md-nav__item> <a href=#servicepvcgo class=md-nav__link> <span class=md-ellipsis> service/pvc.go </span> </a> </li> <li class=md-nav__item> <a href=#controllerpvcgo class=md-nav__link> <span class=md-ellipsis> controller/pvc.go </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#6-工作流 class=md-nav__link> <span class=md-ellipsis> 6. 工作流 </span> </a> <nav class=md-nav aria-label="6. 工作流"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#61-流程设计 class=md-nav__link> <span class=md-ellipsis> 6.1 流程设计 </span> </a> </li> <li class=md-nav__item> <a href=#62-数据库操作gorm class=md-nav__link> <span class=md-ellipsis> 6.2 数据库操作(GORM) </span> </a> <nav class=md-nav aria-label="6.2 数据库操作(GORM)"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1初始化数据库 class=md-nav__link> <span class=md-ellipsis> (1)初始化数据库 </span> </a> </li> <li class=md-nav__item> <a href=#2建立表的映射关系 class=md-nav__link> <span class=md-ellipsis> (2)建立表的映射关系 </span> </a> </li> <li class=md-nav__item> <a href=#3数据库创建表 class=md-nav__link> <span class=md-ellipsis> (3)数据库创建表 </span> </a> </li> <li class=md-nav__item> <a href=#4表数据列表 class=md-nav__link> <span class=md-ellipsis> (4)表数据列表 </span> </a> </li> <li class=md-nav__item> <a href=#5获取单条 class=md-nav__link> <span class=md-ellipsis> (5)获取单条 </span> </a> </li> <li class=md-nav__item> <a href=#6表数据新增 class=md-nav__link> <span class=md-ellipsis> (6)表数据新增 </span> </a> </li> <li class=md-nav__item> <a href=#7表数据删除 class=md-nav__link> <span class=md-ellipsis> (7)表数据删除 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#63-workflow class=md-nav__link> <span class=md-ellipsis> 6.3 Workflow </span> </a> <nav class=md-nav aria-label="6.3 Workflow"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1列表 class=md-nav__link> <span class=md-ellipsis> (1)列表 </span> </a> </li> <li class=md-nav__item> <a href=#2获取workflow详情 class=md-nav__link> <span class=md-ellipsis> (2)获取Workflow详情 </span> </a> </li> <li class=md-nav__item> <a href=#3新增workflow class=md-nav__link> <span class=md-ellipsis> (3)新增Workflow </span> </a> </li> <li class=md-nav__item> <a href=#4删除workflow class=md-nav__link> <span class=md-ellipsis> (4)删除workflow </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#7-中间件 class=md-nav__link> <span class=md-ellipsis> 7. 中间件 </span> </a> <nav class=md-nav aria-label="7. 中间件"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#71什么是中间件 class=md-nav__link> <span class=md-ellipsis> 7.1什么是中间件 </span> </a> </li> <li class=md-nav__item> <a href=#72-gin中间件用法 class=md-nav__link> <span class=md-ellipsis> 7.2 gin中间件用法 </span> </a> </li> <li class=md-nav__item> <a href=#73-cors跨域 class=md-nav__link> <span class=md-ellipsis> 7.3 Cors跨域 </span> </a> </li> <li class=md-nav__item> <a href=#74-jwt-token验证 class=md-nav__link> <span class=md-ellipsis> 7.4 JWT token验证 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../2.K8s%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/ class=md-nav__link> <span class=md-ellipsis> K8s管理系统-前端开发 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_15> <label class=md-nav__link for=__nav_5_15 id=__nav_5_15_label tabindex=0> <span class=md-ellipsis> 14.Go开发的三方平台 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_15_label aria-expanded=false> <label class=md-nav__title for=__nav_5_15> <span class="md-nav__icon md-icon"></span> 14.Go开发的三方平台 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../14.Go%E5%BC%80%E5%8F%91%E7%9A%84%E4%B8%89%E6%96%B9%E5%B9%B3%E5%8F%B0/0.%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%BF%E7%94%A8Go%E5%81%9A%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/ class=md-nav__link> <span class=md-ellipsis> 为什么使用Go做后端开发 </span> </a> </li> <li class=md-nav__item> <a href=../../14.Go%E5%BC%80%E5%8F%91%E7%9A%84%E4%B8%89%E6%96%B9%E5%B9%B3%E5%8F%B0/1.TBak-System%E5%A4%87%E4%BB%BD%E5%B9%B3%E5%8F%B0/ class=md-nav__link> <span class=md-ellipsis> TBak System备份平台 </span> </a> </li> <li class=md-nav__item> <a href=../../14.Go%E5%BC%80%E5%8F%91%E7%9A%84%E4%B8%89%E6%96%B9%E5%B9%B3%E5%8F%B0/2.kubernetes%E5%AE%B9%E5%99%A8%E4%BA%91%E7%AE%A1%E7%90%86%E5%B9%B3%E5%8F%B0/ class=md-nav__link> <span class=md-ellipsis> kubernetes容器云管理平台 </span> </a> </li> <li class=md-nav__item> <a href=../../14.Go%E5%BC%80%E5%8F%91%E7%9A%84%E4%B8%89%E6%96%B9%E5%B9%B3%E5%8F%B0/3.Go%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/ class=md-nav__link> <span class=md-ellipsis> Go命令行工具 </span> </a> </li> <li class=md-nav__item> <a href=../../14.Go%E5%BC%80%E5%8F%91%E7%9A%84%E4%B8%89%E6%96%B9%E5%B9%B3%E5%8F%B0/4.%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/ class=md-nav__link> <span class=md-ellipsis> nps </span> </a> </li> <li class=md-nav__item> <a href=../../14.Go%E5%BC%80%E5%8F%91%E7%9A%84%E4%B8%89%E6%96%B9%E5%B9%B3%E5%8F%B0/5.go-web%E9%A1%B9%E7%9B%AE/ class=md-nav__link> <span class=md-ellipsis> go-web项目 </span> </a> </li> <li class=md-nav__item> <a href=../../14.Go%E5%BC%80%E5%8F%91%E7%9A%84%E4%B8%89%E6%96%B9%E5%B9%B3%E5%8F%B0/6.go-%E4%B8%89%E6%96%B9%E5%B7%A5%E5%85%B7%E7%AE%80%E5%8D%95%E5%85%A5%E9%97%A8/ class=md-nav__link> <span class=md-ellipsis> go-三方工具简单入门 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_16> <label class=md-nav__link for=__nav_5_16 id=__nav_5_16_label tabindex=0> <span class=md-ellipsis> 15.容器化Go </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_16_label aria-expanded=false> <label class=md-nav__title for=__nav_5_16> <span class="md-nav__icon md-icon"></span> 15.容器化Go </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../15.%E5%AE%B9%E5%99%A8%E5%8C%96Go/0.%E6%9E%84%E5%BB%BAGo%E5%BA%94%E7%94%A8docker%E9%95%9C%E5%83%8F/ class=md-nav__link> <span class=md-ellipsis> 构建Go应用docker镜像 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> <span class=md-ellipsis> Python </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Python </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_1> <label class=md-nav__link for=__nav_6_1 id=__nav_6_1_label tabindex=0> <span class=md-ellipsis> 0.学习线路 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_1_label aria-expanded=false> <label class=md-nav__title for=__nav_6_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Pythjon-auto-ops/ class=md-nav__link> <span class=md-ellipsis> Python Linux管理与自动化运维 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_2> <label class=md-nav__link for=__nav_6_2 id=__nav_6_2_label tabindex=0> <span class=md-ellipsis> 1.Python基础篇 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_2_label aria-expanded=false> <label class=md-nav__title for=__nav_6_2> <span class="md-nav__icon md-icon"></span> 1.Python基础篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/1.Python%E7%94%9F%E6%80%81%E5%B7%A5%E5%85%B7/ class=md-nav__link> <span class=md-ellipsis> 1.Python生态工具 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/2.Python%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E5%AE%89%E8%A3%85/ class=md-nav__link> <span class=md-ellipsis> 2.Python第三方库安装 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/3.Python%E5%B7%A5%E4%BD%9C%E7%8E%AF%E5%A2%83%E7%AE%A1%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 3.Python工作环境管理 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/4.Python%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/ class=md-nav__link> <span class=md-ellipsis> 4.Python开发环境 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/5.Python%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/ class=md-nav__link> <span class=md-ellipsis> 5.Python数据结构 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/6.Python%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84/ class=md-nav__link> <span class=md-ellipsis> 6.Python项目的组织结构 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/7.Python%E4%BB%A3%E7%A0%81%E8%A7%84%E8%8C%83/ class=md-nav__link> <span class=md-ellipsis> 7.Python代码规范 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/8.Python%E5%86%85%E7%BD%AE%E5%87%BD%E6%95%B0/ class=md-nav__link> <span class=md-ellipsis> 8.Python内置函数 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_3> <label class=md-nav__link for=__nav_6_3 id=__nav_6_3_label tabindex=0> <span class=md-ellipsis> 2.Python运维开发 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_3_label aria-expanded=false> <label class=md-nav__title for=__nav_6_3> <span class="md-nav__icon md-icon"></span> 2.Python运维开发 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/1.%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/ class=md-nav__link> <span class=md-ellipsis> 1.命令行工具 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/2.%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 2.文本处理 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/3.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 3.Linux系统管理 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/4.%E7%9B%91%E6%8E%A7Linux/ class=md-nav__link> <span class=md-ellipsis> 4.监控Linux </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/5.%E6%96%87%E6%A1%A3%E4%B8%8E%E6%8A%A5%E5%91%8A/ class=md-nav__link> <span class=md-ellipsis> 5.文档与报告 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/6.%E7%BD%91%E7%BB%9C/ class=md-nav__link> <span class=md-ellipsis> 6.网络 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/7.%E8%87%AA%E5%8A%A8%E5%8C%96%E7%AE%A1%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 7.自动化管理 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/8.%E5%B8%B8%E7%94%A8%E6%A8%A1%E5%9D%97/ class=md-nav__link> <span class=md-ellipsis> 8.常用模块 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/9.Python%E6%89%93%E9%80%A0MySQL%E4%B8%93%E5%AE%B6%E7%B3%BB%E7%BB%9F/ class=md-nav__link> <span class=md-ellipsis> 9.Python打造MySQL专家系统 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/10.%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%BC%80%E5%8F%91/ class=md-nav__link> <span class=md-ellipsis> 10.自动化运维系统的开发 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/11.%E5%8D%8E%E4%B8%BA%E4%BA%91Python%E6%BC%94%E7%A4%BA%E4%BB%A3%E7%A0%81/ class=md-nav__link> <span class=md-ellipsis> 11.华为云Python演示代码 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/12.%E5%8D%8E%E4%B8%BA%E4%BA%91Go%E6%BC%94%E7%A4%BA%E4%BB%A3%E7%A0%81/ class=md-nav__link> <span class=md-ellipsis> 12.华为云Go演示代码 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/%E9%99%84-%E8%BF%90%E7%BB%B4%E7%9B%B8%E5%85%B3%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE/ class=md-nav__link> <span class=md-ellipsis> 附-运维相关开源项目 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/%E9%99%84-awesome-python-cn/ class=md-nav__link> <span class=md-ellipsis> 附-awesome-python-cn </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/%E9%99%84-CMDB/ class=md-nav__link> <span class=md-ellipsis> 附-CMDB </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/%E9%99%84-Django-web%E5%BC%80%E5%8F%91/ class=md-nav__link> <span class=md-ellipsis> 附-Django-web开发 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_4> <label class=md-nav__link for=__nav_6_4 id=__nav_6_4_label tabindex=0> <span class=md-ellipsis> 3.Python测试开发 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_4_label aria-expanded=false> <label class=md-nav__title for=__nav_6_4> <span class="md-nav__icon md-icon"></span> 3.Python测试开发 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/1.Python2%E4%B8%8EPython3%E5%8C%BA%E5%88%AB/ class=md-nav__link> <span class=md-ellipsis> 1.Python2与Python3区别 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/2.Windows%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85Python/ class=md-nav__link> <span class=md-ellipsis> 2.Windows环境安装Python </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/3.Linux%E5%A4%9A%E7%89%88%E6%9C%ACPython%E5%AE%89%E8%A3%85/ class=md-nav__link> <span class=md-ellipsis> 3.Linux多版本Python安装 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/4.Python%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85/ class=md-nav__link> <span class=md-ellipsis> 4.Python虚拟环境安装 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/5.Pycharm%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8/ class=md-nav__link> <span class=md-ellipsis> 5.Pycharm安装与使用 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/6.Python%E9%97%B4%E6%8E%A5%E5%AE%9A%E4%B9%89%E5%B8%B8%E9%87%8F/ class=md-nav__link> <span class=md-ellipsis> 6.Python间接定义常量 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/7.Python%E8%BF%90%E7%AE%97%E7%AC%A6%E4%B8%8E%E8%A1%A8%E8%BE%BE%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 7.Python运算符与表达式 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/8.%E9%80%BB%E8%BE%91%E6%8E%A7%E5%88%B6%E8%AF%AD%E5%8F%A5/ class=md-nav__link> <span class=md-ellipsis> 8.逻辑控制语句 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/9.%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%BB%8B%E7%BB%8D/ class=md-nav__link> <span class=md-ellipsis> 9.数据结构 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/10.%E5%87%BD%E6%95%B0%E4%BB%8B%E7%BB%8D/ class=md-nav__link> <span class=md-ellipsis> 10.函数介绍 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/11.%E7%B1%BB%E4%B8%8E%E5%AF%B9%E8%B1%A1/ class=md-nav__link> <span class=md-ellipsis> 11.类与对象 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/12.%E6%89%93%E5%8C%85%E4%B8%8E%E5%8F%91%E5%B8%83/ class=md-nav__link> <span class=md-ellipsis> 12.打包与发布 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/13.%E5%BC%82%E5%B8%B8%E6%8D%95%E8%8E%B7%E4%B8%8E%E5%A4%84%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 13.异常捕获与处理 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/14.%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/ class=md-nav__link> <span class=md-ellipsis> 14.并发编程 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/15.%E6%A0%87%E5%87%86%E5%BA%93%E5%92%8C%E4%B8%89%E6%96%B9%E5%BA%93/ class=md-nav__link> <span class=md-ellipsis> 15.标准库和三方库 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/16.vue-cli%E8%84%9A%E6%89%8B%E6%9E%B6/ class=md-nav__link> <span class=md-ellipsis> 16.vue-cli脚手架 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/17.%E6%A1%88%E4%BE%8B%E5%AE%9E%E8%B7%B5-%E4%BB%BB%E5%8A%A1%E5%88%97%E8%A1%A8/ class=md-nav__link> <span class=md-ellipsis> 17.案例实践-任务列表 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_5> <label class=md-nav__link for=__nav_6_5 id=__nav_6_5_label tabindex=0> <span class=md-ellipsis> 4.Flask-Web全栈开发 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_5_label aria-expanded=false> <label class=md-nav__title for=__nav_6_5> <span class="md-nav__icon md-icon"></span> 4.Flask-Web全栈开发 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/1.Flask%E5%89%8D%E5%A5%8F/ class=md-nav__link> <span class=md-ellipsis> 1.Flask前缀 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/2.%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AE/ class=md-nav__link> <span class=md-ellipsis> 2.项目配置 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/3.URL%E4%B8%8E%E8%A7%86%E5%9B%BE/ class=md-nav__link> <span class=md-ellipsis> 3.URL与视图 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/4.Jinja2%E6%A8%A1%E6%9D%BF/ class=md-nav__link> <span class=md-ellipsis> 4.Jinja2模板 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/5.%E6%95%B0%E6%8D%AE%E5%BA%93/ class=md-nav__link> <span class=md-ellipsis> 5.数据库 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/6.%E8%A1%A8%E5%8D%95/ class=md-nav__link> <span class=md-ellipsis> 6.表单 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/7.Flask%E8%BF%9B%E9%98%B6/ class=md-nav__link> <span class=md-ellipsis> 7.Flask进阶 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/8.%E7%BC%93%E5%AD%98%E7%B3%BB%E7%BB%9F/ class=md-nav__link> <span class=md-ellipsis> 8.缓存系统 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/9.Flask%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/ class=md-nav__link> <span class=md-ellipsis> 9.Flask项目实战 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/10.WebSock%E5%AE%9E%E6%88%98/ class=md-nav__link> <span class=md-ellipsis> 10.WebSock实战 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/11.Flask%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B/ class=md-nav__link> <span class=md-ellipsis> 11.Flask异步编程 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/%E9%99%84-%E4%BD%BF%E7%94%A8Pytest%E6%B5%8B%E8%AF%95Flask/ class=md-nav__link> <span class=md-ellipsis> 附-使用Pytest测试Flask </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/%E9%99%84-Flask%E5%B8%B8%E7%94%A8%E6%89%A9%E5%B1%95/ class=md-nav__link> <span class=md-ellipsis> 附-Flask常用扩展 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/%E9%99%84-Flask%E5%92%8CRedis%E9%98%9F%E5%88%97%E7%9A%84%E5%BC%82%E6%AD%A5%E4%BB%BB%E5%8A%A1/ class=md-nav__link> <span class=md-ellipsis> 附-Flask和Redis队列的异步任务 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/%E9%99%84-Flask%E5%92%8CVue.js%E5%BC%80%E5%8F%91%E5%8D%95%E9%A1%B5%E5%BA%94%E7%94%A8/ class=md-nav__link> <span class=md-ellipsis> 附-Flask和Vue.js开发单页应用 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/%E9%99%84-Flask%E5%AE%B9%E5%99%A8%E5%8C%96%E5%AE%9E%E8%B7%B5/ class=md-nav__link> <span class=md-ellipsis> 附-Flask容器化实践 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/%E9%99%84-Flask%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B/ class=md-nav__link> <span class=md-ellipsis> 附-Flask数据模型 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_6> <label class=md-nav__link for=__nav_6_6 id=__nav_6_6_label tabindex=0> <span class=md-ellipsis> 5.Web开发与自动化测试 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6_6> <span class="md-nav__icon md-icon"></span> 5.Web开发与自动化测试 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python/5.Web%E5%BC%80%E5%8F%91%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95/1.%E6%89%A9%E5%B1%95%E5%BA%93%E7%9A%84%E5%AE%89%E8%A3%85/ class=md-nav__link> <span class=md-ellipsis> 1.扩展库的安装 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_7> <label class=md-nav__link for=__nav_6_7 id=__nav_6_7_label tabindex=0> <span class=md-ellipsis> 6.CMDB项目实战 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_7_label aria-expanded=false> <label class=md-nav__title for=__nav_6_7> <span class="md-nav__icon md-icon"></span> 6.CMDB项目实战 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python/6.CMDB%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/0.DRF%E5%89%8D%E5%A5%8F/ class=md-nav__link> <span class=md-ellipsis> 0.DRF前奏 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/6.CMDB%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/1.DRF%E5%85%A5%E9%97%A8/ class=md-nav__link> <span class=md-ellipsis> 1.DRF入门 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/6.CMDB%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/2.DRF%E8%BF%9B%E9%98%B6/ class=md-nav__link> <span class=md-ellipsis> 2.DRF进阶 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/6.CMDB%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/3.CMDB%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/ class=md-nav__link> <span class=md-ellipsis> 3.CMDB后端开发 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/6.CMDB%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/4.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91-%E4%B8%8A/ class=md-nav__link> <span class=md-ellipsis> 4.Vue前端开发-上 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/6.CMDB%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/5.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91-%E4%B8%8B/ class=md-nav__link> <span class=md-ellipsis> 5.Vue前端开发-下 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/6.CMDB%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/6.Element-Plus%E5%89%8D%E7%AB%AF%E7%BB%84%E4%BB%B6%E5%BA%93/ class=md-nav__link> <span class=md-ellipsis> 6.Element-Plus前端组件库 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/6.CMDB%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/7.CMDB%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91-%E4%B8%8A/ class=md-nav__link> <span class=md-ellipsis> 7.CMDB前端开发-上 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/6.CMDB%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/8.CMDB%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91-%E4%B8%8B/ class=md-nav__link> <span class=md-ellipsis> 8.CMDB前端开发-下 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex=0> <span class=md-ellipsis> Python-vs-Go </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Python-vs-Go </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_1> <label class=md-nav__link for=__nav_7_1 id=__nav_7_1_label tabindex=0> <span class=md-ellipsis> 0.线路 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_1_label aria-expanded=false> <label class=md-nav__title for=__nav_7_1> <span class="md-nav__icon md-icon"></span> 0.线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python-vs-Go/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Python-vs-Go/ class=md-nav__link> <span class=md-ellipsis> Python-vs-Go </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_2> <label class=md-nav__link for=__nav_7_2 id=__nav_7_2_label tabindex=0> <span class=md-ellipsis> 1.对比 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_2_label aria-expanded=false> <label class=md-nav__title for=__nav_7_2> <span class="md-nav__icon md-icon"></span> 1.对比 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/1.Hello-World/ class=md-nav__link> <span class=md-ellipsis> Hello-World </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/2.Print/ class=md-nav__link> <span class=md-ellipsis> Print </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/3.%E6%B3%A8%E9%87%8A/ class=md-nav__link> <span class=md-ellipsis> 注释 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/4.%E5%A4%9A%E8%A1%8C%E5%AD%97%E7%AC%A6%E4%B8%B2/ class=md-nav__link> <span class=md-ellipsis> 多行字符串 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/5.Lists/ class=md-nav__link> <span class=md-ellipsis> Lists </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/6.Map/ class=md-nav__link> <span class=md-ellipsis> Map </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/7.Booleans/ class=md-nav__link> <span class=md-ellipsis> Booleans </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/8.Forloop/ class=md-nav__link> <span class=md-ellipsis> Forloop </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/9.Range/ class=md-nav__link> <span class=md-ellipsis> Range </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/10.Switch/ class=md-nav__link> <span class=md-ellipsis> Switch </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/11.%E5%8F%AF%E5%8F%98%E5%8F%82%E6%95%B0%E5%87%BD%E6%95%B0/ class=md-nav__link> <span class=md-ellipsis> 可变参数函数 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/12.%E6%97%B6%E9%97%B4%E8%AE%A1%E7%AE%97/ class=md-nav__link> <span class=md-ellipsis> 时间计算 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/13.%E5%87%BD%E6%95%B0%E7%9A%84%E9%97%AD%E5%8C%85/ class=md-nav__link> <span class=md-ellipsis> 函数的闭包 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/14.%E9%80%80%E5%87%BA%E5%A4%84%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 退出处理 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/15.%E5%BC%82%E5%B8%B8%E6%8D%95%E8%8E%B7/ class=md-nav__link> <span class=md-ellipsis> 异常捕获 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/16.%E5%8F%AF%E5%8F%98%E9%A1%B9/ class=md-nav__link> <span class=md-ellipsis> 可变项 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/17.%E7%B1%BB/ class=md-nav__link> <span class=md-ellipsis> 类 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/18.%E6%96%B9%E6%B3%95/ class=md-nav__link> <span class=md-ellipsis> 方法 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/19.%E5%B9%B6%E5%8F%91/ class=md-nav__link> <span class=md-ellipsis> 并发 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/20.Args/ class=md-nav__link> <span class=md-ellipsis> Args </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/21.%E5%AF%BC%E5%85%A5%E6%A8%A1%E5%9D%97%E5%88%AB%E5%90%8D/ class=md-nav__link> <span class=md-ellipsis> 导入模块别名 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/22.%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%A0%BC%E5%BC%8F%E5%8C%96/ class=md-nav__link> <span class=md-ellipsis> 字符串格式化 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/23.%E5%8E%BB%E9%87%8D/ class=md-nav__link> <span class=md-ellipsis> 去重 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/24.%E5%B8%A6%E9%A2%9C%E8%89%B2%E6%89%93%E5%8D%B0/ class=md-nav__link> <span class=md-ellipsis> 带颜色打印 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/25.python-example/ class=md-nav__link> <span class=md-ellipsis> Python By Example </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/26.go-example/ class=md-nav__link> <span class=md-ellipsis> Go By Example </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_3> <label class=md-nav__link for=__nav_7_3 id=__nav_7_3_label tabindex=0> <span class=md-ellipsis> 2.进阶 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_3_label aria-expanded=false> <label class=md-nav__title for=__nav_7_3> <span class="md-nav__icon md-icon"></span> 2.进阶 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python-vs-Go/2.%E8%BF%9B%E9%98%B6/1.%E4%BD%BF%E7%94%A8RPC/ class=md-nav__link> <span class=md-ellipsis> 使用RPC </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/2.%E8%BF%9B%E9%98%B6/2.%E4%BD%BF%E7%94%A8MySQL/ class=md-nav__link> <span class=md-ellipsis> 使用MySQL </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/2.%E8%BF%9B%E9%98%B6/3.%E4%BD%BF%E7%94%A8Redis/ class=md-nav__link> <span class=md-ellipsis> 使用Redis </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/2.%E8%BF%9B%E9%98%B6/4.%E4%BD%BF%E7%94%A8MongoDB/ class=md-nav__link> <span class=md-ellipsis> 使用MongoDB </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/2.%E8%BF%9B%E9%98%B6/5.%E7%BB%83%E6%89%8B%E9%A1%B9%E7%9B%AE%E6%8E%A8%E8%8D%90/ class=md-nav__link> <span class=md-ellipsis> 练手项目推荐 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8> <label class=md-nav__link for=__nav_8 id=__nav_8_label tabindex=0> <span class=md-ellipsis> Linux </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_8_label aria-expanded=false> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> Linux </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8_1> <label class=md-nav__link for=__nav_8_1 id=__nav_8_1_label tabindex=0> <span class=md-ellipsis> Shell </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_8_1_label aria-expanded=false> <label class=md-nav__title for=__nav_8_1> <span class="md-nav__icon md-icon"></span> Shell </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Linux/Shell/Shell%E7%AE%80%E4%BB%8B/ class=md-nav__link> <span class=md-ellipsis> Shell 教程概述 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/1.%E7%AC%AC%E4%B8%80%E4%B8%AAshell%E7%A8%8B%E5%BA%8F/ class=md-nav__link> <span class=md-ellipsis> 1.第一个 Shell 程序 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/2.Shell%E5%8F%98%E9%87%8F%E5%92%8C%E5%AD%97%E7%AC%A6%E4%B8%B2/ class=md-nav__link> <span class=md-ellipsis> 2.Shell变量和字符串 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/3.Shell%E5%8F%82%E6%95%B0/ class=md-nav__link> <span class=md-ellipsis> 3.Shell参数 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/4.Shell%E6%95%B0%E7%BB%84/ class=md-nav__link> <span class=md-ellipsis> 4.Shell数组 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/5.Shell%E8%BF%90%E7%AE%97%E7%AC%A6/ class=md-nav__link> <span class=md-ellipsis> 5.Shell运算符 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/6.Shell-echo_printf%E5%91%BD%E4%BB%A4/ class=md-nav__link> <span class=md-ellipsis> 6.Shell echo/printf 命令 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/7.Shell-test%E5%91%BD%E4%BB%A4/ class=md-nav__link> <span class=md-ellipsis> 7.Shell test命令 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/8.Shell%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/ class=md-nav__link> <span class=md-ellipsis> 8.Shell流程控制 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/9.Shell%E5%87%BD%E6%95%B0/ class=md-nav__link> <span class=md-ellipsis> 9.Shell函数 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/10.Shell%E8%BE%93%E5%85%A5_%E8%BE%93%E5%87%BA%E9%87%8D%E5%AE%9A%E5%90%91/ class=md-nav__link> <span class=md-ellipsis> 10.Shell输入/输出重定向 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/11.Shell%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 11.Shell正则表达式 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/12.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bgrep/ class=md-nav__link> <span class=md-ellipsis> 12.Shell三剑客之grep </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/13.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/ class=md-nav__link> <span class=md-ellipsis> 13.Shell三剑客之sed </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/14.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bawk/ class=md-nav__link> <span class=md-ellipsis> 14.Shell三剑客之awk </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/15.Shell%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/ class=md-nav__link> <span class=md-ellipsis> 15.Shell常用工具 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/16.Shell%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/ class=md-nav__link> <span class=md-ellipsis> 16.Shell实战项目 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/17.Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/ class=md-nav__link> <span class=md-ellipsis> 17.Shell脚本示例 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/18.Shell%E8%84%9A%E6%9C%AC%E7%9A%84%E5%8F%82%E6%95%B0%E8%A7%A3%E6%9E%90%E5%B7%A5%E5%85%B7/ class=md-nav__link> <span class=md-ellipsis> 18.Shell脚本的参数解析工具 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/19.%E5%AE%9E%E7%94%A8Shell%E8%84%9A%E6%9C%AC%E6%A1%88%E4%BE%8B/ class=md-nav__link> <span class=md-ellipsis> 19.实用Shell脚本案例 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/20.Shell%E8%84%9A%E6%9C%AC%E7%9A%84%E8%A7%84%E8%8C%83/ class=md-nav__link> <span class=md-ellipsis> 20.Shell脚本的规范 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/21.Shell%E5%A4%9A%E8%BF%9B%E7%A8%8B%E5%B9%B6%E5%8F%91/ class=md-nav__link> <span class=md-ellipsis> 21.Shell多进程并发 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/%E9%99%84-shell%E5%85%B6%E5%AE%83%E8%B5%84%E6%BA%90/ class=md-nav__link> <span class=md-ellipsis> 附-shell其它资源 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/%E9%99%84-vim%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/ class=md-nav__link> <span class=md-ellipsis> 附-vim常用操作 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8_2> <label class=md-nav__link for=__nav_8_2 id=__nav_8_2_label tabindex=0> <span class=md-ellipsis> Ansible </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_8_2_label aria-expanded=false> <label class=md-nav__title for=__nav_8_2> <span class="md-nav__icon md-icon"></span> Ansible </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/ class=md-nav__link> <span class=md-ellipsis> 1.Ansible入门和实践 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Ansible/2.Ansible-wiki/ class=md-nav__link> <span class=md-ellipsis> 2.Ansible-wiki </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8_3> <label class=md-nav__link for=__nav_8_3 id=__nav_8_3_label tabindex=0> <span class=md-ellipsis> Git </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_8_3_label aria-expanded=false> <label class=md-nav__title for=__nav_8_3> <span class="md-nav__icon md-icon"></span> Git </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Linux/Git/1.Git%E5%9F%BA%E7%A1%80/ class=md-nav__link> <span class=md-ellipsis> 1.Git基础 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Git/2.%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93/ class=md-nav__link> <span class=md-ellipsis> 2.远程仓库 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Git/3.%E5%88%86%E6%94%AF%E7%AE%A1%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 3.分支管理 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Git/4.%E5%88%86%E6%94%AF%E7%AE%A1%E7%90%86%E7%AD%96%E7%95%A5/ class=md-nav__link> <span class=md-ellipsis> 4.分支管理策略 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Git/7.%E4%BD%BF%E7%94%A8Github/ class=md-nav__link> <span class=md-ellipsis> 7.使用Github </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Git/8.%E5%AE%9E%E8%B7%B5GitHub-Flow/ class=md-nav__link> <span class=md-ellipsis> 8.实践GitHub Flow </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Git/9.%E5%AE%9E%E8%B7%B5Git-Flow/ class=md-nav__link> <span class=md-ellipsis> 9.实践Git Flow </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Git/10.%E9%A1%B9%E7%9B%AE%E8%A7%84%E8%8C%83/ class=md-nav__link> <span class=md-ellipsis> 10.项目规范 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8_4> <label class=md-nav__link for=__nav_8_4 id=__nav_8_4_label tabindex=0> <span class=md-ellipsis> KVM </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_8_4_label aria-expanded=false> <label class=md-nav__title for=__nav_8_4> <span class="md-nav__icon md-icon"></span> KVM </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Linux/KVM/1.kvm%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4/ class=md-nav__link> <span class=md-ellipsis> 1.kvm相关命令 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/KVM/2.kvm%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%88%9B%E5%BB%BA/ class=md-nav__link> <span class=md-ellipsis> 2.kvm虚拟机创建 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/KVM/3.kvm%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE/ class=md-nav__link> <span class=md-ellipsis> 3.kvm网络配置 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8_5> <label class=md-nav__link for=__nav_8_5 id=__nav_8_5_label tabindex=0> <span class=md-ellipsis> Nginx </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_8_5_label aria-expanded=false> <label class=md-nav__title for=__nav_8_5> <span class="md-nav__icon md-icon"></span> Nginx </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Linux/Nginx/1.Nginx%E7%AE%80%E4%BB%8B/ class=md-nav__link> <span class=md-ellipsis> 1.Nginx简介 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/2.Nginx%E5%AE%89%E8%A3%85%E5%8F%8A%E5%90%AF%E5%8A%A8/ class=md-nav__link> <span class=md-ellipsis> 2.Nginx安装及启动 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/3.Nginx%E9%85%8D%E7%BD%AE/ class=md-nav__link> <span class=md-ellipsis> 3.Nginx配置 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/4.Nginx%E9%85%8D%E7%BD%AE%E4%B8%8B%E8%BD%BD%E7%AB%99%E7%82%B9/ class=md-nav__link> <span class=md-ellipsis> 4.Nginx配置下载站点 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/5.Nginx%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6/ class=md-nav__link> <span class=md-ellipsis> 5.Nginx访问控制 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/6.Nginx%E8%99%9A%E6%8B%9F%E4%B8%BB%E6%9C%BA/ class=md-nav__link> <span class=md-ellipsis> 6.Nginx虚拟主机 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/7.Nginx%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90/ class=md-nav__link> <span class=md-ellipsis> 7.Nginx静态资源 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/8.Nginx%E7%BC%93%E5%AD%98%E9%85%8D%E7%BD%AE/ class=md-nav__link> <span class=md-ellipsis> 8.Nginx缓存配置 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/9.Nginx%E6%AD%A3%E5%8F%8D%E4%BB%A3%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 9.Nginx正反向代理 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/10.Nginx%E9%98%B2%E7%9B%97%E9%93%BE/ class=md-nav__link> <span class=md-ellipsis> 10.Nginx防盗链 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/11.Nginx%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/ class=md-nav__link> <span class=md-ellipsis> 11.Nginx负载均衡 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/12.Nginx%E5%8A%A8%E9%9D%99%E5%88%86%E7%A6%BB/ class=md-nav__link> <span class=md-ellipsis> 12.Nginx动静分离 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/13.Nginx%E8%B7%A8%E5%9F%9F%E9%85%8D%E7%BD%AE/ class=md-nav__link> <span class=md-ellipsis> 13.Nginx跨域配置 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/14.Nginx%E9%87%8D%E5%AE%9A%E5%90%91/ class=md-nav__link> <span class=md-ellipsis> 14.Nginx重定向 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/15.Nginx-HTTPS/ class=md-nav__link> <span class=md-ellipsis> 15.Nginx HTTPS </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/16.%E9%99%84-Nginx-location%E8%AF%AD%E6%B3%95/ class=md-nav__link> <span class=md-ellipsis> 16.附-Nginx-location语法 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/17.%E9%99%84-Nginx%E4%BB%A3%E7%90%86%E7%9B%B8%E5%85%B3%E6%A8%A1%E5%9D%97%E8%A7%A3%E6%9E%90/ class=md-nav__link> <span class=md-ellipsis> 17.附-Nginx代理相关模块解析 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8_6> <label class=md-nav__link for=__nav_8_6 id=__nav_8_6_label tabindex=0> <span class=md-ellipsis> System </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_8_6_label aria-expanded=false> <label class=md-nav__title for=__nav_8_6> <span class="md-nav__icon md-icon"></span> System </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Linux/System/1.%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E5%92%8C%E8%BD%AF%E4%BB%B6%E6%BA%90/ class=md-nav__link> <span class=md-ellipsis> 1.系统镜像和软件源 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/System/2.Linux%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA/ class=md-nav__link> <span class=md-ellipsis> 2.Linux安全加固 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/System/3.Systemd/ class=md-nav__link> <span class=md-ellipsis> 3.Systemd </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/System/4.Superivisor/ class=md-nav__link> <span class=md-ellipsis> 4.Superivisor </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/System/5.SSH%E7%99%BB%E5%BD%95Linux%E6%98%BE%E7%A4%BA%E6%A8%AA%E5%B9%85/ class=md-nav__link> <span class=md-ellipsis> 5.SSH登录Linux显示横幅 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/System/6.Linux%E4%B8%AD%E7%AB%AF%E5%8F%A3%E5%8D%A0%E7%94%A8%E6%8E%92%E6%9F%A5/ class=md-nav__link> <span class=md-ellipsis> 6.Linux中端口占用排查 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/System/7.%E4%BD%BF%E7%94%A8curl%E5%8F%91%E9%80%81REST-API%E8%AF%B7%E6%B1%82/ class=md-nav__link> <span class=md-ellipsis> 7.使用curl发送REST API请求 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/System/8.%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%A8%A1%E7%B3%8A%E6%9F%A5%E6%89%BE%E5%99%A8fzf/ class=md-nav__link> <span class=md-ellipsis> 8.命令行模糊查找器fzf </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/System/9.Centos7.9%E7%B3%BB%E7%BB%9F%E7%9B%98%E6%89%A9%E5%AE%B9/ class=md-nav__link> <span class=md-ellipsis> 9.Centos7.9系统盘扩容 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/System/10.Centos%E5%9C%A8%E7%BA%BF-%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96/ class=md-nav__link> <span class=md-ellipsis> 10.Centos在线-离线安装依赖 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/System/11.rsync-ssh/ class=md-nav__link> <span class=md-ellipsis> 11.rsync ssh使用 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/System/12.%E5%90%84%E5%A4%A7%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%81%9ARAID/ class=md-nav__link> <span class=md-ellipsis> 12.各大服务器做RAID </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8_7> <label class=md-nav__link for=__nav_8_7 id=__nav_8_7_label tabindex=0> <span class=md-ellipsis> Serveices </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_8_7_label aria-expanded=false> <label class=md-nav__title for=__nav_8_7> <span class="md-nav__icon md-icon"></span> Serveices </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Linux/Serveices/0.ubuntu-desktop-vmware/ class=md-nav__link> <span class=md-ellipsis> ubuntu-desktop-vmware </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_9> <label class=md-nav__link for=__nav_9 id=__nav_9_label tabindex=0> <span class=md-ellipsis> Other </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_9_label aria-expanded=false> <label class=md-nav__title for=__nav_9> <span class="md-nav__icon md-icon"></span> Other </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_9_1> <label class=md-nav__link for=__nav_9_1 id=__nav_9_1_label tabindex=0> <span class=md-ellipsis> tools </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_9_1_label aria-expanded=false> <label class=md-nav__title for=__nav_9_1> <span class="md-nav__icon md-icon"></span> tools </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Other/tools/1.PicGo%E5%9B%BE%E5%BA%8A/ class=md-nav__link> <span class=md-ellipsis> 1.PicGo图床 </span> </a> </li> <li class=md-nav__item> <a href=../../../Other/tools/2.PicX%E5%9B%BE%E5%BA%8A/ class=md-nav__link> <span class=md-ellipsis> 2.Picx图床 </span> </a> </li> <li class=md-nav__item> <a href=../../../Other/tools/3.Markdown%E8%AF%AD%E6%B3%95/ class=md-nav__link> <span class=md-ellipsis> 3.Markdown语法 </span> </a> </li> <li class=md-nav__item> <a href=../../../Other/tools/4.KeyManager/ class=md-nav__link> <span class=md-ellipsis> 4.KeyManager </span> </a> </li> <li class=md-nav__item> <a href=../../../Other/tools/5.mkdocs-material%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2/ class=md-nav__link> <span class=md-ellipsis> 5.mkdocs-material搭建博客 </span> </a> </li> <li class=md-nav__item> <a href=../../../Other/tools/6.sphinx%E6%9E%84%E5%BB%BA%E5%8D%9A%E5%AE%A2/ class=md-nav__link> <span class=md-ellipsis> 6.sphinx构建博客 </span> </a> </li> <li class=md-nav__item> <a href=../../../Other/tools/7.%E4%BC%81%E4%B8%9A%E7%BA%A7VPN%E8%BD%AF%E4%BB%B6AnyLink/ class=md-nav__link> <span class=md-ellipsis> 7.企业级VPN软件AnyLink </span> </a> </li> <li class=md-nav__item> <a href=../../../Other/tools/8.%E5%B9%B3%E5%8F%B0%E5%8F%8A%E5%B7%A5%E5%85%B7%E6%B1%87%E6%80%BB/ class=md-nav__link> <span class=md-ellipsis> 8.平台及工具汇总 </span> </a> </li> <li class=md-nav__item> <a href=../../../Other/tools/9.%E8%87%AA%E5%8A%A8%E6%9B%B4%E6%96%B0%E7%B3%BB%E7%BB%9F%E4%BB%A3%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 9.自动更新系统代理 </span> </a> </li> <li class=md-nav__item> <a href=../../../Other/tools/10.Bash-to-Bat-Converter/ class=md-nav__link> <span class=md-ellipsis> 10.Bash-to-Bat-Converter </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_9_2> <label class=md-nav__link for=__nav_9_2 id=__nav_9_2_label tabindex=0> <span class=md-ellipsis> windows </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_9_2_label aria-expanded=false> <label class=md-nav__title for=__nav_9_2> <span class="md-nav__icon md-icon"></span> windows </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Other/windows/1.%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6%E4%B8%8B%E8%BD%BD/ class=md-nav__link> <span class=md-ellipsis> 1.常用软件下载 </span> </a> </li> <li class=md-nav__item> <a href=../../../Other/windows/2.windows%E6%9F%A5%E7%9C%8B%E7%AB%AF%E5%8F%A3%E5%8D%A0%E7%94%A8/ class=md-nav__link> <span class=md-ellipsis> 2.windows查看端口占用 </span> </a> </li> <li class=md-nav__item> <a href=../../../Other/windows/3.Win11%E9%95%9C%E5%83%8F%E4%B8%8B%E8%BD%BD%E3%80%81%E5%A3%81%E7%BA%B8%E5%8F%8AKMS%E6%BF%80%E6%B4%BB/ class=md-nav__link> <span class=md-ellipsis> 3.Win11镜像下载、壁纸及KMS激活 </span> </a> </li> <li class=md-nav__item> <a href=../../../Other/windows/4.windows%E4%B8%8Bnetcat%E5%AE%89%E8%A3%85/ class=md-nav__link> <span class=md-ellipsis> 4.windows下netcat安装 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_9_3> <label class=md-nav__link for=__nav_9_3 id=__nav_9_3_label tabindex=0> <span class=md-ellipsis> Interview </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_9_3_label aria-expanded=false> <label class=md-nav__title for=__nav_9_3> <span class="md-nav__icon md-icon"></span> Interview </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Other/Interview/0.%E9%9D%A2%E8%AF%95%E5%AE%9D%E5%85%B8/ class=md-nav__link> <span class=md-ellipsis> 面试宝典 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#1-项目背景 class=md-nav__link> <span class=md-ellipsis> 1. 项目背景 </span> </a> </li> <li class=md-nav__item> <a href=#2-前后端分离概述 class=md-nav__link> <span class=md-ellipsis> 2. 前后端分离概述 </span> </a> </li> <li class=md-nav__item> <a href=#3-功能设计 class=md-nav__link> <span class=md-ellipsis> 3. 功能设计 </span> </a> </li> <li class=md-nav__item> <a href=#4-client-go介绍 class=md-nav__link> <span class=md-ellipsis> 4. Client-go介绍 </span> </a> <nav class=md-nav aria-label="4. Client-go介绍"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#41-简介 class=md-nav__link> <span class=md-ellipsis> 4.1 简介 </span> </a> </li> <li class=md-nav__item> <a href=#42-环境搭建 class=md-nav__link> <span class=md-ellipsis> 4.2 环境搭建 </span> </a> <nav class=md-nav aria-label="4.2 环境搭建"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#安装精简版k8sk3s环境 class=md-nav__link> <span class=md-ellipsis> 安装精简版K8S(K3S)环境 </span> </a> </li> <li class=md-nav__item> <a href=#安装golang环境 class=md-nav__link> <span class=md-ellipsis> 安装golang环境 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#43-代码示例 class=md-nav__link> <span class=md-ellipsis> 4.3 代码示例 </span> </a> <nav class=md-nav aria-label="4.3 代码示例"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#创建一个测试pod class=md-nav__link> <span class=md-ellipsis> 创建一个测试pod </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#44-常用方法 class=md-nav__link> <span class=md-ellipsis> 4.4 常用方法 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#5-项目目录结构 class=md-nav__link> <span class=md-ellipsis> 5. 项目目录结构 </span> </a> </li> <li class=md-nav__item> <a href=#6-框架搭建 class=md-nav__link> <span class=md-ellipsis> 6. 框架搭建 </span> </a> <nav class=md-nav aria-label="6. 框架搭建"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-创建go项目 class=md-nav__link> <span class=md-ellipsis> 1. 创建go项目 </span> </a> </li> <li class=md-nav__item> <a href=#2-初始化gin工程 class=md-nav__link> <span class=md-ellipsis> 2. 初始化Gin工程 </span> </a> </li> <li class=md-nav__item> <a href=#3-初始化k8s-client class=md-nav__link> <span class=md-ellipsis> 3. 初始化K8s Client </span> </a> </li> <li class=md-nav__item> <a href=#4-测试api接口 class=md-nav__link> <span class=md-ellipsis> 4. 测试API接口 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#7-api开发 class=md-nav__link> <span class=md-ellipsis> 7. API开发 </span> </a> <nav class=md-nav aria-label="7. API开发"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-开发响应流程 class=md-nav__link> <span class=md-ellipsis> 1. 开发&amp;响应流程 </span> </a> </li> <li class=md-nav__item> <a href=#2-工作负载 class=md-nav__link> <span class=md-ellipsis> 2. 工作负载 </span> </a> <nav class=md-nav aria-label="2. 工作负载"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#21-数组的排序过滤分页 class=md-nav__link> <span class=md-ellipsis> 2.1 数组的排序、过滤、分页 </span> </a> </li> <li class=md-nav__item> <a href=#22-pod class=md-nav__link> <span class=md-ellipsis> 2.2 Pod </span> </a> <nav class=md-nav aria-label="2.2 Pod"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#servicepodgo class=md-nav__link> <span class=md-ellipsis> service/pod.go </span> </a> </li> <li class=md-nav__item> <a href=#controllerpodgo class=md-nav__link> <span class=md-ellipsis> controller/pod.go </span> </a> </li> <li class=md-nav__item> <a href=#controllerroutergo class=md-nav__link> <span class=md-ellipsis> controller/router.go </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#23-deployment class=md-nav__link> <span class=md-ellipsis> 2.3 Deployment </span> </a> <nav class=md-nav aria-label="2.3 Deployment"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#servicedataselectorgo class=md-nav__link> <span class=md-ellipsis> service/dataselector.go </span> </a> </li> <li class=md-nav__item> <a href=#servicedeploymentgo class=md-nav__link> <span class=md-ellipsis> service/deployment.go </span> </a> </li> <li class=md-nav__item> <a href=#controllerdeploymentgo class=md-nav__link> <span class=md-ellipsis> controller/deployment.go </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#24-daemonset class=md-nav__link> <span class=md-ellipsis> 2.4 DaemonSet </span> </a> <nav class=md-nav aria-label="2.4 DaemonSet"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#servicedataselectorgo_1 class=md-nav__link> <span class=md-ellipsis> service/dataselector.go </span> </a> </li> <li class=md-nav__item> <a href=#servicedaemonsetgo class=md-nav__link> <span class=md-ellipsis> service/daemonset.go </span> </a> </li> <li class=md-nav__item> <a href=#controllerdaemonsetgo class=md-nav__link> <span class=md-ellipsis> controller/daemonset.go </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#25-statefulset class=md-nav__link> <span class=md-ellipsis> 2.5 StatefulSet </span> </a> <nav class=md-nav aria-label="2.5 StatefulSet"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#servicedataselectorgo_2 class=md-nav__link> <span class=md-ellipsis> service/dataselector.go </span> </a> </li> <li class=md-nav__item> <a href=#servicestatefulsetgo class=md-nav__link> <span class=md-ellipsis> service/statefulset.go </span> </a> </li> <li class=md-nav__item> <a href=#controllerstatefulsetgo class=md-nav__link> <span class=md-ellipsis> controller/statefulset.go </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#3-集群 class=md-nav__link> <span class=md-ellipsis> 3. 集群 </span> </a> <nav class=md-nav aria-label="3. 集群"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#31-node class=md-nav__link> <span class=md-ellipsis> 3.1 Node </span> </a> <nav class=md-nav aria-label="3.1 Node"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#servicedataselectorgo_3 class=md-nav__link> <span class=md-ellipsis> service/dataselector.go </span> </a> </li> <li class=md-nav__item> <a href=#servicenodego class=md-nav__link> <span class=md-ellipsis> service/node.go </span> </a> </li> <li class=md-nav__item> <a href=#controllernodego class=md-nav__link> <span class=md-ellipsis> controller/node.go </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#32-namespace class=md-nav__link> <span class=md-ellipsis> 3.2 Namespace </span> </a> <nav class=md-nav aria-label="3.2 Namespace"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#servicedataselectorgo_4 class=md-nav__link> <span class=md-ellipsis> service/dataselector.go </span> </a> </li> <li class=md-nav__item> <a href=#servicenamespacego class=md-nav__link> <span class=md-ellipsis> service/namespace.go </span> </a> </li> <li class=md-nav__item> <a href=#controllernamespacego class=md-nav__link> <span class=md-ellipsis> controller/namespace.go </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#33-persistentvolume class=md-nav__link> <span class=md-ellipsis> 3.3 PersistentVolume </span> </a> <nav class=md-nav aria-label="3.3 PersistentVolume"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#servicedataselectorgo_5 class=md-nav__link> <span class=md-ellipsis> service/dataselector.go </span> </a> </li> <li class=md-nav__item> <a href=#servicepvgo class=md-nav__link> <span class=md-ellipsis> service/pv.go </span> </a> </li> <li class=md-nav__item> <a href=#controllerpvgo class=md-nav__link> <span class=md-ellipsis> controller/pv.go </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#4-负载均衡 class=md-nav__link> <span class=md-ellipsis> 4. 负载均衡 </span> </a> <nav class=md-nav aria-label="4. 负载均衡"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#41-service class=md-nav__link> <span class=md-ellipsis> 4.1 Service </span> </a> <nav class=md-nav aria-label="4.1 Service"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#servicedataselectorgo_6 class=md-nav__link> <span class=md-ellipsis> service/dataselector.go </span> </a> </li> <li class=md-nav__item> <a href=#serviceservicego class=md-nav__link> <span class=md-ellipsis> service/service.go </span> </a> </li> <li class=md-nav__item> <a href=#controllerservicego class=md-nav__link> <span class=md-ellipsis> controller/service.go </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#42-ingress class=md-nav__link> <span class=md-ellipsis> 4.2 Ingress </span> </a> <nav class=md-nav aria-label="4.2 Ingress"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#servicedataselectorgo_7 class=md-nav__link> <span class=md-ellipsis> service/dataselector.go </span> </a> </li> <li class=md-nav__item> <a href=#serviceingressgo class=md-nav__link> <span class=md-ellipsis> service/ingress.go </span> </a> </li> <li class=md-nav__item> <a href=#controlleringressgo class=md-nav__link> <span class=md-ellipsis> controller/ingress.go </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#5-存储与配置 class=md-nav__link> <span class=md-ellipsis> 5. 存储与配置 </span> </a> <nav class=md-nav aria-label="5. 存储与配置"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#51-configmap class=md-nav__link> <span class=md-ellipsis> 5.1 ConfigMap </span> </a> <nav class=md-nav aria-label="5.1 ConfigMap"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#servicedataselectorgo_8 class=md-nav__link> <span class=md-ellipsis> service/dataselector.go </span> </a> </li> <li class=md-nav__item> <a href=#serviceconfigmapgo class=md-nav__link> <span class=md-ellipsis> service/configmap.go </span> </a> </li> <li class=md-nav__item> <a href=#controllerconfigmapgo class=md-nav__link> <span class=md-ellipsis> controller/configmap.go </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#52-secret class=md-nav__link> <span class=md-ellipsis> 5.2 Secret </span> </a> <nav class=md-nav aria-label="5.2 Secret"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#servicedataselectorgo_9 class=md-nav__link> <span class=md-ellipsis> service/dataselector.go </span> </a> </li> <li class=md-nav__item> <a href=#servicesecretgo class=md-nav__link> <span class=md-ellipsis> service/secret.go </span> </a> </li> <li class=md-nav__item> <a href=#contrllersecretgo class=md-nav__link> <span class=md-ellipsis> contrller/secret.go </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#53-persistentvolumeclaim class=md-nav__link> <span class=md-ellipsis> 5.3 PersistentVolumeClaim </span> </a> <nav class=md-nav aria-label="5.3 PersistentVolumeClaim"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#servicedataselectorgo_10 class=md-nav__link> <span class=md-ellipsis> service/dataselector.go </span> </a> </li> <li class=md-nav__item> <a href=#servicepvcgo class=md-nav__link> <span class=md-ellipsis> service/pvc.go </span> </a> </li> <li class=md-nav__item> <a href=#controllerpvcgo class=md-nav__link> <span class=md-ellipsis> controller/pvc.go </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#6-工作流 class=md-nav__link> <span class=md-ellipsis> 6. 工作流 </span> </a> <nav class=md-nav aria-label="6. 工作流"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#61-流程设计 class=md-nav__link> <span class=md-ellipsis> 6.1 流程设计 </span> </a> </li> <li class=md-nav__item> <a href=#62-数据库操作gorm class=md-nav__link> <span class=md-ellipsis> 6.2 数据库操作(GORM) </span> </a> <nav class=md-nav aria-label="6.2 数据库操作(GORM)"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1初始化数据库 class=md-nav__link> <span class=md-ellipsis> (1)初始化数据库 </span> </a> </li> <li class=md-nav__item> <a href=#2建立表的映射关系 class=md-nav__link> <span class=md-ellipsis> (2)建立表的映射关系 </span> </a> </li> <li class=md-nav__item> <a href=#3数据库创建表 class=md-nav__link> <span class=md-ellipsis> (3)数据库创建表 </span> </a> </li> <li class=md-nav__item> <a href=#4表数据列表 class=md-nav__link> <span class=md-ellipsis> (4)表数据列表 </span> </a> </li> <li class=md-nav__item> <a href=#5获取单条 class=md-nav__link> <span class=md-ellipsis> (5)获取单条 </span> </a> </li> <li class=md-nav__item> <a href=#6表数据新增 class=md-nav__link> <span class=md-ellipsis> (6)表数据新增 </span> </a> </li> <li class=md-nav__item> <a href=#7表数据删除 class=md-nav__link> <span class=md-ellipsis> (7)表数据删除 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#63-workflow class=md-nav__link> <span class=md-ellipsis> 6.3 Workflow </span> </a> <nav class=md-nav aria-label="6.3 Workflow"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1列表 class=md-nav__link> <span class=md-ellipsis> (1)列表 </span> </a> </li> <li class=md-nav__item> <a href=#2获取workflow详情 class=md-nav__link> <span class=md-ellipsis> (2)获取Workflow详情 </span> </a> </li> <li class=md-nav__item> <a href=#3新增workflow class=md-nav__link> <span class=md-ellipsis> (3)新增Workflow </span> </a> </li> <li class=md-nav__item> <a href=#4删除workflow class=md-nav__link> <span class=md-ellipsis> (4)删除workflow </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#7-中间件 class=md-nav__link> <span class=md-ellipsis> 7. 中间件 </span> </a> <nav class=md-nav aria-label="7. 中间件"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#71什么是中间件 class=md-nav__link> <span class=md-ellipsis> 7.1什么是中间件 </span> </a> </li> <li class=md-nav__item> <a href=#72-gin中间件用法 class=md-nav__link> <span class=md-ellipsis> 7.2 gin中间件用法 </span> </a> </li> <li class=md-nav__item> <a href=#73-cors跨域 class=md-nav__link> <span class=md-ellipsis> 7.3 Cors跨域 </span> </a> </li> <li class=md-nav__item> <a href=#74-jwt-token验证 class=md-nav__link> <span class=md-ellipsis> 7.4 JWT token验证 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=k8s管理系统-后端api开发>K8s管理系统-后端API开发<a class=headerlink href=#k8s管理系统-后端api开发 title="Permanent link">&para;</a></h1> <p>本文档为后端服务器部分</p> <p>kubernetes客户端库文档：</p> <p><a href=https://kubernetes.io/zh-cn/docs/reference/using-api/client-libraries/ >https://kubernetes.io/zh-cn/docs/reference/using-api/client-libraries/</a></p> <p><a href=https://gitee.com/wangzilong9570/k8s-platform>gitee仓库地址</a></p> <blockquote> <p>提示：需要配置k8s集群和MySQL数据库</p> </blockquote> <h2 id=1-项目背景>1. 项目背景<a class=headerlink href=#1-项目背景 title="Permanent link">&para;</a></h2> <p>随着容器技术的广泛应用，kubernetes逐渐成为业内的核心技术，是容器编排技术的首选工具。</p> <p>而k8s管理平台在日常的容器维护中也发挥着举足轻重的作用，但随着k8s的定制化功能越来越多，dashboard 已经无法满足日常的维护需求，且 dashboard 的源码学习成本较高，抽象程度较高，二次开发成本也就比较高。</p> <p>本项目使用当下较主流的前端 vue+element plus 及后端 go+gin 框架，打造与dashboard对标的k8s管理功能，且可定制化程度高，</p> <p>同学们在入门后可根据自身需求，进行灵活定制开发，且本课程除了学习相关知识点外，会带着大家逐渐掌握开发习惯与技巧，让大家在日常工作中高效、高质量的进行开发作业。</p> <h2 id=2-前后端分离概述>2. 前后端分离概述<a class=headerlink href=#2-前后端分离概述 title="Permanent link">&para;</a></h2> <p>前后端分离已成为互联网项目开发的业界标准使用方式，通过 nginx+tomcat 的方式（也可以中间加一个node.js）有效的进行解耦，</p> <p>并且前后端分离会为以后的大型分布式架构、弹性计算架构、微服务架构、多段话服务（多种客户端，例如：浏览器，车载终端，安卓IOS等）打下坚实的基础。</p> <p>这个步骤是系统架构学习的必经之路。</p> <p><img alt=1698135577748 class=zoom src=https://cdn.jsdelivr.net/gh/hujianli94/Picgo-atlas@main/img/1698135577748.6u24tknnt9w0.png></p> <p>前后分离的优势：</p> <ol> <li>可以实现真正的前后端解耦，前端服务器使用nginx</li> <li>发现bug，可以快速定位是谁的问题，不会出现互相踢皮球的现象</li> <li>在大并发情况下，可以同时水平扩展前后端服务器。</li> <li>增加代码的维护性&amp;易读性（前后端耦合在一起的代码阅读比较费劲）</li> <li>提升开发效率，因为可以前后端并行开发，而不是像以前的强依赖</li> </ol> <h2 id=3-功能设计>3. 功能设计<a class=headerlink href=#3-功能设计 title="Permanent link">&para;</a></h2> <p><img alt=1698135709154 class=zoom src=https://cdn.jsdelivr.net/gh/hujianli94/Picgo-atlas@main/img/1698135709154.3anyxowdo8m.webp></p> <h2 id=4-client-go介绍>4. Client-go介绍<a class=headerlink href=#4-client-go介绍 title="Permanent link">&para;</a></h2> <h3 id=41-简介>4.1 简介<a class=headerlink href=#41-简介 title="Permanent link">&para;</a></h3> <blockquote> <p>​client-go官方文档：<a href=https://github.com/kubernetes/client-go>https://github.com/kubernetes/client-go</a></p> <p><a href=https://www.bookstack.cn/read/huweihuang-kubernetes-notes/develop-client-go.md>https://www.bookstack.cn/read/huweihuang-kubernetes-notes/develop-client-go.md</a></p> </blockquote> <p>client-go 是 kubernetes 官方提供的 go 语言的客户端库，go 应用使用该库可以访问 kubernetes 的 API Server，这样我们就能通过编程来对 kubernetes 资源进行增删改查操作。</p> <p>除了提供丰富的 API 用于操作 kubernetes 资源，client-go 还为 controller 和 operator 提供了重要支持 client-go 的 informer 机制，可以将 controller 关注的资源变化及时带给此 controller，使 controller 能够及时响应变化。</p> <p>通过 client-go 提供的客户端对象与 kubernetes 的 API Server 进行交互，而 client-go 提供了以下四种客户端对象：</p> <ol> <li>RESTClient这是最基础的客户端对象，仅为HTTPRequest进行了封装，实现RESTFul风格API，这个对象的使用并不方便，因为很多参数都要使用者来设置，于是client-go基于RESTClient又实现了三种新的客户端对象。</li> <li>ClientSet把Resource和Version也封装成了方法，用起来更简单直接，一个资源是一个客户端，多个资源就对应了多个客户端，所以ClientSet就是多个客户端的集合了，这样就好理解了，不过ClientSet只能访问内置资源，访问不了自定义资源</li> <li>DynamicClient可以访问内置资源和自定义资源，个人感觉有点像java的集合操作，拿出的内容是Object类型，按实际情况自己去做强制转换，当然了也会有强制转换失败的风险</li> <li>DiscoveryClient用于发现kubernetes的API Server支持的Group、Version、Resources等信息 //kubectl api-resources</li> </ol> <h3 id=42-环境搭建>4.2 环境搭建<a class=headerlink href=#42-环境搭建 title="Permanent link">&para;</a></h3> <h4 id=安装精简版k8sk3s环境>安装精简版K8S(K3S)环境<a class=headerlink href=#安装精简版k8sk3s环境 title="Permanent link">&para;</a></h4> <p>k3s的官方网址: <a href=https://k3s.io>https://k3s.io</a></p> <p>github地址：<a href=https://github.com/k3s-io/k3s>https://github.com/k3s-io/k3s</a></p> <blockquote> <p>前提</p> </blockquote> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled checked><span class=task-list-indicator></span></label> 安装 centos7</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled checked><span class=task-list-indicator></span></label> 安装 docker</li> </ul> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a>yum<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>yum-utils<span class=w> </span>device-mapper-persistent-data<span class=w> </span>lvm2<span class=w> </span>vim
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=c1># 阿里源或者清华源 </span>
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a>sudo<span class=w> </span>yum-config-manager<span class=w> </span>--add-repo<span class=w> </span>https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
<a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=c1># sudo yum-config-manager --add-repo https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/centos/docker-ce.repo</span>
<a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a>yum<span class=w> </span>list<span class=w> </span>docker-ce<span class=w> </span>--showduplicates<span class=w> </span><span class=p>|</span><span class=w> </span>sort<span class=w> </span>-r
<a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a>yum<span class=w> </span>install<span class=w> </span>docker-ce<span class=w> </span>docker-ce-cli<span class=w> </span>containerd.io<span class=w> </span>-y
<a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a>
<a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a>systemctl<span class=w> </span>start<span class=w> </span>docker
<a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a>systemctl<span class=w> </span><span class=nb>enable</span><span class=w> </span>docker
<a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a>systemctl<span class=w> </span>daemon-reload
<a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a>systemctl<span class=w> </span>restart<span class=w> </span>docker
<a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a>
<a id=__codelineno-0-13 name=__codelineno-0-13 href=#__codelineno-0-13></a>
<a id=__codelineno-0-14 name=__codelineno-0-14 href=#__codelineno-0-14></a>docker<span class=w> </span>run<span class=w> </span>-itd<span class=w> </span>-p<span class=w> </span><span class=m>80</span>:80<span class=w>  </span>nginx:1.18-alpine
</code></pre></div> <p>Docker Compose v2安装</p> <div class=highlight><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=c1># 1、从项目发布页面下载适合你的系统的二进制文件，并将其复制到$HOME/.docker/cli-plugins，作为docker-compose来安装Compose V2</span>
<a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a>
<a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=c1># 2、运行以下命令，下载Docker Compose的当前稳定版本</span>
<a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a><span class=c1># 该命令为$HOME目录下的用户安装Compose V2。</span>
<a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a>$<span class=w> </span>mkdir<span class=w> </span>-p<span class=w> </span>~/.docker/cli-plugins/
<a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a>$<span class=w> </span>curl<span class=w> </span>-SL<span class=w> </span>https://github.com/docker/compose/releases/download/v2.16.0/docker-compose-linux-x86_64<span class=w> </span>-o<span class=w> </span>~/.docker/cli-plugins/docker-compose
<a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a>$<span class=w> </span>chmod<span class=w> </span>+x<span class=w> </span>~/.docker/cli-plugins/docker-compose
<a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a>
<a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a><span class=c1>#为系统中的所有用户安装Docker Compose</span>
<a id=__codelineno-1-10 name=__codelineno-1-10 href=#__codelineno-1-10></a>$<span class=w> </span>mkdir<span class=w> </span>-p<span class=w> </span>/usr/local/lib/docker/cli-plugins
<a id=__codelineno-1-11 name=__codelineno-1-11 href=#__codelineno-1-11></a>$<span class=w> </span>curl<span class=w> </span>-SL<span class=w> </span>https://github.com/docker/compose/releases/download/v2.16.0/docker-compose-linux-x86_64<span class=w> </span>-o<span class=w> </span>/usr/local/lib/docker/cli-plugins/docker-compose
<a id=__codelineno-1-12 name=__codelineno-1-12 href=#__codelineno-1-12></a>$<span class=w> </span>chmod<span class=w> </span>+x<span class=w> </span>/usr/local/lib/docker/cli-plugins/docker-compose
<a id=__codelineno-1-13 name=__codelineno-1-13 href=#__codelineno-1-13></a>
<a id=__codelineno-1-14 name=__codelineno-1-14 href=#__codelineno-1-14></a><span class=c1># 设置docker-compose命令兼容v1</span>
<a id=__codelineno-1-15 name=__codelineno-1-15 href=#__codelineno-1-15></a>$<span class=w> </span>sudo<span class=w> </span>ln<span class=w> </span>-s<span class=w>  </span>~/.docker/cli-plugins/docker-compose<span class=w> </span>/usr/local/bin/docker-compose
<a id=__codelineno-1-16 name=__codelineno-1-16 href=#__codelineno-1-16></a><span class=c1># $ sudo ln -s  /usr/local/lib/docker/cli-plugins/docker-compose /usr/local/bin/docker-compose</span>
<a id=__codelineno-1-17 name=__codelineno-1-17 href=#__codelineno-1-17></a>
<a id=__codelineno-1-18 name=__codelineno-1-18 href=#__codelineno-1-18></a><span class=c1># 3、测试安装</span>
<a id=__codelineno-1-19 name=__codelineno-1-19 href=#__codelineno-1-19></a>$<span class=w> </span>docker<span class=w> </span>compose<span class=w> </span>version
<a id=__codelineno-1-20 name=__codelineno-1-20 href=#__codelineno-1-20></a>Docker<span class=w> </span>Compose<span class=w> </span>version<span class=w> </span>v2.16.0
</code></pre></div> <blockquote> <p>安装</p> </blockquote> <p>k3s的三个文件：</p> <ul> <li>k3s</li> <li>k3s-airgap-images-amd64.tar</li> <li>k3s-install.sh</li> </ul> <p>对于国内用户来说，访问Github超级慢，为了方便下载，可以直接使用下面百度云盘方式下载：</p> <p>百度网盘下载：</p> <p><a href=https://pan.baidu.com/s/1Ca1mxigeXOB7QaFLl5xM6A>https://pan.baidu.com/s/1Ca1mxigeXOB7QaFLl5xM6A</a> 提取码：8888</p> <div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a>chmod<span class=w> </span>+x<span class=w> </span>k3s
<a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a>cp<span class=w> </span>k3s<span class=w> </span>/usr/local/bin/
<a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a>
<a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a>docker<span class=w> </span>load<span class=w> </span>-i<span class=w> </span>k3s-airgap-images-amd64.tar
<a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a>
<a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a><span class=nb>export</span><span class=w> </span><span class=nv>INSTALL_K3S_SKIP_DOWNLOAD</span><span class=o>=</span><span class=nb>true</span>
<a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a>
<a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a><span class=nb>export</span><span class=w> </span><span class=nv>INSTALL_K3S_EXEC</span><span class=o>=</span><span class=s2>&quot;--docker --bind-address=192.168.1.147 \</span>
<a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a><span class=s2>  --cluster-cidr=10.128.0.0/16 --service-cidr=10.129.0.0/16  \</span>
<a id=__codelineno-2-10 name=__codelineno-2-10 href=#__codelineno-2-10></a><span class=s2>  --kube-apiserver-arg service-node-port-range=30000-50000 \</span>
<a id=__codelineno-2-11 name=__codelineno-2-11 href=#__codelineno-2-11></a><span class=s2>  --no-deploy traefik --no-deploy servicelb \</span>
<a id=__codelineno-2-12 name=__codelineno-2-12 href=#__codelineno-2-12></a><span class=s2>  --write-kubeconfig ~/.kube/config --write-kubeconfig-mode 666&quot;</span>
<a id=__codelineno-2-13 name=__codelineno-2-13 href=#__codelineno-2-13></a>
<a id=__codelineno-2-14 name=__codelineno-2-14 href=#__codelineno-2-14></a>sh<span class=w> </span>k3s-install.sh
<a id=__codelineno-2-15 name=__codelineno-2-15 href=#__codelineno-2-15></a>
<a id=__codelineno-2-16 name=__codelineno-2-16 href=#__codelineno-2-16></a>kubectl<span class=w> </span>get<span class=w> </span>pod<span class=w> </span>-A
<a id=__codelineno-2-17 name=__codelineno-2-17 href=#__codelineno-2-17></a>NAMESPACE<span class=w>     </span>NAME<span class=w>                                      </span>READY<span class=w>   </span>STATUS<span class=w>    </span>RESTARTS<span class=w>   </span>AGE
<a id=__codelineno-2-18 name=__codelineno-2-18 href=#__codelineno-2-18></a>kube-system<span class=w>   </span>local-path-provisioner-58fb86bdfd-dgjdm<span class=w>   </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>62s
<a id=__codelineno-2-19 name=__codelineno-2-19 href=#__codelineno-2-19></a>kube-system<span class=w>   </span>metrics-server-6d684c7b5-mcfv4<span class=w>            </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>62s
<a id=__codelineno-2-20 name=__codelineno-2-20 href=#__codelineno-2-20></a>kube-system<span class=w>   </span>coredns-6c6bb68b64-x9p6c<span class=w>                  </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>62s
<a id=__codelineno-2-21 name=__codelineno-2-21 href=#__codelineno-2-21></a>
<a id=__codelineno-2-22 name=__codelineno-2-22 href=#__codelineno-2-22></a>
<a id=__codelineno-2-23 name=__codelineno-2-23 href=#__codelineno-2-23></a><span class=c1># kubectl补全</span>
<a id=__codelineno-2-24 name=__codelineno-2-24 href=#__codelineno-2-24></a><span class=c1># centos7上</span>
<a id=__codelineno-2-25 name=__codelineno-2-25 href=#__codelineno-2-25></a>yum<span class=w> </span>-y<span class=w> </span>install<span class=w> </span>bash-completion
<a id=__codelineno-2-26 name=__codelineno-2-26 href=#__codelineno-2-26></a><span class=c1># ubuntu上</span>
<a id=__codelineno-2-27 name=__codelineno-2-27 href=#__codelineno-2-27></a>sudo<span class=w> </span>apt<span class=w> </span>install<span class=w> </span>bash-completion
<a id=__codelineno-2-28 name=__codelineno-2-28 href=#__codelineno-2-28></a>
<a id=__codelineno-2-29 name=__codelineno-2-29 href=#__codelineno-2-29></a>
<a id=__codelineno-2-30 name=__codelineno-2-30 href=#__codelineno-2-30></a><span class=c1># 在 bash 中设置当前 shell 的自动补全</span>
<a id=__codelineno-2-31 name=__codelineno-2-31 href=#__codelineno-2-31></a><span class=nb>source</span><span class=w> </span>&lt;<span class=o>(</span>kubectl<span class=w> </span>completion<span class=w> </span>bash<span class=o>)</span><span class=w> </span>
<a id=__codelineno-2-32 name=__codelineno-2-32 href=#__codelineno-2-32></a><span class=c1># 在你的 bash shell 中永久地添加自动补全</span>
<a id=__codelineno-2-33 name=__codelineno-2-33 href=#__codelineno-2-33></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;source &lt;(kubectl completion bash)&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span>~/.bashrc<span class=w> </span>
<a id=__codelineno-2-34 name=__codelineno-2-34 href=#__codelineno-2-34></a><span class=nb>source</span><span class=w> </span>/usr/share/bash-completion/bash_completion
<a id=__codelineno-2-35 name=__codelineno-2-35 href=#__codelineno-2-35></a>
<a id=__codelineno-2-36 name=__codelineno-2-36 href=#__codelineno-2-36></a>
<a id=__codelineno-2-37 name=__codelineno-2-37 href=#__codelineno-2-37></a><span class=c1># 快捷键</span>
<a id=__codelineno-2-38 name=__codelineno-2-38 href=#__codelineno-2-38></a>cat<span class=w> </span>&gt;&gt;<span class=w> </span>~/.bashrc<span class=w> </span><span class=s>&lt;&lt;EOF</span>
<a id=__codelineno-2-39 name=__codelineno-2-39 href=#__codelineno-2-39></a><span class=s>alias k=kubectl</span>
<a id=__codelineno-2-40 name=__codelineno-2-40 href=#__codelineno-2-40></a><span class=s>complete -o default -F __start_kubectl k</span>
<a id=__codelineno-2-41 name=__codelineno-2-41 href=#__codelineno-2-41></a><span class=s>EOF</span>
<a id=__codelineno-2-42 name=__codelineno-2-42 href=#__codelineno-2-42></a>
<a id=__codelineno-2-43 name=__codelineno-2-43 href=#__codelineno-2-43></a><span class=nb>source</span><span class=w> </span>~/.bashrc
</code></pre></div> <p><a href=https://www.yuque.com/leryn/wiki/cloud.k8s.k3s>k3s安装</a></p> <p><a href=https://jueee.github.io/2021/09/2021-09-15-%E7%A6%BB%E7%BA%BF%E6%90%AD%E5%BB%BA%E9%83%A8%E7%BD%B2%E9%AB%98%E5%8F%AF%E7%94%A8k3s%E9%9B%86%E7%BE%A4/ >离线搭建部署高可用 k3s 集群</a></p> <p><a href=https://imroc.cc/kubernetes/deploy/k3s/offline-installation>k3s 国内离线安装方法</a></p> <p><a href=https://docs.k3s.io/zh/installation/airgap#%E5%AE%89%E8%A3%85-k3s>k3s 官方离线安装方法</a></p> <p><a href=https://www.linuxbuzz.com/install-k3s-kubernetes-cluster-on-ubuntu/ >How to Install k3s Kubernetes Cluster on Ubuntu 22.04</a></p> <h4 id=安装golang环境>安装golang环境<a class=headerlink href=#安装golang环境 title="Permanent link">&para;</a></h4> <p>在k8s-master节点上</p> <div class=highlight><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=c1># 一：yum安装</span>
<a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a>yum<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>epel-release
<a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a>yum<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>golang
<a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a>
<a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a>
<a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a><span class=c1># 二：手动配置 去官网下载安装包手动编译安装</span>
<a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a>mkdir<span class=w> </span>~/go<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nb>cd</span><span class=w> </span>~/go
<a id=__codelineno-3-8 name=__codelineno-3-8 href=#__codelineno-3-8></a>wget<span class=w> </span>https://dl.google.com/go/go1.17.8.linux-amd64.tar.gz
<a id=__codelineno-3-9 name=__codelineno-3-9 href=#__codelineno-3-9></a><span class=c1># 解压到/usr/local目录下</span>
<a id=__codelineno-3-10 name=__codelineno-3-10 href=#__codelineno-3-10></a>tar<span class=w> </span>-C<span class=w> </span>/usr/local<span class=w> </span>-zxvf<span class=w> </span>go1.17.8.linux-amd64.tar.gz
<a id=__codelineno-3-11 name=__codelineno-3-11 href=#__codelineno-3-11></a>
<a id=__codelineno-3-12 name=__codelineno-3-12 href=#__codelineno-3-12></a><span class=c1># 添加/usr/local/go/bin目录到PATH变量中</span>
<a id=__codelineno-3-13 name=__codelineno-3-13 href=#__codelineno-3-13></a>vi<span class=w> </span>~/.bashrc
<a id=__codelineno-3-14 name=__codelineno-3-14 href=#__codelineno-3-14></a><span class=nb>export</span><span class=w> </span><span class=nv>GOROOT</span><span class=o>=</span>/usr/local/go
<a id=__codelineno-3-15 name=__codelineno-3-15 href=#__codelineno-3-15></a><span class=nb>export</span><span class=w> </span><span class=nv>PATH</span><span class=o>=</span><span class=nv>$PATH</span>:<span class=nv>$GOROOT</span>/bin
<a id=__codelineno-3-16 name=__codelineno-3-16 href=#__codelineno-3-16></a>
<a id=__codelineno-3-17 name=__codelineno-3-17 href=#__codelineno-3-17></a><span class=c1># 刷新配置</span>
<a id=__codelineno-3-18 name=__codelineno-3-18 href=#__codelineno-3-18></a><span class=nb>source</span><span class=w> </span>~/.bashrc
</code></pre></div> <p>新建k8s-platform项目，设置goland远程环境运行</p> <p><img alt=1698201779063 class=zoom src=https://cdn.jsdelivr.net/gh/hujianli94/Picgo-atlas@main/img/1698201779063.10verb6egj5c.png></p> <p><img alt=1698202043803 class=zoom src=https://cdn.jsdelivr.net/gh/hujianli94/Picgo-atlas@main/img/1698202043803.56pntwrwyyg0.png></p> <p>户名，填写密钥</p> <h3 id=43-代码示例>4.3 代码示例<a class=headerlink href=#43-代码示例 title="Permanent link">&para;</a></h3> <h4 id=创建一个测试pod>创建一个测试pod<a class=headerlink href=#创建一个测试pod title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a>kubectl<span class=w> </span>run<span class=w> </span>-i<span class=w> </span>--tty<span class=w> </span>alpine-<span class=nv>$RANDOM</span><span class=w> </span>--image<span class=o>=</span>alpine:latest<span class=w> </span>--<span class=w> </span>sh
<a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=c1># -restart=Never 意味着这个 Pod 不会被重启。</span>
<a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a>
<a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a><span class=c1># --rm 会在退出时自动删除这个 Pod</span>
<a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a><span class=c1># kubectl run -it --rm test-pod --image=appropriate/curl --restart=Never -- /bin/sh</span>
<a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a>
<a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a>kubectl<span class=w> </span>run<span class=w> </span>-i<span class=w> </span>--tty<span class=w> </span>busybox<span class=w> </span>--image<span class=o>=</span>busybox<span class=w> </span>--<span class=w> </span>sh
<a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a>
<a id=__codelineno-4-9 name=__codelineno-4-9 href=#__codelineno-4-9></a>kubectl<span class=w> </span>run<span class=w> </span>ubuntu<span class=w> </span>--image<span class=o>=</span>ubuntu:20.04<span class=w> </span>--restart<span class=o>=</span>Always<span class=w> </span>--<span class=w> </span>/bin/bash<span class=w> </span>-c<span class=w> </span><span class=s2>&quot;while true; do sleep 30; done;&quot;</span>
<a id=__codelineno-4-10 name=__codelineno-4-10 href=#__codelineno-4-10></a><span class=c1># kubectl run -i --tty ubuntu --image=ubuntu:20.04 --restart=Never -- bash -il</span>
</code></pre></div> <p>我们这里在default名称空间下运行3个测试pod</p> <div class=highlight><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a>kubectl<span class=w> </span>get<span class=w> </span>pod
<a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a>NAME<span class=w>                           </span>READY<span class=w>   </span>STATUS<span class=w>    </span>RESTARTS<span class=w>   </span>AGE
<a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a>alpine-9594-7997b99597-z2k6m<span class=w>   </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>1</span><span class=w>          </span>14m
<a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a>busybox-6cd57fd969-5sxvp<span class=w>       </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>1</span><span class=w>          </span>13m
<a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a>ubuntu-797bd794cf-bv75b<span class=w>        </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>3s
</code></pre></div> <p>main.go</p> <div class=highlight><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=kn>package</span><span class=w> </span><span class=nx>main</span>
<a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a>
<a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a><span class=kn>import</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a><span class=w>    </span><span class=s>&quot;context&quot;</span>
<a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a><span class=w>    </span><span class=s>&quot;flag&quot;</span>
<a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a><span class=w>    </span><span class=s>&quot;fmt&quot;</span>
<a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a><span class=w>    </span><span class=s>&quot;os&quot;</span>
<a id=__codelineno-6-8 name=__codelineno-6-8 href=#__codelineno-6-8></a><span class=w>    </span><span class=s>&quot;path/filepath&quot;</span>
<a id=__codelineno-6-9 name=__codelineno-6-9 href=#__codelineno-6-9></a>
<a id=__codelineno-6-10 name=__codelineno-6-10 href=#__codelineno-6-10></a><span class=w>    </span><span class=nx>metav1</span><span class=w> </span><span class=s>&quot;k8s.io/apimachinery/pkg/apis/meta/v1&quot;</span>
<a id=__codelineno-6-11 name=__codelineno-6-11 href=#__codelineno-6-11></a>
<a id=__codelineno-6-12 name=__codelineno-6-12 href=#__codelineno-6-12></a><span class=w>    </span><span class=s>&quot;k8s.io/client-go/kubernetes&quot;</span>
<a id=__codelineno-6-13 name=__codelineno-6-13 href=#__codelineno-6-13></a><span class=w>    </span><span class=s>&quot;k8s.io/client-go/tools/clientcmd&quot;</span><span class=w> </span><span class=c1>//可能需要挂vpn,留意版本问题</span>
<a id=__codelineno-6-14 name=__codelineno-6-14 href=#__codelineno-6-14></a><span class=p>)</span>
<a id=__codelineno-6-15 name=__codelineno-6-15 href=#__codelineno-6-15></a>
<a id=__codelineno-6-16 name=__codelineno-6-16 href=#__codelineno-6-16></a><span class=kd>func</span><span class=w> </span><span class=nx>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-6-17 name=__codelineno-6-17 href=#__codelineno-6-17></a><span class=w>    </span><span class=c1>//声明kubeconfig配置文件</span>
<a id=__codelineno-6-18 name=__codelineno-6-18 href=#__codelineno-6-18></a><span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=nx>kubeconfig</span><span class=w> </span><span class=o>*</span><span class=kt>string</span>
<a id=__codelineno-6-19 name=__codelineno-6-19 href=#__codelineno-6-19></a><span class=w>    </span><span class=c1>//获取home环境变量，拿到$HOME/.kube/config配置文件</span>
<a id=__codelineno-6-20 name=__codelineno-6-20 href=#__codelineno-6-20></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>home</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>homeDir</span><span class=p>();</span><span class=w> </span><span class=nx>home</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=s>&quot;&quot;</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-6-21 name=__codelineno-6-21 href=#__codelineno-6-21></a><span class=w>        </span><span class=nx>kubeconfig</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>flag</span><span class=p>.</span><span class=nx>String</span><span class=p>(</span><span class=s>&quot;kubeconfig&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>filepath</span><span class=p>.</span><span class=nx>Join</span><span class=p>(</span><span class=nx>home</span><span class=p>,</span><span class=w> </span><span class=s>&quot;.kube&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;config&quot;</span><span class=p>),</span>
<a id=__codelineno-6-22 name=__codelineno-6-22 href=#__codelineno-6-22></a><span class=w>            </span><span class=s>&quot;(optional) absolute path to the kubeconfig file&quot;</span><span class=p>)</span>
<a id=__codelineno-6-23 name=__codelineno-6-23 href=#__codelineno-6-23></a><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-6-24 name=__codelineno-6-24 href=#__codelineno-6-24></a><span class=w>        </span><span class=c1>//否则就根据kubeconfig传到获得config的路径</span>
<a id=__codelineno-6-25 name=__codelineno-6-25 href=#__codelineno-6-25></a><span class=w>        </span><span class=nx>kubeconfig</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>flag</span><span class=p>.</span><span class=nx>String</span><span class=p>(</span><span class=s>&quot;kubeconfig&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;absolute path to the kubeconfig file&quot;</span><span class=p>)</span>
<a id=__codelineno-6-26 name=__codelineno-6-26 href=#__codelineno-6-26></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-6-27 name=__codelineno-6-27 href=#__codelineno-6-27></a><span class=w>    </span><span class=nx>flag</span><span class=p>.</span><span class=nx>Parse</span><span class=p>()</span>
<a id=__codelineno-6-28 name=__codelineno-6-28 href=#__codelineno-6-28></a><span class=w>    </span><span class=c1>//将kubeconfig文件转换成rest.config类型文件</span>
<a id=__codelineno-6-29 name=__codelineno-6-29 href=#__codelineno-6-29></a><span class=w>    </span><span class=c1>//*kubeconfig其实就是kubeconfig文件的默认位置地址，直接填入地址字符串也可</span>
<a id=__codelineno-6-30 name=__codelineno-6-30 href=#__codelineno-6-30></a><span class=w>    </span><span class=nx>config</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>clientcmd</span><span class=p>.</span><span class=nx>BuildConfigFromFlags</span><span class=p>(</span><span class=s>&quot;&quot;</span><span class=p>,</span><span class=w> </span><span class=o>*</span><span class=nx>kubeconfig</span><span class=p>)</span>
<a id=__codelineno-6-31 name=__codelineno-6-31 href=#__codelineno-6-31></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-6-32 name=__codelineno-6-32 href=#__codelineno-6-32></a><span class=w>        </span><span class=nb>panic</span><span class=p>(</span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-6-33 name=__codelineno-6-33 href=#__codelineno-6-33></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-6-34 name=__codelineno-6-34 href=#__codelineno-6-34></a><span class=w>    </span><span class=c1>//根据rest.config类型的对象，new一个clientset出来</span>
<a id=__codelineno-6-35 name=__codelineno-6-35 href=#__codelineno-6-35></a><span class=w>    </span><span class=nx>clientset</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>kubernetes</span><span class=p>.</span><span class=nx>NewForConfig</span><span class=p>(</span><span class=nx>config</span><span class=p>)</span>
<a id=__codelineno-6-36 name=__codelineno-6-36 href=#__codelineno-6-36></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-6-37 name=__codelineno-6-37 href=#__codelineno-6-37></a><span class=w>        </span><span class=nb>panic</span><span class=p>(</span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-6-38 name=__codelineno-6-38 href=#__codelineno-6-38></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-6-39 name=__codelineno-6-39 href=#__codelineno-6-39></a><span class=w>    </span><span class=c1>//通过client-go sdk获取pods列表，命名空间是default</span>
<a id=__codelineno-6-40 name=__codelineno-6-40 href=#__codelineno-6-40></a><span class=w>    </span><span class=nx>pods</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>clientset</span><span class=p>.</span><span class=nx>CoreV1</span><span class=p>().</span><span class=nx>Pods</span><span class=p>(</span><span class=s>&quot;default&quot;</span><span class=p>).</span><span class=nx>List</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>ListOptions</span><span class=p>{})</span>
<a id=__codelineno-6-41 name=__codelineno-6-41 href=#__codelineno-6-41></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-6-42 name=__codelineno-6-42 href=#__codelineno-6-42></a><span class=w>        </span><span class=nb>panic</span><span class=p>(</span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-6-43 name=__codelineno-6-43 href=#__codelineno-6-43></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-6-44 name=__codelineno-6-44 href=#__codelineno-6-44></a><span class=w>    </span><span class=c1>//打印pod测试</span>
<a id=__codelineno-6-45 name=__codelineno-6-45 href=#__codelineno-6-45></a><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>pod</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>pods</span><span class=p>.</span><span class=nx>Items</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-6-46 name=__codelineno-6-46 href=#__codelineno-6-46></a><span class=w>        </span><span class=nx>fmt</span><span class=p>.</span><span class=nx>Println</span><span class=p>(</span><span class=nx>pod</span><span class=p>.</span><span class=nx>Name</span><span class=p>,</span><span class=w> </span><span class=nx>pod</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>)</span>
<a id=__codelineno-6-47 name=__codelineno-6-47 href=#__codelineno-6-47></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-6-48 name=__codelineno-6-48 href=#__codelineno-6-48></a><span class=p>}</span>
<a id=__codelineno-6-49 name=__codelineno-6-49 href=#__codelineno-6-49></a>
<a id=__codelineno-6-50 name=__codelineno-6-50 href=#__codelineno-6-50></a><span class=kd>func</span><span class=w> </span><span class=nx>homeDir</span><span class=p>()</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-6-51 name=__codelineno-6-51 href=#__codelineno-6-51></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>h</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>os</span><span class=p>.</span><span class=nx>Getenv</span><span class=p>(</span><span class=s>&quot;HOME&quot;</span><span class=p>);</span><span class=w> </span><span class=nx>h</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=s>&quot;&quot;</span><span class=w> </span><span class=p>{</span><span class=c1>//linux</span>
<a id=__codelineno-6-52 name=__codelineno-6-52 href=#__codelineno-6-52></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>h</span>
<a id=__codelineno-6-53 name=__codelineno-6-53 href=#__codelineno-6-53></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-6-54 name=__codelineno-6-54 href=#__codelineno-6-54></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>os</span><span class=p>.</span><span class=nx>Getenv</span><span class=p>(</span><span class=s>&quot;USERPROFILE&quot;</span><span class=p>)</span><span class=w> </span><span class=c1>//windows</span>
<a id=__codelineno-6-55 name=__codelineno-6-55 href=#__codelineno-6-55></a><span class=p>}</span>
</code></pre></div> <p>运行结果</p> <div class=highlight><pre><span></span><code><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a>alpine-9594-7997b99597-z2k6m<span class=w> </span>default
<a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a>busybox-6cd57fd969-5sxvp<span class=w> </span>default
<a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a>ubuntu-797bd794cf-bv75b<span class=w> </span>default
</code></pre></div> <p>获取到了pod名和命名空间</p> <h3 id=44-常用方法>4.4 常用方法<a class=headerlink href=#44-常用方法 title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=c1>//获取pod列表 </span>
<a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a><span class=nx>podList</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>CoreV1</span><span class=p>().</span><span class=nx>Pods</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span><span class=nx>List</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>ListOptions</span><span class=p>{})</span><span class=w> </span>
<a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a>
<a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a><span class=c1>//获取pod详情 </span>
<a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a><span class=nx>pod</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>CoreV1</span><span class=p>().</span><span class=nx>Pods</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span><span class=nx>Get</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>podName</span><span class=p>,</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>GetOptions</span><span class=p>{})</span><span class=w> </span>
<a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a>
<a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a><span class=c1>//删除pod </span>
<a id=__codelineno-8-8 name=__codelineno-8-8 href=#__codelineno-8-8></a><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>CoreV1</span><span class=p>().</span><span class=nx>Pods</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span><span class=nx>Delete</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>podName</span><span class=p>,</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>DeleteOptions</span><span class=p>{})</span><span class=w> </span>
<a id=__codelineno-8-9 name=__codelineno-8-9 href=#__codelineno-8-9></a>
<a id=__codelineno-8-10 name=__codelineno-8-10 href=#__codelineno-8-10></a><span class=c1>//更新pod（完整yaml） </span>
<a id=__codelineno-8-11 name=__codelineno-8-11 href=#__codelineno-8-11></a><span class=nx>pod</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>CoreV1</span><span class=p>().</span><span class=nx>Pods</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span><span class=nx>Update</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>pod</span><span class=p>,</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>UpdateOptions</span><span class=p>{})</span><span class=w> </span>
<a id=__codelineno-8-12 name=__codelineno-8-12 href=#__codelineno-8-12></a>
<a id=__codelineno-8-13 name=__codelineno-8-13 href=#__codelineno-8-13></a><span class=c1>//获取deployment副本数 </span>
<a id=__codelineno-8-14 name=__codelineno-8-14 href=#__codelineno-8-14></a><span class=nx>scale</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>AppsV1</span><span class=p>().</span><span class=nx>Deployments</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span><span class=nx>GetScale</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>deploymentName</span><span class=p>,</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>GetOptions</span><span class=p>{})</span><span class=w> </span>
<a id=__codelineno-8-15 name=__codelineno-8-15 href=#__codelineno-8-15></a>
<a id=__codelineno-8-16 name=__codelineno-8-16 href=#__codelineno-8-16></a><span class=c1>//创建deployment </span>
<a id=__codelineno-8-17 name=__codelineno-8-17 href=#__codelineno-8-17></a><span class=nx>deployment</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>AppsV1</span><span class=p>().</span><span class=nx>Deployments</span><span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>).</span><span class=nx>Create</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>deployment</span><span class=p>,</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>CreateOptions</span><span class=p>{})</span><span class=w> </span>
<a id=__codelineno-8-18 name=__codelineno-8-18 href=#__codelineno-8-18></a>
<a id=__codelineno-8-19 name=__codelineno-8-19 href=#__codelineno-8-19></a><span class=c1>//更新deployment（部分yaml） </span>
<a id=__codelineno-8-20 name=__codelineno-8-20 href=#__codelineno-8-20></a><span class=nx>deployment</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>AppsV1</span><span class=p>().</span><span class=nx>Deployments</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span><span class=nx>Patch</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>deploymentName</span><span class=p>,</span><span class=w> </span><span class=s>&quot;application/strategic-merge-patch+json&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>patchByte</span><span class=p>,</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>PatchOptions</span><span class=p>{})</span>
</code></pre></div> <h2 id=5-项目目录结构>5. 项目目录结构<a class=headerlink href=#5-项目目录结构 title="Permanent link">&para;</a></h2> <p><img alt=1698204465060 class=zoom src=https://cdn.jsdelivr.net/gh/hujianli94/Picgo-atlas@main/img/1698204465060.6qcpqwmfgyo0.png></p> <ul> <li>config：定义全局配置，如监听地址、管理员账号等。</li> <li>controller：controller层，定义路由规则，及接口入参和响应。</li> <li>service：服务层，处理接口的业务逻辑。</li> <li>dao：数据库操作，包含数据库的增删改查。</li> <li>model：定义数据库的表的字段。</li> <li>db: 用于初始化数据库连接以及配置。</li> <li>middle：中间件层，添加全局的逻辑处理，如跨域、jwt验证等。</li> <li>utils：工具目录，定义常用工具，如token解析，文件操作等。</li> <li>go.mod：定义项目的依赖包以及版本。</li> <li>main.go：项目的主入口 main函数。</li> </ul> <h2 id=6-框架搭建>6. 框架搭建<a class=headerlink href=#6-框架搭建 title="Permanent link">&para;</a></h2> <h3 id=1-创建go项目>1. 创建go项目<a class=headerlink href=#1-创建go项目 title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a>/d/coder/go/src/gitee.com/k8s-platform<span class=w> </span>tree
<a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a>+---<span class=w> </span>config
<a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a>+---<span class=w> </span>controller
<a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a>+---<span class=w> </span>dao
<a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a>+---<span class=w> </span>db
<a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a>+---<span class=w> </span>go.mod
<a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a>+---<span class=w> </span>main.go
<a id=__codelineno-9-8 name=__codelineno-9-8 href=#__codelineno-9-8></a>+---<span class=w> </span>middle
<a id=__codelineno-9-9 name=__codelineno-9-9 href=#__codelineno-9-9></a>+---<span class=w> </span>model
<a id=__codelineno-9-10 name=__codelineno-9-10 href=#__codelineno-9-10></a>+---<span class=w> </span>service
<a id=__codelineno-9-11 name=__codelineno-9-11 href=#__codelineno-9-11></a>+---<span class=w> </span>utils
</code></pre></div> <h3 id=2-初始化gin工程>2. 初始化Gin工程<a class=headerlink href=#2-初始化gin工程 title="Permanent link">&para;</a></h3> <p>（1）创建项目目录结构</p> <p>（2）创建config/config.go文件，配置启动监听端口</p> <div class=highlight><pre><span></span><code><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=kn>package</span><span class=w> </span><span class=nx>config</span>
<a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a>
<a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a><span class=kd>const</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a><span class=w>    </span><span class=c1>// ListenAddr 配置启动监听端口</span>
<a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a><span class=w>    </span><span class=nx>ListenAddr</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=s>&quot;0.0.0.0:9090&quot;</span>
<a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a><span class=p>)</span>
</code></pre></div> <p>（3）创建controller/router.go文件，初始化api路由规则，编写测试api接口</p> <div class=highlight><pre><span></span><code><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=kn>package</span><span class=w> </span><span class=nx>controller</span>
<a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a>
<a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a><span class=kn>import</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a><span class=w>    </span><span class=s>&quot;github.com/gin-gonic/gin&quot;</span>
<a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a><span class=w>    </span><span class=s>&quot;net/http&quot;</span>
<a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a><span class=p>)</span>
<a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a>
<a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a><span class=c1>// Router 实例化router结构体，可使用该对象点出首字母大写的方法（包外调用）</span>
<a id=__codelineno-11-9 name=__codelineno-11-9 href=#__codelineno-11-9></a><span class=kd>var</span><span class=w> </span><span class=nx>Router</span><span class=w> </span><span class=nx>router</span>
<a id=__codelineno-11-10 name=__codelineno-11-10 href=#__codelineno-11-10></a>
<a id=__codelineno-11-11 name=__codelineno-11-11 href=#__codelineno-11-11></a><span class=c1>// 创建router结构体</span>
<a id=__codelineno-11-12 name=__codelineno-11-12 href=#__codelineno-11-12></a><span class=kd>type</span><span class=w> </span><span class=nx>router</span><span class=w> </span><span class=kd>struct</span><span class=p>{}</span>
<a id=__codelineno-11-13 name=__codelineno-11-13 href=#__codelineno-11-13></a>
<a id=__codelineno-11-14 name=__codelineno-11-14 href=#__codelineno-11-14></a><span class=c1>// InitApiRouter 初始化路由规则，创建测试api接口</span>
<a id=__codelineno-11-15 name=__codelineno-11-15 href=#__codelineno-11-15></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>r</span><span class=w> </span><span class=o>*</span><span class=nx>router</span><span class=p>)</span><span class=w> </span><span class=nx>InitApiRouter</span><span class=p>(</span><span class=nx>router</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Engine</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-11-16 name=__codelineno-11-16 href=#__codelineno-11-16></a><span class=w>    </span><span class=nx>router</span><span class=p>.</span><span class=nx>GET</span><span class=p>(</span><span class=s>&quot;/testapi&quot;</span><span class=p>,</span><span class=w> </span><span class=kd>func</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-11-17 name=__codelineno-11-17 href=#__codelineno-11-17></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-11-18 name=__codelineno-11-18 href=#__codelineno-11-18></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;testapi success!&quot;</span><span class=p>,</span>
<a id=__codelineno-11-19 name=__codelineno-11-19 href=#__codelineno-11-19></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-11-20 name=__codelineno-11-20 href=#__codelineno-11-20></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-11-21 name=__codelineno-11-21 href=#__codelineno-11-21></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-11-22 name=__codelineno-11-22 href=#__codelineno-11-22></a><span class=p>}</span>
</code></pre></div> <p>（4）main.go文件中，启动gin程序</p> <div class=highlight><pre><span></span><code><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=kn>package</span><span class=w> </span><span class=nx>main</span>
<a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a>
<a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a><span class=kn>import</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a><span class=w>    </span><span class=s>&quot;gitee.com/k8s-platform/config&quot;</span>
<a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a><span class=w>    </span><span class=s>&quot;gitee.com/k8s-platform/controller&quot;</span>
<a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a>
<a id=__codelineno-12-7 name=__codelineno-12-7 href=#__codelineno-12-7></a><span class=w>    </span><span class=s>&quot;github.com/gin-gonic/gin&quot;</span>
<a id=__codelineno-12-8 name=__codelineno-12-8 href=#__codelineno-12-8></a><span class=p>)</span>
<a id=__codelineno-12-9 name=__codelineno-12-9 href=#__codelineno-12-9></a>
<a id=__codelineno-12-10 name=__codelineno-12-10 href=#__codelineno-12-10></a><span class=kd>func</span><span class=w> </span><span class=nx>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-12-11 name=__codelineno-12-11 href=#__codelineno-12-11></a><span class=w>    </span><span class=c1>//初始化gin对象</span>
<a id=__codelineno-12-12 name=__codelineno-12-12 href=#__codelineno-12-12></a><span class=w>    </span><span class=nx>r</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>Default</span><span class=p>()</span>
<a id=__codelineno-12-13 name=__codelineno-12-13 href=#__codelineno-12-13></a><span class=w>    </span><span class=c1>//初始化路由规则</span>
<a id=__codelineno-12-14 name=__codelineno-12-14 href=#__codelineno-12-14></a><span class=w>    </span><span class=nx>controller</span><span class=p>.</span><span class=nx>Router</span><span class=p>.</span><span class=nx>InitApiRouter</span><span class=p>(</span><span class=nx>r</span><span class=p>)</span>
<a id=__codelineno-12-15 name=__codelineno-12-15 href=#__codelineno-12-15></a><span class=w>    </span><span class=c1>//gin程序启动</span>
<a id=__codelineno-12-16 name=__codelineno-12-16 href=#__codelineno-12-16></a><span class=w>    </span><span class=nx>r</span><span class=p>.</span><span class=nx>Run</span><span class=p>(</span><span class=nx>config</span><span class=p>.</span><span class=nx>ListenAddr</span><span class=p>)</span>
<a id=__codelineno-12-17 name=__codelineno-12-17 href=#__codelineno-12-17></a><span class=p>}</span>
</code></pre></div> <div class=highlight><pre><span></span><code><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a>curl<span class=w> </span>http://127.0.0.1:9090/testapi
<a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a><span class=o>{</span><span class=s2>&quot;data&quot;</span>:null,<span class=s2>&quot;msg&quot;</span>:<span class=s2>&quot;testapi success!&quot;</span><span class=o>}</span><span class=w>    </span>
</code></pre></div> <h3 id=3-初始化k8s-client>3. 初始化K8s Client<a class=headerlink href=#3-初始化k8s-client title="Permanent link">&para;</a></h3> <p>（1）在config.go中添加kubeconfig文件路径</p> <div class=highlight><pre><span></span><code><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=kn>package</span><span class=w> </span><span class=nx>config</span>
<a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a>
<a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a><span class=kd>const</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a><span class=c1>// 配置启动监听端口</span>
<a id=__codelineno-14-5 name=__codelineno-14-5 href=#__codelineno-14-5></a><span class=nx>ListenAddr</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=s>&quot;0.0.0.0:9090&quot;</span>
<a id=__codelineno-14-6 name=__codelineno-14-6 href=#__codelineno-14-6></a>
<a id=__codelineno-14-7 name=__codelineno-14-7 href=#__codelineno-14-7></a><span class=c1>// Linux上配置</span>
<a id=__codelineno-14-8 name=__codelineno-14-8 href=#__codelineno-14-8></a><span class=c1>// Kubeconfig = &quot;/root/.kube/config&quot;</span>
<a id=__codelineno-14-9 name=__codelineno-14-9 href=#__codelineno-14-9></a><span class=c1>// Windows上配置</span>
<a id=__codelineno-14-10 name=__codelineno-14-10 href=#__codelineno-14-10></a><span class=nx>Kubeconfig</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=s>&quot;C:\\Users/18793/.kube/config&quot;</span>
<a id=__codelineno-14-11 name=__codelineno-14-11 href=#__codelineno-14-11></a><span class=p>)</span>
</code></pre></div> <p>（2）创建service/init.go文件，初始化k8s client</p> <div class=highlight><pre><span></span><code><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a><span class=kn>package</span><span class=w> </span><span class=nx>service</span>
<a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a>
<a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a><span class=kn>import</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a><span class=s>&quot;gitee.com/k8s-platform/config&quot;</span>
<a id=__codelineno-15-5 name=__codelineno-15-5 href=#__codelineno-15-5></a>
<a id=__codelineno-15-6 name=__codelineno-15-6 href=#__codelineno-15-6></a><span class=s>&quot;github.com/wonderivan/logger&quot;</span>
<a id=__codelineno-15-7 name=__codelineno-15-7 href=#__codelineno-15-7></a><span class=s>&quot;k8s.io/client-go/kubernetes&quot;</span>
<a id=__codelineno-15-8 name=__codelineno-15-8 href=#__codelineno-15-8></a><span class=s>&quot;k8s.io/client-go/tools/clientcmd&quot;</span>
<a id=__codelineno-15-9 name=__codelineno-15-9 href=#__codelineno-15-9></a><span class=p>)</span>
<a id=__codelineno-15-10 name=__codelineno-15-10 href=#__codelineno-15-10></a>
<a id=__codelineno-15-11 name=__codelineno-15-11 href=#__codelineno-15-11></a><span class=kd>type</span><span class=w> </span><span class=nx>k8s</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-15-12 name=__codelineno-15-12 href=#__codelineno-15-12></a><span class=nx>ClientSet</span><span class=w> </span><span class=o>*</span><span class=nx>kubernetes</span><span class=p>.</span><span class=nx>Clientset</span>
<a id=__codelineno-15-13 name=__codelineno-15-13 href=#__codelineno-15-13></a><span class=p>}</span>
<a id=__codelineno-15-14 name=__codelineno-15-14 href=#__codelineno-15-14></a>
<a id=__codelineno-15-15 name=__codelineno-15-15 href=#__codelineno-15-15></a><span class=kd>var</span><span class=w> </span><span class=nx>K8s</span><span class=w> </span><span class=nx>k8s</span>
<a id=__codelineno-15-16 name=__codelineno-15-16 href=#__codelineno-15-16></a>
<a id=__codelineno-15-17 name=__codelineno-15-17 href=#__codelineno-15-17></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>k</span><span class=w> </span><span class=o>*</span><span class=nx>k8s</span><span class=p>)</span><span class=w> </span><span class=nx>Init</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-15-18 name=__codelineno-15-18 href=#__codelineno-15-18></a><span class=nx>conf</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>clientcmd</span><span class=p>.</span><span class=nx>BuildConfigFromFlags</span><span class=p>(</span><span class=s>&quot;&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>config</span><span class=p>.</span><span class=nx>Kubeconfig</span><span class=p>)</span>
<a id=__codelineno-15-19 name=__codelineno-15-19 href=#__codelineno-15-19></a><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-15-20 name=__codelineno-15-20 href=#__codelineno-15-20></a><span class=w>  </span><span class=nb>panic</span><span class=p>(</span><span class=s>&quot;创建k8s配置失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-15-21 name=__codelineno-15-21 href=#__codelineno-15-21></a><span class=p>}</span>
<a id=__codelineno-15-22 name=__codelineno-15-22 href=#__codelineno-15-22></a><span class=nx>clientSet</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>kubernetes</span><span class=p>.</span><span class=nx>NewForConfig</span><span class=p>(</span><span class=nx>conf</span><span class=p>)</span>
<a id=__codelineno-15-23 name=__codelineno-15-23 href=#__codelineno-15-23></a><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-15-24 name=__codelineno-15-24 href=#__codelineno-15-24></a><span class=w>  </span><span class=nb>panic</span><span class=p>(</span><span class=s>&quot;创建K8s clientSet失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-15-25 name=__codelineno-15-25 href=#__codelineno-15-25></a><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-15-26 name=__codelineno-15-26 href=#__codelineno-15-26></a><span class=w>  </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Info</span><span class=p>(</span><span class=s>&quot;创建k8s clientSet成功&quot;</span><span class=p>)</span>
<a id=__codelineno-15-27 name=__codelineno-15-27 href=#__codelineno-15-27></a><span class=p>}</span>
<a id=__codelineno-15-28 name=__codelineno-15-28 href=#__codelineno-15-28></a><span class=nx>k</span><span class=p>.</span><span class=nx>ClientSet</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>clientSet</span>
<a id=__codelineno-15-29 name=__codelineno-15-29 href=#__codelineno-15-29></a><span class=p>}</span>
</code></pre></div> <p>（3）main.go中添加k8s client启动项</p> <div class=highlight><pre><span></span><code><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a><span class=kn>package</span><span class=w> </span><span class=nx>main</span>
<a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a>
<a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a><span class=kn>import</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a><span class=s>&quot;gitee.com/k8s-platform/config&quot;</span>
<a id=__codelineno-16-5 name=__codelineno-16-5 href=#__codelineno-16-5></a><span class=s>&quot;gitee.com/k8s-platform/controller&quot;</span>
<a id=__codelineno-16-6 name=__codelineno-16-6 href=#__codelineno-16-6></a><span class=s>&quot;gitee.com/k8s-platform/service&quot;</span>
<a id=__codelineno-16-7 name=__codelineno-16-7 href=#__codelineno-16-7></a>
<a id=__codelineno-16-8 name=__codelineno-16-8 href=#__codelineno-16-8></a><span class=s>&quot;github.com/gin-gonic/gin&quot;</span>
<a id=__codelineno-16-9 name=__codelineno-16-9 href=#__codelineno-16-9></a><span class=p>)</span>
<a id=__codelineno-16-10 name=__codelineno-16-10 href=#__codelineno-16-10></a>
<a id=__codelineno-16-11 name=__codelineno-16-11 href=#__codelineno-16-11></a><span class=kd>func</span><span class=w> </span><span class=nx>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-16-12 name=__codelineno-16-12 href=#__codelineno-16-12></a><span class=c1>//初始化gin对象</span>
<a id=__codelineno-16-13 name=__codelineno-16-13 href=#__codelineno-16-13></a><span class=nx>r</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>Default</span><span class=p>()</span>
<a id=__codelineno-16-14 name=__codelineno-16-14 href=#__codelineno-16-14></a><span class=c1>//初始化k8s client</span>
<a id=__codelineno-16-15 name=__codelineno-16-15 href=#__codelineno-16-15></a><span class=nx>service</span><span class=p>.</span><span class=nx>K8s</span><span class=p>.</span><span class=nx>Init</span><span class=p>()</span>
<a id=__codelineno-16-16 name=__codelineno-16-16 href=#__codelineno-16-16></a><span class=c1>//初始化路由规则</span>
<a id=__codelineno-16-17 name=__codelineno-16-17 href=#__codelineno-16-17></a><span class=nx>controller</span><span class=p>.</span><span class=nx>Router</span><span class=p>.</span><span class=nx>InitApiRouter</span><span class=p>(</span><span class=nx>r</span><span class=p>)</span>
<a id=__codelineno-16-18 name=__codelineno-16-18 href=#__codelineno-16-18></a><span class=c1>//gin程序启动</span>
<a id=__codelineno-16-19 name=__codelineno-16-19 href=#__codelineno-16-19></a><span class=nx>r</span><span class=p>.</span><span class=nx>Run</span><span class=p>(</span><span class=nx>config</span><span class=p>.</span><span class=nx>ListenAddr</span><span class=p>)</span>
<a id=__codelineno-16-20 name=__codelineno-16-20 href=#__codelineno-16-20></a><span class=p>}</span>
</code></pre></div> <h3 id=4-测试api接口>4. 测试API接口<a class=headerlink href=#4-测试api接口 title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a>curl<span class=w> </span>http://127.0.0.1:9090/testapi
<a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a><span class=o>{</span><span class=s2>&quot;data&quot;</span>:null,<span class=s2>&quot;msg&quot;</span>:<span class=s2>&quot;testapi success!&quot;</span><span class=o>}</span><span class=w>    </span>
</code></pre></div> <h2 id=7-api开发>7. API开发<a class=headerlink href=#7-api开发 title="Permanent link">&para;</a></h2> <h3 id=1-开发响应流程>1. 开发&amp;响应流程<a class=headerlink href=#1-开发响应流程 title="Permanent link">&para;</a></h3> <p><img alt=1700452058796 class=zoom src=https://cdn.jsdelivr.net/gh/hujianli94/Picgo-atlas@main/img/1700452058796.77vrr972us00.png></p> <ol> <li>Model层：实体层 &gt;&gt; 表数据与类的映射关系，这里的类是strcut </li> <li>Dao层：持久层/数据访问层 &gt;&gt; 主要与数据库交互，增删改查</li> <li>Service层：业务层 &gt;&gt; 控制业务逻辑，主要处理业务模块的功能逻辑</li> <li>Controller层：控制层 &gt;&gt; 接收请求参数，调用不同的Service层代码来控制业务流程</li> </ol> <p><img alt=1700458875460 class=zoom src=https://cdn.jsdelivr.net/gh/hujianli94/Picgo-atlas@main/img/1700458875460.3ok9s1egqvk0.webp></p> <h3 id=2-工作负载>2. 工作负载<a class=headerlink href=#2-工作负载 title="Permanent link">&para;</a></h3> <h4 id=21-数组的排序过滤分页>2.1 数组的排序、过滤、分页<a class=headerlink href=#21-数组的排序过滤分页 title="Permanent link">&para;</a></h4> <p><code>service/dataselector.go</code></p> <p>(1)定义数据结构</p> <div class=highlight><pre><span></span><code><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a><span class=kn>package</span><span class=w> </span><span class=nx>service</span>
<a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a>
<a id=__codelineno-18-3 name=__codelineno-18-3 href=#__codelineno-18-3></a><span class=kn>import</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-18-4 name=__codelineno-18-4 href=#__codelineno-18-4></a><span class=w>    </span><span class=nx>corev1</span><span class=w> </span><span class=s>&quot;k8s.io/api/core/v1&quot;</span>
<a id=__codelineno-18-5 name=__codelineno-18-5 href=#__codelineno-18-5></a><span class=w>    </span><span class=s>&quot;sort&quot;</span>
<a id=__codelineno-18-6 name=__codelineno-18-6 href=#__codelineno-18-6></a><span class=w>    </span><span class=s>&quot;strings&quot;</span>
<a id=__codelineno-18-7 name=__codelineno-18-7 href=#__codelineno-18-7></a><span class=w>    </span><span class=s>&quot;time&quot;</span>
<a id=__codelineno-18-8 name=__codelineno-18-8 href=#__codelineno-18-8></a><span class=p>)</span>
<a id=__codelineno-18-9 name=__codelineno-18-9 href=#__codelineno-18-9></a>
<a id=__codelineno-18-10 name=__codelineno-18-10 href=#__codelineno-18-10></a><span class=c1>// dataSelector 用于封装排序、过滤、分页的数据类型</span>
<a id=__codelineno-18-11 name=__codelineno-18-11 href=#__codelineno-18-11></a><span class=kd>type</span><span class=w> </span><span class=nx>dataSelector</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-18-12 name=__codelineno-18-12 href=#__codelineno-18-12></a><span class=w>    </span><span class=nx>GenericDataList</span><span class=w> </span><span class=p>[]</span><span class=nx>DataCell</span>
<a id=__codelineno-18-13 name=__codelineno-18-13 href=#__codelineno-18-13></a><span class=w>    </span><span class=nx>dataSelectQuery</span><span class=w> </span><span class=o>*</span><span class=nx>DataSelectQuery</span>
<a id=__codelineno-18-14 name=__codelineno-18-14 href=#__codelineno-18-14></a><span class=p>}</span>
<a id=__codelineno-18-15 name=__codelineno-18-15 href=#__codelineno-18-15></a>
<a id=__codelineno-18-16 name=__codelineno-18-16 href=#__codelineno-18-16></a><span class=c1>// DataCell 接口，用于各种资源list的类型转换，转换后可以使用dataSelector的自定义排序方法</span>
<a id=__codelineno-18-17 name=__codelineno-18-17 href=#__codelineno-18-17></a><span class=kd>type</span><span class=w> </span><span class=nx>DataCell</span><span class=w> </span><span class=kd>interface</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-18-18 name=__codelineno-18-18 href=#__codelineno-18-18></a><span class=w>    </span><span class=nx>GetCreation</span><span class=p>()</span><span class=w> </span><span class=nx>time</span><span class=p>.</span><span class=nx>Time</span>
<a id=__codelineno-18-19 name=__codelineno-18-19 href=#__codelineno-18-19></a><span class=w>    </span><span class=nx>GetName</span><span class=p>()</span><span class=w> </span><span class=kt>string</span>
<a id=__codelineno-18-20 name=__codelineno-18-20 href=#__codelineno-18-20></a><span class=p>}</span>
<a id=__codelineno-18-21 name=__codelineno-18-21 href=#__codelineno-18-21></a>
<a id=__codelineno-18-22 name=__codelineno-18-22 href=#__codelineno-18-22></a><span class=c1>// DataSelectQuery 定义过滤和分页的属性，过滤：Name，分页：Limit和Page</span>
<a id=__codelineno-18-23 name=__codelineno-18-23 href=#__codelineno-18-23></a><span class=c1>// Limit是单页的数据条数</span>
<a id=__codelineno-18-24 name=__codelineno-18-24 href=#__codelineno-18-24></a><span class=c1>// Page是第几页</span>
<a id=__codelineno-18-25 name=__codelineno-18-25 href=#__codelineno-18-25></a><span class=kd>type</span><span class=w> </span><span class=nx>DataSelectQuery</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-18-26 name=__codelineno-18-26 href=#__codelineno-18-26></a><span class=w>    </span><span class=nx>FilterQuery</span><span class=w>   </span><span class=o>*</span><span class=nx>FilterQuery</span>
<a id=__codelineno-18-27 name=__codelineno-18-27 href=#__codelineno-18-27></a><span class=w>    </span><span class=nx>PaginateQuery</span><span class=w> </span><span class=o>*</span><span class=nx>PaginateQuery</span>
<a id=__codelineno-18-28 name=__codelineno-18-28 href=#__codelineno-18-28></a><span class=p>}</span>
<a id=__codelineno-18-29 name=__codelineno-18-29 href=#__codelineno-18-29></a><span class=kd>type</span><span class=w> </span><span class=nx>FilterQuery</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-18-30 name=__codelineno-18-30 href=#__codelineno-18-30></a><span class=w>    </span><span class=nx>Name</span><span class=w> </span><span class=kt>string</span>
<a id=__codelineno-18-31 name=__codelineno-18-31 href=#__codelineno-18-31></a><span class=p>}</span>
<a id=__codelineno-18-32 name=__codelineno-18-32 href=#__codelineno-18-32></a><span class=kd>type</span><span class=w> </span><span class=nx>PaginateQuery</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-18-33 name=__codelineno-18-33 href=#__codelineno-18-33></a><span class=w>    </span><span class=nx>Limit</span><span class=w> </span><span class=kt>int</span>
<a id=__codelineno-18-34 name=__codelineno-18-34 href=#__codelineno-18-34></a><span class=w>    </span><span class=nx>Page</span><span class=w>  </span><span class=kt>int</span>
<a id=__codelineno-18-35 name=__codelineno-18-35 href=#__codelineno-18-35></a><span class=p>}</span>
</code></pre></div> <p>(2)排序</p> <p>自定义类型排序参考文档：<a href=https://segmentfault.com/a/1190000008062661>https://segmentfault.com/a/1190000008062661</a></p> <div class=highlight><pre><span></span><code><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a><span class=c1>//实现自定义结构的排序，需要重写Len、Swap、Less方法</span>
<a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a><span class=c1>//Len方法用于获取数组长度</span>
<a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a><span class=kd>func</span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>dataSelector</span><span class=p>)</span><span class=nx>Len</span><span class=p>()</span><span class=kt>int</span><span class=p>{</span>
<a id=__codelineno-19-4 name=__codelineno-19-4 href=#__codelineno-19-4></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>d</span><span class=p>.</span><span class=nx>GenericDataList</span><span class=p>)</span>
<a id=__codelineno-19-5 name=__codelineno-19-5 href=#__codelineno-19-5></a><span class=p>}</span>
<a id=__codelineno-19-6 name=__codelineno-19-6 href=#__codelineno-19-6></a><span class=c1>//Swap方法用于数组中的元素在比较大小后的位置交换，可定义升序或降序</span>
<a id=__codelineno-19-7 name=__codelineno-19-7 href=#__codelineno-19-7></a><span class=kd>func</span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>dataSelector</span><span class=p>)</span><span class=nx>Swap</span><span class=p>(</span><span class=nx>i</span><span class=p>,</span><span class=nx>j</span><span class=w> </span><span class=kt>int</span><span class=p>){</span>
<a id=__codelineno-19-8 name=__codelineno-19-8 href=#__codelineno-19-8></a><span class=w>    </span><span class=nx>d</span><span class=p>.</span><span class=nx>GenericDataList</span><span class=p>[</span><span class=nx>i</span><span class=p>],</span><span class=nx>d</span><span class=p>.</span><span class=nx>GenericDataList</span><span class=p>[</span><span class=nx>j</span><span class=p>]=</span><span class=nx>d</span><span class=p>.</span><span class=nx>GenericDataList</span><span class=p>[</span><span class=nx>j</span><span class=p>],</span><span class=nx>d</span><span class=p>.</span><span class=nx>GenericDataList</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span>
<a id=__codelineno-19-9 name=__codelineno-19-9 href=#__codelineno-19-9></a><span class=p>}</span>
<a id=__codelineno-19-10 name=__codelineno-19-10 href=#__codelineno-19-10></a><span class=c1>//Less方法用于定义数组中元素排序的“大小”的比较方式</span>
<a id=__codelineno-19-11 name=__codelineno-19-11 href=#__codelineno-19-11></a><span class=kd>func</span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>dataSelector</span><span class=p>)</span><span class=nx>Less</span><span class=p>(</span><span class=nx>i</span><span class=p>,</span><span class=nx>j</span><span class=w> </span><span class=kt>int</span><span class=p>)</span><span class=kt>bool</span><span class=p>{</span>
<a id=__codelineno-19-12 name=__codelineno-19-12 href=#__codelineno-19-12></a><span class=w>    </span><span class=nx>a</span><span class=o>:=</span><span class=nx>d</span><span class=p>.</span><span class=nx>GenericDataList</span><span class=p>[</span><span class=nx>i</span><span class=p>].</span><span class=nx>GetCreation</span><span class=p>()</span>
<a id=__codelineno-19-13 name=__codelineno-19-13 href=#__codelineno-19-13></a><span class=w>    </span><span class=nx>b</span><span class=o>:=</span><span class=nx>d</span><span class=p>.</span><span class=nx>GenericDataList</span><span class=p>[</span><span class=nx>j</span><span class=p>].</span><span class=nx>GetCreation</span><span class=p>()</span>
<a id=__codelineno-19-14 name=__codelineno-19-14 href=#__codelineno-19-14></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>b</span><span class=p>.</span><span class=nx>Before</span><span class=p>(</span><span class=nx>a</span><span class=p>)</span>
<a id=__codelineno-19-15 name=__codelineno-19-15 href=#__codelineno-19-15></a><span class=p>}</span>
<a id=__codelineno-19-16 name=__codelineno-19-16 href=#__codelineno-19-16></a><span class=c1>//重写以上3个方法使用sort.Sort进行排序</span>
<a id=__codelineno-19-17 name=__codelineno-19-17 href=#__codelineno-19-17></a><span class=kd>func</span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>dataSelector</span><span class=p>)</span><span class=nx>Sort</span><span class=p>()</span><span class=w> </span><span class=o>*</span><span class=nx>dataSelector</span><span class=p>{</span>
<a id=__codelineno-19-18 name=__codelineno-19-18 href=#__codelineno-19-18></a><span class=w>    </span><span class=nx>sort</span><span class=p>.</span><span class=nx>Sort</span><span class=p>(</span><span class=nx>d</span><span class=p>)</span>
<a id=__codelineno-19-19 name=__codelineno-19-19 href=#__codelineno-19-19></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>d</span>
<a id=__codelineno-19-20 name=__codelineno-19-20 href=#__codelineno-19-20></a><span class=p>}</span>
</code></pre></div> <p>(3)过滤</p> <div class=highlight><pre><span></span><code><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a><span class=c1>//Filter方法用于过滤元素，比较元素的Name属性，若包含，再返回</span>
<a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>dataSelector</span><span class=p>)</span><span class=w> </span><span class=nx>Filter</span><span class=p>()</span><span class=w> </span><span class=o>*</span><span class=nx>dataSelector</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-20-3 name=__codelineno-20-3 href=#__codelineno-20-3></a><span class=w>    </span><span class=c1>//若Name的传参为空，则返回所有元素</span>
<a id=__codelineno-20-4 name=__codelineno-20-4 href=#__codelineno-20-4></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>d</span><span class=p>.</span><span class=nx>dataSelectQuery</span><span class=p>.</span><span class=nx>FilterQuery</span><span class=p>.</span><span class=nx>Name</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&quot;&quot;</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-20-5 name=__codelineno-20-5 href=#__codelineno-20-5></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>d</span>
<a id=__codelineno-20-6 name=__codelineno-20-6 href=#__codelineno-20-6></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-20-7 name=__codelineno-20-7 href=#__codelineno-20-7></a><span class=w>    </span><span class=c1>//若Name的传参不为空，则返回元素名中包含Name的所有元素</span>
<a id=__codelineno-20-8 name=__codelineno-20-8 href=#__codelineno-20-8></a><span class=w>    </span><span class=nx>filteredList</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=p>[]</span><span class=nx>DataCell</span><span class=p>{}</span>
<a id=__codelineno-20-9 name=__codelineno-20-9 href=#__codelineno-20-9></a><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>value</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>d</span><span class=p>.</span><span class=nx>GenericDataList</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-20-10 name=__codelineno-20-10 href=#__codelineno-20-10></a><span class=w>        </span><span class=nx>matches</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kc>true</span>
<a id=__codelineno-20-11 name=__codelineno-20-11 href=#__codelineno-20-11></a><span class=w>        </span><span class=nx>objName</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>value</span><span class=p>.</span><span class=nx>GetName</span><span class=p>()</span>
<a id=__codelineno-20-12 name=__codelineno-20-12 href=#__codelineno-20-12></a><span class=w>        </span><span class=c1>//判断字符串s中是否包含子串str</span>
<a id=__codelineno-20-13 name=__codelineno-20-13 href=#__codelineno-20-13></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>!</span><span class=nx>strings</span><span class=p>.</span><span class=nx>Contains</span><span class=p>(</span><span class=nx>objName</span><span class=p>,</span><span class=w> </span><span class=nx>d</span><span class=p>.</span><span class=nx>dataSelectQuery</span><span class=p>.</span><span class=nx>FilterQuery</span><span class=p>.</span><span class=nx>Name</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-20-14 name=__codelineno-20-14 href=#__codelineno-20-14></a><span class=w>            </span><span class=nx>matches</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=kc>false</span>
<a id=__codelineno-20-15 name=__codelineno-20-15 href=#__codelineno-20-15></a><span class=w>            </span><span class=k>continue</span>
<a id=__codelineno-20-16 name=__codelineno-20-16 href=#__codelineno-20-16></a><span class=w>        </span><span class=p>}</span>
<a id=__codelineno-20-17 name=__codelineno-20-17 href=#__codelineno-20-17></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=nx>matches</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-20-18 name=__codelineno-20-18 href=#__codelineno-20-18></a><span class=w>            </span><span class=nx>filteredList</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nb>append</span><span class=p>(</span><span class=nx>filteredList</span><span class=p>,</span><span class=w> </span><span class=nx>value</span><span class=p>)</span>
<a id=__codelineno-20-19 name=__codelineno-20-19 href=#__codelineno-20-19></a><span class=w>        </span><span class=p>}</span>
<a id=__codelineno-20-20 name=__codelineno-20-20 href=#__codelineno-20-20></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-20-21 name=__codelineno-20-21 href=#__codelineno-20-21></a><span class=w>    </span><span class=nx>d</span><span class=p>.</span><span class=nx>GenericDataList</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>filteredList</span>
<a id=__codelineno-20-22 name=__codelineno-20-22 href=#__codelineno-20-22></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>d</span>
<a id=__codelineno-20-23 name=__codelineno-20-23 href=#__codelineno-20-23></a><span class=p>}</span>
</code></pre></div> <p>(4)分页</p> <div class=highlight><pre><span></span><code><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a><span class=c1>//Paginate方法用于数组分页，根据Limit和Page的传参，返回数据</span>
<a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>dataSelector</span><span class=p>)</span><span class=w> </span><span class=nx>Paginate</span><span class=p>()</span><span class=w> </span><span class=o>*</span><span class=nx>dataSelector</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-21-3 name=__codelineno-21-3 href=#__codelineno-21-3></a><span class=w>    </span><span class=nx>limit</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>d</span><span class=p>.</span><span class=nx>dataSelectQuery</span><span class=p>.</span><span class=nx>PaginateQuery</span><span class=p>.</span><span class=nx>Limit</span>
<a id=__codelineno-21-4 name=__codelineno-21-4 href=#__codelineno-21-4></a><span class=w>    </span><span class=nx>page</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>d</span><span class=p>.</span><span class=nx>dataSelectQuery</span><span class=p>.</span><span class=nx>PaginateQuery</span><span class=p>.</span><span class=nx>Page</span>
<a id=__codelineno-21-5 name=__codelineno-21-5 href=#__codelineno-21-5></a><span class=w>    </span><span class=c1>//验证参数合法，若参数不合法，则返回所有数据</span>
<a id=__codelineno-21-6 name=__codelineno-21-6 href=#__codelineno-21-6></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>limit</span><span class=w> </span><span class=o>&lt;=</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=nx>page</span><span class=w> </span><span class=o>&lt;=</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-21-7 name=__codelineno-21-7 href=#__codelineno-21-7></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>d</span>
<a id=__codelineno-21-8 name=__codelineno-21-8 href=#__codelineno-21-8></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-21-9 name=__codelineno-21-9 href=#__codelineno-21-9></a><span class=w>    </span><span class=c1>//定义取数范围</span>
<a id=__codelineno-21-10 name=__codelineno-21-10 href=#__codelineno-21-10></a><span class=w>    </span><span class=c1>//举例：25个元素的数组，limit是10，page是3，startIndex是20，endIndex是30（实际上endIndex是25）</span>
<a id=__codelineno-21-11 name=__codelineno-21-11 href=#__codelineno-21-11></a><span class=w>    </span><span class=nx>startIndex</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>limit</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=p>(</span><span class=nx>page</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mi>1</span><span class=p>)</span>
<a id=__codelineno-21-12 name=__codelineno-21-12 href=#__codelineno-21-12></a><span class=w>    </span><span class=nx>endIndex</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>limit</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=nx>page</span>
<a id=__codelineno-21-13 name=__codelineno-21-13 href=#__codelineno-21-13></a><span class=w>    </span><span class=c1>//处理最后一页，这时候就把endIndex由30改为25了</span>
<a id=__codelineno-21-14 name=__codelineno-21-14 href=#__codelineno-21-14></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>d</span><span class=p>.</span><span class=nx>GenericDataList</span><span class=p>)</span><span class=w> </span><span class=p>&lt;</span><span class=w> </span><span class=nx>endIndex</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-21-15 name=__codelineno-21-15 href=#__codelineno-21-15></a><span class=w>        </span><span class=nx>endIndex</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>d</span><span class=p>.</span><span class=nx>GenericDataList</span><span class=p>)</span>
<a id=__codelineno-21-16 name=__codelineno-21-16 href=#__codelineno-21-16></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-21-17 name=__codelineno-21-17 href=#__codelineno-21-17></a><span class=w>    </span><span class=nx>d</span><span class=p>.</span><span class=nx>GenericDataList</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>d</span><span class=p>.</span><span class=nx>GenericDataList</span><span class=p>[</span><span class=nx>startIndex</span><span class=p>:</span><span class=nx>endIndex</span><span class=p>]</span>
<a id=__codelineno-21-18 name=__codelineno-21-18 href=#__codelineno-21-18></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>d</span>
<a id=__codelineno-21-19 name=__codelineno-21-19 href=#__codelineno-21-19></a><span class=p>}</span>
</code></pre></div> <p>(5)定义podCell类型，实现DataCell接口，用于类型转换</p> <div class=highlight><pre><span></span><code><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a><span class=c1>//定义podCell类型，实现GetCreation和getName方法后，可进行类型转换</span>
<a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a><span class=kd>type</span><span class=w> </span><span class=nx>podCell</span><span class=w> </span><span class=nx>corev1</span><span class=p>.</span><span class=nx>Pod</span>
<a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a>
<a id=__codelineno-22-4 name=__codelineno-22-4 href=#__codelineno-22-4></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=nx>podCell</span><span class=p>)</span><span class=w> </span><span class=nx>GetCreation</span><span class=p>()</span><span class=w> </span><span class=nx>time</span><span class=p>.</span><span class=nx>Time</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-22-5 name=__codelineno-22-5 href=#__codelineno-22-5></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>p</span><span class=p>.</span><span class=nx>CreationTimestamp</span><span class=p>.</span><span class=nx>Time</span>
<a id=__codelineno-22-6 name=__codelineno-22-6 href=#__codelineno-22-6></a><span class=p>}</span>
<a id=__codelineno-22-7 name=__codelineno-22-7 href=#__codelineno-22-7></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=nx>podCell</span><span class=p>)</span><span class=w> </span><span class=nx>GetName</span><span class=p>()</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-22-8 name=__codelineno-22-8 href=#__codelineno-22-8></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>p</span><span class=p>.</span><span class=nx>Name</span>
<a id=__codelineno-22-9 name=__codelineno-22-9 href=#__codelineno-22-9></a><span class=p>}</span>
</code></pre></div> <p>(6)定义DataCell到Pod类型转换的方法</p> <p>断言：判断一个变量是否属于某一种类型，前提是这一类型实现了这一变量类型接口</p> <p><code>service/pod.go</code></p> <div class=highlight><pre><span></span><code><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a><span class=kn>package</span><span class=w> </span><span class=nx>service</span>
<a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a>
<a id=__codelineno-23-3 name=__codelineno-23-3 href=#__codelineno-23-3></a><span class=kn>import</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-23-4 name=__codelineno-23-4 href=#__codelineno-23-4></a><span class=w>    </span><span class=s>&quot;bytes&quot;</span>
<a id=__codelineno-23-5 name=__codelineno-23-5 href=#__codelineno-23-5></a><span class=w>    </span><span class=s>&quot;context&quot;</span>
<a id=__codelineno-23-6 name=__codelineno-23-6 href=#__codelineno-23-6></a><span class=w>    </span><span class=s>&quot;encoding/json&quot;</span>
<a id=__codelineno-23-7 name=__codelineno-23-7 href=#__codelineno-23-7></a><span class=w>    </span><span class=s>&quot;errors&quot;</span>
<a id=__codelineno-23-8 name=__codelineno-23-8 href=#__codelineno-23-8></a><span class=w>    </span><span class=s>&quot;gitee.com/k8s-platform/config&quot;</span>
<a id=__codelineno-23-9 name=__codelineno-23-9 href=#__codelineno-23-9></a><span class=w>    </span><span class=s>&quot;github.com/wonderivan/logger&quot;</span>
<a id=__codelineno-23-10 name=__codelineno-23-10 href=#__codelineno-23-10></a><span class=w>    </span><span class=s>&quot;io&quot;</span>
<a id=__codelineno-23-11 name=__codelineno-23-11 href=#__codelineno-23-11></a><span class=w>    </span><span class=nx>corev1</span><span class=w> </span><span class=s>&quot;k8s.io/api/core/v1&quot;</span>
<a id=__codelineno-23-12 name=__codelineno-23-12 href=#__codelineno-23-12></a><span class=w>    </span><span class=nx>metav1</span><span class=w> </span><span class=s>&quot;k8s.io/apimachinery/pkg/apis/meta/v1&quot;</span>
<a id=__codelineno-23-13 name=__codelineno-23-13 href=#__codelineno-23-13></a><span class=p>)</span>
<a id=__codelineno-23-14 name=__codelineno-23-14 href=#__codelineno-23-14></a>
<a id=__codelineno-23-15 name=__codelineno-23-15 href=#__codelineno-23-15></a><span class=c1>// Pod 定义pod类型和Pod对象，用于包外的调用(包是指service目录)，例如Controller</span>
<a id=__codelineno-23-16 name=__codelineno-23-16 href=#__codelineno-23-16></a><span class=kd>var</span><span class=w> </span><span class=nx>Pod</span><span class=w> </span><span class=nx>pod</span>
<a id=__codelineno-23-17 name=__codelineno-23-17 href=#__codelineno-23-17></a>
<a id=__codelineno-23-18 name=__codelineno-23-18 href=#__codelineno-23-18></a><span class=kd>type</span><span class=w> </span><span class=nx>pod</span><span class=w> </span><span class=kd>struct</span><span class=p>{}</span>
<a id=__codelineno-23-19 name=__codelineno-23-19 href=#__codelineno-23-19></a>
<a id=__codelineno-23-20 name=__codelineno-23-20 href=#__codelineno-23-20></a><span class=c1>// toCells方法用于将pod类型数组，转换成DataCell类型数组</span>
<a id=__codelineno-23-21 name=__codelineno-23-21 href=#__codelineno-23-21></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=o>*</span><span class=nx>pod</span><span class=p>)</span><span class=w> </span><span class=nx>toCells</span><span class=p>(</span><span class=nx>std</span><span class=w> </span><span class=p>[]</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>Pod</span><span class=p>)</span><span class=w> </span><span class=p>[]</span><span class=nx>DataCell</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-23-22 name=__codelineno-23-22 href=#__codelineno-23-22></a><span class=w>    </span><span class=nx>cells</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>make</span><span class=p>([]</span><span class=nx>DataCell</span><span class=p>,</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>std</span><span class=p>))</span>
<a id=__codelineno-23-23 name=__codelineno-23-23 href=#__codelineno-23-23></a><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=nx>i</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>std</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-23-24 name=__codelineno-23-24 href=#__codelineno-23-24></a><span class=w>        </span><span class=nx>cells</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>podCell</span><span class=p>(</span><span class=nx>std</span><span class=p>[</span><span class=nx>i</span><span class=p>])</span>
<a id=__codelineno-23-25 name=__codelineno-23-25 href=#__codelineno-23-25></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-23-26 name=__codelineno-23-26 href=#__codelineno-23-26></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>cells</span>
<a id=__codelineno-23-27 name=__codelineno-23-27 href=#__codelineno-23-27></a><span class=p>}</span>
<a id=__codelineno-23-28 name=__codelineno-23-28 href=#__codelineno-23-28></a>
<a id=__codelineno-23-29 name=__codelineno-23-29 href=#__codelineno-23-29></a><span class=c1>// fromCells方法用于将DataCell类型数组，转换成pod类型数组</span>
<a id=__codelineno-23-30 name=__codelineno-23-30 href=#__codelineno-23-30></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=o>*</span><span class=nx>pod</span><span class=p>)</span><span class=w> </span><span class=nx>fromCells</span><span class=p>(</span><span class=nx>cells</span><span class=w> </span><span class=p>[]</span><span class=nx>DataCell</span><span class=p>)</span><span class=w> </span><span class=p>[]</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>Pod</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-23-31 name=__codelineno-23-31 href=#__codelineno-23-31></a><span class=w>    </span><span class=nx>pods</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>make</span><span class=p>([]</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>Pod</span><span class=p>,</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>cells</span><span class=p>))</span>
<a id=__codelineno-23-32 name=__codelineno-23-32 href=#__codelineno-23-32></a><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=nx>i</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>cells</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-23-33 name=__codelineno-23-33 href=#__codelineno-23-33></a><span class=w>        </span><span class=c1>//cells[i].(podCell)就使用到了断言，断言后转换成了podCell类型，然后又转换成了Pod类型</span>
<a id=__codelineno-23-34 name=__codelineno-23-34 href=#__codelineno-23-34></a><span class=w>        </span><span class=nx>pods</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>corev1</span><span class=p>.</span><span class=nx>Pod</span><span class=p>(</span><span class=nx>cells</span><span class=p>[</span><span class=nx>i</span><span class=p>].(</span><span class=nx>podCell</span><span class=p>))</span>
<a id=__codelineno-23-35 name=__codelineno-23-35 href=#__codelineno-23-35></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-23-36 name=__codelineno-23-36 href=#__codelineno-23-36></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>pods</span>
<a id=__codelineno-23-37 name=__codelineno-23-37 href=#__codelineno-23-37></a><span class=p>}</span>
</code></pre></div> <h4 id=22-pod>2.2 Pod<a class=headerlink href=#22-pod title="Permanent link">&para;</a></h4> <p>开发 pod 功能</p> <table> <thead> <tr> <th>功能</th> <th>是否实现</th> </tr> </thead> <tbody> <tr> <td>获取所有pod信息</td> <td>√</td> </tr> <tr> <td>获取pod的详细信息</td> <td>√</td> </tr> <tr> <td>删除pod</td> <td>√</td> </tr> <tr> <td>更新pod</td> <td>√</td> </tr> <tr> <td>获取pod容器名称</td> <td>√</td> </tr> <tr> <td>获取pod中容器日志</td> <td>√</td> </tr> <tr> <td>获取每个namespace的pod数量</td> <td>√</td> </tr> </tbody> </table> <h5 id=servicepodgo>service/pod.go<a class=headerlink href=#servicepodgo title="Permanent link">&para;</a></h5> <p>(1)定义数据类型</p> <p>看情况创建结构体</p> <div class=highlight><pre><span></span><code><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a><span class=c1>//定义列表的返回内容，Item是pod元素列表，Total为pod元素数量</span>
<a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a><span class=kd>type</span><span class=w> </span><span class=nx>PodsResp</span><span class=w> </span><span class=kd>struct</span><span class=p>{</span>
<a id=__codelineno-24-3 name=__codelineno-24-3 href=#__codelineno-24-3></a><span class=w>    </span><span class=nx>Items</span><span class=w> </span><span class=p>[]</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>Pod</span><span class=w> </span><span class=s>`json:&quot;items&quot;`</span>
<a id=__codelineno-24-4 name=__codelineno-24-4 href=#__codelineno-24-4></a><span class=w>    </span><span class=nx>Total</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=s>`json:&quot;total&quot;`</span>
<a id=__codelineno-24-5 name=__codelineno-24-5 href=#__codelineno-24-5></a><span class=p>}</span>
<a id=__codelineno-24-6 name=__codelineno-24-6 href=#__codelineno-24-6></a><span class=c1>//定义PodsNp类型，用于返回namespace中pod的数量</span>
<a id=__codelineno-24-7 name=__codelineno-24-7 href=#__codelineno-24-7></a><span class=kd>type</span><span class=w> </span><span class=nx>PodsNp</span><span class=w> </span><span class=kd>struct</span><span class=p>{</span>
<a id=__codelineno-24-8 name=__codelineno-24-8 href=#__codelineno-24-8></a><span class=w>    </span><span class=nx>Namespace</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;namespace&quot;`</span>
<a id=__codelineno-24-9 name=__codelineno-24-9 href=#__codelineno-24-9></a><span class=w>    </span><span class=nx>PodNum</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=s>`json:&quot;pod_num&quot;`</span>
<a id=__codelineno-24-10 name=__codelineno-24-10 href=#__codelineno-24-10></a><span class=p>}</span>
</code></pre></div> <p>(2)获取pod列表</p> <div class=highlight><pre><span></span><code><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a><span class=c1>// GetPods 获取pod列表，支持过滤、排序、分页</span>
<a id=__codelineno-25-2 name=__codelineno-25-2 href=#__codelineno-25-2></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=o>*</span><span class=nx>pod</span><span class=p>)</span><span class=w> </span><span class=nx>GetPods</span><span class=p>(</span><span class=nx>filterName</span><span class=p>,</span><span class=w> </span><span class=nx>namespace</span><span class=w> </span><span class=kt>string</span><span class=p>,</span><span class=w> </span><span class=nx>limit</span><span class=p>,</span><span class=w> </span><span class=nx>page</span><span class=w> </span><span class=kt>int</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>podsResp</span><span class=w> </span><span class=o>*</span><span class=nx>PodsResp</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-25-3 name=__codelineno-25-3 href=#__codelineno-25-3></a><span class=w>    </span><span class=c1>//获取podList类型的pod列表</span>
<a id=__codelineno-25-4 name=__codelineno-25-4 href=#__codelineno-25-4></a><span class=w>    </span><span class=c1>//context.TODO() 用于声明一个空的context上下文，用于List方法内设置这个请求的超时(3)，这里的常用用法</span>
<a id=__codelineno-25-5 name=__codelineno-25-5 href=#__codelineno-25-5></a><span class=w>    </span><span class=c1>//metav1.ListOptions{}用于过滤List数据，如使用label，field等</span>
<a id=__codelineno-25-6 name=__codelineno-25-6 href=#__codelineno-25-6></a><span class=w>    </span><span class=c1>//kubectl get services --all-namespace --field-seletor metadata.namespace != default</span>
<a id=__codelineno-25-7 name=__codelineno-25-7 href=#__codelineno-25-7></a><span class=w>    </span><span class=nx>podList</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>CoreV1</span><span class=p>().</span><span class=nx>Pods</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span><span class=nx>List</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span>
<a id=__codelineno-25-8 name=__codelineno-25-8 href=#__codelineno-25-8></a><span class=w>        </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>ListOptions</span><span class=p>{})</span>
<a id=__codelineno-25-9 name=__codelineno-25-9 href=#__codelineno-25-9></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-25-10 name=__codelineno-25-10 href=#__codelineno-25-10></a><span class=w>        </span><span class=c1>//logger用于打印日志</span>
<a id=__codelineno-25-11 name=__codelineno-25-11 href=#__codelineno-25-11></a><span class=w>        </span><span class=c1>//return用于返回response内容</span>
<a id=__codelineno-25-12 name=__codelineno-25-12 href=#__codelineno-25-12></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取Pod列表失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-25-13 name=__codelineno-25-13 href=#__codelineno-25-13></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取Pod列表失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-25-14 name=__codelineno-25-14 href=#__codelineno-25-14></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-25-15 name=__codelineno-25-15 href=#__codelineno-25-15></a><span class=w>    </span><span class=c1>//实例化dataSelector对象</span>
<a id=__codelineno-25-16 name=__codelineno-25-16 href=#__codelineno-25-16></a><span class=w>    </span><span class=nx>selectableData</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>dataSelector</span><span class=p>{</span>
<a id=__codelineno-25-17 name=__codelineno-25-17 href=#__codelineno-25-17></a><span class=w>        </span><span class=nx>GenericDataList</span><span class=p>:</span><span class=w> </span><span class=nx>p</span><span class=p>.</span><span class=nx>toCells</span><span class=p>(</span><span class=nx>podList</span><span class=p>.</span><span class=nx>Items</span><span class=p>),</span>
<a id=__codelineno-25-18 name=__codelineno-25-18 href=#__codelineno-25-18></a><span class=w>        </span><span class=nx>dataSelectQuery</span><span class=p>:</span><span class=w> </span><span class=o>&amp;</span><span class=nx>DataSelectQuery</span><span class=p>{</span>
<a id=__codelineno-25-19 name=__codelineno-25-19 href=#__codelineno-25-19></a><span class=w>            </span><span class=nx>FilterQuery</span><span class=p>:</span><span class=w> </span><span class=o>&amp;</span><span class=nx>FilterQuery</span><span class=p>{</span><span class=nx>Name</span><span class=p>:</span><span class=w> </span><span class=nx>filterName</span><span class=p>},</span>
<a id=__codelineno-25-20 name=__codelineno-25-20 href=#__codelineno-25-20></a><span class=w>            </span><span class=nx>PaginateQuery</span><span class=p>:</span><span class=w> </span><span class=o>&amp;</span><span class=nx>PaginateQuery</span><span class=p>{</span>
<a id=__codelineno-25-21 name=__codelineno-25-21 href=#__codelineno-25-21></a><span class=w>                </span><span class=nx>Limit</span><span class=p>:</span><span class=w> </span><span class=nx>limit</span><span class=p>,</span>
<a id=__codelineno-25-22 name=__codelineno-25-22 href=#__codelineno-25-22></a><span class=w>                </span><span class=nx>Page</span><span class=p>:</span><span class=w>  </span><span class=nx>page</span><span class=p>,</span>
<a id=__codelineno-25-23 name=__codelineno-25-23 href=#__codelineno-25-23></a><span class=w>            </span><span class=p>},</span>
<a id=__codelineno-25-24 name=__codelineno-25-24 href=#__codelineno-25-24></a><span class=w>        </span><span class=p>},</span>
<a id=__codelineno-25-25 name=__codelineno-25-25 href=#__codelineno-25-25></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-25-26 name=__codelineno-25-26 href=#__codelineno-25-26></a><span class=w>    </span><span class=c1>//先过滤</span>
<a id=__codelineno-25-27 name=__codelineno-25-27 href=#__codelineno-25-27></a><span class=w>    </span><span class=nx>filtered</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>selectableData</span><span class=p>.</span><span class=nx>Filter</span><span class=p>()</span>
<a id=__codelineno-25-28 name=__codelineno-25-28 href=#__codelineno-25-28></a><span class=w>    </span><span class=nx>total</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>filtered</span><span class=p>.</span><span class=nx>GenericDataList</span><span class=p>)</span>
<a id=__codelineno-25-29 name=__codelineno-25-29 href=#__codelineno-25-29></a><span class=w>    </span><span class=c1>//再排序和分页</span>
<a id=__codelineno-25-30 name=__codelineno-25-30 href=#__codelineno-25-30></a><span class=w>    </span><span class=nx>data</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>filtered</span><span class=p>.</span><span class=nx>Sort</span><span class=p>().</span><span class=nx>Paginate</span><span class=p>()</span>
<a id=__codelineno-25-31 name=__codelineno-25-31 href=#__codelineno-25-31></a><span class=w>    </span><span class=c1>//将[]DataCell类型的pod列表转为v1.pod列表</span>
<a id=__codelineno-25-32 name=__codelineno-25-32 href=#__codelineno-25-32></a><span class=w>    </span><span class=nx>pods</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>p</span><span class=p>.</span><span class=nx>fromCells</span><span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>GenericDataList</span><span class=p>)</span>
<a id=__codelineno-25-33 name=__codelineno-25-33 href=#__codelineno-25-33></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=o>&amp;</span><span class=nx>PodsResp</span><span class=p>{</span>
<a id=__codelineno-25-34 name=__codelineno-25-34 href=#__codelineno-25-34></a><span class=w>        </span><span class=nx>Items</span><span class=p>:</span><span class=w> </span><span class=nx>pods</span><span class=p>,</span>
<a id=__codelineno-25-35 name=__codelineno-25-35 href=#__codelineno-25-35></a><span class=w>        </span><span class=nx>Total</span><span class=p>:</span><span class=w> </span><span class=nx>total</span><span class=p>,</span>
<a id=__codelineno-25-36 name=__codelineno-25-36 href=#__codelineno-25-36></a><span class=w>    </span><span class=p>},</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-25-37 name=__codelineno-25-37 href=#__codelineno-25-37></a><span class=p>}</span>
</code></pre></div> <p>(3)获取Pod详情</p> <div class=highlight><pre><span></span><code><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a><span class=c1>// GetPodDetail 获取pod详情</span>
<a id=__codelineno-26-2 name=__codelineno-26-2 href=#__codelineno-26-2></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=o>*</span><span class=nx>pod</span><span class=p>)</span><span class=w> </span><span class=nx>GetPodDetail</span><span class=p>(</span><span class=nx>podName</span><span class=p>,</span><span class=w> </span><span class=nx>namespace</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>pod</span><span class=w> </span><span class=o>*</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>Pod</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-26-3 name=__codelineno-26-3 href=#__codelineno-26-3></a><span class=w>    </span><span class=nx>pod</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>CoreV1</span><span class=p>().</span><span class=nx>Pods</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span>
<a id=__codelineno-26-4 name=__codelineno-26-4 href=#__codelineno-26-4></a><span class=w>        </span><span class=nx>Get</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>podName</span><span class=p>,</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>GetOptions</span><span class=p>{})</span>
<a id=__codelineno-26-5 name=__codelineno-26-5 href=#__codelineno-26-5></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-26-6 name=__codelineno-26-6 href=#__codelineno-26-6></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取Pod详情失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-26-7 name=__codelineno-26-7 href=#__codelineno-26-7></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取Pod详情失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-26-8 name=__codelineno-26-8 href=#__codelineno-26-8></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-26-9 name=__codelineno-26-9 href=#__codelineno-26-9></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>pod</span><span class=p>,</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-26-10 name=__codelineno-26-10 href=#__codelineno-26-10></a><span class=p>}</span>
</code></pre></div> <p>(4)删除Pod</p> <div class=highlight><pre><span></span><code><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a><span class=c1>// DeletePod 删除pod</span>
<a id=__codelineno-27-2 name=__codelineno-27-2 href=#__codelineno-27-2></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=o>*</span><span class=nx>pod</span><span class=p>)</span><span class=w> </span><span class=nx>DeletePod</span><span class=p>(</span><span class=nx>podName</span><span class=p>,</span><span class=w> </span><span class=nx>namespace</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-27-3 name=__codelineno-27-3 href=#__codelineno-27-3></a><span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>CoreV1</span><span class=p>().</span><span class=nx>Pods</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span>
<a id=__codelineno-27-4 name=__codelineno-27-4 href=#__codelineno-27-4></a><span class=w>        </span><span class=nx>Delete</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>podName</span><span class=p>,</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>DeleteOptions</span><span class=p>{})</span>
<a id=__codelineno-27-5 name=__codelineno-27-5 href=#__codelineno-27-5></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-27-6 name=__codelineno-27-6 href=#__codelineno-27-6></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;删除pod失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-27-7 name=__codelineno-27-7 href=#__codelineno-27-7></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;删除pod失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-27-8 name=__codelineno-27-8 href=#__codelineno-27-8></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-27-9 name=__codelineno-27-9 href=#__codelineno-27-9></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-27-10 name=__codelineno-27-10 href=#__codelineno-27-10></a><span class=p>}</span>
</code></pre></div> <p>(5)更新pod</p> <div class=highlight><pre><span></span><code><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a><span class=c1>// UpdatePod 更新pod</span>
<a id=__codelineno-28-2 name=__codelineno-28-2 href=#__codelineno-28-2></a><span class=c1>// content参数是请求中传入的pod对象的json数据</span>
<a id=__codelineno-28-3 name=__codelineno-28-3 href=#__codelineno-28-3></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=o>*</span><span class=nx>pod</span><span class=p>)</span><span class=w> </span><span class=nx>UpdatePod</span><span class=p>(</span><span class=nx>namespace</span><span class=p>,</span><span class=w> </span><span class=nx>content</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-28-4 name=__codelineno-28-4 href=#__codelineno-28-4></a><span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=nx>pod</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>Pod</span><span class=p>{}</span>
<a id=__codelineno-28-5 name=__codelineno-28-5 href=#__codelineno-28-5></a><span class=w>    </span><span class=c1>//反序列化为pod对象</span>
<a id=__codelineno-28-6 name=__codelineno-28-6 href=#__codelineno-28-6></a><span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>json</span><span class=p>.</span><span class=nx>Unmarshal</span><span class=p>([]</span><span class=nb>byte</span><span class=p>(</span><span class=nx>content</span><span class=p>),</span><span class=w> </span><span class=nx>pod</span><span class=p>)</span>
<a id=__codelineno-28-7 name=__codelineno-28-7 href=#__codelineno-28-7></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-28-8 name=__codelineno-28-8 href=#__codelineno-28-8></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;反序列化失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-28-9 name=__codelineno-28-9 href=#__codelineno-28-9></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;反序列化失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-28-10 name=__codelineno-28-10 href=#__codelineno-28-10></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-28-11 name=__codelineno-28-11 href=#__codelineno-28-11></a><span class=w>    </span><span class=c1>//更新pod</span>
<a id=__codelineno-28-12 name=__codelineno-28-12 href=#__codelineno-28-12></a><span class=w>    </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>CoreV1</span><span class=p>().</span><span class=nx>Pods</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span>
<a id=__codelineno-28-13 name=__codelineno-28-13 href=#__codelineno-28-13></a><span class=w>        </span><span class=nx>Update</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>pod</span><span class=p>,</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>UpdateOptions</span><span class=p>{})</span>
<a id=__codelineno-28-14 name=__codelineno-28-14 href=#__codelineno-28-14></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-28-15 name=__codelineno-28-15 href=#__codelineno-28-15></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;更新Pod失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-28-16 name=__codelineno-28-16 href=#__codelineno-28-16></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;更新Pod失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-28-17 name=__codelineno-28-17 href=#__codelineno-28-17></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-28-18 name=__codelineno-28-18 href=#__codelineno-28-18></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-28-19 name=__codelineno-28-19 href=#__codelineno-28-19></a><span class=p>}</span>
</code></pre></div> <p>(6)获取Pod中的容器名</p> <div class=highlight><pre><span></span><code><a id=__codelineno-29-1 name=__codelineno-29-1 href=#__codelineno-29-1></a><span class=c1>// GetPodContainer 获取Pod中的容器名</span>
<a id=__codelineno-29-2 name=__codelineno-29-2 href=#__codelineno-29-2></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=o>*</span><span class=nx>pod</span><span class=p>)</span><span class=w> </span><span class=nx>GetPodContainer</span><span class=p>(</span><span class=nx>podName</span><span class=p>,</span><span class=w> </span><span class=nx>namespace</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>containers</span><span class=w> </span><span class=p>[]</span><span class=kt>string</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-29-3 name=__codelineno-29-3 href=#__codelineno-29-3></a><span class=w>    </span><span class=c1>//获取pod详情</span>
<a id=__codelineno-29-4 name=__codelineno-29-4 href=#__codelineno-29-4></a><span class=w>    </span><span class=nx>pod</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>p</span><span class=p>.</span><span class=nx>GetPodDetail</span><span class=p>(</span><span class=nx>podName</span><span class=p>,</span><span class=w> </span><span class=nx>namespace</span><span class=p>)</span>
<a id=__codelineno-29-5 name=__codelineno-29-5 href=#__codelineno-29-5></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-29-6 name=__codelineno-29-6 href=#__codelineno-29-6></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>err</span>
<a id=__codelineno-29-7 name=__codelineno-29-7 href=#__codelineno-29-7></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-29-8 name=__codelineno-29-8 href=#__codelineno-29-8></a><span class=w>    </span><span class=c1>//从pod对象中拿到容器名</span>
<a id=__codelineno-29-9 name=__codelineno-29-9 href=#__codelineno-29-9></a><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>container</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>pod</span><span class=p>.</span><span class=nx>Spec</span><span class=p>.</span><span class=nx>Containers</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-29-10 name=__codelineno-29-10 href=#__codelineno-29-10></a><span class=w>        </span><span class=nx>containers</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nb>append</span><span class=p>(</span><span class=nx>containers</span><span class=p>,</span><span class=w> </span><span class=nx>container</span><span class=p>.</span><span class=nx>Name</span><span class=p>)</span>
<a id=__codelineno-29-11 name=__codelineno-29-11 href=#__codelineno-29-11></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-29-12 name=__codelineno-29-12 href=#__codelineno-29-12></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>containers</span><span class=p>,</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-29-13 name=__codelineno-29-13 href=#__codelineno-29-13></a><span class=p>}</span>
</code></pre></div> <p>(7)获取容器日志</p> <div class=highlight><pre><span></span><code><a id=__codelineno-30-1 name=__codelineno-30-1 href=#__codelineno-30-1></a><span class=c1>// GetPodLog 获取pod内容器日志</span>
<a id=__codelineno-30-2 name=__codelineno-30-2 href=#__codelineno-30-2></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=o>*</span><span class=nx>pod</span><span class=p>)</span><span class=w> </span><span class=nx>GetPodLog</span><span class=p>(</span><span class=nx>containerName</span><span class=p>,</span><span class=w> </span><span class=nx>podName</span><span class=p>,</span><span class=w> </span><span class=nx>namespace</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>log</span><span class=w> </span><span class=kt>string</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-30-3 name=__codelineno-30-3 href=#__codelineno-30-3></a><span class=w>    </span><span class=c1>//设置日志的配置，容器名、tail的行数</span>
<a id=__codelineno-30-4 name=__codelineno-30-4 href=#__codelineno-30-4></a><span class=w>    </span><span class=nx>lineLimit</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>int64</span><span class=p>(</span><span class=nx>config</span><span class=p>.</span><span class=nx>PodLogTailLine</span><span class=p>)</span>
<a id=__codelineno-30-5 name=__codelineno-30-5 href=#__codelineno-30-5></a><span class=w>    </span><span class=nx>option</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>PodLogOptions</span><span class=p>{</span>
<a id=__codelineno-30-6 name=__codelineno-30-6 href=#__codelineno-30-6></a><span class=w>        </span><span class=nx>Container</span><span class=p>:</span><span class=w> </span><span class=nx>containerName</span><span class=p>,</span>
<a id=__codelineno-30-7 name=__codelineno-30-7 href=#__codelineno-30-7></a><span class=w>        </span><span class=nx>TailLines</span><span class=p>:</span><span class=w> </span><span class=o>&amp;</span><span class=nx>lineLimit</span><span class=p>,</span>
<a id=__codelineno-30-8 name=__codelineno-30-8 href=#__codelineno-30-8></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-30-9 name=__codelineno-30-9 href=#__codelineno-30-9></a><span class=w>    </span><span class=c1>//获取request实例</span>
<a id=__codelineno-30-10 name=__codelineno-30-10 href=#__codelineno-30-10></a><span class=w>    </span><span class=nx>req</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>CoreV1</span><span class=p>().</span><span class=nx>Pods</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span><span class=nx>GetLogs</span><span class=p>(</span><span class=nx>podName</span><span class=p>,</span><span class=w> </span><span class=nx>option</span><span class=p>)</span>
<a id=__codelineno-30-11 name=__codelineno-30-11 href=#__codelineno-30-11></a><span class=w>    </span><span class=c1>//发起request请求，返回一个io.ReadCloser类型（等同于response.boby)</span>
<a id=__codelineno-30-12 name=__codelineno-30-12 href=#__codelineno-30-12></a><span class=w>    </span><span class=nx>podLogs</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>req</span><span class=p>.</span><span class=nx>Stream</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>())</span>
<a id=__codelineno-30-13 name=__codelineno-30-13 href=#__codelineno-30-13></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-30-14 name=__codelineno-30-14 href=#__codelineno-30-14></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取PodLog失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-30-15 name=__codelineno-30-15 href=#__codelineno-30-15></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=s>&quot;&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取PodLog失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-30-16 name=__codelineno-30-16 href=#__codelineno-30-16></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-30-17 name=__codelineno-30-17 href=#__codelineno-30-17></a><span class=w>    </span><span class=k>defer</span><span class=w> </span><span class=nx>podLogs</span><span class=p>.</span><span class=nx>Close</span><span class=p>()</span>
<a id=__codelineno-30-18 name=__codelineno-30-18 href=#__codelineno-30-18></a><span class=w>    </span><span class=c1>//将response body写入到缓冲区，目的是为了转成string返回</span>
<a id=__codelineno-30-19 name=__codelineno-30-19 href=#__codelineno-30-19></a><span class=w>    </span><span class=nx>buf</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=nx>bytes</span><span class=p>.</span><span class=nx>Buffer</span><span class=p>)</span>
<a id=__codelineno-30-20 name=__codelineno-30-20 href=#__codelineno-30-20></a><span class=w>    </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>io</span><span class=p>.</span><span class=nx>Copy</span><span class=p>(</span><span class=nx>buf</span><span class=p>,</span><span class=w> </span><span class=nx>podLogs</span><span class=p>)</span>
<a id=__codelineno-30-21 name=__codelineno-30-21 href=#__codelineno-30-21></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-30-22 name=__codelineno-30-22 href=#__codelineno-30-22></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;复制PodList失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-30-23 name=__codelineno-30-23 href=#__codelineno-30-23></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=s>&quot;&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;复制PodList失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-30-24 name=__codelineno-30-24 href=#__codelineno-30-24></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-30-25 name=__codelineno-30-25 href=#__codelineno-30-25></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>buf</span><span class=p>.</span><span class=nx>String</span><span class=p>(),</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-30-26 name=__codelineno-30-26 href=#__codelineno-30-26></a><span class=p>}</span>
</code></pre></div> <p>(8)获取每个namespace的pod数量</p> <div class=highlight><pre><span></span><code><a id=__codelineno-31-1 name=__codelineno-31-1 href=#__codelineno-31-1></a><span class=c1>// GetPodNumPerNp 获取每个namespace的pod数量</span>
<a id=__codelineno-31-2 name=__codelineno-31-2 href=#__codelineno-31-2></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=o>*</span><span class=nx>pod</span><span class=p>)</span><span class=w> </span><span class=nx>GetPodNumPerNp</span><span class=p>()</span><span class=w> </span><span class=p>(</span><span class=nx>podsNps</span><span class=w> </span><span class=p>[]</span><span class=o>*</span><span class=nx>PodsNp</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-31-3 name=__codelineno-31-3 href=#__codelineno-31-3></a><span class=w>    </span><span class=c1>//获取namespace列表</span>
<a id=__codelineno-31-4 name=__codelineno-31-4 href=#__codelineno-31-4></a><span class=w>    </span><span class=nx>namespaceList</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>CoreV1</span><span class=p>().</span><span class=nx>Namespaces</span><span class=p>().</span><span class=nx>List</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>ListOptions</span><span class=p>{})</span>
<a id=__codelineno-31-5 name=__codelineno-31-5 href=#__codelineno-31-5></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-31-6 name=__codelineno-31-6 href=#__codelineno-31-6></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>err</span>
<a id=__codelineno-31-7 name=__codelineno-31-7 href=#__codelineno-31-7></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-31-8 name=__codelineno-31-8 href=#__codelineno-31-8></a><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>namespace</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>namespaceList</span><span class=p>.</span><span class=nx>Items</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-31-9 name=__codelineno-31-9 href=#__codelineno-31-9></a><span class=w>        </span><span class=c1>//获取pod列表</span>
<a id=__codelineno-31-10 name=__codelineno-31-10 href=#__codelineno-31-10></a><span class=w>        </span><span class=nx>podList</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>CoreV1</span><span class=p>().</span><span class=nx>Pods</span><span class=p>(</span><span class=nx>namespace</span><span class=p>.</span><span class=nx>Name</span><span class=p>).</span>
<a id=__codelineno-31-11 name=__codelineno-31-11 href=#__codelineno-31-11></a><span class=w>            </span><span class=nx>List</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>ListOptions</span><span class=p>{})</span>
<a id=__codelineno-31-12 name=__codelineno-31-12 href=#__codelineno-31-12></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-31-13 name=__codelineno-31-13 href=#__codelineno-31-13></a><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>err</span>
<a id=__codelineno-31-14 name=__codelineno-31-14 href=#__codelineno-31-14></a><span class=w>        </span><span class=p>}</span>
<a id=__codelineno-31-15 name=__codelineno-31-15 href=#__codelineno-31-15></a><span class=w>        </span><span class=c1>//组装数据</span>
<a id=__codelineno-31-16 name=__codelineno-31-16 href=#__codelineno-31-16></a><span class=w>        </span><span class=nx>PodsNp</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>PodsNp</span><span class=p>{</span>
<a id=__codelineno-31-17 name=__codelineno-31-17 href=#__codelineno-31-17></a><span class=w>            </span><span class=nx>Namespace</span><span class=p>:</span><span class=w> </span><span class=nx>namespace</span><span class=p>.</span><span class=nx>Name</span><span class=p>,</span>
<a id=__codelineno-31-18 name=__codelineno-31-18 href=#__codelineno-31-18></a><span class=w>            </span><span class=nx>PodNum</span><span class=p>:</span><span class=w>    </span><span class=nb>len</span><span class=p>(</span><span class=nx>podList</span><span class=p>.</span><span class=nx>Items</span><span class=p>),</span>
<a id=__codelineno-31-19 name=__codelineno-31-19 href=#__codelineno-31-19></a><span class=w>        </span><span class=p>}</span>
<a id=__codelineno-31-20 name=__codelineno-31-20 href=#__codelineno-31-20></a><span class=w>        </span><span class=c1>//添加到podsNps数组中</span>
<a id=__codelineno-31-21 name=__codelineno-31-21 href=#__codelineno-31-21></a><span class=w>        </span><span class=nx>podsNps</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nb>append</span><span class=p>(</span><span class=nx>podsNps</span><span class=p>,</span><span class=w> </span><span class=nx>PodsNp</span><span class=p>)</span>
<a id=__codelineno-31-22 name=__codelineno-31-22 href=#__codelineno-31-22></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-31-23 name=__codelineno-31-23 href=#__codelineno-31-23></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>podsNps</span><span class=p>,</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-31-24 name=__codelineno-31-24 href=#__codelineno-31-24></a><span class=p>}</span>
</code></pre></div> <h5 id=controllerpodgo>controller/pod.go<a class=headerlink href=#controllerpodgo title="Permanent link">&para;</a></h5> <p>(9)编写Controller层的pod代码</p> <div class=highlight><pre><span></span><code><a id=__codelineno-32-1 name=__codelineno-32-1 href=#__codelineno-32-1></a><span class=kn>package</span><span class=w> </span><span class=nx>controller</span>
<a id=__codelineno-32-2 name=__codelineno-32-2 href=#__codelineno-32-2></a>
<a id=__codelineno-32-3 name=__codelineno-32-3 href=#__codelineno-32-3></a><span class=kn>import</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-32-4 name=__codelineno-32-4 href=#__codelineno-32-4></a><span class=w>    </span><span class=s>&quot;gitee.com/k8s-platform/service&quot;</span>
<a id=__codelineno-32-5 name=__codelineno-32-5 href=#__codelineno-32-5></a><span class=w>    </span><span class=s>&quot;net/http&quot;</span>
<a id=__codelineno-32-6 name=__codelineno-32-6 href=#__codelineno-32-6></a>
<a id=__codelineno-32-7 name=__codelineno-32-7 href=#__codelineno-32-7></a><span class=w>    </span><span class=s>&quot;github.com/gin-gonic/gin&quot;</span>
<a id=__codelineno-32-8 name=__codelineno-32-8 href=#__codelineno-32-8></a><span class=w>    </span><span class=s>&quot;github.com/wonderivan/logger&quot;</span>
<a id=__codelineno-32-9 name=__codelineno-32-9 href=#__codelineno-32-9></a><span class=p>)</span>
<a id=__codelineno-32-10 name=__codelineno-32-10 href=#__codelineno-32-10></a>
<a id=__codelineno-32-11 name=__codelineno-32-11 href=#__codelineno-32-11></a><span class=kd>var</span><span class=w> </span><span class=nx>Pod</span><span class=w> </span><span class=nx>pod</span>
<a id=__codelineno-32-12 name=__codelineno-32-12 href=#__codelineno-32-12></a>
<a id=__codelineno-32-13 name=__codelineno-32-13 href=#__codelineno-32-13></a><span class=kd>type</span><span class=w> </span><span class=nx>pod</span><span class=w> </span><span class=kd>struct</span><span class=p>{}</span>
<a id=__codelineno-32-14 name=__codelineno-32-14 href=#__codelineno-32-14></a>
<a id=__codelineno-32-15 name=__codelineno-32-15 href=#__codelineno-32-15></a><span class=c1>//Controller中的方法入参是gin.Context，用于从上下文中获取请求参数及定义响应内容</span>
<a id=__codelineno-32-16 name=__codelineno-32-16 href=#__codelineno-32-16></a><span class=c1>//流程：绑定参数-&gt;调用service代码-&gt;根据调用结果响应具体内容</span>
<a id=__codelineno-32-17 name=__codelineno-32-17 href=#__codelineno-32-17></a>
<a id=__codelineno-32-18 name=__codelineno-32-18 href=#__codelineno-32-18></a><span class=c1>// GetPods 获取pod列表，支持过滤、排序、分页</span>
<a id=__codelineno-32-19 name=__codelineno-32-19 href=#__codelineno-32-19></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=o>*</span><span class=nx>pod</span><span class=p>)</span><span class=w> </span><span class=nx>GetPods</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-32-20 name=__codelineno-32-20 href=#__codelineno-32-20></a><span class=w>    </span><span class=c1>//匿名结构体，用于声明入参，get请求为form格式，其他请求为json格式</span>
<a id=__codelineno-32-21 name=__codelineno-32-21 href=#__codelineno-32-21></a><span class=w>    </span><span class=nx>params</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-32-22 name=__codelineno-32-22 href=#__codelineno-32-22></a><span class=w>        </span><span class=nx>FilterName</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`form:&quot;filter_name&quot;`</span>
<a id=__codelineno-32-23 name=__codelineno-32-23 href=#__codelineno-32-23></a><span class=w>        </span><span class=nx>Namespace</span><span class=w>  </span><span class=kt>string</span><span class=w> </span><span class=s>`form:&quot;namespace&quot;`</span>
<a id=__codelineno-32-24 name=__codelineno-32-24 href=#__codelineno-32-24></a><span class=w>        </span><span class=nx>Page</span><span class=w>       </span><span class=kt>int</span><span class=w>    </span><span class=s>`form:&quot;page&quot;`</span>
<a id=__codelineno-32-25 name=__codelineno-32-25 href=#__codelineno-32-25></a><span class=w>        </span><span class=nx>Limit</span><span class=w>      </span><span class=kt>int</span><span class=w>    </span><span class=s>`form:&quot;limit&quot;`</span>
<a id=__codelineno-32-26 name=__codelineno-32-26 href=#__codelineno-32-26></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-32-27 name=__codelineno-32-27 href=#__codelineno-32-27></a><span class=w>    </span><span class=c1>//绑定参数，给匿名结构体中的属性赋值，值是入参</span>
<a id=__codelineno-32-28 name=__codelineno-32-28 href=#__codelineno-32-28></a><span class=w>    </span><span class=c1>//form格式(Get)使用ctx.Bind方法，json格式使用ctx.ShouldBindJSON方法</span>
<a id=__codelineno-32-29 name=__codelineno-32-29 href=#__codelineno-32-29></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>Bind</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-32-30 name=__codelineno-32-30 href=#__codelineno-32-30></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-32-31 name=__codelineno-32-31 href=#__codelineno-32-31></a><span class=w>        </span><span class=c1>//ctx.JSON方法用于返回响应内容，入参是状态码和响应内容，响应内容放入gin.H的map中</span>
<a id=__codelineno-32-32 name=__codelineno-32-32 href=#__codelineno-32-32></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-32-33 name=__codelineno-32-33 href=#__codelineno-32-33></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-32-34 name=__codelineno-32-34 href=#__codelineno-32-34></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-32-35 name=__codelineno-32-35 href=#__codelineno-32-35></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-32-36 name=__codelineno-32-36 href=#__codelineno-32-36></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-32-37 name=__codelineno-32-37 href=#__codelineno-32-37></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-32-38 name=__codelineno-32-38 href=#__codelineno-32-38></a><span class=w>    </span><span class=c1>//service中的的方法通过 包名.结构体变量名.方法名 使用，serivce.Pod.GetPods()</span>
<a id=__codelineno-32-39 name=__codelineno-32-39 href=#__codelineno-32-39></a><span class=w>    </span><span class=nx>data</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>Pod</span><span class=p>.</span><span class=nx>GetPods</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>FilterName</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Limit</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Page</span><span class=p>)</span>
<a id=__codelineno-32-40 name=__codelineno-32-40 href=#__codelineno-32-40></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-32-41 name=__codelineno-32-41 href=#__codelineno-32-41></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-32-42 name=__codelineno-32-42 href=#__codelineno-32-42></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-32-43 name=__codelineno-32-43 href=#__codelineno-32-43></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-32-44 name=__codelineno-32-44 href=#__codelineno-32-44></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-32-45 name=__codelineno-32-45 href=#__codelineno-32-45></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-32-46 name=__codelineno-32-46 href=#__codelineno-32-46></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-32-47 name=__codelineno-32-47 href=#__codelineno-32-47></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-32-48 name=__codelineno-32-48 href=#__codelineno-32-48></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;获取Pod列表成功&quot;</span><span class=p>,</span>
<a id=__codelineno-32-49 name=__codelineno-32-49 href=#__codelineno-32-49></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=nx>data</span><span class=p>,</span>
<a id=__codelineno-32-50 name=__codelineno-32-50 href=#__codelineno-32-50></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-32-51 name=__codelineno-32-51 href=#__codelineno-32-51></a><span class=p>}</span>
<a id=__codelineno-32-52 name=__codelineno-32-52 href=#__codelineno-32-52></a>
<a id=__codelineno-32-53 name=__codelineno-32-53 href=#__codelineno-32-53></a><span class=c1>// GetPodDetail 获取pod详情</span>
<a id=__codelineno-32-54 name=__codelineno-32-54 href=#__codelineno-32-54></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=o>*</span><span class=nx>pod</span><span class=p>)</span><span class=w> </span><span class=nx>GetPodDetail</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-32-55 name=__codelineno-32-55 href=#__codelineno-32-55></a><span class=w>    </span><span class=nx>params</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-32-56 name=__codelineno-32-56 href=#__codelineno-32-56></a><span class=w>        </span><span class=nx>PodName</span><span class=w>   </span><span class=kt>string</span><span class=w> </span><span class=s>`form:&quot;pod_name&quot;`</span>
<a id=__codelineno-32-57 name=__codelineno-32-57 href=#__codelineno-32-57></a><span class=w>        </span><span class=nx>Namespace</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`form:&quot;namespace&quot;`</span>
<a id=__codelineno-32-58 name=__codelineno-32-58 href=#__codelineno-32-58></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-32-59 name=__codelineno-32-59 href=#__codelineno-32-59></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>Bind</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-32-60 name=__codelineno-32-60 href=#__codelineno-32-60></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-32-61 name=__codelineno-32-61 href=#__codelineno-32-61></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-32-62 name=__codelineno-32-62 href=#__codelineno-32-62></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-32-63 name=__codelineno-32-63 href=#__codelineno-32-63></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-32-64 name=__codelineno-32-64 href=#__codelineno-32-64></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-32-65 name=__codelineno-32-65 href=#__codelineno-32-65></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-32-66 name=__codelineno-32-66 href=#__codelineno-32-66></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-32-67 name=__codelineno-32-67 href=#__codelineno-32-67></a><span class=w>    </span><span class=nx>data</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>Pod</span><span class=p>.</span><span class=nx>GetPodDetail</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>PodName</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>)</span>
<a id=__codelineno-32-68 name=__codelineno-32-68 href=#__codelineno-32-68></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-32-69 name=__codelineno-32-69 href=#__codelineno-32-69></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-32-70 name=__codelineno-32-70 href=#__codelineno-32-70></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-32-71 name=__codelineno-32-71 href=#__codelineno-32-71></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-32-72 name=__codelineno-32-72 href=#__codelineno-32-72></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-32-73 name=__codelineno-32-73 href=#__codelineno-32-73></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-32-74 name=__codelineno-32-74 href=#__codelineno-32-74></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-32-75 name=__codelineno-32-75 href=#__codelineno-32-75></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-32-76 name=__codelineno-32-76 href=#__codelineno-32-76></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;获取Pod详情成功&quot;</span><span class=p>,</span>
<a id=__codelineno-32-77 name=__codelineno-32-77 href=#__codelineno-32-77></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=nx>data</span><span class=p>,</span>
<a id=__codelineno-32-78 name=__codelineno-32-78 href=#__codelineno-32-78></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-32-79 name=__codelineno-32-79 href=#__codelineno-32-79></a><span class=p>}</span>
<a id=__codelineno-32-80 name=__codelineno-32-80 href=#__codelineno-32-80></a>
<a id=__codelineno-32-81 name=__codelineno-32-81 href=#__codelineno-32-81></a><span class=c1>// DeletePod 删除Pod</span>
<a id=__codelineno-32-82 name=__codelineno-32-82 href=#__codelineno-32-82></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=o>*</span><span class=nx>pod</span><span class=p>)</span><span class=w> </span><span class=nx>DeletePod</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-32-83 name=__codelineno-32-83 href=#__codelineno-32-83></a><span class=w>    </span><span class=nx>params</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-32-84 name=__codelineno-32-84 href=#__codelineno-32-84></a><span class=w>        </span><span class=nx>PodName</span><span class=w>   </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;pod_name&quot;`</span>
<a id=__codelineno-32-85 name=__codelineno-32-85 href=#__codelineno-32-85></a><span class=w>        </span><span class=nx>Namespace</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;namespace&quot;`</span>
<a id=__codelineno-32-86 name=__codelineno-32-86 href=#__codelineno-32-86></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-32-87 name=__codelineno-32-87 href=#__codelineno-32-87></a><span class=w>    </span><span class=c1>//PUT请求，绑定参数方法改为ctx.ShouldBindJSON</span>
<a id=__codelineno-32-88 name=__codelineno-32-88 href=#__codelineno-32-88></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>ShouldBindJSON</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-32-89 name=__codelineno-32-89 href=#__codelineno-32-89></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-32-90 name=__codelineno-32-90 href=#__codelineno-32-90></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-32-91 name=__codelineno-32-91 href=#__codelineno-32-91></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-32-92 name=__codelineno-32-92 href=#__codelineno-32-92></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-32-93 name=__codelineno-32-93 href=#__codelineno-32-93></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-32-94 name=__codelineno-32-94 href=#__codelineno-32-94></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-32-95 name=__codelineno-32-95 href=#__codelineno-32-95></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-32-96 name=__codelineno-32-96 href=#__codelineno-32-96></a><span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>Pod</span><span class=p>.</span><span class=nx>DeletePod</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>PodName</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>)</span>
<a id=__codelineno-32-97 name=__codelineno-32-97 href=#__codelineno-32-97></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-32-98 name=__codelineno-32-98 href=#__codelineno-32-98></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-32-99 name=__codelineno-32-99 href=#__codelineno-32-99></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-32-100 name=__codelineno-32-100 href=#__codelineno-32-100></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-32-101 name=__codelineno-32-101 href=#__codelineno-32-101></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-32-102 name=__codelineno-32-102 href=#__codelineno-32-102></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-32-103 name=__codelineno-32-103 href=#__codelineno-32-103></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-32-104 name=__codelineno-32-104 href=#__codelineno-32-104></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-32-105 name=__codelineno-32-105 href=#__codelineno-32-105></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;删除Pod成功&quot;</span><span class=p>,</span>
<a id=__codelineno-32-106 name=__codelineno-32-106 href=#__codelineno-32-106></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-32-107 name=__codelineno-32-107 href=#__codelineno-32-107></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-32-108 name=__codelineno-32-108 href=#__codelineno-32-108></a><span class=p>}</span>
<a id=__codelineno-32-109 name=__codelineno-32-109 href=#__codelineno-32-109></a>
<a id=__codelineno-32-110 name=__codelineno-32-110 href=#__codelineno-32-110></a><span class=c1>// UpdatePod 更新pod</span>
<a id=__codelineno-32-111 name=__codelineno-32-111 href=#__codelineno-32-111></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=o>*</span><span class=nx>pod</span><span class=p>)</span><span class=w> </span><span class=nx>UpdatePod</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-32-112 name=__codelineno-32-112 href=#__codelineno-32-112></a><span class=w>    </span><span class=nx>params</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-32-113 name=__codelineno-32-113 href=#__codelineno-32-113></a><span class=w>        </span><span class=nx>Namespace</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;namespace&quot;`</span>
<a id=__codelineno-32-114 name=__codelineno-32-114 href=#__codelineno-32-114></a><span class=w>        </span><span class=nx>Content</span><span class=w>   </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;content&quot;`</span>
<a id=__codelineno-32-115 name=__codelineno-32-115 href=#__codelineno-32-115></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-32-116 name=__codelineno-32-116 href=#__codelineno-32-116></a><span class=w>    </span><span class=c1>//PUT请求，绑定参数方法改为ctx.ShouldBindJSON</span>
<a id=__codelineno-32-117 name=__codelineno-32-117 href=#__codelineno-32-117></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>ShouldBindJSON</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-32-118 name=__codelineno-32-118 href=#__codelineno-32-118></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-32-119 name=__codelineno-32-119 href=#__codelineno-32-119></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-32-120 name=__codelineno-32-120 href=#__codelineno-32-120></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-32-121 name=__codelineno-32-121 href=#__codelineno-32-121></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-32-122 name=__codelineno-32-122 href=#__codelineno-32-122></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-32-123 name=__codelineno-32-123 href=#__codelineno-32-123></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-32-124 name=__codelineno-32-124 href=#__codelineno-32-124></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-32-125 name=__codelineno-32-125 href=#__codelineno-32-125></a><span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>Pod</span><span class=p>.</span><span class=nx>UpdatePod</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Content</span><span class=p>)</span>
<a id=__codelineno-32-126 name=__codelineno-32-126 href=#__codelineno-32-126></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-32-127 name=__codelineno-32-127 href=#__codelineno-32-127></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-32-128 name=__codelineno-32-128 href=#__codelineno-32-128></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-32-129 name=__codelineno-32-129 href=#__codelineno-32-129></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-32-130 name=__codelineno-32-130 href=#__codelineno-32-130></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-32-131 name=__codelineno-32-131 href=#__codelineno-32-131></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-32-132 name=__codelineno-32-132 href=#__codelineno-32-132></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-32-133 name=__codelineno-32-133 href=#__codelineno-32-133></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-32-134 name=__codelineno-32-134 href=#__codelineno-32-134></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;更新Pod成功&quot;</span><span class=p>,</span>
<a id=__codelineno-32-135 name=__codelineno-32-135 href=#__codelineno-32-135></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-32-136 name=__codelineno-32-136 href=#__codelineno-32-136></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-32-137 name=__codelineno-32-137 href=#__codelineno-32-137></a><span class=p>}</span>
<a id=__codelineno-32-138 name=__codelineno-32-138 href=#__codelineno-32-138></a>
<a id=__codelineno-32-139 name=__codelineno-32-139 href=#__codelineno-32-139></a><span class=c1>// GetPodContainer 获取pod容量</span>
<a id=__codelineno-32-140 name=__codelineno-32-140 href=#__codelineno-32-140></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=o>*</span><span class=nx>pod</span><span class=p>)</span><span class=w> </span><span class=nx>GetPodContainer</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-32-141 name=__codelineno-32-141 href=#__codelineno-32-141></a><span class=w>    </span><span class=nx>params</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-32-142 name=__codelineno-32-142 href=#__codelineno-32-142></a><span class=w>        </span><span class=nx>PodName</span><span class=w>   </span><span class=kt>string</span><span class=w> </span><span class=s>`form:&quot;pod_name&quot;`</span>
<a id=__codelineno-32-143 name=__codelineno-32-143 href=#__codelineno-32-143></a><span class=w>        </span><span class=nx>Namespace</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`form:&quot;namespace&quot;`</span>
<a id=__codelineno-32-144 name=__codelineno-32-144 href=#__codelineno-32-144></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-32-145 name=__codelineno-32-145 href=#__codelineno-32-145></a><span class=w>    </span><span class=c1>//GET请求，绑定参数方法改为ctx.Bind</span>
<a id=__codelineno-32-146 name=__codelineno-32-146 href=#__codelineno-32-146></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>Bind</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-32-147 name=__codelineno-32-147 href=#__codelineno-32-147></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-32-148 name=__codelineno-32-148 href=#__codelineno-32-148></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-32-149 name=__codelineno-32-149 href=#__codelineno-32-149></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-32-150 name=__codelineno-32-150 href=#__codelineno-32-150></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-32-151 name=__codelineno-32-151 href=#__codelineno-32-151></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-32-152 name=__codelineno-32-152 href=#__codelineno-32-152></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-32-153 name=__codelineno-32-153 href=#__codelineno-32-153></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-32-154 name=__codelineno-32-154 href=#__codelineno-32-154></a><span class=w>    </span><span class=nx>data</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>Pod</span><span class=p>.</span><span class=nx>GetPodContainer</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>PodName</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>)</span>
<a id=__codelineno-32-155 name=__codelineno-32-155 href=#__codelineno-32-155></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-32-156 name=__codelineno-32-156 href=#__codelineno-32-156></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-32-157 name=__codelineno-32-157 href=#__codelineno-32-157></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-32-158 name=__codelineno-32-158 href=#__codelineno-32-158></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-32-159 name=__codelineno-32-159 href=#__codelineno-32-159></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-32-160 name=__codelineno-32-160 href=#__codelineno-32-160></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-32-161 name=__codelineno-32-161 href=#__codelineno-32-161></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-32-162 name=__codelineno-32-162 href=#__codelineno-32-162></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-32-163 name=__codelineno-32-163 href=#__codelineno-32-163></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;获取Pod容器成功&quot;</span><span class=p>,</span>
<a id=__codelineno-32-164 name=__codelineno-32-164 href=#__codelineno-32-164></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=nx>data</span><span class=p>,</span>
<a id=__codelineno-32-165 name=__codelineno-32-165 href=#__codelineno-32-165></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-32-166 name=__codelineno-32-166 href=#__codelineno-32-166></a><span class=p>}</span>
<a id=__codelineno-32-167 name=__codelineno-32-167 href=#__codelineno-32-167></a>
<a id=__codelineno-32-168 name=__codelineno-32-168 href=#__codelineno-32-168></a><span class=c1>// GetPodLog 获取pod中容器日志</span>
<a id=__codelineno-32-169 name=__codelineno-32-169 href=#__codelineno-32-169></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=o>*</span><span class=nx>pod</span><span class=p>)</span><span class=w> </span><span class=nx>GetPodLog</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-32-170 name=__codelineno-32-170 href=#__codelineno-32-170></a><span class=w>    </span><span class=nx>params</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-32-171 name=__codelineno-32-171 href=#__codelineno-32-171></a><span class=w>        </span><span class=nx>ContainerName</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`form:&quot;container_name&quot;`</span>
<a id=__codelineno-32-172 name=__codelineno-32-172 href=#__codelineno-32-172></a><span class=w>        </span><span class=nx>PodName</span><span class=w>       </span><span class=kt>string</span><span class=w> </span><span class=s>`form:&quot;pod_name&quot;`</span>
<a id=__codelineno-32-173 name=__codelineno-32-173 href=#__codelineno-32-173></a><span class=w>        </span><span class=nx>Namespace</span><span class=w>     </span><span class=kt>string</span><span class=w> </span><span class=s>`form:&quot;namespace&quot;`</span>
<a id=__codelineno-32-174 name=__codelineno-32-174 href=#__codelineno-32-174></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-32-175 name=__codelineno-32-175 href=#__codelineno-32-175></a><span class=w>    </span><span class=c1>//GET请求，绑定参数方法改为ctx.Bind</span>
<a id=__codelineno-32-176 name=__codelineno-32-176 href=#__codelineno-32-176></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>Bind</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-32-177 name=__codelineno-32-177 href=#__codelineno-32-177></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-32-178 name=__codelineno-32-178 href=#__codelineno-32-178></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-32-179 name=__codelineno-32-179 href=#__codelineno-32-179></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-32-180 name=__codelineno-32-180 href=#__codelineno-32-180></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-32-181 name=__codelineno-32-181 href=#__codelineno-32-181></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-32-182 name=__codelineno-32-182 href=#__codelineno-32-182></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-32-183 name=__codelineno-32-183 href=#__codelineno-32-183></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-32-184 name=__codelineno-32-184 href=#__codelineno-32-184></a><span class=w>    </span><span class=nx>data</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>Pod</span><span class=p>.</span><span class=nx>GetPodLog</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>ContainerName</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>PodName</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>)</span>
<a id=__codelineno-32-185 name=__codelineno-32-185 href=#__codelineno-32-185></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-32-186 name=__codelineno-32-186 href=#__codelineno-32-186></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-32-187 name=__codelineno-32-187 href=#__codelineno-32-187></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-32-188 name=__codelineno-32-188 href=#__codelineno-32-188></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-32-189 name=__codelineno-32-189 href=#__codelineno-32-189></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-32-190 name=__codelineno-32-190 href=#__codelineno-32-190></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-32-191 name=__codelineno-32-191 href=#__codelineno-32-191></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-32-192 name=__codelineno-32-192 href=#__codelineno-32-192></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-32-193 name=__codelineno-32-193 href=#__codelineno-32-193></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;获取Pod中容器日志成功&quot;</span><span class=p>,</span>
<a id=__codelineno-32-194 name=__codelineno-32-194 href=#__codelineno-32-194></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=nx>data</span><span class=p>,</span>
<a id=__codelineno-32-195 name=__codelineno-32-195 href=#__codelineno-32-195></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-32-196 name=__codelineno-32-196 href=#__codelineno-32-196></a><span class=p>}</span>
<a id=__codelineno-32-197 name=__codelineno-32-197 href=#__codelineno-32-197></a>
<a id=__codelineno-32-198 name=__codelineno-32-198 href=#__codelineno-32-198></a><span class=c1>// GetPodNumPerNp 获取每个namespace的pod数量</span>
<a id=__codelineno-32-199 name=__codelineno-32-199 href=#__codelineno-32-199></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=o>*</span><span class=nx>pod</span><span class=p>)</span><span class=w> </span><span class=nx>GetPodNumPerNp</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-32-200 name=__codelineno-32-200 href=#__codelineno-32-200></a><span class=w>    </span><span class=nx>data</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>Pod</span><span class=p>.</span><span class=nx>GetPodNumPerNp</span><span class=p>()</span>
<a id=__codelineno-32-201 name=__codelineno-32-201 href=#__codelineno-32-201></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-32-202 name=__codelineno-32-202 href=#__codelineno-32-202></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-32-203 name=__codelineno-32-203 href=#__codelineno-32-203></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-32-204 name=__codelineno-32-204 href=#__codelineno-32-204></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-32-205 name=__codelineno-32-205 href=#__codelineno-32-205></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-32-206 name=__codelineno-32-206 href=#__codelineno-32-206></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-32-207 name=__codelineno-32-207 href=#__codelineno-32-207></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-32-208 name=__codelineno-32-208 href=#__codelineno-32-208></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-32-209 name=__codelineno-32-209 href=#__codelineno-32-209></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;获取每个namespace的pod数量成功&quot;</span><span class=p>,</span>
<a id=__codelineno-32-210 name=__codelineno-32-210 href=#__codelineno-32-210></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=nx>data</span><span class=p>,</span>
<a id=__codelineno-32-211 name=__codelineno-32-211 href=#__codelineno-32-211></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-32-212 name=__codelineno-32-212 href=#__codelineno-32-212></a><span class=p>}</span>
</code></pre></div> <h5 id=controllerroutergo>controller/router.go<a class=headerlink href=#controllerroutergo title="Permanent link">&para;</a></h5> <p>(10)定义路由规则</p> <div class=highlight><pre><span></span><code><a id=__codelineno-33-1 name=__codelineno-33-1 href=#__codelineno-33-1></a><span class=kn>package</span><span class=w> </span><span class=nx>controller</span>
<a id=__codelineno-33-2 name=__codelineno-33-2 href=#__codelineno-33-2></a>
<a id=__codelineno-33-3 name=__codelineno-33-3 href=#__codelineno-33-3></a><span class=kn>import</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-33-4 name=__codelineno-33-4 href=#__codelineno-33-4></a><span class=w>    </span><span class=s>&quot;github.com/gin-gonic/gin&quot;</span>
<a id=__codelineno-33-5 name=__codelineno-33-5 href=#__codelineno-33-5></a><span class=w>    </span><span class=s>&quot;net/http&quot;</span>
<a id=__codelineno-33-6 name=__codelineno-33-6 href=#__codelineno-33-6></a><span class=p>)</span>
<a id=__codelineno-33-7 name=__codelineno-33-7 href=#__codelineno-33-7></a>
<a id=__codelineno-33-8 name=__codelineno-33-8 href=#__codelineno-33-8></a><span class=c1>// Router 实例化router结构体，可使用该对象点出首字母大写的方法（包外调用）</span>
<a id=__codelineno-33-9 name=__codelineno-33-9 href=#__codelineno-33-9></a><span class=kd>var</span><span class=w> </span><span class=nx>Router</span><span class=w> </span><span class=nx>router</span>
<a id=__codelineno-33-10 name=__codelineno-33-10 href=#__codelineno-33-10></a>
<a id=__codelineno-33-11 name=__codelineno-33-11 href=#__codelineno-33-11></a><span class=c1>// 创建router结构体</span>
<a id=__codelineno-33-12 name=__codelineno-33-12 href=#__codelineno-33-12></a><span class=kd>type</span><span class=w> </span><span class=nx>router</span><span class=w> </span><span class=kd>struct</span><span class=p>{}</span>
<a id=__codelineno-33-13 name=__codelineno-33-13 href=#__codelineno-33-13></a>
<a id=__codelineno-33-14 name=__codelineno-33-14 href=#__codelineno-33-14></a><span class=c1>// InitApiRouter 初始化路由规则</span>
<a id=__codelineno-33-15 name=__codelineno-33-15 href=#__codelineno-33-15></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>r</span><span class=w> </span><span class=o>*</span><span class=nx>router</span><span class=p>)</span><span class=w> </span><span class=nx>InitApiRouter</span><span class=p>(</span><span class=nx>router</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Engine</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-33-16 name=__codelineno-33-16 href=#__codelineno-33-16></a><span class=w>    </span><span class=c1>//创建测试api接口</span>
<a id=__codelineno-33-17 name=__codelineno-33-17 href=#__codelineno-33-17></a><span class=w>    </span><span class=nx>router</span><span class=p>.</span><span class=nx>GET</span><span class=p>(</span><span class=s>&quot;/testapi&quot;</span><span class=p>,</span><span class=w> </span><span class=kd>func</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-33-18 name=__codelineno-33-18 href=#__codelineno-33-18></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-33-19 name=__codelineno-33-19 href=#__codelineno-33-19></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;testapi success!&quot;</span><span class=p>,</span>
<a id=__codelineno-33-20 name=__codelineno-33-20 href=#__codelineno-33-20></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-33-21 name=__codelineno-33-21 href=#__codelineno-33-21></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-33-22 name=__codelineno-33-22 href=#__codelineno-33-22></a><span class=w>    </span><span class=p>}).</span>
<a id=__codelineno-33-23 name=__codelineno-33-23 href=#__codelineno-33-23></a><span class=w>        </span><span class=c1>// pod操作</span>
<a id=__codelineno-33-24 name=__codelineno-33-24 href=#__codelineno-33-24></a><span class=w>        </span><span class=nx>GET</span><span class=p>(</span><span class=s>&quot;/api/k8s/pods&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Pod</span><span class=p>.</span><span class=nx>GetPods</span><span class=p>).</span>
<a id=__codelineno-33-25 name=__codelineno-33-25 href=#__codelineno-33-25></a><span class=w>        </span><span class=nx>GET</span><span class=p>(</span><span class=s>&quot;/api/k8s/pod/detail&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Pod</span><span class=p>.</span><span class=nx>GetPodDetail</span><span class=p>).</span>
<a id=__codelineno-33-26 name=__codelineno-33-26 href=#__codelineno-33-26></a><span class=w>        </span><span class=nx>DELETE</span><span class=p>(</span><span class=s>&quot;/api/k8s/pod/del&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Pod</span><span class=p>.</span><span class=nx>DeletePod</span><span class=p>).</span>
<a id=__codelineno-33-27 name=__codelineno-33-27 href=#__codelineno-33-27></a><span class=w>        </span><span class=nx>PUT</span><span class=p>(</span><span class=s>&quot;/api/k8s/pod/update&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Pod</span><span class=p>.</span><span class=nx>UpdatePod</span><span class=p>).</span>
<a id=__codelineno-33-28 name=__codelineno-33-28 href=#__codelineno-33-28></a><span class=w>        </span><span class=nx>GET</span><span class=p>(</span><span class=s>&quot;/api/k8s/pod/container&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Pod</span><span class=p>.</span><span class=nx>GetPodContainer</span><span class=p>).</span>
<a id=__codelineno-33-29 name=__codelineno-33-29 href=#__codelineno-33-29></a><span class=w>        </span><span class=nx>GET</span><span class=p>(</span><span class=s>&quot;/api/k8s/pod/log&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Pod</span><span class=p>.</span><span class=nx>GetPodLog</span><span class=p>).</span>
<a id=__codelineno-33-30 name=__codelineno-33-30 href=#__codelineno-33-30></a><span class=w>        </span><span class=nx>GET</span><span class=p>(</span><span class=s>&quot;/api/k8s/pod/numnp&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Pod</span><span class=p>.</span><span class=nx>GetPodNumPerNp</span><span class=p>)</span>
<a id=__codelineno-33-31 name=__codelineno-33-31 href=#__codelineno-33-31></a><span class=p>}</span>
</code></pre></div> <p>(11)做接口测试</p> <ul> <li>获取所有pod信息</li> </ul> <p><img alt=1700558387506 class=zoom src=https://cdn.jsdelivr.net/gh/hujianli94/Picgo-atlas@main/img/1700558387506.5wwy3ial69c0.webp></p> <ul> <li>获取pod详细内容</li> </ul> <p><img alt=1700558473846 class=zoom src=https://cdn.jsdelivr.net/gh/hujianli94/Picgo-atlas@main/img/1700558473846.3h9rliiwuhs0.webp></p> <ul> <li>删除pod</li> </ul> <p><img alt=1700558519334 class=zoom src=https://cdn.jsdelivr.net/gh/hujianli94/Picgo-atlas@main/img/1700558519334.723iphdn21o0.webp></p> <h4 id=23-deployment>2.3 Deployment<a class=headerlink href=#23-deployment title="Permanent link">&para;</a></h4> <h5 id=servicedataselectorgo>service/dataselector.go<a class=headerlink href=#servicedataselectorgo title="Permanent link">&para;</a></h5> <div class=highlight><pre><span></span><code><a id=__codelineno-34-1 name=__codelineno-34-1 href=#__codelineno-34-1></a><span class=c1>// 实现 Deployment的 DataCell接口</span>
<a id=__codelineno-34-2 name=__codelineno-34-2 href=#__codelineno-34-2></a><span class=kd>type</span><span class=w> </span><span class=nx>deploymentCell</span><span class=w> </span><span class=nx>appsv1</span><span class=p>.</span><span class=nx>Deployment</span><span class=w> </span><span class=c1>//appsv1 &quot;k8s.io/api/apps/v1&quot;</span>
<a id=__codelineno-34-3 name=__codelineno-34-3 href=#__codelineno-34-3></a>
<a id=__codelineno-34-4 name=__codelineno-34-4 href=#__codelineno-34-4></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=nx>deploymentCell</span><span class=p>)</span><span class=w> </span><span class=nx>GetCreation</span><span class=p>()</span><span class=w> </span><span class=nx>time</span><span class=p>.</span><span class=nx>Time</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-34-5 name=__codelineno-34-5 href=#__codelineno-34-5></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>d</span><span class=p>.</span><span class=nx>CreationTimestamp</span><span class=p>.</span><span class=nx>Time</span>
<a id=__codelineno-34-6 name=__codelineno-34-6 href=#__codelineno-34-6></a><span class=p>}</span>
<a id=__codelineno-34-7 name=__codelineno-34-7 href=#__codelineno-34-7></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=nx>deploymentCell</span><span class=p>)</span><span class=w> </span><span class=nx>GetName</span><span class=p>()</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-34-8 name=__codelineno-34-8 href=#__codelineno-34-8></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>d</span><span class=p>.</span><span class=nx>Name</span>
<a id=__codelineno-34-9 name=__codelineno-34-9 href=#__codelineno-34-9></a><span class=p>}</span>
</code></pre></div> <h5 id=servicedeploymentgo>service/deployment.go<a class=headerlink href=#servicedeploymentgo title="Permanent link">&para;</a></h5> <p>开发deployment功能</p> <table> <thead> <tr> <th>功能</th> <th>是否实现</th> </tr> </thead> <tbody> <tr> <td>deployment列表</td> <td>√</td> </tr> <tr> <td>获取Deployment详情</td> <td>√</td> </tr> <tr> <td>修改Deployment副本数</td> <td>√</td> </tr> <tr> <td>创建Deployment</td> <td>√</td> </tr> <tr> <td>删除Deployment</td> <td>√</td> </tr> <tr> <td>重启Deployment</td> <td>√</td> </tr> <tr> <td>更新Deployment</td> <td>√</td> </tr> <tr> <td>获取每个namespace的Deployment数量</td> <td>√</td> </tr> </tbody> </table> <div class=highlight><pre><span></span><code><a id=__codelineno-35-1 name=__codelineno-35-1 href=#__codelineno-35-1></a><span class=kn>package</span><span class=w> </span><span class=nx>service</span>
<a id=__codelineno-35-2 name=__codelineno-35-2 href=#__codelineno-35-2></a>
<a id=__codelineno-35-3 name=__codelineno-35-3 href=#__codelineno-35-3></a><span class=kn>import</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-35-4 name=__codelineno-35-4 href=#__codelineno-35-4></a><span class=w>    </span><span class=s>&quot;context&quot;</span>
<a id=__codelineno-35-5 name=__codelineno-35-5 href=#__codelineno-35-5></a><span class=w>    </span><span class=s>&quot;encoding/json&quot;</span>
<a id=__codelineno-35-6 name=__codelineno-35-6 href=#__codelineno-35-6></a><span class=w>    </span><span class=s>&quot;errors&quot;</span>
<a id=__codelineno-35-7 name=__codelineno-35-7 href=#__codelineno-35-7></a><span class=w>    </span><span class=s>&quot;strconv&quot;</span>
<a id=__codelineno-35-8 name=__codelineno-35-8 href=#__codelineno-35-8></a><span class=w>    </span><span class=s>&quot;time&quot;</span>
<a id=__codelineno-35-9 name=__codelineno-35-9 href=#__codelineno-35-9></a>
<a id=__codelineno-35-10 name=__codelineno-35-10 href=#__codelineno-35-10></a><span class=w>    </span><span class=nx>corev1</span><span class=w> </span><span class=s>&quot;k8s.io/api/core/v1&quot;</span>
<a id=__codelineno-35-11 name=__codelineno-35-11 href=#__codelineno-35-11></a><span class=w>    </span><span class=s>&quot;k8s.io/apimachinery/pkg/api/resource&quot;</span>
<a id=__codelineno-35-12 name=__codelineno-35-12 href=#__codelineno-35-12></a><span class=w>    </span><span class=s>&quot;k8s.io/apimachinery/pkg/util/intstr&quot;</span>
<a id=__codelineno-35-13 name=__codelineno-35-13 href=#__codelineno-35-13></a>
<a id=__codelineno-35-14 name=__codelineno-35-14 href=#__codelineno-35-14></a><span class=w>    </span><span class=s>&quot;github.com/wonderivan/logger&quot;</span>
<a id=__codelineno-35-15 name=__codelineno-35-15 href=#__codelineno-35-15></a><span class=w>    </span><span class=nx>appsv1</span><span class=w> </span><span class=s>&quot;k8s.io/api/apps/v1&quot;</span>
<a id=__codelineno-35-16 name=__codelineno-35-16 href=#__codelineno-35-16></a><span class=w>    </span><span class=nx>metav1</span><span class=w> </span><span class=s>&quot;k8s.io/apimachinery/pkg/apis/meta/v1&quot;</span>
<a id=__codelineno-35-17 name=__codelineno-35-17 href=#__codelineno-35-17></a><span class=p>)</span>
<a id=__codelineno-35-18 name=__codelineno-35-18 href=#__codelineno-35-18></a>
<a id=__codelineno-35-19 name=__codelineno-35-19 href=#__codelineno-35-19></a><span class=kd>var</span><span class=w> </span><span class=nx>Deployment</span><span class=w> </span><span class=nx>deployment</span>
<a id=__codelineno-35-20 name=__codelineno-35-20 href=#__codelineno-35-20></a>
<a id=__codelineno-35-21 name=__codelineno-35-21 href=#__codelineno-35-21></a><span class=kd>type</span><span class=w> </span><span class=nx>deployment</span><span class=w> </span><span class=kd>struct</span><span class=p>{}</span>
<a id=__codelineno-35-22 name=__codelineno-35-22 href=#__codelineno-35-22></a>
<a id=__codelineno-35-23 name=__codelineno-35-23 href=#__codelineno-35-23></a><span class=c1>// DeploymentsResp 定义列表的返回内容，Items是deployment元素列表，Total为deployment元素数量</span>
<a id=__codelineno-35-24 name=__codelineno-35-24 href=#__codelineno-35-24></a><span class=kd>type</span><span class=w> </span><span class=nx>DeploymentsResp</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-35-25 name=__codelineno-35-25 href=#__codelineno-35-25></a><span class=w>    </span><span class=nx>Items</span><span class=w> </span><span class=p>[]</span><span class=nx>appsv1</span><span class=p>.</span><span class=nx>Deployment</span><span class=w> </span><span class=s>`json:&quot;items&quot;`</span>
<a id=__codelineno-35-26 name=__codelineno-35-26 href=#__codelineno-35-26></a><span class=w>    </span><span class=nx>Total</span><span class=w> </span><span class=kt>int</span><span class=w>                 </span><span class=s>`json:&quot;total&quot;`</span>
<a id=__codelineno-35-27 name=__codelineno-35-27 href=#__codelineno-35-27></a><span class=p>}</span>
<a id=__codelineno-35-28 name=__codelineno-35-28 href=#__codelineno-35-28></a>
<a id=__codelineno-35-29 name=__codelineno-35-29 href=#__codelineno-35-29></a><span class=c1>// DeployCreate 结构体，用于创建deployment需要的参数属性的定义</span>
<a id=__codelineno-35-30 name=__codelineno-35-30 href=#__codelineno-35-30></a><span class=kd>type</span><span class=w> </span><span class=nx>DeployCreate</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-35-31 name=__codelineno-35-31 href=#__codelineno-35-31></a><span class=w>    </span><span class=nx>Name</span><span class=w>          </span><span class=kt>string</span><span class=w>            </span><span class=s>`json:&quot;name&quot;`</span>
<a id=__codelineno-35-32 name=__codelineno-35-32 href=#__codelineno-35-32></a><span class=w>    </span><span class=nx>Namespace</span><span class=w>     </span><span class=kt>string</span><span class=w>            </span><span class=s>`json:&quot;namespace&quot;`</span>
<a id=__codelineno-35-33 name=__codelineno-35-33 href=#__codelineno-35-33></a><span class=w>    </span><span class=nx>Replicas</span><span class=w>      </span><span class=kt>int32</span><span class=w>             </span><span class=s>`json:&quot;replicas&quot;`</span>
<a id=__codelineno-35-34 name=__codelineno-35-34 href=#__codelineno-35-34></a><span class=w>    </span><span class=nx>Image</span><span class=w>         </span><span class=kt>string</span><span class=w>            </span><span class=s>`json:&quot;image&quot;`</span>
<a id=__codelineno-35-35 name=__codelineno-35-35 href=#__codelineno-35-35></a><span class=w>    </span><span class=nx>Label</span><span class=w>         </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;label&quot;`</span>
<a id=__codelineno-35-36 name=__codelineno-35-36 href=#__codelineno-35-36></a><span class=w>    </span><span class=nx>Cpu</span><span class=w>           </span><span class=kt>string</span><span class=w>            </span><span class=s>`json:&quot;cpu&quot;`</span>
<a id=__codelineno-35-37 name=__codelineno-35-37 href=#__codelineno-35-37></a><span class=w>    </span><span class=nx>Memory</span><span class=w>        </span><span class=kt>string</span><span class=w>            </span><span class=s>`json:&quot;memory&quot;`</span>
<a id=__codelineno-35-38 name=__codelineno-35-38 href=#__codelineno-35-38></a><span class=w>    </span><span class=nx>ContainerPort</span><span class=w> </span><span class=kt>int32</span><span class=w>             </span><span class=s>`json:&quot;container_port&quot;`</span>
<a id=__codelineno-35-39 name=__codelineno-35-39 href=#__codelineno-35-39></a><span class=w>    </span><span class=nx>HealthCheck</span><span class=w>   </span><span class=kt>bool</span><span class=w>              </span><span class=s>`json:&quot;health_check&quot;`</span>
<a id=__codelineno-35-40 name=__codelineno-35-40 href=#__codelineno-35-40></a><span class=w>    </span><span class=nx>HealthPath</span><span class=w>    </span><span class=kt>string</span><span class=w>            </span><span class=s>`json:&quot;health_path&quot;`</span>
<a id=__codelineno-35-41 name=__codelineno-35-41 href=#__codelineno-35-41></a><span class=p>}</span>
<a id=__codelineno-35-42 name=__codelineno-35-42 href=#__codelineno-35-42></a>
<a id=__codelineno-35-43 name=__codelineno-35-43 href=#__codelineno-35-43></a><span class=c1>// DeploysNp 类型，用于返回namespace中deployment的数量</span>
<a id=__codelineno-35-44 name=__codelineno-35-44 href=#__codelineno-35-44></a><span class=kd>type</span><span class=w> </span><span class=nx>DeploysNp</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-35-45 name=__codelineno-35-45 href=#__codelineno-35-45></a><span class=w>    </span><span class=nx>Namespace</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;namespace&quot;`</span>
<a id=__codelineno-35-46 name=__codelineno-35-46 href=#__codelineno-35-46></a><span class=w>    </span><span class=nx>DeployNum</span><span class=w> </span><span class=kt>int</span><span class=w>    </span><span class=s>`json:&quot;deployment_num&quot;`</span>
<a id=__codelineno-35-47 name=__codelineno-35-47 href=#__codelineno-35-47></a><span class=p>}</span>
<a id=__codelineno-35-48 name=__codelineno-35-48 href=#__codelineno-35-48></a>
<a id=__codelineno-35-49 name=__codelineno-35-49 href=#__codelineno-35-49></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>deployment</span><span class=p>)</span><span class=w> </span><span class=nx>toCells</span><span class=p>(</span><span class=nx>std</span><span class=w> </span><span class=p>[]</span><span class=nx>appsv1</span><span class=p>.</span><span class=nx>Deployment</span><span class=p>)</span><span class=w> </span><span class=p>[]</span><span class=nx>DataCell</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-35-50 name=__codelineno-35-50 href=#__codelineno-35-50></a><span class=w>    </span><span class=nx>cells</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>make</span><span class=p>([]</span><span class=nx>DataCell</span><span class=p>,</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>std</span><span class=p>))</span>
<a id=__codelineno-35-51 name=__codelineno-35-51 href=#__codelineno-35-51></a><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=nx>i</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>std</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-35-52 name=__codelineno-35-52 href=#__codelineno-35-52></a><span class=w>        </span><span class=nx>cells</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>deploymentCell</span><span class=p>(</span><span class=nx>std</span><span class=p>[</span><span class=nx>i</span><span class=p>])</span>
<a id=__codelineno-35-53 name=__codelineno-35-53 href=#__codelineno-35-53></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-35-54 name=__codelineno-35-54 href=#__codelineno-35-54></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>cells</span>
<a id=__codelineno-35-55 name=__codelineno-35-55 href=#__codelineno-35-55></a><span class=p>}</span>
<a id=__codelineno-35-56 name=__codelineno-35-56 href=#__codelineno-35-56></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>deployment</span><span class=p>)</span><span class=w> </span><span class=nx>fromCells</span><span class=p>(</span><span class=nx>cells</span><span class=w> </span><span class=p>[]</span><span class=nx>DataCell</span><span class=p>)</span><span class=w> </span><span class=p>[]</span><span class=nx>appsv1</span><span class=p>.</span><span class=nx>Deployment</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-35-57 name=__codelineno-35-57 href=#__codelineno-35-57></a><span class=w>    </span><span class=nx>deployments</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>make</span><span class=p>([]</span><span class=nx>appsv1</span><span class=p>.</span><span class=nx>Deployment</span><span class=p>,</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>cells</span><span class=p>))</span>
<a id=__codelineno-35-58 name=__codelineno-35-58 href=#__codelineno-35-58></a><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=nx>i</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>cells</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-35-59 name=__codelineno-35-59 href=#__codelineno-35-59></a><span class=w>        </span><span class=nx>deployments</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>appsv1</span><span class=p>.</span><span class=nx>Deployment</span><span class=p>(</span><span class=nx>cells</span><span class=p>[</span><span class=nx>i</span><span class=p>].(</span><span class=nx>deploymentCell</span><span class=p>))</span>
<a id=__codelineno-35-60 name=__codelineno-35-60 href=#__codelineno-35-60></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-35-61 name=__codelineno-35-61 href=#__codelineno-35-61></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>deployments</span>
<a id=__codelineno-35-62 name=__codelineno-35-62 href=#__codelineno-35-62></a><span class=p>}</span>
<a id=__codelineno-35-63 name=__codelineno-35-63 href=#__codelineno-35-63></a>
<a id=__codelineno-35-64 name=__codelineno-35-64 href=#__codelineno-35-64></a><span class=c1>// GetDeployments 获取deployment列表，支持过滤、排序、分页</span>
<a id=__codelineno-35-65 name=__codelineno-35-65 href=#__codelineno-35-65></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>deployment</span><span class=p>)</span><span class=w> </span><span class=nx>GetDeployments</span><span class=p>(</span><span class=nx>filterName</span><span class=p>,</span><span class=w> </span><span class=nx>namespace</span><span class=w> </span><span class=kt>string</span><span class=p>,</span><span class=w> </span><span class=nx>limit</span><span class=p>,</span><span class=w> </span><span class=nx>page</span><span class=w> </span><span class=kt>int</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>deploymentsResp</span><span class=w> </span><span class=o>*</span><span class=nx>DeploymentsResp</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-35-66 name=__codelineno-35-66 href=#__codelineno-35-66></a><span class=w>    </span><span class=c1>//获取deploymentList类型的deployment列表</span>
<a id=__codelineno-35-67 name=__codelineno-35-67 href=#__codelineno-35-67></a><span class=w>    </span><span class=nx>deploymentList</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>AppsV1</span><span class=p>().</span><span class=nx>Deployments</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span><span class=nx>List</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>ListOptions</span><span class=p>{})</span>
<a id=__codelineno-35-68 name=__codelineno-35-68 href=#__codelineno-35-68></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-35-69 name=__codelineno-35-69 href=#__codelineno-35-69></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取Deployment列表失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-35-70 name=__codelineno-35-70 href=#__codelineno-35-70></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取Deployment列表失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-35-71 name=__codelineno-35-71 href=#__codelineno-35-71></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-35-72 name=__codelineno-35-72 href=#__codelineno-35-72></a><span class=w>    </span><span class=c1>//将deploymentList中的deployment列表(Items),放进dataselector对象中，进行排序</span>
<a id=__codelineno-35-73 name=__codelineno-35-73 href=#__codelineno-35-73></a><span class=w>    </span><span class=nx>selectableData</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>dataSelector</span><span class=p>{</span>
<a id=__codelineno-35-74 name=__codelineno-35-74 href=#__codelineno-35-74></a><span class=w>        </span><span class=nx>GenericDataList</span><span class=p>:</span><span class=w> </span><span class=nx>d</span><span class=p>.</span><span class=nx>toCells</span><span class=p>(</span><span class=nx>deploymentList</span><span class=p>.</span><span class=nx>Items</span><span class=p>),</span>
<a id=__codelineno-35-75 name=__codelineno-35-75 href=#__codelineno-35-75></a><span class=w>        </span><span class=nx>dataSelectQuery</span><span class=p>:</span><span class=w> </span><span class=o>&amp;</span><span class=nx>DataSelectQuery</span><span class=p>{</span>
<a id=__codelineno-35-76 name=__codelineno-35-76 href=#__codelineno-35-76></a><span class=w>            </span><span class=nx>FilterQuery</span><span class=p>:</span><span class=w> </span><span class=o>&amp;</span><span class=nx>FilterQuery</span><span class=p>{</span><span class=nx>Name</span><span class=p>:</span><span class=w> </span><span class=nx>filterName</span><span class=p>},</span>
<a id=__codelineno-35-77 name=__codelineno-35-77 href=#__codelineno-35-77></a><span class=w>            </span><span class=nx>PaginateQuery</span><span class=p>:</span><span class=w> </span><span class=o>&amp;</span><span class=nx>PaginateQuery</span><span class=p>{</span>
<a id=__codelineno-35-78 name=__codelineno-35-78 href=#__codelineno-35-78></a><span class=w>                </span><span class=nx>Limit</span><span class=p>:</span><span class=w> </span><span class=nx>limit</span><span class=p>,</span>
<a id=__codelineno-35-79 name=__codelineno-35-79 href=#__codelineno-35-79></a><span class=w>                </span><span class=nx>Page</span><span class=p>:</span><span class=w>  </span><span class=nx>page</span><span class=p>,</span>
<a id=__codelineno-35-80 name=__codelineno-35-80 href=#__codelineno-35-80></a><span class=w>            </span><span class=p>},</span>
<a id=__codelineno-35-81 name=__codelineno-35-81 href=#__codelineno-35-81></a><span class=w>        </span><span class=p>},</span>
<a id=__codelineno-35-82 name=__codelineno-35-82 href=#__codelineno-35-82></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-35-83 name=__codelineno-35-83 href=#__codelineno-35-83></a><span class=w>    </span><span class=nx>filtered</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>selectableData</span><span class=p>.</span><span class=nx>Filter</span><span class=p>()</span>
<a id=__codelineno-35-84 name=__codelineno-35-84 href=#__codelineno-35-84></a><span class=w>    </span><span class=nx>total</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>filtered</span><span class=p>.</span><span class=nx>GenericDataList</span><span class=p>)</span>
<a id=__codelineno-35-85 name=__codelineno-35-85 href=#__codelineno-35-85></a><span class=w>    </span><span class=nx>data</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>filtered</span><span class=p>.</span><span class=nx>Sort</span><span class=p>().</span><span class=nx>Paginate</span><span class=p>()</span>
<a id=__codelineno-35-86 name=__codelineno-35-86 href=#__codelineno-35-86></a><span class=w>    </span><span class=c1>//将[]DataCell类型的deployment列表转为appsv1.deployment列表</span>
<a id=__codelineno-35-87 name=__codelineno-35-87 href=#__codelineno-35-87></a><span class=w>    </span><span class=nx>deployments</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>d</span><span class=p>.</span><span class=nx>fromCells</span><span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>GenericDataList</span><span class=p>)</span>
<a id=__codelineno-35-88 name=__codelineno-35-88 href=#__codelineno-35-88></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=o>&amp;</span><span class=nx>DeploymentsResp</span><span class=p>{</span>
<a id=__codelineno-35-89 name=__codelineno-35-89 href=#__codelineno-35-89></a><span class=w>        </span><span class=nx>Items</span><span class=p>:</span><span class=w> </span><span class=nx>deployments</span><span class=p>,</span>
<a id=__codelineno-35-90 name=__codelineno-35-90 href=#__codelineno-35-90></a><span class=w>        </span><span class=nx>Total</span><span class=p>:</span><span class=w> </span><span class=nx>total</span><span class=p>,</span>
<a id=__codelineno-35-91 name=__codelineno-35-91 href=#__codelineno-35-91></a><span class=w>    </span><span class=p>},</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-35-92 name=__codelineno-35-92 href=#__codelineno-35-92></a><span class=p>}</span>
<a id=__codelineno-35-93 name=__codelineno-35-93 href=#__codelineno-35-93></a>
<a id=__codelineno-35-94 name=__codelineno-35-94 href=#__codelineno-35-94></a><span class=c1>// GetDeploymentDetail 获取deployment详情</span>
<a id=__codelineno-35-95 name=__codelineno-35-95 href=#__codelineno-35-95></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>deployment</span><span class=p>)</span><span class=w> </span><span class=nx>GetDeploymentDetail</span><span class=p>(</span><span class=nx>deploymentName</span><span class=p>,</span><span class=w> </span><span class=nx>namespace</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>deployment</span><span class=w> </span><span class=o>*</span><span class=nx>appsv1</span><span class=p>.</span><span class=nx>Deployment</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-35-96 name=__codelineno-35-96 href=#__codelineno-35-96></a><span class=w>    </span><span class=nx>deployment</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>AppsV1</span><span class=p>().</span><span class=nx>Deployments</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span><span class=nx>Get</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>deploymentName</span><span class=p>,</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>GetOptions</span><span class=p>{})</span>
<a id=__codelineno-35-97 name=__codelineno-35-97 href=#__codelineno-35-97></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-35-98 name=__codelineno-35-98 href=#__codelineno-35-98></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取Deployment详情失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-35-99 name=__codelineno-35-99 href=#__codelineno-35-99></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取Deployment详情失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-35-100 name=__codelineno-35-100 href=#__codelineno-35-100></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-35-101 name=__codelineno-35-101 href=#__codelineno-35-101></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>deployment</span><span class=p>,</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-35-102 name=__codelineno-35-102 href=#__codelineno-35-102></a><span class=p>}</span>
<a id=__codelineno-35-103 name=__codelineno-35-103 href=#__codelineno-35-103></a>
<a id=__codelineno-35-104 name=__codelineno-35-104 href=#__codelineno-35-104></a><span class=c1>// ScaleDeployment 设置deployment副本数</span>
<a id=__codelineno-35-105 name=__codelineno-35-105 href=#__codelineno-35-105></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>deployment</span><span class=p>)</span><span class=w> </span><span class=nx>ScaleDeployment</span><span class=p>(</span><span class=nx>deploymentName</span><span class=p>,</span><span class=w> </span><span class=nx>namespace</span><span class=w> </span><span class=kt>string</span><span class=p>,</span><span class=w> </span><span class=nx>scaleNum</span><span class=w> </span><span class=kt>int</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>replica</span><span class=w> </span><span class=kt>int32</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-35-106 name=__codelineno-35-106 href=#__codelineno-35-106></a><span class=w>    </span><span class=c1>//获取autoscalingv1.Scale类型的对象，能点出当前的副本数</span>
<a id=__codelineno-35-107 name=__codelineno-35-107 href=#__codelineno-35-107></a><span class=w>    </span><span class=nx>scale</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>AppsV1</span><span class=p>().</span><span class=nx>Deployments</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span><span class=nx>GetScale</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>deploymentName</span><span class=p>,</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>GetOptions</span><span class=p>{})</span>
<a id=__codelineno-35-108 name=__codelineno-35-108 href=#__codelineno-35-108></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-35-109 name=__codelineno-35-109 href=#__codelineno-35-109></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取Deployment副本数信息失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-35-110 name=__codelineno-35-110 href=#__codelineno-35-110></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取Deployment副本数信息失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-35-111 name=__codelineno-35-111 href=#__codelineno-35-111></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-35-112 name=__codelineno-35-112 href=#__codelineno-35-112></a><span class=w>    </span><span class=c1>//修改副本数</span>
<a id=__codelineno-35-113 name=__codelineno-35-113 href=#__codelineno-35-113></a><span class=w>    </span><span class=nx>scale</span><span class=p>.</span><span class=nx>Spec</span><span class=p>.</span><span class=nx>Replicas</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nb>int32</span><span class=p>(</span><span class=nx>scaleNum</span><span class=p>)</span>
<a id=__codelineno-35-114 name=__codelineno-35-114 href=#__codelineno-35-114></a><span class=w>    </span><span class=c1>//更新副本数，传入scale对象</span>
<a id=__codelineno-35-115 name=__codelineno-35-115 href=#__codelineno-35-115></a><span class=w>    </span><span class=nx>newScale</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>AppsV1</span><span class=p>().</span><span class=nx>Deployments</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span><span class=nx>UpdateScale</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>deploymentName</span><span class=p>,</span><span class=w> </span><span class=nx>scale</span><span class=p>,</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>UpdateOptions</span><span class=p>{})</span>
<a id=__codelineno-35-116 name=__codelineno-35-116 href=#__codelineno-35-116></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-35-117 name=__codelineno-35-117 href=#__codelineno-35-117></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;更新Deployment副本数信息失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-35-118 name=__codelineno-35-118 href=#__codelineno-35-118></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;更新Deployment副本数信息失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-35-119 name=__codelineno-35-119 href=#__codelineno-35-119></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-35-120 name=__codelineno-35-120 href=#__codelineno-35-120></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>newScale</span><span class=p>.</span><span class=nx>Spec</span><span class=p>.</span><span class=nx>Replicas</span><span class=p>,</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-35-121 name=__codelineno-35-121 href=#__codelineno-35-121></a><span class=p>}</span>
<a id=__codelineno-35-122 name=__codelineno-35-122 href=#__codelineno-35-122></a>
<a id=__codelineno-35-123 name=__codelineno-35-123 href=#__codelineno-35-123></a><span class=c1>// CreateDeployment 创建deployment，接收DeployCreate对象</span>
<a id=__codelineno-35-124 name=__codelineno-35-124 href=#__codelineno-35-124></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>deployment</span><span class=p>)</span><span class=w> </span><span class=nx>CreateDeployment</span><span class=p>(</span><span class=nx>data</span><span class=w> </span><span class=o>*</span><span class=nx>DeployCreate</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-35-125 name=__codelineno-35-125 href=#__codelineno-35-125></a><span class=w>    </span><span class=c1>//将data中的数据组装成appsv1.Deployment对象</span>
<a id=__codelineno-35-126 name=__codelineno-35-126 href=#__codelineno-35-126></a><span class=w>    </span><span class=nx>deployment</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>appsv1</span><span class=p>.</span><span class=nx>Deployment</span><span class=p>{</span>
<a id=__codelineno-35-127 name=__codelineno-35-127 href=#__codelineno-35-127></a><span class=w>        </span><span class=c1>//ObjectMeta中定义资源名、命名空间以及标签</span>
<a id=__codelineno-35-128 name=__codelineno-35-128 href=#__codelineno-35-128></a><span class=w>        </span><span class=nx>ObjectMeta</span><span class=p>:</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>ObjectMeta</span><span class=p>{</span>
<a id=__codelineno-35-129 name=__codelineno-35-129 href=#__codelineno-35-129></a><span class=w>            </span><span class=nx>Name</span><span class=p>:</span><span class=w>      </span><span class=nx>data</span><span class=p>.</span><span class=nx>Name</span><span class=p>,</span>
<a id=__codelineno-35-130 name=__codelineno-35-130 href=#__codelineno-35-130></a><span class=w>            </span><span class=nx>Namespace</span><span class=p>:</span><span class=w> </span><span class=nx>data</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>,</span>
<a id=__codelineno-35-131 name=__codelineno-35-131 href=#__codelineno-35-131></a><span class=w>            </span><span class=nx>Labels</span><span class=p>:</span><span class=w>    </span><span class=nx>data</span><span class=p>.</span><span class=nx>Label</span><span class=p>,</span>
<a id=__codelineno-35-132 name=__codelineno-35-132 href=#__codelineno-35-132></a><span class=w>        </span><span class=p>},</span>
<a id=__codelineno-35-133 name=__codelineno-35-133 href=#__codelineno-35-133></a><span class=w>        </span><span class=c1>//Spec中定义副本数、选择器、以及pod属性</span>
<a id=__codelineno-35-134 name=__codelineno-35-134 href=#__codelineno-35-134></a><span class=w>        </span><span class=nx>Spec</span><span class=p>:</span><span class=w> </span><span class=nx>appsv1</span><span class=p>.</span><span class=nx>DeploymentSpec</span><span class=p>{</span>
<a id=__codelineno-35-135 name=__codelineno-35-135 href=#__codelineno-35-135></a><span class=w>            </span><span class=nx>Replicas</span><span class=p>:</span><span class=w> </span><span class=o>&amp;</span><span class=nx>data</span><span class=p>.</span><span class=nx>Replicas</span><span class=p>,</span>
<a id=__codelineno-35-136 name=__codelineno-35-136 href=#__codelineno-35-136></a><span class=w>            </span><span class=nx>Selector</span><span class=p>:</span><span class=w> </span><span class=o>&amp;</span><span class=nx>metav1</span><span class=p>.</span><span class=nx>LabelSelector</span><span class=p>{</span>
<a id=__codelineno-35-137 name=__codelineno-35-137 href=#__codelineno-35-137></a><span class=w>                </span><span class=nx>MatchLabels</span><span class=p>:</span><span class=w> </span><span class=nx>data</span><span class=p>.</span><span class=nx>Label</span><span class=p>,</span>
<a id=__codelineno-35-138 name=__codelineno-35-138 href=#__codelineno-35-138></a><span class=w>            </span><span class=p>},</span>
<a id=__codelineno-35-139 name=__codelineno-35-139 href=#__codelineno-35-139></a><span class=w>            </span><span class=nx>Template</span><span class=p>:</span><span class=w> </span><span class=nx>corev1</span><span class=p>.</span><span class=nx>PodTemplateSpec</span><span class=p>{</span>
<a id=__codelineno-35-140 name=__codelineno-35-140 href=#__codelineno-35-140></a><span class=w>                </span><span class=c1>//定义pod名和标签</span>
<a id=__codelineno-35-141 name=__codelineno-35-141 href=#__codelineno-35-141></a><span class=w>                </span><span class=nx>ObjectMeta</span><span class=p>:</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>ObjectMeta</span><span class=p>{</span>
<a id=__codelineno-35-142 name=__codelineno-35-142 href=#__codelineno-35-142></a><span class=w>                    </span><span class=nx>Name</span><span class=p>:</span><span class=w>   </span><span class=nx>data</span><span class=p>.</span><span class=nx>Name</span><span class=p>,</span>
<a id=__codelineno-35-143 name=__codelineno-35-143 href=#__codelineno-35-143></a><span class=w>                    </span><span class=nx>Labels</span><span class=p>:</span><span class=w> </span><span class=nx>data</span><span class=p>.</span><span class=nx>Label</span><span class=p>,</span>
<a id=__codelineno-35-144 name=__codelineno-35-144 href=#__codelineno-35-144></a><span class=w>                </span><span class=p>},</span>
<a id=__codelineno-35-145 name=__codelineno-35-145 href=#__codelineno-35-145></a><span class=w>                </span><span class=c1>//定义容器名、镜像和端口</span>
<a id=__codelineno-35-146 name=__codelineno-35-146 href=#__codelineno-35-146></a><span class=w>                </span><span class=nx>Spec</span><span class=p>:</span><span class=w> </span><span class=nx>corev1</span><span class=p>.</span><span class=nx>PodSpec</span><span class=p>{</span>
<a id=__codelineno-35-147 name=__codelineno-35-147 href=#__codelineno-35-147></a><span class=w>                    </span><span class=nx>Containers</span><span class=p>:</span><span class=w> </span><span class=p>[]</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>Container</span><span class=p>{</span>
<a id=__codelineno-35-148 name=__codelineno-35-148 href=#__codelineno-35-148></a><span class=w>                        </span><span class=p>{</span>
<a id=__codelineno-35-149 name=__codelineno-35-149 href=#__codelineno-35-149></a><span class=w>                            </span><span class=nx>Name</span><span class=p>:</span><span class=w>  </span><span class=nx>data</span><span class=p>.</span><span class=nx>Name</span><span class=p>,</span>
<a id=__codelineno-35-150 name=__codelineno-35-150 href=#__codelineno-35-150></a><span class=w>                            </span><span class=nx>Image</span><span class=p>:</span><span class=w> </span><span class=nx>data</span><span class=p>.</span><span class=nx>Image</span><span class=p>,</span>
<a id=__codelineno-35-151 name=__codelineno-35-151 href=#__codelineno-35-151></a><span class=w>                            </span><span class=nx>Ports</span><span class=p>:</span><span class=w> </span><span class=p>[]</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>ContainerPort</span><span class=p>{</span>
<a id=__codelineno-35-152 name=__codelineno-35-152 href=#__codelineno-35-152></a><span class=w>                                </span><span class=p>{</span>
<a id=__codelineno-35-153 name=__codelineno-35-153 href=#__codelineno-35-153></a><span class=w>                                    </span><span class=nx>Name</span><span class=p>:</span><span class=w>          </span><span class=s>&quot;http&quot;</span><span class=p>,</span>
<a id=__codelineno-35-154 name=__codelineno-35-154 href=#__codelineno-35-154></a><span class=w>                                    </span><span class=nx>Protocol</span><span class=p>:</span><span class=w>      </span><span class=nx>corev1</span><span class=p>.</span><span class=nx>ProtocolTCP</span><span class=p>,</span>
<a id=__codelineno-35-155 name=__codelineno-35-155 href=#__codelineno-35-155></a><span class=w>                                    </span><span class=nx>ContainerPort</span><span class=p>:</span><span class=w> </span><span class=nx>data</span><span class=p>.</span><span class=nx>ContainerPort</span><span class=p>,</span>
<a id=__codelineno-35-156 name=__codelineno-35-156 href=#__codelineno-35-156></a><span class=w>                                </span><span class=p>},</span>
<a id=__codelineno-35-157 name=__codelineno-35-157 href=#__codelineno-35-157></a><span class=w>                            </span><span class=p>},</span>
<a id=__codelineno-35-158 name=__codelineno-35-158 href=#__codelineno-35-158></a><span class=w>                        </span><span class=p>},</span>
<a id=__codelineno-35-159 name=__codelineno-35-159 href=#__codelineno-35-159></a><span class=w>                    </span><span class=p>},</span>
<a id=__codelineno-35-160 name=__codelineno-35-160 href=#__codelineno-35-160></a><span class=w>                </span><span class=p>},</span>
<a id=__codelineno-35-161 name=__codelineno-35-161 href=#__codelineno-35-161></a><span class=w>            </span><span class=p>},</span>
<a id=__codelineno-35-162 name=__codelineno-35-162 href=#__codelineno-35-162></a><span class=w>        </span><span class=p>},</span>
<a id=__codelineno-35-163 name=__codelineno-35-163 href=#__codelineno-35-163></a><span class=w>        </span><span class=c1>//Status定义资源的运行状态，这里由于是新建，传入空的appsv1.DeploymentStatus{}对象即可</span>
<a id=__codelineno-35-164 name=__codelineno-35-164 href=#__codelineno-35-164></a><span class=w>        </span><span class=nx>Status</span><span class=p>:</span><span class=w> </span><span class=nx>appsv1</span><span class=p>.</span><span class=nx>DeploymentStatus</span><span class=p>{},</span>
<a id=__codelineno-35-165 name=__codelineno-35-165 href=#__codelineno-35-165></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-35-166 name=__codelineno-35-166 href=#__codelineno-35-166></a><span class=w>    </span><span class=c1>//判断是否打开健康检查功能，若打开，则定义ReadinessProbe和LivenessProbe</span>
<a id=__codelineno-35-167 name=__codelineno-35-167 href=#__codelineno-35-167></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>data</span><span class=p>.</span><span class=nx>HealthCheck</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-35-168 name=__codelineno-35-168 href=#__codelineno-35-168></a><span class=w>        </span><span class=c1>//设置第一个容器的ReadinessProbe,因为我们pod中只有一个容器，所以直接使用index 0即可</span>
<a id=__codelineno-35-169 name=__codelineno-35-169 href=#__codelineno-35-169></a><span class=w>        </span><span class=c1>//若pod中有多个容器，则这里需要使用for循环去定义了</span>
<a id=__codelineno-35-170 name=__codelineno-35-170 href=#__codelineno-35-170></a><span class=w>        </span><span class=nx>deployment</span><span class=p>.</span><span class=nx>Spec</span><span class=p>.</span><span class=nx>Template</span><span class=p>.</span><span class=nx>Spec</span><span class=p>.</span><span class=nx>Containers</span><span class=p>[</span><span class=mi>0</span><span class=p>].</span><span class=nx>ReadinessProbe</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>Probe</span><span class=p>{</span>
<a id=__codelineno-35-171 name=__codelineno-35-171 href=#__codelineno-35-171></a><span class=w>            </span><span class=nx>ProbeHandler</span><span class=p>:</span><span class=w> </span><span class=nx>corev1</span><span class=p>.</span><span class=nx>ProbeHandler</span><span class=p>{</span>
<a id=__codelineno-35-172 name=__codelineno-35-172 href=#__codelineno-35-172></a><span class=w>                </span><span class=nx>HTTPGet</span><span class=p>:</span><span class=w> </span><span class=o>&amp;</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>HTTPGetAction</span><span class=p>{</span>
<a id=__codelineno-35-173 name=__codelineno-35-173 href=#__codelineno-35-173></a><span class=w>                    </span><span class=nx>Path</span><span class=p>:</span><span class=w> </span><span class=nx>data</span><span class=p>.</span><span class=nx>HealthPath</span><span class=p>,</span>
<a id=__codelineno-35-174 name=__codelineno-35-174 href=#__codelineno-35-174></a><span class=w>                    </span><span class=c1>//intstr.IntOrString的作用是端口可以定义为整型，也可以定义为字符串</span>
<a id=__codelineno-35-175 name=__codelineno-35-175 href=#__codelineno-35-175></a><span class=w>                    </span><span class=c1>//Type=0则表示该结构体实例内的数据为整型，转json时只使用IntVal的数据</span>
<a id=__codelineno-35-176 name=__codelineno-35-176 href=#__codelineno-35-176></a><span class=w>                    </span><span class=c1>//Type=1则表示该结构体实例内的数据为字符串，转json时只使用StrVal的数据</span>
<a id=__codelineno-35-177 name=__codelineno-35-177 href=#__codelineno-35-177></a><span class=w>                    </span><span class=nx>Port</span><span class=p>:</span><span class=w> </span><span class=nx>intstr</span><span class=p>.</span><span class=nx>IntOrString</span><span class=p>{</span>
<a id=__codelineno-35-178 name=__codelineno-35-178 href=#__codelineno-35-178></a><span class=w>                        </span><span class=nx>Type</span><span class=p>:</span><span class=w>   </span><span class=mi>0</span><span class=p>,</span>
<a id=__codelineno-35-179 name=__codelineno-35-179 href=#__codelineno-35-179></a><span class=w>                        </span><span class=nx>IntVal</span><span class=p>:</span><span class=w> </span><span class=nx>data</span><span class=p>.</span><span class=nx>ContainerPort</span><span class=p>,</span>
<a id=__codelineno-35-180 name=__codelineno-35-180 href=#__codelineno-35-180></a><span class=w>                    </span><span class=p>},</span>
<a id=__codelineno-35-181 name=__codelineno-35-181 href=#__codelineno-35-181></a><span class=w>                </span><span class=p>},</span>
<a id=__codelineno-35-182 name=__codelineno-35-182 href=#__codelineno-35-182></a><span class=w>            </span><span class=p>},</span>
<a id=__codelineno-35-183 name=__codelineno-35-183 href=#__codelineno-35-183></a><span class=w>            </span><span class=c1>//初始化等待时间</span>
<a id=__codelineno-35-184 name=__codelineno-35-184 href=#__codelineno-35-184></a><span class=w>            </span><span class=nx>InitialDelaySeconds</span><span class=p>:</span><span class=w> </span><span class=mi>5</span><span class=p>,</span>
<a id=__codelineno-35-185 name=__codelineno-35-185 href=#__codelineno-35-185></a><span class=w>            </span><span class=c1>//超时时间</span>
<a id=__codelineno-35-186 name=__codelineno-35-186 href=#__codelineno-35-186></a><span class=w>            </span><span class=nx>TimeoutSeconds</span><span class=p>:</span><span class=w> </span><span class=mi>5</span><span class=p>,</span>
<a id=__codelineno-35-187 name=__codelineno-35-187 href=#__codelineno-35-187></a><span class=w>            </span><span class=c1>//执行间隔</span>
<a id=__codelineno-35-188 name=__codelineno-35-188 href=#__codelineno-35-188></a><span class=w>            </span><span class=nx>PeriodSeconds</span><span class=p>:</span><span class=w> </span><span class=mi>5</span><span class=p>,</span>
<a id=__codelineno-35-189 name=__codelineno-35-189 href=#__codelineno-35-189></a><span class=w>        </span><span class=p>}</span>
<a id=__codelineno-35-190 name=__codelineno-35-190 href=#__codelineno-35-190></a><span class=w>        </span><span class=nx>deployment</span><span class=p>.</span><span class=nx>Spec</span><span class=p>.</span><span class=nx>Template</span><span class=p>.</span><span class=nx>Spec</span><span class=p>.</span><span class=nx>Containers</span><span class=p>[</span><span class=mi>0</span><span class=p>].</span><span class=nx>LivenessProbe</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>Probe</span><span class=p>{</span>
<a id=__codelineno-35-191 name=__codelineno-35-191 href=#__codelineno-35-191></a><span class=w>            </span><span class=nx>ProbeHandler</span><span class=p>:</span><span class=w> </span><span class=nx>corev1</span><span class=p>.</span><span class=nx>ProbeHandler</span><span class=p>{</span>
<a id=__codelineno-35-192 name=__codelineno-35-192 href=#__codelineno-35-192></a><span class=w>                </span><span class=nx>HTTPGet</span><span class=p>:</span><span class=w> </span><span class=o>&amp;</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>HTTPGetAction</span><span class=p>{</span>
<a id=__codelineno-35-193 name=__codelineno-35-193 href=#__codelineno-35-193></a><span class=w>                    </span><span class=nx>Path</span><span class=p>:</span><span class=w> </span><span class=nx>data</span><span class=p>.</span><span class=nx>HealthPath</span><span class=p>,</span>
<a id=__codelineno-35-194 name=__codelineno-35-194 href=#__codelineno-35-194></a><span class=w>                    </span><span class=nx>Port</span><span class=p>:</span><span class=w> </span><span class=nx>intstr</span><span class=p>.</span><span class=nx>IntOrString</span><span class=p>{</span>
<a id=__codelineno-35-195 name=__codelineno-35-195 href=#__codelineno-35-195></a><span class=w>                        </span><span class=nx>Type</span><span class=p>:</span><span class=w>   </span><span class=mi>0</span><span class=p>,</span>
<a id=__codelineno-35-196 name=__codelineno-35-196 href=#__codelineno-35-196></a><span class=w>                        </span><span class=nx>IntVal</span><span class=p>:</span><span class=w> </span><span class=nx>data</span><span class=p>.</span><span class=nx>ContainerPort</span><span class=p>,</span>
<a id=__codelineno-35-197 name=__codelineno-35-197 href=#__codelineno-35-197></a><span class=w>                    </span><span class=p>},</span>
<a id=__codelineno-35-198 name=__codelineno-35-198 href=#__codelineno-35-198></a><span class=w>                </span><span class=p>},</span>
<a id=__codelineno-35-199 name=__codelineno-35-199 href=#__codelineno-35-199></a><span class=w>            </span><span class=p>},</span>
<a id=__codelineno-35-200 name=__codelineno-35-200 href=#__codelineno-35-200></a><span class=w>            </span><span class=nx>InitialDelaySeconds</span><span class=p>:</span><span class=w> </span><span class=mi>15</span><span class=p>,</span>
<a id=__codelineno-35-201 name=__codelineno-35-201 href=#__codelineno-35-201></a><span class=w>            </span><span class=nx>TimeoutSeconds</span><span class=p>:</span><span class=w>      </span><span class=mi>5</span><span class=p>,</span>
<a id=__codelineno-35-202 name=__codelineno-35-202 href=#__codelineno-35-202></a><span class=w>            </span><span class=nx>PeriodSeconds</span><span class=p>:</span><span class=w>       </span><span class=mi>5</span><span class=p>,</span>
<a id=__codelineno-35-203 name=__codelineno-35-203 href=#__codelineno-35-203></a><span class=w>        </span><span class=p>}</span>
<a id=__codelineno-35-204 name=__codelineno-35-204 href=#__codelineno-35-204></a><span class=w>        </span><span class=c1>//定义容器的limit和request资源</span>
<a id=__codelineno-35-205 name=__codelineno-35-205 href=#__codelineno-35-205></a><span class=w>        </span><span class=nx>deployment</span><span class=p>.</span><span class=nx>Spec</span><span class=p>.</span><span class=nx>Template</span><span class=p>.</span><span class=nx>Spec</span><span class=p>.</span><span class=nx>Containers</span><span class=p>[</span><span class=mi>0</span><span class=p>].</span><span class=nx>Resources</span><span class=p>.</span><span class=nx>Limits</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>ResourceName</span><span class=p>]</span><span class=nx>resource</span><span class=p>.</span><span class=nx>Quantity</span><span class=p>{</span>
<a id=__codelineno-35-206 name=__codelineno-35-206 href=#__codelineno-35-206></a><span class=w>            </span><span class=nx>corev1</span><span class=p>.</span><span class=nx>ResourceCPU</span><span class=p>:</span><span class=w>    </span><span class=nx>resource</span><span class=p>.</span><span class=nx>MustParse</span><span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>Cpu</span><span class=p>),</span>
<a id=__codelineno-35-207 name=__codelineno-35-207 href=#__codelineno-35-207></a><span class=w>            </span><span class=nx>corev1</span><span class=p>.</span><span class=nx>ResourceMemory</span><span class=p>:</span><span class=w> </span><span class=nx>resource</span><span class=p>.</span><span class=nx>MustParse</span><span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>Memory</span><span class=p>),</span>
<a id=__codelineno-35-208 name=__codelineno-35-208 href=#__codelineno-35-208></a><span class=w>        </span><span class=p>}</span>
<a id=__codelineno-35-209 name=__codelineno-35-209 href=#__codelineno-35-209></a><span class=w>        </span><span class=nx>deployment</span><span class=p>.</span><span class=nx>Spec</span><span class=p>.</span><span class=nx>Template</span><span class=p>.</span><span class=nx>Spec</span><span class=p>.</span><span class=nx>Containers</span><span class=p>[</span><span class=mi>0</span><span class=p>].</span><span class=nx>Resources</span><span class=p>.</span><span class=nx>Requests</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>ResourceName</span><span class=p>]</span><span class=nx>resource</span><span class=p>.</span><span class=nx>Quantity</span><span class=p>{</span>
<a id=__codelineno-35-210 name=__codelineno-35-210 href=#__codelineno-35-210></a><span class=w>            </span><span class=nx>corev1</span><span class=p>.</span><span class=nx>ResourceCPU</span><span class=p>:</span><span class=w>    </span><span class=nx>resource</span><span class=p>.</span><span class=nx>MustParse</span><span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>Cpu</span><span class=p>),</span>
<a id=__codelineno-35-211 name=__codelineno-35-211 href=#__codelineno-35-211></a><span class=w>            </span><span class=nx>corev1</span><span class=p>.</span><span class=nx>ResourceMemory</span><span class=p>:</span><span class=w> </span><span class=nx>resource</span><span class=p>.</span><span class=nx>MustParse</span><span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>Memory</span><span class=p>),</span>
<a id=__codelineno-35-212 name=__codelineno-35-212 href=#__codelineno-35-212></a><span class=w>        </span><span class=p>}</span>
<a id=__codelineno-35-213 name=__codelineno-35-213 href=#__codelineno-35-213></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-35-214 name=__codelineno-35-214 href=#__codelineno-35-214></a><span class=w>    </span><span class=c1>//调用sdk创建deployment</span>
<a id=__codelineno-35-215 name=__codelineno-35-215 href=#__codelineno-35-215></a><span class=w>    </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>AppsV1</span><span class=p>().</span><span class=nx>Deployments</span><span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>).</span><span class=nx>Create</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>deployment</span><span class=p>,</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>CreateOptions</span><span class=p>{})</span>
<a id=__codelineno-35-216 name=__codelineno-35-216 href=#__codelineno-35-216></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-35-217 name=__codelineno-35-217 href=#__codelineno-35-217></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;创建Deployment失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-35-218 name=__codelineno-35-218 href=#__codelineno-35-218></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;创建Deployment失败,&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-35-219 name=__codelineno-35-219 href=#__codelineno-35-219></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-35-220 name=__codelineno-35-220 href=#__codelineno-35-220></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-35-221 name=__codelineno-35-221 href=#__codelineno-35-221></a><span class=p>}</span>
<a id=__codelineno-35-222 name=__codelineno-35-222 href=#__codelineno-35-222></a>
<a id=__codelineno-35-223 name=__codelineno-35-223 href=#__codelineno-35-223></a><span class=c1>// DeleteDeployment 删除deployment</span>
<a id=__codelineno-35-224 name=__codelineno-35-224 href=#__codelineno-35-224></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>deployment</span><span class=p>)</span><span class=w> </span><span class=nx>DeleteDeployment</span><span class=p>(</span><span class=nx>deploymentName</span><span class=p>,</span><span class=w> </span><span class=nx>namespace</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-35-225 name=__codelineno-35-225 href=#__codelineno-35-225></a><span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>AppsV1</span><span class=p>().</span><span class=nx>Deployments</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span><span class=nx>Delete</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>deploymentName</span><span class=p>,</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>DeleteOptions</span><span class=p>{})</span>
<a id=__codelineno-35-226 name=__codelineno-35-226 href=#__codelineno-35-226></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-35-227 name=__codelineno-35-227 href=#__codelineno-35-227></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;删除Deployment失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-35-228 name=__codelineno-35-228 href=#__codelineno-35-228></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;删除Deployment失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-35-229 name=__codelineno-35-229 href=#__codelineno-35-229></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-35-230 name=__codelineno-35-230 href=#__codelineno-35-230></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-35-231 name=__codelineno-35-231 href=#__codelineno-35-231></a><span class=p>}</span>
<a id=__codelineno-35-232 name=__codelineno-35-232 href=#__codelineno-35-232></a>
<a id=__codelineno-35-233 name=__codelineno-35-233 href=#__codelineno-35-233></a><span class=c1>// RestartDeployment 重启deployment</span>
<a id=__codelineno-35-234 name=__codelineno-35-234 href=#__codelineno-35-234></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>deployment</span><span class=p>)</span><span class=w> </span><span class=nx>RestartDeployment</span><span class=p>(</span><span class=nx>deploymentName</span><span class=p>,</span><span class=w> </span><span class=nx>namespace</span><span class=p>,</span><span class=w> </span><span class=nx>imageName</span><span class=p>,</span><span class=w> </span><span class=nx>image</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-35-235 name=__codelineno-35-235 href=#__codelineno-35-235></a><span class=w>    </span><span class=c1>//此功能等同于以下kubectl命令</span>
<a id=__codelineno-35-236 name=__codelineno-35-236 href=#__codelineno-35-236></a><span class=w>    </span><span class=c1>//kubectl deployment ${service} -p \</span>
<a id=__codelineno-35-237 name=__codelineno-35-237 href=#__codelineno-35-237></a><span class=w>    </span><span class=c1>//&#39;{&quot;spec&quot;:{&quot;template&quot;:{&quot;spec&quot;:{&quot;containers&quot;:[{&quot;name&quot;:&quot;&#39;&quot;${service}&quot;&#39;&quot;,&quot;env&quot;:</span>
<a id=__codelineno-35-238 name=__codelineno-35-238 href=#__codelineno-35-238></a><span class=w>    </span><span class=c1>//[{&quot;name&quot;:&quot;RESTART_&quot;,&quot;value&quot;:&quot;&#39;$(date +%s)&#39;&quot;}]}]}}}}&#39;</span>
<a id=__codelineno-35-239 name=__codelineno-35-239 href=#__codelineno-35-239></a>
<a id=__codelineno-35-240 name=__codelineno-35-240 href=#__codelineno-35-240></a><span class=w>    </span><span class=c1>//使用patchData Map组装数据</span>
<a id=__codelineno-35-241 name=__codelineno-35-241 href=#__codelineno-35-241></a><span class=w>    </span><span class=nx>patchData</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kd>interface</span><span class=p>{}{</span>
<a id=__codelineno-35-242 name=__codelineno-35-242 href=#__codelineno-35-242></a><span class=w>        </span><span class=s>&quot;metadata&quot;</span><span class=p>:</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kd>interface</span><span class=p>{}{</span>
<a id=__codelineno-35-243 name=__codelineno-35-243 href=#__codelineno-35-243></a><span class=w>            </span><span class=s>&quot;name&quot;</span><span class=p>:</span><span class=w>      </span><span class=nx>deploymentName</span><span class=p>,</span>
<a id=__codelineno-35-244 name=__codelineno-35-244 href=#__codelineno-35-244></a><span class=w>            </span><span class=s>&quot;namespace&quot;</span><span class=p>:</span><span class=w> </span><span class=nx>namespace</span><span class=p>,</span>
<a id=__codelineno-35-245 name=__codelineno-35-245 href=#__codelineno-35-245></a><span class=w>        </span><span class=p>},</span>
<a id=__codelineno-35-246 name=__codelineno-35-246 href=#__codelineno-35-246></a><span class=w>        </span><span class=s>&quot;spec&quot;</span><span class=p>:</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kd>interface</span><span class=p>{}{</span>
<a id=__codelineno-35-247 name=__codelineno-35-247 href=#__codelineno-35-247></a><span class=w>            </span><span class=s>&quot;template&quot;</span><span class=p>:</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kd>interface</span><span class=p>{}{</span>
<a id=__codelineno-35-248 name=__codelineno-35-248 href=#__codelineno-35-248></a><span class=w>                </span><span class=s>&quot;spec&quot;</span><span class=p>:</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kd>interface</span><span class=p>{}{</span>
<a id=__codelineno-35-249 name=__codelineno-35-249 href=#__codelineno-35-249></a><span class=w>                    </span><span class=s>&quot;containers&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[]</span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kd>interface</span><span class=p>{}{</span>
<a id=__codelineno-35-250 name=__codelineno-35-250 href=#__codelineno-35-250></a><span class=w>                        </span><span class=p>{</span>
<a id=__codelineno-35-251 name=__codelineno-35-251 href=#__codelineno-35-251></a><span class=w>                            </span><span class=s>&quot;name&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>imageName</span><span class=p>,</span>
<a id=__codelineno-35-252 name=__codelineno-35-252 href=#__codelineno-35-252></a><span class=w>                            </span><span class=s>&quot;image&quot;</span><span class=p>:</span><span class=w> </span><span class=nx>image</span><span class=p>,</span>
<a id=__codelineno-35-253 name=__codelineno-35-253 href=#__codelineno-35-253></a><span class=w>                            </span><span class=s>&quot;env&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[]</span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>string</span><span class=p>{{</span>
<a id=__codelineno-35-254 name=__codelineno-35-254 href=#__codelineno-35-254></a><span class=w>                                </span><span class=s>&quot;name&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;RESTART_&quot;</span><span class=p>,</span>
<a id=__codelineno-35-255 name=__codelineno-35-255 href=#__codelineno-35-255></a><span class=w>                                </span><span class=s>&quot;value&quot;</span><span class=p>:</span><span class=w> </span><span class=nx>strconv</span><span class=p>.</span><span class=nx>FormatInt</span><span class=p>(</span><span class=nx>time</span><span class=p>.</span><span class=nx>Now</span><span class=p>().</span><span class=nx>Unix</span><span class=p>(),</span><span class=w> </span><span class=mi>10</span><span class=p>),</span>
<a id=__codelineno-35-256 name=__codelineno-35-256 href=#__codelineno-35-256></a><span class=w>                            </span><span class=p>}},</span>
<a id=__codelineno-35-257 name=__codelineno-35-257 href=#__codelineno-35-257></a><span class=w>                        </span><span class=p>},</span>
<a id=__codelineno-35-258 name=__codelineno-35-258 href=#__codelineno-35-258></a><span class=w>                    </span><span class=p>},</span>
<a id=__codelineno-35-259 name=__codelineno-35-259 href=#__codelineno-35-259></a><span class=w>                </span><span class=p>},</span>
<a id=__codelineno-35-260 name=__codelineno-35-260 href=#__codelineno-35-260></a><span class=w>            </span><span class=p>},</span>
<a id=__codelineno-35-261 name=__codelineno-35-261 href=#__codelineno-35-261></a><span class=w>        </span><span class=p>},</span>
<a id=__codelineno-35-262 name=__codelineno-35-262 href=#__codelineno-35-262></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-35-263 name=__codelineno-35-263 href=#__codelineno-35-263></a><span class=w>    </span><span class=c1>//序列化为字节，因为patch方法只接收字节类型参数</span>
<a id=__codelineno-35-264 name=__codelineno-35-264 href=#__codelineno-35-264></a><span class=w>    </span><span class=nx>patchByte</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>json</span><span class=p>.</span><span class=nx>Marshal</span><span class=p>(</span><span class=nx>patchData</span><span class=p>)</span>
<a id=__codelineno-35-265 name=__codelineno-35-265 href=#__codelineno-35-265></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-35-266 name=__codelineno-35-266 href=#__codelineno-35-266></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;json序列化失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-35-267 name=__codelineno-35-267 href=#__codelineno-35-267></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;json序列化失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-35-268 name=__codelineno-35-268 href=#__codelineno-35-268></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-35-269 name=__codelineno-35-269 href=#__codelineno-35-269></a><span class=w>    </span><span class=c1>//调用patch方法更新deployment</span>
<a id=__codelineno-35-270 name=__codelineno-35-270 href=#__codelineno-35-270></a><span class=w>    </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>AppsV1</span><span class=p>().</span><span class=nx>Deployments</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span><span class=nx>Patch</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>deploymentName</span><span class=p>,</span><span class=w> </span><span class=s>&quot;application/strategic-merge-patch+json&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>patchByte</span><span class=p>,</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>PatchOptions</span><span class=p>{})</span>
<a id=__codelineno-35-271 name=__codelineno-35-271 href=#__codelineno-35-271></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-35-272 name=__codelineno-35-272 href=#__codelineno-35-272></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;重启Deployment失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-35-273 name=__codelineno-35-273 href=#__codelineno-35-273></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;重启Deployment失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-35-274 name=__codelineno-35-274 href=#__codelineno-35-274></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-35-275 name=__codelineno-35-275 href=#__codelineno-35-275></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-35-276 name=__codelineno-35-276 href=#__codelineno-35-276></a><span class=p>}</span>
<a id=__codelineno-35-277 name=__codelineno-35-277 href=#__codelineno-35-277></a>
<a id=__codelineno-35-278 name=__codelineno-35-278 href=#__codelineno-35-278></a><span class=c1>// UpdateDeployment 更新deployment</span>
<a id=__codelineno-35-279 name=__codelineno-35-279 href=#__codelineno-35-279></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>deployment</span><span class=p>)</span><span class=w> </span><span class=nx>UpdateDeployment</span><span class=p>(</span><span class=nx>namespace</span><span class=p>,</span><span class=w> </span><span class=nx>content</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-35-280 name=__codelineno-35-280 href=#__codelineno-35-280></a><span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=nx>deploy</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>appsv1</span><span class=p>.</span><span class=nx>Deployment</span><span class=p>{}</span>
<a id=__codelineno-35-281 name=__codelineno-35-281 href=#__codelineno-35-281></a>
<a id=__codelineno-35-282 name=__codelineno-35-282 href=#__codelineno-35-282></a><span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>json</span><span class=p>.</span><span class=nx>Unmarshal</span><span class=p>([]</span><span class=nb>byte</span><span class=p>(</span><span class=nx>content</span><span class=p>),</span><span class=w> </span><span class=nx>deploy</span><span class=p>)</span>
<a id=__codelineno-35-283 name=__codelineno-35-283 href=#__codelineno-35-283></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-35-284 name=__codelineno-35-284 href=#__codelineno-35-284></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;反序列化失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-35-285 name=__codelineno-35-285 href=#__codelineno-35-285></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;反序列化失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-35-286 name=__codelineno-35-286 href=#__codelineno-35-286></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-35-287 name=__codelineno-35-287 href=#__codelineno-35-287></a>
<a id=__codelineno-35-288 name=__codelineno-35-288 href=#__codelineno-35-288></a><span class=w>    </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>AppsV1</span><span class=p>().</span><span class=nx>Deployments</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span><span class=nx>Update</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>deploy</span><span class=p>,</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>UpdateOptions</span><span class=p>{})</span>
<a id=__codelineno-35-289 name=__codelineno-35-289 href=#__codelineno-35-289></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-35-290 name=__codelineno-35-290 href=#__codelineno-35-290></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;更新Deployment失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-35-291 name=__codelineno-35-291 href=#__codelineno-35-291></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;更新Deployment失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-35-292 name=__codelineno-35-292 href=#__codelineno-35-292></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-35-293 name=__codelineno-35-293 href=#__codelineno-35-293></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-35-294 name=__codelineno-35-294 href=#__codelineno-35-294></a><span class=p>}</span>
<a id=__codelineno-35-295 name=__codelineno-35-295 href=#__codelineno-35-295></a>
<a id=__codelineno-35-296 name=__codelineno-35-296 href=#__codelineno-35-296></a><span class=c1>// GetDeployNumPerNp 获取每个namespace的deployment数量</span>
<a id=__codelineno-35-297 name=__codelineno-35-297 href=#__codelineno-35-297></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>deployment</span><span class=p>)</span><span class=w> </span><span class=nx>GetDeployNumPerNp</span><span class=p>()</span><span class=w> </span><span class=p>(</span><span class=nx>deploysNps</span><span class=w> </span><span class=p>[]</span><span class=o>*</span><span class=nx>DeploysNp</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-35-298 name=__codelineno-35-298 href=#__codelineno-35-298></a><span class=w>    </span><span class=nx>namespaceList</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>CoreV1</span><span class=p>().</span><span class=nx>Namespaces</span><span class=p>().</span><span class=nx>List</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>ListOptions</span><span class=p>{})</span>
<a id=__codelineno-35-299 name=__codelineno-35-299 href=#__codelineno-35-299></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-35-300 name=__codelineno-35-300 href=#__codelineno-35-300></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>err</span>
<a id=__codelineno-35-301 name=__codelineno-35-301 href=#__codelineno-35-301></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-35-302 name=__codelineno-35-302 href=#__codelineno-35-302></a><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>namespace</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>namespaceList</span><span class=p>.</span><span class=nx>Items</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-35-303 name=__codelineno-35-303 href=#__codelineno-35-303></a><span class=w>        </span><span class=nx>deploymentList</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>AppsV1</span><span class=p>().</span><span class=nx>Deployments</span><span class=p>(</span><span class=nx>namespace</span><span class=p>.</span><span class=nx>Name</span><span class=p>).</span><span class=nx>List</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>ListOptions</span><span class=p>{})</span>
<a id=__codelineno-35-304 name=__codelineno-35-304 href=#__codelineno-35-304></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-35-305 name=__codelineno-35-305 href=#__codelineno-35-305></a><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>err</span>
<a id=__codelineno-35-306 name=__codelineno-35-306 href=#__codelineno-35-306></a><span class=w>        </span><span class=p>}</span>
<a id=__codelineno-35-307 name=__codelineno-35-307 href=#__codelineno-35-307></a><span class=w>        </span><span class=nx>DeploysNp</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>DeploysNp</span><span class=p>{</span>
<a id=__codelineno-35-308 name=__codelineno-35-308 href=#__codelineno-35-308></a><span class=w>            </span><span class=nx>Namespace</span><span class=p>:</span><span class=w> </span><span class=nx>namespace</span><span class=p>.</span><span class=nx>Name</span><span class=p>,</span>
<a id=__codelineno-35-309 name=__codelineno-35-309 href=#__codelineno-35-309></a><span class=w>            </span><span class=nx>DeployNum</span><span class=p>:</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>deploymentList</span><span class=p>.</span><span class=nx>Items</span><span class=p>),</span>
<a id=__codelineno-35-310 name=__codelineno-35-310 href=#__codelineno-35-310></a><span class=w>        </span><span class=p>}</span>
<a id=__codelineno-35-311 name=__codelineno-35-311 href=#__codelineno-35-311></a><span class=w>        </span><span class=nx>deploysNps</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nb>append</span><span class=p>(</span><span class=nx>deploysNps</span><span class=p>,</span><span class=w> </span><span class=nx>DeploysNp</span><span class=p>)</span>
<a id=__codelineno-35-312 name=__codelineno-35-312 href=#__codelineno-35-312></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-35-313 name=__codelineno-35-313 href=#__codelineno-35-313></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>deploysNps</span><span class=p>,</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-35-314 name=__codelineno-35-314 href=#__codelineno-35-314></a><span class=p>}</span>
</code></pre></div> <h5 id=controllerdeploymentgo>controller/deployment.go<a class=headerlink href=#controllerdeploymentgo title="Permanent link">&para;</a></h5> <div class=highlight><pre><span></span><code><a id=__codelineno-36-1 name=__codelineno-36-1 href=#__codelineno-36-1></a><span class=kn>package</span><span class=w> </span><span class=nx>controller</span>
<a id=__codelineno-36-2 name=__codelineno-36-2 href=#__codelineno-36-2></a>
<a id=__codelineno-36-3 name=__codelineno-36-3 href=#__codelineno-36-3></a><span class=kn>import</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-36-4 name=__codelineno-36-4 href=#__codelineno-36-4></a><span class=w>    </span><span class=s>&quot;fmt&quot;</span>
<a id=__codelineno-36-5 name=__codelineno-36-5 href=#__codelineno-36-5></a><span class=w>    </span><span class=s>&quot;gitee.com/k8s-platform/service&quot;</span>
<a id=__codelineno-36-6 name=__codelineno-36-6 href=#__codelineno-36-6></a><span class=w>    </span><span class=s>&quot;net/http&quot;</span>
<a id=__codelineno-36-7 name=__codelineno-36-7 href=#__codelineno-36-7></a>
<a id=__codelineno-36-8 name=__codelineno-36-8 href=#__codelineno-36-8></a><span class=w>    </span><span class=s>&quot;github.com/gin-gonic/gin&quot;</span>
<a id=__codelineno-36-9 name=__codelineno-36-9 href=#__codelineno-36-9></a><span class=w>    </span><span class=s>&quot;github.com/wonderivan/logger&quot;</span>
<a id=__codelineno-36-10 name=__codelineno-36-10 href=#__codelineno-36-10></a><span class=p>)</span>
<a id=__codelineno-36-11 name=__codelineno-36-11 href=#__codelineno-36-11></a>
<a id=__codelineno-36-12 name=__codelineno-36-12 href=#__codelineno-36-12></a><span class=kd>type</span><span class=w> </span><span class=nx>deployment</span><span class=w> </span><span class=kd>struct</span><span class=p>{}</span>
<a id=__codelineno-36-13 name=__codelineno-36-13 href=#__codelineno-36-13></a>
<a id=__codelineno-36-14 name=__codelineno-36-14 href=#__codelineno-36-14></a><span class=kd>var</span><span class=w> </span><span class=nx>Deployment</span><span class=w> </span><span class=nx>deployment</span>
<a id=__codelineno-36-15 name=__codelineno-36-15 href=#__codelineno-36-15></a>
<a id=__codelineno-36-16 name=__codelineno-36-16 href=#__codelineno-36-16></a><span class=c1>// GetDeployments 获取deployment列表，支持过滤、排序、分页</span>
<a id=__codelineno-36-17 name=__codelineno-36-17 href=#__codelineno-36-17></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>deployment</span><span class=p>)</span><span class=w> </span><span class=nx>GetDeployments</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-36-18 name=__codelineno-36-18 href=#__codelineno-36-18></a><span class=w>    </span><span class=nx>params</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-36-19 name=__codelineno-36-19 href=#__codelineno-36-19></a><span class=w>        </span><span class=nx>FilterName</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`form:&quot;filter_name&quot;`</span>
<a id=__codelineno-36-20 name=__codelineno-36-20 href=#__codelineno-36-20></a><span class=w>        </span><span class=nx>Namespace</span><span class=w>  </span><span class=kt>string</span><span class=w> </span><span class=s>`form:&quot;namespace&quot;`</span>
<a id=__codelineno-36-21 name=__codelineno-36-21 href=#__codelineno-36-21></a><span class=w>        </span><span class=nx>Page</span><span class=w>       </span><span class=kt>int</span><span class=w>    </span><span class=s>`form:&quot;page&quot;`</span>
<a id=__codelineno-36-22 name=__codelineno-36-22 href=#__codelineno-36-22></a><span class=w>        </span><span class=nx>Limit</span><span class=w>      </span><span class=kt>int</span><span class=w>    </span><span class=s>`form:&quot;limit&quot;`</span>
<a id=__codelineno-36-23 name=__codelineno-36-23 href=#__codelineno-36-23></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-36-24 name=__codelineno-36-24 href=#__codelineno-36-24></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>Bind</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-36-25 name=__codelineno-36-25 href=#__codelineno-36-25></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-36-26 name=__codelineno-36-26 href=#__codelineno-36-26></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-36-27 name=__codelineno-36-27 href=#__codelineno-36-27></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-36-28 name=__codelineno-36-28 href=#__codelineno-36-28></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-36-29 name=__codelineno-36-29 href=#__codelineno-36-29></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-36-30 name=__codelineno-36-30 href=#__codelineno-36-30></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-36-31 name=__codelineno-36-31 href=#__codelineno-36-31></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-36-32 name=__codelineno-36-32 href=#__codelineno-36-32></a><span class=w>    </span><span class=nx>data</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>Deployment</span><span class=p>.</span><span class=nx>GetDeployments</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>FilterName</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Limit</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Page</span><span class=p>)</span>
<a id=__codelineno-36-33 name=__codelineno-36-33 href=#__codelineno-36-33></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-36-34 name=__codelineno-36-34 href=#__codelineno-36-34></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-36-35 name=__codelineno-36-35 href=#__codelineno-36-35></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-36-36 name=__codelineno-36-36 href=#__codelineno-36-36></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-36-37 name=__codelineno-36-37 href=#__codelineno-36-37></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-36-38 name=__codelineno-36-38 href=#__codelineno-36-38></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-36-39 name=__codelineno-36-39 href=#__codelineno-36-39></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-36-40 name=__codelineno-36-40 href=#__codelineno-36-40></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-36-41 name=__codelineno-36-41 href=#__codelineno-36-41></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;获取Deployment列表成功&quot;</span><span class=p>,</span>
<a id=__codelineno-36-42 name=__codelineno-36-42 href=#__codelineno-36-42></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=nx>data</span><span class=p>,</span>
<a id=__codelineno-36-43 name=__codelineno-36-43 href=#__codelineno-36-43></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-36-44 name=__codelineno-36-44 href=#__codelineno-36-44></a><span class=p>}</span>
<a id=__codelineno-36-45 name=__codelineno-36-45 href=#__codelineno-36-45></a>
<a id=__codelineno-36-46 name=__codelineno-36-46 href=#__codelineno-36-46></a><span class=c1>// GetDeploymentDetail 获取deployment详情</span>
<a id=__codelineno-36-47 name=__codelineno-36-47 href=#__codelineno-36-47></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>deployment</span><span class=p>)</span><span class=w> </span><span class=nx>GetDeploymentDetail</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-36-48 name=__codelineno-36-48 href=#__codelineno-36-48></a><span class=w>    </span><span class=nx>params</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-36-49 name=__codelineno-36-49 href=#__codelineno-36-49></a><span class=w>        </span><span class=nx>DeploymentName</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`form:&quot;deployment_name&quot;`</span>
<a id=__codelineno-36-50 name=__codelineno-36-50 href=#__codelineno-36-50></a><span class=w>        </span><span class=nx>Namespace</span><span class=w>      </span><span class=kt>string</span><span class=w> </span><span class=s>`form:&quot;namespace&quot;`</span>
<a id=__codelineno-36-51 name=__codelineno-36-51 href=#__codelineno-36-51></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-36-52 name=__codelineno-36-52 href=#__codelineno-36-52></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>Bind</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-36-53 name=__codelineno-36-53 href=#__codelineno-36-53></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-36-54 name=__codelineno-36-54 href=#__codelineno-36-54></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-36-55 name=__codelineno-36-55 href=#__codelineno-36-55></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-36-56 name=__codelineno-36-56 href=#__codelineno-36-56></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-36-57 name=__codelineno-36-57 href=#__codelineno-36-57></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-36-58 name=__codelineno-36-58 href=#__codelineno-36-58></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-36-59 name=__codelineno-36-59 href=#__codelineno-36-59></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-36-60 name=__codelineno-36-60 href=#__codelineno-36-60></a><span class=w>    </span><span class=nx>data</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>Deployment</span><span class=p>.</span><span class=nx>GetDeploymentDetail</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>DeploymentName</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>)</span>
<a id=__codelineno-36-61 name=__codelineno-36-61 href=#__codelineno-36-61></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-36-62 name=__codelineno-36-62 href=#__codelineno-36-62></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-36-63 name=__codelineno-36-63 href=#__codelineno-36-63></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-36-64 name=__codelineno-36-64 href=#__codelineno-36-64></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-36-65 name=__codelineno-36-65 href=#__codelineno-36-65></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-36-66 name=__codelineno-36-66 href=#__codelineno-36-66></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-36-67 name=__codelineno-36-67 href=#__codelineno-36-67></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-36-68 name=__codelineno-36-68 href=#__codelineno-36-68></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-36-69 name=__codelineno-36-69 href=#__codelineno-36-69></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;获取Deployment详情成功&quot;</span><span class=p>,</span>
<a id=__codelineno-36-70 name=__codelineno-36-70 href=#__codelineno-36-70></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=nx>data</span><span class=p>,</span>
<a id=__codelineno-36-71 name=__codelineno-36-71 href=#__codelineno-36-71></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-36-72 name=__codelineno-36-72 href=#__codelineno-36-72></a><span class=p>}</span>
<a id=__codelineno-36-73 name=__codelineno-36-73 href=#__codelineno-36-73></a>
<a id=__codelineno-36-74 name=__codelineno-36-74 href=#__codelineno-36-74></a><span class=c1>// CreateDeployment 创建deployment</span>
<a id=__codelineno-36-75 name=__codelineno-36-75 href=#__codelineno-36-75></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>deployment</span><span class=p>)</span><span class=w> </span><span class=nx>CreateDeployment</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-36-76 name=__codelineno-36-76 href=#__codelineno-36-76></a><span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-36-77 name=__codelineno-36-77 href=#__codelineno-36-77></a><span class=w>        </span><span class=nx>deployCreate</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=nx>service</span><span class=p>.</span><span class=nx>DeployCreate</span><span class=p>)</span>
<a id=__codelineno-36-78 name=__codelineno-36-78 href=#__codelineno-36-78></a><span class=w>        </span><span class=nx>err</span><span class=w>          </span><span class=kt>error</span>
<a id=__codelineno-36-79 name=__codelineno-36-79 href=#__codelineno-36-79></a><span class=w>    </span><span class=p>)</span>
<a id=__codelineno-36-80 name=__codelineno-36-80 href=#__codelineno-36-80></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>ShouldBindJSON</span><span class=p>(</span><span class=nx>deployCreate</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-36-81 name=__codelineno-36-81 href=#__codelineno-36-81></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-36-82 name=__codelineno-36-82 href=#__codelineno-36-82></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-36-83 name=__codelineno-36-83 href=#__codelineno-36-83></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-36-84 name=__codelineno-36-84 href=#__codelineno-36-84></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-36-85 name=__codelineno-36-85 href=#__codelineno-36-85></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-36-86 name=__codelineno-36-86 href=#__codelineno-36-86></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-36-87 name=__codelineno-36-87 href=#__codelineno-36-87></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-36-88 name=__codelineno-36-88 href=#__codelineno-36-88></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>Deployment</span><span class=p>.</span><span class=nx>CreateDeployment</span><span class=p>(</span><span class=nx>deployCreate</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-36-89 name=__codelineno-36-89 href=#__codelineno-36-89></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-36-90 name=__codelineno-36-90 href=#__codelineno-36-90></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-36-91 name=__codelineno-36-91 href=#__codelineno-36-91></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-36-92 name=__codelineno-36-92 href=#__codelineno-36-92></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-36-93 name=__codelineno-36-93 href=#__codelineno-36-93></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-36-94 name=__codelineno-36-94 href=#__codelineno-36-94></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-36-95 name=__codelineno-36-95 href=#__codelineno-36-95></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;创建Deployment成功&quot;</span><span class=p>,</span>
<a id=__codelineno-36-96 name=__codelineno-36-96 href=#__codelineno-36-96></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-36-97 name=__codelineno-36-97 href=#__codelineno-36-97></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-36-98 name=__codelineno-36-98 href=#__codelineno-36-98></a><span class=p>}</span>
<a id=__codelineno-36-99 name=__codelineno-36-99 href=#__codelineno-36-99></a>
<a id=__codelineno-36-100 name=__codelineno-36-100 href=#__codelineno-36-100></a><span class=c1>// ScaleDeployment 设置deployment副本数</span>
<a id=__codelineno-36-101 name=__codelineno-36-101 href=#__codelineno-36-101></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>deployment</span><span class=p>)</span><span class=w> </span><span class=nx>ScaleDeployment</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-36-102 name=__codelineno-36-102 href=#__codelineno-36-102></a><span class=w>    </span><span class=nx>params</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-36-103 name=__codelineno-36-103 href=#__codelineno-36-103></a><span class=w>        </span><span class=nx>DeploymentName</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;deployment_name&quot;`</span>
<a id=__codelineno-36-104 name=__codelineno-36-104 href=#__codelineno-36-104></a><span class=w>        </span><span class=nx>Namespace</span><span class=w>      </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;namespace&quot;`</span>
<a id=__codelineno-36-105 name=__codelineno-36-105 href=#__codelineno-36-105></a><span class=w>        </span><span class=nx>ScaleNum</span><span class=w>       </span><span class=kt>int</span><span class=w>    </span><span class=s>`json:&quot;scale_num&quot;`</span>
<a id=__codelineno-36-106 name=__codelineno-36-106 href=#__codelineno-36-106></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-36-107 name=__codelineno-36-107 href=#__codelineno-36-107></a><span class=w>    </span><span class=c1>//PUT请求，绑定参数方法为ctx.ShouldBindJSON</span>
<a id=__codelineno-36-108 name=__codelineno-36-108 href=#__codelineno-36-108></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>ShouldBindJSON</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-36-109 name=__codelineno-36-109 href=#__codelineno-36-109></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-36-110 name=__codelineno-36-110 href=#__codelineno-36-110></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-36-111 name=__codelineno-36-111 href=#__codelineno-36-111></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-36-112 name=__codelineno-36-112 href=#__codelineno-36-112></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-36-113 name=__codelineno-36-113 href=#__codelineno-36-113></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-36-114 name=__codelineno-36-114 href=#__codelineno-36-114></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-36-115 name=__codelineno-36-115 href=#__codelineno-36-115></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-36-116 name=__codelineno-36-116 href=#__codelineno-36-116></a><span class=w>    </span><span class=nx>data</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>Deployment</span><span class=p>.</span><span class=nx>ScaleDeployment</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>DeploymentName</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>ScaleNum</span><span class=p>)</span>
<a id=__codelineno-36-117 name=__codelineno-36-117 href=#__codelineno-36-117></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-36-118 name=__codelineno-36-118 href=#__codelineno-36-118></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-36-119 name=__codelineno-36-119 href=#__codelineno-36-119></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-36-120 name=__codelineno-36-120 href=#__codelineno-36-120></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-36-121 name=__codelineno-36-121 href=#__codelineno-36-121></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-36-122 name=__codelineno-36-122 href=#__codelineno-36-122></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-36-123 name=__codelineno-36-123 href=#__codelineno-36-123></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-36-124 name=__codelineno-36-124 href=#__codelineno-36-124></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-36-125 name=__codelineno-36-125 href=#__codelineno-36-125></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;设置Deployment副本数成功&quot;</span><span class=p>,</span>
<a id=__codelineno-36-126 name=__codelineno-36-126 href=#__codelineno-36-126></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=nx>fmt</span><span class=p>.</span><span class=nx>Sprintf</span><span class=p>(</span><span class=s>&quot;最新副本数：%d&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>data</span><span class=p>),</span>
<a id=__codelineno-36-127 name=__codelineno-36-127 href=#__codelineno-36-127></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-36-128 name=__codelineno-36-128 href=#__codelineno-36-128></a><span class=p>}</span>
<a id=__codelineno-36-129 name=__codelineno-36-129 href=#__codelineno-36-129></a>
<a id=__codelineno-36-130 name=__codelineno-36-130 href=#__codelineno-36-130></a><span class=c1>// DeleteDeployment 删除deployment</span>
<a id=__codelineno-36-131 name=__codelineno-36-131 href=#__codelineno-36-131></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>deployment</span><span class=p>)</span><span class=w> </span><span class=nx>DeleteDeployment</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-36-132 name=__codelineno-36-132 href=#__codelineno-36-132></a><span class=w>    </span><span class=nx>params</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-36-133 name=__codelineno-36-133 href=#__codelineno-36-133></a><span class=w>        </span><span class=nx>DeploymentName</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;deployment_name&quot;`</span>
<a id=__codelineno-36-134 name=__codelineno-36-134 href=#__codelineno-36-134></a><span class=w>        </span><span class=nx>Namespace</span><span class=w>      </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;namespace&quot;`</span>
<a id=__codelineno-36-135 name=__codelineno-36-135 href=#__codelineno-36-135></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-36-136 name=__codelineno-36-136 href=#__codelineno-36-136></a><span class=w>    </span><span class=c1>//DELETE请求，绑定参数方法改为ctx.ShouldBindJSON</span>
<a id=__codelineno-36-137 name=__codelineno-36-137 href=#__codelineno-36-137></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>ShouldBindJSON</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-36-138 name=__codelineno-36-138 href=#__codelineno-36-138></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-36-139 name=__codelineno-36-139 href=#__codelineno-36-139></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-36-140 name=__codelineno-36-140 href=#__codelineno-36-140></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-36-141 name=__codelineno-36-141 href=#__codelineno-36-141></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-36-142 name=__codelineno-36-142 href=#__codelineno-36-142></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-36-143 name=__codelineno-36-143 href=#__codelineno-36-143></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-36-144 name=__codelineno-36-144 href=#__codelineno-36-144></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-36-145 name=__codelineno-36-145 href=#__codelineno-36-145></a><span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>Deployment</span><span class=p>.</span><span class=nx>DeleteDeployment</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>DeploymentName</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>)</span>
<a id=__codelineno-36-146 name=__codelineno-36-146 href=#__codelineno-36-146></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-36-147 name=__codelineno-36-147 href=#__codelineno-36-147></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-36-148 name=__codelineno-36-148 href=#__codelineno-36-148></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-36-149 name=__codelineno-36-149 href=#__codelineno-36-149></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-36-150 name=__codelineno-36-150 href=#__codelineno-36-150></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-36-151 name=__codelineno-36-151 href=#__codelineno-36-151></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-36-152 name=__codelineno-36-152 href=#__codelineno-36-152></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-36-153 name=__codelineno-36-153 href=#__codelineno-36-153></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-36-154 name=__codelineno-36-154 href=#__codelineno-36-154></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;删除Deployment成功&quot;</span><span class=p>,</span>
<a id=__codelineno-36-155 name=__codelineno-36-155 href=#__codelineno-36-155></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-36-156 name=__codelineno-36-156 href=#__codelineno-36-156></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-36-157 name=__codelineno-36-157 href=#__codelineno-36-157></a><span class=p>}</span>
<a id=__codelineno-36-158 name=__codelineno-36-158 href=#__codelineno-36-158></a>
<a id=__codelineno-36-159 name=__codelineno-36-159 href=#__codelineno-36-159></a><span class=c1>// RestartDeployment 重启deployment</span>
<a id=__codelineno-36-160 name=__codelineno-36-160 href=#__codelineno-36-160></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>deployment</span><span class=p>)</span><span class=w> </span><span class=nx>RestartDeployment</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-36-161 name=__codelineno-36-161 href=#__codelineno-36-161></a><span class=w>    </span><span class=nx>params</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-36-162 name=__codelineno-36-162 href=#__codelineno-36-162></a><span class=w>        </span><span class=nx>DeploymentName</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;deployment_name&quot;`</span>
<a id=__codelineno-36-163 name=__codelineno-36-163 href=#__codelineno-36-163></a><span class=w>        </span><span class=nx>Namespace</span><span class=w>      </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;namespace&quot;`</span>
<a id=__codelineno-36-164 name=__codelineno-36-164 href=#__codelineno-36-164></a><span class=w>        </span><span class=nx>ImageName</span><span class=w>      </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;image_name&quot;`</span>
<a id=__codelineno-36-165 name=__codelineno-36-165 href=#__codelineno-36-165></a><span class=w>        </span><span class=nx>Image</span><span class=w>          </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;image&quot;`</span>
<a id=__codelineno-36-166 name=__codelineno-36-166 href=#__codelineno-36-166></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-36-167 name=__codelineno-36-167 href=#__codelineno-36-167></a><span class=w>    </span><span class=c1>//PUT请求，绑定参数方法为ctx.ShouldBindJSON</span>
<a id=__codelineno-36-168 name=__codelineno-36-168 href=#__codelineno-36-168></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>ShouldBindJSON</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-36-169 name=__codelineno-36-169 href=#__codelineno-36-169></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-36-170 name=__codelineno-36-170 href=#__codelineno-36-170></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-36-171 name=__codelineno-36-171 href=#__codelineno-36-171></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-36-172 name=__codelineno-36-172 href=#__codelineno-36-172></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-36-173 name=__codelineno-36-173 href=#__codelineno-36-173></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-36-174 name=__codelineno-36-174 href=#__codelineno-36-174></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-36-175 name=__codelineno-36-175 href=#__codelineno-36-175></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-36-176 name=__codelineno-36-176 href=#__codelineno-36-176></a><span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>Deployment</span><span class=p>.</span><span class=nx>RestartDeployment</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>DeploymentName</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>ImageName</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Image</span><span class=p>)</span>
<a id=__codelineno-36-177 name=__codelineno-36-177 href=#__codelineno-36-177></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-36-178 name=__codelineno-36-178 href=#__codelineno-36-178></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-36-179 name=__codelineno-36-179 href=#__codelineno-36-179></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-36-180 name=__codelineno-36-180 href=#__codelineno-36-180></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-36-181 name=__codelineno-36-181 href=#__codelineno-36-181></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-36-182 name=__codelineno-36-182 href=#__codelineno-36-182></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-36-183 name=__codelineno-36-183 href=#__codelineno-36-183></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-36-184 name=__codelineno-36-184 href=#__codelineno-36-184></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-36-185 name=__codelineno-36-185 href=#__codelineno-36-185></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;重启Deployment成功&quot;</span><span class=p>,</span>
<a id=__codelineno-36-186 name=__codelineno-36-186 href=#__codelineno-36-186></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-36-187 name=__codelineno-36-187 href=#__codelineno-36-187></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-36-188 name=__codelineno-36-188 href=#__codelineno-36-188></a><span class=p>}</span>
<a id=__codelineno-36-189 name=__codelineno-36-189 href=#__codelineno-36-189></a>
<a id=__codelineno-36-190 name=__codelineno-36-190 href=#__codelineno-36-190></a><span class=c1>// UpdateDeployment 更新deployment</span>
<a id=__codelineno-36-191 name=__codelineno-36-191 href=#__codelineno-36-191></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>deployment</span><span class=p>)</span><span class=w> </span><span class=nx>UpdateDeployment</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-36-192 name=__codelineno-36-192 href=#__codelineno-36-192></a><span class=w>    </span><span class=nx>params</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-36-193 name=__codelineno-36-193 href=#__codelineno-36-193></a><span class=w>        </span><span class=nx>Namespace</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;namespace&quot;`</span>
<a id=__codelineno-36-194 name=__codelineno-36-194 href=#__codelineno-36-194></a><span class=w>        </span><span class=nx>Content</span><span class=w>   </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;content&quot;`</span>
<a id=__codelineno-36-195 name=__codelineno-36-195 href=#__codelineno-36-195></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-36-196 name=__codelineno-36-196 href=#__codelineno-36-196></a><span class=w>    </span><span class=c1>//PUT请求，绑定参数方法为ctx.ShouldBindJSON</span>
<a id=__codelineno-36-197 name=__codelineno-36-197 href=#__codelineno-36-197></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>ShouldBindJSON</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-36-198 name=__codelineno-36-198 href=#__codelineno-36-198></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-36-199 name=__codelineno-36-199 href=#__codelineno-36-199></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-36-200 name=__codelineno-36-200 href=#__codelineno-36-200></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-36-201 name=__codelineno-36-201 href=#__codelineno-36-201></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-36-202 name=__codelineno-36-202 href=#__codelineno-36-202></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-36-203 name=__codelineno-36-203 href=#__codelineno-36-203></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-36-204 name=__codelineno-36-204 href=#__codelineno-36-204></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-36-205 name=__codelineno-36-205 href=#__codelineno-36-205></a><span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>Deployment</span><span class=p>.</span><span class=nx>UpdateDeployment</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Content</span><span class=p>)</span>
<a id=__codelineno-36-206 name=__codelineno-36-206 href=#__codelineno-36-206></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-36-207 name=__codelineno-36-207 href=#__codelineno-36-207></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-36-208 name=__codelineno-36-208 href=#__codelineno-36-208></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-36-209 name=__codelineno-36-209 href=#__codelineno-36-209></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-36-210 name=__codelineno-36-210 href=#__codelineno-36-210></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-36-211 name=__codelineno-36-211 href=#__codelineno-36-211></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-36-212 name=__codelineno-36-212 href=#__codelineno-36-212></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-36-213 name=__codelineno-36-213 href=#__codelineno-36-213></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-36-214 name=__codelineno-36-214 href=#__codelineno-36-214></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;更新Deployment成功&quot;</span><span class=p>,</span>
<a id=__codelineno-36-215 name=__codelineno-36-215 href=#__codelineno-36-215></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-36-216 name=__codelineno-36-216 href=#__codelineno-36-216></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-36-217 name=__codelineno-36-217 href=#__codelineno-36-217></a><span class=p>}</span>
<a id=__codelineno-36-218 name=__codelineno-36-218 href=#__codelineno-36-218></a>
<a id=__codelineno-36-219 name=__codelineno-36-219 href=#__codelineno-36-219></a><span class=c1>// GetDeployNumPerNp 获取每个namespace的pod数量</span>
<a id=__codelineno-36-220 name=__codelineno-36-220 href=#__codelineno-36-220></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>deployment</span><span class=p>)</span><span class=w> </span><span class=nx>GetDeployNumPerNp</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-36-221 name=__codelineno-36-221 href=#__codelineno-36-221></a><span class=w>    </span><span class=nx>data</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>Deployment</span><span class=p>.</span><span class=nx>GetDeployNumPerNp</span><span class=p>()</span>
<a id=__codelineno-36-222 name=__codelineno-36-222 href=#__codelineno-36-222></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-36-223 name=__codelineno-36-223 href=#__codelineno-36-223></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-36-224 name=__codelineno-36-224 href=#__codelineno-36-224></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-36-225 name=__codelineno-36-225 href=#__codelineno-36-225></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-36-226 name=__codelineno-36-226 href=#__codelineno-36-226></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-36-227 name=__codelineno-36-227 href=#__codelineno-36-227></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-36-228 name=__codelineno-36-228 href=#__codelineno-36-228></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-36-229 name=__codelineno-36-229 href=#__codelineno-36-229></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-36-230 name=__codelineno-36-230 href=#__codelineno-36-230></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;获取每个namespace的deployment数量成功&quot;</span><span class=p>,</span>
<a id=__codelineno-36-231 name=__codelineno-36-231 href=#__codelineno-36-231></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=nx>data</span><span class=p>,</span>
<a id=__codelineno-36-232 name=__codelineno-36-232 href=#__codelineno-36-232></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-36-233 name=__codelineno-36-233 href=#__codelineno-36-233></a><span class=p>}</span>
</code></pre></div> <p><code>controller/router.go</code></p> <p>定义路由规则</p> <div class=highlight><pre><span></span><code><a id=__codelineno-37-1 name=__codelineno-37-1 href=#__codelineno-37-1></a><span class=kn>package</span><span class=w> </span><span class=nx>controller</span>
<a id=__codelineno-37-2 name=__codelineno-37-2 href=#__codelineno-37-2></a>
<a id=__codelineno-37-3 name=__codelineno-37-3 href=#__codelineno-37-3></a><span class=kn>import</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-37-4 name=__codelineno-37-4 href=#__codelineno-37-4></a><span class=w>    </span><span class=s>&quot;github.com/gin-gonic/gin&quot;</span>
<a id=__codelineno-37-5 name=__codelineno-37-5 href=#__codelineno-37-5></a><span class=w>    </span><span class=s>&quot;net/http&quot;</span>
<a id=__codelineno-37-6 name=__codelineno-37-6 href=#__codelineno-37-6></a><span class=p>)</span>
<a id=__codelineno-37-7 name=__codelineno-37-7 href=#__codelineno-37-7></a>
<a id=__codelineno-37-8 name=__codelineno-37-8 href=#__codelineno-37-8></a><span class=c1>// Router 实例化router结构体，可使用该对象点出首字母大写的方法（包外调用）</span>
<a id=__codelineno-37-9 name=__codelineno-37-9 href=#__codelineno-37-9></a><span class=kd>var</span><span class=w> </span><span class=nx>Router</span><span class=w> </span><span class=nx>router</span>
<a id=__codelineno-37-10 name=__codelineno-37-10 href=#__codelineno-37-10></a>
<a id=__codelineno-37-11 name=__codelineno-37-11 href=#__codelineno-37-11></a><span class=c1>// 创建router结构体</span>
<a id=__codelineno-37-12 name=__codelineno-37-12 href=#__codelineno-37-12></a><span class=kd>type</span><span class=w> </span><span class=nx>router</span><span class=w> </span><span class=kd>struct</span><span class=p>{}</span>
<a id=__codelineno-37-13 name=__codelineno-37-13 href=#__codelineno-37-13></a>
<a id=__codelineno-37-14 name=__codelineno-37-14 href=#__codelineno-37-14></a><span class=c1>// InitApiRouter 初始化路由规则</span>
<a id=__codelineno-37-15 name=__codelineno-37-15 href=#__codelineno-37-15></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>r</span><span class=w> </span><span class=o>*</span><span class=nx>router</span><span class=p>)</span><span class=w> </span><span class=nx>InitApiRouter</span><span class=p>(</span><span class=nx>router</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Engine</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-37-16 name=__codelineno-37-16 href=#__codelineno-37-16></a><span class=w>    </span><span class=c1>// 创建测试api接口</span>
<a id=__codelineno-37-17 name=__codelineno-37-17 href=#__codelineno-37-17></a><span class=w>    </span><span class=nx>router</span><span class=p>.</span><span class=nx>GET</span><span class=p>(</span><span class=s>&quot;/testapi&quot;</span><span class=p>,</span><span class=w> </span><span class=kd>func</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-37-18 name=__codelineno-37-18 href=#__codelineno-37-18></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-37-19 name=__codelineno-37-19 href=#__codelineno-37-19></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;testapi success!&quot;</span><span class=p>,</span>
<a id=__codelineno-37-20 name=__codelineno-37-20 href=#__codelineno-37-20></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-37-21 name=__codelineno-37-21 href=#__codelineno-37-21></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-37-22 name=__codelineno-37-22 href=#__codelineno-37-22></a><span class=w>    </span><span class=p>}).</span>
<a id=__codelineno-37-23 name=__codelineno-37-23 href=#__codelineno-37-23></a><span class=w>        </span><span class=c1>// pod操作</span>
<a id=__codelineno-37-24 name=__codelineno-37-24 href=#__codelineno-37-24></a><span class=w>        </span><span class=nx>GET</span><span class=p>(</span><span class=s>&quot;/api/k8s/pods&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Pod</span><span class=p>.</span><span class=nx>GetPods</span><span class=p>).</span>
<a id=__codelineno-37-25 name=__codelineno-37-25 href=#__codelineno-37-25></a><span class=w>        </span><span class=nx>GET</span><span class=p>(</span><span class=s>&quot;/api/k8s/pod/detail&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Pod</span><span class=p>.</span><span class=nx>GetPodDetail</span><span class=p>).</span>
<a id=__codelineno-37-26 name=__codelineno-37-26 href=#__codelineno-37-26></a><span class=w>        </span><span class=nx>DELETE</span><span class=p>(</span><span class=s>&quot;/api/k8s/pod/del&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Pod</span><span class=p>.</span><span class=nx>DeletePod</span><span class=p>).</span>
<a id=__codelineno-37-27 name=__codelineno-37-27 href=#__codelineno-37-27></a><span class=w>        </span><span class=nx>PUT</span><span class=p>(</span><span class=s>&quot;/api/k8s/pod/update&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Pod</span><span class=p>.</span><span class=nx>UpdatePod</span><span class=p>).</span>
<a id=__codelineno-37-28 name=__codelineno-37-28 href=#__codelineno-37-28></a><span class=w>        </span><span class=nx>GET</span><span class=p>(</span><span class=s>&quot;/api/k8s/pod/container&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Pod</span><span class=p>.</span><span class=nx>GetPodContainer</span><span class=p>).</span>
<a id=__codelineno-37-29 name=__codelineno-37-29 href=#__codelineno-37-29></a><span class=w>        </span><span class=nx>GET</span><span class=p>(</span><span class=s>&quot;/api/k8s/pod/log&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Pod</span><span class=p>.</span><span class=nx>GetPodLog</span><span class=p>).</span>
<a id=__codelineno-37-30 name=__codelineno-37-30 href=#__codelineno-37-30></a><span class=w>        </span><span class=nx>GET</span><span class=p>(</span><span class=s>&quot;/api/k8s/pod/numnp&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Pod</span><span class=p>.</span><span class=nx>GetPodNumPerNp</span><span class=p>).</span>
<a id=__codelineno-37-31 name=__codelineno-37-31 href=#__codelineno-37-31></a><span class=w>        </span><span class=c1>// deployment操作</span>
<a id=__codelineno-37-32 name=__codelineno-37-32 href=#__codelineno-37-32></a><span class=w>        </span><span class=nx>GET</span><span class=p>(</span><span class=s>&quot;/api/k8s/deployments&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Deployment</span><span class=p>.</span><span class=nx>GetDeployments</span><span class=p>).</span>
<a id=__codelineno-37-33 name=__codelineno-37-33 href=#__codelineno-37-33></a><span class=w>        </span><span class=nx>GET</span><span class=p>(</span><span class=s>&quot;/api/k8s/deployment/detail&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Deployment</span><span class=p>.</span><span class=nx>GetDeploymentDetail</span><span class=p>).</span>
<a id=__codelineno-37-34 name=__codelineno-37-34 href=#__codelineno-37-34></a><span class=w>        </span><span class=nx>PUT</span><span class=p>(</span><span class=s>&quot;/api/k8s/deployment/scale&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Deployment</span><span class=p>.</span><span class=nx>ScaleDeployment</span><span class=p>).</span>
<a id=__codelineno-37-35 name=__codelineno-37-35 href=#__codelineno-37-35></a><span class=w>        </span><span class=nx>DELETE</span><span class=p>(</span><span class=s>&quot;/api/k8s/deployment/del&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Deployment</span><span class=p>.</span><span class=nx>DeleteDeployment</span><span class=p>).</span>
<a id=__codelineno-37-36 name=__codelineno-37-36 href=#__codelineno-37-36></a><span class=w>        </span><span class=nx>PUT</span><span class=p>(</span><span class=s>&quot;/api/k8s/deployment/restart&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Deployment</span><span class=p>.</span><span class=nx>RestartDeployment</span><span class=p>).</span>
<a id=__codelineno-37-37 name=__codelineno-37-37 href=#__codelineno-37-37></a><span class=w>        </span><span class=nx>PUT</span><span class=p>(</span><span class=s>&quot;/api/k8s/deployment/update&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Deployment</span><span class=p>.</span><span class=nx>UpdateDeployment</span><span class=p>).</span>
<a id=__codelineno-37-38 name=__codelineno-37-38 href=#__codelineno-37-38></a><span class=w>        </span><span class=nx>GET</span><span class=p>(</span><span class=s>&quot;/api/k8s/deployment/numnp&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Deployment</span><span class=p>.</span><span class=nx>GetDeployNumPerNp</span><span class=p>).</span>
<a id=__codelineno-37-39 name=__codelineno-37-39 href=#__codelineno-37-39></a><span class=w>        </span><span class=nx>POST</span><span class=p>(</span><span class=s>&quot;/api/k8s/deployment/create&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Deployment</span><span class=p>.</span><span class=nx>CreateDeployment</span><span class=p>)</span>
<a id=__codelineno-37-40 name=__codelineno-37-40 href=#__codelineno-37-40></a><span class=p>}</span>
</code></pre></div> <h4 id=24-daemonset>2.4 DaemonSet<a class=headerlink href=#24-daemonset title="Permanent link">&para;</a></h4> <blockquote> <p>注意：以下功能与Pod和Deployment是实现方式一致</p> </blockquote> <table> <thead> <tr> <th>功能</th> <th>是否实现</th> </tr> </thead> <tbody> <tr> <td>DaemonSet列表</td> <td>√</td> </tr> <tr> <td>获取DaemonSet详情</td> <td>√</td> </tr> <tr> <td>删除DaemonSet</td> <td>√</td> </tr> <tr> <td>更新DaemonSet</td> <td>√</td> </tr> </tbody> </table> <h5 id=servicedataselectorgo_1>service/dataselector.go<a class=headerlink href=#servicedataselectorgo_1 title="Permanent link">&para;</a></h5> <div class=highlight><pre><span></span><code><a id=__codelineno-38-1 name=__codelineno-38-1 href=#__codelineno-38-1></a><span class=c1>// 实现 DaemonSet 的 DataCell接口</span>
<a id=__codelineno-38-2 name=__codelineno-38-2 href=#__codelineno-38-2></a><span class=kd>type</span><span class=w> </span><span class=nx>daemonSetCell</span><span class=w> </span><span class=nx>appsv1</span><span class=p>.</span><span class=nx>DaemonSet</span>
<a id=__codelineno-38-3 name=__codelineno-38-3 href=#__codelineno-38-3></a>
<a id=__codelineno-38-4 name=__codelineno-38-4 href=#__codelineno-38-4></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=nx>daemonSetCell</span><span class=p>)</span><span class=w> </span><span class=nx>GetCreation</span><span class=p>()</span><span class=w> </span><span class=nx>time</span><span class=p>.</span><span class=nx>Time</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-38-5 name=__codelineno-38-5 href=#__codelineno-38-5></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>d</span><span class=p>.</span><span class=nx>CreationTimestamp</span><span class=p>.</span><span class=nx>Time</span>
<a id=__codelineno-38-6 name=__codelineno-38-6 href=#__codelineno-38-6></a><span class=p>}</span>
<a id=__codelineno-38-7 name=__codelineno-38-7 href=#__codelineno-38-7></a>
<a id=__codelineno-38-8 name=__codelineno-38-8 href=#__codelineno-38-8></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=nx>daemonSetCell</span><span class=p>)</span><span class=w> </span><span class=nx>GetName</span><span class=p>()</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-38-9 name=__codelineno-38-9 href=#__codelineno-38-9></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>d</span><span class=p>.</span><span class=nx>Name</span>
<a id=__codelineno-38-10 name=__codelineno-38-10 href=#__codelineno-38-10></a><span class=p>}</span>
</code></pre></div> <h5 id=servicedaemonsetgo>service/daemonset.go<a class=headerlink href=#servicedaemonsetgo title="Permanent link">&para;</a></h5> <div class=highlight><pre><span></span><code><a id=__codelineno-39-1 name=__codelineno-39-1 href=#__codelineno-39-1></a><span class=kn>package</span><span class=w> </span><span class=nx>service</span>
<a id=__codelineno-39-2 name=__codelineno-39-2 href=#__codelineno-39-2></a>
<a id=__codelineno-39-3 name=__codelineno-39-3 href=#__codelineno-39-3></a><span class=kn>import</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-39-4 name=__codelineno-39-4 href=#__codelineno-39-4></a><span class=w>    </span><span class=s>&quot;context&quot;</span>
<a id=__codelineno-39-5 name=__codelineno-39-5 href=#__codelineno-39-5></a><span class=w>    </span><span class=s>&quot;encoding/json&quot;</span>
<a id=__codelineno-39-6 name=__codelineno-39-6 href=#__codelineno-39-6></a><span class=w>    </span><span class=s>&quot;errors&quot;</span>
<a id=__codelineno-39-7 name=__codelineno-39-7 href=#__codelineno-39-7></a>
<a id=__codelineno-39-8 name=__codelineno-39-8 href=#__codelineno-39-8></a><span class=w>    </span><span class=s>&quot;github.com/wonderivan/logger&quot;</span>
<a id=__codelineno-39-9 name=__codelineno-39-9 href=#__codelineno-39-9></a><span class=w>    </span><span class=nx>appsv1</span><span class=w> </span><span class=s>&quot;k8s.io/api/apps/v1&quot;</span>
<a id=__codelineno-39-10 name=__codelineno-39-10 href=#__codelineno-39-10></a><span class=w>    </span><span class=nx>metav1</span><span class=w> </span><span class=s>&quot;k8s.io/apimachinery/pkg/apis/meta/v1&quot;</span>
<a id=__codelineno-39-11 name=__codelineno-39-11 href=#__codelineno-39-11></a><span class=p>)</span>
<a id=__codelineno-39-12 name=__codelineno-39-12 href=#__codelineno-39-12></a>
<a id=__codelineno-39-13 name=__codelineno-39-13 href=#__codelineno-39-13></a><span class=kd>var</span><span class=w> </span><span class=nx>DaemonSet</span><span class=w> </span><span class=nx>daemonSet</span>
<a id=__codelineno-39-14 name=__codelineno-39-14 href=#__codelineno-39-14></a>
<a id=__codelineno-39-15 name=__codelineno-39-15 href=#__codelineno-39-15></a><span class=kd>type</span><span class=w> </span><span class=nx>daemonSet</span><span class=w> </span><span class=kd>struct</span><span class=p>{}</span>
<a id=__codelineno-39-16 name=__codelineno-39-16 href=#__codelineno-39-16></a>
<a id=__codelineno-39-17 name=__codelineno-39-17 href=#__codelineno-39-17></a><span class=kd>type</span><span class=w> </span><span class=nx>DaemonSetsResp</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-39-18 name=__codelineno-39-18 href=#__codelineno-39-18></a><span class=w>    </span><span class=nx>Items</span><span class=w> </span><span class=p>[]</span><span class=nx>appsv1</span><span class=p>.</span><span class=nx>DaemonSet</span><span class=w> </span><span class=s>`json:&quot;items&quot;`</span>
<a id=__codelineno-39-19 name=__codelineno-39-19 href=#__codelineno-39-19></a><span class=w>    </span><span class=nx>Total</span><span class=w> </span><span class=kt>int</span><span class=w>                </span><span class=s>`json:&quot;total&quot;`</span>
<a id=__codelineno-39-20 name=__codelineno-39-20 href=#__codelineno-39-20></a><span class=p>}</span>
<a id=__codelineno-39-21 name=__codelineno-39-21 href=#__codelineno-39-21></a>
<a id=__codelineno-39-22 name=__codelineno-39-22 href=#__codelineno-39-22></a><span class=c1>// GetDaemonSets 获取daemonset列表，支持过滤、排序、分页</span>
<a id=__codelineno-39-23 name=__codelineno-39-23 href=#__codelineno-39-23></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>daemonSet</span><span class=p>)</span><span class=w> </span><span class=nx>GetDaemonSets</span><span class=p>(</span><span class=nx>filterName</span><span class=p>,</span><span class=w> </span><span class=nx>namespace</span><span class=w> </span><span class=kt>string</span><span class=p>,</span><span class=w> </span><span class=nx>limit</span><span class=p>,</span><span class=w> </span><span class=nx>page</span><span class=w> </span><span class=kt>int</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>daemonSetsResp</span><span class=w> </span><span class=o>*</span><span class=nx>DaemonSetsResp</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-39-24 name=__codelineno-39-24 href=#__codelineno-39-24></a><span class=w>    </span><span class=c1>//获取daemonSetList类型的daemonSet列表</span>
<a id=__codelineno-39-25 name=__codelineno-39-25 href=#__codelineno-39-25></a><span class=w>    </span><span class=nx>daemonSetList</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>AppsV1</span><span class=p>().</span><span class=nx>DaemonSets</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span><span class=nx>List</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>ListOptions</span><span class=p>{})</span>
<a id=__codelineno-39-26 name=__codelineno-39-26 href=#__codelineno-39-26></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-39-27 name=__codelineno-39-27 href=#__codelineno-39-27></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取DaemonSet列表失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-39-28 name=__codelineno-39-28 href=#__codelineno-39-28></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取DaemonSet列表失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-39-29 name=__codelineno-39-29 href=#__codelineno-39-29></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-39-30 name=__codelineno-39-30 href=#__codelineno-39-30></a><span class=w>    </span><span class=c1>//将daemonSetList中的daemonSet列表(Items)，放进dataselector对象中，进行排序</span>
<a id=__codelineno-39-31 name=__codelineno-39-31 href=#__codelineno-39-31></a><span class=w>    </span><span class=nx>selectableData</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>dataSelector</span><span class=p>{</span>
<a id=__codelineno-39-32 name=__codelineno-39-32 href=#__codelineno-39-32></a><span class=w>        </span><span class=nx>GenericDataList</span><span class=p>:</span><span class=w> </span><span class=nx>d</span><span class=p>.</span><span class=nx>toCells</span><span class=p>(</span><span class=nx>daemonSetList</span><span class=p>.</span><span class=nx>Items</span><span class=p>),</span>
<a id=__codelineno-39-33 name=__codelineno-39-33 href=#__codelineno-39-33></a><span class=w>        </span><span class=nx>dataSelectQuery</span><span class=p>:</span><span class=w> </span><span class=o>&amp;</span><span class=nx>DataSelectQuery</span><span class=p>{</span>
<a id=__codelineno-39-34 name=__codelineno-39-34 href=#__codelineno-39-34></a><span class=w>            </span><span class=nx>FilterQuery</span><span class=p>:</span><span class=w> </span><span class=o>&amp;</span><span class=nx>FilterQuery</span><span class=p>{</span><span class=nx>Name</span><span class=p>:</span><span class=w> </span><span class=nx>filterName</span><span class=p>},</span>
<a id=__codelineno-39-35 name=__codelineno-39-35 href=#__codelineno-39-35></a><span class=w>            </span><span class=nx>PaginateQuery</span><span class=p>:</span><span class=w> </span><span class=o>&amp;</span><span class=nx>PaginateQuery</span><span class=p>{</span>
<a id=__codelineno-39-36 name=__codelineno-39-36 href=#__codelineno-39-36></a><span class=w>                </span><span class=nx>Limit</span><span class=p>:</span><span class=w> </span><span class=nx>limit</span><span class=p>,</span>
<a id=__codelineno-39-37 name=__codelineno-39-37 href=#__codelineno-39-37></a><span class=w>                </span><span class=nx>Page</span><span class=p>:</span><span class=w>  </span><span class=nx>page</span><span class=p>,</span>
<a id=__codelineno-39-38 name=__codelineno-39-38 href=#__codelineno-39-38></a><span class=w>            </span><span class=p>},</span>
<a id=__codelineno-39-39 name=__codelineno-39-39 href=#__codelineno-39-39></a><span class=w>        </span><span class=p>},</span>
<a id=__codelineno-39-40 name=__codelineno-39-40 href=#__codelineno-39-40></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-39-41 name=__codelineno-39-41 href=#__codelineno-39-41></a>
<a id=__codelineno-39-42 name=__codelineno-39-42 href=#__codelineno-39-42></a><span class=w>    </span><span class=nx>filtered</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>selectableData</span><span class=p>.</span><span class=nx>Filter</span><span class=p>()</span>
<a id=__codelineno-39-43 name=__codelineno-39-43 href=#__codelineno-39-43></a><span class=w>    </span><span class=nx>total</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>filtered</span><span class=p>.</span><span class=nx>GenericDataList</span><span class=p>)</span>
<a id=__codelineno-39-44 name=__codelineno-39-44 href=#__codelineno-39-44></a><span class=w>    </span><span class=nx>data</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>filtered</span><span class=p>.</span><span class=nx>Sort</span><span class=p>().</span><span class=nx>Paginate</span><span class=p>()</span>
<a id=__codelineno-39-45 name=__codelineno-39-45 href=#__codelineno-39-45></a>
<a id=__codelineno-39-46 name=__codelineno-39-46 href=#__codelineno-39-46></a><span class=w>    </span><span class=c1>//将[]DataCell类型的daemonset列表转为v1.daemonset列表</span>
<a id=__codelineno-39-47 name=__codelineno-39-47 href=#__codelineno-39-47></a><span class=w>    </span><span class=nx>daemonSets</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>d</span><span class=p>.</span><span class=nx>fromCells</span><span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>GenericDataList</span><span class=p>)</span>
<a id=__codelineno-39-48 name=__codelineno-39-48 href=#__codelineno-39-48></a>
<a id=__codelineno-39-49 name=__codelineno-39-49 href=#__codelineno-39-49></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=o>&amp;</span><span class=nx>DaemonSetsResp</span><span class=p>{</span>
<a id=__codelineno-39-50 name=__codelineno-39-50 href=#__codelineno-39-50></a><span class=w>        </span><span class=nx>Items</span><span class=p>:</span><span class=w> </span><span class=nx>daemonSets</span><span class=p>,</span>
<a id=__codelineno-39-51 name=__codelineno-39-51 href=#__codelineno-39-51></a><span class=w>        </span><span class=nx>Total</span><span class=p>:</span><span class=w> </span><span class=nx>total</span><span class=p>,</span>
<a id=__codelineno-39-52 name=__codelineno-39-52 href=#__codelineno-39-52></a><span class=w>    </span><span class=p>},</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-39-53 name=__codelineno-39-53 href=#__codelineno-39-53></a><span class=p>}</span>
<a id=__codelineno-39-54 name=__codelineno-39-54 href=#__codelineno-39-54></a>
<a id=__codelineno-39-55 name=__codelineno-39-55 href=#__codelineno-39-55></a><span class=c1>// GetDaemonSetDetail 获取daemonset详情</span>
<a id=__codelineno-39-56 name=__codelineno-39-56 href=#__codelineno-39-56></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>daemonSet</span><span class=p>)</span><span class=w> </span><span class=nx>GetDaemonSetDetail</span><span class=p>(</span><span class=nx>daemonSetName</span><span class=p>,</span><span class=w> </span><span class=nx>namespace</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>daemonSet</span><span class=w> </span><span class=o>*</span><span class=nx>appsv1</span><span class=p>.</span><span class=nx>DaemonSet</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-39-57 name=__codelineno-39-57 href=#__codelineno-39-57></a><span class=w>    </span><span class=nx>daemonSet</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>AppsV1</span><span class=p>().</span><span class=nx>DaemonSets</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span><span class=nx>Get</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>daemonSetName</span><span class=p>,</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>GetOptions</span><span class=p>{})</span>
<a id=__codelineno-39-58 name=__codelineno-39-58 href=#__codelineno-39-58></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-39-59 name=__codelineno-39-59 href=#__codelineno-39-59></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取DaemonSet详情失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-39-60 name=__codelineno-39-60 href=#__codelineno-39-60></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取DaemonSet详情失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-39-61 name=__codelineno-39-61 href=#__codelineno-39-61></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-39-62 name=__codelineno-39-62 href=#__codelineno-39-62></a>
<a id=__codelineno-39-63 name=__codelineno-39-63 href=#__codelineno-39-63></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>daemonSet</span><span class=p>,</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-39-64 name=__codelineno-39-64 href=#__codelineno-39-64></a><span class=p>}</span>
<a id=__codelineno-39-65 name=__codelineno-39-65 href=#__codelineno-39-65></a>
<a id=__codelineno-39-66 name=__codelineno-39-66 href=#__codelineno-39-66></a><span class=c1>// DeleteDaemonSet 删除daemonset</span>
<a id=__codelineno-39-67 name=__codelineno-39-67 href=#__codelineno-39-67></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>daemonSet</span><span class=p>)</span><span class=w> </span><span class=nx>DeleteDaemonSet</span><span class=p>(</span><span class=nx>daemonSetName</span><span class=p>,</span><span class=w> </span><span class=nx>namespace</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-39-68 name=__codelineno-39-68 href=#__codelineno-39-68></a><span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>AppsV1</span><span class=p>().</span><span class=nx>DaemonSets</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span><span class=nx>Delete</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>daemonSetName</span><span class=p>,</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>DeleteOptions</span><span class=p>{})</span>
<a id=__codelineno-39-69 name=__codelineno-39-69 href=#__codelineno-39-69></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-39-70 name=__codelineno-39-70 href=#__codelineno-39-70></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;删除DaemonSet失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-39-71 name=__codelineno-39-71 href=#__codelineno-39-71></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;删除DaemonSet失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-39-72 name=__codelineno-39-72 href=#__codelineno-39-72></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-39-73 name=__codelineno-39-73 href=#__codelineno-39-73></a>
<a id=__codelineno-39-74 name=__codelineno-39-74 href=#__codelineno-39-74></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-39-75 name=__codelineno-39-75 href=#__codelineno-39-75></a><span class=p>}</span>
<a id=__codelineno-39-76 name=__codelineno-39-76 href=#__codelineno-39-76></a>
<a id=__codelineno-39-77 name=__codelineno-39-77 href=#__codelineno-39-77></a><span class=c1>// UpdateDaemonSet 更新daemonset</span>
<a id=__codelineno-39-78 name=__codelineno-39-78 href=#__codelineno-39-78></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>daemonSet</span><span class=p>)</span><span class=w> </span><span class=nx>UpdateDaemonSet</span><span class=p>(</span><span class=nx>namespace</span><span class=p>,</span><span class=w> </span><span class=nx>content</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-39-79 name=__codelineno-39-79 href=#__codelineno-39-79></a><span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=nx>daemonSet</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>appsv1</span><span class=p>.</span><span class=nx>DaemonSet</span><span class=p>{}</span>
<a id=__codelineno-39-80 name=__codelineno-39-80 href=#__codelineno-39-80></a>
<a id=__codelineno-39-81 name=__codelineno-39-81 href=#__codelineno-39-81></a><span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>json</span><span class=p>.</span><span class=nx>Unmarshal</span><span class=p>([]</span><span class=nb>byte</span><span class=p>(</span><span class=nx>content</span><span class=p>),</span><span class=w> </span><span class=nx>daemonSet</span><span class=p>)</span>
<a id=__codelineno-39-82 name=__codelineno-39-82 href=#__codelineno-39-82></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-39-83 name=__codelineno-39-83 href=#__codelineno-39-83></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;反序列化失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-39-84 name=__codelineno-39-84 href=#__codelineno-39-84></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;反序列化失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-39-85 name=__codelineno-39-85 href=#__codelineno-39-85></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-39-86 name=__codelineno-39-86 href=#__codelineno-39-86></a>
<a id=__codelineno-39-87 name=__codelineno-39-87 href=#__codelineno-39-87></a><span class=w>    </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>AppsV1</span><span class=p>().</span><span class=nx>DaemonSets</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span><span class=nx>Update</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>daemonSet</span><span class=p>,</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>UpdateOptions</span><span class=p>{})</span>
<a id=__codelineno-39-88 name=__codelineno-39-88 href=#__codelineno-39-88></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-39-89 name=__codelineno-39-89 href=#__codelineno-39-89></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;更新DaemonSet失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-39-90 name=__codelineno-39-90 href=#__codelineno-39-90></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;更新DaemonSet失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-39-91 name=__codelineno-39-91 href=#__codelineno-39-91></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-39-92 name=__codelineno-39-92 href=#__codelineno-39-92></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-39-93 name=__codelineno-39-93 href=#__codelineno-39-93></a><span class=p>}</span>
<a id=__codelineno-39-94 name=__codelineno-39-94 href=#__codelineno-39-94></a>
<a id=__codelineno-39-95 name=__codelineno-39-95 href=#__codelineno-39-95></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>daemonSet</span><span class=p>)</span><span class=w> </span><span class=nx>toCells</span><span class=p>(</span><span class=nx>std</span><span class=w> </span><span class=p>[]</span><span class=nx>appsv1</span><span class=p>.</span><span class=nx>DaemonSet</span><span class=p>)</span><span class=w> </span><span class=p>[]</span><span class=nx>DataCell</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-39-96 name=__codelineno-39-96 href=#__codelineno-39-96></a><span class=w>    </span><span class=nx>cells</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>make</span><span class=p>([]</span><span class=nx>DataCell</span><span class=p>,</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>std</span><span class=p>))</span>
<a id=__codelineno-39-97 name=__codelineno-39-97 href=#__codelineno-39-97></a><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=nx>i</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>std</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-39-98 name=__codelineno-39-98 href=#__codelineno-39-98></a><span class=w>        </span><span class=nx>cells</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>daemonSetCell</span><span class=p>(</span><span class=nx>std</span><span class=p>[</span><span class=nx>i</span><span class=p>])</span>
<a id=__codelineno-39-99 name=__codelineno-39-99 href=#__codelineno-39-99></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-39-100 name=__codelineno-39-100 href=#__codelineno-39-100></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>cells</span>
<a id=__codelineno-39-101 name=__codelineno-39-101 href=#__codelineno-39-101></a><span class=p>}</span>
<a id=__codelineno-39-102 name=__codelineno-39-102 href=#__codelineno-39-102></a>
<a id=__codelineno-39-103 name=__codelineno-39-103 href=#__codelineno-39-103></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>daemonSet</span><span class=p>)</span><span class=w> </span><span class=nx>fromCells</span><span class=p>(</span><span class=nx>cells</span><span class=w> </span><span class=p>[]</span><span class=nx>DataCell</span><span class=p>)</span><span class=w> </span><span class=p>[]</span><span class=nx>appsv1</span><span class=p>.</span><span class=nx>DaemonSet</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-39-104 name=__codelineno-39-104 href=#__codelineno-39-104></a><span class=w>    </span><span class=nx>daemonSets</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>make</span><span class=p>([]</span><span class=nx>appsv1</span><span class=p>.</span><span class=nx>DaemonSet</span><span class=p>,</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>cells</span><span class=p>))</span>
<a id=__codelineno-39-105 name=__codelineno-39-105 href=#__codelineno-39-105></a><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=nx>i</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>cells</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-39-106 name=__codelineno-39-106 href=#__codelineno-39-106></a><span class=w>        </span><span class=nx>daemonSets</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>appsv1</span><span class=p>.</span><span class=nx>DaemonSet</span><span class=p>(</span><span class=nx>cells</span><span class=p>[</span><span class=nx>i</span><span class=p>].(</span><span class=nx>daemonSetCell</span><span class=p>))</span>
<a id=__codelineno-39-107 name=__codelineno-39-107 href=#__codelineno-39-107></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-39-108 name=__codelineno-39-108 href=#__codelineno-39-108></a>
<a id=__codelineno-39-109 name=__codelineno-39-109 href=#__codelineno-39-109></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>daemonSets</span>
<a id=__codelineno-39-110 name=__codelineno-39-110 href=#__codelineno-39-110></a><span class=p>}</span>
</code></pre></div> <h5 id=controllerdaemonsetgo>controller/daemonset.go<a class=headerlink href=#controllerdaemonsetgo title="Permanent link">&para;</a></h5> <div class=highlight><pre><span></span><code><a id=__codelineno-40-1 name=__codelineno-40-1 href=#__codelineno-40-1></a><span class=kn>package</span><span class=w> </span><span class=nx>controller</span>
<a id=__codelineno-40-2 name=__codelineno-40-2 href=#__codelineno-40-2></a>
<a id=__codelineno-40-3 name=__codelineno-40-3 href=#__codelineno-40-3></a><span class=kn>import</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-40-4 name=__codelineno-40-4 href=#__codelineno-40-4></a><span class=w>    </span><span class=s>&quot;gitee.com/k8s-platform/service&quot;</span>
<a id=__codelineno-40-5 name=__codelineno-40-5 href=#__codelineno-40-5></a><span class=w>    </span><span class=s>&quot;net/http&quot;</span>
<a id=__codelineno-40-6 name=__codelineno-40-6 href=#__codelineno-40-6></a>
<a id=__codelineno-40-7 name=__codelineno-40-7 href=#__codelineno-40-7></a><span class=w>    </span><span class=s>&quot;github.com/gin-gonic/gin&quot;</span>
<a id=__codelineno-40-8 name=__codelineno-40-8 href=#__codelineno-40-8></a><span class=w>    </span><span class=s>&quot;github.com/wonderivan/logger&quot;</span>
<a id=__codelineno-40-9 name=__codelineno-40-9 href=#__codelineno-40-9></a><span class=p>)</span>
<a id=__codelineno-40-10 name=__codelineno-40-10 href=#__codelineno-40-10></a>
<a id=__codelineno-40-11 name=__codelineno-40-11 href=#__codelineno-40-11></a><span class=kd>var</span><span class=w> </span><span class=nx>DaemonSet</span><span class=w> </span><span class=nx>daemonSet</span>
<a id=__codelineno-40-12 name=__codelineno-40-12 href=#__codelineno-40-12></a>
<a id=__codelineno-40-13 name=__codelineno-40-13 href=#__codelineno-40-13></a><span class=kd>type</span><span class=w> </span><span class=nx>daemonSet</span><span class=w> </span><span class=kd>struct</span><span class=p>{}</span>
<a id=__codelineno-40-14 name=__codelineno-40-14 href=#__codelineno-40-14></a>
<a id=__codelineno-40-15 name=__codelineno-40-15 href=#__codelineno-40-15></a><span class=c1>// GetDaemonSets 获取daemonset列表，支持过滤、排序、分页</span>
<a id=__codelineno-40-16 name=__codelineno-40-16 href=#__codelineno-40-16></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>daemonSet</span><span class=p>)</span><span class=w> </span><span class=nx>GetDaemonSets</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-40-17 name=__codelineno-40-17 href=#__codelineno-40-17></a><span class=w>    </span><span class=nx>params</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-40-18 name=__codelineno-40-18 href=#__codelineno-40-18></a><span class=w>        </span><span class=nx>FilterName</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`form:&quot;filter_name&quot;`</span>
<a id=__codelineno-40-19 name=__codelineno-40-19 href=#__codelineno-40-19></a><span class=w>        </span><span class=nx>Namespace</span><span class=w>  </span><span class=kt>string</span><span class=w> </span><span class=s>`form:&quot;namespace&quot;`</span>
<a id=__codelineno-40-20 name=__codelineno-40-20 href=#__codelineno-40-20></a><span class=w>        </span><span class=nx>Page</span><span class=w>       </span><span class=kt>int</span><span class=w>    </span><span class=s>`form:&quot;page&quot;`</span>
<a id=__codelineno-40-21 name=__codelineno-40-21 href=#__codelineno-40-21></a><span class=w>        </span><span class=nx>Limit</span><span class=w>      </span><span class=kt>int</span><span class=w>    </span><span class=s>`form:&quot;limit&quot;`</span>
<a id=__codelineno-40-22 name=__codelineno-40-22 href=#__codelineno-40-22></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-40-23 name=__codelineno-40-23 href=#__codelineno-40-23></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>Bind</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-40-24 name=__codelineno-40-24 href=#__codelineno-40-24></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-40-25 name=__codelineno-40-25 href=#__codelineno-40-25></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-40-26 name=__codelineno-40-26 href=#__codelineno-40-26></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-40-27 name=__codelineno-40-27 href=#__codelineno-40-27></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-40-28 name=__codelineno-40-28 href=#__codelineno-40-28></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-40-29 name=__codelineno-40-29 href=#__codelineno-40-29></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-40-30 name=__codelineno-40-30 href=#__codelineno-40-30></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-40-31 name=__codelineno-40-31 href=#__codelineno-40-31></a>
<a id=__codelineno-40-32 name=__codelineno-40-32 href=#__codelineno-40-32></a><span class=w>    </span><span class=nx>data</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>DaemonSet</span><span class=p>.</span><span class=nx>GetDaemonSets</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>FilterName</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Limit</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Page</span><span class=p>)</span>
<a id=__codelineno-40-33 name=__codelineno-40-33 href=#__codelineno-40-33></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-40-34 name=__codelineno-40-34 href=#__codelineno-40-34></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-40-35 name=__codelineno-40-35 href=#__codelineno-40-35></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-40-36 name=__codelineno-40-36 href=#__codelineno-40-36></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-40-37 name=__codelineno-40-37 href=#__codelineno-40-37></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-40-38 name=__codelineno-40-38 href=#__codelineno-40-38></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-40-39 name=__codelineno-40-39 href=#__codelineno-40-39></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-40-40 name=__codelineno-40-40 href=#__codelineno-40-40></a>
<a id=__codelineno-40-41 name=__codelineno-40-41 href=#__codelineno-40-41></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-40-42 name=__codelineno-40-42 href=#__codelineno-40-42></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;获取DaemonSet列表成功&quot;</span><span class=p>,</span>
<a id=__codelineno-40-43 name=__codelineno-40-43 href=#__codelineno-40-43></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=nx>data</span><span class=p>,</span>
<a id=__codelineno-40-44 name=__codelineno-40-44 href=#__codelineno-40-44></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-40-45 name=__codelineno-40-45 href=#__codelineno-40-45></a><span class=p>}</span>
<a id=__codelineno-40-46 name=__codelineno-40-46 href=#__codelineno-40-46></a>
<a id=__codelineno-40-47 name=__codelineno-40-47 href=#__codelineno-40-47></a><span class=c1>// GetDaemonSetDetail 获取daemonset详情</span>
<a id=__codelineno-40-48 name=__codelineno-40-48 href=#__codelineno-40-48></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>daemonSet</span><span class=p>)</span><span class=w> </span><span class=nx>GetDaemonSetDetail</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-40-49 name=__codelineno-40-49 href=#__codelineno-40-49></a><span class=w>    </span><span class=nx>params</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-40-50 name=__codelineno-40-50 href=#__codelineno-40-50></a><span class=w>        </span><span class=nx>DaemonSetName</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`form:&quot;daemonset_name&quot;`</span>
<a id=__codelineno-40-51 name=__codelineno-40-51 href=#__codelineno-40-51></a><span class=w>        </span><span class=nx>Namespace</span><span class=w>     </span><span class=kt>string</span><span class=w> </span><span class=s>`form:&quot;namespace&quot;`</span>
<a id=__codelineno-40-52 name=__codelineno-40-52 href=#__codelineno-40-52></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-40-53 name=__codelineno-40-53 href=#__codelineno-40-53></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>Bind</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-40-54 name=__codelineno-40-54 href=#__codelineno-40-54></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-40-55 name=__codelineno-40-55 href=#__codelineno-40-55></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-40-56 name=__codelineno-40-56 href=#__codelineno-40-56></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-40-57 name=__codelineno-40-57 href=#__codelineno-40-57></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-40-58 name=__codelineno-40-58 href=#__codelineno-40-58></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-40-59 name=__codelineno-40-59 href=#__codelineno-40-59></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-40-60 name=__codelineno-40-60 href=#__codelineno-40-60></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-40-61 name=__codelineno-40-61 href=#__codelineno-40-61></a>
<a id=__codelineno-40-62 name=__codelineno-40-62 href=#__codelineno-40-62></a><span class=w>    </span><span class=nx>data</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>DaemonSet</span><span class=p>.</span><span class=nx>GetDaemonSetDetail</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>DaemonSetName</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>)</span>
<a id=__codelineno-40-63 name=__codelineno-40-63 href=#__codelineno-40-63></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-40-64 name=__codelineno-40-64 href=#__codelineno-40-64></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-40-65 name=__codelineno-40-65 href=#__codelineno-40-65></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-40-66 name=__codelineno-40-66 href=#__codelineno-40-66></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-40-67 name=__codelineno-40-67 href=#__codelineno-40-67></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-40-68 name=__codelineno-40-68 href=#__codelineno-40-68></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-40-69 name=__codelineno-40-69 href=#__codelineno-40-69></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-40-70 name=__codelineno-40-70 href=#__codelineno-40-70></a>
<a id=__codelineno-40-71 name=__codelineno-40-71 href=#__codelineno-40-71></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-40-72 name=__codelineno-40-72 href=#__codelineno-40-72></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;获取DaemonSet详情成功&quot;</span><span class=p>,</span>
<a id=__codelineno-40-73 name=__codelineno-40-73 href=#__codelineno-40-73></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=nx>data</span><span class=p>,</span>
<a id=__codelineno-40-74 name=__codelineno-40-74 href=#__codelineno-40-74></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-40-75 name=__codelineno-40-75 href=#__codelineno-40-75></a><span class=p>}</span>
<a id=__codelineno-40-76 name=__codelineno-40-76 href=#__codelineno-40-76></a>
<a id=__codelineno-40-77 name=__codelineno-40-77 href=#__codelineno-40-77></a><span class=c1>// DeleteDaemonSet 删除daemonset</span>
<a id=__codelineno-40-78 name=__codelineno-40-78 href=#__codelineno-40-78></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>daemonSet</span><span class=p>)</span><span class=w> </span><span class=nx>DeleteDaemonSet</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-40-79 name=__codelineno-40-79 href=#__codelineno-40-79></a><span class=w>    </span><span class=nx>params</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-40-80 name=__codelineno-40-80 href=#__codelineno-40-80></a><span class=w>        </span><span class=nx>DaemonSetName</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;daemonset_name&quot;`</span>
<a id=__codelineno-40-81 name=__codelineno-40-81 href=#__codelineno-40-81></a><span class=w>        </span><span class=nx>Namespace</span><span class=w>     </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;namespace&quot;`</span>
<a id=__codelineno-40-82 name=__codelineno-40-82 href=#__codelineno-40-82></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-40-83 name=__codelineno-40-83 href=#__codelineno-40-83></a><span class=w>    </span><span class=c1>//DELETE请求，绑定参数方法改为ctx.ShouldBindJSON</span>
<a id=__codelineno-40-84 name=__codelineno-40-84 href=#__codelineno-40-84></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>ShouldBindJSON</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-40-85 name=__codelineno-40-85 href=#__codelineno-40-85></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-40-86 name=__codelineno-40-86 href=#__codelineno-40-86></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-40-87 name=__codelineno-40-87 href=#__codelineno-40-87></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-40-88 name=__codelineno-40-88 href=#__codelineno-40-88></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-40-89 name=__codelineno-40-89 href=#__codelineno-40-89></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-40-90 name=__codelineno-40-90 href=#__codelineno-40-90></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-40-91 name=__codelineno-40-91 href=#__codelineno-40-91></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-40-92 name=__codelineno-40-92 href=#__codelineno-40-92></a>
<a id=__codelineno-40-93 name=__codelineno-40-93 href=#__codelineno-40-93></a><span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>DaemonSet</span><span class=p>.</span><span class=nx>DeleteDaemonSet</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>DaemonSetName</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>)</span>
<a id=__codelineno-40-94 name=__codelineno-40-94 href=#__codelineno-40-94></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-40-95 name=__codelineno-40-95 href=#__codelineno-40-95></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-40-96 name=__codelineno-40-96 href=#__codelineno-40-96></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-40-97 name=__codelineno-40-97 href=#__codelineno-40-97></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-40-98 name=__codelineno-40-98 href=#__codelineno-40-98></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-40-99 name=__codelineno-40-99 href=#__codelineno-40-99></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-40-100 name=__codelineno-40-100 href=#__codelineno-40-100></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-40-101 name=__codelineno-40-101 href=#__codelineno-40-101></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-40-102 name=__codelineno-40-102 href=#__codelineno-40-102></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;删除DaemonSet成功&quot;</span><span class=p>,</span>
<a id=__codelineno-40-103 name=__codelineno-40-103 href=#__codelineno-40-103></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-40-104 name=__codelineno-40-104 href=#__codelineno-40-104></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-40-105 name=__codelineno-40-105 href=#__codelineno-40-105></a><span class=p>}</span>
<a id=__codelineno-40-106 name=__codelineno-40-106 href=#__codelineno-40-106></a>
<a id=__codelineno-40-107 name=__codelineno-40-107 href=#__codelineno-40-107></a><span class=c1>// UpdateDaemonSet 更新daemonset</span>
<a id=__codelineno-40-108 name=__codelineno-40-108 href=#__codelineno-40-108></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>daemonSet</span><span class=p>)</span><span class=w> </span><span class=nx>UpdateDaemonSet</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-40-109 name=__codelineno-40-109 href=#__codelineno-40-109></a><span class=w>    </span><span class=nx>params</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-40-110 name=__codelineno-40-110 href=#__codelineno-40-110></a><span class=w>        </span><span class=nx>Namespace</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;namespace&quot;`</span>
<a id=__codelineno-40-111 name=__codelineno-40-111 href=#__codelineno-40-111></a><span class=w>        </span><span class=nx>Content</span><span class=w>   </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;content&quot;`</span>
<a id=__codelineno-40-112 name=__codelineno-40-112 href=#__codelineno-40-112></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-40-113 name=__codelineno-40-113 href=#__codelineno-40-113></a><span class=w>    </span><span class=c1>//PUT请求，绑定参数方法改为ctx.ShouldBindJSON</span>
<a id=__codelineno-40-114 name=__codelineno-40-114 href=#__codelineno-40-114></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>ShouldBindJSON</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-40-115 name=__codelineno-40-115 href=#__codelineno-40-115></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-40-116 name=__codelineno-40-116 href=#__codelineno-40-116></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-40-117 name=__codelineno-40-117 href=#__codelineno-40-117></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-40-118 name=__codelineno-40-118 href=#__codelineno-40-118></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-40-119 name=__codelineno-40-119 href=#__codelineno-40-119></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-40-120 name=__codelineno-40-120 href=#__codelineno-40-120></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-40-121 name=__codelineno-40-121 href=#__codelineno-40-121></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-40-122 name=__codelineno-40-122 href=#__codelineno-40-122></a>
<a id=__codelineno-40-123 name=__codelineno-40-123 href=#__codelineno-40-123></a><span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>DaemonSet</span><span class=p>.</span><span class=nx>UpdateDaemonSet</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Content</span><span class=p>)</span>
<a id=__codelineno-40-124 name=__codelineno-40-124 href=#__codelineno-40-124></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-40-125 name=__codelineno-40-125 href=#__codelineno-40-125></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-40-126 name=__codelineno-40-126 href=#__codelineno-40-126></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-40-127 name=__codelineno-40-127 href=#__codelineno-40-127></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-40-128 name=__codelineno-40-128 href=#__codelineno-40-128></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-40-129 name=__codelineno-40-129 href=#__codelineno-40-129></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-40-130 name=__codelineno-40-130 href=#__codelineno-40-130></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-40-131 name=__codelineno-40-131 href=#__codelineno-40-131></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-40-132 name=__codelineno-40-132 href=#__codelineno-40-132></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;更新DaemonSet成功&quot;</span><span class=p>,</span>
<a id=__codelineno-40-133 name=__codelineno-40-133 href=#__codelineno-40-133></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-40-134 name=__codelineno-40-134 href=#__codelineno-40-134></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-40-135 name=__codelineno-40-135 href=#__codelineno-40-135></a><span class=p>}</span>
</code></pre></div> <h4 id=25-statefulset>2.5 StatefulSet<a class=headerlink href=#25-statefulset title="Permanent link">&para;</a></h4> <blockquote> <p>注意：以下功能与Pod和Deployment是实现方式一致</p> </blockquote> <table> <thead> <tr> <th>功能</th> <th>是否实现</th> </tr> </thead> <tbody> <tr> <td>StatefulSet列表</td> <td>√</td> </tr> <tr> <td>获取StatefulSet详情</td> <td>√</td> </tr> <tr> <td>删除StatefulSet</td> <td>√</td> </tr> <tr> <td>更新StatefulSet</td> <td>√</td> </tr> </tbody> </table> <h5 id=servicedataselectorgo_2>service/dataselector.go<a class=headerlink href=#servicedataselectorgo_2 title="Permanent link">&para;</a></h5> <div class=highlight><pre><span></span><code><a id=__codelineno-41-1 name=__codelineno-41-1 href=#__codelineno-41-1></a><span class=c1>// 实现 StatefulSet 的 DataCell接口</span>
<a id=__codelineno-41-2 name=__codelineno-41-2 href=#__codelineno-41-2></a><span class=kd>type</span><span class=w> </span><span class=nx>statefulSetCell</span><span class=w> </span><span class=nx>appsv1</span><span class=p>.</span><span class=nx>StatefulSet</span>
<a id=__codelineno-41-3 name=__codelineno-41-3 href=#__codelineno-41-3></a>
<a id=__codelineno-41-4 name=__codelineno-41-4 href=#__codelineno-41-4></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>s</span><span class=w> </span><span class=nx>statefulSetCell</span><span class=p>)</span><span class=w> </span><span class=nx>GetCreation</span><span class=p>()</span><span class=w> </span><span class=nx>time</span><span class=p>.</span><span class=nx>Time</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-41-5 name=__codelineno-41-5 href=#__codelineno-41-5></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>s</span><span class=p>.</span><span class=nx>CreationTimestamp</span><span class=p>.</span><span class=nx>Time</span>
<a id=__codelineno-41-6 name=__codelineno-41-6 href=#__codelineno-41-6></a><span class=p>}</span>
<a id=__codelineno-41-7 name=__codelineno-41-7 href=#__codelineno-41-7></a>
<a id=__codelineno-41-8 name=__codelineno-41-8 href=#__codelineno-41-8></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>s</span><span class=w> </span><span class=nx>statefulSetCell</span><span class=p>)</span><span class=w> </span><span class=nx>GetName</span><span class=p>()</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-41-9 name=__codelineno-41-9 href=#__codelineno-41-9></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>s</span><span class=p>.</span><span class=nx>Name</span>
<a id=__codelineno-41-10 name=__codelineno-41-10 href=#__codelineno-41-10></a><span class=p>}</span>
</code></pre></div> <h5 id=servicestatefulsetgo>service/statefulset.go<a class=headerlink href=#servicestatefulsetgo title="Permanent link">&para;</a></h5> <div class=highlight><pre><span></span><code><a id=__codelineno-42-1 name=__codelineno-42-1 href=#__codelineno-42-1></a><span class=kn>package</span><span class=w> </span><span class=nx>service</span>
<a id=__codelineno-42-2 name=__codelineno-42-2 href=#__codelineno-42-2></a>
<a id=__codelineno-42-3 name=__codelineno-42-3 href=#__codelineno-42-3></a><span class=kn>import</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-42-4 name=__codelineno-42-4 href=#__codelineno-42-4></a><span class=w>    </span><span class=s>&quot;context&quot;</span>
<a id=__codelineno-42-5 name=__codelineno-42-5 href=#__codelineno-42-5></a><span class=w>    </span><span class=s>&quot;encoding/json&quot;</span>
<a id=__codelineno-42-6 name=__codelineno-42-6 href=#__codelineno-42-6></a><span class=w>    </span><span class=s>&quot;errors&quot;</span>
<a id=__codelineno-42-7 name=__codelineno-42-7 href=#__codelineno-42-7></a>
<a id=__codelineno-42-8 name=__codelineno-42-8 href=#__codelineno-42-8></a><span class=w>    </span><span class=s>&quot;github.com/wonderivan/logger&quot;</span>
<a id=__codelineno-42-9 name=__codelineno-42-9 href=#__codelineno-42-9></a><span class=w>    </span><span class=nx>appsv1</span><span class=w> </span><span class=s>&quot;k8s.io/api/apps/v1&quot;</span>
<a id=__codelineno-42-10 name=__codelineno-42-10 href=#__codelineno-42-10></a><span class=w>    </span><span class=nx>metav1</span><span class=w> </span><span class=s>&quot;k8s.io/apimachinery/pkg/apis/meta/v1&quot;</span>
<a id=__codelineno-42-11 name=__codelineno-42-11 href=#__codelineno-42-11></a><span class=p>)</span>
<a id=__codelineno-42-12 name=__codelineno-42-12 href=#__codelineno-42-12></a>
<a id=__codelineno-42-13 name=__codelineno-42-13 href=#__codelineno-42-13></a><span class=kd>var</span><span class=w> </span><span class=nx>StatefulSet</span><span class=w> </span><span class=nx>statefulSet</span>
<a id=__codelineno-42-14 name=__codelineno-42-14 href=#__codelineno-42-14></a>
<a id=__codelineno-42-15 name=__codelineno-42-15 href=#__codelineno-42-15></a><span class=kd>type</span><span class=w> </span><span class=nx>statefulSet</span><span class=w> </span><span class=kd>struct</span><span class=p>{}</span>
<a id=__codelineno-42-16 name=__codelineno-42-16 href=#__codelineno-42-16></a>
<a id=__codelineno-42-17 name=__codelineno-42-17 href=#__codelineno-42-17></a><span class=kd>type</span><span class=w> </span><span class=nx>StatusfulSetsResp</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-42-18 name=__codelineno-42-18 href=#__codelineno-42-18></a><span class=w>    </span><span class=nx>Items</span><span class=w> </span><span class=p>[]</span><span class=nx>appsv1</span><span class=p>.</span><span class=nx>StatefulSet</span><span class=w> </span><span class=s>`json:&quot;items&quot;`</span>
<a id=__codelineno-42-19 name=__codelineno-42-19 href=#__codelineno-42-19></a><span class=w>    </span><span class=nx>Total</span><span class=w> </span><span class=kt>int</span><span class=w>                  </span><span class=s>`json:&quot;total&quot;`</span>
<a id=__codelineno-42-20 name=__codelineno-42-20 href=#__codelineno-42-20></a><span class=p>}</span>
<a id=__codelineno-42-21 name=__codelineno-42-21 href=#__codelineno-42-21></a>
<a id=__codelineno-42-22 name=__codelineno-42-22 href=#__codelineno-42-22></a><span class=c1>// GetStatefulSets 获取statefulset列表，支持过滤、排序、分页</span>
<a id=__codelineno-42-23 name=__codelineno-42-23 href=#__codelineno-42-23></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>s</span><span class=w> </span><span class=o>*</span><span class=nx>statefulSet</span><span class=p>)</span><span class=w> </span><span class=nx>GetStatefulSets</span><span class=p>(</span><span class=nx>filterName</span><span class=p>,</span><span class=w> </span><span class=nx>namespace</span><span class=w> </span><span class=kt>string</span><span class=p>,</span><span class=w> </span><span class=nx>limit</span><span class=p>,</span><span class=w> </span><span class=nx>page</span><span class=w> </span><span class=kt>int</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>statusfulSetsResp</span><span class=w> </span><span class=o>*</span><span class=nx>StatusfulSetsResp</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-42-24 name=__codelineno-42-24 href=#__codelineno-42-24></a><span class=w>    </span><span class=c1>//获取statefulSetList类型的statefulSet列表</span>
<a id=__codelineno-42-25 name=__codelineno-42-25 href=#__codelineno-42-25></a><span class=w>    </span><span class=nx>statefulSetList</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>AppsV1</span><span class=p>().</span><span class=nx>StatefulSets</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span><span class=nx>List</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>ListOptions</span><span class=p>{})</span>
<a id=__codelineno-42-26 name=__codelineno-42-26 href=#__codelineno-42-26></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-42-27 name=__codelineno-42-27 href=#__codelineno-42-27></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取StatefulSet列表失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-42-28 name=__codelineno-42-28 href=#__codelineno-42-28></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取StatefulSet列表失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-42-29 name=__codelineno-42-29 href=#__codelineno-42-29></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-42-30 name=__codelineno-42-30 href=#__codelineno-42-30></a><span class=w>    </span><span class=c1>//将statefulSetList中的StatefulSet列表(Items)，放进dataselector对象中，进行排序</span>
<a id=__codelineno-42-31 name=__codelineno-42-31 href=#__codelineno-42-31></a><span class=w>    </span><span class=nx>selectableData</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>dataSelector</span><span class=p>{</span>
<a id=__codelineno-42-32 name=__codelineno-42-32 href=#__codelineno-42-32></a><span class=w>        </span><span class=nx>GenericDataList</span><span class=p>:</span><span class=w> </span><span class=nx>s</span><span class=p>.</span><span class=nx>toCells</span><span class=p>(</span><span class=nx>statefulSetList</span><span class=p>.</span><span class=nx>Items</span><span class=p>),</span>
<a id=__codelineno-42-33 name=__codelineno-42-33 href=#__codelineno-42-33></a><span class=w>        </span><span class=nx>dataSelectQuery</span><span class=p>:</span><span class=w> </span><span class=o>&amp;</span><span class=nx>DataSelectQuery</span><span class=p>{</span>
<a id=__codelineno-42-34 name=__codelineno-42-34 href=#__codelineno-42-34></a><span class=w>            </span><span class=nx>FilterQuery</span><span class=p>:</span><span class=w> </span><span class=o>&amp;</span><span class=nx>FilterQuery</span><span class=p>{</span><span class=nx>Name</span><span class=p>:</span><span class=w> </span><span class=nx>filterName</span><span class=p>},</span>
<a id=__codelineno-42-35 name=__codelineno-42-35 href=#__codelineno-42-35></a><span class=w>            </span><span class=nx>PaginateQuery</span><span class=p>:</span><span class=w> </span><span class=o>&amp;</span><span class=nx>PaginateQuery</span><span class=p>{</span>
<a id=__codelineno-42-36 name=__codelineno-42-36 href=#__codelineno-42-36></a><span class=w>                </span><span class=nx>Limit</span><span class=p>:</span><span class=w> </span><span class=nx>limit</span><span class=p>,</span>
<a id=__codelineno-42-37 name=__codelineno-42-37 href=#__codelineno-42-37></a><span class=w>                </span><span class=nx>Page</span><span class=p>:</span><span class=w>  </span><span class=nx>page</span><span class=p>,</span>
<a id=__codelineno-42-38 name=__codelineno-42-38 href=#__codelineno-42-38></a><span class=w>            </span><span class=p>},</span>
<a id=__codelineno-42-39 name=__codelineno-42-39 href=#__codelineno-42-39></a><span class=w>        </span><span class=p>},</span>
<a id=__codelineno-42-40 name=__codelineno-42-40 href=#__codelineno-42-40></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-42-41 name=__codelineno-42-41 href=#__codelineno-42-41></a>
<a id=__codelineno-42-42 name=__codelineno-42-42 href=#__codelineno-42-42></a><span class=w>    </span><span class=nx>filtered</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>selectableData</span><span class=p>.</span><span class=nx>Filter</span><span class=p>()</span>
<a id=__codelineno-42-43 name=__codelineno-42-43 href=#__codelineno-42-43></a><span class=w>    </span><span class=nx>total</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>filtered</span><span class=p>.</span><span class=nx>GenericDataList</span><span class=p>)</span>
<a id=__codelineno-42-44 name=__codelineno-42-44 href=#__codelineno-42-44></a><span class=w>    </span><span class=nx>data</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>filtered</span><span class=p>.</span><span class=nx>Sort</span><span class=p>().</span><span class=nx>Paginate</span><span class=p>()</span>
<a id=__codelineno-42-45 name=__codelineno-42-45 href=#__codelineno-42-45></a>
<a id=__codelineno-42-46 name=__codelineno-42-46 href=#__codelineno-42-46></a><span class=w>    </span><span class=c1>//将[]DataCell类型的statefulset列表转为v1.statefulset列表</span>
<a id=__codelineno-42-47 name=__codelineno-42-47 href=#__codelineno-42-47></a><span class=w>    </span><span class=nx>statefulSets</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>s</span><span class=p>.</span><span class=nx>fromCells</span><span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>GenericDataList</span><span class=p>)</span>
<a id=__codelineno-42-48 name=__codelineno-42-48 href=#__codelineno-42-48></a>
<a id=__codelineno-42-49 name=__codelineno-42-49 href=#__codelineno-42-49></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=o>&amp;</span><span class=nx>StatusfulSetsResp</span><span class=p>{</span>
<a id=__codelineno-42-50 name=__codelineno-42-50 href=#__codelineno-42-50></a><span class=w>        </span><span class=nx>Items</span><span class=p>:</span><span class=w> </span><span class=nx>statefulSets</span><span class=p>,</span>
<a id=__codelineno-42-51 name=__codelineno-42-51 href=#__codelineno-42-51></a><span class=w>        </span><span class=nx>Total</span><span class=p>:</span><span class=w> </span><span class=nx>total</span><span class=p>,</span>
<a id=__codelineno-42-52 name=__codelineno-42-52 href=#__codelineno-42-52></a><span class=w>    </span><span class=p>},</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-42-53 name=__codelineno-42-53 href=#__codelineno-42-53></a><span class=p>}</span>
<a id=__codelineno-42-54 name=__codelineno-42-54 href=#__codelineno-42-54></a>
<a id=__codelineno-42-55 name=__codelineno-42-55 href=#__codelineno-42-55></a><span class=c1>// GetStatefulSetDetail 获取statefulset详情</span>
<a id=__codelineno-42-56 name=__codelineno-42-56 href=#__codelineno-42-56></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>s</span><span class=w> </span><span class=o>*</span><span class=nx>statefulSet</span><span class=p>)</span><span class=w> </span><span class=nx>GetStatefulSetDetail</span><span class=p>(</span><span class=nx>statefulSetName</span><span class=p>,</span><span class=w> </span><span class=nx>namespace</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>statefulSet</span><span class=w> </span><span class=o>*</span><span class=nx>appsv1</span><span class=p>.</span><span class=nx>StatefulSet</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-42-57 name=__codelineno-42-57 href=#__codelineno-42-57></a><span class=w>    </span><span class=nx>statefulSet</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>AppsV1</span><span class=p>().</span><span class=nx>StatefulSets</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span><span class=nx>Get</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>statefulSetName</span><span class=p>,</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>GetOptions</span><span class=p>{})</span>
<a id=__codelineno-42-58 name=__codelineno-42-58 href=#__codelineno-42-58></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-42-59 name=__codelineno-42-59 href=#__codelineno-42-59></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取StatefulSet详情失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-42-60 name=__codelineno-42-60 href=#__codelineno-42-60></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取StatefulSet详情失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-42-61 name=__codelineno-42-61 href=#__codelineno-42-61></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-42-62 name=__codelineno-42-62 href=#__codelineno-42-62></a>
<a id=__codelineno-42-63 name=__codelineno-42-63 href=#__codelineno-42-63></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>statefulSet</span><span class=p>,</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-42-64 name=__codelineno-42-64 href=#__codelineno-42-64></a><span class=p>}</span>
<a id=__codelineno-42-65 name=__codelineno-42-65 href=#__codelineno-42-65></a>
<a id=__codelineno-42-66 name=__codelineno-42-66 href=#__codelineno-42-66></a><span class=c1>// DeleteStatefulSet 删除statefulset</span>
<a id=__codelineno-42-67 name=__codelineno-42-67 href=#__codelineno-42-67></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>s</span><span class=w> </span><span class=o>*</span><span class=nx>statefulSet</span><span class=p>)</span><span class=w> </span><span class=nx>DeleteStatefulSet</span><span class=p>(</span><span class=nx>statefulSetName</span><span class=p>,</span><span class=w> </span><span class=nx>namespace</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-42-68 name=__codelineno-42-68 href=#__codelineno-42-68></a><span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>AppsV1</span><span class=p>().</span><span class=nx>StatefulSets</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span><span class=nx>Delete</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>statefulSetName</span><span class=p>,</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>DeleteOptions</span><span class=p>{})</span>
<a id=__codelineno-42-69 name=__codelineno-42-69 href=#__codelineno-42-69></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-42-70 name=__codelineno-42-70 href=#__codelineno-42-70></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;删除StatefulSet失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-42-71 name=__codelineno-42-71 href=#__codelineno-42-71></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;删除StatefulSet失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-42-72 name=__codelineno-42-72 href=#__codelineno-42-72></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-42-73 name=__codelineno-42-73 href=#__codelineno-42-73></a>
<a id=__codelineno-42-74 name=__codelineno-42-74 href=#__codelineno-42-74></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-42-75 name=__codelineno-42-75 href=#__codelineno-42-75></a><span class=p>}</span>
<a id=__codelineno-42-76 name=__codelineno-42-76 href=#__codelineno-42-76></a>
<a id=__codelineno-42-77 name=__codelineno-42-77 href=#__codelineno-42-77></a><span class=c1>// UpdateStatefulSet 更新statefulset</span>
<a id=__codelineno-42-78 name=__codelineno-42-78 href=#__codelineno-42-78></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>s</span><span class=w> </span><span class=o>*</span><span class=nx>statefulSet</span><span class=p>)</span><span class=w> </span><span class=nx>UpdateStatefulSet</span><span class=p>(</span><span class=nx>namespace</span><span class=p>,</span><span class=w> </span><span class=nx>content</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-42-79 name=__codelineno-42-79 href=#__codelineno-42-79></a><span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=nx>statefulSet</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>appsv1</span><span class=p>.</span><span class=nx>StatefulSet</span><span class=p>{}</span>
<a id=__codelineno-42-80 name=__codelineno-42-80 href=#__codelineno-42-80></a>
<a id=__codelineno-42-81 name=__codelineno-42-81 href=#__codelineno-42-81></a><span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>json</span><span class=p>.</span><span class=nx>Unmarshal</span><span class=p>([]</span><span class=nb>byte</span><span class=p>(</span><span class=nx>content</span><span class=p>),</span><span class=w> </span><span class=nx>statefulSet</span><span class=p>)</span>
<a id=__codelineno-42-82 name=__codelineno-42-82 href=#__codelineno-42-82></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-42-83 name=__codelineno-42-83 href=#__codelineno-42-83></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;反序列化失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-42-84 name=__codelineno-42-84 href=#__codelineno-42-84></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;反序列化失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-42-85 name=__codelineno-42-85 href=#__codelineno-42-85></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-42-86 name=__codelineno-42-86 href=#__codelineno-42-86></a>
<a id=__codelineno-42-87 name=__codelineno-42-87 href=#__codelineno-42-87></a><span class=w>    </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>AppsV1</span><span class=p>().</span><span class=nx>StatefulSets</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span><span class=nx>Update</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>statefulSet</span><span class=p>,</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>UpdateOptions</span><span class=p>{})</span>
<a id=__codelineno-42-88 name=__codelineno-42-88 href=#__codelineno-42-88></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-42-89 name=__codelineno-42-89 href=#__codelineno-42-89></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;更新StatefulSet失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-42-90 name=__codelineno-42-90 href=#__codelineno-42-90></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;更新StatefulSet失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-42-91 name=__codelineno-42-91 href=#__codelineno-42-91></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-42-92 name=__codelineno-42-92 href=#__codelineno-42-92></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-42-93 name=__codelineno-42-93 href=#__codelineno-42-93></a><span class=p>}</span>
<a id=__codelineno-42-94 name=__codelineno-42-94 href=#__codelineno-42-94></a>
<a id=__codelineno-42-95 name=__codelineno-42-95 href=#__codelineno-42-95></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>s</span><span class=w> </span><span class=o>*</span><span class=nx>statefulSet</span><span class=p>)</span><span class=w> </span><span class=nx>toCells</span><span class=p>(</span><span class=nx>std</span><span class=w> </span><span class=p>[]</span><span class=nx>appsv1</span><span class=p>.</span><span class=nx>StatefulSet</span><span class=p>)</span><span class=w> </span><span class=p>[]</span><span class=nx>DataCell</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-42-96 name=__codelineno-42-96 href=#__codelineno-42-96></a><span class=w>    </span><span class=nx>cells</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>make</span><span class=p>([]</span><span class=nx>DataCell</span><span class=p>,</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>std</span><span class=p>))</span>
<a id=__codelineno-42-97 name=__codelineno-42-97 href=#__codelineno-42-97></a><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=nx>i</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>std</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-42-98 name=__codelineno-42-98 href=#__codelineno-42-98></a><span class=w>        </span><span class=nx>cells</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>statefulSetCell</span><span class=p>(</span><span class=nx>std</span><span class=p>[</span><span class=nx>i</span><span class=p>])</span>
<a id=__codelineno-42-99 name=__codelineno-42-99 href=#__codelineno-42-99></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-42-100 name=__codelineno-42-100 href=#__codelineno-42-100></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>cells</span>
<a id=__codelineno-42-101 name=__codelineno-42-101 href=#__codelineno-42-101></a><span class=p>}</span>
<a id=__codelineno-42-102 name=__codelineno-42-102 href=#__codelineno-42-102></a>
<a id=__codelineno-42-103 name=__codelineno-42-103 href=#__codelineno-42-103></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>s</span><span class=w> </span><span class=o>*</span><span class=nx>statefulSet</span><span class=p>)</span><span class=w> </span><span class=nx>fromCells</span><span class=p>(</span><span class=nx>cells</span><span class=w> </span><span class=p>[]</span><span class=nx>DataCell</span><span class=p>)</span><span class=w> </span><span class=p>[]</span><span class=nx>appsv1</span><span class=p>.</span><span class=nx>StatefulSet</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-42-104 name=__codelineno-42-104 href=#__codelineno-42-104></a><span class=w>    </span><span class=nx>statefulSets</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>make</span><span class=p>([]</span><span class=nx>appsv1</span><span class=p>.</span><span class=nx>StatefulSet</span><span class=p>,</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>cells</span><span class=p>))</span>
<a id=__codelineno-42-105 name=__codelineno-42-105 href=#__codelineno-42-105></a><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=nx>i</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>cells</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-42-106 name=__codelineno-42-106 href=#__codelineno-42-106></a><span class=w>        </span><span class=nx>statefulSets</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>appsv1</span><span class=p>.</span><span class=nx>StatefulSet</span><span class=p>(</span><span class=nx>cells</span><span class=p>[</span><span class=nx>i</span><span class=p>].(</span><span class=nx>statefulSetCell</span><span class=p>))</span>
<a id=__codelineno-42-107 name=__codelineno-42-107 href=#__codelineno-42-107></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-42-108 name=__codelineno-42-108 href=#__codelineno-42-108></a>
<a id=__codelineno-42-109 name=__codelineno-42-109 href=#__codelineno-42-109></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>statefulSets</span>
<a id=__codelineno-42-110 name=__codelineno-42-110 href=#__codelineno-42-110></a><span class=p>}</span>
</code></pre></div> <h5 id=controllerstatefulsetgo>controller/statefulset.go<a class=headerlink href=#controllerstatefulsetgo title="Permanent link">&para;</a></h5> <div class=highlight><pre><span></span><code><a id=__codelineno-43-1 name=__codelineno-43-1 href=#__codelineno-43-1></a><span class=kn>package</span><span class=w> </span><span class=nx>controller</span>
<a id=__codelineno-43-2 name=__codelineno-43-2 href=#__codelineno-43-2></a>
<a id=__codelineno-43-3 name=__codelineno-43-3 href=#__codelineno-43-3></a><span class=kn>import</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-43-4 name=__codelineno-43-4 href=#__codelineno-43-4></a><span class=w>    </span><span class=s>&quot;gitee.com/hujianli94net/k8s-platform/service&quot;</span>
<a id=__codelineno-43-5 name=__codelineno-43-5 href=#__codelineno-43-5></a><span class=w>    </span><span class=s>&quot;net/http&quot;</span>
<a id=__codelineno-43-6 name=__codelineno-43-6 href=#__codelineno-43-6></a>
<a id=__codelineno-43-7 name=__codelineno-43-7 href=#__codelineno-43-7></a><span class=w>    </span><span class=s>&quot;github.com/gin-gonic/gin&quot;</span>
<a id=__codelineno-43-8 name=__codelineno-43-8 href=#__codelineno-43-8></a><span class=w>    </span><span class=s>&quot;github.com/wonderivan/logger&quot;</span>
<a id=__codelineno-43-9 name=__codelineno-43-9 href=#__codelineno-43-9></a><span class=p>)</span>
<a id=__codelineno-43-10 name=__codelineno-43-10 href=#__codelineno-43-10></a>
<a id=__codelineno-43-11 name=__codelineno-43-11 href=#__codelineno-43-11></a><span class=kd>var</span><span class=w> </span><span class=nx>StatefulSet</span><span class=w> </span><span class=nx>statefulSet</span>
<a id=__codelineno-43-12 name=__codelineno-43-12 href=#__codelineno-43-12></a>
<a id=__codelineno-43-13 name=__codelineno-43-13 href=#__codelineno-43-13></a><span class=kd>type</span><span class=w> </span><span class=nx>statefulSet</span><span class=w> </span><span class=kd>struct</span><span class=p>{}</span>
<a id=__codelineno-43-14 name=__codelineno-43-14 href=#__codelineno-43-14></a>
<a id=__codelineno-43-15 name=__codelineno-43-15 href=#__codelineno-43-15></a><span class=c1>// GetStatefulSets 获取statefulset列表，支持过滤、排序、分页</span>
<a id=__codelineno-43-16 name=__codelineno-43-16 href=#__codelineno-43-16></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>s</span><span class=w> </span><span class=o>*</span><span class=nx>statefulSet</span><span class=p>)</span><span class=w> </span><span class=nx>GetStatefulSets</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-43-17 name=__codelineno-43-17 href=#__codelineno-43-17></a><span class=w>    </span><span class=nx>params</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-43-18 name=__codelineno-43-18 href=#__codelineno-43-18></a><span class=w>        </span><span class=nx>FilterName</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`form:&quot;filter_name&quot;`</span>
<a id=__codelineno-43-19 name=__codelineno-43-19 href=#__codelineno-43-19></a><span class=w>        </span><span class=nx>Namespace</span><span class=w>  </span><span class=kt>string</span><span class=w> </span><span class=s>`form:&quot;namespace&quot;`</span>
<a id=__codelineno-43-20 name=__codelineno-43-20 href=#__codelineno-43-20></a><span class=w>        </span><span class=nx>Page</span><span class=w>       </span><span class=kt>int</span><span class=w>    </span><span class=s>`form:&quot;page&quot;`</span>
<a id=__codelineno-43-21 name=__codelineno-43-21 href=#__codelineno-43-21></a><span class=w>        </span><span class=nx>Limit</span><span class=w>      </span><span class=kt>int</span><span class=w>    </span><span class=s>`form:&quot;limit&quot;`</span>
<a id=__codelineno-43-22 name=__codelineno-43-22 href=#__codelineno-43-22></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-43-23 name=__codelineno-43-23 href=#__codelineno-43-23></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>Bind</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-43-24 name=__codelineno-43-24 href=#__codelineno-43-24></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-43-25 name=__codelineno-43-25 href=#__codelineno-43-25></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-43-26 name=__codelineno-43-26 href=#__codelineno-43-26></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-43-27 name=__codelineno-43-27 href=#__codelineno-43-27></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-43-28 name=__codelineno-43-28 href=#__codelineno-43-28></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-43-29 name=__codelineno-43-29 href=#__codelineno-43-29></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-43-30 name=__codelineno-43-30 href=#__codelineno-43-30></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-43-31 name=__codelineno-43-31 href=#__codelineno-43-31></a>
<a id=__codelineno-43-32 name=__codelineno-43-32 href=#__codelineno-43-32></a><span class=w>    </span><span class=nx>data</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>StatefulSet</span><span class=p>.</span><span class=nx>GetStatefulSets</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>FilterName</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Limit</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Page</span><span class=p>)</span>
<a id=__codelineno-43-33 name=__codelineno-43-33 href=#__codelineno-43-33></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-43-34 name=__codelineno-43-34 href=#__codelineno-43-34></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-43-35 name=__codelineno-43-35 href=#__codelineno-43-35></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-43-36 name=__codelineno-43-36 href=#__codelineno-43-36></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-43-37 name=__codelineno-43-37 href=#__codelineno-43-37></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-43-38 name=__codelineno-43-38 href=#__codelineno-43-38></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-43-39 name=__codelineno-43-39 href=#__codelineno-43-39></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-43-40 name=__codelineno-43-40 href=#__codelineno-43-40></a>
<a id=__codelineno-43-41 name=__codelineno-43-41 href=#__codelineno-43-41></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-43-42 name=__codelineno-43-42 href=#__codelineno-43-42></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;获取StatefulSet列表成功&quot;</span><span class=p>,</span>
<a id=__codelineno-43-43 name=__codelineno-43-43 href=#__codelineno-43-43></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=nx>data</span><span class=p>,</span>
<a id=__codelineno-43-44 name=__codelineno-43-44 href=#__codelineno-43-44></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-43-45 name=__codelineno-43-45 href=#__codelineno-43-45></a><span class=p>}</span>
<a id=__codelineno-43-46 name=__codelineno-43-46 href=#__codelineno-43-46></a>
<a id=__codelineno-43-47 name=__codelineno-43-47 href=#__codelineno-43-47></a><span class=c1>// GetStatefulSetDetail 获取statefulset详情</span>
<a id=__codelineno-43-48 name=__codelineno-43-48 href=#__codelineno-43-48></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>s</span><span class=w> </span><span class=o>*</span><span class=nx>statefulSet</span><span class=p>)</span><span class=w> </span><span class=nx>GetStatefulSetDetail</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-43-49 name=__codelineno-43-49 href=#__codelineno-43-49></a><span class=w>    </span><span class=nx>params</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-43-50 name=__codelineno-43-50 href=#__codelineno-43-50></a><span class=w>        </span><span class=nx>StatefulSetName</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`form:&quot;statefulset_name&quot;`</span>
<a id=__codelineno-43-51 name=__codelineno-43-51 href=#__codelineno-43-51></a><span class=w>        </span><span class=nx>Namespace</span><span class=w>       </span><span class=kt>string</span><span class=w> </span><span class=s>`form:&quot;namespace&quot;`</span>
<a id=__codelineno-43-52 name=__codelineno-43-52 href=#__codelineno-43-52></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-43-53 name=__codelineno-43-53 href=#__codelineno-43-53></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>Bind</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-43-54 name=__codelineno-43-54 href=#__codelineno-43-54></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-43-55 name=__codelineno-43-55 href=#__codelineno-43-55></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-43-56 name=__codelineno-43-56 href=#__codelineno-43-56></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-43-57 name=__codelineno-43-57 href=#__codelineno-43-57></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-43-58 name=__codelineno-43-58 href=#__codelineno-43-58></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-43-59 name=__codelineno-43-59 href=#__codelineno-43-59></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-43-60 name=__codelineno-43-60 href=#__codelineno-43-60></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-43-61 name=__codelineno-43-61 href=#__codelineno-43-61></a>
<a id=__codelineno-43-62 name=__codelineno-43-62 href=#__codelineno-43-62></a><span class=w>    </span><span class=nx>data</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>StatefulSet</span><span class=p>.</span><span class=nx>GetStatefulSetDetail</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>StatefulSetName</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>)</span>
<a id=__codelineno-43-63 name=__codelineno-43-63 href=#__codelineno-43-63></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-43-64 name=__codelineno-43-64 href=#__codelineno-43-64></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-43-65 name=__codelineno-43-65 href=#__codelineno-43-65></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-43-66 name=__codelineno-43-66 href=#__codelineno-43-66></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-43-67 name=__codelineno-43-67 href=#__codelineno-43-67></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-43-68 name=__codelineno-43-68 href=#__codelineno-43-68></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-43-69 name=__codelineno-43-69 href=#__codelineno-43-69></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-43-70 name=__codelineno-43-70 href=#__codelineno-43-70></a>
<a id=__codelineno-43-71 name=__codelineno-43-71 href=#__codelineno-43-71></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-43-72 name=__codelineno-43-72 href=#__codelineno-43-72></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;获取StatefulSet详情成功&quot;</span><span class=p>,</span>
<a id=__codelineno-43-73 name=__codelineno-43-73 href=#__codelineno-43-73></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=nx>data</span><span class=p>,</span>
<a id=__codelineno-43-74 name=__codelineno-43-74 href=#__codelineno-43-74></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-43-75 name=__codelineno-43-75 href=#__codelineno-43-75></a><span class=p>}</span>
<a id=__codelineno-43-76 name=__codelineno-43-76 href=#__codelineno-43-76></a>
<a id=__codelineno-43-77 name=__codelineno-43-77 href=#__codelineno-43-77></a><span class=c1>// DeleteStatefulSet 删除statefulset</span>
<a id=__codelineno-43-78 name=__codelineno-43-78 href=#__codelineno-43-78></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>s</span><span class=w> </span><span class=o>*</span><span class=nx>statefulSet</span><span class=p>)</span><span class=w> </span><span class=nx>DeleteStatefulSet</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-43-79 name=__codelineno-43-79 href=#__codelineno-43-79></a><span class=w>    </span><span class=nx>params</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-43-80 name=__codelineno-43-80 href=#__codelineno-43-80></a><span class=w>        </span><span class=nx>StatefulSetName</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;statefulset_name&quot;`</span>
<a id=__codelineno-43-81 name=__codelineno-43-81 href=#__codelineno-43-81></a><span class=w>        </span><span class=nx>Namespace</span><span class=w>       </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;namespace&quot;`</span>
<a id=__codelineno-43-82 name=__codelineno-43-82 href=#__codelineno-43-82></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-43-83 name=__codelineno-43-83 href=#__codelineno-43-83></a><span class=w>    </span><span class=c1>//DELETE请求，绑定参数方法改为ctx.ShouldBindJSON</span>
<a id=__codelineno-43-84 name=__codelineno-43-84 href=#__codelineno-43-84></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>ShouldBindJSON</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-43-85 name=__codelineno-43-85 href=#__codelineno-43-85></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-43-86 name=__codelineno-43-86 href=#__codelineno-43-86></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-43-87 name=__codelineno-43-87 href=#__codelineno-43-87></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-43-88 name=__codelineno-43-88 href=#__codelineno-43-88></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-43-89 name=__codelineno-43-89 href=#__codelineno-43-89></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-43-90 name=__codelineno-43-90 href=#__codelineno-43-90></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-43-91 name=__codelineno-43-91 href=#__codelineno-43-91></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-43-92 name=__codelineno-43-92 href=#__codelineno-43-92></a>
<a id=__codelineno-43-93 name=__codelineno-43-93 href=#__codelineno-43-93></a><span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>StatefulSet</span><span class=p>.</span><span class=nx>DeleteStatefulSet</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>StatefulSetName</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>)</span>
<a id=__codelineno-43-94 name=__codelineno-43-94 href=#__codelineno-43-94></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-43-95 name=__codelineno-43-95 href=#__codelineno-43-95></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-43-96 name=__codelineno-43-96 href=#__codelineno-43-96></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-43-97 name=__codelineno-43-97 href=#__codelineno-43-97></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-43-98 name=__codelineno-43-98 href=#__codelineno-43-98></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-43-99 name=__codelineno-43-99 href=#__codelineno-43-99></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-43-100 name=__codelineno-43-100 href=#__codelineno-43-100></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-43-101 name=__codelineno-43-101 href=#__codelineno-43-101></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-43-102 name=__codelineno-43-102 href=#__codelineno-43-102></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;删除StatefulSet成功&quot;</span><span class=p>,</span>
<a id=__codelineno-43-103 name=__codelineno-43-103 href=#__codelineno-43-103></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-43-104 name=__codelineno-43-104 href=#__codelineno-43-104></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-43-105 name=__codelineno-43-105 href=#__codelineno-43-105></a><span class=p>}</span>
<a id=__codelineno-43-106 name=__codelineno-43-106 href=#__codelineno-43-106></a>
<a id=__codelineno-43-107 name=__codelineno-43-107 href=#__codelineno-43-107></a><span class=c1>// UpdateStatefulSet 更新statefulSet</span>
<a id=__codelineno-43-108 name=__codelineno-43-108 href=#__codelineno-43-108></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>s</span><span class=w> </span><span class=o>*</span><span class=nx>statefulSet</span><span class=p>)</span><span class=w> </span><span class=nx>UpdateStatefulSet</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-43-109 name=__codelineno-43-109 href=#__codelineno-43-109></a><span class=w>    </span><span class=nx>params</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-43-110 name=__codelineno-43-110 href=#__codelineno-43-110></a><span class=w>        </span><span class=nx>Namespace</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;namespace&quot;`</span>
<a id=__codelineno-43-111 name=__codelineno-43-111 href=#__codelineno-43-111></a><span class=w>        </span><span class=nx>Content</span><span class=w>   </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;content&quot;`</span>
<a id=__codelineno-43-112 name=__codelineno-43-112 href=#__codelineno-43-112></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-43-113 name=__codelineno-43-113 href=#__codelineno-43-113></a><span class=w>    </span><span class=c1>//PUT请求，绑定参数方法改为ctx.ShouldBindJSON</span>
<a id=__codelineno-43-114 name=__codelineno-43-114 href=#__codelineno-43-114></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>ShouldBindJSON</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-43-115 name=__codelineno-43-115 href=#__codelineno-43-115></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-43-116 name=__codelineno-43-116 href=#__codelineno-43-116></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-43-117 name=__codelineno-43-117 href=#__codelineno-43-117></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-43-118 name=__codelineno-43-118 href=#__codelineno-43-118></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-43-119 name=__codelineno-43-119 href=#__codelineno-43-119></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-43-120 name=__codelineno-43-120 href=#__codelineno-43-120></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-43-121 name=__codelineno-43-121 href=#__codelineno-43-121></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-43-122 name=__codelineno-43-122 href=#__codelineno-43-122></a>
<a id=__codelineno-43-123 name=__codelineno-43-123 href=#__codelineno-43-123></a><span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>StatefulSet</span><span class=p>.</span><span class=nx>UpdateStatefulSet</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Content</span><span class=p>)</span>
<a id=__codelineno-43-124 name=__codelineno-43-124 href=#__codelineno-43-124></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-43-125 name=__codelineno-43-125 href=#__codelineno-43-125></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-43-126 name=__codelineno-43-126 href=#__codelineno-43-126></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-43-127 name=__codelineno-43-127 href=#__codelineno-43-127></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-43-128 name=__codelineno-43-128 href=#__codelineno-43-128></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-43-129 name=__codelineno-43-129 href=#__codelineno-43-129></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-43-130 name=__codelineno-43-130 href=#__codelineno-43-130></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-43-131 name=__codelineno-43-131 href=#__codelineno-43-131></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-43-132 name=__codelineno-43-132 href=#__codelineno-43-132></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;更新StatefulSet成功&quot;</span><span class=p>,</span>
<a id=__codelineno-43-133 name=__codelineno-43-133 href=#__codelineno-43-133></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-43-134 name=__codelineno-43-134 href=#__codelineno-43-134></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-43-135 name=__codelineno-43-135 href=#__codelineno-43-135></a><span class=p>}</span>
</code></pre></div> <h3 id=3-集群>3. 集群<a class=headerlink href=#3-集群 title="Permanent link">&para;</a></h3> <blockquote> <p>注意：以下3个资源是集群维度的，没有Namespace的概念</p> </blockquote> <h4 id=31-node>3.1 Node<a class=headerlink href=#31-node title="Permanent link">&para;</a></h4> <table> <thead> <tr> <th>功能</th> <th>是否实现</th> </tr> </thead> <tbody> <tr> <td>Node列表</td> <td>√</td> </tr> <tr> <td>获取Node详情</td> <td>√</td> </tr> </tbody> </table> <h5 id=servicedataselectorgo_3>service/dataselector.go<a class=headerlink href=#servicedataselectorgo_3 title="Permanent link">&para;</a></h5> <div class=highlight><pre><span></span><code><a id=__codelineno-44-1 name=__codelineno-44-1 href=#__codelineno-44-1></a><span class=c1>// 实现 Node 的 DataCell接口</span>
<a id=__codelineno-44-2 name=__codelineno-44-2 href=#__codelineno-44-2></a><span class=kd>type</span><span class=w> </span><span class=nx>nodeCell</span><span class=w> </span><span class=nx>corev1</span><span class=p>.</span><span class=nx>Node</span>
<a id=__codelineno-44-3 name=__codelineno-44-3 href=#__codelineno-44-3></a>
<a id=__codelineno-44-4 name=__codelineno-44-4 href=#__codelineno-44-4></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>n</span><span class=w> </span><span class=nx>nodeCell</span><span class=p>)</span><span class=w> </span><span class=nx>GetCreation</span><span class=p>()</span><span class=w> </span><span class=nx>time</span><span class=p>.</span><span class=nx>Time</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-44-5 name=__codelineno-44-5 href=#__codelineno-44-5></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>n</span><span class=p>.</span><span class=nx>CreationTimestamp</span><span class=p>.</span><span class=nx>Time</span>
<a id=__codelineno-44-6 name=__codelineno-44-6 href=#__codelineno-44-6></a><span class=p>}</span>
<a id=__codelineno-44-7 name=__codelineno-44-7 href=#__codelineno-44-7></a>
<a id=__codelineno-44-8 name=__codelineno-44-8 href=#__codelineno-44-8></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>n</span><span class=w> </span><span class=nx>nodeCell</span><span class=p>)</span><span class=w> </span><span class=nx>GetName</span><span class=p>()</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-44-9 name=__codelineno-44-9 href=#__codelineno-44-9></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>n</span><span class=p>.</span><span class=nx>Name</span>
<a id=__codelineno-44-10 name=__codelineno-44-10 href=#__codelineno-44-10></a><span class=p>}</span>
</code></pre></div> <h5 id=servicenodego>service/node.go<a class=headerlink href=#servicenodego title="Permanent link">&para;</a></h5> <div class=highlight><pre><span></span><code><a id=__codelineno-45-1 name=__codelineno-45-1 href=#__codelineno-45-1></a><span class=kn>package</span><span class=w> </span><span class=nx>service</span>
<a id=__codelineno-45-2 name=__codelineno-45-2 href=#__codelineno-45-2></a>
<a id=__codelineno-45-3 name=__codelineno-45-3 href=#__codelineno-45-3></a><span class=kn>import</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-45-4 name=__codelineno-45-4 href=#__codelineno-45-4></a><span class=w>    </span><span class=s>&quot;context&quot;</span>
<a id=__codelineno-45-5 name=__codelineno-45-5 href=#__codelineno-45-5></a><span class=w>    </span><span class=s>&quot;errors&quot;</span>
<a id=__codelineno-45-6 name=__codelineno-45-6 href=#__codelineno-45-6></a>
<a id=__codelineno-45-7 name=__codelineno-45-7 href=#__codelineno-45-7></a><span class=w>    </span><span class=s>&quot;github.com/wonderivan/logger&quot;</span>
<a id=__codelineno-45-8 name=__codelineno-45-8 href=#__codelineno-45-8></a><span class=w>    </span><span class=nx>corev1</span><span class=w> </span><span class=s>&quot;k8s.io/api/core/v1&quot;</span>
<a id=__codelineno-45-9 name=__codelineno-45-9 href=#__codelineno-45-9></a><span class=w>    </span><span class=nx>metav1</span><span class=w> </span><span class=s>&quot;k8s.io/apimachinery/pkg/apis/meta/v1&quot;</span>
<a id=__codelineno-45-10 name=__codelineno-45-10 href=#__codelineno-45-10></a><span class=p>)</span>
<a id=__codelineno-45-11 name=__codelineno-45-11 href=#__codelineno-45-11></a>
<a id=__codelineno-45-12 name=__codelineno-45-12 href=#__codelineno-45-12></a><span class=kd>var</span><span class=w> </span><span class=nx>Node</span><span class=w> </span><span class=nx>node</span>
<a id=__codelineno-45-13 name=__codelineno-45-13 href=#__codelineno-45-13></a>
<a id=__codelineno-45-14 name=__codelineno-45-14 href=#__codelineno-45-14></a><span class=kd>type</span><span class=w> </span><span class=nx>node</span><span class=w> </span><span class=kd>struct</span><span class=p>{}</span>
<a id=__codelineno-45-15 name=__codelineno-45-15 href=#__codelineno-45-15></a>
<a id=__codelineno-45-16 name=__codelineno-45-16 href=#__codelineno-45-16></a><span class=kd>type</span><span class=w> </span><span class=nx>NodesResp</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-45-17 name=__codelineno-45-17 href=#__codelineno-45-17></a><span class=w>    </span><span class=nx>Items</span><span class=w> </span><span class=p>[]</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>Node</span><span class=w> </span><span class=s>`json:&quot;items&quot;`</span>
<a id=__codelineno-45-18 name=__codelineno-45-18 href=#__codelineno-45-18></a><span class=w>    </span><span class=nx>Total</span><span class=w> </span><span class=kt>int</span><span class=w>           </span><span class=s>`json:&quot;total&quot;`</span>
<a id=__codelineno-45-19 name=__codelineno-45-19 href=#__codelineno-45-19></a><span class=p>}</span>
<a id=__codelineno-45-20 name=__codelineno-45-20 href=#__codelineno-45-20></a>
<a id=__codelineno-45-21 name=__codelineno-45-21 href=#__codelineno-45-21></a><span class=c1>// GetNodes 获取node列表，支持过滤、排序、分页</span>
<a id=__codelineno-45-22 name=__codelineno-45-22 href=#__codelineno-45-22></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>n</span><span class=w> </span><span class=o>*</span><span class=nx>node</span><span class=p>)</span><span class=w> </span><span class=nx>GetNodes</span><span class=p>(</span><span class=nx>filterName</span><span class=w> </span><span class=kt>string</span><span class=p>,</span><span class=w> </span><span class=nx>limit</span><span class=p>,</span><span class=w> </span><span class=nx>page</span><span class=w> </span><span class=kt>int</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>nodesResp</span><span class=w> </span><span class=o>*</span><span class=nx>NodesResp</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-45-23 name=__codelineno-45-23 href=#__codelineno-45-23></a><span class=w>    </span><span class=c1>//获取nodeList类型的node列表</span>
<a id=__codelineno-45-24 name=__codelineno-45-24 href=#__codelineno-45-24></a><span class=w>    </span><span class=nx>nodeList</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>CoreV1</span><span class=p>().</span><span class=nx>Nodes</span><span class=p>().</span><span class=nx>List</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>ListOptions</span><span class=p>{})</span>
<a id=__codelineno-45-25 name=__codelineno-45-25 href=#__codelineno-45-25></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-45-26 name=__codelineno-45-26 href=#__codelineno-45-26></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取Node列表失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-45-27 name=__codelineno-45-27 href=#__codelineno-45-27></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取Node列表失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-45-28 name=__codelineno-45-28 href=#__codelineno-45-28></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-45-29 name=__codelineno-45-29 href=#__codelineno-45-29></a><span class=w>    </span><span class=c1>//将nodeList中的node列表(Items)，放进dataselector对象中，进行排序</span>
<a id=__codelineno-45-30 name=__codelineno-45-30 href=#__codelineno-45-30></a><span class=w>    </span><span class=nx>selectableData</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>dataSelector</span><span class=p>{</span>
<a id=__codelineno-45-31 name=__codelineno-45-31 href=#__codelineno-45-31></a><span class=w>        </span><span class=nx>GenericDataList</span><span class=p>:</span><span class=w> </span><span class=nx>n</span><span class=p>.</span><span class=nx>toCells</span><span class=p>(</span><span class=nx>nodeList</span><span class=p>.</span><span class=nx>Items</span><span class=p>),</span>
<a id=__codelineno-45-32 name=__codelineno-45-32 href=#__codelineno-45-32></a><span class=w>        </span><span class=nx>dataSelectQuery</span><span class=p>:</span><span class=w> </span><span class=o>&amp;</span><span class=nx>DataSelectQuery</span><span class=p>{</span>
<a id=__codelineno-45-33 name=__codelineno-45-33 href=#__codelineno-45-33></a><span class=w>            </span><span class=nx>FilterQuery</span><span class=p>:</span><span class=w> </span><span class=o>&amp;</span><span class=nx>FilterQuery</span><span class=p>{</span><span class=nx>Name</span><span class=p>:</span><span class=w> </span><span class=nx>filterName</span><span class=p>},</span>
<a id=__codelineno-45-34 name=__codelineno-45-34 href=#__codelineno-45-34></a><span class=w>            </span><span class=nx>PaginateQuery</span><span class=p>:</span><span class=w> </span><span class=o>&amp;</span><span class=nx>PaginateQuery</span><span class=p>{</span>
<a id=__codelineno-45-35 name=__codelineno-45-35 href=#__codelineno-45-35></a><span class=w>                </span><span class=nx>Limit</span><span class=p>:</span><span class=w> </span><span class=nx>limit</span><span class=p>,</span>
<a id=__codelineno-45-36 name=__codelineno-45-36 href=#__codelineno-45-36></a><span class=w>                </span><span class=nx>Page</span><span class=p>:</span><span class=w>  </span><span class=nx>page</span><span class=p>,</span>
<a id=__codelineno-45-37 name=__codelineno-45-37 href=#__codelineno-45-37></a><span class=w>            </span><span class=p>},</span>
<a id=__codelineno-45-38 name=__codelineno-45-38 href=#__codelineno-45-38></a><span class=w>        </span><span class=p>},</span>
<a id=__codelineno-45-39 name=__codelineno-45-39 href=#__codelineno-45-39></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-45-40 name=__codelineno-45-40 href=#__codelineno-45-40></a>
<a id=__codelineno-45-41 name=__codelineno-45-41 href=#__codelineno-45-41></a><span class=w>    </span><span class=nx>filtered</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>selectableData</span><span class=p>.</span><span class=nx>Filter</span><span class=p>()</span>
<a id=__codelineno-45-42 name=__codelineno-45-42 href=#__codelineno-45-42></a><span class=w>    </span><span class=nx>total</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>filtered</span><span class=p>.</span><span class=nx>GenericDataList</span><span class=p>)</span>
<a id=__codelineno-45-43 name=__codelineno-45-43 href=#__codelineno-45-43></a><span class=w>    </span><span class=nx>data</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>filtered</span><span class=p>.</span><span class=nx>Sort</span><span class=p>().</span><span class=nx>Paginate</span><span class=p>()</span>
<a id=__codelineno-45-44 name=__codelineno-45-44 href=#__codelineno-45-44></a>
<a id=__codelineno-45-45 name=__codelineno-45-45 href=#__codelineno-45-45></a><span class=w>    </span><span class=c1>//将[]DataCell类型的node列表转为v1.node列表</span>
<a id=__codelineno-45-46 name=__codelineno-45-46 href=#__codelineno-45-46></a><span class=w>    </span><span class=nx>nodes</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>n</span><span class=p>.</span><span class=nx>fromCells</span><span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>GenericDataList</span><span class=p>)</span>
<a id=__codelineno-45-47 name=__codelineno-45-47 href=#__codelineno-45-47></a>
<a id=__codelineno-45-48 name=__codelineno-45-48 href=#__codelineno-45-48></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=o>&amp;</span><span class=nx>NodesResp</span><span class=p>{</span>
<a id=__codelineno-45-49 name=__codelineno-45-49 href=#__codelineno-45-49></a><span class=w>        </span><span class=nx>Items</span><span class=p>:</span><span class=w> </span><span class=nx>nodes</span><span class=p>,</span>
<a id=__codelineno-45-50 name=__codelineno-45-50 href=#__codelineno-45-50></a><span class=w>        </span><span class=nx>Total</span><span class=p>:</span><span class=w> </span><span class=nx>total</span><span class=p>,</span>
<a id=__codelineno-45-51 name=__codelineno-45-51 href=#__codelineno-45-51></a><span class=w>    </span><span class=p>},</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-45-52 name=__codelineno-45-52 href=#__codelineno-45-52></a><span class=p>}</span>
<a id=__codelineno-45-53 name=__codelineno-45-53 href=#__codelineno-45-53></a>
<a id=__codelineno-45-54 name=__codelineno-45-54 href=#__codelineno-45-54></a><span class=c1>// GetNodeDetail 获取node详情</span>
<a id=__codelineno-45-55 name=__codelineno-45-55 href=#__codelineno-45-55></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>n</span><span class=w> </span><span class=o>*</span><span class=nx>node</span><span class=p>)</span><span class=w> </span><span class=nx>GetNodeDetail</span><span class=p>(</span><span class=nx>nodeName</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>node</span><span class=w> </span><span class=o>*</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>Node</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-45-56 name=__codelineno-45-56 href=#__codelineno-45-56></a><span class=w>    </span><span class=nx>node</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>CoreV1</span><span class=p>().</span><span class=nx>Nodes</span><span class=p>().</span><span class=nx>Get</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>nodeName</span><span class=p>,</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>GetOptions</span><span class=p>{})</span>
<a id=__codelineno-45-57 name=__codelineno-45-57 href=#__codelineno-45-57></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-45-58 name=__codelineno-45-58 href=#__codelineno-45-58></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取Node详情失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-45-59 name=__codelineno-45-59 href=#__codelineno-45-59></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取Node详情失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-45-60 name=__codelineno-45-60 href=#__codelineno-45-60></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-45-61 name=__codelineno-45-61 href=#__codelineno-45-61></a>
<a id=__codelineno-45-62 name=__codelineno-45-62 href=#__codelineno-45-62></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>node</span><span class=p>,</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-45-63 name=__codelineno-45-63 href=#__codelineno-45-63></a><span class=p>}</span>
<a id=__codelineno-45-64 name=__codelineno-45-64 href=#__codelineno-45-64></a>
<a id=__codelineno-45-65 name=__codelineno-45-65 href=#__codelineno-45-65></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>n</span><span class=w> </span><span class=o>*</span><span class=nx>node</span><span class=p>)</span><span class=w> </span><span class=nx>toCells</span><span class=p>(</span><span class=nx>std</span><span class=w> </span><span class=p>[]</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>Node</span><span class=p>)</span><span class=w> </span><span class=p>[]</span><span class=nx>DataCell</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-45-66 name=__codelineno-45-66 href=#__codelineno-45-66></a><span class=w>    </span><span class=nx>cells</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>make</span><span class=p>([]</span><span class=nx>DataCell</span><span class=p>,</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>std</span><span class=p>))</span>
<a id=__codelineno-45-67 name=__codelineno-45-67 href=#__codelineno-45-67></a><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=nx>i</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>std</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-45-68 name=__codelineno-45-68 href=#__codelineno-45-68></a><span class=w>        </span><span class=nx>cells</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>nodeCell</span><span class=p>(</span><span class=nx>std</span><span class=p>[</span><span class=nx>i</span><span class=p>])</span>
<a id=__codelineno-45-69 name=__codelineno-45-69 href=#__codelineno-45-69></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-45-70 name=__codelineno-45-70 href=#__codelineno-45-70></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>cells</span>
<a id=__codelineno-45-71 name=__codelineno-45-71 href=#__codelineno-45-71></a><span class=p>}</span>
<a id=__codelineno-45-72 name=__codelineno-45-72 href=#__codelineno-45-72></a>
<a id=__codelineno-45-73 name=__codelineno-45-73 href=#__codelineno-45-73></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>n</span><span class=w> </span><span class=o>*</span><span class=nx>node</span><span class=p>)</span><span class=w> </span><span class=nx>fromCells</span><span class=p>(</span><span class=nx>cells</span><span class=w> </span><span class=p>[]</span><span class=nx>DataCell</span><span class=p>)</span><span class=w> </span><span class=p>[]</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>Node</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-45-74 name=__codelineno-45-74 href=#__codelineno-45-74></a><span class=w>    </span><span class=nx>nodes</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>make</span><span class=p>([]</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>Node</span><span class=p>,</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>cells</span><span class=p>))</span>
<a id=__codelineno-45-75 name=__codelineno-45-75 href=#__codelineno-45-75></a><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=nx>i</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>cells</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-45-76 name=__codelineno-45-76 href=#__codelineno-45-76></a><span class=w>        </span><span class=nx>nodes</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>corev1</span><span class=p>.</span><span class=nx>Node</span><span class=p>(</span><span class=nx>cells</span><span class=p>[</span><span class=nx>i</span><span class=p>].(</span><span class=nx>nodeCell</span><span class=p>))</span>
<a id=__codelineno-45-77 name=__codelineno-45-77 href=#__codelineno-45-77></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-45-78 name=__codelineno-45-78 href=#__codelineno-45-78></a>
<a id=__codelineno-45-79 name=__codelineno-45-79 href=#__codelineno-45-79></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>nodes</span>
<a id=__codelineno-45-80 name=__codelineno-45-80 href=#__codelineno-45-80></a><span class=p>}</span>
</code></pre></div> <h5 id=controllernodego>controller/node.go<a class=headerlink href=#controllernodego title="Permanent link">&para;</a></h5> <div class=highlight><pre><span></span><code><a id=__codelineno-46-1 name=__codelineno-46-1 href=#__codelineno-46-1></a><span class=kn>package</span><span class=w> </span><span class=nx>controller</span>
<a id=__codelineno-46-2 name=__codelineno-46-2 href=#__codelineno-46-2></a>
<a id=__codelineno-46-3 name=__codelineno-46-3 href=#__codelineno-46-3></a><span class=kn>import</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-46-4 name=__codelineno-46-4 href=#__codelineno-46-4></a><span class=w>    </span><span class=s>&quot;gitee.com/hujianli94net/k8s-platform/service&quot;</span>
<a id=__codelineno-46-5 name=__codelineno-46-5 href=#__codelineno-46-5></a><span class=w>    </span><span class=s>&quot;net/http&quot;</span>
<a id=__codelineno-46-6 name=__codelineno-46-6 href=#__codelineno-46-6></a>
<a id=__codelineno-46-7 name=__codelineno-46-7 href=#__codelineno-46-7></a><span class=w>    </span><span class=s>&quot;github.com/gin-gonic/gin&quot;</span>
<a id=__codelineno-46-8 name=__codelineno-46-8 href=#__codelineno-46-8></a><span class=w>    </span><span class=s>&quot;github.com/wonderivan/logger&quot;</span>
<a id=__codelineno-46-9 name=__codelineno-46-9 href=#__codelineno-46-9></a><span class=p>)</span>
<a id=__codelineno-46-10 name=__codelineno-46-10 href=#__codelineno-46-10></a>
<a id=__codelineno-46-11 name=__codelineno-46-11 href=#__codelineno-46-11></a><span class=kd>var</span><span class=w> </span><span class=nx>Node</span><span class=w> </span><span class=nx>node</span>
<a id=__codelineno-46-12 name=__codelineno-46-12 href=#__codelineno-46-12></a>
<a id=__codelineno-46-13 name=__codelineno-46-13 href=#__codelineno-46-13></a><span class=kd>type</span><span class=w> </span><span class=nx>node</span><span class=w> </span><span class=kd>struct</span><span class=p>{}</span>
<a id=__codelineno-46-14 name=__codelineno-46-14 href=#__codelineno-46-14></a>
<a id=__codelineno-46-15 name=__codelineno-46-15 href=#__codelineno-46-15></a><span class=c1>// GetNodes 获取node列表，支持过滤、排序、分页</span>
<a id=__codelineno-46-16 name=__codelineno-46-16 href=#__codelineno-46-16></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>n</span><span class=w> </span><span class=o>*</span><span class=nx>node</span><span class=p>)</span><span class=w> </span><span class=nx>GetNodes</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-46-17 name=__codelineno-46-17 href=#__codelineno-46-17></a><span class=w>    </span><span class=nx>params</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-46-18 name=__codelineno-46-18 href=#__codelineno-46-18></a><span class=w>        </span><span class=nx>FilterName</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`form:&quot;filter_name&quot;`</span>
<a id=__codelineno-46-19 name=__codelineno-46-19 href=#__codelineno-46-19></a><span class=w>        </span><span class=nx>Page</span><span class=w>       </span><span class=kt>int</span><span class=w>    </span><span class=s>`form:&quot;page&quot;`</span>
<a id=__codelineno-46-20 name=__codelineno-46-20 href=#__codelineno-46-20></a><span class=w>        </span><span class=nx>Limit</span><span class=w>      </span><span class=kt>int</span><span class=w>    </span><span class=s>`form:&quot;limit&quot;`</span>
<a id=__codelineno-46-21 name=__codelineno-46-21 href=#__codelineno-46-21></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-46-22 name=__codelineno-46-22 href=#__codelineno-46-22></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>Bind</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-46-23 name=__codelineno-46-23 href=#__codelineno-46-23></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-46-24 name=__codelineno-46-24 href=#__codelineno-46-24></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-46-25 name=__codelineno-46-25 href=#__codelineno-46-25></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-46-26 name=__codelineno-46-26 href=#__codelineno-46-26></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-46-27 name=__codelineno-46-27 href=#__codelineno-46-27></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-46-28 name=__codelineno-46-28 href=#__codelineno-46-28></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-46-29 name=__codelineno-46-29 href=#__codelineno-46-29></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-46-30 name=__codelineno-46-30 href=#__codelineno-46-30></a>
<a id=__codelineno-46-31 name=__codelineno-46-31 href=#__codelineno-46-31></a><span class=w>    </span><span class=nx>data</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>Node</span><span class=p>.</span><span class=nx>GetNodes</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>FilterName</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Limit</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Page</span><span class=p>)</span>
<a id=__codelineno-46-32 name=__codelineno-46-32 href=#__codelineno-46-32></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-46-33 name=__codelineno-46-33 href=#__codelineno-46-33></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-46-34 name=__codelineno-46-34 href=#__codelineno-46-34></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-46-35 name=__codelineno-46-35 href=#__codelineno-46-35></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-46-36 name=__codelineno-46-36 href=#__codelineno-46-36></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-46-37 name=__codelineno-46-37 href=#__codelineno-46-37></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-46-38 name=__codelineno-46-38 href=#__codelineno-46-38></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-46-39 name=__codelineno-46-39 href=#__codelineno-46-39></a>
<a id=__codelineno-46-40 name=__codelineno-46-40 href=#__codelineno-46-40></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-46-41 name=__codelineno-46-41 href=#__codelineno-46-41></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;获取Node列表成功&quot;</span><span class=p>,</span>
<a id=__codelineno-46-42 name=__codelineno-46-42 href=#__codelineno-46-42></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=nx>data</span><span class=p>,</span>
<a id=__codelineno-46-43 name=__codelineno-46-43 href=#__codelineno-46-43></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-46-44 name=__codelineno-46-44 href=#__codelineno-46-44></a><span class=p>}</span>
<a id=__codelineno-46-45 name=__codelineno-46-45 href=#__codelineno-46-45></a>
<a id=__codelineno-46-46 name=__codelineno-46-46 href=#__codelineno-46-46></a><span class=c1>// GetNodeDetail 获取node详情</span>
<a id=__codelineno-46-47 name=__codelineno-46-47 href=#__codelineno-46-47></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>n</span><span class=w> </span><span class=o>*</span><span class=nx>node</span><span class=p>)</span><span class=w> </span><span class=nx>GetNodeDetail</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-46-48 name=__codelineno-46-48 href=#__codelineno-46-48></a><span class=w>    </span><span class=nx>params</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-46-49 name=__codelineno-46-49 href=#__codelineno-46-49></a><span class=w>        </span><span class=nx>NodeName</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`form:&quot;node_name&quot;`</span>
<a id=__codelineno-46-50 name=__codelineno-46-50 href=#__codelineno-46-50></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-46-51 name=__codelineno-46-51 href=#__codelineno-46-51></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>Bind</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-46-52 name=__codelineno-46-52 href=#__codelineno-46-52></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-46-53 name=__codelineno-46-53 href=#__codelineno-46-53></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-46-54 name=__codelineno-46-54 href=#__codelineno-46-54></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-46-55 name=__codelineno-46-55 href=#__codelineno-46-55></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-46-56 name=__codelineno-46-56 href=#__codelineno-46-56></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-46-57 name=__codelineno-46-57 href=#__codelineno-46-57></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-46-58 name=__codelineno-46-58 href=#__codelineno-46-58></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-46-59 name=__codelineno-46-59 href=#__codelineno-46-59></a>
<a id=__codelineno-46-60 name=__codelineno-46-60 href=#__codelineno-46-60></a><span class=w>    </span><span class=nx>data</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>Node</span><span class=p>.</span><span class=nx>GetNodeDetail</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>NodeName</span><span class=p>)</span>
<a id=__codelineno-46-61 name=__codelineno-46-61 href=#__codelineno-46-61></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-46-62 name=__codelineno-46-62 href=#__codelineno-46-62></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-46-63 name=__codelineno-46-63 href=#__codelineno-46-63></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-46-64 name=__codelineno-46-64 href=#__codelineno-46-64></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-46-65 name=__codelineno-46-65 href=#__codelineno-46-65></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-46-66 name=__codelineno-46-66 href=#__codelineno-46-66></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-46-67 name=__codelineno-46-67 href=#__codelineno-46-67></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-46-68 name=__codelineno-46-68 href=#__codelineno-46-68></a>
<a id=__codelineno-46-69 name=__codelineno-46-69 href=#__codelineno-46-69></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-46-70 name=__codelineno-46-70 href=#__codelineno-46-70></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;获取Node详情成功&quot;</span><span class=p>,</span>
<a id=__codelineno-46-71 name=__codelineno-46-71 href=#__codelineno-46-71></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=nx>data</span><span class=p>,</span>
<a id=__codelineno-46-72 name=__codelineno-46-72 href=#__codelineno-46-72></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-46-73 name=__codelineno-46-73 href=#__codelineno-46-73></a><span class=p>}</span>
</code></pre></div> <h4 id=32-namespace>3.2 Namespace<a class=headerlink href=#32-namespace title="Permanent link">&para;</a></h4> <table> <thead> <tr> <th>功能</th> <th>是否实现</th> </tr> </thead> <tbody> <tr> <td>Namespace 列表</td> <td>√</td> </tr> <tr> <td>获取Namespace详情</td> <td>√</td> </tr> <tr> <td>删除Namespace</td> <td>√</td> </tr> </tbody> </table> <h5 id=servicedataselectorgo_4>service/dataselector.go<a class=headerlink href=#servicedataselectorgo_4 title="Permanent link">&para;</a></h5> <div class=highlight><pre><span></span><code><a id=__codelineno-47-1 name=__codelineno-47-1 href=#__codelineno-47-1></a><span class=c1>// 实现 Namespace 的 DataCell接口</span>
<a id=__codelineno-47-2 name=__codelineno-47-2 href=#__codelineno-47-2></a><span class=kd>type</span><span class=w> </span><span class=nx>namespaceCell</span><span class=w> </span><span class=nx>corev1</span><span class=p>.</span><span class=nx>Namespace</span>
<a id=__codelineno-47-3 name=__codelineno-47-3 href=#__codelineno-47-3></a>
<a id=__codelineno-47-4 name=__codelineno-47-4 href=#__codelineno-47-4></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>n</span><span class=w> </span><span class=nx>namespaceCell</span><span class=p>)</span><span class=w> </span><span class=nx>GetCreation</span><span class=p>()</span><span class=w> </span><span class=nx>time</span><span class=p>.</span><span class=nx>Time</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-47-5 name=__codelineno-47-5 href=#__codelineno-47-5></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>n</span><span class=p>.</span><span class=nx>CreationTimestamp</span><span class=p>.</span><span class=nx>Time</span>
<a id=__codelineno-47-6 name=__codelineno-47-6 href=#__codelineno-47-6></a><span class=p>}</span>
<a id=__codelineno-47-7 name=__codelineno-47-7 href=#__codelineno-47-7></a>
<a id=__codelineno-47-8 name=__codelineno-47-8 href=#__codelineno-47-8></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>n</span><span class=w> </span><span class=nx>namespaceCell</span><span class=p>)</span><span class=w> </span><span class=nx>GetName</span><span class=p>()</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-47-9 name=__codelineno-47-9 href=#__codelineno-47-9></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>n</span><span class=p>.</span><span class=nx>Name</span>
<a id=__codelineno-47-10 name=__codelineno-47-10 href=#__codelineno-47-10></a><span class=p>}</span>
</code></pre></div> <h5 id=servicenamespacego>service/namespace.go<a class=headerlink href=#servicenamespacego title="Permanent link">&para;</a></h5> <div class=highlight><pre><span></span><code><a id=__codelineno-48-1 name=__codelineno-48-1 href=#__codelineno-48-1></a><span class=kn>package</span><span class=w> </span><span class=nx>service</span>
<a id=__codelineno-48-2 name=__codelineno-48-2 href=#__codelineno-48-2></a>
<a id=__codelineno-48-3 name=__codelineno-48-3 href=#__codelineno-48-3></a><span class=kn>import</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-48-4 name=__codelineno-48-4 href=#__codelineno-48-4></a><span class=w>    </span><span class=s>&quot;context&quot;</span>
<a id=__codelineno-48-5 name=__codelineno-48-5 href=#__codelineno-48-5></a><span class=w>    </span><span class=s>&quot;errors&quot;</span>
<a id=__codelineno-48-6 name=__codelineno-48-6 href=#__codelineno-48-6></a>
<a id=__codelineno-48-7 name=__codelineno-48-7 href=#__codelineno-48-7></a><span class=w>    </span><span class=s>&quot;github.com/wonderivan/logger&quot;</span>
<a id=__codelineno-48-8 name=__codelineno-48-8 href=#__codelineno-48-8></a><span class=w>    </span><span class=nx>corev1</span><span class=w> </span><span class=s>&quot;k8s.io/api/core/v1&quot;</span>
<a id=__codelineno-48-9 name=__codelineno-48-9 href=#__codelineno-48-9></a><span class=w>    </span><span class=nx>metav1</span><span class=w> </span><span class=s>&quot;k8s.io/apimachinery/pkg/apis/meta/v1&quot;</span>
<a id=__codelineno-48-10 name=__codelineno-48-10 href=#__codelineno-48-10></a><span class=p>)</span>
<a id=__codelineno-48-11 name=__codelineno-48-11 href=#__codelineno-48-11></a>
<a id=__codelineno-48-12 name=__codelineno-48-12 href=#__codelineno-48-12></a><span class=kd>type</span><span class=w> </span><span class=nx>namespace</span><span class=w> </span><span class=kd>struct</span><span class=p>{}</span>
<a id=__codelineno-48-13 name=__codelineno-48-13 href=#__codelineno-48-13></a>
<a id=__codelineno-48-14 name=__codelineno-48-14 href=#__codelineno-48-14></a><span class=kd>var</span><span class=w> </span><span class=nx>Namespace</span><span class=w> </span><span class=nx>namespace</span>
<a id=__codelineno-48-15 name=__codelineno-48-15 href=#__codelineno-48-15></a>
<a id=__codelineno-48-16 name=__codelineno-48-16 href=#__codelineno-48-16></a><span class=kd>type</span><span class=w> </span><span class=nx>NamespacesResp</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-48-17 name=__codelineno-48-17 href=#__codelineno-48-17></a><span class=w>    </span><span class=nx>Items</span><span class=w> </span><span class=p>[]</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>Namespace</span><span class=w> </span><span class=s>`json:&quot;items&quot;`</span>
<a id=__codelineno-48-18 name=__codelineno-48-18 href=#__codelineno-48-18></a><span class=w>    </span><span class=nx>Total</span><span class=w> </span><span class=kt>int</span><span class=w>                </span><span class=s>`json:&quot;total&quot;`</span>
<a id=__codelineno-48-19 name=__codelineno-48-19 href=#__codelineno-48-19></a><span class=p>}</span>
<a id=__codelineno-48-20 name=__codelineno-48-20 href=#__codelineno-48-20></a>
<a id=__codelineno-48-21 name=__codelineno-48-21 href=#__codelineno-48-21></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>n</span><span class=w> </span><span class=o>*</span><span class=nx>namespace</span><span class=p>)</span><span class=w> </span><span class=nx>toCells</span><span class=p>(</span><span class=nx>std</span><span class=w> </span><span class=p>[]</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>)</span><span class=w> </span><span class=p>[]</span><span class=nx>DataCell</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-48-22 name=__codelineno-48-22 href=#__codelineno-48-22></a><span class=w>    </span><span class=nx>cells</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>make</span><span class=p>([]</span><span class=nx>DataCell</span><span class=p>,</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>std</span><span class=p>))</span>
<a id=__codelineno-48-23 name=__codelineno-48-23 href=#__codelineno-48-23></a><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=nx>i</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>std</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-48-24 name=__codelineno-48-24 href=#__codelineno-48-24></a><span class=w>        </span><span class=nx>cells</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>namespaceCell</span><span class=p>(</span><span class=nx>std</span><span class=p>[</span><span class=nx>i</span><span class=p>])</span>
<a id=__codelineno-48-25 name=__codelineno-48-25 href=#__codelineno-48-25></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-48-26 name=__codelineno-48-26 href=#__codelineno-48-26></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>cells</span>
<a id=__codelineno-48-27 name=__codelineno-48-27 href=#__codelineno-48-27></a><span class=p>}</span>
<a id=__codelineno-48-28 name=__codelineno-48-28 href=#__codelineno-48-28></a>
<a id=__codelineno-48-29 name=__codelineno-48-29 href=#__codelineno-48-29></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>n</span><span class=w> </span><span class=o>*</span><span class=nx>namespace</span><span class=p>)</span><span class=w> </span><span class=nx>fromCells</span><span class=p>(</span><span class=nx>cells</span><span class=w> </span><span class=p>[]</span><span class=nx>DataCell</span><span class=p>)</span><span class=w> </span><span class=p>[]</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>Namespace</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-48-30 name=__codelineno-48-30 href=#__codelineno-48-30></a><span class=w>    </span><span class=nx>namespaces</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>make</span><span class=p>([]</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>,</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>cells</span><span class=p>))</span>
<a id=__codelineno-48-31 name=__codelineno-48-31 href=#__codelineno-48-31></a><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=nx>i</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>cells</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-48-32 name=__codelineno-48-32 href=#__codelineno-48-32></a><span class=w>        </span><span class=nx>namespaces</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>corev1</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>(</span><span class=nx>cells</span><span class=p>[</span><span class=nx>i</span><span class=p>].(</span><span class=nx>namespaceCell</span><span class=p>))</span>
<a id=__codelineno-48-33 name=__codelineno-48-33 href=#__codelineno-48-33></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-48-34 name=__codelineno-48-34 href=#__codelineno-48-34></a>
<a id=__codelineno-48-35 name=__codelineno-48-35 href=#__codelineno-48-35></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>namespaces</span>
<a id=__codelineno-48-36 name=__codelineno-48-36 href=#__codelineno-48-36></a><span class=p>}</span>
<a id=__codelineno-48-37 name=__codelineno-48-37 href=#__codelineno-48-37></a>
<a id=__codelineno-48-38 name=__codelineno-48-38 href=#__codelineno-48-38></a><span class=c1>// GetNamespaces 获取namespace列表，支持过滤、排序、分页</span>
<a id=__codelineno-48-39 name=__codelineno-48-39 href=#__codelineno-48-39></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>n</span><span class=w> </span><span class=o>*</span><span class=nx>namespace</span><span class=p>)</span><span class=w> </span><span class=nx>GetNamespaces</span><span class=p>(</span><span class=nx>filterName</span><span class=w> </span><span class=kt>string</span><span class=p>,</span><span class=w> </span><span class=nx>limit</span><span class=p>,</span><span class=w> </span><span class=nx>page</span><span class=w> </span><span class=kt>int</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>namespaceResp</span><span class=w> </span><span class=o>*</span><span class=nx>NamespacesResp</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-48-40 name=__codelineno-48-40 href=#__codelineno-48-40></a><span class=w>    </span><span class=c1>//获取namespaceList类型的namespace列表</span>
<a id=__codelineno-48-41 name=__codelineno-48-41 href=#__codelineno-48-41></a><span class=w>    </span><span class=nx>namespaceList</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>CoreV1</span><span class=p>().</span><span class=nx>Namespaces</span><span class=p>().</span><span class=nx>List</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>ListOptions</span><span class=p>{})</span>
<a id=__codelineno-48-42 name=__codelineno-48-42 href=#__codelineno-48-42></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-48-43 name=__codelineno-48-43 href=#__codelineno-48-43></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取Namespace列表失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-48-44 name=__codelineno-48-44 href=#__codelineno-48-44></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取Namespace列表失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-48-45 name=__codelineno-48-45 href=#__codelineno-48-45></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-48-46 name=__codelineno-48-46 href=#__codelineno-48-46></a><span class=w>    </span><span class=c1>//将namespaceList中的namespace列表(Items)，放进dataselector对象中，进行排序</span>
<a id=__codelineno-48-47 name=__codelineno-48-47 href=#__codelineno-48-47></a><span class=w>    </span><span class=nx>selectableData</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>dataSelector</span><span class=p>{</span>
<a id=__codelineno-48-48 name=__codelineno-48-48 href=#__codelineno-48-48></a><span class=w>        </span><span class=nx>GenericDataList</span><span class=p>:</span><span class=w> </span><span class=nx>n</span><span class=p>.</span><span class=nx>toCells</span><span class=p>(</span><span class=nx>namespaceList</span><span class=p>.</span><span class=nx>Items</span><span class=p>),</span>
<a id=__codelineno-48-49 name=__codelineno-48-49 href=#__codelineno-48-49></a><span class=w>        </span><span class=nx>dataSelectQuery</span><span class=p>:</span><span class=w> </span><span class=o>&amp;</span><span class=nx>DataSelectQuery</span><span class=p>{</span>
<a id=__codelineno-48-50 name=__codelineno-48-50 href=#__codelineno-48-50></a><span class=w>            </span><span class=nx>FilterQuery</span><span class=p>:</span><span class=w> </span><span class=o>&amp;</span><span class=nx>FilterQuery</span><span class=p>{</span><span class=nx>Name</span><span class=p>:</span><span class=w> </span><span class=nx>filterName</span><span class=p>},</span>
<a id=__codelineno-48-51 name=__codelineno-48-51 href=#__codelineno-48-51></a><span class=w>            </span><span class=nx>PaginateQuery</span><span class=p>:</span><span class=w> </span><span class=o>&amp;</span><span class=nx>PaginateQuery</span><span class=p>{</span>
<a id=__codelineno-48-52 name=__codelineno-48-52 href=#__codelineno-48-52></a><span class=w>                </span><span class=nx>Limit</span><span class=p>:</span><span class=w> </span><span class=nx>limit</span><span class=p>,</span>
<a id=__codelineno-48-53 name=__codelineno-48-53 href=#__codelineno-48-53></a><span class=w>                </span><span class=nx>Page</span><span class=p>:</span><span class=w>  </span><span class=nx>page</span><span class=p>,</span>
<a id=__codelineno-48-54 name=__codelineno-48-54 href=#__codelineno-48-54></a><span class=w>            </span><span class=p>},</span>
<a id=__codelineno-48-55 name=__codelineno-48-55 href=#__codelineno-48-55></a><span class=w>        </span><span class=p>},</span>
<a id=__codelineno-48-56 name=__codelineno-48-56 href=#__codelineno-48-56></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-48-57 name=__codelineno-48-57 href=#__codelineno-48-57></a><span class=w>    </span><span class=nx>filtered</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>selectableData</span><span class=p>.</span><span class=nx>Filter</span><span class=p>()</span>
<a id=__codelineno-48-58 name=__codelineno-48-58 href=#__codelineno-48-58></a><span class=w>    </span><span class=nx>total</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>filtered</span><span class=p>.</span><span class=nx>GenericDataList</span><span class=p>)</span>
<a id=__codelineno-48-59 name=__codelineno-48-59 href=#__codelineno-48-59></a><span class=w>    </span><span class=nx>data</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>filtered</span><span class=p>.</span><span class=nx>Sort</span><span class=p>().</span><span class=nx>Paginate</span><span class=p>()</span>
<a id=__codelineno-48-60 name=__codelineno-48-60 href=#__codelineno-48-60></a><span class=w>    </span><span class=c1>//将[]DataCell类型的namespace列表转为v1.namespace列表</span>
<a id=__codelineno-48-61 name=__codelineno-48-61 href=#__codelineno-48-61></a><span class=w>    </span><span class=nx>namespaces</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>n</span><span class=p>.</span><span class=nx>fromCells</span><span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>GenericDataList</span><span class=p>)</span>
<a id=__codelineno-48-62 name=__codelineno-48-62 href=#__codelineno-48-62></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=o>&amp;</span><span class=nx>NamespacesResp</span><span class=p>{</span>
<a id=__codelineno-48-63 name=__codelineno-48-63 href=#__codelineno-48-63></a><span class=w>        </span><span class=nx>Items</span><span class=p>:</span><span class=w> </span><span class=nx>namespaces</span><span class=p>,</span>
<a id=__codelineno-48-64 name=__codelineno-48-64 href=#__codelineno-48-64></a><span class=w>        </span><span class=nx>Total</span><span class=p>:</span><span class=w> </span><span class=nx>total</span><span class=p>,</span>
<a id=__codelineno-48-65 name=__codelineno-48-65 href=#__codelineno-48-65></a><span class=w>    </span><span class=p>},</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-48-66 name=__codelineno-48-66 href=#__codelineno-48-66></a><span class=p>}</span>
<a id=__codelineno-48-67 name=__codelineno-48-67 href=#__codelineno-48-67></a>
<a id=__codelineno-48-68 name=__codelineno-48-68 href=#__codelineno-48-68></a><span class=c1>// GetNamespaceDetail 获取namespace详情</span>
<a id=__codelineno-48-69 name=__codelineno-48-69 href=#__codelineno-48-69></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>n</span><span class=w> </span><span class=o>*</span><span class=nx>namespace</span><span class=p>)</span><span class=w> </span><span class=nx>GetNamespaceDetail</span><span class=p>(</span><span class=nx>namespaceName</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>namespace</span><span class=w> </span><span class=o>*</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-48-70 name=__codelineno-48-70 href=#__codelineno-48-70></a><span class=w>    </span><span class=nx>namespace</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>CoreV1</span><span class=p>().</span><span class=nx>Namespaces</span><span class=p>().</span><span class=nx>Get</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>namespaceName</span><span class=p>,</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>GetOptions</span><span class=p>{})</span>
<a id=__codelineno-48-71 name=__codelineno-48-71 href=#__codelineno-48-71></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-48-72 name=__codelineno-48-72 href=#__codelineno-48-72></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取Namespace详情失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-48-73 name=__codelineno-48-73 href=#__codelineno-48-73></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取Namespace详情失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-48-74 name=__codelineno-48-74 href=#__codelineno-48-74></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-48-75 name=__codelineno-48-75 href=#__codelineno-48-75></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>namespace</span><span class=p>,</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-48-76 name=__codelineno-48-76 href=#__codelineno-48-76></a><span class=p>}</span>
<a id=__codelineno-48-77 name=__codelineno-48-77 href=#__codelineno-48-77></a>
<a id=__codelineno-48-78 name=__codelineno-48-78 href=#__codelineno-48-78></a><span class=c1>// DeleteNamespace 删除namespace</span>
<a id=__codelineno-48-79 name=__codelineno-48-79 href=#__codelineno-48-79></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>n</span><span class=w> </span><span class=o>*</span><span class=nx>namespace</span><span class=p>)</span><span class=w> </span><span class=nx>DeleteNamespace</span><span class=p>(</span><span class=nx>namespaceName</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-48-80 name=__codelineno-48-80 href=#__codelineno-48-80></a><span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>CoreV1</span><span class=p>().</span><span class=nx>Namespaces</span><span class=p>().</span><span class=nx>Delete</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>namespaceName</span><span class=p>,</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>DeleteOptions</span><span class=p>{})</span>
<a id=__codelineno-48-81 name=__codelineno-48-81 href=#__codelineno-48-81></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-48-82 name=__codelineno-48-82 href=#__codelineno-48-82></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;删除Namespace失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-48-83 name=__codelineno-48-83 href=#__codelineno-48-83></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;删除Namespace失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-48-84 name=__codelineno-48-84 href=#__codelineno-48-84></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-48-85 name=__codelineno-48-85 href=#__codelineno-48-85></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-48-86 name=__codelineno-48-86 href=#__codelineno-48-86></a><span class=p>}</span>
</code></pre></div> <h5 id=controllernamespacego>controller/namespace.go<a class=headerlink href=#controllernamespacego title="Permanent link">&para;</a></h5> <div class=highlight><pre><span></span><code><a id=__codelineno-49-1 name=__codelineno-49-1 href=#__codelineno-49-1></a><span class=kn>package</span><span class=w> </span><span class=nx>controller</span>
<a id=__codelineno-49-2 name=__codelineno-49-2 href=#__codelineno-49-2></a>
<a id=__codelineno-49-3 name=__codelineno-49-3 href=#__codelineno-49-3></a><span class=kn>import</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-49-4 name=__codelineno-49-4 href=#__codelineno-49-4></a><span class=w>    </span><span class=s>&quot;gitee.com/hujianli94net/k8s-platform/service&quot;</span>
<a id=__codelineno-49-5 name=__codelineno-49-5 href=#__codelineno-49-5></a><span class=w>    </span><span class=s>&quot;net/http&quot;</span>
<a id=__codelineno-49-6 name=__codelineno-49-6 href=#__codelineno-49-6></a>
<a id=__codelineno-49-7 name=__codelineno-49-7 href=#__codelineno-49-7></a><span class=w>    </span><span class=s>&quot;github.com/gin-gonic/gin&quot;</span>
<a id=__codelineno-49-8 name=__codelineno-49-8 href=#__codelineno-49-8></a><span class=w>    </span><span class=s>&quot;github.com/wonderivan/logger&quot;</span>
<a id=__codelineno-49-9 name=__codelineno-49-9 href=#__codelineno-49-9></a><span class=p>)</span>
<a id=__codelineno-49-10 name=__codelineno-49-10 href=#__codelineno-49-10></a>
<a id=__codelineno-49-11 name=__codelineno-49-11 href=#__codelineno-49-11></a><span class=kd>type</span><span class=w> </span><span class=nx>namespace</span><span class=w> </span><span class=kd>struct</span><span class=p>{}</span>
<a id=__codelineno-49-12 name=__codelineno-49-12 href=#__codelineno-49-12></a>
<a id=__codelineno-49-13 name=__codelineno-49-13 href=#__codelineno-49-13></a><span class=kd>var</span><span class=w> </span><span class=nx>Namespace</span><span class=w> </span><span class=nx>namespace</span>
<a id=__codelineno-49-14 name=__codelineno-49-14 href=#__codelineno-49-14></a>
<a id=__codelineno-49-15 name=__codelineno-49-15 href=#__codelineno-49-15></a><span class=c1>// GetNamespaces 获取namespace列表，支持过滤、排序、分页</span>
<a id=__codelineno-49-16 name=__codelineno-49-16 href=#__codelineno-49-16></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>n</span><span class=w> </span><span class=o>*</span><span class=nx>namespace</span><span class=p>)</span><span class=w> </span><span class=nx>GetNamespaces</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-49-17 name=__codelineno-49-17 href=#__codelineno-49-17></a><span class=w>    </span><span class=nx>params</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-49-18 name=__codelineno-49-18 href=#__codelineno-49-18></a><span class=w>        </span><span class=nx>FilterName</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`form:&quot;filter_name&quot;`</span>
<a id=__codelineno-49-19 name=__codelineno-49-19 href=#__codelineno-49-19></a><span class=w>        </span><span class=nx>Page</span><span class=w>       </span><span class=kt>int</span><span class=w>    </span><span class=s>`form:&quot;page&quot;`</span>
<a id=__codelineno-49-20 name=__codelineno-49-20 href=#__codelineno-49-20></a><span class=w>        </span><span class=nx>Limit</span><span class=w>      </span><span class=kt>int</span><span class=w>    </span><span class=s>`form:&quot;limit&quot;`</span>
<a id=__codelineno-49-21 name=__codelineno-49-21 href=#__codelineno-49-21></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-49-22 name=__codelineno-49-22 href=#__codelineno-49-22></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>Bind</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-49-23 name=__codelineno-49-23 href=#__codelineno-49-23></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-49-24 name=__codelineno-49-24 href=#__codelineno-49-24></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-49-25 name=__codelineno-49-25 href=#__codelineno-49-25></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-49-26 name=__codelineno-49-26 href=#__codelineno-49-26></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-49-27 name=__codelineno-49-27 href=#__codelineno-49-27></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-49-28 name=__codelineno-49-28 href=#__codelineno-49-28></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-49-29 name=__codelineno-49-29 href=#__codelineno-49-29></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-49-30 name=__codelineno-49-30 href=#__codelineno-49-30></a><span class=w>    </span><span class=nx>data</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>.</span><span class=nx>GetNamespaces</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>FilterName</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Limit</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Page</span><span class=p>)</span>
<a id=__codelineno-49-31 name=__codelineno-49-31 href=#__codelineno-49-31></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-49-32 name=__codelineno-49-32 href=#__codelineno-49-32></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-49-33 name=__codelineno-49-33 href=#__codelineno-49-33></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-49-34 name=__codelineno-49-34 href=#__codelineno-49-34></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-49-35 name=__codelineno-49-35 href=#__codelineno-49-35></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-49-36 name=__codelineno-49-36 href=#__codelineno-49-36></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-49-37 name=__codelineno-49-37 href=#__codelineno-49-37></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-49-38 name=__codelineno-49-38 href=#__codelineno-49-38></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-49-39 name=__codelineno-49-39 href=#__codelineno-49-39></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;获取Namespace列表成功&quot;</span><span class=p>,</span>
<a id=__codelineno-49-40 name=__codelineno-49-40 href=#__codelineno-49-40></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=nx>data</span><span class=p>,</span>
<a id=__codelineno-49-41 name=__codelineno-49-41 href=#__codelineno-49-41></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-49-42 name=__codelineno-49-42 href=#__codelineno-49-42></a><span class=p>}</span>
<a id=__codelineno-49-43 name=__codelineno-49-43 href=#__codelineno-49-43></a>
<a id=__codelineno-49-44 name=__codelineno-49-44 href=#__codelineno-49-44></a><span class=c1>// GetNamespaceDetail 获取namespace详情</span>
<a id=__codelineno-49-45 name=__codelineno-49-45 href=#__codelineno-49-45></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>n</span><span class=w> </span><span class=o>*</span><span class=nx>namespace</span><span class=p>)</span><span class=w> </span><span class=nx>GetNamespaceDetail</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-49-46 name=__codelineno-49-46 href=#__codelineno-49-46></a><span class=w>    </span><span class=nx>params</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-49-47 name=__codelineno-49-47 href=#__codelineno-49-47></a><span class=w>        </span><span class=nx>NamespaceName</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`form:&quot;namespace_name&quot;`</span>
<a id=__codelineno-49-48 name=__codelineno-49-48 href=#__codelineno-49-48></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-49-49 name=__codelineno-49-49 href=#__codelineno-49-49></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>Bind</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-49-50 name=__codelineno-49-50 href=#__codelineno-49-50></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-49-51 name=__codelineno-49-51 href=#__codelineno-49-51></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-49-52 name=__codelineno-49-52 href=#__codelineno-49-52></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-49-53 name=__codelineno-49-53 href=#__codelineno-49-53></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-49-54 name=__codelineno-49-54 href=#__codelineno-49-54></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-49-55 name=__codelineno-49-55 href=#__codelineno-49-55></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-49-56 name=__codelineno-49-56 href=#__codelineno-49-56></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-49-57 name=__codelineno-49-57 href=#__codelineno-49-57></a>
<a id=__codelineno-49-58 name=__codelineno-49-58 href=#__codelineno-49-58></a><span class=w>    </span><span class=nx>data</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>.</span><span class=nx>GetNamespaceDetail</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>NamespaceName</span><span class=p>)</span>
<a id=__codelineno-49-59 name=__codelineno-49-59 href=#__codelineno-49-59></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-49-60 name=__codelineno-49-60 href=#__codelineno-49-60></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-49-61 name=__codelineno-49-61 href=#__codelineno-49-61></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-49-62 name=__codelineno-49-62 href=#__codelineno-49-62></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-49-63 name=__codelineno-49-63 href=#__codelineno-49-63></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-49-64 name=__codelineno-49-64 href=#__codelineno-49-64></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-49-65 name=__codelineno-49-65 href=#__codelineno-49-65></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-49-66 name=__codelineno-49-66 href=#__codelineno-49-66></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-49-67 name=__codelineno-49-67 href=#__codelineno-49-67></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;获取Namespace详情成功&quot;</span><span class=p>,</span>
<a id=__codelineno-49-68 name=__codelineno-49-68 href=#__codelineno-49-68></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=nx>data</span><span class=p>,</span>
<a id=__codelineno-49-69 name=__codelineno-49-69 href=#__codelineno-49-69></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-49-70 name=__codelineno-49-70 href=#__codelineno-49-70></a><span class=p>}</span>
<a id=__codelineno-49-71 name=__codelineno-49-71 href=#__codelineno-49-71></a>
<a id=__codelineno-49-72 name=__codelineno-49-72 href=#__codelineno-49-72></a><span class=c1>// DeleteNamespace 删除namespace</span>
<a id=__codelineno-49-73 name=__codelineno-49-73 href=#__codelineno-49-73></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>n</span><span class=w> </span><span class=o>*</span><span class=nx>namespace</span><span class=p>)</span><span class=w> </span><span class=nx>DeleteNamespace</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-49-74 name=__codelineno-49-74 href=#__codelineno-49-74></a><span class=w>    </span><span class=nx>params</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-49-75 name=__codelineno-49-75 href=#__codelineno-49-75></a><span class=w>        </span><span class=nx>NamespaceName</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;namespace_name&quot;`</span>
<a id=__codelineno-49-76 name=__codelineno-49-76 href=#__codelineno-49-76></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-49-77 name=__codelineno-49-77 href=#__codelineno-49-77></a><span class=w>    </span><span class=c1>//DELETE请求，绑定参数方法改为ctx.ShouldBindJSON</span>
<a id=__codelineno-49-78 name=__codelineno-49-78 href=#__codelineno-49-78></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>ShouldBindJSON</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-49-79 name=__codelineno-49-79 href=#__codelineno-49-79></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-49-80 name=__codelineno-49-80 href=#__codelineno-49-80></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-49-81 name=__codelineno-49-81 href=#__codelineno-49-81></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-49-82 name=__codelineno-49-82 href=#__codelineno-49-82></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-49-83 name=__codelineno-49-83 href=#__codelineno-49-83></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-49-84 name=__codelineno-49-84 href=#__codelineno-49-84></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-49-85 name=__codelineno-49-85 href=#__codelineno-49-85></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-49-86 name=__codelineno-49-86 href=#__codelineno-49-86></a><span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>.</span><span class=nx>DeleteNamespace</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>NamespaceName</span><span class=p>)</span>
<a id=__codelineno-49-87 name=__codelineno-49-87 href=#__codelineno-49-87></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-49-88 name=__codelineno-49-88 href=#__codelineno-49-88></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-49-89 name=__codelineno-49-89 href=#__codelineno-49-89></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-49-90 name=__codelineno-49-90 href=#__codelineno-49-90></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-49-91 name=__codelineno-49-91 href=#__codelineno-49-91></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-49-92 name=__codelineno-49-92 href=#__codelineno-49-92></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-49-93 name=__codelineno-49-93 href=#__codelineno-49-93></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-49-94 name=__codelineno-49-94 href=#__codelineno-49-94></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-49-95 name=__codelineno-49-95 href=#__codelineno-49-95></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;删除Namespace成功&quot;</span><span class=p>,</span>
<a id=__codelineno-49-96 name=__codelineno-49-96 href=#__codelineno-49-96></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-49-97 name=__codelineno-49-97 href=#__codelineno-49-97></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-49-98 name=__codelineno-49-98 href=#__codelineno-49-98></a><span class=p>}</span>
</code></pre></div> <h4 id=33-persistentvolume>3.3 PersistentVolume<a class=headerlink href=#33-persistentvolume title="Permanent link">&para;</a></h4> <table> <thead> <tr> <th>功能</th> <th>是否实现</th> </tr> </thead> <tbody> <tr> <td>PersistentVolume 列表</td> <td>√</td> </tr> <tr> <td>获取PersistentVolume详情</td> <td>√</td> </tr> <tr> <td>删除PersistentVolume</td> <td>√</td> </tr> </tbody> </table> <h5 id=servicedataselectorgo_5>service/dataselector.go<a class=headerlink href=#servicedataselectorgo_5 title="Permanent link">&para;</a></h5> <div class=highlight><pre><span></span><code><a id=__codelineno-50-1 name=__codelineno-50-1 href=#__codelineno-50-1></a><span class=c1>// 实现 PersistentVolume 的 DataCell接口</span>
<a id=__codelineno-50-2 name=__codelineno-50-2 href=#__codelineno-50-2></a><span class=kd>type</span><span class=w> </span><span class=nx>pvCell</span><span class=w> </span><span class=nx>corev1</span><span class=p>.</span><span class=nx>PersistentVolume</span>
<a id=__codelineno-50-3 name=__codelineno-50-3 href=#__codelineno-50-3></a>
<a id=__codelineno-50-4 name=__codelineno-50-4 href=#__codelineno-50-4></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=nx>pvCell</span><span class=p>)</span><span class=w> </span><span class=nx>GetCreation</span><span class=p>()</span><span class=w> </span><span class=nx>time</span><span class=p>.</span><span class=nx>Time</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-50-5 name=__codelineno-50-5 href=#__codelineno-50-5></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>p</span><span class=p>.</span><span class=nx>CreationTimestamp</span><span class=p>.</span><span class=nx>Time</span>
<a id=__codelineno-50-6 name=__codelineno-50-6 href=#__codelineno-50-6></a><span class=p>}</span>
<a id=__codelineno-50-7 name=__codelineno-50-7 href=#__codelineno-50-7></a>
<a id=__codelineno-50-8 name=__codelineno-50-8 href=#__codelineno-50-8></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=nx>pvCell</span><span class=p>)</span><span class=w> </span><span class=nx>GetName</span><span class=p>()</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-50-9 name=__codelineno-50-9 href=#__codelineno-50-9></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>p</span><span class=p>.</span><span class=nx>Name</span>
<a id=__codelineno-50-10 name=__codelineno-50-10 href=#__codelineno-50-10></a><span class=p>}</span>
</code></pre></div> <h5 id=servicepvgo>service/pv.go<a class=headerlink href=#servicepvgo title="Permanent link">&para;</a></h5> <div class=highlight><pre><span></span><code><a id=__codelineno-51-1 name=__codelineno-51-1 href=#__codelineno-51-1></a><span class=kn>package</span><span class=w> </span><span class=nx>service</span>
<a id=__codelineno-51-2 name=__codelineno-51-2 href=#__codelineno-51-2></a>
<a id=__codelineno-51-3 name=__codelineno-51-3 href=#__codelineno-51-3></a><span class=kn>import</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-51-4 name=__codelineno-51-4 href=#__codelineno-51-4></a><span class=w>    </span><span class=s>&quot;context&quot;</span>
<a id=__codelineno-51-5 name=__codelineno-51-5 href=#__codelineno-51-5></a><span class=w>    </span><span class=s>&quot;errors&quot;</span>
<a id=__codelineno-51-6 name=__codelineno-51-6 href=#__codelineno-51-6></a>
<a id=__codelineno-51-7 name=__codelineno-51-7 href=#__codelineno-51-7></a><span class=w>    </span><span class=s>&quot;github.com/wonderivan/logger&quot;</span>
<a id=__codelineno-51-8 name=__codelineno-51-8 href=#__codelineno-51-8></a><span class=w>    </span><span class=nx>corev1</span><span class=w> </span><span class=s>&quot;k8s.io/api/core/v1&quot;</span>
<a id=__codelineno-51-9 name=__codelineno-51-9 href=#__codelineno-51-9></a><span class=w>    </span><span class=nx>metav1</span><span class=w> </span><span class=s>&quot;k8s.io/apimachinery/pkg/apis/meta/v1&quot;</span>
<a id=__codelineno-51-10 name=__codelineno-51-10 href=#__codelineno-51-10></a><span class=p>)</span>
<a id=__codelineno-51-11 name=__codelineno-51-11 href=#__codelineno-51-11></a>
<a id=__codelineno-51-12 name=__codelineno-51-12 href=#__codelineno-51-12></a><span class=kd>var</span><span class=w> </span><span class=nx>Pv</span><span class=w> </span><span class=nx>pv</span>
<a id=__codelineno-51-13 name=__codelineno-51-13 href=#__codelineno-51-13></a>
<a id=__codelineno-51-14 name=__codelineno-51-14 href=#__codelineno-51-14></a><span class=kd>type</span><span class=w> </span><span class=nx>pv</span><span class=w> </span><span class=kd>struct</span><span class=p>{}</span>
<a id=__codelineno-51-15 name=__codelineno-51-15 href=#__codelineno-51-15></a>
<a id=__codelineno-51-16 name=__codelineno-51-16 href=#__codelineno-51-16></a><span class=kd>type</span><span class=w> </span><span class=nx>PvsResp</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-51-17 name=__codelineno-51-17 href=#__codelineno-51-17></a><span class=w>    </span><span class=nx>Items</span><span class=w> </span><span class=p>[]</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>PersistentVolume</span><span class=w> </span><span class=s>`json:&quot;items&quot;`</span>
<a id=__codelineno-51-18 name=__codelineno-51-18 href=#__codelineno-51-18></a><span class=w>    </span><span class=nx>Total</span><span class=w> </span><span class=kt>int</span><span class=w>                       </span><span class=s>`json:&quot;total&quot;`</span>
<a id=__codelineno-51-19 name=__codelineno-51-19 href=#__codelineno-51-19></a><span class=p>}</span>
<a id=__codelineno-51-20 name=__codelineno-51-20 href=#__codelineno-51-20></a>
<a id=__codelineno-51-21 name=__codelineno-51-21 href=#__codelineno-51-21></a><span class=c1>// GetPvs 获取pv列表，支持过滤、排序、分页</span>
<a id=__codelineno-51-22 name=__codelineno-51-22 href=#__codelineno-51-22></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=o>*</span><span class=nx>pv</span><span class=p>)</span><span class=w> </span><span class=nx>GetPvs</span><span class=p>(</span><span class=nx>filterName</span><span class=w> </span><span class=kt>string</span><span class=p>,</span><span class=w> </span><span class=nx>limit</span><span class=p>,</span><span class=w> </span><span class=nx>page</span><span class=w> </span><span class=kt>int</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>pvsResp</span><span class=w> </span><span class=o>*</span><span class=nx>PvsResp</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-51-23 name=__codelineno-51-23 href=#__codelineno-51-23></a><span class=w>    </span><span class=c1>//获取pvList类型的pv列表</span>
<a id=__codelineno-51-24 name=__codelineno-51-24 href=#__codelineno-51-24></a><span class=w>    </span><span class=nx>pvList</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>CoreV1</span><span class=p>().</span><span class=nx>PersistentVolumes</span><span class=p>().</span><span class=nx>List</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>ListOptions</span><span class=p>{})</span>
<a id=__codelineno-51-25 name=__codelineno-51-25 href=#__codelineno-51-25></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-51-26 name=__codelineno-51-26 href=#__codelineno-51-26></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取Pv列表失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-51-27 name=__codelineno-51-27 href=#__codelineno-51-27></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取Pv列表失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-51-28 name=__codelineno-51-28 href=#__codelineno-51-28></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-51-29 name=__codelineno-51-29 href=#__codelineno-51-29></a><span class=w>    </span><span class=c1>//将pvList中的pv列表(Items)，放进dataselector对象中，进行排序</span>
<a id=__codelineno-51-30 name=__codelineno-51-30 href=#__codelineno-51-30></a><span class=w>    </span><span class=nx>selectableData</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>dataSelector</span><span class=p>{</span>
<a id=__codelineno-51-31 name=__codelineno-51-31 href=#__codelineno-51-31></a><span class=w>        </span><span class=nx>GenericDataList</span><span class=p>:</span><span class=w> </span><span class=nx>p</span><span class=p>.</span><span class=nx>toCells</span><span class=p>(</span><span class=nx>pvList</span><span class=p>.</span><span class=nx>Items</span><span class=p>),</span>
<a id=__codelineno-51-32 name=__codelineno-51-32 href=#__codelineno-51-32></a><span class=w>        </span><span class=nx>dataSelectQuery</span><span class=p>:</span><span class=w> </span><span class=o>&amp;</span><span class=nx>DataSelectQuery</span><span class=p>{</span>
<a id=__codelineno-51-33 name=__codelineno-51-33 href=#__codelineno-51-33></a><span class=w>            </span><span class=nx>FilterQuery</span><span class=p>:</span><span class=w> </span><span class=o>&amp;</span><span class=nx>FilterQuery</span><span class=p>{</span><span class=nx>Name</span><span class=p>:</span><span class=w> </span><span class=nx>filterName</span><span class=p>},</span>
<a id=__codelineno-51-34 name=__codelineno-51-34 href=#__codelineno-51-34></a><span class=w>            </span><span class=nx>PaginateQuery</span><span class=p>:</span><span class=w> </span><span class=o>&amp;</span><span class=nx>PaginateQuery</span><span class=p>{</span>
<a id=__codelineno-51-35 name=__codelineno-51-35 href=#__codelineno-51-35></a><span class=w>                </span><span class=nx>Limit</span><span class=p>:</span><span class=w> </span><span class=nx>limit</span><span class=p>,</span>
<a id=__codelineno-51-36 name=__codelineno-51-36 href=#__codelineno-51-36></a><span class=w>                </span><span class=nx>Page</span><span class=p>:</span><span class=w>  </span><span class=nx>page</span><span class=p>,</span>
<a id=__codelineno-51-37 name=__codelineno-51-37 href=#__codelineno-51-37></a><span class=w>            </span><span class=p>},</span>
<a id=__codelineno-51-38 name=__codelineno-51-38 href=#__codelineno-51-38></a><span class=w>        </span><span class=p>},</span>
<a id=__codelineno-51-39 name=__codelineno-51-39 href=#__codelineno-51-39></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-51-40 name=__codelineno-51-40 href=#__codelineno-51-40></a>
<a id=__codelineno-51-41 name=__codelineno-51-41 href=#__codelineno-51-41></a><span class=w>    </span><span class=nx>filtered</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>selectableData</span><span class=p>.</span><span class=nx>Filter</span><span class=p>()</span>
<a id=__codelineno-51-42 name=__codelineno-51-42 href=#__codelineno-51-42></a><span class=w>    </span><span class=nx>total</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>filtered</span><span class=p>.</span><span class=nx>GenericDataList</span><span class=p>)</span>
<a id=__codelineno-51-43 name=__codelineno-51-43 href=#__codelineno-51-43></a><span class=w>    </span><span class=nx>data</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>filtered</span><span class=p>.</span><span class=nx>Sort</span><span class=p>().</span><span class=nx>Paginate</span><span class=p>()</span>
<a id=__codelineno-51-44 name=__codelineno-51-44 href=#__codelineno-51-44></a>
<a id=__codelineno-51-45 name=__codelineno-51-45 href=#__codelineno-51-45></a><span class=w>    </span><span class=c1>//将[]DataCell类型的pv列表转为v1.pv列表</span>
<a id=__codelineno-51-46 name=__codelineno-51-46 href=#__codelineno-51-46></a><span class=w>    </span><span class=nx>pvs</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>p</span><span class=p>.</span><span class=nx>fromCells</span><span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>GenericDataList</span><span class=p>)</span>
<a id=__codelineno-51-47 name=__codelineno-51-47 href=#__codelineno-51-47></a>
<a id=__codelineno-51-48 name=__codelineno-51-48 href=#__codelineno-51-48></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=o>&amp;</span><span class=nx>PvsResp</span><span class=p>{</span>
<a id=__codelineno-51-49 name=__codelineno-51-49 href=#__codelineno-51-49></a><span class=w>        </span><span class=nx>Items</span><span class=p>:</span><span class=w> </span><span class=nx>pvs</span><span class=p>,</span>
<a id=__codelineno-51-50 name=__codelineno-51-50 href=#__codelineno-51-50></a><span class=w>        </span><span class=nx>Total</span><span class=p>:</span><span class=w> </span><span class=nx>total</span><span class=p>,</span>
<a id=__codelineno-51-51 name=__codelineno-51-51 href=#__codelineno-51-51></a><span class=w>    </span><span class=p>},</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-51-52 name=__codelineno-51-52 href=#__codelineno-51-52></a><span class=p>}</span>
<a id=__codelineno-51-53 name=__codelineno-51-53 href=#__codelineno-51-53></a>
<a id=__codelineno-51-54 name=__codelineno-51-54 href=#__codelineno-51-54></a><span class=c1>// GetPvDetail 获取pv详情</span>
<a id=__codelineno-51-55 name=__codelineno-51-55 href=#__codelineno-51-55></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=o>*</span><span class=nx>pv</span><span class=p>)</span><span class=w> </span><span class=nx>GetPvDetail</span><span class=p>(</span><span class=nx>pvName</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>pv</span><span class=w> </span><span class=o>*</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>PersistentVolume</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-51-56 name=__codelineno-51-56 href=#__codelineno-51-56></a><span class=w>    </span><span class=nx>pv</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>CoreV1</span><span class=p>().</span><span class=nx>PersistentVolumes</span><span class=p>().</span><span class=nx>Get</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>pvName</span><span class=p>,</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>GetOptions</span><span class=p>{})</span>
<a id=__codelineno-51-57 name=__codelineno-51-57 href=#__codelineno-51-57></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-51-58 name=__codelineno-51-58 href=#__codelineno-51-58></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取Pv详情失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-51-59 name=__codelineno-51-59 href=#__codelineno-51-59></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取Pv详情失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-51-60 name=__codelineno-51-60 href=#__codelineno-51-60></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-51-61 name=__codelineno-51-61 href=#__codelineno-51-61></a>
<a id=__codelineno-51-62 name=__codelineno-51-62 href=#__codelineno-51-62></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>pv</span><span class=p>,</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-51-63 name=__codelineno-51-63 href=#__codelineno-51-63></a><span class=p>}</span>
<a id=__codelineno-51-64 name=__codelineno-51-64 href=#__codelineno-51-64></a>
<a id=__codelineno-51-65 name=__codelineno-51-65 href=#__codelineno-51-65></a><span class=c1>// DeletePv 删除pv</span>
<a id=__codelineno-51-66 name=__codelineno-51-66 href=#__codelineno-51-66></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=o>*</span><span class=nx>pv</span><span class=p>)</span><span class=w> </span><span class=nx>DeletePv</span><span class=p>(</span><span class=nx>pvName</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-51-67 name=__codelineno-51-67 href=#__codelineno-51-67></a><span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>CoreV1</span><span class=p>().</span><span class=nx>PersistentVolumes</span><span class=p>().</span><span class=nx>Delete</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>pvName</span><span class=p>,</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>DeleteOptions</span><span class=p>{})</span>
<a id=__codelineno-51-68 name=__codelineno-51-68 href=#__codelineno-51-68></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-51-69 name=__codelineno-51-69 href=#__codelineno-51-69></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;删除Pv失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-51-70 name=__codelineno-51-70 href=#__codelineno-51-70></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;删除Pv失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-51-71 name=__codelineno-51-71 href=#__codelineno-51-71></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-51-72 name=__codelineno-51-72 href=#__codelineno-51-72></a>
<a id=__codelineno-51-73 name=__codelineno-51-73 href=#__codelineno-51-73></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-51-74 name=__codelineno-51-74 href=#__codelineno-51-74></a><span class=p>}</span>
<a id=__codelineno-51-75 name=__codelineno-51-75 href=#__codelineno-51-75></a>
<a id=__codelineno-51-76 name=__codelineno-51-76 href=#__codelineno-51-76></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=o>*</span><span class=nx>pv</span><span class=p>)</span><span class=w> </span><span class=nx>toCells</span><span class=p>(</span><span class=nx>std</span><span class=w> </span><span class=p>[]</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>PersistentVolume</span><span class=p>)</span><span class=w> </span><span class=p>[]</span><span class=nx>DataCell</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-51-77 name=__codelineno-51-77 href=#__codelineno-51-77></a><span class=w>    </span><span class=nx>cells</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>make</span><span class=p>([]</span><span class=nx>DataCell</span><span class=p>,</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>std</span><span class=p>))</span>
<a id=__codelineno-51-78 name=__codelineno-51-78 href=#__codelineno-51-78></a><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=nx>i</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>std</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-51-79 name=__codelineno-51-79 href=#__codelineno-51-79></a><span class=w>        </span><span class=nx>cells</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>pvCell</span><span class=p>(</span><span class=nx>std</span><span class=p>[</span><span class=nx>i</span><span class=p>])</span>
<a id=__codelineno-51-80 name=__codelineno-51-80 href=#__codelineno-51-80></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-51-81 name=__codelineno-51-81 href=#__codelineno-51-81></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>cells</span>
<a id=__codelineno-51-82 name=__codelineno-51-82 href=#__codelineno-51-82></a><span class=p>}</span>
<a id=__codelineno-51-83 name=__codelineno-51-83 href=#__codelineno-51-83></a>
<a id=__codelineno-51-84 name=__codelineno-51-84 href=#__codelineno-51-84></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=o>*</span><span class=nx>pv</span><span class=p>)</span><span class=w> </span><span class=nx>fromCells</span><span class=p>(</span><span class=nx>cells</span><span class=w> </span><span class=p>[]</span><span class=nx>DataCell</span><span class=p>)</span><span class=w> </span><span class=p>[]</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>PersistentVolume</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-51-85 name=__codelineno-51-85 href=#__codelineno-51-85></a><span class=w>    </span><span class=nx>pvs</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>make</span><span class=p>([]</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>PersistentVolume</span><span class=p>,</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>cells</span><span class=p>))</span>
<a id=__codelineno-51-86 name=__codelineno-51-86 href=#__codelineno-51-86></a><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=nx>i</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>cells</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-51-87 name=__codelineno-51-87 href=#__codelineno-51-87></a><span class=w>        </span><span class=nx>pvs</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>corev1</span><span class=p>.</span><span class=nx>PersistentVolume</span><span class=p>(</span><span class=nx>cells</span><span class=p>[</span><span class=nx>i</span><span class=p>].(</span><span class=nx>pvCell</span><span class=p>))</span>
<a id=__codelineno-51-88 name=__codelineno-51-88 href=#__codelineno-51-88></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-51-89 name=__codelineno-51-89 href=#__codelineno-51-89></a>
<a id=__codelineno-51-90 name=__codelineno-51-90 href=#__codelineno-51-90></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>pvs</span>
<a id=__codelineno-51-91 name=__codelineno-51-91 href=#__codelineno-51-91></a><span class=p>}</span>
</code></pre></div> <h5 id=controllerpvgo>controller/pv.go<a class=headerlink href=#controllerpvgo title="Permanent link">&para;</a></h5> <div class=highlight><pre><span></span><code><a id=__codelineno-52-1 name=__codelineno-52-1 href=#__codelineno-52-1></a><span class=kn>package</span><span class=w> </span><span class=nx>controller</span>
<a id=__codelineno-52-2 name=__codelineno-52-2 href=#__codelineno-52-2></a>
<a id=__codelineno-52-3 name=__codelineno-52-3 href=#__codelineno-52-3></a><span class=kn>import</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-52-4 name=__codelineno-52-4 href=#__codelineno-52-4></a><span class=w>    </span><span class=s>&quot;gitee.com/hujianli94net/k8s-platform/service&quot;</span>
<a id=__codelineno-52-5 name=__codelineno-52-5 href=#__codelineno-52-5></a><span class=w>    </span><span class=s>&quot;net/http&quot;</span>
<a id=__codelineno-52-6 name=__codelineno-52-6 href=#__codelineno-52-6></a>
<a id=__codelineno-52-7 name=__codelineno-52-7 href=#__codelineno-52-7></a><span class=w>    </span><span class=s>&quot;github.com/gin-gonic/gin&quot;</span>
<a id=__codelineno-52-8 name=__codelineno-52-8 href=#__codelineno-52-8></a><span class=w>    </span><span class=s>&quot;github.com/wonderivan/logger&quot;</span>
<a id=__codelineno-52-9 name=__codelineno-52-9 href=#__codelineno-52-9></a><span class=p>)</span>
<a id=__codelineno-52-10 name=__codelineno-52-10 href=#__codelineno-52-10></a>
<a id=__codelineno-52-11 name=__codelineno-52-11 href=#__codelineno-52-11></a><span class=kd>var</span><span class=w> </span><span class=nx>Pv</span><span class=w> </span><span class=nx>pv</span>
<a id=__codelineno-52-12 name=__codelineno-52-12 href=#__codelineno-52-12></a>
<a id=__codelineno-52-13 name=__codelineno-52-13 href=#__codelineno-52-13></a><span class=kd>type</span><span class=w> </span><span class=nx>pv</span><span class=w> </span><span class=kd>struct</span><span class=p>{}</span>
<a id=__codelineno-52-14 name=__codelineno-52-14 href=#__codelineno-52-14></a>
<a id=__codelineno-52-15 name=__codelineno-52-15 href=#__codelineno-52-15></a><span class=c1>// GetPvs 获取pv列表，支持过滤、排序、分页</span>
<a id=__codelineno-52-16 name=__codelineno-52-16 href=#__codelineno-52-16></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=o>*</span><span class=nx>pv</span><span class=p>)</span><span class=w> </span><span class=nx>GetPvs</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-52-17 name=__codelineno-52-17 href=#__codelineno-52-17></a><span class=w>    </span><span class=nx>params</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-52-18 name=__codelineno-52-18 href=#__codelineno-52-18></a><span class=w>        </span><span class=nx>FilterName</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`form:&quot;filter_name&quot;`</span>
<a id=__codelineno-52-19 name=__codelineno-52-19 href=#__codelineno-52-19></a><span class=w>        </span><span class=nx>Page</span><span class=w>       </span><span class=kt>int</span><span class=w>    </span><span class=s>`form:&quot;page&quot;`</span>
<a id=__codelineno-52-20 name=__codelineno-52-20 href=#__codelineno-52-20></a><span class=w>        </span><span class=nx>Limit</span><span class=w>      </span><span class=kt>int</span><span class=w>    </span><span class=s>`form:&quot;limit&quot;`</span>
<a id=__codelineno-52-21 name=__codelineno-52-21 href=#__codelineno-52-21></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-52-22 name=__codelineno-52-22 href=#__codelineno-52-22></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>Bind</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-52-23 name=__codelineno-52-23 href=#__codelineno-52-23></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-52-24 name=__codelineno-52-24 href=#__codelineno-52-24></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-52-25 name=__codelineno-52-25 href=#__codelineno-52-25></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-52-26 name=__codelineno-52-26 href=#__codelineno-52-26></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-52-27 name=__codelineno-52-27 href=#__codelineno-52-27></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-52-28 name=__codelineno-52-28 href=#__codelineno-52-28></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-52-29 name=__codelineno-52-29 href=#__codelineno-52-29></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-52-30 name=__codelineno-52-30 href=#__codelineno-52-30></a>
<a id=__codelineno-52-31 name=__codelineno-52-31 href=#__codelineno-52-31></a><span class=w>    </span><span class=nx>data</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>Pv</span><span class=p>.</span><span class=nx>GetPvs</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>FilterName</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Limit</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Page</span><span class=p>)</span>
<a id=__codelineno-52-32 name=__codelineno-52-32 href=#__codelineno-52-32></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-52-33 name=__codelineno-52-33 href=#__codelineno-52-33></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-52-34 name=__codelineno-52-34 href=#__codelineno-52-34></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-52-35 name=__codelineno-52-35 href=#__codelineno-52-35></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-52-36 name=__codelineno-52-36 href=#__codelineno-52-36></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-52-37 name=__codelineno-52-37 href=#__codelineno-52-37></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-52-38 name=__codelineno-52-38 href=#__codelineno-52-38></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-52-39 name=__codelineno-52-39 href=#__codelineno-52-39></a>
<a id=__codelineno-52-40 name=__codelineno-52-40 href=#__codelineno-52-40></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-52-41 name=__codelineno-52-41 href=#__codelineno-52-41></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;获取Pv列表成功&quot;</span><span class=p>,</span>
<a id=__codelineno-52-42 name=__codelineno-52-42 href=#__codelineno-52-42></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=nx>data</span><span class=p>,</span>
<a id=__codelineno-52-43 name=__codelineno-52-43 href=#__codelineno-52-43></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-52-44 name=__codelineno-52-44 href=#__codelineno-52-44></a><span class=p>}</span>
<a id=__codelineno-52-45 name=__codelineno-52-45 href=#__codelineno-52-45></a>
<a id=__codelineno-52-46 name=__codelineno-52-46 href=#__codelineno-52-46></a><span class=c1>// GetPvDetail 获取pv详情</span>
<a id=__codelineno-52-47 name=__codelineno-52-47 href=#__codelineno-52-47></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=o>*</span><span class=nx>pv</span><span class=p>)</span><span class=w> </span><span class=nx>GetPvDetail</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-52-48 name=__codelineno-52-48 href=#__codelineno-52-48></a><span class=w>    </span><span class=nx>params</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-52-49 name=__codelineno-52-49 href=#__codelineno-52-49></a><span class=w>        </span><span class=nx>PvName</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`form:&quot;pv_name&quot;`</span>
<a id=__codelineno-52-50 name=__codelineno-52-50 href=#__codelineno-52-50></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-52-51 name=__codelineno-52-51 href=#__codelineno-52-51></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>Bind</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-52-52 name=__codelineno-52-52 href=#__codelineno-52-52></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-52-53 name=__codelineno-52-53 href=#__codelineno-52-53></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-52-54 name=__codelineno-52-54 href=#__codelineno-52-54></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-52-55 name=__codelineno-52-55 href=#__codelineno-52-55></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-52-56 name=__codelineno-52-56 href=#__codelineno-52-56></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-52-57 name=__codelineno-52-57 href=#__codelineno-52-57></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-52-58 name=__codelineno-52-58 href=#__codelineno-52-58></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-52-59 name=__codelineno-52-59 href=#__codelineno-52-59></a>
<a id=__codelineno-52-60 name=__codelineno-52-60 href=#__codelineno-52-60></a><span class=w>    </span><span class=nx>data</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>Pv</span><span class=p>.</span><span class=nx>GetPvDetail</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>PvName</span><span class=p>)</span>
<a id=__codelineno-52-61 name=__codelineno-52-61 href=#__codelineno-52-61></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-52-62 name=__codelineno-52-62 href=#__codelineno-52-62></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-52-63 name=__codelineno-52-63 href=#__codelineno-52-63></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-52-64 name=__codelineno-52-64 href=#__codelineno-52-64></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-52-65 name=__codelineno-52-65 href=#__codelineno-52-65></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-52-66 name=__codelineno-52-66 href=#__codelineno-52-66></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-52-67 name=__codelineno-52-67 href=#__codelineno-52-67></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-52-68 name=__codelineno-52-68 href=#__codelineno-52-68></a>
<a id=__codelineno-52-69 name=__codelineno-52-69 href=#__codelineno-52-69></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-52-70 name=__codelineno-52-70 href=#__codelineno-52-70></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;获取Pv详情成功&quot;</span><span class=p>,</span>
<a id=__codelineno-52-71 name=__codelineno-52-71 href=#__codelineno-52-71></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=nx>data</span><span class=p>,</span>
<a id=__codelineno-52-72 name=__codelineno-52-72 href=#__codelineno-52-72></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-52-73 name=__codelineno-52-73 href=#__codelineno-52-73></a><span class=p>}</span>
<a id=__codelineno-52-74 name=__codelineno-52-74 href=#__codelineno-52-74></a>
<a id=__codelineno-52-75 name=__codelineno-52-75 href=#__codelineno-52-75></a><span class=c1>// DeletePv 删除pv</span>
<a id=__codelineno-52-76 name=__codelineno-52-76 href=#__codelineno-52-76></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=o>*</span><span class=nx>pv</span><span class=p>)</span><span class=w> </span><span class=nx>DeletePv</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-52-77 name=__codelineno-52-77 href=#__codelineno-52-77></a><span class=w>    </span><span class=nx>params</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-52-78 name=__codelineno-52-78 href=#__codelineno-52-78></a><span class=w>        </span><span class=nx>PvName</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;pv_name&quot;`</span>
<a id=__codelineno-52-79 name=__codelineno-52-79 href=#__codelineno-52-79></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-52-80 name=__codelineno-52-80 href=#__codelineno-52-80></a><span class=w>    </span><span class=c1>//DELETE请求，绑定参数方法改为ctx.ShouldBindJSON</span>
<a id=__codelineno-52-81 name=__codelineno-52-81 href=#__codelineno-52-81></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>ShouldBindJSON</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-52-82 name=__codelineno-52-82 href=#__codelineno-52-82></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-52-83 name=__codelineno-52-83 href=#__codelineno-52-83></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-52-84 name=__codelineno-52-84 href=#__codelineno-52-84></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-52-85 name=__codelineno-52-85 href=#__codelineno-52-85></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-52-86 name=__codelineno-52-86 href=#__codelineno-52-86></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-52-87 name=__codelineno-52-87 href=#__codelineno-52-87></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-52-88 name=__codelineno-52-88 href=#__codelineno-52-88></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-52-89 name=__codelineno-52-89 href=#__codelineno-52-89></a>
<a id=__codelineno-52-90 name=__codelineno-52-90 href=#__codelineno-52-90></a><span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>Pv</span><span class=p>.</span><span class=nx>DeletePv</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>PvName</span><span class=p>)</span>
<a id=__codelineno-52-91 name=__codelineno-52-91 href=#__codelineno-52-91></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-52-92 name=__codelineno-52-92 href=#__codelineno-52-92></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-52-93 name=__codelineno-52-93 href=#__codelineno-52-93></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-52-94 name=__codelineno-52-94 href=#__codelineno-52-94></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-52-95 name=__codelineno-52-95 href=#__codelineno-52-95></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-52-96 name=__codelineno-52-96 href=#__codelineno-52-96></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-52-97 name=__codelineno-52-97 href=#__codelineno-52-97></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-52-98 name=__codelineno-52-98 href=#__codelineno-52-98></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-52-99 name=__codelineno-52-99 href=#__codelineno-52-99></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;删除Pv成功&quot;</span><span class=p>,</span>
<a id=__codelineno-52-100 name=__codelineno-52-100 href=#__codelineno-52-100></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-52-101 name=__codelineno-52-101 href=#__codelineno-52-101></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-52-102 name=__codelineno-52-102 href=#__codelineno-52-102></a><span class=p>}</span>
</code></pre></div> <h3 id=4-负载均衡>4. 负载均衡<a class=headerlink href=#4-负载均衡 title="Permanent link">&para;</a></h3> <h4 id=41-service>4.1 Service<a class=headerlink href=#41-service title="Permanent link">&para;</a></h4> <table> <thead> <tr> <th>功能</th> <th>是否实现</th> </tr> </thead> <tbody> <tr> <td>Service 列表</td> <td>√</td> </tr> <tr> <td>获取Service详情</td> <td>√</td> </tr> <tr> <td>创建Service</td> <td>√</td> </tr> <tr> <td>删除Service</td> <td>√</td> </tr> <tr> <td>更新Service</td> <td>√</td> </tr> </tbody> </table> <h5 id=servicedataselectorgo_6>service/dataselector.go<a class=headerlink href=#servicedataselectorgo_6 title="Permanent link">&para;</a></h5> <div class=highlight><pre><span></span><code><a id=__codelineno-53-1 name=__codelineno-53-1 href=#__codelineno-53-1></a><span class=c1>// 实现 Service 的 DataCell接口</span>
<a id=__codelineno-53-2 name=__codelineno-53-2 href=#__codelineno-53-2></a><span class=kd>type</span><span class=w> </span><span class=nx>serviceCell</span><span class=w> </span><span class=nx>corev1</span><span class=p>.</span><span class=nx>Service</span><span class=w> </span><span class=c1>//corev1 &quot;k8s.io/api/core/v1&quot;</span>
<a id=__codelineno-53-3 name=__codelineno-53-3 href=#__codelineno-53-3></a>
<a id=__codelineno-53-4 name=__codelineno-53-4 href=#__codelineno-53-4></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>s</span><span class=w> </span><span class=nx>serviceCell</span><span class=p>)</span><span class=w> </span><span class=nx>GetCreation</span><span class=p>()</span><span class=w> </span><span class=nx>time</span><span class=p>.</span><span class=nx>Time</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-53-5 name=__codelineno-53-5 href=#__codelineno-53-5></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>s</span><span class=p>.</span><span class=nx>CreationTimestamp</span><span class=p>.</span><span class=nx>Time</span>
<a id=__codelineno-53-6 name=__codelineno-53-6 href=#__codelineno-53-6></a><span class=p>}</span>
<a id=__codelineno-53-7 name=__codelineno-53-7 href=#__codelineno-53-7></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>s</span><span class=w> </span><span class=nx>serviceCell</span><span class=p>)</span><span class=w> </span><span class=nx>GetName</span><span class=p>()</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-53-8 name=__codelineno-53-8 href=#__codelineno-53-8></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>s</span><span class=p>.</span><span class=nx>Name</span>
<a id=__codelineno-53-9 name=__codelineno-53-9 href=#__codelineno-53-9></a><span class=p>}</span>
</code></pre></div> <h5 id=serviceservicego>service/service.go<a class=headerlink href=#serviceservicego title="Permanent link">&para;</a></h5> <div class=highlight><pre><span></span><code><a id=__codelineno-54-1 name=__codelineno-54-1 href=#__codelineno-54-1></a><span class=kn>package</span><span class=w> </span><span class=nx>service</span>
<a id=__codelineno-54-2 name=__codelineno-54-2 href=#__codelineno-54-2></a>
<a id=__codelineno-54-3 name=__codelineno-54-3 href=#__codelineno-54-3></a><span class=kn>import</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-54-4 name=__codelineno-54-4 href=#__codelineno-54-4></a><span class=w>    </span><span class=s>&quot;context&quot;</span>
<a id=__codelineno-54-5 name=__codelineno-54-5 href=#__codelineno-54-5></a><span class=w>    </span><span class=s>&quot;encoding/json&quot;</span>
<a id=__codelineno-54-6 name=__codelineno-54-6 href=#__codelineno-54-6></a><span class=w>    </span><span class=s>&quot;errors&quot;</span>
<a id=__codelineno-54-7 name=__codelineno-54-7 href=#__codelineno-54-7></a>
<a id=__codelineno-54-8 name=__codelineno-54-8 href=#__codelineno-54-8></a><span class=w>    </span><span class=s>&quot;github.com/wonderivan/logger&quot;</span>
<a id=__codelineno-54-9 name=__codelineno-54-9 href=#__codelineno-54-9></a><span class=w>    </span><span class=nx>corev1</span><span class=w> </span><span class=s>&quot;k8s.io/api/core/v1&quot;</span>
<a id=__codelineno-54-10 name=__codelineno-54-10 href=#__codelineno-54-10></a><span class=w>    </span><span class=nx>metav1</span><span class=w> </span><span class=s>&quot;k8s.io/apimachinery/pkg/apis/meta/v1&quot;</span>
<a id=__codelineno-54-11 name=__codelineno-54-11 href=#__codelineno-54-11></a><span class=w>    </span><span class=s>&quot;k8s.io/apimachinery/pkg/util/intstr&quot;</span>
<a id=__codelineno-54-12 name=__codelineno-54-12 href=#__codelineno-54-12></a><span class=p>)</span>
<a id=__codelineno-54-13 name=__codelineno-54-13 href=#__codelineno-54-13></a>
<a id=__codelineno-54-14 name=__codelineno-54-14 href=#__codelineno-54-14></a><span class=kd>var</span><span class=w> </span><span class=nx>Service</span><span class=w> </span><span class=nx>service</span>
<a id=__codelineno-54-15 name=__codelineno-54-15 href=#__codelineno-54-15></a>
<a id=__codelineno-54-16 name=__codelineno-54-16 href=#__codelineno-54-16></a><span class=kd>type</span><span class=w> </span><span class=nx>service</span><span class=w> </span><span class=kd>struct</span><span class=p>{}</span>
<a id=__codelineno-54-17 name=__codelineno-54-17 href=#__codelineno-54-17></a>
<a id=__codelineno-54-18 name=__codelineno-54-18 href=#__codelineno-54-18></a><span class=c1>// ServicesResp 定义列表的返回内容，Items是Services元素列表，Total为Services元素数量</span>
<a id=__codelineno-54-19 name=__codelineno-54-19 href=#__codelineno-54-19></a><span class=kd>type</span><span class=w> </span><span class=nx>ServicesResp</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-54-20 name=__codelineno-54-20 href=#__codelineno-54-20></a><span class=w>    </span><span class=nx>Items</span><span class=w> </span><span class=p>[]</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>Service</span><span class=w> </span><span class=s>`json:&quot;items&quot;`</span>
<a id=__codelineno-54-21 name=__codelineno-54-21 href=#__codelineno-54-21></a><span class=w>    </span><span class=nx>Total</span><span class=w> </span><span class=kt>int</span><span class=w>              </span><span class=s>`json:&quot;total&quot;`</span>
<a id=__codelineno-54-22 name=__codelineno-54-22 href=#__codelineno-54-22></a><span class=p>}</span>
<a id=__codelineno-54-23 name=__codelineno-54-23 href=#__codelineno-54-23></a>
<a id=__codelineno-54-24 name=__codelineno-54-24 href=#__codelineno-54-24></a><span class=c1>// ServicesNp 定义ServicesNp类型，用于返回namespace中service的数量</span>
<a id=__codelineno-54-25 name=__codelineno-54-25 href=#__codelineno-54-25></a><span class=kd>type</span><span class=w> </span><span class=nx>ServicesNp</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-54-26 name=__codelineno-54-26 href=#__codelineno-54-26></a><span class=w>    </span><span class=nx>Namespace</span><span class=w>  </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;namespace&quot;`</span>
<a id=__codelineno-54-27 name=__codelineno-54-27 href=#__codelineno-54-27></a><span class=w>    </span><span class=nx>ServiceNum</span><span class=w> </span><span class=kt>int</span><span class=w>    </span><span class=s>`json:&quot;service_num&quot;`</span>
<a id=__codelineno-54-28 name=__codelineno-54-28 href=#__codelineno-54-28></a><span class=p>}</span>
<a id=__codelineno-54-29 name=__codelineno-54-29 href=#__codelineno-54-29></a>
<a id=__codelineno-54-30 name=__codelineno-54-30 href=#__codelineno-54-30></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>s</span><span class=w> </span><span class=o>*</span><span class=nx>service</span><span class=p>)</span><span class=w> </span><span class=nx>toCells</span><span class=p>(</span><span class=nx>std</span><span class=w> </span><span class=p>[]</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>Service</span><span class=p>)</span><span class=w> </span><span class=p>[]</span><span class=nx>DataCell</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-54-31 name=__codelineno-54-31 href=#__codelineno-54-31></a><span class=w>    </span><span class=nx>cells</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>make</span><span class=p>([]</span><span class=nx>DataCell</span><span class=p>,</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>std</span><span class=p>))</span>
<a id=__codelineno-54-32 name=__codelineno-54-32 href=#__codelineno-54-32></a><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=nx>i</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>std</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-54-33 name=__codelineno-54-33 href=#__codelineno-54-33></a><span class=w>        </span><span class=nx>cells</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>serviceCell</span><span class=p>(</span><span class=nx>std</span><span class=p>[</span><span class=nx>i</span><span class=p>])</span>
<a id=__codelineno-54-34 name=__codelineno-54-34 href=#__codelineno-54-34></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-54-35 name=__codelineno-54-35 href=#__codelineno-54-35></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>cells</span>
<a id=__codelineno-54-36 name=__codelineno-54-36 href=#__codelineno-54-36></a><span class=p>}</span>
<a id=__codelineno-54-37 name=__codelineno-54-37 href=#__codelineno-54-37></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>s</span><span class=w> </span><span class=o>*</span><span class=nx>service</span><span class=p>)</span><span class=w> </span><span class=nx>fromCells</span><span class=p>(</span><span class=nx>cells</span><span class=w> </span><span class=p>[]</span><span class=nx>DataCell</span><span class=p>)</span><span class=w> </span><span class=p>[]</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>Service</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-54-38 name=__codelineno-54-38 href=#__codelineno-54-38></a><span class=w>    </span><span class=nx>services</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>make</span><span class=p>([]</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>Service</span><span class=p>,</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>cells</span><span class=p>))</span>
<a id=__codelineno-54-39 name=__codelineno-54-39 href=#__codelineno-54-39></a><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=nx>i</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>cells</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-54-40 name=__codelineno-54-40 href=#__codelineno-54-40></a><span class=w>        </span><span class=nx>services</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>corev1</span><span class=p>.</span><span class=nx>Service</span><span class=p>(</span><span class=nx>cells</span><span class=p>[</span><span class=nx>i</span><span class=p>].(</span><span class=nx>serviceCell</span><span class=p>))</span>
<a id=__codelineno-54-41 name=__codelineno-54-41 href=#__codelineno-54-41></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-54-42 name=__codelineno-54-42 href=#__codelineno-54-42></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>services</span>
<a id=__codelineno-54-43 name=__codelineno-54-43 href=#__codelineno-54-43></a><span class=p>}</span>
<a id=__codelineno-54-44 name=__codelineno-54-44 href=#__codelineno-54-44></a>
<a id=__codelineno-54-45 name=__codelineno-54-45 href=#__codelineno-54-45></a><span class=c1>// ServiceCreate 定义ServiceCreate结构体，用于创建service需要的参数属性的定义</span>
<a id=__codelineno-54-46 name=__codelineno-54-46 href=#__codelineno-54-46></a><span class=kd>type</span><span class=w> </span><span class=nx>ServiceCreate</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-54-47 name=__codelineno-54-47 href=#__codelineno-54-47></a><span class=w>    </span><span class=nx>Name</span><span class=w>          </span><span class=kt>string</span><span class=w>            </span><span class=s>`json:&quot;name&quot;`</span>
<a id=__codelineno-54-48 name=__codelineno-54-48 href=#__codelineno-54-48></a><span class=w>    </span><span class=nx>Namespace</span><span class=w>     </span><span class=kt>string</span><span class=w>            </span><span class=s>`json:&quot;namespace&quot;`</span>
<a id=__codelineno-54-49 name=__codelineno-54-49 href=#__codelineno-54-49></a><span class=w>    </span><span class=nx>Type</span><span class=w>          </span><span class=kt>string</span><span class=w>            </span><span class=s>`json:&quot;type&quot;`</span>
<a id=__codelineno-54-50 name=__codelineno-54-50 href=#__codelineno-54-50></a><span class=w>    </span><span class=nx>ContainerPort</span><span class=w> </span><span class=kt>int32</span><span class=w>             </span><span class=s>`json:&quot;container_port&quot;`</span>
<a id=__codelineno-54-51 name=__codelineno-54-51 href=#__codelineno-54-51></a><span class=w>    </span><span class=nx>Port</span><span class=w>          </span><span class=kt>int32</span><span class=w>             </span><span class=s>`json:&quot;port&quot;`</span>
<a id=__codelineno-54-52 name=__codelineno-54-52 href=#__codelineno-54-52></a><span class=w>    </span><span class=nx>NodePort</span><span class=w>      </span><span class=kt>int32</span><span class=w>             </span><span class=s>`json:&quot;node_port&quot;`</span>
<a id=__codelineno-54-53 name=__codelineno-54-53 href=#__codelineno-54-53></a><span class=w>    </span><span class=nx>Label</span><span class=w>         </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;label&quot;`</span>
<a id=__codelineno-54-54 name=__codelineno-54-54 href=#__codelineno-54-54></a><span class=p>}</span>
<a id=__codelineno-54-55 name=__codelineno-54-55 href=#__codelineno-54-55></a>
<a id=__codelineno-54-56 name=__codelineno-54-56 href=#__codelineno-54-56></a><span class=c1>// GetServices 获取service列表，支持过滤、排序、分页</span>
<a id=__codelineno-54-57 name=__codelineno-54-57 href=#__codelineno-54-57></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>s</span><span class=w> </span><span class=o>*</span><span class=nx>service</span><span class=p>)</span><span class=w> </span><span class=nx>GetServices</span><span class=p>(</span><span class=nx>filterName</span><span class=p>,</span><span class=w> </span><span class=nx>namespace</span><span class=w> </span><span class=kt>string</span><span class=p>,</span><span class=w> </span><span class=nx>limit</span><span class=p>,</span><span class=w> </span><span class=nx>page</span><span class=w> </span><span class=kt>int</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>servicesResp</span><span class=w> </span><span class=o>*</span><span class=nx>ServicesResp</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-54-58 name=__codelineno-54-58 href=#__codelineno-54-58></a><span class=w>    </span><span class=c1>//获取serviceList类型的service列表</span>
<a id=__codelineno-54-59 name=__codelineno-54-59 href=#__codelineno-54-59></a><span class=w>    </span><span class=nx>serviceList</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>CoreV1</span><span class=p>().</span><span class=nx>Services</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span><span class=nx>List</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>ListOptions</span><span class=p>{})</span>
<a id=__codelineno-54-60 name=__codelineno-54-60 href=#__codelineno-54-60></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-54-61 name=__codelineno-54-61 href=#__codelineno-54-61></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取Service列表失败,&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-54-62 name=__codelineno-54-62 href=#__codelineno-54-62></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取Service列表失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-54-63 name=__codelineno-54-63 href=#__codelineno-54-63></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-54-64 name=__codelineno-54-64 href=#__codelineno-54-64></a><span class=w>    </span><span class=c1>//将serviceList中的service列表（Item），放进dataselector对象中，进行排序</span>
<a id=__codelineno-54-65 name=__codelineno-54-65 href=#__codelineno-54-65></a><span class=w>    </span><span class=nx>selectableData</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>dataSelector</span><span class=p>{</span>
<a id=__codelineno-54-66 name=__codelineno-54-66 href=#__codelineno-54-66></a><span class=w>        </span><span class=nx>GenericDataList</span><span class=p>:</span><span class=w> </span><span class=nx>s</span><span class=p>.</span><span class=nx>toCells</span><span class=p>(</span><span class=nx>serviceList</span><span class=p>.</span><span class=nx>Items</span><span class=p>),</span>
<a id=__codelineno-54-67 name=__codelineno-54-67 href=#__codelineno-54-67></a><span class=w>        </span><span class=nx>dataSelectQuery</span><span class=p>:</span><span class=w> </span><span class=o>&amp;</span><span class=nx>DataSelectQuery</span><span class=p>{</span>
<a id=__codelineno-54-68 name=__codelineno-54-68 href=#__codelineno-54-68></a><span class=w>            </span><span class=nx>FilterQuery</span><span class=p>:</span><span class=w> </span><span class=o>&amp;</span><span class=nx>FilterQuery</span><span class=p>{</span><span class=nx>Name</span><span class=p>:</span><span class=w> </span><span class=nx>filterName</span><span class=p>},</span>
<a id=__codelineno-54-69 name=__codelineno-54-69 href=#__codelineno-54-69></a><span class=w>            </span><span class=nx>PaginateQuery</span><span class=p>:</span><span class=w> </span><span class=o>&amp;</span><span class=nx>PaginateQuery</span><span class=p>{</span>
<a id=__codelineno-54-70 name=__codelineno-54-70 href=#__codelineno-54-70></a><span class=w>                </span><span class=nx>Limit</span><span class=p>:</span><span class=w> </span><span class=nx>limit</span><span class=p>,</span>
<a id=__codelineno-54-71 name=__codelineno-54-71 href=#__codelineno-54-71></a><span class=w>                </span><span class=nx>Page</span><span class=p>:</span><span class=w>  </span><span class=nx>page</span><span class=p>,</span>
<a id=__codelineno-54-72 name=__codelineno-54-72 href=#__codelineno-54-72></a><span class=w>            </span><span class=p>},</span>
<a id=__codelineno-54-73 name=__codelineno-54-73 href=#__codelineno-54-73></a><span class=w>        </span><span class=p>},</span>
<a id=__codelineno-54-74 name=__codelineno-54-74 href=#__codelineno-54-74></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-54-75 name=__codelineno-54-75 href=#__codelineno-54-75></a><span class=w>    </span><span class=nx>filtered</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>selectableData</span><span class=p>.</span><span class=nx>Filter</span><span class=p>()</span>
<a id=__codelineno-54-76 name=__codelineno-54-76 href=#__codelineno-54-76></a><span class=w>    </span><span class=nx>total</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>filtered</span><span class=p>.</span><span class=nx>GenericDataList</span><span class=p>)</span>
<a id=__codelineno-54-77 name=__codelineno-54-77 href=#__codelineno-54-77></a><span class=w>    </span><span class=nx>data</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>filtered</span><span class=p>.</span><span class=nx>Sort</span><span class=p>().</span><span class=nx>Paginate</span><span class=p>()</span>
<a id=__codelineno-54-78 name=__codelineno-54-78 href=#__codelineno-54-78></a><span class=w>    </span><span class=c1>//将[]DataCell类型的service列表转为v1.service列表</span>
<a id=__codelineno-54-79 name=__codelineno-54-79 href=#__codelineno-54-79></a><span class=w>    </span><span class=nx>services</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>s</span><span class=p>.</span><span class=nx>fromCells</span><span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>GenericDataList</span><span class=p>)</span>
<a id=__codelineno-54-80 name=__codelineno-54-80 href=#__codelineno-54-80></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=o>&amp;</span><span class=nx>ServicesResp</span><span class=p>{</span>
<a id=__codelineno-54-81 name=__codelineno-54-81 href=#__codelineno-54-81></a><span class=w>        </span><span class=nx>Items</span><span class=p>:</span><span class=w> </span><span class=nx>services</span><span class=p>,</span>
<a id=__codelineno-54-82 name=__codelineno-54-82 href=#__codelineno-54-82></a><span class=w>        </span><span class=nx>Total</span><span class=p>:</span><span class=w> </span><span class=nx>total</span><span class=p>,</span>
<a id=__codelineno-54-83 name=__codelineno-54-83 href=#__codelineno-54-83></a><span class=w>    </span><span class=p>},</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-54-84 name=__codelineno-54-84 href=#__codelineno-54-84></a><span class=p>}</span>
<a id=__codelineno-54-85 name=__codelineno-54-85 href=#__codelineno-54-85></a>
<a id=__codelineno-54-86 name=__codelineno-54-86 href=#__codelineno-54-86></a><span class=c1>// GetServiceDetail 获取service详情</span>
<a id=__codelineno-54-87 name=__codelineno-54-87 href=#__codelineno-54-87></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>s</span><span class=w> </span><span class=o>*</span><span class=nx>service</span><span class=p>)</span><span class=w> </span><span class=nx>GetServiceDetail</span><span class=p>(</span><span class=nx>serviceName</span><span class=p>,</span><span class=w> </span><span class=nx>namespace</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>service</span><span class=w> </span><span class=o>*</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>Service</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-54-88 name=__codelineno-54-88 href=#__codelineno-54-88></a><span class=w>    </span><span class=nx>service</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>CoreV1</span><span class=p>().</span><span class=nx>Services</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span><span class=nx>Get</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>serviceName</span><span class=p>,</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>GetOptions</span><span class=p>{})</span>
<a id=__codelineno-54-89 name=__codelineno-54-89 href=#__codelineno-54-89></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-54-90 name=__codelineno-54-90 href=#__codelineno-54-90></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取Service详情失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-54-91 name=__codelineno-54-91 href=#__codelineno-54-91></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取Service详情失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-54-92 name=__codelineno-54-92 href=#__codelineno-54-92></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-54-93 name=__codelineno-54-93 href=#__codelineno-54-93></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>service</span><span class=p>,</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-54-94 name=__codelineno-54-94 href=#__codelineno-54-94></a><span class=p>}</span>
<a id=__codelineno-54-95 name=__codelineno-54-95 href=#__codelineno-54-95></a>
<a id=__codelineno-54-96 name=__codelineno-54-96 href=#__codelineno-54-96></a><span class=c1>// CreateService 创建service，接收ServiceCreate对象</span>
<a id=__codelineno-54-97 name=__codelineno-54-97 href=#__codelineno-54-97></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>s</span><span class=w> </span><span class=o>*</span><span class=nx>service</span><span class=p>)</span><span class=w> </span><span class=nx>CreateService</span><span class=p>(</span><span class=nx>data</span><span class=w> </span><span class=o>*</span><span class=nx>ServiceCreate</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-54-98 name=__codelineno-54-98 href=#__codelineno-54-98></a><span class=w>    </span><span class=c1>//将data中的数据组装成corev1.Service对象</span>
<a id=__codelineno-54-99 name=__codelineno-54-99 href=#__codelineno-54-99></a><span class=w>    </span><span class=nx>service</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>Service</span><span class=p>{</span>
<a id=__codelineno-54-100 name=__codelineno-54-100 href=#__codelineno-54-100></a><span class=w>        </span><span class=c1>//ObjectMeta中定义资源名、命名空间以及标签</span>
<a id=__codelineno-54-101 name=__codelineno-54-101 href=#__codelineno-54-101></a><span class=w>        </span><span class=nx>ObjectMeta</span><span class=p>:</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>ObjectMeta</span><span class=p>{</span>
<a id=__codelineno-54-102 name=__codelineno-54-102 href=#__codelineno-54-102></a><span class=w>            </span><span class=nx>Name</span><span class=p>:</span><span class=w>      </span><span class=nx>data</span><span class=p>.</span><span class=nx>Name</span><span class=p>,</span>
<a id=__codelineno-54-103 name=__codelineno-54-103 href=#__codelineno-54-103></a><span class=w>            </span><span class=nx>Namespace</span><span class=p>:</span><span class=w> </span><span class=nx>data</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>,</span>
<a id=__codelineno-54-104 name=__codelineno-54-104 href=#__codelineno-54-104></a><span class=w>            </span><span class=nx>Labels</span><span class=p>:</span><span class=w>    </span><span class=nx>data</span><span class=p>.</span><span class=nx>Label</span><span class=p>,</span>
<a id=__codelineno-54-105 name=__codelineno-54-105 href=#__codelineno-54-105></a><span class=w>        </span><span class=p>},</span>
<a id=__codelineno-54-106 name=__codelineno-54-106 href=#__codelineno-54-106></a><span class=w>        </span><span class=c1>//Spec中定义类型，端口，选择器</span>
<a id=__codelineno-54-107 name=__codelineno-54-107 href=#__codelineno-54-107></a><span class=w>        </span><span class=nx>Spec</span><span class=p>:</span><span class=w> </span><span class=nx>corev1</span><span class=p>.</span><span class=nx>ServiceSpec</span><span class=p>{</span>
<a id=__codelineno-54-108 name=__codelineno-54-108 href=#__codelineno-54-108></a><span class=w>            </span><span class=nx>Type</span><span class=p>:</span><span class=w> </span><span class=nx>corev1</span><span class=p>.</span><span class=nx>ServiceType</span><span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>Type</span><span class=p>),</span>
<a id=__codelineno-54-109 name=__codelineno-54-109 href=#__codelineno-54-109></a><span class=w>            </span><span class=nx>Ports</span><span class=p>:</span><span class=w> </span><span class=p>[]</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>ServicePort</span><span class=p>{</span>
<a id=__codelineno-54-110 name=__codelineno-54-110 href=#__codelineno-54-110></a><span class=w>                </span><span class=p>{</span>
<a id=__codelineno-54-111 name=__codelineno-54-111 href=#__codelineno-54-111></a><span class=w>                    </span><span class=nx>Name</span><span class=p>:</span><span class=w>     </span><span class=s>&quot;http&quot;</span><span class=p>,</span>
<a id=__codelineno-54-112 name=__codelineno-54-112 href=#__codelineno-54-112></a><span class=w>                    </span><span class=nx>Port</span><span class=p>:</span><span class=w>     </span><span class=nx>data</span><span class=p>.</span><span class=nx>Port</span><span class=p>,</span>
<a id=__codelineno-54-113 name=__codelineno-54-113 href=#__codelineno-54-113></a><span class=w>                    </span><span class=nx>Protocol</span><span class=p>:</span><span class=w> </span><span class=s>&quot;TCP&quot;</span><span class=p>,</span>
<a id=__codelineno-54-114 name=__codelineno-54-114 href=#__codelineno-54-114></a><span class=w>                    </span><span class=nx>TargetPort</span><span class=p>:</span><span class=w> </span><span class=nx>intstr</span><span class=p>.</span><span class=nx>IntOrString</span><span class=p>{</span>
<a id=__codelineno-54-115 name=__codelineno-54-115 href=#__codelineno-54-115></a><span class=w>                        </span><span class=nx>Type</span><span class=p>:</span><span class=w>   </span><span class=mi>0</span><span class=p>,</span>
<a id=__codelineno-54-116 name=__codelineno-54-116 href=#__codelineno-54-116></a><span class=w>                        </span><span class=nx>IntVal</span><span class=p>:</span><span class=w> </span><span class=nx>data</span><span class=p>.</span><span class=nx>ContainerPort</span><span class=p>,</span>
<a id=__codelineno-54-117 name=__codelineno-54-117 href=#__codelineno-54-117></a><span class=w>                    </span><span class=p>},</span>
<a id=__codelineno-54-118 name=__codelineno-54-118 href=#__codelineno-54-118></a><span class=w>                </span><span class=p>},</span>
<a id=__codelineno-54-119 name=__codelineno-54-119 href=#__codelineno-54-119></a><span class=w>            </span><span class=p>},</span>
<a id=__codelineno-54-120 name=__codelineno-54-120 href=#__codelineno-54-120></a><span class=w>            </span><span class=nx>Selector</span><span class=p>:</span><span class=w> </span><span class=nx>data</span><span class=p>.</span><span class=nx>Label</span><span class=p>,</span>
<a id=__codelineno-54-121 name=__codelineno-54-121 href=#__codelineno-54-121></a><span class=w>        </span><span class=p>},</span>
<a id=__codelineno-54-122 name=__codelineno-54-122 href=#__codelineno-54-122></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-54-123 name=__codelineno-54-123 href=#__codelineno-54-123></a><span class=w>    </span><span class=c1>//默认ClusterIP,这里是判断NodePort，添加配置</span>
<a id=__codelineno-54-124 name=__codelineno-54-124 href=#__codelineno-54-124></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>data</span><span class=p>.</span><span class=nx>NodePort</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nx>data</span><span class=p>.</span><span class=nx>Type</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&quot;NodePort&quot;</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-54-125 name=__codelineno-54-125 href=#__codelineno-54-125></a><span class=w>        </span><span class=nx>service</span><span class=p>.</span><span class=nx>Spec</span><span class=p>.</span><span class=nx>Ports</span><span class=p>[</span><span class=mi>0</span><span class=p>].</span><span class=nx>NodePort</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>data</span><span class=p>.</span><span class=nx>NodePort</span>
<a id=__codelineno-54-126 name=__codelineno-54-126 href=#__codelineno-54-126></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-54-127 name=__codelineno-54-127 href=#__codelineno-54-127></a><span class=w>    </span><span class=c1>//创建Service</span>
<a id=__codelineno-54-128 name=__codelineno-54-128 href=#__codelineno-54-128></a><span class=w>    </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>CoreV1</span><span class=p>().</span><span class=nx>Services</span><span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>).</span><span class=nx>Create</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>service</span><span class=p>,</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>CreateOptions</span><span class=p>{})</span>
<a id=__codelineno-54-129 name=__codelineno-54-129 href=#__codelineno-54-129></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-54-130 name=__codelineno-54-130 href=#__codelineno-54-130></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;创建Service失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-54-131 name=__codelineno-54-131 href=#__codelineno-54-131></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;创建Service失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-54-132 name=__codelineno-54-132 href=#__codelineno-54-132></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-54-133 name=__codelineno-54-133 href=#__codelineno-54-133></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-54-134 name=__codelineno-54-134 href=#__codelineno-54-134></a><span class=p>}</span>
<a id=__codelineno-54-135 name=__codelineno-54-135 href=#__codelineno-54-135></a>
<a id=__codelineno-54-136 name=__codelineno-54-136 href=#__codelineno-54-136></a><span class=c1>// DeleteService 删除service</span>
<a id=__codelineno-54-137 name=__codelineno-54-137 href=#__codelineno-54-137></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>s</span><span class=w> </span><span class=o>*</span><span class=nx>service</span><span class=p>)</span><span class=w> </span><span class=nx>DeleteService</span><span class=p>(</span><span class=nx>serviceName</span><span class=p>,</span><span class=w> </span><span class=nx>namespace</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-54-138 name=__codelineno-54-138 href=#__codelineno-54-138></a><span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>CoreV1</span><span class=p>().</span><span class=nx>Services</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span><span class=nx>Delete</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>serviceName</span><span class=p>,</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>DeleteOptions</span><span class=p>{})</span>
<a id=__codelineno-54-139 name=__codelineno-54-139 href=#__codelineno-54-139></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-54-140 name=__codelineno-54-140 href=#__codelineno-54-140></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;删除Service失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-54-141 name=__codelineno-54-141 href=#__codelineno-54-141></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;删除Service失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-54-142 name=__codelineno-54-142 href=#__codelineno-54-142></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-54-143 name=__codelineno-54-143 href=#__codelineno-54-143></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-54-144 name=__codelineno-54-144 href=#__codelineno-54-144></a><span class=p>}</span>
<a id=__codelineno-54-145 name=__codelineno-54-145 href=#__codelineno-54-145></a>
<a id=__codelineno-54-146 name=__codelineno-54-146 href=#__codelineno-54-146></a><span class=c1>// UpdateService 更新service</span>
<a id=__codelineno-54-147 name=__codelineno-54-147 href=#__codelineno-54-147></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>s</span><span class=w> </span><span class=o>*</span><span class=nx>service</span><span class=p>)</span><span class=w> </span><span class=nx>UpdateService</span><span class=p>(</span><span class=nx>namespace</span><span class=p>,</span><span class=w> </span><span class=nx>content</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-54-148 name=__codelineno-54-148 href=#__codelineno-54-148></a><span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=nx>service</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>Service</span><span class=p>{}</span>
<a id=__codelineno-54-149 name=__codelineno-54-149 href=#__codelineno-54-149></a><span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>json</span><span class=p>.</span><span class=nx>Unmarshal</span><span class=p>([]</span><span class=nb>byte</span><span class=p>(</span><span class=nx>content</span><span class=p>),</span><span class=w> </span><span class=nx>service</span><span class=p>)</span>
<a id=__codelineno-54-150 name=__codelineno-54-150 href=#__codelineno-54-150></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-54-151 name=__codelineno-54-151 href=#__codelineno-54-151></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;反序列化失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-54-152 name=__codelineno-54-152 href=#__codelineno-54-152></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;反序列化失败,&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-54-153 name=__codelineno-54-153 href=#__codelineno-54-153></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-54-154 name=__codelineno-54-154 href=#__codelineno-54-154></a><span class=w>    </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>CoreV1</span><span class=p>().</span><span class=nx>Services</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span><span class=nx>Update</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>service</span><span class=p>,</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>UpdateOptions</span><span class=p>{})</span>
<a id=__codelineno-54-155 name=__codelineno-54-155 href=#__codelineno-54-155></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-54-156 name=__codelineno-54-156 href=#__codelineno-54-156></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;更新service失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-54-157 name=__codelineno-54-157 href=#__codelineno-54-157></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;更新service失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-54-158 name=__codelineno-54-158 href=#__codelineno-54-158></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-54-159 name=__codelineno-54-159 href=#__codelineno-54-159></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-54-160 name=__codelineno-54-160 href=#__codelineno-54-160></a><span class=p>}</span>
</code></pre></div> <p>对标</p> <div class=highlight><pre><span></span><code><a id=__codelineno-55-1 name=__codelineno-55-1 href=#__codelineno-55-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span><span class=w> </span>
<a id=__codelineno-55-2 name=__codelineno-55-2 href=#__codelineno-55-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Service</span><span class=w> </span>
<a id=__codelineno-55-3 name=__codelineno-55-3 href=#__codelineno-55-3></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-55-4 name=__codelineno-55-4 href=#__codelineno-55-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">myapp-svc</span><span class=w> </span>
<a id=__codelineno-55-5 name=__codelineno-55-5 href=#__codelineno-55-5></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">default</span><span class=w> </span>
<a id=__codelineno-55-6 name=__codelineno-55-6 href=#__codelineno-55-6></a><span class=nt>spec</span><span class=p>:</span><span class=w> </span>
<a id=__codelineno-55-7 name=__codelineno-55-7 href=#__codelineno-55-7></a><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w> </span>
<a id=__codelineno-55-8 name=__codelineno-55-8 href=#__codelineno-55-8></a><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span><span class=w> </span>
<a id=__codelineno-55-9 name=__codelineno-55-9 href=#__codelineno-55-9></a><span class=w>  </span><span class=nt>ports</span><span class=p>:</span>
<a id=__codelineno-55-10 name=__codelineno-55-10 href=#__codelineno-55-10></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">http</span><span class=w> </span>
<a id=__codelineno-55-11 name=__codelineno-55-11 href=#__codelineno-55-11></a><span class=w>    </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">80</span><span class=w> </span><span class=c1>#service的端口</span>
<a id=__codelineno-55-12 name=__codelineno-55-12 href=#__codelineno-55-12></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">protocol：tcp</span><span class=w> </span><span class=c1>#协议</span>
<a id=__codelineno-55-13 name=__codelineno-55-13 href=#__codelineno-55-13></a><span class=w>    </span><span class=nt>targetPort</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">80</span><span class=w> </span><span class=c1>#pod的端口</span>
</code></pre></div> <h5 id=controllerservicego>controller/service.go<a class=headerlink href=#controllerservicego title="Permanent link">&para;</a></h5> <div class=highlight><pre><span></span><code><a id=__codelineno-56-1 name=__codelineno-56-1 href=#__codelineno-56-1></a><span class=kn>package</span><span class=w> </span><span class=nx>controller</span>
<a id=__codelineno-56-2 name=__codelineno-56-2 href=#__codelineno-56-2></a>
<a id=__codelineno-56-3 name=__codelineno-56-3 href=#__codelineno-56-3></a><span class=kn>import</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-56-4 name=__codelineno-56-4 href=#__codelineno-56-4></a><span class=w>    </span><span class=s>&quot;gitee.com/hujianli94net/k8s-platform/service&quot;</span>
<a id=__codelineno-56-5 name=__codelineno-56-5 href=#__codelineno-56-5></a><span class=w>    </span><span class=s>&quot;net/http&quot;</span>
<a id=__codelineno-56-6 name=__codelineno-56-6 href=#__codelineno-56-6></a>
<a id=__codelineno-56-7 name=__codelineno-56-7 href=#__codelineno-56-7></a><span class=w>    </span><span class=s>&quot;github.com/gin-gonic/gin&quot;</span>
<a id=__codelineno-56-8 name=__codelineno-56-8 href=#__codelineno-56-8></a><span class=w>    </span><span class=s>&quot;github.com/wonderivan/logger&quot;</span>
<a id=__codelineno-56-9 name=__codelineno-56-9 href=#__codelineno-56-9></a><span class=p>)</span>
<a id=__codelineno-56-10 name=__codelineno-56-10 href=#__codelineno-56-10></a>
<a id=__codelineno-56-11 name=__codelineno-56-11 href=#__codelineno-56-11></a><span class=kd>var</span><span class=w> </span><span class=nx>Servicev1</span><span class=w> </span><span class=nx>servicev1</span>
<a id=__codelineno-56-12 name=__codelineno-56-12 href=#__codelineno-56-12></a>
<a id=__codelineno-56-13 name=__codelineno-56-13 href=#__codelineno-56-13></a><span class=kd>type</span><span class=w> </span><span class=nx>servicev1</span><span class=w> </span><span class=kd>struct</span><span class=p>{}</span>
<a id=__codelineno-56-14 name=__codelineno-56-14 href=#__codelineno-56-14></a>
<a id=__codelineno-56-15 name=__codelineno-56-15 href=#__codelineno-56-15></a><span class=c1>// GetServices 获取service列表，支持过滤、排序、分页</span>
<a id=__codelineno-56-16 name=__codelineno-56-16 href=#__codelineno-56-16></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>s</span><span class=w> </span><span class=o>*</span><span class=nx>servicev1</span><span class=p>)</span><span class=w> </span><span class=nx>GetServices</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-56-17 name=__codelineno-56-17 href=#__codelineno-56-17></a><span class=w>    </span><span class=nx>params</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-56-18 name=__codelineno-56-18 href=#__codelineno-56-18></a><span class=w>        </span><span class=nx>FilterName</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`form:&quot;filter_name&quot;`</span>
<a id=__codelineno-56-19 name=__codelineno-56-19 href=#__codelineno-56-19></a><span class=w>        </span><span class=nx>Namespace</span><span class=w>  </span><span class=kt>string</span><span class=w> </span><span class=s>`form:&quot;namespace&quot;`</span>
<a id=__codelineno-56-20 name=__codelineno-56-20 href=#__codelineno-56-20></a><span class=w>        </span><span class=nx>Page</span><span class=w>       </span><span class=kt>int</span><span class=w>    </span><span class=s>`form:&quot;page&quot;`</span>
<a id=__codelineno-56-21 name=__codelineno-56-21 href=#__codelineno-56-21></a><span class=w>        </span><span class=nx>Limit</span><span class=w>      </span><span class=kt>int</span><span class=w>    </span><span class=s>`form:&quot;limit&quot;`</span>
<a id=__codelineno-56-22 name=__codelineno-56-22 href=#__codelineno-56-22></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-56-23 name=__codelineno-56-23 href=#__codelineno-56-23></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>Bind</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-56-24 name=__codelineno-56-24 href=#__codelineno-56-24></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-56-25 name=__codelineno-56-25 href=#__codelineno-56-25></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-56-26 name=__codelineno-56-26 href=#__codelineno-56-26></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-56-27 name=__codelineno-56-27 href=#__codelineno-56-27></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-56-28 name=__codelineno-56-28 href=#__codelineno-56-28></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-56-29 name=__codelineno-56-29 href=#__codelineno-56-29></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-56-30 name=__codelineno-56-30 href=#__codelineno-56-30></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-56-31 name=__codelineno-56-31 href=#__codelineno-56-31></a>
<a id=__codelineno-56-32 name=__codelineno-56-32 href=#__codelineno-56-32></a><span class=w>    </span><span class=nx>data</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>Service</span><span class=p>.</span><span class=nx>GetServices</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>FilterName</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Limit</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Page</span><span class=p>)</span>
<a id=__codelineno-56-33 name=__codelineno-56-33 href=#__codelineno-56-33></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-56-34 name=__codelineno-56-34 href=#__codelineno-56-34></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-56-35 name=__codelineno-56-35 href=#__codelineno-56-35></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-56-36 name=__codelineno-56-36 href=#__codelineno-56-36></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-56-37 name=__codelineno-56-37 href=#__codelineno-56-37></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-56-38 name=__codelineno-56-38 href=#__codelineno-56-38></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-56-39 name=__codelineno-56-39 href=#__codelineno-56-39></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-56-40 name=__codelineno-56-40 href=#__codelineno-56-40></a>
<a id=__codelineno-56-41 name=__codelineno-56-41 href=#__codelineno-56-41></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-56-42 name=__codelineno-56-42 href=#__codelineno-56-42></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;获取Servicet列表成功&quot;</span><span class=p>,</span>
<a id=__codelineno-56-43 name=__codelineno-56-43 href=#__codelineno-56-43></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=nx>data</span><span class=p>,</span>
<a id=__codelineno-56-44 name=__codelineno-56-44 href=#__codelineno-56-44></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-56-45 name=__codelineno-56-45 href=#__codelineno-56-45></a><span class=p>}</span>
<a id=__codelineno-56-46 name=__codelineno-56-46 href=#__codelineno-56-46></a>
<a id=__codelineno-56-47 name=__codelineno-56-47 href=#__codelineno-56-47></a><span class=c1>// GetServiceDetail 获取service详情</span>
<a id=__codelineno-56-48 name=__codelineno-56-48 href=#__codelineno-56-48></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>s</span><span class=w> </span><span class=o>*</span><span class=nx>servicev1</span><span class=p>)</span><span class=w> </span><span class=nx>GetServiceDetail</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-56-49 name=__codelineno-56-49 href=#__codelineno-56-49></a><span class=w>    </span><span class=nx>params</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-56-50 name=__codelineno-56-50 href=#__codelineno-56-50></a><span class=w>        </span><span class=nx>ServiceName</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`form:&quot;service_name&quot;`</span>
<a id=__codelineno-56-51 name=__codelineno-56-51 href=#__codelineno-56-51></a><span class=w>        </span><span class=nx>Namespace</span><span class=w>   </span><span class=kt>string</span><span class=w> </span><span class=s>`form:&quot;namespace&quot;`</span>
<a id=__codelineno-56-52 name=__codelineno-56-52 href=#__codelineno-56-52></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-56-53 name=__codelineno-56-53 href=#__codelineno-56-53></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>Bind</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-56-54 name=__codelineno-56-54 href=#__codelineno-56-54></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-56-55 name=__codelineno-56-55 href=#__codelineno-56-55></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-56-56 name=__codelineno-56-56 href=#__codelineno-56-56></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-56-57 name=__codelineno-56-57 href=#__codelineno-56-57></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-56-58 name=__codelineno-56-58 href=#__codelineno-56-58></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-56-59 name=__codelineno-56-59 href=#__codelineno-56-59></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-56-60 name=__codelineno-56-60 href=#__codelineno-56-60></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-56-61 name=__codelineno-56-61 href=#__codelineno-56-61></a>
<a id=__codelineno-56-62 name=__codelineno-56-62 href=#__codelineno-56-62></a><span class=w>    </span><span class=nx>data</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>Service</span><span class=p>.</span><span class=nx>GetServiceDetail</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>ServiceName</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>)</span>
<a id=__codelineno-56-63 name=__codelineno-56-63 href=#__codelineno-56-63></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-56-64 name=__codelineno-56-64 href=#__codelineno-56-64></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-56-65 name=__codelineno-56-65 href=#__codelineno-56-65></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-56-66 name=__codelineno-56-66 href=#__codelineno-56-66></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-56-67 name=__codelineno-56-67 href=#__codelineno-56-67></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-56-68 name=__codelineno-56-68 href=#__codelineno-56-68></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-56-69 name=__codelineno-56-69 href=#__codelineno-56-69></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-56-70 name=__codelineno-56-70 href=#__codelineno-56-70></a>
<a id=__codelineno-56-71 name=__codelineno-56-71 href=#__codelineno-56-71></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-56-72 name=__codelineno-56-72 href=#__codelineno-56-72></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;获取Service详情成功&quot;</span><span class=p>,</span>
<a id=__codelineno-56-73 name=__codelineno-56-73 href=#__codelineno-56-73></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=nx>data</span><span class=p>,</span>
<a id=__codelineno-56-74 name=__codelineno-56-74 href=#__codelineno-56-74></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-56-75 name=__codelineno-56-75 href=#__codelineno-56-75></a><span class=p>}</span>
<a id=__codelineno-56-76 name=__codelineno-56-76 href=#__codelineno-56-76></a>
<a id=__codelineno-56-77 name=__codelineno-56-77 href=#__codelineno-56-77></a><span class=c1>// CreateService 创建service</span>
<a id=__codelineno-56-78 name=__codelineno-56-78 href=#__codelineno-56-78></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>s</span><span class=w> </span><span class=o>*</span><span class=nx>servicev1</span><span class=p>)</span><span class=w> </span><span class=nx>CreateService</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-56-79 name=__codelineno-56-79 href=#__codelineno-56-79></a><span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-56-80 name=__codelineno-56-80 href=#__codelineno-56-80></a><span class=w>        </span><span class=nx>serviceCreate</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=nx>service</span><span class=p>.</span><span class=nx>ServiceCreate</span><span class=p>)</span>
<a id=__codelineno-56-81 name=__codelineno-56-81 href=#__codelineno-56-81></a><span class=w>        </span><span class=nx>err</span><span class=w>           </span><span class=kt>error</span>
<a id=__codelineno-56-82 name=__codelineno-56-82 href=#__codelineno-56-82></a><span class=w>    </span><span class=p>)</span>
<a id=__codelineno-56-83 name=__codelineno-56-83 href=#__codelineno-56-83></a>
<a id=__codelineno-56-84 name=__codelineno-56-84 href=#__codelineno-56-84></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>ShouldBindJSON</span><span class=p>(</span><span class=nx>serviceCreate</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-56-85 name=__codelineno-56-85 href=#__codelineno-56-85></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-56-86 name=__codelineno-56-86 href=#__codelineno-56-86></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-56-87 name=__codelineno-56-87 href=#__codelineno-56-87></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-56-88 name=__codelineno-56-88 href=#__codelineno-56-88></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-56-89 name=__codelineno-56-89 href=#__codelineno-56-89></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-56-90 name=__codelineno-56-90 href=#__codelineno-56-90></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-56-91 name=__codelineno-56-91 href=#__codelineno-56-91></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-56-92 name=__codelineno-56-92 href=#__codelineno-56-92></a>
<a id=__codelineno-56-93 name=__codelineno-56-93 href=#__codelineno-56-93></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>Service</span><span class=p>.</span><span class=nx>CreateService</span><span class=p>(</span><span class=nx>serviceCreate</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-56-94 name=__codelineno-56-94 href=#__codelineno-56-94></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-56-95 name=__codelineno-56-95 href=#__codelineno-56-95></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-56-96 name=__codelineno-56-96 href=#__codelineno-56-96></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-56-97 name=__codelineno-56-97 href=#__codelineno-56-97></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-56-98 name=__codelineno-56-98 href=#__codelineno-56-98></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-56-99 name=__codelineno-56-99 href=#__codelineno-56-99></a>
<a id=__codelineno-56-100 name=__codelineno-56-100 href=#__codelineno-56-100></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-56-101 name=__codelineno-56-101 href=#__codelineno-56-101></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;创建Service成功&quot;</span><span class=p>,</span>
<a id=__codelineno-56-102 name=__codelineno-56-102 href=#__codelineno-56-102></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-56-103 name=__codelineno-56-103 href=#__codelineno-56-103></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-56-104 name=__codelineno-56-104 href=#__codelineno-56-104></a><span class=p>}</span>
<a id=__codelineno-56-105 name=__codelineno-56-105 href=#__codelineno-56-105></a>
<a id=__codelineno-56-106 name=__codelineno-56-106 href=#__codelineno-56-106></a><span class=c1>// DeleteService 删除service</span>
<a id=__codelineno-56-107 name=__codelineno-56-107 href=#__codelineno-56-107></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>s</span><span class=w> </span><span class=o>*</span><span class=nx>servicev1</span><span class=p>)</span><span class=w> </span><span class=nx>DeleteService</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-56-108 name=__codelineno-56-108 href=#__codelineno-56-108></a><span class=w>    </span><span class=nx>params</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-56-109 name=__codelineno-56-109 href=#__codelineno-56-109></a><span class=w>        </span><span class=nx>ServiceName</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;service_name&quot;`</span>
<a id=__codelineno-56-110 name=__codelineno-56-110 href=#__codelineno-56-110></a><span class=w>        </span><span class=nx>Namespace</span><span class=w>   </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;namespace&quot;`</span>
<a id=__codelineno-56-111 name=__codelineno-56-111 href=#__codelineno-56-111></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-56-112 name=__codelineno-56-112 href=#__codelineno-56-112></a><span class=w>    </span><span class=c1>//DELETE请求，绑定参数方法改为ctx.ShouldBindJSON</span>
<a id=__codelineno-56-113 name=__codelineno-56-113 href=#__codelineno-56-113></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>ShouldBindJSON</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-56-114 name=__codelineno-56-114 href=#__codelineno-56-114></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-56-115 name=__codelineno-56-115 href=#__codelineno-56-115></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-56-116 name=__codelineno-56-116 href=#__codelineno-56-116></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-56-117 name=__codelineno-56-117 href=#__codelineno-56-117></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-56-118 name=__codelineno-56-118 href=#__codelineno-56-118></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-56-119 name=__codelineno-56-119 href=#__codelineno-56-119></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-56-120 name=__codelineno-56-120 href=#__codelineno-56-120></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-56-121 name=__codelineno-56-121 href=#__codelineno-56-121></a>
<a id=__codelineno-56-122 name=__codelineno-56-122 href=#__codelineno-56-122></a><span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>Service</span><span class=p>.</span><span class=nx>DeleteService</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>ServiceName</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>)</span>
<a id=__codelineno-56-123 name=__codelineno-56-123 href=#__codelineno-56-123></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-56-124 name=__codelineno-56-124 href=#__codelineno-56-124></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-56-125 name=__codelineno-56-125 href=#__codelineno-56-125></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-56-126 name=__codelineno-56-126 href=#__codelineno-56-126></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-56-127 name=__codelineno-56-127 href=#__codelineno-56-127></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-56-128 name=__codelineno-56-128 href=#__codelineno-56-128></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-56-129 name=__codelineno-56-129 href=#__codelineno-56-129></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-56-130 name=__codelineno-56-130 href=#__codelineno-56-130></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-56-131 name=__codelineno-56-131 href=#__codelineno-56-131></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;删除Service成功&quot;</span><span class=p>,</span>
<a id=__codelineno-56-132 name=__codelineno-56-132 href=#__codelineno-56-132></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-56-133 name=__codelineno-56-133 href=#__codelineno-56-133></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-56-134 name=__codelineno-56-134 href=#__codelineno-56-134></a><span class=p>}</span>
<a id=__codelineno-56-135 name=__codelineno-56-135 href=#__codelineno-56-135></a>
<a id=__codelineno-56-136 name=__codelineno-56-136 href=#__codelineno-56-136></a><span class=c1>// UpdateService 更新service</span>
<a id=__codelineno-56-137 name=__codelineno-56-137 href=#__codelineno-56-137></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>s</span><span class=w> </span><span class=o>*</span><span class=nx>servicev1</span><span class=p>)</span><span class=w> </span><span class=nx>UpdateService</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-56-138 name=__codelineno-56-138 href=#__codelineno-56-138></a><span class=w>    </span><span class=nx>params</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-56-139 name=__codelineno-56-139 href=#__codelineno-56-139></a><span class=w>        </span><span class=nx>Namespace</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;namespace&quot;`</span>
<a id=__codelineno-56-140 name=__codelineno-56-140 href=#__codelineno-56-140></a><span class=w>        </span><span class=nx>Content</span><span class=w>   </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;content&quot;`</span>
<a id=__codelineno-56-141 name=__codelineno-56-141 href=#__codelineno-56-141></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-56-142 name=__codelineno-56-142 href=#__codelineno-56-142></a><span class=w>    </span><span class=c1>//PUT请求，绑定参数方法改为ctx.ShouldBindJSON</span>
<a id=__codelineno-56-143 name=__codelineno-56-143 href=#__codelineno-56-143></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>ShouldBindJSON</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-56-144 name=__codelineno-56-144 href=#__codelineno-56-144></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-56-145 name=__codelineno-56-145 href=#__codelineno-56-145></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-56-146 name=__codelineno-56-146 href=#__codelineno-56-146></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-56-147 name=__codelineno-56-147 href=#__codelineno-56-147></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-56-148 name=__codelineno-56-148 href=#__codelineno-56-148></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-56-149 name=__codelineno-56-149 href=#__codelineno-56-149></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-56-150 name=__codelineno-56-150 href=#__codelineno-56-150></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-56-151 name=__codelineno-56-151 href=#__codelineno-56-151></a>
<a id=__codelineno-56-152 name=__codelineno-56-152 href=#__codelineno-56-152></a><span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>Service</span><span class=p>.</span><span class=nx>UpdateService</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Content</span><span class=p>)</span>
<a id=__codelineno-56-153 name=__codelineno-56-153 href=#__codelineno-56-153></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-56-154 name=__codelineno-56-154 href=#__codelineno-56-154></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-56-155 name=__codelineno-56-155 href=#__codelineno-56-155></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-56-156 name=__codelineno-56-156 href=#__codelineno-56-156></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-56-157 name=__codelineno-56-157 href=#__codelineno-56-157></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-56-158 name=__codelineno-56-158 href=#__codelineno-56-158></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-56-159 name=__codelineno-56-159 href=#__codelineno-56-159></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-56-160 name=__codelineno-56-160 href=#__codelineno-56-160></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-56-161 name=__codelineno-56-161 href=#__codelineno-56-161></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;更新Service成功&quot;</span><span class=p>,</span>
<a id=__codelineno-56-162 name=__codelineno-56-162 href=#__codelineno-56-162></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-56-163 name=__codelineno-56-163 href=#__codelineno-56-163></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-56-164 name=__codelineno-56-164 href=#__codelineno-56-164></a><span class=p>}</span>
</code></pre></div> <h4 id=42-ingress>4.2 Ingress<a class=headerlink href=#42-ingress title="Permanent link">&para;</a></h4> <table> <thead> <tr> <th>功能</th> <th>是否实现</th> </tr> </thead> <tbody> <tr> <td>Ingress 列表</td> <td>√</td> </tr> <tr> <td>获取Ingress详情</td> <td>√</td> </tr> <tr> <td>创建Ingress</td> <td>√</td> </tr> <tr> <td>删除Ingress</td> <td>√</td> </tr> <tr> <td>更新Ingress</td> <td>√</td> </tr> </tbody> </table> <h5 id=servicedataselectorgo_7>service/dataselector.go<a class=headerlink href=#servicedataselectorgo_7 title="Permanent link">&para;</a></h5> <div class=highlight><pre><span></span><code><a id=__codelineno-57-1 name=__codelineno-57-1 href=#__codelineno-57-1></a><span class=kn>import</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-57-2 name=__codelineno-57-2 href=#__codelineno-57-2></a><span class=w>    </span><span class=nx>appsv1</span><span class=w> </span><span class=s>&quot;k8s.io/api/apps/v1&quot;</span>
<a id=__codelineno-57-3 name=__codelineno-57-3 href=#__codelineno-57-3></a><span class=w>    </span><span class=nx>corev1</span><span class=w> </span><span class=s>&quot;k8s.io/api/core/v1&quot;</span>
<a id=__codelineno-57-4 name=__codelineno-57-4 href=#__codelineno-57-4></a><span class=w>    </span><span class=nx>nwv1</span><span class=w> </span><span class=s>&quot;k8s.io/api/networking/v1&quot;</span>
<a id=__codelineno-57-5 name=__codelineno-57-5 href=#__codelineno-57-5></a><span class=w>    </span><span class=s>&quot;sort&quot;</span>
<a id=__codelineno-57-6 name=__codelineno-57-6 href=#__codelineno-57-6></a><span class=w>    </span><span class=s>&quot;strings&quot;</span>
<a id=__codelineno-57-7 name=__codelineno-57-7 href=#__codelineno-57-7></a><span class=w>    </span><span class=s>&quot;time&quot;</span>
<a id=__codelineno-57-8 name=__codelineno-57-8 href=#__codelineno-57-8></a><span class=p>)</span>
<a id=__codelineno-57-9 name=__codelineno-57-9 href=#__codelineno-57-9></a>
<a id=__codelineno-57-10 name=__codelineno-57-10 href=#__codelineno-57-10></a><span class=c1>// 实现 Ingress 的 DataCell接口</span>
<a id=__codelineno-57-11 name=__codelineno-57-11 href=#__codelineno-57-11></a><span class=kd>type</span><span class=w> </span><span class=nx>ingressCell</span><span class=w> </span><span class=nx>nwv1</span><span class=p>.</span><span class=nx>Ingress</span><span class=w> </span><span class=c1>//nwv1 &quot;k8s.io/api/networking/v1&quot;</span>
<a id=__codelineno-57-12 name=__codelineno-57-12 href=#__codelineno-57-12></a>
<a id=__codelineno-57-13 name=__codelineno-57-13 href=#__codelineno-57-13></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>i</span><span class=w> </span><span class=nx>ingressCell</span><span class=p>)</span><span class=w> </span><span class=nx>GetCreation</span><span class=p>()</span><span class=w> </span><span class=nx>time</span><span class=p>.</span><span class=nx>Time</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-57-14 name=__codelineno-57-14 href=#__codelineno-57-14></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>i</span><span class=p>.</span><span class=nx>CreationTimestamp</span><span class=p>.</span><span class=nx>Time</span>
<a id=__codelineno-57-15 name=__codelineno-57-15 href=#__codelineno-57-15></a><span class=p>}</span>
<a id=__codelineno-57-16 name=__codelineno-57-16 href=#__codelineno-57-16></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>i</span><span class=w> </span><span class=nx>ingressCell</span><span class=p>)</span><span class=w> </span><span class=nx>GetName</span><span class=p>()</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-57-17 name=__codelineno-57-17 href=#__codelineno-57-17></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>i</span><span class=p>.</span><span class=nx>Name</span>
<a id=__codelineno-57-18 name=__codelineno-57-18 href=#__codelineno-57-18></a><span class=p>}</span>
</code></pre></div> <p>创建Ingress</p> <h5 id=serviceingressgo>service/ingress.go<a class=headerlink href=#serviceingressgo title="Permanent link">&para;</a></h5> <div class=highlight><pre><span></span><code><a id=__codelineno-58-1 name=__codelineno-58-1 href=#__codelineno-58-1></a><span class=kn>package</span><span class=w> </span><span class=nx>service</span>
<a id=__codelineno-58-2 name=__codelineno-58-2 href=#__codelineno-58-2></a>
<a id=__codelineno-58-3 name=__codelineno-58-3 href=#__codelineno-58-3></a><span class=kn>import</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-58-4 name=__codelineno-58-4 href=#__codelineno-58-4></a><span class=w>    </span><span class=s>&quot;context&quot;</span>
<a id=__codelineno-58-5 name=__codelineno-58-5 href=#__codelineno-58-5></a><span class=w>    </span><span class=s>&quot;encoding/json&quot;</span>
<a id=__codelineno-58-6 name=__codelineno-58-6 href=#__codelineno-58-6></a><span class=w>    </span><span class=s>&quot;errors&quot;</span>
<a id=__codelineno-58-7 name=__codelineno-58-7 href=#__codelineno-58-7></a>
<a id=__codelineno-58-8 name=__codelineno-58-8 href=#__codelineno-58-8></a><span class=w>    </span><span class=nx>nwv1</span><span class=w> </span><span class=s>&quot;k8s.io/api/networking/v1&quot;</span>
<a id=__codelineno-58-9 name=__codelineno-58-9 href=#__codelineno-58-9></a>
<a id=__codelineno-58-10 name=__codelineno-58-10 href=#__codelineno-58-10></a><span class=w>    </span><span class=s>&quot;github.com/wonderivan/logger&quot;</span>
<a id=__codelineno-58-11 name=__codelineno-58-11 href=#__codelineno-58-11></a><span class=w>    </span><span class=nx>metav1</span><span class=w> </span><span class=s>&quot;k8s.io/apimachinery/pkg/apis/meta/v1&quot;</span>
<a id=__codelineno-58-12 name=__codelineno-58-12 href=#__codelineno-58-12></a><span class=p>)</span>
<a id=__codelineno-58-13 name=__codelineno-58-13 href=#__codelineno-58-13></a>
<a id=__codelineno-58-14 name=__codelineno-58-14 href=#__codelineno-58-14></a><span class=kd>var</span><span class=w> </span><span class=nx>Ingress</span><span class=w> </span><span class=nx>ingress</span>
<a id=__codelineno-58-15 name=__codelineno-58-15 href=#__codelineno-58-15></a>
<a id=__codelineno-58-16 name=__codelineno-58-16 href=#__codelineno-58-16></a><span class=kd>type</span><span class=w> </span><span class=nx>ingress</span><span class=w> </span><span class=kd>struct</span><span class=p>{}</span>
<a id=__codelineno-58-17 name=__codelineno-58-17 href=#__codelineno-58-17></a>
<a id=__codelineno-58-18 name=__codelineno-58-18 href=#__codelineno-58-18></a><span class=c1>// IngressesResp 定义列表的返回内容，Items是ingress元素列表，Total为ingress元素数量</span>
<a id=__codelineno-58-19 name=__codelineno-58-19 href=#__codelineno-58-19></a><span class=kd>type</span><span class=w> </span><span class=nx>IngressesResp</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-58-20 name=__codelineno-58-20 href=#__codelineno-58-20></a><span class=w>    </span><span class=nx>Items</span><span class=w> </span><span class=p>[]</span><span class=nx>nwv1</span><span class=p>.</span><span class=nx>Ingress</span><span class=w> </span><span class=s>`json:&quot;items&quot;`</span>
<a id=__codelineno-58-21 name=__codelineno-58-21 href=#__codelineno-58-21></a><span class=w>    </span><span class=nx>Total</span><span class=w> </span><span class=kt>int</span><span class=w>            </span><span class=s>`json:&quot;total&quot;`</span>
<a id=__codelineno-58-22 name=__codelineno-58-22 href=#__codelineno-58-22></a><span class=p>}</span>
<a id=__codelineno-58-23 name=__codelineno-58-23 href=#__codelineno-58-23></a>
<a id=__codelineno-58-24 name=__codelineno-58-24 href=#__codelineno-58-24></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>s</span><span class=w> </span><span class=o>*</span><span class=nx>ingress</span><span class=p>)</span><span class=w> </span><span class=nx>toCells</span><span class=p>(</span><span class=nx>std</span><span class=w> </span><span class=p>[]</span><span class=nx>nwv1</span><span class=p>.</span><span class=nx>Ingress</span><span class=p>)</span><span class=w> </span><span class=p>[]</span><span class=nx>DataCell</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-58-25 name=__codelineno-58-25 href=#__codelineno-58-25></a><span class=w>    </span><span class=nx>cells</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>make</span><span class=p>([]</span><span class=nx>DataCell</span><span class=p>,</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>std</span><span class=p>))</span>
<a id=__codelineno-58-26 name=__codelineno-58-26 href=#__codelineno-58-26></a><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=nx>i</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>std</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-58-27 name=__codelineno-58-27 href=#__codelineno-58-27></a><span class=w>        </span><span class=nx>cells</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>ingressCell</span><span class=p>(</span><span class=nx>std</span><span class=p>[</span><span class=nx>i</span><span class=p>])</span>
<a id=__codelineno-58-28 name=__codelineno-58-28 href=#__codelineno-58-28></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-58-29 name=__codelineno-58-29 href=#__codelineno-58-29></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>cells</span>
<a id=__codelineno-58-30 name=__codelineno-58-30 href=#__codelineno-58-30></a><span class=p>}</span>
<a id=__codelineno-58-31 name=__codelineno-58-31 href=#__codelineno-58-31></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>s</span><span class=w> </span><span class=o>*</span><span class=nx>ingress</span><span class=p>)</span><span class=w> </span><span class=nx>fromCells</span><span class=p>(</span><span class=nx>cells</span><span class=w> </span><span class=p>[]</span><span class=nx>DataCell</span><span class=p>)</span><span class=w> </span><span class=p>[]</span><span class=nx>nwv1</span><span class=p>.</span><span class=nx>Ingress</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-58-32 name=__codelineno-58-32 href=#__codelineno-58-32></a><span class=w>    </span><span class=nx>ingresses</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>make</span><span class=p>([]</span><span class=nx>nwv1</span><span class=p>.</span><span class=nx>Ingress</span><span class=p>,</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>cells</span><span class=p>))</span>
<a id=__codelineno-58-33 name=__codelineno-58-33 href=#__codelineno-58-33></a><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=nx>i</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>cells</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-58-34 name=__codelineno-58-34 href=#__codelineno-58-34></a><span class=w>        </span><span class=nx>ingresses</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>nwv1</span><span class=p>.</span><span class=nx>Ingress</span><span class=p>(</span><span class=nx>cells</span><span class=p>[</span><span class=nx>i</span><span class=p>].(</span><span class=nx>ingressCell</span><span class=p>))</span>
<a id=__codelineno-58-35 name=__codelineno-58-35 href=#__codelineno-58-35></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-58-36 name=__codelineno-58-36 href=#__codelineno-58-36></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>ingresses</span>
<a id=__codelineno-58-37 name=__codelineno-58-37 href=#__codelineno-58-37></a><span class=p>}</span>
<a id=__codelineno-58-38 name=__codelineno-58-38 href=#__codelineno-58-38></a>
<a id=__codelineno-58-39 name=__codelineno-58-39 href=#__codelineno-58-39></a><span class=c1>// HttpPath 定义ingress的path结构体</span>
<a id=__codelineno-58-40 name=__codelineno-58-40 href=#__codelineno-58-40></a><span class=kd>type</span><span class=w> </span><span class=nx>HttpPath</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-58-41 name=__codelineno-58-41 href=#__codelineno-58-41></a><span class=w>    </span><span class=nx>Path</span><span class=w>        </span><span class=kt>string</span><span class=w>        </span><span class=s>`json:&quot;path&quot;`</span>
<a id=__codelineno-58-42 name=__codelineno-58-42 href=#__codelineno-58-42></a><span class=w>    </span><span class=nx>PathType</span><span class=w>    </span><span class=nx>nwv1</span><span class=p>.</span><span class=nx>PathType</span><span class=w> </span><span class=s>`json:&quot;path_type&quot;`</span>
<a id=__codelineno-58-43 name=__codelineno-58-43 href=#__codelineno-58-43></a><span class=w>    </span><span class=nx>ServiceName</span><span class=w> </span><span class=kt>string</span><span class=w>        </span><span class=s>`json:&quot;service_name&quot;`</span>
<a id=__codelineno-58-44 name=__codelineno-58-44 href=#__codelineno-58-44></a><span class=w>    </span><span class=nx>ServicePort</span><span class=w> </span><span class=kt>int32</span><span class=w>         </span><span class=s>`json:&quot;service_port&quot;`</span>
<a id=__codelineno-58-45 name=__codelineno-58-45 href=#__codelineno-58-45></a><span class=p>}</span>
<a id=__codelineno-58-46 name=__codelineno-58-46 href=#__codelineno-58-46></a>
<a id=__codelineno-58-47 name=__codelineno-58-47 href=#__codelineno-58-47></a><span class=c1>// IngressCreate 定义IngressCreate结构体，用于创建ingress需要的参数属性的定义</span>
<a id=__codelineno-58-48 name=__codelineno-58-48 href=#__codelineno-58-48></a><span class=kd>type</span><span class=w> </span><span class=nx>IngressCreate</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-58-49 name=__codelineno-58-49 href=#__codelineno-58-49></a><span class=w>    </span><span class=nx>Name</span><span class=w>      </span><span class=kt>string</span><span class=w>                 </span><span class=s>`json:&quot;name&quot;`</span>
<a id=__codelineno-58-50 name=__codelineno-58-50 href=#__codelineno-58-50></a><span class=w>    </span><span class=nx>Namespace</span><span class=w> </span><span class=kt>string</span><span class=w>                 </span><span class=s>`json:&quot;namespace&quot;`</span>
<a id=__codelineno-58-51 name=__codelineno-58-51 href=#__codelineno-58-51></a><span class=w>    </span><span class=nx>Label</span><span class=w>     </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>string</span><span class=w>      </span><span class=s>`json:&quot;label&quot;`</span>
<a id=__codelineno-58-52 name=__codelineno-58-52 href=#__codelineno-58-52></a><span class=w>    </span><span class=nx>Hosts</span><span class=w>     </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>][]</span><span class=o>*</span><span class=nx>HttpPath</span><span class=w> </span><span class=s>`json:&quot;hosts&quot;`</span>
<a id=__codelineno-58-53 name=__codelineno-58-53 href=#__codelineno-58-53></a><span class=p>}</span>
<a id=__codelineno-58-54 name=__codelineno-58-54 href=#__codelineno-58-54></a>
<a id=__codelineno-58-55 name=__codelineno-58-55 href=#__codelineno-58-55></a><span class=c1>// GetIngresses 获取ingress列表，支持过滤、排序、分页</span>
<a id=__codelineno-58-56 name=__codelineno-58-56 href=#__codelineno-58-56></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>i</span><span class=w> </span><span class=o>*</span><span class=nx>ingress</span><span class=p>)</span><span class=w> </span><span class=nx>GetIngresses</span><span class=p>(</span><span class=nx>filterName</span><span class=p>,</span><span class=w> </span><span class=nx>namespace</span><span class=w> </span><span class=kt>string</span><span class=p>,</span><span class=w> </span><span class=nx>limit</span><span class=p>,</span><span class=w> </span><span class=nx>page</span><span class=w> </span><span class=kt>int</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>ingressesResp</span><span class=w> </span><span class=o>*</span><span class=nx>IngressesResp</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-58-57 name=__codelineno-58-57 href=#__codelineno-58-57></a><span class=w>    </span><span class=c1>//获取ingressList类型的ingress列表</span>
<a id=__codelineno-58-58 name=__codelineno-58-58 href=#__codelineno-58-58></a><span class=w>    </span><span class=nx>ingressList</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>NetworkingV1</span><span class=p>().</span><span class=nx>Ingresses</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span><span class=nx>List</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>ListOptions</span><span class=p>{})</span>
<a id=__codelineno-58-59 name=__codelineno-58-59 href=#__codelineno-58-59></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-58-60 name=__codelineno-58-60 href=#__codelineno-58-60></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取Ingress列表失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-58-61 name=__codelineno-58-61 href=#__codelineno-58-61></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取Ingress列表失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-58-62 name=__codelineno-58-62 href=#__codelineno-58-62></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-58-63 name=__codelineno-58-63 href=#__codelineno-58-63></a><span class=w>    </span><span class=c1>//将ingressList中的ingress列表（Items），放进dataselector对象中，进行排序</span>
<a id=__codelineno-58-64 name=__codelineno-58-64 href=#__codelineno-58-64></a><span class=w>    </span><span class=nx>selectableData</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>dataSelector</span><span class=p>{</span>
<a id=__codelineno-58-65 name=__codelineno-58-65 href=#__codelineno-58-65></a><span class=w>        </span><span class=nx>GenericDataList</span><span class=p>:</span><span class=w> </span><span class=nx>i</span><span class=p>.</span><span class=nx>toCells</span><span class=p>(</span><span class=nx>ingressList</span><span class=p>.</span><span class=nx>Items</span><span class=p>),</span>
<a id=__codelineno-58-66 name=__codelineno-58-66 href=#__codelineno-58-66></a><span class=w>        </span><span class=nx>dataSelectQuery</span><span class=p>:</span><span class=w> </span><span class=o>&amp;</span><span class=nx>DataSelectQuery</span><span class=p>{</span>
<a id=__codelineno-58-67 name=__codelineno-58-67 href=#__codelineno-58-67></a><span class=w>            </span><span class=nx>FilterQuery</span><span class=p>:</span><span class=w> </span><span class=o>&amp;</span><span class=nx>FilterQuery</span><span class=p>{</span>
<a id=__codelineno-58-68 name=__codelineno-58-68 href=#__codelineno-58-68></a><span class=w>                </span><span class=nx>Name</span><span class=p>:</span><span class=w> </span><span class=nx>filterName</span><span class=p>,</span>
<a id=__codelineno-58-69 name=__codelineno-58-69 href=#__codelineno-58-69></a><span class=w>            </span><span class=p>},</span>
<a id=__codelineno-58-70 name=__codelineno-58-70 href=#__codelineno-58-70></a><span class=w>            </span><span class=nx>PaginateQuery</span><span class=p>:</span><span class=w> </span><span class=o>&amp;</span><span class=nx>PaginateQuery</span><span class=p>{</span>
<a id=__codelineno-58-71 name=__codelineno-58-71 href=#__codelineno-58-71></a><span class=w>                </span><span class=nx>Limit</span><span class=p>:</span><span class=w> </span><span class=nx>limit</span><span class=p>,</span>
<a id=__codelineno-58-72 name=__codelineno-58-72 href=#__codelineno-58-72></a><span class=w>                </span><span class=nx>Page</span><span class=p>:</span><span class=w>  </span><span class=nx>page</span><span class=p>,</span>
<a id=__codelineno-58-73 name=__codelineno-58-73 href=#__codelineno-58-73></a><span class=w>            </span><span class=p>},</span>
<a id=__codelineno-58-74 name=__codelineno-58-74 href=#__codelineno-58-74></a><span class=w>        </span><span class=p>},</span>
<a id=__codelineno-58-75 name=__codelineno-58-75 href=#__codelineno-58-75></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-58-76 name=__codelineno-58-76 href=#__codelineno-58-76></a><span class=w>    </span><span class=nx>filtered</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>selectableData</span><span class=p>.</span><span class=nx>Filter</span><span class=p>()</span>
<a id=__codelineno-58-77 name=__codelineno-58-77 href=#__codelineno-58-77></a><span class=w>    </span><span class=nx>total</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>filtered</span><span class=p>.</span><span class=nx>GenericDataList</span><span class=p>)</span>
<a id=__codelineno-58-78 name=__codelineno-58-78 href=#__codelineno-58-78></a><span class=w>    </span><span class=nx>data</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>filtered</span><span class=p>.</span><span class=nx>Sort</span><span class=p>().</span><span class=nx>Paginate</span><span class=p>()</span>
<a id=__codelineno-58-79 name=__codelineno-58-79 href=#__codelineno-58-79></a><span class=w>    </span><span class=c1>//将[]DataCell类型的ingress列表转为v1.ingress列表</span>
<a id=__codelineno-58-80 name=__codelineno-58-80 href=#__codelineno-58-80></a><span class=w>    </span><span class=nx>ingresses</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>i</span><span class=p>.</span><span class=nx>fromCells</span><span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>GenericDataList</span><span class=p>)</span>
<a id=__codelineno-58-81 name=__codelineno-58-81 href=#__codelineno-58-81></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=o>&amp;</span><span class=nx>IngressesResp</span><span class=p>{</span>
<a id=__codelineno-58-82 name=__codelineno-58-82 href=#__codelineno-58-82></a><span class=w>        </span><span class=nx>Items</span><span class=p>:</span><span class=w> </span><span class=nx>ingresses</span><span class=p>,</span>
<a id=__codelineno-58-83 name=__codelineno-58-83 href=#__codelineno-58-83></a><span class=w>        </span><span class=nx>Total</span><span class=p>:</span><span class=w> </span><span class=nx>total</span><span class=p>,</span>
<a id=__codelineno-58-84 name=__codelineno-58-84 href=#__codelineno-58-84></a><span class=w>    </span><span class=p>},</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-58-85 name=__codelineno-58-85 href=#__codelineno-58-85></a><span class=p>}</span>
<a id=__codelineno-58-86 name=__codelineno-58-86 href=#__codelineno-58-86></a>
<a id=__codelineno-58-87 name=__codelineno-58-87 href=#__codelineno-58-87></a><span class=c1>// GetIngressDetail 获取ingress详情</span>
<a id=__codelineno-58-88 name=__codelineno-58-88 href=#__codelineno-58-88></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>i</span><span class=w> </span><span class=o>*</span><span class=nx>ingress</span><span class=p>)</span><span class=w> </span><span class=nx>GetIngressDetail</span><span class=p>(</span><span class=nx>ingressName</span><span class=p>,</span><span class=w> </span><span class=nx>namespace</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>ingress</span><span class=w> </span><span class=o>*</span><span class=nx>nwv1</span><span class=p>.</span><span class=nx>Ingress</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-58-89 name=__codelineno-58-89 href=#__codelineno-58-89></a><span class=w>    </span><span class=nx>ingress</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>NetworkingV1</span><span class=p>().</span><span class=nx>Ingresses</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span><span class=nx>Get</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>ingressName</span><span class=p>,</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>GetOptions</span><span class=p>{})</span>
<a id=__codelineno-58-90 name=__codelineno-58-90 href=#__codelineno-58-90></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-58-91 name=__codelineno-58-91 href=#__codelineno-58-91></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取Ingress详情失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-58-92 name=__codelineno-58-92 href=#__codelineno-58-92></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取Ingress详情失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-58-93 name=__codelineno-58-93 href=#__codelineno-58-93></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-58-94 name=__codelineno-58-94 href=#__codelineno-58-94></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>ingress</span><span class=p>,</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-58-95 name=__codelineno-58-95 href=#__codelineno-58-95></a><span class=p>}</span>
<a id=__codelineno-58-96 name=__codelineno-58-96 href=#__codelineno-58-96></a>
<a id=__codelineno-58-97 name=__codelineno-58-97 href=#__codelineno-58-97></a><span class=c1>// CreateIngress 创建ingress，接收IngressCreate对象</span>
<a id=__codelineno-58-98 name=__codelineno-58-98 href=#__codelineno-58-98></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>i</span><span class=w> </span><span class=o>*</span><span class=nx>ingress</span><span class=p>)</span><span class=w> </span><span class=nx>CreateIngress</span><span class=p>(</span><span class=nx>data</span><span class=w> </span><span class=o>*</span><span class=nx>IngressCreate</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-58-99 name=__codelineno-58-99 href=#__codelineno-58-99></a><span class=w>    </span><span class=c1>//声明nwv1.IngressRule和nwv1.HTTPIngressPath变量，后面组装数据用到</span>
<a id=__codelineno-58-100 name=__codelineno-58-100 href=#__codelineno-58-100></a><span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=nx>ingressRules</span><span class=w> </span><span class=p>[]</span><span class=nx>nwv1</span><span class=p>.</span><span class=nx>IngressRule</span>
<a id=__codelineno-58-101 name=__codelineno-58-101 href=#__codelineno-58-101></a><span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=nx>httpIngressPATHs</span><span class=w> </span><span class=p>[]</span><span class=nx>nwv1</span><span class=p>.</span><span class=nx>HTTPIngressPath</span>
<a id=__codelineno-58-102 name=__codelineno-58-102 href=#__codelineno-58-102></a><span class=w>    </span><span class=c1>//将data中的数据组装成nwv1.Ingress对象</span>
<a id=__codelineno-58-103 name=__codelineno-58-103 href=#__codelineno-58-103></a><span class=w>    </span><span class=nx>ingress</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>nwv1</span><span class=p>.</span><span class=nx>Ingress</span><span class=p>{</span>
<a id=__codelineno-58-104 name=__codelineno-58-104 href=#__codelineno-58-104></a><span class=w>        </span><span class=c1>//ObjectMeta中定义资源名、命名空间以及标签</span>
<a id=__codelineno-58-105 name=__codelineno-58-105 href=#__codelineno-58-105></a><span class=w>        </span><span class=nx>ObjectMeta</span><span class=p>:</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>ObjectMeta</span><span class=p>{</span>
<a id=__codelineno-58-106 name=__codelineno-58-106 href=#__codelineno-58-106></a><span class=w>            </span><span class=nx>Name</span><span class=p>:</span><span class=w>      </span><span class=nx>data</span><span class=p>.</span><span class=nx>Name</span><span class=p>,</span>
<a id=__codelineno-58-107 name=__codelineno-58-107 href=#__codelineno-58-107></a><span class=w>            </span><span class=nx>Namespace</span><span class=p>:</span><span class=w> </span><span class=nx>data</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>,</span>
<a id=__codelineno-58-108 name=__codelineno-58-108 href=#__codelineno-58-108></a><span class=w>            </span><span class=nx>Labels</span><span class=p>:</span><span class=w>    </span><span class=nx>data</span><span class=p>.</span><span class=nx>Label</span><span class=p>,</span>
<a id=__codelineno-58-109 name=__codelineno-58-109 href=#__codelineno-58-109></a><span class=w>        </span><span class=p>},</span>
<a id=__codelineno-58-110 name=__codelineno-58-110 href=#__codelineno-58-110></a><span class=w>        </span><span class=nx>Status</span><span class=p>:</span><span class=w> </span><span class=nx>nwv1</span><span class=p>.</span><span class=nx>IngressStatus</span><span class=p>{},</span>
<a id=__codelineno-58-111 name=__codelineno-58-111 href=#__codelineno-58-111></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-58-112 name=__codelineno-58-112 href=#__codelineno-58-112></a><span class=w>    </span><span class=c1>//第一层for循环是将host组装成nwv1.IngressRule类型性的对象</span>
<a id=__codelineno-58-113 name=__codelineno-58-113 href=#__codelineno-58-113></a><span class=w>    </span><span class=c1>//一个host对应一个ingressrule,每个ingressrule中包含一个host和多个path</span>
<a id=__codelineno-58-114 name=__codelineno-58-114 href=#__codelineno-58-114></a><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=nx>key</span><span class=p>,</span><span class=w> </span><span class=nx>value</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>data</span><span class=p>.</span><span class=nx>Hosts</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-58-115 name=__codelineno-58-115 href=#__codelineno-58-115></a><span class=w>        </span><span class=nx>ir</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>nwv1</span><span class=p>.</span><span class=nx>IngressRule</span><span class=p>{</span>
<a id=__codelineno-58-116 name=__codelineno-58-116 href=#__codelineno-58-116></a><span class=w>            </span><span class=nx>Host</span><span class=p>:</span><span class=w> </span><span class=nx>key</span><span class=p>,</span>
<a id=__codelineno-58-117 name=__codelineno-58-117 href=#__codelineno-58-117></a><span class=w>            </span><span class=c1>//这里现将nwv1.HTTPIngressRuleValue类型中的Paths置为空，后面组装好数据再赋值</span>
<a id=__codelineno-58-118 name=__codelineno-58-118 href=#__codelineno-58-118></a><span class=w>            </span><span class=nx>IngressRuleValue</span><span class=p>:</span><span class=w> </span><span class=nx>nwv1</span><span class=p>.</span><span class=nx>IngressRuleValue</span><span class=p>{</span>
<a id=__codelineno-58-119 name=__codelineno-58-119 href=#__codelineno-58-119></a><span class=w>                </span><span class=nx>HTTP</span><span class=p>:</span><span class=w> </span><span class=o>&amp;</span><span class=nx>nwv1</span><span class=p>.</span><span class=nx>HTTPIngressRuleValue</span><span class=p>{</span><span class=nx>Paths</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>},</span>
<a id=__codelineno-58-120 name=__codelineno-58-120 href=#__codelineno-58-120></a><span class=w>            </span><span class=p>},</span>
<a id=__codelineno-58-121 name=__codelineno-58-121 href=#__codelineno-58-121></a><span class=w>        </span><span class=p>}</span>
<a id=__codelineno-58-122 name=__codelineno-58-122 href=#__codelineno-58-122></a><span class=w>        </span><span class=c1>//第二层for循环是将path组装成nwv1.HTTPIngressPath类型的对象</span>
<a id=__codelineno-58-123 name=__codelineno-58-123 href=#__codelineno-58-123></a><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>HttpPath</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>value</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-58-124 name=__codelineno-58-124 href=#__codelineno-58-124></a><span class=w>            </span><span class=nx>hip</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>nwv1</span><span class=p>.</span><span class=nx>HTTPIngressPath</span><span class=p>{</span>
<a id=__codelineno-58-125 name=__codelineno-58-125 href=#__codelineno-58-125></a><span class=w>                </span><span class=nx>Path</span><span class=p>:</span><span class=w>     </span><span class=nx>HttpPath</span><span class=p>.</span><span class=nx>Path</span><span class=p>,</span>
<a id=__codelineno-58-126 name=__codelineno-58-126 href=#__codelineno-58-126></a><span class=w>                </span><span class=nx>PathType</span><span class=p>:</span><span class=w> </span><span class=o>&amp;</span><span class=nx>HttpPath</span><span class=p>.</span><span class=nx>PathType</span><span class=p>,</span>
<a id=__codelineno-58-127 name=__codelineno-58-127 href=#__codelineno-58-127></a><span class=w>                </span><span class=nx>Backend</span><span class=p>:</span><span class=w> </span><span class=nx>nwv1</span><span class=p>.</span><span class=nx>IngressBackend</span><span class=p>{</span>
<a id=__codelineno-58-128 name=__codelineno-58-128 href=#__codelineno-58-128></a><span class=w>                    </span><span class=nx>Service</span><span class=p>:</span><span class=w> </span><span class=o>&amp;</span><span class=nx>nwv1</span><span class=p>.</span><span class=nx>IngressServiceBackend</span><span class=p>{</span>
<a id=__codelineno-58-129 name=__codelineno-58-129 href=#__codelineno-58-129></a><span class=w>                        </span><span class=nx>Name</span><span class=p>:</span><span class=w> </span><span class=nx>HttpPath</span><span class=p>.</span><span class=nx>ServiceName</span><span class=p>,</span>
<a id=__codelineno-58-130 name=__codelineno-58-130 href=#__codelineno-58-130></a><span class=w>                        </span><span class=nx>Port</span><span class=p>:</span><span class=w> </span><span class=nx>nwv1</span><span class=p>.</span><span class=nx>ServiceBackendPort</span><span class=p>{</span>
<a id=__codelineno-58-131 name=__codelineno-58-131 href=#__codelineno-58-131></a><span class=w>                            </span><span class=nx>Number</span><span class=p>:</span><span class=w> </span><span class=nx>HttpPath</span><span class=p>.</span><span class=nx>ServicePort</span><span class=p>,</span>
<a id=__codelineno-58-132 name=__codelineno-58-132 href=#__codelineno-58-132></a><span class=w>                        </span><span class=p>},</span>
<a id=__codelineno-58-133 name=__codelineno-58-133 href=#__codelineno-58-133></a><span class=w>                    </span><span class=p>},</span>
<a id=__codelineno-58-134 name=__codelineno-58-134 href=#__codelineno-58-134></a><span class=w>                </span><span class=p>},</span>
<a id=__codelineno-58-135 name=__codelineno-58-135 href=#__codelineno-58-135></a><span class=w>            </span><span class=p>}</span>
<a id=__codelineno-58-136 name=__codelineno-58-136 href=#__codelineno-58-136></a><span class=w>            </span><span class=c1>//将每个hip对象组装成数组</span>
<a id=__codelineno-58-137 name=__codelineno-58-137 href=#__codelineno-58-137></a><span class=w>            </span><span class=nx>httpIngressPATHs</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nb>append</span><span class=p>(</span><span class=nx>httpIngressPATHs</span><span class=p>,</span><span class=w> </span><span class=nx>hip</span><span class=p>)</span>
<a id=__codelineno-58-138 name=__codelineno-58-138 href=#__codelineno-58-138></a><span class=w>        </span><span class=p>}</span>
<a id=__codelineno-58-139 name=__codelineno-58-139 href=#__codelineno-58-139></a><span class=w>        </span><span class=c1>//给Paths赋值，前面置为空了</span>
<a id=__codelineno-58-140 name=__codelineno-58-140 href=#__codelineno-58-140></a><span class=w>        </span><span class=nx>ir</span><span class=p>.</span><span class=nx>IngressRuleValue</span><span class=p>.</span><span class=nx>HTTP</span><span class=p>.</span><span class=nx>Paths</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>httpIngressPATHs</span>
<a id=__codelineno-58-141 name=__codelineno-58-141 href=#__codelineno-58-141></a><span class=w>        </span><span class=c1>//将每个ir对象组装成数组，这个ir对象就是IngressRule，每个元素是一个host和多个path</span>
<a id=__codelineno-58-142 name=__codelineno-58-142 href=#__codelineno-58-142></a><span class=w>        </span><span class=nx>ingressRules</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nb>append</span><span class=p>(</span><span class=nx>ingressRules</span><span class=p>,</span><span class=w> </span><span class=nx>ir</span><span class=p>)</span>
<a id=__codelineno-58-143 name=__codelineno-58-143 href=#__codelineno-58-143></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-58-144 name=__codelineno-58-144 href=#__codelineno-58-144></a><span class=w>    </span><span class=c1>//将ingressRules对象加入到ingress的规则中</span>
<a id=__codelineno-58-145 name=__codelineno-58-145 href=#__codelineno-58-145></a><span class=w>    </span><span class=nx>ingress</span><span class=p>.</span><span class=nx>Spec</span><span class=p>.</span><span class=nx>Rules</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>ingressRules</span>
<a id=__codelineno-58-146 name=__codelineno-58-146 href=#__codelineno-58-146></a><span class=w>    </span><span class=c1>//创建ingress</span>
<a id=__codelineno-58-147 name=__codelineno-58-147 href=#__codelineno-58-147></a><span class=w>    </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>NetworkingV1</span><span class=p>().</span><span class=nx>Ingresses</span><span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>).</span><span class=nx>Create</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>ingress</span><span class=p>,</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>CreateOptions</span><span class=p>{})</span>
<a id=__codelineno-58-148 name=__codelineno-58-148 href=#__codelineno-58-148></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-58-149 name=__codelineno-58-149 href=#__codelineno-58-149></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;创建Ingress失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-58-150 name=__codelineno-58-150 href=#__codelineno-58-150></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;创建Ingress失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-58-151 name=__codelineno-58-151 href=#__codelineno-58-151></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-58-152 name=__codelineno-58-152 href=#__codelineno-58-152></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-58-153 name=__codelineno-58-153 href=#__codelineno-58-153></a><span class=p>}</span>
<a id=__codelineno-58-154 name=__codelineno-58-154 href=#__codelineno-58-154></a>
<a id=__codelineno-58-155 name=__codelineno-58-155 href=#__codelineno-58-155></a><span class=c1>// DeleteIngress 删除ingress</span>
<a id=__codelineno-58-156 name=__codelineno-58-156 href=#__codelineno-58-156></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>i</span><span class=w> </span><span class=o>*</span><span class=nx>ingress</span><span class=p>)</span><span class=w> </span><span class=nx>DeleteIngress</span><span class=p>(</span><span class=nx>ingressName</span><span class=p>,</span><span class=w> </span><span class=nx>namespace</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-58-157 name=__codelineno-58-157 href=#__codelineno-58-157></a><span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>NetworkingV1</span><span class=p>().</span><span class=nx>Ingresses</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span><span class=nx>Delete</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>ingressName</span><span class=p>,</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>DeleteOptions</span><span class=p>{})</span>
<a id=__codelineno-58-158 name=__codelineno-58-158 href=#__codelineno-58-158></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-58-159 name=__codelineno-58-159 href=#__codelineno-58-159></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;删除Ingress失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-58-160 name=__codelineno-58-160 href=#__codelineno-58-160></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;删除Ingress失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-58-161 name=__codelineno-58-161 href=#__codelineno-58-161></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-58-162 name=__codelineno-58-162 href=#__codelineno-58-162></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-58-163 name=__codelineno-58-163 href=#__codelineno-58-163></a><span class=p>}</span>
<a id=__codelineno-58-164 name=__codelineno-58-164 href=#__codelineno-58-164></a>
<a id=__codelineno-58-165 name=__codelineno-58-165 href=#__codelineno-58-165></a><span class=c1>// UpdateIngress 更新ingress</span>
<a id=__codelineno-58-166 name=__codelineno-58-166 href=#__codelineno-58-166></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>i</span><span class=w> </span><span class=o>*</span><span class=nx>ingress</span><span class=p>)</span><span class=w> </span><span class=nx>UpdateIngress</span><span class=p>(</span><span class=nx>namespace</span><span class=p>,</span><span class=w> </span><span class=nx>content</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-58-167 name=__codelineno-58-167 href=#__codelineno-58-167></a><span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=nx>ingress</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>nwv1</span><span class=p>.</span><span class=nx>Ingress</span><span class=p>{}</span>
<a id=__codelineno-58-168 name=__codelineno-58-168 href=#__codelineno-58-168></a><span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>json</span><span class=p>.</span><span class=nx>Unmarshal</span><span class=p>([]</span><span class=nb>byte</span><span class=p>(</span><span class=nx>content</span><span class=p>),</span><span class=w> </span><span class=nx>ingress</span><span class=p>)</span>
<a id=__codelineno-58-169 name=__codelineno-58-169 href=#__codelineno-58-169></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-58-170 name=__codelineno-58-170 href=#__codelineno-58-170></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;反序列化失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-58-171 name=__codelineno-58-171 href=#__codelineno-58-171></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;反序列化失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-58-172 name=__codelineno-58-172 href=#__codelineno-58-172></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-58-173 name=__codelineno-58-173 href=#__codelineno-58-173></a><span class=w>    </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>NetworkingV1</span><span class=p>().</span><span class=nx>Ingresses</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span><span class=nx>Update</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>ingress</span><span class=p>,</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>UpdateOptions</span><span class=p>{})</span>
<a id=__codelineno-58-174 name=__codelineno-58-174 href=#__codelineno-58-174></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-58-175 name=__codelineno-58-175 href=#__codelineno-58-175></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;更新ingress失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-58-176 name=__codelineno-58-176 href=#__codelineno-58-176></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;更新ingress失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-58-177 name=__codelineno-58-177 href=#__codelineno-58-177></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-58-178 name=__codelineno-58-178 href=#__codelineno-58-178></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-58-179 name=__codelineno-58-179 href=#__codelineno-58-179></a><span class=p>}</span>
</code></pre></div> <h5 id=controlleringressgo>controller/ingress.go<a class=headerlink href=#controlleringressgo title="Permanent link">&para;</a></h5> <div class=highlight><pre><span></span><code><a id=__codelineno-59-1 name=__codelineno-59-1 href=#__codelineno-59-1></a><span class=kn>package</span><span class=w> </span><span class=nx>controller</span>
<a id=__codelineno-59-2 name=__codelineno-59-2 href=#__codelineno-59-2></a>
<a id=__codelineno-59-3 name=__codelineno-59-3 href=#__codelineno-59-3></a><span class=kn>import</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-59-4 name=__codelineno-59-4 href=#__codelineno-59-4></a><span class=w>    </span><span class=s>&quot;gitee.com/hujianli94net/k8s-platform/service&quot;</span>
<a id=__codelineno-59-5 name=__codelineno-59-5 href=#__codelineno-59-5></a><span class=w>    </span><span class=s>&quot;net/http&quot;</span>
<a id=__codelineno-59-6 name=__codelineno-59-6 href=#__codelineno-59-6></a>
<a id=__codelineno-59-7 name=__codelineno-59-7 href=#__codelineno-59-7></a><span class=w>    </span><span class=s>&quot;github.com/gin-gonic/gin&quot;</span>
<a id=__codelineno-59-8 name=__codelineno-59-8 href=#__codelineno-59-8></a><span class=w>    </span><span class=s>&quot;github.com/wonderivan/logger&quot;</span>
<a id=__codelineno-59-9 name=__codelineno-59-9 href=#__codelineno-59-9></a><span class=p>)</span>
<a id=__codelineno-59-10 name=__codelineno-59-10 href=#__codelineno-59-10></a>
<a id=__codelineno-59-11 name=__codelineno-59-11 href=#__codelineno-59-11></a><span class=kd>var</span><span class=w> </span><span class=nx>Ingress</span><span class=w> </span><span class=nx>ingress</span>
<a id=__codelineno-59-12 name=__codelineno-59-12 href=#__codelineno-59-12></a>
<a id=__codelineno-59-13 name=__codelineno-59-13 href=#__codelineno-59-13></a><span class=kd>type</span><span class=w> </span><span class=nx>ingress</span><span class=w> </span><span class=kd>struct</span><span class=p>{}</span>
<a id=__codelineno-59-14 name=__codelineno-59-14 href=#__codelineno-59-14></a>
<a id=__codelineno-59-15 name=__codelineno-59-15 href=#__codelineno-59-15></a><span class=c1>// GetIngresses 获取ingress列表，支持过滤、排序、分页</span>
<a id=__codelineno-59-16 name=__codelineno-59-16 href=#__codelineno-59-16></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>i</span><span class=w> </span><span class=o>*</span><span class=nx>ingress</span><span class=p>)</span><span class=w> </span><span class=nx>GetIngresses</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-59-17 name=__codelineno-59-17 href=#__codelineno-59-17></a><span class=w>    </span><span class=nx>params</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-59-18 name=__codelineno-59-18 href=#__codelineno-59-18></a><span class=w>        </span><span class=nx>FilterName</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`form:&quot;filter_name&quot;`</span>
<a id=__codelineno-59-19 name=__codelineno-59-19 href=#__codelineno-59-19></a><span class=w>        </span><span class=nx>Namespace</span><span class=w>  </span><span class=kt>string</span><span class=w> </span><span class=s>`form:&quot;namespace&quot;`</span>
<a id=__codelineno-59-20 name=__codelineno-59-20 href=#__codelineno-59-20></a><span class=w>        </span><span class=nx>Page</span><span class=w>       </span><span class=kt>int</span><span class=w>    </span><span class=s>`form:&quot;page&quot;`</span>
<a id=__codelineno-59-21 name=__codelineno-59-21 href=#__codelineno-59-21></a><span class=w>        </span><span class=nx>Limit</span><span class=w>      </span><span class=kt>int</span><span class=w>    </span><span class=s>`form:&quot;limit&quot;`</span>
<a id=__codelineno-59-22 name=__codelineno-59-22 href=#__codelineno-59-22></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-59-23 name=__codelineno-59-23 href=#__codelineno-59-23></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>Bind</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-59-24 name=__codelineno-59-24 href=#__codelineno-59-24></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-59-25 name=__codelineno-59-25 href=#__codelineno-59-25></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-59-26 name=__codelineno-59-26 href=#__codelineno-59-26></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-59-27 name=__codelineno-59-27 href=#__codelineno-59-27></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-59-28 name=__codelineno-59-28 href=#__codelineno-59-28></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-59-29 name=__codelineno-59-29 href=#__codelineno-59-29></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-59-30 name=__codelineno-59-30 href=#__codelineno-59-30></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-59-31 name=__codelineno-59-31 href=#__codelineno-59-31></a>
<a id=__codelineno-59-32 name=__codelineno-59-32 href=#__codelineno-59-32></a><span class=w>    </span><span class=nx>data</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>Ingress</span><span class=p>.</span><span class=nx>GetIngresses</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>FilterName</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Limit</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Page</span><span class=p>)</span>
<a id=__codelineno-59-33 name=__codelineno-59-33 href=#__codelineno-59-33></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-59-34 name=__codelineno-59-34 href=#__codelineno-59-34></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-59-35 name=__codelineno-59-35 href=#__codelineno-59-35></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-59-36 name=__codelineno-59-36 href=#__codelineno-59-36></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-59-37 name=__codelineno-59-37 href=#__codelineno-59-37></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-59-38 name=__codelineno-59-38 href=#__codelineno-59-38></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-59-39 name=__codelineno-59-39 href=#__codelineno-59-39></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-59-40 name=__codelineno-59-40 href=#__codelineno-59-40></a>
<a id=__codelineno-59-41 name=__codelineno-59-41 href=#__codelineno-59-41></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-59-42 name=__codelineno-59-42 href=#__codelineno-59-42></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;获取Ingresst列表成功&quot;</span><span class=p>,</span>
<a id=__codelineno-59-43 name=__codelineno-59-43 href=#__codelineno-59-43></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=nx>data</span><span class=p>,</span>
<a id=__codelineno-59-44 name=__codelineno-59-44 href=#__codelineno-59-44></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-59-45 name=__codelineno-59-45 href=#__codelineno-59-45></a><span class=p>}</span>
<a id=__codelineno-59-46 name=__codelineno-59-46 href=#__codelineno-59-46></a>
<a id=__codelineno-59-47 name=__codelineno-59-47 href=#__codelineno-59-47></a><span class=c1>// GetIngressDetail 获取ingress详情</span>
<a id=__codelineno-59-48 name=__codelineno-59-48 href=#__codelineno-59-48></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>i</span><span class=w> </span><span class=o>*</span><span class=nx>ingress</span><span class=p>)</span><span class=w> </span><span class=nx>GetIngressDetail</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-59-49 name=__codelineno-59-49 href=#__codelineno-59-49></a><span class=w>    </span><span class=nx>params</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-59-50 name=__codelineno-59-50 href=#__codelineno-59-50></a><span class=w>        </span><span class=nx>IngressName</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`form:&quot;ingress_name&quot;`</span>
<a id=__codelineno-59-51 name=__codelineno-59-51 href=#__codelineno-59-51></a><span class=w>        </span><span class=nx>Namespace</span><span class=w>   </span><span class=kt>string</span><span class=w> </span><span class=s>`form:&quot;namespace&quot;`</span>
<a id=__codelineno-59-52 name=__codelineno-59-52 href=#__codelineno-59-52></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-59-53 name=__codelineno-59-53 href=#__codelineno-59-53></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>Bind</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-59-54 name=__codelineno-59-54 href=#__codelineno-59-54></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-59-55 name=__codelineno-59-55 href=#__codelineno-59-55></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-59-56 name=__codelineno-59-56 href=#__codelineno-59-56></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-59-57 name=__codelineno-59-57 href=#__codelineno-59-57></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-59-58 name=__codelineno-59-58 href=#__codelineno-59-58></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-59-59 name=__codelineno-59-59 href=#__codelineno-59-59></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-59-60 name=__codelineno-59-60 href=#__codelineno-59-60></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-59-61 name=__codelineno-59-61 href=#__codelineno-59-61></a>
<a id=__codelineno-59-62 name=__codelineno-59-62 href=#__codelineno-59-62></a><span class=w>    </span><span class=nx>data</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>Ingress</span><span class=p>.</span><span class=nx>GetIngressDetail</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>IngressName</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>)</span>
<a id=__codelineno-59-63 name=__codelineno-59-63 href=#__codelineno-59-63></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-59-64 name=__codelineno-59-64 href=#__codelineno-59-64></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-59-65 name=__codelineno-59-65 href=#__codelineno-59-65></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-59-66 name=__codelineno-59-66 href=#__codelineno-59-66></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-59-67 name=__codelineno-59-67 href=#__codelineno-59-67></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-59-68 name=__codelineno-59-68 href=#__codelineno-59-68></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-59-69 name=__codelineno-59-69 href=#__codelineno-59-69></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-59-70 name=__codelineno-59-70 href=#__codelineno-59-70></a>
<a id=__codelineno-59-71 name=__codelineno-59-71 href=#__codelineno-59-71></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-59-72 name=__codelineno-59-72 href=#__codelineno-59-72></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;获取Ingress详情成功&quot;</span><span class=p>,</span>
<a id=__codelineno-59-73 name=__codelineno-59-73 href=#__codelineno-59-73></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=nx>data</span><span class=p>,</span>
<a id=__codelineno-59-74 name=__codelineno-59-74 href=#__codelineno-59-74></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-59-75 name=__codelineno-59-75 href=#__codelineno-59-75></a><span class=p>}</span>
<a id=__codelineno-59-76 name=__codelineno-59-76 href=#__codelineno-59-76></a>
<a id=__codelineno-59-77 name=__codelineno-59-77 href=#__codelineno-59-77></a><span class=c1>// DeleteIngress 删除ingress</span>
<a id=__codelineno-59-78 name=__codelineno-59-78 href=#__codelineno-59-78></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>i</span><span class=w> </span><span class=o>*</span><span class=nx>ingress</span><span class=p>)</span><span class=w> </span><span class=nx>DeleteIngress</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-59-79 name=__codelineno-59-79 href=#__codelineno-59-79></a><span class=w>    </span><span class=nx>params</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-59-80 name=__codelineno-59-80 href=#__codelineno-59-80></a><span class=w>        </span><span class=nx>IngressName</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;ingress_name&quot;`</span>
<a id=__codelineno-59-81 name=__codelineno-59-81 href=#__codelineno-59-81></a><span class=w>        </span><span class=nx>Namespace</span><span class=w>   </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;namespace&quot;`</span>
<a id=__codelineno-59-82 name=__codelineno-59-82 href=#__codelineno-59-82></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-59-83 name=__codelineno-59-83 href=#__codelineno-59-83></a><span class=w>    </span><span class=c1>//DELETE请求，绑定参数方法改为ctx.ShouldBindJSON</span>
<a id=__codelineno-59-84 name=__codelineno-59-84 href=#__codelineno-59-84></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>ShouldBindJSON</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-59-85 name=__codelineno-59-85 href=#__codelineno-59-85></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-59-86 name=__codelineno-59-86 href=#__codelineno-59-86></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-59-87 name=__codelineno-59-87 href=#__codelineno-59-87></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-59-88 name=__codelineno-59-88 href=#__codelineno-59-88></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-59-89 name=__codelineno-59-89 href=#__codelineno-59-89></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-59-90 name=__codelineno-59-90 href=#__codelineno-59-90></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-59-91 name=__codelineno-59-91 href=#__codelineno-59-91></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-59-92 name=__codelineno-59-92 href=#__codelineno-59-92></a>
<a id=__codelineno-59-93 name=__codelineno-59-93 href=#__codelineno-59-93></a><span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>Ingress</span><span class=p>.</span><span class=nx>DeleteIngress</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>IngressName</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>)</span>
<a id=__codelineno-59-94 name=__codelineno-59-94 href=#__codelineno-59-94></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-59-95 name=__codelineno-59-95 href=#__codelineno-59-95></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-59-96 name=__codelineno-59-96 href=#__codelineno-59-96></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-59-97 name=__codelineno-59-97 href=#__codelineno-59-97></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-59-98 name=__codelineno-59-98 href=#__codelineno-59-98></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-59-99 name=__codelineno-59-99 href=#__codelineno-59-99></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-59-100 name=__codelineno-59-100 href=#__codelineno-59-100></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-59-101 name=__codelineno-59-101 href=#__codelineno-59-101></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-59-102 name=__codelineno-59-102 href=#__codelineno-59-102></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;删除Ingress成功&quot;</span><span class=p>,</span>
<a id=__codelineno-59-103 name=__codelineno-59-103 href=#__codelineno-59-103></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-59-104 name=__codelineno-59-104 href=#__codelineno-59-104></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-59-105 name=__codelineno-59-105 href=#__codelineno-59-105></a><span class=p>}</span>
<a id=__codelineno-59-106 name=__codelineno-59-106 href=#__codelineno-59-106></a>
<a id=__codelineno-59-107 name=__codelineno-59-107 href=#__codelineno-59-107></a><span class=c1>// CreateIngress 创建ingress</span>
<a id=__codelineno-59-108 name=__codelineno-59-108 href=#__codelineno-59-108></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>i</span><span class=w> </span><span class=o>*</span><span class=nx>ingress</span><span class=p>)</span><span class=w> </span><span class=nx>CreateIngress</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-59-109 name=__codelineno-59-109 href=#__codelineno-59-109></a><span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-59-110 name=__codelineno-59-110 href=#__codelineno-59-110></a><span class=w>        </span><span class=nx>ingressCreate</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=nx>service</span><span class=p>.</span><span class=nx>IngressCreate</span><span class=p>)</span>
<a id=__codelineno-59-111 name=__codelineno-59-111 href=#__codelineno-59-111></a><span class=w>        </span><span class=nx>err</span><span class=w>           </span><span class=kt>error</span>
<a id=__codelineno-59-112 name=__codelineno-59-112 href=#__codelineno-59-112></a><span class=w>    </span><span class=p>)</span>
<a id=__codelineno-59-113 name=__codelineno-59-113 href=#__codelineno-59-113></a>
<a id=__codelineno-59-114 name=__codelineno-59-114 href=#__codelineno-59-114></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>ShouldBindJSON</span><span class=p>(</span><span class=nx>ingressCreate</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-59-115 name=__codelineno-59-115 href=#__codelineno-59-115></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-59-116 name=__codelineno-59-116 href=#__codelineno-59-116></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-59-117 name=__codelineno-59-117 href=#__codelineno-59-117></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-59-118 name=__codelineno-59-118 href=#__codelineno-59-118></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-59-119 name=__codelineno-59-119 href=#__codelineno-59-119></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-59-120 name=__codelineno-59-120 href=#__codelineno-59-120></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-59-121 name=__codelineno-59-121 href=#__codelineno-59-121></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-59-122 name=__codelineno-59-122 href=#__codelineno-59-122></a>
<a id=__codelineno-59-123 name=__codelineno-59-123 href=#__codelineno-59-123></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>Ingress</span><span class=p>.</span><span class=nx>CreateIngress</span><span class=p>(</span><span class=nx>ingressCreate</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-59-124 name=__codelineno-59-124 href=#__codelineno-59-124></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-59-125 name=__codelineno-59-125 href=#__codelineno-59-125></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-59-126 name=__codelineno-59-126 href=#__codelineno-59-126></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-59-127 name=__codelineno-59-127 href=#__codelineno-59-127></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-59-128 name=__codelineno-59-128 href=#__codelineno-59-128></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-59-129 name=__codelineno-59-129 href=#__codelineno-59-129></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-59-130 name=__codelineno-59-130 href=#__codelineno-59-130></a>
<a id=__codelineno-59-131 name=__codelineno-59-131 href=#__codelineno-59-131></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-59-132 name=__codelineno-59-132 href=#__codelineno-59-132></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;创建Ingress成功&quot;</span><span class=p>,</span>
<a id=__codelineno-59-133 name=__codelineno-59-133 href=#__codelineno-59-133></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-59-134 name=__codelineno-59-134 href=#__codelineno-59-134></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-59-135 name=__codelineno-59-135 href=#__codelineno-59-135></a><span class=p>}</span>
<a id=__codelineno-59-136 name=__codelineno-59-136 href=#__codelineno-59-136></a>
<a id=__codelineno-59-137 name=__codelineno-59-137 href=#__codelineno-59-137></a><span class=c1>// UpdateIngress 更新ingress</span>
<a id=__codelineno-59-138 name=__codelineno-59-138 href=#__codelineno-59-138></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>i</span><span class=w> </span><span class=o>*</span><span class=nx>ingress</span><span class=p>)</span><span class=w> </span><span class=nx>UpdateIngress</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-59-139 name=__codelineno-59-139 href=#__codelineno-59-139></a><span class=w>    </span><span class=nx>params</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-59-140 name=__codelineno-59-140 href=#__codelineno-59-140></a><span class=w>        </span><span class=nx>Namespace</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;namespace&quot;`</span>
<a id=__codelineno-59-141 name=__codelineno-59-141 href=#__codelineno-59-141></a><span class=w>        </span><span class=nx>Content</span><span class=w>   </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;content&quot;`</span>
<a id=__codelineno-59-142 name=__codelineno-59-142 href=#__codelineno-59-142></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-59-143 name=__codelineno-59-143 href=#__codelineno-59-143></a><span class=w>    </span><span class=c1>//PUT请求，绑定参数方法改为ctx.ShouldBindJSON</span>
<a id=__codelineno-59-144 name=__codelineno-59-144 href=#__codelineno-59-144></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>ShouldBindJSON</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-59-145 name=__codelineno-59-145 href=#__codelineno-59-145></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-59-146 name=__codelineno-59-146 href=#__codelineno-59-146></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-59-147 name=__codelineno-59-147 href=#__codelineno-59-147></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-59-148 name=__codelineno-59-148 href=#__codelineno-59-148></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-59-149 name=__codelineno-59-149 href=#__codelineno-59-149></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-59-150 name=__codelineno-59-150 href=#__codelineno-59-150></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-59-151 name=__codelineno-59-151 href=#__codelineno-59-151></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-59-152 name=__codelineno-59-152 href=#__codelineno-59-152></a>
<a id=__codelineno-59-153 name=__codelineno-59-153 href=#__codelineno-59-153></a><span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>Ingress</span><span class=p>.</span><span class=nx>UpdateIngress</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Content</span><span class=p>)</span>
<a id=__codelineno-59-154 name=__codelineno-59-154 href=#__codelineno-59-154></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-59-155 name=__codelineno-59-155 href=#__codelineno-59-155></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-59-156 name=__codelineno-59-156 href=#__codelineno-59-156></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-59-157 name=__codelineno-59-157 href=#__codelineno-59-157></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-59-158 name=__codelineno-59-158 href=#__codelineno-59-158></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-59-159 name=__codelineno-59-159 href=#__codelineno-59-159></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-59-160 name=__codelineno-59-160 href=#__codelineno-59-160></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-59-161 name=__codelineno-59-161 href=#__codelineno-59-161></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-59-162 name=__codelineno-59-162 href=#__codelineno-59-162></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;更新Ingress成功&quot;</span><span class=p>,</span>
<a id=__codelineno-59-163 name=__codelineno-59-163 href=#__codelineno-59-163></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-59-164 name=__codelineno-59-164 href=#__codelineno-59-164></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-59-165 name=__codelineno-59-165 href=#__codelineno-59-165></a><span class=p>}</span>
</code></pre></div> <h3 id=5-存储与配置>5. 存储与配置<a class=headerlink href=#5-存储与配置 title="Permanent link">&para;</a></h3> <h4 id=51-configmap>5.1 ConfigMap<a class=headerlink href=#51-configmap title="Permanent link">&para;</a></h4> <table> <thead> <tr> <th>功能</th> <th>是否实现</th> </tr> </thead> <tbody> <tr> <td>ConfigMap 列表</td> <td>√</td> </tr> <tr> <td>获取ConfigMap详情</td> <td>√</td> </tr> <tr> <td>删除ConfigMap</td> <td>√</td> </tr> <tr> <td>更新ConfigMap</td> <td>√</td> </tr> </tbody> </table> <h5 id=servicedataselectorgo_8>service/dataselector.go<a class=headerlink href=#servicedataselectorgo_8 title="Permanent link">&para;</a></h5> <div class=highlight><pre><span></span><code><a id=__codelineno-60-1 name=__codelineno-60-1 href=#__codelineno-60-1></a><span class=c1>// 实现 ConfigMap 的 DataCell接口</span>
<a id=__codelineno-60-2 name=__codelineno-60-2 href=#__codelineno-60-2></a><span class=kd>type</span><span class=w> </span><span class=nx>configMapCell</span><span class=w> </span><span class=nx>corev1</span><span class=p>.</span><span class=nx>ConfigMap</span>
<a id=__codelineno-60-3 name=__codelineno-60-3 href=#__codelineno-60-3></a>
<a id=__codelineno-60-4 name=__codelineno-60-4 href=#__codelineno-60-4></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>c</span><span class=w> </span><span class=nx>configMapCell</span><span class=p>)</span><span class=w> </span><span class=nx>GetCreation</span><span class=p>()</span><span class=w> </span><span class=nx>time</span><span class=p>.</span><span class=nx>Time</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-60-5 name=__codelineno-60-5 href=#__codelineno-60-5></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>c</span><span class=p>.</span><span class=nx>CreationTimestamp</span><span class=p>.</span><span class=nx>Time</span>
<a id=__codelineno-60-6 name=__codelineno-60-6 href=#__codelineno-60-6></a><span class=p>}</span>
<a id=__codelineno-60-7 name=__codelineno-60-7 href=#__codelineno-60-7></a>
<a id=__codelineno-60-8 name=__codelineno-60-8 href=#__codelineno-60-8></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>c</span><span class=w> </span><span class=nx>configMapCell</span><span class=p>)</span><span class=w> </span><span class=nx>GetName</span><span class=p>()</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-60-9 name=__codelineno-60-9 href=#__codelineno-60-9></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>c</span><span class=p>.</span><span class=nx>Name</span>
<a id=__codelineno-60-10 name=__codelineno-60-10 href=#__codelineno-60-10></a><span class=p>}</span>
</code></pre></div> <h5 id=serviceconfigmapgo>service/configmap.go<a class=headerlink href=#serviceconfigmapgo title="Permanent link">&para;</a></h5> <div class=highlight><pre><span></span><code><a id=__codelineno-61-1 name=__codelineno-61-1 href=#__codelineno-61-1></a><span class=kn>package</span><span class=w> </span><span class=nx>service</span>
<a id=__codelineno-61-2 name=__codelineno-61-2 href=#__codelineno-61-2></a>
<a id=__codelineno-61-3 name=__codelineno-61-3 href=#__codelineno-61-3></a><span class=kn>import</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-61-4 name=__codelineno-61-4 href=#__codelineno-61-4></a><span class=w>    </span><span class=s>&quot;context&quot;</span>
<a id=__codelineno-61-5 name=__codelineno-61-5 href=#__codelineno-61-5></a><span class=w>    </span><span class=s>&quot;encoding/json&quot;</span>
<a id=__codelineno-61-6 name=__codelineno-61-6 href=#__codelineno-61-6></a><span class=w>    </span><span class=s>&quot;errors&quot;</span>
<a id=__codelineno-61-7 name=__codelineno-61-7 href=#__codelineno-61-7></a>
<a id=__codelineno-61-8 name=__codelineno-61-8 href=#__codelineno-61-8></a><span class=w>    </span><span class=s>&quot;github.com/wonderivan/logger&quot;</span>
<a id=__codelineno-61-9 name=__codelineno-61-9 href=#__codelineno-61-9></a><span class=w>    </span><span class=nx>corev1</span><span class=w> </span><span class=s>&quot;k8s.io/api/core/v1&quot;</span>
<a id=__codelineno-61-10 name=__codelineno-61-10 href=#__codelineno-61-10></a><span class=w>    </span><span class=nx>metav1</span><span class=w> </span><span class=s>&quot;k8s.io/apimachinery/pkg/apis/meta/v1&quot;</span>
<a id=__codelineno-61-11 name=__codelineno-61-11 href=#__codelineno-61-11></a><span class=p>)</span>
<a id=__codelineno-61-12 name=__codelineno-61-12 href=#__codelineno-61-12></a>
<a id=__codelineno-61-13 name=__codelineno-61-13 href=#__codelineno-61-13></a><span class=kd>type</span><span class=w> </span><span class=nx>configMap</span><span class=w> </span><span class=kd>struct</span><span class=p>{}</span>
<a id=__codelineno-61-14 name=__codelineno-61-14 href=#__codelineno-61-14></a>
<a id=__codelineno-61-15 name=__codelineno-61-15 href=#__codelineno-61-15></a><span class=kd>var</span><span class=w> </span><span class=nx>ConfigMap</span><span class=w> </span><span class=nx>configMap</span>
<a id=__codelineno-61-16 name=__codelineno-61-16 href=#__codelineno-61-16></a>
<a id=__codelineno-61-17 name=__codelineno-61-17 href=#__codelineno-61-17></a><span class=kd>type</span><span class=w> </span><span class=nx>ConfigMapsResp</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-61-18 name=__codelineno-61-18 href=#__codelineno-61-18></a><span class=w>    </span><span class=nx>Items</span><span class=w> </span><span class=p>[]</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>ConfigMap</span><span class=w> </span><span class=s>`json:&quot;items&quot;`</span>
<a id=__codelineno-61-19 name=__codelineno-61-19 href=#__codelineno-61-19></a><span class=w>    </span><span class=nx>Total</span><span class=w> </span><span class=kt>int</span><span class=w>                </span><span class=s>`json:&quot;total&quot;`</span>
<a id=__codelineno-61-20 name=__codelineno-61-20 href=#__codelineno-61-20></a><span class=p>}</span>
<a id=__codelineno-61-21 name=__codelineno-61-21 href=#__codelineno-61-21></a>
<a id=__codelineno-61-22 name=__codelineno-61-22 href=#__codelineno-61-22></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>c</span><span class=w> </span><span class=o>*</span><span class=nx>configMap</span><span class=p>)</span><span class=w> </span><span class=nx>toCells</span><span class=p>(</span><span class=nx>std</span><span class=w> </span><span class=p>[]</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>ConfigMap</span><span class=p>)</span><span class=w> </span><span class=p>[]</span><span class=nx>DataCell</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-61-23 name=__codelineno-61-23 href=#__codelineno-61-23></a><span class=w>    </span><span class=nx>cells</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>make</span><span class=p>([]</span><span class=nx>DataCell</span><span class=p>,</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>std</span><span class=p>))</span>
<a id=__codelineno-61-24 name=__codelineno-61-24 href=#__codelineno-61-24></a><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=nx>i</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>std</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-61-25 name=__codelineno-61-25 href=#__codelineno-61-25></a><span class=w>        </span><span class=nx>cells</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>configMapCell</span><span class=p>(</span><span class=nx>std</span><span class=p>[</span><span class=nx>i</span><span class=p>])</span>
<a id=__codelineno-61-26 name=__codelineno-61-26 href=#__codelineno-61-26></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-61-27 name=__codelineno-61-27 href=#__codelineno-61-27></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>cells</span>
<a id=__codelineno-61-28 name=__codelineno-61-28 href=#__codelineno-61-28></a><span class=p>}</span>
<a id=__codelineno-61-29 name=__codelineno-61-29 href=#__codelineno-61-29></a>
<a id=__codelineno-61-30 name=__codelineno-61-30 href=#__codelineno-61-30></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>c</span><span class=w> </span><span class=o>*</span><span class=nx>configMap</span><span class=p>)</span><span class=w> </span><span class=nx>fromCells</span><span class=p>(</span><span class=nx>cells</span><span class=w> </span><span class=p>[]</span><span class=nx>DataCell</span><span class=p>)</span><span class=w> </span><span class=p>[]</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>ConfigMap</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-61-31 name=__codelineno-61-31 href=#__codelineno-61-31></a><span class=w>    </span><span class=nx>configMaps</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>make</span><span class=p>([]</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>ConfigMap</span><span class=p>,</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>cells</span><span class=p>))</span>
<a id=__codelineno-61-32 name=__codelineno-61-32 href=#__codelineno-61-32></a><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=nx>i</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>cells</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-61-33 name=__codelineno-61-33 href=#__codelineno-61-33></a><span class=w>        </span><span class=nx>configMaps</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>corev1</span><span class=p>.</span><span class=nx>ConfigMap</span><span class=p>(</span><span class=nx>cells</span><span class=p>[</span><span class=nx>i</span><span class=p>].(</span><span class=nx>configMapCell</span><span class=p>))</span>
<a id=__codelineno-61-34 name=__codelineno-61-34 href=#__codelineno-61-34></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-61-35 name=__codelineno-61-35 href=#__codelineno-61-35></a>
<a id=__codelineno-61-36 name=__codelineno-61-36 href=#__codelineno-61-36></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>configMaps</span>
<a id=__codelineno-61-37 name=__codelineno-61-37 href=#__codelineno-61-37></a><span class=p>}</span>
<a id=__codelineno-61-38 name=__codelineno-61-38 href=#__codelineno-61-38></a>
<a id=__codelineno-61-39 name=__codelineno-61-39 href=#__codelineno-61-39></a><span class=c1>// GetConfigMaps 获取configmap列表，支持过滤、排序、分页</span>
<a id=__codelineno-61-40 name=__codelineno-61-40 href=#__codelineno-61-40></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>c</span><span class=w> </span><span class=o>*</span><span class=nx>configMap</span><span class=p>)</span><span class=w> </span><span class=nx>GetConfigMaps</span><span class=p>(</span><span class=nx>filterName</span><span class=p>,</span><span class=w> </span><span class=nx>namespace</span><span class=w> </span><span class=kt>string</span><span class=p>,</span><span class=w> </span><span class=nx>limit</span><span class=p>,</span><span class=w> </span><span class=nx>page</span><span class=w> </span><span class=kt>int</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>configMapsResp</span><span class=w> </span><span class=o>*</span><span class=nx>ConfigMapsResp</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-61-41 name=__codelineno-61-41 href=#__codelineno-61-41></a><span class=w>    </span><span class=c1>//获取configMapList类型的configMap列表</span>
<a id=__codelineno-61-42 name=__codelineno-61-42 href=#__codelineno-61-42></a><span class=w>    </span><span class=nx>configMapList</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>CoreV1</span><span class=p>().</span><span class=nx>ConfigMaps</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span><span class=nx>List</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>ListOptions</span><span class=p>{})</span>
<a id=__codelineno-61-43 name=__codelineno-61-43 href=#__codelineno-61-43></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-61-44 name=__codelineno-61-44 href=#__codelineno-61-44></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取ConfigMap列表失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-61-45 name=__codelineno-61-45 href=#__codelineno-61-45></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取ConfigMap列表失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-61-46 name=__codelineno-61-46 href=#__codelineno-61-46></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-61-47 name=__codelineno-61-47 href=#__codelineno-61-47></a><span class=w>    </span><span class=c1>//将configMapList中的configMap列表（Items），放进dataselector对象中，进行排序</span>
<a id=__codelineno-61-48 name=__codelineno-61-48 href=#__codelineno-61-48></a><span class=w>    </span><span class=nx>selectableData</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>dataSelector</span><span class=p>{</span>
<a id=__codelineno-61-49 name=__codelineno-61-49 href=#__codelineno-61-49></a><span class=w>        </span><span class=nx>GenericDataList</span><span class=p>:</span><span class=w> </span><span class=nx>c</span><span class=p>.</span><span class=nx>toCells</span><span class=p>(</span><span class=nx>configMapList</span><span class=p>.</span><span class=nx>Items</span><span class=p>),</span>
<a id=__codelineno-61-50 name=__codelineno-61-50 href=#__codelineno-61-50></a><span class=w>        </span><span class=nx>dataSelectQuery</span><span class=p>:</span><span class=w> </span><span class=o>&amp;</span><span class=nx>DataSelectQuery</span><span class=p>{</span>
<a id=__codelineno-61-51 name=__codelineno-61-51 href=#__codelineno-61-51></a><span class=w>            </span><span class=nx>FilterQuery</span><span class=p>:</span><span class=w> </span><span class=o>&amp;</span><span class=nx>FilterQuery</span><span class=p>{</span><span class=nx>Name</span><span class=p>:</span><span class=w> </span><span class=nx>filterName</span><span class=p>},</span>
<a id=__codelineno-61-52 name=__codelineno-61-52 href=#__codelineno-61-52></a><span class=w>            </span><span class=nx>PaginateQuery</span><span class=p>:</span><span class=w> </span><span class=o>&amp;</span><span class=nx>PaginateQuery</span><span class=p>{</span>
<a id=__codelineno-61-53 name=__codelineno-61-53 href=#__codelineno-61-53></a><span class=w>                </span><span class=nx>Limit</span><span class=p>:</span><span class=w> </span><span class=nx>limit</span><span class=p>,</span>
<a id=__codelineno-61-54 name=__codelineno-61-54 href=#__codelineno-61-54></a><span class=w>                </span><span class=nx>Page</span><span class=p>:</span><span class=w>  </span><span class=nx>page</span><span class=p>,</span>
<a id=__codelineno-61-55 name=__codelineno-61-55 href=#__codelineno-61-55></a><span class=w>            </span><span class=p>},</span>
<a id=__codelineno-61-56 name=__codelineno-61-56 href=#__codelineno-61-56></a><span class=w>        </span><span class=p>},</span>
<a id=__codelineno-61-57 name=__codelineno-61-57 href=#__codelineno-61-57></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-61-58 name=__codelineno-61-58 href=#__codelineno-61-58></a><span class=w>    </span><span class=nx>filtered</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>selectableData</span><span class=p>.</span><span class=nx>Filter</span><span class=p>()</span>
<a id=__codelineno-61-59 name=__codelineno-61-59 href=#__codelineno-61-59></a><span class=w>    </span><span class=nx>total</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>filtered</span><span class=p>.</span><span class=nx>GenericDataList</span><span class=p>)</span>
<a id=__codelineno-61-60 name=__codelineno-61-60 href=#__codelineno-61-60></a><span class=w>    </span><span class=nx>data</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>filtered</span><span class=p>.</span><span class=nx>Sort</span><span class=p>().</span><span class=nx>Paginate</span><span class=p>()</span>
<a id=__codelineno-61-61 name=__codelineno-61-61 href=#__codelineno-61-61></a><span class=w>    </span><span class=c1>//将[]DataCell类型的configmap列表转为v1.configmap列表</span>
<a id=__codelineno-61-62 name=__codelineno-61-62 href=#__codelineno-61-62></a><span class=w>    </span><span class=nx>configMaps</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>c</span><span class=p>.</span><span class=nx>fromCells</span><span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>GenericDataList</span><span class=p>)</span>
<a id=__codelineno-61-63 name=__codelineno-61-63 href=#__codelineno-61-63></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=o>&amp;</span><span class=nx>ConfigMapsResp</span><span class=p>{</span>
<a id=__codelineno-61-64 name=__codelineno-61-64 href=#__codelineno-61-64></a><span class=w>        </span><span class=nx>Items</span><span class=p>:</span><span class=w> </span><span class=nx>configMaps</span><span class=p>,</span>
<a id=__codelineno-61-65 name=__codelineno-61-65 href=#__codelineno-61-65></a><span class=w>        </span><span class=nx>Total</span><span class=p>:</span><span class=w> </span><span class=nx>total</span><span class=p>,</span>
<a id=__codelineno-61-66 name=__codelineno-61-66 href=#__codelineno-61-66></a><span class=w>    </span><span class=p>},</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-61-67 name=__codelineno-61-67 href=#__codelineno-61-67></a><span class=p>}</span>
<a id=__codelineno-61-68 name=__codelineno-61-68 href=#__codelineno-61-68></a>
<a id=__codelineno-61-69 name=__codelineno-61-69 href=#__codelineno-61-69></a><span class=c1>// GetConfigMapDetail 获取configmap详情</span>
<a id=__codelineno-61-70 name=__codelineno-61-70 href=#__codelineno-61-70></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>c</span><span class=w> </span><span class=o>*</span><span class=nx>configMap</span><span class=p>)</span><span class=w> </span><span class=nx>GetConfigMapDetail</span><span class=p>(</span><span class=nx>configMapName</span><span class=p>,</span><span class=w> </span><span class=nx>namespace</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>configMap</span><span class=w> </span><span class=o>*</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>ConfigMap</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-61-71 name=__codelineno-61-71 href=#__codelineno-61-71></a><span class=w>    </span><span class=nx>configMap</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>CoreV1</span><span class=p>().</span><span class=nx>ConfigMaps</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span><span class=nx>Get</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>configMapName</span><span class=p>,</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>GetOptions</span><span class=p>{})</span>
<a id=__codelineno-61-72 name=__codelineno-61-72 href=#__codelineno-61-72></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-61-73 name=__codelineno-61-73 href=#__codelineno-61-73></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取ConfigMap详情失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-61-74 name=__codelineno-61-74 href=#__codelineno-61-74></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取ConfigMap详情失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-61-75 name=__codelineno-61-75 href=#__codelineno-61-75></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-61-76 name=__codelineno-61-76 href=#__codelineno-61-76></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>configMap</span><span class=p>,</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-61-77 name=__codelineno-61-77 href=#__codelineno-61-77></a><span class=p>}</span>
<a id=__codelineno-61-78 name=__codelineno-61-78 href=#__codelineno-61-78></a>
<a id=__codelineno-61-79 name=__codelineno-61-79 href=#__codelineno-61-79></a><span class=c1>// DeleteConfigMap 删除configmap</span>
<a id=__codelineno-61-80 name=__codelineno-61-80 href=#__codelineno-61-80></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>c</span><span class=w> </span><span class=o>*</span><span class=nx>configMap</span><span class=p>)</span><span class=w> </span><span class=nx>DeleteConfigMap</span><span class=p>(</span><span class=nx>configMapName</span><span class=p>,</span><span class=w> </span><span class=nx>namespace</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-61-81 name=__codelineno-61-81 href=#__codelineno-61-81></a><span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>CoreV1</span><span class=p>().</span><span class=nx>ConfigMaps</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span><span class=nx>Delete</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>configMapName</span><span class=p>,</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>DeleteOptions</span><span class=p>{})</span>
<a id=__codelineno-61-82 name=__codelineno-61-82 href=#__codelineno-61-82></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-61-83 name=__codelineno-61-83 href=#__codelineno-61-83></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;删除ConfigMap失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-61-84 name=__codelineno-61-84 href=#__codelineno-61-84></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;删除ConfigMap失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-61-85 name=__codelineno-61-85 href=#__codelineno-61-85></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-61-86 name=__codelineno-61-86 href=#__codelineno-61-86></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-61-87 name=__codelineno-61-87 href=#__codelineno-61-87></a><span class=p>}</span>
<a id=__codelineno-61-88 name=__codelineno-61-88 href=#__codelineno-61-88></a>
<a id=__codelineno-61-89 name=__codelineno-61-89 href=#__codelineno-61-89></a><span class=c1>// UpdateConfigMap 更新configMap</span>
<a id=__codelineno-61-90 name=__codelineno-61-90 href=#__codelineno-61-90></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>c</span><span class=w> </span><span class=o>*</span><span class=nx>configMap</span><span class=p>)</span><span class=w> </span><span class=nx>UpdateConfigMap</span><span class=p>(</span><span class=nx>namespace</span><span class=p>,</span><span class=w> </span><span class=nx>content</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-61-91 name=__codelineno-61-91 href=#__codelineno-61-91></a><span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=nx>configMap</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>ConfigMap</span><span class=p>{}</span>
<a id=__codelineno-61-92 name=__codelineno-61-92 href=#__codelineno-61-92></a><span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>json</span><span class=p>.</span><span class=nx>Unmarshal</span><span class=p>([]</span><span class=nb>byte</span><span class=p>(</span><span class=nx>content</span><span class=p>),</span><span class=w> </span><span class=nx>configMap</span><span class=p>)</span>
<a id=__codelineno-61-93 name=__codelineno-61-93 href=#__codelineno-61-93></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-61-94 name=__codelineno-61-94 href=#__codelineno-61-94></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;反序列化失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-61-95 name=__codelineno-61-95 href=#__codelineno-61-95></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;反序列化失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-61-96 name=__codelineno-61-96 href=#__codelineno-61-96></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-61-97 name=__codelineno-61-97 href=#__codelineno-61-97></a><span class=w>    </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>CoreV1</span><span class=p>().</span><span class=nx>ConfigMaps</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span><span class=nx>Update</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>configMap</span><span class=p>,</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>UpdateOptions</span><span class=p>{})</span>
<a id=__codelineno-61-98 name=__codelineno-61-98 href=#__codelineno-61-98></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-61-99 name=__codelineno-61-99 href=#__codelineno-61-99></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;更新ConfigMap失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-61-100 name=__codelineno-61-100 href=#__codelineno-61-100></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;更新ConfigMap失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-61-101 name=__codelineno-61-101 href=#__codelineno-61-101></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-61-102 name=__codelineno-61-102 href=#__codelineno-61-102></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-61-103 name=__codelineno-61-103 href=#__codelineno-61-103></a><span class=p>}</span>
</code></pre></div> <h5 id=controllerconfigmapgo>controller/configmap.go<a class=headerlink href=#controllerconfigmapgo title="Permanent link">&para;</a></h5> <div class=highlight><pre><span></span><code><a id=__codelineno-62-1 name=__codelineno-62-1 href=#__codelineno-62-1></a><span class=kn>package</span><span class=w> </span><span class=nx>controller</span>
<a id=__codelineno-62-2 name=__codelineno-62-2 href=#__codelineno-62-2></a>
<a id=__codelineno-62-3 name=__codelineno-62-3 href=#__codelineno-62-3></a><span class=kn>import</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-62-4 name=__codelineno-62-4 href=#__codelineno-62-4></a><span class=w>    </span><span class=s>&quot;k8s-platform/service&quot;</span>
<a id=__codelineno-62-5 name=__codelineno-62-5 href=#__codelineno-62-5></a><span class=w>    </span><span class=s>&quot;net/http&quot;</span>
<a id=__codelineno-62-6 name=__codelineno-62-6 href=#__codelineno-62-6></a>
<a id=__codelineno-62-7 name=__codelineno-62-7 href=#__codelineno-62-7></a><span class=w>    </span><span class=s>&quot;github.com/gin-gonic/gin&quot;</span>
<a id=__codelineno-62-8 name=__codelineno-62-8 href=#__codelineno-62-8></a><span class=w>    </span><span class=s>&quot;github.com/wonderivan/logger&quot;</span>
<a id=__codelineno-62-9 name=__codelineno-62-9 href=#__codelineno-62-9></a><span class=p>)</span>
<a id=__codelineno-62-10 name=__codelineno-62-10 href=#__codelineno-62-10></a>
<a id=__codelineno-62-11 name=__codelineno-62-11 href=#__codelineno-62-11></a><span class=cm>/**</span>
<a id=__codelineno-62-12 name=__codelineno-62-12 href=#__codelineno-62-12></a><span class=cm> * @author 王子龙</span>
<a id=__codelineno-62-13 name=__codelineno-62-13 href=#__codelineno-62-13></a><span class=cm> * 时间：2022/10/3 11:30</span>
<a id=__codelineno-62-14 name=__codelineno-62-14 href=#__codelineno-62-14></a><span class=cm> */</span>
<a id=__codelineno-62-15 name=__codelineno-62-15 href=#__codelineno-62-15></a><span class=kd>type</span><span class=w> </span><span class=nx>configMap</span><span class=w> </span><span class=kd>struct</span><span class=p>{}</span>
<a id=__codelineno-62-16 name=__codelineno-62-16 href=#__codelineno-62-16></a>
<a id=__codelineno-62-17 name=__codelineno-62-17 href=#__codelineno-62-17></a><span class=kd>var</span><span class=w> </span><span class=nx>ConfigMap</span><span class=w> </span><span class=nx>configMap</span>
<a id=__codelineno-62-18 name=__codelineno-62-18 href=#__codelineno-62-18></a>
<a id=__codelineno-62-19 name=__codelineno-62-19 href=#__codelineno-62-19></a><span class=c1>//获取configmap列表，支持过滤、排序、分页</span>
<a id=__codelineno-62-20 name=__codelineno-62-20 href=#__codelineno-62-20></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>c</span><span class=w> </span><span class=o>*</span><span class=nx>configMap</span><span class=p>)</span><span class=w> </span><span class=nx>GetConfigMaps</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-62-21 name=__codelineno-62-21 href=#__codelineno-62-21></a><span class=w>    </span><span class=nx>params</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-62-22 name=__codelineno-62-22 href=#__codelineno-62-22></a><span class=w>        </span><span class=nx>FilterName</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`form:&quot;filter_name&quot;`</span>
<a id=__codelineno-62-23 name=__codelineno-62-23 href=#__codelineno-62-23></a><span class=w>        </span><span class=nx>Namespace</span><span class=w>  </span><span class=kt>string</span><span class=w> </span><span class=s>`form:&quot;namespace&quot;`</span>
<a id=__codelineno-62-24 name=__codelineno-62-24 href=#__codelineno-62-24></a><span class=w>        </span><span class=nx>Page</span><span class=w>       </span><span class=kt>int</span><span class=w>    </span><span class=s>`form:&quot;page&quot;`</span>
<a id=__codelineno-62-25 name=__codelineno-62-25 href=#__codelineno-62-25></a><span class=w>        </span><span class=nx>Limit</span><span class=w>      </span><span class=kt>int</span><span class=w>    </span><span class=s>`form:&quot;limit&quot;`</span>
<a id=__codelineno-62-26 name=__codelineno-62-26 href=#__codelineno-62-26></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-62-27 name=__codelineno-62-27 href=#__codelineno-62-27></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>Bind</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-62-28 name=__codelineno-62-28 href=#__codelineno-62-28></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-62-29 name=__codelineno-62-29 href=#__codelineno-62-29></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-62-30 name=__codelineno-62-30 href=#__codelineno-62-30></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-62-31 name=__codelineno-62-31 href=#__codelineno-62-31></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-62-32 name=__codelineno-62-32 href=#__codelineno-62-32></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-62-33 name=__codelineno-62-33 href=#__codelineno-62-33></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-62-34 name=__codelineno-62-34 href=#__codelineno-62-34></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-62-35 name=__codelineno-62-35 href=#__codelineno-62-35></a><span class=w>    </span><span class=nx>data</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>ConfigMap</span><span class=p>.</span><span class=nx>GetConfigMaps</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>FilterName</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Limit</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Page</span><span class=p>)</span>
<a id=__codelineno-62-36 name=__codelineno-62-36 href=#__codelineno-62-36></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-62-37 name=__codelineno-62-37 href=#__codelineno-62-37></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-62-38 name=__codelineno-62-38 href=#__codelineno-62-38></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-62-39 name=__codelineno-62-39 href=#__codelineno-62-39></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-62-40 name=__codelineno-62-40 href=#__codelineno-62-40></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-62-41 name=__codelineno-62-41 href=#__codelineno-62-41></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-62-42 name=__codelineno-62-42 href=#__codelineno-62-42></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-62-43 name=__codelineno-62-43 href=#__codelineno-62-43></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-62-44 name=__codelineno-62-44 href=#__codelineno-62-44></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;获取ConfigMap列表失败&quot;</span><span class=p>,</span>
<a id=__codelineno-62-45 name=__codelineno-62-45 href=#__codelineno-62-45></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=nx>data</span><span class=p>,</span>
<a id=__codelineno-62-46 name=__codelineno-62-46 href=#__codelineno-62-46></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-62-47 name=__codelineno-62-47 href=#__codelineno-62-47></a><span class=p>}</span>
<a id=__codelineno-62-48 name=__codelineno-62-48 href=#__codelineno-62-48></a>
<a id=__codelineno-62-49 name=__codelineno-62-49 href=#__codelineno-62-49></a><span class=c1>//获取configmap详情</span>
<a id=__codelineno-62-50 name=__codelineno-62-50 href=#__codelineno-62-50></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>c</span><span class=w> </span><span class=o>*</span><span class=nx>configMap</span><span class=p>)</span><span class=w> </span><span class=nx>GetConfigMapDetail</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-62-51 name=__codelineno-62-51 href=#__codelineno-62-51></a><span class=w>    </span><span class=nx>params</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-62-52 name=__codelineno-62-52 href=#__codelineno-62-52></a><span class=w>        </span><span class=nx>ConfigMapName</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`form:&quot;configmap_name&quot;`</span>
<a id=__codelineno-62-53 name=__codelineno-62-53 href=#__codelineno-62-53></a><span class=w>        </span><span class=nx>Namespace</span><span class=w>     </span><span class=kt>string</span><span class=w> </span><span class=s>`form:&quot;namespace&quot;`</span>
<a id=__codelineno-62-54 name=__codelineno-62-54 href=#__codelineno-62-54></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-62-55 name=__codelineno-62-55 href=#__codelineno-62-55></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>Bind</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-62-56 name=__codelineno-62-56 href=#__codelineno-62-56></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-62-57 name=__codelineno-62-57 href=#__codelineno-62-57></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-62-58 name=__codelineno-62-58 href=#__codelineno-62-58></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-62-59 name=__codelineno-62-59 href=#__codelineno-62-59></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-62-60 name=__codelineno-62-60 href=#__codelineno-62-60></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-62-61 name=__codelineno-62-61 href=#__codelineno-62-61></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-62-62 name=__codelineno-62-62 href=#__codelineno-62-62></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-62-63 name=__codelineno-62-63 href=#__codelineno-62-63></a><span class=w>    </span><span class=nx>data</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>ConfigMap</span><span class=p>.</span><span class=nx>GetConfigMapDetail</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>ConfigMapName</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>)</span>
<a id=__codelineno-62-64 name=__codelineno-62-64 href=#__codelineno-62-64></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-62-65 name=__codelineno-62-65 href=#__codelineno-62-65></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-62-66 name=__codelineno-62-66 href=#__codelineno-62-66></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-62-67 name=__codelineno-62-67 href=#__codelineno-62-67></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-62-68 name=__codelineno-62-68 href=#__codelineno-62-68></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-62-69 name=__codelineno-62-69 href=#__codelineno-62-69></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-62-70 name=__codelineno-62-70 href=#__codelineno-62-70></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-62-71 name=__codelineno-62-71 href=#__codelineno-62-71></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-62-72 name=__codelineno-62-72 href=#__codelineno-62-72></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;获取ConfigMap详情成功&quot;</span><span class=p>,</span>
<a id=__codelineno-62-73 name=__codelineno-62-73 href=#__codelineno-62-73></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=nx>data</span><span class=p>,</span>
<a id=__codelineno-62-74 name=__codelineno-62-74 href=#__codelineno-62-74></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-62-75 name=__codelineno-62-75 href=#__codelineno-62-75></a><span class=p>}</span>
<a id=__codelineno-62-76 name=__codelineno-62-76 href=#__codelineno-62-76></a>
<a id=__codelineno-62-77 name=__codelineno-62-77 href=#__codelineno-62-77></a><span class=c1>//删除configmap</span>
<a id=__codelineno-62-78 name=__codelineno-62-78 href=#__codelineno-62-78></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>c</span><span class=w> </span><span class=o>*</span><span class=nx>configMap</span><span class=p>)</span><span class=w> </span><span class=nx>DeleteConfigMap</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-62-79 name=__codelineno-62-79 href=#__codelineno-62-79></a><span class=w>    </span><span class=nx>params</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-62-80 name=__codelineno-62-80 href=#__codelineno-62-80></a><span class=w>        </span><span class=nx>ConfigMapName</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;configmap_name&quot;`</span>
<a id=__codelineno-62-81 name=__codelineno-62-81 href=#__codelineno-62-81></a><span class=w>        </span><span class=nx>Namespace</span><span class=w>     </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;namespace&quot;`</span>
<a id=__codelineno-62-82 name=__codelineno-62-82 href=#__codelineno-62-82></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-62-83 name=__codelineno-62-83 href=#__codelineno-62-83></a><span class=w>    </span><span class=c1>//DELETE请求，绑定参数方法改为ctx.ShouldBindJSON</span>
<a id=__codelineno-62-84 name=__codelineno-62-84 href=#__codelineno-62-84></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>ShouldBindJSON</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-62-85 name=__codelineno-62-85 href=#__codelineno-62-85></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-62-86 name=__codelineno-62-86 href=#__codelineno-62-86></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-62-87 name=__codelineno-62-87 href=#__codelineno-62-87></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-62-88 name=__codelineno-62-88 href=#__codelineno-62-88></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-62-89 name=__codelineno-62-89 href=#__codelineno-62-89></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-62-90 name=__codelineno-62-90 href=#__codelineno-62-90></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-62-91 name=__codelineno-62-91 href=#__codelineno-62-91></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-62-92 name=__codelineno-62-92 href=#__codelineno-62-92></a><span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>ConfigMap</span><span class=p>.</span><span class=nx>DeleteConfigMap</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>ConfigMapName</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>)</span>
<a id=__codelineno-62-93 name=__codelineno-62-93 href=#__codelineno-62-93></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-62-94 name=__codelineno-62-94 href=#__codelineno-62-94></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-62-95 name=__codelineno-62-95 href=#__codelineno-62-95></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-62-96 name=__codelineno-62-96 href=#__codelineno-62-96></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-62-97 name=__codelineno-62-97 href=#__codelineno-62-97></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-62-98 name=__codelineno-62-98 href=#__codelineno-62-98></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-62-99 name=__codelineno-62-99 href=#__codelineno-62-99></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-62-100 name=__codelineno-62-100 href=#__codelineno-62-100></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-62-101 name=__codelineno-62-101 href=#__codelineno-62-101></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;删除ConfigMap成功&quot;</span><span class=p>,</span>
<a id=__codelineno-62-102 name=__codelineno-62-102 href=#__codelineno-62-102></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-62-103 name=__codelineno-62-103 href=#__codelineno-62-103></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-62-104 name=__codelineno-62-104 href=#__codelineno-62-104></a><span class=p>}</span>
<a id=__codelineno-62-105 name=__codelineno-62-105 href=#__codelineno-62-105></a>
<a id=__codelineno-62-106 name=__codelineno-62-106 href=#__codelineno-62-106></a><span class=c1>//更新configmap</span>
<a id=__codelineno-62-107 name=__codelineno-62-107 href=#__codelineno-62-107></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>c</span><span class=w> </span><span class=o>*</span><span class=nx>configMap</span><span class=p>)</span><span class=w> </span><span class=nx>UpdateConfigMap</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-62-108 name=__codelineno-62-108 href=#__codelineno-62-108></a><span class=w>    </span><span class=nx>params</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-62-109 name=__codelineno-62-109 href=#__codelineno-62-109></a><span class=w>        </span><span class=nx>Namespace</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;namespace&quot;`</span>
<a id=__codelineno-62-110 name=__codelineno-62-110 href=#__codelineno-62-110></a><span class=w>        </span><span class=nx>Content</span><span class=w>   </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;content&quot;`</span>
<a id=__codelineno-62-111 name=__codelineno-62-111 href=#__codelineno-62-111></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-62-112 name=__codelineno-62-112 href=#__codelineno-62-112></a><span class=w>    </span><span class=c1>//PUT请求，绑定参数方法改为ctx.ShouldBindJSON</span>
<a id=__codelineno-62-113 name=__codelineno-62-113 href=#__codelineno-62-113></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>ShouldBindJSON</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-62-114 name=__codelineno-62-114 href=#__codelineno-62-114></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-62-115 name=__codelineno-62-115 href=#__codelineno-62-115></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-62-116 name=__codelineno-62-116 href=#__codelineno-62-116></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-62-117 name=__codelineno-62-117 href=#__codelineno-62-117></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-62-118 name=__codelineno-62-118 href=#__codelineno-62-118></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-62-119 name=__codelineno-62-119 href=#__codelineno-62-119></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-62-120 name=__codelineno-62-120 href=#__codelineno-62-120></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-62-121 name=__codelineno-62-121 href=#__codelineno-62-121></a><span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>ConfigMap</span><span class=p>.</span><span class=nx>UpdateConfigMap</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Content</span><span class=p>)</span>
<a id=__codelineno-62-122 name=__codelineno-62-122 href=#__codelineno-62-122></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-62-123 name=__codelineno-62-123 href=#__codelineno-62-123></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-62-124 name=__codelineno-62-124 href=#__codelineno-62-124></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-62-125 name=__codelineno-62-125 href=#__codelineno-62-125></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-62-126 name=__codelineno-62-126 href=#__codelineno-62-126></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-62-127 name=__codelineno-62-127 href=#__codelineno-62-127></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-62-128 name=__codelineno-62-128 href=#__codelineno-62-128></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-62-129 name=__codelineno-62-129 href=#__codelineno-62-129></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-62-130 name=__codelineno-62-130 href=#__codelineno-62-130></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;更新ConfigMap成功&quot;</span><span class=p>,</span>
<a id=__codelineno-62-131 name=__codelineno-62-131 href=#__codelineno-62-131></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-62-132 name=__codelineno-62-132 href=#__codelineno-62-132></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-62-133 name=__codelineno-62-133 href=#__codelineno-62-133></a><span class=p>}</span>
</code></pre></div> <h4 id=52-secret>5.2 Secret<a class=headerlink href=#52-secret title="Permanent link">&para;</a></h4> <table> <thead> <tr> <th>功能</th> <th>是否实现</th> </tr> </thead> <tbody> <tr> <td>Secret 列表</td> <td>√</td> </tr> <tr> <td>获取Secret详情</td> <td>√</td> </tr> <tr> <td>删除Secret</td> <td>√</td> </tr> <tr> <td>更新Secret</td> <td>√</td> </tr> </tbody> </table> <h5 id=servicedataselectorgo_9>service/dataselector.go<a class=headerlink href=#servicedataselectorgo_9 title="Permanent link">&para;</a></h5> <div class=highlight><pre><span></span><code><a id=__codelineno-63-1 name=__codelineno-63-1 href=#__codelineno-63-1></a><span class=c1>// 实现 Secret 的 DataCell接口</span>
<a id=__codelineno-63-2 name=__codelineno-63-2 href=#__codelineno-63-2></a><span class=kd>type</span><span class=w> </span><span class=nx>secretCell</span><span class=w> </span><span class=nx>corev1</span><span class=p>.</span><span class=nx>Secret</span>
<a id=__codelineno-63-3 name=__codelineno-63-3 href=#__codelineno-63-3></a>
<a id=__codelineno-63-4 name=__codelineno-63-4 href=#__codelineno-63-4></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>s</span><span class=w> </span><span class=nx>secretCell</span><span class=p>)</span><span class=w> </span><span class=nx>GetCreation</span><span class=p>()</span><span class=w> </span><span class=nx>time</span><span class=p>.</span><span class=nx>Time</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-63-5 name=__codelineno-63-5 href=#__codelineno-63-5></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>s</span><span class=p>.</span><span class=nx>CreationTimestamp</span><span class=p>.</span><span class=nx>Time</span>
<a id=__codelineno-63-6 name=__codelineno-63-6 href=#__codelineno-63-6></a><span class=p>}</span>
<a id=__codelineno-63-7 name=__codelineno-63-7 href=#__codelineno-63-7></a>
<a id=__codelineno-63-8 name=__codelineno-63-8 href=#__codelineno-63-8></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>s</span><span class=w> </span><span class=nx>secretCell</span><span class=p>)</span><span class=w> </span><span class=nx>GetName</span><span class=p>()</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-63-9 name=__codelineno-63-9 href=#__codelineno-63-9></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>s</span><span class=p>.</span><span class=nx>Name</span>
<a id=__codelineno-63-10 name=__codelineno-63-10 href=#__codelineno-63-10></a><span class=p>}</span>
</code></pre></div> <h5 id=servicesecretgo>service/secret.go<a class=headerlink href=#servicesecretgo title="Permanent link">&para;</a></h5> <div class=highlight><pre><span></span><code><a id=__codelineno-64-1 name=__codelineno-64-1 href=#__codelineno-64-1></a><span class=kn>package</span><span class=w> </span><span class=nx>service</span>
<a id=__codelineno-64-2 name=__codelineno-64-2 href=#__codelineno-64-2></a>
<a id=__codelineno-64-3 name=__codelineno-64-3 href=#__codelineno-64-3></a><span class=kn>import</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-64-4 name=__codelineno-64-4 href=#__codelineno-64-4></a><span class=w>    </span><span class=s>&quot;context&quot;</span>
<a id=__codelineno-64-5 name=__codelineno-64-5 href=#__codelineno-64-5></a><span class=w>    </span><span class=s>&quot;encoding/json&quot;</span>
<a id=__codelineno-64-6 name=__codelineno-64-6 href=#__codelineno-64-6></a><span class=w>    </span><span class=s>&quot;errors&quot;</span>
<a id=__codelineno-64-7 name=__codelineno-64-7 href=#__codelineno-64-7></a>
<a id=__codelineno-64-8 name=__codelineno-64-8 href=#__codelineno-64-8></a><span class=w>    </span><span class=s>&quot;github.com/wonderivan/logger&quot;</span>
<a id=__codelineno-64-9 name=__codelineno-64-9 href=#__codelineno-64-9></a><span class=w>    </span><span class=nx>corev1</span><span class=w> </span><span class=s>&quot;k8s.io/api/core/v1&quot;</span>
<a id=__codelineno-64-10 name=__codelineno-64-10 href=#__codelineno-64-10></a><span class=w>    </span><span class=nx>metav1</span><span class=w> </span><span class=s>&quot;k8s.io/apimachinery/pkg/apis/meta/v1&quot;</span>
<a id=__codelineno-64-11 name=__codelineno-64-11 href=#__codelineno-64-11></a><span class=p>)</span>
<a id=__codelineno-64-12 name=__codelineno-64-12 href=#__codelineno-64-12></a>
<a id=__codelineno-64-13 name=__codelineno-64-13 href=#__codelineno-64-13></a><span class=kd>var</span><span class=w> </span><span class=nx>Secret</span><span class=w> </span><span class=nx>secret</span>
<a id=__codelineno-64-14 name=__codelineno-64-14 href=#__codelineno-64-14></a>
<a id=__codelineno-64-15 name=__codelineno-64-15 href=#__codelineno-64-15></a><span class=kd>type</span><span class=w> </span><span class=nx>secret</span><span class=w> </span><span class=kd>struct</span><span class=p>{}</span>
<a id=__codelineno-64-16 name=__codelineno-64-16 href=#__codelineno-64-16></a>
<a id=__codelineno-64-17 name=__codelineno-64-17 href=#__codelineno-64-17></a><span class=kd>type</span><span class=w> </span><span class=nx>SecretsResp</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-64-18 name=__codelineno-64-18 href=#__codelineno-64-18></a><span class=w>    </span><span class=nx>Items</span><span class=w> </span><span class=p>[]</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>Secret</span><span class=w> </span><span class=s>`json:&quot;items&quot;`</span>
<a id=__codelineno-64-19 name=__codelineno-64-19 href=#__codelineno-64-19></a><span class=w>    </span><span class=nx>Total</span><span class=w> </span><span class=kt>int</span><span class=w>             </span><span class=s>`json:&quot;total&quot;`</span>
<a id=__codelineno-64-20 name=__codelineno-64-20 href=#__codelineno-64-20></a><span class=p>}</span>
<a id=__codelineno-64-21 name=__codelineno-64-21 href=#__codelineno-64-21></a>
<a id=__codelineno-64-22 name=__codelineno-64-22 href=#__codelineno-64-22></a><span class=c1>// GetSecrets 获取secret列表，支持过滤、排序、分页</span>
<a id=__codelineno-64-23 name=__codelineno-64-23 href=#__codelineno-64-23></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>s</span><span class=w> </span><span class=o>*</span><span class=nx>secret</span><span class=p>)</span><span class=w> </span><span class=nx>GetSecrets</span><span class=p>(</span><span class=nx>filterName</span><span class=p>,</span><span class=w> </span><span class=nx>namespace</span><span class=w> </span><span class=kt>string</span><span class=p>,</span><span class=w> </span><span class=nx>limit</span><span class=p>,</span><span class=w> </span><span class=nx>page</span><span class=w> </span><span class=kt>int</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>secretsResp</span><span class=w> </span><span class=o>*</span><span class=nx>SecretsResp</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-64-24 name=__codelineno-64-24 href=#__codelineno-64-24></a><span class=w>    </span><span class=c1>//获取secretList类型的secret列表</span>
<a id=__codelineno-64-25 name=__codelineno-64-25 href=#__codelineno-64-25></a><span class=w>    </span><span class=nx>secretList</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>CoreV1</span><span class=p>().</span><span class=nx>Secrets</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span><span class=nx>List</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>ListOptions</span><span class=p>{})</span>
<a id=__codelineno-64-26 name=__codelineno-64-26 href=#__codelineno-64-26></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-64-27 name=__codelineno-64-27 href=#__codelineno-64-27></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取Secret列表失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-64-28 name=__codelineno-64-28 href=#__codelineno-64-28></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取Secret列表失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-64-29 name=__codelineno-64-29 href=#__codelineno-64-29></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-64-30 name=__codelineno-64-30 href=#__codelineno-64-30></a><span class=w>    </span><span class=c1>//将secretList中的secret列表(Items)，放进dataselector对象中，进行排序</span>
<a id=__codelineno-64-31 name=__codelineno-64-31 href=#__codelineno-64-31></a><span class=w>    </span><span class=nx>selectableData</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>dataSelector</span><span class=p>{</span>
<a id=__codelineno-64-32 name=__codelineno-64-32 href=#__codelineno-64-32></a><span class=w>        </span><span class=nx>GenericDataList</span><span class=p>:</span><span class=w> </span><span class=nx>s</span><span class=p>.</span><span class=nx>toCells</span><span class=p>(</span><span class=nx>secretList</span><span class=p>.</span><span class=nx>Items</span><span class=p>),</span>
<a id=__codelineno-64-33 name=__codelineno-64-33 href=#__codelineno-64-33></a><span class=w>        </span><span class=nx>dataSelectQuery</span><span class=p>:</span><span class=w> </span><span class=o>&amp;</span><span class=nx>DataSelectQuery</span><span class=p>{</span>
<a id=__codelineno-64-34 name=__codelineno-64-34 href=#__codelineno-64-34></a><span class=w>            </span><span class=nx>FilterQuery</span><span class=p>:</span><span class=w> </span><span class=o>&amp;</span><span class=nx>FilterQuery</span><span class=p>{</span><span class=nx>Name</span><span class=p>:</span><span class=w> </span><span class=nx>filterName</span><span class=p>},</span>
<a id=__codelineno-64-35 name=__codelineno-64-35 href=#__codelineno-64-35></a><span class=w>            </span><span class=nx>PaginateQuery</span><span class=p>:</span><span class=w> </span><span class=o>&amp;</span><span class=nx>PaginateQuery</span><span class=p>{</span>
<a id=__codelineno-64-36 name=__codelineno-64-36 href=#__codelineno-64-36></a><span class=w>                </span><span class=nx>Limit</span><span class=p>:</span><span class=w> </span><span class=nx>limit</span><span class=p>,</span>
<a id=__codelineno-64-37 name=__codelineno-64-37 href=#__codelineno-64-37></a><span class=w>                </span><span class=nx>Page</span><span class=p>:</span><span class=w>  </span><span class=nx>page</span><span class=p>,</span>
<a id=__codelineno-64-38 name=__codelineno-64-38 href=#__codelineno-64-38></a><span class=w>            </span><span class=p>},</span>
<a id=__codelineno-64-39 name=__codelineno-64-39 href=#__codelineno-64-39></a><span class=w>        </span><span class=p>},</span>
<a id=__codelineno-64-40 name=__codelineno-64-40 href=#__codelineno-64-40></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-64-41 name=__codelineno-64-41 href=#__codelineno-64-41></a>
<a id=__codelineno-64-42 name=__codelineno-64-42 href=#__codelineno-64-42></a><span class=w>    </span><span class=nx>filtered</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>selectableData</span><span class=p>.</span><span class=nx>Filter</span><span class=p>()</span>
<a id=__codelineno-64-43 name=__codelineno-64-43 href=#__codelineno-64-43></a><span class=w>    </span><span class=nx>total</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>filtered</span><span class=p>.</span><span class=nx>GenericDataList</span><span class=p>)</span>
<a id=__codelineno-64-44 name=__codelineno-64-44 href=#__codelineno-64-44></a><span class=w>    </span><span class=nx>data</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>filtered</span><span class=p>.</span><span class=nx>Sort</span><span class=p>().</span><span class=nx>Paginate</span><span class=p>()</span>
<a id=__codelineno-64-45 name=__codelineno-64-45 href=#__codelineno-64-45></a>
<a id=__codelineno-64-46 name=__codelineno-64-46 href=#__codelineno-64-46></a><span class=w>    </span><span class=c1>//将[]DataCell类型的secret列表转为v1.secret列表</span>
<a id=__codelineno-64-47 name=__codelineno-64-47 href=#__codelineno-64-47></a><span class=w>    </span><span class=nx>secrets</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>s</span><span class=p>.</span><span class=nx>fromCells</span><span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>GenericDataList</span><span class=p>)</span>
<a id=__codelineno-64-48 name=__codelineno-64-48 href=#__codelineno-64-48></a>
<a id=__codelineno-64-49 name=__codelineno-64-49 href=#__codelineno-64-49></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=o>&amp;</span><span class=nx>SecretsResp</span><span class=p>{</span>
<a id=__codelineno-64-50 name=__codelineno-64-50 href=#__codelineno-64-50></a><span class=w>        </span><span class=nx>Items</span><span class=p>:</span><span class=w> </span><span class=nx>secrets</span><span class=p>,</span>
<a id=__codelineno-64-51 name=__codelineno-64-51 href=#__codelineno-64-51></a><span class=w>        </span><span class=nx>Total</span><span class=p>:</span><span class=w> </span><span class=nx>total</span><span class=p>,</span>
<a id=__codelineno-64-52 name=__codelineno-64-52 href=#__codelineno-64-52></a><span class=w>    </span><span class=p>},</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-64-53 name=__codelineno-64-53 href=#__codelineno-64-53></a><span class=p>}</span>
<a id=__codelineno-64-54 name=__codelineno-64-54 href=#__codelineno-64-54></a>
<a id=__codelineno-64-55 name=__codelineno-64-55 href=#__codelineno-64-55></a><span class=c1>// GetSecretDetail 获取secret详情</span>
<a id=__codelineno-64-56 name=__codelineno-64-56 href=#__codelineno-64-56></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>s</span><span class=w> </span><span class=o>*</span><span class=nx>secret</span><span class=p>)</span><span class=w> </span><span class=nx>GetSecretDetail</span><span class=p>(</span><span class=nx>secretName</span><span class=p>,</span><span class=w> </span><span class=nx>namespace</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>secret</span><span class=w> </span><span class=o>*</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>Secret</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-64-57 name=__codelineno-64-57 href=#__codelineno-64-57></a><span class=w>    </span><span class=nx>secret</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>CoreV1</span><span class=p>().</span><span class=nx>Secrets</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span><span class=nx>Get</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>secretName</span><span class=p>,</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>GetOptions</span><span class=p>{})</span>
<a id=__codelineno-64-58 name=__codelineno-64-58 href=#__codelineno-64-58></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-64-59 name=__codelineno-64-59 href=#__codelineno-64-59></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取Secret详情失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-64-60 name=__codelineno-64-60 href=#__codelineno-64-60></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取Secret详情失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-64-61 name=__codelineno-64-61 href=#__codelineno-64-61></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-64-62 name=__codelineno-64-62 href=#__codelineno-64-62></a>
<a id=__codelineno-64-63 name=__codelineno-64-63 href=#__codelineno-64-63></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>secret</span><span class=p>,</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-64-64 name=__codelineno-64-64 href=#__codelineno-64-64></a><span class=p>}</span>
<a id=__codelineno-64-65 name=__codelineno-64-65 href=#__codelineno-64-65></a>
<a id=__codelineno-64-66 name=__codelineno-64-66 href=#__codelineno-64-66></a><span class=c1>// DeleteSecret 删除secret</span>
<a id=__codelineno-64-67 name=__codelineno-64-67 href=#__codelineno-64-67></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>s</span><span class=w> </span><span class=o>*</span><span class=nx>secret</span><span class=p>)</span><span class=w> </span><span class=nx>DeleteSecret</span><span class=p>(</span><span class=nx>secretName</span><span class=p>,</span><span class=w> </span><span class=nx>namespace</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-64-68 name=__codelineno-64-68 href=#__codelineno-64-68></a><span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>CoreV1</span><span class=p>().</span><span class=nx>Secrets</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span><span class=nx>Delete</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>secretName</span><span class=p>,</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>DeleteOptions</span><span class=p>{})</span>
<a id=__codelineno-64-69 name=__codelineno-64-69 href=#__codelineno-64-69></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-64-70 name=__codelineno-64-70 href=#__codelineno-64-70></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;删除Secret失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-64-71 name=__codelineno-64-71 href=#__codelineno-64-71></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;删除Secret失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-64-72 name=__codelineno-64-72 href=#__codelineno-64-72></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-64-73 name=__codelineno-64-73 href=#__codelineno-64-73></a>
<a id=__codelineno-64-74 name=__codelineno-64-74 href=#__codelineno-64-74></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-64-75 name=__codelineno-64-75 href=#__codelineno-64-75></a><span class=p>}</span>
<a id=__codelineno-64-76 name=__codelineno-64-76 href=#__codelineno-64-76></a>
<a id=__codelineno-64-77 name=__codelineno-64-77 href=#__codelineno-64-77></a><span class=c1>// UpdateSecret 更新secret</span>
<a id=__codelineno-64-78 name=__codelineno-64-78 href=#__codelineno-64-78></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>s</span><span class=w> </span><span class=o>*</span><span class=nx>secret</span><span class=p>)</span><span class=w> </span><span class=nx>UpdateSecret</span><span class=p>(</span><span class=nx>namespace</span><span class=p>,</span><span class=w> </span><span class=nx>content</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-64-79 name=__codelineno-64-79 href=#__codelineno-64-79></a><span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=nx>secret</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>Secret</span><span class=p>{}</span>
<a id=__codelineno-64-80 name=__codelineno-64-80 href=#__codelineno-64-80></a>
<a id=__codelineno-64-81 name=__codelineno-64-81 href=#__codelineno-64-81></a><span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>json</span><span class=p>.</span><span class=nx>Unmarshal</span><span class=p>([]</span><span class=nb>byte</span><span class=p>(</span><span class=nx>content</span><span class=p>),</span><span class=w> </span><span class=nx>secret</span><span class=p>)</span>
<a id=__codelineno-64-82 name=__codelineno-64-82 href=#__codelineno-64-82></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-64-83 name=__codelineno-64-83 href=#__codelineno-64-83></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;反序列化失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-64-84 name=__codelineno-64-84 href=#__codelineno-64-84></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;反序列化失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-64-85 name=__codelineno-64-85 href=#__codelineno-64-85></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-64-86 name=__codelineno-64-86 href=#__codelineno-64-86></a>
<a id=__codelineno-64-87 name=__codelineno-64-87 href=#__codelineno-64-87></a><span class=w>    </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>CoreV1</span><span class=p>().</span><span class=nx>Secrets</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span><span class=nx>Update</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>secret</span><span class=p>,</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>UpdateOptions</span><span class=p>{})</span>
<a id=__codelineno-64-88 name=__codelineno-64-88 href=#__codelineno-64-88></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-64-89 name=__codelineno-64-89 href=#__codelineno-64-89></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;更新Secret失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-64-90 name=__codelineno-64-90 href=#__codelineno-64-90></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;更新Secret失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-64-91 name=__codelineno-64-91 href=#__codelineno-64-91></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-64-92 name=__codelineno-64-92 href=#__codelineno-64-92></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-64-93 name=__codelineno-64-93 href=#__codelineno-64-93></a><span class=p>}</span>
<a id=__codelineno-64-94 name=__codelineno-64-94 href=#__codelineno-64-94></a>
<a id=__codelineno-64-95 name=__codelineno-64-95 href=#__codelineno-64-95></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>s</span><span class=w> </span><span class=o>*</span><span class=nx>secret</span><span class=p>)</span><span class=w> </span><span class=nx>toCells</span><span class=p>(</span><span class=nx>std</span><span class=w> </span><span class=p>[]</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>Secret</span><span class=p>)</span><span class=w> </span><span class=p>[]</span><span class=nx>DataCell</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-64-96 name=__codelineno-64-96 href=#__codelineno-64-96></a><span class=w>    </span><span class=nx>cells</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>make</span><span class=p>([]</span><span class=nx>DataCell</span><span class=p>,</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>std</span><span class=p>))</span>
<a id=__codelineno-64-97 name=__codelineno-64-97 href=#__codelineno-64-97></a><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=nx>i</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>std</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-64-98 name=__codelineno-64-98 href=#__codelineno-64-98></a><span class=w>        </span><span class=nx>cells</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>secretCell</span><span class=p>(</span><span class=nx>std</span><span class=p>[</span><span class=nx>i</span><span class=p>])</span>
<a id=__codelineno-64-99 name=__codelineno-64-99 href=#__codelineno-64-99></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-64-100 name=__codelineno-64-100 href=#__codelineno-64-100></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>cells</span>
<a id=__codelineno-64-101 name=__codelineno-64-101 href=#__codelineno-64-101></a><span class=p>}</span>
<a id=__codelineno-64-102 name=__codelineno-64-102 href=#__codelineno-64-102></a>
<a id=__codelineno-64-103 name=__codelineno-64-103 href=#__codelineno-64-103></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>s</span><span class=w> </span><span class=o>*</span><span class=nx>secret</span><span class=p>)</span><span class=w> </span><span class=nx>fromCells</span><span class=p>(</span><span class=nx>cells</span><span class=w> </span><span class=p>[]</span><span class=nx>DataCell</span><span class=p>)</span><span class=w> </span><span class=p>[]</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>Secret</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-64-104 name=__codelineno-64-104 href=#__codelineno-64-104></a><span class=w>    </span><span class=nx>secrets</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>make</span><span class=p>([]</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>Secret</span><span class=p>,</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>cells</span><span class=p>))</span>
<a id=__codelineno-64-105 name=__codelineno-64-105 href=#__codelineno-64-105></a><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=nx>i</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>cells</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-64-106 name=__codelineno-64-106 href=#__codelineno-64-106></a><span class=w>        </span><span class=nx>secrets</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>corev1</span><span class=p>.</span><span class=nx>Secret</span><span class=p>(</span><span class=nx>cells</span><span class=p>[</span><span class=nx>i</span><span class=p>].(</span><span class=nx>secretCell</span><span class=p>))</span>
<a id=__codelineno-64-107 name=__codelineno-64-107 href=#__codelineno-64-107></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-64-108 name=__codelineno-64-108 href=#__codelineno-64-108></a>
<a id=__codelineno-64-109 name=__codelineno-64-109 href=#__codelineno-64-109></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>secrets</span>
<a id=__codelineno-64-110 name=__codelineno-64-110 href=#__codelineno-64-110></a><span class=p>}</span>
</code></pre></div> <h5 id=contrllersecretgo>contrller/secret.go<a class=headerlink href=#contrllersecretgo title="Permanent link">&para;</a></h5> <div class=highlight><pre><span></span><code><a id=__codelineno-65-1 name=__codelineno-65-1 href=#__codelineno-65-1></a><span class=kn>package</span><span class=w> </span><span class=nx>controller</span>
<a id=__codelineno-65-2 name=__codelineno-65-2 href=#__codelineno-65-2></a>
<a id=__codelineno-65-3 name=__codelineno-65-3 href=#__codelineno-65-3></a><span class=kn>import</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-65-4 name=__codelineno-65-4 href=#__codelineno-65-4></a><span class=w>    </span><span class=s>&quot;gitee.com/hujianli94net/k8s-platform/service&quot;</span>
<a id=__codelineno-65-5 name=__codelineno-65-5 href=#__codelineno-65-5></a><span class=w>    </span><span class=s>&quot;net/http&quot;</span>
<a id=__codelineno-65-6 name=__codelineno-65-6 href=#__codelineno-65-6></a>
<a id=__codelineno-65-7 name=__codelineno-65-7 href=#__codelineno-65-7></a><span class=w>    </span><span class=s>&quot;github.com/gin-gonic/gin&quot;</span>
<a id=__codelineno-65-8 name=__codelineno-65-8 href=#__codelineno-65-8></a><span class=w>    </span><span class=s>&quot;github.com/wonderivan/logger&quot;</span>
<a id=__codelineno-65-9 name=__codelineno-65-9 href=#__codelineno-65-9></a><span class=p>)</span>
<a id=__codelineno-65-10 name=__codelineno-65-10 href=#__codelineno-65-10></a>
<a id=__codelineno-65-11 name=__codelineno-65-11 href=#__codelineno-65-11></a><span class=kd>var</span><span class=w> </span><span class=nx>Secret</span><span class=w> </span><span class=nx>secret</span>
<a id=__codelineno-65-12 name=__codelineno-65-12 href=#__codelineno-65-12></a>
<a id=__codelineno-65-13 name=__codelineno-65-13 href=#__codelineno-65-13></a><span class=kd>type</span><span class=w> </span><span class=nx>secret</span><span class=w> </span><span class=kd>struct</span><span class=p>{}</span>
<a id=__codelineno-65-14 name=__codelineno-65-14 href=#__codelineno-65-14></a>
<a id=__codelineno-65-15 name=__codelineno-65-15 href=#__codelineno-65-15></a><span class=c1>// GetSecrets 获取secret列表，支持过滤、排序、分页</span>
<a id=__codelineno-65-16 name=__codelineno-65-16 href=#__codelineno-65-16></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>s</span><span class=w> </span><span class=o>*</span><span class=nx>secret</span><span class=p>)</span><span class=w> </span><span class=nx>GetSecrets</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-65-17 name=__codelineno-65-17 href=#__codelineno-65-17></a><span class=w>    </span><span class=nx>params</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-65-18 name=__codelineno-65-18 href=#__codelineno-65-18></a><span class=w>        </span><span class=nx>FilterName</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`form:&quot;filter_name&quot;`</span>
<a id=__codelineno-65-19 name=__codelineno-65-19 href=#__codelineno-65-19></a><span class=w>        </span><span class=nx>Namespace</span><span class=w>  </span><span class=kt>string</span><span class=w> </span><span class=s>`form:&quot;namespace&quot;`</span>
<a id=__codelineno-65-20 name=__codelineno-65-20 href=#__codelineno-65-20></a><span class=w>        </span><span class=nx>Page</span><span class=w>       </span><span class=kt>int</span><span class=w>    </span><span class=s>`form:&quot;page&quot;`</span>
<a id=__codelineno-65-21 name=__codelineno-65-21 href=#__codelineno-65-21></a><span class=w>        </span><span class=nx>Limit</span><span class=w>      </span><span class=kt>int</span><span class=w>    </span><span class=s>`form:&quot;limit&quot;`</span>
<a id=__codelineno-65-22 name=__codelineno-65-22 href=#__codelineno-65-22></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-65-23 name=__codelineno-65-23 href=#__codelineno-65-23></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>Bind</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-65-24 name=__codelineno-65-24 href=#__codelineno-65-24></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-65-25 name=__codelineno-65-25 href=#__codelineno-65-25></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-65-26 name=__codelineno-65-26 href=#__codelineno-65-26></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-65-27 name=__codelineno-65-27 href=#__codelineno-65-27></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-65-28 name=__codelineno-65-28 href=#__codelineno-65-28></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-65-29 name=__codelineno-65-29 href=#__codelineno-65-29></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-65-30 name=__codelineno-65-30 href=#__codelineno-65-30></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-65-31 name=__codelineno-65-31 href=#__codelineno-65-31></a>
<a id=__codelineno-65-32 name=__codelineno-65-32 href=#__codelineno-65-32></a><span class=w>    </span><span class=nx>data</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>Secret</span><span class=p>.</span><span class=nx>GetSecrets</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>FilterName</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Limit</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Page</span><span class=p>)</span>
<a id=__codelineno-65-33 name=__codelineno-65-33 href=#__codelineno-65-33></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-65-34 name=__codelineno-65-34 href=#__codelineno-65-34></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-65-35 name=__codelineno-65-35 href=#__codelineno-65-35></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-65-36 name=__codelineno-65-36 href=#__codelineno-65-36></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-65-37 name=__codelineno-65-37 href=#__codelineno-65-37></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-65-38 name=__codelineno-65-38 href=#__codelineno-65-38></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-65-39 name=__codelineno-65-39 href=#__codelineno-65-39></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-65-40 name=__codelineno-65-40 href=#__codelineno-65-40></a>
<a id=__codelineno-65-41 name=__codelineno-65-41 href=#__codelineno-65-41></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-65-42 name=__codelineno-65-42 href=#__codelineno-65-42></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;获取Secret列表成功&quot;</span><span class=p>,</span>
<a id=__codelineno-65-43 name=__codelineno-65-43 href=#__codelineno-65-43></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=nx>data</span><span class=p>,</span>
<a id=__codelineno-65-44 name=__codelineno-65-44 href=#__codelineno-65-44></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-65-45 name=__codelineno-65-45 href=#__codelineno-65-45></a><span class=p>}</span>
<a id=__codelineno-65-46 name=__codelineno-65-46 href=#__codelineno-65-46></a>
<a id=__codelineno-65-47 name=__codelineno-65-47 href=#__codelineno-65-47></a><span class=c1>// GetSecretDetail 获取secret详情</span>
<a id=__codelineno-65-48 name=__codelineno-65-48 href=#__codelineno-65-48></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>s</span><span class=w> </span><span class=o>*</span><span class=nx>secret</span><span class=p>)</span><span class=w> </span><span class=nx>GetSecretDetail</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-65-49 name=__codelineno-65-49 href=#__codelineno-65-49></a><span class=w>    </span><span class=nx>params</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-65-50 name=__codelineno-65-50 href=#__codelineno-65-50></a><span class=w>        </span><span class=nx>SecretName</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`form:&quot;secret_name&quot;`</span>
<a id=__codelineno-65-51 name=__codelineno-65-51 href=#__codelineno-65-51></a><span class=w>        </span><span class=nx>Namespace</span><span class=w>  </span><span class=kt>string</span><span class=w> </span><span class=s>`form:&quot;namespace&quot;`</span>
<a id=__codelineno-65-52 name=__codelineno-65-52 href=#__codelineno-65-52></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-65-53 name=__codelineno-65-53 href=#__codelineno-65-53></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>Bind</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-65-54 name=__codelineno-65-54 href=#__codelineno-65-54></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-65-55 name=__codelineno-65-55 href=#__codelineno-65-55></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-65-56 name=__codelineno-65-56 href=#__codelineno-65-56></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-65-57 name=__codelineno-65-57 href=#__codelineno-65-57></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-65-58 name=__codelineno-65-58 href=#__codelineno-65-58></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-65-59 name=__codelineno-65-59 href=#__codelineno-65-59></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-65-60 name=__codelineno-65-60 href=#__codelineno-65-60></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-65-61 name=__codelineno-65-61 href=#__codelineno-65-61></a>
<a id=__codelineno-65-62 name=__codelineno-65-62 href=#__codelineno-65-62></a><span class=w>    </span><span class=nx>data</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>Secret</span><span class=p>.</span><span class=nx>GetSecretDetail</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>SecretName</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>)</span>
<a id=__codelineno-65-63 name=__codelineno-65-63 href=#__codelineno-65-63></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-65-64 name=__codelineno-65-64 href=#__codelineno-65-64></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-65-65 name=__codelineno-65-65 href=#__codelineno-65-65></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-65-66 name=__codelineno-65-66 href=#__codelineno-65-66></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-65-67 name=__codelineno-65-67 href=#__codelineno-65-67></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-65-68 name=__codelineno-65-68 href=#__codelineno-65-68></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-65-69 name=__codelineno-65-69 href=#__codelineno-65-69></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-65-70 name=__codelineno-65-70 href=#__codelineno-65-70></a>
<a id=__codelineno-65-71 name=__codelineno-65-71 href=#__codelineno-65-71></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-65-72 name=__codelineno-65-72 href=#__codelineno-65-72></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;获取Secret详情成功&quot;</span><span class=p>,</span>
<a id=__codelineno-65-73 name=__codelineno-65-73 href=#__codelineno-65-73></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=nx>data</span><span class=p>,</span>
<a id=__codelineno-65-74 name=__codelineno-65-74 href=#__codelineno-65-74></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-65-75 name=__codelineno-65-75 href=#__codelineno-65-75></a><span class=p>}</span>
<a id=__codelineno-65-76 name=__codelineno-65-76 href=#__codelineno-65-76></a>
<a id=__codelineno-65-77 name=__codelineno-65-77 href=#__codelineno-65-77></a><span class=c1>// DeleteSecret 删除secret</span>
<a id=__codelineno-65-78 name=__codelineno-65-78 href=#__codelineno-65-78></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>s</span><span class=w> </span><span class=o>*</span><span class=nx>secret</span><span class=p>)</span><span class=w> </span><span class=nx>DeleteSecret</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-65-79 name=__codelineno-65-79 href=#__codelineno-65-79></a><span class=w>    </span><span class=nx>params</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-65-80 name=__codelineno-65-80 href=#__codelineno-65-80></a><span class=w>        </span><span class=nx>SecretName</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;secret_name&quot;`</span>
<a id=__codelineno-65-81 name=__codelineno-65-81 href=#__codelineno-65-81></a><span class=w>        </span><span class=nx>Namespace</span><span class=w>  </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;namespace&quot;`</span>
<a id=__codelineno-65-82 name=__codelineno-65-82 href=#__codelineno-65-82></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-65-83 name=__codelineno-65-83 href=#__codelineno-65-83></a><span class=w>    </span><span class=c1>//DELETE请求，绑定参数方法改为ctx.ShouldBindJSON</span>
<a id=__codelineno-65-84 name=__codelineno-65-84 href=#__codelineno-65-84></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>ShouldBindJSON</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-65-85 name=__codelineno-65-85 href=#__codelineno-65-85></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-65-86 name=__codelineno-65-86 href=#__codelineno-65-86></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-65-87 name=__codelineno-65-87 href=#__codelineno-65-87></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-65-88 name=__codelineno-65-88 href=#__codelineno-65-88></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-65-89 name=__codelineno-65-89 href=#__codelineno-65-89></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-65-90 name=__codelineno-65-90 href=#__codelineno-65-90></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-65-91 name=__codelineno-65-91 href=#__codelineno-65-91></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-65-92 name=__codelineno-65-92 href=#__codelineno-65-92></a>
<a id=__codelineno-65-93 name=__codelineno-65-93 href=#__codelineno-65-93></a><span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>Secret</span><span class=p>.</span><span class=nx>DeleteSecret</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>SecretName</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>)</span>
<a id=__codelineno-65-94 name=__codelineno-65-94 href=#__codelineno-65-94></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-65-95 name=__codelineno-65-95 href=#__codelineno-65-95></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-65-96 name=__codelineno-65-96 href=#__codelineno-65-96></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-65-97 name=__codelineno-65-97 href=#__codelineno-65-97></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-65-98 name=__codelineno-65-98 href=#__codelineno-65-98></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-65-99 name=__codelineno-65-99 href=#__codelineno-65-99></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-65-100 name=__codelineno-65-100 href=#__codelineno-65-100></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-65-101 name=__codelineno-65-101 href=#__codelineno-65-101></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-65-102 name=__codelineno-65-102 href=#__codelineno-65-102></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;删除Secret成功&quot;</span><span class=p>,</span>
<a id=__codelineno-65-103 name=__codelineno-65-103 href=#__codelineno-65-103></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-65-104 name=__codelineno-65-104 href=#__codelineno-65-104></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-65-105 name=__codelineno-65-105 href=#__codelineno-65-105></a><span class=p>}</span>
<a id=__codelineno-65-106 name=__codelineno-65-106 href=#__codelineno-65-106></a>
<a id=__codelineno-65-107 name=__codelineno-65-107 href=#__codelineno-65-107></a><span class=c1>// UpdateSecret 更新secret</span>
<a id=__codelineno-65-108 name=__codelineno-65-108 href=#__codelineno-65-108></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>s</span><span class=w> </span><span class=o>*</span><span class=nx>secret</span><span class=p>)</span><span class=w> </span><span class=nx>UpdateSecret</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-65-109 name=__codelineno-65-109 href=#__codelineno-65-109></a><span class=w>    </span><span class=nx>params</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-65-110 name=__codelineno-65-110 href=#__codelineno-65-110></a><span class=w>        </span><span class=nx>Namespace</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;namespace&quot;`</span>
<a id=__codelineno-65-111 name=__codelineno-65-111 href=#__codelineno-65-111></a><span class=w>        </span><span class=nx>Content</span><span class=w>   </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;content&quot;`</span>
<a id=__codelineno-65-112 name=__codelineno-65-112 href=#__codelineno-65-112></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-65-113 name=__codelineno-65-113 href=#__codelineno-65-113></a><span class=w>    </span><span class=c1>//PUT请求，绑定参数方法改为ctx.ShouldBindJSON</span>
<a id=__codelineno-65-114 name=__codelineno-65-114 href=#__codelineno-65-114></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>ShouldBindJSON</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-65-115 name=__codelineno-65-115 href=#__codelineno-65-115></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-65-116 name=__codelineno-65-116 href=#__codelineno-65-116></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-65-117 name=__codelineno-65-117 href=#__codelineno-65-117></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-65-118 name=__codelineno-65-118 href=#__codelineno-65-118></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-65-119 name=__codelineno-65-119 href=#__codelineno-65-119></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-65-120 name=__codelineno-65-120 href=#__codelineno-65-120></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-65-121 name=__codelineno-65-121 href=#__codelineno-65-121></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-65-122 name=__codelineno-65-122 href=#__codelineno-65-122></a>
<a id=__codelineno-65-123 name=__codelineno-65-123 href=#__codelineno-65-123></a><span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>Secret</span><span class=p>.</span><span class=nx>UpdateSecret</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Content</span><span class=p>)</span>
<a id=__codelineno-65-124 name=__codelineno-65-124 href=#__codelineno-65-124></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-65-125 name=__codelineno-65-125 href=#__codelineno-65-125></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-65-126 name=__codelineno-65-126 href=#__codelineno-65-126></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-65-127 name=__codelineno-65-127 href=#__codelineno-65-127></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-65-128 name=__codelineno-65-128 href=#__codelineno-65-128></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-65-129 name=__codelineno-65-129 href=#__codelineno-65-129></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-65-130 name=__codelineno-65-130 href=#__codelineno-65-130></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-65-131 name=__codelineno-65-131 href=#__codelineno-65-131></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-65-132 name=__codelineno-65-132 href=#__codelineno-65-132></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;更新Secret成功&quot;</span><span class=p>,</span>
<a id=__codelineno-65-133 name=__codelineno-65-133 href=#__codelineno-65-133></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-65-134 name=__codelineno-65-134 href=#__codelineno-65-134></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-65-135 name=__codelineno-65-135 href=#__codelineno-65-135></a><span class=p>}</span>
</code></pre></div> <h4 id=53-persistentvolumeclaim>5.3 PersistentVolumeClaim<a class=headerlink href=#53-persistentvolumeclaim title="Permanent link">&para;</a></h4> <table> <thead> <tr> <th>功能</th> <th>是否实现</th> </tr> </thead> <tbody> <tr> <td>PersistentVolumeClaim 列表</td> <td>√</td> </tr> <tr> <td>获取PersistentVolumeClaim详情</td> <td>√</td> </tr> <tr> <td>删除PersistentVolumeClaim</td> <td>√</td> </tr> <tr> <td>更新PersistentVolumeClaim</td> <td>√</td> </tr> </tbody> </table> <h5 id=servicedataselectorgo_10>service/dataselector.go<a class=headerlink href=#servicedataselectorgo_10 title="Permanent link">&para;</a></h5> <div class=highlight><pre><span></span><code><a id=__codelineno-66-1 name=__codelineno-66-1 href=#__codelineno-66-1></a>
</code></pre></div> <h5 id=servicepvcgo>service/pvc.go<a class=headerlink href=#servicepvcgo title="Permanent link">&para;</a></h5> <div class=highlight><pre><span></span><code><a id=__codelineno-67-1 name=__codelineno-67-1 href=#__codelineno-67-1></a><span class=kn>package</span><span class=w> </span><span class=nx>service</span>
<a id=__codelineno-67-2 name=__codelineno-67-2 href=#__codelineno-67-2></a>
<a id=__codelineno-67-3 name=__codelineno-67-3 href=#__codelineno-67-3></a><span class=kn>import</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-67-4 name=__codelineno-67-4 href=#__codelineno-67-4></a><span class=w>    </span><span class=s>&quot;context&quot;</span>
<a id=__codelineno-67-5 name=__codelineno-67-5 href=#__codelineno-67-5></a><span class=w>    </span><span class=s>&quot;encoding/json&quot;</span>
<a id=__codelineno-67-6 name=__codelineno-67-6 href=#__codelineno-67-6></a><span class=w>    </span><span class=s>&quot;errors&quot;</span>
<a id=__codelineno-67-7 name=__codelineno-67-7 href=#__codelineno-67-7></a>
<a id=__codelineno-67-8 name=__codelineno-67-8 href=#__codelineno-67-8></a><span class=w>    </span><span class=s>&quot;github.com/wonderivan/logger&quot;</span>
<a id=__codelineno-67-9 name=__codelineno-67-9 href=#__codelineno-67-9></a><span class=w>    </span><span class=nx>corev1</span><span class=w> </span><span class=s>&quot;k8s.io/api/core/v1&quot;</span>
<a id=__codelineno-67-10 name=__codelineno-67-10 href=#__codelineno-67-10></a><span class=w>    </span><span class=nx>metav1</span><span class=w> </span><span class=s>&quot;k8s.io/apimachinery/pkg/apis/meta/v1&quot;</span>
<a id=__codelineno-67-11 name=__codelineno-67-11 href=#__codelineno-67-11></a><span class=p>)</span>
<a id=__codelineno-67-12 name=__codelineno-67-12 href=#__codelineno-67-12></a>
<a id=__codelineno-67-13 name=__codelineno-67-13 href=#__codelineno-67-13></a><span class=kd>var</span><span class=w> </span><span class=nx>Pvc</span><span class=w> </span><span class=nx>pvc</span>
<a id=__codelineno-67-14 name=__codelineno-67-14 href=#__codelineno-67-14></a>
<a id=__codelineno-67-15 name=__codelineno-67-15 href=#__codelineno-67-15></a><span class=kd>type</span><span class=w> </span><span class=nx>pvc</span><span class=w> </span><span class=kd>struct</span><span class=p>{}</span>
<a id=__codelineno-67-16 name=__codelineno-67-16 href=#__codelineno-67-16></a>
<a id=__codelineno-67-17 name=__codelineno-67-17 href=#__codelineno-67-17></a><span class=kd>type</span><span class=w> </span><span class=nx>PvcsResp</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-67-18 name=__codelineno-67-18 href=#__codelineno-67-18></a><span class=w>    </span><span class=nx>Items</span><span class=w> </span><span class=p>[]</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>PersistentVolumeClaim</span><span class=w> </span><span class=s>`json:&quot;items&quot;`</span>
<a id=__codelineno-67-19 name=__codelineno-67-19 href=#__codelineno-67-19></a><span class=w>    </span><span class=nx>Total</span><span class=w> </span><span class=kt>int</span><span class=w>                            </span><span class=s>`json:&quot;total&quot;`</span>
<a id=__codelineno-67-20 name=__codelineno-67-20 href=#__codelineno-67-20></a><span class=p>}</span>
<a id=__codelineno-67-21 name=__codelineno-67-21 href=#__codelineno-67-21></a>
<a id=__codelineno-67-22 name=__codelineno-67-22 href=#__codelineno-67-22></a><span class=c1>// GetPvcs 获取pvc列表，支持过滤、排序、分页</span>
<a id=__codelineno-67-23 name=__codelineno-67-23 href=#__codelineno-67-23></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=o>*</span><span class=nx>pvc</span><span class=p>)</span><span class=w> </span><span class=nx>GetPvcs</span><span class=p>(</span><span class=nx>filterName</span><span class=p>,</span><span class=w> </span><span class=nx>namespace</span><span class=w> </span><span class=kt>string</span><span class=p>,</span><span class=w> </span><span class=nx>limit</span><span class=p>,</span><span class=w> </span><span class=nx>page</span><span class=w> </span><span class=kt>int</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>pvcsResp</span><span class=w> </span><span class=o>*</span><span class=nx>PvcsResp</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-67-24 name=__codelineno-67-24 href=#__codelineno-67-24></a><span class=w>    </span><span class=c1>//获取pvcList类型的pvc列表</span>
<a id=__codelineno-67-25 name=__codelineno-67-25 href=#__codelineno-67-25></a><span class=w>    </span><span class=nx>pvcList</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>CoreV1</span><span class=p>().</span><span class=nx>PersistentVolumeClaims</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span><span class=nx>List</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>ListOptions</span><span class=p>{})</span>
<a id=__codelineno-67-26 name=__codelineno-67-26 href=#__codelineno-67-26></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-67-27 name=__codelineno-67-27 href=#__codelineno-67-27></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取Pvc列表失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-67-28 name=__codelineno-67-28 href=#__codelineno-67-28></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取Pvc列表失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-67-29 name=__codelineno-67-29 href=#__codelineno-67-29></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-67-30 name=__codelineno-67-30 href=#__codelineno-67-30></a><span class=w>    </span><span class=c1>//将pvcList中的pvc列表(Items)，放进dataselector对象中，进行排序</span>
<a id=__codelineno-67-31 name=__codelineno-67-31 href=#__codelineno-67-31></a><span class=w>    </span><span class=nx>selectableData</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>dataSelector</span><span class=p>{</span>
<a id=__codelineno-67-32 name=__codelineno-67-32 href=#__codelineno-67-32></a><span class=w>        </span><span class=nx>GenericDataList</span><span class=p>:</span><span class=w> </span><span class=nx>p</span><span class=p>.</span><span class=nx>toCells</span><span class=p>(</span><span class=nx>pvcList</span><span class=p>.</span><span class=nx>Items</span><span class=p>),</span>
<a id=__codelineno-67-33 name=__codelineno-67-33 href=#__codelineno-67-33></a><span class=w>        </span><span class=nx>dataSelectQuery</span><span class=p>:</span><span class=w> </span><span class=o>&amp;</span><span class=nx>DataSelectQuery</span><span class=p>{</span>
<a id=__codelineno-67-34 name=__codelineno-67-34 href=#__codelineno-67-34></a><span class=w>            </span><span class=nx>FilterQuery</span><span class=p>:</span><span class=w> </span><span class=o>&amp;</span><span class=nx>FilterQuery</span><span class=p>{</span><span class=nx>Name</span><span class=p>:</span><span class=w> </span><span class=nx>filterName</span><span class=p>},</span>
<a id=__codelineno-67-35 name=__codelineno-67-35 href=#__codelineno-67-35></a><span class=w>            </span><span class=nx>PaginateQuery</span><span class=p>:</span><span class=w> </span><span class=o>&amp;</span><span class=nx>PaginateQuery</span><span class=p>{</span>
<a id=__codelineno-67-36 name=__codelineno-67-36 href=#__codelineno-67-36></a><span class=w>                </span><span class=nx>Limit</span><span class=p>:</span><span class=w> </span><span class=nx>limit</span><span class=p>,</span>
<a id=__codelineno-67-37 name=__codelineno-67-37 href=#__codelineno-67-37></a><span class=w>                </span><span class=nx>Page</span><span class=p>:</span><span class=w>  </span><span class=nx>page</span><span class=p>,</span>
<a id=__codelineno-67-38 name=__codelineno-67-38 href=#__codelineno-67-38></a><span class=w>            </span><span class=p>},</span>
<a id=__codelineno-67-39 name=__codelineno-67-39 href=#__codelineno-67-39></a><span class=w>        </span><span class=p>},</span>
<a id=__codelineno-67-40 name=__codelineno-67-40 href=#__codelineno-67-40></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-67-41 name=__codelineno-67-41 href=#__codelineno-67-41></a>
<a id=__codelineno-67-42 name=__codelineno-67-42 href=#__codelineno-67-42></a><span class=w>    </span><span class=nx>filtered</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>selectableData</span><span class=p>.</span><span class=nx>Filter</span><span class=p>()</span>
<a id=__codelineno-67-43 name=__codelineno-67-43 href=#__codelineno-67-43></a><span class=w>    </span><span class=nx>total</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>filtered</span><span class=p>.</span><span class=nx>GenericDataList</span><span class=p>)</span>
<a id=__codelineno-67-44 name=__codelineno-67-44 href=#__codelineno-67-44></a><span class=w>    </span><span class=nx>data</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>filtered</span><span class=p>.</span><span class=nx>Sort</span><span class=p>().</span><span class=nx>Paginate</span><span class=p>()</span>
<a id=__codelineno-67-45 name=__codelineno-67-45 href=#__codelineno-67-45></a>
<a id=__codelineno-67-46 name=__codelineno-67-46 href=#__codelineno-67-46></a><span class=w>    </span><span class=c1>//将[]DataCell类型的pvc列表转为v1.pvc列表</span>
<a id=__codelineno-67-47 name=__codelineno-67-47 href=#__codelineno-67-47></a><span class=w>    </span><span class=nx>pvcs</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>p</span><span class=p>.</span><span class=nx>fromCells</span><span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>GenericDataList</span><span class=p>)</span>
<a id=__codelineno-67-48 name=__codelineno-67-48 href=#__codelineno-67-48></a>
<a id=__codelineno-67-49 name=__codelineno-67-49 href=#__codelineno-67-49></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=o>&amp;</span><span class=nx>PvcsResp</span><span class=p>{</span>
<a id=__codelineno-67-50 name=__codelineno-67-50 href=#__codelineno-67-50></a><span class=w>        </span><span class=nx>Items</span><span class=p>:</span><span class=w> </span><span class=nx>pvcs</span><span class=p>,</span>
<a id=__codelineno-67-51 name=__codelineno-67-51 href=#__codelineno-67-51></a><span class=w>        </span><span class=nx>Total</span><span class=p>:</span><span class=w> </span><span class=nx>total</span><span class=p>,</span>
<a id=__codelineno-67-52 name=__codelineno-67-52 href=#__codelineno-67-52></a><span class=w>    </span><span class=p>},</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-67-53 name=__codelineno-67-53 href=#__codelineno-67-53></a><span class=p>}</span>
<a id=__codelineno-67-54 name=__codelineno-67-54 href=#__codelineno-67-54></a>
<a id=__codelineno-67-55 name=__codelineno-67-55 href=#__codelineno-67-55></a><span class=c1>// GetPvcDetail 获取pvc详情</span>
<a id=__codelineno-67-56 name=__codelineno-67-56 href=#__codelineno-67-56></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=o>*</span><span class=nx>pvc</span><span class=p>)</span><span class=w> </span><span class=nx>GetPvcDetail</span><span class=p>(</span><span class=nx>pvcName</span><span class=p>,</span><span class=w> </span><span class=nx>namespace</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>pvc</span><span class=w> </span><span class=o>*</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>PersistentVolumeClaim</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-67-57 name=__codelineno-67-57 href=#__codelineno-67-57></a><span class=w>    </span><span class=nx>pvc</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>CoreV1</span><span class=p>().</span><span class=nx>PersistentVolumeClaims</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span><span class=nx>Get</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>pvcName</span><span class=p>,</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>GetOptions</span><span class=p>{})</span>
<a id=__codelineno-67-58 name=__codelineno-67-58 href=#__codelineno-67-58></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-67-59 name=__codelineno-67-59 href=#__codelineno-67-59></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取Pvc详情失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-67-60 name=__codelineno-67-60 href=#__codelineno-67-60></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取Pvc详情失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-67-61 name=__codelineno-67-61 href=#__codelineno-67-61></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-67-62 name=__codelineno-67-62 href=#__codelineno-67-62></a>
<a id=__codelineno-67-63 name=__codelineno-67-63 href=#__codelineno-67-63></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>pvc</span><span class=p>,</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-67-64 name=__codelineno-67-64 href=#__codelineno-67-64></a><span class=p>}</span>
<a id=__codelineno-67-65 name=__codelineno-67-65 href=#__codelineno-67-65></a>
<a id=__codelineno-67-66 name=__codelineno-67-66 href=#__codelineno-67-66></a><span class=c1>// DeletePvc 删除pvc</span>
<a id=__codelineno-67-67 name=__codelineno-67-67 href=#__codelineno-67-67></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=o>*</span><span class=nx>pvc</span><span class=p>)</span><span class=w> </span><span class=nx>DeletePvc</span><span class=p>(</span><span class=nx>pvcName</span><span class=p>,</span><span class=w> </span><span class=nx>namespace</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-67-68 name=__codelineno-67-68 href=#__codelineno-67-68></a><span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>CoreV1</span><span class=p>().</span><span class=nx>PersistentVolumeClaims</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span><span class=nx>Delete</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>pvcName</span><span class=p>,</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>DeleteOptions</span><span class=p>{})</span>
<a id=__codelineno-67-69 name=__codelineno-67-69 href=#__codelineno-67-69></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-67-70 name=__codelineno-67-70 href=#__codelineno-67-70></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;删除Pvc失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-67-71 name=__codelineno-67-71 href=#__codelineno-67-71></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;删除Pvc失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-67-72 name=__codelineno-67-72 href=#__codelineno-67-72></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-67-73 name=__codelineno-67-73 href=#__codelineno-67-73></a>
<a id=__codelineno-67-74 name=__codelineno-67-74 href=#__codelineno-67-74></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-67-75 name=__codelineno-67-75 href=#__codelineno-67-75></a><span class=p>}</span>
<a id=__codelineno-67-76 name=__codelineno-67-76 href=#__codelineno-67-76></a>
<a id=__codelineno-67-77 name=__codelineno-67-77 href=#__codelineno-67-77></a><span class=c1>// UpdatePvc 更新pvc</span>
<a id=__codelineno-67-78 name=__codelineno-67-78 href=#__codelineno-67-78></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=o>*</span><span class=nx>pvc</span><span class=p>)</span><span class=w> </span><span class=nx>UpdatePvc</span><span class=p>(</span><span class=nx>namespace</span><span class=p>,</span><span class=w> </span><span class=nx>content</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-67-79 name=__codelineno-67-79 href=#__codelineno-67-79></a><span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=nx>pvc</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>PersistentVolumeClaim</span><span class=p>{}</span>
<a id=__codelineno-67-80 name=__codelineno-67-80 href=#__codelineno-67-80></a>
<a id=__codelineno-67-81 name=__codelineno-67-81 href=#__codelineno-67-81></a><span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>json</span><span class=p>.</span><span class=nx>Unmarshal</span><span class=p>([]</span><span class=nb>byte</span><span class=p>(</span><span class=nx>content</span><span class=p>),</span><span class=w> </span><span class=nx>pvc</span><span class=p>)</span>
<a id=__codelineno-67-82 name=__codelineno-67-82 href=#__codelineno-67-82></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-67-83 name=__codelineno-67-83 href=#__codelineno-67-83></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;反序列化失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-67-84 name=__codelineno-67-84 href=#__codelineno-67-84></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;反序列化失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-67-85 name=__codelineno-67-85 href=#__codelineno-67-85></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-67-86 name=__codelineno-67-86 href=#__codelineno-67-86></a>
<a id=__codelineno-67-87 name=__codelineno-67-87 href=#__codelineno-67-87></a><span class=w>    </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>K8s</span><span class=p>.</span><span class=nx>ClientSet</span><span class=p>.</span><span class=nx>CoreV1</span><span class=p>().</span><span class=nx>PersistentVolumeClaims</span><span class=p>(</span><span class=nx>namespace</span><span class=p>).</span><span class=nx>Update</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>TODO</span><span class=p>(),</span><span class=w> </span><span class=nx>pvc</span><span class=p>,</span><span class=w> </span><span class=nx>metav1</span><span class=p>.</span><span class=nx>UpdateOptions</span><span class=p>{})</span>
<a id=__codelineno-67-88 name=__codelineno-67-88 href=#__codelineno-67-88></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-67-89 name=__codelineno-67-89 href=#__codelineno-67-89></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;更新Pvc失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-67-90 name=__codelineno-67-90 href=#__codelineno-67-90></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;更新Pvc失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-67-91 name=__codelineno-67-91 href=#__codelineno-67-91></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-67-92 name=__codelineno-67-92 href=#__codelineno-67-92></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-67-93 name=__codelineno-67-93 href=#__codelineno-67-93></a><span class=p>}</span>
<a id=__codelineno-67-94 name=__codelineno-67-94 href=#__codelineno-67-94></a>
<a id=__codelineno-67-95 name=__codelineno-67-95 href=#__codelineno-67-95></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=o>*</span><span class=nx>pvc</span><span class=p>)</span><span class=w> </span><span class=nx>toCells</span><span class=p>(</span><span class=nx>std</span><span class=w> </span><span class=p>[]</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>PersistentVolumeClaim</span><span class=p>)</span><span class=w> </span><span class=p>[]</span><span class=nx>DataCell</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-67-96 name=__codelineno-67-96 href=#__codelineno-67-96></a><span class=w>    </span><span class=nx>cells</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>make</span><span class=p>([]</span><span class=nx>DataCell</span><span class=p>,</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>std</span><span class=p>))</span>
<a id=__codelineno-67-97 name=__codelineno-67-97 href=#__codelineno-67-97></a><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=nx>i</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>std</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-67-98 name=__codelineno-67-98 href=#__codelineno-67-98></a><span class=w>        </span><span class=nx>cells</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>pvcCell</span><span class=p>(</span><span class=nx>std</span><span class=p>[</span><span class=nx>i</span><span class=p>])</span>
<a id=__codelineno-67-99 name=__codelineno-67-99 href=#__codelineno-67-99></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-67-100 name=__codelineno-67-100 href=#__codelineno-67-100></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>cells</span>
<a id=__codelineno-67-101 name=__codelineno-67-101 href=#__codelineno-67-101></a><span class=p>}</span>
<a id=__codelineno-67-102 name=__codelineno-67-102 href=#__codelineno-67-102></a>
<a id=__codelineno-67-103 name=__codelineno-67-103 href=#__codelineno-67-103></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=o>*</span><span class=nx>pvc</span><span class=p>)</span><span class=w> </span><span class=nx>fromCells</span><span class=p>(</span><span class=nx>cells</span><span class=w> </span><span class=p>[]</span><span class=nx>DataCell</span><span class=p>)</span><span class=w> </span><span class=p>[]</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>PersistentVolumeClaim</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-67-104 name=__codelineno-67-104 href=#__codelineno-67-104></a><span class=w>    </span><span class=nx>pvcs</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>make</span><span class=p>([]</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>PersistentVolumeClaim</span><span class=p>,</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>cells</span><span class=p>))</span>
<a id=__codelineno-67-105 name=__codelineno-67-105 href=#__codelineno-67-105></a><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=nx>i</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>cells</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-67-106 name=__codelineno-67-106 href=#__codelineno-67-106></a><span class=w>        </span><span class=nx>pvcs</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>corev1</span><span class=p>.</span><span class=nx>PersistentVolumeClaim</span><span class=p>(</span><span class=nx>cells</span><span class=p>[</span><span class=nx>i</span><span class=p>].(</span><span class=nx>pvcCell</span><span class=p>))</span>
<a id=__codelineno-67-107 name=__codelineno-67-107 href=#__codelineno-67-107></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-67-108 name=__codelineno-67-108 href=#__codelineno-67-108></a>
<a id=__codelineno-67-109 name=__codelineno-67-109 href=#__codelineno-67-109></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>pvcs</span>
<a id=__codelineno-67-110 name=__codelineno-67-110 href=#__codelineno-67-110></a><span class=p>}</span>
</code></pre></div> <h5 id=controllerpvcgo>controller/pvc.go<a class=headerlink href=#controllerpvcgo title="Permanent link">&para;</a></h5> <div class=highlight><pre><span></span><code><a id=__codelineno-68-1 name=__codelineno-68-1 href=#__codelineno-68-1></a><span class=kn>package</span><span class=w> </span><span class=nx>controller</span>
<a id=__codelineno-68-2 name=__codelineno-68-2 href=#__codelineno-68-2></a>
<a id=__codelineno-68-3 name=__codelineno-68-3 href=#__codelineno-68-3></a><span class=kn>import</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-68-4 name=__codelineno-68-4 href=#__codelineno-68-4></a><span class=w>    </span><span class=s>&quot;gitee.com/hujianli94net/k8s-platform/service&quot;</span>
<a id=__codelineno-68-5 name=__codelineno-68-5 href=#__codelineno-68-5></a><span class=w>    </span><span class=s>&quot;net/http&quot;</span>
<a id=__codelineno-68-6 name=__codelineno-68-6 href=#__codelineno-68-6></a>
<a id=__codelineno-68-7 name=__codelineno-68-7 href=#__codelineno-68-7></a><span class=w>    </span><span class=s>&quot;github.com/gin-gonic/gin&quot;</span>
<a id=__codelineno-68-8 name=__codelineno-68-8 href=#__codelineno-68-8></a><span class=w>    </span><span class=s>&quot;github.com/wonderivan/logger&quot;</span>
<a id=__codelineno-68-9 name=__codelineno-68-9 href=#__codelineno-68-9></a><span class=p>)</span>
<a id=__codelineno-68-10 name=__codelineno-68-10 href=#__codelineno-68-10></a>
<a id=__codelineno-68-11 name=__codelineno-68-11 href=#__codelineno-68-11></a><span class=kd>var</span><span class=w> </span><span class=nx>Pvc</span><span class=w> </span><span class=nx>pvc</span>
<a id=__codelineno-68-12 name=__codelineno-68-12 href=#__codelineno-68-12></a>
<a id=__codelineno-68-13 name=__codelineno-68-13 href=#__codelineno-68-13></a><span class=kd>type</span><span class=w> </span><span class=nx>pvc</span><span class=w> </span><span class=kd>struct</span><span class=p>{}</span>
<a id=__codelineno-68-14 name=__codelineno-68-14 href=#__codelineno-68-14></a>
<a id=__codelineno-68-15 name=__codelineno-68-15 href=#__codelineno-68-15></a><span class=c1>// GetPvcs 获取pvc列表，支持过滤、排序、分页</span>
<a id=__codelineno-68-16 name=__codelineno-68-16 href=#__codelineno-68-16></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=o>*</span><span class=nx>pvc</span><span class=p>)</span><span class=w> </span><span class=nx>GetPvcs</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-68-17 name=__codelineno-68-17 href=#__codelineno-68-17></a><span class=w>    </span><span class=nx>params</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-68-18 name=__codelineno-68-18 href=#__codelineno-68-18></a><span class=w>        </span><span class=nx>FilterName</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`form:&quot;filter_name&quot;`</span>
<a id=__codelineno-68-19 name=__codelineno-68-19 href=#__codelineno-68-19></a><span class=w>        </span><span class=nx>Namespace</span><span class=w>  </span><span class=kt>string</span><span class=w> </span><span class=s>`form:&quot;namespace&quot;`</span>
<a id=__codelineno-68-20 name=__codelineno-68-20 href=#__codelineno-68-20></a><span class=w>        </span><span class=nx>Page</span><span class=w>       </span><span class=kt>int</span><span class=w>    </span><span class=s>`form:&quot;page&quot;`</span>
<a id=__codelineno-68-21 name=__codelineno-68-21 href=#__codelineno-68-21></a><span class=w>        </span><span class=nx>Limit</span><span class=w>      </span><span class=kt>int</span><span class=w>    </span><span class=s>`form:&quot;limit&quot;`</span>
<a id=__codelineno-68-22 name=__codelineno-68-22 href=#__codelineno-68-22></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-68-23 name=__codelineno-68-23 href=#__codelineno-68-23></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>Bind</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-68-24 name=__codelineno-68-24 href=#__codelineno-68-24></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-68-25 name=__codelineno-68-25 href=#__codelineno-68-25></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-68-26 name=__codelineno-68-26 href=#__codelineno-68-26></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-68-27 name=__codelineno-68-27 href=#__codelineno-68-27></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-68-28 name=__codelineno-68-28 href=#__codelineno-68-28></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-68-29 name=__codelineno-68-29 href=#__codelineno-68-29></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-68-30 name=__codelineno-68-30 href=#__codelineno-68-30></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-68-31 name=__codelineno-68-31 href=#__codelineno-68-31></a>
<a id=__codelineno-68-32 name=__codelineno-68-32 href=#__codelineno-68-32></a><span class=w>    </span><span class=nx>data</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>Pvc</span><span class=p>.</span><span class=nx>GetPvcs</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>FilterName</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Limit</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Page</span><span class=p>)</span>
<a id=__codelineno-68-33 name=__codelineno-68-33 href=#__codelineno-68-33></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-68-34 name=__codelineno-68-34 href=#__codelineno-68-34></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-68-35 name=__codelineno-68-35 href=#__codelineno-68-35></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-68-36 name=__codelineno-68-36 href=#__codelineno-68-36></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-68-37 name=__codelineno-68-37 href=#__codelineno-68-37></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-68-38 name=__codelineno-68-38 href=#__codelineno-68-38></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-68-39 name=__codelineno-68-39 href=#__codelineno-68-39></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-68-40 name=__codelineno-68-40 href=#__codelineno-68-40></a>
<a id=__codelineno-68-41 name=__codelineno-68-41 href=#__codelineno-68-41></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-68-42 name=__codelineno-68-42 href=#__codelineno-68-42></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;获取Pvc列表成功&quot;</span><span class=p>,</span>
<a id=__codelineno-68-43 name=__codelineno-68-43 href=#__codelineno-68-43></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=nx>data</span><span class=p>,</span>
<a id=__codelineno-68-44 name=__codelineno-68-44 href=#__codelineno-68-44></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-68-45 name=__codelineno-68-45 href=#__codelineno-68-45></a><span class=p>}</span>
<a id=__codelineno-68-46 name=__codelineno-68-46 href=#__codelineno-68-46></a>
<a id=__codelineno-68-47 name=__codelineno-68-47 href=#__codelineno-68-47></a><span class=c1>// GetPvcDetail 获取pvc详情</span>
<a id=__codelineno-68-48 name=__codelineno-68-48 href=#__codelineno-68-48></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=o>*</span><span class=nx>pvc</span><span class=p>)</span><span class=w> </span><span class=nx>GetPvcDetail</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-68-49 name=__codelineno-68-49 href=#__codelineno-68-49></a><span class=w>    </span><span class=nx>params</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-68-50 name=__codelineno-68-50 href=#__codelineno-68-50></a><span class=w>        </span><span class=nx>PvcName</span><span class=w>   </span><span class=kt>string</span><span class=w> </span><span class=s>`form:&quot;pvc_name&quot;`</span>
<a id=__codelineno-68-51 name=__codelineno-68-51 href=#__codelineno-68-51></a><span class=w>        </span><span class=nx>Namespace</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`form:&quot;namespace&quot;`</span>
<a id=__codelineno-68-52 name=__codelineno-68-52 href=#__codelineno-68-52></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-68-53 name=__codelineno-68-53 href=#__codelineno-68-53></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>Bind</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-68-54 name=__codelineno-68-54 href=#__codelineno-68-54></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-68-55 name=__codelineno-68-55 href=#__codelineno-68-55></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-68-56 name=__codelineno-68-56 href=#__codelineno-68-56></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-68-57 name=__codelineno-68-57 href=#__codelineno-68-57></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-68-58 name=__codelineno-68-58 href=#__codelineno-68-58></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-68-59 name=__codelineno-68-59 href=#__codelineno-68-59></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-68-60 name=__codelineno-68-60 href=#__codelineno-68-60></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-68-61 name=__codelineno-68-61 href=#__codelineno-68-61></a>
<a id=__codelineno-68-62 name=__codelineno-68-62 href=#__codelineno-68-62></a><span class=w>    </span><span class=nx>data</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>Pvc</span><span class=p>.</span><span class=nx>GetPvcDetail</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>PvcName</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>)</span>
<a id=__codelineno-68-63 name=__codelineno-68-63 href=#__codelineno-68-63></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-68-64 name=__codelineno-68-64 href=#__codelineno-68-64></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-68-65 name=__codelineno-68-65 href=#__codelineno-68-65></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-68-66 name=__codelineno-68-66 href=#__codelineno-68-66></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-68-67 name=__codelineno-68-67 href=#__codelineno-68-67></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-68-68 name=__codelineno-68-68 href=#__codelineno-68-68></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-68-69 name=__codelineno-68-69 href=#__codelineno-68-69></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-68-70 name=__codelineno-68-70 href=#__codelineno-68-70></a>
<a id=__codelineno-68-71 name=__codelineno-68-71 href=#__codelineno-68-71></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-68-72 name=__codelineno-68-72 href=#__codelineno-68-72></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;获取Pvc详情成功&quot;</span><span class=p>,</span>
<a id=__codelineno-68-73 name=__codelineno-68-73 href=#__codelineno-68-73></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=nx>data</span><span class=p>,</span>
<a id=__codelineno-68-74 name=__codelineno-68-74 href=#__codelineno-68-74></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-68-75 name=__codelineno-68-75 href=#__codelineno-68-75></a><span class=p>}</span>
<a id=__codelineno-68-76 name=__codelineno-68-76 href=#__codelineno-68-76></a>
<a id=__codelineno-68-77 name=__codelineno-68-77 href=#__codelineno-68-77></a><span class=c1>// DeletePvc 删除pvc</span>
<a id=__codelineno-68-78 name=__codelineno-68-78 href=#__codelineno-68-78></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=o>*</span><span class=nx>pvc</span><span class=p>)</span><span class=w> </span><span class=nx>DeletePvc</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-68-79 name=__codelineno-68-79 href=#__codelineno-68-79></a><span class=w>    </span><span class=nx>params</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-68-80 name=__codelineno-68-80 href=#__codelineno-68-80></a><span class=w>        </span><span class=nx>PvcName</span><span class=w>   </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;pvc_name&quot;`</span>
<a id=__codelineno-68-81 name=__codelineno-68-81 href=#__codelineno-68-81></a><span class=w>        </span><span class=nx>Namespace</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;namespace&quot;`</span>
<a id=__codelineno-68-82 name=__codelineno-68-82 href=#__codelineno-68-82></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-68-83 name=__codelineno-68-83 href=#__codelineno-68-83></a><span class=w>    </span><span class=c1>//DELETE请求，绑定参数方法改为ctx.ShouldBindJSON</span>
<a id=__codelineno-68-84 name=__codelineno-68-84 href=#__codelineno-68-84></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>ShouldBindJSON</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-68-85 name=__codelineno-68-85 href=#__codelineno-68-85></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-68-86 name=__codelineno-68-86 href=#__codelineno-68-86></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-68-87 name=__codelineno-68-87 href=#__codelineno-68-87></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-68-88 name=__codelineno-68-88 href=#__codelineno-68-88></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-68-89 name=__codelineno-68-89 href=#__codelineno-68-89></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-68-90 name=__codelineno-68-90 href=#__codelineno-68-90></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-68-91 name=__codelineno-68-91 href=#__codelineno-68-91></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-68-92 name=__codelineno-68-92 href=#__codelineno-68-92></a>
<a id=__codelineno-68-93 name=__codelineno-68-93 href=#__codelineno-68-93></a><span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>Pvc</span><span class=p>.</span><span class=nx>DeletePvc</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>PvcName</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>)</span>
<a id=__codelineno-68-94 name=__codelineno-68-94 href=#__codelineno-68-94></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-68-95 name=__codelineno-68-95 href=#__codelineno-68-95></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-68-96 name=__codelineno-68-96 href=#__codelineno-68-96></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-68-97 name=__codelineno-68-97 href=#__codelineno-68-97></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-68-98 name=__codelineno-68-98 href=#__codelineno-68-98></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-68-99 name=__codelineno-68-99 href=#__codelineno-68-99></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-68-100 name=__codelineno-68-100 href=#__codelineno-68-100></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-68-101 name=__codelineno-68-101 href=#__codelineno-68-101></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-68-102 name=__codelineno-68-102 href=#__codelineno-68-102></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;删除Pvc成功&quot;</span><span class=p>,</span>
<a id=__codelineno-68-103 name=__codelineno-68-103 href=#__codelineno-68-103></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-68-104 name=__codelineno-68-104 href=#__codelineno-68-104></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-68-105 name=__codelineno-68-105 href=#__codelineno-68-105></a><span class=p>}</span>
<a id=__codelineno-68-106 name=__codelineno-68-106 href=#__codelineno-68-106></a>
<a id=__codelineno-68-107 name=__codelineno-68-107 href=#__codelineno-68-107></a><span class=c1>// UpdatePvc 更新pvc</span>
<a id=__codelineno-68-108 name=__codelineno-68-108 href=#__codelineno-68-108></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=o>*</span><span class=nx>pvc</span><span class=p>)</span><span class=w> </span><span class=nx>UpdatePvc</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-68-109 name=__codelineno-68-109 href=#__codelineno-68-109></a><span class=w>    </span><span class=nx>params</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-68-110 name=__codelineno-68-110 href=#__codelineno-68-110></a><span class=w>        </span><span class=nx>Namespace</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;namespace&quot;`</span>
<a id=__codelineno-68-111 name=__codelineno-68-111 href=#__codelineno-68-111></a><span class=w>        </span><span class=nx>Content</span><span class=w>   </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;content&quot;`</span>
<a id=__codelineno-68-112 name=__codelineno-68-112 href=#__codelineno-68-112></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-68-113 name=__codelineno-68-113 href=#__codelineno-68-113></a><span class=w>    </span><span class=c1>//PUT请求，绑定参数方法改为ctx.ShouldBindJSON</span>
<a id=__codelineno-68-114 name=__codelineno-68-114 href=#__codelineno-68-114></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>ShouldBindJSON</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-68-115 name=__codelineno-68-115 href=#__codelineno-68-115></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败, &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-68-116 name=__codelineno-68-116 href=#__codelineno-68-116></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-68-117 name=__codelineno-68-117 href=#__codelineno-68-117></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-68-118 name=__codelineno-68-118 href=#__codelineno-68-118></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-68-119 name=__codelineno-68-119 href=#__codelineno-68-119></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-68-120 name=__codelineno-68-120 href=#__codelineno-68-120></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-68-121 name=__codelineno-68-121 href=#__codelineno-68-121></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-68-122 name=__codelineno-68-122 href=#__codelineno-68-122></a>
<a id=__codelineno-68-123 name=__codelineno-68-123 href=#__codelineno-68-123></a><span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>Pvc</span><span class=p>.</span><span class=nx>UpdatePvc</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Content</span><span class=p>)</span>
<a id=__codelineno-68-124 name=__codelineno-68-124 href=#__codelineno-68-124></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-68-125 name=__codelineno-68-125 href=#__codelineno-68-125></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-68-126 name=__codelineno-68-126 href=#__codelineno-68-126></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-68-127 name=__codelineno-68-127 href=#__codelineno-68-127></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-68-128 name=__codelineno-68-128 href=#__codelineno-68-128></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-68-129 name=__codelineno-68-129 href=#__codelineno-68-129></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-68-130 name=__codelineno-68-130 href=#__codelineno-68-130></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-68-131 name=__codelineno-68-131 href=#__codelineno-68-131></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-68-132 name=__codelineno-68-132 href=#__codelineno-68-132></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;更新Pvc成功&quot;</span><span class=p>,</span>
<a id=__codelineno-68-133 name=__codelineno-68-133 href=#__codelineno-68-133></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-68-134 name=__codelineno-68-134 href=#__codelineno-68-134></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-68-135 name=__codelineno-68-135 href=#__codelineno-68-135></a><span class=p>}</span>
</code></pre></div> <h3 id=6-工作流>6. 工作流<a class=headerlink href=#6-工作流 title="Permanent link">&para;</a></h3> <h4 id=61-流程设计>6.1 流程设计<a class=headerlink href=#61-流程设计 title="Permanent link">&para;</a></h4> <p><img alt=1700633628391 class=zoom src=https://cdn.jsdelivr.net/gh/hujianli94/Picgo-atlas@main/img/1700633628391.27c2ahp63lwk.webp></p> <h4 id=62-数据库操作gorm>6.2 数据库操作(GORM)<a class=headerlink href=#62-数据库操作gorm title="Permanent link">&para;</a></h4> <h5 id=1初始化数据库>(1)初始化数据库<a class=headerlink href=#1初始化数据库 title="Permanent link">&para;</a></h5> <p><code>config/config.go</code></p> <div class=highlight><pre><span></span><code><a id=__codelineno-69-1 name=__codelineno-69-1 href=#__codelineno-69-1></a><span class=kn>package</span><span class=w> </span><span class=nx>config</span>
<a id=__codelineno-69-2 name=__codelineno-69-2 href=#__codelineno-69-2></a>
<a id=__codelineno-69-3 name=__codelineno-69-3 href=#__codelineno-69-3></a><span class=kn>import</span><span class=w> </span><span class=s>&quot;time&quot;</span>
<a id=__codelineno-69-4 name=__codelineno-69-4 href=#__codelineno-69-4></a>
<a id=__codelineno-69-5 name=__codelineno-69-5 href=#__codelineno-69-5></a><span class=kd>const</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-69-6 name=__codelineno-69-6 href=#__codelineno-69-6></a><span class=w>    </span><span class=c1>//配置启动监听端口</span>
<a id=__codelineno-69-7 name=__codelineno-69-7 href=#__codelineno-69-7></a><span class=w>    </span><span class=nx>ListenAddr</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=s>&quot;0.0.0.0:9090&quot;</span>
<a id=__codelineno-69-8 name=__codelineno-69-8 href=#__codelineno-69-8></a>
<a id=__codelineno-69-9 name=__codelineno-69-9 href=#__codelineno-69-9></a><span class=w>    </span><span class=c1>//Kubeconfig Linux上配置</span>
<a id=__codelineno-69-10 name=__codelineno-69-10 href=#__codelineno-69-10></a><span class=w>    </span><span class=c1>//Kubeconfig = &quot;/root/.kube/config&quot;</span>
<a id=__codelineno-69-11 name=__codelineno-69-11 href=#__codelineno-69-11></a><span class=w>    </span><span class=c1>//Windows上配置</span>
<a id=__codelineno-69-12 name=__codelineno-69-12 href=#__codelineno-69-12></a><span class=w>    </span><span class=nx>Kubeconfig</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=s>&quot;C:\\Users/18793/.kube/config&quot;</span>
<a id=__codelineno-69-13 name=__codelineno-69-13 href=#__codelineno-69-13></a><span class=w>    </span><span class=c1>//数据库配置</span>
<a id=__codelineno-69-14 name=__codelineno-69-14 href=#__codelineno-69-14></a><span class=w>    </span><span class=nx>DbType</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=s>&quot;mysql&quot;</span>
<a id=__codelineno-69-15 name=__codelineno-69-15 href=#__codelineno-69-15></a><span class=w>    </span><span class=nx>DbUser</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=s>&quot;root&quot;</span>
<a id=__codelineno-69-16 name=__codelineno-69-16 href=#__codelineno-69-16></a><span class=w>    </span><span class=nx>DbPwd</span><span class=w>  </span><span class=p>=</span><span class=w> </span><span class=s>&quot;123456&quot;</span>
<a id=__codelineno-69-17 name=__codelineno-69-17 href=#__codelineno-69-17></a><span class=w>    </span><span class=nx>DbHost</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=s>&quot;127.0.0.1&quot;</span>
<a id=__codelineno-69-18 name=__codelineno-69-18 href=#__codelineno-69-18></a><span class=w>    </span><span class=nx>DbPort</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=mi>3306</span>
<a id=__codelineno-69-19 name=__codelineno-69-19 href=#__codelineno-69-19></a><span class=w>    </span><span class=nx>DbName</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=s>&quot;kubernetes-manage&quot;</span>
<a id=__codelineno-69-20 name=__codelineno-69-20 href=#__codelineno-69-20></a><span class=w>    </span><span class=c1>//连接池的配置</span>
<a id=__codelineno-69-21 name=__codelineno-69-21 href=#__codelineno-69-21></a><span class=w>    </span><span class=nx>MaxIdleConns</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=mi>10</span><span class=w>               </span><span class=c1>//最大空闲连接</span>
<a id=__codelineno-69-22 name=__codelineno-69-22 href=#__codelineno-69-22></a><span class=w>    </span><span class=nx>MaxOpenConns</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=mi>100</span><span class=w>              </span><span class=c1>//最大连接数</span>
<a id=__codelineno-69-23 name=__codelineno-69-23 href=#__codelineno-69-23></a><span class=w>    </span><span class=nx>MaxLifeTime</span><span class=w>  </span><span class=p>=</span><span class=w> </span><span class=mi>30</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=nx>time</span><span class=p>.</span><span class=nx>Second</span><span class=w> </span><span class=c1>//最大生存时间</span>
<a id=__codelineno-69-24 name=__codelineno-69-24 href=#__codelineno-69-24></a><span class=w>    </span><span class=c1>//日志显示行数</span>
<a id=__codelineno-69-25 name=__codelineno-69-25 href=#__codelineno-69-25></a><span class=w>    </span><span class=nx>PodLogTailLine</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=mi>2000</span>
<a id=__codelineno-69-26 name=__codelineno-69-26 href=#__codelineno-69-26></a><span class=p>)</span>
</code></pre></div> <p><code>db/db.go</code></p> <div class=highlight><pre><span></span><code><a id=__codelineno-70-1 name=__codelineno-70-1 href=#__codelineno-70-1></a><span class=kn>package</span><span class=w> </span><span class=nx>db</span>
<a id=__codelineno-70-2 name=__codelineno-70-2 href=#__codelineno-70-2></a>
<a id=__codelineno-70-3 name=__codelineno-70-3 href=#__codelineno-70-3></a><span class=kn>import</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-70-4 name=__codelineno-70-4 href=#__codelineno-70-4></a><span class=w>    </span><span class=s>&quot;errors&quot;</span>
<a id=__codelineno-70-5 name=__codelineno-70-5 href=#__codelineno-70-5></a><span class=w>    </span><span class=s>&quot;fmt&quot;</span>
<a id=__codelineno-70-6 name=__codelineno-70-6 href=#__codelineno-70-6></a><span class=w>    </span><span class=s>&quot;gitee.com/hujianli94net/k8s-platform/config&quot;</span>
<a id=__codelineno-70-7 name=__codelineno-70-7 href=#__codelineno-70-7></a><span class=w>    </span><span class=s>&quot;time&quot;</span>
<a id=__codelineno-70-8 name=__codelineno-70-8 href=#__codelineno-70-8></a>
<a id=__codelineno-70-9 name=__codelineno-70-9 href=#__codelineno-70-9></a><span class=w>    </span><span class=s>&quot;github.com/wonderivan/logger&quot;</span>
<a id=__codelineno-70-10 name=__codelineno-70-10 href=#__codelineno-70-10></a>
<a id=__codelineno-70-11 name=__codelineno-70-11 href=#__codelineno-70-11></a><span class=w>    </span><span class=s>&quot;gorm.io/driver/mysql&quot;</span>
<a id=__codelineno-70-12 name=__codelineno-70-12 href=#__codelineno-70-12></a><span class=w>    </span><span class=s>&quot;gorm.io/gorm&quot;</span>
<a id=__codelineno-70-13 name=__codelineno-70-13 href=#__codelineno-70-13></a><span class=p>)</span>
<a id=__codelineno-70-14 name=__codelineno-70-14 href=#__codelineno-70-14></a>
<a id=__codelineno-70-15 name=__codelineno-70-15 href=#__codelineno-70-15></a><span class=kd>var</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-70-16 name=__codelineno-70-16 href=#__codelineno-70-16></a><span class=w>    </span><span class=nx>isInit</span><span class=w> </span><span class=kt>bool</span>
<a id=__codelineno-70-17 name=__codelineno-70-17 href=#__codelineno-70-17></a><span class=w>    </span><span class=nx>GORM</span><span class=w>   </span><span class=o>*</span><span class=nx>gorm</span><span class=p>.</span><span class=nx>DB</span>
<a id=__codelineno-70-18 name=__codelineno-70-18 href=#__codelineno-70-18></a><span class=w>    </span><span class=nx>err</span><span class=w>    </span><span class=kt>error</span>
<a id=__codelineno-70-19 name=__codelineno-70-19 href=#__codelineno-70-19></a><span class=p>)</span>
<a id=__codelineno-70-20 name=__codelineno-70-20 href=#__codelineno-70-20></a>
<a id=__codelineno-70-21 name=__codelineno-70-21 href=#__codelineno-70-21></a><span class=c1>// Init db的初始化函数，与数据库建立连接</span>
<a id=__codelineno-70-22 name=__codelineno-70-22 href=#__codelineno-70-22></a><span class=kd>func</span><span class=w> </span><span class=nx>Init</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-70-23 name=__codelineno-70-23 href=#__codelineno-70-23></a><span class=w>    </span><span class=c1>//判断是否已经初始化了</span>
<a id=__codelineno-70-24 name=__codelineno-70-24 href=#__codelineno-70-24></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>isInit</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-70-25 name=__codelineno-70-25 href=#__codelineno-70-25></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-70-26 name=__codelineno-70-26 href=#__codelineno-70-26></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-70-27 name=__codelineno-70-27 href=#__codelineno-70-27></a><span class=w>    </span><span class=c1>// 组装连接配置</span>
<a id=__codelineno-70-28 name=__codelineno-70-28 href=#__codelineno-70-28></a><span class=w>    </span><span class=c1>// parseTime是查询结果是否自动解析为时间</span>
<a id=__codelineno-70-29 name=__codelineno-70-29 href=#__codelineno-70-29></a><span class=w>    </span><span class=c1>// loc是Mysql的时区设置</span>
<a id=__codelineno-70-30 name=__codelineno-70-30 href=#__codelineno-70-30></a><span class=w>    </span><span class=nx>dsn</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>fmt</span><span class=p>.</span><span class=nx>Sprintf</span><span class=p>(</span><span class=s>&quot;%s:%s@tcp(%s:%d)/%s?charset=utf8&amp;parseTime=True&amp;loc=Local&quot;</span><span class=p>,</span>
<a id=__codelineno-70-31 name=__codelineno-70-31 href=#__codelineno-70-31></a><span class=w>        </span><span class=nx>config</span><span class=p>.</span><span class=nx>DbUser</span><span class=p>,</span>
<a id=__codelineno-70-32 name=__codelineno-70-32 href=#__codelineno-70-32></a><span class=w>        </span><span class=nx>config</span><span class=p>.</span><span class=nx>DbPwd</span><span class=p>,</span>
<a id=__codelineno-70-33 name=__codelineno-70-33 href=#__codelineno-70-33></a><span class=w>        </span><span class=nx>config</span><span class=p>.</span><span class=nx>DbHost</span><span class=p>,</span>
<a id=__codelineno-70-34 name=__codelineno-70-34 href=#__codelineno-70-34></a><span class=w>        </span><span class=nx>config</span><span class=p>.</span><span class=nx>DbPort</span><span class=p>,</span>
<a id=__codelineno-70-35 name=__codelineno-70-35 href=#__codelineno-70-35></a><span class=w>        </span><span class=nx>config</span><span class=p>.</span><span class=nx>DbName</span><span class=p>)</span>
<a id=__codelineno-70-36 name=__codelineno-70-36 href=#__codelineno-70-36></a><span class=w>    </span><span class=c1>// 与数据库建立连接，生成一个*gorm.DB类型的对象</span>
<a id=__codelineno-70-37 name=__codelineno-70-37 href=#__codelineno-70-37></a><span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=nx>DbType</span><span class=w> </span><span class=nx>gorm</span><span class=p>.</span><span class=nx>Dialector</span>
<a id=__codelineno-70-38 name=__codelineno-70-38 href=#__codelineno-70-38></a><span class=w>    </span><span class=c1>//DbType := *new(gorm.Dialector)</span>
<a id=__codelineno-70-39 name=__codelineno-70-39 href=#__codelineno-70-39></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>config</span><span class=p>.</span><span class=nx>DbType</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&quot;mysql&quot;</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-70-40 name=__codelineno-70-40 href=#__codelineno-70-40></a><span class=w>        </span><span class=nx>DbType</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>mysql</span><span class=p>.</span><span class=nx>Open</span><span class=p>(</span><span class=nx>dsn</span><span class=p>)</span>
<a id=__codelineno-70-41 name=__codelineno-70-41 href=#__codelineno-70-41></a><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-70-42 name=__codelineno-70-42 href=#__codelineno-70-42></a><span class=w>        </span><span class=nb>panic</span><span class=p>(</span><span class=s>&quot;config.DbType!=\&quot;mysql\&quot;&quot;</span><span class=p>)</span>
<a id=__codelineno-70-43 name=__codelineno-70-43 href=#__codelineno-70-43></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-70-44 name=__codelineno-70-44 href=#__codelineno-70-44></a><span class=w>    </span><span class=nx>GORM</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>gorm</span><span class=p>.</span><span class=nx>Open</span><span class=p>(</span><span class=nx>DbType</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=nx>gorm</span><span class=p>.</span><span class=nx>Config</span><span class=p>{})</span>
<a id=__codelineno-70-45 name=__codelineno-70-45 href=#__codelineno-70-45></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-70-46 name=__codelineno-70-46 href=#__codelineno-70-46></a><span class=w>        </span><span class=nb>panic</span><span class=p>(</span><span class=s>&quot;数据库连接失败&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-70-47 name=__codelineno-70-47 href=#__codelineno-70-47></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-70-48 name=__codelineno-70-48 href=#__codelineno-70-48></a><span class=w>    </span><span class=c1>////打印sql语句</span>
<a id=__codelineno-70-49 name=__codelineno-70-49 href=#__codelineno-70-49></a><span class=w>    </span><span class=c1>//fmt.Println(&quot;db&quot;, GORM)</span>
<a id=__codelineno-70-50 name=__codelineno-70-50 href=#__codelineno-70-50></a>
<a id=__codelineno-70-51 name=__codelineno-70-51 href=#__codelineno-70-51></a><span class=w>    </span><span class=c1>//开启连接池</span>
<a id=__codelineno-70-52 name=__codelineno-70-52 href=#__codelineno-70-52></a><span class=w>    </span><span class=nx>sqlDb</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>GORM</span><span class=p>.</span><span class=nx>DB</span><span class=p>()</span>
<a id=__codelineno-70-53 name=__codelineno-70-53 href=#__codelineno-70-53></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-70-54 name=__codelineno-70-54 href=#__codelineno-70-54></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取Deployment列表失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-70-55 name=__codelineno-70-55 href=#__codelineno-70-55></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-70-56 name=__codelineno-70-56 href=#__codelineno-70-56></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-70-57 name=__codelineno-70-57 href=#__codelineno-70-57></a><span class=w>    </span><span class=c1>//连接池最大允许的空闲连接数，如果没有sql任务需要执行的连接数大于20，超过的连接会被连接池关闭</span>
<a id=__codelineno-70-58 name=__codelineno-70-58 href=#__codelineno-70-58></a><span class=w>    </span><span class=nx>sqlDb</span><span class=p>.</span><span class=nx>SetMaxIdleConns</span><span class=p>(</span><span class=nx>config</span><span class=p>.</span><span class=nx>MaxIdleConns</span><span class=p>)</span>
<a id=__codelineno-70-59 name=__codelineno-70-59 href=#__codelineno-70-59></a><span class=w>    </span><span class=c1>//设置了连接池最大数量</span>
<a id=__codelineno-70-60 name=__codelineno-70-60 href=#__codelineno-70-60></a><span class=w>    </span><span class=nx>sqlDb</span><span class=p>.</span><span class=nx>SetMaxOpenConns</span><span class=p>(</span><span class=nx>config</span><span class=p>.</span><span class=nx>MaxOpenConns</span><span class=p>)</span>
<a id=__codelineno-70-61 name=__codelineno-70-61 href=#__codelineno-70-61></a><span class=w>    </span><span class=c1>//设置了连接可复用的最大时间</span>
<a id=__codelineno-70-62 name=__codelineno-70-62 href=#__codelineno-70-62></a><span class=w>    </span><span class=nx>sqlDb</span><span class=p>.</span><span class=nx>SetConnMaxLifetime</span><span class=p>(</span><span class=nx>time</span><span class=p>.</span><span class=nx>Duration</span><span class=p>(</span><span class=nx>config</span><span class=p>.</span><span class=nx>MaxLifeTime</span><span class=p>))</span>
<a id=__codelineno-70-63 name=__codelineno-70-63 href=#__codelineno-70-63></a><span class=w>    </span><span class=nx>isInit</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=kc>true</span>
<a id=__codelineno-70-64 name=__codelineno-70-64 href=#__codelineno-70-64></a><span class=w>    </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Info</span><span class=p>(</span><span class=s>&quot;连接数据库成功！&quot;</span><span class=p>)</span>
<a id=__codelineno-70-65 name=__codelineno-70-65 href=#__codelineno-70-65></a><span class=p>}</span>
<a id=__codelineno-70-66 name=__codelineno-70-66 href=#__codelineno-70-66></a>
<a id=__codelineno-70-67 name=__codelineno-70-67 href=#__codelineno-70-67></a><span class=c1>// Close db的关闭函数</span>
<a id=__codelineno-70-68 name=__codelineno-70-68 href=#__codelineno-70-68></a><span class=kd>func</span><span class=w> </span><span class=nx>Close</span><span class=p>()</span><span class=w> </span><span class=kt>error</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-70-69 name=__codelineno-70-69 href=#__codelineno-70-69></a><span class=w>    </span><span class=nx>sqlDb</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>GORM</span><span class=p>.</span><span class=nx>DB</span><span class=p>()</span>
<a id=__codelineno-70-70 name=__codelineno-70-70 href=#__codelineno-70-70></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-70-71 name=__codelineno-70-71 href=#__codelineno-70-71></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取Deployment列表失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-70-72 name=__codelineno-70-72 href=#__codelineno-70-72></a><span class=w>        </span><span class=nb>panic</span><span class=p>(</span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-70-73 name=__codelineno-70-73 href=#__codelineno-70-73></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-70-74 name=__codelineno-70-74 href=#__codelineno-70-74></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>sqlDb</span><span class=p>.</span><span class=nx>Close</span><span class=p>()</span>
<a id=__codelineno-70-75 name=__codelineno-70-75 href=#__codelineno-70-75></a><span class=p>}</span>
</code></pre></div> <blockquote> <p>SetMaxOpenConns 默认情况下，连接池的最大数量是没有限制的。一般来说，连接数越多，访问数据库的性能越高。但是系统资源不是无限的，数据库的并发能力也不是无限的。因此为了减少系统和数据库崩溃的风险，可以给并发连接数设置一个上限，这个数值一般不超过进程的最大文件句柄打开数，不超过数据库服务自身支持的并发连接数，比如1000。 </p> <p>SetMaxIdleConns 理论上maxIdleConns连接的上限越高，也即允许在连接池中的空闲连接最大值越大，可以有效减少连接创建和销毁的次数，提高程序的性能。但是连接对象也是占用内存资源的，而且如果空闲连接越多，存在于连接池内的时间可能越长。 连接在经过一段时间后有可能会变得不可用 ，而这时连接还在连接池内没有回收的话，后续被征用的时候就会出问题。一般建议maxIdleConns的值为MaxOpenConns的 &frac12; ，仅供参考。</p> <p>SetConnMaxLifetime 设置一个连接被使用的最长时间，即过了一段时间后会被强制回收，理论上这可以有效减少不可用连接出现的概率。当数据库方面也设置了连接的超时时间时，这个值应当不超过数据库的超时参数值。</p> </blockquote> <p>main.go</p> <div class=highlight><pre><span></span><code><a id=__codelineno-71-1 name=__codelineno-71-1 href=#__codelineno-71-1></a><span class=kn>package</span><span class=w> </span><span class=nx>main</span>
<a id=__codelineno-71-2 name=__codelineno-71-2 href=#__codelineno-71-2></a>
<a id=__codelineno-71-3 name=__codelineno-71-3 href=#__codelineno-71-3></a><span class=kn>import</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-71-4 name=__codelineno-71-4 href=#__codelineno-71-4></a><span class=w>    </span><span class=s>&quot;gitee.com/hujianli94net/k8s-platform/config&quot;</span>
<a id=__codelineno-71-5 name=__codelineno-71-5 href=#__codelineno-71-5></a><span class=w>    </span><span class=s>&quot;gitee.com/hujianli94net/k8s-platform/controller&quot;</span>
<a id=__codelineno-71-6 name=__codelineno-71-6 href=#__codelineno-71-6></a><span class=w>    </span><span class=s>&quot;gitee.com/hujianli94net/k8s-platform/db&quot;</span>
<a id=__codelineno-71-7 name=__codelineno-71-7 href=#__codelineno-71-7></a><span class=w>    </span><span class=s>&quot;gitee.com/hujianli94net/k8s-platform/service&quot;</span>
<a id=__codelineno-71-8 name=__codelineno-71-8 href=#__codelineno-71-8></a>
<a id=__codelineno-71-9 name=__codelineno-71-9 href=#__codelineno-71-9></a><span class=w>    </span><span class=s>&quot;github.com/gin-gonic/gin&quot;</span>
<a id=__codelineno-71-10 name=__codelineno-71-10 href=#__codelineno-71-10></a><span class=p>)</span>
<a id=__codelineno-71-11 name=__codelineno-71-11 href=#__codelineno-71-11></a>
<a id=__codelineno-71-12 name=__codelineno-71-12 href=#__codelineno-71-12></a><span class=kd>func</span><span class=w> </span><span class=nx>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-71-13 name=__codelineno-71-13 href=#__codelineno-71-13></a><span class=w>    </span><span class=c1>//初始化k8s client</span>
<a id=__codelineno-71-14 name=__codelineno-71-14 href=#__codelineno-71-14></a><span class=w>    </span><span class=nx>service</span><span class=p>.</span><span class=nx>K8s</span><span class=p>.</span><span class=nx>Init</span><span class=p>()</span>
<a id=__codelineno-71-15 name=__codelineno-71-15 href=#__codelineno-71-15></a><span class=w>    </span><span class=c1>//初始化数据库</span>
<a id=__codelineno-71-16 name=__codelineno-71-16 href=#__codelineno-71-16></a><span class=w>    </span><span class=nx>db</span><span class=p>.</span><span class=nx>Init</span><span class=p>()</span>
<a id=__codelineno-71-17 name=__codelineno-71-17 href=#__codelineno-71-17></a><span class=w>    </span><span class=c1>//初始化gin对象</span>
<a id=__codelineno-71-18 name=__codelineno-71-18 href=#__codelineno-71-18></a><span class=w>    </span><span class=nx>r</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>Default</span><span class=p>()</span>
<a id=__codelineno-71-19 name=__codelineno-71-19 href=#__codelineno-71-19></a><span class=w>    </span><span class=c1>//初始化k8s client</span>
<a id=__codelineno-71-20 name=__codelineno-71-20 href=#__codelineno-71-20></a><span class=w>    </span><span class=nx>service</span><span class=p>.</span><span class=nx>K8s</span><span class=p>.</span><span class=nx>Init</span><span class=p>()</span>
<a id=__codelineno-71-21 name=__codelineno-71-21 href=#__codelineno-71-21></a><span class=w>    </span><span class=c1>//初始化路由规则</span>
<a id=__codelineno-71-22 name=__codelineno-71-22 href=#__codelineno-71-22></a><span class=w>    </span><span class=nx>controller</span><span class=p>.</span><span class=nx>Router</span><span class=p>.</span><span class=nx>InitApiRouter</span><span class=p>(</span><span class=nx>r</span><span class=p>)</span>
<a id=__codelineno-71-23 name=__codelineno-71-23 href=#__codelineno-71-23></a><span class=w>    </span><span class=c1>//gin程序启动</span>
<a id=__codelineno-71-24 name=__codelineno-71-24 href=#__codelineno-71-24></a><span class=w>    </span><span class=nx>r</span><span class=p>.</span><span class=nx>Run</span><span class=p>(</span><span class=nx>config</span><span class=p>.</span><span class=nx>ListenAddr</span><span class=p>)</span>
<a id=__codelineno-71-25 name=__codelineno-71-25 href=#__codelineno-71-25></a><span class=w>    </span><span class=c1>//关闭db连接</span>
<a id=__codelineno-71-26 name=__codelineno-71-26 href=#__codelineno-71-26></a><span class=w>    </span><span class=nx>db</span><span class=p>.</span><span class=nx>Close</span><span class=p>()</span>
<a id=__codelineno-71-27 name=__codelineno-71-27 href=#__codelineno-71-27></a><span class=p>}</span>
</code></pre></div> <h5 id=2建立表的映射关系>(2)建立表的映射关系<a class=headerlink href=#2建立表的映射关系 title="Permanent link">&para;</a></h5> <p>model/workflow.go</p> <div class=highlight><pre><span></span><code><a id=__codelineno-72-1 name=__codelineno-72-1 href=#__codelineno-72-1></a><span class=kn>package</span><span class=w> </span><span class=nx>model</span>
<a id=__codelineno-72-2 name=__codelineno-72-2 href=#__codelineno-72-2></a>
<a id=__codelineno-72-3 name=__codelineno-72-3 href=#__codelineno-72-3></a><span class=kn>import</span><span class=w> </span><span class=s>&quot;time&quot;</span>
<a id=__codelineno-72-4 name=__codelineno-72-4 href=#__codelineno-72-4></a>
<a id=__codelineno-72-5 name=__codelineno-72-5 href=#__codelineno-72-5></a><span class=c1>// Workflow 定义结构体，属性与mysql表字段对齐</span>
<a id=__codelineno-72-6 name=__codelineno-72-6 href=#__codelineno-72-6></a><span class=kd>type</span><span class=w> </span><span class=nx>Workflow</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-72-7 name=__codelineno-72-7 href=#__codelineno-72-7></a><span class=w>    </span><span class=c1>// gorm:&quot;primaryKey&quot;用于声明主键</span>
<a id=__codelineno-72-8 name=__codelineno-72-8 href=#__codelineno-72-8></a><span class=w>    </span><span class=nx>ID</span><span class=w>        </span><span class=kt>uint</span><span class=w>       </span><span class=s>`json:&quot;id&quot; gorm:&quot;primaryKey&quot;`</span>
<a id=__codelineno-72-9 name=__codelineno-72-9 href=#__codelineno-72-9></a><span class=w>    </span><span class=nx>CreatedAt</span><span class=w> </span><span class=o>*</span><span class=nx>time</span><span class=p>.</span><span class=nx>Time</span><span class=w> </span><span class=s>`json:&quot;created_at&quot;`</span>
<a id=__codelineno-72-10 name=__codelineno-72-10 href=#__codelineno-72-10></a><span class=w>    </span><span class=nx>UpdatedAt</span><span class=w> </span><span class=o>*</span><span class=nx>time</span><span class=p>.</span><span class=nx>Time</span><span class=w> </span><span class=s>`json:&quot;updated_at&quot;`</span>
<a id=__codelineno-72-11 name=__codelineno-72-11 href=#__codelineno-72-11></a><span class=w>    </span><span class=nx>DeletedAt</span><span class=w> </span><span class=o>*</span><span class=nx>time</span><span class=p>.</span><span class=nx>Time</span><span class=w> </span><span class=s>`json:&quot;deleted_at&quot;`</span>
<a id=__codelineno-72-12 name=__codelineno-72-12 href=#__codelineno-72-12></a>
<a id=__codelineno-72-13 name=__codelineno-72-13 href=#__codelineno-72-13></a><span class=w>    </span><span class=nx>Name</span><span class=w>       </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;name&quot;`</span>
<a id=__codelineno-72-14 name=__codelineno-72-14 href=#__codelineno-72-14></a><span class=w>    </span><span class=nx>Namespace</span><span class=w>  </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;namespace&quot;`</span>
<a id=__codelineno-72-15 name=__codelineno-72-15 href=#__codelineno-72-15></a><span class=w>    </span><span class=nx>Replicas</span><span class=w>   </span><span class=kt>int32</span><span class=w>  </span><span class=s>`json:&quot;replicas&quot;`</span>
<a id=__codelineno-72-16 name=__codelineno-72-16 href=#__codelineno-72-16></a><span class=w>    </span><span class=nx>Deployment</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;deployment&quot;`</span>
<a id=__codelineno-72-17 name=__codelineno-72-17 href=#__codelineno-72-17></a><span class=w>    </span><span class=nx>Service</span><span class=w>    </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;service&quot;`</span>
<a id=__codelineno-72-18 name=__codelineno-72-18 href=#__codelineno-72-18></a><span class=w>    </span><span class=nx>Ingress</span><span class=w>    </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;ingress&quot;`</span>
<a id=__codelineno-72-19 name=__codelineno-72-19 href=#__codelineno-72-19></a><span class=w>    </span><span class=nx>Type</span><span class=w>       </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;type&quot; gorm:&quot;column:type&quot;`</span>
<a id=__codelineno-72-20 name=__codelineno-72-20 href=#__codelineno-72-20></a><span class=w>    </span><span class=c1>//Type: clusterip nodeport ingrress</span>
<a id=__codelineno-72-21 name=__codelineno-72-21 href=#__codelineno-72-21></a><span class=p>}</span>
<a id=__codelineno-72-22 name=__codelineno-72-22 href=#__codelineno-72-22></a>
<a id=__codelineno-72-23 name=__codelineno-72-23 href=#__codelineno-72-23></a><span class=c1>// TableName 定义TableName方法，返回mysql表名，以此来定义mysql中的表名</span>
<a id=__codelineno-72-24 name=__codelineno-72-24 href=#__codelineno-72-24></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=o>*</span><span class=nx>Workflow</span><span class=p>)</span><span class=w> </span><span class=nx>TableName</span><span class=p>()</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-72-25 name=__codelineno-72-25 href=#__codelineno-72-25></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=s>&quot;workflow&quot;</span>
<a id=__codelineno-72-26 name=__codelineno-72-26 href=#__codelineno-72-26></a><span class=p>}</span>
</code></pre></div> <h5 id=3数据库创建表>(3)数据库创建表<a class=headerlink href=#3数据库创建表 title="Permanent link">&para;</a></h5> <p>首先创建数据库</p> <div class=highlight><pre><span></span><code><a id=__codelineno-73-1 name=__codelineno-73-1 href=#__codelineno-73-1></a><span class=k>CREATE</span><span class=w> </span><span class=k>DATABASE</span><span class=w> </span><span class=o>`</span><span class=n>kubernetes</span><span class=o>-</span><span class=n>manage</span><span class=o>`</span><span class=w> </span><span class=nb>CHARACTER</span><span class=w> </span><span class=k>SET</span><span class=w> </span><span class=s1>&#39;utf8&#39;</span><span class=p>;</span>
</code></pre></div> <p>使用 AutoMigrate 迁移创建表。</p> <p>AutoMigrate 会创建表、缺失的外键、约束、列和索引。</p> <p><code>db/db.go</code></p> <div class=highlight><pre><span></span><code><a id=__codelineno-74-1 name=__codelineno-74-1 href=#__codelineno-74-1></a><span class=c1>//Init db的初始化函数，与数据库建立连接</span>
<a id=__codelineno-74-2 name=__codelineno-74-2 href=#__codelineno-74-2></a><span class=kd>func</span><span class=w> </span><span class=nx>Init</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-74-3 name=__codelineno-74-3 href=#__codelineno-74-3></a><span class=w>    </span><span class=c1>//判断是否已经初始化了</span>
<a id=__codelineno-74-4 name=__codelineno-74-4 href=#__codelineno-74-4></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>isInit</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-74-5 name=__codelineno-74-5 href=#__codelineno-74-5></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-74-6 name=__codelineno-74-6 href=#__codelineno-74-6></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-74-7 name=__codelineno-74-7 href=#__codelineno-74-7></a><span class=w>    </span><span class=c1>//组装连接配置</span>
<a id=__codelineno-74-8 name=__codelineno-74-8 href=#__codelineno-74-8></a><span class=w>    </span><span class=c1>//parseTime是查询结果是否自动解析为时间</span>
<a id=__codelineno-74-9 name=__codelineno-74-9 href=#__codelineno-74-9></a><span class=w>    </span><span class=c1>//loc是Mysql的时区设置</span>
<a id=__codelineno-74-10 name=__codelineno-74-10 href=#__codelineno-74-10></a><span class=w>    </span><span class=nx>dsn</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>fmt</span><span class=p>.</span><span class=nx>Sprintf</span><span class=p>(</span><span class=s>&quot;%s:%s@tcp(%s:%d)/%s?charset=utf8&amp;parseTime=True&amp;loc=Local&quot;</span><span class=p>,</span>
<a id=__codelineno-74-11 name=__codelineno-74-11 href=#__codelineno-74-11></a><span class=w>        </span><span class=nx>config</span><span class=p>.</span><span class=nx>DbUser</span><span class=p>,</span>
<a id=__codelineno-74-12 name=__codelineno-74-12 href=#__codelineno-74-12></a><span class=w>        </span><span class=nx>config</span><span class=p>.</span><span class=nx>DbPwd</span><span class=p>,</span>
<a id=__codelineno-74-13 name=__codelineno-74-13 href=#__codelineno-74-13></a><span class=w>        </span><span class=nx>config</span><span class=p>.</span><span class=nx>DbHost</span><span class=p>,</span>
<a id=__codelineno-74-14 name=__codelineno-74-14 href=#__codelineno-74-14></a><span class=w>        </span><span class=nx>config</span><span class=p>.</span><span class=nx>DbPort</span><span class=p>,</span>
<a id=__codelineno-74-15 name=__codelineno-74-15 href=#__codelineno-74-15></a><span class=w>        </span><span class=nx>config</span><span class=p>.</span><span class=nx>DbName</span><span class=p>)</span>
<a id=__codelineno-74-16 name=__codelineno-74-16 href=#__codelineno-74-16></a><span class=w>    </span><span class=c1>//与数据库建立连接，生成一个*gorm.DB类型的对象</span>
<a id=__codelineno-74-17 name=__codelineno-74-17 href=#__codelineno-74-17></a><span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=nx>DbType</span><span class=w> </span><span class=nx>gorm</span><span class=p>.</span><span class=nx>Dialector</span>
<a id=__codelineno-74-18 name=__codelineno-74-18 href=#__codelineno-74-18></a><span class=w>    </span><span class=c1>//DbType := *new(gorm.Dialector)</span>
<a id=__codelineno-74-19 name=__codelineno-74-19 href=#__codelineno-74-19></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>config</span><span class=p>.</span><span class=nx>DbType</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&quot;mysql&quot;</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-74-20 name=__codelineno-74-20 href=#__codelineno-74-20></a><span class=w>        </span><span class=nx>DbType</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>mysql</span><span class=p>.</span><span class=nx>Open</span><span class=p>(</span><span class=nx>dsn</span><span class=p>)</span>
<a id=__codelineno-74-21 name=__codelineno-74-21 href=#__codelineno-74-21></a><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-74-22 name=__codelineno-74-22 href=#__codelineno-74-22></a><span class=w>        </span><span class=nb>panic</span><span class=p>(</span><span class=s>&quot;config.DbType!=\&quot;mysql\&quot;&quot;</span><span class=p>)</span>
<a id=__codelineno-74-23 name=__codelineno-74-23 href=#__codelineno-74-23></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-74-24 name=__codelineno-74-24 href=#__codelineno-74-24></a><span class=w>    </span><span class=c1>//连接数据库</span>
<a id=__codelineno-74-25 name=__codelineno-74-25 href=#__codelineno-74-25></a><span class=w>    </span><span class=nx>GORM</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>gorm</span><span class=p>.</span><span class=nx>Open</span><span class=p>(</span><span class=nx>DbType</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=nx>gorm</span><span class=p>.</span><span class=nx>Config</span><span class=p>{})</span>
<a id=__codelineno-74-26 name=__codelineno-74-26 href=#__codelineno-74-26></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-74-27 name=__codelineno-74-27 href=#__codelineno-74-27></a><span class=w>        </span><span class=nb>panic</span><span class=p>(</span><span class=s>&quot;数据库连接失败&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-74-28 name=__codelineno-74-28 href=#__codelineno-74-28></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-74-29 name=__codelineno-74-29 href=#__codelineno-74-29></a><span class=w>    </span><span class=c1>////打印sql语句</span>
<a id=__codelineno-74-30 name=__codelineno-74-30 href=#__codelineno-74-30></a><span class=w>    </span><span class=c1>//fmt.Println(&quot;db&quot;, GORM)</span>
<a id=__codelineno-74-31 name=__codelineno-74-31 href=#__codelineno-74-31></a><span class=w>    </span><span class=c1>//启用日志记录功能</span>
<a id=__codelineno-74-32 name=__codelineno-74-32 href=#__codelineno-74-32></a><span class=w>    </span><span class=c1>//GORM = GORM.Debug()</span>
<a id=__codelineno-74-33 name=__codelineno-74-33 href=#__codelineno-74-33></a>
<a id=__codelineno-74-34 name=__codelineno-74-34 href=#__codelineno-74-34></a><span class=w>    </span><span class=c1>//自动创建表</span>
<a id=__codelineno-74-35 name=__codelineno-74-35 href=#__codelineno-74-35></a><span class=w>    </span><span class=nx>GORM</span><span class=p>.</span><span class=nx>AutoMigrate</span><span class=p>(</span>
<a id=__codelineno-74-36 name=__codelineno-74-36 href=#__codelineno-74-36></a><span class=w>        </span><span class=nx>model</span><span class=p>.</span><span class=nx>Workflow</span><span class=p>{},</span>
<a id=__codelineno-74-37 name=__codelineno-74-37 href=#__codelineno-74-37></a><span class=w>    </span><span class=p>)</span>
<a id=__codelineno-74-38 name=__codelineno-74-38 href=#__codelineno-74-38></a>
<a id=__codelineno-74-39 name=__codelineno-74-39 href=#__codelineno-74-39></a><span class=w>    </span><span class=c1>//开启连接池</span>
<a id=__codelineno-74-40 name=__codelineno-74-40 href=#__codelineno-74-40></a><span class=w>    </span><span class=nx>sqlDb</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>GORM</span><span class=p>.</span><span class=nx>DB</span><span class=p>()</span>
<a id=__codelineno-74-41 name=__codelineno-74-41 href=#__codelineno-74-41></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-74-42 name=__codelineno-74-42 href=#__codelineno-74-42></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取Deployment列表失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()))</span>
<a id=__codelineno-74-43 name=__codelineno-74-43 href=#__codelineno-74-43></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-74-44 name=__codelineno-74-44 href=#__codelineno-74-44></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-74-45 name=__codelineno-74-45 href=#__codelineno-74-45></a>
<a id=__codelineno-74-46 name=__codelineno-74-46 href=#__codelineno-74-46></a><span class=w>    </span><span class=c1>//连接池最大允许的空闲连接数，如果没有sql任务需要执行的连接数大于20，超过的连接会被连接池关闭</span>
<a id=__codelineno-74-47 name=__codelineno-74-47 href=#__codelineno-74-47></a><span class=w>    </span><span class=nx>sqlDb</span><span class=p>.</span><span class=nx>SetMaxIdleConns</span><span class=p>(</span><span class=nx>config</span><span class=p>.</span><span class=nx>MaxIdleConns</span><span class=p>)</span>
<a id=__codelineno-74-48 name=__codelineno-74-48 href=#__codelineno-74-48></a><span class=w>    </span><span class=c1>//设置了连接池最大数量</span>
<a id=__codelineno-74-49 name=__codelineno-74-49 href=#__codelineno-74-49></a><span class=w>    </span><span class=nx>sqlDb</span><span class=p>.</span><span class=nx>SetMaxOpenConns</span><span class=p>(</span><span class=nx>config</span><span class=p>.</span><span class=nx>MaxOpenConns</span><span class=p>)</span>
<a id=__codelineno-74-50 name=__codelineno-74-50 href=#__codelineno-74-50></a><span class=w>    </span><span class=c1>//设置了连接可复用的最大时间</span>
<a id=__codelineno-74-51 name=__codelineno-74-51 href=#__codelineno-74-51></a><span class=w>    </span><span class=nx>sqlDb</span><span class=p>.</span><span class=nx>SetConnMaxLifetime</span><span class=p>(</span><span class=nx>time</span><span class=p>.</span><span class=nx>Duration</span><span class=p>(</span><span class=nx>config</span><span class=p>.</span><span class=nx>MaxLifeTime</span><span class=p>))</span>
<a id=__codelineno-74-52 name=__codelineno-74-52 href=#__codelineno-74-52></a><span class=w>    </span><span class=nx>isInit</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=kc>true</span>
<a id=__codelineno-74-53 name=__codelineno-74-53 href=#__codelineno-74-53></a><span class=w>    </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Info</span><span class=p>(</span><span class=s>&quot;连接数据库成功！&quot;</span><span class=p>)</span>
<a id=__codelineno-74-54 name=__codelineno-74-54 href=#__codelineno-74-54></a><span class=p>}</span>
</code></pre></div> <!-- ```sql
CREATE TABLE `workflow` (
  `id` int NOT NULL AUTO_INCREMENT,
  `name` varchar(32) COLLATE utf8mb4_general_ci NOT NULL,
  `namespace` varchar(32) COLLATE utf8mb4_general_ci DEFAULT NULL,
  `replicas` int DEFAULT NULL,
  `deployment` varchar(32) COLLATE utf8mb4_general_ci DEFAULT NULL,
  `service` varchar(32) COLLATE utf8mb4_general_ci DEFAULT NULL,
  `ingress` varchar(32) COLLATE utf8mb4_general_ci DEFAULT NULL,
  `type` varchar(32) COLLATE utf8mb4_general_ci DEFAULT NULL,
  `created_at` datetime DEFAULT NULL,
  `updated_at` datetime DEFAULT NULL,
  `deleted_at` datetime DEFAULT NULL,
  PRIMARY KEY (`id`) USING BTREE,
  UNIQUE KEY `name` (`name`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci
``` --> <h5 id=4表数据列表>(4)表数据列表<a class=headerlink href=#4表数据列表 title="Permanent link">&para;</a></h5> <p><code>dao/workflow.go</code></p> <div class=highlight><pre><span></span><code><a id=__codelineno-75-1 name=__codelineno-75-1 href=#__codelineno-75-1></a><span class=kn>package</span><span class=w> </span><span class=nx>dao</span>
<a id=__codelineno-75-2 name=__codelineno-75-2 href=#__codelineno-75-2></a>
<a id=__codelineno-75-3 name=__codelineno-75-3 href=#__codelineno-75-3></a><span class=kn>import</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-75-4 name=__codelineno-75-4 href=#__codelineno-75-4></a><span class=w>    </span><span class=s>&quot;errors&quot;</span>
<a id=__codelineno-75-5 name=__codelineno-75-5 href=#__codelineno-75-5></a><span class=w>    </span><span class=s>&quot;gitee.com/hujianli94net/k8s-platform/db&quot;</span>
<a id=__codelineno-75-6 name=__codelineno-75-6 href=#__codelineno-75-6></a><span class=w>    </span><span class=s>&quot;gitee.com/hujianli94net/k8s-platform/model&quot;</span>
<a id=__codelineno-75-7 name=__codelineno-75-7 href=#__codelineno-75-7></a>
<a id=__codelineno-75-8 name=__codelineno-75-8 href=#__codelineno-75-8></a><span class=w>    </span><span class=s>&quot;github.com/wonderivan/logger&quot;</span>
<a id=__codelineno-75-9 name=__codelineno-75-9 href=#__codelineno-75-9></a><span class=p>)</span>
<a id=__codelineno-75-10 name=__codelineno-75-10 href=#__codelineno-75-10></a>
<a id=__codelineno-75-11 name=__codelineno-75-11 href=#__codelineno-75-11></a><span class=kd>type</span><span class=w> </span><span class=nx>workflow</span><span class=w> </span><span class=kd>struct</span><span class=p>{}</span>
<a id=__codelineno-75-12 name=__codelineno-75-12 href=#__codelineno-75-12></a>
<a id=__codelineno-75-13 name=__codelineno-75-13 href=#__codelineno-75-13></a><span class=kd>var</span><span class=w> </span><span class=nx>Workflow</span><span class=w> </span><span class=nx>workflow</span>
<a id=__codelineno-75-14 name=__codelineno-75-14 href=#__codelineno-75-14></a>
<a id=__codelineno-75-15 name=__codelineno-75-15 href=#__codelineno-75-15></a><span class=c1>// WorkflowResp 定义列表的返回内容，Items是workflow元素列表，Total为workflow元素数量</span>
<a id=__codelineno-75-16 name=__codelineno-75-16 href=#__codelineno-75-16></a><span class=kd>type</span><span class=w> </span><span class=nx>WorkflowResp</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-75-17 name=__codelineno-75-17 href=#__codelineno-75-17></a><span class=w>    </span><span class=nx>Items</span><span class=w> </span><span class=p>[]</span><span class=o>*</span><span class=nx>model</span><span class=p>.</span><span class=nx>Workflow</span><span class=w> </span><span class=s>`json:&quot;items&quot;`</span>
<a id=__codelineno-75-18 name=__codelineno-75-18 href=#__codelineno-75-18></a><span class=w>    </span><span class=nx>Total</span><span class=w> </span><span class=kt>int</span><span class=w>               </span><span class=s>`json:&quot;total&quot;`</span>
<a id=__codelineno-75-19 name=__codelineno-75-19 href=#__codelineno-75-19></a><span class=p>}</span>
<a id=__codelineno-75-20 name=__codelineno-75-20 href=#__codelineno-75-20></a>
<a id=__codelineno-75-21 name=__codelineno-75-21 href=#__codelineno-75-21></a><span class=c1>// GetList 获取列表分页查询</span>
<a id=__codelineno-75-22 name=__codelineno-75-22 href=#__codelineno-75-22></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>w</span><span class=w> </span><span class=o>*</span><span class=nx>workflow</span><span class=p>)</span><span class=w> </span><span class=nx>GetList</span><span class=p>(</span><span class=nx>namespace</span><span class=w> </span><span class=kt>string</span><span class=p>,</span><span class=w> </span><span class=nx>page</span><span class=p>,</span><span class=w> </span><span class=nx>limit</span><span class=w> </span><span class=kt>int</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>data</span><span class=w> </span><span class=o>*</span><span class=nx>WorkflowResp</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-75-23 name=__codelineno-75-23 href=#__codelineno-75-23></a><span class=w>    </span><span class=c1>//定义分页数据的起始位置</span>
<a id=__codelineno-75-24 name=__codelineno-75-24 href=#__codelineno-75-24></a><span class=w>    </span><span class=nx>startSet</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=p>(</span><span class=nx>page</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mi>1</span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=nx>limit</span>
<a id=__codelineno-75-25 name=__codelineno-75-25 href=#__codelineno-75-25></a><span class=w>    </span><span class=c1>//定义数据库查询返回内容</span>
<a id=__codelineno-75-26 name=__codelineno-75-26 href=#__codelineno-75-26></a><span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=nx>workflowList</span><span class=w> </span><span class=p>[]</span><span class=o>*</span><span class=nx>model</span><span class=p>.</span><span class=nx>Workflow</span>
<a id=__codelineno-75-27 name=__codelineno-75-27 href=#__codelineno-75-27></a><span class=w>    </span><span class=c1>//数据库查询，Limit方法用于限制条数，Offset方法设置起始位置</span>
<a id=__codelineno-75-28 name=__codelineno-75-28 href=#__codelineno-75-28></a><span class=w>    </span><span class=nx>tx</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>db</span><span class=p>.</span><span class=nx>GORM</span><span class=p>.</span>
<a id=__codelineno-75-29 name=__codelineno-75-29 href=#__codelineno-75-29></a><span class=w>        </span><span class=nx>Where</span><span class=p>(</span><span class=s>&quot;namespace = ?&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>namespace</span><span class=p>).</span>
<a id=__codelineno-75-30 name=__codelineno-75-30 href=#__codelineno-75-30></a><span class=w>        </span><span class=nx>Limit</span><span class=p>(</span><span class=nx>limit</span><span class=p>).</span>
<a id=__codelineno-75-31 name=__codelineno-75-31 href=#__codelineno-75-31></a><span class=w>        </span><span class=nx>Offset</span><span class=p>(</span><span class=nx>startSet</span><span class=p>).</span>
<a id=__codelineno-75-32 name=__codelineno-75-32 href=#__codelineno-75-32></a><span class=w>        </span><span class=nx>Order</span><span class=p>(</span><span class=s>&quot;id desc&quot;</span><span class=p>).</span>
<a id=__codelineno-75-33 name=__codelineno-75-33 href=#__codelineno-75-33></a><span class=w>        </span><span class=nx>Find</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>workflowList</span><span class=p>)</span>
<a id=__codelineno-75-34 name=__codelineno-75-34 href=#__codelineno-75-34></a><span class=w>    </span><span class=c1>//gorm会默认把空数据也放到err中，故这里要排除空数据的情况</span>
<a id=__codelineno-75-35 name=__codelineno-75-35 href=#__codelineno-75-35></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>tx</span><span class=p>.</span><span class=nx>Error</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nx>tx</span><span class=p>.</span><span class=nx>Error</span><span class=p>.</span><span class=nx>Error</span><span class=p>()</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=s>&quot;record not found&quot;</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-75-36 name=__codelineno-75-36 href=#__codelineno-75-36></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;获取Workflow列表失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>tx</span><span class=p>.</span><span class=nx>Error</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-75-37 name=__codelineno-75-37 href=#__codelineno-75-37></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取Workflow列表失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>tx</span><span class=p>.</span><span class=nx>Error</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-75-38 name=__codelineno-75-38 href=#__codelineno-75-38></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-75-39 name=__codelineno-75-39 href=#__codelineno-75-39></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=o>&amp;</span><span class=nx>WorkflowResp</span><span class=p>{</span>
<a id=__codelineno-75-40 name=__codelineno-75-40 href=#__codelineno-75-40></a><span class=w>        </span><span class=nx>Items</span><span class=p>:</span><span class=w> </span><span class=nx>workflowList</span><span class=p>,</span>
<a id=__codelineno-75-41 name=__codelineno-75-41 href=#__codelineno-75-41></a><span class=w>        </span><span class=nx>Total</span><span class=p>:</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>workflowList</span><span class=p>),</span>
<a id=__codelineno-75-42 name=__codelineno-75-42 href=#__codelineno-75-42></a><span class=w>    </span><span class=p>},</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-75-43 name=__codelineno-75-43 href=#__codelineno-75-43></a><span class=p>}</span>
</code></pre></div> <h5 id=5获取单条>(5)获取单条<a class=headerlink href=#5获取单条 title="Permanent link">&para;</a></h5> <div class=highlight><pre><span></span><code><a id=__codelineno-76-1 name=__codelineno-76-1 href=#__codelineno-76-1></a><span class=c1>// GetById 获取workflow单条数据</span>
<a id=__codelineno-76-2 name=__codelineno-76-2 href=#__codelineno-76-2></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>w</span><span class=w> </span><span class=o>*</span><span class=nx>workflow</span><span class=p>)</span><span class=w> </span><span class=nx>GetById</span><span class=p>(</span><span class=nx>id</span><span class=w> </span><span class=kt>int</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>workflow</span><span class=w> </span><span class=o>*</span><span class=nx>model</span><span class=p>.</span><span class=nx>Workflow</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-76-3 name=__codelineno-76-3 href=#__codelineno-76-3></a><span class=w>    </span><span class=nx>workflow</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>model</span><span class=p>.</span><span class=nx>Workflow</span><span class=p>{}</span><span class=w> </span><span class=c1>//给空间</span>
<a id=__codelineno-76-4 name=__codelineno-76-4 href=#__codelineno-76-4></a><span class=w>    </span><span class=nx>tx</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>db</span><span class=p>.</span><span class=nx>GORM</span><span class=p>.</span><span class=nx>Where</span><span class=p>(</span><span class=s>&quot;id = ?&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>id</span><span class=p>).</span><span class=nx>First</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>workflow</span><span class=p>)</span>
<a id=__codelineno-76-5 name=__codelineno-76-5 href=#__codelineno-76-5></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>tx</span><span class=p>.</span><span class=nx>Error</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nx>tx</span><span class=p>.</span><span class=nx>Error</span><span class=p>.</span><span class=nx>Error</span><span class=p>()</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=s>&quot;record not found&quot;</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-76-6 name=__codelineno-76-6 href=#__codelineno-76-6></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;获取Workflow单条数据失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>tx</span><span class=p>.</span><span class=nx>Error</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-76-7 name=__codelineno-76-7 href=#__codelineno-76-7></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;获取Workflow单条数据失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>tx</span><span class=p>.</span><span class=nx>Error</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-76-8 name=__codelineno-76-8 href=#__codelineno-76-8></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-76-9 name=__codelineno-76-9 href=#__codelineno-76-9></a><span class=w>    </span><span class=k>return</span>
<a id=__codelineno-76-10 name=__codelineno-76-10 href=#__codelineno-76-10></a><span class=p>}</span>
</code></pre></div> <h5 id=6表数据新增>(6)表数据新增<a class=headerlink href=#6表数据新增 title="Permanent link">&para;</a></h5> <div class=highlight><pre><span></span><code><a id=__codelineno-77-1 name=__codelineno-77-1 href=#__codelineno-77-1></a><span class=c1>// Add 新增workflow</span>
<a id=__codelineno-77-2 name=__codelineno-77-2 href=#__codelineno-77-2></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>w</span><span class=w> </span><span class=o>*</span><span class=nx>workflow</span><span class=p>)</span><span class=w> </span><span class=nx>Add</span><span class=p>(</span><span class=nx>workflow</span><span class=w> </span><span class=o>*</span><span class=nx>model</span><span class=p>.</span><span class=nx>Workflow</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-77-3 name=__codelineno-77-3 href=#__codelineno-77-3></a><span class=w>    </span><span class=nx>tx</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>db</span><span class=p>.</span><span class=nx>GORM</span><span class=p>.</span><span class=nx>Create</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>workflow</span><span class=p>)</span>
<a id=__codelineno-77-4 name=__codelineno-77-4 href=#__codelineno-77-4></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>tx</span><span class=p>.</span><span class=nx>Error</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-77-5 name=__codelineno-77-5 href=#__codelineno-77-5></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;添加Workflow失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>tx</span><span class=p>.</span><span class=nx>Error</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-77-6 name=__codelineno-77-6 href=#__codelineno-77-6></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;添加Workflow失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>tx</span><span class=p>.</span><span class=nx>Error</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-77-7 name=__codelineno-77-7 href=#__codelineno-77-7></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-77-8 name=__codelineno-77-8 href=#__codelineno-77-8></a><span class=w>    </span><span class=k>return</span>
<a id=__codelineno-77-9 name=__codelineno-77-9 href=#__codelineno-77-9></a><span class=p>}</span>
</code></pre></div> <h5 id=7表数据删除>(7)表数据删除<a class=headerlink href=#7表数据删除 title="Permanent link">&para;</a></h5> <div class=highlight><pre><span></span><code><a id=__codelineno-78-1 name=__codelineno-78-1 href=#__codelineno-78-1></a><span class=c1>// DelById 删除workflow</span>
<a id=__codelineno-78-2 name=__codelineno-78-2 href=#__codelineno-78-2></a><span class=c1>// 软删除db.GORM.Delete(&quot;id = ?&quot;,id)</span>
<a id=__codelineno-78-3 name=__codelineno-78-3 href=#__codelineno-78-3></a><span class=c1>// model.Workflow 定义包含了 DeletedAt 字段，这通常是用于 GORM 软删除的。因此，在提供的代码中，Delete 方法执行的是软删除操作</span>
<a id=__codelineno-78-4 name=__codelineno-78-4 href=#__codelineno-78-4></a><span class=c1>// 软删除执行的是UPDATE语句，将deleted_at字段设置为时间即可，gorm默认就是软删</span>
<a id=__codelineno-78-5 name=__codelineno-78-5 href=#__codelineno-78-5></a><span class=c1>// 实际执行语句UPDATE &#39;workflow&#39; SET &#39;deleted_at&#39; = &#39;2022-09-28 16:22:55&#39; WHERE &#39;id&#39; IN (&#39;1&#39;)</span>
<a id=__codelineno-78-6 name=__codelineno-78-6 href=#__codelineno-78-6></a><span class=c1>// 硬删除db.GORM.Unscoped().Delete(&quot;id = ?&quot;,id)直接从表中删除这条数据</span>
<a id=__codelineno-78-7 name=__codelineno-78-7 href=#__codelineno-78-7></a><span class=c1>// 实际执行语句DELETE FROM &#39;workflow&#39; WHERE &#39;id&#39; IN (&#39;1&#39;);</span>
<a id=__codelineno-78-8 name=__codelineno-78-8 href=#__codelineno-78-8></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>w</span><span class=w> </span><span class=o>*</span><span class=nx>workflow</span><span class=p>)</span><span class=w> </span><span class=nx>DelById</span><span class=p>(</span><span class=nx>id</span><span class=w> </span><span class=kt>int</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-78-9 name=__codelineno-78-9 href=#__codelineno-78-9></a><span class=w>    </span><span class=nx>tx</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>db</span><span class=p>.</span><span class=nx>GORM</span><span class=p>.</span><span class=nx>Where</span><span class=p>(</span><span class=s>&quot;id = ?&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>id</span><span class=p>).</span><span class=nx>Delete</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>model</span><span class=p>.</span><span class=nx>Workflow</span><span class=p>{})</span>
<a id=__codelineno-78-10 name=__codelineno-78-10 href=#__codelineno-78-10></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>tx</span><span class=p>.</span><span class=nx>Error</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-78-11 name=__codelineno-78-11 href=#__codelineno-78-11></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;删除Workflow失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>tx</span><span class=p>.</span><span class=nx>Error</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-78-12 name=__codelineno-78-12 href=#__codelineno-78-12></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;删除Workflow失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>tx</span><span class=p>.</span><span class=nx>Error</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-78-13 name=__codelineno-78-13 href=#__codelineno-78-13></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-78-14 name=__codelineno-78-14 href=#__codelineno-78-14></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-78-15 name=__codelineno-78-15 href=#__codelineno-78-15></a><span class=p>}</span>
</code></pre></div> <h4 id=63-workflow>6.3 Workflow<a class=headerlink href=#63-workflow title="Permanent link">&para;</a></h4> <h5 id=1列表>(1)列表<a class=headerlink href=#1列表 title="Permanent link">&para;</a></h5> <p><code>service/workflow.go</code></p> <div class=highlight><pre><span></span><code><a id=__codelineno-79-1 name=__codelineno-79-1 href=#__codelineno-79-1></a><span class=kn>package</span><span class=w> </span><span class=nx>service</span>
<a id=__codelineno-79-2 name=__codelineno-79-2 href=#__codelineno-79-2></a>
<a id=__codelineno-79-3 name=__codelineno-79-3 href=#__codelineno-79-3></a><span class=kn>import</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-79-4 name=__codelineno-79-4 href=#__codelineno-79-4></a><span class=w>    </span><span class=s>&quot;gitee.com/hujianli94net/k8s-platform/dao&quot;</span>
<a id=__codelineno-79-5 name=__codelineno-79-5 href=#__codelineno-79-5></a><span class=w>    </span><span class=s>&quot;gitee.com/hujianli94net/k8s-platform/model&quot;</span>
<a id=__codelineno-79-6 name=__codelineno-79-6 href=#__codelineno-79-6></a><span class=p>)</span>
<a id=__codelineno-79-7 name=__codelineno-79-7 href=#__codelineno-79-7></a>
<a id=__codelineno-79-8 name=__codelineno-79-8 href=#__codelineno-79-8></a><span class=kd>type</span><span class=w> </span><span class=nx>workflow</span><span class=w> </span><span class=kd>struct</span><span class=p>{}</span>
<a id=__codelineno-79-9 name=__codelineno-79-9 href=#__codelineno-79-9></a>
<a id=__codelineno-79-10 name=__codelineno-79-10 href=#__codelineno-79-10></a><span class=kd>var</span><span class=w> </span><span class=nx>Workflow</span><span class=w> </span><span class=nx>workflow</span>
<a id=__codelineno-79-11 name=__codelineno-79-11 href=#__codelineno-79-11></a>
<a id=__codelineno-79-12 name=__codelineno-79-12 href=#__codelineno-79-12></a><span class=c1>// GetList 获取列表分页查询</span>
<a id=__codelineno-79-13 name=__codelineno-79-13 href=#__codelineno-79-13></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>w</span><span class=w> </span><span class=o>*</span><span class=nx>workflow</span><span class=p>)</span><span class=w> </span><span class=nx>GetList</span><span class=p>(</span><span class=nx>namespace</span><span class=w> </span><span class=kt>string</span><span class=p>,</span><span class=w> </span><span class=nx>page</span><span class=p>,</span><span class=w> </span><span class=nx>limit</span><span class=w> </span><span class=kt>int</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>data</span><span class=w> </span><span class=o>*</span><span class=nx>dao</span><span class=p>.</span><span class=nx>WorkflowResp</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-79-14 name=__codelineno-79-14 href=#__codelineno-79-14></a><span class=w>    </span><span class=nx>data</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>dao</span><span class=p>.</span><span class=nx>Workflow</span><span class=p>.</span><span class=nx>GetList</span><span class=p>(</span><span class=nx>namespace</span><span class=p>,</span><span class=w> </span><span class=nx>page</span><span class=p>,</span><span class=w> </span><span class=nx>limit</span><span class=p>)</span>
<a id=__codelineno-79-15 name=__codelineno-79-15 href=#__codelineno-79-15></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-79-16 name=__codelineno-79-16 href=#__codelineno-79-16></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>err</span>
<a id=__codelineno-79-17 name=__codelineno-79-17 href=#__codelineno-79-17></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-79-18 name=__codelineno-79-18 href=#__codelineno-79-18></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>data</span><span class=p>,</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-79-19 name=__codelineno-79-19 href=#__codelineno-79-19></a><span class=p>}</span>
</code></pre></div> <h5 id=2获取workflow详情>(2)获取Workflow详情<a class=headerlink href=#2获取workflow详情 title="Permanent link">&para;</a></h5> <div class=highlight><pre><span></span><code><a id=__codelineno-80-1 name=__codelineno-80-1 href=#__codelineno-80-1></a><span class=c1>// GetById 查询workflow单条数据</span>
<a id=__codelineno-80-2 name=__codelineno-80-2 href=#__codelineno-80-2></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>w</span><span class=w> </span><span class=o>*</span><span class=nx>workflow</span><span class=p>)</span><span class=w> </span><span class=nx>GetById</span><span class=p>(</span><span class=nx>id</span><span class=w> </span><span class=kt>int</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>data</span><span class=w> </span><span class=o>*</span><span class=nx>model</span><span class=p>.</span><span class=nx>Workflow</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-80-3 name=__codelineno-80-3 href=#__codelineno-80-3></a><span class=w>    </span><span class=nx>data</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>dao</span><span class=p>.</span><span class=nx>Workflow</span><span class=p>.</span><span class=nx>GetById</span><span class=p>(</span><span class=nx>id</span><span class=p>)</span>
<a id=__codelineno-80-4 name=__codelineno-80-4 href=#__codelineno-80-4></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-80-5 name=__codelineno-80-5 href=#__codelineno-80-5></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>err</span>
<a id=__codelineno-80-6 name=__codelineno-80-6 href=#__codelineno-80-6></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-80-7 name=__codelineno-80-7 href=#__codelineno-80-7></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>data</span><span class=p>,</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-80-8 name=__codelineno-80-8 href=#__codelineno-80-8></a><span class=p>}</span>
</code></pre></div> <h5 id=3新增workflow>(3)新增Workflow<a class=headerlink href=#3新增workflow title="Permanent link">&para;</a></h5> <div class=highlight><pre><span></span><code><a id=__codelineno-81-1 name=__codelineno-81-1 href=#__codelineno-81-1></a><span class=c1>// WorkflowCreate 定义WorkflowCreate结构体，用于创建workflow需要的参数属性的定义</span>
<a id=__codelineno-81-2 name=__codelineno-81-2 href=#__codelineno-81-2></a><span class=kd>type</span><span class=w> </span><span class=nx>WorkflowCreate</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-81-3 name=__codelineno-81-3 href=#__codelineno-81-3></a><span class=w>    </span><span class=nx>Name</span><span class=w>          </span><span class=kt>string</span><span class=w>                 </span><span class=s>`json:&quot;name&quot;`</span>
<a id=__codelineno-81-4 name=__codelineno-81-4 href=#__codelineno-81-4></a><span class=w>    </span><span class=nx>Namespace</span><span class=w>     </span><span class=kt>string</span><span class=w>                 </span><span class=s>`json:&quot;namespace&quot;`</span>
<a id=__codelineno-81-5 name=__codelineno-81-5 href=#__codelineno-81-5></a><span class=w>    </span><span class=nx>Replicas</span><span class=w>      </span><span class=kt>int32</span><span class=w>                  </span><span class=s>`json:&quot;replicas&quot;`</span>
<a id=__codelineno-81-6 name=__codelineno-81-6 href=#__codelineno-81-6></a><span class=w>    </span><span class=nx>Image</span><span class=w>         </span><span class=kt>string</span><span class=w>                 </span><span class=s>`json:&quot;image&quot;`</span>
<a id=__codelineno-81-7 name=__codelineno-81-7 href=#__codelineno-81-7></a><span class=w>    </span><span class=nx>Label</span><span class=w>         </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>string</span><span class=w>      </span><span class=s>`json:&quot;label&quot;`</span>
<a id=__codelineno-81-8 name=__codelineno-81-8 href=#__codelineno-81-8></a><span class=w>    </span><span class=nx>Cpu</span><span class=w>           </span><span class=kt>string</span><span class=w>                 </span><span class=s>`json:&quot;cpu&quot;`</span>
<a id=__codelineno-81-9 name=__codelineno-81-9 href=#__codelineno-81-9></a><span class=w>    </span><span class=nx>Memory</span><span class=w>        </span><span class=kt>string</span><span class=w>                 </span><span class=s>`json:&quot;memory&quot;`</span>
<a id=__codelineno-81-10 name=__codelineno-81-10 href=#__codelineno-81-10></a><span class=w>    </span><span class=nx>ContainerPort</span><span class=w> </span><span class=kt>int32</span><span class=w>                  </span><span class=s>`json:&quot;container_port&quot;`</span>
<a id=__codelineno-81-11 name=__codelineno-81-11 href=#__codelineno-81-11></a><span class=w>    </span><span class=nx>HealthCheck</span><span class=w>   </span><span class=kt>bool</span><span class=w>                   </span><span class=s>`json:&quot;health_check&quot;`</span>
<a id=__codelineno-81-12 name=__codelineno-81-12 href=#__codelineno-81-12></a><span class=w>    </span><span class=nx>HealthPath</span><span class=w>    </span><span class=kt>string</span><span class=w>                 </span><span class=s>`json:&quot;health_path&quot;`</span>
<a id=__codelineno-81-13 name=__codelineno-81-13 href=#__codelineno-81-13></a><span class=w>    </span><span class=nx>Type</span><span class=w>          </span><span class=kt>string</span><span class=w>                 </span><span class=s>`json:&quot;type&quot;`</span>
<a id=__codelineno-81-14 name=__codelineno-81-14 href=#__codelineno-81-14></a><span class=w>    </span><span class=nx>Port</span><span class=w>          </span><span class=kt>int32</span><span class=w>                  </span><span class=s>`json:&quot;port&quot;`</span>
<a id=__codelineno-81-15 name=__codelineno-81-15 href=#__codelineno-81-15></a><span class=w>    </span><span class=nx>NodePort</span><span class=w>      </span><span class=kt>int32</span><span class=w>                  </span><span class=s>`json:&quot;node_port&quot;`</span>
<a id=__codelineno-81-16 name=__codelineno-81-16 href=#__codelineno-81-16></a><span class=w>    </span><span class=nx>Hosts</span><span class=w>         </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>][]</span><span class=o>*</span><span class=nx>HttpPath</span><span class=w> </span><span class=s>`json:&quot;hosts&quot;`</span>
<a id=__codelineno-81-17 name=__codelineno-81-17 href=#__codelineno-81-17></a><span class=p>}</span>
<a id=__codelineno-81-18 name=__codelineno-81-18 href=#__codelineno-81-18></a>
<a id=__codelineno-81-19 name=__codelineno-81-19 href=#__codelineno-81-19></a><span class=c1>// workflow名字转换成ingress名字，添加-ing后缀</span>
<a id=__codelineno-81-20 name=__codelineno-81-20 href=#__codelineno-81-20></a><span class=kd>func</span><span class=w> </span><span class=nx>getIngressName</span><span class=p>(</span><span class=nx>workflowName</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>ingressName</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-81-21 name=__codelineno-81-21 href=#__codelineno-81-21></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>workflowName</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&quot;-ing&quot;</span>
<a id=__codelineno-81-22 name=__codelineno-81-22 href=#__codelineno-81-22></a><span class=p>}</span>
<a id=__codelineno-81-23 name=__codelineno-81-23 href=#__codelineno-81-23></a>
<a id=__codelineno-81-24 name=__codelineno-81-24 href=#__codelineno-81-24></a><span class=c1>// workflow名字转换成service名字，添加-svc后缀</span>
<a id=__codelineno-81-25 name=__codelineno-81-25 href=#__codelineno-81-25></a><span class=kd>func</span><span class=w> </span><span class=nx>getServiceName</span><span class=p>(</span><span class=nx>workflowName</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>ingressName</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-81-26 name=__codelineno-81-26 href=#__codelineno-81-26></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>workflowName</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&quot;-svc&quot;</span>
<a id=__codelineno-81-27 name=__codelineno-81-27 href=#__codelineno-81-27></a><span class=p>}</span>
<a id=__codelineno-81-28 name=__codelineno-81-28 href=#__codelineno-81-28></a>
<a id=__codelineno-81-29 name=__codelineno-81-29 href=#__codelineno-81-29></a><span class=c1>// 封装创建workflow对应的k8s资源</span>
<a id=__codelineno-81-30 name=__codelineno-81-30 href=#__codelineno-81-30></a><span class=c1>// 小写开头的函数，作用域只在当前包中，不支持跨包调用</span>
<a id=__codelineno-81-31 name=__codelineno-81-31 href=#__codelineno-81-31></a><span class=kd>func</span><span class=w> </span><span class=nx>createWorkflowRes</span><span class=p>(</span><span class=nx>data</span><span class=w> </span><span class=o>*</span><span class=nx>WorkflowCreate</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-81-32 name=__codelineno-81-32 href=#__codelineno-81-32></a><span class=w>    </span><span class=c1>//声明service类型</span>
<a id=__codelineno-81-33 name=__codelineno-81-33 href=#__codelineno-81-33></a><span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=nx>serviceType</span><span class=w> </span><span class=kt>string</span>
<a id=__codelineno-81-34 name=__codelineno-81-34 href=#__codelineno-81-34></a><span class=w>    </span><span class=c1>//组装DeployCreate类型的数据</span>
<a id=__codelineno-81-35 name=__codelineno-81-35 href=#__codelineno-81-35></a><span class=w>    </span><span class=nx>dc</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>DeployCreate</span><span class=p>{</span>
<a id=__codelineno-81-36 name=__codelineno-81-36 href=#__codelineno-81-36></a><span class=w>        </span><span class=nx>Name</span><span class=p>:</span><span class=w>          </span><span class=nx>data</span><span class=p>.</span><span class=nx>Name</span><span class=p>,</span>
<a id=__codelineno-81-37 name=__codelineno-81-37 href=#__codelineno-81-37></a><span class=w>        </span><span class=nx>Namespace</span><span class=p>:</span><span class=w>     </span><span class=nx>data</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>,</span>
<a id=__codelineno-81-38 name=__codelineno-81-38 href=#__codelineno-81-38></a><span class=w>        </span><span class=nx>Replicas</span><span class=p>:</span><span class=w>      </span><span class=nx>data</span><span class=p>.</span><span class=nx>Replicas</span><span class=p>,</span>
<a id=__codelineno-81-39 name=__codelineno-81-39 href=#__codelineno-81-39></a><span class=w>        </span><span class=nx>Image</span><span class=p>:</span><span class=w>         </span><span class=nx>data</span><span class=p>.</span><span class=nx>Image</span><span class=p>,</span>
<a id=__codelineno-81-40 name=__codelineno-81-40 href=#__codelineno-81-40></a><span class=w>        </span><span class=nx>Label</span><span class=p>:</span><span class=w>         </span><span class=nx>data</span><span class=p>.</span><span class=nx>Label</span><span class=p>,</span>
<a id=__codelineno-81-41 name=__codelineno-81-41 href=#__codelineno-81-41></a><span class=w>        </span><span class=nx>Cpu</span><span class=p>:</span><span class=w>           </span><span class=nx>data</span><span class=p>.</span><span class=nx>Cpu</span><span class=p>,</span>
<a id=__codelineno-81-42 name=__codelineno-81-42 href=#__codelineno-81-42></a><span class=w>        </span><span class=nx>Memory</span><span class=p>:</span><span class=w>        </span><span class=nx>data</span><span class=p>.</span><span class=nx>Memory</span><span class=p>,</span>
<a id=__codelineno-81-43 name=__codelineno-81-43 href=#__codelineno-81-43></a><span class=w>        </span><span class=nx>ContainerPort</span><span class=p>:</span><span class=w> </span><span class=nx>data</span><span class=p>.</span><span class=nx>ContainerPort</span><span class=p>,</span>
<a id=__codelineno-81-44 name=__codelineno-81-44 href=#__codelineno-81-44></a><span class=w>        </span><span class=nx>HealthCheck</span><span class=p>:</span><span class=w>   </span><span class=nx>data</span><span class=p>.</span><span class=nx>HealthCheck</span><span class=p>,</span>
<a id=__codelineno-81-45 name=__codelineno-81-45 href=#__codelineno-81-45></a><span class=w>        </span><span class=nx>HealthPath</span><span class=p>:</span><span class=w>    </span><span class=nx>data</span><span class=p>.</span><span class=nx>HealthPath</span><span class=p>,</span>
<a id=__codelineno-81-46 name=__codelineno-81-46 href=#__codelineno-81-46></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-81-47 name=__codelineno-81-47 href=#__codelineno-81-47></a><span class=w>    </span><span class=c1>//创建deployemnt</span>
<a id=__codelineno-81-48 name=__codelineno-81-48 href=#__codelineno-81-48></a><span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>Deployment</span><span class=p>.</span><span class=nx>CreateDeployment</span><span class=p>(</span><span class=nx>dc</span><span class=p>)</span>
<a id=__codelineno-81-49 name=__codelineno-81-49 href=#__codelineno-81-49></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-81-50 name=__codelineno-81-50 href=#__codelineno-81-50></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>err</span>
<a id=__codelineno-81-51 name=__codelineno-81-51 href=#__codelineno-81-51></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-81-52 name=__codelineno-81-52 href=#__codelineno-81-52></a><span class=w>    </span><span class=c1>//判断service类型</span>
<a id=__codelineno-81-53 name=__codelineno-81-53 href=#__codelineno-81-53></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>data</span><span class=p>.</span><span class=nx>Type</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=s>&quot;Ingress&quot;</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-81-54 name=__codelineno-81-54 href=#__codelineno-81-54></a><span class=w>        </span><span class=nx>serviceType</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>data</span><span class=p>.</span><span class=nx>Type</span>
<a id=__codelineno-81-55 name=__codelineno-81-55 href=#__codelineno-81-55></a><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-81-56 name=__codelineno-81-56 href=#__codelineno-81-56></a><span class=w>        </span><span class=nx>serviceType</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=s>&quot;ClusterIP&quot;</span>
<a id=__codelineno-81-57 name=__codelineno-81-57 href=#__codelineno-81-57></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-81-58 name=__codelineno-81-58 href=#__codelineno-81-58></a><span class=w>    </span><span class=c1>//组装ServiceCreate类型的数据</span>
<a id=__codelineno-81-59 name=__codelineno-81-59 href=#__codelineno-81-59></a><span class=w>    </span><span class=nx>sc</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>ServiceCreate</span><span class=p>{</span>
<a id=__codelineno-81-60 name=__codelineno-81-60 href=#__codelineno-81-60></a><span class=w>        </span><span class=nx>Name</span><span class=p>:</span><span class=w>          </span><span class=nx>getServiceName</span><span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>Name</span><span class=p>),</span>
<a id=__codelineno-81-61 name=__codelineno-81-61 href=#__codelineno-81-61></a><span class=w>        </span><span class=nx>Namespace</span><span class=p>:</span><span class=w>     </span><span class=nx>data</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>,</span>
<a id=__codelineno-81-62 name=__codelineno-81-62 href=#__codelineno-81-62></a><span class=w>        </span><span class=nx>Type</span><span class=p>:</span><span class=w>          </span><span class=nx>serviceType</span><span class=p>,</span>
<a id=__codelineno-81-63 name=__codelineno-81-63 href=#__codelineno-81-63></a><span class=w>        </span><span class=nx>ContainerPort</span><span class=p>:</span><span class=w> </span><span class=nx>data</span><span class=p>.</span><span class=nx>ContainerPort</span><span class=p>,</span>
<a id=__codelineno-81-64 name=__codelineno-81-64 href=#__codelineno-81-64></a><span class=w>        </span><span class=nx>Port</span><span class=p>:</span><span class=w>          </span><span class=nx>data</span><span class=p>.</span><span class=nx>Port</span><span class=p>,</span>
<a id=__codelineno-81-65 name=__codelineno-81-65 href=#__codelineno-81-65></a><span class=w>        </span><span class=nx>NodePort</span><span class=p>:</span><span class=w>      </span><span class=nx>data</span><span class=p>.</span><span class=nx>NodePort</span><span class=p>,</span>
<a id=__codelineno-81-66 name=__codelineno-81-66 href=#__codelineno-81-66></a><span class=w>        </span><span class=nx>Label</span><span class=p>:</span><span class=w>         </span><span class=nx>data</span><span class=p>.</span><span class=nx>Label</span><span class=p>,</span>
<a id=__codelineno-81-67 name=__codelineno-81-67 href=#__codelineno-81-67></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-81-68 name=__codelineno-81-68 href=#__codelineno-81-68></a><span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>Service</span><span class=p>.</span><span class=nx>CreateService</span><span class=p>(</span><span class=nx>sc</span><span class=p>)</span>
<a id=__codelineno-81-69 name=__codelineno-81-69 href=#__codelineno-81-69></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-81-70 name=__codelineno-81-70 href=#__codelineno-81-70></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>err</span>
<a id=__codelineno-81-71 name=__codelineno-81-71 href=#__codelineno-81-71></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-81-72 name=__codelineno-81-72 href=#__codelineno-81-72></a><span class=w>    </span><span class=c1>//组装IngressCreate类型的数据，创建ingress，只有ingress类型的workflow才有ingress资源，所以这里做了一层判断</span>
<a id=__codelineno-81-73 name=__codelineno-81-73 href=#__codelineno-81-73></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>data</span><span class=p>.</span><span class=nx>Type</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&quot;Ingress&quot;</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-81-74 name=__codelineno-81-74 href=#__codelineno-81-74></a><span class=w>        </span><span class=nx>ic</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>IngressCreate</span><span class=p>{</span>
<a id=__codelineno-81-75 name=__codelineno-81-75 href=#__codelineno-81-75></a><span class=w>            </span><span class=nx>Name</span><span class=p>:</span><span class=w>      </span><span class=nx>getIngressName</span><span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>Name</span><span class=p>),</span>
<a id=__codelineno-81-76 name=__codelineno-81-76 href=#__codelineno-81-76></a><span class=w>            </span><span class=nx>Namespace</span><span class=p>:</span><span class=w> </span><span class=nx>data</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>,</span>
<a id=__codelineno-81-77 name=__codelineno-81-77 href=#__codelineno-81-77></a><span class=w>            </span><span class=nx>Label</span><span class=p>:</span><span class=w>     </span><span class=nx>data</span><span class=p>.</span><span class=nx>Label</span><span class=p>,</span>
<a id=__codelineno-81-78 name=__codelineno-81-78 href=#__codelineno-81-78></a><span class=w>            </span><span class=nx>Hosts</span><span class=p>:</span><span class=w>     </span><span class=nx>data</span><span class=p>.</span><span class=nx>Hosts</span><span class=p>,</span>
<a id=__codelineno-81-79 name=__codelineno-81-79 href=#__codelineno-81-79></a><span class=w>        </span><span class=p>}</span>
<a id=__codelineno-81-80 name=__codelineno-81-80 href=#__codelineno-81-80></a><span class=w>        </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>Ingress</span><span class=p>.</span><span class=nx>CreateIngress</span><span class=p>(</span><span class=nx>ic</span><span class=p>)</span>
<a id=__codelineno-81-81 name=__codelineno-81-81 href=#__codelineno-81-81></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-81-82 name=__codelineno-81-82 href=#__codelineno-81-82></a><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=nx>err</span>
<a id=__codelineno-81-83 name=__codelineno-81-83 href=#__codelineno-81-83></a><span class=w>        </span><span class=p>}</span>
<a id=__codelineno-81-84 name=__codelineno-81-84 href=#__codelineno-81-84></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-81-85 name=__codelineno-81-85 href=#__codelineno-81-85></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-81-86 name=__codelineno-81-86 href=#__codelineno-81-86></a><span class=p>}</span>
<a id=__codelineno-81-87 name=__codelineno-81-87 href=#__codelineno-81-87></a>
<a id=__codelineno-81-88 name=__codelineno-81-88 href=#__codelineno-81-88></a><span class=c1>// CreateWorkflow 创建workflow</span>
<a id=__codelineno-81-89 name=__codelineno-81-89 href=#__codelineno-81-89></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>w</span><span class=w> </span><span class=o>*</span><span class=nx>workflow</span><span class=p>)</span><span class=w> </span><span class=nx>CreateWorkflow</span><span class=p>(</span><span class=nx>data</span><span class=w> </span><span class=o>*</span><span class=nx>WorkflowCreate</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-81-90 name=__codelineno-81-90 href=#__codelineno-81-90></a><span class=w>    </span><span class=c1>//若workflow不是ingress类型，传入空字符串即可</span>
<a id=__codelineno-81-91 name=__codelineno-81-91 href=#__codelineno-81-91></a><span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=nx>ingressName</span><span class=w> </span><span class=kt>string</span>
<a id=__codelineno-81-92 name=__codelineno-81-92 href=#__codelineno-81-92></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>data</span><span class=p>.</span><span class=nx>Type</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&quot;Ingress&quot;</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-81-93 name=__codelineno-81-93 href=#__codelineno-81-93></a><span class=w>        </span><span class=nx>ingressName</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>getIngressName</span><span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>Name</span><span class=p>)</span>
<a id=__codelineno-81-94 name=__codelineno-81-94 href=#__codelineno-81-94></a><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-81-95 name=__codelineno-81-95 href=#__codelineno-81-95></a><span class=w>        </span><span class=nx>ingressName</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=s>&quot;&quot;</span>
<a id=__codelineno-81-96 name=__codelineno-81-96 href=#__codelineno-81-96></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-81-97 name=__codelineno-81-97 href=#__codelineno-81-97></a><span class=w>    </span><span class=c1>//组装mysql中workflow的单条数据</span>
<a id=__codelineno-81-98 name=__codelineno-81-98 href=#__codelineno-81-98></a><span class=w>    </span><span class=nx>workflow</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>model</span><span class=p>.</span><span class=nx>Workflow</span><span class=p>{</span>
<a id=__codelineno-81-99 name=__codelineno-81-99 href=#__codelineno-81-99></a><span class=w>        </span><span class=nx>Name</span><span class=p>:</span><span class=w>       </span><span class=nx>data</span><span class=p>.</span><span class=nx>Name</span><span class=p>,</span>
<a id=__codelineno-81-100 name=__codelineno-81-100 href=#__codelineno-81-100></a><span class=w>        </span><span class=nx>Namespace</span><span class=p>:</span><span class=w>  </span><span class=nx>data</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>,</span>
<a id=__codelineno-81-101 name=__codelineno-81-101 href=#__codelineno-81-101></a><span class=w>        </span><span class=nx>Replicas</span><span class=p>:</span><span class=w>   </span><span class=nx>data</span><span class=p>.</span><span class=nx>Replicas</span><span class=p>,</span>
<a id=__codelineno-81-102 name=__codelineno-81-102 href=#__codelineno-81-102></a><span class=w>        </span><span class=nx>Deployment</span><span class=p>:</span><span class=w> </span><span class=nx>data</span><span class=p>.</span><span class=nx>Name</span><span class=p>,</span>
<a id=__codelineno-81-103 name=__codelineno-81-103 href=#__codelineno-81-103></a><span class=w>        </span><span class=nx>Service</span><span class=p>:</span><span class=w>    </span><span class=nx>getServiceName</span><span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>Name</span><span class=p>),</span>
<a id=__codelineno-81-104 name=__codelineno-81-104 href=#__codelineno-81-104></a><span class=w>        </span><span class=nx>Ingress</span><span class=p>:</span><span class=w>    </span><span class=nx>ingressName</span><span class=p>,</span>
<a id=__codelineno-81-105 name=__codelineno-81-105 href=#__codelineno-81-105></a><span class=w>        </span><span class=nx>Type</span><span class=p>:</span><span class=w>       </span><span class=nx>data</span><span class=p>.</span><span class=nx>Type</span><span class=p>,</span>
<a id=__codelineno-81-106 name=__codelineno-81-106 href=#__codelineno-81-106></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-81-107 name=__codelineno-81-107 href=#__codelineno-81-107></a><span class=w>    </span><span class=c1>//调用dao层执行数据库的添加操作</span>
<a id=__codelineno-81-108 name=__codelineno-81-108 href=#__codelineno-81-108></a><span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>dao</span><span class=p>.</span><span class=nx>Workflow</span><span class=p>.</span><span class=nx>Add</span><span class=p>(</span><span class=nx>workflow</span><span class=p>)</span>
<a id=__codelineno-81-109 name=__codelineno-81-109 href=#__codelineno-81-109></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-81-110 name=__codelineno-81-110 href=#__codelineno-81-110></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>err</span>
<a id=__codelineno-81-111 name=__codelineno-81-111 href=#__codelineno-81-111></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-81-112 name=__codelineno-81-112 href=#__codelineno-81-112></a><span class=w>    </span><span class=c1>//创建k8s资源</span>
<a id=__codelineno-81-113 name=__codelineno-81-113 href=#__codelineno-81-113></a><span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>createWorkflowRes</span><span class=p>(</span><span class=nx>data</span><span class=p>)</span>
<a id=__codelineno-81-114 name=__codelineno-81-114 href=#__codelineno-81-114></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-81-115 name=__codelineno-81-115 href=#__codelineno-81-115></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>err</span>
<a id=__codelineno-81-116 name=__codelineno-81-116 href=#__codelineno-81-116></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-81-117 name=__codelineno-81-117 href=#__codelineno-81-117></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-81-118 name=__codelineno-81-118 href=#__codelineno-81-118></a><span class=p>}</span>
</code></pre></div> <h5 id=4删除workflow>(4)删除workflow<a class=headerlink href=#4删除workflow title="Permanent link">&para;</a></h5> <div class=highlight><pre><span></span><code><a id=__codelineno-82-1 name=__codelineno-82-1 href=#__codelineno-82-1></a><span class=c1>// 封装删除workflow对应的k8s资源</span>
<a id=__codelineno-82-2 name=__codelineno-82-2 href=#__codelineno-82-2></a><span class=kd>func</span><span class=w> </span><span class=nx>delWorkflowRes</span><span class=p>(</span><span class=nx>workflow</span><span class=w> </span><span class=o>*</span><span class=nx>model</span><span class=p>.</span><span class=nx>Workflow</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-82-3 name=__codelineno-82-3 href=#__codelineno-82-3></a><span class=w>    </span><span class=c1>//删除deployment</span>
<a id=__codelineno-82-4 name=__codelineno-82-4 href=#__codelineno-82-4></a><span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>Deployment</span><span class=p>.</span><span class=nx>DeleteDeployment</span><span class=p>(</span><span class=nx>workflow</span><span class=p>.</span><span class=nx>Name</span><span class=p>,</span><span class=w> </span><span class=nx>workflow</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>)</span>
<a id=__codelineno-82-5 name=__codelineno-82-5 href=#__codelineno-82-5></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-82-6 name=__codelineno-82-6 href=#__codelineno-82-6></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>err</span>
<a id=__codelineno-82-7 name=__codelineno-82-7 href=#__codelineno-82-7></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-82-8 name=__codelineno-82-8 href=#__codelineno-82-8></a><span class=w>    </span><span class=c1>//删除service</span>
<a id=__codelineno-82-9 name=__codelineno-82-9 href=#__codelineno-82-9></a><span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>Service</span><span class=p>.</span><span class=nx>DeleteService</span><span class=p>(</span><span class=nx>getServiceName</span><span class=p>(</span><span class=nx>workflow</span><span class=p>.</span><span class=nx>Name</span><span class=p>),</span><span class=w> </span><span class=nx>workflow</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>)</span>
<a id=__codelineno-82-10 name=__codelineno-82-10 href=#__codelineno-82-10></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-82-11 name=__codelineno-82-11 href=#__codelineno-82-11></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>err</span>
<a id=__codelineno-82-12 name=__codelineno-82-12 href=#__codelineno-82-12></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-82-13 name=__codelineno-82-13 href=#__codelineno-82-13></a><span class=w>    </span><span class=c1>//删除ingress，这里多了一层判断，因为只有type为ingress的workflow才有ingress资源</span>
<a id=__codelineno-82-14 name=__codelineno-82-14 href=#__codelineno-82-14></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>workflow</span><span class=p>.</span><span class=nx>Type</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&quot;Ingress&quot;</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-82-15 name=__codelineno-82-15 href=#__codelineno-82-15></a><span class=w>        </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>Ingress</span><span class=p>.</span><span class=nx>DeleteIngress</span><span class=p>(</span><span class=nx>getIngressName</span><span class=p>(</span><span class=nx>workflow</span><span class=p>.</span><span class=nx>Name</span><span class=p>),</span><span class=w> </span><span class=nx>workflow</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>)</span>
<a id=__codelineno-82-16 name=__codelineno-82-16 href=#__codelineno-82-16></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-82-17 name=__codelineno-82-17 href=#__codelineno-82-17></a><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=nx>err</span>
<a id=__codelineno-82-18 name=__codelineno-82-18 href=#__codelineno-82-18></a><span class=w>        </span><span class=p>}</span>
<a id=__codelineno-82-19 name=__codelineno-82-19 href=#__codelineno-82-19></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-82-20 name=__codelineno-82-20 href=#__codelineno-82-20></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-82-21 name=__codelineno-82-21 href=#__codelineno-82-21></a><span class=p>}</span>
<a id=__codelineno-82-22 name=__codelineno-82-22 href=#__codelineno-82-22></a>
<a id=__codelineno-82-23 name=__codelineno-82-23 href=#__codelineno-82-23></a><span class=c1>// DelById 删除workflow</span>
<a id=__codelineno-82-24 name=__codelineno-82-24 href=#__codelineno-82-24></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>w</span><span class=w> </span><span class=o>*</span><span class=nx>workflow</span><span class=p>)</span><span class=w> </span><span class=nx>DelById</span><span class=p>(</span><span class=nx>id</span><span class=w> </span><span class=kt>int</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-82-25 name=__codelineno-82-25 href=#__codelineno-82-25></a><span class=w>    </span><span class=c1>//获取workflow数据</span>
<a id=__codelineno-82-26 name=__codelineno-82-26 href=#__codelineno-82-26></a><span class=w>    </span><span class=nx>workflow</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>dao</span><span class=p>.</span><span class=nx>Workflow</span><span class=p>.</span><span class=nx>GetById</span><span class=p>(</span><span class=nx>id</span><span class=p>)</span>
<a id=__codelineno-82-27 name=__codelineno-82-27 href=#__codelineno-82-27></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-82-28 name=__codelineno-82-28 href=#__codelineno-82-28></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>err</span>
<a id=__codelineno-82-29 name=__codelineno-82-29 href=#__codelineno-82-29></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-82-30 name=__codelineno-82-30 href=#__codelineno-82-30></a><span class=w>    </span><span class=c1>//删除k8s资源</span>
<a id=__codelineno-82-31 name=__codelineno-82-31 href=#__codelineno-82-31></a><span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>delWorkflowRes</span><span class=p>(</span><span class=nx>workflow</span><span class=p>)</span>
<a id=__codelineno-82-32 name=__codelineno-82-32 href=#__codelineno-82-32></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-82-33 name=__codelineno-82-33 href=#__codelineno-82-33></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-82-34 name=__codelineno-82-34 href=#__codelineno-82-34></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-82-35 name=__codelineno-82-35 href=#__codelineno-82-35></a><span class=w>    </span><span class=c1>//删除数据库数据</span>
<a id=__codelineno-82-36 name=__codelineno-82-36 href=#__codelineno-82-36></a><span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>dao</span><span class=p>.</span><span class=nx>Workflow</span><span class=p>.</span><span class=nx>DelById</span><span class=p>(</span><span class=nx>id</span><span class=p>)</span>
<a id=__codelineno-82-37 name=__codelineno-82-37 href=#__codelineno-82-37></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-82-38 name=__codelineno-82-38 href=#__codelineno-82-38></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>err</span>
<a id=__codelineno-82-39 name=__codelineno-82-39 href=#__codelineno-82-39></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-82-40 name=__codelineno-82-40 href=#__codelineno-82-40></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-82-41 name=__codelineno-82-41 href=#__codelineno-82-41></a><span class=p>}</span>
</code></pre></div> <p><code>controller/workflow.go</code></p> <div class=highlight><pre><span></span><code><a id=__codelineno-83-1 name=__codelineno-83-1 href=#__codelineno-83-1></a><span class=kn>package</span><span class=w> </span><span class=nx>controller</span>
<a id=__codelineno-83-2 name=__codelineno-83-2 href=#__codelineno-83-2></a>
<a id=__codelineno-83-3 name=__codelineno-83-3 href=#__codelineno-83-3></a><span class=kn>import</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-83-4 name=__codelineno-83-4 href=#__codelineno-83-4></a><span class=w>    </span><span class=s>&quot;gitee.com/hujianli94net/k8s-platform/service&quot;</span>
<a id=__codelineno-83-5 name=__codelineno-83-5 href=#__codelineno-83-5></a><span class=w>    </span><span class=s>&quot;net/http&quot;</span>
<a id=__codelineno-83-6 name=__codelineno-83-6 href=#__codelineno-83-6></a>
<a id=__codelineno-83-7 name=__codelineno-83-7 href=#__codelineno-83-7></a><span class=w>    </span><span class=s>&quot;github.com/gin-gonic/gin&quot;</span>
<a id=__codelineno-83-8 name=__codelineno-83-8 href=#__codelineno-83-8></a><span class=w>    </span><span class=s>&quot;github.com/wonderivan/logger&quot;</span>
<a id=__codelineno-83-9 name=__codelineno-83-9 href=#__codelineno-83-9></a><span class=p>)</span>
<a id=__codelineno-83-10 name=__codelineno-83-10 href=#__codelineno-83-10></a>
<a id=__codelineno-83-11 name=__codelineno-83-11 href=#__codelineno-83-11></a><span class=kd>type</span><span class=w> </span><span class=nx>workflow</span><span class=w> </span><span class=kd>struct</span><span class=p>{}</span>
<a id=__codelineno-83-12 name=__codelineno-83-12 href=#__codelineno-83-12></a>
<a id=__codelineno-83-13 name=__codelineno-83-13 href=#__codelineno-83-13></a><span class=kd>var</span><span class=w> </span><span class=nx>Workflow</span><span class=w> </span><span class=nx>workflow</span>
<a id=__codelineno-83-14 name=__codelineno-83-14 href=#__codelineno-83-14></a>
<a id=__codelineno-83-15 name=__codelineno-83-15 href=#__codelineno-83-15></a><span class=c1>// GetList 获取列表分页查询</span>
<a id=__codelineno-83-16 name=__codelineno-83-16 href=#__codelineno-83-16></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>w</span><span class=w> </span><span class=o>*</span><span class=nx>workflow</span><span class=p>)</span><span class=w> </span><span class=nx>GetList</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-83-17 name=__codelineno-83-17 href=#__codelineno-83-17></a><span class=w>    </span><span class=nx>params</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-83-18 name=__codelineno-83-18 href=#__codelineno-83-18></a><span class=w>        </span><span class=nx>Namespace</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`form:&quot;namespace&quot;`</span>
<a id=__codelineno-83-19 name=__codelineno-83-19 href=#__codelineno-83-19></a><span class=w>        </span><span class=nx>Page</span><span class=w>      </span><span class=kt>int</span><span class=w>    </span><span class=s>`form:&quot;page&quot;`</span>
<a id=__codelineno-83-20 name=__codelineno-83-20 href=#__codelineno-83-20></a><span class=w>        </span><span class=nx>Limit</span><span class=w>     </span><span class=kt>int</span><span class=w>    </span><span class=s>`form:&quot;limit&quot;`</span>
<a id=__codelineno-83-21 name=__codelineno-83-21 href=#__codelineno-83-21></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-83-22 name=__codelineno-83-22 href=#__codelineno-83-22></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>Bind</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-83-23 name=__codelineno-83-23 href=#__codelineno-83-23></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-83-24 name=__codelineno-83-24 href=#__codelineno-83-24></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-83-25 name=__codelineno-83-25 href=#__codelineno-83-25></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-83-26 name=__codelineno-83-26 href=#__codelineno-83-26></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-83-27 name=__codelineno-83-27 href=#__codelineno-83-27></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-83-28 name=__codelineno-83-28 href=#__codelineno-83-28></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-83-29 name=__codelineno-83-29 href=#__codelineno-83-29></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-83-30 name=__codelineno-83-30 href=#__codelineno-83-30></a><span class=w>    </span><span class=nx>data</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>Workflow</span><span class=p>.</span><span class=nx>GetList</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Page</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=p>.</span><span class=nx>Limit</span><span class=p>)</span>
<a id=__codelineno-83-31 name=__codelineno-83-31 href=#__codelineno-83-31></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-83-32 name=__codelineno-83-32 href=#__codelineno-83-32></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;获取Workflow列表失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-83-33 name=__codelineno-83-33 href=#__codelineno-83-33></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-83-34 name=__codelineno-83-34 href=#__codelineno-83-34></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-83-35 name=__codelineno-83-35 href=#__codelineno-83-35></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-83-36 name=__codelineno-83-36 href=#__codelineno-83-36></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-83-37 name=__codelineno-83-37 href=#__codelineno-83-37></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-83-38 name=__codelineno-83-38 href=#__codelineno-83-38></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-83-39 name=__codelineno-83-39 href=#__codelineno-83-39></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-83-40 name=__codelineno-83-40 href=#__codelineno-83-40></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;获取Workflow列表成功&quot;</span><span class=p>,</span>
<a id=__codelineno-83-41 name=__codelineno-83-41 href=#__codelineno-83-41></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=nx>data</span><span class=p>,</span>
<a id=__codelineno-83-42 name=__codelineno-83-42 href=#__codelineno-83-42></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-83-43 name=__codelineno-83-43 href=#__codelineno-83-43></a><span class=p>}</span>
<a id=__codelineno-83-44 name=__codelineno-83-44 href=#__codelineno-83-44></a>
<a id=__codelineno-83-45 name=__codelineno-83-45 href=#__codelineno-83-45></a><span class=c1>// GetById 查询workflow单条数据</span>
<a id=__codelineno-83-46 name=__codelineno-83-46 href=#__codelineno-83-46></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>w</span><span class=w> </span><span class=o>*</span><span class=nx>workflow</span><span class=p>)</span><span class=w> </span><span class=nx>GetById</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-83-47 name=__codelineno-83-47 href=#__codelineno-83-47></a><span class=w>    </span><span class=nx>params</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-83-48 name=__codelineno-83-48 href=#__codelineno-83-48></a><span class=w>        </span><span class=nx>ID</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=s>`form:&quot;id&quot;`</span>
<a id=__codelineno-83-49 name=__codelineno-83-49 href=#__codelineno-83-49></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-83-50 name=__codelineno-83-50 href=#__codelineno-83-50></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>Bind</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-83-51 name=__codelineno-83-51 href=#__codelineno-83-51></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-83-52 name=__codelineno-83-52 href=#__codelineno-83-52></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-83-53 name=__codelineno-83-53 href=#__codelineno-83-53></a><span class=w>            </span><span class=s>&quot;mag&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-83-54 name=__codelineno-83-54 href=#__codelineno-83-54></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-83-55 name=__codelineno-83-55 href=#__codelineno-83-55></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-83-56 name=__codelineno-83-56 href=#__codelineno-83-56></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-83-57 name=__codelineno-83-57 href=#__codelineno-83-57></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-83-58 name=__codelineno-83-58 href=#__codelineno-83-58></a><span class=w>    </span><span class=nx>data</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>Workflow</span><span class=p>.</span><span class=nx>GetById</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>ID</span><span class=p>)</span>
<a id=__codelineno-83-59 name=__codelineno-83-59 href=#__codelineno-83-59></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-83-60 name=__codelineno-83-60 href=#__codelineno-83-60></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;查询Workflow单条数据失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-83-61 name=__codelineno-83-61 href=#__codelineno-83-61></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-83-62 name=__codelineno-83-62 href=#__codelineno-83-62></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-83-63 name=__codelineno-83-63 href=#__codelineno-83-63></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-83-64 name=__codelineno-83-64 href=#__codelineno-83-64></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-83-65 name=__codelineno-83-65 href=#__codelineno-83-65></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-83-66 name=__codelineno-83-66 href=#__codelineno-83-66></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-83-67 name=__codelineno-83-67 href=#__codelineno-83-67></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-83-68 name=__codelineno-83-68 href=#__codelineno-83-68></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;查询Workflow单条数据成功&quot;</span><span class=p>,</span>
<a id=__codelineno-83-69 name=__codelineno-83-69 href=#__codelineno-83-69></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=nx>data</span><span class=p>,</span>
<a id=__codelineno-83-70 name=__codelineno-83-70 href=#__codelineno-83-70></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-83-71 name=__codelineno-83-71 href=#__codelineno-83-71></a><span class=p>}</span>
<a id=__codelineno-83-72 name=__codelineno-83-72 href=#__codelineno-83-72></a>
<a id=__codelineno-83-73 name=__codelineno-83-73 href=#__codelineno-83-73></a><span class=c1>// Create 创建workflow</span>
<a id=__codelineno-83-74 name=__codelineno-83-74 href=#__codelineno-83-74></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>w</span><span class=w> </span><span class=o>*</span><span class=nx>workflow</span><span class=p>)</span><span class=w> </span><span class=nx>Create</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-83-75 name=__codelineno-83-75 href=#__codelineno-83-75></a><span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-83-76 name=__codelineno-83-76 href=#__codelineno-83-76></a><span class=w>        </span><span class=nx>wc</span><span class=w>  </span><span class=p>=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>service</span><span class=p>.</span><span class=nx>WorkflowCreate</span><span class=p>{}</span>
<a id=__codelineno-83-77 name=__codelineno-83-77 href=#__codelineno-83-77></a><span class=w>        </span><span class=nx>err</span><span class=w> </span><span class=kt>error</span>
<a id=__codelineno-83-78 name=__codelineno-83-78 href=#__codelineno-83-78></a><span class=w>    </span><span class=p>)</span>
<a id=__codelineno-83-79 name=__codelineno-83-79 href=#__codelineno-83-79></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>ShouldBindJSON</span><span class=p>(</span><span class=nx>wc</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-83-80 name=__codelineno-83-80 href=#__codelineno-83-80></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数dc失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-83-81 name=__codelineno-83-81 href=#__codelineno-83-81></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-83-82 name=__codelineno-83-82 href=#__codelineno-83-82></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-83-83 name=__codelineno-83-83 href=#__codelineno-83-83></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-83-84 name=__codelineno-83-84 href=#__codelineno-83-84></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-83-85 name=__codelineno-83-85 href=#__codelineno-83-85></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-83-86 name=__codelineno-83-86 href=#__codelineno-83-86></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-83-87 name=__codelineno-83-87 href=#__codelineno-83-87></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>Workflow</span><span class=p>.</span><span class=nx>CreateWorkflow</span><span class=p>(</span><span class=nx>wc</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-83-88 name=__codelineno-83-88 href=#__codelineno-83-88></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;创建Workflow失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-83-89 name=__codelineno-83-89 href=#__codelineno-83-89></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{})</span>
<a id=__codelineno-83-90 name=__codelineno-83-90 href=#__codelineno-83-90></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-83-91 name=__codelineno-83-91 href=#__codelineno-83-91></a><span class=p>}</span>
<a id=__codelineno-83-92 name=__codelineno-83-92 href=#__codelineno-83-92></a>
<a id=__codelineno-83-93 name=__codelineno-83-93 href=#__codelineno-83-93></a><span class=c1>// DelById 删除workflow</span>
<a id=__codelineno-83-94 name=__codelineno-83-94 href=#__codelineno-83-94></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>w</span><span class=w> </span><span class=o>*</span><span class=nx>workflow</span><span class=p>)</span><span class=w> </span><span class=nx>DelById</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-83-95 name=__codelineno-83-95 href=#__codelineno-83-95></a><span class=w>    </span><span class=nx>params</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-83-96 name=__codelineno-83-96 href=#__codelineno-83-96></a><span class=w>        </span><span class=nx>ID</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=s>`json:&quot;id&quot;`</span>
<a id=__codelineno-83-97 name=__codelineno-83-97 href=#__codelineno-83-97></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-83-98 name=__codelineno-83-98 href=#__codelineno-83-98></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>ShouldBindJSON</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-83-99 name=__codelineno-83-99 href=#__codelineno-83-99></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;Bind请求参数失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-83-100 name=__codelineno-83-100 href=#__codelineno-83-100></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-83-101 name=__codelineno-83-101 href=#__codelineno-83-101></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-83-102 name=__codelineno-83-102 href=#__codelineno-83-102></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-83-103 name=__codelineno-83-103 href=#__codelineno-83-103></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-83-104 name=__codelineno-83-104 href=#__codelineno-83-104></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-83-105 name=__codelineno-83-105 href=#__codelineno-83-105></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-83-106 name=__codelineno-83-106 href=#__codelineno-83-106></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>Workflow</span><span class=p>.</span><span class=nx>DelById</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>ID</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-83-107 name=__codelineno-83-107 href=#__codelineno-83-107></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;删除Workflow失败，&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>())</span>
<a id=__codelineno-83-108 name=__codelineno-83-108 href=#__codelineno-83-108></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-83-109 name=__codelineno-83-109 href=#__codelineno-83-109></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-83-110 name=__codelineno-83-110 href=#__codelineno-83-110></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-83-111 name=__codelineno-83-111 href=#__codelineno-83-111></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-83-112 name=__codelineno-83-112 href=#__codelineno-83-112></a><span class=w>        </span><span class=k>return</span>
<a id=__codelineno-83-113 name=__codelineno-83-113 href=#__codelineno-83-113></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-83-114 name=__codelineno-83-114 href=#__codelineno-83-114></a><span class=w>    </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-83-115 name=__codelineno-83-115 href=#__codelineno-83-115></a><span class=w>        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;删除Workflow成功&quot;</span><span class=p>,</span>
<a id=__codelineno-83-116 name=__codelineno-83-116 href=#__codelineno-83-116></a><span class=w>        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-83-117 name=__codelineno-83-117 href=#__codelineno-83-117></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-83-118 name=__codelineno-83-118 href=#__codelineno-83-118></a><span class=p>}</span>
</code></pre></div> <p><code>controller/router.go</code></p> <div class=highlight><pre><span></span><code><a id=__codelineno-84-1 name=__codelineno-84-1 href=#__codelineno-84-1></a><span class=kn>package</span><span class=w> </span><span class=nx>controller</span>
<a id=__codelineno-84-2 name=__codelineno-84-2 href=#__codelineno-84-2></a>
<a id=__codelineno-84-3 name=__codelineno-84-3 href=#__codelineno-84-3></a><span class=kn>import</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-84-4 name=__codelineno-84-4 href=#__codelineno-84-4></a><span class=w>    </span><span class=s>&quot;github.com/gin-gonic/gin&quot;</span>
<a id=__codelineno-84-5 name=__codelineno-84-5 href=#__codelineno-84-5></a><span class=w>    </span><span class=s>&quot;net/http&quot;</span>
<a id=__codelineno-84-6 name=__codelineno-84-6 href=#__codelineno-84-6></a><span class=p>)</span>
<a id=__codelineno-84-7 name=__codelineno-84-7 href=#__codelineno-84-7></a>
<a id=__codelineno-84-8 name=__codelineno-84-8 href=#__codelineno-84-8></a><span class=c1>// Router 实例化router结构体，可使用该对象点出首字母大写的方法（包外调用）</span>
<a id=__codelineno-84-9 name=__codelineno-84-9 href=#__codelineno-84-9></a><span class=kd>var</span><span class=w> </span><span class=nx>Router</span><span class=w> </span><span class=nx>router</span>
<a id=__codelineno-84-10 name=__codelineno-84-10 href=#__codelineno-84-10></a>
<a id=__codelineno-84-11 name=__codelineno-84-11 href=#__codelineno-84-11></a><span class=c1>// 创建router结构体</span>
<a id=__codelineno-84-12 name=__codelineno-84-12 href=#__codelineno-84-12></a><span class=kd>type</span><span class=w> </span><span class=nx>router</span><span class=w> </span><span class=kd>struct</span><span class=p>{}</span>
<a id=__codelineno-84-13 name=__codelineno-84-13 href=#__codelineno-84-13></a>
<a id=__codelineno-84-14 name=__codelineno-84-14 href=#__codelineno-84-14></a><span class=c1>// InitApiRouter 初始化路由规则</span>
<a id=__codelineno-84-15 name=__codelineno-84-15 href=#__codelineno-84-15></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>r</span><span class=w> </span><span class=o>*</span><span class=nx>router</span><span class=p>)</span><span class=w> </span><span class=nx>InitApiRouter</span><span class=p>(</span><span class=nx>router</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Engine</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-84-16 name=__codelineno-84-16 href=#__codelineno-84-16></a><span class=w>    </span><span class=c1>// 创建测试api接口</span>
<a id=__codelineno-84-17 name=__codelineno-84-17 href=#__codelineno-84-17></a><span class=w>    </span><span class=nx>router</span><span class=p>.</span><span class=nx>GET</span><span class=p>(</span><span class=s>&quot;/testapi&quot;</span><span class=p>,</span><span class=w> </span><span class=kd>func</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-84-18 name=__codelineno-84-18 href=#__codelineno-84-18></a><span class=w>        </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-84-19 name=__codelineno-84-19 href=#__codelineno-84-19></a><span class=w>            </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;testapi success!&quot;</span><span class=p>,</span>
<a id=__codelineno-84-20 name=__codelineno-84-20 href=#__codelineno-84-20></a><span class=w>            </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-84-21 name=__codelineno-84-21 href=#__codelineno-84-21></a><span class=w>        </span><span class=p>})</span>
<a id=__codelineno-84-22 name=__codelineno-84-22 href=#__codelineno-84-22></a><span class=w>    </span><span class=p>}).</span>
<a id=__codelineno-84-23 name=__codelineno-84-23 href=#__codelineno-84-23></a><span class=w>        </span><span class=c1>//工作流</span>
<a id=__codelineno-84-24 name=__codelineno-84-24 href=#__codelineno-84-24></a><span class=w>        </span><span class=nx>GET</span><span class=p>(</span><span class=s>&quot;/api/k8s/workflows&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Workflow</span><span class=p>.</span><span class=nx>GetList</span><span class=p>).</span>
<a id=__codelineno-84-25 name=__codelineno-84-25 href=#__codelineno-84-25></a><span class=w>        </span><span class=nx>GET</span><span class=p>(</span><span class=s>&quot;/api/k8s/workflow/detail&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Workflow</span><span class=p>.</span><span class=nx>GetById</span><span class=p>).</span>
<a id=__codelineno-84-26 name=__codelineno-84-26 href=#__codelineno-84-26></a><span class=w>        </span><span class=nx>POST</span><span class=p>(</span><span class=s>&quot;/api/k8s/workflow/create&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Workflow</span><span class=p>.</span><span class=nx>Create</span><span class=p>).</span>
<a id=__codelineno-84-27 name=__codelineno-84-27 href=#__codelineno-84-27></a><span class=w>        </span><span class=nx>DELETE</span><span class=p>(</span><span class=s>&quot;/api/k8s/workflow/del&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Workflow</span><span class=p>.</span><span class=nx>DelById</span><span class=p>).</span>
<a id=__codelineno-84-28 name=__codelineno-84-28 href=#__codelineno-84-28></a>
<a id=__codelineno-84-29 name=__codelineno-84-29 href=#__codelineno-84-29></a><span class=w>        </span><span class=c1>//pod操作</span>
<a id=__codelineno-84-30 name=__codelineno-84-30 href=#__codelineno-84-30></a><span class=w>        </span><span class=nx>GET</span><span class=p>(</span><span class=s>&quot;/api/k8s/pods&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Pod</span><span class=p>.</span><span class=nx>GetPods</span><span class=p>).</span>
<a id=__codelineno-84-31 name=__codelineno-84-31 href=#__codelineno-84-31></a><span class=w>        </span><span class=nx>GET</span><span class=p>(</span><span class=s>&quot;/api/k8s/pod/detail&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Pod</span><span class=p>.</span><span class=nx>GetPodDetail</span><span class=p>).</span>
<a id=__codelineno-84-32 name=__codelineno-84-32 href=#__codelineno-84-32></a><span class=w>        </span><span class=nx>DELETE</span><span class=p>(</span><span class=s>&quot;/api/k8s/pod/del&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Pod</span><span class=p>.</span><span class=nx>DeletePod</span><span class=p>).</span>
<a id=__codelineno-84-33 name=__codelineno-84-33 href=#__codelineno-84-33></a><span class=w>        </span><span class=nx>PUT</span><span class=p>(</span><span class=s>&quot;/api/k8s/pod/update&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Pod</span><span class=p>.</span><span class=nx>UpdatePod</span><span class=p>).</span>
<a id=__codelineno-84-34 name=__codelineno-84-34 href=#__codelineno-84-34></a><span class=w>        </span><span class=nx>GET</span><span class=p>(</span><span class=s>&quot;/api/k8s/pod/container&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Pod</span><span class=p>.</span><span class=nx>GetPodContainer</span><span class=p>).</span>
<a id=__codelineno-84-35 name=__codelineno-84-35 href=#__codelineno-84-35></a><span class=w>        </span><span class=nx>GET</span><span class=p>(</span><span class=s>&quot;/api/k8s/pod/log&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Pod</span><span class=p>.</span><span class=nx>GetPodLog</span><span class=p>).</span>
<a id=__codelineno-84-36 name=__codelineno-84-36 href=#__codelineno-84-36></a><span class=w>        </span><span class=nx>GET</span><span class=p>(</span><span class=s>&quot;/api/k8s/pod/numnp&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Pod</span><span class=p>.</span><span class=nx>GetPodNumPerNp</span><span class=p>).</span>
<a id=__codelineno-84-37 name=__codelineno-84-37 href=#__codelineno-84-37></a>
<a id=__codelineno-84-38 name=__codelineno-84-38 href=#__codelineno-84-38></a><span class=w>        </span><span class=c1>//deployment操作</span>
<a id=__codelineno-84-39 name=__codelineno-84-39 href=#__codelineno-84-39></a><span class=w>        </span><span class=nx>GET</span><span class=p>(</span><span class=s>&quot;/api/k8s/deployments&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Deployment</span><span class=p>.</span><span class=nx>GetDeployments</span><span class=p>).</span>
<a id=__codelineno-84-40 name=__codelineno-84-40 href=#__codelineno-84-40></a><span class=w>        </span><span class=nx>GET</span><span class=p>(</span><span class=s>&quot;/api/k8s/deployment/detail&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Deployment</span><span class=p>.</span><span class=nx>GetDeploymentDetail</span><span class=p>).</span>
<a id=__codelineno-84-41 name=__codelineno-84-41 href=#__codelineno-84-41></a><span class=w>        </span><span class=nx>PUT</span><span class=p>(</span><span class=s>&quot;/api/k8s/deployment/scale&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Deployment</span><span class=p>.</span><span class=nx>ScaleDeployment</span><span class=p>).</span>
<a id=__codelineno-84-42 name=__codelineno-84-42 href=#__codelineno-84-42></a><span class=w>        </span><span class=nx>DELETE</span><span class=p>(</span><span class=s>&quot;/api/k8s/deployment/del&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Deployment</span><span class=p>.</span><span class=nx>DeleteDeployment</span><span class=p>).</span>
<a id=__codelineno-84-43 name=__codelineno-84-43 href=#__codelineno-84-43></a><span class=w>        </span><span class=nx>PUT</span><span class=p>(</span><span class=s>&quot;/api/k8s/deployment/restart&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Deployment</span><span class=p>.</span><span class=nx>RestartDeployment</span><span class=p>).</span>
<a id=__codelineno-84-44 name=__codelineno-84-44 href=#__codelineno-84-44></a><span class=w>        </span><span class=nx>PUT</span><span class=p>(</span><span class=s>&quot;/api/k8s/deployment/update&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Deployment</span><span class=p>.</span><span class=nx>UpdateDeployment</span><span class=p>).</span>
<a id=__codelineno-84-45 name=__codelineno-84-45 href=#__codelineno-84-45></a><span class=w>        </span><span class=nx>GET</span><span class=p>(</span><span class=s>&quot;/api/k8s/deployment/numnp&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Deployment</span><span class=p>.</span><span class=nx>GetDeployNumPerNp</span><span class=p>).</span>
<a id=__codelineno-84-46 name=__codelineno-84-46 href=#__codelineno-84-46></a><span class=w>        </span><span class=nx>POST</span><span class=p>(</span><span class=s>&quot;/api/k8s/deployment/create&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Deployment</span><span class=p>.</span><span class=nx>CreateDeployment</span><span class=p>).</span>
<a id=__codelineno-84-47 name=__codelineno-84-47 href=#__codelineno-84-47></a>
<a id=__codelineno-84-48 name=__codelineno-84-48 href=#__codelineno-84-48></a><span class=w>        </span><span class=c1>//daemonset操作</span>
<a id=__codelineno-84-49 name=__codelineno-84-49 href=#__codelineno-84-49></a><span class=w>        </span><span class=nx>GET</span><span class=p>(</span><span class=s>&quot;/api/k8s/daemonsets&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>DaemonSet</span><span class=p>.</span><span class=nx>GetDaemonSets</span><span class=p>).</span>
<a id=__codelineno-84-50 name=__codelineno-84-50 href=#__codelineno-84-50></a><span class=w>        </span><span class=nx>GET</span><span class=p>(</span><span class=s>&quot;/api/k8s/daemonset/detail&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>DaemonSet</span><span class=p>.</span><span class=nx>GetDaemonSetDetail</span><span class=p>).</span>
<a id=__codelineno-84-51 name=__codelineno-84-51 href=#__codelineno-84-51></a><span class=w>        </span><span class=nx>DELETE</span><span class=p>(</span><span class=s>&quot;/api/k8s/daemonset/del&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>DaemonSet</span><span class=p>.</span><span class=nx>DeleteDaemonSet</span><span class=p>).</span>
<a id=__codelineno-84-52 name=__codelineno-84-52 href=#__codelineno-84-52></a><span class=w>        </span><span class=nx>PUT</span><span class=p>(</span><span class=s>&quot;/api/k8s/daemonset/update&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>DaemonSet</span><span class=p>.</span><span class=nx>UpdateDaemonSet</span><span class=p>).</span>
<a id=__codelineno-84-53 name=__codelineno-84-53 href=#__codelineno-84-53></a>
<a id=__codelineno-84-54 name=__codelineno-84-54 href=#__codelineno-84-54></a><span class=w>        </span><span class=c1>//statefulset操作</span>
<a id=__codelineno-84-55 name=__codelineno-84-55 href=#__codelineno-84-55></a><span class=w>        </span><span class=nx>GET</span><span class=p>(</span><span class=s>&quot;/api/k8s/statefulsets&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>StatefulSet</span><span class=p>.</span><span class=nx>GetStatefulSets</span><span class=p>).</span>
<a id=__codelineno-84-56 name=__codelineno-84-56 href=#__codelineno-84-56></a><span class=w>        </span><span class=nx>GET</span><span class=p>(</span><span class=s>&quot;/api/k8s/statefulset/detail&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>StatefulSet</span><span class=p>.</span><span class=nx>GetStatefulSetDetail</span><span class=p>).</span>
<a id=__codelineno-84-57 name=__codelineno-84-57 href=#__codelineno-84-57></a><span class=w>        </span><span class=nx>DELETE</span><span class=p>(</span><span class=s>&quot;/api/k8s/statefulset/del&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>StatefulSet</span><span class=p>.</span><span class=nx>DeleteStatefulSet</span><span class=p>).</span>
<a id=__codelineno-84-58 name=__codelineno-84-58 href=#__codelineno-84-58></a><span class=w>        </span><span class=nx>PUT</span><span class=p>(</span><span class=s>&quot;/api/k8s/statefulset/update&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>StatefulSet</span><span class=p>.</span><span class=nx>UpdateStatefulSet</span><span class=p>).</span>
<a id=__codelineno-84-59 name=__codelineno-84-59 href=#__codelineno-84-59></a>
<a id=__codelineno-84-60 name=__codelineno-84-60 href=#__codelineno-84-60></a><span class=w>        </span><span class=c1>//service操作</span>
<a id=__codelineno-84-61 name=__codelineno-84-61 href=#__codelineno-84-61></a><span class=w>        </span><span class=nx>GET</span><span class=p>(</span><span class=s>&quot;/api/k8s/services&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Servicev1</span><span class=p>.</span><span class=nx>GetServices</span><span class=p>).</span>
<a id=__codelineno-84-62 name=__codelineno-84-62 href=#__codelineno-84-62></a><span class=w>        </span><span class=nx>GET</span><span class=p>(</span><span class=s>&quot;/api/k8s/service/detail&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Servicev1</span><span class=p>.</span><span class=nx>GetServiceDetail</span><span class=p>).</span>
<a id=__codelineno-84-63 name=__codelineno-84-63 href=#__codelineno-84-63></a><span class=w>        </span><span class=nx>DELETE</span><span class=p>(</span><span class=s>&quot;/api/k8s/service/del&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Servicev1</span><span class=p>.</span><span class=nx>DeleteService</span><span class=p>).</span>
<a id=__codelineno-84-64 name=__codelineno-84-64 href=#__codelineno-84-64></a><span class=w>        </span><span class=nx>PUT</span><span class=p>(</span><span class=s>&quot;/api/k8s/service/update&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Servicev1</span><span class=p>.</span><span class=nx>UpdateService</span><span class=p>).</span>
<a id=__codelineno-84-65 name=__codelineno-84-65 href=#__codelineno-84-65></a><span class=w>        </span><span class=nx>POST</span><span class=p>(</span><span class=s>&quot;/api/k8s/service/create&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Servicev1</span><span class=p>.</span><span class=nx>CreateService</span><span class=p>).</span>
<a id=__codelineno-84-66 name=__codelineno-84-66 href=#__codelineno-84-66></a>
<a id=__codelineno-84-67 name=__codelineno-84-67 href=#__codelineno-84-67></a><span class=w>        </span><span class=c1>//ingress操作</span>
<a id=__codelineno-84-68 name=__codelineno-84-68 href=#__codelineno-84-68></a><span class=w>        </span><span class=nx>GET</span><span class=p>(</span><span class=s>&quot;/api/k8s/ingresses&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Ingress</span><span class=p>.</span><span class=nx>GetIngresses</span><span class=p>).</span>
<a id=__codelineno-84-69 name=__codelineno-84-69 href=#__codelineno-84-69></a><span class=w>        </span><span class=nx>GET</span><span class=p>(</span><span class=s>&quot;/api/k8s/ingress/detail&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Ingress</span><span class=p>.</span><span class=nx>GetIngressDetail</span><span class=p>).</span>
<a id=__codelineno-84-70 name=__codelineno-84-70 href=#__codelineno-84-70></a><span class=w>        </span><span class=nx>DELETE</span><span class=p>(</span><span class=s>&quot;/api/k8s/ingress/del&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Ingress</span><span class=p>.</span><span class=nx>DeleteIngress</span><span class=p>).</span>
<a id=__codelineno-84-71 name=__codelineno-84-71 href=#__codelineno-84-71></a><span class=w>        </span><span class=nx>PUT</span><span class=p>(</span><span class=s>&quot;/api/k8s/ingress/update&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Ingress</span><span class=p>.</span><span class=nx>UpdateIngress</span><span class=p>).</span>
<a id=__codelineno-84-72 name=__codelineno-84-72 href=#__codelineno-84-72></a><span class=w>        </span><span class=nx>POST</span><span class=p>(</span><span class=s>&quot;/api/k8s/ingress/create&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Ingress</span><span class=p>.</span><span class=nx>CreateIngress</span><span class=p>).</span>
<a id=__codelineno-84-73 name=__codelineno-84-73 href=#__codelineno-84-73></a>
<a id=__codelineno-84-74 name=__codelineno-84-74 href=#__codelineno-84-74></a><span class=w>        </span><span class=c1>//configmap操作</span>
<a id=__codelineno-84-75 name=__codelineno-84-75 href=#__codelineno-84-75></a><span class=w>        </span><span class=nx>GET</span><span class=p>(</span><span class=s>&quot;/api/k8s/configmaps&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>ConfigMap</span><span class=p>.</span><span class=nx>GetConfigMaps</span><span class=p>).</span>
<a id=__codelineno-84-76 name=__codelineno-84-76 href=#__codelineno-84-76></a><span class=w>        </span><span class=nx>GET</span><span class=p>(</span><span class=s>&quot;/api/k8s/configmap/detail&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>ConfigMap</span><span class=p>.</span><span class=nx>GetConfigMapDetail</span><span class=p>).</span>
<a id=__codelineno-84-77 name=__codelineno-84-77 href=#__codelineno-84-77></a><span class=w>        </span><span class=nx>DELETE</span><span class=p>(</span><span class=s>&quot;/api/k8s/configmap/del&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>ConfigMap</span><span class=p>.</span><span class=nx>DeleteConfigMap</span><span class=p>).</span>
<a id=__codelineno-84-78 name=__codelineno-84-78 href=#__codelineno-84-78></a><span class=w>        </span><span class=nx>PUT</span><span class=p>(</span><span class=s>&quot;/api/k8s/configmap/update&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>ConfigMap</span><span class=p>.</span><span class=nx>UpdateConfigMap</span><span class=p>).</span>
<a id=__codelineno-84-79 name=__codelineno-84-79 href=#__codelineno-84-79></a>
<a id=__codelineno-84-80 name=__codelineno-84-80 href=#__codelineno-84-80></a><span class=w>        </span><span class=c1>//sercret操作</span>
<a id=__codelineno-84-81 name=__codelineno-84-81 href=#__codelineno-84-81></a><span class=w>        </span><span class=nx>GET</span><span class=p>(</span><span class=s>&quot;/api/k8s/secrets&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Secret</span><span class=p>.</span><span class=nx>GetSecrets</span><span class=p>).</span>
<a id=__codelineno-84-82 name=__codelineno-84-82 href=#__codelineno-84-82></a><span class=w>        </span><span class=nx>GET</span><span class=p>(</span><span class=s>&quot;/api/k8s/secret/detail&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Secret</span><span class=p>.</span><span class=nx>GetSecretDetail</span><span class=p>).</span>
<a id=__codelineno-84-83 name=__codelineno-84-83 href=#__codelineno-84-83></a><span class=w>        </span><span class=nx>DELETE</span><span class=p>(</span><span class=s>&quot;/api/k8s/secret/del&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Secret</span><span class=p>.</span><span class=nx>DeleteSecret</span><span class=p>).</span>
<a id=__codelineno-84-84 name=__codelineno-84-84 href=#__codelineno-84-84></a><span class=w>        </span><span class=nx>PUT</span><span class=p>(</span><span class=s>&quot;/api/k8s/secret/update&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Secret</span><span class=p>.</span><span class=nx>UpdateSecret</span><span class=p>).</span>
<a id=__codelineno-84-85 name=__codelineno-84-85 href=#__codelineno-84-85></a>
<a id=__codelineno-84-86 name=__codelineno-84-86 href=#__codelineno-84-86></a><span class=w>        </span><span class=c1>//pvc操作</span>
<a id=__codelineno-84-87 name=__codelineno-84-87 href=#__codelineno-84-87></a><span class=w>        </span><span class=nx>GET</span><span class=p>(</span><span class=s>&quot;/api/k8s/pvcs&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Pvc</span><span class=p>.</span><span class=nx>GetPvcs</span><span class=p>).</span>
<a id=__codelineno-84-88 name=__codelineno-84-88 href=#__codelineno-84-88></a><span class=w>        </span><span class=nx>GET</span><span class=p>(</span><span class=s>&quot;/api/k8s/pvc/detail&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Pvc</span><span class=p>.</span><span class=nx>GetPvcDetail</span><span class=p>).</span>
<a id=__codelineno-84-89 name=__codelineno-84-89 href=#__codelineno-84-89></a><span class=w>        </span><span class=nx>DELETE</span><span class=p>(</span><span class=s>&quot;/api/k8s/pvc/del&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Pvc</span><span class=p>.</span><span class=nx>DeletePvc</span><span class=p>).</span>
<a id=__codelineno-84-90 name=__codelineno-84-90 href=#__codelineno-84-90></a><span class=w>        </span><span class=nx>PUT</span><span class=p>(</span><span class=s>&quot;/api/k8s/pvc/update&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Pvc</span><span class=p>.</span><span class=nx>UpdatePvc</span><span class=p>).</span>
<a id=__codelineno-84-91 name=__codelineno-84-91 href=#__codelineno-84-91></a>
<a id=__codelineno-84-92 name=__codelineno-84-92 href=#__codelineno-84-92></a><span class=w>        </span><span class=c1>//node操作</span>
<a id=__codelineno-84-93 name=__codelineno-84-93 href=#__codelineno-84-93></a><span class=w>        </span><span class=nx>GET</span><span class=p>(</span><span class=s>&quot;/api/k8s/nodes&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Node</span><span class=p>.</span><span class=nx>GetNodes</span><span class=p>).</span>
<a id=__codelineno-84-94 name=__codelineno-84-94 href=#__codelineno-84-94></a><span class=w>        </span><span class=nx>GET</span><span class=p>(</span><span class=s>&quot;/api/k8s/node/detail&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Node</span><span class=p>.</span><span class=nx>GetNodeDetail</span><span class=p>).</span>
<a id=__codelineno-84-95 name=__codelineno-84-95 href=#__codelineno-84-95></a>
<a id=__codelineno-84-96 name=__codelineno-84-96 href=#__codelineno-84-96></a><span class=w>        </span><span class=c1>//namespace操作</span>
<a id=__codelineno-84-97 name=__codelineno-84-97 href=#__codelineno-84-97></a><span class=w>        </span><span class=nx>GET</span><span class=p>(</span><span class=s>&quot;/api/k8s/namespaces&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Namespace</span><span class=p>.</span><span class=nx>GetNamespaces</span><span class=p>).</span>
<a id=__codelineno-84-98 name=__codelineno-84-98 href=#__codelineno-84-98></a><span class=w>        </span><span class=nx>GET</span><span class=p>(</span><span class=s>&quot;/api/k8s/namespace/detail&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Namespace</span><span class=p>.</span><span class=nx>GetNamespaceDetail</span><span class=p>).</span>
<a id=__codelineno-84-99 name=__codelineno-84-99 href=#__codelineno-84-99></a><span class=w>        </span><span class=nx>DELETE</span><span class=p>(</span><span class=s>&quot;/api/k8s/namespace/del&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Namespace</span><span class=p>.</span><span class=nx>DeleteNamespace</span><span class=p>).</span>
<a id=__codelineno-84-100 name=__codelineno-84-100 href=#__codelineno-84-100></a>
<a id=__codelineno-84-101 name=__codelineno-84-101 href=#__codelineno-84-101></a><span class=w>        </span><span class=c1>//pv操作</span>
<a id=__codelineno-84-102 name=__codelineno-84-102 href=#__codelineno-84-102></a><span class=w>        </span><span class=nx>GET</span><span class=p>(</span><span class=s>&quot;/api/k8s/pvs&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Pv</span><span class=p>.</span><span class=nx>GetPvs</span><span class=p>).</span>
<a id=__codelineno-84-103 name=__codelineno-84-103 href=#__codelineno-84-103></a><span class=w>        </span><span class=nx>GET</span><span class=p>(</span><span class=s>&quot;/api/k8s/pv/detail&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Pv</span><span class=p>.</span><span class=nx>GetPvDetail</span><span class=p>)</span>
<a id=__codelineno-84-104 name=__codelineno-84-104 href=#__codelineno-84-104></a><span class=p>}</span>
</code></pre></div> <h3 id=7-中间件>7. 中间件<a class=headerlink href=#7-中间件 title="Permanent link">&para;</a></h3> <h4 id=71什么是中间件>7.1什么是中间件<a class=headerlink href=#71什么是中间件 title="Permanent link">&para;</a></h4> <p><img alt=1701079033842 class=zoom src=https://cdn.jsdelivr.net/gh/hujianli94/Picgo-atlas@main/img/1701079033842.4xggjwpkrcw0.webp></p> <p>中间件，英译middleware，顾名思义，放在中间的物件，那么放在谁中间呢？本来，客户端可以直接请求到服务端接口。现在，中间件横插一脚，它能在请求到达接口之前拦截请求，做一些特殊处理，比如日志记录，故障处理等。</p> <h4 id=72-gin中间件用法>7.2 gin中间件用法<a class=headerlink href=#72-gin中间件用法 title="Permanent link">&para;</a></h4> <p><img alt=1701079134241 class=zoom src=https://cdn.jsdelivr.net/gh/hujianli94/Picgo-atlas@main/img/1701079134241.71uglfgapns0.webp></p> <p>因为gin的中间件函数与业务逻辑处理函数是放到gin的队列中的，所以当一个中间件函数执行return语句时只代表当前中间件函数执行完了，gin框架会驱动index++,然后执行队列中后续的中间件函数或逻辑处理函数，当在中间件函数中执行context.Next()时，gin框架也会驱动index++，执行下一个函数。当执行context.Abort()时，会修改c.index = 63.5,由于该索引不存在，所以队列中后面的的中间件函数和逻辑处理函数就不会执行了。</p> <p>（1）定义一个返回值是gin.HandlerFunc的方法</p> <p>（2）在方法中根据context上下文添加中间件逻辑</p> <p>（3）中间件逻辑未通过，使用context.Abort()和return停止下个函数的执行</p> <p>（4）中间件逻辑通过时，使用context.Next()继续执行下个函数</p> <p>（5）定义好中间件函数后，在main中使用use()将其加入到队列中，注意use一定要在初始化路由的前面，否则不会生效</p> <h4 id=73-cors跨域>7.3 Cors跨域<a class=headerlink href=#73-cors跨域 title="Permanent link">&para;</a></h4> <p>代码层直接处理跨域请求，不需要前面再加一层nginx处理，解决前后端域名不同、IP不同甚至端口不同导致的跨域报错。</p> <p><code>middle/cors.go</code></p> <div class=highlight><pre><span></span><code><a id=__codelineno-85-1 name=__codelineno-85-1 href=#__codelineno-85-1></a><span class=kn>package</span><span class=w> </span><span class=nx>middle</span>
<a id=__codelineno-85-2 name=__codelineno-85-2 href=#__codelineno-85-2></a>
<a id=__codelineno-85-3 name=__codelineno-85-3 href=#__codelineno-85-3></a><span class=kn>import</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-85-4 name=__codelineno-85-4 href=#__codelineno-85-4></a><span class=w>    </span><span class=s>&quot;github.com/gin-gonic/gin&quot;</span>
<a id=__codelineno-85-5 name=__codelineno-85-5 href=#__codelineno-85-5></a><span class=w>    </span><span class=s>&quot;net/http&quot;</span>
<a id=__codelineno-85-6 name=__codelineno-85-6 href=#__codelineno-85-6></a><span class=p>)</span>
<a id=__codelineno-85-7 name=__codelineno-85-7 href=#__codelineno-85-7></a>
<a id=__codelineno-85-8 name=__codelineno-85-8 href=#__codelineno-85-8></a><span class=c1>// Cors 处理跨域请求，支持options访问</span>
<a id=__codelineno-85-9 name=__codelineno-85-9 href=#__codelineno-85-9></a><span class=kd>func</span><span class=w> </span><span class=nx>Cors</span><span class=p>()</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>HandlerFunc</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-85-10 name=__codelineno-85-10 href=#__codelineno-85-10></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kd>func</span><span class=p>(</span><span class=nx>c</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-85-11 name=__codelineno-85-11 href=#__codelineno-85-11></a><span class=w>        </span><span class=c1>//获取请求方法</span>
<a id=__codelineno-85-12 name=__codelineno-85-12 href=#__codelineno-85-12></a><span class=w>        </span><span class=nx>method</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>c</span><span class=p>.</span><span class=nx>Request</span><span class=p>.</span><span class=nx>Method</span>
<a id=__codelineno-85-13 name=__codelineno-85-13 href=#__codelineno-85-13></a><span class=w>        </span><span class=c1>//添加跨域响应头</span>
<a id=__codelineno-85-14 name=__codelineno-85-14 href=#__codelineno-85-14></a><span class=w>        </span><span class=nx>c</span><span class=p>.</span><span class=nx>Header</span><span class=p>(</span><span class=s>&quot;Content-Type&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;application/json&quot;</span><span class=p>)</span>
<a id=__codelineno-85-15 name=__codelineno-85-15 href=#__codelineno-85-15></a><span class=w>        </span><span class=c1>//c.Header(&quot;Content-Type&quot;, &quot;*&quot;)</span>
<a id=__codelineno-85-16 name=__codelineno-85-16 href=#__codelineno-85-16></a><span class=w>        </span><span class=nx>c</span><span class=p>.</span><span class=nx>Header</span><span class=p>(</span><span class=s>&quot;Access-Control-Allow-Origin&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;*&quot;</span><span class=p>)</span>
<a id=__codelineno-85-17 name=__codelineno-85-17 href=#__codelineno-85-17></a><span class=w>        </span><span class=nx>c</span><span class=p>.</span><span class=nx>Header</span><span class=p>(</span><span class=s>&quot;Access-Control-Max-Age&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;86400&quot;</span><span class=p>)</span>
<a id=__codelineno-85-18 name=__codelineno-85-18 href=#__codelineno-85-18></a><span class=w>        </span><span class=nx>c</span><span class=p>.</span><span class=nx>Header</span><span class=p>(</span><span class=s>&quot;Access-Control-Allow-Methods&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;POST, GET, OPTIONS, PUT, DELETE, UPDATE&quot;</span><span class=p>)</span>
<a id=__codelineno-85-19 name=__codelineno-85-19 href=#__codelineno-85-19></a><span class=w>        </span><span class=c1>//c.Header(&quot;Access-Control-Allow-Methods&quot;, &quot;*&quot;)</span>
<a id=__codelineno-85-20 name=__codelineno-85-20 href=#__codelineno-85-20></a><span class=w>        </span><span class=nx>c</span><span class=p>.</span><span class=nx>Header</span><span class=p>(</span><span class=s>&quot;Access-Control-Allow-Headers&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;X-Token, Content-Type, Content-Length, Accept-Encoding, X-CSRF-Token, Authorization, X-Max&quot;</span><span class=p>)</span>
<a id=__codelineno-85-21 name=__codelineno-85-21 href=#__codelineno-85-21></a><span class=w>        </span><span class=nx>c</span><span class=p>.</span><span class=nx>Header</span><span class=p>(</span><span class=s>&quot;Access-Control-Allow-Credentials&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;false&quot;</span><span class=p>)</span>
<a id=__codelineno-85-22 name=__codelineno-85-22 href=#__codelineno-85-22></a><span class=w>        </span><span class=c1>//旅行所有OPTIONS方法</span>
<a id=__codelineno-85-23 name=__codelineno-85-23 href=#__codelineno-85-23></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=nx>method</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&quot;OPTIONS&quot;</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-85-24 name=__codelineno-85-24 href=#__codelineno-85-24></a><span class=w>            </span><span class=nx>c</span><span class=p>.</span><span class=nx>AbortWithStatus</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusNoContent</span><span class=p>)</span>
<a id=__codelineno-85-25 name=__codelineno-85-25 href=#__codelineno-85-25></a><span class=w>        </span><span class=p>}</span>
<a id=__codelineno-85-26 name=__codelineno-85-26 href=#__codelineno-85-26></a><span class=w>        </span><span class=c1>//fmt.Println(&quot;c.Request&quot;, c.Request)</span>
<a id=__codelineno-85-27 name=__codelineno-85-27 href=#__codelineno-85-27></a><span class=w>        </span><span class=c1>//处理请求</span>
<a id=__codelineno-85-28 name=__codelineno-85-28 href=#__codelineno-85-28></a><span class=w>        </span><span class=nx>c</span><span class=p>.</span><span class=nx>Next</span><span class=p>()</span>
<a id=__codelineno-85-29 name=__codelineno-85-29 href=#__codelineno-85-29></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-85-30 name=__codelineno-85-30 href=#__codelineno-85-30></a><span class=p>}</span>
</code></pre></div> <p><code>main.go</code></p> <div class=highlight><pre><span></span><code><a id=__codelineno-86-1 name=__codelineno-86-1 href=#__codelineno-86-1></a><span class=kn>package</span><span class=w> </span><span class=nx>main</span>
<a id=__codelineno-86-2 name=__codelineno-86-2 href=#__codelineno-86-2></a>
<a id=__codelineno-86-3 name=__codelineno-86-3 href=#__codelineno-86-3></a><span class=kn>import</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-86-4 name=__codelineno-86-4 href=#__codelineno-86-4></a><span class=w>    </span><span class=s>&quot;gitee.com/hujianli94net/k8s-platform/config&quot;</span>
<a id=__codelineno-86-5 name=__codelineno-86-5 href=#__codelineno-86-5></a><span class=w>    </span><span class=s>&quot;gitee.com/hujianli94net/k8s-platform/controller&quot;</span>
<a id=__codelineno-86-6 name=__codelineno-86-6 href=#__codelineno-86-6></a><span class=w>    </span><span class=s>&quot;gitee.com/hujianli94net/k8s-platform/db&quot;</span>
<a id=__codelineno-86-7 name=__codelineno-86-7 href=#__codelineno-86-7></a><span class=w>    </span><span class=s>&quot;gitee.com/hujianli94net/k8s-platform/middle&quot;</span>
<a id=__codelineno-86-8 name=__codelineno-86-8 href=#__codelineno-86-8></a><span class=w>    </span><span class=s>&quot;gitee.com/hujianli94net/k8s-platform/service&quot;</span>
<a id=__codelineno-86-9 name=__codelineno-86-9 href=#__codelineno-86-9></a>
<a id=__codelineno-86-10 name=__codelineno-86-10 href=#__codelineno-86-10></a><span class=w>    </span><span class=s>&quot;github.com/gin-gonic/gin&quot;</span>
<a id=__codelineno-86-11 name=__codelineno-86-11 href=#__codelineno-86-11></a><span class=p>)</span>
<a id=__codelineno-86-12 name=__codelineno-86-12 href=#__codelineno-86-12></a>
<a id=__codelineno-86-13 name=__codelineno-86-13 href=#__codelineno-86-13></a><span class=kd>func</span><span class=w> </span><span class=nx>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-86-14 name=__codelineno-86-14 href=#__codelineno-86-14></a><span class=w>    </span><span class=c1>//初始化k8s client</span>
<a id=__codelineno-86-15 name=__codelineno-86-15 href=#__codelineno-86-15></a><span class=w>    </span><span class=nx>service</span><span class=p>.</span><span class=nx>K8s</span><span class=p>.</span><span class=nx>Init</span><span class=p>()</span>
<a id=__codelineno-86-16 name=__codelineno-86-16 href=#__codelineno-86-16></a><span class=w>    </span><span class=c1>//初始化数据库</span>
<a id=__codelineno-86-17 name=__codelineno-86-17 href=#__codelineno-86-17></a><span class=w>    </span><span class=nx>db</span><span class=p>.</span><span class=nx>Init</span><span class=p>()</span>
<a id=__codelineno-86-18 name=__codelineno-86-18 href=#__codelineno-86-18></a><span class=w>    </span><span class=c1>//初始化gin对象</span>
<a id=__codelineno-86-19 name=__codelineno-86-19 href=#__codelineno-86-19></a><span class=w>    </span><span class=nx>r</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>Default</span><span class=p>()</span>
<a id=__codelineno-86-20 name=__codelineno-86-20 href=#__codelineno-86-20></a><span class=w>    </span><span class=c1>//初始化k8s client</span>
<a id=__codelineno-86-21 name=__codelineno-86-21 href=#__codelineno-86-21></a><span class=w>    </span><span class=nx>service</span><span class=p>.</span><span class=nx>K8s</span><span class=p>.</span><span class=nx>Init</span><span class=p>()</span>
<a id=__codelineno-86-22 name=__codelineno-86-22 href=#__codelineno-86-22></a><span class=w>    </span><span class=c1>//跨域配置</span>
<a id=__codelineno-86-23 name=__codelineno-86-23 href=#__codelineno-86-23></a><span class=w>    </span><span class=nx>r</span><span class=p>.</span><span class=nx>Use</span><span class=p>(</span><span class=nx>middle</span><span class=p>.</span><span class=nx>Cors</span><span class=p>())</span>
<a id=__codelineno-86-24 name=__codelineno-86-24 href=#__codelineno-86-24></a><span class=w>    </span><span class=c1>//初始化路由规则</span>
<a id=__codelineno-86-25 name=__codelineno-86-25 href=#__codelineno-86-25></a><span class=w>    </span><span class=nx>controller</span><span class=p>.</span><span class=nx>Router</span><span class=p>.</span><span class=nx>InitApiRouter</span><span class=p>(</span><span class=nx>r</span><span class=p>)</span>
<a id=__codelineno-86-26 name=__codelineno-86-26 href=#__codelineno-86-26></a><span class=w>    </span><span class=c1>//gin程序启动</span>
<a id=__codelineno-86-27 name=__codelineno-86-27 href=#__codelineno-86-27></a><span class=w>    </span><span class=nx>r</span><span class=p>.</span><span class=nx>Run</span><span class=p>(</span><span class=nx>config</span><span class=p>.</span><span class=nx>ListenAddr</span><span class=p>)</span>
<a id=__codelineno-86-28 name=__codelineno-86-28 href=#__codelineno-86-28></a><span class=w>    </span><span class=c1>//关闭db连接</span>
<a id=__codelineno-86-29 name=__codelineno-86-29 href=#__codelineno-86-29></a><span class=w>    </span><span class=nx>db</span><span class=p>.</span><span class=nx>Close</span><span class=p>()</span>
<a id=__codelineno-86-30 name=__codelineno-86-30 href=#__codelineno-86-30></a><span class=p>}</span>
</code></pre></div> <h4 id=74-jwt-token验证>7.4 JWT token验证<a class=headerlink href=#74-jwt-token验证 title="Permanent link">&para;</a></h4> <p>验证请求的合法性，前端只有在登录状态下才会生成token，请求时将token放入Header中，后端接收的请求时，先由该中间件验证token是否合法，合法时才放行，继续执行业务函数的逻辑处理。</p> <p><code>utils/jwt.go</code></p> <div class=highlight><pre><span></span><code><a id=__codelineno-87-1 name=__codelineno-87-1 href=#__codelineno-87-1></a><span class=kn>package</span><span class=w> </span><span class=nx>utils</span>
<a id=__codelineno-87-2 name=__codelineno-87-2 href=#__codelineno-87-2></a>
<a id=__codelineno-87-3 name=__codelineno-87-3 href=#__codelineno-87-3></a><span class=kn>import</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-87-4 name=__codelineno-87-4 href=#__codelineno-87-4></a><span class=w>    </span><span class=s>&quot;errors&quot;</span>
<a id=__codelineno-87-5 name=__codelineno-87-5 href=#__codelineno-87-5></a><span class=w>    </span><span class=s>&quot;github.com/dgrijalva/jwt-go&quot;</span>
<a id=__codelineno-87-6 name=__codelineno-87-6 href=#__codelineno-87-6></a><span class=w>    </span><span class=s>&quot;github.com/wonderivan/logger&quot;</span>
<a id=__codelineno-87-7 name=__codelineno-87-7 href=#__codelineno-87-7></a><span class=p>)</span>
<a id=__codelineno-87-8 name=__codelineno-87-8 href=#__codelineno-87-8></a>
<a id=__codelineno-87-9 name=__codelineno-87-9 href=#__codelineno-87-9></a><span class=kd>type</span><span class=w> </span><span class=nx>jwtToken</span><span class=w> </span><span class=kd>struct</span><span class=p>{}</span>
<a id=__codelineno-87-10 name=__codelineno-87-10 href=#__codelineno-87-10></a>
<a id=__codelineno-87-11 name=__codelineno-87-11 href=#__codelineno-87-11></a><span class=kd>var</span><span class=w> </span><span class=nx>JWTToken</span><span class=w> </span><span class=nx>jwtToken</span>
<a id=__codelineno-87-12 name=__codelineno-87-12 href=#__codelineno-87-12></a>
<a id=__codelineno-87-13 name=__codelineno-87-13 href=#__codelineno-87-13></a><span class=c1>// CustomClaims token中包含的自定义信息以及jwt签名信息</span>
<a id=__codelineno-87-14 name=__codelineno-87-14 href=#__codelineno-87-14></a><span class=kd>type</span><span class=w> </span><span class=nx>CustomClaims</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-87-15 name=__codelineno-87-15 href=#__codelineno-87-15></a><span class=w>    </span><span class=nx>Username</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;username&quot;`</span>
<a id=__codelineno-87-16 name=__codelineno-87-16 href=#__codelineno-87-16></a><span class=w>    </span><span class=nx>Password</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;password&quot;`</span>
<a id=__codelineno-87-17 name=__codelineno-87-17 href=#__codelineno-87-17></a><span class=w>    </span><span class=nx>jwt</span><span class=p>.</span><span class=nx>StandardClaims</span>
<a id=__codelineno-87-18 name=__codelineno-87-18 href=#__codelineno-87-18></a><span class=p>}</span>
<a id=__codelineno-87-19 name=__codelineno-87-19 href=#__codelineno-87-19></a>
<a id=__codelineno-87-20 name=__codelineno-87-20 href=#__codelineno-87-20></a><span class=c1>// 加解密因子</span>
<a id=__codelineno-87-21 name=__codelineno-87-21 href=#__codelineno-87-21></a><span class=kd>const</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-87-22 name=__codelineno-87-22 href=#__codelineno-87-22></a><span class=w>    </span><span class=nx>SECRET</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=s>&quot;adoodevops&quot;</span>
<a id=__codelineno-87-23 name=__codelineno-87-23 href=#__codelineno-87-23></a><span class=p>)</span>
<a id=__codelineno-87-24 name=__codelineno-87-24 href=#__codelineno-87-24></a>
<a id=__codelineno-87-25 name=__codelineno-87-25 href=#__codelineno-87-25></a><span class=c1>// ParseToken 解析token</span>
<a id=__codelineno-87-26 name=__codelineno-87-26 href=#__codelineno-87-26></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=o>*</span><span class=nx>jwtToken</span><span class=p>)</span><span class=w> </span><span class=nx>ParseToken</span><span class=p>(</span><span class=nx>tokenString</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>claim</span><span class=w> </span><span class=o>*</span><span class=nx>CustomClaims</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-87-27 name=__codelineno-87-27 href=#__codelineno-87-27></a><span class=w>    </span><span class=c1>//使用jwt.ParseWithClaims方法解析token，这个token是前端传给我们的，获得一个*Token类型的对象</span>
<a id=__codelineno-87-28 name=__codelineno-87-28 href=#__codelineno-87-28></a><span class=w>    </span><span class=nx>token</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>jwt</span><span class=p>.</span><span class=nx>ParseWithClaims</span><span class=p>(</span><span class=nx>tokenString</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=nx>CustomClaims</span><span class=p>{},</span><span class=w> </span><span class=kd>func</span><span class=p>(</span><span class=nx>token</span><span class=w> </span><span class=o>*</span><span class=nx>jwt</span><span class=p>.</span><span class=nx>Token</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=kd>interface</span><span class=p>{},</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-87-29 name=__codelineno-87-29 href=#__codelineno-87-29></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=p>[]</span><span class=nb>byte</span><span class=p>(</span><span class=nx>SECRET</span><span class=p>),</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-87-30 name=__codelineno-87-30 href=#__codelineno-87-30></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-87-31 name=__codelineno-87-31 href=#__codelineno-87-31></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-87-32 name=__codelineno-87-32 href=#__codelineno-87-32></a><span class=w>        </span><span class=nx>logger</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=s>&quot;parse token failed&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span>
<a id=__codelineno-87-33 name=__codelineno-87-33 href=#__codelineno-87-33></a><span class=w>        </span><span class=c1>//处理token解析后的各种错误</span>
<a id=__codelineno-87-34 name=__codelineno-87-34 href=#__codelineno-87-34></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=nx>ve</span><span class=p>,</span><span class=w> </span><span class=nx>ok</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>err</span><span class=p>.(</span><span class=o>*</span><span class=nx>jwt</span><span class=p>.</span><span class=nx>ValidationError</span><span class=p>);</span><span class=w> </span><span class=nx>ok</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-87-35 name=__codelineno-87-35 href=#__codelineno-87-35></a><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=nx>ve</span><span class=p>.</span><span class=nx>Errors</span><span class=o>&amp;</span><span class=nx>jwt</span><span class=p>.</span><span class=nx>ValidationErrorMalformed</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-87-36 name=__codelineno-87-36 href=#__codelineno-87-36></a><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;TokenMalformed&quot;</span><span class=p>)</span>
<a id=__codelineno-87-37 name=__codelineno-87-37 href=#__codelineno-87-37></a><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=nx>ve</span><span class=p>.</span><span class=nx>Errors</span><span class=o>&amp;</span><span class=nx>jwt</span><span class=p>.</span><span class=nx>ValidationErrorExpired</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-87-38 name=__codelineno-87-38 href=#__codelineno-87-38></a><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;TokenExpired&quot;</span><span class=p>)</span>
<a id=__codelineno-87-39 name=__codelineno-87-39 href=#__codelineno-87-39></a><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=nx>ve</span><span class=p>.</span><span class=nx>Errors</span><span class=o>&amp;</span><span class=nx>jwt</span><span class=p>.</span><span class=nx>ValidationErrorNotValidYet</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-87-40 name=__codelineno-87-40 href=#__codelineno-87-40></a><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;TokenNotValidYet&quot;</span><span class=p>)</span>
<a id=__codelineno-87-41 name=__codelineno-87-41 href=#__codelineno-87-41></a><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-87-42 name=__codelineno-87-42 href=#__codelineno-87-42></a><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;TokenInvalid&quot;</span><span class=p>)</span>
<a id=__codelineno-87-43 name=__codelineno-87-43 href=#__codelineno-87-43></a><span class=w>            </span><span class=p>}</span>
<a id=__codelineno-87-44 name=__codelineno-87-44 href=#__codelineno-87-44></a><span class=w>        </span><span class=p>}</span>
<a id=__codelineno-87-45 name=__codelineno-87-45 href=#__codelineno-87-45></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-87-46 name=__codelineno-87-46 href=#__codelineno-87-46></a><span class=w>    </span><span class=c1>//转换成*CustomClaims类型并返回</span>
<a id=__codelineno-87-47 name=__codelineno-87-47 href=#__codelineno-87-47></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>claims</span><span class=p>,</span><span class=w> </span><span class=nx>ok</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>token</span><span class=p>.</span><span class=nx>Claims</span><span class=p>.(</span><span class=o>*</span><span class=nx>CustomClaims</span><span class=p>);</span><span class=w> </span><span class=nx>ok</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nx>token</span><span class=p>.</span><span class=nx>Valid</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-87-48 name=__codelineno-87-48 href=#__codelineno-87-48></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>claims</span><span class=p>,</span><span class=w> </span><span class=kc>nil</span>
<a id=__codelineno-87-49 name=__codelineno-87-49 href=#__codelineno-87-49></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-87-50 name=__codelineno-87-50 href=#__codelineno-87-50></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;解析Token失败&quot;</span><span class=p>)</span>
<a id=__codelineno-87-51 name=__codelineno-87-51 href=#__codelineno-87-51></a><span class=p>}</span>
</code></pre></div> <p><code>middle/jwt.go</code></p> <div class=highlight><pre><span></span><code><a id=__codelineno-88-1 name=__codelineno-88-1 href=#__codelineno-88-1></a><span class=kn>package</span><span class=w> </span><span class=nx>middle</span>
<a id=__codelineno-88-2 name=__codelineno-88-2 href=#__codelineno-88-2></a>
<a id=__codelineno-88-3 name=__codelineno-88-3 href=#__codelineno-88-3></a><span class=kn>import</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-88-4 name=__codelineno-88-4 href=#__codelineno-88-4></a><span class=w>    </span><span class=s>&quot;gitee.com/hujianli94net/k8s-platform/utils&quot;</span>
<a id=__codelineno-88-5 name=__codelineno-88-5 href=#__codelineno-88-5></a><span class=w>    </span><span class=s>&quot;net/http&quot;</span>
<a id=__codelineno-88-6 name=__codelineno-88-6 href=#__codelineno-88-6></a>
<a id=__codelineno-88-7 name=__codelineno-88-7 href=#__codelineno-88-7></a><span class=w>    </span><span class=s>&quot;github.com/gin-gonic/gin&quot;</span>
<a id=__codelineno-88-8 name=__codelineno-88-8 href=#__codelineno-88-8></a><span class=p>)</span>
<a id=__codelineno-88-9 name=__codelineno-88-9 href=#__codelineno-88-9></a>
<a id=__codelineno-88-10 name=__codelineno-88-10 href=#__codelineno-88-10></a><span class=c1>// 中间件，检查token</span>
<a id=__codelineno-88-11 name=__codelineno-88-11 href=#__codelineno-88-11></a><span class=kd>func</span><span class=w> </span><span class=nx>JWTAuth</span><span class=p>()</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>HandlerFunc</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-88-12 name=__codelineno-88-12 href=#__codelineno-88-12></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kd>func</span><span class=p>(</span><span class=nx>c</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-88-13 name=__codelineno-88-13 href=#__codelineno-88-13></a><span class=w>        </span><span class=c1>//对登录接口放行</span>
<a id=__codelineno-88-14 name=__codelineno-88-14 href=#__codelineno-88-14></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>c</span><span class=p>.</span><span class=nx>Request</span><span class=p>.</span><span class=nx>URL</span><span class=p>.</span><span class=nx>String</span><span class=p>())</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=mi>10</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nx>c</span><span class=p>.</span><span class=nx>Request</span><span class=p>.</span><span class=nx>URL</span><span class=p>.</span><span class=nx>String</span><span class=p>()[</span><span class=mi>0</span><span class=p>:</span><span class=mi>10</span><span class=p>]</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&quot;/api/login&quot;</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-88-15 name=__codelineno-88-15 href=#__codelineno-88-15></a><span class=w>            </span><span class=nx>c</span><span class=p>.</span><span class=nx>Next</span><span class=p>()</span>
<a id=__codelineno-88-16 name=__codelineno-88-16 href=#__codelineno-88-16></a><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-88-17 name=__codelineno-88-17 href=#__codelineno-88-17></a><span class=w>            </span><span class=c1>//获取Header中的Authorization</span>
<a id=__codelineno-88-18 name=__codelineno-88-18 href=#__codelineno-88-18></a><span class=w>            </span><span class=nx>token</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>c</span><span class=p>.</span><span class=nx>Request</span><span class=p>.</span><span class=nx>Header</span><span class=p>.</span><span class=nx>Get</span><span class=p>(</span><span class=s>&quot;Authorization&quot;</span><span class=p>)</span>
<a id=__codelineno-88-19 name=__codelineno-88-19 href=#__codelineno-88-19></a><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=nx>token</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&quot;&quot;</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-88-20 name=__codelineno-88-20 href=#__codelineno-88-20></a><span class=w>                </span><span class=nx>c</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusBadRequest</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-88-21 name=__codelineno-88-21 href=#__codelineno-88-21></a><span class=w>                    </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;请求未携带token，无权限访问&quot;</span><span class=p>,</span>
<a id=__codelineno-88-22 name=__codelineno-88-22 href=#__codelineno-88-22></a><span class=w>                    </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-88-23 name=__codelineno-88-23 href=#__codelineno-88-23></a><span class=w>                </span><span class=p>})</span>
<a id=__codelineno-88-24 name=__codelineno-88-24 href=#__codelineno-88-24></a><span class=w>                </span><span class=nx>c</span><span class=p>.</span><span class=nx>Abort</span><span class=p>()</span>
<a id=__codelineno-88-25 name=__codelineno-88-25 href=#__codelineno-88-25></a><span class=w>                </span><span class=k>return</span>
<a id=__codelineno-88-26 name=__codelineno-88-26 href=#__codelineno-88-26></a><span class=w>            </span><span class=p>}</span>
<a id=__codelineno-88-27 name=__codelineno-88-27 href=#__codelineno-88-27></a><span class=w>            </span><span class=c1>//parseToken解析token包含的信息</span>
<a id=__codelineno-88-28 name=__codelineno-88-28 href=#__codelineno-88-28></a><span class=w>            </span><span class=nx>claims</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>utils</span><span class=p>.</span><span class=nx>JWTToken</span><span class=p>.</span><span class=nx>ParseToken</span><span class=p>(</span><span class=nx>token</span><span class=p>)</span>
<a id=__codelineno-88-29 name=__codelineno-88-29 href=#__codelineno-88-29></a><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-88-30 name=__codelineno-88-30 href=#__codelineno-88-30></a><span class=w>                </span><span class=c1>//token延期错误</span>
<a id=__codelineno-88-31 name=__codelineno-88-31 href=#__codelineno-88-31></a><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>()</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&quot;TokenExpired&quot;</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-88-32 name=__codelineno-88-32 href=#__codelineno-88-32></a><span class=w>                    </span><span class=nx>c</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusBadRequest</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-88-33 name=__codelineno-88-33 href=#__codelineno-88-33></a><span class=w>                        </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;授权已过期&quot;</span><span class=p>,</span>
<a id=__codelineno-88-34 name=__codelineno-88-34 href=#__codelineno-88-34></a><span class=w>                        </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-88-35 name=__codelineno-88-35 href=#__codelineno-88-35></a><span class=w>                    </span><span class=p>})</span>
<a id=__codelineno-88-36 name=__codelineno-88-36 href=#__codelineno-88-36></a><span class=w>                    </span><span class=nx>c</span><span class=p>.</span><span class=nx>Abort</span><span class=p>()</span>
<a id=__codelineno-88-37 name=__codelineno-88-37 href=#__codelineno-88-37></a><span class=w>                    </span><span class=k>return</span>
<a id=__codelineno-88-38 name=__codelineno-88-38 href=#__codelineno-88-38></a><span class=w>                </span><span class=p>}</span>
<a id=__codelineno-88-39 name=__codelineno-88-39 href=#__codelineno-88-39></a><span class=w>                </span><span class=c1>//其他解析错误</span>
<a id=__codelineno-88-40 name=__codelineno-88-40 href=#__codelineno-88-40></a><span class=w>                </span><span class=nx>c</span><span class=p>.</span><span class=nx>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusBadRequest</span><span class=p>,</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
<a id=__codelineno-88-41 name=__codelineno-88-41 href=#__codelineno-88-41></a><span class=w>                    </span><span class=s>&quot;msg&quot;</span><span class=p>:</span><span class=w>  </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span>
<a id=__codelineno-88-42 name=__codelineno-88-42 href=#__codelineno-88-42></a><span class=w>                    </span><span class=s>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span>
<a id=__codelineno-88-43 name=__codelineno-88-43 href=#__codelineno-88-43></a><span class=w>                </span><span class=p>})</span>
<a id=__codelineno-88-44 name=__codelineno-88-44 href=#__codelineno-88-44></a><span class=w>                </span><span class=nx>c</span><span class=p>.</span><span class=nx>Abort</span><span class=p>()</span>
<a id=__codelineno-88-45 name=__codelineno-88-45 href=#__codelineno-88-45></a><span class=w>                </span><span class=k>return</span>
<a id=__codelineno-88-46 name=__codelineno-88-46 href=#__codelineno-88-46></a><span class=w>            </span><span class=p>}</span>
<a id=__codelineno-88-47 name=__codelineno-88-47 href=#__codelineno-88-47></a><span class=w>            </span><span class=c1>//继续交由下一个路由处理，并将解析出的信息传递下去</span>
<a id=__codelineno-88-48 name=__codelineno-88-48 href=#__codelineno-88-48></a><span class=w>            </span><span class=nx>c</span><span class=p>.</span><span class=nx>Set</span><span class=p>(</span><span class=s>&quot;claims&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>claims</span><span class=p>)</span>
<a id=__codelineno-88-49 name=__codelineno-88-49 href=#__codelineno-88-49></a><span class=w>            </span><span class=nx>c</span><span class=p>.</span><span class=nx>Next</span><span class=p>()</span>
<a id=__codelineno-88-50 name=__codelineno-88-50 href=#__codelineno-88-50></a><span class=w>        </span><span class=p>}</span>
<a id=__codelineno-88-51 name=__codelineno-88-51 href=#__codelineno-88-51></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-88-52 name=__codelineno-88-52 href=#__codelineno-88-52></a><span class=p>}</span>
</code></pre></div> <p><code>main.go</code></p> <div class=highlight><pre><span></span><code><a id=__codelineno-89-1 name=__codelineno-89-1 href=#__codelineno-89-1></a><span class=kn>package</span><span class=w> </span><span class=nx>main</span>
<a id=__codelineno-89-2 name=__codelineno-89-2 href=#__codelineno-89-2></a>
<a id=__codelineno-89-3 name=__codelineno-89-3 href=#__codelineno-89-3></a><span class=kn>import</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-89-4 name=__codelineno-89-4 href=#__codelineno-89-4></a><span class=w>    </span><span class=s>&quot;gitee.com/hujianli94net/k8s-platform/config&quot;</span>
<a id=__codelineno-89-5 name=__codelineno-89-5 href=#__codelineno-89-5></a><span class=w>    </span><span class=s>&quot;gitee.com/hujianli94net/k8s-platform/controller&quot;</span>
<a id=__codelineno-89-6 name=__codelineno-89-6 href=#__codelineno-89-6></a><span class=w>    </span><span class=s>&quot;gitee.com/hujianli94net/k8s-platform/db&quot;</span>
<a id=__codelineno-89-7 name=__codelineno-89-7 href=#__codelineno-89-7></a><span class=w>    </span><span class=s>&quot;gitee.com/hujianli94net/k8s-platform/middle&quot;</span>
<a id=__codelineno-89-8 name=__codelineno-89-8 href=#__codelineno-89-8></a><span class=w>    </span><span class=s>&quot;gitee.com/hujianli94net/k8s-platform/service&quot;</span>
<a id=__codelineno-89-9 name=__codelineno-89-9 href=#__codelineno-89-9></a>
<a id=__codelineno-89-10 name=__codelineno-89-10 href=#__codelineno-89-10></a><span class=w>    </span><span class=s>&quot;github.com/gin-gonic/gin&quot;</span>
<a id=__codelineno-89-11 name=__codelineno-89-11 href=#__codelineno-89-11></a><span class=p>)</span>
<a id=__codelineno-89-12 name=__codelineno-89-12 href=#__codelineno-89-12></a>
<a id=__codelineno-89-13 name=__codelineno-89-13 href=#__codelineno-89-13></a><span class=kd>func</span><span class=w> </span><span class=nx>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-89-14 name=__codelineno-89-14 href=#__codelineno-89-14></a><span class=w>    </span><span class=c1>//初始化k8s client</span>
<a id=__codelineno-89-15 name=__codelineno-89-15 href=#__codelineno-89-15></a><span class=w>    </span><span class=nx>service</span><span class=p>.</span><span class=nx>K8s</span><span class=p>.</span><span class=nx>Init</span><span class=p>()</span>
<a id=__codelineno-89-16 name=__codelineno-89-16 href=#__codelineno-89-16></a><span class=w>    </span><span class=c1>//初始化数据库</span>
<a id=__codelineno-89-17 name=__codelineno-89-17 href=#__codelineno-89-17></a><span class=w>    </span><span class=nx>db</span><span class=p>.</span><span class=nx>Init</span><span class=p>()</span>
<a id=__codelineno-89-18 name=__codelineno-89-18 href=#__codelineno-89-18></a><span class=w>    </span><span class=c1>//初始化gin对象</span>
<a id=__codelineno-89-19 name=__codelineno-89-19 href=#__codelineno-89-19></a><span class=w>    </span><span class=nx>r</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>gin</span><span class=p>.</span><span class=nx>Default</span><span class=p>()</span>
<a id=__codelineno-89-20 name=__codelineno-89-20 href=#__codelineno-89-20></a><span class=w>    </span><span class=c1>//初始化k8s client</span>
<a id=__codelineno-89-21 name=__codelineno-89-21 href=#__codelineno-89-21></a><span class=w>    </span><span class=nx>service</span><span class=p>.</span><span class=nx>K8s</span><span class=p>.</span><span class=nx>Init</span><span class=p>()</span>
<a id=__codelineno-89-22 name=__codelineno-89-22 href=#__codelineno-89-22></a><span class=w>    </span><span class=c1>//跨域配置</span>
<a id=__codelineno-89-23 name=__codelineno-89-23 href=#__codelineno-89-23></a><span class=w>    </span><span class=nx>r</span><span class=p>.</span><span class=nx>Use</span><span class=p>(</span><span class=nx>middle</span><span class=p>.</span><span class=nx>Cors</span><span class=p>())</span>
<a id=__codelineno-89-24 name=__codelineno-89-24 href=#__codelineno-89-24></a><span class=w>    </span><span class=c1>//jwt token验证</span>
<a id=__codelineno-89-25 name=__codelineno-89-25 href=#__codelineno-89-25></a><span class=w>    </span><span class=nx>r</span><span class=p>.</span><span class=nx>Use</span><span class=p>(</span><span class=nx>middle</span><span class=p>.</span><span class=nx>JWTAuth</span><span class=p>())</span>
<a id=__codelineno-89-26 name=__codelineno-89-26 href=#__codelineno-89-26></a><span class=w>    </span><span class=c1>//初始化路由规则</span>
<a id=__codelineno-89-27 name=__codelineno-89-27 href=#__codelineno-89-27></a><span class=w>    </span><span class=nx>controller</span><span class=p>.</span><span class=nx>Router</span><span class=p>.</span><span class=nx>InitApiRouter</span><span class=p>(</span><span class=nx>r</span><span class=p>)</span>
<a id=__codelineno-89-28 name=__codelineno-89-28 href=#__codelineno-89-28></a><span class=w>    </span><span class=c1>//gin程序启动</span>
<a id=__codelineno-89-29 name=__codelineno-89-29 href=#__codelineno-89-29></a><span class=w>    </span><span class=nx>r</span><span class=p>.</span><span class=nx>Run</span><span class=p>(</span><span class=nx>config</span><span class=p>.</span><span class=nx>ListenAddr</span><span class=p>)</span>
<a id=__codelineno-89-30 name=__codelineno-89-30 href=#__codelineno-89-30></a><span class=w>    </span><span class=c1>//关闭db连接</span>
<a id=__codelineno-89-31 name=__codelineno-89-31 href=#__codelineno-89-31></a><span class=w>    </span><span class=nx>db</span><span class=p>.</span><span class=nx>Close</span><span class=p>()</span>
<a id=__codelineno-89-32 name=__codelineno-89-32 href=#__codelineno-89-32></a><span class=p>}</span>
</code></pre></div> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title=最后更新> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1-2.1-2M12.5 7v5.2l4 2.4-1 1L11 13V7h1.5M11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2v1.8Z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime">December 12, 2023 17:40:44</span> </span> <span class=md-source-file__fact> <span class=md-icon title=创建日期> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3h-2Z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime">October 24, 2023 16:47:51</span> </span> </aside> <form class=md-feedback name=feedback hidden> <fieldset> <legend class=md-feedback__title> Was this page helpful? </legend> <div class=md-feedback__inner> <div class=md-feedback__list> <button class="md-feedback__icon md-icon" type=submit title="This page was helpful" data-md-value=1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m7 0c0 .8-.7 1.5-1.5 1.5S14 10.3 14 9.5 14.7 8 15.5 8s1.5.7 1.5 1.5m-5 7.73c-1.75 0-3.29-.73-4.19-1.81L9.23 14c.45.72 1.52 1.23 2.77 1.23s2.32-.51 2.77-1.23l1.42 1.42c-.9 1.08-2.44 1.81-4.19 1.81Z"/></svg> </button> <button class="md-feedback__icon md-icon" type=submit title="This page could be improved" data-md-value=0> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10m-6.5-4c.8 0 1.5.7 1.5 1.5s-.7 1.5-1.5 1.5-1.5-.7-1.5-1.5.7-1.5 1.5-1.5M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m2 4.5c1.75 0 3.29.72 4.19 1.81l-1.42 1.42C14.32 16.5 13.25 16 12 16s-2.32.5-2.77 1.23l-1.42-1.42C8.71 14.72 10.25 14 12 14Z"/></svg> </button> </div> <div class=md-feedback__note> <div data-md-value=1 hidden> Thanks for your feedback! </div> <div data-md-value=0 hidden> Thanks for your feedback! Help us improve this page by using our <a href="https://github.com/hujianli94/hujianli94.github.io/issues/new/?title=[Feedback]+K8s%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-%E5%90%8E%E7%AB%AFAPI%E5%BC%80%E5%8F%91+-+/Golang/13.K8s%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/1.K8s%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-%E5%90%8E%E7%AB%AFAPI%E5%BC%80%E5%8F%91/" target=_blank>feedback form</a>. </div> </div> </div> </fieldset> </form> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> 回到页面顶部 </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=页脚> <a href=../../12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/12.Element-Plus/ class="md-footer__link md-footer__link--prev" aria-label="上一页: 12.Element Plus"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> 上一页 </span> <div class=md-ellipsis> 12.Element Plus </div> </div> </a> <a href=../2.K8s%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/ class="md-footer__link md-footer__link--next" aria-label="下一页: K8s管理系统-前端开发"> <div class=md-footer__title> <span class=md-footer__direction> 下一页 </span> <div class=md-ellipsis> K8s管理系统-前端开发 </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2023 - 2024 hujainli94 </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/hujianli94 target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> <a href=https://kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com/blog_img/20220125122524.png target=_blank rel=noopener title=kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 576 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M385.2 167.6c6.4 0 12.6.3 18.8 1.1C387.4 90.3 303.3 32 207.7 32 100.5 32 13 104.8 13 197.4c0 53.4 29.3 97.5 77.9 131.6l-19.3 58.6 68-34.1c24.4 4.8 43.8 9.7 68.2 9.7 6.2 0 12.1-.3 18.3-.8-4-12.9-6.2-26.6-6.2-40.8-.1-84.9 72.9-154 165.3-154zm-104.5-52.9c14.5 0 24.2 9.7 24.2 24.4 0 14.5-9.7 24.2-24.2 24.2-14.8 0-29.3-9.7-29.3-24.2.1-14.7 14.6-24.4 29.3-24.4zm-136.4 48.6c-14.5 0-29.3-9.7-29.3-24.2 0-14.8 14.8-24.4 29.3-24.4 14.8 0 24.4 9.7 24.4 24.4 0 14.6-9.6 24.2-24.4 24.2zM563 319.4c0-77.9-77.9-141.3-165.4-141.3-92.7 0-165.4 63.4-165.4 141.3S305 460.7 397.6 460.7c19.3 0 38.9-5.1 58.6-9.9l53.4 29.3-14.8-48.6C534 402.1 563 363.2 563 319.4zm-219.1-24.5c-9.7 0-19.3-9.7-19.3-19.6 0-9.7 9.7-19.3 19.3-19.3 14.8 0 24.4 9.7 24.4 19.3 0 10-9.7 19.6-24.4 19.6zm107.1 0c-9.7 0-19.3-9.7-19.3-19.6 0-9.7 9.7-19.3 19.3-19.3 14.5 0 24.4 9.7 24.4 19.3.1 10-9.9 19.6-24.4 19.6z"/></svg> </a> <a href="mailto:<1879324764@qq.com>" target=_blank rel=noopener title=发送邮件 class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M498.1 5.6c10.1 7 15.4 19.1 13.5 31.2l-64 416c-1.5 9.7-7.4 18.2-16 23s-18.9 5.4-28 1.6L284 427.7l-68.5 74.1c-8.9 9.7-22.9 12.9-35.2 8.1S160 493.2 160 480v-83.6c0-4 1.5-7.8 4.2-10.7l167.6-182.9c5.8-6.3 5.6-16-.4-22s-15.7-6.4-22-.7L106 360.8l-88.3-44.2C7.1 311.3.3 300.7 0 288.9s5.9-22.8 16.1-28.7l448-256c10.7-6.1 23.9-5.5 34 1.4z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-consent data-md-component=consent id=__consent hidden> <div class=md-consent__overlay></div> <aside class=md-consent__inner> <form class="md-consent__form md-grid md-typeset" name=consent> <h4>Cookie consent</h4> <p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p> <input class=md-toggle type=checkbox id=__settings> <div class=md-consent__settings> <ul class=task-list> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=analytics checked> <span class=task-list-indicator></span> Google Analytics </label> </li> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=github checked> <span class=task-list-indicator></span> GitHub </label> </li> </ul> </div> <div class=md-consent__controls> <button class="md-button md-button--primary">同意</button> <label class=md-button for=__settings>管理设定</label> </div> </form> </aside> </div> <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout(function(){document.querySelector("[data-md-component=consent]").hidden=!1},250);var action,form=document.forms.consent;for(action of["submit","reset"])form.addEventListener(action,function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map(function(e){return[e,!0]}))),location.hash="",location.reload()})</script> <script id=__config type=application/json>{"base": "../../..", "features": ["content.action.edit", "content.action.view", "content.code.copy", "content.code.annotate", "navigation.indexes", "navigation.footer", "navigation.indexes", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest"], "search": "../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script> <script src=../../../assets/javascripts/bundle.c8d2eff1.min.js></script> <script src=../../../javascripts/extra.js></script> <script src=https://file.cdn.shafish.cn/blog/js/video.min.js></script> </body> </html>