<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="stay hungry,stay foolish"><meta name=author content=hujainli94><link href=https://hujianli94.github.io/Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/15.Kubernetes%E7%9B%91%E6%8E%A7%E5%91%8A%E8%AD%A6/ rel=canonical><link href=../14.Kubernetes%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/ rel=prev><link href=../16.%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83Ingress%E8%BF%9B%E9%98%B6/ rel=next><link rel=icon href=../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.5.3, mkdocs-material-9.5.4"><title>Kubernetes监控告警 - DevOps运维开发</title><link rel=stylesheet href=../../../assets/stylesheets/main.50c56a3b.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.06af60db.min.css><style>:root{--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M1 7.775V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 0 1 0 2.474l-5.026 5.026a1.75 1.75 0 0 1-2.474 0l-6.25-6.25A1.752 1.752 0 0 1 1 7.775Zm1.5 0c0 .066.026.13.073.177l6.25 6.25a.25.25 0 0 0 .354 0l5.025-5.025a.25.25 0 0 0 0-.354l-6.25-6.25a.25.25 0 0 0-.177-.073H2.75a.25.25 0 0 0-.25.25ZM6 5a1 1 0 1 1 0 2 1 1 0 0 1 0-2Z"/></svg>');--md-admonition-icon--abstract:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M2.5 1.75v11.5c0 .138.112.25.25.25h3.17a.75.75 0 0 1 0 1.5H2.75A1.75 1.75 0 0 1 1 13.25V1.75C1 .784 1.784 0 2.75 0h8.5C12.216 0 13 .784 13 1.75v7.736a.75.75 0 0 1-1.5 0V1.75a.25.25 0 0 0-.25-.25h-8.5a.25.25 0 0 0-.25.25Zm13.274 9.537v-.001l-4.557 4.45a.75.75 0 0 1-1.055-.008l-1.943-1.95a.75.75 0 0 1 1.062-1.058l1.419 1.425 4.026-3.932a.75.75 0 1 1 1.048 1.074ZM4.75 4h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM4 7.75A.75.75 0 0 1 4.75 7h2a.75.75 0 0 1 0 1.5h-2A.75.75 0 0 1 4 7.75Z"/></svg>');--md-admonition-icon--info:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"/></svg>');--md-admonition-icon--tip:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M3.499.75a.75.75 0 0 1 1.5 0v.996C5.9 2.903 6.793 3.65 7.662 4.376l.24.202c-.036-.694.055-1.422.426-2.163C9.1.873 10.794-.045 12.622.26 14.408.558 16 1.94 16 4.25c0 1.278-.954 2.575-2.44 2.734l.146.508.065.22c.203.701.412 1.455.476 2.226.142 1.707-.4 3.03-1.487 3.898C11.714 14.671 10.27 15 8.75 15h-6a.75.75 0 0 1 0-1.5h1.376a4.484 4.484 0 0 1-.563-1.191 3.835 3.835 0 0 1-.05-2.063 4.647 4.647 0 0 1-2.025-.293.75.75 0 0 1 .525-1.406c1.357.507 2.376-.006 2.698-.318l.009-.01a.747.747 0 0 1 1.06 0 .748.748 0 0 1-.012 1.074c-.912.92-.992 1.835-.768 2.586.221.74.745 1.337 1.196 1.621H8.75c1.343 0 2.398-.296 3.074-.836.635-.507 1.036-1.31.928-2.602-.05-.603-.216-1.224-.422-1.93l-.064-.221c-.12-.407-.246-.84-.353-1.29a2.425 2.425 0 0 1-.507-.441 3.075 3.075 0 0 1-.633-1.248.75.75 0 0 1 1.455-.364c.046.185.144.436.31.627.146.168.353.305.712.305.738 0 1.25-.615 1.25-1.25 0-1.47-.95-2.315-2.123-2.51-1.172-.196-2.227.387-2.706 1.345-.46.92-.27 1.774.019 3.062l.042.19a.884.884 0 0 1 .01.05c.348.443.666.949.94 1.553a.75.75 0 1 1-1.365.62c-.553-1.217-1.32-1.94-2.3-2.768L6.7 5.527c-.814-.68-1.75-1.462-2.692-2.619a3.737 3.737 0 0 0-1.023.88c-.406.495-.663 1.036-.722 1.508.116.122.306.21.591.239.388.038.797-.06 1.032-.19a.75.75 0 0 1 .728 1.31c-.515.287-1.23.439-1.906.373-.682-.067-1.473-.38-1.879-1.193L.75 5.677V5.5c0-.984.48-1.94 1.077-2.664.46-.559 1.05-1.055 1.673-1.353V.75Z"/></svg>');--md-admonition-icon--success:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"/></svg>');--md-admonition-icon--question:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.92 6.085h.001a.749.749 0 1 1-1.342-.67c.169-.339.436-.701.849-.977C6.845 4.16 7.369 4 8 4a2.756 2.756 0 0 1 1.637.525c.503.377.863.965.863 1.725 0 .448-.115.83-.329 1.15-.205.307-.47.513-.692.662-.109.072-.22.138-.313.195l-.006.004a6.24 6.24 0 0 0-.26.16.952.952 0 0 0-.276.245.75.75 0 0 1-1.248-.832c.184-.264.42-.489.692-.661.103-.067.207-.132.313-.195l.007-.004c.1-.061.182-.11.258-.161a.969.969 0 0 0 .277-.245C8.96 6.514 9 6.427 9 6.25a.612.612 0 0 0-.262-.525A1.27 1.27 0 0 0 8 5.5c-.369 0-.595.09-.74.187a1.01 1.01 0 0 0-.34.398ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"/></svg>');--md-admonition-icon--warning:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"/></svg>');--md-admonition-icon--failure:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M2.344 2.343h-.001a8 8 0 0 1 11.314 11.314A8.002 8.002 0 0 1 .234 10.089a8 8 0 0 1 2.11-7.746Zm1.06 10.253a6.5 6.5 0 1 0 9.108-9.275 6.5 6.5 0 0 0-9.108 9.275ZM6.03 4.97 8 6.94l1.97-1.97a.749.749 0 0 1 1.275.326.749.749 0 0 1-.215.734L9.06 8l1.97 1.97a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215L8 9.06l-1.97 1.97a.749.749 0 0 1-1.275-.326.749.749 0 0 1 .215-.734L6.94 8 4.97 6.03a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018Z"/></svg>');--md-admonition-icon--danger:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M9.504.43a1.516 1.516 0 0 1 2.437 1.713L10.415 5.5h2.123c1.57 0 2.346 1.909 1.22 3.004l-7.34 7.142a1.249 1.249 0 0 1-.871.354h-.302a1.25 1.25 0 0 1-1.157-1.723L5.633 10.5H3.462c-1.57 0-2.346-1.909-1.22-3.004L9.503.429Zm1.047 1.074L3.286 8.571A.25.25 0 0 0 3.462 9H6.75a.75.75 0 0 1 .694 1.034l-1.713 4.188 6.982-6.793A.25.25 0 0 0 12.538 7H9.25a.75.75 0 0 1-.683-1.06l2.008-4.418.003-.006a.036.036 0 0 0-.004-.009l-.006-.006-.008-.001c-.003 0-.006.002-.009.004Z"/></svg>');--md-admonition-icon--bug:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M4.72.22a.75.75 0 0 1 1.06 0l1 .999a3.488 3.488 0 0 1 2.441 0l.999-1a.748.748 0 0 1 1.265.332.75.75 0 0 1-.205.729l-.775.776c.616.63.995 1.493.995 2.444v.327c0 .1-.009.197-.025.292.408.14.764.392 1.029.722l1.968-.787a.75.75 0 0 1 .556 1.392L13 7.258V9h2.25a.75.75 0 0 1 0 1.5H13v.5c0 .409-.049.806-.141 1.186l2.17.868a.75.75 0 0 1-.557 1.392l-2.184-.873A4.997 4.997 0 0 1 8 16a4.997 4.997 0 0 1-4.288-2.427l-2.183.873a.75.75 0 0 1-.558-1.392l2.17-.868A5.036 5.036 0 0 1 3 11v-.5H.75a.75.75 0 0 1 0-1.5H3V7.258L.971 6.446a.75.75 0 0 1 .558-1.392l1.967.787c.265-.33.62-.583 1.03-.722a1.677 1.677 0 0 1-.026-.292V4.5c0-.951.38-1.814.995-2.444L4.72 1.28a.75.75 0 0 1 0-1.06Zm.53 6.28a.75.75 0 0 0-.75.75V11a3.5 3.5 0 1 0 7 0V7.25a.75.75 0 0 0-.75-.75ZM6.173 5h3.654A.172.172 0 0 0 10 4.827V4.5a2 2 0 1 0-4 0v.327c0 .096.077.173.173.173Z"/></svg>');--md-admonition-icon--example:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M5 5.782V2.5h-.25a.75.75 0 0 1 0-1.5h6.5a.75.75 0 0 1 0 1.5H11v3.282l3.666 5.76C15.619 13.04 14.543 15 12.767 15H3.233c-1.776 0-2.852-1.96-1.899-3.458Zm-2.4 6.565a.75.75 0 0 0 .633 1.153h9.534a.75.75 0 0 0 .633-1.153L12.225 10.5h-8.45ZM9.5 2.5h-3V6c0 .143-.04.283-.117.403L4.73 9h6.54L9.617 6.403A.746.746 0 0 1 9.5 6Z"/></svg>');--md-admonition-icon--quote:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M1.75 2.5h10.5a.75.75 0 0 1 0 1.5H1.75a.75.75 0 0 1 0-1.5Zm4 5h8.5a.75.75 0 0 1 0 1.5h-8.5a.75.75 0 0 1 0-1.5Zm0 5h8.5a.75.75 0 0 1 0 1.5h-8.5a.75.75 0 0 1 0-1.5ZM2.5 7.75v6a.75.75 0 0 1-1.5 0v-6a.75.75 0 0 1 1.5 0Z"/></svg>');}</style><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../stylesheets/extra.css><link rel=stylesheet href=https://file.cdn.shafish.cn/blog/css/vssue.css><link rel=stylesheet href=https://file.cdn.shafish.cn/blog/css/video-js.min.css><link rel=stylesheet href=https://file.cdn.shafish.cn/blog/css/video.css><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","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"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","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",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=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",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script><script>var consent;"undefined"==typeof __md_analytics||(consent=__md_get("__consent"))&&consent.analytics&&__md_analytics()</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#kubernetes监控告警 class=md-skip> 跳转至 </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=页眉> <a href=../../.. title=DevOps运维开发 class="md-header__button md-logo" aria-label=DevOps运维开发 data-md-component=logo> <img src=../../../assets/images/logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> DevOps运维开发 </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Kubernetes监控告警 </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label=切换至深色模式 type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title=切换至深色模式 for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=blue data-md-color-accent=blue aria-label=切换至浅色模式 type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title=切换至浅色模式 for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg> </label> </form> <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=查找> <a href=javascript:void(0) class="md-search__icon md-icon" title=分享 aria-label=分享 data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=清空当前内容 aria-label=清空当前内容 tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> 正在初始化搜索引擎 </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/hujianli94/hujianli94.github.io title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> hujianli94.github.io </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=标签 data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> 首页 </a> </li> <li class=md-tabs__item> <a href=../../../k8s/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.k8s/ class=md-tabs__link> k8s </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../../0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Kubernetes/ class=md-tabs__link> Kubernetes </a> </li> <li class=md-tabs__item> <a href=../../../Docker/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Docker/ class=md-tabs__link> Docker </a> </li> <li class=md-tabs__item> <a href=../../../Golang/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Go-Web%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98/ class=md-tabs__link> Golang </a> </li> <li class=md-tabs__item> <a href=../../../Python/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Pythjon-auto-ops/ class=md-tabs__link> Python </a> </li> <li class=md-tabs__item> <a href=../../../Python-vs-Go/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Python-vs-Go/ class=md-tabs__link> Python-vs-Go </a> </li> <li class=md-tabs__item> <a href=../../../Linux/Shell/Shell%E7%AE%80%E4%BB%8B/ class=md-tabs__link> Linux </a> </li> <li class=md-tabs__item> <a href=../../../Other/tools/1.PicGo%E5%9B%BE%E5%BA%8A/ class=md-tabs__link> Other </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=导航栏 data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title=DevOps运维开发 class="md-nav__button md-logo" aria-label=DevOps运维开发 data-md-component=logo> <img src=../../../assets/images/logo.png alt=logo> </a> DevOps运维开发 </label> <div class=md-nav__source> <a href=https://github.com/hujianli94/hujianli94.github.io title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> hujianli94.github.io </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> <span class=md-ellipsis> 首页 </span> </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex> <span class=md-ellipsis> k8s </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> k8s </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_1> <label class=md-nav__link for=__nav_2_1 id=__nav_2_1_label tabindex=0> <span class=md-ellipsis> 0.学习线路 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_1_label aria-expanded=false> <label class=md-nav__title for=__nav_2_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.k8s/ class=md-nav__link> <span class=md-ellipsis> Kubernetes从入门到实践 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2> <label class=md-nav__link for=__nav_2_2 id=__nav_2_2_label tabindex=0> <span class=md-ellipsis> 1.容器的发展史 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2> <span class="md-nav__icon md-icon"></span> 1.容器的发展史 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/1.%E5%AE%B9%E5%99%A8%E7%9A%84%E5%8F%91%E5%B1%95%E5%8F%B2/1.1%E5%BC%80%E5%8F%91%E8%BF%87%E7%A8%8B%E7%9A%84%E5%8F%91%E5%B1%95/ class=md-nav__link> <span class=md-ellipsis> 1.1开发过程的发展 </span> </a> </li> <li class=md-nav__item> <a href=../../../k8s/1.%E5%AE%B9%E5%99%A8%E7%9A%84%E5%8F%91%E5%B1%95%E5%8F%B2/1.2%E5%BA%94%E7%94%A8%E6%9E%B6%E6%9E%84%E7%9A%84%E5%8F%91%E5%B1%95/ class=md-nav__link> <span class=md-ellipsis> 1.2应用架构的发展 </span> </a> </li> <li class=md-nav__item> <a href=../../../k8s/1.%E5%AE%B9%E5%99%A8%E7%9A%84%E5%8F%91%E5%B1%95%E5%8F%B2/1.3%E9%83%A8%E7%BD%B2%E6%89%93%E5%8C%85%E7%9A%84%E5%8F%91%E5%B1%95/ class=md-nav__link> <span class=md-ellipsis> 1.3部署打包的发展 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_3> <label class=md-nav__link for=__nav_2_3 id=__nav_2_3_label tabindex=0> <span class=md-ellipsis> 2.Kubernetes的核心概念 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_3_label aria-expanded=false> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> 2.Kubernetes的核心概念 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/2.Kubernetes%E7%9A%84%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/2.1Kubernetes%E7%9A%84%E8%AE%BE%E8%AE%A1%E6%9E%B6%E6%9E%84/ class=md-nav__link> <span class=md-ellipsis> 2.1Kubernetes的设计架构 </span> </a> </li> <li class=md-nav__item> <a href=../../../k8s/2.Kubernetes%E7%9A%84%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/2.2Kubernetes%E7%9A%84%E6%A0%B8%E5%BF%83%E5%AF%B9%E8%B1%A1/ class=md-nav__link> <span class=md-ellipsis> 2.2Kubernetes的核心对象 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_4> <label class=md-nav__link for=__nav_2_4 id=__nav_2_4_label tabindex=0> <span class=md-ellipsis> 3.Kubernetes的安装和部署 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_4_label aria-expanded=false> <label class=md-nav__title for=__nav_2_4> <span class="md-nav__icon md-icon"></span> 3.Kubernetes的安装和部署 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/3.Kubernetes%E7%9A%84%E5%AE%89%E8%A3%85%E5%92%8C%E9%83%A8%E7%BD%B2/3.1kubeadm%E6%90%AD%E5%BB%BA%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/ class=md-nav__link> <span class=md-ellipsis> 3.1kubeadm搭建开发环境 </span> </a> </li> <li class=md-nav__item> <a href=../../../k8s/3.Kubernetes%E7%9A%84%E5%AE%89%E8%A3%85%E5%92%8C%E9%83%A8%E7%BD%B2/3.2kubeadm%E6%90%AD%E5%BB%BA%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83/ class=md-nav__link> <span class=md-ellipsis> 3.2kubeadm搭建生产环境 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_5> <label class=md-nav__link for=__nav_2_5 id=__nav_2_5_label tabindex=0> <span class=md-ellipsis> 4.Pod </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_5_label aria-expanded=false> <label class=md-nav__title for=__nav_2_5> <span class="md-nav__icon md-icon"></span> 4.Pod </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/4.Pod/4.1Pod%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/ class=md-nav__link> <span class=md-ellipsis> 4.1Pod的基本操作 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_6> <label class=md-nav__link for=__nav_2_6 id=__nav_2_6_label tabindex=0> <span class=md-ellipsis> 5.控制器 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_6_label aria-expanded=false> <label class=md-nav__title for=__nav_2_6> <span class="md-nav__icon md-icon"></span> 5.控制器 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/5.%E6%8E%A7%E5%88%B6%E5%99%A8/5.1Deployment/ class=md-nav__link> <span class=md-ellipsis> 5.1Deployment </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex> <span class=md-ellipsis> Kubernetes </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=true> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1> <label class=md-nav__link for=__nav_3_1 id=__nav_3_1_label tabindex=0> <span class=md-ellipsis> 0.学习线路 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_1_label aria-expanded=false> <label class=md-nav__title for=__nav_3_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Kubernetes/ class=md-nav__link> <span class=md-ellipsis> Kubernetes </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2> <label class=md-nav__link for=__nav_3_2 id=__nav_3_2_label tabindex=0> <span class=md-ellipsis> 1.安装篇 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> 1.安装篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../1.%E5%AE%89%E8%A3%85%E7%AF%87/1.Kubeadm%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/ class=md-nav__link> <span class=md-ellipsis> Kubeadm安装高可用集群 </span> </a> </li> <li class=md-nav__item> <a href=../../1.%E5%AE%89%E8%A3%85%E7%AF%87/2.%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/ class=md-nav__link> <span class=md-ellipsis> 二进制安装高可用K8s集群 </span> </a> </li> <li class=md-nav__item> <a href=../../1.%E5%AE%89%E8%A3%85%E7%AF%87/3.%E5%AE%89%E8%A3%85%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/ class=md-nav__link> <span class=md-ellipsis> 安装常用工具 </span> </a> </li> <li class=md-nav__item> <a href=../../1.%E5%AE%89%E8%A3%85%E7%AF%87/4.Kubeadm%E5%AE%89%E8%A3%85%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/ class=md-nav__link> <span class=md-ellipsis> Kubeadm安装开发环境 </span> </a> </li> <li class=md-nav__item> <a href=../../1.%E5%AE%89%E8%A3%85%E7%AF%87/5.K3s%E5%92%8CMinikube/ class=md-nav__link> <span class=md-ellipsis> K3s和Minikube </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_3> <label class=md-nav__link for=__nav_3_3 id=__nav_3_3_label tabindex=0> <span class=md-ellipsis> 2.基础篇 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> 2.基础篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../2.%E5%9F%BA%E7%A1%80%E7%AF%87/3.Docker%E5%9F%BA%E7%A1%80/ class=md-nav__link> <span class=md-ellipsis> Docker基础 </span> </a> </li> <li class=md-nav__item> <a href=../../2.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Kubernetes%E7%9A%84%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/ class=md-nav__link> <span class=md-ellipsis> Kubernetes的基础概念 </span> </a> </li> <li class=md-nav__item> <a href=../../2.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Kubernetes%E8%B0%83%E5%BA%A6%E5%9F%BA%E7%A1%80/ class=md-nav__link> <span class=md-ellipsis> Kubernetes调度基础 </span> </a> </li> <li class=md-nav__item> <a href=../../2.%E5%9F%BA%E7%A1%80%E7%AF%87/6.Kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83%E5%9F%BA%E7%A1%80/ class=md-nav__link> <span class=md-ellipsis> Kubernetes服务发布基础 </span> </a> </li> <li class=md-nav__item> <a href=../../2.%E5%9F%BA%E7%A1%80%E7%AF%87/7.Kubernetes%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> Kubernetes配置管理 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_4> <label class=md-nav__link for=__nav_3_4 id=__nav_3_4_label tabindex=0> <span class=md-ellipsis> 3.进阶篇 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_4_label aria-expanded=false> <label class=md-nav__title for=__nav_3_4> <span class="md-nav__icon md-icon"></span> 3.进阶篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../3.%E8%BF%9B%E9%98%B6%E7%AF%87/8.Kubernetes%E5%AD%98%E5%82%A8%E5%85%A5%E9%97%A8/ class=md-nav__link> <span class=md-ellipsis> Kubernetes存储入门 </span> </a> </li> <li class=md-nav__item> <a href=../../3.%E8%BF%9B%E9%98%B6%E7%AF%87/9.Kubernetes%E9%AB%98%E7%BA%A7%E8%B0%83%E5%BA%A6/ class=md-nav__link> <span class=md-ellipsis> Kubernetes高级调度 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_5> <label class=md-nav__link for=__nav_3_5 id=__nav_3_5_label tabindex=0> <span class=md-ellipsis> 4.高级篇 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_5_label aria-expanded=false> <label class=md-nav__title for=__nav_3_5> <span class="md-nav__icon md-icon"></span> 4.高级篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../4.%E9%AB%98%E7%BA%A7%E7%AF%87/12.%E4%BA%91%E5%8E%9F%E7%94%9F%E5%AD%98%E5%82%A8Rook/ class=md-nav__link> <span class=md-ellipsis> 云原生存储Rook </span> </a> </li> <li class=md-nav__item> <a href=../../4.%E9%AB%98%E7%BA%A7%E7%AF%87/13.%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%AE%B9%E5%99%A8%E5%8C%96/ class=md-nav__link> <span class=md-ellipsis> 中间件容器化 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_6 checked> <label class=md-nav__link for=__nav_3_6 id=__nav_3_6_label tabindex=0> <span class=md-ellipsis> 5.运维篇 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_6_label aria-expanded=true> <label class=md-nav__title for=__nav_3_6> <span class="md-nav__icon md-icon"></span> 5.运维篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../14.Kubernetes%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/ class=md-nav__link> <span class=md-ellipsis> Kubernetes日志收集 </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Kubernetes监控告警 </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Kubernetes监控告警 </span> </a> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#1prometheus的架构介绍 class=md-nav__link> <span class=md-ellipsis> 1.Prometheus的架构介绍 </span> </a> </li> <li class=md-nav__item> <a href=#2prometheus的安装 class=md-nav__link> <span class=md-ellipsis> 2.Prometheus的安装 </span> </a> </li> <li class=md-nav__item> <a href=#3云原生和非云原生应用的监控流程 class=md-nav__link> <span class=md-ellipsis> 3.云原生和非云原生应用的监控流程 </span> </a> <nav class=md-nav aria-label=3.云原生和非云原生应用的监控流程> <ul class=md-nav__list> <li class=md-nav__item> <a href=#31-监控数据来源 class=md-nav__link> <span class=md-ellipsis> 3.1 监控数据来源 </span> </a> </li> <li class=md-nav__item> <a href=#32-什么是servicemonitor class=md-nav__link> <span class=md-ellipsis> 3.2 什么是ServiceMonitor </span> </a> </li> <li class=md-nav__item> <a href=#33-servicemonitor找不到监控主机排查 class=md-nav__link> <span class=md-ellipsis> 3.3 ServiceMonitor找不到监控主机排查 </span> </a> </li> <li class=md-nav__item> <a href=#34-云原生应用监控 class=md-nav__link> <span class=md-ellipsis> 3.4 云原生应用监控 </span> </a> </li> <li class=md-nav__item> <a href=#35-非云原生监控exporter class=md-nav__link> <span class=md-ellipsis> 3.5 非云原生监控Exporter </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#4黑盒监控 class=md-nav__link> <span class=md-ellipsis> 4.黑盒监控 </span> </a> </li> <li class=md-nav__item> <a href=#5prometheus静态配置 class=md-nav__link> <span class=md-ellipsis> 5.Prometheus静态配置 </span> </a> </li> <li class=md-nav__item> <a href=#6prometheus监控windows外部主机 class=md-nav__link> <span class=md-ellipsis> 6.Prometheus监控Windows(外部)主机 </span> </a> </li> <li class=md-nav__item> <a href=#7prometheus语法promql入门 class=md-nav__link> <span class=md-ellipsis> 7.Prometheus语法PromQL入门 </span> </a> <nav class=md-nav aria-label=7.Prometheus语法PromQL入门> <ul class=md-nav__list> <li class=md-nav__item> <a href=#71-promql语法初体验 class=md-nav__link> <span class=md-ellipsis> 7.1 PromQL语法初体验 </span> </a> </li> <li class=md-nav__item> <a href=#72-promql操作符 class=md-nav__link> <span class=md-ellipsis> 7.2 PromQL操作符 </span> </a> </li> <li class=md-nav__item> <a href=#73-promql常用函数 class=md-nav__link> <span class=md-ellipsis> 7.3 PromQL常用函数 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#8alertmanager告警入门 class=md-nav__link> <span class=md-ellipsis> 8.Alertmanager告警入门 </span> </a> <nav class=md-nav aria-label=8.Alertmanager告警入门> <ul class=md-nav__list> <li class=md-nav__item> <a href=#81-alertmanager配置文件解析 class=md-nav__link> <span class=md-ellipsis> 8.1 Alertmanager配置文件解析 </span> </a> </li> <li class=md-nav__item> <a href=#82-alertmanager路由规则 class=md-nav__link> <span class=md-ellipsis> 8.2 Alertmanager路由规则 </span> </a> </li> <li class=md-nav__item> <a href=#83-alertmanager邮件通知 class=md-nav__link> <span class=md-ellipsis> 8.3 Alertmanager邮件通知 </span> </a> </li> <li class=md-nav__item> <a href=#84-alertmanager企业微信通知 class=md-nav__link> <span class=md-ellipsis> 8.4 Alertmanager企业微信通知 </span> </a> </li> <li class=md-nav__item> <a href=#85-自定义告警模板 class=md-nav__link> <span class=md-ellipsis> 8.5 自定义告警模板 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#9prometheus告警实战 class=md-nav__link> <span class=md-ellipsis> 9.Prometheus告警实战 </span> </a> <nav class=md-nav aria-label=9.Prometheus告警实战> <ul class=md-nav__list> <li class=md-nav__item> <a href=#91-prometheusrule class=md-nav__link> <span class=md-ellipsis> 9.1 PrometheusRule </span> </a> </li> <li class=md-nav__item> <a href=#92-告警通用配置步骤 class=md-nav__link> <span class=md-ellipsis> 9.2 告警通用配置步骤 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../16.%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83Ingress%E8%BF%9B%E9%98%B6/ class=md-nav__link> <span class=md-ellipsis> 服务发布Ingress进阶 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_7> <label class=md-nav__link for=__nav_3_7 id=__nav_3_7_label tabindex=0> <span class=md-ellipsis> 6.DevOps篇 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_7_label aria-expanded=false> <label class=md-nav__title for=__nav_3_7> <span class="md-nav__icon md-icon"></span> 6.DevOps篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/ class=md-nav__link> <span class=md-ellipsis> DevOps实践 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex> <span class=md-ellipsis> Docker </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Docker </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_1> <label class=md-nav__link for=__nav_4_1 id=__nav_4_1_label tabindex=0> <span class=md-ellipsis> 0.学习线路 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_1_label aria-expanded=false> <label class=md-nav__title for=__nav_4_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Docker/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Docker/ class=md-nav__link> <span class=md-ellipsis> Docker </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_2> <label class=md-nav__link for=__nav_4_2 id=__nav_4_2_label tabindex=0> <span class=md-ellipsis> 1.基础 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_2_label aria-expanded=false> <label class=md-nav__title for=__nav_4_2> <span class="md-nav__icon md-icon"></span> 1.基础 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Docker/1.%E5%9F%BA%E7%A1%80/1.%E5%AE%89%E8%A3%85Docker/ class=md-nav__link> <span class=md-ellipsis> 1.安装Docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.%E5%9F%BA%E7%A1%80/2.Docker%E9%95%9C%E5%83%8F/ class=md-nav__link> <span class=md-ellipsis> 2.Docker镜像 </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.%E5%9F%BA%E7%A1%80/3.Docker%E5%AE%B9%E5%99%A8/ class=md-nav__link> <span class=md-ellipsis> 3.Docker容器 </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.%E5%9F%BA%E7%A1%80/4.%E4%BC%81%E4%B8%9A%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93harbor/ class=md-nav__link> <span class=md-ellipsis> 4.企业私有仓库harbor </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.%E5%9F%BA%E7%A1%80/5.Docker%E6%95%B0%E6%8D%AE/ class=md-nav__link> <span class=md-ellipsis> 5.Docker数据 </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.%E5%9F%BA%E7%A1%80/6.Docker%E7%BD%91%E7%BB%9C/ class=md-nav__link> <span class=md-ellipsis> 6.Docker网络 </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.%E5%9F%BA%E7%A1%80/7.Dockerfile/ class=md-nav__link> <span class=md-ellipsis> 7.Dockerfile </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.%E5%9F%BA%E7%A1%80/8.docker-compose/ class=md-nav__link> <span class=md-ellipsis> 8.docker-compose </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.%E5%9F%BA%E7%A1%80/9.Docker%E7%9B%B8%E5%85%B3%E8%84%9A%E6%9C%AC/ class=md-nav__link> <span class=md-ellipsis> 9.Docker相关脚本 </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.%E5%9F%BA%E7%A1%80/10.Docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/ class=md-nav__link> <span class=md-ellipsis> 10.Docker常用命令 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_3> <label class=md-nav__link for=__nav_4_3 id=__nav_4_3_label tabindex=0> <span class=md-ellipsis> 2.实战案例 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_3_label aria-expanded=false> <label class=md-nav__title for=__nav_4_3> <span class="md-nav__icon md-icon"></span> 2.实战案例 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/1.%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/ class=md-nav__link> <span class=md-ellipsis> 1.操作系统 </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/2.Web%E6%9C%8D%E5%8A%A1%E4%B8%8E%E5%BA%94%E7%94%A8/ class=md-nav__link> <span class=md-ellipsis> 2.Web服务与应用 </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/3.%E6%8C%81%E7%BB%AD%E5%BC%80%E5%8F%91%E4%B8%8E%E7%AE%A1%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 3.持续开发与管理 </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/4.%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BA%94%E7%94%A8/ class=md-nav__link> <span class=md-ellipsis> 4.数据库应用 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_4> <label class=md-nav__link for=__nav_4_4 id=__nav_4_4_label tabindex=0> <span class=md-ellipsis> 3.Devops </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4_4> <span class="md-nav__icon md-icon"></span> 3.Devops </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Docker/3.Devops/1.confcenter-docker/ class=md-nav__link> <span class=md-ellipsis> 1.confcenter-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/2.simaple-jenkins/ class=md-nav__link> <span class=md-ellipsis> 2.simaple-jenkins </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/3.docker-nginx-spa/ class=md-nav__link> <span class=md-ellipsis> 3.docker-nginx-spa </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/4.fileserver-docker/ class=md-nav__link> <span class=md-ellipsis> 4.fileserver-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/5.haproxy-docker/ class=md-nav__link> <span class=md-ellipsis> 5.haproxy-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/6.mysql-docker/ class=md-nav__link> <span class=md-ellipsis> 6.mysql-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/7.frp-docker/ class=md-nav__link> <span class=md-ellipsis> 7.frp-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/8.coredns-docker/ class=md-nav__link> <span class=md-ellipsis> 8.coredns-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/9.simple-harbor/ class=md-nav__link> <span class=md-ellipsis> 9.simple-harbor </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/10.redis-docker/ class=md-nav__link> <span class=md-ellipsis> 10.redis-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/11.nexus3-docker/ class=md-nav__link> <span class=md-ellipsis> 11.nexus3-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/12.openvpn-docker/ class=md-nav__link> <span class=md-ellipsis> 12.openvpn-docker.md </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/13.nfs-docker/ class=md-nav__link> <span class=md-ellipsis> 13.nfs-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/14.jumpserver-docker/ class=md-nav__link> <span class=md-ellipsis> 14.jumpserver-docker.md </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/15.ansible-docker/ class=md-nav__link> <span class=md-ellipsis> 15.ansible-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/16.minio-docker/ class=md-nav__link> <span class=md-ellipsis> 16.minio-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/17.vaultwarden-docker/ class=md-nav__link> <span class=md-ellipsis> 17.vaultwarden-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/18.kasm-docker/ class=md-nav__link> <span class=md-ellipsis> 18.kasm-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/19.nginx-docker/ class=md-nav__link> <span class=md-ellipsis> 19.nginx-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/20.kafka-docker/ class=md-nav__link> <span class=md-ellipsis> 20.kafka-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/21.golang-docker/ class=md-nav__link> <span class=md-ellipsis> 21.golang-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/22.postgres-docker/ class=md-nav__link> <span class=md-ellipsis> 22.postgres-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/23.nginx-download-docker/ class=md-nav__link> <span class=md-ellipsis> 23.nginx-download-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/24.helm%E9%83%A8%E7%BD%B2%E5%B8%B8%E7%94%A8%E6%9C%8D%E5%8A%A1/ class=md-nav__link> <span class=md-ellipsis> 24.helm部署常用服务 </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/25.Python%E6%93%8D%E4%BD%9CDocker/ class=md-nav__link> <span class=md-ellipsis> 25.Python操作Docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/26.docker-compose-devops/ class=md-nav__link> <span class=md-ellipsis> 26.docker-compose-devops </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/27.DevOps%E4%B8%8B%E7%9A%84Shell%E8%84%9A%E6%9C%AC/ class=md-nav__link> <span class=md-ellipsis> 27.DevOps下的Shell脚本 </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/28.Devops%E4%B8%8B%E7%9A%84Python%E8%84%9A%E6%9C%AC/ class=md-nav__link> <span class=md-ellipsis> 28.Devops下的Python脚本 </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/29.Vagrant%E8%99%9A%E6%8B%9F%E6%9C%BA/ class=md-nav__link> <span class=md-ellipsis> 29.Vagrant虚拟机 </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/30.VMware-workstation/ class=md-nav__link> <span class=md-ellipsis> 30.VMware Workstation </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/31.VirtualBox/ class=md-nav__link> <span class=md-ellipsis> 31.VirtualBox </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex> <span class=md-ellipsis> Golang </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Golang </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_1> <label class=md-nav__link for=__nav_5_1 id=__nav_5_1_label tabindex=0> <span class=md-ellipsis> 0.学习线路 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_1_label aria-expanded=false> <label class=md-nav__title for=__nav_5_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Go-Web%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98/ class=md-nav__link> <span class=md-ellipsis> Go Web开发实战 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_2> <label class=md-nav__link for=__nav_5_2 id=__nav_5_2_label tabindex=0> <span class=md-ellipsis> 1.Go基础 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_2_label aria-expanded=false> <label class=md-nav__title for=__nav_5_2> <span class="md-nav__icon md-icon"></span> 1.Go基础 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/1.Go%E5%9F%BA%E7%A1%80/1.%E5%AE%89%E8%A3%85Go/ class=md-nav__link> <span class=md-ellipsis> 安装Go </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/1.Go%E5%9F%BA%E7%A1%80/2.%E7%AC%AC%E4%B8%80%E4%B8%AAGo%E7%A8%8B%E5%BA%8F/ class=md-nav__link> <span class=md-ellipsis> 第一个Go程序 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/ class=md-nav__link> <span class=md-ellipsis> Go基础语法 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/1.Go%E5%9F%BA%E7%A1%80/4.Go-Module/ class=md-nav__link> <span class=md-ellipsis> Go Module </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/1.Go%E5%9F%BA%E7%A1%80/5.Go-%E6%A0%87%E5%87%86%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84/ class=md-nav__link> <span class=md-ellipsis> Go-标准目录结构 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_3> <label class=md-nav__link for=__nav_5_3 id=__nav_5_3_label tabindex=0> <span class=md-ellipsis> 2.Go-Web基础 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_3_label aria-expanded=false> <label class=md-nav__title for=__nav_5_3> <span class="md-nav__icon md-icon"></span> 2.Go-Web基础 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/2.Go-Web%E5%9F%BA%E7%A1%80/5.%E7%AC%AC%E4%B8%80%E4%B8%AAGo-Web%E7%A8%8B%E5%BA%8F/ class=md-nav__link> <span class=md-ellipsis> 第一个Go Web程序 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/2.Go-Web%E5%9F%BA%E7%A1%80/6.Web%E7%A8%8B%E5%BA%8F%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86%E7%AE%80%E4%BB%8B/ class=md-nav__link> <span class=md-ellipsis> Web程序运行原理简介 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/2.Go-Web%E5%9F%BA%E7%A1%80/7.net-http%E5%8C%85/ class=md-nav__link> <span class=md-ellipsis> net/http包 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/2.Go-Web%E5%9F%BA%E7%A1%80/8.html-template%E5%8C%85/ class=md-nav__link> <span class=md-ellipsis> html/template包 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_4> <label class=md-nav__link for=__nav_5_4 id=__nav_5_4_label tabindex=0> <span class=md-ellipsis> 3.Go-Web请求处理 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_4_label aria-expanded=false> <label class=md-nav__title for=__nav_5_4> <span class="md-nav__icon md-icon"></span> 3.Go-Web请求处理 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/3.Go-Web%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/9.%E7%AE%80%E5%8D%95Web%E6%9C%8D%E5%8A%A1%E5%99%A8/ class=md-nav__link> <span class=md-ellipsis> 简单Web服务器 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/3.Go-Web%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/10.%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82/ class=md-nav__link> <span class=md-ellipsis> 处理请求 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/3.Go-Web%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/11.session%E5%92%8Ccookie/ class=md-nav__link> <span class=md-ellipsis> session和cookie </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_5> <label class=md-nav__link for=__nav_5_5 id=__nav_5_5_label tabindex=0> <span class=md-ellipsis> 4.Go访问数据库 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5_5> <span class="md-nav__icon md-icon"></span> 4.Go访问数据库 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/12.Go%E6%93%8D%E4%BD%9CMySQL/ class=md-nav__link> <span class=md-ellipsis> Go操作MySQL </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/13.Go%E6%93%8D%E4%BD%9CRedis/ class=md-nav__link> <span class=md-ellipsis> Go操作Redis </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/14.Go%E6%93%8D%E4%BD%9CMongoDB/ class=md-nav__link> <span class=md-ellipsis> Go操作MongoDB </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/15.Go%E7%9A%84%E5%B8%B8%E8%A7%81ORM%E5%BA%93/ class=md-nav__link> <span class=md-ellipsis> Go的常见ORM库 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/16.Go%E6%93%8D%E4%BD%9CSQLite/ class=md-nav__link> <span class=md-ellipsis> Go操作SQLite </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_6> <label class=md-nav__link for=__nav_5_6 id=__nav_5_6_label tabindex=0> <span class=md-ellipsis> 5.Go高级网络编程 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_6_label aria-expanded=false> <label class=md-nav__title for=__nav_5_6> <span class="md-nav__icon md-icon"></span> 5.Go高级网络编程 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/5.Go%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/17.Go-Socket%E7%BC%96%E7%A8%8B/ class=md-nav__link> <span class=md-ellipsis> Go Socket编程 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/5.Go%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/18.Go-RPC%E7%BC%96%E7%A8%8B/ class=md-nav__link> <span class=md-ellipsis> Go RPC编程 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/5.Go%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/19.Go-%E5%BE%AE%E6%9C%8D%E5%8A%A1/ class=md-nav__link> <span class=md-ellipsis> Go 微服务 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_7> <label class=md-nav__link for=__nav_5_7 id=__nav_5_7_label tabindex=0> <span class=md-ellipsis> 6.Go文件处理 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_7_label aria-expanded=false> <label class=md-nav__title for=__nav_5_7> <span class="md-nav__icon md-icon"></span> 6.Go文件处理 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/20.%E5%A4%84%E7%90%86%E7%9B%AE%E5%BD%95%E4%B8%8E%E6%96%87%E4%BB%B6/ class=md-nav__link> <span class=md-ellipsis> 处理目录与文件 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/21.%E5%A4%84%E7%90%86XML%E6%96%87%E4%BB%B6/ class=md-nav__link> <span class=md-ellipsis> 处理XML文件 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/22.%E5%A4%84%E7%90%86JSON%E6%96%87%E4%BB%B6/ class=md-nav__link> <span class=md-ellipsis> 处理JSON文件 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/23.%E5%A4%84%E7%90%86CSV%E6%96%87%E4%BB%B6/ class=md-nav__link> <span class=md-ellipsis> 处理CSV文件 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/24.%E5%A4%84%E7%90%86Go%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95/ class=md-nav__link> <span class=md-ellipsis> 处理Go日志记录 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/25.%E5%A4%84%E7%90%86%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 处理正则表达式 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/26.%E5%A4%84%E7%90%86Excel%E6%96%87%E4%BB%B6/ class=md-nav__link> <span class=md-ellipsis> 处理Excel文件 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_8> <label class=md-nav__link for=__nav_5_8 id=__nav_5_8_label tabindex=0> <span class=md-ellipsis> 7.Go并发编程 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_8_label aria-expanded=false> <label class=md-nav__title for=__nav_5_8> <span class="md-nav__icon md-icon"></span> 7.Go并发编程 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/26.%E5%B9%B6%E5%8F%91-%E5%B9%B6%E8%A1%8C/ class=md-nav__link> <span class=md-ellipsis> 并发 并行 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/27.%E8%BF%9B%E7%A8%8B-%E7%BA%BF%E7%A8%8B-%E5%8D%8F%E7%A8%8B/ class=md-nav__link> <span class=md-ellipsis> 进程 线程 协程 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/28.Go%E5%B9%B6%E5%8F%91%E6%A8%A1%E5%9E%8B/ class=md-nav__link> <span class=md-ellipsis> Go并发模型 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/29.goroutine%E5%92%8Cchannel/ class=md-nav__link> <span class=md-ellipsis> goroutine和channel </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/30.sync%E5%AE%9E%E7%8E%B0%E5%B9%B6%E5%8F%91/ class=md-nav__link> <span class=md-ellipsis> sync实现并发 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/31.Go%E5%B9%B6%E5%8F%91%E7%9A%84Web%E5%BA%94%E7%94%A8/ class=md-nav__link> <span class=md-ellipsis> Go并发的Web应用 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_9> <label class=md-nav__link for=__nav_5_9 id=__nav_5_9_label tabindex=0> <span class=md-ellipsis> 8.Go标准库 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_9_label aria-expanded=false> <label class=md-nav__title for=__nav_5_9> <span class="md-nav__icon md-icon"></span> 8.Go标准库 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/32.time/ class=md-nav__link> <span class=md-ellipsis> time </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/33.strings/ class=md-nav__link> <span class=md-ellipsis> strings </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/34.bytes/ class=md-nav__link> <span class=md-ellipsis> bytes </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/35.json/ class=md-nav__link> <span class=md-ellipsis> json </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/36.io-bufio/ class=md-nav__link> <span class=md-ellipsis> io/bufio </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/37.fmt/ class=md-nav__link> <span class=md-ellipsis> fmt </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/38.strconv/ class=md-nav__link> <span class=md-ellipsis> strconv </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/39.regexp/ class=md-nav__link> <span class=md-ellipsis> regexp </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/40.log/ class=md-nav__link> <span class=md-ellipsis> log </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/41.reflect-unsafe/ class=md-nav__link> <span class=md-ellipsis> reflect/unsafe </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/42.os-path-filepath/ class=md-nav__link> <span class=md-ellipsis> os/path/filepath </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/43.unicode/ class=md-nav__link> <span class=md-ellipsis> unicode </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/44.flag/ class=md-nav__link> <span class=md-ellipsis> flag </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/45.net-url/ class=md-nav__link> <span class=md-ellipsis> net/url </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/46.net-http/ class=md-nav__link> <span class=md-ellipsis> net/http </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/47.sort/ class=md-nav__link> <span class=md-ellipsis> sort </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/48.errors/ class=md-nav__link> <span class=md-ellipsis> errors </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_10> <label class=md-nav__link for=__nav_5_10 id=__nav_5_10_label tabindex=0> <span class=md-ellipsis> 9.Go三方库 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_10_label aria-expanded=false> <label class=md-nav__title for=__nav_5_10> <span class="md-nav__icon md-icon"></span> 9.Go三方库 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/0.%E5%BC%80%E6%BA%90%E8%87%AA%E5%B7%B1%E7%9A%84Go%E5%BA%93/ class=md-nav__link> <span class=md-ellipsis> 开源自己的Go库 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/1.cobra/ class=md-nav__link> <span class=md-ellipsis> Cobra </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/2.viper/ class=md-nav__link> <span class=md-ellipsis> Viper </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/3.mahonia/ class=md-nav__link> <span class=md-ellipsis> mahonia </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/4.ssh/ class=md-nav__link> <span class=md-ellipsis> ssh </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/5.fsnotify/ class=md-nav__link> <span class=md-ellipsis> fsnotify </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/6.yaml/ class=md-nav__link> <span class=md-ellipsis> yaml </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/7.tail/ class=md-nav__link> <span class=md-ellipsis> tail </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/8.gopsutil/ class=md-nav__link> <span class=md-ellipsis> gopsutil </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/9.go-awesome/ class=md-nav__link> <span class=md-ellipsis> go-awesome </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_11> <label class=md-nav__link for=__nav_5_11 id=__nav_5_11_label tabindex=0> <span class=md-ellipsis> 10.Go-RESTful-API接口开发 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_11_label aria-expanded=false> <label class=md-nav__title for=__nav_5_11> <span class="md-nav__icon md-icon"></span> 10.Go-RESTful-API接口开发 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/10.Go-RESTful-API%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91/1.%E4%BB%80%E4%B9%88%E6%98%AFRESTful-API/ class=md-nav__link> <span class=md-ellipsis> 1.什么是RESTful-API </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/10.Go-RESTful-API%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91/2.GORMv2/ class=md-nav__link> <span class=md-ellipsis> 2.GORMv2 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/10.Go-RESTful-API%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91/3.Gin%E6%A1%86%E6%9E%B6%E7%9A%84%E4%BD%BF%E7%94%A8/ class=md-nav__link> <span class=md-ellipsis> 3.Gin框架的使用 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/10.Go-RESTful-API%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91/4.%E5%9B%BE%E4%B9%A6%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-%E5%89%8D%E7%AB%AF/ class=md-nav__link> <span class=md-ellipsis> 4.图书管理系统-前端 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/10.Go-RESTful-API%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91/5.%E5%9B%BE%E4%B9%A6%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-%E5%90%8E%E7%AB%AF/ class=md-nav__link> <span class=md-ellipsis> 5.图书管理系统-后端 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_12> <label class=md-nav__link for=__nav_5_12 id=__nav_5_12_label tabindex=0> <span class=md-ellipsis> 11.Web前端 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_12_label aria-expanded=false> <label class=md-nav__title for=__nav_5_12> <span class="md-nav__icon md-icon"></span> 11.Web前端 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/11.Web%E5%89%8D%E7%AB%AF/1.HTML%E6%A0%87%E8%AE%B0%E8%AF%AD%E8%A8%80/ class=md-nav__link> <span class=md-ellipsis> 1.HTML标记语言 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/11.Web%E5%89%8D%E7%AB%AF/2.CSS%E6%A0%B7%E5%BC%8F%E8%AF%AD%E8%A8%80/ class=md-nav__link> <span class=md-ellipsis> 2.CSS样式语言 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/11.Web%E5%89%8D%E7%AB%AF/3.JavaScript%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%84%9A%E6%9C%AC%E8%AF%AD%E8%A8%80/ class=md-nav__link> <span class=md-ellipsis> 3.JavaScript客户端脚本语言 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/11.Web%E5%89%8D%E7%AB%AF/4.JavaScript%E5%BA%93-JQuery/ class=md-nav__link> <span class=md-ellipsis> 4.JavaScript库:JQuery </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_13> <label class=md-nav__link for=__nav_5_13 id=__nav_5_13_label tabindex=0> <span class=md-ellipsis> 12.Vue前端开发 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_13_label aria-expanded=false> <label class=md-nav__title for=__nav_5_13> <span class="md-nav__icon md-icon"></span> 12.Vue前端开发 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/1.%E8%AE%A4%E8%AF%86Vue.js/ class=md-nav__link> <span class=md-ellipsis> 1.认识Vue.js.md </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/2.Vue%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4/ class=md-nav__link> <span class=md-ellipsis> 2.Vue常用指令 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/3.Vue%E5%B8%B8%E7%94%A8%E5%B1%9E%E6%80%A7/ class=md-nav__link> <span class=md-ellipsis> 3.Vue常用属性 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/4.Vue%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4%E4%B9%8B%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/ class=md-nav__link> <span class=md-ellipsis> 4.Vue常用指令之流程控制 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/5.Vue%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4%E4%B9%8B%E6%95%B0%E6%8D%AE%E5%8F%8C%E5%90%91%E7%BB%91%E5%AE%9A/ class=md-nav__link> <span class=md-ellipsis> 5.Vue常用指令之数据双向绑定 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/6.Vue%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E9%92%A9%E5%AD%90/ class=md-nav__link> <span class=md-ellipsis> 6.Vue生命周期钩子 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/7.VueCli%E8%84%9A%E6%89%8B%E6%9E%B6/ class=md-nav__link> <span class=md-ellipsis> 7.VueCli脚手架 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/8.Vue%E7%BB%84%E4%BB%B6/ class=md-nav__link> <span class=md-ellipsis> 8.Vue组件 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/9.Vue%E8%B7%AF%E7%94%B1/ class=md-nav__link> <span class=md-ellipsis> 9.Vue路由 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/10.Vuex%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 10.Vuex状态管理 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/11.%E5%89%8D%E5%90%8E%E7%AB%AF%E6%95%B0%E6%8D%AE%E4%BA%A4%E4%BA%92-Axios/ class=md-nav__link> <span class=md-ellipsis> 11.前后端数据交互 Axios </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/12.Element-Plus/ class=md-nav__link> <span class=md-ellipsis> 12.Element Plus </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_14> <label class=md-nav__link for=__nav_5_14 id=__nav_5_14_label tabindex=0> <span class=md-ellipsis> 13.K8s管理系统项目实战 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_14_label aria-expanded=false> <label class=md-nav__title for=__nav_5_14> <span class="md-nav__icon md-icon"></span> 13.K8s管理系统项目实战 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/13.K8s%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/1.K8s%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-%E5%90%8E%E7%AB%AFAPI%E5%BC%80%E5%8F%91/ class=md-nav__link> <span class=md-ellipsis> K8s管理系统-后端API开发 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/13.K8s%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/2.K8s%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/ class=md-nav__link> <span class=md-ellipsis> K8s管理系统-前端开发 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_15> <label class=md-nav__link for=__nav_5_15 id=__nav_5_15_label tabindex=0> <span class=md-ellipsis> 14.Go开发的三方平台 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_15_label aria-expanded=false> <label class=md-nav__title for=__nav_5_15> <span class="md-nav__icon md-icon"></span> 14.Go开发的三方平台 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/14.Go%E5%BC%80%E5%8F%91%E7%9A%84%E4%B8%89%E6%96%B9%E5%B9%B3%E5%8F%B0/1.TBak-System%E5%A4%87%E4%BB%BD%E5%B9%B3%E5%8F%B0/ class=md-nav__link> <span class=md-ellipsis> TBak System备份平台 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/14.Go%E5%BC%80%E5%8F%91%E7%9A%84%E4%B8%89%E6%96%B9%E5%B9%B3%E5%8F%B0/2.kubemanage%E4%BA%91%E5%8E%9F%E7%94%9F%E8%BF%90%E7%BB%B4%E5%B9%B3%E5%8F%B0/ class=md-nav__link> <span class=md-ellipsis> kubemanage云原生运维平台 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex> <span class=md-ellipsis> Python </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Python </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_1> <label class=md-nav__link for=__nav_6_1 id=__nav_6_1_label tabindex=0> <span class=md-ellipsis> 0.学习线路 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_1_label aria-expanded=false> <label class=md-nav__title for=__nav_6_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Pythjon-auto-ops/ class=md-nav__link> <span class=md-ellipsis> Python Linux管理与自动化运维 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_2> <label class=md-nav__link for=__nav_6_2 id=__nav_6_2_label tabindex=0> <span class=md-ellipsis> 1.Python基础篇 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_2_label aria-expanded=false> <label class=md-nav__title for=__nav_6_2> <span class="md-nav__icon md-icon"></span> 1.Python基础篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/1.Python%E7%94%9F%E6%80%81%E5%B7%A5%E5%85%B7/ class=md-nav__link> <span class=md-ellipsis> 1.Python生态工具 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/2.Python%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E5%AE%89%E8%A3%85/ class=md-nav__link> <span class=md-ellipsis> 2.Python第三方库安装 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/3.Python%E5%B7%A5%E4%BD%9C%E7%8E%AF%E5%A2%83%E7%AE%A1%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 3.Python工作环境管理 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/4.Python%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/ class=md-nav__link> <span class=md-ellipsis> 4.Python开发环境 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/5.Python%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/ class=md-nav__link> <span class=md-ellipsis> 5.Python数据结构 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/6.Python%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84/ class=md-nav__link> <span class=md-ellipsis> 6.Python项目的组织结构 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/7.Python%E4%BB%A3%E7%A0%81%E8%A7%84%E8%8C%83/ class=md-nav__link> <span class=md-ellipsis> 7.Python代码规范 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/8.Python%E5%86%85%E7%BD%AE%E5%87%BD%E6%95%B0/ class=md-nav__link> <span class=md-ellipsis> 8.Python内置函数 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_3> <label class=md-nav__link for=__nav_6_3 id=__nav_6_3_label tabindex=0> <span class=md-ellipsis> 2.Python运维开发 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_3_label aria-expanded=false> <label class=md-nav__title for=__nav_6_3> <span class="md-nav__icon md-icon"></span> 2.Python运维开发 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/1.%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/ class=md-nav__link> <span class=md-ellipsis> 1.命令行工具 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/2.%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 2.文本处理 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/3.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 3.Linux系统管理 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/4.%E7%9B%91%E6%8E%A7Linux/ class=md-nav__link> <span class=md-ellipsis> 4.监控Linux </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/5.%E6%96%87%E6%A1%A3%E4%B8%8E%E6%8A%A5%E5%91%8A/ class=md-nav__link> <span class=md-ellipsis> 5.文档与报告 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/6.%E7%BD%91%E7%BB%9C/ class=md-nav__link> <span class=md-ellipsis> 6.网络 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/7.%E8%87%AA%E5%8A%A8%E5%8C%96%E7%AE%A1%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 7.自动化管理 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/8.%E5%B8%B8%E7%94%A8%E6%A8%A1%E5%9D%97/ class=md-nav__link> <span class=md-ellipsis> 8.常用模块 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/9.Python%E6%89%93%E9%80%A0MySQL%E4%B8%93%E5%AE%B6%E7%B3%BB%E7%BB%9F/ class=md-nav__link> <span class=md-ellipsis> 9.Python打造MySQL专家系统 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/10.%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%BC%80%E5%8F%91/ class=md-nav__link> <span class=md-ellipsis> 10.自动化运维系统的开发 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/11.%E5%8D%8E%E4%B8%BA%E4%BA%91Python%E6%BC%94%E7%A4%BA%E4%BB%A3%E7%A0%81/ class=md-nav__link> <span class=md-ellipsis> 11.华为云Python演示代码 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/12.%E5%8D%8E%E4%B8%BA%E4%BA%91Go%E6%BC%94%E7%A4%BA%E4%BB%A3%E7%A0%81/ class=md-nav__link> <span class=md-ellipsis> 12.华为云Go演示代码 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/%E9%99%84-awesome-python-cn/ class=md-nav__link> <span class=md-ellipsis> 附-awesome-python-cn </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/%E9%99%84-CMDB/ class=md-nav__link> <span class=md-ellipsis> 附-CMDB </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/%E9%99%84-Django-web%E5%BC%80%E5%8F%91/ class=md-nav__link> <span class=md-ellipsis> 附-Django-web开发 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_4> <label class=md-nav__link for=__nav_6_4 id=__nav_6_4_label tabindex=0> <span class=md-ellipsis> 3.Python测试开发 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_4_label aria-expanded=false> <label class=md-nav__title for=__nav_6_4> <span class="md-nav__icon md-icon"></span> 3.Python测试开发 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/1.Python2%E4%B8%8EPython3%E5%8C%BA%E5%88%AB/ class=md-nav__link> <span class=md-ellipsis> 1.Python2与Python3区别 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/2.Windows%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85Python/ class=md-nav__link> <span class=md-ellipsis> 2.Windows环境安装Python </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/3.Linux%E5%A4%9A%E7%89%88%E6%9C%ACPython%E5%AE%89%E8%A3%85/ class=md-nav__link> <span class=md-ellipsis> 3.Linux多版本Python安装 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/4.Python%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85/ class=md-nav__link> <span class=md-ellipsis> 4.Python虚拟环境安装 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/5.Pycharm%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8/ class=md-nav__link> <span class=md-ellipsis> 5.Pycharm安装与使用 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/6.Python%E9%97%B4%E6%8E%A5%E5%AE%9A%E4%B9%89%E5%B8%B8%E9%87%8F/ class=md-nav__link> <span class=md-ellipsis> 6.Python间接定义常量 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/7.Python%E8%BF%90%E7%AE%97%E7%AC%A6%E4%B8%8E%E8%A1%A8%E8%BE%BE%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 7.Python运算符与表达式 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/8.%E9%80%BB%E8%BE%91%E6%8E%A7%E5%88%B6%E8%AF%AD%E5%8F%A5/ class=md-nav__link> <span class=md-ellipsis> 8.逻辑控制语句 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/9.%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%BB%8B%E7%BB%8D/ class=md-nav__link> <span class=md-ellipsis> 9.数据结构 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/10.%E5%87%BD%E6%95%B0%E4%BB%8B%E7%BB%8D/ class=md-nav__link> <span class=md-ellipsis> 10.函数介绍 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/11.%E7%B1%BB%E4%B8%8E%E5%AF%B9%E8%B1%A1/ class=md-nav__link> <span class=md-ellipsis> 11.类与对象 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/12.%E6%89%93%E5%8C%85%E4%B8%8E%E5%8F%91%E5%B8%83/ class=md-nav__link> <span class=md-ellipsis> 12.打包与发布 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/13.%E5%BC%82%E5%B8%B8%E6%8D%95%E8%8E%B7%E4%B8%8E%E5%A4%84%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 13.异常捕获与处理 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/14.%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/ class=md-nav__link> <span class=md-ellipsis> 14.并发编程 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/15.%E6%A0%87%E5%87%86%E5%BA%93%E5%92%8C%E4%B8%89%E6%96%B9%E5%BA%93/ class=md-nav__link> <span class=md-ellipsis> 15.标准库和三方库 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/16.vue-cli%E8%84%9A%E6%89%8B%E6%9E%B6/ class=md-nav__link> <span class=md-ellipsis> 16.vue-cli脚手架 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/17.%E6%A1%88%E4%BE%8B%E5%AE%9E%E8%B7%B5-%E4%BB%BB%E5%8A%A1%E5%88%97%E8%A1%A8/ class=md-nav__link> <span class=md-ellipsis> 17.案例实践-任务列表 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_5> <label class=md-nav__link for=__nav_6_5 id=__nav_6_5_label tabindex=0> <span class=md-ellipsis> 4.Flask-Web全栈开发 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_5_label aria-expanded=false> <label class=md-nav__title for=__nav_6_5> <span class="md-nav__icon md-icon"></span> 4.Flask-Web全栈开发 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/1.Flask%E5%89%8D%E5%A5%8F/ class=md-nav__link> <span class=md-ellipsis> 1.Flask前缀 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/2.%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AE/ class=md-nav__link> <span class=md-ellipsis> 2.项目配置 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/3.URL%E4%B8%8E%E8%A7%86%E5%9B%BE/ class=md-nav__link> <span class=md-ellipsis> 3.URL与视图 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/4.Jinja2%E6%A8%A1%E6%9D%BF/ class=md-nav__link> <span class=md-ellipsis> 4.Jinja2模板 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/5.%E6%95%B0%E6%8D%AE%E5%BA%93/ class=md-nav__link> <span class=md-ellipsis> 5.数据库 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/6.%E8%A1%A8%E5%8D%95/ class=md-nav__link> <span class=md-ellipsis> 6.表单 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/7.Flask%E8%BF%9B%E9%98%B6/ class=md-nav__link> <span class=md-ellipsis> 7.Flask进阶 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/8.%E7%BC%93%E5%AD%98%E7%B3%BB%E7%BB%9F/ class=md-nav__link> <span class=md-ellipsis> 8.缓存系统 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/9.Flask%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/ class=md-nav__link> <span class=md-ellipsis> 9.Flask项目实战 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/10.WebSock%E5%AE%9E%E6%88%98/ class=md-nav__link> <span class=md-ellipsis> 10.WebSock实战 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/11.Flask%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B/ class=md-nav__link> <span class=md-ellipsis> 11.Flask异步编程 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/%E9%99%84-%E4%BD%BF%E7%94%A8Pytest%E6%B5%8B%E8%AF%95Flask/ class=md-nav__link> <span class=md-ellipsis> 附-使用Pytest测试Flask </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/%E9%99%84-Flask%E5%B8%B8%E7%94%A8%E6%89%A9%E5%B1%95/ class=md-nav__link> <span class=md-ellipsis> 附-Flask常用扩展 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/%E9%99%84-Flask%E5%92%8CRedis%E9%98%9F%E5%88%97%E7%9A%84%E5%BC%82%E6%AD%A5%E4%BB%BB%E5%8A%A1/ class=md-nav__link> <span class=md-ellipsis> 附-Flask和Redis队列的异步任务 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/%E9%99%84-Flask%E5%92%8CVue.js%E5%BC%80%E5%8F%91%E5%8D%95%E9%A1%B5%E5%BA%94%E7%94%A8/ class=md-nav__link> <span class=md-ellipsis> 附-Flask和Vue.js开发单页应用 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/%E9%99%84-Flask%E5%AE%B9%E5%99%A8%E5%8C%96%E5%AE%9E%E8%B7%B5/ class=md-nav__link> <span class=md-ellipsis> 附-Flask容器化实践 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/%E9%99%84-Flask%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B/ class=md-nav__link> <span class=md-ellipsis> 附-Flask数据模型 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex> <span class=md-ellipsis> Python-vs-Go </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Python-vs-Go </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_1> <label class=md-nav__link for=__nav_7_1 id=__nav_7_1_label tabindex=0> <span class=md-ellipsis> 0.线路 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_1_label aria-expanded=false> <label class=md-nav__title for=__nav_7_1> <span class="md-nav__icon md-icon"></span> 0.线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python-vs-Go/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Python-vs-Go/ class=md-nav__link> <span class=md-ellipsis> Python-vs-Go </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_2> <label class=md-nav__link for=__nav_7_2 id=__nav_7_2_label tabindex=0> <span class=md-ellipsis> 1.对比 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_2_label aria-expanded=false> <label class=md-nav__title for=__nav_7_2> <span class="md-nav__icon md-icon"></span> 1.对比 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/1.Hello-World/ class=md-nav__link> <span class=md-ellipsis> Hello-World </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/2.Print/ class=md-nav__link> <span class=md-ellipsis> Print </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/3.%E6%B3%A8%E9%87%8A/ class=md-nav__link> <span class=md-ellipsis> 注释 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/4.%E5%A4%9A%E8%A1%8C%E5%AD%97%E7%AC%A6%E4%B8%B2/ class=md-nav__link> <span class=md-ellipsis> 多行字符串 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/5.Lists/ class=md-nav__link> <span class=md-ellipsis> Lists </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/6.Map/ class=md-nav__link> <span class=md-ellipsis> Map </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/7.Booleans/ class=md-nav__link> <span class=md-ellipsis> Booleans </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/8.Forloop/ class=md-nav__link> <span class=md-ellipsis> Forloop </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/9.Range/ class=md-nav__link> <span class=md-ellipsis> Range </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/10.Switch/ class=md-nav__link> <span class=md-ellipsis> Switch </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/11.%E5%8F%AF%E5%8F%98%E5%8F%82%E6%95%B0%E5%87%BD%E6%95%B0/ class=md-nav__link> <span class=md-ellipsis> 可变参数函数 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/12.%E6%97%B6%E9%97%B4%E8%AE%A1%E7%AE%97/ class=md-nav__link> <span class=md-ellipsis> 时间计算 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/13.%E5%87%BD%E6%95%B0%E7%9A%84%E9%97%AD%E5%8C%85/ class=md-nav__link> <span class=md-ellipsis> 函数的闭包 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/14.%E9%80%80%E5%87%BA%E5%A4%84%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 退出处理 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/15.%E5%BC%82%E5%B8%B8%E6%8D%95%E8%8E%B7/ class=md-nav__link> <span class=md-ellipsis> 异常捕获 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/16.%E5%8F%AF%E5%8F%98%E9%A1%B9/ class=md-nav__link> <span class=md-ellipsis> 可变项 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/17.%E7%B1%BB/ class=md-nav__link> <span class=md-ellipsis> 类 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/18.%E6%96%B9%E6%B3%95/ class=md-nav__link> <span class=md-ellipsis> 方法 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/19.%E5%B9%B6%E5%8F%91/ class=md-nav__link> <span class=md-ellipsis> 并发 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/20.Args/ class=md-nav__link> <span class=md-ellipsis> Args </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/21.%E5%AF%BC%E5%85%A5%E6%A8%A1%E5%9D%97%E5%88%AB%E5%90%8D/ class=md-nav__link> <span class=md-ellipsis> 导入模块别名 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/22.%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%A0%BC%E5%BC%8F%E5%8C%96/ class=md-nav__link> <span class=md-ellipsis> 字符串格式化 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/23.%E5%8E%BB%E9%87%8D/ class=md-nav__link> <span class=md-ellipsis> 去重 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/24.%E5%B8%A6%E9%A2%9C%E8%89%B2%E6%89%93%E5%8D%B0/ class=md-nav__link> <span class=md-ellipsis> 带颜色打印 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_3> <label class=md-nav__link for=__nav_7_3 id=__nav_7_3_label tabindex=0> <span class=md-ellipsis> 2.进阶 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_3_label aria-expanded=false> <label class=md-nav__title for=__nav_7_3> <span class="md-nav__icon md-icon"></span> 2.进阶 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python-vs-Go/2.%E8%BF%9B%E9%98%B6/1.%E4%BD%BF%E7%94%A8RPC/ class=md-nav__link> <span class=md-ellipsis> 使用RPC </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/2.%E8%BF%9B%E9%98%B6/2.%E4%BD%BF%E7%94%A8MySQL/ class=md-nav__link> <span class=md-ellipsis> 使用MySQL </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/2.%E8%BF%9B%E9%98%B6/3.%E4%BD%BF%E7%94%A8Redis/ class=md-nav__link> <span class=md-ellipsis> 使用Redis </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/2.%E8%BF%9B%E9%98%B6/4.%E4%BD%BF%E7%94%A8MongoDB/ class=md-nav__link> <span class=md-ellipsis> 使用MongoDB </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8> <label class=md-nav__link for=__nav_8 id=__nav_8_label tabindex> <span class=md-ellipsis> Linux </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_8_label aria-expanded=false> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> Linux </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8_1> <label class=md-nav__link for=__nav_8_1 id=__nav_8_1_label tabindex=0> <span class=md-ellipsis> Shell </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_8_1_label aria-expanded=false> <label class=md-nav__title for=__nav_8_1> <span class="md-nav__icon md-icon"></span> Shell </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Linux/Shell/Shell%E7%AE%80%E4%BB%8B/ class=md-nav__link> <span class=md-ellipsis> Shell 教程概述 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/1.%E7%AC%AC%E4%B8%80%E4%B8%AAshell%E7%A8%8B%E5%BA%8F/ class=md-nav__link> <span class=md-ellipsis> 1.第一个 Shell 程序 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/2.Shell%E5%8F%98%E9%87%8F%E5%92%8C%E5%AD%97%E7%AC%A6%E4%B8%B2/ class=md-nav__link> <span class=md-ellipsis> 2.Shell变量和字符串 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/3.Shell%E5%8F%82%E6%95%B0/ class=md-nav__link> <span class=md-ellipsis> 3.Shell参数 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/4.Shell%E6%95%B0%E7%BB%84/ class=md-nav__link> <span class=md-ellipsis> 4.Shell数组 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/5.Shell%E8%BF%90%E7%AE%97%E7%AC%A6/ class=md-nav__link> <span class=md-ellipsis> 5.Shell运算符 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/6.Shell-echo_printf%E5%91%BD%E4%BB%A4/ class=md-nav__link> <span class=md-ellipsis> 6.Shell echo/printf 命令 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/7.Shell-test%E5%91%BD%E4%BB%A4/ class=md-nav__link> <span class=md-ellipsis> 7.Shell test命令 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/8.Shell%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/ class=md-nav__link> <span class=md-ellipsis> 8.Shell流程控制 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/9.Shell%E5%87%BD%E6%95%B0/ class=md-nav__link> <span class=md-ellipsis> 9.Shell函数 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/10.Shell%E8%BE%93%E5%85%A5_%E8%BE%93%E5%87%BA%E9%87%8D%E5%AE%9A%E5%90%91/ class=md-nav__link> <span class=md-ellipsis> 10.Shell输入/输出重定向 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/11.Shell%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 11.Shell正则表达式 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/12.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bgrep/ class=md-nav__link> <span class=md-ellipsis> 12.Shell三剑客之grep </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/13.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/ class=md-nav__link> <span class=md-ellipsis> 13.Shell三剑客之sed </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/14.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bawk/ class=md-nav__link> <span class=md-ellipsis> 14.Shell三剑客之awk </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/15.Shell%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/ class=md-nav__link> <span class=md-ellipsis> 15.Shell常用工具 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/16.Shell%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/ class=md-nav__link> <span class=md-ellipsis> 16.Shell实战项目 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/17.Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/ class=md-nav__link> <span class=md-ellipsis> 17.Shell脚本示例 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/18.Shell%E8%84%9A%E6%9C%AC%E7%9A%84%E5%8F%82%E6%95%B0%E8%A7%A3%E6%9E%90%E5%B7%A5%E5%85%B7/ class=md-nav__link> <span class=md-ellipsis> 18.Shell脚本的参数解析工具 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/19.%E5%AE%9E%E7%94%A8Shell%E8%84%9A%E6%9C%AC%E6%A1%88%E4%BE%8B/ class=md-nav__link> <span class=md-ellipsis> 19.实用Shell脚本案例 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/20.Shell%E8%84%9A%E6%9C%AC%E7%9A%84%E8%A7%84%E8%8C%83/ class=md-nav__link> <span class=md-ellipsis> 20.Shell脚本的规范 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/21.Shell%E5%A4%9A%E8%BF%9B%E7%A8%8B%E5%B9%B6%E5%8F%91/ class=md-nav__link> <span class=md-ellipsis> 21.Shell多进程并发 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/%E9%99%84-shell%E5%85%B6%E5%AE%83%E8%B5%84%E6%BA%90/ class=md-nav__link> <span class=md-ellipsis> 附-shell其它资源 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/%E9%99%84-vim%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/ class=md-nav__link> <span class=md-ellipsis> 附-vim常用操作 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8_2> <label class=md-nav__link for=__nav_8_2 id=__nav_8_2_label tabindex=0> <span class=md-ellipsis> Ansible </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_8_2_label aria-expanded=false> <label class=md-nav__title for=__nav_8_2> <span class="md-nav__icon md-icon"></span> Ansible </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/ class=md-nav__link> <span class=md-ellipsis> 1.Ansible入门和实践 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Ansible/2.Ansible-wiki/ class=md-nav__link> <span class=md-ellipsis> 2.Ansible-wiki </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8_3> <label class=md-nav__link for=__nav_8_3 id=__nav_8_3_label tabindex=0> <span class=md-ellipsis> Git </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_8_3_label aria-expanded=false> <label class=md-nav__title for=__nav_8_3> <span class="md-nav__icon md-icon"></span> Git </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Linux/Git/1.Git%E5%9F%BA%E7%A1%80/ class=md-nav__link> <span class=md-ellipsis> 1.Git基础 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Git/2.%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93/ class=md-nav__link> <span class=md-ellipsis> 2.远程仓库 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Git/3.%E5%88%86%E6%94%AF%E7%AE%A1%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 3.分支管理 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Git/4.%E5%88%86%E6%94%AF%E7%AE%A1%E7%90%86%E7%AD%96%E7%95%A5/ class=md-nav__link> <span class=md-ellipsis> 4.分支管理策略 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Git/7.%E4%BD%BF%E7%94%A8Github/ class=md-nav__link> <span class=md-ellipsis> 7.使用Github </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Git/8.%E5%AE%9E%E8%B7%B5GitHub-Flow/ class=md-nav__link> <span class=md-ellipsis> 8.实践GitHub Flow </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Git/9.%E5%AE%9E%E8%B7%B5Git-Flow/ class=md-nav__link> <span class=md-ellipsis> 9.实践Git Flow </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Git/10.%E9%A1%B9%E7%9B%AE%E8%A7%84%E8%8C%83/ class=md-nav__link> <span class=md-ellipsis> 10.项目规范 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8_4> <label class=md-nav__link for=__nav_8_4 id=__nav_8_4_label tabindex=0> <span class=md-ellipsis> KVM </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_8_4_label aria-expanded=false> <label class=md-nav__title for=__nav_8_4> <span class="md-nav__icon md-icon"></span> KVM </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Linux/KVM/1.kvm%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4/ class=md-nav__link> <span class=md-ellipsis> 1.kvm相关命令 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/KVM/2.kvm%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%88%9B%E5%BB%BA/ class=md-nav__link> <span class=md-ellipsis> 2.kvm虚拟机创建 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/KVM/3.kvm%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE/ class=md-nav__link> <span class=md-ellipsis> 3.kvm网络配置 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8_5> <label class=md-nav__link for=__nav_8_5 id=__nav_8_5_label tabindex=0> <span class=md-ellipsis> Nginx </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_8_5_label aria-expanded=false> <label class=md-nav__title for=__nav_8_5> <span class="md-nav__icon md-icon"></span> Nginx </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Linux/Nginx/1.Nginx%E7%AE%80%E4%BB%8B/ class=md-nav__link> <span class=md-ellipsis> 1.Nginx简介 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/2.Nginx%E5%AE%89%E8%A3%85%E5%8F%8A%E5%90%AF%E5%8A%A8/ class=md-nav__link> <span class=md-ellipsis> 2.Nginx安装及启动 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/3.Nginx%E9%85%8D%E7%BD%AE/ class=md-nav__link> <span class=md-ellipsis> 3.Nginx配置 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/4.Nginx%E9%85%8D%E7%BD%AE%E4%B8%8B%E8%BD%BD%E7%AB%99%E7%82%B9/ class=md-nav__link> <span class=md-ellipsis> 4.Nginx配置下载站点 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/5.Nginx%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6/ class=md-nav__link> <span class=md-ellipsis> 5.Nginx访问控制 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/6.Nginx%E8%99%9A%E6%8B%9F%E4%B8%BB%E6%9C%BA/ class=md-nav__link> <span class=md-ellipsis> 6.Nginx虚拟主机 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/7.Nginx%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90/ class=md-nav__link> <span class=md-ellipsis> 7.Nginx静态资源 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/8.Nginx%E7%BC%93%E5%AD%98%E9%85%8D%E7%BD%AE/ class=md-nav__link> <span class=md-ellipsis> 8.Nginx缓存配置 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/9.Nginx%E6%AD%A3%E5%8F%8D%E4%BB%A3%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 9.Nginx正反向代理 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/10.Nginx%E9%98%B2%E7%9B%97%E9%93%BE/ class=md-nav__link> <span class=md-ellipsis> 10.Nginx防盗链 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/11.Nginx%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/ class=md-nav__link> <span class=md-ellipsis> 11.Nginx负载均衡 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/12.Nginx%E5%8A%A8%E9%9D%99%E5%88%86%E7%A6%BB/ class=md-nav__link> <span class=md-ellipsis> 12.Nginx动静分离 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/13.Nginx%E8%B7%A8%E5%9F%9F%E9%85%8D%E7%BD%AE/ class=md-nav__link> <span class=md-ellipsis> 13.Nginx跨域配置 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/14.Nginx%E9%87%8D%E5%AE%9A%E5%90%91/ class=md-nav__link> <span class=md-ellipsis> 14.Nginx重定向 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/15.Nginx-HTTPS/ class=md-nav__link> <span class=md-ellipsis> 15.Nginx HttPS </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8_6> <label class=md-nav__link for=__nav_8_6 id=__nav_8_6_label tabindex=0> <span class=md-ellipsis> System </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_8_6_label aria-expanded=false> <label class=md-nav__title for=__nav_8_6> <span class="md-nav__icon md-icon"></span> System </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Linux/System/1.%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E5%92%8C%E8%BD%AF%E4%BB%B6%E6%BA%90/ class=md-nav__link> <span class=md-ellipsis> 1.系统镜像和软件源 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/System/2.Linux%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA/ class=md-nav__link> <span class=md-ellipsis> 2.Linux安全加固 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/System/3.Systemd/ class=md-nav__link> <span class=md-ellipsis> 3.Systemd </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/System/4.Superivisor/ class=md-nav__link> <span class=md-ellipsis> 4.Superivisor </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/System/5.SSH%E7%99%BB%E5%BD%95Linux%E6%98%BE%E7%A4%BA%E6%A8%AA%E5%B9%85/ class=md-nav__link> <span class=md-ellipsis> 5.SSH登录Linux显示横幅.md </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/System/6.Linux%E4%B8%AD%E7%AB%AF%E5%8F%A3%E5%8D%A0%E7%94%A8%E6%8E%92%E6%9F%A5/ class=md-nav__link> <span class=md-ellipsis> 6.Linux中端口占用排查 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/System/7.%E4%BD%BF%E7%94%A8curl%E5%8F%91%E9%80%81REST-API%E8%AF%B7%E6%B1%82/ class=md-nav__link> <span class=md-ellipsis> 7.使用curl发送REST API请求 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/System/8.%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%A8%A1%E7%B3%8A%E6%9F%A5%E6%89%BE%E5%99%A8fzf/ class=md-nav__link> <span class=md-ellipsis> 8.命令行模糊查找器fzf </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/System/9.Centos7.9%E7%B3%BB%E7%BB%9F%E7%9B%98%E6%89%A9%E5%AE%B9/ class=md-nav__link> <span class=md-ellipsis> 9.Centos7.9系统盘扩容 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/System/10.Centos%E5%9C%A8%E7%BA%BF-%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96/ class=md-nav__link> <span class=md-ellipsis> 10.Centos在线-离线安装依赖 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/System/11.rsync-ssh/ class=md-nav__link> <span class=md-ellipsis> 11.rsync ssh使用 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/System/12.%E5%90%84%E5%A4%A7%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%81%9ARAID/ class=md-nav__link> <span class=md-ellipsis> 各大服务器做RAID </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8_7> <label class=md-nav__link for=__nav_8_7 id=__nav_8_7_label tabindex=0> <span class=md-ellipsis> Serveices </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_8_7_label aria-expanded=false> <label class=md-nav__title for=__nav_8_7> <span class="md-nav__icon md-icon"></span> Serveices </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Linux/Serveices/0.ubuntu-desktop-vmware/ class=md-nav__link> <span class=md-ellipsis> ubuntu-desktop-vmware </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_9> <label class=md-nav__link for=__nav_9 id=__nav_9_label tabindex> <span class=md-ellipsis> Other </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_9_label aria-expanded=false> <label class=md-nav__title for=__nav_9> <span class="md-nav__icon md-icon"></span> Other </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_9_1> <label class=md-nav__link for=__nav_9_1 id=__nav_9_1_label tabindex=0> <span class=md-ellipsis> tools </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_9_1_label aria-expanded=false> <label class=md-nav__title for=__nav_9_1> <span class="md-nav__icon md-icon"></span> tools </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Other/tools/1.PicGo%E5%9B%BE%E5%BA%8A/ class=md-nav__link> <span class=md-ellipsis> 1.PicGo图床 </span> </a> </li> <li class=md-nav__item> <a href=../../../Other/tools/2.PicX%E5%9B%BE%E5%BA%8A/ class=md-nav__link> <span class=md-ellipsis> 2.Picx图床 </span> </a> </li> <li class=md-nav__item> <a href=../../../Other/tools/3.Markdown%E8%AF%AD%E6%B3%95/ class=md-nav__link> <span class=md-ellipsis> 3.Markdown语法 </span> </a> </li> <li class=md-nav__item> <a href=../../../Other/tools/4.KeyManager/ class=md-nav__link> <span class=md-ellipsis> 4.KeyManager </span> </a> </li> <li class=md-nav__item> <a href=../../../Other/tools/5.mkdocs-material%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2/ class=md-nav__link> <span class=md-ellipsis> 5.mkdocs-material搭建博客 </span> </a> </li> <li class=md-nav__item> <a href=../../../Other/tools/6.sphinx%E6%9E%84%E5%BB%BA%E5%8D%9A%E5%AE%A2/ class=md-nav__link> <span class=md-ellipsis> 6.sphinx构建博客 </span> </a> </li> <li class=md-nav__item> <a href=../../../Other/tools/7.%E4%BC%81%E4%B8%9A%E7%BA%A7VPN%E8%BD%AF%E4%BB%B6AnyLink/ class=md-nav__link> <span class=md-ellipsis> 7.企业级VPN软件AnyLink </span> </a> </li> <li class=md-nav__item> <a href=../../../Other/tools/8.%E5%B9%B3%E5%8F%B0%E5%8F%8A%E5%B7%A5%E5%85%B7%E6%B1%87%E6%80%BB/ class=md-nav__link> <span class=md-ellipsis> 8.平台及工具汇总 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_9_2> <label class=md-nav__link for=__nav_9_2 id=__nav_9_2_label tabindex=0> <span class=md-ellipsis> windows </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_9_2_label aria-expanded=false> <label class=md-nav__title for=__nav_9_2> <span class="md-nav__icon md-icon"></span> windows </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Other/windows/1.%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6%E4%B8%8B%E8%BD%BD/ class=md-nav__link> <span class=md-ellipsis> 1.常用软件下载 </span> </a> </li> <li class=md-nav__item> <a href=../../../Other/windows/2.windows%E6%9F%A5%E7%9C%8B%E7%AB%AF%E5%8F%A3%E5%8D%A0%E7%94%A8/ class=md-nav__link> <span class=md-ellipsis> 2.windows查看端口占用 </span> </a> </li> <li class=md-nav__item> <a href=../../../Other/windows/3.Win11%E9%95%9C%E5%83%8F%E4%B8%8B%E8%BD%BD%E3%80%81%E5%A3%81%E7%BA%B8%E5%8F%8AKMS%E6%BF%80%E6%B4%BB/ class=md-nav__link> <span class=md-ellipsis> 3.Win11镜像下载、壁纸及KMS激活 </span> </a> </li> <li class=md-nav__item> <a href=../../../Other/windows/4.windows%E4%B8%8Bnetcat%E5%AE%89%E8%A3%85/ class=md-nav__link> <span class=md-ellipsis> 4.windows下netcat安装 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#1prometheus的架构介绍 class=md-nav__link> <span class=md-ellipsis> 1.Prometheus的架构介绍 </span> </a> </li> <li class=md-nav__item> <a href=#2prometheus的安装 class=md-nav__link> <span class=md-ellipsis> 2.Prometheus的安装 </span> </a> </li> <li class=md-nav__item> <a href=#3云原生和非云原生应用的监控流程 class=md-nav__link> <span class=md-ellipsis> 3.云原生和非云原生应用的监控流程 </span> </a> <nav class=md-nav aria-label=3.云原生和非云原生应用的监控流程> <ul class=md-nav__list> <li class=md-nav__item> <a href=#31-监控数据来源 class=md-nav__link> <span class=md-ellipsis> 3.1 监控数据来源 </span> </a> </li> <li class=md-nav__item> <a href=#32-什么是servicemonitor class=md-nav__link> <span class=md-ellipsis> 3.2 什么是ServiceMonitor </span> </a> </li> <li class=md-nav__item> <a href=#33-servicemonitor找不到监控主机排查 class=md-nav__link> <span class=md-ellipsis> 3.3 ServiceMonitor找不到监控主机排查 </span> </a> </li> <li class=md-nav__item> <a href=#34-云原生应用监控 class=md-nav__link> <span class=md-ellipsis> 3.4 云原生应用监控 </span> </a> </li> <li class=md-nav__item> <a href=#35-非云原生监控exporter class=md-nav__link> <span class=md-ellipsis> 3.5 非云原生监控Exporter </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#4黑盒监控 class=md-nav__link> <span class=md-ellipsis> 4.黑盒监控 </span> </a> </li> <li class=md-nav__item> <a href=#5prometheus静态配置 class=md-nav__link> <span class=md-ellipsis> 5.Prometheus静态配置 </span> </a> </li> <li class=md-nav__item> <a href=#6prometheus监控windows外部主机 class=md-nav__link> <span class=md-ellipsis> 6.Prometheus监控Windows(外部)主机 </span> </a> </li> <li class=md-nav__item> <a href=#7prometheus语法promql入门 class=md-nav__link> <span class=md-ellipsis> 7.Prometheus语法PromQL入门 </span> </a> <nav class=md-nav aria-label=7.Prometheus语法PromQL入门> <ul class=md-nav__list> <li class=md-nav__item> <a href=#71-promql语法初体验 class=md-nav__link> <span class=md-ellipsis> 7.1 PromQL语法初体验 </span> </a> </li> <li class=md-nav__item> <a href=#72-promql操作符 class=md-nav__link> <span class=md-ellipsis> 7.2 PromQL操作符 </span> </a> </li> <li class=md-nav__item> <a href=#73-promql常用函数 class=md-nav__link> <span class=md-ellipsis> 7.3 PromQL常用函数 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#8alertmanager告警入门 class=md-nav__link> <span class=md-ellipsis> 8.Alertmanager告警入门 </span> </a> <nav class=md-nav aria-label=8.Alertmanager告警入门> <ul class=md-nav__list> <li class=md-nav__item> <a href=#81-alertmanager配置文件解析 class=md-nav__link> <span class=md-ellipsis> 8.1 Alertmanager配置文件解析 </span> </a> </li> <li class=md-nav__item> <a href=#82-alertmanager路由规则 class=md-nav__link> <span class=md-ellipsis> 8.2 Alertmanager路由规则 </span> </a> </li> <li class=md-nav__item> <a href=#83-alertmanager邮件通知 class=md-nav__link> <span class=md-ellipsis> 8.3 Alertmanager邮件通知 </span> </a> </li> <li class=md-nav__item> <a href=#84-alertmanager企业微信通知 class=md-nav__link> <span class=md-ellipsis> 8.4 Alertmanager企业微信通知 </span> </a> </li> <li class=md-nav__item> <a href=#85-自定义告警模板 class=md-nav__link> <span class=md-ellipsis> 8.5 自定义告警模板 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#9prometheus告警实战 class=md-nav__link> <span class=md-ellipsis> 9.Prometheus告警实战 </span> </a> <nav class=md-nav aria-label=9.Prometheus告警实战> <ul class=md-nav__list> <li class=md-nav__item> <a href=#91-prometheusrule class=md-nav__link> <span class=md-ellipsis> 9.1 PrometheusRule </span> </a> </li> <li class=md-nav__item> <a href=#92-告警通用配置步骤 class=md-nav__link> <span class=md-ellipsis> 9.2 告警通用配置步骤 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=kubernetes监控告警>Kubernetes监控告警<a class=headerlink href=#kubernetes监控告警 title="Permanent link">&para;</a></h1> <p>本章将带领读者学习如何对Kubernetes集群以及部署的应用进行监控。</p> <p>传统架构中比较流行的监控工具有Zabbix、Nagios等，这些监控工具对于Kubernetes这类云平台监控不是很友好，特别是当Kubernetes集群中有了成千上万的容器后更是如此，本章将带领读者学习下一代的云原生监控平台—Prometheus。</p> <h2 id=1prometheus的架构介绍>1.Prometheus的架构介绍<a class=headerlink href=#1prometheus的架构介绍 title="Permanent link">&para;</a></h2> <p>Prometheus是一个开源的系统监控和报警框架，其本身也是一个时间序列数据库（Time Series Database，TSDB),它的设计灵感来源于Google的Borgmon，就像Kubernetes是基于Borg系统开源的。</p> <p>Prometheus是由Sound Cloud的Google前员工设计并开源的，官方网站为https://prometheus.io/。 Prometheus于2016年加入云原生计算基金会（Cloud Native Computing Foundation，CNCF）,成为受欢迎程度仅次于Kubernetes的开源项目。</p> <p>该项目拥有非常活跃的开发者和用户社区，目前已经被很多公司采用，并且部分公司也参与了该项目的维护。</p> <p>Prometheus被称为下一代的监控平台，具有很多和“老牌”监控不一样的特性，比如：</p> <ul> <li>一个多维的数据模型，具有由指标名称和键-值对标识的时间序列数据。</li> <li>使用PromQL查询和聚合数据，可以非常灵活地对数据进行检索。</li> <li>不依赖额外的数据存储，Prometheus本身就是一个时序数据库，提供本地存储和分布式存储，并且每个Prometheus都是自治的。</li> <li>应用程序暴露Metrics接口，Prometheus通过基于HTTP的Pull模型采集数据。</li> <li>同时可以使用PushGateway进行Push数据。</li> <li>Prometheus同时支持动态服务和静态配置发现目标机器。</li> <li>支持多种图形和仪表盘，和Grafana堪称“绝配”</li> </ul> <p>Prometheus生态系统由多个组件组成，其架构图如图15.1所示。</p> <p><img alt class=zoom src=../../../assets/static/kubernetes/5/15-1-prometheus.png> 图15.1　Prometheus架构</p> <p>虽然Prometheus的组件有很多，但是很多组件都是可选的，所以Prometheus要比其他监控平台更灵活。接下来看一下每个组件的用途。</p> <p>Prometheus Server：Prometheus生态最重要的组件，主要用于抓取和存储时间序列数据，同时提供数据的查询和告警策略的配置管 理。</p> <ul> <li> <p>Alertmanager：Prometheus生态用于告警的组件，Prometheus Server会将告警发送给Alertmanager，Alertmanager根据路由配置 将告警信息发送给指定的人或组。Alertmanager支持邮件、Webhook、微信、钉钉、短信等媒介进行告警通知。</p> </li> <li> <p>Grafana：用于展示数据，便于数据的查询和观测。</p> </li> <li> <p>Push Gateway：Prometheus本身是通过Pull的方式拉取数据的，但是有些监控数据可能是短期的，如果没有采集数据可能会出现丢 失。Push Gateway可以用来解决此类问题，它可以用来接收数据，也就是客户端可以通过Push的方式将数据推送到Push Gateway，之后Prometheus可以通过Pull拉取该数据。</p> </li> <li> <p>Exporter：主要用来采集监控数据，比如主机的监控数据可以通过node_exporter采集，MySQL的监控数据可以通过mysql_exporter采集，之后Exporter暴露一个接口，比如/metrics，Prometheus可以通过该接口采集到数据。</p> </li> <li> <p>PromQL：PromQL其实不算Prometheus的组件，它是用来查询数据的 一种语法，比如可以通过SQL语句查询数据库的数据，通过LogQL语句查询Loki的数据，通过PromQL语句查询Prometheus的数据。</p> </li> <li> <p>Service Discovery：用来发现监控目标的自动发现，常用的有基于Kubernetes、Consul、Eureka、文件的自动发现等。</p> </li> </ul> <p>以上对Prometheus进行了简单的介绍，接下来我们上手体验Prometheus的强大之处。</p> <h2 id=2prometheus的安装>2.Prometheus的安装<a class=headerlink href=#2prometheus的安装 title="Permanent link">&para;</a></h2> <p>Prometheus有多种安装方式，比如二进制安装、容器安装和Kubernetes 集群中安装，由于本书是基于Kubernetes展开的，因此会将Prometheus安装到Kubernetes集群中，当然这也是官方推荐的部署方式。</p> <p>将Prometheus安装到Kubernetes集群也有很多方式，比如之前提到过的Helm、Operator等，Prometheus也是支持上述安装方式的。</p> <p>但是Prometheus是一个生态系统，有很多组件都需要安装，并且也有很多监控需要单独配置，于是Prometheus官方开源了一个kube-prometheus项目，该项目不仅仅是用来安装Prometheus的，也包含很多其他的组件，如下所示：</p> <ul> <li>Prometheus Operator。</li> <li>高可用的Prometheus。</li> <li>高可用的Alertmanager。</li> <li>主机监控Node Exporter。</li> <li>Prometheus Adapter。</li> <li>容器监控kube-state-metrics。</li> <li>图形化展示Grafana。</li> </ul> <p>具体可以通过https://github.com/prometheus-operator/kube-prometheus/找到该项目进行查看。</p> <p>有了kube-prometheus项目，对其的安装也变得非常简单，只需要两条命令即可。</p> <p>首先需要通过该项目地址找到和自己Kubernetes版本对应的Kube Prometheus Stack的版本，如图15.2所示。</p> <p><img alt class=zoom src=../../../assets/static/kubernetes/5/15-2-prometheus.png></p> <p>图15.2　Prometheus版本选择</p> <p>之后将该项目对应分支克隆到本地：</p> <p>kubernetes1.21使用如下方式 <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a>$<span class=w> </span>git<span class=w> </span>clone<span class=w> </span>-b<span class=w> </span>release-0.9<span class=w> </span>https://github.com/prometheus-operator/kube-prometheus.git
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>$<span class=w> </span><span class=nb>cd</span><span class=w> </span>kube-prometheus/manifests
</code></pre></div></p> <p>kubernetes1.20使用如下方式 <div class=highlight><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a>$<span class=w> </span>git<span class=w> </span>clone<span class=w> </span>https://github.com/prometheus-operator/kube-prometheus.git
<a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a>$<span class=w> </span><span class=nb>cd</span><span class=w> </span>kube-prometheus
<a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a>$<span class=w> </span>git<span class=w> </span>checkout<span class=w> </span>-b<span class=w> </span>origin/release-0.8<span class=w> </span>remotes/origin/release-0.8
<a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a>$<span class=w> </span><span class=nb>cd</span><span class=w> </span>manifests/
</code></pre></div></p> <p>首先安装Prometheus Operator：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a>$<span class=w> </span>kubectl<span class=w> </span>create<span class=w> </span>-f<span class=w> </span>setup/
<a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a>namespace/monitoring<span class=w> </span>created
<a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a>...
<a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a>deployment.apps/prometheus-operator<span class=w> </span>created
<a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a>service/prometheus-operator<span class=w> </span>created
<a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a>serviceaccount/prometheus-operator<span class=w> </span>created
</code></pre></div> <p>查看Operator容器的状态：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>pod<span class=w> </span>-n<span class=w> </span>monitoring
<a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a>NAME<span class=w>                                   </span>READY<span class=w>   </span>STATUS<span class=w>    </span>RESTARTS<span class=w>   </span>AGE
<a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a>prometheus-operator-75d9b475d9-pk8qb<span class=w>   </span><span class=m>2</span>/2<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>4m16s
</code></pre></div> <p><strong>数据持久化</strong></p> <p>配置prometheus持久化的配置清单：</p> <p>prometheus-prometheus.yaml</p> <div class=highlight><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">quay.io/prometheus/prometheus:v2.26.0</span>
<a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=w>  </span><span class=nt>env</span><span class=p>:</span>
<a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">TZ</span>
<a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a><span class=w>    </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Asia/Shanghai&quot;</span>
<a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a><span class="l l-Scalar l-Scalar-Plain">......</span>
<a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a><span class=w>  </span><span class="l l-Scalar l-Scalar-Plain">retention</span><span class="p p-Indicator">:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">15d</span>
<a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a><span class=w>  </span><span class="l l-Scalar l-Scalar-Plain">storage</span><span class="p p-Indicator">:</span>
<a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a><span class=w>    </span><span class=nt>volumeClaimTemplate</span><span class=p>:</span>
<a id=__codelineno-4-9 name=__codelineno-4-9 href=#__codelineno-4-9></a><span class=w>      </span><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-4-10 name=__codelineno-4-10 href=#__codelineno-4-10></a><span class=w>        </span><span class=nt>storageClassName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">gitee-nfs-client</span>
<a id=__codelineno-4-11 name=__codelineno-4-11 href=#__codelineno-4-11></a><span class=w>        </span><span class=nt>resources</span><span class=p>:</span>
<a id=__codelineno-4-12 name=__codelineno-4-12 href=#__codelineno-4-12></a><span class=w>          </span><span class=nt>requests</span><span class=p>:</span>
<a id=__codelineno-4-13 name=__codelineno-4-13 href=#__codelineno-4-13></a><span class=w>            </span><span class=nt>storage</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">20Gi</span>
</code></pre></div> <p>配置grafana持久化的配置清单：</p> <p>grafana-pvc.yaml</p> <div class=highlight><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a>$<span class=w> </span>mkdir<span class=w> </span>grafana-pvc<span class=w> </span>
<a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a>$<span class=w> </span>vim<span class=w> </span>grafana-pvc.yaml
</code></pre></div> <div class=highlight><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
<a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">grafana-pvc</span>
<a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">monitoring</span>
<a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a><span class=w>  </span><span class=nt>accessModes</span><span class=p>:</span>
<a id=__codelineno-6-8 name=__codelineno-6-8 href=#__codelineno-6-8></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteMany</span>
<a id=__codelineno-6-9 name=__codelineno-6-9 href=#__codelineno-6-9></a><span class=w>  </span><span class=nt>resources</span><span class=p>:</span>
<a id=__codelineno-6-10 name=__codelineno-6-10 href=#__codelineno-6-10></a><span class=w>    </span><span class=nt>requests</span><span class=p>:</span>
<a id=__codelineno-6-11 name=__codelineno-6-11 href=#__codelineno-6-11></a><span class=w>      </span><span class=nt>storage</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">20M</span>
<a id=__codelineno-6-12 name=__codelineno-6-12 href=#__codelineno-6-12></a><span class=w>  </span><span class=nt>storageClassName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">gitee-nfs-client</span>
</code></pre></div> <p>grafana-deployment.yaml</p> <div class=highlight><pre><span></span><code><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class="l l-Scalar l-Scalar-Plain">.......</span>
<a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a>
<a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">spec</span><span class="p p-Indicator">:</span>
<a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a><span class=w>      </span><span class=nt>containers</span><span class=p>:</span>
<a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a><span class=w>      </span><span class=c1># 固定grafana的登陆密码</span>
<a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>env</span><span class=p>:</span>
<a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a><span class=w>         </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">GF_SECURITY_ADMIN_USER</span>
<a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a><span class=w>            </span><span class="l l-Scalar l-Scalar-Plain">value</span><span class="p p-Indicator">:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">admin</span>
<a id=__codelineno-7-9 name=__codelineno-7-9 href=#__codelineno-7-9></a><span class=w>         </span><span class="w w-Error"> </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">GF_SECURITY_ADMIN_PASSWORD</span>
<a id=__codelineno-7-10 name=__codelineno-7-10 href=#__codelineno-7-10></a><span class=w>            </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">oschina123</span>
<a id=__codelineno-7-11 name=__codelineno-7-11 href=#__codelineno-7-11></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">TZ</span>
<a id=__codelineno-7-12 name=__codelineno-7-12 href=#__codelineno-7-12></a><span class=w>            </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Asia/Shanghai</span>
<a id=__codelineno-7-13 name=__codelineno-7-13 href=#__codelineno-7-13></a><span class=w>        </span><span class=c1># image: grafana/grafana:8.1.1</span>
<a id=__codelineno-7-14 name=__codelineno-7-14 href=#__codelineno-7-14></a><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">grafana/grafana:8.4.7</span>
<a id=__codelineno-7-15 name=__codelineno-7-15 href=#__codelineno-7-15></a><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">grafana</span>
<a id=__codelineno-7-16 name=__codelineno-7-16 href=#__codelineno-7-16></a><span class=w>        </span><span class=nt>ports</span><span class=p>:</span>
<a id=__codelineno-7-17 name=__codelineno-7-17 href=#__codelineno-7-17></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3000</span>
<a id=__codelineno-7-18 name=__codelineno-7-18 href=#__codelineno-7-18></a><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">http</span>
<a id=__codelineno-7-19 name=__codelineno-7-19 href=#__codelineno-7-19></a><span class=w>        </span><span class=nt>readinessProbe</span><span class=p>:</span>
<a id=__codelineno-7-20 name=__codelineno-7-20 href=#__codelineno-7-20></a><span class=w>          </span><span class=nt>httpGet</span><span class=p>:</span>
<a id=__codelineno-7-21 name=__codelineno-7-21 href=#__codelineno-7-21></a><span class=w>            </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/api/health</span>
<a id=__codelineno-7-22 name=__codelineno-7-22 href=#__codelineno-7-22></a><span class=w>            </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">http</span>
<a id=__codelineno-7-23 name=__codelineno-7-23 href=#__codelineno-7-23></a><span class=w>        </span><span class=nt>resources</span><span class=p>:</span>
<a id=__codelineno-7-24 name=__codelineno-7-24 href=#__codelineno-7-24></a><span class=w>          </span><span class=nt>limits</span><span class=p>:</span>
<a id=__codelineno-7-25 name=__codelineno-7-25 href=#__codelineno-7-25></a><span class=w>            </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">200m</span>
<a id=__codelineno-7-26 name=__codelineno-7-26 href=#__codelineno-7-26></a><span class=w>            </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">200Mi</span>
<a id=__codelineno-7-27 name=__codelineno-7-27 href=#__codelineno-7-27></a><span class=w>          </span><span class=nt>requests</span><span class=p>:</span>
<a id=__codelineno-7-28 name=__codelineno-7-28 href=#__codelineno-7-28></a><span class=w>            </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">100m</span>
<a id=__codelineno-7-29 name=__codelineno-7-29 href=#__codelineno-7-29></a><span class=w>            </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">100Mi</span>
<a id=__codelineno-7-30 name=__codelineno-7-30 href=#__codelineno-7-30></a><span class=w>      </span><span class="l l-Scalar l-Scalar-Plain">.......</span>
<a id=__codelineno-7-31 name=__codelineno-7-31 href=#__codelineno-7-31></a>
<a id=__codelineno-7-32 name=__codelineno-7-32 href=#__codelineno-7-32></a><span class=w>      </span><span class=nt>nodeSelector</span><span class=p>:</span>
<a id=__codelineno-7-33 name=__codelineno-7-33 href=#__codelineno-7-33></a><span class=w>        </span><span class=nt>kubernetes.io/os</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">linux</span>
<a id=__codelineno-7-34 name=__codelineno-7-34 href=#__codelineno-7-34></a><span class=w>      </span><span class=nt>securityContext</span><span class=p>:</span>
<a id=__codelineno-7-35 name=__codelineno-7-35 href=#__codelineno-7-35></a><span class=w>        </span><span class=nt>fsGroup</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">65534</span>
<a id=__codelineno-7-36 name=__codelineno-7-36 href=#__codelineno-7-36></a><span class=w>        </span><span class=nt>runAsNonRoot</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id=__codelineno-7-37 name=__codelineno-7-37 href=#__codelineno-7-37></a><span class=w>        </span><span class=nt>runAsUser</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">65534</span>
<a id=__codelineno-7-38 name=__codelineno-7-38 href=#__codelineno-7-38></a><span class=w>      </span><span class=nt>serviceAccountName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">grafana</span>
<a id=__codelineno-7-39 name=__codelineno-7-39 href=#__codelineno-7-39></a><span class=w>      </span><span class=nt>volumes</span><span class=p>:</span>
<a id=__codelineno-7-40 name=__codelineno-7-40 href=#__codelineno-7-40></a><span class=w>      </span><span class=c1># 持久化pvc</span>
<a id=__codelineno-7-41 name=__codelineno-7-41 href=#__codelineno-7-41></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">grafana-storage</span>
<a id=__codelineno-7-42 name=__codelineno-7-42 href=#__codelineno-7-42></a><span class=w>        </span><span class=nt>persistentVolumeClaim</span><span class=p>:</span>
<a id=__codelineno-7-43 name=__codelineno-7-43 href=#__codelineno-7-43></a><span class=w>          </span><span class=nt>claimName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">grafana-pvc</span>
<a id=__codelineno-7-44 name=__codelineno-7-44 href=#__codelineno-7-44></a><span class="l l-Scalar l-Scalar-Plain">.......</span>
</code></pre></div> <p>配置alertmanager持久化的配置清单：</p> <p>alertmanager-alertmanager.yaml</p> <div class=highlight><pre><span></span><code><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class="l l-Scalar l-Scalar-Plain">....</span>
<a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a><span class=w>  </span><span class="l l-Scalar l-Scalar-Plain">retention</span><span class="p p-Indicator">:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">24h</span>
<a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a><span class=w>  </span><span class="l l-Scalar l-Scalar-Plain">storage</span><span class="p p-Indicator">:</span>
<a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a><span class=w>    </span><span class=nt>volumeClaimTemplate</span><span class=p>:</span>
<a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a><span class=w>      </span><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a><span class=w>        </span><span class=nt>storageClassName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">gitee-nfs-client</span>
<a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a><span class=w>        </span><span class=nt>resources</span><span class=p>:</span>
<a id=__codelineno-8-8 name=__codelineno-8-8 href=#__codelineno-8-8></a><span class=w>          </span><span class=nt>requests</span><span class=p>:</span>
<a id=__codelineno-8-9 name=__codelineno-8-9 href=#__codelineno-8-9></a><span class=w>            </span><span class=nt>storage</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10Gi</span>
</code></pre></div> <div class="admonition abstract"> <p class=admonition-title>参考文献</p> <p><a href=https://www.lhl.zone/virtualization/kube-prometheus/102.html>https://www.lhl.zone/virtualization/kube-prometheus/102.html</a></p> </div> <p>Operator容器启动后，安装Prometheus Stack：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a>$<span class=w> </span>kubectl<span class=w> </span>create<span class=w> </span>-f<span class=w> </span>.
<a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a>alertmanager.monitoring.coreos.com/main<span class=w> </span>created
<a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a>Warning:<span class=w> </span>policy/v1beta1<span class=w> </span>PodDisruptionBudget<span class=w> </span>is<span class=w> </span>deprecated<span class=w> </span><span class=k>in</span><span class=w> </span>v1.21+,<span class=w> </span>unavailable<span class=w> </span><span class=k>in</span><span class=w> </span>v1.25+<span class=p>;</span><span class=w> </span>use<span class=w> </span>policy/v1<span class=w> </span>PodDisruptionBudget
<a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a>poddisruptionbudget.policy/alertmanager-main<span class=w> </span>created
<a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a>prometheusrule.monitoring.coreos.com/alertmanager-main-rules<span class=w> </span>created
<a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a>....
<a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a>role.rbac.authorization.k8s.io/prometheus-k8s-config<span class=w> </span>created
<a id=__codelineno-9-8 name=__codelineno-9-8 href=#__codelineno-9-8></a>role.rbac.authorization.k8s.io/prometheus-k8s<span class=w> </span>created
<a id=__codelineno-9-9 name=__codelineno-9-9 href=#__codelineno-9-9></a>role.rbac.authorization.k8s.io/prometheus-k8s<span class=w> </span>created
<a id=__codelineno-9-10 name=__codelineno-9-10 href=#__codelineno-9-10></a>role.rbac.authorization.k8s.io/prometheus-k8s<span class=w> </span>created
<a id=__codelineno-9-11 name=__codelineno-9-11 href=#__codelineno-9-11></a>service/prometheus-k8s<span class=w> </span>created
<a id=__codelineno-9-12 name=__codelineno-9-12 href=#__codelineno-9-12></a>serviceaccount/prometheus-k8s<span class=w> </span>created
<a id=__codelineno-9-13 name=__codelineno-9-13 href=#__codelineno-9-13></a>servicemonitor.monitoring.coreos.com/prometheus-k8s<span class=w> </span>created
</code></pre></div> <p>不过需要注意有一些资源的镜像来自于 <code>k8s.gcr.io</code>，如果不能正常拉取，则可以将镜像替换成可拉取的：</p> <ul> <li><code>prometheusAdapter-deployment.yaml</code>：将 <code>image: k8s.gcr.io/prometheus-adapter/prometheus-adapter:v0.9.1</code> 替换为 <code>cnych/prometheus-adapter:v0.9.1</code></li> <li><code>kubeStateMetrics-deployment.yaml</code>：将 <code>image: k8s.gcr.io/kube-state-metrics/kube-state-metrics:v2.4.2</code> 替换为 <code>cnych/kube-state-metrics:v2.4.2</code></li> </ul> <div class=highlight><pre><span></span><code><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a>$<span class=w> </span>sed<span class=w> </span><span class=s1>&#39;s#k8s.gcr.io/kube-state-metrics/kube-state-metrics:v2.1.1#cnych/kube-state-metrics:v2.4.2#g&#39;</span><span class=w> </span>-i<span class=w> </span>*.yaml
<a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a>$<span class=w> </span>sed<span class=w> </span><span class=s1>&#39;s#k8s.gcr.io/prometheus-adapter/prometheus-adapter:v0.9.0#cnych/prometheus-adapter:v0.9.1#g&#39;</span><span class=w> </span>-i<span class=w> </span>*.yaml
</code></pre></div> <p>这会自动安装 prometheus-operator、node-exporter、kube-state-metrics、grafana、prometheus-adapter 以及 prometheus 和 alertmanager 等大量组件，如果没成功可以多次执行上面的安装命令。</p> <p>查看Prometheus容器的状态：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>pods<span class=w> </span>-n<span class=w> </span>monitoring
<a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a>NAME<span class=w>                                   </span>READY<span class=w>   </span>STATUS<span class=w>    </span>RESTARTS<span class=w>   </span>AGE
<a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a>alertmanager-main-0<span class=w>                    </span><span class=m>2</span>/2<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>6m41s
<a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a>alertmanager-main-1<span class=w>                    </span><span class=m>2</span>/2<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>6m41s
<a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a>alertmanager-main-2<span class=w>                    </span><span class=m>2</span>/2<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>6m41s
<a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a>blackbox-exporter-6798fb5bb4-9rg5s<span class=w>     </span><span class=m>3</span>/3<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>6m41s
<a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a>grafana-7476b4c65b-6qrxh<span class=w>               </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>6m40s
<a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a>kube-state-metrics-64c7ff87dc-8b4bs<span class=w>    </span><span class=m>3</span>/3<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>6m40s
<a id=__codelineno-11-9 name=__codelineno-11-9 href=#__codelineno-11-9></a>node-exporter-2f2h2<span class=w>                    </span><span class=m>2</span>/2<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>6m40s
<a id=__codelineno-11-10 name=__codelineno-11-10 href=#__codelineno-11-10></a>node-exporter-2zcbr<span class=w>                    </span><span class=m>2</span>/2<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>6m40s
<a id=__codelineno-11-11 name=__codelineno-11-11 href=#__codelineno-11-11></a>node-exporter-5txxx<span class=w>                    </span><span class=m>2</span>/2<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>6m40s
<a id=__codelineno-11-12 name=__codelineno-11-12 href=#__codelineno-11-12></a>node-exporter-7wxp6<span class=w>                    </span><span class=m>2</span>/2<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>6m40s
<a id=__codelineno-11-13 name=__codelineno-11-13 href=#__codelineno-11-13></a>node-exporter-99wrh<span class=w>                    </span><span class=m>2</span>/2<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>6m40s
<a id=__codelineno-11-14 name=__codelineno-11-14 href=#__codelineno-11-14></a>node-exporter-dcfdn<span class=w>                    </span><span class=m>2</span>/2<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>6m40s
<a id=__codelineno-11-15 name=__codelineno-11-15 href=#__codelineno-11-15></a>node-exporter-g7hl9<span class=w>                    </span><span class=m>2</span>/2<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>6m40s
<a id=__codelineno-11-16 name=__codelineno-11-16 href=#__codelineno-11-16></a>node-exporter-hsgwx<span class=w>                    </span><span class=m>2</span>/2<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>6m40s
<a id=__codelineno-11-17 name=__codelineno-11-17 href=#__codelineno-11-17></a>node-exporter-jp8qs<span class=w>                    </span><span class=m>2</span>/2<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>6m40s
<a id=__codelineno-11-18 name=__codelineno-11-18 href=#__codelineno-11-18></a>prometheus-adapter-77774d7447-r7m9p<span class=w>    </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>6m40s
<a id=__codelineno-11-19 name=__codelineno-11-19 href=#__codelineno-11-19></a>prometheus-adapter-77774d7447-xjcm5<span class=w>    </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>6m40s
<a id=__codelineno-11-20 name=__codelineno-11-20 href=#__codelineno-11-20></a>prometheus-k8s-0<span class=w>                       </span><span class=m>2</span>/2<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>6m39s
<a id=__codelineno-11-21 name=__codelineno-11-21 href=#__codelineno-11-21></a>prometheus-k8s-1<span class=w>                       </span><span class=m>2</span>/2<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>6m39s
<a id=__codelineno-11-22 name=__codelineno-11-22 href=#__codelineno-11-22></a>prometheus-operator-75d9b475d9-pk8qb<span class=w>   </span><span class=m>2</span>/2<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>97m
<a id=__codelineno-11-23 name=__codelineno-11-23 href=#__codelineno-11-23></a>
<a id=__codelineno-11-24 name=__codelineno-11-24 href=#__codelineno-11-24></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>svc<span class=w> </span>-n<span class=w> </span>monitoring
<a id=__codelineno-11-25 name=__codelineno-11-25 href=#__codelineno-11-25></a>NAME<span class=w>                    </span>TYPE<span class=w>        </span>CLUSTER-IP<span class=w>       </span>EXTERNAL-IP<span class=w>   </span>PORT<span class=o>(</span>S<span class=o>)</span><span class=w>                      </span>AGE
<a id=__codelineno-11-26 name=__codelineno-11-26 href=#__codelineno-11-26></a>alertmanager-main<span class=w>       </span>ClusterIP<span class=w>   </span><span class=m>10</span>.111.159.143<span class=w>   </span>&lt;none&gt;<span class=w>        </span><span class=m>9093</span>/TCP<span class=w>                     </span>6m58s
<a id=__codelineno-11-27 name=__codelineno-11-27 href=#__codelineno-11-27></a>alertmanager-operated<span class=w>   </span>ClusterIP<span class=w>   </span>None<span class=w>             </span>&lt;none&gt;<span class=w>        </span><span class=m>9093</span>/TCP,9094/TCP,9094/UDP<span class=w>   </span>6m58s
<a id=__codelineno-11-28 name=__codelineno-11-28 href=#__codelineno-11-28></a>blackbox-exporter<span class=w>       </span>ClusterIP<span class=w>   </span><span class=m>10</span>.103.27.127<span class=w>    </span>&lt;none&gt;<span class=w>        </span><span class=m>9115</span>/TCP,19115/TCP<span class=w>           </span>6m58s
<a id=__codelineno-11-29 name=__codelineno-11-29 href=#__codelineno-11-29></a>grafana<span class=w>                 </span>ClusterIP<span class=w>   </span><span class=m>10</span>.102.99.88<span class=w>     </span>&lt;none&gt;<span class=w>        </span><span class=m>3000</span>/TCP<span class=w>                     </span>6m57s
<a id=__codelineno-11-30 name=__codelineno-11-30 href=#__codelineno-11-30></a>kube-state-metrics<span class=w>      </span>ClusterIP<span class=w>   </span>None<span class=w>             </span>&lt;none&gt;<span class=w>        </span><span class=m>8443</span>/TCP,9443/TCP<span class=w>            </span>6m57s
<a id=__codelineno-11-31 name=__codelineno-11-31 href=#__codelineno-11-31></a>node-exporter<span class=w>           </span>ClusterIP<span class=w>   </span>None<span class=w>             </span>&lt;none&gt;<span class=w>        </span><span class=m>9100</span>/TCP<span class=w>                     </span>6m57s
<a id=__codelineno-11-32 name=__codelineno-11-32 href=#__codelineno-11-32></a>prometheus-adapter<span class=w>      </span>ClusterIP<span class=w>   </span><span class=m>10</span>.110.138.216<span class=w>   </span>&lt;none&gt;<span class=w>        </span><span class=m>443</span>/TCP<span class=w>                      </span>6m57s
<a id=__codelineno-11-33 name=__codelineno-11-33 href=#__codelineno-11-33></a>prometheus-k8s<span class=w>          </span>ClusterIP<span class=w>   </span><span class=m>10</span>.106.193.178<span class=w>   </span>&lt;none&gt;<span class=w>        </span><span class=m>9090</span>/TCP<span class=w>                     </span>6m56s
<a id=__codelineno-11-34 name=__codelineno-11-34 href=#__codelineno-11-34></a>prometheus-operated<span class=w>     </span>ClusterIP<span class=w>   </span>None<span class=w>             </span>&lt;none&gt;<span class=w>        </span><span class=m>9090</span>/TCP<span class=w>                     </span>6m56s
<a id=__codelineno-11-35 name=__codelineno-11-35 href=#__codelineno-11-35></a>prometheus-operator<span class=w>     </span>ClusterIP<span class=w>   </span>None<span class=w>             </span>&lt;none&gt;<span class=w>        </span><span class=m>8443</span>/TCP<span class=w>                     </span>97m
</code></pre></div> <p>待容器全部下载完成(首次安装镜像下载可能会很慢)并且启动后，可以访问Grafana和Prometheus 。</p> <p>在执行安装时会自动创建Grafana和Prometheus的Service，可以通过NodePort或者Ingress的方式访问，在此演示的为NodePort方式。</p> <p>首先将Grafana的Service改成NodePort类型：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a>$<span class=w> </span>kubectl<span class=w> </span>edit<span class=w> </span>svc<span class=w> </span>grafana<span class=w> </span>-n<span class=w> </span>monitoring
<a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a><span class=w>  </span>selector:
<a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a><span class=w>    </span>app.kubernetes.io/component:<span class=w> </span>grafana
<a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a><span class=w>    </span>app.kubernetes.io/name:<span class=w> </span>grafana
<a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a><span class=w>    </span>app.kubernetes.io/part-of:<span class=w> </span>kube-prometheus
<a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a><span class=w>  </span>sessionAffinity:<span class=w> </span>None
<a id=__codelineno-12-7 name=__codelineno-12-7 href=#__codelineno-12-7></a><span class=w>  </span><span class=c1># 更改Grafana的Service类型</span>
<a id=__codelineno-12-8 name=__codelineno-12-8 href=#__codelineno-12-8></a><span class=w>  </span>type:<span class=w> </span>NodePort
</code></pre></div> <p>或者直接修改<code>grafana-service.yaml</code>文件内容 <div class=highlight><pre><span></span><code><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a><span class=w>  </span><span class=nt>labels</span><span class=p>:</span>
<a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a><span class=w>    </span><span class=nt>app.kubernetes.io/component</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">grafana</span>
<a id=__codelineno-13-6 name=__codelineno-13-6 href=#__codelineno-13-6></a><span class=w>    </span><span class=nt>app.kubernetes.io/name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">grafana</span>
<a id=__codelineno-13-7 name=__codelineno-13-7 href=#__codelineno-13-7></a><span class=w>    </span><span class=nt>app.kubernetes.io/part-of</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kube-prometheus</span>
<a id=__codelineno-13-8 name=__codelineno-13-8 href=#__codelineno-13-8></a><span class=w>    </span><span class=nt>app.kubernetes.io/version</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">7.5.4</span>
<a id=__codelineno-13-9 name=__codelineno-13-9 href=#__codelineno-13-9></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">grafana</span>
<a id=__codelineno-13-10 name=__codelineno-13-10 href=#__codelineno-13-10></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">monitoring</span>
<a id=__codelineno-13-11 name=__codelineno-13-11 href=#__codelineno-13-11></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-13-12 name=__codelineno-13-12 href=#__codelineno-13-12></a><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">NodePort</span>
<a id=__codelineno-13-13 name=__codelineno-13-13 href=#__codelineno-13-13></a><span class=w>  </span><span class=nt>ports</span><span class=p>:</span>
<a id=__codelineno-13-14 name=__codelineno-13-14 href=#__codelineno-13-14></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">http</span>
<a id=__codelineno-13-15 name=__codelineno-13-15 href=#__codelineno-13-15></a><span class=w>    </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3000</span>
<a id=__codelineno-13-16 name=__codelineno-13-16 href=#__codelineno-13-16></a><span class=w>    </span><span class=nt>nodePort</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">30030</span>
<a id=__codelineno-13-17 name=__codelineno-13-17 href=#__codelineno-13-17></a><span class=w>    </span><span class=nt>targetPort</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">http</span>
<a id=__codelineno-13-18 name=__codelineno-13-18 href=#__codelineno-13-18></a><span class=w>  </span><span class=nt>selector</span><span class=p>:</span>
<a id=__codelineno-13-19 name=__codelineno-13-19 href=#__codelineno-13-19></a><span class=w>    </span><span class=nt>app.kubernetes.io/component</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">grafana</span>
<a id=__codelineno-13-20 name=__codelineno-13-20 href=#__codelineno-13-20></a><span class=w>    </span><span class=nt>app.kubernetes.io/name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">grafana</span>
<a id=__codelineno-13-21 name=__codelineno-13-21 href=#__codelineno-13-21></a><span class=w>    </span><span class=nt>app.kubernetes.io/part-of</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kube-prometheus</span>
</code></pre></div></p> <p>查看Grafana Service的NodePort：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>svc<span class=w> </span>grafana<span class=w> </span>-n<span class=w> </span>monitoring
<a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a>NAME<span class=w>      </span>TYPE<span class=w>       </span>CLUSTER-IP<span class=w>     </span>EXTERNAL-IP<span class=w>   </span>PORT<span class=o>(</span>S<span class=o>)</span><span class=w>          </span>AGE
<a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a>grafana<span class=w>   </span>NodePort<span class=w>   </span><span class=m>10</span>.102.99.88<span class=w>   </span>&lt;none&gt;<span class=w>        </span><span class=m>3000</span>:31790/TCP<span class=w>   </span>8m55s
</code></pre></div> <p>之后通过任意一个安装了kube-proxy服务的节点IP+31790端口即可访问Grafana，如图15.4所示。</p> <p><img alt class=zoom src=../../../assets/static/kubernetes/5/15-4-grafana.png></p> <p>Grafana默认登录的账号和密码为admin/admin，登录会提示更改密码，也可以单击skip不更改密码。然后以相同的方式更改Prometheus的Service为NodePort：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a>$<span class=w> </span>kubectl<span class=w> </span>edit<span class=w> </span>svc<span class=w> </span>prometheus-k8s<span class=w> </span>-n<span class=w> </span>monitoring
<a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a><span class=w>  </span>selector:
<a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a><span class=w>    </span>app:<span class=w> </span>prometheus
<a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a><span class=w>    </span>app.kubernetes.io/component:<span class=w> </span>prometheus
<a id=__codelineno-15-5 name=__codelineno-15-5 href=#__codelineno-15-5></a><span class=w>    </span>app.kubernetes.io/name:<span class=w> </span>prometheus
<a id=__codelineno-15-6 name=__codelineno-15-6 href=#__codelineno-15-6></a><span class=w>    </span>app.kubernetes.io/part-of:<span class=w> </span>kube-prometheus
<a id=__codelineno-15-7 name=__codelineno-15-7 href=#__codelineno-15-7></a><span class=w>    </span>prometheus:<span class=w> </span>k8s
<a id=__codelineno-15-8 name=__codelineno-15-8 href=#__codelineno-15-8></a><span class=w>  </span>sessionAffinity:<span class=w> </span>ClientIP
<a id=__codelineno-15-9 name=__codelineno-15-9 href=#__codelineno-15-9></a><span class=w>  </span>sessionAffinityConfig:
<a id=__codelineno-15-10 name=__codelineno-15-10 href=#__codelineno-15-10></a><span class=w>    </span>clientIP:
<a id=__codelineno-15-11 name=__codelineno-15-11 href=#__codelineno-15-11></a><span class=w>      </span>timeoutSeconds:<span class=w> </span><span class=m>10800</span>
<a id=__codelineno-15-12 name=__codelineno-15-12 href=#__codelineno-15-12></a><span class=w>  </span><span class=c1># 更改prometheus的Service类型</span>
<a id=__codelineno-15-13 name=__codelineno-15-13 href=#__codelineno-15-13></a><span class=w>  </span>type:<span class=w> </span>NodePort
<a id=__codelineno-15-14 name=__codelineno-15-14 href=#__codelineno-15-14></a>
<a id=__codelineno-15-15 name=__codelineno-15-15 href=#__codelineno-15-15></a>
<a id=__codelineno-15-16 name=__codelineno-15-16 href=#__codelineno-15-16></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>svc<span class=w> </span>prometheus-k8s<span class=w> </span>-n<span class=w> </span>monitoring
<a id=__codelineno-15-17 name=__codelineno-15-17 href=#__codelineno-15-17></a>NAME<span class=w>             </span>TYPE<span class=w>       </span>CLUSTER-IP<span class=w>       </span>EXTERNAL-IP<span class=w>   </span>PORT<span class=o>(</span>S<span class=o>)</span><span class=w>          </span>AGE
<a id=__codelineno-15-18 name=__codelineno-15-18 href=#__codelineno-15-18></a>prometheus-k8s<span class=w>   </span>NodePort<span class=w>   </span><span class=m>10</span>.106.193.178<span class=w>   </span>&lt;none&gt;<span class=w>        </span><span class=m>9090</span>:31635/TCP<span class=w>   </span>13m
</code></pre></div> <p>最后通过任意一个安装了kube-proxy服务的节点IP+31635端口即可访问Prometheus的Web UI，如图15.5所示。</p> <p><img alt class=zoom src=../../../assets/static/kubernetes/5/15-5-prometheus.png> 图15.5 访问Prometheus Web UI</p> <div class="admonition tip"> <p class=admonition-title>提示</p> <p>默认安装完成后，会有几个告警，先忽略。</p> </div> <p>如果要清理 Prometheus-Operator，可以直接删除对应的资源清单即可：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a>$<span class=w> </span>kubectl<span class=w> </span>delete<span class=w> </span>-f<span class=w> </span>kube-prometheus/manifests/
<a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a>$<span class=w> </span>kubectl<span class=w> </span>delete<span class=w> </span>-f<span class=w> </span>kube-prometheus/manifests/setup/
</code></pre></div> <h2 id=3云原生和非云原生应用的监控流程>3.云原生和非云原生应用的监控流程<a class=headerlink href=#3云原生和非云原生应用的监控流程 title="Permanent link">&para;</a></h2> <p>通过前面的学习，可以看到只需要几条命令即可完成Prometheus Stack的安装，接下来开始介绍Prometheus是如何抓取数据的。</p> <h3 id=31-监控数据来源>3.1 监控数据来源<a class=headerlink href=#31-监控数据来源 title="Permanent link">&para;</a></h3> <p>从Prometheus的架构中了解到，Prometheus通常采用Pull的形式来拉取数据，也就意味着被监控应用只要有一个能获取到监控数据的接口，就可以采集到监控数据，所以接下来讲一下这个接口从何而来。</p> <p>如果读者从事云相关的工作，肯定都听说过云原生这个词语，其中云原生涉及12个关键要素，其中一项就是应用的开发者在进行相关程序开发时，要考虑程序本身一些内部的运行情况，比如程序当前的连接数、资源占用情况等，此时可以引用Prometheus的客户端工具来采集并暴露数据，也就是基于云原生理念开发的程序自己会暴露Metrics接口，就像Kubernetes本身的组件、Etcd等，都有一个/metrics接口，Prometheus只需要请求这个接口即可获取到相关数据。</p> <p>基于云原生理念开发的程序大部分都有相关接口，但是有很多应用并非是基于云原生理念开发的，所以没有此类接口，比如MySQL、Redis等。</p> <p>那么如何采集这类程序的监控数据呢？这个时候在讲解Prometheus架构时提到的Exporter就派上用场了，Exporter主要用来采集非云原生应用的内部数据，它可以通过某些机制（比如调用接口、执行客户端命名）来获取内部一些比较重要的数据，然后将其转换成Prometheus能够识别的数据，并且由Exporter暴露/metrics，此时Prometheus就可以采集到由Exporter暴露的非云原生应用的内部运行状态。目前比较常用的Exporter工具如表15.1所示。</p> <p>表15.1　目前比较常用的Exporter工具</p> <p><img alt class=zoom src=../../../assets/static/kubernetes/5/15-1-Exporter.png></p> <p>在安装了Prometheus Stack后，默认会安装一些常用的监控，比如Kubernetes组件、集群状态、主机状态的监控等。其中Kubernetes组件是基于云原生理念开发的，它自身提供了Metrics接口，比如Kubelet组件可以通过主机的10255端口访问监控数据：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a>$<span class=w> </span>curl<span class=w> </span>-s<span class=w> </span><span class=m>127</span>.0.0.1:10255/metrics<span class=p>|</span><span class=w> </span>tail<span class=w> </span>-5
</code></pre></div> <p>如果读者的Kubelet不是10255端口，可以通过netstat查看监听的端口号：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a>$<span class=w> </span>netstat<span class=w> </span>-lnpt<span class=p>|</span>grep<span class=w> </span>kubelet
<a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a>tcp<span class=w>        </span><span class=m>0</span><span class=w>      </span><span class=m>0</span><span class=w> </span><span class=m>127</span>.0.0.1:10248<span class=w>         </span><span class=m>0</span>.0.0.0:*<span class=w>               </span>LISTEN<span class=w>      </span><span class=m>96284</span>/kubelet
<a id=__codelineno-18-3 name=__codelineno-18-3 href=#__codelineno-18-3></a>tcp6<span class=w>       </span><span class=m>0</span><span class=w>      </span><span class=m>0</span><span class=w> </span>:::10250<span class=w>                </span>:::*<span class=w>                    </span>LISTEN<span class=w>      </span><span class=m>96284</span>/kubelet
</code></pre></div> <p>之后在Grafana页面即可看到相关的监控数据，依次单击General/Home→Default→Kubernetes/Kubelet即可看到面板，如图15.6所示。</p> <p><img alt class=zoom src=../../../assets/static/kubernetes/5/15-6-kubelet.png></p> <p>Kubernetes节点（也就是服务器本身）肯定不是云原生应用，或者说它不算一个应用，而是一个系统，那么系统本身肯定没有类似的Metrics接口。</p> <p>按照之前的讲解，需要有一个Exporter采集宿主机信息，然后暴露给Prometheus，此时可以使用专用于主机信息采集的node-exporter应用来采集数据，并暴露Metrics接口给Prometheus。</p> <p>安装Prometheus Stack时，默认用DaemonSet安装了node-exporter，它会在每个Kubernetes节点部署一个node-exporter：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>ds<span class=w> </span>-n<span class=w> </span>monitoring
<a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a>NAME<span class=w>            </span>DESIRED<span class=w>   </span>CURRENT<span class=w>   </span>READY<span class=w>   </span>UP-TO-DATE<span class=w>   </span>AVAILABLE<span class=w>   </span>NODE<span class=w> </span>SELECTOR<span class=w>            </span>AGE
<a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a>node-exporter<span class=w>   </span><span class=m>9</span><span class=w>         </span><span class=m>9</span><span class=w>         </span><span class=m>9</span><span class=w>       </span><span class=m>9</span><span class=w>            </span><span class=m>9</span><span class=w>           </span>kubernetes.io/os<span class=o>=</span>linux<span class=w>   </span>34m
<a id=__codelineno-19-4 name=__codelineno-19-4 href=#__codelineno-19-4></a>
<a id=__codelineno-19-5 name=__codelineno-19-5 href=#__codelineno-19-5></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>pod<span class=w> </span>-n<span class=w> </span>monitoring<span class=p>|</span>grep<span class=w> </span>node-exporter
<a id=__codelineno-19-6 name=__codelineno-19-6 href=#__codelineno-19-6></a>node-exporter-2f2h2<span class=w>                    </span><span class=m>2</span>/2<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>34m
<a id=__codelineno-19-7 name=__codelineno-19-7 href=#__codelineno-19-7></a>node-exporter-2zcbr<span class=w>                    </span><span class=m>2</span>/2<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>34m
<a id=__codelineno-19-8 name=__codelineno-19-8 href=#__codelineno-19-8></a>node-exporter-5txxx<span class=w>                    </span><span class=m>2</span>/2<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>34m
<a id=__codelineno-19-9 name=__codelineno-19-9 href=#__codelineno-19-9></a>node-exporter-7wxp6<span class=w>                    </span><span class=m>2</span>/2<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>34m
<a id=__codelineno-19-10 name=__codelineno-19-10 href=#__codelineno-19-10></a>node-exporter-99wrh<span class=w>                    </span><span class=m>2</span>/2<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>34m
<a id=__codelineno-19-11 name=__codelineno-19-11 href=#__codelineno-19-11></a>node-exporter-dcfdn<span class=w>                    </span><span class=m>2</span>/2<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>34m
<a id=__codelineno-19-12 name=__codelineno-19-12 href=#__codelineno-19-12></a>node-exporter-g7hl9<span class=w>                    </span><span class=m>2</span>/2<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>34m
<a id=__codelineno-19-13 name=__codelineno-19-13 href=#__codelineno-19-13></a>node-exporter-hsgwx<span class=w>                    </span><span class=m>2</span>/2<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>34m
<a id=__codelineno-19-14 name=__codelineno-19-14 href=#__codelineno-19-14></a>node-exporter-jp8qs<span class=w>                    </span><span class=m>2</span>/2<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>34m
</code></pre></div> <p>此时可以在每个宿主机看到node-exporter监听的9100端口：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a>$<span class=w> </span>netstat<span class=w> </span>-lntp<span class=p>|</span>grep<span class=w> </span>node_exporter
<a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a>tcp<span class=w>        </span><span class=m>0</span><span class=w>      </span><span class=m>0</span><span class=w> </span><span class=m>127</span>.0.0.1:9100<span class=w>          </span><span class=m>0</span>.0.0.0:*<span class=w>               </span>LISTEN<span class=w>      </span><span class=m>40711</span>/node_exporter
</code></pre></div> <p>此时访问9100即可访问到主机的监控信息：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a>$<span class=w> </span>curl<span class=w> </span>-s<span class=w> </span><span class=m>127</span>.0.0.1:9100/metrics<span class=p>|</span><span class=w> </span>tail<span class=w> </span>-5
<a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a><span class=c1># HELP promhttp_metric_handler_requests_total Total number of scrapes by HTTP status code.</span>
<a id=__codelineno-21-3 name=__codelineno-21-3 href=#__codelineno-21-3></a><span class=c1># TYPE promhttp_metric_handler_requests_total counter</span>
<a id=__codelineno-21-4 name=__codelineno-21-4 href=#__codelineno-21-4></a>promhttp_metric_handler_requests_total<span class=o>{</span><span class=nv>code</span><span class=o>=</span><span class=s2>&quot;200&quot;</span><span class=o>}</span><span class=w> </span><span class=m>281</span>
<a id=__codelineno-21-5 name=__codelineno-21-5 href=#__codelineno-21-5></a>promhttp_metric_handler_requests_total<span class=o>{</span><span class=nv>code</span><span class=o>=</span><span class=s2>&quot;500&quot;</span><span class=o>}</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-21-6 name=__codelineno-21-6 href=#__codelineno-21-6></a>promhttp_metric_handler_requests_total<span class=o>{</span><span class=nv>code</span><span class=o>=</span><span class=s2>&quot;503&quot;</span><span class=o>}</span><span class=w> </span><span class=m>0</span>
</code></pre></div> <p>同时在Grafana上也可以看到监控面板,单击General/Home→Default→Node Exporter。</p> <p>通过上面的理解，我们知道了针对云原生应用或非云原生应用的监控数据来源，但是Prometheus是如何知道要采集哪些数据的呢？接下来我们介绍如何配置Prometheus采集指定目标应用的监控数据。</p> <h3 id=32-什么是servicemonitor>3.2 什么是ServiceMonitor<a class=headerlink href=#32-什么是servicemonitor title="Permanent link">&para;</a></h3> <p>如果读者体验过容器化或者二进制的方式安装Prometheus，就会注意到Prometheus有一个配置文件，用于配置需要监控哪些数据，或者配置一些告警策略。</p> <p>这个配置文件的维护非常麻烦，特别是监控项非常多的情况下，很容易出现配置错误，而在Kubernetes上部署Prometheus，可以不用去维护这个配置文件，而是通过一个叫ServiceMonitor的资源来自动发现监控目标并动态生成配置。</p> <p>比如上述展示的Kubelet和NodeExporter的监控 ， 都有一个ServiceMonitor：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>servicemonitor<span class=w> </span>-n<span class=w> </span>monitoring
<a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a>NAME<span class=w>                      </span>AGE
<a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a>alertmanager<span class=w>              </span>42m
<a id=__codelineno-22-4 name=__codelineno-22-4 href=#__codelineno-22-4></a>blackbox-exporter<span class=w>         </span>42m
<a id=__codelineno-22-5 name=__codelineno-22-5 href=#__codelineno-22-5></a>coredns<span class=w>                   </span>42m
<a id=__codelineno-22-6 name=__codelineno-22-6 href=#__codelineno-22-6></a>grafana<span class=w>                   </span>42m
<a id=__codelineno-22-7 name=__codelineno-22-7 href=#__codelineno-22-7></a>kube-apiserver<span class=w>            </span>42m
<a id=__codelineno-22-8 name=__codelineno-22-8 href=#__codelineno-22-8></a>kube-controller-manager<span class=w>   </span>42m
<a id=__codelineno-22-9 name=__codelineno-22-9 href=#__codelineno-22-9></a>kube-scheduler<span class=w>            </span>42m
<a id=__codelineno-22-10 name=__codelineno-22-10 href=#__codelineno-22-10></a>kube-state-metrics<span class=w>        </span>42m
<a id=__codelineno-22-11 name=__codelineno-22-11 href=#__codelineno-22-11></a>kubelet<span class=w>                   </span>42m
<a id=__codelineno-22-12 name=__codelineno-22-12 href=#__codelineno-22-12></a>node-exporter<span class=w>             </span>42m
<a id=__codelineno-22-13 name=__codelineno-22-13 href=#__codelineno-22-13></a>prometheus-adapter<span class=w>        </span>42m
<a id=__codelineno-22-14 name=__codelineno-22-14 href=#__codelineno-22-14></a>prometheus-k8s<span class=w>            </span>42m
<a id=__codelineno-22-15 name=__codelineno-22-15 href=#__codelineno-22-15></a>prometheus-operator<span class=w>       </span>42m
</code></pre></div> <p>可以通过-o命令查看配置详情：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>servicemonitor<span class=w> </span>-n<span class=w> </span>monitoring<span class=w> </span>kubelet<span class=w> </span>-o<span class=w> </span>yaml
<a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a>apiVersion:<span class=w> </span>monitoring.coreos.com/v1
<a id=__codelineno-23-3 name=__codelineno-23-3 href=#__codelineno-23-3></a>kind:<span class=w> </span>ServiceMonitor
<a id=__codelineno-23-4 name=__codelineno-23-4 href=#__codelineno-23-4></a>metadata:
<a id=__codelineno-23-5 name=__codelineno-23-5 href=#__codelineno-23-5></a><span class=w>  </span>creationTimestamp:<span class=w> </span><span class=s2>&quot;2022-12-28T06:35:18Z&quot;</span>
<a id=__codelineno-23-6 name=__codelineno-23-6 href=#__codelineno-23-6></a><span class=w>  </span>generation:<span class=w> </span><span class=m>1</span>
<a id=__codelineno-23-7 name=__codelineno-23-7 href=#__codelineno-23-7></a><span class=w>  </span>labels:
<a id=__codelineno-23-8 name=__codelineno-23-8 href=#__codelineno-23-8></a><span class=w>    </span>app.kubernetes.io/name:<span class=w> </span>kubelet
<a id=__codelineno-23-9 name=__codelineno-23-9 href=#__codelineno-23-9></a><span class=w>  </span>name:<span class=w> </span>kubelet
<a id=__codelineno-23-10 name=__codelineno-23-10 href=#__codelineno-23-10></a><span class=w>  </span>namespace:<span class=w> </span>monitoring
<a id=__codelineno-23-11 name=__codelineno-23-11 href=#__codelineno-23-11></a><span class=w>  </span>resourceVersion:<span class=w> </span><span class=s2>&quot;269124093&quot;</span>
<a id=__codelineno-23-12 name=__codelineno-23-12 href=#__codelineno-23-12></a><span class=w>  </span>selfLink:<span class=w> </span>/apis/monitoring.coreos.com/v1/namespaces/monitoring/servicemonitors/kubelet
<a id=__codelineno-23-13 name=__codelineno-23-13 href=#__codelineno-23-13></a><span class=w>  </span>uid:<span class=w> </span>0295ed26-49c4-4b15-ba92-f63a0bc5e7ec
<a id=__codelineno-23-14 name=__codelineno-23-14 href=#__codelineno-23-14></a>spec:
<a id=__codelineno-23-15 name=__codelineno-23-15 href=#__codelineno-23-15></a><span class=w>  </span>endpoints:
<a id=__codelineno-23-16 name=__codelineno-23-16 href=#__codelineno-23-16></a><span class=w>  </span>-<span class=w> </span>bearerTokenFile:<span class=w> </span>/var/run/secrets/kubernetes.io/serviceaccount/token
<a id=__codelineno-23-17 name=__codelineno-23-17 href=#__codelineno-23-17></a><span class=w>    </span>honorLabels:<span class=w> </span><span class=nb>true</span>
<a id=__codelineno-23-18 name=__codelineno-23-18 href=#__codelineno-23-18></a><span class=w>    </span>interval:<span class=w> </span>30s
<a id=__codelineno-23-19 name=__codelineno-23-19 href=#__codelineno-23-19></a><span class=w>    </span>metricRelabelings:
<a id=__codelineno-23-20 name=__codelineno-23-20 href=#__codelineno-23-20></a>......
<a id=__codelineno-23-21 name=__codelineno-23-21 href=#__codelineno-23-21></a>
<a id=__codelineno-23-22 name=__codelineno-23-22 href=#__codelineno-23-22></a><span class=w>  </span>jobLabel:<span class=w> </span>app.kubernetes.io/name
<a id=__codelineno-23-23 name=__codelineno-23-23 href=#__codelineno-23-23></a><span class=w>  </span>namespaceSelector:
<a id=__codelineno-23-24 name=__codelineno-23-24 href=#__codelineno-23-24></a><span class=w>    </span>matchNames:
<a id=__codelineno-23-25 name=__codelineno-23-25 href=#__codelineno-23-25></a><span class=w>    </span>-<span class=w> </span>kube-system
<a id=__codelineno-23-26 name=__codelineno-23-26 href=#__codelineno-23-26></a><span class=w>  </span>selector:
<a id=__codelineno-23-27 name=__codelineno-23-27 href=#__codelineno-23-27></a><span class=w>    </span>matchLabels:
<a id=__codelineno-23-28 name=__codelineno-23-28 href=#__codelineno-23-28></a><span class=w>      </span>app.kubernetes.io/name:<span class=w> </span>kubelet
</code></pre></div> <p>上述展示的是一个Kubelet的ServiceMonitor配置，可以看到它的kind配置为ServiceMonitor，并非标准的Kubernetes提供的资源类型。</p> <p>在第13章，我们讲过Operator和CRD，Prometheus Stack也是一种CRD和Operator的实现。我们定义了一个类型为ServiceMonitor的自定义资源，Prometheus的Operator会解析该资源类型的配置，然后动态生成Prometheus的配置，</p> <p>这就是ServiceMonitor的作用,它可以让我们用资源定义的方式去配置Prometheus需要监控谁，不用再处理成百上千行的Prometheus配置，也不需要每次更改Prometheus配置后重启Prometheus实例。</p> <p>接下来看一个ServiceMonitor配置示例：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">monitoring.coreos.com/v1</span>
<a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ServiceMonitor</span>
<a id=__codelineno-24-3 name=__codelineno-24-3 href=#__codelineno-24-3></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-24-4 name=__codelineno-24-4 href=#__codelineno-24-4></a><span class=w>  </span><span class=nt>labels</span><span class=p>:</span>
<a id=__codelineno-24-5 name=__codelineno-24-5 href=#__codelineno-24-5></a><span class=w>    </span><span class=nt>k8s-app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">elasticsearch-exporter</span>
<a id=__codelineno-24-6 name=__codelineno-24-6 href=#__codelineno-24-6></a><span class=w>    </span><span class=nt>release</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">es-exporter</span>
<a id=__codelineno-24-7 name=__codelineno-24-7 href=#__codelineno-24-7></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">es-exporter-elasticsearch-exporter</span>
<a id=__codelineno-24-8 name=__codelineno-24-8 href=#__codelineno-24-8></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">monitoring</span>
<a id=__codelineno-24-9 name=__codelineno-24-9 href=#__codelineno-24-9></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-24-10 name=__codelineno-24-10 href=#__codelineno-24-10></a><span class=w>  </span><span class=nt>endpoints</span><span class=p>:</span>
<a id=__codelineno-24-11 name=__codelineno-24-11 href=#__codelineno-24-11></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>honorLabels</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id=__codelineno-24-12 name=__codelineno-24-12 href=#__codelineno-24-12></a><span class=w>    </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10s</span>
<a id=__codelineno-24-13 name=__codelineno-24-13 href=#__codelineno-24-13></a><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/metrics</span>
<a id=__codelineno-24-14 name=__codelineno-24-14 href=#__codelineno-24-14></a><span class=w>    </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">http</span>
<a id=__codelineno-24-15 name=__codelineno-24-15 href=#__codelineno-24-15></a><span class=w>    </span><span class=nt>scheme</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">http</span>
<a id=__codelineno-24-16 name=__codelineno-24-16 href=#__codelineno-24-16></a><span class=w>  </span><span class=nt>jobLabel</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">es-exporter</span>
<a id=__codelineno-24-17 name=__codelineno-24-17 href=#__codelineno-24-17></a><span class=w>  </span><span class=nt>namespaceSelector</span><span class=p>:</span>
<a id=__codelineno-24-18 name=__codelineno-24-18 href=#__codelineno-24-18></a><span class=w>    </span><span class=nt>matchNames</span><span class=p>:</span>
<a id=__codelineno-24-19 name=__codelineno-24-19 href=#__codelineno-24-19></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">monitoring</span>
<a id=__codelineno-24-20 name=__codelineno-24-20 href=#__codelineno-24-20></a><span class=w>  </span><span class=nt>selector</span><span class=p>:</span>
<a id=__codelineno-24-21 name=__codelineno-24-21 href=#__codelineno-24-21></a><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span>
<a id=__codelineno-24-22 name=__codelineno-24-22 href=#__codelineno-24-22></a><span class=w>      </span><span class=nt>k8s-app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">elasticsearch-exporter</span>
<a id=__codelineno-24-23 name=__codelineno-24-23 href=#__codelineno-24-23></a><span class=w>      </span><span class=nt>release</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">es-exporter</span>
</code></pre></div> <ul> <li>honorLabels：如果目标标签和服务器标签冲突，是否保留目标标签。</li> <li>interval：监控数据抓取的时间间隔。</li> <li>path：Metrics接口路径。</li> <li>port：Metrics端口。</li> <li>scheme：Metrics接口的协议。</li> <li>namespaceSelector：监控目标Service所在的命名空间。</li> <li>selector：监控目标Service的标签。</li> </ul> <p>反过来再看Kubelet的ServiceMonitor：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a><span class=w>  </span><span class=nt>namespaceSelector</span><span class=p>:</span>
<a id=__codelineno-25-2 name=__codelineno-25-2 href=#__codelineno-25-2></a><span class=w>    </span><span class=nt>matchNames</span><span class=p>:</span>
<a id=__codelineno-25-3 name=__codelineno-25-3 href=#__codelineno-25-3></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kube-system</span>
<a id=__codelineno-25-4 name=__codelineno-25-4 href=#__codelineno-25-4></a><span class=w>  </span><span class=nt>selector</span><span class=p>:</span>
<a id=__codelineno-25-5 name=__codelineno-25-5 href=#__codelineno-25-5></a><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span>
<a id=__codelineno-25-6 name=__codelineno-25-6 href=#__codelineno-25-6></a><span class=w>      </span><span class=nt>app.kubernetes.io/name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kubelet</span>
</code></pre></div> <p>可以看到该ServiceMonitor的监控目标是kube-system命名空间下具有app.kubernetes.io/name=kubelet标签的Service,此时可以查 看该Service：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>svc<span class=w> </span>-n<span class=w> </span>kube-system<span class=w> </span>-l<span class=w> </span>app.kubernetes.io/name<span class=o>=</span>kubelet
<a id=__codelineno-26-2 name=__codelineno-26-2 href=#__codelineno-26-2></a>NAME<span class=w>      </span>TYPE<span class=w>        </span>CLUSTER-IP<span class=w>   </span>EXTERNAL-IP<span class=w>   </span>PORT<span class=o>(</span>S<span class=o>)</span><span class=w>                        </span>AGE
<a id=__codelineno-26-3 name=__codelineno-26-3 href=#__codelineno-26-3></a>kubelet<span class=w>   </span>ClusterIP<span class=w>   </span>None<span class=w>         </span>&lt;none&gt;<span class=w>        </span><span class=m>10250</span>/TCP,10255/TCP,4194/TCP<span class=w>   </span>161m
</code></pre></div> <p>通过上面的学习，我们简单总结一下，在使用Prometheus监控应用时，有云原生和非云原生应用之分，说白了就是监控数据是由程序本身提供还是通过Exporter提供。对于不同的应用，可以采用不同的管控流程，具体说明如下：</p> <ul> <li> <p>云原生应用：找到本身提供的Metrics接口，然后配置一个Service指向该应用的Pod，最后创建一个ServiceMonitor指定该应用的Service即可完成监控数据的采集。</p> </li> <li> <p>非云原生应用：需要找到合适该应用的Exporter，之后Exporter链接至该应用并采集相关数据，然后配置一个Service指向该Exporter的Pod，最后创建一个ServiceMonitor指定该Exporter的Service即可完成监控数据的采集。</p> </li> </ul> <h3 id=33-servicemonitor找不到监控主机排查>3.3 ServiceMonitor找不到监控主机排查<a class=headerlink href=#33-servicemonitor找不到监控主机排查 title="Permanent link">&para;</a></h3> <p>通过上面的学习，我们知道了Prometheus监控应用的流程，接下来趁热打铁看一个Kubernetes组件的监控问题。</p> <p>如果读者采用的是二进制方式安装的Kubernetes集群，安装Prometheus后，kube-controller-manager和kube- scheduler可能处于无法监控的状态，也就是找不到目标主机。</p> <p>可以通过Prometheus的Web UI的Status→Service Discovery查看，如图15.7所示。</p> <p><img alt class=zoom src=../../../assets/static/kubernetes/5/15-7-serviceMonitor.png></p> <p>同时在Alerts页面也能看到Controller Manager和Scheduler的告警，如图15.8所示。</p> <p><img alt class=zoom src=../../../assets/static/kubernetes/5/15-8-gaoj01.png></p> <p>图15.8　查看告警</p> <p>此时虽然有kube-controller-manager和kube-scheduler的监控配置，但是并没有发现可用的监控目标。接下来我们分析一下为什么找不到监控目标。</p> <hr> <p>注意 本节的排查思路是通用步骤，不仅仅局限于controller和scheduler。</p> <p>其次Kubernetes版本不一致，针对controller和scheduler的问题解决方式可能并不一致，但是ServiceMonitor找不到主机的排查步骤是一致的。</p> <hr> <p>首先我们注意到Prometheus是有相关配置的，说明ServiceMonitor已经创建成功，可以通过以下命令查看：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>servicemonitors<span class=w> </span>-n<span class=w> </span>monitoring<span class=w> </span>kube-controller-manager<span class=w> </span>kube-scheduler
<a id=__codelineno-27-2 name=__codelineno-27-2 href=#__codelineno-27-2></a>NAME<span class=w>                      </span>AGE
<a id=__codelineno-27-3 name=__codelineno-27-3 href=#__codelineno-27-3></a>kube-controller-manager<span class=w>   </span>127m
<a id=__codelineno-27-4 name=__codelineno-27-4 href=#__codelineno-27-4></a>kube-scheduler<span class=w>            </span>127m
</code></pre></div> <p>接下来进一步分析 ,首先查看kube-controller-manager的ServiceMonitor配置：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>servicemonitor<span class=w> </span>-n<span class=w> </span>monitoring<span class=w> </span>kube-controller-manager<span class=w> </span>-o<span class=w> </span>yaml
<a id=__codelineno-28-2 name=__codelineno-28-2 href=#__codelineno-28-2></a>apiVersion:<span class=w> </span>monitoring.coreos.com/v1
<a id=__codelineno-28-3 name=__codelineno-28-3 href=#__codelineno-28-3></a>kind:<span class=w> </span>ServiceMonitor
<a id=__codelineno-28-4 name=__codelineno-28-4 href=#__codelineno-28-4></a>......
<a id=__codelineno-28-5 name=__codelineno-28-5 href=#__codelineno-28-5></a><span class=w>    </span>port:<span class=w> </span>https-metrics
<a id=__codelineno-28-6 name=__codelineno-28-6 href=#__codelineno-28-6></a><span class=w>    </span>scheme:<span class=w> </span>https
<a id=__codelineno-28-7 name=__codelineno-28-7 href=#__codelineno-28-7></a><span class=w>    </span>tlsConfig:
<a id=__codelineno-28-8 name=__codelineno-28-8 href=#__codelineno-28-8></a><span class=w>      </span>insecureSkipVerify:<span class=w> </span><span class=nb>true</span>
<a id=__codelineno-28-9 name=__codelineno-28-9 href=#__codelineno-28-9></a><span class=w>  </span>jobLabel:<span class=w> </span>app.kubernetes.io/name
<a id=__codelineno-28-10 name=__codelineno-28-10 href=#__codelineno-28-10></a><span class=w>  </span>namespaceSelector:
<a id=__codelineno-28-11 name=__codelineno-28-11 href=#__codelineno-28-11></a><span class=w>    </span>matchNames:
<a id=__codelineno-28-12 name=__codelineno-28-12 href=#__codelineno-28-12></a><span class=w>    </span>-<span class=w> </span>kube-system
<a id=__codelineno-28-13 name=__codelineno-28-13 href=#__codelineno-28-13></a><span class=w>  </span>selector:
<a id=__codelineno-28-14 name=__codelineno-28-14 href=#__codelineno-28-14></a><span class=w>    </span>matchLabels:
<a id=__codelineno-28-15 name=__codelineno-28-15 href=#__codelineno-28-15></a><span class=w>      </span>app.kubernetes.io/name:<span class=w> </span>kube-controller-manager
</code></pre></div> <p>看到该ServiceMonitor 匹配的是kube-system 命名空间下具有app.kubernetes.io/name=kubecontroller-manager的标签，接下来通过该标签查看是否有该Service：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-29-1 name=__codelineno-29-1 href=#__codelineno-29-1></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>svc<span class=w> </span>-n<span class=w> </span>kube-system<span class=w> </span>-l<span class=w> </span>app.kubernetes.io/name<span class=o>=</span>kube-controller-manager
<a id=__codelineno-29-2 name=__codelineno-29-2 href=#__codelineno-29-2></a>No<span class=w> </span>resources<span class=w> </span>found<span class=w> </span><span class=k>in</span><span class=w> </span>kube-system<span class=w> </span>namespace.
</code></pre></div> <p>可以看到并没有此标签的Service，所以导致找不到需要监控的目标，此时可以手动创建该Service和Endpoint指向自己的Controller Manager：</p> <p><code>kubernetesControlPlane-serviceMonitorKubeControllerManager.yaml</code></p> <div class=highlight><pre><span></span><code><a id=__codelineno-30-1 name=__codelineno-30-1 href=#__codelineno-30-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id=__codelineno-30-2 name=__codelineno-30-2 href=#__codelineno-30-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<a id=__codelineno-30-3 name=__codelineno-30-3 href=#__codelineno-30-3></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-30-4 name=__codelineno-30-4 href=#__codelineno-30-4></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kube-system</span>
<a id=__codelineno-30-5 name=__codelineno-30-5 href=#__codelineno-30-5></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kube-controller-manager</span>
<a id=__codelineno-30-6 name=__codelineno-30-6 href=#__codelineno-30-6></a><span class=w>  </span><span class=nt>labels</span><span class=p>:</span>
<a id=__codelineno-30-7 name=__codelineno-30-7 href=#__codelineno-30-7></a><span class=w>    </span><span class=nt>app.kubernetes.io/name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kube-controller-manager</span>
<a id=__codelineno-30-8 name=__codelineno-30-8 href=#__codelineno-30-8></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-30-9 name=__codelineno-30-9 href=#__codelineno-30-9></a><span class=w>  </span><span class=nt>selector</span><span class=p>:</span>
<a id=__codelineno-30-10 name=__codelineno-30-10 href=#__codelineno-30-10></a><span class=w>    </span><span class=nt>component</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kube-controller-manager</span>
<a id=__codelineno-30-11 name=__codelineno-30-11 href=#__codelineno-30-11></a><span class=w>  </span><span class=nt>ports</span><span class=p>:</span>
<a id=__codelineno-30-12 name=__codelineno-30-12 href=#__codelineno-30-12></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">https-metrics</span>
<a id=__codelineno-30-13 name=__codelineno-30-13 href=#__codelineno-30-13></a><span class=w>      </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10257</span>
<a id=__codelineno-30-14 name=__codelineno-30-14 href=#__codelineno-30-14></a><span class=w>      </span><span class=nt>targetPort</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10257</span><span class=w> </span><span class=c1># controller-manager 的安全端口为10257</span>
</code></pre></div> <p>注意需要更改Endpoint配置的YOUR_CONTROLLER_IP为自己的Controller Manager的IP，接下来创建该Service和Endpoint：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-31-1 name=__codelineno-31-1 href=#__codelineno-31-1></a>$<span class=w> </span>kubectl<span class=w> </span>create<span class=w> </span>-f<span class=w> </span>kubernetesControlPlane-serviceMonitorKubeControllerManager.yaml
<a id=__codelineno-31-2 name=__codelineno-31-2 href=#__codelineno-31-2></a>service/kube-controller-manager<span class=w> </span>created
</code></pre></div> <p>查看创建的Service和Endpoint：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-32-1 name=__codelineno-32-1 href=#__codelineno-32-1></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>svc<span class=w> </span>-n<span class=w> </span>kube-system<span class=w> </span>kube-controller-manager
<a id=__codelineno-32-2 name=__codelineno-32-2 href=#__codelineno-32-2></a>NAME<span class=w>                      </span>TYPE<span class=w>        </span>CLUSTER-IP<span class=w>     </span>EXTERNAL-IP<span class=w>   </span>PORT<span class=o>(</span>S<span class=o>)</span><span class=w>     </span>AGE
<a id=__codelineno-32-3 name=__codelineno-32-3 href=#__codelineno-32-3></a>kube-controller-manager<span class=w>   </span>ClusterIP<span class=w>   </span><span class=m>10</span>.99.49.192<span class=w>   </span>&lt;none&gt;<span class=w>        </span><span class=m>10257</span>/TCP<span class=w>   </span>37s
</code></pre></div> <p>此时该Service可能是不通的，因为在集群搭建时，Controller Manager和Scheduler监听的可能是127.0.0.1，导致无法被外部访问，此时需要更改它的监听地址为0.0.0.0（如果读者的集群原本监听的就是0.0.0.0，则无须更改，kubeadm安装方式配置文件在/etc/kubernetes/manifests目录）：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-33-1 name=__codelineno-33-1 href=#__codelineno-33-1></a>$<span class=w> </span>sed<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;s#address=127.0.0.1#address=0.0.0.0#g&#39;</span><span class=w> </span>/usr/lib/systemd/system/kube-controller-manager.service
<a id=__codelineno-33-2 name=__codelineno-33-2 href=#__codelineno-33-2></a>$<span class=w> </span>systemctl<span class=w> </span>daemon-reload
<a id=__codelineno-33-3 name=__codelineno-33-3 href=#__codelineno-33-3></a>$<span class=w> </span>systemctl<span class=w> </span>restart<span class=w> </span>kube-controller-manager
</code></pre></div> <p>如果使用kubeadm启动的集群，初始化时加入如下参数</p> <div class=highlight><pre><span></span><code><a id=__codelineno-34-1 name=__codelineno-34-1 href=#__codelineno-34-1></a>controllerManagerExtraArgs:
<a id=__codelineno-34-2 name=__codelineno-34-2 href=#__codelineno-34-2></a>  address: 0.0.0.0
<a id=__codelineno-34-3 name=__codelineno-34-3 href=#__codelineno-34-3></a>schedulerExtraArgs:
<a id=__codelineno-34-4 name=__codelineno-34-4 href=#__codelineno-34-4></a>  address: 0.0.0.0
</code></pre></div> <p>如果是已经启动之后的集群，可以使用如下命令修改</p> <div class=highlight><pre><span></span><code><a id=__codelineno-35-1 name=__codelineno-35-1 href=#__codelineno-35-1></a>$<span class=w> </span>sed<span class=w> </span>-e<span class=w> </span><span class=s2>&quot;s/- --address=127.0.0.1/- --address=0.0.0.0/&quot;</span><span class=w> </span>-i<span class=w> </span>/etc/kubernetes/manifests/kube-controller-manager.yaml
<a id=__codelineno-35-2 name=__codelineno-35-2 href=#__codelineno-35-2></a>$<span class=w> </span>sed<span class=w> </span>-e<span class=w> </span><span class=s2>&quot;s/- --address=127.0.0.1/- --address=0.0.0.0/&quot;</span><span class=w> </span>-i<span class=w> </span>/etc/kubernetes/manifests/kube-scheduler.yaml
</code></pre></div> <p>提示 如果读者的Kubernetes版本大于1.22，到此步骤后，controller的问题就已经解决了。</p> <hr> <p>通过该Service的ClusterIP访问Controller Manager的Metrics接口：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-36-1 name=__codelineno-36-1 href=#__codelineno-36-1></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>svc<span class=w> </span>-n<span class=w> </span>kube-system<span class=w> </span>kube-controller-manager
<a id=__codelineno-36-2 name=__codelineno-36-2 href=#__codelineno-36-2></a>NAME<span class=w>                      </span>TYPE<span class=w>        </span>CLUSTER-IP<span class=w>     </span>EXTERNAL-IP<span class=w>   </span>PORT<span class=o>(</span>S<span class=o>)</span><span class=w>     </span>AGE
<a id=__codelineno-36-3 name=__codelineno-36-3 href=#__codelineno-36-3></a>kube-controller-manager<span class=w>   </span>ClusterIP<span class=w>   </span><span class=m>10</span>.99.49.192<span class=w>   </span>&lt;none&gt;<span class=w>        </span><span class=m>10257</span>/TCP<span class=w>   </span>37s
<a id=__codelineno-36-4 name=__codelineno-36-4 href=#__codelineno-36-4></a>
<a id=__codelineno-36-5 name=__codelineno-36-5 href=#__codelineno-36-5></a>
<a id=__codelineno-36-6 name=__codelineno-36-6 href=#__codelineno-36-6></a>$<span class=w> </span>curl<span class=w> </span>-s<span class=w> </span><span class=m>10</span>.99.49.192:10257/metrics<span class=p>|</span><span class=w> </span>tail<span class=w> </span>-1
</code></pre></div> <p>到此时，读者可能会以为有了这个Service之后，Prometheus就能发现该目标，但其实不然，细心的读者会发现ServiceMonitor的port和scheme配置的和该Service的不一致。</p> <p>在创建Service之前，如果读者的集群已经有了符合ServiceMonitor选择的Service，依旧不能发现监控目标，就需要检查端口和协议是否和Service配置的一致。更改ServiceMonitor的配置和Service一致，如下所示。</p> <div class=highlight><pre><span></span><code><a id=__codelineno-37-1 name=__codelineno-37-1 href=#__codelineno-37-1></a><span class=w>    </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">https-metrics</span>
<a id=__codelineno-37-2 name=__codelineno-37-2 href=#__codelineno-37-2></a><span class=w>    </span><span class=nt>scheme</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">https</span>
<a id=__codelineno-37-3 name=__codelineno-37-3 href=#__codelineno-37-3></a><span class=w>    </span><span class=nt>tlsConfig</span><span class=p>:</span>
<a id=__codelineno-37-4 name=__codelineno-37-4 href=#__codelineno-37-4></a><span class=w>      </span><span class=nt>insecureSkipVerify</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div> <p>配置Service Monitor</p> <div class=highlight><pre><span></span><code><a id=__codelineno-38-1 name=__codelineno-38-1 href=#__codelineno-38-1></a>$<span class=w> </span>kubectl<span class=w> </span>edit<span class=w> </span>servicemonitor<span class=w> </span>kube-controller-manager<span class=w> </span>-n<span class=w> </span>monitoring
</code></pre></div> <p>等待几分钟后， 就可以在Prometheus 的Web UI上看到Controller Manager的监控目标，如图15.10和图15.11所示。</p> <p><img alt class=zoom src=../../../assets/static/kubernetes/5/15-10-targets.png> 图15.10　查看Targets</p> <p><img alt class=zoom src=../../../assets/static/kubernetes/5/15-11-targets.png> 图15.11　查看Service Discovery</p> <div class="admonition example"> <p class=admonition-title>参考</p> <p><a href=https://p8s.io/docs/operator/install/ >https://p8s.io/docs/operator/install/</a></p> </div> <p>此时告警也会消失，Grafana也能查看到Controller Manager的监控数据。Scheduler的排查和Controller Manager一致。</p> <p><code>kubernetesControlPlane-serviceMonitorKubeScheduler.yaml</code></p> <div class=highlight><pre><span></span><code><a id=__codelineno-39-1 name=__codelineno-39-1 href=#__codelineno-39-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">monitoring.coreos.com/v1</span>
<a id=__codelineno-39-2 name=__codelineno-39-2 href=#__codelineno-39-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ServiceMonitor</span>
<a id=__codelineno-39-3 name=__codelineno-39-3 href=#__codelineno-39-3></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-39-4 name=__codelineno-39-4 href=#__codelineno-39-4></a><span class=w>  </span><span class=nt>labels</span><span class=p>:</span>
<a id=__codelineno-39-5 name=__codelineno-39-5 href=#__codelineno-39-5></a><span class=w>    </span><span class=nt>app.kubernetes.io/name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kube-scheduler</span>
<a id=__codelineno-39-6 name=__codelineno-39-6 href=#__codelineno-39-6></a><span class=w>    </span><span class=nt>app.kubernetes.io/part-of</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kube-prometheus</span>
<a id=__codelineno-39-7 name=__codelineno-39-7 href=#__codelineno-39-7></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kube-scheduler</span>
<a id=__codelineno-39-8 name=__codelineno-39-8 href=#__codelineno-39-8></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">monitoring</span>
<a id=__codelineno-39-9 name=__codelineno-39-9 href=#__codelineno-39-9></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-39-10 name=__codelineno-39-10 href=#__codelineno-39-10></a><span class=w>  </span><span class=nt>endpoints</span><span class=p>:</span>
<a id=__codelineno-39-11 name=__codelineno-39-11 href=#__codelineno-39-11></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>bearerTokenFile</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/var/run/secrets/kubernetes.io/serviceaccount/token</span>
<a id=__codelineno-39-12 name=__codelineno-39-12 href=#__codelineno-39-12></a><span class=w>    </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">30s</span>
<a id=__codelineno-39-13 name=__codelineno-39-13 href=#__codelineno-39-13></a><span class=w>    </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">https-metrics</span>
<a id=__codelineno-39-14 name=__codelineno-39-14 href=#__codelineno-39-14></a><span class=w>    </span><span class=nt>scheme</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">https</span>
<a id=__codelineno-39-15 name=__codelineno-39-15 href=#__codelineno-39-15></a><span class=w>    </span><span class=nt>tlsConfig</span><span class=p>:</span>
<a id=__codelineno-39-16 name=__codelineno-39-16 href=#__codelineno-39-16></a><span class=w>      </span><span class=nt>insecureSkipVerify</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id=__codelineno-39-17 name=__codelineno-39-17 href=#__codelineno-39-17></a><span class=w>  </span><span class=nt>jobLabel</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">app.kubernetes.io/name</span>
<a id=__codelineno-39-18 name=__codelineno-39-18 href=#__codelineno-39-18></a><span class=w>  </span><span class=nt>namespaceSelector</span><span class=p>:</span>
<a id=__codelineno-39-19 name=__codelineno-39-19 href=#__codelineno-39-19></a><span class=w>    </span><span class=nt>matchNames</span><span class=p>:</span>
<a id=__codelineno-39-20 name=__codelineno-39-20 href=#__codelineno-39-20></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kube-system</span>
<a id=__codelineno-39-21 name=__codelineno-39-21 href=#__codelineno-39-21></a><span class=w>  </span><span class=nt>selector</span><span class=p>:</span>
<a id=__codelineno-39-22 name=__codelineno-39-22 href=#__codelineno-39-22></a><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span>
<a id=__codelineno-39-23 name=__codelineno-39-23 href=#__codelineno-39-23></a><span class=w>      </span><span class=nt>app.kubernetes.io/name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kube-scheduler</span>
<a id=__codelineno-39-24 name=__codelineno-39-24 href=#__codelineno-39-24></a>
<a id=__codelineno-39-25 name=__codelineno-39-25 href=#__codelineno-39-25></a><span class=nn>---</span>
<a id=__codelineno-39-26 name=__codelineno-39-26 href=#__codelineno-39-26></a>
<a id=__codelineno-39-27 name=__codelineno-39-27 href=#__codelineno-39-27></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id=__codelineno-39-28 name=__codelineno-39-28 href=#__codelineno-39-28></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<a id=__codelineno-39-29 name=__codelineno-39-29 href=#__codelineno-39-29></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-39-30 name=__codelineno-39-30 href=#__codelineno-39-30></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kube-system</span>
<a id=__codelineno-39-31 name=__codelineno-39-31 href=#__codelineno-39-31></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kube-scheduler</span>
<a id=__codelineno-39-32 name=__codelineno-39-32 href=#__codelineno-39-32></a><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w> </span><span class=c1># 必须和上面的 ServiceMonitor 下面的 matchLabels 保持一致</span>
<a id=__codelineno-39-33 name=__codelineno-39-33 href=#__codelineno-39-33></a><span class=w>    </span><span class=nt>app.kubernetes.io/name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kube-scheduler</span>
<a id=__codelineno-39-34 name=__codelineno-39-34 href=#__codelineno-39-34></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-39-35 name=__codelineno-39-35 href=#__codelineno-39-35></a><span class=w>  </span><span class=nt>selector</span><span class=p>:</span>
<a id=__codelineno-39-36 name=__codelineno-39-36 href=#__codelineno-39-36></a><span class=w>    </span><span class=nt>component</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kube-scheduler</span>
<a id=__codelineno-39-37 name=__codelineno-39-37 href=#__codelineno-39-37></a><span class=w>  </span><span class=nt>ports</span><span class=p>:</span>
<a id=__codelineno-39-38 name=__codelineno-39-38 href=#__codelineno-39-38></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">https-metrics</span>
<a id=__codelineno-39-39 name=__codelineno-39-39 href=#__codelineno-39-39></a><span class=w>      </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10259</span>
<a id=__codelineno-39-40 name=__codelineno-39-40 href=#__codelineno-39-40></a><span class=w>      </span><span class=c1># 需要注意现在版本默认的安全端口是10259</span>
<a id=__codelineno-39-41 name=__codelineno-39-41 href=#__codelineno-39-41></a><span class=w>      </span><span class=nt>targetPort</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10259</span><span class=w> </span>
</code></pre></div> <p>综上所述，通过ServiceMonitor监控应用时，如果监控没有找到目标主机的排查步骤，排查步骤大致如下：</p> <ul> <li>确认ServiceMonitor是否成功创建。</li> <li>确认Prometheus是否生成了相关配置。</li> <li>确认存在ServiceMonitor匹配的Service。</li> <li>确认通过Service能够访问程序的Metrics接口。</li> <li>确认Service的端口和Scheme、ServiceMonitor一致。</li> </ul> <h3 id=34-云原生应用监控>3.4 云原生应用监控<a class=headerlink href=#34-云原生应用监控 title="Permanent link">&para;</a></h3> <p>通过前面的学习，我们对Prometheus相关知识做了一些了解，也理解了云原生和非云原生应用的监控流程，接下来通过两个示例演示应用监控的基本流程。</p> <p>除了 Kubernetes 集群中的一些资源对象、节点以及组件需要监控，有的时候我们可能还需要根据实际的业务需求去添加自定义的监控项，添加一个自定义监控的步骤也是非常简单的。</p> <p>第一步建立一个 ServiceMonitor 对象，用于 Prometheus 添加监控项</p> <p>第二步为 ServiceMonitor 对象关联 metrics 数据接口的一个 Service 对象</p> <p>第三步确保 Service 对象可以正确获取到 metrics 数据</p> <p>接下来我们就来为大家演示如何添加 etcd 集群的监控。无论是 Kubernetes 集群外的还是使用 kubeadm 安装在集群内部的 etcd 集群，我们这里都将其视作集群外的独立集群，因为对于二者的使用方法没什么特殊之处。</p> <p>在安装Prometheus时，并没有对Etcd集群进行监控，Etcd集群是Kubernetes的数据库，掌握着Kubernetes最核心的数据，Etcd的状态和性能直接影响Kubernetes集群的状态，所以对Etcd集群的监控是非常重要的。</p> <p>接下来通过Etcd的监控学习如何对云原生应用进行监控。</p> <p>之前讲了，云原生应用会提供一个Metrics接口，可以直接获取到内部的运行信息，比如Etcd的内部数据可以通过2379的/metrics得到，和之前的kubelet类似。不同的是，Etcd对外的接口必须通过HTTPS协议访问，所以在请求时需要加上对应的证书，比如：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-40-1 name=__codelineno-40-1 href=#__codelineno-40-1></a>$<span class=w> </span>curl<span class=w> </span>-s<span class=w> </span>--cert<span class=w> </span>/etc/kubernetes/pki/etcd/etcd.pem<span class=w> </span>--key<span class=w> </span>/etc/kubernetes/pki/etcd/etcd-key.pem<span class=w> </span>https://YOUR_ETCD_IP:2379/metrics<span class=w> </span>-k<span class=w> </span><span class=p>|</span><span class=w> </span>tail<span class=w> </span>-1
</code></pre></div> <p>证书的位置可以在Etcd配置文件中获得（注意配置文件的位置，不同的集群位置可能不同 ， Kubeadm 安 装 方 式 可 能 会在/etc/kubernetes/manifests/etcd.yml中)：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-41-1 name=__codelineno-41-1 href=#__codelineno-41-1></a>$<span class=w> </span>grep<span class=w> </span>-E<span class=w> </span><span class=s2>&quot;key-file|cert-file&quot;</span><span class=w> </span>/etc/kubernetes/manifests/etcd.yaml
<a id=__codelineno-41-2 name=__codelineno-41-2 href=#__codelineno-41-2></a><span class=w>    </span>-<span class=w> </span>--cert-file<span class=o>=</span>/etc/kubernetes/pki/etcd/server.crt
<a id=__codelineno-41-3 name=__codelineno-41-3 href=#__codelineno-41-3></a><span class=w>    </span>-<span class=w> </span>--key-file<span class=o>=</span>/etc/kubernetes/pki/etcd/server.key
<a id=__codelineno-41-4 name=__codelineno-41-4 href=#__codelineno-41-4></a><span class=w>    </span>-<span class=w> </span>--peer-cert-file<span class=o>=</span>/etc/kubernetes/pki/etcd/peer.crt
<a id=__codelineno-41-5 name=__codelineno-41-5 href=#__codelineno-41-5></a><span class=w>    </span>-<span class=w> </span>--peer-key-file<span class=o>=</span>/etc/kubernetes/pki/etcd/peer.key
</code></pre></div> <p>可以看到，此时加上--cert和--key参数才可以访问Etcd的Metrics接口，所以在配置ServiceMonitor时需要加上证书的配置。</p> <p><strong>1．创建Etcd ServiceMonitor</strong></p> <p>首先，需要配置Etcd的Service和Endpoint：</p> <p><code>kubernetesControlPlane-serviceMonitorEtcd.yaml</code></p> <div class=highlight><pre><span></span><code><a id=__codelineno-42-1 name=__codelineno-42-1 href=#__codelineno-42-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">monitoring.coreos.com/v1</span>
<a id=__codelineno-42-2 name=__codelineno-42-2 href=#__codelineno-42-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ServiceMonitor</span>
<a id=__codelineno-42-3 name=__codelineno-42-3 href=#__codelineno-42-3></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-42-4 name=__codelineno-42-4 href=#__codelineno-42-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">etcd-k8s</span>
<a id=__codelineno-42-5 name=__codelineno-42-5 href=#__codelineno-42-5></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">monitoring</span>
<a id=__codelineno-42-6 name=__codelineno-42-6 href=#__codelineno-42-6></a><span class=w>  </span><span class=nt>labels</span><span class=p>:</span>
<a id=__codelineno-42-7 name=__codelineno-42-7 href=#__codelineno-42-7></a><span class=w>    </span><span class=nt>k8s-app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">etcd-k8s</span>
<a id=__codelineno-42-8 name=__codelineno-42-8 href=#__codelineno-42-8></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-42-9 name=__codelineno-42-9 href=#__codelineno-42-9></a><span class=w>  </span><span class=nt>jobLabel</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">k8s-app</span>
<a id=__codelineno-42-10 name=__codelineno-42-10 href=#__codelineno-42-10></a><span class=w>  </span><span class=nt>endpoints</span><span class=p>:</span>
<a id=__codelineno-42-11 name=__codelineno-42-11 href=#__codelineno-42-11></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">port</span>
<a id=__codelineno-42-12 name=__codelineno-42-12 href=#__codelineno-42-12></a><span class=w>      </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">15s</span>
<a id=__codelineno-42-13 name=__codelineno-42-13 href=#__codelineno-42-13></a><span class=w>  </span><span class=nt>selector</span><span class=p>:</span>
<a id=__codelineno-42-14 name=__codelineno-42-14 href=#__codelineno-42-14></a><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span>
<a id=__codelineno-42-15 name=__codelineno-42-15 href=#__codelineno-42-15></a><span class=w>      </span><span class=nt>k8s-app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">etcd</span>
<a id=__codelineno-42-16 name=__codelineno-42-16 href=#__codelineno-42-16></a><span class=w>  </span><span class=nt>namespaceSelector</span><span class=p>:</span>
<a id=__codelineno-42-17 name=__codelineno-42-17 href=#__codelineno-42-17></a><span class=w>    </span><span class=nt>matchNames</span><span class=p>:</span>
<a id=__codelineno-42-18 name=__codelineno-42-18 href=#__codelineno-42-18></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kube-system</span>
</code></pre></div> <p>需要注意将YOUR_ETCD_IP改成自己的Etcd主机IP，另外需要注意port的名称为https-metrics，要和后面的ServiceMonitor保持一致。之后创建该资源并查看Service的ClusterIP：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-43-1 name=__codelineno-43-1 href=#__codelineno-43-1></a>$<span class=w> </span>kubectl<span class=w> </span>create<span class=w> </span>-f<span class=w> </span>kubernetesControlPlane-serviceMonitorEtcd.yaml
<a id=__codelineno-43-2 name=__codelineno-43-2 href=#__codelineno-43-2></a>servicemonitor.monitoring.coreos.com/etcd-k8s<span class=w> </span>created
</code></pre></div> <p><strong>2.创建Etcd Service</strong></p> <p>但实际上现在并不能监控到 etcd 集群，因为并没有一个满足 ServiceMonitor 条件的 Service 对象与之关联：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-44-1 name=__codelineno-44-1 href=#__codelineno-44-1></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>svc<span class=w> </span>-n<span class=w> </span>kube-system<span class=w> </span>-l<span class=w> </span>k8s-app<span class=o>=</span>etcd
<a id=__codelineno-44-2 name=__codelineno-44-2 href=#__codelineno-44-2></a>No<span class=w> </span>resources<span class=w> </span>found<span class=w> </span><span class=k>in</span><span class=w> </span>kube-system<span class=w> </span>namespace.
</code></pre></div> <p>所以接下来我们需要创建一个满足上面条件的 Service 对象，由于我们把 etcd 当成是集群外部的服务，所以要引入到集群中来我们就需要自定义 Endpoints 对象来创建 Service 对象了：</p> <p><code>etcd-service.yaml</code></p> <div class=highlight><pre><span></span><code><a id=__codelineno-45-1 name=__codelineno-45-1 href=#__codelineno-45-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id=__codelineno-45-2 name=__codelineno-45-2 href=#__codelineno-45-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<a id=__codelineno-45-3 name=__codelineno-45-3 href=#__codelineno-45-3></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-45-4 name=__codelineno-45-4 href=#__codelineno-45-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">etcd-k8s</span>
<a id=__codelineno-45-5 name=__codelineno-45-5 href=#__codelineno-45-5></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kube-system</span>
<a id=__codelineno-45-6 name=__codelineno-45-6 href=#__codelineno-45-6></a><span class=w>  </span><span class=nt>labels</span><span class=p>:</span>
<a id=__codelineno-45-7 name=__codelineno-45-7 href=#__codelineno-45-7></a><span class=w>    </span><span class=nt>k8s-app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">etcd</span>
<a id=__codelineno-45-8 name=__codelineno-45-8 href=#__codelineno-45-8></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-45-9 name=__codelineno-45-9 href=#__codelineno-45-9></a><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ClusterIP</span>
<a id=__codelineno-45-10 name=__codelineno-45-10 href=#__codelineno-45-10></a><span class=w>  </span><span class=nt>clusterIP</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">None</span><span class=w> </span><span class=c1># 一定要设置 clusterIP:None</span>
<a id=__codelineno-45-11 name=__codelineno-45-11 href=#__codelineno-45-11></a><span class=w>  </span><span class=nt>ports</span><span class=p>:</span>
<a id=__codelineno-45-12 name=__codelineno-45-12 href=#__codelineno-45-12></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">port</span>
<a id=__codelineno-45-13 name=__codelineno-45-13 href=#__codelineno-45-13></a><span class=w>      </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">2381</span>
<a id=__codelineno-45-14 name=__codelineno-45-14 href=#__codelineno-45-14></a><span class=nn>---</span>
<a id=__codelineno-45-15 name=__codelineno-45-15 href=#__codelineno-45-15></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id=__codelineno-45-16 name=__codelineno-45-16 href=#__codelineno-45-16></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Endpoints</span>
<a id=__codelineno-45-17 name=__codelineno-45-17 href=#__codelineno-45-17></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-45-18 name=__codelineno-45-18 href=#__codelineno-45-18></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">etcd-k8s</span>
<a id=__codelineno-45-19 name=__codelineno-45-19 href=#__codelineno-45-19></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kube-system</span>
<a id=__codelineno-45-20 name=__codelineno-45-20 href=#__codelineno-45-20></a><span class=w>  </span><span class=nt>labels</span><span class=p>:</span>
<a id=__codelineno-45-21 name=__codelineno-45-21 href=#__codelineno-45-21></a><span class=w>    </span><span class=nt>k8s-app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">etcd</span>
<a id=__codelineno-45-22 name=__codelineno-45-22 href=#__codelineno-45-22></a><span class=nt>subsets</span><span class=p>:</span>
<a id=__codelineno-45-23 name=__codelineno-45-23 href=#__codelineno-45-23></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>addresses</span><span class=p>:</span>
<a id=__codelineno-45-24 name=__codelineno-45-24 href=#__codelineno-45-24></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>ip</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">192.168.1.56</span><span class=w> </span><span class=c1># 指定etcd节点地址，如果是集群则继续向下添加</span>
<a id=__codelineno-45-25 name=__codelineno-45-25 href=#__codelineno-45-25></a><span class=w>        </span><span class=nt>nodeName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">etc-master</span>
<a id=__codelineno-45-26 name=__codelineno-45-26 href=#__codelineno-45-26></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
<a id=__codelineno-45-27 name=__codelineno-45-27 href=#__codelineno-45-27></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">port</span>
<a id=__codelineno-45-28 name=__codelineno-45-28 href=#__codelineno-45-28></a><span class=w>        </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">2381</span>
</code></pre></div> <div class=highlight><pre><span></span><code><a id=__codelineno-46-1 name=__codelineno-46-1 href=#__codelineno-46-1></a>$<span class=w> </span>kubectl<span class=w> </span>create<span class=w> </span>-f<span class=w> </span>etcd-service.yaml
<a id=__codelineno-46-2 name=__codelineno-46-2 href=#__codelineno-46-2></a>service/etcd-k8s<span class=w> </span>created
<a id=__codelineno-46-3 name=__codelineno-46-3 href=#__codelineno-46-3></a>endpoints/etcd-k8s<span class=w> </span>created
</code></pre></div> <p>我们这里创建的 Service 没有采用前面通过 label 标签的形式去匹配 Pod 的做法，因为前面我们说过很多时候我们创建的 etcd 集群是独立于集群之外的，这种情况下面我们就需要自定义一个 Endpoints，要注意 <code>metadata</code> 区域的内容要和 Service 保持一致，Service 的 clusterIP 设置为 None，新版本的 etcd 将 metrics 接口数据放置到了 2381 端口。直接创建该资源对象即可：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-47-1 name=__codelineno-47-1 href=#__codelineno-47-1></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>svc<span class=w> </span>-n<span class=w> </span>kube-system<span class=w> </span>-l<span class=w> </span>k8s-app<span class=o>=</span>etcd
<a id=__codelineno-47-2 name=__codelineno-47-2 href=#__codelineno-47-2></a>NAME<span class=w>       </span>TYPE<span class=w>        </span>CLUSTER-IP<span class=w>   </span>EXTERNAL-IP<span class=w>   </span>PORT<span class=o>(</span>S<span class=o>)</span><span class=w>    </span>AGE
<a id=__codelineno-47-3 name=__codelineno-47-3 href=#__codelineno-47-3></a>etcd-k8s<span class=w>   </span>ClusterIP<span class=w>   </span>None<span class=w>         </span>&lt;none&gt;<span class=w>        </span><span class=m>2381</span>/TCP<span class=w>   </span>37s
</code></pre></div> <p>创建完成后，隔一会儿去Prometheus的Dashboard中查看targets，便会有etcd的监控项了：</p> <p><img alt class=zoom src=../../../assets/static/kubernetes/5/etcd-target-01.png></p> <p>可以看到有一个明显的错误，2381 端口链接被拒绝，这是因为我们这里的 etcd 的 metrics 接口是监听在 <code>127.0.0.1</code> 这个 IP 上面的，所以访问会拒绝：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-48-1 name=__codelineno-48-1 href=#__codelineno-48-1></a>--listen-metrics-urls=http://127.0.0.1:2381
</code></pre></div> <p>我们只需要在 <code>/etc/kubernetes/manifests/</code>目录下面（静态Pod默认的目录）的 <code>etcd.yaml</code> 文件中将上面的<code>listen-metrics-urls</code> 更改成节点IP即可：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-49-1 name=__codelineno-49-1 href=#__codelineno-49-1></a>--listen-metrics-urls=http://0.0.0.0:2381
</code></pre></div> <p>当etcd重启生效后，查看etcd这个监控任务就正常了： <img alt class=zoom src=../../../assets/static/kubernetes/5/etcd-target-02.png></p> <p><strong>3．配置Grafana</strong></p> <p>依次单击“+”→Import，之后输入Etcd的Grafana Dashboard地址</p> <p>数据采集到后，可以在 grafana 中导入编号为 <code>3070</code> 的 dashboard，就可以获取到 etcd 的监控图表：</p> <p>之后就可以看到Etcd集群的状态，如图15.16所示。</p> <p><img alt class=zoom src=../../../assets/static/kubernetes/5/etcd-target-03.png></p> <p>图15.16　查看Etcd监控</p> <div class="admonition example"> <p class=admonition-title>参考文献</p> <p><a href="https://p8s.io/docs/operator/custom/?h=etc#etcd-%E7%9B%91%E6%8E%A7">https://p8s.io/docs/operator/custom/?h=etc#etcd-%E7%9B%91%E6%8E%A7</a></p> </div> <h3 id=35-非云原生监控exporter>3.5 非云原生监控Exporter<a class=headerlink href=#35-非云原生监控exporter title="Permanent link">&para;</a></h3> <p>上一小节针对云原生应用Etcd进行了监控，可以看到符合云原生要素开发的应用，自带的都有一个Metrics接口，可以让监控平台直接采集到监控数据。</p> <p>而非原生应用（如MySQL、Redis、Kakfa等）没有暴露Metrics接口，所以可以使用对应的Exporter采集数据，并暴露Metrics接口。本小节将使用MySQL作为一个测试用例，演示如何使用Exporter监控非云原生应用。</p> <p>1．部署测试用例</p> <p>首先部署MySQL至Kubernetes集群中，如果读者有需要监控的MySQL，可以忽略此步骤，直接配置MySQL的权限即可：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-50-1 name=__codelineno-50-1 href=#__codelineno-50-1></a>$<span class=w> </span>kubectl<span class=w> </span>create<span class=w> </span>deploy<span class=w> </span>mysql<span class=w> </span>--image<span class=o>=</span>registry.cn-beijing.aliyuncs.com/dotbalo/mysql:5.7.23
<a id=__codelineno-50-2 name=__codelineno-50-2 href=#__codelineno-50-2></a>deployment.apps/mysql<span class=w> </span>created
<a id=__codelineno-50-3 name=__codelineno-50-3 href=#__codelineno-50-3></a>
<a id=__codelineno-50-4 name=__codelineno-50-4 href=#__codelineno-50-4></a>$<span class=w> </span>kubectl<span class=w> </span><span class=nb>set</span><span class=w> </span>env<span class=w> </span>deploy/mysql<span class=w> </span><span class=nv>MYSQL_ROOT_PASSWORD</span><span class=o>=</span>mysql
<a id=__codelineno-50-5 name=__codelineno-50-5 href=#__codelineno-50-5></a>deployment.apps/mysql<span class=w> </span>env<span class=w> </span>updated
<a id=__codelineno-50-6 name=__codelineno-50-6 href=#__codelineno-50-6></a>
<a id=__codelineno-50-7 name=__codelineno-50-7 href=#__codelineno-50-7></a><span class=c1># 查看pod是否正常</span>
<a id=__codelineno-50-8 name=__codelineno-50-8 href=#__codelineno-50-8></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>po<span class=w> </span>-l<span class=w> </span><span class=nv>app</span><span class=o>=</span>mysql
<a id=__codelineno-50-9 name=__codelineno-50-9 href=#__codelineno-50-9></a>NAME<span class=w>                     </span>READY<span class=w>   </span>STATUS<span class=w>    </span>RESTARTS<span class=w>   </span>AGE
<a id=__codelineno-50-10 name=__codelineno-50-10 href=#__codelineno-50-10></a>mysql-69d6f69557-8hdg6<span class=w>   </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>52s
</code></pre></div> <p>创建Service暴露MySQL：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-51-1 name=__codelineno-51-1 href=#__codelineno-51-1></a>$<span class=w> </span>kubectl<span class=w> </span>expose<span class=w> </span>deploy<span class=w> </span>mysql<span class=w> </span>--port<span class=w> </span><span class=m>3306</span>
<a id=__codelineno-51-2 name=__codelineno-51-2 href=#__codelineno-51-2></a>service/mysql<span class=w> </span>exposed
<a id=__codelineno-51-3 name=__codelineno-51-3 href=#__codelineno-51-3></a>
<a id=__codelineno-51-4 name=__codelineno-51-4 href=#__codelineno-51-4></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>svc<span class=w> </span>-l<span class=w> </span><span class=nv>app</span><span class=o>=</span>mysql
<a id=__codelineno-51-5 name=__codelineno-51-5 href=#__codelineno-51-5></a>NAME<span class=w>    </span>TYPE<span class=w>        </span>CLUSTER-IP<span class=w>       </span>EXTERNAL-IP<span class=w>   </span>PORT<span class=o>(</span>S<span class=o>)</span><span class=w>    </span>AGE
<a id=__codelineno-51-6 name=__codelineno-51-6 href=#__codelineno-51-6></a>mysql<span class=w>   </span>ClusterIP<span class=w>   </span><span class=m>10</span>.110.161.154<span class=w>   </span>&lt;none&gt;<span class=w>        </span><span class=m>3306</span>/TCP<span class=w>   </span>24s
</code></pre></div> <p>检查Service是否可用：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-52-1 name=__codelineno-52-1 href=#__codelineno-52-1></a>$<span class=w> </span>telnet<span class=w> </span><span class=m>10</span>.110.161.154<span class=w> </span><span class=m>3306</span>
<a id=__codelineno-52-2 name=__codelineno-52-2 href=#__codelineno-52-2></a>Trying<span class=w> </span><span class=m>10</span>.110.161.154...
<a id=__codelineno-52-3 name=__codelineno-52-3 href=#__codelineno-52-3></a>Connected<span class=w> </span>to<span class=w> </span><span class=m>10</span>.110.161.154.
<a id=__codelineno-52-4 name=__codelineno-52-4 href=#__codelineno-52-4></a>Escape<span class=w> </span>character<span class=w> </span>is<span class=w> </span><span class=s1>&#39;^]&#39;</span>.
<a id=__codelineno-52-5 name=__codelineno-52-5 href=#__codelineno-52-5></a>J
<a id=__codelineno-52-6 name=__codelineno-52-6 href=#__codelineno-52-6></a><span class=m>5</span>.7.23/adMH4SqV,w+b<span class=err>&#39;</span>y?E8mysql_native_password
</code></pre></div> <p>登录MySQL，创建Exporter所需的用户和权限（如果已经有需要监控的MySQL，直接执行此步骤即可）：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-53-1 name=__codelineno-53-1 href=#__codelineno-53-1></a>$<span class=w> </span>kubectl<span class=w> </span><span class=nb>exec</span><span class=w> </span>-ti<span class=w> </span>mysql-69d6f69557-5vnvg<span class=w> </span>--<span class=w> </span>bash
<a id=__codelineno-53-2 name=__codelineno-53-2 href=#__codelineno-53-2></a>root@mysql-69d6f69557-5vnvg:/#<span class=w> </span>mysql<span class=w> </span>-uroot<span class=w> </span>-pmysql
<a id=__codelineno-53-3 name=__codelineno-53-3 href=#__codelineno-53-3></a>
<a id=__codelineno-53-4 name=__codelineno-53-4 href=#__codelineno-53-4></a>mysql&gt;<span class=w> </span>CREATE<span class=w> </span>USER<span class=w> </span><span class=s1>&#39;exporter&#39;</span>@<span class=s1>&#39;%&#39;</span><span class=w> </span>IDENTIFIED<span class=w> </span>BY<span class=w> </span><span class=s1>&#39;exporter&#39;</span><span class=w> </span>WITH<span class=w> </span>MAX_USER_CONNECTIONS<span class=w> </span><span class=m>3</span><span class=p>;</span>
<a id=__codelineno-53-5 name=__codelineno-53-5 href=#__codelineno-53-5></a>Query<span class=w> </span>OK,<span class=w> </span><span class=m>0</span><span class=w> </span>rows<span class=w> </span>affected<span class=w> </span><span class=o>(</span><span class=m>0</span>.00<span class=w> </span>sec<span class=o>)</span>
<a id=__codelineno-53-6 name=__codelineno-53-6 href=#__codelineno-53-6></a>
<a id=__codelineno-53-7 name=__codelineno-53-7 href=#__codelineno-53-7></a>mysql&gt;<span class=w> </span>GRANT<span class=w> </span>PROCESS,<span class=w> </span>REPLICATION<span class=w> </span>CLIENT,<span class=w> </span>SELECT<span class=w> </span>ON<span class=w> </span>*.*<span class=w> </span>TO<span class=w> </span><span class=s1>&#39;exporter&#39;</span>@<span class=s1>&#39;%&#39;</span><span class=p>;</span>
<a id=__codelineno-53-8 name=__codelineno-53-8 href=#__codelineno-53-8></a>Query<span class=w> </span>OK,<span class=w> </span><span class=m>0</span><span class=w> </span>rows<span class=w> </span>affected<span class=w> </span><span class=o>(</span><span class=m>0</span>.00<span class=w> </span>sec<span class=o>)</span>
<a id=__codelineno-53-9 name=__codelineno-53-9 href=#__codelineno-53-9></a>mysql&gt;<span class=w> </span>quit
<a id=__codelineno-53-10 name=__codelineno-53-10 href=#__codelineno-53-10></a>Bye
<a id=__codelineno-53-11 name=__codelineno-53-11 href=#__codelineno-53-11></a>root@mysql-69d6f69557-5vnvg:/#<span class=w> </span><span class=nb>exit</span>
<a id=__codelineno-53-12 name=__codelineno-53-12 href=#__codelineno-53-12></a><span class=nb>exit</span>
</code></pre></div> <p>配置MySQL Exporter采集MySQL监控数据：</p> <p>mysql-exporter.yaml</p> <div class=highlight><pre><span></span><code><a id=__codelineno-54-1 name=__codelineno-54-1 href=#__codelineno-54-1></a><span class=nn>---</span>
<a id=__codelineno-54-2 name=__codelineno-54-2 href=#__codelineno-54-2></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<a id=__codelineno-54-3 name=__codelineno-54-3 href=#__codelineno-54-3></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<a id=__codelineno-54-4 name=__codelineno-54-4 href=#__codelineno-54-4></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-54-5 name=__codelineno-54-5 href=#__codelineno-54-5></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">mysql-exporter</span>
<a id=__codelineno-54-6 name=__codelineno-54-6 href=#__codelineno-54-6></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">monitoring</span>
<a id=__codelineno-54-7 name=__codelineno-54-7 href=#__codelineno-54-7></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-54-8 name=__codelineno-54-8 href=#__codelineno-54-8></a><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<a id=__codelineno-54-9 name=__codelineno-54-9 href=#__codelineno-54-9></a><span class=w>  </span><span class=nt>selector</span><span class=p>:</span>
<a id=__codelineno-54-10 name=__codelineno-54-10 href=#__codelineno-54-10></a><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span>
<a id=__codelineno-54-11 name=__codelineno-54-11 href=#__codelineno-54-11></a><span class=w>      </span><span class=nt>k8s-app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">mysql-exporter</span>
<a id=__codelineno-54-12 name=__codelineno-54-12 href=#__codelineno-54-12></a><span class=w>  </span><span class=nt>template</span><span class=p>:</span>
<a id=__codelineno-54-13 name=__codelineno-54-13 href=#__codelineno-54-13></a><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-54-14 name=__codelineno-54-14 href=#__codelineno-54-14></a><span class=w>      </span><span class=nt>labels</span><span class=p>:</span>
<a id=__codelineno-54-15 name=__codelineno-54-15 href=#__codelineno-54-15></a><span class=w>        </span><span class=nt>k8s-app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">mysql-exporter</span>
<a id=__codelineno-54-16 name=__codelineno-54-16 href=#__codelineno-54-16></a><span class=w>    </span><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-54-17 name=__codelineno-54-17 href=#__codelineno-54-17></a><span class=w>      </span><span class=nt>containers</span><span class=p>:</span>
<a id=__codelineno-54-18 name=__codelineno-54-18 href=#__codelineno-54-18></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">mysql-exporter</span>
<a id=__codelineno-54-19 name=__codelineno-54-19 href=#__codelineno-54-19></a><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">registry.cn-beijing.aliyuncs.com/dotbalo/mysqld-exporter</span><span class=w> </span>
<a id=__codelineno-54-20 name=__codelineno-54-20 href=#__codelineno-54-20></a><span class=w>        </span><span class=nt>env</span><span class=p>:</span>
<a id=__codelineno-54-21 name=__codelineno-54-21 href=#__codelineno-54-21></a><span class=w>         </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">DATA_SOURCE_NAME</span>
<a id=__codelineno-54-22 name=__codelineno-54-22 href=#__codelineno-54-22></a><span class=w>           </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s>&quot;root:mysql@(mysql.default:3306)/&quot;</span>
<a id=__codelineno-54-23 name=__codelineno-54-23 href=#__codelineno-54-23></a><span class=w>        </span><span class=nt>imagePullPolicy</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
<a id=__codelineno-54-24 name=__codelineno-54-24 href=#__codelineno-54-24></a><span class=w>        </span><span class=nt>ports</span><span class=p>:</span>
<a id=__codelineno-54-25 name=__codelineno-54-25 href=#__codelineno-54-25></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">9104</span>
<a id=__codelineno-54-26 name=__codelineno-54-26 href=#__codelineno-54-26></a><span class=nn>---</span>
<a id=__codelineno-54-27 name=__codelineno-54-27 href=#__codelineno-54-27></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id=__codelineno-54-28 name=__codelineno-54-28 href=#__codelineno-54-28></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<a id=__codelineno-54-29 name=__codelineno-54-29 href=#__codelineno-54-29></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-54-30 name=__codelineno-54-30 href=#__codelineno-54-30></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">mysql-exporter</span>
<a id=__codelineno-54-31 name=__codelineno-54-31 href=#__codelineno-54-31></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">monitoring</span>
<a id=__codelineno-54-32 name=__codelineno-54-32 href=#__codelineno-54-32></a><span class=w>  </span><span class=nt>labels</span><span class=p>:</span>
<a id=__codelineno-54-33 name=__codelineno-54-33 href=#__codelineno-54-33></a><span class=w>    </span><span class=nt>k8s-app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">mysql-exporter</span>
<a id=__codelineno-54-34 name=__codelineno-54-34 href=#__codelineno-54-34></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-54-35 name=__codelineno-54-35 href=#__codelineno-54-35></a><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ClusterIP</span>
<a id=__codelineno-54-36 name=__codelineno-54-36 href=#__codelineno-54-36></a><span class=w>  </span><span class=nt>selector</span><span class=p>:</span>
<a id=__codelineno-54-37 name=__codelineno-54-37 href=#__codelineno-54-37></a><span class=w>    </span><span class=nt>k8s-app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">mysql-exporter</span>
<a id=__codelineno-54-38 name=__codelineno-54-38 href=#__codelineno-54-38></a><span class=w>  </span><span class=nt>ports</span><span class=p>:</span>
<a id=__codelineno-54-39 name=__codelineno-54-39 href=#__codelineno-54-39></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">api</span>
<a id=__codelineno-54-40 name=__codelineno-54-40 href=#__codelineno-54-40></a><span class=w>    </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">9104</span>
<a id=__codelineno-54-41 name=__codelineno-54-41 href=#__codelineno-54-41></a><span class=w>    </span><span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
</code></pre></div> <p>注 意 DATA_SOURCE_NAME 的 配 置 ， 需要将 <code>exporter:exporter@(mysql.default:3306)/</code>改成自己的实际配置，格式为： <code>USERNAME:PASSWORD@MYSQL_HOST_ADDRESS:MYSQL_PORT</code>。</p> <p>创建Exporter：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-55-1 name=__codelineno-55-1 href=#__codelineno-55-1></a>$<span class=w> </span>kubectl<span class=w> </span>create<span class=w> </span>-f<span class=w> </span>mysql-exporter.yaml
<a id=__codelineno-55-2 name=__codelineno-55-2 href=#__codelineno-55-2></a>deployment.apps/mysql-exporter<span class=w> </span>created
<a id=__codelineno-55-3 name=__codelineno-55-3 href=#__codelineno-55-3></a>service/mysql-exporter<span class=w> </span>created
<a id=__codelineno-55-4 name=__codelineno-55-4 href=#__codelineno-55-4></a>
<a id=__codelineno-55-5 name=__codelineno-55-5 href=#__codelineno-55-5></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>-f<span class=w> </span>mysql-exporter.yaml
<a id=__codelineno-55-6 name=__codelineno-55-6 href=#__codelineno-55-6></a>NAME<span class=w>                             </span>READY<span class=w>   </span>UP-TO-DATE<span class=w>   </span>AVAILABLE<span class=w>   </span>AGE
<a id=__codelineno-55-7 name=__codelineno-55-7 href=#__codelineno-55-7></a>deployment.apps/mysql-exporter<span class=w>   </span><span class=m>1</span>/1<span class=w>     </span><span class=m>1</span><span class=w>            </span><span class=m>1</span><span class=w>           </span>9s
<a id=__codelineno-55-8 name=__codelineno-55-8 href=#__codelineno-55-8></a>
<a id=__codelineno-55-9 name=__codelineno-55-9 href=#__codelineno-55-9></a>NAME<span class=w>                     </span>TYPE<span class=w>        </span>CLUSTER-IP<span class=w>       </span>EXTERNAL-IP<span class=w>   </span>PORT<span class=o>(</span>S<span class=o>)</span><span class=w>    </span>AGE
<a id=__codelineno-55-10 name=__codelineno-55-10 href=#__codelineno-55-10></a>service/mysql-exporter<span class=w>   </span>ClusterIP<span class=w>   </span><span class=m>10</span>.105.237.248<span class=w>   </span>&lt;none&gt;<span class=w>        </span><span class=m>9104</span>/TCP<span class=w>   </span>9s
</code></pre></div> <p>通过该Service地址检查是否能正常获取Metrics数据：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-56-1 name=__codelineno-56-1 href=#__codelineno-56-1></a>$<span class=w> </span>curl<span class=w> </span>-s<span class=w> </span><span class=m>10</span>.105.237.248:9104/metrics<span class=w> </span><span class=p>|</span><span class=w> </span>tail<span class=w> </span>-1
<a id=__codelineno-56-2 name=__codelineno-56-2 href=#__codelineno-56-2></a>promhttp_metric_handler_requests_total<span class=o>{</span><span class=nv>code</span><span class=o>=</span><span class=s2>&quot;503&quot;</span><span class=o>}</span><span class=w> </span><span class=m>0</span>
</code></pre></div> <p>2．配置ServiceMonitor和Grafana</p> <p>配置Exporter后，Metrics接口已经有了，剩下的配置其实和云原生监控流程已经一样了。</p> <p>首先配置ServiceMonitor，然后导入Grafana Dashboard即可。配置ServiceMonitor：</p> <p>mysql-sm.yaml</p> <div class=highlight><pre><span></span><code><a id=__codelineno-57-1 name=__codelineno-57-1 href=#__codelineno-57-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">monitoring.coreos.com/v1</span>
<a id=__codelineno-57-2 name=__codelineno-57-2 href=#__codelineno-57-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ServiceMonitor</span>
<a id=__codelineno-57-3 name=__codelineno-57-3 href=#__codelineno-57-3></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-57-4 name=__codelineno-57-4 href=#__codelineno-57-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">mysql-exporter</span>
<a id=__codelineno-57-5 name=__codelineno-57-5 href=#__codelineno-57-5></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">monitoring</span>
<a id=__codelineno-57-6 name=__codelineno-57-6 href=#__codelineno-57-6></a><span class=w>  </span><span class=nt>labels</span><span class=p>:</span>
<a id=__codelineno-57-7 name=__codelineno-57-7 href=#__codelineno-57-7></a><span class=w>    </span><span class=nt>k8s-app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">mysql-exporter</span>
<a id=__codelineno-57-8 name=__codelineno-57-8 href=#__codelineno-57-8></a><span class=w>    </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">monitoring</span>
<a id=__codelineno-57-9 name=__codelineno-57-9 href=#__codelineno-57-9></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-57-10 name=__codelineno-57-10 href=#__codelineno-57-10></a><span class=w>  </span><span class=nt>jobLabel</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">k8s-app</span>
<a id=__codelineno-57-11 name=__codelineno-57-11 href=#__codelineno-57-11></a><span class=w>  </span><span class=nt>endpoints</span><span class=p>:</span>
<a id=__codelineno-57-12 name=__codelineno-57-12 href=#__codelineno-57-12></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">api</span>
<a id=__codelineno-57-13 name=__codelineno-57-13 href=#__codelineno-57-13></a><span class=w>    </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">30s</span>
<a id=__codelineno-57-14 name=__codelineno-57-14 href=#__codelineno-57-14></a><span class=w>    </span><span class=nt>scheme</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">http</span>
<a id=__codelineno-57-15 name=__codelineno-57-15 href=#__codelineno-57-15></a><span class=w>  </span><span class=nt>selector</span><span class=p>:</span>
<a id=__codelineno-57-16 name=__codelineno-57-16 href=#__codelineno-57-16></a><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span>
<a id=__codelineno-57-17 name=__codelineno-57-17 href=#__codelineno-57-17></a><span class=w>      </span><span class=nt>k8s-app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">mysql-exporter</span>
<a id=__codelineno-57-18 name=__codelineno-57-18 href=#__codelineno-57-18></a><span class=w>  </span><span class=nt>namespaceSelector</span><span class=p>:</span>
<a id=__codelineno-57-19 name=__codelineno-57-19 href=#__codelineno-57-19></a><span class=w>    </span><span class=nt>matchNames</span><span class=p>:</span>
<a id=__codelineno-57-20 name=__codelineno-57-20 href=#__codelineno-57-20></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">monitoring</span>
</code></pre></div> <p>需要注意matchLabels和endpoints的配置，要和MySQL的Service一致。 之后创建该ServiceMonitor：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-58-1 name=__codelineno-58-1 href=#__codelineno-58-1></a>$<span class=w> </span>kubectl<span class=w> </span>create<span class=w> </span>-f<span class=w> </span>mysql-sm.yaml
<a id=__codelineno-58-2 name=__codelineno-58-2 href=#__codelineno-58-2></a>servicemonitor.monitoring.coreos.com/mysql-exporter<span class=w> </span>created
</code></pre></div> <p>接下来即可在Prometheus Web UI看到该监控，如图15.17所示。</p> <p><img alt class=zoom src=../../../assets/static/kubernetes/5/mysql-target-01.png></p> <p>导入Grafana Dashboard, 地址为https://grafana.com/grafana/dashboards/6239，导入步骤和之前类似，在此不再演示。</p> <p>导入完成后，即可在Grafana看到监控数据，如图15.18所示。</p> <p><img alt class=zoom src=../../../assets/static/kubernetes/5/mysql-target-02.png> 图15.18　查看MySQL监控</p> <h2 id=4黑盒监控>4.黑盒监控<a class=headerlink href=#4黑盒监控 title="Permanent link">&para;</a></h2> <p>前面的章节对MySQL或者Etcd的监控都是监控应用本身，也就是程序内部的一些指标，这类监控关注的是原因，一般为出现问题的根本，此类监控称为白盒监控。</p> <p>还有一类监控关注的是现象，也就是正在发生的告警，比如某个网站突然慢了，或者打不开了。此类告警是站在用户的角度看到的东西，比较关注现象，表示正在发生的问题，这类监控称为黑盒监控。</p> <p>白盒监控可以通过Exporter采集数据，黑盒监控也可以通过Exporter采集数据，新版本的Prometheus Stack已经默认安装了Blackbox Exporter，可以用其采集某个域名、接口或者TCP连接的状态、是否可用等。</p> <p>新版Prometheus Stack已经默认安装了Blackbox Exporter，可以通过以下命令查看：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-59-1 name=__codelineno-59-1 href=#__codelineno-59-1></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>po<span class=w> </span>-n<span class=w> </span>monitoring<span class=w> </span>-l<span class=w> </span>app.kubernetes.io/name<span class=o>=</span>blackbox-exporter
<a id=__codelineno-59-2 name=__codelineno-59-2 href=#__codelineno-59-2></a>NAME<span class=w>                                 </span>READY<span class=w>   </span>STATUS<span class=w>    </span>RESTARTS<span class=w>   </span>AGE
<a id=__codelineno-59-3 name=__codelineno-59-3 href=#__codelineno-59-3></a>blackbox-exporter-6798fb5bb4-nqstp<span class=w>   </span><span class=m>3</span>/3<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>14h
</code></pre></div> <p>同时也会创建一个Service，可以通过该Service访问Blackbox Exporter并传递一些参数：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-60-1 name=__codelineno-60-1 href=#__codelineno-60-1></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>svc<span class=w> </span>-n<span class=w> </span>monitoring<span class=w> </span>-l<span class=w> </span>app.kubernetes.io/name<span class=o>=</span>blackbox-exporter
<a id=__codelineno-60-2 name=__codelineno-60-2 href=#__codelineno-60-2></a>NAME<span class=w>                </span>TYPE<span class=w>        </span>CLUSTER-IP<span class=w>       </span>EXTERNAL-IP<span class=w>   </span>PORT<span class=o>(</span>S<span class=o>)</span><span class=w>              </span>AGE
<a id=__codelineno-60-3 name=__codelineno-60-3 href=#__codelineno-60-3></a>blackbox-exporter<span class=w>   </span>ClusterIP<span class=w>   </span><span class=m>10</span>.105.208.175<span class=w>   </span>&lt;none&gt;<span class=w>        </span><span class=m>9115</span>/TCP,19115/TCP<span class=w>   </span>14h
</code></pre></div> <p>比如检测www.baidu.com（使用任何一个公网域名或者公司内的域名探测即可）网站的状态，可以通过如下命令进行检查：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-61-1 name=__codelineno-61-1 href=#__codelineno-61-1></a>$<span class=w> </span>curl<span class=w> </span>-s<span class=w> </span><span class=s2>&quot;http://10.105.208.175:19115/probe?target=www.baidu.com&amp;module=http_2xx&quot;</span><span class=w> </span><span class=p>|</span>tail<span class=w> </span>-3
<a id=__codelineno-61-2 name=__codelineno-61-2 href=#__codelineno-61-2></a><span class=c1># HELP probe_success Displays whether or not the probe was a success</span>
<a id=__codelineno-61-3 name=__codelineno-61-3 href=#__codelineno-61-3></a><span class=c1># TYPE probe_success gauge</span>
<a id=__codelineno-61-4 name=__codelineno-61-4 href=#__codelineno-61-4></a>probe_success<span class=w> </span><span class=m>1</span>
</code></pre></div> <p>probe是接口地址，target是检测的目标，module是指使用哪个模块进行探测。</p> <p>如果集群中没有配置Blackbox Exporter, 可以参考如下进行安装:</p> <blockquote> <p><a href=https://github.com/prometheus/blackbox_exporter>https://github.com/prometheus/blackbox_exporter</a> </p> </blockquote> <h2 id=5prometheus静态配置>5.Prometheus静态配置<a class=headerlink href=#5prometheus静态配置 title="Permanent link">&para;</a></h2> <p>前面几个小节配置监控目标时，用的都是ServiceMonitor，但是ServiceMonitor可能会有一些限制 。 比如 ， 如果没有安装 Prometheus Operator，可能就无法使用ServiceMonitor，另外并不是所有的监控都能使用ServiceMonitor进行配置，或者使用ServiceMonitor配置显得过于烦琐。</p> <p>上一节讲解的黑盒监控使用ServiceMonitor就显得过于复杂，使用传统的配置方式，直接将target传递给Blackbox Exporter即可。虽然本书使用的是Operator安装Prometheus，但是它也是支持静态配置的，可以通过以下步骤开启Prometheus的静态配置。</p> <p>首先创建一个空文件，然后通过该文件创建一个Secret，这个Secret即可作为Prometheus的静态配置：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-62-1 name=__codelineno-62-1 href=#__codelineno-62-1></a>$<span class=w> </span>touch<span class=w> </span>prometheus-additional.yaml
<a id=__codelineno-62-2 name=__codelineno-62-2 href=#__codelineno-62-2></a>$<span class=w> </span>kubectl<span class=w> </span>create<span class=w> </span>secret<span class=w> </span>generic<span class=w> </span>additional-configs<span class=w> </span>--from-file<span class=o>=</span>prometheus-additional.yaml<span class=w> </span>-n<span class=w> </span>monitoring
<a id=__codelineno-62-3 name=__codelineno-62-3 href=#__codelineno-62-3></a>secret/additional-configs<span class=w> </span>created
</code></pre></div> <p>创建完Secret后，需要编辑Prometheus的配置（见图15.19）：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-63-1 name=__codelineno-63-1 href=#__codelineno-63-1></a>$<span class=w> </span>kubectl<span class=w> </span>edit<span class=w> </span>prometheus<span class=w> </span>-n<span class=w> </span>monitoring<span class=w> </span>k8s
</code></pre></div> <div class=highlight><pre><span></span><code><a id=__codelineno-64-1 name=__codelineno-64-1 href=#__codelineno-64-1></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-64-2 name=__codelineno-64-2 href=#__codelineno-64-2></a><span class=w>  </span><span class=nt>additionalScrapeConfigs</span><span class=p>:</span>
<a id=__codelineno-64-3 name=__codelineno-64-3 href=#__codelineno-64-3></a><span class=w>    </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">prometheus-additional.yaml</span>
<a id=__codelineno-64-4 name=__codelineno-64-4 href=#__codelineno-64-4></a><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">additional-configs</span>
<a id=__codelineno-64-5 name=__codelineno-64-5 href=#__codelineno-64-5></a><span class=w>    </span><span class=nt>optional</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id=__codelineno-64-6 name=__codelineno-64-6 href=#__codelineno-64-6></a><span class=w>  </span><span class=nt>alerting</span><span class=p>:</span>
<a id=__codelineno-64-7 name=__codelineno-64-7 href=#__codelineno-64-7></a><span class=w>    </span><span class=nt>alertmanagers</span><span class=p>:</span>
<a id=__codelineno-64-8 name=__codelineno-64-8 href=#__codelineno-64-8></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v2</span>
<a id=__codelineno-64-9 name=__codelineno-64-9 href=#__codelineno-64-9></a><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">alertmanager-main</span>
<a id=__codelineno-64-10 name=__codelineno-64-10 href=#__codelineno-64-10></a><span class=w>      </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">monitoring</span>
<a id=__codelineno-64-11 name=__codelineno-64-11 href=#__codelineno-64-11></a><span class=w>      </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">web</span>
<a id=__codelineno-64-12 name=__codelineno-64-12 href=#__codelineno-64-12></a><span class=w>  </span><span class=nt>enableFeatures</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[]</span>
<a id=__codelineno-64-13 name=__codelineno-64-13 href=#__codelineno-64-13></a><span class=w>  </span><span class=nt>externalLabels</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">{}</span>
<a id=__codelineno-64-14 name=__codelineno-64-14 href=#__codelineno-64-14></a><span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">quay.io/prometheus/prometheus:v2.29.1</span>
<a id=__codelineno-64-15 name=__codelineno-64-15 href=#__codelineno-64-15></a><span class=w>  </span><span class=nt>nodeSelector</span><span class=p>:</span>
<a id=__codelineno-64-16 name=__codelineno-64-16 href=#__codelineno-64-16></a><span class=w>    </span><span class=nt>kubernetes.io/os</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">linux</span>
</code></pre></div> <p>添加上述配置后保存退出，无须重启Prometheus的Pod即可生效。</p> <p>之后在prometheusadditional.yaml文件内编辑一些静态配置，此处用黑盒监控的配置进行演示：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-65-1 name=__codelineno-65-1 href=#__codelineno-65-1></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>job_name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;blackbox&quot;</span>
<a id=__codelineno-65-2 name=__codelineno-65-2 href=#__codelineno-65-2></a><span class=w>  </span><span class=c1># 这里的指标路径是 /probe</span>
<a id=__codelineno-65-3 name=__codelineno-65-3 href=#__codelineno-65-3></a><span class=w>  </span><span class=nt>metrics_path</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/probe</span>
<a id=__codelineno-65-4 name=__codelineno-65-4 href=#__codelineno-65-4></a><span class=w>  </span><span class=nt>params</span><span class=p>:</span>
<a id=__codelineno-65-5 name=__codelineno-65-5 href=#__codelineno-65-5></a><span class=w>    </span><span class=c1># 使用 http 模块</span>
<a id=__codelineno-65-6 name=__codelineno-65-6 href=#__codelineno-65-6></a><span class=w>    </span><span class=nt>modelus</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=nv>http_2xx</span><span class="p p-Indicator">]</span>
<a id=__codelineno-65-7 name=__codelineno-65-7 href=#__codelineno-65-7></a><span class=w>  </span><span class=nt>static_configs</span><span class=p>:</span>
<a id=__codelineno-65-8 name=__codelineno-65-8 href=#__codelineno-65-8></a><span class=w>    </span><span class=c1># 检测的目标</span>
<a id=__codelineno-65-9 name=__codelineno-65-9 href=#__codelineno-65-9></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>targets</span><span class=p>:</span>
<a id=__codelineno-65-10 name=__codelineno-65-10 href=#__codelineno-65-10></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">https://www.baidu.com</span>
<a id=__codelineno-65-11 name=__codelineno-65-11 href=#__codelineno-65-11></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">https://youdianzhishi.com</span>
<a id=__codelineno-65-12 name=__codelineno-65-12 href=#__codelineno-65-12></a><span class=w>  </span><span class=nt>relabel_configs</span><span class=p>:</span>
<a id=__codelineno-65-13 name=__codelineno-65-13 href=#__codelineno-65-13></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>source_labels</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=nv>__address__</span><span class="p p-Indicator">]</span>
<a id=__codelineno-65-14 name=__codelineno-65-14 href=#__codelineno-65-14></a><span class=w>      </span><span class=nt>target_label</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">__param_target</span>
<a id=__codelineno-65-15 name=__codelineno-65-15 href=#__codelineno-65-15></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>source_labels</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=nv>__param_target</span><span class="p p-Indicator">]</span>
<a id=__codelineno-65-16 name=__codelineno-65-16 href=#__codelineno-65-16></a><span class=w>      </span><span class=nt>target_label</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">instance</span>
<a id=__codelineno-65-17 name=__codelineno-65-17 href=#__codelineno-65-17></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>target_label</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">__address__</span>
<a id=__codelineno-65-18 name=__codelineno-65-18 href=#__codelineno-65-18></a><span class=w>      </span><span class=nt>replacement</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">blackbox-exporter:19115</span>
<a id=__codelineno-65-19 name=__codelineno-65-19 href=#__codelineno-65-19></a>
<a id=__codelineno-65-20 name=__codelineno-65-20 href=#__codelineno-65-20></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>job_name</span><span class=p>:</span><span class=w> </span><span class=s>&#39;other-node_exporter&#39;</span>
<a id=__codelineno-65-21 name=__codelineno-65-21 href=#__codelineno-65-21></a><span class=w>  </span><span class=nt>static_configs</span><span class=p>:</span>
<a id=__codelineno-65-22 name=__codelineno-65-22 href=#__codelineno-65-22></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>targets</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&#39;172.18.0.85:9100&#39;</span><span class="p p-Indicator">,</span><span class=s>&quot;172.18.0.84:9100&quot;</span><span class="p p-Indicator">,</span><span class=s>&quot;172.18.0.83:9100&quot;</span><span class="p p-Indicator">,</span><span class=s>&quot;172.18.0.82:9100&quot;</span><span class="p p-Indicator">]</span>
<a id=__codelineno-65-23 name=__codelineno-65-23 href=#__codelineno-65-23></a>
<a id=__codelineno-65-24 name=__codelineno-65-24 href=#__codelineno-65-24></a>
<a id=__codelineno-65-25 name=__codelineno-65-25 href=#__codelineno-65-25></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>job_name</span><span class=p>:</span><span class=w> </span><span class=s>&#39;node-exporter-others&#39;</span>
<a id=__codelineno-65-26 name=__codelineno-65-26 href=#__codelineno-65-26></a><span class=w>  </span><span class=nt>static_configs</span><span class=p>:</span>
<a id=__codelineno-65-27 name=__codelineno-65-27 href=#__codelineno-65-27></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>targets</span><span class=p>:</span>
<a id=__codelineno-65-28 name=__codelineno-65-28 href=#__codelineno-65-28></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=err>*</span><span class="l l-Scalar l-Scalar-Plain">.*.*.149:31190</span>
<a id=__codelineno-65-29 name=__codelineno-65-29 href=#__codelineno-65-29></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=err>*</span><span class="l l-Scalar l-Scalar-Plain">.*.*.150:31190</span>
<a id=__codelineno-65-30 name=__codelineno-65-30 href=#__codelineno-65-30></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=err>*</span><span class="l l-Scalar l-Scalar-Plain">.*.*.122:31190</span>
<a id=__codelineno-65-31 name=__codelineno-65-31 href=#__codelineno-65-31></a>
<a id=__codelineno-65-32 name=__codelineno-65-32 href=#__codelineno-65-32></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>job_name</span><span class=p>:</span><span class=w> </span><span class=s>&#39;mysql-exporter&#39;</span>
<a id=__codelineno-65-33 name=__codelineno-65-33 href=#__codelineno-65-33></a><span class=w>  </span><span class=nt>static_configs</span><span class=p>:</span>
<a id=__codelineno-65-34 name=__codelineno-65-34 href=#__codelineno-65-34></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>targets</span><span class=p>:</span>
<a id=__codelineno-65-35 name=__codelineno-65-35 href=#__codelineno-65-35></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=err>*</span><span class="l l-Scalar l-Scalar-Plain">.*.*.104:9592</span>
<a id=__codelineno-65-36 name=__codelineno-65-36 href=#__codelineno-65-36></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=err>*</span><span class="l l-Scalar l-Scalar-Plain">.*.*.125:9592</span>
<a id=__codelineno-65-37 name=__codelineno-65-37 href=#__codelineno-65-37></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=err>*</span><span class="l l-Scalar l-Scalar-Plain">.*.*.128:9592</span>
<a id=__codelineno-65-38 name=__codelineno-65-38 href=#__codelineno-65-38></a>
<a id=__codelineno-65-39 name=__codelineno-65-39 href=#__codelineno-65-39></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>job_name</span><span class=p>:</span><span class=w> </span><span class=s>&#39;nacos-exporter&#39;</span>
<a id=__codelineno-65-40 name=__codelineno-65-40 href=#__codelineno-65-40></a><span class=w>  </span><span class=nt>metrics_path</span><span class=p>:</span><span class=w> </span><span class=s>&#39;/nacos/actuator/prometheus&#39;</span>
<a id=__codelineno-65-41 name=__codelineno-65-41 href=#__codelineno-65-41></a><span class=w>  </span><span class=nt>static_configs</span><span class=p>:</span>
<a id=__codelineno-65-42 name=__codelineno-65-42 href=#__codelineno-65-42></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>targets</span><span class=p>:</span>
<a id=__codelineno-65-43 name=__codelineno-65-43 href=#__codelineno-65-43></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=err>*</span><span class="l l-Scalar l-Scalar-Plain">.*.*.113:8848</span>
<a id=__codelineno-65-44 name=__codelineno-65-44 href=#__codelineno-65-44></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=err>*</span><span class="l l-Scalar l-Scalar-Plain">.*.*.114:8848</span>
<a id=__codelineno-65-45 name=__codelineno-65-45 href=#__codelineno-65-45></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=err>*</span><span class="l l-Scalar l-Scalar-Plain">.*.*.118:8848</span>
<a id=__codelineno-65-46 name=__codelineno-65-46 href=#__codelineno-65-46></a>
<a id=__codelineno-65-47 name=__codelineno-65-47 href=#__codelineno-65-47></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>job_name</span><span class=p>:</span><span class=w> </span><span class=s>&#39;elasticsearch-exporter&#39;</span>
<a id=__codelineno-65-48 name=__codelineno-65-48 href=#__codelineno-65-48></a><span class=w>  </span><span class=nt>static_configs</span><span class=p>:</span>
<a id=__codelineno-65-49 name=__codelineno-65-49 href=#__codelineno-65-49></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>targets</span><span class=p>:</span>
<a id=__codelineno-65-50 name=__codelineno-65-50 href=#__codelineno-65-50></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=err>*</span><span class="l l-Scalar l-Scalar-Plain">.*.*.110:9597</span>
<a id=__codelineno-65-51 name=__codelineno-65-51 href=#__codelineno-65-51></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=err>*</span><span class="l l-Scalar l-Scalar-Plain">.*.*.107:9597</span>
<a id=__codelineno-65-52 name=__codelineno-65-52 href=#__codelineno-65-52></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=err>*</span><span class="l l-Scalar l-Scalar-Plain">.*.*.117:9597</span>
<a id=__codelineno-65-53 name=__codelineno-65-53 href=#__codelineno-65-53></a>
<a id=__codelineno-65-54 name=__codelineno-65-54 href=#__codelineno-65-54></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>job_name</span><span class=p>:</span><span class=w> </span><span class=s>&#39;zookeeper-exporter&#39;</span>
<a id=__codelineno-65-55 name=__codelineno-65-55 href=#__codelineno-65-55></a><span class=w>  </span><span class=nt>static_configs</span><span class=p>:</span>
<a id=__codelineno-65-56 name=__codelineno-65-56 href=#__codelineno-65-56></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>targets</span><span class=p>:</span>
<a id=__codelineno-65-57 name=__codelineno-65-57 href=#__codelineno-65-57></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=err>*</span><span class="l l-Scalar l-Scalar-Plain">.*.*.115:9595</span>
<a id=__codelineno-65-58 name=__codelineno-65-58 href=#__codelineno-65-58></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=err>*</span><span class="l l-Scalar l-Scalar-Plain">.*.*.121:9595</span>
<a id=__codelineno-65-59 name=__codelineno-65-59 href=#__codelineno-65-59></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=err>*</span><span class="l l-Scalar l-Scalar-Plain">.*.*.120:9595</span>
<a id=__codelineno-65-60 name=__codelineno-65-60 href=#__codelineno-65-60></a>
<a id=__codelineno-65-61 name=__codelineno-65-61 href=#__codelineno-65-61></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>job_name</span><span class=p>:</span><span class=w> </span><span class=s>&#39;nginx-exporter&#39;</span>
<a id=__codelineno-65-62 name=__codelineno-65-62 href=#__codelineno-65-62></a><span class=w>  </span><span class=nt>static_configs</span><span class=p>:</span>
<a id=__codelineno-65-63 name=__codelineno-65-63 href=#__codelineno-65-63></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>targets</span><span class=p>:</span>
<a id=__codelineno-65-64 name=__codelineno-65-64 href=#__codelineno-65-64></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=err>*</span><span class="l l-Scalar l-Scalar-Plain">.*.*.149:9593</span>
<a id=__codelineno-65-65 name=__codelineno-65-65 href=#__codelineno-65-65></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=err>*</span><span class="l l-Scalar l-Scalar-Plain">.*.*.150:9593</span>
<a id=__codelineno-65-66 name=__codelineno-65-66 href=#__codelineno-65-66></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=err>*</span><span class="l l-Scalar l-Scalar-Plain">.*.*.122:9593</span>
<a id=__codelineno-65-67 name=__codelineno-65-67 href=#__codelineno-65-67></a>
<a id=__codelineno-65-68 name=__codelineno-65-68 href=#__codelineno-65-68></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>job_name</span><span class=p>:</span><span class=w> </span><span class=s>&#39;redis-exporter&#39;</span>
<a id=__codelineno-65-69 name=__codelineno-65-69 href=#__codelineno-65-69></a><span class=w>  </span><span class=nt>static_configs</span><span class=p>:</span>
<a id=__codelineno-65-70 name=__codelineno-65-70 href=#__codelineno-65-70></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>targets</span><span class=p>:</span>
<a id=__codelineno-65-71 name=__codelineno-65-71 href=#__codelineno-65-71></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=err>*</span><span class="l l-Scalar l-Scalar-Plain">.*.*.109:9594</span>
<a id=__codelineno-65-72 name=__codelineno-65-72 href=#__codelineno-65-72></a>
<a id=__codelineno-65-73 name=__codelineno-65-73 href=#__codelineno-65-73></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>job_name</span><span class=p>:</span><span class=w> </span><span class=s>&#39;redis-exporter-targets&#39;</span>
<a id=__codelineno-65-74 name=__codelineno-65-74 href=#__codelineno-65-74></a><span class=w>  </span><span class=nt>static_configs</span><span class=p>:</span>
<a id=__codelineno-65-75 name=__codelineno-65-75 href=#__codelineno-65-75></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>targets</span><span class=p>:</span>
<a id=__codelineno-65-76 name=__codelineno-65-76 href=#__codelineno-65-76></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">redis://*.*.*.146:7090</span>
<a id=__codelineno-65-77 name=__codelineno-65-77 href=#__codelineno-65-77></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">redis://*.*.*.144:7090</span>
<a id=__codelineno-65-78 name=__codelineno-65-78 href=#__codelineno-65-78></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">redis://*.*.*.133:7091</span>
<a id=__codelineno-65-79 name=__codelineno-65-79 href=#__codelineno-65-79></a><span class=w>  </span><span class=nt>metrics_path</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/scrape</span>
<a id=__codelineno-65-80 name=__codelineno-65-80 href=#__codelineno-65-80></a><span class=w>  </span><span class=nt>relabel_configs</span><span class=p>:</span>
<a id=__codelineno-65-81 name=__codelineno-65-81 href=#__codelineno-65-81></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>source_labels</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=nv>__address__</span><span class="p p-Indicator">]</span>
<a id=__codelineno-65-82 name=__codelineno-65-82 href=#__codelineno-65-82></a><span class=w>      </span><span class=nt>target_label</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">__param_target</span>
<a id=__codelineno-65-83 name=__codelineno-65-83 href=#__codelineno-65-83></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>source_labels</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=nv>__param_target</span><span class="p p-Indicator">]</span>
<a id=__codelineno-65-84 name=__codelineno-65-84 href=#__codelineno-65-84></a><span class=w>      </span><span class=nt>target_label</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">instance</span>
<a id=__codelineno-65-85 name=__codelineno-65-85 href=#__codelineno-65-85></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>target_label</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">__address__</span>
<a id=__codelineno-65-86 name=__codelineno-65-86 href=#__codelineno-65-86></a><span class=w>      </span><span class=nt>replacement</span><span class=p>:</span><span class=w> </span><span class=err>*</span><span class="l l-Scalar l-Scalar-Plain">.*.*.109:9594</span>
</code></pre></div> <ul> <li>targets：探测的目标，根据实际情况进行更改。</li> <li>params：使用哪个模块进行探测。</li> <li>replacement：Blackbox Exporter的地址。</li> </ul> <p>可以看到此处的内容和传统配置的内容一致，只需要添加对应的job即可。之后通过该文件更新该Secret：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-66-1 name=__codelineno-66-1 href=#__codelineno-66-1></a>$<span class=w> </span>kubectl<span class=w> </span>create<span class=w> </span>secret<span class=w> </span>generic<span class=w> </span>additional-configs<span class=w> </span>--from-file<span class=o>=</span>prometheus-additional.yaml<span class=w> </span>--dry-run<span class=o>=</span>client<span class=w> </span>-o<span class=w> </span>yaml<span class=w> </span><span class=p>|</span>kubectl<span class=w> </span>replace<span class=w> </span>-f<span class=w> </span>-<span class=w> </span>-n<span class=w> </span>monitoring
<a id=__codelineno-66-2 name=__codelineno-66-2 href=#__codelineno-66-2></a>secret/additional-configs<span class=w> </span>replaced
</code></pre></div> <p>更新完成后，稍等一分钟即可在Prometheus Web UI看到该配置，如图15.20所示。</p> <p><img alt class=zoom src=../../../assets/static/kubernetes/5/15-20-blackbox.png></p> <p>图15.20　查看黑盒监控Target</p> <p>监控状态为UP后, 导入黑盒监控的模板（<a href=https://grafana.com/grafana/dashboards/13659>https://grafana.com/grafana/dashboards/13659</a>）即可,如图15.21所示。</p> <p><img alt class=zoom src=../../../assets/static/kubernetes/5/15-21-black-box.png></p> <p>以上演示了黑盒监控的HTTP模块的使用，其他模块的使用方法类似，可以参考：</p> <blockquote> <p><a href=https://github.com/prometheus/blackbox_exporter>https://github.com/prometheus/blackbox_exporter</a>。</p> </blockquote> <h2 id=6prometheus监控windows外部主机>6.Prometheus监控Windows(外部)主机<a class=headerlink href=#6prometheus监控windows外部主机 title="Permanent link">&para;</a></h2> <p>上一节演示了使用Prometheus静态配置监控网站的可用性，接下来再通过一个实例演示静态配置的使用，同时也学习一下Kubernetes集群外部的服务是如何监控的。</p> <p>使用Prometheus监控Windows主机和Linux主机并无太大区别，都是使用社区的Exporter采集数据，之后暴露一个Metrics接口，可以让Prometheus采集到主机的数据。</p> <p>其中 </p> <blockquote> <p>监控Linux的Exporter是 </p> <p><a href=https://github.com/prometheus/node_exporter>https://github.com/prometheus/node_exporter</a></p> <p>监控Windows主机的Exporter是</p> <p><a href=https://github.com/prometheus-community/windows_exporter>https://github.com/prometheus-community/windows_exporter</a></p> </blockquote> <p>首先下载对应的Exporter至Windows主机<a href=https://github.com/prometheus-community/windows_exporter/releases>MSI文件下载地址</a>，如图15.22所示。</p> <p><img alt class=zoom src=../../../assets/static/kubernetes/5/15-22-win.png></p> <p>图15.22　下载Windows监控组件</p> <p>下载完成后，双击打开即可完成安装，之后可以在任务管理器上看到对应的进程，如图15.23所示。</p> <p><img alt class=zoom src=../../../assets/static/kubernetes/5/15-23-win.png></p> <p>Windows Exporter会暴露一个9182端口，可以通过该端口访问Windows的监控数据。接下来在静态配置文件中添加以下配置：</p> <p>Targets配置的是监控主机，如果是多台Windows主机，配置多行即可，当然每台主机都需要配置Exporter。之后可以在Prometheus Web UI看到监控数据，如图15.24所示。</p> <div class=highlight><pre><span></span><code><a id=__codelineno-67-1 name=__codelineno-67-1 href=#__codelineno-67-1></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>job_name</span><span class=p>:</span><span class=w> </span><span class=s>&#39;WindowsServerMonitor&#39;</span>
<a id=__codelineno-67-2 name=__codelineno-67-2 href=#__codelineno-67-2></a><span class=w>  </span><span class=nt>static_configs</span><span class=p>:</span>
<a id=__codelineno-67-3 name=__codelineno-67-3 href=#__codelineno-67-3></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>targets</span><span class=p>:</span>
<a id=__codelineno-67-4 name=__codelineno-67-4 href=#__codelineno-67-4></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;192.168.1.164:9182&quot;</span>
<a id=__codelineno-67-5 name=__codelineno-67-5 href=#__codelineno-67-5></a><span class=w>      </span><span class=nt>labels</span><span class=p>:</span>
<a id=__codelineno-67-6 name=__codelineno-67-6 href=#__codelineno-67-6></a><span class=w>        </span><span class=nt>server_type</span><span class=p>:</span><span class=w> </span><span class=s>&#39;windows&#39;</span>
<a id=__codelineno-67-7 name=__codelineno-67-7 href=#__codelineno-67-7></a><span class=w>  </span><span class=nt>relabel_configs</span><span class=p>:</span>
<a id=__codelineno-67-8 name=__codelineno-67-8 href=#__codelineno-67-8></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>source_labels</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=nv>__address__</span><span class="p p-Indicator">]</span>
<a id=__codelineno-67-9 name=__codelineno-67-9 href=#__codelineno-67-9></a><span class=w>      </span><span class=nt>target_label</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">instance</span>
</code></pre></div> <p>Targets配置的是监控主机，如果是多台Windows主机，配置多行即可，当然每台主机都需要配置Exporter。</p> <p>之后可以在Prometheus Web UI看到监控数据，如图15.24所示。</p> <p><img alt class=zoom src=../../../assets/static/kubernetes/5/15-24-win.png></p> <p>图15.24　查看Windows监控指标</p> <p>之后导入模板(地 址:<a href=https://grafana.com/grafana/dashboards/12566)即可>https://grafana.com/grafana/dashboards/12566)即可</a>，如图15.25所示。</p> <p><img alt class=zoom src=../../../assets/static/kubernetes/5/15-25-win.png></p> <p>可以看到Prometheus的静态配置大致流程一致，配置内容也类似，所以一些不方便使用ServiceMonitor进行配置的，可以采用静态配置的方式，当然静态配置也可以采用ServiceMonitor方式。</p> <h2 id=7prometheus语法promql入门>7.Prometheus语法PromQL入门<a class=headerlink href=#7prometheus语法promql入门 title="Permanent link">&para;</a></h2> <p>前面学习了云原生应用、非云原生应用、黑盒监控和集群外部主机监控，同时学习了ServiceMonitor和静态配置的使用，掌握这些以后，生产环境的大部分场景都可以进行监控。</p> <p>但是监控并不是最终的目的，虽然通过Grafana的Dashboard能看到一些监控大屏，但是需要监控的地方太多，并且技术人员不可能随时随地都盯着Dashboard，所以需要对严重的告警进行通知。</p> <p>接下来就需要用到Prometheus的另一个组件—Alertmanager，主要用来进行告警的通知，可以采用邮箱、钉钉、微信、Slack、Webhook等进行通知。</p> <h3 id=71-promql语法初体验>7.1 PromQL语法初体验<a class=headerlink href=#71-promql语法初体验 title="Permanent link">&para;</a></h3> <p>在学习告警之前，必须掌握基础的Prometheus数据查询语法 。Prometheus查询语法叫PromQL，就像MySQL的SQL语句。</p> <p>首先根据查询语法查出来想要的数据，之后根据条件判断即可进行告警。</p> <p>PromQL Web UI的Graph选项卡提供了简单的用于查询数据的入口，对于PromQL的编写和校验都可以在此位置，如图15.26所示。</p> <p><img alt class=zoom src=../../../assets/static/kubernetes/5/15-26.png> 图15.26　选择Graph</p> <p>我们可以先输入up，然后单击Execute，就能查到监控正常的Target，如图15.27所示。</p> <p><img alt class=zoom src=../../../assets/static/kubernetes/5/15-27.png></p> <p>up命令可以查到所有正常监控的目标，如果监控的目标过多，可能会查询出来很多数据。此时可以根据一些条件进行过滤，就像SQL语句的where语法。比如通过标签选择器过滤出job为node-exporter的监控，语法为：up{job="node-exporter"}，如图15.28所示。</p> <p><img alt class=zoom src=../../../assets/static/kubernetes/5/15-28.png> 图15.28　查看主机监控</p> <p>注意此时up{job="node-exporter"}属于绝对匹配，Prom?L也支持如下表达式：</p> <ul> <li>!=：表示不等于某个值的指标，比如up{job!="node-exporter"}表示job不为node-exporter的指标。</li> <li>=~：表示符合正则表达式的指标，比如up{job=~"node.*"}表示所有以node开头的指标。</li> <li>!<sub>：和=</sub>类似，=<sub>表示正则匹配，!</sub>表示正则不匹配，也就是排除一些指标。</li> </ul> <p>如果想要查看主机监控的指标有哪些，可以输入node，会提示所有主机监控的指标，如图15.29所示。 <img alt class=zoom src=../../../assets/static/kubernetes/5/15-29.png> 图15.29　查看主机监控指标</p> <p>假如想要查询Kubernetes集群中每个宿主机的磁盘总量，可以使用node_filesystem_size_bytes，如图15.30所示。</p> <p><img alt class=zoom src=../../../assets/static/kubernetes/5/15-30.png> 图15.30　查看磁盘空间</p> <p>可以看到此时查询结果过多，我们可以进一步进行处理，比如只查询根分区的大小，根据前文提到的标签选择器，加上mountpoint匹配规则node_filesystem_size_bytes{mountpoint="/"}即可，如图15.31所示。</p> <p><img alt class=zoom src=../../../assets/static/kubernetes/5/15-31.png> 图15.31　查看根分区空间大小</p> <p>或者查询分区不是/boot，且磁盘是/dev/开头的分区大小（结果不再展示）：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-68-1 name=__codelineno-68-1 href=#__codelineno-68-1></a>node_filesystem_size_bytes{device=~&quot;/dev/.*&quot;,mountpoint!=&quot;/boot&quot;}
</code></pre></div> <p>上述的PromQL查询出来的数据都是瞬时值，也就是Prometheus采集到的最新的数据，在时序数据库中被称为瞬时向量。因为Prometheus本身是一个时序数据库，所以也可以查询某个指标一段时间内的数据，比如查询主机k8s-master01在最近5分钟可用的磁盘空间变化（见图15.32）：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-69-1 name=__codelineno-69-1 href=#__codelineno-69-1></a>node_filesystem_avail_bytes{instance=&quot;giteego-k8s-m1&quot;,mountpoint=&quot;/&quot;,device=&quot;/dev/sda1&quot;}[5m]
</code></pre></div> <p><img alt class=zoom src=../../../assets/static/kubernetes/5/15-32.png> 图15.32　查看最近5分钟的数据</p> <p>可以看到查询的数据有一个时间戳（查询结果@符号后面），这个时间戳记录了数据样本的记录时间。</p> <p>并且能看到有多条查询结果为这5分钟内的所有数据，这种查询一段时间范围内的数据结果被称为区间向量。目前支持的范 围单位如下：</p> <ul> <li>s：秒。</li> <li>m：分钟。</li> <li>h：小时。</li> <li>d：天。</li> <li>w：周。</li> <li>y：年。</li> </ul> <p>除了能查询区间向量和瞬时向量的数据，Prometheus也支持查询几分钟之前的数据或者几分钟之前的一段时间范围内的数据，比如查询10分钟之前磁盘的可用空间，只需要指定offset参数即可：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-70-1 name=__codelineno-70-1 href=#__codelineno-70-1></a>node_filesystem_avail_bytes{instance=&quot;giteego-k8s-m1&quot;,mountpoint=&quot;/&quot;,device=&quot;/dev/sda1&quot;} offset 10m
</code></pre></div> <p>或者查询10分钟之前，5分钟区间的磁盘可用空间的变化：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-71-1 name=__codelineno-71-1 href=#__codelineno-71-1></a>node_filesystem_avail_bytes{instance=&quot;giteego-k8s-m1&quot;,mountpoint=&quot;/&quot;,device=&quot;/dev/sda1&quot;}[5m] offset 10m
</code></pre></div> <h3 id=72-promql操作符>7.2 PromQL操作符<a class=headerlink href=#72-promql操作符 title="Permanent link">&para;</a></h3> <p>上一小节我们通过PromQL的语法查到了主机磁盘的空间数据，查询结果如图15.33所示。</p> <p><img alt class=zoom src=../../../assets/static/kubernetes/5/15-33.png> 图15.33　查看主机磁盘空间数据</p> <p>可以看到此时的数据为16358440960，这个结果并不适合直接阅读，因为它返回的数据单位为字节（bytes，其他指标可能是其他单位）。可以通过以下命令将字节转换为GB或者MB：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-72-1 name=__codelineno-72-1 href=#__codelineno-72-1></a>node_filesystem_avail_bytes{instance=&quot;giteego-k8s-m1&quot;,mountpoint=&quot;/&quot;,device=&quot;/dev/sda1&quot;} / 1024 / 1024 / 1024
</code></pre></div> <p>也可以将1024/1024/1024改为(1024 ^ 3)：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-73-1 name=__codelineno-73-1 href=#__codelineno-73-1></a>node_filesystem_avail_bytes{instance=&quot;giteego-k8s-m1&quot;,mountpoint=&quot;/&quot;,device=&quot;/dev/sda1&quot;} / (1024 ^3) 
</code></pre></div> <p>查询结果如图15.34所示，此时为12GB左右。</p> <p><img alt class=zoom src=../../../assets/static/kubernetes/5/15-34.png> 图15.34　查看空间大小</p> <p>此时可以在宿主机上比对数据是否正确：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-74-1 name=__codelineno-74-1 href=#__codelineno-74-1></a>$<span class=w> </span>df<span class=w> </span>-Th<span class=p>|</span>grep<span class=w> </span>/dev/sda1
<a id=__codelineno-74-2 name=__codelineno-74-2 href=#__codelineno-74-2></a>/dev/sda1<span class=w>      </span>xfs<span class=w>        </span>20G<span class=w>  </span><span class=m>7</span>.4G<span class=w>   </span>13G<span class=w>  </span><span class=m>37</span>%<span class=w> </span>/
</code></pre></div> <p>上述使用的“/”为数学运算的“除”，“^”为幂运算，同时也支持如下运算符：</p> <ul> <li>+：加。</li> <li>‒：减。</li> <li>*：乘。</li> <li>/：除。</li> <li>^：幂运算。</li> <li>%：求余。</li> </ul> <p>通过不同的指标结合不同的表达式可以查询到不同的数据，比如要查询k8s-master01根区分磁盘的可用率，可以通过如下指令进行计算：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-75-1 name=__codelineno-75-1 href=#__codelineno-75-1></a>node_filesystem_avail_bytes{instance=&quot;giteego-k8s-m1&quot;,mountpoint=&quot;/&quot;,device=&quot;/dev/sda1&quot;}  /node_filesystem_size_bytes{instance=&quot;giteego-k8s-m1&quot;,mountpoint=&quot;/&quot;,device=&quot;/dev/sda1&quot;}
</code></pre></div> <p>node_filesystem_avail_bytes 为 系 统 可 用 的 磁 盘 空 间 ，node_filesystem_size_bytes为磁盘空间的总大小，所以两者的比值即为磁 盘空间的可用率。当然也可以去掉instance参数，查询所有主机根分区的可用率（见图15.35）：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-76-1 name=__codelineno-76-1 href=#__codelineno-76-1></a>node_filesystem_avail_bytes{mountpoint=&quot;/&quot;} /node_filesystem_size_bytes{mountpoint=&quot;/&quot;}
</code></pre></div> <p><img alt class=zoom src=../../../assets/static/kubernetes/5/15-35.png> 图15.35　查看磁盘可用率</p> <p>也可以将结果乘以100直接得到百分比：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-77-1 name=__codelineno-77-1 href=#__codelineno-77-1></a>node_filesystem_avail_bytes{mountpoint=&quot;/&quot;} /node_filesystem_size_bytes{mountpoint=&quot;/&quot;} * 100
</code></pre></div> <p>通过上述操作符的学习，我们可以查询到主机磁盘的使用信息，读者可以根据上述语句尝试查询其他指标信息，比如CPU、内存的使用率等，如图15.36所示。</p> <p><img alt class=zoom src=../../../assets/static/kubernetes/5/15-36.png></p> <p>图15.36　查看磁盘可用百分比</p> <p>虽然可以通过上述语句查询到一些指标，但是这些指标可能并非我们最终想要的。</p> <p>比如想要找到集群中根分区空间可用率大于60%的主机，此时可以将查询语句添加一个判断条件，得到自己想要的结果，比如：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-78-1 name=__codelineno-78-1 href=#__codelineno-78-1></a>node_filesystem_avail_bytes{mountpoint=&quot;/&quot;} /node_filesystem_size_bytes{mountpoint=&quot;/&quot;} * 100 &gt;60
</code></pre></div> <p>结果如图15.37所示。</p> <p><img alt class=zoom src=../../../assets/static/kubernetes/5/15-37.png> 图15.37　查看磁盘可用率大于60%的主机</p> <p>此时得到的结果为监控目标主机磁盘可用率大于60%的主机，如果将大于60改为小于20，就是查询所有磁盘可用率小于20%的主机，此时是不是就应该产生告警？所以说将PromQL的语法稍加改造即为我们想要的告警条件。</p> <div class=highlight><pre><span></span><code><a id=__codelineno-79-1 name=__codelineno-79-1 href=#__codelineno-79-1></a>node_filesystem_avail_bytes{mountpoint=&quot;/&quot;} /node_filesystem_size_bytes{mountpoint=&quot;/&quot;} * 100 &lt;20
</code></pre></div> <p>除了以上判断语法外，PromQL也支持如下判断：</p> <ul> <li>==：相等。</li> <li>!=：不相等。</li> <li>：大于。</li> <li>&lt;：小于。</li> <li>=：大于等于。</li> <li>&lt;=：小于等于。</li> </ul> <p>上述语法只是做了一个简单的判断，比如只过滤了磁盘可用率大于60%的指标，如果想要过滤其他范围也是支持的，比如磁盘可用率大于30%小于等于60%的主机：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-80-1 name=__codelineno-80-1 href=#__codelineno-80-1></a>30 &lt; node_filesystem_avail_bytes{mountpoint=&quot;/&quot;} /node_filesystem_size_bytes{mountpoint=&quot;/&quot;} * 100 &lt;=60
</code></pre></div> <p>在语句的前面加上“30&lt;”，后面加上“&lt;=”60。也可以用and进行联合查询：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-81-1 name=__codelineno-81-1 href=#__codelineno-81-1></a>(node_filesystem_avail_bytes{mountpoint=&quot;/&quot;} /node_filesystem_size_bytes{mountpoint=&quot;/&quot;}) * 100 &gt; 30 and (node_filesystem_avail_bytes{mountpoint=&quot;/&quot;} /node_filesystem_size_bytes{mountpoint=&quot;/&quot;}) * 100 &lt;= 60
</code></pre></div> <p>除了and外，也支持or和unless：</p> <ul> <li>and：并且。</li> <li>or：或者。</li> <li>unless：排除。</li> </ul> <p>由上可知，and是必须两个条件都符合，or只需要符合其中一个即可，读者可以自行练习。</p> <p>而unless是排除某个指标，比如查询主机磁盘剩余空间，并且排除掉shm和tmpfs的磁盘：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-82-1 name=__codelineno-82-1 href=#__codelineno-82-1></a>node_filesystem_free_bytes unless node_filesystem_free_bytes{device=~&quot;shm|tmpfs&quot;}
</code></pre></div> <p>当然，这个语法也可以直接写为：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-83-1 name=__codelineno-83-1 href=#__codelineno-83-1></a>node_filesystem_free_bytes{device!~&quot;shm|tmpfs&quot;}
</code></pre></div> <h3 id=73-promql常用函数>7.3 PromQL常用函数<a class=headerlink href=#73-promql常用函数 title="Permanent link">&para;</a></h3> <p>上一小节使用PromQL查询了一些指标，接下来通过PromQL一些常用的函数对数据进一步处理。比如使用sum函数统计当前监控目标所有主机根分区剩余的空间（见图15.38）：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-84-1 name=__codelineno-84-1 href=#__codelineno-84-1></a>sum(node_filesystem_free_bytes{mountpoint=&quot;/&quot;}) / 1024^3
</code></pre></div> <p><img alt class=zoom src=../../../assets/static/kubernetes/5/15-38.png> 图15.38　sum统计</p> <p>也可以用同样方式计算所有的请求总量：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-85-1 name=__codelineno-85-1 href=#__codelineno-85-1></a>sum(http_requests_total)
</code></pre></div> <p>sum(http_request_total)是对所有的请求进行汇总，如果想要统计更加细粒度的指标，可以加上对应的匹配条件，比如想要统计所有状态码为200的请求。</p> <p>接下来通过http_request_total学习细粒度的统计，首先看一下http_request_total的数据类型是怎样的 。 </p> <p>可以直接查询http_request_total的数据（见图15.39）：</p> <p><img alt class=zoom src=../../../assets/static/kubernetes/5/15-39.png> 图15.39　sum统计请求数</p> <p>上面只展示了一条数据，可以看到有handler、statuscode和method，也就是该条数据可以代表访问根路径状态为200且请求方式为get的统计，数量为10。</p> <p>由该条数据结合sum函数，可以根据statuscode字段统计请求数据（见图15.40）：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-86-1 name=__codelineno-86-1 href=#__codelineno-86-1></a>sum(http_request_total) by (statuscode)
</code></pre></div> <p><img alt class=zoom src=../../../assets/static/kubernetes/5/15-40.png> 图15.40　根据字段进行统计</p> <p>可以看到状态码为404的请求次数是12，状态码为200的请求次数是7156。同时也可以根据statuscode和handler两个指标进一步统计（见图15.41）：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-87-1 name=__codelineno-87-1 href=#__codelineno-87-1></a>sum(http_request_total) by (statuscode, handler)
</code></pre></div> <p><img alt class=zoom src=../../../assets/static/kubernetes/5/15-41.png> 图15.41　根据多个字段统计</p> <p>上述语句可以统计出访问某个路径且状态码为某个值的统计结果。</p> <p>此时我们可以继续使用topk函数，找到统计结果中次数最多的几个结果。比如找到排名前5的数据（为节省篇幅，结果不再展示）：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-88-1 name=__codelineno-88-1 href=#__codelineno-88-1></a>topk(5, sum(http_request_total) by (statuscode, handler))
</code></pre></div> <p>PromQL开箱即用的函数有很多，比如取最后3个数据：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-89-1 name=__codelineno-89-1 href=#__codelineno-89-1></a>grafana(3, sum(http_request_total) by (statuscode, handler))
</code></pre></div> <p>找出统计结果中最小的数据：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-90-1 name=__codelineno-90-1 href=#__codelineno-90-1></a>min(node_filesystem_avail_bytes{mountpoint=&quot;/&quot;})
</code></pre></div> <p>最大的数据：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-91-1 name=__codelineno-91-1 href=#__codelineno-91-1></a>max(node_filesystem_avail_bytes{mountpoint=&quot;/&quot;})
</code></pre></div> <p>平均值：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-92-1 name=__codelineno-92-1 href=#__codelineno-92-1></a>avg(node_filesystem_avail_bytes{mountpoint=&quot;/&quot;})
</code></pre></div> <p>四舍五入，向上取最接近的整数，比如2.79→3：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-93-1 name=__codelineno-93-1 href=#__codelineno-93-1></a>ceil(node_filesystem_files_free{mountpoint=&quot;/&quot;} / 1024 / 1024)
</code></pre></div> <p>向下取整数，比如2.79→2：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-94-1 name=__codelineno-94-1 href=#__codelineno-94-1></a>floor(node_filesystem_files_free{mountpoint=&quot;/&quot;} / 1024 / 1024)
</code></pre></div> <p>对结果进行正向排序：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-95-1 name=__codelineno-95-1 href=#__codelineno-95-1></a>sort(sum(http_request_total) by (handler, statuscode))
</code></pre></div> <p>对结果进行逆向排序：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-96-1 name=__codelineno-96-1 href=#__codelineno-96-1></a>sort_desc(sum(http_request_total) by (handler, statuscode))
</code></pre></div> <p>predict_linear函数可以用于预测分析和预测性告警，比如可以根据一天的数据预测4个小时后磁盘分区的空间会不会小于0：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-97-1 name=__codelineno-97-1 href=#__codelineno-97-1></a>predict_linear(node_filesystem_files_free{mountpoint=&quot;/&quot;}[1d],4*3600) &lt; 0
</code></pre></div> <p>除了上述函数，还有几个比较重要的函数，比如increase、rate、irate。</p> <p>其中increase用于计算在一段时间范围内数据的增长，rate和irate用于计算增长率。比如查询某个请求在1小时内增长了多少：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-98-1 name=__codelineno-98-1 href=#__codelineno-98-1></a>increase(http_request_total{handler=&quot;/api/datasources/proxy/:id/*&quot;,method=&quot;get&quot;,namespace=&quot;monitoring&quot;,service=&quot;grafana&quot;,statuscode=&quot;200&quot;}[1h])
</code></pre></div> <p>将1小时增长的数量除以该时间即为增长率：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-99-1 name=__codelineno-99-1 href=#__codelineno-99-1></a>increase(http_request_total{handler=&quot;/api/datasources/proxy/:id/*&quot;,method=&quot;get&quot;,namespace=&quot;monitoring&quot;,service=&quot;grafana&quot;,statuscode=&quot;200&quot;}[1h]) / 3600
</code></pre></div> <p>当然，increase也可以用于磁盘、CPU、内存等指标，读者可以发挥一下自己的想象。</p> <p>相对于increase，rate可以直接计算出某个指标在给定时间范围内的增长率，比如还是计算1小时的增长率，可以用rate函数进行计算：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-100-1 name=__codelineno-100-1 href=#__codelineno-100-1></a>rate(http_request_total{handler=&quot;/api/datasources/proxy/:id/*&quot;,method=&quot;get&quot;,namespace=&quot;monitoring&quot;,service=&quot;grafana&quot;,statuscode=&quot;200&quot;}[1h])
</code></pre></div> <p>在使用rate和increase时，难免会遇到一个问题，就是常说的“长尾效应”，也就是某个指标一直处于一个数值，这个增长率即为0，此时会出现误判。</p> <p>比如某个主机的磁盘空间已经在昨天达到了100%，此时查询1小时的增长率，由于没有变化，因此无法计算在这个时间窗口的平均增长率，就意味着无法反映此问题。</p> <p>PromQL针对“长尾效应”提供了一个更加灵敏的函数：</p> <p>irate，同样用于计算区间向量的增长速率，但是irate计算的是瞬时增长率，即irate是通过 区间向量中最后两个样本数据来计算区间向量的增长率的，这种方式可以适当避免一些指标的“长尾效应”。</p> <p>虽然irate较rate提供了更高的灵敏度，但是如果需要分析长期趋势，或者在配置告警规则时，irate过高的灵敏度会造成干扰，针对长期趋势分析和告警规则，更推荐使用rate函数。</p> <p>实际应用环境中如果需要了解更多关于PromQL函数的内容，读者可以从官网https://prometheus.io/docs/prometheus/2.4/querying/functions/中继续学习。</p> <h2 id=8alertmanager告警入门>8.Alertmanager告警入门<a class=headerlink href=#8alertmanager告警入门 title="Permanent link">&para;</a></h2> <p>前面介绍了一些比较常用的Prometheus查询语法，同时也学习了告警语法的编写方法。</p> <p>本节我们学习Prometheus的告警组件Alertmanager，看一下如何使用一些常用的媒介发送告警通知，同时也会学习Alertmanager的路由 规则，将告警进行分组。</p> <h3 id=81-alertmanager配置文件解析>8.1 Alertmanager配置文件解析<a class=headerlink href=#81-alertmanager配置文件解析 title="Permanent link">&para;</a></h3> <p>首先看一个简单的Alertmanager配置示例：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-101-1 name=__codelineno-101-1 href=#__codelineno-101-1></a><span class=c1>## Alertmanager 配置文件</span>
<a id=__codelineno-101-2 name=__codelineno-101-2 href=#__codelineno-101-2></a><span class=nt>global</span><span class=p>:</span>
<a id=__codelineno-101-3 name=__codelineno-101-3 href=#__codelineno-101-3></a><span class=w>  </span><span class=nt>resolve_timeout</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5m</span>
<a id=__codelineno-101-4 name=__codelineno-101-4 href=#__codelineno-101-4></a><span class=w>  </span><span class=c1># smtp配置</span>
<a id=__codelineno-101-5 name=__codelineno-101-5 href=#__codelineno-101-5></a><span class=w>  </span><span class=nt>smtp_from</span><span class=p>:</span><span class=w> </span><span class=s>&quot;prom-alert@example.com&quot;</span>
<a id=__codelineno-101-6 name=__codelineno-101-6 href=#__codelineno-101-6></a><span class=w>  </span><span class=nt>smtp_smarthost</span><span class=p>:</span><span class=w> </span><span class=s>&#39;email-smtp.us-west-2.amazonaws.com:465&#39;</span>
<a id=__codelineno-101-7 name=__codelineno-101-7 href=#__codelineno-101-7></a><span class=w>  </span><span class=nt>smtp_auth_username</span><span class=p>:</span><span class=w> </span><span class=s>&quot;user&quot;</span>
<a id=__codelineno-101-8 name=__codelineno-101-8 href=#__codelineno-101-8></a><span class=w>  </span><span class=nt>smtp_auth_password</span><span class=p>:</span><span class=w> </span><span class=s>&quot;pass&quot;</span>
<a id=__codelineno-101-9 name=__codelineno-101-9 href=#__codelineno-101-9></a><span class=w>  </span><span class=nt>smtp_require_tls</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id=__codelineno-101-10 name=__codelineno-101-10 href=#__codelineno-101-10></a>
<a id=__codelineno-101-11 name=__codelineno-101-11 href=#__codelineno-101-11></a><span class=c1># email、企业微信的模板配置存放位置，钉钉的模板会单独讲如果配置。</span>
<a id=__codelineno-101-12 name=__codelineno-101-12 href=#__codelineno-101-12></a><span class=nt>templates</span><span class=p>:</span>
<a id=__codelineno-101-13 name=__codelineno-101-13 href=#__codelineno-101-13></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&#39;/data/alertmanager/templates/*.tmpl&#39;</span>
<a id=__codelineno-101-14 name=__codelineno-101-14 href=#__codelineno-101-14></a><span class=c1># 路由分组</span>
<a id=__codelineno-101-15 name=__codelineno-101-15 href=#__codelineno-101-15></a><span class=nt>route</span><span class=p>:</span>
<a id=__codelineno-101-16 name=__codelineno-101-16 href=#__codelineno-101-16></a><span class=w>  </span><span class=nt>receiver</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Default</span>
<a id=__codelineno-101-17 name=__codelineno-101-17 href=#__codelineno-101-17></a><span class=w>  </span><span class=nt>group_by</span><span class=p>:</span>
<a id=__codelineno-101-18 name=__codelineno-101-18 href=#__codelineno-101-18></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">namespace</span>
<a id=__codelineno-101-19 name=__codelineno-101-19 href=#__codelineno-101-19></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">job</span>
<a id=__codelineno-101-20 name=__codelineno-101-20 href=#__codelineno-101-20></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">alertname</span>
<a id=__codelineno-101-21 name=__codelineno-101-21 href=#__codelineno-101-21></a><span class=w>  </span><span class=nt>routes</span><span class=p>:</span>
<a id=__codelineno-101-22 name=__codelineno-101-22 href=#__codelineno-101-22></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>receiver</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Watchdog</span>
<a id=__codelineno-101-23 name=__codelineno-101-23 href=#__codelineno-101-23></a><span class=w>    </span><span class=nt>match</span><span class=p>:</span>
<a id=__codelineno-101-24 name=__codelineno-101-24 href=#__codelineno-101-24></a><span class=w>      </span><span class=nt>alertname</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Watchdog</span>
<a id=__codelineno-101-25 name=__codelineno-101-25 href=#__codelineno-101-25></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>receiver</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Critical</span>
<a id=__codelineno-101-26 name=__codelineno-101-26 href=#__codelineno-101-26></a><span class=w>    </span><span class=nt>match</span><span class=p>:</span>
<a id=__codelineno-101-27 name=__codelineno-101-27 href=#__codelineno-101-27></a><span class=w>      </span><span class=nt>severity</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">critical</span>
<a id=__codelineno-101-28 name=__codelineno-101-28 href=#__codelineno-101-28></a><span class=w>  </span><span class=nt>group_wait</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">30s</span>
<a id=__codelineno-101-29 name=__codelineno-101-29 href=#__codelineno-101-29></a><span class=w>  </span><span class=nt>group_interval</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5m</span>
<a id=__codelineno-101-30 name=__codelineno-101-30 href=#__codelineno-101-30></a><span class=w>  </span><span class=nt>repeat_interval</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10m</span>
<a id=__codelineno-101-31 name=__codelineno-101-31 href=#__codelineno-101-31></a>
<a id=__codelineno-101-32 name=__codelineno-101-32 href=#__codelineno-101-32></a><span class=c1># 抑制器配置</span>
<a id=__codelineno-101-33 name=__codelineno-101-33 href=#__codelineno-101-33></a><span class=nt>inhibit_rules</span><span class=p>:</span>
<a id=__codelineno-101-34 name=__codelineno-101-34 href=#__codelineno-101-34></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>source_match</span><span class=p>:</span><span class=w> </span><span class=c1># 源标签警报触发时抑制含有目标标签的警报，在当前警报匹配 status: &#39;High&#39;</span>
<a id=__codelineno-101-35 name=__codelineno-101-35 href=#__codelineno-101-35></a><span class=w>      </span><span class=nt>severity</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">critical</span>
<a id=__codelineno-101-36 name=__codelineno-101-36 href=#__codelineno-101-36></a><span class=w>    </span><span class=nt>target_match_re</span><span class=p>:</span>
<a id=__codelineno-101-37 name=__codelineno-101-37 href=#__codelineno-101-37></a><span class=w>      </span><span class=nt>severity</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">warning|info</span>
<a id=__codelineno-101-38 name=__codelineno-101-38 href=#__codelineno-101-38></a><span class=w>    </span><span class=nt>equal</span><span class=p>:</span>
<a id=__codelineno-101-39 name=__codelineno-101-39 href=#__codelineno-101-39></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">namespace</span>
<a id=__codelineno-101-40 name=__codelineno-101-40 href=#__codelineno-101-40></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">alertname</span>
<a id=__codelineno-101-41 name=__codelineno-101-41 href=#__codelineno-101-41></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>source_match</span><span class=p>:</span>
<a id=__codelineno-101-42 name=__codelineno-101-42 href=#__codelineno-101-42></a><span class=w>      </span><span class=nt>severity</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">warning</span>
<a id=__codelineno-101-43 name=__codelineno-101-43 href=#__codelineno-101-43></a><span class=w>    </span><span class=nt>target_match_re</span><span class=p>:</span>
<a id=__codelineno-101-44 name=__codelineno-101-44 href=#__codelineno-101-44></a><span class=w>      </span><span class=nt>severity</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">info</span>
<a id=__codelineno-101-45 name=__codelineno-101-45 href=#__codelineno-101-45></a><span class=w>    </span><span class=nt>equal</span><span class=p>:</span>
<a id=__codelineno-101-46 name=__codelineno-101-46 href=#__codelineno-101-46></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">namespace</span>
<a id=__codelineno-101-47 name=__codelineno-101-47 href=#__codelineno-101-47></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">alertname</span>
<a id=__codelineno-101-48 name=__codelineno-101-48 href=#__codelineno-101-48></a>
<a id=__codelineno-101-49 name=__codelineno-101-49 href=#__codelineno-101-49></a><span class=c1># 接收器指定发送人以及发送渠道</span>
<a id=__codelineno-101-50 name=__codelineno-101-50 href=#__codelineno-101-50></a><span class=nt>receivers</span><span class=p>:</span>
<a id=__codelineno-101-51 name=__codelineno-101-51 href=#__codelineno-101-51></a><span class=c1># ops分组的定义</span>
<a id=__codelineno-101-52 name=__codelineno-101-52 href=#__codelineno-101-52></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ops</span>
<a id=__codelineno-101-53 name=__codelineno-101-53 href=#__codelineno-101-53></a><span class=w>  </span><span class=nt>email_configs</span><span class=p>:</span>
<a id=__codelineno-101-54 name=__codelineno-101-54 href=#__codelineno-101-54></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>to</span><span class=p>:</span><span class=w> </span><span class=s>&#39;9935226@qq.com,10000@qq.com&#39;</span>
<a id=__codelineno-101-55 name=__codelineno-101-55 href=#__codelineno-101-55></a><span class=w>    </span><span class=nt>send_resolved</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id=__codelineno-101-56 name=__codelineno-101-56 href=#__codelineno-101-56></a><span class=w>    </span><span class=nt>headers</span><span class=p>:</span><span class=w> </span>
<a id=__codelineno-101-57 name=__codelineno-101-57 href=#__codelineno-101-57></a><span class=w>      </span><span class=nt>subject</span><span class=p>:</span><span class=w> </span><span class=s>&quot;[operations]</span><span class=nv> </span><span class=s>报警邮件&quot;</span>
<a id=__codelineno-101-58 name=__codelineno-101-58 href=#__codelineno-101-58></a><span class=w>      </span><span class=nt>from</span><span class=p>:</span><span class=w> </span><span class=s>&quot;警报中心&quot;</span>
<a id=__codelineno-101-59 name=__codelineno-101-59 href=#__codelineno-101-59></a><span class=w>      </span><span class=nt>to</span><span class=p>:</span><span class=w> </span><span class=s>&quot;小煜狼皇&quot;</span><span class=w> </span>
<a id=__codelineno-101-60 name=__codelineno-101-60 href=#__codelineno-101-60></a><span class=w>  </span><span class=c1># 钉钉配置</span>
<a id=__codelineno-101-61 name=__codelineno-101-61 href=#__codelineno-101-61></a><span class=w>  </span><span class=nt>webhook_configs</span><span class=p>:</span>
<a id=__codelineno-101-62 name=__codelineno-101-62 href=#__codelineno-101-62></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>url</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">http://localhost:8070/dingtalk/ops/send</span>
<a id=__codelineno-101-63 name=__codelineno-101-63 href=#__codelineno-101-63></a><span class=w>    </span><span class=c1># 企业微信配置</span>
<a id=__codelineno-101-64 name=__codelineno-101-64 href=#__codelineno-101-64></a><span class=w>  </span><span class=nt>wechat_configs</span><span class=p>:</span>
<a id=__codelineno-101-65 name=__codelineno-101-65 href=#__codelineno-101-65></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>corp_id</span><span class=p>:</span><span class=w> </span><span class=s>&#39;ww5421dksajhdasjkhj&#39;</span>
<a id=__codelineno-101-66 name=__codelineno-101-66 href=#__codelineno-101-66></a><span class=w>    </span><span class=nt>api_url</span><span class=p>:</span><span class=w> </span><span class=s>&#39;https://qyapi.weixin.qq.com/cgi-bin/&#39;</span>
<a id=__codelineno-101-67 name=__codelineno-101-67 href=#__codelineno-101-67></a><span class=w>    </span><span class=nt>send_resolved</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id=__codelineno-101-68 name=__codelineno-101-68 href=#__codelineno-101-68></a><span class=w>    </span><span class=nt>to_party</span><span class=p>:</span><span class=w> </span><span class=s>&#39;2&#39;</span>
<a id=__codelineno-101-69 name=__codelineno-101-69 href=#__codelineno-101-69></a><span class=w>    </span><span class=nt>agent_id</span><span class=p>:</span><span class=w> </span><span class=s>&#39;1000002&#39;</span>
<a id=__codelineno-101-70 name=__codelineno-101-70 href=#__codelineno-101-70></a><span class=w>    </span><span class=nt>api_secret</span><span class=p>:</span><span class=w> </span><span class=s>&#39;Tm1kkEE3RGqVhv5hO-khdakjsdkjsahjkdksahjkdsahkj&#39;</span>
<a id=__codelineno-101-71 name=__codelineno-101-71 href=#__codelineno-101-71></a>
<a id=__codelineno-101-72 name=__codelineno-101-72 href=#__codelineno-101-72></a><span class=c1># web</span>
<a id=__codelineno-101-73 name=__codelineno-101-73 href=#__codelineno-101-73></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">web</span>
<a id=__codelineno-101-74 name=__codelineno-101-74 href=#__codelineno-101-74></a><span class=w>  </span><span class=nt>email_configs</span><span class=p>:</span>
<a id=__codelineno-101-75 name=__codelineno-101-75 href=#__codelineno-101-75></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>to</span><span class=p>:</span><span class=w> </span><span class=s>&#39;9935226@qq.com&#39;</span>
<a id=__codelineno-101-76 name=__codelineno-101-76 href=#__codelineno-101-76></a><span class=w>    </span><span class=nt>send_resolved</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id=__codelineno-101-77 name=__codelineno-101-77 href=#__codelineno-101-77></a><span class=w>    </span><span class=nt>headers</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">{</span><span class=nt> Subject</span><span class=p>:</span><span class=w> </span><span class=s>&quot;[web]</span><span class=nv> </span><span class=s>报警邮件&quot;</span><span class="p p-Indicator">}</span><span class=w> </span><span class=c1># 接收邮件的标题</span>
<a id=__codelineno-101-78 name=__codelineno-101-78 href=#__codelineno-101-78></a><span class=w>  </span><span class=nt>webhook_configs</span><span class=p>:</span>
<a id=__codelineno-101-79 name=__codelineno-101-79 href=#__codelineno-101-79></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>url</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">http://localhost:8070/dingtalk/web/send</span>
<a id=__codelineno-101-80 name=__codelineno-101-80 href=#__codelineno-101-80></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>url</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">http://localhost:8070/dingtalk/ops/send</span>
<a id=__codelineno-101-81 name=__codelineno-101-81 href=#__codelineno-101-81></a><span class=c1># db</span>
<a id=__codelineno-101-82 name=__codelineno-101-82 href=#__codelineno-101-82></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">db</span>
<a id=__codelineno-101-83 name=__codelineno-101-83 href=#__codelineno-101-83></a><span class=w>  </span><span class=nt>email_configs</span><span class=p>:</span>
<a id=__codelineno-101-84 name=__codelineno-101-84 href=#__codelineno-101-84></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>to</span><span class=p>:</span><span class=w> </span><span class=s>&#39;9935226@qq.com&#39;</span>
<a id=__codelineno-101-85 name=__codelineno-101-85 href=#__codelineno-101-85></a><span class=w>    </span><span class=nt>send_resolved</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id=__codelineno-101-86 name=__codelineno-101-86 href=#__codelineno-101-86></a><span class=w>    </span><span class=nt>headers</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">{</span><span class=nt> Subject</span><span class=p>:</span><span class=w> </span><span class=s>&quot;[db]</span><span class=nv> </span><span class=s>报警邮件&quot;</span><span class="p p-Indicator">}</span><span class=w> </span><span class=c1># 接收邮件的标题</span>
<a id=__codelineno-101-87 name=__codelineno-101-87 href=#__codelineno-101-87></a><span class=w>  </span><span class=nt>webhook_configs</span><span class=p>:</span>
<a id=__codelineno-101-88 name=__codelineno-101-88 href=#__codelineno-101-88></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>url</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">http://localhost:8070/dingtalk/db/send</span>
<a id=__codelineno-101-89 name=__codelineno-101-89 href=#__codelineno-101-89></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>url</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">http://localhost:8070/dingtalk/ops/send</span>
<a id=__codelineno-101-90 name=__codelineno-101-90 href=#__codelineno-101-90></a><span class=c1># hadoop</span>
<a id=__codelineno-101-91 name=__codelineno-101-91 href=#__codelineno-101-91></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">hadoop</span>
<a id=__codelineno-101-92 name=__codelineno-101-92 href=#__codelineno-101-92></a><span class=w>  </span><span class=nt>email_configs</span><span class=p>:</span>
<a id=__codelineno-101-93 name=__codelineno-101-93 href=#__codelineno-101-93></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>to</span><span class=p>:</span><span class=w> </span><span class=s>&#39;9935226@qq.com&#39;</span>
<a id=__codelineno-101-94 name=__codelineno-101-94 href=#__codelineno-101-94></a><span class=w>    </span><span class=nt>send_resolved</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id=__codelineno-101-95 name=__codelineno-101-95 href=#__codelineno-101-95></a><span class=w>    </span><span class=nt>headers</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">{</span><span class=nt> Subject</span><span class=p>:</span><span class=w> </span><span class=s>&quot;[hadoop]</span><span class=nv> </span><span class=s>报警邮件&quot;</span><span class="p p-Indicator">}</span><span class=w> </span><span class=c1># 接收邮件的标题</span>
<a id=__codelineno-101-96 name=__codelineno-101-96 href=#__codelineno-101-96></a><span class=w>  </span><span class=nt>webhook_configs</span><span class=p>:</span>
<a id=__codelineno-101-97 name=__codelineno-101-97 href=#__codelineno-101-97></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>url</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">http://localhost:8070/dingtalk/hadoop/send</span>
<a id=__codelineno-101-98 name=__codelineno-101-98 href=#__codelineno-101-98></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>url</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">http://localhost:8070/dingtalk/ops/send</span>
</code></pre></div> <p>从配置文件可以看出，Alertmanager的配置主要分为5大块：</p> <ul> <li> <p>Global：全局配置，主要进行一些通用的配置，比如邮件通知的账号、密码、SMTP服务器、微信告警等。Global块配置下的配置选项在本配置文件内的所有配置项下可见，但是文件内其他位置的子配置可以覆盖Global配置。</p> </li> <li> <p>Templates：用于放置自定义模板的位置。</p> </li> <li>Route：告警路由配置，用于告警信息的分组路由，可以将不同分组的告警发送给不同的收件人。比如将数据库告警发送给DBA，服务器告警发送给OPS。</li> <li>Inhibit_rules：告警抑制，主要用于减少告警的次数，防止“告警轰炸”。比如某个宿主机宕机，可能会引起容器重建、漂移、服务 不可用等一系列问题，如果每个异常均有告警，会一次性发送很多告警，造成告警轰炸，并且也会干扰定位问题的思路，所以可以使 用告警抑制，屏蔽由宿主机宕机引来的其他问题，只发送宿主机宕机的消息即可。</li> <li>Receivers：告警收件人配置，每个receiver都有一个名字，经过route分组并且路由后需要指定一个receiver，就是在此位置配置 的。</li> </ul> <p>了解完Alertmanager主要的配置块后，接下来对Alertmanager比较重要的Route单独讲解，其他配置会在实践中进行补充。</p> <h3 id=82-alertmanager路由规则>8.2 Alertmanager路由规则<a class=headerlink href=#82-alertmanager路由规则 title="Permanent link">&para;</a></h3> <p>前文提到过Route是告警的路由配置，它可以让告警根据分组发送给对应的人或者小组，这一块的配置是Alertmanager比较复杂且经常变更的配置，所以本小节将讲解一下Alertmanager的路由配置。</p> <p>从上述配置文件中，截取Route配置：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-102-1 name=__codelineno-102-1 href=#__codelineno-102-1></a><span class=c1># 路由分组</span>
<a id=__codelineno-102-2 name=__codelineno-102-2 href=#__codelineno-102-2></a><span class=nt>route</span><span class=p>:</span>
<a id=__codelineno-102-3 name=__codelineno-102-3 href=#__codelineno-102-3></a><span class=w>  </span><span class=nt>receiver</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Default</span>
<a id=__codelineno-102-4 name=__codelineno-102-4 href=#__codelineno-102-4></a><span class=w>  </span><span class=nt>group_by</span><span class=p>:</span>
<a id=__codelineno-102-5 name=__codelineno-102-5 href=#__codelineno-102-5></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">namespace</span>
<a id=__codelineno-102-6 name=__codelineno-102-6 href=#__codelineno-102-6></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">job</span>
<a id=__codelineno-102-7 name=__codelineno-102-7 href=#__codelineno-102-7></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">alertname</span>
<a id=__codelineno-102-8 name=__codelineno-102-8 href=#__codelineno-102-8></a><span class=w>  </span><span class=nt>routes</span><span class=p>:</span>
<a id=__codelineno-102-9 name=__codelineno-102-9 href=#__codelineno-102-9></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>receiver</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Watchdog</span>
<a id=__codelineno-102-10 name=__codelineno-102-10 href=#__codelineno-102-10></a><span class=w>    </span><span class=nt>match</span><span class=p>:</span>
<a id=__codelineno-102-11 name=__codelineno-102-11 href=#__codelineno-102-11></a><span class=w>      </span><span class=nt>alertname</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Watchdog</span>
<a id=__codelineno-102-12 name=__codelineno-102-12 href=#__codelineno-102-12></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>receiver</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Critical</span>
<a id=__codelineno-102-13 name=__codelineno-102-13 href=#__codelineno-102-13></a><span class=w>    </span><span class=nt>match</span><span class=p>:</span>
<a id=__codelineno-102-14 name=__codelineno-102-14 href=#__codelineno-102-14></a><span class=w>      </span><span class=nt>severity</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">critical</span>
<a id=__codelineno-102-15 name=__codelineno-102-15 href=#__codelineno-102-15></a><span class=w>  </span><span class=nt>group_wait</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">30s</span>
<a id=__codelineno-102-16 name=__codelineno-102-16 href=#__codelineno-102-16></a><span class=w>  </span><span class=nt>group_interval</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5m</span>
<a id=__codelineno-102-17 name=__codelineno-102-17 href=#__codelineno-102-17></a><span class=w>  </span><span class=nt>repeat_interval</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10m</span>
</code></pre></div> <p>从配置文件可以看出，路由配置块的顶级配置由route开始，它是整个路由的入口，称作根路由。</p> <p>每一条告警进来后，都先进入route，之后根据告警自身的标签和route.group_by配置的字段进行分组。比如可以根据job、 cluster或者其他自定义的标签名称进行分组，分组后进入子路由（通过route.routes配置子路由），进一步进行更加细粒度的划分，比如job名称包含mysql的发送给DBA组。</p> <p>除了group_by和routes外，Route还有以下常用的配置：</p> <ul> <li> <p>receiver：告警的通知目标，需要和receivers配置中的name进行匹配。需要注意的是，route.routes下也可以有receiver配置，优先级高于route.receiver配置的默认接收人，当告警没有匹配到子路由时,会使用route.receiver进行通知,比如上述配置中的Default。</p> </li> <li> <p>group_by ： 分组配置,值类型为列表。比如配置成['job','severity']，代表告警信息包含job和severity标签的会进行分组，且标签的key和value都相同才会被分到一组。</p> </li> <li> <p>continue：决定匹配到第一个路由后，是否继续后续匹配。默认为false，即匹配到第一个子节点后停止继续匹配。</p> </li> <li> <p>match：一对一匹配规则，比如match配置的为job: mysql，那么具有job=mysql的告警会进入该路由。</p> </li> <li> <p>match_re：和match类似，只不过match_re是正则匹配。</p> </li> <li> <p>matchers：这是Alertmanager 0.22版本新添加的一个配置项，用于替换match和match_re，如果读者用0.22以上版本的Alertmanager，可以尝试使用该参数。Matchers设计理念参考了PromQL和OpenMetrics，可以直接写成如下格式：</p> </li> <li> <p>匹配foo等于bar且dings不等于bums</p> <div class=highlight><pre><span></span><code><a id=__codelineno-103-1 name=__codelineno-103-1 href=#__codelineno-103-1></a>matchers:
<a id=__codelineno-103-2 name=__codelineno-103-2 href=#__codelineno-103-2></a>  - foo = bar
<a id=__codelineno-103-3 name=__codelineno-103-3 href=#__codelineno-103-3></a>  - dings != bums
</code></pre></div> </li> <li> <p>匹配foo等于bar和baz，且dings不等于bums：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-104-1 name=__codelineno-104-1 href=#__codelineno-104-1></a>matchers：[ &quot;foo = bar,baz&quot;, &quot;dings != bums&quot; ]
</code></pre></div> </li> <li> <p>匹配foo等于bar且dings不等于bums的另一种写法，和PromQL类似：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-105-1 name=__codelineno-105-1 href=#__codelineno-105-1></a>matchers：[ &#39;{foo=&quot;bar&quot;, dings!=&quot;bums&quot;}&#39; ]
</code></pre></div> </li> <li> <p>group_wait：告警通知等待，值类型为字符串。若一组新的告警产生，则会等group_wait后再发送通知，该功能主要用于当告警在很短时间内接连产生时，在group_wait内合并为单一的告警后再发送，防止告警过多，默认值为30s。</p> </li> <li> <p>group_interval：同一组告警通知后，如果有新的告警添加到该组中，再次发送告警通知的时间，默认值为5ms。</p> </li> <li>repeat_interval：如果一条告警通知已成功发送，且在间隔repeat_interval后，该告警仍然未被设置为resolved，则会再次发 送该告警通知，默认值为4h。</li> </ul> <p>以上即为Alertmanager常用的路由配置，可以看到Alertmanager的路由和匹配规则非常灵活，通过不同的路由嵌套和匹配规则可以达到不同的通知效果。</p> <p>对于Alertmanager的其他配置，会在实践中进行补充。接下来学习如何将告警通过不同的媒介进行通知。</p> <h3 id=83-alertmanager邮件通知>8.3 Alertmanager邮件通知<a class=headerlink href=#83-alertmanager邮件通知 title="Permanent link">&para;</a></h3> <p>告警邮件通知是企业内最常用的一种通知方式，Alertmanager原生支持邮件告警方式，其配置方式相对简单。首先进入在安装小节（本书15.2节）clone的代码目录，找到Alertmanager的配置文件（其他安装方式的位置可能不同，需要自行找到配置文件的位置，配置文件的内容是一致的）：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-106-1 name=__codelineno-106-1 href=#__codelineno-106-1></a><span class=o>[</span>root@centos7-base<span class=w> </span>kube-prometheus<span class=o>]</span><span class=c1># cd manifests/</span>
<a id=__codelineno-106-2 name=__codelineno-106-2 href=#__codelineno-106-2></a><span class=o>[</span>root@centos7-base<span class=w> </span>manifests<span class=o>]</span><span class=c1># ls alertmanager-secret.yaml</span>
<a id=__codelineno-106-3 name=__codelineno-106-3 href=#__codelineno-106-3></a>alertmanager-secret.yaml
</code></pre></div> <p>使用Operator形式安装的Prometheus和Alertmanager，配置都会存储在Kubernetes的ConfigMap和Secret中。</p> <p>Alertmanager的配置文件是通过Secret进行存储的，其原始文件为alertmanagersecret.yaml，内容大致如下：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-107-1 name=__codelineno-107-1 href=#__codelineno-107-1></a><span class="l l-Scalar l-Scalar-Plain">cat alertmanager-secret.yaml</span>
<a id=__codelineno-107-2 name=__codelineno-107-2 href=#__codelineno-107-2></a><span class="l l-Scalar l-Scalar-Plain">apiVersion</span><span class="p p-Indicator">:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id=__codelineno-107-3 name=__codelineno-107-3 href=#__codelineno-107-3></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Secret</span>
<a id=__codelineno-107-4 name=__codelineno-107-4 href=#__codelineno-107-4></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-107-5 name=__codelineno-107-5 href=#__codelineno-107-5></a><span class=w>  </span><span class=nt>labels</span><span class=p>:</span>
<a id=__codelineno-107-6 name=__codelineno-107-6 href=#__codelineno-107-6></a><span class=w>    </span><span class=nt>alertmanager</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">main</span>
<a id=__codelineno-107-7 name=__codelineno-107-7 href=#__codelineno-107-7></a><span class=w>    </span><span class=nt>app.kubernetes.io/component</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">alert-router</span>
<a id=__codelineno-107-8 name=__codelineno-107-8 href=#__codelineno-107-8></a><span class=w>    </span><span class=nt>app.kubernetes.io/name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">alertmanager</span>
<a id=__codelineno-107-9 name=__codelineno-107-9 href=#__codelineno-107-9></a><span class=w>    </span><span class=nt>app.kubernetes.io/part-of</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kube-prometheus</span>
<a id=__codelineno-107-10 name=__codelineno-107-10 href=#__codelineno-107-10></a><span class=w>    </span><span class=nt>app.kubernetes.io/version</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">0.22.2</span>
<a id=__codelineno-107-11 name=__codelineno-107-11 href=#__codelineno-107-11></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">alertmanager-main</span>
<a id=__codelineno-107-12 name=__codelineno-107-12 href=#__codelineno-107-12></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">monitoring</span>
<a id=__codelineno-107-13 name=__codelineno-107-13 href=#__codelineno-107-13></a><span class=nt>stringData</span><span class=p>:</span>
<a id=__codelineno-107-14 name=__codelineno-107-14 href=#__codelineno-107-14></a><span class=w>  </span><span class=nt>alertmanager.yaml</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|-</span>
<a id=__codelineno-107-15 name=__codelineno-107-15 href=#__codelineno-107-15></a><span class=w>    </span><span class=no>&quot;global&quot;:</span>
<a id=__codelineno-107-16 name=__codelineno-107-16 href=#__codelineno-107-16></a><span class=w>      </span><span class=no>&quot;resolve_timeout&quot;: &quot;5m&quot;</span>
<a id=__codelineno-107-17 name=__codelineno-107-17 href=#__codelineno-107-17></a><span class="l l-Scalar l-Scalar-Plain">......</span>
</code></pre></div> <p>前文提到过，一般通用配置会放置在global配置中，进行邮件通知的SMTP配置也是放在global下。</p> <p>接下来通过163邮箱配置邮件通知，首先在163邮箱平台将SMTP功能打开（本书不做演示），之后在alertmanager- secret.yaml文件的global下添加如下配置：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-108-1 name=__codelineno-108-1 href=#__codelineno-108-1></a><span class=w>  </span><span class=nt>alertmanager.yaml</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|-</span>
<a id=__codelineno-108-2 name=__codelineno-108-2 href=#__codelineno-108-2></a><span class=w>    </span><span class=no>&quot;global&quot;:</span>
<a id=__codelineno-108-3 name=__codelineno-108-3 href=#__codelineno-108-3></a><span class=w>      </span><span class=no>resolve_timeout: &quot;5m&quot;</span>
<a id=__codelineno-108-4 name=__codelineno-108-4 href=#__codelineno-108-4></a><span class=w>      </span><span class=no># smtp配置</span>
<a id=__codelineno-108-5 name=__codelineno-108-5 href=#__codelineno-108-5></a><span class=w>      </span><span class=no>smtp_from: &quot;1879324764@qq.com&quot;</span>
<a id=__codelineno-108-6 name=__codelineno-108-6 href=#__codelineno-108-6></a><span class=w>      </span><span class=no>smtp_smarthost: &#39;smtp.qq.com:25&#39;</span>
<a id=__codelineno-108-7 name=__codelineno-108-7 href=#__codelineno-108-7></a><span class=w>      </span><span class=no>smtp_hello: &quot;smtp.qq.com&quot;</span>
<a id=__codelineno-108-8 name=__codelineno-108-8 href=#__codelineno-108-8></a><span class=w>      </span><span class=no>smtp_auth_username: &quot;1879324764@qq.com&quot;</span>
<a id=__codelineno-108-9 name=__codelineno-108-9 href=#__codelineno-108-9></a><span class=w>      </span><span class=no>smtp_auth_password: &quot;ucpkvebqnkysecgh&quot;</span>
<a id=__codelineno-108-10 name=__codelineno-108-10 href=#__codelineno-108-10></a><span class=w>      </span><span class=no>smtp_require_tls: false</span>
</code></pre></div> <p>之后将名称为Default的receiver配置更改为邮件通知,修改alertmanager-secret.yaml文件的receivers配置如下：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-109-1 name=__codelineno-109-1 href=#__codelineno-109-1></a><span class=w>    </span><span class=s>&quot;receivers&quot;</span><span class="p p-Indicator">:</span>
<a id=__codelineno-109-2 name=__codelineno-109-2 href=#__codelineno-109-2></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;name&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class=s>&quot;Default&quot;</span>
<a id=__codelineno-109-3 name=__codelineno-109-3 href=#__codelineno-109-3></a><span class=w>      </span><span class=s>&quot;email_configs&quot;</span><span class="p p-Indicator">:</span>
<a id=__codelineno-109-4 name=__codelineno-109-4 href=#__codelineno-109-4></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>to</span><span class=p>:</span><span class=w> </span><span class=s>&quot;notification@163.com&quot;</span>
<a id=__codelineno-109-5 name=__codelineno-109-5 href=#__codelineno-109-5></a><span class=w>        </span><span class=nt>send_resolved</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id=__codelineno-109-6 name=__codelineno-109-6 href=#__codelineno-109-6></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;name&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class=s>&quot;Watchdog&quot;</span>
<a id=__codelineno-109-7 name=__codelineno-109-7 href=#__codelineno-109-7></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;name&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class=s>&quot;Critical&quot;</span>
</code></pre></div> <ul> <li>email_configs：代表使用邮件通知。</li> <li>to：收件人，此处为<a href=mailto:notification@163.com>&#110;&#111;&#116;&#105;&#102;&#105;&#99;&#97;&#116;&#105;&#111;&#110;&#64;&#49;&#54;&#51;&#46;&#99;&#111;&#109;</a>，可以配置多个，用逗号隔开。</li> <li>send_resolved：如果告警被解决，是否发送解决通知</li> </ul> <p>至此，即完成了告警的邮件通知。接下来分析一下路由规则（默认分组只有namespace，在此添加job和alertname，当然不添加也可以）：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-110-1 name=__codelineno-110-1 href=#__codelineno-110-1></a><span class=c1># 路由分组</span>
<a id=__codelineno-110-2 name=__codelineno-110-2 href=#__codelineno-110-2></a><span class=nt>route</span><span class=p>:</span>
<a id=__codelineno-110-3 name=__codelineno-110-3 href=#__codelineno-110-3></a><span class=w>  </span><span class=nt>group_wait</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">30s</span>
<a id=__codelineno-110-4 name=__codelineno-110-4 href=#__codelineno-110-4></a><span class=w>  </span><span class=nt>group_interval</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5m</span>
<a id=__codelineno-110-5 name=__codelineno-110-5 href=#__codelineno-110-5></a><span class=w>  </span><span class=nt>repeat_interval</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10m</span>
<a id=__codelineno-110-6 name=__codelineno-110-6 href=#__codelineno-110-6></a><span class=w>  </span><span class=nt>receiver</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Default</span>
<a id=__codelineno-110-7 name=__codelineno-110-7 href=#__codelineno-110-7></a><span class=w>  </span><span class=s>&quot;group_by&quot;</span><span class="p p-Indicator">:</span>
<a id=__codelineno-110-8 name=__codelineno-110-8 href=#__codelineno-110-8></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;namespace&quot;</span>
<a id=__codelineno-110-9 name=__codelineno-110-9 href=#__codelineno-110-9></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;job&quot;</span>
<a id=__codelineno-110-10 name=__codelineno-110-10 href=#__codelineno-110-10></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;alertname&quot;</span>
<a id=__codelineno-110-11 name=__codelineno-110-11 href=#__codelineno-110-11></a><span class=w>  </span><span class=nt>routes</span><span class=p>:</span>
<a id=__codelineno-110-12 name=__codelineno-110-12 href=#__codelineno-110-12></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>receiver</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Watchdog</span>
<a id=__codelineno-110-13 name=__codelineno-110-13 href=#__codelineno-110-13></a><span class=w>    </span><span class=nt>match</span><span class=p>:</span>
<a id=__codelineno-110-14 name=__codelineno-110-14 href=#__codelineno-110-14></a><span class=w>      </span><span class=nt>alertname</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Watchdog</span>
<a id=__codelineno-110-15 name=__codelineno-110-15 href=#__codelineno-110-15></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>receiver</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Critical</span>
<a id=__codelineno-110-16 name=__codelineno-110-16 href=#__codelineno-110-16></a><span class=w>    </span><span class=nt>match</span><span class=p>:</span>
<a id=__codelineno-110-17 name=__codelineno-110-17 href=#__codelineno-110-17></a><span class=w>      </span><span class=nt>severity</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">critical</span>
</code></pre></div> <p>该告警规则对namespace标签进行分组（group_by字段），没有匹配到子路由的告警默认发送给名为Default的receiver（receiver字段）。</p> <p>如果匹配到alertname=Watchdog的告警，则将通知发送给Watchdog，如果匹配到severity=critical的告警，则将通知发送给Critical。</p> <p>我们可以通过Alertmanager提供的Web UI查看分组信息，和Prometheus一致，将Alertmanager的Service更改为NodePort（见图15.42）：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-111-1 name=__codelineno-111-1 href=#__codelineno-111-1></a><span class=c1># kubectl edit svc -n monitoring alertmanager-main</span>
</code></pre></div> <div class=highlight><pre><span></span><code><a id=__codelineno-112-1 name=__codelineno-112-1 href=#__codelineno-112-1></a><span class=w>  </span><span class=nt>ports</span><span class=p>:</span>
<a id=__codelineno-112-2 name=__codelineno-112-2 href=#__codelineno-112-2></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">web</span>
<a id=__codelineno-112-3 name=__codelineno-112-3 href=#__codelineno-112-3></a><span class=w>    </span><span class=nt>nodePort</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">32234</span>
<a id=__codelineno-112-4 name=__codelineno-112-4 href=#__codelineno-112-4></a><span class=w>    </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">9093</span>
<a id=__codelineno-112-5 name=__codelineno-112-5 href=#__codelineno-112-5></a><span class=w>    </span><span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<a id=__codelineno-112-6 name=__codelineno-112-6 href=#__codelineno-112-6></a><span class=w>    </span><span class=nt>targetPort</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">web</span>
<a id=__codelineno-112-7 name=__codelineno-112-7 href=#__codelineno-112-7></a><span class=w>  </span><span class=nt>selector</span><span class=p>:</span>
<a id=__codelineno-112-8 name=__codelineno-112-8 href=#__codelineno-112-8></a><span class=w>    </span><span class=nt>alertmanager</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">main</span>
<a id=__codelineno-112-9 name=__codelineno-112-9 href=#__codelineno-112-9></a><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">alertmanager</span>
<a id=__codelineno-112-10 name=__codelineno-112-10 href=#__codelineno-112-10></a><span class=w>    </span><span class=nt>app.kubernetes.io/component</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">alert-router</span>
<a id=__codelineno-112-11 name=__codelineno-112-11 href=#__codelineno-112-11></a><span class=w>    </span><span class=nt>app.kubernetes.io/name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">alertmanager</span>
<a id=__codelineno-112-12 name=__codelineno-112-12 href=#__codelineno-112-12></a><span class=w>    </span><span class=nt>app.kubernetes.io/part-of</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kube-prometheus</span>
<a id=__codelineno-112-13 name=__codelineno-112-13 href=#__codelineno-112-13></a><span class=w>  </span><span class=nt>sessionAffinity</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ClientIP</span>
<a id=__codelineno-112-14 name=__codelineno-112-14 href=#__codelineno-112-14></a><span class=w>  </span><span class=nt>sessionAffinityConfig</span><span class=p>:</span>
<a id=__codelineno-112-15 name=__codelineno-112-15 href=#__codelineno-112-15></a><span class=w>    </span><span class=nt>clientIP</span><span class=p>:</span>
<a id=__codelineno-112-16 name=__codelineno-112-16 href=#__codelineno-112-16></a><span class=w>      </span><span class=nt>timeoutSeconds</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10800</span>
<a id=__codelineno-112-17 name=__codelineno-112-17 href=#__codelineno-112-17></a><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">NodePort</span>
</code></pre></div> <p>查看监听的端口号：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-113-1 name=__codelineno-113-1 href=#__codelineno-113-1></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>svc<span class=w> </span>-n<span class=w> </span>monitoring<span class=w> </span>alertmanager-main
<a id=__codelineno-113-2 name=__codelineno-113-2 href=#__codelineno-113-2></a>NAME<span class=w>                </span>TYPE<span class=w>       </span>CLUSTER-IP<span class=w>    </span>EXTERNAL-IP<span class=w>   </span>PORT<span class=o>(</span>S<span class=o>)</span><span class=w>          </span>AGE
<a id=__codelineno-113-3 name=__codelineno-113-3 href=#__codelineno-113-3></a>alertmanager-main<span class=w>   </span>NodePort<span class=w>   </span><span class=m>10</span>.99.53.46<span class=w>   </span>&lt;none&gt;<span class=w>        </span><span class=m>9093</span>:32234/TCP<span class=w>   </span>21h
</code></pre></div> <p>将更改好的Alertmanager配置加载到Alertmanager：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-114-1 name=__codelineno-114-1 href=#__codelineno-114-1></a>$<span class=w> </span>kubectl<span class=w> </span>replace<span class=w> </span>-f<span class=w> </span>alertmanager-secret.yaml
<a id=__codelineno-114-2 name=__codelineno-114-2 href=#__codelineno-114-2></a>secret/alertmanager-main<span class=w> </span>replaced
</code></pre></div> <p>稍等几分钟，即可在Alertmanager的Web界面看到更改的配置(Status），如图15.43所示。</p> <p><img alt class=zoom src=../../../assets/static/kubernetes/5/15-43.png> 图15.43　查看Alertmanager配置</p> <p>也可以查看分组信息，如图15.44所示。 <img alt class=zoom src=../../../assets/static/kubernetes/5/15-44.png> 图15.44　查看告警分组</p> <p>在安装Prometheus后，如果没有做任何更改，可能会在Prometheus页面看到如下告警：</p> <ul> <li>KubeSchedulerDown和KubeControllerManagerDown可以参考15.3.3节的ServiceMonitor进行解决。</li> <li>Watchdog：并非是一个异常的告警，而是Prometheus集群的状态监控，它表示Prometheus集群的状态是正常的，可以将此告警关闭。</li> <li>CPU?hrottlingHigh：该告警反映的是最近5分钟超过25%的CPU执行周期受到限制的容器，一般是limit设置得低或者未设置引起的。可以将此告警关闭，或者合理配置容器的resources参数。</li> <li>NodeClockNotSynchronising：该告警是由于主机和时间服务器无法连接导致的，读者可能并没有此告警，该告警可以直接关闭，也可以通过配置NTP服务器来解决。</li> </ul> <p>接下来单击任意一个告警，可以查看到该条告警信息的告警语法，如图15.45和图15.46所示。</p> <p><img alt class=zoom src=../../../assets/static/kubernetes/5/15-45.png> 图15.45　查看告警</p> <p><img alt class=zoom src=../../../assets/static/kubernetes/5/15-46.png> 图15.46　查看告警语法</p> <p>之后单击expr的语法，可以进入查询页面，如图15.47所示。 <img alt class=zoom src=../../../assets/static/kubernetes/5/15-47.png> 图15.47　查看expr语法</p> <p>此时可以看到每个metric的标签，如果查看每个已经告警的详细语法，可以看到Watchdog具有alertname="Watchdog"标签，两个Kube的告警（如有）具有severity="critical"标签，这两条告警均被子路由匹配，分别将告警发送给了Watchdog和Critical，由于两者并没有配置实际的媒介，因此暂时无法收到该告警。</p> <p>而CPUThrottlingHigh和NodeClockNotSynchronising没有匹配到任何子路由，所以将告警信息发送到了默认的receiver，也就是Default，此时Default receiver配置的邮箱会收到两者的告警信息，如图15.48和图15.49所示。</p> <p><img alt class=zoom src=../../../assets/static/kubernetes/5/15-48.png> 图15.48　查看邮件告警</p> <p>通过以上步骤即可实现告警的邮件通知，在实际使用时，可以根据不同的分组将告警发送给不同的收件人。</p> <h3 id=84-alertmanager企业微信通知>8.4 Alertmanager企业微信通知<a class=headerlink href=#84-alertmanager企业微信通知 title="Permanent link">&para;</a></h3> <p>上一小节已经实现了使用邮件进行告警的通知，本小节演示使用企业微信进行告警。</p> <p>首先在企业微信官网（<a href=https://work.weixin.qq.com/ >https://work.weixin.qq.com/</a>）注册一个企业(任何人都可以注册，注册过程不再演示），如果读者所在的公司已经有相关企业微信，可以无须注册，只需要有创建通讯录和创建应用的权限即可。</p> <p><strong>1．企业微信配置</strong></p> <p>注册完成后进行登录，登录后单击“我的企业”，如图15.50所示。</p> <p><img alt class=zoom src=../../../assets/static/kubernetes/5/15-50.png> 图15.50　查看我的企业</p> <p>在页面的最下面找到企业ID（对应Alertmanager的corp_id字段）并记录，稍后会用到，如图15.51所示。</p> <p><img alt class=zoom src=../../../assets/static/kubernetes/5/15-51.png> 图15.51　查看企业ID</p> <p>之后创建一个部门，用于接收告警通知，如图15.52所示。 <img alt class=zoom src=../../../assets/static/kubernetes/5/15-52.png> 图15.52　添加子部门</p> <p>输入Prom告警，之后单击“确定”按钮，如图15.53所示。 <img alt class=zoom src=../../../assets/static/kubernetes/5/15-53.png> 图15.53　配置部门名称</p> <p>之后在Prom告警子部门添加相关的成员即可，如图15.54所示，在此不再演示。 <img alt class=zoom src=../../../assets/static/kubernetes/5/15-54.png> 图15.54　添加成员</p> <p>查看该部门ID（对应Alertmanager的to_party字段）并记录，如图15.55所示。 <img alt class=zoom src=../../../assets/static/kubernetes/5/15-55.png> 图15.55　查看部门ID</p> <p>之后创建机器人应用，首先单击应用管理→创建应用，如图15.56所示。 <img alt class=zoom src=../../../assets/static/kubernetes/5/15-56.png> 图15.56　添加告警应用</p> <p>选择一个logo，输入应用名称并选择可见范围，如图15.57和图15.58所示。</p> <p><img alt class=zoom src=../../../assets/static/kubernetes/5/15-57.png> 图15.57　配置应用可见权限</p> <p><img alt class=zoom src=../../../assets/static/kubernetes/5/15-58.png> 图15.58　配置应用可见范围</p> <p>创建完成后，查看AgentId和Secret（对应Alertmanager的api_secret字段）并记录，如图15.59所示。</p> <p>单击Secret后的“查看”，此时会将Secret发送至企业微信，单击“前往查看”并记录即可，如图15.60所示。 <img alt class=zoom src=../../../assets/static/kubernetes/5/15-59.png> 图15.59　查看AgentId和Secret</p> <p><img alt class=zoom src=../../../assets/static/kubernetes/5/15-60.png> 图15.60　查看Secret详情</p> <p><strong>2．Alertmanager配置</strong></p> <p>修改Alertmanager配置文件，添加企业微信告警。首先修改global，添加一些通用配置，wechat_api_url是固定配置，corp_id为企业ID：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-115-1 name=__codelineno-115-1 href=#__codelineno-115-1></a><span class=w>    </span><span class=s>&quot;global&quot;</span><span class="p p-Indicator">:</span>
<a id=__codelineno-115-2 name=__codelineno-115-2 href=#__codelineno-115-2></a><span class=w>      </span><span class=nt>resolve_timeout</span><span class=p>:</span><span class=w> </span><span class=s>&quot;5m&quot;</span>
<a id=__codelineno-115-3 name=__codelineno-115-3 href=#__codelineno-115-3></a><span class=w>      </span><span class=nt>wechat_api_url</span><span class=p>:</span><span class=w> </span><span class=s>&quot;https://qyapi.weixin.qq.com/cgi-bin/&quot;</span>
<a id=__codelineno-115-4 name=__codelineno-115-4 href=#__codelineno-115-4></a><span class=w>      </span><span class=nt>wechat api corp id</span><span class=p>:</span><span class=w> </span><span class=s>&quot;wwef86a30xxxxxxxxxxxx&quot;</span>
</code></pre></div> <p>receivers添加微信通知：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-116-1 name=__codelineno-116-1 href=#__codelineno-116-1></a><span class=w>    </span><span class=s>&quot;receivers&quot;</span><span class="p p-Indicator">:</span>
<a id=__codelineno-116-2 name=__codelineno-116-2 href=#__codelineno-116-2></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;name&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">wechat-ops</span>
<a id=__codelineno-116-3 name=__codelineno-116-3 href=#__codelineno-116-3></a><span class=w>      </span><span class=nt>wechat_configs</span><span class=p>:</span>
<a id=__codelineno-116-4 name=__codelineno-116-4 href=#__codelineno-116-4></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>send_resolved</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id=__codelineno-116-5 name=__codelineno-116-5 href=#__codelineno-116-5></a><span class=w>        </span><span class=nt>to_party</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<a id=__codelineno-116-6 name=__codelineno-116-6 href=#__codelineno-116-6></a><span class=w>        </span><span class=nt>to_user</span><span class=p>:</span><span class=w> </span><span class=s>&quot;@all&quot;</span>
<a id=__codelineno-116-7 name=__codelineno-116-7 href=#__codelineno-116-7></a><span class=w>        </span><span class=nt>agent_id</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1000006</span>
<a id=__codelineno-116-8 name=__codelineno-116-8 href=#__codelineno-116-8></a><span class=w>        </span><span class=nt>api_secret</span><span class=p>:</span><span class=w> </span><span class=s>&quot;3bB350Sxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&quot;</span>
<a id=__codelineno-116-9 name=__codelineno-116-9 href=#__codelineno-116-9></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;name&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class=s>&quot;Default&quot;</span>
<a id=__codelineno-116-10 name=__codelineno-116-10 href=#__codelineno-116-10></a><span class=w>      </span><span class=s>&quot;email_configs&quot;</span><span class="p p-Indicator">:</span>
<a id=__codelineno-116-11 name=__codelineno-116-11 href=#__codelineno-116-11></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>to</span><span class=p>:</span><span class=w> </span><span class=s>&quot;notification@163.com&quot;</span>
<a id=__codelineno-116-12 name=__codelineno-116-12 href=#__codelineno-116-12></a><span class=w>        </span><span class=nt>send_resolved</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id=__codelineno-116-13 name=__codelineno-116-13 href=#__codelineno-116-13></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;name&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class=s>&quot;Watchdog&quot;</span>
<a id=__codelineno-116-14 name=__codelineno-116-14 href=#__codelineno-116-14></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;name&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class=s>&quot;Critical&quot;</span>
</code></pre></div> <p>此处配置的receiver名字为wechat-ops，可根据实际情况划分不同的部门。此时配置的to_user为<a class="magiclink magiclink-github magiclink-mention" href=https://github.com/all title="GitHub User: all">@all</a>，代表发送给所有人，也可以只发送给部门的某一个人，只需要将此处改为USER_ID即可， 如图15.61所示。</p> <p><img alt class=zoom src=../../../assets/static/kubernetes/5/15-61.png> 图15.61　用户ID</p> <p>更改路由配置，将Watchdog的告警发送给该部门（也可以根据自己的实际情况将其他告警发送给该部门）：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-117-1 name=__codelineno-117-1 href=#__codelineno-117-1></a><span class=nt>route</span><span class=p>:</span>
<a id=__codelineno-117-2 name=__codelineno-117-2 href=#__codelineno-117-2></a><span class=w>  </span><span class=nt>group_wait</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">30s</span>
<a id=__codelineno-117-3 name=__codelineno-117-3 href=#__codelineno-117-3></a><span class=w>  </span><span class=nt>group_interval</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5m</span>
<a id=__codelineno-117-4 name=__codelineno-117-4 href=#__codelineno-117-4></a><span class=w>  </span><span class=nt>repeat_interval</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10m</span>
<a id=__codelineno-117-5 name=__codelineno-117-5 href=#__codelineno-117-5></a><span class=w>  </span><span class=nt>receiver</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Default</span>
<a id=__codelineno-117-6 name=__codelineno-117-6 href=#__codelineno-117-6></a><span class=w>  </span><span class=s>&quot;group_by&quot;</span><span class="p p-Indicator">:</span>
<a id=__codelineno-117-7 name=__codelineno-117-7 href=#__codelineno-117-7></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;namespace&quot;</span>
<a id=__codelineno-117-8 name=__codelineno-117-8 href=#__codelineno-117-8></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;job&quot;</span>
<a id=__codelineno-117-9 name=__codelineno-117-9 href=#__codelineno-117-9></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;alertname&quot;</span>
<a id=__codelineno-117-10 name=__codelineno-117-10 href=#__codelineno-117-10></a><span class=w>  </span><span class=nt>routes</span><span class=p>:</span>
<a id=__codelineno-117-11 name=__codelineno-117-11 href=#__codelineno-117-11></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;match&quot;</span><span class="p p-Indicator">:</span>
<a id=__codelineno-117-12 name=__codelineno-117-12 href=#__codelineno-117-12></a><span class=w>    </span><span class=s>&quot;alertname&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class=s>&quot;Watchdog&quot;</span>
<a id=__codelineno-117-13 name=__codelineno-117-13 href=#__codelineno-117-13></a><span class=w>    </span><span class=s>&quot;receiver&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class=s>&quot;wechat-ops&quot;</span>
<a id=__codelineno-117-14 name=__codelineno-117-14 href=#__codelineno-117-14></a><span class=w>    </span><span class=s>&quot;repeat_interval&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class=s>&quot;10m&quot;</span>
</code></pre></div> <p>之后更新Alertmanager的配置：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-118-1 name=__codelineno-118-1 href=#__codelineno-118-1></a>$<span class=w> </span>kubectl<span class=w> </span>replace<span class=w> </span>-f<span class=w> </span>alertmanager-secret.yaml
<a id=__codelineno-118-2 name=__codelineno-118-2 href=#__codelineno-118-2></a>secret/alertmanager-main<span class=w> </span>replaced
</code></pre></div> <p>等待几分钟后，可以在Alertmanager Web UI看到新配置，并且企业微信可以收到Watchdog的告警，如图15.62所示。</p> <p><img alt class=zoom src=../../../assets/static/kubernetes/5/15-62.png> 图15.62　查看微信告警</p> <h3 id=85-自定义告警模板>8.5 自定义告警模板<a class=headerlink href=#85-自定义告警模板 title="Permanent link">&para;</a></h3> <p>上一小节使用企业微信进行了告警通知，相对于邮箱通知，企业微信的告警通知并不是很容易阅读，此时可以通过Alertmanager的模板功能配置一些自定义模板。</p> <p>首先修改alertmanager-secret.yaml添加自定义模板（注意wechat.tmpl和alertmanager.yaml需要对齐，模板的内容也是通过go-template编写的）：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-119-1 name=__codelineno-119-1 href=#__codelineno-119-1></a><span class=w>        </span><span class=nt>app.kubernetes.io/part-of</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kube-prometheus</span>
<a id=__codelineno-119-2 name=__codelineno-119-2 href=#__codelineno-119-2></a><span class=w>        </span><span class=nt>app.kubernetes.io/version</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">0.21.0</span>
<a id=__codelineno-119-3 name=__codelineno-119-3 href=#__codelineno-119-3></a><span class=w>     </span><span class="w w-Error"> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">alertmanager-main</span>
<a id=__codelineno-119-4 name=__codelineno-119-4 href=#__codelineno-119-4></a><span class=w>      </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">monitoring</span>
<a id=__codelineno-119-5 name=__codelineno-119-5 href=#__codelineno-119-5></a><span class=w>   </span><span class="w w-Error"> </span><span class=nt>stringData</span><span class=p>:</span>
<a id=__codelineno-119-6 name=__codelineno-119-6 href=#__codelineno-119-6></a><span class=w>      </span><span class=nt>wechat.tmpl</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|-</span>
<a id=__codelineno-119-7 name=__codelineno-119-7 href=#__codelineno-119-7></a><span class=w>        </span><span class=no>{{ define &quot;wechat.default.message&quot; }}</span>
<a id=__codelineno-119-8 name=__codelineno-119-8 href=#__codelineno-119-8></a><span class=w>        </span><span class=no>... </span>
<a id=__codelineno-119-9 name=__codelineno-119-9 href=#__codelineno-119-9></a><span class=w>        </span><span class=no>{{- end }}</span>
<a id=__codelineno-119-10 name=__codelineno-119-10 href=#__codelineno-119-10></a><span class=w>      </span><span class=nt>alertmanager.yaml</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|-</span>
<a id=__codelineno-119-11 name=__codelineno-119-11 href=#__codelineno-119-11></a><span class=w>        </span><span class=no>&quot;global&quot;:</span>
<a id=__codelineno-119-12 name=__codelineno-119-12 href=#__codelineno-119-12></a><span class=w>          </span><span class=no>&quot;resolve_timeout&quot;: &quot;5m&quot;</span>
</code></pre></div> <p>在templates字段添加模板位置：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-120-1 name=__codelineno-120-1 href=#__codelineno-120-1></a><span class=nt>templates</span><span class=p>:</span>
<a id=__codelineno-120-2 name=__codelineno-120-2 href=#__codelineno-120-2></a><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&#39;/etc/alertmanager/config/*.tmpl&#39;</span>
<a id=__codelineno-120-3 name=__codelineno-120-3 href=#__codelineno-120-3></a><span class=s>&quot;inhibit_rules&quot;</span><span class="p p-Indicator">:</span>
</code></pre></div> <p>配置wechat-ops receiver使用该模板：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-121-1 name=__codelineno-121-1 href=#__codelineno-121-1></a><span class=w>    </span><span class=s>&quot;receivers&quot;</span><span class="p p-Indicator">:</span>
<a id=__codelineno-121-2 name=__codelineno-121-2 href=#__codelineno-121-2></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;name&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">wechat-ops</span>
<a id=__codelineno-121-3 name=__codelineno-121-3 href=#__codelineno-121-3></a><span class=w>      </span><span class=nt>wechat_configs</span><span class=p>:</span>
<a id=__codelineno-121-4 name=__codelineno-121-4 href=#__codelineno-121-4></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>send_resolved</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id=__codelineno-121-5 name=__codelineno-121-5 href=#__codelineno-121-5></a><span class=w>        </span><span class=nt>to_party</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<a id=__codelineno-121-6 name=__codelineno-121-6 href=#__codelineno-121-6></a><span class=w>        </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<a id=__codelineno-121-7 name=__codelineno-121-7 href=#__codelineno-121-7></a><span class=w>        </span><span class=nt>message</span><span class=p>:</span><span class=w> </span><span class=s>&#39;{{</span><span class=nv> </span><span class=s>template</span><span class=nv> </span><span class=s>&quot;wechat.default.message&quot;</span><span class=nv> </span><span class=s>.</span><span class=nv> </span><span class=s>}}&#39;</span>
</code></pre></div> <hr> <div class="admonition warning"> <p class=admonition-title>注意</p> <p>{{ template "wechat.default.message" . }} 配 置 的wechat.default.message 是 模 板 文 件 define 定 义 的 名 称 ： {{ define "wechat.default.message" }}，并非文件名称。</p> </div> <p>将配置更新至Alertmanager：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-122-1 name=__codelineno-122-1 href=#__codelineno-122-1></a>$<span class=w> </span>kubectl<span class=w> </span>replace<span class=w> </span>-f<span class=w> </span>alertmanager-secret.yaml
<a id=__codelineno-122-2 name=__codelineno-122-2 href=#__codelineno-122-2></a>secret/alertmanager-main<span class=w> </span>replaced
</code></pre></div> <p>更新完成后，可以在Secret中查看该配置：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-123-1 name=__codelineno-123-1 href=#__codelineno-123-1></a>$<span class=w> </span>kubectl<span class=w> </span>describe<span class=w> </span>secrets<span class=w> </span>alertmanager-main<span class=w> </span>-n<span class=w> </span>monitoring
<a id=__codelineno-123-2 name=__codelineno-123-2 href=#__codelineno-123-2></a>Name:<span class=w>         </span>alertmanager-main
<a id=__codelineno-123-3 name=__codelineno-123-3 href=#__codelineno-123-3></a>Namespace:<span class=w>    </span>monitoring
<a id=__codelineno-123-4 name=__codelineno-123-4 href=#__codelineno-123-4></a>Labels:<span class=w>       </span><span class=nv>alertmanager</span><span class=o>=</span>main
<a id=__codelineno-123-5 name=__codelineno-123-5 href=#__codelineno-123-5></a><span class=w>              </span>app.kubernetes.io/component<span class=o>=</span>alert-router
<a id=__codelineno-123-6 name=__codelineno-123-6 href=#__codelineno-123-6></a><span class=w>              </span>app.kubernetes.io/name<span class=o>=</span>alertmanager
<a id=__codelineno-123-7 name=__codelineno-123-7 href=#__codelineno-123-7></a><span class=w>              </span>app.kubernetes.io/part-of<span class=o>=</span>kube-prometheus
<a id=__codelineno-123-8 name=__codelineno-123-8 href=#__codelineno-123-8></a><span class=w>              </span>app.kubernetes.io/version<span class=o>=</span><span class=m>0</span>.22.2
<a id=__codelineno-123-9 name=__codelineno-123-9 href=#__codelineno-123-9></a>Annotations:<span class=w>  </span>&lt;none&gt;
<a id=__codelineno-123-10 name=__codelineno-123-10 href=#__codelineno-123-10></a>
<a id=__codelineno-123-11 name=__codelineno-123-11 href=#__codelineno-123-11></a>Type:<span class=w>  </span>Opaque
<a id=__codelineno-123-12 name=__codelineno-123-12 href=#__codelineno-123-12></a>
<a id=__codelineno-123-13 name=__codelineno-123-13 href=#__codelineno-123-13></a><span class=nv>Data</span>
<a id=__codelineno-123-14 name=__codelineno-123-14 href=#__codelineno-123-14></a><span class=o>====</span>
<a id=__codelineno-123-15 name=__codelineno-123-15 href=#__codelineno-123-15></a>alertmanager.yaml:<span class=w>  </span><span class=m>1438</span><span class=w> </span>bytes
<a id=__codelineno-123-16 name=__codelineno-123-16 href=#__codelineno-123-16></a>wechat.tmpl:<span class=w>     </span><span class=m>1823</span><span class=w> </span>bytes
</code></pre></div> <p>之后再次收到告警，即为自定义告警模板，如图15.63所示。</p> <p><img alt class=zoom src=../../../assets/static/kubernetes/5/15-63.png></p> <p>图15.63　查看微信告警</p> <hr> <div class="admonition tip"> <p class=admonition-title>提示</p> <p>新版的kube-prometheus提供了Alertmanager 配置的自定义资源AlertmanagerConfig，上述配置均可以通过AlertmanagerConfig进行配 置，但是由于AlertmanagerConfig还不够成熟，并且并不是所有的公司都将Prometheus技术栈部署至Kubernetes，</p> <p>因此本书还是以传统的配置文件进行讲解， 有兴趣的读者可以参考 <a href=https://github.com/prometheus-operator/prometheus-operator/blob/master/Documentation/design.md#alertmanagerconfig>https://github.com/prometheus-operator/prometheus-operator/blob/master/Documentation/design.md#alertmanagerconfig</a> 进行学习。</p> </div> <h2 id=9prometheus告警实战>9.Prometheus告警实战<a class=headerlink href=#9prometheus告警实战 title="Permanent link">&para;</a></h2> <p>前面的章节基本上对Prometheus和Alertmanager常用的配置进行了全面的学习，并且学习了PromQL语法，实现了常用媒介的告警通知。接下来我们介绍如何使用PromQL自定义告警策略。</p> <h3 id=91-prometheusrule>9.1 PrometheusRule<a class=headerlink href=#91-prometheusrule title="Permanent link">&para;</a></h3> <p>在安装Prometheus后，默认配置了很多告警策略，那么这些告警配置是如何加载到Prometheus的呢？</p> <p>在传统架构中，通过直接修改Prometheus的配置文件即可加载相应的告警策略，但是在Prometheus Operator中，无须再直接修改Prometheus的配置，通过自定义的资源PrometheusRule即可配置告警策略。可以通过如下命令查看默认配置的告警策略：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-124-1 name=__codelineno-124-1 href=#__codelineno-124-1></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>prometheusrule<span class=w> </span>-n<span class=w> </span>monitoring
<a id=__codelineno-124-2 name=__codelineno-124-2 href=#__codelineno-124-2></a>NAME<span class=w>                              </span>AGE
<a id=__codelineno-124-3 name=__codelineno-124-3 href=#__codelineno-124-3></a>alertmanager-main-rules<span class=w>           </span>44h
<a id=__codelineno-124-4 name=__codelineno-124-4 href=#__codelineno-124-4></a>kube-prometheus-rules<span class=w>             </span>44h
<a id=__codelineno-124-5 name=__codelineno-124-5 href=#__codelineno-124-5></a>kube-state-metrics-rules<span class=w>          </span>44h
<a id=__codelineno-124-6 name=__codelineno-124-6 href=#__codelineno-124-6></a>kubernetes-monitoring-rules<span class=w>       </span>44h
<a id=__codelineno-124-7 name=__codelineno-124-7 href=#__codelineno-124-7></a>node-exporter-rules<span class=w>               </span>44h
<a id=__codelineno-124-8 name=__codelineno-124-8 href=#__codelineno-124-8></a>prometheus-k8s-prometheus-rules<span class=w>   </span>44h
<a id=__codelineno-124-9 name=__codelineno-124-9 href=#__codelineno-124-9></a>prometheus-operator-rules<span class=w>         </span>44h
</code></pre></div> <p>也可以通过-oyaml查看某个rules的详细配置：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-125-1 name=__codelineno-125-1 href=#__codelineno-125-1></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>prometheusrule<span class=w> </span>node-exporter-rules<span class=w> </span>-n<span class=w> </span>monitoring<span class=w> </span>-o<span class=w> </span>yaml
<a id=__codelineno-125-2 name=__codelineno-125-2 href=#__codelineno-125-2></a>apiVersion:<span class=w> </span>monitoring.coreos.com/v1
<a id=__codelineno-125-3 name=__codelineno-125-3 href=#__codelineno-125-3></a>kind:<span class=w> </span>PrometheusRule
<a id=__codelineno-125-4 name=__codelineno-125-4 href=#__codelineno-125-4></a>....<span class=w>    </span>
<a id=__codelineno-125-5 name=__codelineno-125-5 href=#__codelineno-125-5></a>spec:
<a id=__codelineno-125-6 name=__codelineno-125-6 href=#__codelineno-125-6></a><span class=w>  </span>groups:
<a id=__codelineno-125-7 name=__codelineno-125-7 href=#__codelineno-125-7></a><span class=w>  </span>-<span class=w> </span>name:<span class=w> </span>node-exporter
<a id=__codelineno-125-8 name=__codelineno-125-8 href=#__codelineno-125-8></a><span class=w>    </span>rules:
<a id=__codelineno-125-9 name=__codelineno-125-9 href=#__codelineno-125-9></a><span class=w>    </span>-<span class=w> </span>alert:<span class=w> </span>NodeFilesystemSpaceFillingUp
<a id=__codelineno-125-10 name=__codelineno-125-10 href=#__codelineno-125-10></a><span class=w>      </span>annotations:
<a id=__codelineno-125-11 name=__codelineno-125-11 href=#__codelineno-125-11></a><span class=w>        </span>description:<span class=w> </span>Filesystem<span class=w> </span>on<span class=w> </span><span class=o>{{</span><span class=w> </span><span class=nv>$labels</span>.device<span class=w> </span><span class=o>}}</span><span class=w> </span>at<span class=w> </span><span class=o>{{</span><span class=w> </span><span class=nv>$labels</span>.instance<span class=w> </span><span class=o>}}</span>
<a id=__codelineno-125-12 name=__codelineno-125-12 href=#__codelineno-125-12></a><span class=w>          </span>has<span class=w> </span>only<span class=w> </span><span class=o>{{</span><span class=w> </span><span class=nb>printf</span><span class=w> </span><span class=s2>&quot;%.2f&quot;</span><span class=w> </span><span class=nv>$value</span><span class=w> </span><span class=o>}}</span>%<span class=w> </span>available<span class=w> </span>space<span class=w> </span>left<span class=w> </span>and<span class=w> </span>is<span class=w> </span>filling
<a id=__codelineno-125-13 name=__codelineno-125-13 href=#__codelineno-125-13></a><span class=w>          </span>up.
<a id=__codelineno-125-14 name=__codelineno-125-14 href=#__codelineno-125-14></a><span class=w>        </span>runbook_url:<span class=w> </span>https://runbooks.prometheus-operator.dev/runbooks/node/nodefilesystemspacefillingup
<a id=__codelineno-125-15 name=__codelineno-125-15 href=#__codelineno-125-15></a><span class=w>        </span>summary:<span class=w> </span>Filesystem<span class=w> </span>is<span class=w> </span>predicted<span class=w> </span>to<span class=w> </span>run<span class=w> </span>out<span class=w> </span>of<span class=w> </span>space<span class=w> </span>within<span class=w> </span>the<span class=w> </span>next<span class=w> </span><span class=m>24</span><span class=w> </span>hours.
<a id=__codelineno-125-16 name=__codelineno-125-16 href=#__codelineno-125-16></a><span class=w>      </span>expr:<span class=w> </span><span class=p>|</span>
<a id=__codelineno-125-17 name=__codelineno-125-17 href=#__codelineno-125-17></a><span class=w>        </span><span class=o>(</span>
<a id=__codelineno-125-18 name=__codelineno-125-18 href=#__codelineno-125-18></a><span class=w>          </span>node_filesystem_avail_bytes<span class=o>{</span><span class=nv>job</span><span class=o>=</span><span class=s2>&quot;node-exporter&quot;</span>,fstype!<span class=o>=</span><span class=s2>&quot;&quot;</span><span class=o>}</span><span class=w> </span>/<span class=w> </span>node_filesystem_size_bytes<span class=o>{</span><span class=nv>job</span><span class=o>=</span><span class=s2>&quot;node-exporter&quot;</span>,fstype!<span class=o>=</span><span class=s2>&quot;&quot;</span><span class=o>}</span><span class=w> </span>*<span class=w> </span><span class=m>100</span><span class=w> </span>&lt;<span class=w> </span><span class=m>40</span>
<a id=__codelineno-125-19 name=__codelineno-125-19 href=#__codelineno-125-19></a><span class=w>        </span>and
<a id=__codelineno-125-20 name=__codelineno-125-20 href=#__codelineno-125-20></a><span class=w>          </span>predict_linear<span class=o>(</span>node_filesystem_avail_bytes<span class=o>{</span><span class=nv>job</span><span class=o>=</span><span class=s2>&quot;node-exporter&quot;</span>,fstype!<span class=o>=</span><span class=s2>&quot;&quot;</span><span class=o>}[</span>6h<span class=o>]</span>,<span class=w> </span><span class=m>24</span>*60*60<span class=o>)</span><span class=w> </span>&lt;<span class=w> </span><span class=m>0</span>
<a id=__codelineno-125-21 name=__codelineno-125-21 href=#__codelineno-125-21></a><span class=w>        </span>and
<a id=__codelineno-125-22 name=__codelineno-125-22 href=#__codelineno-125-22></a><span class=w>          </span>node_filesystem_readonly<span class=o>{</span><span class=nv>job</span><span class=o>=</span><span class=s2>&quot;node-exporter&quot;</span>,fstype!<span class=o>=</span><span class=s2>&quot;&quot;</span><span class=o>}</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-125-23 name=__codelineno-125-23 href=#__codelineno-125-23></a><span class=w>        </span><span class=o>)</span>
<a id=__codelineno-125-24 name=__codelineno-125-24 href=#__codelineno-125-24></a><span class=w>      </span><span class=k>for</span>:<span class=w> </span>1h
<a id=__codelineno-125-25 name=__codelineno-125-25 href=#__codelineno-125-25></a><span class=w>      </span>labels:
<a id=__codelineno-125-26 name=__codelineno-125-26 href=#__codelineno-125-26></a><span class=w>        </span>severity:<span class=w> </span>warning
</code></pre></div> <p>groups下的配置即为告警策略,如果读者学习过传统配置的Prometheus，其实可以看出并无区别，只是Operator是通过kind为 PrometheusRule进行单独管理的。</p> <p>接下来进行每个配置的解析。</p> <ul> <li>alert：告警策略的名称。</li> <li>annotations：告警注释信息，一般写为告警信息。</li> <li>expr：告警表达式。</li> <li>for：评估等待时间，告警持续多久才会发送告警数据。</li> <li>labels：告警的标签，用于告警的路由。</li> </ul> <p>了解了PrometheusRule写法规则后，可以自定义一个告警策略。</p> <p>实际使用时可以按照监控的目标划分PrometheusRule，比如之前配置了黑盒监控，那么可以创建一个名为blackbox的PrometheusRule。</p> <h3 id=92-告警通用配置步骤>9.2 告警通用配置步骤<a class=headerlink href=#92-告警通用配置步骤 title="Permanent link">&para;</a></h3> <p>假设需要对域名访问延迟进行监控，访问延迟大于1秒进行告警（生产环境可以按需调节，为了实现告警测试，可以将该值设置得小一些），此时可以创建一个PrometheusRule，代码如下：</p> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title=最后更新> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1-2.1-2M12.5 7v5.2l4 2.4-1 1L11 13V7h1.5M11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2v1.8Z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime">March 27, 2023 17:02:02</span> </span> <span class=md-source-file__fact> <span class=md-icon title=创建日期> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3h-2Z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime">March 23, 2023 18:59:28</span> </span> </aside> <form class=md-feedback name=feedback hidden> <fieldset> <legend class=md-feedback__title> Was this page helpful? </legend> <div class=md-feedback__inner> <div class=md-feedback__list> <button class="md-feedback__icon md-icon" type=submit title="This page was helpful" data-md-value=1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m7 0c0 .8-.7 1.5-1.5 1.5S14 10.3 14 9.5 14.7 8 15.5 8s1.5.7 1.5 1.5m-5 7.73c-1.75 0-3.29-.73-4.19-1.81L9.23 14c.45.72 1.52 1.23 2.77 1.23s2.32-.51 2.77-1.23l1.42 1.42c-.9 1.08-2.44 1.81-4.19 1.81Z"/></svg> </button> <button class="md-feedback__icon md-icon" type=submit title="This page could be improved" data-md-value=0> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10m-6.5-4c.8 0 1.5.7 1.5 1.5s-.7 1.5-1.5 1.5-1.5-.7-1.5-1.5.7-1.5 1.5-1.5M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m2 4.5c1.75 0 3.29.72 4.19 1.81l-1.42 1.42C14.32 16.5 13.25 16 12 16s-2.32.5-2.77 1.23l-1.42-1.42C8.71 14.72 10.25 14 12 14Z"/></svg> </button> </div> <div class=md-feedback__note> <div data-md-value=1 hidden> Thanks for your feedback! </div> <div data-md-value=0 hidden> Thanks for your feedback! Help us improve this page by using our <a href="https://github.com/hujianli94/hujianli94.github.io/issues/new/?title=[Feedback]+Kubernetes%E7%9B%91%E6%8E%A7%E5%91%8A%E8%AD%A6+-+/Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/15.Kubernetes%E7%9B%91%E6%8E%A7%E5%91%8A%E8%AD%A6/" target=_blank>feedback form</a>. </div> </div> </div> </fieldset> </form> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> 回到页面顶部 </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=页脚> <a href=../14.Kubernetes%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/ class="md-footer__link md-footer__link--prev" aria-label="上一页: Kubernetes日志收集"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> 上一页 </span> <div class=md-ellipsis> Kubernetes日志收集 </div> </div> </a> <a href=../16.%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83Ingress%E8%BF%9B%E9%98%B6/ class="md-footer__link md-footer__link--next" aria-label="下一页: 服务发布Ingress进阶"> <div class=md-footer__title> <span class=md-footer__direction> 下一页 </span> <div class=md-ellipsis> 服务发布Ingress进阶 </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2023 - 2024 hujainli94 </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/hujianli94 target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> <a href=https://kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com/blog_img/20220125122524.png target=_blank rel=noopener title=kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 576 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M385.2 167.6c6.4 0 12.6.3 18.8 1.1C387.4 90.3 303.3 32 207.7 32 100.5 32 13 104.8 13 197.4c0 53.4 29.3 97.5 77.9 131.6l-19.3 58.6 68-34.1c24.4 4.8 43.8 9.7 68.2 9.7 6.2 0 12.1-.3 18.3-.8-4-12.9-6.2-26.6-6.2-40.8-.1-84.9 72.9-154 165.3-154zm-104.5-52.9c14.5 0 24.2 9.7 24.2 24.4 0 14.5-9.7 24.2-24.2 24.2-14.8 0-29.3-9.7-29.3-24.2.1-14.7 14.6-24.4 29.3-24.4zm-136.4 48.6c-14.5 0-29.3-9.7-29.3-24.2 0-14.8 14.8-24.4 29.3-24.4 14.8 0 24.4 9.7 24.4 24.4 0 14.6-9.6 24.2-24.4 24.2zM563 319.4c0-77.9-77.9-141.3-165.4-141.3-92.7 0-165.4 63.4-165.4 141.3S305 460.7 397.6 460.7c19.3 0 38.9-5.1 58.6-9.9l53.4 29.3-14.8-48.6C534 402.1 563 363.2 563 319.4zm-219.1-24.5c-9.7 0-19.3-9.7-19.3-19.6 0-9.7 9.7-19.3 19.3-19.3 14.8 0 24.4 9.7 24.4 19.3 0 10-9.7 19.6-24.4 19.6zm107.1 0c-9.7 0-19.3-9.7-19.3-19.6 0-9.7 9.7-19.3 19.3-19.3 14.5 0 24.4 9.7 24.4 19.3.1 10-9.9 19.6-24.4 19.6z"/></svg> </a> <a href="mailto:<1879324764@qq.com>" target=_blank rel=noopener title=发送邮件 class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M498.1 5.6c10.1 7 15.4 19.1 13.5 31.2l-64 416c-1.5 9.7-7.4 18.2-16 23s-18.9 5.4-28 1.6L284 427.7l-68.5 74.1c-8.9 9.7-22.9 12.9-35.2 8.1S160 493.2 160 480v-83.6c0-4 1.5-7.8 4.2-10.7l167.6-182.9c5.8-6.3 5.6-16-.4-22s-15.7-6.4-22-.7L106 360.8l-88.3-44.2C7.1 311.3.3 300.7 0 288.9s5.9-22.8 16.1-28.7l448-256c10.7-6.1 23.9-5.5 34 1.4z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-consent data-md-component=consent id=__consent hidden> <div class=md-consent__overlay></div> <aside class=md-consent__inner> <form class="md-consent__form md-grid md-typeset" name=consent> <h4>Cookie consent</h4> <p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p> <input class=md-toggle type=checkbox id=__settings> <div class=md-consent__settings> <ul class=task-list> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=analytics checked> <span class=task-list-indicator></span> Google Analytics </label> </li> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=github checked> <span class=task-list-indicator></span> GitHub </label> </li> </ul> </div> <div class=md-consent__controls> <button class="md-button md-button--primary">同意</button> <label class=md-button for=__settings>管理设定</label> </div> </form> </aside> </div> <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout(function(){document.querySelector("[data-md-component=consent]").hidden=!1},250);var action,form=document.forms.consent;for(action of["submit","reset"])form.addEventListener(action,function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map(function(e){return[e,!0]}))),location.hash="",location.reload()})</script> <script id=__config type=application/json>{"base": "../../..", "features": ["content.action.edit", "content.action.view", "content.code.copy", "content.code.annotate", "navigation.indexes", "navigation.footer", "navigation.indexes", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest"], "search": "../../../assets/javascripts/workers/search.c011b7c0.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script> <script src=../../../assets/javascripts/bundle.7389ff0e.min.js></script> <script src=../../../javascripts/extra.js></script> <script src=https://file.cdn.shafish.cn/blog/js/video.min.js></script> </body> </html>