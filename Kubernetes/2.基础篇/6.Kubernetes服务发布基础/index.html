<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="stay hungry,stay foolish"><meta name=author content=hujainli94><link href=https://hujianli94.github.io/Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/6.Kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83%E5%9F%BA%E7%A1%80/ rel=canonical><link href=../5.Kubernetes%E8%B0%83%E5%BA%A6%E5%9F%BA%E7%A1%80/ rel=prev><link href=../7.Kubernetes%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/ rel=next><link rel=icon href=../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.4.2, mkdocs-material-9.1.4"><title>Kubernetes服务发布基础 - DevOps运维开发手记</title><link rel=stylesheet href=../../../assets/stylesheets/main.240905d7.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.a0c5b2b5.min.css><style>:root{--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M1 7.775V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 0 1 0 2.474l-5.026 5.026a1.75 1.75 0 0 1-2.474 0l-6.25-6.25A1.752 1.752 0 0 1 1 7.775Zm1.5 0c0 .066.026.13.073.177l6.25 6.25a.25.25 0 0 0 .354 0l5.025-5.025a.25.25 0 0 0 0-.354l-6.25-6.25a.25.25 0 0 0-.177-.073H2.75a.25.25 0 0 0-.25.25ZM6 5a1 1 0 1 1 0 2 1 1 0 0 1 0-2Z"/></svg>');--md-admonition-icon--abstract:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M2.5 1.75v11.5c0 .138.112.25.25.25h3.17a.75.75 0 0 1 0 1.5H2.75A1.75 1.75 0 0 1 1 13.25V1.75C1 .784 1.784 0 2.75 0h8.5C12.216 0 13 .784 13 1.75v7.736a.75.75 0 0 1-1.5 0V1.75a.25.25 0 0 0-.25-.25h-8.5a.25.25 0 0 0-.25.25Zm13.274 9.537v-.001l-4.557 4.45a.75.75 0 0 1-1.055-.008l-1.943-1.95a.75.75 0 0 1 1.062-1.058l1.419 1.425 4.026-3.932a.75.75 0 1 1 1.048 1.074ZM4.75 4h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM4 7.75A.75.75 0 0 1 4.75 7h2a.75.75 0 0 1 0 1.5h-2A.75.75 0 0 1 4 7.75Z"/></svg>');--md-admonition-icon--info:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"/></svg>');--md-admonition-icon--tip:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M3.499.75a.75.75 0 0 1 1.5 0v.996C5.9 2.903 6.793 3.65 7.662 4.376l.24.202c-.036-.694.055-1.422.426-2.163C9.1.873 10.794-.045 12.622.26 14.408.558 16 1.94 16 4.25c0 1.278-.954 2.575-2.44 2.734l.146.508.065.22c.203.701.412 1.455.476 2.226.142 1.707-.4 3.03-1.487 3.898C11.714 14.671 10.27 15 8.75 15h-6a.75.75 0 0 1 0-1.5h1.376a4.484 4.484 0 0 1-.563-1.191 3.835 3.835 0 0 1-.05-2.063 4.647 4.647 0 0 1-2.025-.293.75.75 0 0 1 .525-1.406c1.357.507 2.376-.006 2.698-.318l.009-.01a.747.747 0 0 1 1.06 0 .748.748 0 0 1-.012 1.074c-.912.92-.992 1.835-.768 2.586.221.74.745 1.337 1.196 1.621H8.75c1.343 0 2.398-.296 3.074-.836.635-.507 1.036-1.31.928-2.602-.05-.603-.216-1.224-.422-1.93l-.064-.221c-.12-.407-.246-.84-.353-1.29a2.425 2.425 0 0 1-.507-.441 3.075 3.075 0 0 1-.633-1.248.75.75 0 0 1 1.455-.364c.046.185.144.436.31.627.146.168.353.305.712.305.738 0 1.25-.615 1.25-1.25 0-1.47-.95-2.315-2.123-2.51-1.172-.196-2.227.387-2.706 1.345-.46.92-.27 1.774.019 3.062l.042.19a.884.884 0 0 1 .01.05c.348.443.666.949.94 1.553a.75.75 0 1 1-1.365.62c-.553-1.217-1.32-1.94-2.3-2.768L6.7 5.527c-.814-.68-1.75-1.462-2.692-2.619a3.737 3.737 0 0 0-1.023.88c-.406.495-.663 1.036-.722 1.508.116.122.306.21.591.239.388.038.797-.06 1.032-.19a.75.75 0 0 1 .728 1.31c-.515.287-1.23.439-1.906.373-.682-.067-1.473-.38-1.879-1.193L.75 5.677V5.5c0-.984.48-1.94 1.077-2.664.46-.559 1.05-1.055 1.673-1.353V.75Z"/></svg>');--md-admonition-icon--success:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"/></svg>');--md-admonition-icon--question:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.92 6.085h.001a.749.749 0 1 1-1.342-.67c.169-.339.436-.701.849-.977C6.845 4.16 7.369 4 8 4a2.756 2.756 0 0 1 1.637.525c.503.377.863.965.863 1.725 0 .448-.115.83-.329 1.15-.205.307-.47.513-.692.662-.109.072-.22.138-.313.195l-.006.004a6.24 6.24 0 0 0-.26.16.952.952 0 0 0-.276.245.75.75 0 0 1-1.248-.832c.184-.264.42-.489.692-.661.103-.067.207-.132.313-.195l.007-.004c.1-.061.182-.11.258-.161a.969.969 0 0 0 .277-.245C8.96 6.514 9 6.427 9 6.25a.612.612 0 0 0-.262-.525A1.27 1.27 0 0 0 8 5.5c-.369 0-.595.09-.74.187a1.01 1.01 0 0 0-.34.398ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"/></svg>');--md-admonition-icon--warning:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"/></svg>');--md-admonition-icon--failure:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M2.344 2.343h-.001a8 8 0 0 1 11.314 11.314A8.002 8.002 0 0 1 .234 10.089a8 8 0 0 1 2.11-7.746Zm1.06 10.253a6.5 6.5 0 1 0 9.108-9.275 6.5 6.5 0 0 0-9.108 9.275ZM6.03 4.97 8 6.94l1.97-1.97a.749.749 0 0 1 1.275.326.749.749 0 0 1-.215.734L9.06 8l1.97 1.97a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215L8 9.06l-1.97 1.97a.749.749 0 0 1-1.275-.326.749.749 0 0 1 .215-.734L6.94 8 4.97 6.03a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018Z"/></svg>');--md-admonition-icon--danger:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M9.504.43a1.516 1.516 0 0 1 2.437 1.713L10.415 5.5h2.123c1.57 0 2.346 1.909 1.22 3.004l-7.34 7.142a1.249 1.249 0 0 1-.871.354h-.302a1.25 1.25 0 0 1-1.157-1.723L5.633 10.5H3.462c-1.57 0-2.346-1.909-1.22-3.004L9.503.429Zm1.047 1.074L3.286 8.571A.25.25 0 0 0 3.462 9H6.75a.75.75 0 0 1 .694 1.034l-1.713 4.188 6.982-6.793A.25.25 0 0 0 12.538 7H9.25a.75.75 0 0 1-.683-1.06l2.008-4.418.003-.006a.036.036 0 0 0-.004-.009l-.006-.006-.008-.001c-.003 0-.006.002-.009.004Z"/></svg>');--md-admonition-icon--bug:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M4.72.22a.75.75 0 0 1 1.06 0l1 .999a3.488 3.488 0 0 1 2.441 0l.999-1a.748.748 0 0 1 1.265.332.75.75 0 0 1-.205.729l-.775.776c.616.63.995 1.493.995 2.444v.327c0 .1-.009.197-.025.292.408.14.764.392 1.029.722l1.968-.787a.75.75 0 0 1 .556 1.392L13 7.258V9h2.25a.75.75 0 0 1 0 1.5H13v.5c0 .409-.049.806-.141 1.186l2.17.868a.75.75 0 0 1-.557 1.392l-2.184-.873A4.997 4.997 0 0 1 8 16a4.997 4.997 0 0 1-4.288-2.427l-2.183.873a.75.75 0 0 1-.558-1.392l2.17-.868A5.036 5.036 0 0 1 3 11v-.5H.75a.75.75 0 0 1 0-1.5H3V7.258L.971 6.446a.75.75 0 0 1 .558-1.392l1.967.787c.265-.33.62-.583 1.03-.722a1.677 1.677 0 0 1-.026-.292V4.5c0-.951.38-1.814.995-2.444L4.72 1.28a.75.75 0 0 1 0-1.06Zm.53 6.28a.75.75 0 0 0-.75.75V11a3.5 3.5 0 1 0 7 0V7.25a.75.75 0 0 0-.75-.75ZM6.173 5h3.654A.172.172 0 0 0 10 4.827V4.5a2 2 0 1 0-4 0v.327c0 .096.077.173.173.173Z"/></svg>');--md-admonition-icon--example:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M5 5.782V2.5h-.25a.75.75 0 0 1 0-1.5h6.5a.75.75 0 0 1 0 1.5H11v3.282l3.666 5.76C15.619 13.04 14.543 15 12.767 15H3.233c-1.776 0-2.852-1.96-1.899-3.458Zm-2.4 6.565a.75.75 0 0 0 .633 1.153h9.534a.75.75 0 0 0 .633-1.153L12.225 10.5h-8.45ZM9.5 2.5h-3V6c0 .143-.04.283-.117.403L4.73 9h6.54L9.617 6.403A.746.746 0 0 1 9.5 6Z"/></svg>');--md-admonition-icon--quote:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M1.75 2.5h10.5a.75.75 0 0 1 0 1.5H1.75a.75.75 0 0 1 0-1.5Zm4 5h8.5a.75.75 0 0 1 0 1.5h-8.5a.75.75 0 0 1 0-1.5Zm0 5h8.5a.75.75 0 0 1 0 1.5h-8.5a.75.75 0 0 1 0-1.5ZM2.5 7.75v6a.75.75 0 0 1-1.5 0v-6a.75.75 0 0 1 1.5 0Z"/></svg>');}</style><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../stylesheets/extra.css><link rel=stylesheet href=https://file.cdn.shafish.cn/blog/css/vssue.css><link rel=stylesheet href=https://file.cdn.shafish.cn/blog/css/video-js.min.css><link rel=stylesheet href=https://file.cdn.shafish.cn/blog/css/video.css><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script>var consent;"undefined"==typeof __md_analytics||(consent=__md_get("__consent"))&&consent.analytics&&__md_analytics()</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#kubernetes服务发布基础 class=md-skip> 跳转至 </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=页眉> <a href=../../.. title=DevOps运维开发手记 class="md-header__button md-logo" aria-label=DevOps运维开发手记 data-md-component=logo> <img src=../../../assets/images/logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> DevOps运维开发手记 </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Kubernetes服务发布基础 </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label=切换至深色模式 type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title=切换至深色模式 for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=blue data-md-color-accent=blue aria-label=切换至浅色模式 type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title=切换至浅色模式 for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=查找> <a href=javascript:void(0) class="md-search__icon md-icon" title=分享 aria-label=分享 data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=清空当前内容 aria-label=清空当前内容 tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> 正在初始化搜索引擎 </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/hujianli94/hujianli94.github.io title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> hujianli94.github.io </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=标签 data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> 首页 </a> </li> <li class=md-tabs__item> <a href=../../0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Kubernetes/ class="md-tabs__link md-tabs__link--active"> Kubernetes </a> </li> <li class=md-tabs__item> <a href=../../../Docker/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Docker/ class=md-tabs__link> Docker </a> </li> <li class=md-tabs__item> <a href=../../../Python/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Pythjon-auto-ops/ class=md-tabs__link> Python </a> </li> <li class=md-tabs__item> <a href=../../../Python-vs-Go/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/1.Python-vs-Go/ class=md-tabs__link> Python-vs-Go </a> </li> <li class=md-tabs__item> <a href=../../../Linux/system/Linux%E5%86%85%E6%A0%B8%E5%BC%95%E5%AF%BC%E8%AF%A6%E8%A7%A3/ class=md-tabs__link> Linux </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=导航栏 data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title=DevOps运维开发手记 class="md-nav__button md-logo" aria-label=DevOps运维开发手记 data-md-component=logo> <img src=../../../assets/images/logo.png alt=logo> </a> DevOps运维开发手记 </label> <div class=md-nav__source> <a href=https://github.com/hujianli94/hujianli94.github.io title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> hujianli94.github.io </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> 首页 </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2 checked> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> Kubernetes <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=true> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_1> <label class=md-nav__link for=__nav_2_1 id=__nav_2_1_label tabindex=0> 0.学习线路 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_1_label aria-expanded=false> <label class=md-nav__title for=__nav_2_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Kubernetes/ class=md-nav__link> Kubernetes </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2> <label class=md-nav__link for=__nav_2_2 id=__nav_2_2_label tabindex=0> 1.安装篇 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2> <span class="md-nav__icon md-icon"></span> 1.安装篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../1.%E5%AE%89%E8%A3%85%E7%AF%87/1.Kubeadm%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/ class=md-nav__link> Kubeadm安装高可用集群 </a> </li> <li class=md-nav__item> <a href=../../1.%E5%AE%89%E8%A3%85%E7%AF%87/2.%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/ class=md-nav__link> 二进制安装高可用K8s集群 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_3 checked> <label class=md-nav__link for=__nav_2_3 id=__nav_2_3_label tabindex=0> 2.基础篇 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_3_label aria-expanded=true> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> 2.基础篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../3.Docker%E5%9F%BA%E7%A1%80/ class=md-nav__link> Docker基础 </a> </li> <li class=md-nav__item> <a href=../4.Kubernetes%E7%9A%84%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/ class=md-nav__link> Kubernetes的基础概念 </a> </li> <li class=md-nav__item> <a href=../5.Kubernetes%E8%B0%83%E5%BA%A6%E5%9F%BA%E7%A1%80/ class=md-nav__link> Kubernetes调度基础 </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Kubernetes服务发布基础 <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Kubernetes服务发布基础 </a> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#1标签和选择器 class=md-nav__link> 1.标签和选择器 </a> <nav class=md-nav aria-label=1.标签和选择器> <ul class=md-nav__list> <li class=md-nav__item> <a href=#11-定义标签 class=md-nav__link> 1.1 定义标签 </a> </li> <li class=md-nav__item> <a href=#12-选择器 class=md-nav__link> 1.2 选择器 </a> </li> <li class=md-nav__item> <a href=#13-修改标签 class=md-nav__link> 1.3 修改标签 </a> </li> <li class=md-nav__item> <a href=#14-删除标签 class=md-nav__link> 1.4 删除标签 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2service class=md-nav__link> 2.Service </a> <nav class=md-nav aria-label=2.Service> <ul class=md-nav__list> <li class=md-nav__item> <a href=#21-service的基本概念 class=md-nav__link> 2.1 Service的基本概念 </a> </li> <li class=md-nav__item> <a href=#22-定义service class=md-nav__link> 2.2 定义Service </a> </li> <li class=md-nav__item> <a href=#23-无选择器的service和endpoint class=md-nav__link> 2.3 无选择器的Service和Endpoint </a> </li> <li class=md-nav__item> <a href=#24-externalname-service class=md-nav__link> 2.4 ExternalName Service </a> </li> <li class=md-nav__item> <a href=#25-service代理模式 class=md-nav__link> 2.5 Service代理模式 </a> <nav class=md-nav aria-label="2.5 Service代理模式"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#251-iptables代理模式 class=md-nav__link> 2.5.1 iptables代理模式 </a> </li> <li class=md-nav__item> <a href=#252-ipvs代理模式 class=md-nav__link> 2.5.2 ipvs代理模式 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#26-多端口service class=md-nav__link> 2.6 多端口Service </a> </li> <li class=md-nav__item> <a href=#27-service的类型 class=md-nav__link> 2.7 Service的类型 </a> </li> <li class=md-nav__item> <a href=#28-kubernetes服务发现 class=md-nav__link> 2.8 Kubernetes服务发现 </a> <nav class=md-nav aria-label="2.8 Kubernetes服务发现"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#281-基于环境变量的服务发现 class=md-nav__link> 2.8.1 基于环境变量的服务发现 </a> </li> <li class=md-nav__item> <a href=#2基于dns的服务发现 class=md-nav__link> 2．基于DNS的服务发现 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#3ingress class=md-nav__link> 3.Ingress </a> <nav class=md-nav aria-label=3.Ingress> <ul class=md-nav__list> <li class=md-nav__item> <a href=#31-基本概念 class=md-nav__link> 3.1 基本概念 </a> </li> <li class=md-nav__item> <a href=#32-创建一个ingress class=md-nav__link> 3.2 创建一个Ingress </a> </li> <li class=md-nav__item> <a href=#33-ingress使用入门 class=md-nav__link> 3.3 Ingress使用入门 </a> <nav class=md-nav aria-label="3.3 Ingress使用入门"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1单域名 class=md-nav__link> 1.单域名 </a> </li> <li class=md-nav__item> <a href=#2多域名 class=md-nav__link> 2.多域名 </a> </li> <li class=md-nav__item> <a href=#3基于tls的ingress class=md-nav__link> 3.基于TLS的Ingress </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#34-更新ingress class=md-nav__link> 3.4 更新Ingress </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#4小结 class=md-nav__link> 4.小结 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../7.Kubernetes%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/ class=md-nav__link> Kubernetes配置管理 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_4> <label class=md-nav__link for=__nav_2_4 id=__nav_2_4_label tabindex=0> 3.进阶篇 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_4_label aria-expanded=false> <label class=md-nav__title for=__nav_2_4> <span class="md-nav__icon md-icon"></span> 3.进阶篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../3.%E8%BF%9B%E9%98%B6%E7%AF%87/8.Kubernetes%E5%AD%98%E5%82%A8%E5%85%A5%E9%97%A8/ class=md-nav__link> Kubernetes存储入门 </a> </li> <li class=md-nav__item> <a href=../../3.%E8%BF%9B%E9%98%B6%E7%AF%87/9.Kubernetes%E9%AB%98%E7%BA%A7%E8%B0%83%E5%BA%A6/ class=md-nav__link> Kubernetes高级调度 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_5> <label class=md-nav__link for=__nav_2_5 id=__nav_2_5_label tabindex=0> 4.高级篇 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_5_label aria-expanded=false> <label class=md-nav__title for=__nav_2_5> <span class="md-nav__icon md-icon"></span> 4.高级篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../4.%E9%AB%98%E7%BA%A7%E7%AF%87/12.%E4%BA%91%E5%8E%9F%E7%94%9F%E5%AD%98%E5%82%A8Rook/ class=md-nav__link> 云原生存储Rook </a> </li> <li class=md-nav__item> <a href=../../4.%E9%AB%98%E7%BA%A7%E7%AF%87/13.%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%AE%B9%E5%99%A8%E5%8C%96/ class=md-nav__link> 中间件容器化 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_6> <label class=md-nav__link for=__nav_2_6 id=__nav_2_6_label tabindex=0> 5.运维篇 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_6_label aria-expanded=false> <label class=md-nav__title for=__nav_2_6> <span class="md-nav__icon md-icon"></span> 5.运维篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../5.%E8%BF%90%E7%BB%B4%E7%AF%87/14.Kubernetes%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/ class=md-nav__link> Kubernetes日志收集 </a> </li> <li class=md-nav__item> <a href=../../5.%E8%BF%90%E7%BB%B4%E7%AF%87/15.Kubernetes%E7%9B%91%E6%8E%A7%E5%91%8A%E8%AD%A6/ class=md-nav__link> Kubernetes监控告警 </a> </li> <li class=md-nav__item> <a href=../../5.%E8%BF%90%E7%BB%B4%E7%AF%87/16.%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83Ingress%E8%BF%9B%E9%98%B6/ class=md-nav__link> 服务发布Ingress进阶 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_7> <label class=md-nav__link for=__nav_2_7 id=__nav_2_7_label tabindex=0> 6.DevOps篇 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_7_label aria-expanded=false> <label class=md-nav__title for=__nav_2_7> <span class="md-nav__icon md-icon"></span> 6.DevOps篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/ class=md-nav__link> DevOps实践 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> Docker <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Docker </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1> <label class=md-nav__link for=__nav_3_1 id=__nav_3_1_label tabindex=0> 0.学习线路 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_1_label aria-expanded=false> <label class=md-nav__title for=__nav_3_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Docker/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Docker/ class=md-nav__link> Docker工具集 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2> <label class=md-nav__link for=__nav_3_2 id=__nav_3_2_label tabindex=0> 1.Docker基础 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> 1.Docker基础 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Docker/1.Docker%E5%9F%BA%E7%A1%80/1.%E5%AE%89%E8%A3%85/ class=md-nav__link> 安装 </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.Docker%E5%9F%BA%E7%A1%80/2.Docker%E7%9B%B8%E5%85%B3%E8%84%9A%E6%9C%AC/ class=md-nav__link> Docker相关脚本 </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.Docker%E5%9F%BA%E7%A1%80/3.docker-compose%E7%A4%BA%E4%BE%8B/ class=md-nav__link> docker-compose示例 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_3> <label class=md-nav__link for=__nav_3_3 id=__nav_3_3_label tabindex=0> 2.Devops <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> 2.Devops </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Docker/2.Devops/1.ConfCenter/ class=md-nav__link> ConfCenter </a> </li> <li class=md-nav__item> <a href=../../../Docker/2.Devops/2.CoreDNS/ class=md-nav__link> Coredns </a> </li> <li class=md-nav__item> <a href=../../../Docker/2.Devops/3.Harbor/ class=md-nav__link> Harbor </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> Python <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Python </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_1> <label class=md-nav__link for=__nav_4_1 id=__nav_4_1_label tabindex=0> 0.学习线路 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_1_label aria-expanded=false> <label class=md-nav__title for=__nav_4_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Pythjon-auto-ops/ class=md-nav__link> Pythjon自动化运维 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_2> <label class=md-nav__link for=__nav_4_2 id=__nav_4_2_label tabindex=0> 1.基础篇 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_2_label aria-expanded=false> <label class=md-nav__title for=__nav_4_2> <span class="md-nav__icon md-icon"></span> 1.基础篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/1.Python%E5%86%85%E7%BD%AE%E5%B0%8F%E5%B7%A5%E5%85%B7/ class=md-nav__link> Python内置小工具 </a> </li> <li class=md-nav__item> <a href=../../../Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/2.Python%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E5%AE%89%E8%A3%85/ class=md-nav__link> Python第三方库安装 </a> </li> <li class=md-nav__item> <a href=../../../Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/3.Python%E5%B7%A5%E4%BD%9C%E7%8E%AF%E5%A2%83%E7%AE%A1%E7%90%86/ class=md-nav__link> Python工作环境管理 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_3> <label class=md-nav__link for=__nav_4_3 id=__nav_4_3_label tabindex=0> 2.命令行相关 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_3_label aria-expanded=false> <label class=md-nav__title for=__nav_4_3> <span class="md-nav__icon md-icon"></span> 2.命令行相关 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python/2.%E5%91%BD%E4%BB%A4%E8%A1%8C%E7%9B%B8%E5%85%B3/1.%E4%B8%8E%E5%91%BD%E4%BB%A4%E8%A1%8C%E7%9B%B8%E5%85%B3%E7%9A%84Python%E8%AF%AD%E8%A8%80%E7%89%B9%E6%80%A7/ class=md-nav__link> 与命令行相关的Python语言特性 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> Python-vs-Go <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Python-vs-Go </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_1> <label class=md-nav__link for=__nav_5_1 id=__nav_5_1_label tabindex=0> 0.学习线路 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_1_label aria-expanded=false> <label class=md-nav__title for=__nav_5_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python-vs-Go/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/1.Python-vs-Go/ class=md-nav__link> Python-vs-Go </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_2> <label class=md-nav__link for=__nav_5_2 id=__nav_5_2_label tabindex=0> 1.对比学习 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_2_label aria-expanded=false> <label class=md-nav__title for=__nav_5_2> <span class="md-nav__icon md-icon"></span> 1.对比学习 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/1.Hello-World/ class=md-nav__link> Hello-World </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/2.Print/ class=md-nav__link> Print </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/3.%E6%B3%A8%E9%87%8A/ class=md-nav__link> 注释 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/4.%E5%A4%9A%E8%A1%8C%E5%AD%97%E7%AC%A6%E4%B8%B2/ class=md-nav__link> 多行字符串 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/5.Lists/ class=md-nav__link> Lists </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/6.Map/ class=md-nav__link> Map </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/7.Booleans/ class=md-nav__link> Booleans </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/8.Forloop/ class=md-nav__link> Forloop </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/9.Range/ class=md-nav__link> Range </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/10.Switch/ class=md-nav__link> Switch </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/11.%E5%8F%AF%E5%8F%98%E5%8F%82%E6%95%B0%E5%87%BD%E6%95%B0/ class=md-nav__link> 可变参数函数 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/12.%E6%97%B6%E9%97%B4%E8%AE%A1%E7%AE%97/ class=md-nav__link> 时间计算 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/13.%E5%87%BD%E6%95%B0%E7%9A%84%E9%97%AD%E5%8C%85/ class=md-nav__link> 函数的闭包 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/14.%E9%80%80%E5%87%BA%E5%A4%84%E7%90%86/ class=md-nav__link> 退出处理 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/15.%E5%BC%82%E5%B8%B8%E6%8D%95%E8%8E%B7/ class=md-nav__link> 异常捕获 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/16.%E5%8F%AF%E5%8F%98%E9%A1%B9/ class=md-nav__link> 可变项 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/17.%E7%B1%BB/ class=md-nav__link> 类 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/18.%E6%96%B9%E6%B3%95/ class=md-nav__link> 方法 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/19.%E5%B9%B6%E5%8F%91/ class=md-nav__link> 并发 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/20.Args/ class=md-nav__link> Args </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/21.%E5%AF%BC%E5%85%A5%E6%A8%A1%E5%9D%97%E5%88%AB%E5%90%8D/ class=md-nav__link> 导入模块别名 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/22.%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%A0%BC%E5%BC%8F%E5%8C%96/ class=md-nav__link> 字符串格式化 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/23.%E5%8E%BB%E9%87%8D/ class=md-nav__link> 去重 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/24.%E5%B8%A6%E9%A2%9C%E8%89%B2%E6%89%93%E5%8D%B0/ class=md-nav__link> 带颜色打印 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_3> <label class=md-nav__link for=__nav_5_3 id=__nav_5_3_label tabindex=0> 2.进阶 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_3_label aria-expanded=false> <label class=md-nav__title for=__nav_5_3> <span class="md-nav__icon md-icon"></span> 2.进阶 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python-vs-Go/2.%E8%BF%9B%E9%98%B6/1.%E4%BD%BF%E7%94%A8RPC/ class=md-nav__link> 使用RPC </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/2.%E8%BF%9B%E9%98%B6/2.%E4%BD%BF%E7%94%A8MySQL/ class=md-nav__link> 使用MySQL </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/2.%E8%BF%9B%E9%98%B6/3.%E4%BD%BF%E7%94%A8Redis/ class=md-nav__link> 使用Redis </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/2.%E8%BF%9B%E9%98%B6/4.%E4%BD%BF%E7%94%A8MongoDB/ class=md-nav__link> 使用MongoDB </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> Linux <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Linux </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_1> <label class=md-nav__link for=__nav_6_1 id=__nav_6_1_label tabindex=0> system <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_1_label aria-expanded=false> <label class=md-nav__title for=__nav_6_1> <span class="md-nav__icon md-icon"></span> system </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Linux/system/Linux%E5%86%85%E6%A0%B8%E5%BC%95%E5%AF%BC%E8%AF%A6%E8%A7%A3/ class=md-nav__link> Linux内核引导详解 </a> </li> <li class=md-nav__item> <a href=../../../Linux/system/Linux%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/ class=md-nav__link> Linux 系统安全加固最佳实践 </a> </li> <li class=md-nav__item> <a href=../../../Linux/system/virtio%E8%AF%A6%E8%A7%A3/ class=md-nav__link> Virtio 详解 </a> </li> <li class=md-nav__item> <a href=../../../Linux/system/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8E%8B%E6%B5%8B/ class=md-nav__link> 数据库压测 </a> </li> <li class=md-nav__item> <a href=../../../Linux/system/%E7%BA%A2%E6%97%97%E7%B3%BB%E7%BB%9F%E6%93%8D%E4%BD%9C/ class=md-nav__link> 红旗系统操作 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_2> <label class=md-nav__link for=__nav_6_2 id=__nav_6_2_label tabindex=0> serveices <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_2_label aria-expanded=false> <label class=md-nav__title for=__nav_6_2> <span class="md-nav__icon md-icon"></span> serveices </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Linux/serveices/1.Linux%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E4%B8%8B%E8%BD%BD/ class=md-nav__link> Linux操作系统镜像下载 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_3> <label class=md-nav__link for=__nav_6_3 id=__nav_6_3_label tabindex=0> Shell <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_3_label aria-expanded=false> <label class=md-nav__title for=__nav_6_3> <span class="md-nav__icon md-icon"></span> Shell </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Linux/shell/Shell%E7%AE%80%E4%BB%8B/ class=md-nav__link> Shell 教程概述 </a> </li> <li class=md-nav__item> <a href=../../../Linux/shell/1.%E7%AC%AC%E4%B8%80%E4%B8%AAshell%E7%A8%8B%E5%BA%8F/ class=md-nav__link> 1.第一个 Shell 程序 </a> </li> <li class=md-nav__item> <a href=../../../Linux/shell/2.Shell%E5%8F%98%E9%87%8F/ class=md-nav__link> 2.Shell 变量 </a> </li> <li class=md-nav__item> <a href=../../../Linux/shell/3.Shell%E5%8F%82%E6%95%B0/ class=md-nav__link> 3.Shell 参数 </a> </li> <li class=md-nav__item> <a href=../../../Linux/shell/4.Shell%E6%95%B0%E7%BB%84/ class=md-nav__link> 4.Shell数组 </a> </li> <li class=md-nav__item> <a href=../../../Linux/shell/5.Shell%E8%BF%90%E7%AE%97%E7%AC%A6/ class=md-nav__link> 5.Shell 运算符 </a> </li> <li class=md-nav__item> <a href=../../../Linux/shell/6.Shell%20echo_printf%E5%91%BD%E4%BB%A4/ class=md-nav__link> 6.Shell echo/printf 命令 </a> </li> <li class=md-nav__item> <a href=../../../Linux/shell/7.Shell%20test%E5%91%BD%E4%BB%A4/ class=md-nav__link> 7.Shell test 命令 </a> </li> <li class=md-nav__item> <a href=../../../Linux/shell/8.Shell%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/ class=md-nav__link> 8.Shell 流程控制 </a> </li> <li class=md-nav__item> <a href=../../../Linux/shell/9.Shell%E5%87%BD%E6%95%B0/ class=md-nav__link> 8.Shell 函数 </a> </li> <li class=md-nav__item> <a href=../../../Linux/shell/10.Shell%E8%BE%93%E5%85%A5_%E8%BE%93%E5%87%BA%E9%87%8D%E5%AE%9A%E5%90%91/ class=md-nav__link> 10.Shell输入/输出重定向 </a> </li> <li class=md-nav__item> <a href=../../../Linux/shell/11.Shell%20%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/ class=md-nav__link> 11.Shell 正则表达式 </a> </li> <li class=md-nav__item> <a href=../../../Linux/shell/12.Shell%20%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bgrep/ class=md-nav__link> 12.Shell 三剑客之grep </a> </li> <li class=md-nav__item> <a href=../../../Linux/shell/13.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/ class=md-nav__link> 13.Shell三剑客之sed </a> </li> <li class=md-nav__item> <a href=../../../Linux/shell/14.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bawk/ class=md-nav__link> 14.Shell三剑客之awk </a> </li> <li class=md-nav__item> <a href=../../../Linux/shell/15.Shell%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/ class=md-nav__link> 15.Shell常用工具 </a> </li> <li class=md-nav__item> <a href=../../../Linux/shell/16.Shell%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/ class=md-nav__link> 16.Shell实战项目 </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#1标签和选择器 class=md-nav__link> 1.标签和选择器 </a> <nav class=md-nav aria-label=1.标签和选择器> <ul class=md-nav__list> <li class=md-nav__item> <a href=#11-定义标签 class=md-nav__link> 1.1 定义标签 </a> </li> <li class=md-nav__item> <a href=#12-选择器 class=md-nav__link> 1.2 选择器 </a> </li> <li class=md-nav__item> <a href=#13-修改标签 class=md-nav__link> 1.3 修改标签 </a> </li> <li class=md-nav__item> <a href=#14-删除标签 class=md-nav__link> 1.4 删除标签 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2service class=md-nav__link> 2.Service </a> <nav class=md-nav aria-label=2.Service> <ul class=md-nav__list> <li class=md-nav__item> <a href=#21-service的基本概念 class=md-nav__link> 2.1 Service的基本概念 </a> </li> <li class=md-nav__item> <a href=#22-定义service class=md-nav__link> 2.2 定义Service </a> </li> <li class=md-nav__item> <a href=#23-无选择器的service和endpoint class=md-nav__link> 2.3 无选择器的Service和Endpoint </a> </li> <li class=md-nav__item> <a href=#24-externalname-service class=md-nav__link> 2.4 ExternalName Service </a> </li> <li class=md-nav__item> <a href=#25-service代理模式 class=md-nav__link> 2.5 Service代理模式 </a> <nav class=md-nav aria-label="2.5 Service代理模式"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#251-iptables代理模式 class=md-nav__link> 2.5.1 iptables代理模式 </a> </li> <li class=md-nav__item> <a href=#252-ipvs代理模式 class=md-nav__link> 2.5.2 ipvs代理模式 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#26-多端口service class=md-nav__link> 2.6 多端口Service </a> </li> <li class=md-nav__item> <a href=#27-service的类型 class=md-nav__link> 2.7 Service的类型 </a> </li> <li class=md-nav__item> <a href=#28-kubernetes服务发现 class=md-nav__link> 2.8 Kubernetes服务发现 </a> <nav class=md-nav aria-label="2.8 Kubernetes服务发现"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#281-基于环境变量的服务发现 class=md-nav__link> 2.8.1 基于环境变量的服务发现 </a> </li> <li class=md-nav__item> <a href=#2基于dns的服务发现 class=md-nav__link> 2．基于DNS的服务发现 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#3ingress class=md-nav__link> 3.Ingress </a> <nav class=md-nav aria-label=3.Ingress> <ul class=md-nav__list> <li class=md-nav__item> <a href=#31-基本概念 class=md-nav__link> 3.1 基本概念 </a> </li> <li class=md-nav__item> <a href=#32-创建一个ingress class=md-nav__link> 3.2 创建一个Ingress </a> </li> <li class=md-nav__item> <a href=#33-ingress使用入门 class=md-nav__link> 3.3 Ingress使用入门 </a> <nav class=md-nav aria-label="3.3 Ingress使用入门"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1单域名 class=md-nav__link> 1.单域名 </a> </li> <li class=md-nav__item> <a href=#2多域名 class=md-nav__link> 2.多域名 </a> </li> <li class=md-nav__item> <a href=#3基于tls的ingress class=md-nav__link> 3.基于TLS的Ingress </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#34-更新ingress class=md-nav__link> 3.4 更新Ingress </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#4小结 class=md-nav__link> 4.小结 </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=kubernetes服务发布基础>Kubernetes服务发布基础<a class=headerlink href=#kubernetes服务发布基础 title="Permanent link">&para;</a></h1> <p>在传统架构中，用户访问公司内的服务可能通过了多层代理、网关、防火墙等。在Kubernetes中，访问Kubernetes中的应用同样也会经过多层代理、网关、防火墙等。</p> <p>但是在传统架构中，可能是通过Nginx、HAProxy、LVS、公有云的SLB、ELB等实现的负载均衡和域名路由，虽然Kubernetes也是通过诸如此类的技术实现的域名路由或者负载均衡，只不过对应的名字叫法可能有所变化，读者不要把这些当作一个比较新颖的东西，其实内部的实现和之前并无区别。</p> <p>在传统架构配置多个相同服务的负载均衡可能使用的是Nginx的upstream，在Kubernetes中用Service实现。</p> <p>在传统架构配置域名访问应用可能使用Nginx的Server配置，在Kubernetes中用Ingress实现域名路由的配置（最终通过Ingress的配置生成对应控制器的配置，比如使用Nginx作为Ingress控制器，Ingress资源最终生成的就是Nginx的配置文件）。</p> <h2 id=1标签和选择器>1.标签和选择器<a class=headerlink href=#1标签和选择器 title="Permanent link">&para;</a></h2> <p>很多情况下，我们需要对各类资源进行分组管理，或者同一个应用的Pod可能会根据不同的功能进行划分，比如有一个后端的应用， 需要提供API接口供前端调用，也需要进行一些周期性的计划任务，相当于同一个镜像分两个身份运行，所以就需要对这两个资源文件用标签进行区分，这样的话就可以让流量进入提供API接口的Pod，执行计划任务的Pod不接收任何流量，</p> <p>如图6.1所示。</p> <p><img alt class=zoom src=../../../assets/static/kubernetes/2/6-1-selector.png></p> <p>图6.1 同一个应用不同的运行方式</p> <p>此时其他应用调用该应用的Service（Service为容器服务的入口，可以通过Service访问符合选择器（Selector）过滤的容器的应用程序，缩写为svc，具体可以参考本书6.2节）时， 流量只能到达api的Pod，不会到达cron的Pod，因为选择器进行匹配时是“与”的关系，需要所有的标签（Label）都要匹配，所以role=cronjob的Pod不会被接入流量。</p> <p>使用标签同样可以对Kubernetes的其他资源进行配置，当Kubernetes对系统的任何API对象（如Pod和节点）进行“分组”时，会对其添加标签 （key=value形式的“键-值对”），用以精准地选择对应的API对象。</p> <p>而选择 器则是针对匹配对象的查询方法。</p> <p>常用的标签tier可用于区分容器的属性，如frontend、backend；或者一个release_track用于区分容器的环境，如canary、production等。</p> <h3 id=11-定义标签>1.1 定义标签<a class=headerlink href=#11-定义标签 title="Permanent link">&para;</a></h3> <p>应用案例：公司与xx银行有一条专属的高速光纤通道，此通道只能与192.168.7.0网段进行通信，因此只能将与xx银行通信的应用部署到192.168.7.0网段所在的节点上，此时可以对节点添加标签：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a>$<span class=w> </span>kubectl<span class=w> </span>label<span class=w> </span>node<span class=w> </span>k8s-node02<span class=w> </span><span class=nv>region</span><span class=o>=</span>subnet7
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>node/k8s-node02<span class=w> </span>labeled
</code></pre></div> <p>然后可以通过选择器对其筛选：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>node<span class=w> </span>-l<span class=w> </span><span class=nv>region</span><span class=o>=</span>subnet7
<a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a>NAME<span class=w>             </span>STATUS<span class=w>   </span>ROLES<span class=w>     </span>AGE<span class=w>    </span>VERSION
<a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a>k8s-node02<span class=w>   </span>Ready<span class=w>    </span>ingress<span class=w>   </span>321d<span class=w>   </span>v1.21.3
</code></pre></div> <p>删除标签</p> <div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a>$<span class=w> </span>kubectl<span class=w> </span>label<span class=w> </span>node<span class=w> </span>giteego-k8s-n2<span class=w> </span>region-
<a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a>node/giteego-k8s-n2<span class=w> </span>labeled
<a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a>
<a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>no<span class=w> </span>-l<span class=w> </span><span class=nv>region</span><span class=o>=</span>subnet7
<a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a>No<span class=w> </span>resources<span class=w> </span>found
</code></pre></div> <p>最后在Deployment或其他控制器中指定将Pod部署到该节点：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=w> </span><span class=c1># 可选，指定Node节点</span>
<a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=w>  </span><span class=nt>nodeSelector</span><span class=p>:</span>
<a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a><span class=w>    </span><span class=nt>region</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">subnet7</span>
<a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a><span class=w>  </span><span class=nt>restartPolicy</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Always</span>
</code></pre></div> <p>也可以用同样的方式对Service添加标签：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a>$<span class=w> </span>kubectl<span class=w> </span>label<span class=w> </span>svc<span class=w> </span>canary-v1<span class=w> </span>-n<span class=w> </span>canary-production<span class=w> </span><span class=nv>env</span><span class=o>=</span>canary<span class=w> </span><span class=nv>version</span><span class=o>=</span>v1
<a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a>service/canary-v1<span class=w> </span>labeled
</code></pre></div> <p>查看该Service的标签：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>svc<span class=w> </span>-n<span class=w> </span>canary-production<span class=w> </span>--show-labels
</code></pre></div> <p>还可以查看所有version为v1的Service：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>svc<span class=w> </span>--all-namespaces<span class=w> </span>-l<span class=w> </span><span class=nv>version</span><span class=o>=</span>v1
</code></pre></div> <p>上述演示了对节点、Service添加自定义标签的方法，对其他资源添加标签的方式相同。</p> <h3 id=12-选择器>1.2 选择器<a class=headerlink href=#12-选择器 title="Permanent link">&para;</a></h3> <p>选择器主要用于资源的匹配，只有符合条件的资源才会被调用或使用，可以使用该方式对集群中的各类资源进行分配。</p> <p>由于Kubernetes的核心资源Deployment、StatefulSet管理哪些Pod是通过选择器字段决定的，通过Service访问哪些后端Pod也是通过选择器字段决定的， 因此本节将介绍如何使用选择器过滤出自己想要的资源。</p> <p>首先使用--show-labels查看目前已有的标签：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>service<span class=w> </span>--show-labels
<a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a>NAME<span class=w>                          </span>TYPE<span class=w>        </span>CLUSTER-IP<span class=w>      </span>EXTERNAL-IP<span class=w>   </span>PORT<span class=o>(</span>S<span class=o>)</span><span class=w>   </span>AGE<span class=w>    </span>LABELS
<a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a>kubernetes<span class=w>                    </span>ClusterIP<span class=w>   </span><span class=m>10</span>.96.0.1<span class=w>       </span>&lt;none&gt;<span class=w>        </span><span class=m>443</span>/TCP<span class=w>   </span>321d<span class=w>   </span><span class=nv>component</span><span class=o>=</span>apiserver,provider<span class=o>=</span>kubernetes
<a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a>nginx-deployment-helm-nginx<span class=w>   </span>ClusterIP<span class=w>   </span><span class=m>10</span>.103.233.67<span class=w>   </span>&lt;none&gt;<span class=w>        </span><span class=m>80</span>/TCP<span class=w>    </span>16d<span class=w>    </span>app.kubernetes.io/instance<span class=o>=</span>nginx-deployment,app.kubernetes.io/managed-by<span class=o>=</span>Helm,app.kubernetes.io/name<span class=o>=</span>helm-nginx,app.kubernetes.io/version<span class=o>=</span><span class=m>1</span>.16.0,helm.sh/chart<span class=o>=</span>helm-nginx-0.1.0
</code></pre></div> <p>选择匹配provider为details或者kubernetes的Service：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>svc<span class=w> </span>-l<span class=w> </span><span class=s2>&quot;provider in (details,kubernetes)&quot;</span><span class=w> </span>--show-labels
<a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a>NAME<span class=w>         </span>TYPE<span class=w>        </span>CLUSTER-IP<span class=w>   </span>EXTERNAL-IP<span class=w>   </span>PORT<span class=o>(</span>S<span class=o>)</span><span class=w>   </span>AGE<span class=w>    </span>LABELS
<a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a>kubernetes<span class=w>   </span>ClusterIP<span class=w>   </span><span class=m>10</span>.96.0.1<span class=w>    </span>&lt;none&gt;<span class=w>        </span><span class=m>443</span>/TCP<span class=w>   </span>321d<span class=w>   </span><span class=nv>component</span><span class=o>=</span>apiserver,provider<span class=o>=</span>kubernetes
</code></pre></div> <p>选择provider为details或kubernetes但不包括version=v1的Service：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>svc<span class=w> </span>-l<span class=w> </span>version!<span class=o>=</span>v1,<span class=s2>&quot;provider in (details,kubernetes)&quot;</span><span class=w> </span>--show-labels
<a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a>NAME<span class=w>         </span>TYPE<span class=w>        </span>CLUSTER-IP<span class=w>   </span>EXTERNAL-IP<span class=w>   </span>PORT<span class=o>(</span>S<span class=o>)</span><span class=w>   </span>AGE<span class=w>    </span>LABELS
<a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a>kubernetes<span class=w>   </span>ClusterIP<span class=w>   </span><span class=m>10</span>.96.0.1<span class=w>    </span>&lt;none&gt;<span class=w>        </span><span class=m>443</span>/TCP<span class=w>   </span>321d<span class=w>   </span><span class=nv>component</span><span class=o>=</span>apiserver,provider<span class=o>=</span>kubernetes
</code></pre></div> <p>选择label的key名为app的Service： <div class=highlight><pre><span></span><code><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>svc<span class=w> </span>-l<span class=w> </span>app<span class=w> </span>--show-labels
</code></pre></div></p> <h3 id=13-修改标签>1.3 修改标签<a class=headerlink href=#13-修改标签 title="Permanent link">&para;</a></h3> <p>在实际使用中，资源标签的更改是经常发生的事情，可以使用overwrite 参数修改标签。</p> <p>比如将version=v1改为version=v2： <div class=highlight><pre><span></span><code><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>svc<span class=w> </span>-n<span class=w> </span>canary-production<span class=w> </span>--show-labels
<a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a>
<a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a>$<span class=w> </span>kubectl<span class=w> </span>label<span class=w> </span>svc<span class=w> </span>canary-v1<span class=w> </span>-n<span class=w> </span>canary-production<span class=w> </span><span class=nv>version</span><span class=o>=</span>v2<span class=w> </span>--overwrite
<a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a>
<a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>svc<span class=w> </span>-n<span class=w> </span>canary-production<span class=w> </span>--show-labels
</code></pre></div></p> <h3 id=14-删除标签>1.4 删除标签<a class=headerlink href=#14-删除标签 title="Permanent link">&para;</a></h3> <p>有时候也会需要删除某资源的标签，在label的key名后面加一个减号即可删除，比如删除key名为version的标签：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a>$<span class=w> </span>kubectl<span class=w> </span>label<span class=w> </span>svc<span class=w> </span>canary-v1<span class=w> </span>-n<span class=w> </span>canary-product<span class=w> </span>version-
<a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a>
<a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>svc<span class=w> </span>-n<span class=w> </span>canary-production<span class=w> </span>--show-labels
</code></pre></div> <div class=highlight><pre><span></span><code><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=c1># 设置标签</span>
<a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a>$<span class=w> </span>kubectl<span class=w> </span>label<span class=w> </span>node<span class=w> </span>gitee-k8s-w02<span class=w> </span><span class=nv>monitor</span><span class=o>=</span>prometheus
<a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a>node/gitee-k8s-w02<span class=w> </span>labeled
<a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a>
<a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a><span class=c1># 带有prometheus标识符的标签</span>
<a id=__codelineno-13-6 name=__codelineno-13-6 href=#__codelineno-13-6></a>$<span class=w> </span>kubectl<span class=w> </span>label<span class=w> </span>nodes<span class=w> </span>gitee-k8s-w02<span class=w> </span>node-role.kubernetes.io/prometheus<span class=o>=</span><span class=s2>&quot;true&quot;</span>
<a id=__codelineno-13-7 name=__codelineno-13-7 href=#__codelineno-13-7></a>
<a id=__codelineno-13-8 name=__codelineno-13-8 href=#__codelineno-13-8></a>
<a id=__codelineno-13-9 name=__codelineno-13-9 href=#__codelineno-13-9></a><span class=c1># 删除标签</span>
<a id=__codelineno-13-10 name=__codelineno-13-10 href=#__codelineno-13-10></a>$<span class=w> </span>kubectl<span class=w> </span>label<span class=w> </span>nodes<span class=w> </span>gitee-k8s-w02<span class=w> </span>monitor-
<a id=__codelineno-13-11 name=__codelineno-13-11 href=#__codelineno-13-11></a>node/gitee-k8s-w02<span class=w> </span>labeled
<a id=__codelineno-13-12 name=__codelineno-13-12 href=#__codelineno-13-12></a>
<a id=__codelineno-13-13 name=__codelineno-13-13 href=#__codelineno-13-13></a><span class=c1># 带有prometheus标识符的标签</span>
<a id=__codelineno-13-14 name=__codelineno-13-14 href=#__codelineno-13-14></a>$<span class=w> </span>kubectl<span class=w> </span>label<span class=w> </span>nodes<span class=w> </span>gitee-k8s-w02<span class=w> </span>node-role.kubernetes.io/prometheus-
<a id=__codelineno-13-15 name=__codelineno-13-15 href=#__codelineno-13-15></a>
<a id=__codelineno-13-16 name=__codelineno-13-16 href=#__codelineno-13-16></a>
<a id=__codelineno-13-17 name=__codelineno-13-17 href=#__codelineno-13-17></a><span class=c1># label为node-role.kubernetes.io/prometheus=&quot;true&quot;</span>
<a id=__codelineno-13-18 name=__codelineno-13-18 href=#__codelineno-13-18></a>nodeSelector:<span class=w> </span><span class=o>{</span><span class=s2>&quot;node-role.kubernetes.io/prometheus&quot;</span>:<span class=s2>&quot;true&quot;</span><span class=o>}</span>
<a id=__codelineno-13-19 name=__codelineno-13-19 href=#__codelineno-13-19></a>
<a id=__codelineno-13-20 name=__codelineno-13-20 href=#__codelineno-13-20></a>
<a id=__codelineno-13-21 name=__codelineno-13-21 href=#__codelineno-13-21></a><span class=c1># 修改一个label的值，需要加上–overwrite参数：</span>
<a id=__codelineno-13-22 name=__codelineno-13-22 href=#__codelineno-13-22></a>$<span class=w> </span>kubectl<span class=w> </span>label<span class=w> </span>nodes<span class=w> </span>k8s-test01<span class=w> </span><span class=nv>gpu</span><span class=o>=</span><span class=nb>false</span><span class=w> </span>--overwrite
</code></pre></div> <div class="admonition example"> <p class=admonition-title>参考文献<p><a href=https://www.qikqiak.com/k8strain2/scheduler/usage/#nodeSelector>https://www.qikqiak.com/k8strain2/scheduler/usage/#nodeSelector</a></p> </p> </div> <h2 id=2service>2.Service<a class=headerlink href=#2service title="Permanent link">&para;</a></h2> <p>使用虚拟机或者裸容器部署应用时，程序之前的互相访问一般都是使用宿主机的IP地址和端口号进行访问的，因为宿主机的IP地址一般不会轻易改变，所以IP+端口的方式并没有什么大的问题。</p> <p>而使用Kubernetes的Pod部署应用时，Pod大部分都是随机地部署至最佳的节点上，并且经常被删除重建， 所以Pod的IP地址并不是一成不变的，这样的话服务之前的访问就不能使用IP+端口的方式， 所以Service应运而生。</p> <p>Service主要用于Pod之间的通信，对于Pod的IP地址而言，Service是提前定义好并且是不变的资源类型， 在生产环境中最佳的实践方式就是每个应用互相调用时使用Service的名字进行连接， 而非IP地址。</p> <h3 id=21-service的基本概念>2.1 Service的基本概念<a class=headerlink href=#21-service的基本概念 title="Permanent link">&para;</a></h3> <p>Kubernetes的Pod具有生命周期的概念，它可以被创建、删除、销毁，一旦被销毁就意味着生命周期的结束。</p> <p>通过ReplicaSet能够动态地创建和销毁Pod，例如进行扩缩容和执行滚动升级。 每个Pod都会获取到它自己的IP地址，但是这些IP地址不总是稳定和可依赖的，这样就会导致一个问题：</p> <p>在Kubernetes集群中，如果一组Pod（比如后端的Pod）为其他Pod（比如前端的Pod）提供服务，那么如果它们之间使用Pod的IP地址进行通信，在Pod重建后，将无法再进行连接。</p> <p>为了解决上述问题，Kubernetes引用了Service这样一种抽象概念： 逻辑上的一组Pod，即一种可以访问Pod的策略，通常被称为微服务。</p> <p>这一组Pod能够被Service访问，通常是通过Label Selector（标签选择器）实现的，如图6.2所示。</p> <p><img alt class=zoom src=../../../assets/static/kubernetes/2/6-2-selector.png></p> <p>图6.2 Service代理模式</p> <p>假设有一个用作图片处理的backend（后端），运行了3个副本，每个副 本具有一个app=backend的Label，这些副本是可互换（无状态）的， 之后创建一个Service指定Selector为app=backend，那么frontend（前端）即可通过这个Service的名称直接访问backend，所以frontend不需要关心它调用了哪个backend副本。</p> <p>即使组成这一组backend程序的Pod发生了变化，frontend也没有必要知道，而且也不需要跟踪这一组backend的状态，因为Service能够解耦这种关联。</p> <h3 id=22-定义service>2.2 定义Service<a class=headerlink href=#22-定义service title="Permanent link">&para;</a></h3> <p>和创建其他类型的资源一样，定义一个YAML文件，即可通过kubectl客户端创建一个Service。 例如有一组Pod，它们暴露了9376端口，同时具有<code>app=myapp</code>的标签，此时可以定义Service的YAML文件如下：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">my-service</span>
<a id=__codelineno-14-5 name=__codelineno-14-5 href=#__codelineno-14-5></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-14-6 name=__codelineno-14-6 href=#__codelineno-14-6></a><span class=w>  </span><span class=nt>selector</span><span class=p>:</span>
<a id=__codelineno-14-7 name=__codelineno-14-7 href=#__codelineno-14-7></a><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
<a id=__codelineno-14-8 name=__codelineno-14-8 href=#__codelineno-14-8></a><span class=w>  </span><span class=nt>ports</span><span class=p>:</span>
<a id=__codelineno-14-9 name=__codelineno-14-9 href=#__codelineno-14-9></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<a id=__codelineno-14-10 name=__codelineno-14-10 href=#__codelineno-14-10></a><span class=w>      </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<a id=__codelineno-14-11 name=__codelineno-14-11 href=#__codelineno-14-11></a><span class=w>      </span><span class=nt>targetPort</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">9376</span>
</code></pre></div> <p>上述文件配置创建一个名为my-service的Service对象，它会将请求代理 到TCP端口为9376并且具有标签app=myapp的Pod上。 这个Service会被分配一个IP地址，通常称为ClusterIP，它会被服务的代理使用， 在集群内部可以通过该ClusterIP（不建议使用ClusterIP进行访问）或Service名加上port进行访问，该示例my-service:80即可访问具有app=myapp标签的Pod的9376端口。</p> <p><strong>需要注意的是，Service能够将一个接收端口映射到任意的targetPort， 如果targetPort为空，targetPort将被设置为与Port字段相同的值 。</strong></p> <p>targetPort可以设置为一个字符串，引用backend Pod的一个端口的名称，这样的话即使更改了Pod的端口，也不会对Service的访问造成影响。 Kubernetes Service能够支持TCP、UDP、SCTP等协议，默认为TCP协议。</p> <h3 id=23-无选择器的service和endpoint>2.3 无选择器的Service和Endpoint<a class=headerlink href=#23-无选择器的service和endpoint title="Permanent link">&para;</a></h3> <p>以下情况均可使用无选择器的Service，例如：</p> <ul> <li>希望在生产环境中使用某个固定的名称而非IP地址访问外部的中间件服务。</li> <li>希望Service指向另一个Namespace或其他集群中的服务。</li> <li>正在将工作负载转移到Kubernetes集群，但是一部分服务仍运行在Kubernetes集群之外的backend。</li> </ul> <p>在这些场景中，都能定义没有选择器的Service，只需要把上述的Service去除Selector字段即可。</p> <p>由于这个Service没有选择器，就不会创建相关的Endpoints对象，可以手动创建一个同名的Endpoints（同名的Service和Endpoints会自动建立链接）：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">my-service</span>
<a id=__codelineno-15-5 name=__codelineno-15-5 href=#__codelineno-15-5></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-15-6 name=__codelineno-15-6 href=#__codelineno-15-6></a><span class=w>  </span><span class=nt>ports</span><span class=p>:</span>
<a id=__codelineno-15-7 name=__codelineno-15-7 href=#__codelineno-15-7></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<a id=__codelineno-15-8 name=__codelineno-15-8 href=#__codelineno-15-8></a><span class=w>      </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<a id=__codelineno-15-9 name=__codelineno-15-9 href=#__codelineno-15-9></a><span class=w>      </span><span class=nt>targetPort</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">9376</span>
<a id=__codelineno-15-10 name=__codelineno-15-10 href=#__codelineno-15-10></a><span class=nn>---</span>
<a id=__codelineno-15-11 name=__codelineno-15-11 href=#__codelineno-15-11></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Endpoints</span>
<a id=__codelineno-15-12 name=__codelineno-15-12 href=#__codelineno-15-12></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id=__codelineno-15-13 name=__codelineno-15-13 href=#__codelineno-15-13></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-15-14 name=__codelineno-15-14 href=#__codelineno-15-14></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">my-service</span>
<a id=__codelineno-15-15 name=__codelineno-15-15 href=#__codelineno-15-15></a><span class=nt>subsets</span><span class=p>:</span>
<a id=__codelineno-15-16 name=__codelineno-15-16 href=#__codelineno-15-16></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>addresses</span><span class=p>:</span>
<a id=__codelineno-15-17 name=__codelineno-15-17 href=#__codelineno-15-17></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>ip</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1.2.3.4</span>
<a id=__codelineno-15-18 name=__codelineno-15-18 href=#__codelineno-15-18></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
<a id=__codelineno-15-19 name=__codelineno-15-19 href=#__codelineno-15-19></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">9376</span>
</code></pre></div> <div class="admonition warning"> <p class=admonition-title>注意</p> <p>Endpoint IP地址不能是loopback(127.0.0.0/8)、 link-loca(l169.254.0.0/16)或者link-local多播地址(224.0.0.0/24)。</p> <p>访问没有选择器的Service与有选择器的Service的原理相同，通过Service名称即可访问，请求将被路由到用户定义的Endpoint，该示例为 1.2.3.4:9376。</p> </div> <h3 id=24-externalname-service>2.4 ExternalName Service<a class=headerlink href=#24-externalname-service title="Permanent link">&para;</a></h3> <p>ExternalName Service是Service的特例，它没有选择器，也没有定义任何端口和Endpoint，它通过返回该外部服务的别名来提供服务。</p> <p>比如可以定义一个Service，后端设置为一个外部域名，这样通过Service的名称即可访问该域名。</p> <p>使用nslookup解析以下文件定义的Service，集群的DNS服务将返回一个值为my.database.example.com的CNAME记录：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">my-service</span>
<a id=__codelineno-16-5 name=__codelineno-16-5 href=#__codelineno-16-5></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">prod</span>
<a id=__codelineno-16-6 name=__codelineno-16-6 href=#__codelineno-16-6></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-16-7 name=__codelineno-16-7 href=#__codelineno-16-7></a><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ExternalName</span><span class=w>    </span>
<a id=__codelineno-16-8 name=__codelineno-16-8 href=#__codelineno-16-8></a><span class=w>  </span><span class=nt>externalName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">my.database.example.com</span>
</code></pre></div> <h3 id=25-service代理模式>2.5 Service代理模式<a class=headerlink href=#25-service代理模式 title="Permanent link">&para;</a></h3> <p>在Kubernetes集群中，每个节点运行一个kube-proxy进程。 kube-proxy 负责为Service实现一种VIP（虚拟IP）的形式，而不是ExternalName的形式。 在Kubernetesv 1.0版本中，代理完全是userspace。在Kubernetesv 1.1版中新增了iptables代理，从Kubernetesv 1.2版起，默认是iptables代理。</p> <p><strong>从Kubernetesv 1.8版开始新增了ipvs代理，生产环境建议使用ipvs模式。</strong></p> <h4 id=251-iptables代理模式>2.5.1 iptables代理模式<a class=headerlink href=#251-iptables代理模式 title="Permanent link">&para;</a></h4> <p>这种模式下，kube-proxy会监视Kubernetes master节点对Service对象和Endpoints对象的添加和移除。</p> <p>对每个Service它会创建iptables规则，从而捕获该Service的ClusterIP（虚拟IP）和端口的请求，进而将请求重定向 到Service的一组backend中的某个Pod上面。对于每个Endpoints对象，它也 会创建iptables规则，这个规则会选择一个backend Pod。 默认的策略是随机选择一个backend，如果要实现基于客户端IP的会话亲和性，可以将service.spec.sessionAffinity的值设置为ClusterIP（默认为 None）。</p> <p>和userspace代理类似，网络返回的结果都是到达Service的IP:Port请求，这些请求会被代理到一个合适的backend，不需要客户端知道关于 Kubernetes、Service或Pod的任何信息。这比userspace代理更快、更可靠，并且当初始选择的Pod没有响应时，iptables代理能够自动重试另一个Pod。</p> <h4 id=252-ipvs代理模式>2.5.2 ipvs代理模式<a class=headerlink href=#252-ipvs代理模式 title="Permanent link">&para;</a></h4> <p>在此模式下，kube-proxy监视Kubernetes Service和Endpoint，调用 netlink接口以相应地创建ipvs规则， 并定期与Kubernetes Service和 Endpoint同步ipvs规则，以确保ipvs状态与期望保持一致。访问服务时，流量将被重定向到其中一个后端Pod。</p> <p>与iptables类似，ipvs基于netfilter钩子函数，但是ipvs使用哈希表作 为底层数据结构并在内核空间中工作，这意味着ipvs可以更快地重定向流量， 并且在同步代理规则时具有更好的性能，此外，ipvs为负载均衡算法提 供了更多的选项，例如：</p> <ul> <li>rr：轮询。 </li> <li>lc：最少连接。</li> <li>dh：目标哈希。</li> <li>sh：源哈希。</li> <li>sed：预计延迟最短。</li> <li>nq：从不排队。</li> </ul> <div class="admonition warning"> <p class=admonition-title>注意</p> <p>Kube-proxy使用ipvs模式必须在每个节点上安装ipvs模块，如果没有安装 ipvs模块，将会默认使用iptables模式。</p> </div> <h3 id=26-多端口service>2.6 多端口Service<a class=headerlink href=#26-多端口service title="Permanent link">&para;</a></h3> <p>在许多情况下，Service可能需要暴露多个端口，对于这种情况，Kubernetes支持Service定义多个端口，但使用多个端口时，必须提供所有端口的名称，</p> <p>例如将Service的80端口代理到后端的9376，443端口代理到后端的9377：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id=__codelineno-17-3 name=__codelineno-17-3 href=#__codelineno-17-3></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-17-4 name=__codelineno-17-4 href=#__codelineno-17-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">my-service</span>
<a id=__codelineno-17-5 name=__codelineno-17-5 href=#__codelineno-17-5></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-17-6 name=__codelineno-17-6 href=#__codelineno-17-6></a><span class=w>  </span><span class=nt>selector</span><span class=p>:</span>
<a id=__codelineno-17-7 name=__codelineno-17-7 href=#__codelineno-17-7></a><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
<a id=__codelineno-17-8 name=__codelineno-17-8 href=#__codelineno-17-8></a><span class=w>  </span><span class=nt>ports</span><span class=p>:</span>
<a id=__codelineno-17-9 name=__codelineno-17-9 href=#__codelineno-17-9></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">http</span>
<a id=__codelineno-17-10 name=__codelineno-17-10 href=#__codelineno-17-10></a><span class=w>    </span><span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<a id=__codelineno-17-11 name=__codelineno-17-11 href=#__codelineno-17-11></a><span class=w>    </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<a id=__codelineno-17-12 name=__codelineno-17-12 href=#__codelineno-17-12></a><span class=w>    </span><span class=nt>targetPort</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">9376</span>
<a id=__codelineno-17-13 name=__codelineno-17-13 href=#__codelineno-17-13></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">https</span>
<a id=__codelineno-17-14 name=__codelineno-17-14 href=#__codelineno-17-14></a><span class=w>    </span><span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<a id=__codelineno-17-15 name=__codelineno-17-15 href=#__codelineno-17-15></a><span class=w>    </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">443</span>
<a id=__codelineno-17-16 name=__codelineno-17-16 href=#__codelineno-17-16></a><span class=w>    </span><span class=nt>targetPort</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">9377</span>
</code></pre></div> <h3 id=27-service的类型>2.7 Service的类型<a class=headerlink href=#27-service的类型 title="Permanent link">&para;</a></h3> <p>Kubernetes Service Type（服务类型）主要包括以下几种：</p> <ul> <li>ClusterIP：在集群内部使用，默认值，只能从集群中访问。</li> <li>NodePort：在所有安装了Kube-Proxy的节点上打开一个端口，此端口可以代理至后端Pod，可以通过NodePort从集群外部访问集群内的 服务，格式为NodeIP:NodePort。 </li> <li>LoadBalancer：使用云提供商的负载均衡器公开服务，成本较高。</li> <li>ExternalName：通过返回定义的CNAME别名，将Service映射到可被 DNS解析的其他域名，需要1.7或更高版本kube-dns的支持。</li> </ul> <p>应用程序部署到Kubernetes后，需要将某些服务发布至Kubernetes集群 外，也就是可以被其他人访问或者调用，比较常用的发布方式是IP+端口或使 用域名的方式。</p> <p>IP+端口的方式可以用NodePort类型Service进行发布，域名的方式可以使用Ingress（6.3节介绍）进行发布。</p> <p>以NodePort为例，如果将Service的type字段设置为NodePort，则Kubernetes将从--service-nodeport-range参数指定的范围（默认为30000～ 32767）中自动分配端口， 也可以手动指定NodePort，创建该Service后，集群每个节点都将暴露一个端口，通过某个宿主机的IP+端口即可访问后端的应用， 也可以前端采用一个反代服务器代理至多个Node节点+端口，防止单个Node节点故障引起的服务不可用。</p> <p>定义一个NodePort类型的Service格式如下（ Kubernetes集群安装时Dashboard的访问就是基于NodePort类型的Service进行访问的，6.3节将会讲 到如何使用域名访问Kubernetes集群的应用）：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id=__codelineno-18-3 name=__codelineno-18-3 href=#__codelineno-18-3></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-18-4 name=__codelineno-18-4 href=#__codelineno-18-4></a><span class=w>  </span><span class=nt>labels</span><span class=p>:</span>
<a id=__codelineno-18-5 name=__codelineno-18-5 href=#__codelineno-18-5></a><span class=w>    </span><span class=nt>k8s-app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes-dashboard</span>
<a id=__codelineno-18-6 name=__codelineno-18-6 href=#__codelineno-18-6></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes-dashboard</span>
<a id=__codelineno-18-7 name=__codelineno-18-7 href=#__codelineno-18-7></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kube-system</span>
<a id=__codelineno-18-8 name=__codelineno-18-8 href=#__codelineno-18-8></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-18-9 name=__codelineno-18-9 href=#__codelineno-18-9></a><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">NodePort</span>
<a id=__codelineno-18-10 name=__codelineno-18-10 href=#__codelineno-18-10></a><span class=w>  </span><span class=nt>ports</span><span class=p>:</span>
<a id=__codelineno-18-11 name=__codelineno-18-11 href=#__codelineno-18-11></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">443</span>
<a id=__codelineno-18-12 name=__codelineno-18-12 href=#__codelineno-18-12></a><span class=w>      </span><span class=nt>targetPort</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">8443</span>
<a id=__codelineno-18-13 name=__codelineno-18-13 href=#__codelineno-18-13></a><span class=w>      </span><span class=nt>nodePort</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">30000</span>
<a id=__codelineno-18-14 name=__codelineno-18-14 href=#__codelineno-18-14></a><span class=w>  </span><span class=nt>selector</span><span class=p>:</span>
<a id=__codelineno-18-15 name=__codelineno-18-15 href=#__codelineno-18-15></a><span class=w>    </span><span class=nt>k8s-app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes-dashboard</span>
</code></pre></div> <div class="admonition example"> <p class=admonition-title>参考文献</p> <p><a href=https://www.qikqiak.com/k8strain/network/service/ >https://www.qikqiak.com/k8strain/network/service/</a></p> </div> <div class="admonition tip"> <p class=admonition-title>其他服务访问方式详情参见以下网址：</p> <p><a href=https://kubernetes.io/docs/concepts/services-networking/service/#publishing-services-service-types>https://kubernetes.io/docs/concepts/services-networking/service/#publishing-services-service-types</a></p> </div> <h3 id=28-kubernetes服务发现>2.8 Kubernetes服务发现<a class=headerlink href=#28-kubernetes服务发现 title="Permanent link">&para;</a></h3> <p>Kubernetes支持两种类型的服务发现：环境变量和DNS。</p> <h4 id=281-基于环境变量的服务发现>2.8.1 基于环境变量的服务发现<a class=headerlink href=#281-基于环境变量的服务发现 title="Permanent link">&para;</a></h4> <p>当Pod部署到一个Node节点后，该Node节点上的Kubelet会在该Pod内部设置一组环境变量， 这些环境变量是根据活跃的Service生成并以{SERVICE_NAME}<em>SERVICE_HOST和{SERVICE_NAME}_SERVICE_PORT格式命名的变量，其中服务名都转换为大写字母，“.”和“-”转换为“</em>”。 </p> <p>当一个Pod运行到节点时，kubelet会为每个容器添加一组环境变量，Pod容器中的程序就可以使用这些环境变量发现Service。</p> <p><code>busybox.yaml</code></p> <div class=highlight><pre><span></span><code><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span>
<a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-19-4 name=__codelineno-19-4 href=#__codelineno-19-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">busybox</span>
<a id=__codelineno-19-5 name=__codelineno-19-5 href=#__codelineno-19-5></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<a id=__codelineno-19-6 name=__codelineno-19-6 href=#__codelineno-19-6></a>
<a id=__codelineno-19-7 name=__codelineno-19-7 href=#__codelineno-19-7></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-19-8 name=__codelineno-19-8 href=#__codelineno-19-8></a><span class=w>  </span><span class=nt>containers</span><span class=p>:</span>
<a id=__codelineno-19-9 name=__codelineno-19-9 href=#__codelineno-19-9></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">busybox</span>
<a id=__codelineno-19-10 name=__codelineno-19-10 href=#__codelineno-19-10></a><span class=w>      </span><span class=nt>command</span><span class=p>:</span>
<a id=__codelineno-19-11 name=__codelineno-19-11 href=#__codelineno-19-11></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">sleep</span>
<a id=__codelineno-19-12 name=__codelineno-19-12 href=#__codelineno-19-12></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;3600&quot;</span>
<a id=__codelineno-19-13 name=__codelineno-19-13 href=#__codelineno-19-13></a><span class=w>      </span><span class=nt>imagePullPolicy</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
<a id=__codelineno-19-14 name=__codelineno-19-14 href=#__codelineno-19-14></a><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">busybox</span>
<a id=__codelineno-19-15 name=__codelineno-19-15 href=#__codelineno-19-15></a><span class=w>  </span><span class=nt>restartPolicy</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Always</span>
</code></pre></div> <div class=highlight><pre><span></span><code><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a><span class=o>[</span>root@ci-base<span class=w> </span>pod<span class=o>]</span><span class=c1># kubectl create -f busybox.yaml</span>
<a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a>pod/busybox<span class=w> </span>created
<a id=__codelineno-20-3 name=__codelineno-20-3 href=#__codelineno-20-3></a>
<a id=__codelineno-20-4 name=__codelineno-20-4 href=#__codelineno-20-4></a><span class=o>[</span>root@ci-base<span class=w> </span>pod<span class=o>]</span><span class=c1># kubectl get pod</span>
<a id=__codelineno-20-5 name=__codelineno-20-5 href=#__codelineno-20-5></a>NAME<span class=w>      </span>READY<span class=w>   </span>STATUS<span class=w>    </span>RESTARTS<span class=w>   </span>AGE
<a id=__codelineno-20-6 name=__codelineno-20-6 href=#__codelineno-20-6></a>busybox<span class=w>   </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>2s
<a id=__codelineno-20-7 name=__codelineno-20-7 href=#__codelineno-20-7></a>
<a id=__codelineno-20-8 name=__codelineno-20-8 href=#__codelineno-20-8></a><span class=o>[</span>root@ci-base<span class=w> </span>pod<span class=o>]</span><span class=c1># kubectl exec -it busybox sh</span>
<a id=__codelineno-20-9 name=__codelineno-20-9 href=#__codelineno-20-9></a>/<span class=w> </span><span class=c1># env</span>
<a id=__codelineno-20-10 name=__codelineno-20-10 href=#__codelineno-20-10></a><span class=nv>KUBERNETES_PORT</span><span class=o>=</span>tcp://10.96.0.1:443
<a id=__codelineno-20-11 name=__codelineno-20-11 href=#__codelineno-20-11></a><span class=nv>KUBERNETES_SERVICE_PORT</span><span class=o>=</span><span class=m>443</span>
<a id=__codelineno-20-12 name=__codelineno-20-12 href=#__codelineno-20-12></a><span class=nv>HOSTNAME</span><span class=o>=</span>busybox
<a id=__codelineno-20-13 name=__codelineno-20-13 href=#__codelineno-20-13></a><span class=nv>SHLVL</span><span class=o>=</span><span class=m>1</span>
<a id=__codelineno-20-14 name=__codelineno-20-14 href=#__codelineno-20-14></a><span class=nv>HOME</span><span class=o>=</span>/root
<a id=__codelineno-20-15 name=__codelineno-20-15 href=#__codelineno-20-15></a><span class=nv>HU_NGINX_PORT_80_TCP</span><span class=o>=</span>tcp://10.102.125.25:80
<a id=__codelineno-20-16 name=__codelineno-20-16 href=#__codelineno-20-16></a><span class=nv>HU_NGINX_PORT_443_TCP_ADDR</span><span class=o>=</span><span class=m>10</span>.102.125.25
<a id=__codelineno-20-17 name=__codelineno-20-17 href=#__codelineno-20-17></a><span class=nv>HU_NGINX_PORT_443_TCP_PORT</span><span class=o>=</span><span class=m>443</span>
<a id=__codelineno-20-18 name=__codelineno-20-18 href=#__codelineno-20-18></a><span class=nv>HU_NGINX_PORT_443_TCP_PROTO</span><span class=o>=</span>tcp
<a id=__codelineno-20-19 name=__codelineno-20-19 href=#__codelineno-20-19></a><span class=nv>HU_NGINX_SERVICE_PORT_HTTP</span><span class=o>=</span><span class=m>80</span>
<a id=__codelineno-20-20 name=__codelineno-20-20 href=#__codelineno-20-20></a><span class=nv>TERM</span><span class=o>=</span>xterm
<a id=__codelineno-20-21 name=__codelineno-20-21 href=#__codelineno-20-21></a><span class=nv>KUBERNETES_PORT_443_TCP_ADDR</span><span class=o>=</span><span class=m>10</span>.96.0.1
<a id=__codelineno-20-22 name=__codelineno-20-22 href=#__codelineno-20-22></a><span class=nv>HU_NGINX_SERVICE_PORT_HTTPS</span><span class=o>=</span><span class=m>443</span>
<a id=__codelineno-20-23 name=__codelineno-20-23 href=#__codelineno-20-23></a><span class=nv>HU_NGINX_PORT_443_TCP</span><span class=o>=</span>tcp://10.102.125.25:443
<a id=__codelineno-20-24 name=__codelineno-20-24 href=#__codelineno-20-24></a><span class=nv>PATH</span><span class=o>=</span>/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
<a id=__codelineno-20-25 name=__codelineno-20-25 href=#__codelineno-20-25></a><span class=nv>HU_NGINX_SERVICE_HOST</span><span class=o>=</span><span class=m>10</span>.102.125.25
<a id=__codelineno-20-26 name=__codelineno-20-26 href=#__codelineno-20-26></a><span class=nv>KUBERNETES_PORT_443_TCP_PORT</span><span class=o>=</span><span class=m>443</span>
<a id=__codelineno-20-27 name=__codelineno-20-27 href=#__codelineno-20-27></a><span class=nv>KUBERNETES_PORT_443_TCP_PROTO</span><span class=o>=</span>tcp
<a id=__codelineno-20-28 name=__codelineno-20-28 href=#__codelineno-20-28></a><span class=nv>HU_NGINX_SERVICE_PORT</span><span class=o>=</span><span class=m>80</span>
<a id=__codelineno-20-29 name=__codelineno-20-29 href=#__codelineno-20-29></a><span class=nv>HU_NGINX_PORT</span><span class=o>=</span>tcp://10.102.125.25:80
<a id=__codelineno-20-30 name=__codelineno-20-30 href=#__codelineno-20-30></a><span class=nv>KUBERNETES_PORT_443_TCP</span><span class=o>=</span>tcp://10.96.0.1:443
<a id=__codelineno-20-31 name=__codelineno-20-31 href=#__codelineno-20-31></a><span class=nv>KUBERNETES_SERVICE_PORT_HTTPS</span><span class=o>=</span><span class=m>443</span>
<a id=__codelineno-20-32 name=__codelineno-20-32 href=#__codelineno-20-32></a><span class=nv>KUBERNETES_SERVICE_HOST</span><span class=o>=</span><span class=m>10</span>.96.0.1
<a id=__codelineno-20-33 name=__codelineno-20-33 href=#__codelineno-20-33></a><span class=nv>PWD</span><span class=o>=</span>/
<a id=__codelineno-20-34 name=__codelineno-20-34 href=#__codelineno-20-34></a><span class=nv>HU_NGINX_PORT_80_TCP_ADDR</span><span class=o>=</span><span class=m>10</span>.102.125.25
<a id=__codelineno-20-35 name=__codelineno-20-35 href=#__codelineno-20-35></a><span class=nv>HU_NGINX_PORT_80_TCP_PORT</span><span class=o>=</span><span class=m>80</span>
<a id=__codelineno-20-36 name=__codelineno-20-36 href=#__codelineno-20-36></a><span class=nv>HU_NGINX_PORT_80_TCP_PROTO</span><span class=o>=</span>tcp
<a id=__codelineno-20-37 name=__codelineno-20-37 href=#__codelineno-20-37></a>
<a id=__codelineno-20-38 name=__codelineno-20-38 href=#__codelineno-20-38></a>/<span class=w> </span><span class=c1># echo ${HU_NGINX_SERVICE_HOST}</span>
<a id=__codelineno-20-39 name=__codelineno-20-39 href=#__codelineno-20-39></a><span class=m>10</span>.102.125.25
<a id=__codelineno-20-40 name=__codelineno-20-40 href=#__codelineno-20-40></a>/<span class=w> </span><span class=c1># echo ${HU_NGINX_SERVICE_PORT}</span>
<a id=__codelineno-20-41 name=__codelineno-20-41 href=#__codelineno-20-41></a><span class=m>80</span>
</code></pre></div> <div class=highlight><pre><span></span><code><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a><span class=o>[</span>root@ci-base<span class=w> </span>pod<span class=o>]</span><span class=c1># kubectl get svc</span>
<a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a>NAME<span class=w>         </span>TYPE<span class=w>        </span>CLUSTER-IP<span class=w>      </span>EXTERNAL-IP<span class=w>   </span>PORT<span class=o>(</span>S<span class=o>)</span><span class=w>          </span>AGE
<a id=__codelineno-21-3 name=__codelineno-21-3 href=#__codelineno-21-3></a>hu-nginx<span class=w>     </span>ClusterIP<span class=w>   </span><span class=m>10</span>.102.125.25<span class=w>   </span>&lt;none&gt;<span class=w>        </span><span class=m>80</span>/TCP,443/TCP<span class=w>   </span>7m52s
</code></pre></div> <div class="admonition warning"> <p class=admonition-title>注意</p> <ul> <li> <p>Pod和Service的创建顺序是有要求的，Service必须在Pod创建之前创建，新创建的Pod会自动注入Service的环境变量。必须先声明Service为Pod做代理，再创建Pod，这样Pod就有了Service的环境变量</p> </li> <li> <p>Pod只能获取同一Namespace中的Service的环境变量，如果Service和Pod跨命名空间，则无法获取环境变量。</p> </li> </ul> </div> <h4 id=2基于dns的服务发现>2．基于DNS的服务发现<a class=headerlink href=#2基于dns的服务发现 title="Permanent link">&para;</a></h4> <p>Kubernetes进行服务发现的另一种方式是基于Kubernetes内部的DNS记 录，新版Kubernetes默认使用CoreDNS作为集群的内部DNS， 一般CoreDNS的 Service地址为Service网段的第10个IP，比如10.96.0.10，端口53， 集群内Pod可通过该地址和端口进行Kubernetes内部的服务解析。</p> <p>DNS服务器监听 Kubernetes创建的Service，然后给每个Service添加一组DNS记录，集群中的 Pod就能通过Kubernetes内部的DNS解析到Service的IP，也就是Service的ClusterIP。</p> <p>为服务提供名称域名的访问。</p> <ul> <li>DNS服务监视Kubernetes API，为每一个Service创建DNS记录用于域名解析。</li> <li>ClusterIP A记录格式：<code>&lt;service-name&gt;.&lt;namespace-name&gt;.svc.cluster.local</code> 示例：my-svc.my-namespace.svc.cluster.local</li> </ul> <p>例如创建一个含有nslookup命令的容器 ， 测试解析kube-dns的Service（指定的Service名为kube-dns.kube-system，同一个命名空间下可以省略.kube-system）： <div class=highlight><pre><span></span><code><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a>$<span class=w> </span>kubectl<span class=w> </span>run<span class=w> </span>redis<span class=w> </span>--image<span class=o>=</span>redis:3.2.10-alpine
<a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>pod
<a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a>NAME<span class=w>    </span>READY<span class=w>   </span>STATUS<span class=w>    </span>RESTARTS<span class=w>   </span>AGE
<a id=__codelineno-22-4 name=__codelineno-22-4 href=#__codelineno-22-4></a>redis<span class=w>   </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>28s
<a id=__codelineno-22-5 name=__codelineno-22-5 href=#__codelineno-22-5></a>
<a id=__codelineno-22-6 name=__codelineno-22-6 href=#__codelineno-22-6></a>
<a id=__codelineno-22-7 name=__codelineno-22-7 href=#__codelineno-22-7></a>$<span class=w> </span>kubectl<span class=w> </span><span class=nb>exec</span><span class=w> </span>-ti<span class=w> </span>redis<span class=w> </span>--<span class=w> </span>nslookup<span class=w> </span>kube-dns.kube-system
<a id=__codelineno-22-8 name=__codelineno-22-8 href=#__codelineno-22-8></a>nslookup:<span class=w> </span>can<span class=s1>&#39;t resolve &#39;</span><span class=o>(</span>null<span class=o>)</span><span class=err>&#39;</span>:<span class=w> </span>Name<span class=w> </span>does<span class=w> </span>not<span class=w> </span>resolve
<a id=__codelineno-22-9 name=__codelineno-22-9 href=#__codelineno-22-9></a>
<a id=__codelineno-22-10 name=__codelineno-22-10 href=#__codelineno-22-10></a>Name:<span class=w>      </span>kube-dns.kube-system
<a id=__codelineno-22-11 name=__codelineno-22-11 href=#__codelineno-22-11></a>Address<span class=w> </span><span class=m>1</span>:<span class=w> </span><span class=m>10</span>.96.0.10<span class=w> </span>kube-dns.kube-system.svc.cluster.local
</code></pre></div></p> <p>Kubernetes还支持命名端口的DNS SRV（服务)记录，如果一个服务有一个TCP端口，并且该端口的名称为http， 则可以使用"_http._tcp.{SERVICE_NAME}.{SERVICE_NAMESPACE}"执行DNS SRV查询，以查询该Service的IP和端口。</p> <p>Kubernetes目前支持环境变量和DNS两种简单的服务发现，两种方式各有 优缺点，其中环境变量形式需要开发人员自行实现变量的解析， 而基于DNS的 服务发现不需要多余的代码，直接通过http://SERVICE_NAME:SERVICE_PORT 即可调用其他组件，但是会有一些网络上的消耗。 相对于Kubernetes的服务发现，业界更常用的可能是基于Spring Cloud的Eureka，或者是Consul等工具实现微服务的自动发现， 不过并不是所有的项目都是基于Spring Cloud全家桶进行开发的，而使用其他工具或Kubernetes环境变量进行服务发现， 也会带来实现服务发现逻辑代码时间上的消耗，所以可能基于Kubernetes DNS的服务发现更为简单高效。</p> <h2 id=3ingress>3.Ingress<a class=headerlink href=#3ingress title="Permanent link">&para;</a></h2> <p>Ingress为Kubernetes集群中的服务提供了入口，可以提供负载均衡、 SSL终止和基于名称（域名）的虚拟主机、应用的灰度发布等功能，在生产环 境中常用的Ingress有Treafik、Nginx、HAProxy、Istio等。</p> <h3 id=31-基本概念>3.1 基本概念<a class=headerlink href=#31-基本概念 title="Permanent link">&para;</a></h3> <p>上一节讲解Service时，我们可以通过NodePort类型的Service在集群外 部访问Kubernetes集群内的应用，然而通过IP地址+端口的访问模式并不是应 用发布的最佳实践，也不是推荐的发布方式，相对于IP地址，我们更喜欢在 浏览器输入域名访问应用， 那么在Kubernetes集群中如何使用域名发布服务呢？</p> <p>在没有使用Kubernetes的传统架构中，部署一个应用并使用域名进行发 布的流程如下：</p> <p>1）部署应用至宿主机，启动应用并暴露一个端口号。</p> <p>2）通过Nginx或其他代理工具配置域名，并代理至后端应用。</p> <p>3）在域名厂商进行域名解析，设置DNS记录至Nginx或其他代理工具</p> <p>(Nginx的前面可能还有其他代理服务器，在此不进行说明)的服务器上，之后就能通过域名访问我们的应用。</p> <p>在使用Kubernetes时，部署一个应用并使用域名进行发布的流程如下： 1）部署应用至Kubernetes集群，容器内定义了程序启动的方式。</p> <p>2）配置ClusterIP类型的Service，通过Selector链接到容器内的应用。</p> <p>3）配置Ingress链接到该应用的Service，之后将域名解析到Ingress(Ingress前面可能还有其他代理服务器)对应的宿主机上即可。</p> <p>此时在Kubernetes中对应的架构图如图6.3所示。</p> <p><img alt class=zoom src=../../../assets/static/kubernetes/2/6-3-ingress.png></p> <p>图6.3 Ingress代理模式</p> <p>那Ingress到底是什么呢？</p> <p>通俗来讲，Ingress和之前提到的Service、Deployment等类似，也是一个Kubernetes的资源对象，Deployment是用来部署应用的，Ingress就是实现用域名的方式访问应用。</p> <p>Ingress实现的方式有很多，比如Nginx、HAProxy、 Treafik等，就Nginx而言 ，和上述提到的传统服务架构用Nginx类似 。</p> <p>Ingress控制器在每个符合条件的宿主机上部署一个Pod，这个Pod里面运行的 就是Nginx进程，里面的实现逻辑和宿主机部署Nginx的方式并无太大区别， 关键区别是宿主机部署的Nginx需要更改Nginx的配置文件配置域名， 而Ingress则和其他Kubernetes资源文件一样，使用YAML文件进行配置，之后 Ingress控制器根据YAML文件定义的内容自动生成对应的配置文件。</p> <p>在Kubernetes v1.1版中正式引用Ingress的概念，用于从集群外部到集 群内部Service的HTTP和HTTPS路由，可以配置提供服务外部访问的URL、负载 均衡和终止SSL，并提供基于域名的虚拟主机。流量从Internet到Ingress再 到Services最后到Pod上，通常情况下，Ingress部署在所有的Node节点上， 暴露443和80端口（一般通过hostNetwork的方式部署Ingress),之后再通过F5或公有云LB代理到对应的Ingress节点上，之后将域名解析到F5或公有云LB即可实现基于域名的服务发布。</p> <div class="admonition abstract"> <p class=admonition-title>Ingress选型</p> <p>参考文献</p> <ul> <li><a href=https://www.yuque.com/coolops/kubernetes/uung6g>https://www.yuque.com/coolops/kubernetes/uung6g</a></li> <li><a href=https://www.yuque.com/cuiliang0302/kubernets/qc173m>https://www.yuque.com/cuiliang0302/kubernets/qc173m</a></li> <li><a href=https://www.qikqiak.com/k8strain/network/ingress/nginx/ >https://www.qikqiak.com/k8strain/network/ingress/nginx/</a></li> </ul> </div> <div class="admonition abstract"> <p class=admonition-title><strong>Nginx Ingress奇巧淫技</strong></p> <p><a href=https://www.yuque.com/coolops/kubernetes/ke3qu2>https://www.yuque.com/coolops/kubernetes/ke3qu2</a></p> </div> <h3 id=32-创建一个ingress>3.2 创建一个Ingress<a class=headerlink href=#32-创建一个ingress title="Permanent link">&para;</a></h3> <p>创建Ingress和创建其他资源类似，也是使用YAML格式的文件。</p> <p>创建一个简单的Ingress代码如下 (Kubernetes版本小于1.22时，APIVersion为 networking.k8s.io/v1beta1,大于等于1.22版本时必须为networking.k8s.io/v1,最早期的版本还有extensions/v1beta1，在此不再说明）：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1beta1</span>
<a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span>
<a id=__codelineno-23-3 name=__codelineno-23-3 href=#__codelineno-23-3></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-23-4 name=__codelineno-23-4 href=#__codelineno-23-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">simple-fanout-example</span>
<a id=__codelineno-23-5 name=__codelineno-23-5 href=#__codelineno-23-5></a><span class=w>  </span><span class=nt>annotations</span><span class=p>:</span>
<a id=__codelineno-23-6 name=__codelineno-23-6 href=#__codelineno-23-6></a><span class=w>    </span><span class=nt>kubernetes.io/ingress.class</span><span class=p>:</span><span class=w> </span><span class=s>&quot;nginx&quot;</span><span class=w> </span><span class=c1># 不同的controller，ingress.class可能不一致</span>
<a id=__codelineno-23-7 name=__codelineno-23-7 href=#__codelineno-23-7></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-23-8 name=__codelineno-23-8 href=#__codelineno-23-8></a><span class=w>  </span><span class=nt>rules</span><span class=p>:</span>
<a id=__codelineno-23-9 name=__codelineno-23-9 href=#__codelineno-23-9></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>host</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">foo.bar.com</span>
<a id=__codelineno-23-10 name=__codelineno-23-10 href=#__codelineno-23-10></a><span class=w>    </span><span class=nt>http</span><span class=p>:</span>
<a id=__codelineno-23-11 name=__codelineno-23-11 href=#__codelineno-23-11></a><span class=w>      </span><span class=nt>paths</span><span class=p>:</span>
<a id=__codelineno-23-12 name=__codelineno-23-12 href=#__codelineno-23-12></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/foo</span>
<a id=__codelineno-23-13 name=__codelineno-23-13 href=#__codelineno-23-13></a><span class=w>        </span><span class=nt>pathType</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Prefix</span>
<a id=__codelineno-23-14 name=__codelineno-23-14 href=#__codelineno-23-14></a><span class=w>        </span><span class=nt>backend</span><span class=p>:</span>
<a id=__codelineno-23-15 name=__codelineno-23-15 href=#__codelineno-23-15></a><span class=w>          </span><span class=nt>serviceName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">service1</span>
<a id=__codelineno-23-16 name=__codelineno-23-16 href=#__codelineno-23-16></a><span class=w>          </span><span class=nt>servicePort</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">4200</span>
<a id=__codelineno-23-17 name=__codelineno-23-17 href=#__codelineno-23-17></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/bar</span>
<a id=__codelineno-23-18 name=__codelineno-23-18 href=#__codelineno-23-18></a><span class=w>        </span><span class=nt>pathType</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ImplementationSpecific</span>
<a id=__codelineno-23-19 name=__codelineno-23-19 href=#__codelineno-23-19></a><span class=w>        </span><span class=nt>backend</span><span class=p>:</span>
<a id=__codelineno-23-20 name=__codelineno-23-20 href=#__codelineno-23-20></a><span class=w>          </span><span class=nt>serviceName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">service2</span>
<a id=__codelineno-23-21 name=__codelineno-23-21 href=#__codelineno-23-21></a><span class=w>          </span><span class=nt>servicePort</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
</code></pre></div> <p>上述host定义该Ingress的域名，将其解析至任意部署了Ingress控制器 的Node上即可访问，</p> <p>如果访问的是foo.bar.com/foo，则被转发到service1的4200端口， 如果访问的是foo.bar.com/bar，则被转发到service2的8080端口。</p> <p><strong>当集群版本大于等于1.19时，Ingress的APIVersion变为了v1版本（1.22后废弃了v1beta1）</strong>，对应的配置也有一些变化，代码如下：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span><span class=w> </span><span class=c1># 1.19+</span>
<a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span>
<a id=__codelineno-24-3 name=__codelineno-24-3 href=#__codelineno-24-3></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-24-4 name=__codelineno-24-4 href=#__codelineno-24-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">simple-fanout-example</span>
<a id=__codelineno-24-5 name=__codelineno-24-5 href=#__codelineno-24-5></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-24-6 name=__codelineno-24-6 href=#__codelineno-24-6></a><span class=w>  </span><span class=nt>ingressClassName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<a id=__codelineno-24-7 name=__codelineno-24-7 href=#__codelineno-24-7></a><span class=w>  </span><span class=nt>rules</span><span class=p>:</span>
<a id=__codelineno-24-8 name=__codelineno-24-8 href=#__codelineno-24-8></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>host</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">foo.bar.com</span>
<a id=__codelineno-24-9 name=__codelineno-24-9 href=#__codelineno-24-9></a><span class=w>    </span><span class=nt>http</span><span class=p>:</span>
<a id=__codelineno-24-10 name=__codelineno-24-10 href=#__codelineno-24-10></a><span class=w>      </span><span class=nt>paths</span><span class=p>:</span>
<a id=__codelineno-24-11 name=__codelineno-24-11 href=#__codelineno-24-11></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/foo</span>
<a id=__codelineno-24-12 name=__codelineno-24-12 href=#__codelineno-24-12></a><span class=w>        </span><span class=nt>backend</span><span class=p>:</span>
<a id=__codelineno-24-13 name=__codelineno-24-13 href=#__codelineno-24-13></a><span class=w>          </span><span class="l l-Scalar l-Scalar-Plain">service</span>
<a id=__codelineno-24-14 name=__codelineno-24-14 href=#__codelineno-24-14></a><span class=w>             </span><span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">service1</span>
<a id=__codelineno-24-15 name=__codelineno-24-15 href=#__codelineno-24-15></a><span class=w>             </span><span class="l l-Scalar l-Scalar-Plain">port</span><span class="p p-Indicator">:</span>
<a id=__codelineno-24-16 name=__codelineno-24-16 href=#__codelineno-24-16></a><span class=w>               </span><span class=nt>number</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">4200</span>
</code></pre></div> <h3 id=33-ingress使用入门>3.3 Ingress使用入门<a class=headerlink href=#33-ingress使用入门 title="Permanent link">&para;</a></h3> <h4 id=1单域名>1.单域名<a class=headerlink href=#1单域名 title="Permanent link">&para;</a></h4> <p>一个比较常见的配置是单个域名匹配多个path到不同的Service（Kubernetes 1.19版本以上可以参考前文）：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1beta1</span>
<a id=__codelineno-25-2 name=__codelineno-25-2 href=#__codelineno-25-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span>
<a id=__codelineno-25-3 name=__codelineno-25-3 href=#__codelineno-25-3></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-25-4 name=__codelineno-25-4 href=#__codelineno-25-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">simple-fanout-example</span>
<a id=__codelineno-25-5 name=__codelineno-25-5 href=#__codelineno-25-5></a><span class=w>  </span><span class=nt>annotations</span><span class=p>:</span>
<a id=__codelineno-25-6 name=__codelineno-25-6 href=#__codelineno-25-6></a><span class=w>    </span><span class=nt>nginx.ingress.kubernetes.io/rewrite-target</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/</span>
<a id=__codelineno-25-7 name=__codelineno-25-7 href=#__codelineno-25-7></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-25-8 name=__codelineno-25-8 href=#__codelineno-25-8></a><span class=w>  </span><span class=nt>rules</span><span class=p>:</span>
<a id=__codelineno-25-9 name=__codelineno-25-9 href=#__codelineno-25-9></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>host</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">foo.bar.com</span>
<a id=__codelineno-25-10 name=__codelineno-25-10 href=#__codelineno-25-10></a><span class=w>    </span><span class=nt>http</span><span class=p>:</span>
<a id=__codelineno-25-11 name=__codelineno-25-11 href=#__codelineno-25-11></a><span class=w>      </span><span class=nt>paths</span><span class=p>:</span>
<a id=__codelineno-25-12 name=__codelineno-25-12 href=#__codelineno-25-12></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/foo</span>
<a id=__codelineno-25-13 name=__codelineno-25-13 href=#__codelineno-25-13></a><span class=w>        </span><span class=nt>backend</span><span class=p>:</span>
<a id=__codelineno-25-14 name=__codelineno-25-14 href=#__codelineno-25-14></a><span class=w>          </span><span class=nt>serviceName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">service1</span>
<a id=__codelineno-25-15 name=__codelineno-25-15 href=#__codelineno-25-15></a><span class=w>          </span><span class=nt>servicePort</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">4200</span>
<a id=__codelineno-25-16 name=__codelineno-25-16 href=#__codelineno-25-16></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/bar</span>
<a id=__codelineno-25-17 name=__codelineno-25-17 href=#__codelineno-25-17></a><span class=w>        </span><span class=nt>backend</span><span class=p>:</span>
<a id=__codelineno-25-18 name=__codelineno-25-18 href=#__codelineno-25-18></a><span class=w>          </span><span class=nt>serviceName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">service2</span>
<a id=__codelineno-25-19 name=__codelineno-25-19 href=#__codelineno-25-19></a><span class=w>          </span><span class=nt>servicePort</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
</code></pre></div> <p>此时，访问foo.bar.com/foo到service1的4200，访问foo.bar.com/bar到service2的8080。</p> <h4 id=2多域名>2.多域名<a class=headerlink href=#2多域名 title="Permanent link">&para;</a></h4> <p>也支持和Nginx一样的多域名配置，也就是基于域名的虚拟主机，支持将HTTP流量路由到同一IP地址的多个主机名（Kubernetes 1.19以上版本可以参考前文）：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1beta1</span>
<a id=__codelineno-26-2 name=__codelineno-26-2 href=#__codelineno-26-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span>
<a id=__codelineno-26-3 name=__codelineno-26-3 href=#__codelineno-26-3></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-26-4 name=__codelineno-26-4 href=#__codelineno-26-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">name-virtual-host-ingress</span>
<a id=__codelineno-26-5 name=__codelineno-26-5 href=#__codelineno-26-5></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-26-6 name=__codelineno-26-6 href=#__codelineno-26-6></a><span class=w>  </span><span class=nt>rules</span><span class=p>:</span>
<a id=__codelineno-26-7 name=__codelineno-26-7 href=#__codelineno-26-7></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>host</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">foo.bar.com</span>
<a id=__codelineno-26-8 name=__codelineno-26-8 href=#__codelineno-26-8></a><span class=w>    </span><span class=nt>http</span><span class=p>:</span>
<a id=__codelineno-26-9 name=__codelineno-26-9 href=#__codelineno-26-9></a><span class=w>      </span><span class=nt>paths</span><span class=p>:</span>
<a id=__codelineno-26-10 name=__codelineno-26-10 href=#__codelineno-26-10></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>backend</span><span class=p>:</span>
<a id=__codelineno-26-11 name=__codelineno-26-11 href=#__codelineno-26-11></a><span class=w>          </span><span class=nt>serviceName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">service1</span>
<a id=__codelineno-26-12 name=__codelineno-26-12 href=#__codelineno-26-12></a><span class=w>          </span><span class=nt>servicePort</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<a id=__codelineno-26-13 name=__codelineno-26-13 href=#__codelineno-26-13></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>host</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">bar.foo.com</span>
<a id=__codelineno-26-14 name=__codelineno-26-14 href=#__codelineno-26-14></a><span class=w>    </span><span class=nt>http</span><span class=p>:</span>
<a id=__codelineno-26-15 name=__codelineno-26-15 href=#__codelineno-26-15></a><span class=w>      </span><span class=nt>paths</span><span class=p>:</span>
<a id=__codelineno-26-16 name=__codelineno-26-16 href=#__codelineno-26-16></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>backend</span><span class=p>:</span>
<a id=__codelineno-26-17 name=__codelineno-26-17 href=#__codelineno-26-17></a><span class=w>          </span><span class=nt>serviceName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">service2</span>
<a id=__codelineno-26-18 name=__codelineno-26-18 href=#__codelineno-26-18></a><span class=w>          </span><span class=nt>servicePort</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
</code></pre></div> <p>此时，访问foo.bar.com到service1，访问bar.foo.com到service2。</p> <h4 id=3基于tls的ingress>3.基于TLS的Ingress<a class=headerlink href=#3基于tls的ingress title="Permanent link">&para;</a></h4> <p>生产环境的域名大部分都是HTTPS的，Ingress也支持HTTPS类型的域名。首先创建证书，生产环境的证书为公司购买的证书：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a>$<span class=w> </span>kubectl<span class=w> </span>-n<span class=w> </span>default<span class=w> </span>create<span class=w> </span>secret<span class=w> </span>tls<span class=w> </span>nginx-test-tls<span class=w> </span>--key<span class=o>=</span>tls.key<span class=w> </span>--cert<span class=o>=</span>tls.crt
</code></pre></div> <p>定义Ingress（Kubernetes 1.19以上版本可以参考前文）：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1beta1</span>
<a id=__codelineno-28-2 name=__codelineno-28-2 href=#__codelineno-28-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span>
<a id=__codelineno-28-3 name=__codelineno-28-3 href=#__codelineno-28-3></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-28-4 name=__codelineno-28-4 href=#__codelineno-28-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx-https-test</span>
<a id=__codelineno-28-5 name=__codelineno-28-5 href=#__codelineno-28-5></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<a id=__codelineno-28-6 name=__codelineno-28-6 href=#__codelineno-28-6></a><span class=w>  </span><span class=nt>annotations</span><span class=p>:</span>
<a id=__codelineno-28-7 name=__codelineno-28-7 href=#__codelineno-28-7></a><span class=w>    </span><span class=nt>kubernetes.io/ingress.class</span><span class=p>:</span><span class=w> </span><span class=s>&quot;nginx&quot;</span>
<a id=__codelineno-28-8 name=__codelineno-28-8 href=#__codelineno-28-8></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-28-9 name=__codelineno-28-9 href=#__codelineno-28-9></a><span class=w>  </span><span class=nt>rules</span><span class=p>:</span>
<a id=__codelineno-28-10 name=__codelineno-28-10 href=#__codelineno-28-10></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>host</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">https-test.com</span>
<a id=__codelineno-28-11 name=__codelineno-28-11 href=#__codelineno-28-11></a><span class=w>    </span><span class=nt>http</span><span class=p>:</span>
<a id=__codelineno-28-12 name=__codelineno-28-12 href=#__codelineno-28-12></a><span class=w>      </span><span class=nt>paths</span><span class=p>:</span>
<a id=__codelineno-28-13 name=__codelineno-28-13 href=#__codelineno-28-13></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>backend</span><span class=p>:</span>
<a id=__codelineno-28-14 name=__codelineno-28-14 href=#__codelineno-28-14></a><span class=w>          </span><span class=nt>serviceName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx-svc</span>
<a id=__codelineno-28-15 name=__codelineno-28-15 href=#__codelineno-28-15></a><span class=w>          </span><span class=nt>servicePort</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<a id=__codelineno-28-16 name=__codelineno-28-16 href=#__codelineno-28-16></a><span class=w>  </span><span class=nt>tls</span><span class=p>:</span>
<a id=__codelineno-28-17 name=__codelineno-28-17 href=#__codelineno-28-17></a><span class=w>   </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>secretName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx-test-tls</span>
</code></pre></div> <blockquote> <p>提示 tls为域名证书配置项，一个Ingress可以定义多个tls类型的Secret。</p> </blockquote> <h3 id=34-更新ingress>3.4 更新Ingress<a class=headerlink href=#34-更新ingress title="Permanent link">&para;</a></h3> <p>更新Ingress可以直接使用<code>kubectl edit ingress INGRESS-NAME</code>进行更改，也可以通过<code>kubectl apply/replace -f NEW-INGRESS-YAML.yaml</code>进行更改。</p> <p>本章只介绍了Ingress的基本概念，更多Ingress的配置请参考Ingress Nginx进阶一章（本书第16章）的内容。</p> <h2 id=4小结>4.小结<a class=headerlink href=#4小结 title="Permanent link">&para;</a></h2> <p>本章讲解了服务发布的两种方式，即Service和Ingress。 通常情况下， Service用于程序间的内部访问，即后端服务之间的相互调用。 而Ingress多 用于对外发布服务，即通过域名的形式让用户能访问到内部服务，这也是最普遍的发布方式， 但是如果一个不需要对外发布的后端服务，通过Ingress被另一个后端服务调用，则相当于从外部绕了一圈，这不是推荐的方式。</p> <p>实际使用时，也会有架构直接通过Service的NodePort暴露服务，然后由 上层的网关进行代理，域名都配置在上层，这样的话，服务过多会引起端口 维护非常复杂，可能还会有性能损耗。</p> <p>所以一般推荐在上层配置通配符域名，比如*.test.com到Kubernetes的Ingress Controller，之后由Ingress再做路由。比如a.test.com指向A项目，a.test.com/xxx指向A项目的xxx服务。</p> <p>另外在程序设计时，有了Service无须再考虑负载均衡等问题，所以如果有程序间的调用，首选Service，并且以后可以无缝地接入服务网格，进行服 务治理。</p> <p>在使用Kubernetes时，其实并不推荐使用Spring Cloud这类架构， 因为很多功能都是类似的， 在Kubernetes上仍旧使用Spring Cloud属于“套娃”型架构，应该向着单服务方向进行开发，比如直接使用Spring Boot即可。</p> <hr> <div class=md-source-file> <small> 最后更新: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime">March 26, 2023 18:26:01</span> <br> 创建日期: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime">March 23, 2023 18:59:28</span> </small> </div> <form class=md-feedback name=feedback hidden> <fieldset> <legend class=md-feedback__title> Was this page helpful? </legend> <div class=md-feedback__inner> <div class=md-feedback__list> <button class="md-feedback__icon md-icon" type=submit title="This page was helpful" data-md-value=1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m7 0c0 .8-.7 1.5-1.5 1.5S14 10.3 14 9.5 14.7 8 15.5 8s1.5.7 1.5 1.5m-5 7.73c-1.75 0-3.29-.73-4.19-1.81L9.23 14c.45.72 1.52 1.23 2.77 1.23s2.32-.51 2.77-1.23l1.42 1.42c-.9 1.08-2.44 1.81-4.19 1.81Z"/></svg> </button> <button class="md-feedback__icon md-icon" type=submit title="This page could be improved" data-md-value=0> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10m-6.5-4c.8 0 1.5.7 1.5 1.5s-.7 1.5-1.5 1.5-1.5-.7-1.5-1.5.7-1.5 1.5-1.5M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m2 4.5c1.75 0 3.29.72 4.19 1.81l-1.42 1.42C14.32 16.5 13.25 16 12 16s-2.32.5-2.77 1.23l-1.42-1.42C8.71 14.72 10.25 14 12 14Z"/></svg> </button> </div> <div class=md-feedback__note> <div data-md-value=1 hidden> Thanks for your feedback! </div> <div data-md-value=0 hidden> Thanks for your feedback! Help us improve this page by using our <a href="https://github.com/hujianli94/hujianli94.github.io/issues/new/?title=[Feedback]+Kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83%E5%9F%BA%E7%A1%80+-+/Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/6.Kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83%E5%9F%BA%E7%A1%80/" target=_blank>feedback form</a>. </div> </div> </div> </fieldset> </form> </article> </div> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> 回到页面顶部 </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=页脚> <a href=../5.Kubernetes%E8%B0%83%E5%BA%A6%E5%9F%BA%E7%A1%80/ class="md-footer__link md-footer__link--prev" aria-label="上一页: Kubernetes调度基础" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> 上一页 </span> Kubernetes调度基础 </div> </div> </a> <a href=../7.Kubernetes%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/ class="md-footer__link md-footer__link--next" aria-label="下一页: Kubernetes配置管理" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> 下一页 </span> Kubernetes配置管理 </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2023 - 2024 hujainli94 </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/hujianli94 target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> <a href=https://kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com/blog_img/20220125122524.png target=_blank rel=noopener title=kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 576 512"><!-- Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M385.2 167.6c6.4 0 12.6.3 18.8 1.1C387.4 90.3 303.3 32 207.7 32 100.5 32 13 104.8 13 197.4c0 53.4 29.3 97.5 77.9 131.6l-19.3 58.6 68-34.1c24.4 4.8 43.8 9.7 68.2 9.7 6.2 0 12.1-.3 18.3-.8-4-12.9-6.2-26.6-6.2-40.8-.1-84.9 72.9-154 165.3-154zm-104.5-52.9c14.5 0 24.2 9.7 24.2 24.4 0 14.5-9.7 24.2-24.2 24.2-14.8 0-29.3-9.7-29.3-24.2.1-14.7 14.6-24.4 29.3-24.4zm-136.4 48.6c-14.5 0-29.3-9.7-29.3-24.2 0-14.8 14.8-24.4 29.3-24.4 14.8 0 24.4 9.7 24.4 24.4 0 14.6-9.6 24.2-24.4 24.2zM563 319.4c0-77.9-77.9-141.3-165.4-141.3-92.7 0-165.4 63.4-165.4 141.3S305 460.7 397.6 460.7c19.3 0 38.9-5.1 58.6-9.9l53.4 29.3-14.8-48.6C534 402.1 563 363.2 563 319.4zm-219.1-24.5c-9.7 0-19.3-9.7-19.3-19.6 0-9.7 9.7-19.3 19.3-19.3 14.8 0 24.4 9.7 24.4 19.3 0 10-9.7 19.6-24.4 19.6zm107.1 0c-9.7 0-19.3-9.7-19.3-19.6 0-9.7 9.7-19.3 19.3-19.3 14.5 0 24.4 9.7 24.4 19.3.1 10-9.9 19.6-24.4 19.6z"/></svg> </a> <a href="mailto:<1879324764@qq.com>" target=_blank rel=noopener title=发送邮件 class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M498.1 5.6c10.1 7 15.4 19.1 13.5 31.2l-64 416c-1.5 9.7-7.4 18.2-16 23s-18.9 5.4-28 1.6L284 427.7l-68.5 74.1c-8.9 9.7-22.9 12.9-35.2 8.1S160 493.2 160 480v-83.6c0-4 1.5-7.8 4.2-10.7l167.6-182.9c5.8-6.3 5.6-16-.4-22s-15.7-6.4-22-.7L106 360.8l-88.3-44.2C7.1 311.3.3 300.7 0 288.9s5.9-22.8 16.1-28.7l448-256c10.7-6.1 23.9-5.5 34 1.4z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-consent data-md-component=consent id=__consent hidden> <div class=md-consent__overlay></div> <aside class=md-consent__inner> <form class="md-consent__form md-grid md-typeset" name=consent> <h4>Cookie consent</h4> <p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p> <input class=md-toggle type=checkbox id=__settings> <div class=md-consent__settings> <ul class=task-list> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=analytics checked> <span class=task-list-indicator></span> Google Analytics </label> </li> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=github checked> <span class=task-list-indicator></span> GitHub </label> </li> </ul> </div> <div class=md-consent__controls> <button class="md-button md-button--primary">同意</button> <label class=md-button for=__settings>管理设定</label> </div> </form> </aside> </div> <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout(function(){document.querySelector("[data-md-component=consent]").hidden=!1},250);var action,form=document.forms.consent;for(action of["submit","reset"])form.addEventListener(action,function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map(function(e){return[e,!0]}))),location.hash="",location.reload()})</script> <script id=__config type=application/json>{"base": "../../..", "features": ["content.action.edit", "content.action.view", "content.code.copy", "content.code.annotate", "navigation.indexes", "navigation.footer", "navigation.indexes", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest"], "search": "../../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script> <script src=../../../assets/javascripts/bundle.19047be9.min.js></script> <script src=../../../javascripts/extra.js></script> <script src=https://file.cdn.shafish.cn/blog/js/video.min.js></script> </body> </html>