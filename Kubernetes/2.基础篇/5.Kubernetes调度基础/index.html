<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="stay hungry,stay foolish"><meta name=author content=hujainli94><link href=https://hujianli94.github.io/Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Kubernetes%E8%B0%83%E5%BA%A6%E5%9F%BA%E7%A1%80/ rel=canonical><link href=../4.Kubernetes%E7%9A%84%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/ rel=prev><link href=../6.Kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83%E5%9F%BA%E7%A1%80/ rel=next><link rel=icon href=../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.5.2, mkdocs-material-9.1.21"><title>Kubernetes调度基础 - DevOps运维开发</title><link rel=stylesheet href=../../../assets/stylesheets/main.eebd395e.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.ecc896b0.min.css><style>:root{--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M1 7.775V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 0 1 0 2.474l-5.026 5.026a1.75 1.75 0 0 1-2.474 0l-6.25-6.25A1.752 1.752 0 0 1 1 7.775Zm1.5 0c0 .066.026.13.073.177l6.25 6.25a.25.25 0 0 0 .354 0l5.025-5.025a.25.25 0 0 0 0-.354l-6.25-6.25a.25.25 0 0 0-.177-.073H2.75a.25.25 0 0 0-.25.25ZM6 5a1 1 0 1 1 0 2 1 1 0 0 1 0-2Z"/></svg>');--md-admonition-icon--abstract:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M2.5 1.75v11.5c0 .138.112.25.25.25h3.17a.75.75 0 0 1 0 1.5H2.75A1.75 1.75 0 0 1 1 13.25V1.75C1 .784 1.784 0 2.75 0h8.5C12.216 0 13 .784 13 1.75v7.736a.75.75 0 0 1-1.5 0V1.75a.25.25 0 0 0-.25-.25h-8.5a.25.25 0 0 0-.25.25Zm13.274 9.537v-.001l-4.557 4.45a.75.75 0 0 1-1.055-.008l-1.943-1.95a.75.75 0 0 1 1.062-1.058l1.419 1.425 4.026-3.932a.75.75 0 1 1 1.048 1.074ZM4.75 4h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM4 7.75A.75.75 0 0 1 4.75 7h2a.75.75 0 0 1 0 1.5h-2A.75.75 0 0 1 4 7.75Z"/></svg>');--md-admonition-icon--info:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"/></svg>');--md-admonition-icon--tip:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M3.499.75a.75.75 0 0 1 1.5 0v.996C5.9 2.903 6.793 3.65 7.662 4.376l.24.202c-.036-.694.055-1.422.426-2.163C9.1.873 10.794-.045 12.622.26 14.408.558 16 1.94 16 4.25c0 1.278-.954 2.575-2.44 2.734l.146.508.065.22c.203.701.412 1.455.476 2.226.142 1.707-.4 3.03-1.487 3.898C11.714 14.671 10.27 15 8.75 15h-6a.75.75 0 0 1 0-1.5h1.376a4.484 4.484 0 0 1-.563-1.191 3.835 3.835 0 0 1-.05-2.063 4.647 4.647 0 0 1-2.025-.293.75.75 0 0 1 .525-1.406c1.357.507 2.376-.006 2.698-.318l.009-.01a.747.747 0 0 1 1.06 0 .748.748 0 0 1-.012 1.074c-.912.92-.992 1.835-.768 2.586.221.74.745 1.337 1.196 1.621H8.75c1.343 0 2.398-.296 3.074-.836.635-.507 1.036-1.31.928-2.602-.05-.603-.216-1.224-.422-1.93l-.064-.221c-.12-.407-.246-.84-.353-1.29a2.425 2.425 0 0 1-.507-.441 3.075 3.075 0 0 1-.633-1.248.75.75 0 0 1 1.455-.364c.046.185.144.436.31.627.146.168.353.305.712.305.738 0 1.25-.615 1.25-1.25 0-1.47-.95-2.315-2.123-2.51-1.172-.196-2.227.387-2.706 1.345-.46.92-.27 1.774.019 3.062l.042.19a.884.884 0 0 1 .01.05c.348.443.666.949.94 1.553a.75.75 0 1 1-1.365.62c-.553-1.217-1.32-1.94-2.3-2.768L6.7 5.527c-.814-.68-1.75-1.462-2.692-2.619a3.737 3.737 0 0 0-1.023.88c-.406.495-.663 1.036-.722 1.508.116.122.306.21.591.239.388.038.797-.06 1.032-.19a.75.75 0 0 1 .728 1.31c-.515.287-1.23.439-1.906.373-.682-.067-1.473-.38-1.879-1.193L.75 5.677V5.5c0-.984.48-1.94 1.077-2.664.46-.559 1.05-1.055 1.673-1.353V.75Z"/></svg>');--md-admonition-icon--success:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"/></svg>');--md-admonition-icon--question:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.92 6.085h.001a.749.749 0 1 1-1.342-.67c.169-.339.436-.701.849-.977C6.845 4.16 7.369 4 8 4a2.756 2.756 0 0 1 1.637.525c.503.377.863.965.863 1.725 0 .448-.115.83-.329 1.15-.205.307-.47.513-.692.662-.109.072-.22.138-.313.195l-.006.004a6.24 6.24 0 0 0-.26.16.952.952 0 0 0-.276.245.75.75 0 0 1-1.248-.832c.184-.264.42-.489.692-.661.103-.067.207-.132.313-.195l.007-.004c.1-.061.182-.11.258-.161a.969.969 0 0 0 .277-.245C8.96 6.514 9 6.427 9 6.25a.612.612 0 0 0-.262-.525A1.27 1.27 0 0 0 8 5.5c-.369 0-.595.09-.74.187a1.01 1.01 0 0 0-.34.398ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"/></svg>');--md-admonition-icon--warning:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"/></svg>');--md-admonition-icon--failure:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M2.344 2.343h-.001a8 8 0 0 1 11.314 11.314A8.002 8.002 0 0 1 .234 10.089a8 8 0 0 1 2.11-7.746Zm1.06 10.253a6.5 6.5 0 1 0 9.108-9.275 6.5 6.5 0 0 0-9.108 9.275ZM6.03 4.97 8 6.94l1.97-1.97a.749.749 0 0 1 1.275.326.749.749 0 0 1-.215.734L9.06 8l1.97 1.97a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215L8 9.06l-1.97 1.97a.749.749 0 0 1-1.275-.326.749.749 0 0 1 .215-.734L6.94 8 4.97 6.03a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018Z"/></svg>');--md-admonition-icon--danger:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M9.504.43a1.516 1.516 0 0 1 2.437 1.713L10.415 5.5h2.123c1.57 0 2.346 1.909 1.22 3.004l-7.34 7.142a1.249 1.249 0 0 1-.871.354h-.302a1.25 1.25 0 0 1-1.157-1.723L5.633 10.5H3.462c-1.57 0-2.346-1.909-1.22-3.004L9.503.429Zm1.047 1.074L3.286 8.571A.25.25 0 0 0 3.462 9H6.75a.75.75 0 0 1 .694 1.034l-1.713 4.188 6.982-6.793A.25.25 0 0 0 12.538 7H9.25a.75.75 0 0 1-.683-1.06l2.008-4.418.003-.006a.036.036 0 0 0-.004-.009l-.006-.006-.008-.001c-.003 0-.006.002-.009.004Z"/></svg>');--md-admonition-icon--bug:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M4.72.22a.75.75 0 0 1 1.06 0l1 .999a3.488 3.488 0 0 1 2.441 0l.999-1a.748.748 0 0 1 1.265.332.75.75 0 0 1-.205.729l-.775.776c.616.63.995 1.493.995 2.444v.327c0 .1-.009.197-.025.292.408.14.764.392 1.029.722l1.968-.787a.75.75 0 0 1 .556 1.392L13 7.258V9h2.25a.75.75 0 0 1 0 1.5H13v.5c0 .409-.049.806-.141 1.186l2.17.868a.75.75 0 0 1-.557 1.392l-2.184-.873A4.997 4.997 0 0 1 8 16a4.997 4.997 0 0 1-4.288-2.427l-2.183.873a.75.75 0 0 1-.558-1.392l2.17-.868A5.036 5.036 0 0 1 3 11v-.5H.75a.75.75 0 0 1 0-1.5H3V7.258L.971 6.446a.75.75 0 0 1 .558-1.392l1.967.787c.265-.33.62-.583 1.03-.722a1.677 1.677 0 0 1-.026-.292V4.5c0-.951.38-1.814.995-2.444L4.72 1.28a.75.75 0 0 1 0-1.06Zm.53 6.28a.75.75 0 0 0-.75.75V11a3.5 3.5 0 1 0 7 0V7.25a.75.75 0 0 0-.75-.75ZM6.173 5h3.654A.172.172 0 0 0 10 4.827V4.5a2 2 0 1 0-4 0v.327c0 .096.077.173.173.173Z"/></svg>');--md-admonition-icon--example:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M5 5.782V2.5h-.25a.75.75 0 0 1 0-1.5h6.5a.75.75 0 0 1 0 1.5H11v3.282l3.666 5.76C15.619 13.04 14.543 15 12.767 15H3.233c-1.776 0-2.852-1.96-1.899-3.458Zm-2.4 6.565a.75.75 0 0 0 .633 1.153h9.534a.75.75 0 0 0 .633-1.153L12.225 10.5h-8.45ZM9.5 2.5h-3V6c0 .143-.04.283-.117.403L4.73 9h6.54L9.617 6.403A.746.746 0 0 1 9.5 6Z"/></svg>');--md-admonition-icon--quote:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M1.75 2.5h10.5a.75.75 0 0 1 0 1.5H1.75a.75.75 0 0 1 0-1.5Zm4 5h8.5a.75.75 0 0 1 0 1.5h-8.5a.75.75 0 0 1 0-1.5Zm0 5h8.5a.75.75 0 0 1 0 1.5h-8.5a.75.75 0 0 1 0-1.5ZM2.5 7.75v6a.75.75 0 0 1-1.5 0v-6a.75.75 0 0 1 1.5 0Z"/></svg>');}</style><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../stylesheets/extra.css><link rel=stylesheet href=https://file.cdn.shafish.cn/blog/css/vssue.css><link rel=stylesheet href=https://file.cdn.shafish.cn/blog/css/video-js.min.css><link rel=stylesheet href=https://file.cdn.shafish.cn/blog/css/video.css><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script>var consent;"undefined"==typeof __md_analytics||(consent=__md_get("__consent"))&&consent.analytics&&__md_analytics()</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#kubernetes调度基础 class=md-skip> 跳转至 </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=页眉> <a href=../../.. title=DevOps运维开发 class="md-header__button md-logo" aria-label=DevOps运维开发 data-md-component=logo> <img src=../../../assets/images/logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> DevOps运维开发 </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Kubernetes调度基础 </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label=切换至深色模式 type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title=切换至深色模式 for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=blue data-md-color-accent=blue aria-label=切换至浅色模式 type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title=切换至浅色模式 for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=查找> <a href=javascript:void(0) class="md-search__icon md-icon" title=分享 aria-label=分享 data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=清空当前内容 aria-label=清空当前内容 tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> 正在初始化搜索引擎 </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/hujianli94/hujianli94.github.io title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> hujianli94.github.io </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=标签 data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> 首页 </a> </li> <li class=md-tabs__item> <a href=../../0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Kubernetes/ class="md-tabs__link md-tabs__link--active"> Kubernetes </a> </li> <li class=md-tabs__item> <a href=../../../Docker/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Docker/ class=md-tabs__link> Docker </a> </li> <li class=md-tabs__item> <a href=../../../Golang/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Go-Web%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98/ class=md-tabs__link> Golang </a> </li> <li class=md-tabs__item> <a href=../../../Python/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Pythjon-auto-ops/ class=md-tabs__link> Python </a> </li> <li class=md-tabs__item> <a href=../../../Python-vs-Go/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Python-vs-Go/ class=md-tabs__link> Python-vs-Go </a> </li> <li class=md-tabs__item> <a href=../../../Linux/shell/Shell%E7%AE%80%E4%BB%8B/ class=md-tabs__link> Linux </a> </li> <li class=md-tabs__item> <a href=../../../Other/tools/1.PicGo%E5%9B%BE%E5%BA%8A/ class=md-tabs__link> Other </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=导航栏 data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title=DevOps运维开发 class="md-nav__button md-logo" aria-label=DevOps运维开发 data-md-component=logo> <img src=../../../assets/images/logo.png alt=logo> </a> DevOps运维开发 </label> <div class=md-nav__source> <a href=https://github.com/hujianli94/hujianli94.github.io title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> hujianli94.github.io </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> 首页 </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2 checked> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> Kubernetes <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=true> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_1> <label class=md-nav__link for=__nav_2_1 id=__nav_2_1_label tabindex=0> 0.学习线路 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_1_label aria-expanded=false> <label class=md-nav__title for=__nav_2_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Kubernetes/ class=md-nav__link> Kubernetes </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2> <label class=md-nav__link for=__nav_2_2 id=__nav_2_2_label tabindex=0> 1.安装篇 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2> <span class="md-nav__icon md-icon"></span> 1.安装篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../1.%E5%AE%89%E8%A3%85%E7%AF%87/1.Kubeadm%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/ class=md-nav__link> Kubeadm安装高可用集群 </a> </li> <li class=md-nav__item> <a href=../../1.%E5%AE%89%E8%A3%85%E7%AF%87/2.%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/ class=md-nav__link> 二进制安装高可用K8s集群 </a> </li> <li class=md-nav__item> <a href=../../1.%E5%AE%89%E8%A3%85%E7%AF%87/3.%E5%AE%89%E8%A3%85%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/ class=md-nav__link> 安装常用工具 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_3 checked> <label class=md-nav__link for=__nav_2_3 id=__nav_2_3_label tabindex=0> 2.基础篇 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_3_label aria-expanded=true> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> 2.基础篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../3.Docker%E5%9F%BA%E7%A1%80/ class=md-nav__link> Docker基础 </a> </li> <li class=md-nav__item> <a href=../4.Kubernetes%E7%9A%84%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/ class=md-nav__link> Kubernetes的基础概念 </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Kubernetes调度基础 <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Kubernetes调度基础 </a> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#1replication-controller和replicaset class=md-nav__link> 1.Replication Controller和ReplicaSet </a> <nav class=md-nav aria-label="1.Replication Controller和ReplicaSet"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#11-replication-controller class=md-nav__link> 1.1 Replication Controller </a> </li> <li class=md-nav__item> <a href=#12-replicaset class=md-nav__link> 1.2 ReplicaSet </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2无状态应用管理deployment class=md-nav__link> 2.无状态应用管理Deployment </a> <nav class=md-nav aria-label=2.无状态应用管理Deployment> <ul class=md-nav__list> <li class=md-nav__item> <a href=#21-创建deployment class=md-nav__link> 2.1 创建Deployment </a> </li> <li class=md-nav__item> <a href=#22-更新deployment class=md-nav__link> 2.2 更新Deployment </a> </li> <li class=md-nav__item> <a href=#23-回滚deployment class=md-nav__link> 2.3 回滚Deployment </a> </li> <li class=md-nav__item> <a href=#24-扩容deployment class=md-nav__link> 2.4 扩容Deployment </a> </li> <li class=md-nav__item> <a href=#25-暂停和恢复deployment更新 class=md-nav__link> 2.5 暂停和恢复Deployment更新 </a> </li> <li class=md-nav__item> <a href=#26-更新deployment的注意事项 class=md-nav__link> 2.6 更新Deployment的注意事项 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#3有状态应用管理statefulset class=md-nav__link> 3.有状态应用管理StatefulSet </a> <nav class=md-nav aria-label=3.有状态应用管理StatefulSet> <ul class=md-nav__list> <li class=md-nav__item> <a href=#31-statefulset的基本概念 class=md-nav__link> 3.1 StatefulSet的基本概念 </a> </li> <li class=md-nav__item> <a href=#32-statefulset的注意事项 class=md-nav__link> 3.2 StatefulSet的注意事项 </a> </li> <li class=md-nav__item> <a href=#33-定义一个statefulset资源文件 class=md-nav__link> 3.3 定义一个StatefulSet资源文件 </a> </li> <li class=md-nav__item> <a href=#34-创建statefulset class=md-nav__link> 3.4 创建StatefulSet </a> </li> <li class=md-nav__item> <a href=#35-statefulset创建pod的流程 class=md-nav__link> 3.5 StatefulSet创建Pod的流程 </a> </li> <li class=md-nav__item> <a href=#36-statefulset扩容和缩容 class=md-nav__link> 3.6 StatefulSet扩容和缩容 </a> </li> <li class=md-nav__item> <a href=#37-statefulset更新策略 class=md-nav__link> 3.7 StatefulSet更新策略 </a> </li> <li class=md-nav__item> <a href=#38-删除statefulset class=md-nav__link> 3.8 删除StatefulSet </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#4守护进程集daemonset class=md-nav__link> 4.守护进程集DaemonSet </a> <nav class=md-nav aria-label=4.守护进程集DaemonSet> <ul class=md-nav__list> <li class=md-nav__item> <a href=#41-什么是daemonset class=md-nav__link> 4.1 什么是DaemonSet </a> </li> <li class=md-nav__item> <a href=#42-定义一个daemonset class=md-nav__link> 4.2 定义一个DaemonSet </a> </li> <li class=md-nav__item> <a href=#43-创建daemonset class=md-nav__link> 4.3 创建DaemonSet </a> </li> <li class=md-nav__item> <a href=#44-更新和回滚daemonset class=md-nav__link> 4.4 更新和回滚DaemonSet </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#5cronjob class=md-nav__link> 5.CronJob </a> <nav class=md-nav aria-label=5.CronJob> <ul class=md-nav__list> <li class=md-nav__item> <a href=#51-创建cronjob class=md-nav__link> 5.1 创建CronJob </a> </li> <li class=md-nav__item> <a href=#52-可用参数的配置 class=md-nav__link> 5.2 可用参数的配置 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#6小结 class=md-nav__link> 6.小结 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../6.Kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83%E5%9F%BA%E7%A1%80/ class=md-nav__link> Kubernetes服务发布基础 </a> </li> <li class=md-nav__item> <a href=../7.Kubernetes%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/ class=md-nav__link> Kubernetes配置管理 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_4> <label class=md-nav__link for=__nav_2_4 id=__nav_2_4_label tabindex=0> 3.进阶篇 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_4_label aria-expanded=false> <label class=md-nav__title for=__nav_2_4> <span class="md-nav__icon md-icon"></span> 3.进阶篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../3.%E8%BF%9B%E9%98%B6%E7%AF%87/8.Kubernetes%E5%AD%98%E5%82%A8%E5%85%A5%E9%97%A8/ class=md-nav__link> Kubernetes存储入门 </a> </li> <li class=md-nav__item> <a href=../../3.%E8%BF%9B%E9%98%B6%E7%AF%87/9.Kubernetes%E9%AB%98%E7%BA%A7%E8%B0%83%E5%BA%A6/ class=md-nav__link> Kubernetes高级调度 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_5> <label class=md-nav__link for=__nav_2_5 id=__nav_2_5_label tabindex=0> 4.高级篇 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_5_label aria-expanded=false> <label class=md-nav__title for=__nav_2_5> <span class="md-nav__icon md-icon"></span> 4.高级篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../4.%E9%AB%98%E7%BA%A7%E7%AF%87/12.%E4%BA%91%E5%8E%9F%E7%94%9F%E5%AD%98%E5%82%A8Rook/ class=md-nav__link> 云原生存储Rook </a> </li> <li class=md-nav__item> <a href=../../4.%E9%AB%98%E7%BA%A7%E7%AF%87/13.%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%AE%B9%E5%99%A8%E5%8C%96/ class=md-nav__link> 中间件容器化 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_6> <label class=md-nav__link for=__nav_2_6 id=__nav_2_6_label tabindex=0> 5.运维篇 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_6_label aria-expanded=false> <label class=md-nav__title for=__nav_2_6> <span class="md-nav__icon md-icon"></span> 5.运维篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../5.%E8%BF%90%E7%BB%B4%E7%AF%87/14.Kubernetes%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/ class=md-nav__link> Kubernetes日志收集 </a> </li> <li class=md-nav__item> <a href=../../5.%E8%BF%90%E7%BB%B4%E7%AF%87/15.Kubernetes%E7%9B%91%E6%8E%A7%E5%91%8A%E8%AD%A6/ class=md-nav__link> Kubernetes监控告警 </a> </li> <li class=md-nav__item> <a href=../../5.%E8%BF%90%E7%BB%B4%E7%AF%87/16.%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83Ingress%E8%BF%9B%E9%98%B6/ class=md-nav__link> 服务发布Ingress进阶 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_7> <label class=md-nav__link for=__nav_2_7 id=__nav_2_7_label tabindex=0> 6.DevOps篇 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_7_label aria-expanded=false> <label class=md-nav__title for=__nav_2_7> <span class="md-nav__icon md-icon"></span> 6.DevOps篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/ class=md-nav__link> DevOps实践 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> Docker <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Docker </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1> <label class=md-nav__link for=__nav_3_1 id=__nav_3_1_label tabindex=0> 0.学习线路 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_1_label aria-expanded=false> <label class=md-nav__title for=__nav_3_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Docker/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Docker/ class=md-nav__link> Docker </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2> <label class=md-nav__link for=__nav_3_2 id=__nav_3_2_label tabindex=0> 1.基础 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> 1.基础 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Docker/1.%E5%9F%BA%E7%A1%80/1.%E5%AE%89%E8%A3%85Docker/ class=md-nav__link> 1.安装Docker </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.%E5%9F%BA%E7%A1%80/2.Docker%E9%95%9C%E5%83%8F/ class=md-nav__link> 2.Docker镜像 </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.%E5%9F%BA%E7%A1%80/3.Docker%E5%AE%B9%E5%99%A8/ class=md-nav__link> 3.Docker容器 </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.%E5%9F%BA%E7%A1%80/4.%E4%BC%81%E4%B8%9A%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93harbor/ class=md-nav__link> 4.企业私有仓库harbor </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.%E5%9F%BA%E7%A1%80/5.Docker%E6%95%B0%E6%8D%AE/ class=md-nav__link> 5.Docker数据 </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.%E5%9F%BA%E7%A1%80/6.Docker%E7%BD%91%E7%BB%9C/ class=md-nav__link> 6.Docker网络 </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.%E5%9F%BA%E7%A1%80/7.Dockerfile/ class=md-nav__link> 7.Dockerfile </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.%E5%9F%BA%E7%A1%80/8.docker-compose/ class=md-nav__link> 8.docker-compose </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.%E5%9F%BA%E7%A1%80/9.Docker%E7%9B%B8%E5%85%B3%E8%84%9A%E6%9C%AC/ class=md-nav__link> 9.Docker相关脚本 </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.%E5%9F%BA%E7%A1%80/10.Docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/ class=md-nav__link> 10.Docker常用命令 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_3> <label class=md-nav__link for=__nav_3_3 id=__nav_3_3_label tabindex=0> 2.实战案例 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> 2.实战案例 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/1.%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/ class=md-nav__link> 1.操作系统 </a> </li> <li class=md-nav__item> <a href=../../../Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/2.Web%E6%9C%8D%E5%8A%A1%E4%B8%8E%E5%BA%94%E7%94%A8/ class=md-nav__link> 2.Web服务与应用 </a> </li> <li class=md-nav__item> <a href=../../../Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/3.%E6%8C%81%E7%BB%AD%E5%BC%80%E5%8F%91%E4%B8%8E%E7%AE%A1%E7%90%86/ class=md-nav__link> 3.持续开发与管理 </a> </li> <li class=md-nav__item> <a href=../../../Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/4.%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BA%94%E7%94%A8/ class=md-nav__link> 4.数据库应用 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_4> <label class=md-nav__link for=__nav_3_4 id=__nav_3_4_label tabindex=0> 3.Devops <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_4_label aria-expanded=false> <label class=md-nav__title for=__nav_3_4> <span class="md-nav__icon md-icon"></span> 3.Devops </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Docker/3.Devops/1.ConfCenter/ class=md-nav__link> ConfCenter </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/2.CoreDNS/ class=md-nav__link> Coredns </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/3.Harbor/ class=md-nav__link> Harbor </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/4.Python%E6%93%8D%E4%BD%9CDocker/ class=md-nav__link> Python操作Docker </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/5.Haproxy/ class=md-nav__link> Haproxy </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/6.Nexus/ class=md-nav__link> Nexus </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> Golang <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Golang </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_1> <label class=md-nav__link for=__nav_4_1 id=__nav_4_1_label tabindex=0> 0.学习线路 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_1_label aria-expanded=false> <label class=md-nav__title for=__nav_4_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Go-Web%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98/ class=md-nav__link> Go Web开发实战 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_2> <label class=md-nav__link for=__nav_4_2 id=__nav_4_2_label tabindex=0> 1.Go基础 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_2_label aria-expanded=false> <label class=md-nav__title for=__nav_4_2> <span class="md-nav__icon md-icon"></span> 1.Go基础 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/1.Go%E5%9F%BA%E7%A1%80/1.%E5%AE%89%E8%A3%85Go/ class=md-nav__link> 安装Go </a> </li> <li class=md-nav__item> <a href=../../../Golang/1.Go%E5%9F%BA%E7%A1%80/2.%E7%AC%AC%E4%B8%80%E4%B8%AAGo%E7%A8%8B%E5%BA%8F/ class=md-nav__link> 第一个Go程序 </a> </li> <li class=md-nav__item> <a href=../../../Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/ class=md-nav__link> Go基础语法 </a> </li> <li class=md-nav__item> <a href=../../../Golang/1.Go%E5%9F%BA%E7%A1%80/4.Go-Module%E6%95%99%E7%A8%8B/ class=md-nav__link> Go Module教程 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_3> <label class=md-nav__link for=__nav_4_3 id=__nav_4_3_label tabindex=0> 2.Go-Web基础 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_3_label aria-expanded=false> <label class=md-nav__title for=__nav_4_3> <span class="md-nav__icon md-icon"></span> 2.Go-Web基础 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/2.Go-Web%E5%9F%BA%E7%A1%80/5.%E7%AC%AC%E4%B8%80%E4%B8%AAGo-Web%E7%A8%8B%E5%BA%8F/ class=md-nav__link> 第一个Go Web程序 </a> </li> <li class=md-nav__item> <a href=../../../Golang/2.Go-Web%E5%9F%BA%E7%A1%80/6.Web%E7%A8%8B%E5%BA%8F%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86%E7%AE%80%E4%BB%8B/ class=md-nav__link> Web程序运行原理简介 </a> </li> <li class=md-nav__item> <a href=../../../Golang/2.Go-Web%E5%9F%BA%E7%A1%80/7.net-http%E5%8C%85/ class=md-nav__link> net/http包 </a> </li> <li class=md-nav__item> <a href=../../../Golang/2.Go-Web%E5%9F%BA%E7%A1%80/8.html-template%E5%8C%85/ class=md-nav__link> html/template包 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_4> <label class=md-nav__link for=__nav_4_4 id=__nav_4_4_label tabindex=0> 3.Go-Web请求处理 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4_4> <span class="md-nav__icon md-icon"></span> 3.Go-Web请求处理 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/3.Go-Web%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/9.%E7%AE%80%E5%8D%95Web%E6%9C%8D%E5%8A%A1%E5%99%A8/ class=md-nav__link> 简单Web服务器 </a> </li> <li class=md-nav__item> <a href=../../../Golang/3.Go-Web%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/10.%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82/ class=md-nav__link> 处理请求 </a> </li> <li class=md-nav__item> <a href=../../../Golang/3.Go-Web%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/11.session%E5%92%8Ccookie/ class=md-nav__link> session和cookie </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_5> <label class=md-nav__link for=__nav_4_5 id=__nav_4_5_label tabindex=0> 4.Go访问数据库 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_5_label aria-expanded=false> <label class=md-nav__title for=__nav_4_5> <span class="md-nav__icon md-icon"></span> 4.Go访问数据库 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/12.Go%E6%93%8D%E4%BD%9CMySQL/ class=md-nav__link> Go操作MySQL </a> </li> <li class=md-nav__item> <a href=../../../Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/13.Go%E6%93%8D%E4%BD%9CRedis/ class=md-nav__link> Go操作Redis </a> </li> <li class=md-nav__item> <a href=../../../Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/14.Go%E6%93%8D%E4%BD%9CMongoDB/ class=md-nav__link> Go操作MongoDB </a> </li> <li class=md-nav__item> <a href=../../../Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/15.Go%E7%9A%84%E5%B8%B8%E8%A7%81ORM%E5%BA%93/ class=md-nav__link> Go的常见ORM库 </a> </li> <li class=md-nav__item> <a href=../../../Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/16.Go%E6%93%8D%E4%BD%9CSQLite/ class=md-nav__link> Go操作SQLite </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_6> <label class=md-nav__link for=__nav_4_6 id=__nav_4_6_label tabindex=0> 5.Go高级网络编程 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_6_label aria-expanded=false> <label class=md-nav__title for=__nav_4_6> <span class="md-nav__icon md-icon"></span> 5.Go高级网络编程 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/5.Go%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/17.Go-Socket%E7%BC%96%E7%A8%8B/ class=md-nav__link> Go Socket编程 </a> </li> <li class=md-nav__item> <a href=../../../Golang/5.Go%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/18.Go-RPC%E7%BC%96%E7%A8%8B/ class=md-nav__link> Go RPC编程 </a> </li> <li class=md-nav__item> <a href=../../../Golang/5.Go%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/19.Go-%E5%BE%AE%E6%9C%8D%E5%8A%A1/ class=md-nav__link> Go 微服务 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_7> <label class=md-nav__link for=__nav_4_7 id=__nav_4_7_label tabindex=0> 6.Go文件处理 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_7_label aria-expanded=false> <label class=md-nav__title for=__nav_4_7> <span class="md-nav__icon md-icon"></span> 6.Go文件处理 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/20.%E5%A4%84%E7%90%86%E7%9B%AE%E5%BD%95%E4%B8%8E%E6%96%87%E4%BB%B6/ class=md-nav__link> 处理目录与文件 </a> </li> <li class=md-nav__item> <a href=../../../Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/21.%E5%A4%84%E7%90%86XML%E6%96%87%E4%BB%B6/ class=md-nav__link> 处理XML文件 </a> </li> <li class=md-nav__item> <a href=../../../Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/22.%E5%A4%84%E7%90%86JSON%E6%96%87%E4%BB%B6/ class=md-nav__link> 处理JSON文件 </a> </li> <li class=md-nav__item> <a href=../../../Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/23.%E5%A4%84%E7%90%86CSV%E6%96%87%E4%BB%B6/ class=md-nav__link> 处理CSV文件 </a> </li> <li class=md-nav__item> <a href=../../../Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/24.%E5%A4%84%E7%90%86Go%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95/ class=md-nav__link> 处理Go日志记录 </a> </li> <li class=md-nav__item> <a href=../../../Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/25.%E5%A4%84%E7%90%86%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/ class=md-nav__link> 处理正则表达式 </a> </li> <li class=md-nav__item> <a href=../../../Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/26.%E5%A4%84%E7%90%86Excel%E6%96%87%E4%BB%B6/ class=md-nav__link> 处理Excel文件 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_8> <label class=md-nav__link for=__nav_4_8 id=__nav_4_8_label tabindex=0> 7.Go并发编程 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_8_label aria-expanded=false> <label class=md-nav__title for=__nav_4_8> <span class="md-nav__icon md-icon"></span> 7.Go并发编程 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/26.%E5%B9%B6%E5%8F%91-%E5%B9%B6%E8%A1%8C/ class=md-nav__link> 并发 并行 </a> </li> <li class=md-nav__item> <a href=../../../Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/27.%E8%BF%9B%E7%A8%8B-%E7%BA%BF%E7%A8%8B-%E5%8D%8F%E7%A8%8B/ class=md-nav__link> 进程 线程 协程 </a> </li> <li class=md-nav__item> <a href=../../../Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/28.Go%E5%B9%B6%E5%8F%91%E6%A8%A1%E5%9E%8B/ class=md-nav__link> Go并发模型 </a> </li> <li class=md-nav__item> <a href=../../../Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/29.goroutine%E5%92%8Cchannel/ class=md-nav__link> goroutine和channel </a> </li> <li class=md-nav__item> <a href=../../../Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/30.sync%E5%AE%9E%E7%8E%B0%E5%B9%B6%E5%8F%91/ class=md-nav__link> sync实现并发 </a> </li> <li class=md-nav__item> <a href=../../../Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/31.Go%E5%B9%B6%E5%8F%91%E7%9A%84Web%E5%BA%94%E7%94%A8/ class=md-nav__link> Go并发的Web应用 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_9> <label class=md-nav__link for=__nav_4_9 id=__nav_4_9_label tabindex=0> 8.Go标准库 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_9_label aria-expanded=false> <label class=md-nav__title for=__nav_4_9> <span class="md-nav__icon md-icon"></span> 8.Go标准库 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/32.time/ class=md-nav__link> time </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/33.strings/ class=md-nav__link> strings </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/34.bytes/ class=md-nav__link> bytes </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/35.json/ class=md-nav__link> json </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/36.io-bufio/ class=md-nav__link> io/bufio </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/37.fmt/ class=md-nav__link> fmt </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/38.strconv/ class=md-nav__link> strconv </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/39.regexp/ class=md-nav__link> regexp </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/40.log/ class=md-nav__link> log </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/41.reflect-unsafe/ class=md-nav__link> reflect/unsafe </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/42.os-path-filepath/ class=md-nav__link> os/path/filepath </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/43.unicode/ class=md-nav__link> unicode </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/44.flag/ class=md-nav__link> flag </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/45.net-url/ class=md-nav__link> net/url </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/46.net-http/ class=md-nav__link> net/http </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/47.sort/ class=md-nav__link> sort </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/48.errors/ class=md-nav__link> errors </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_10> <label class=md-nav__link for=__nav_4_10 id=__nav_4_10_label tabindex=0> 9.Go三方库 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_10_label aria-expanded=false> <label class=md-nav__title for=__nav_4_10> <span class="md-nav__icon md-icon"></span> 9.Go三方库 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/0.%E5%BC%80%E6%BA%90%E8%87%AA%E5%B7%B1%E7%9A%84Go%E5%BA%93/ class=md-nav__link> 开源自己的Go库 </a> </li> <li class=md-nav__item> <a href=../../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/1.cobra/ class=md-nav__link> Cobra </a> </li> <li class=md-nav__item> <a href=../../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/2.viper/ class=md-nav__link> Viper </a> </li> <li class=md-nav__item> <a href=../../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/3.mahonia/ class=md-nav__link> mahonia </a> </li> <li class=md-nav__item> <a href=../../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/4.ssh/ class=md-nav__link> ssh </a> </li> <li class=md-nav__item> <a href=../../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/5.fsnotify/ class=md-nav__link> fsnotify </a> </li> <li class=md-nav__item> <a href=../../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/6.yaml/ class=md-nav__link> yaml </a> </li> <li class=md-nav__item> <a href=../../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/7.tail/ class=md-nav__link> tail </a> </li> <li class=md-nav__item> <a href=../../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/8.gopsutil/ class=md-nav__link> gopsutil </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> Python <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Python </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_1> <label class=md-nav__link for=__nav_5_1 id=__nav_5_1_label tabindex=0> 0.学习线路 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_1_label aria-expanded=false> <label class=md-nav__title for=__nav_5_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Pythjon-auto-ops/ class=md-nav__link> Python Linux管理与自动化运维 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_2> <label class=md-nav__link for=__nav_5_2 id=__nav_5_2_label tabindex=0> 1.基础篇 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_2_label aria-expanded=false> <label class=md-nav__title for=__nav_5_2> <span class="md-nav__icon md-icon"></span> 1.基础篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/1.Python%E7%94%9F%E6%80%81%E5%B7%A5%E5%85%B7/ class=md-nav__link> 1.Python生态工具 </a> </li> <li class=md-nav__item> <a href=../../../Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/2.Python%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E5%AE%89%E8%A3%85/ class=md-nav__link> 2.Python第三方库安装 </a> </li> <li class=md-nav__item> <a href=../../../Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/3.Python%E5%B7%A5%E4%BD%9C%E7%8E%AF%E5%A2%83%E7%AE%A1%E7%90%86/ class=md-nav__link> 3.Python工作环境管理 </a> </li> <li class=md-nav__item> <a href=../../../Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/4.VSCode%E4%B8%ADPython%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/ class=md-nav__link> 4.VSCode中Python环境配置 </a> </li> <li class=md-nav__item> <a href=../../../Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Python%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/ class=md-nav__link> 5.Python开发环境 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_3> <label class=md-nav__link for=__nav_5_3 id=__nav_5_3_label tabindex=0> 2.高级篇 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_3_label aria-expanded=false> <label class=md-nav__title for=__nav_5_3> <span class="md-nav__icon md-icon"></span> 2.高级篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/6.%E6%89%93%E9%80%A0%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/ class=md-nav__link> 6.打造命令行工具 </a> </li> <li class=md-nav__item> <a href=../../../Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/7.%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/ class=md-nav__link> 7.文本处理 </a> </li> <li class=md-nav__item> <a href=../../../Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/8.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/ class=md-nav__link> 8.Linux系统管理 </a> </li> <li class=md-nav__item> <a href=../../../Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/9.%E7%9B%91%E6%8E%A7Linux/ class=md-nav__link> 9.监控Linux </a> </li> <li class=md-nav__item> <a href=../../../Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/10.%E6%96%87%E6%A1%A3%E4%B8%8E%E6%8A%A5%E5%91%8A/ class=md-nav__link> 10.文档与报告 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> Python-vs-Go <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Python-vs-Go </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_1> <label class=md-nav__link for=__nav_6_1 id=__nav_6_1_label tabindex=0> 0.学习线路 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_1_label aria-expanded=false> <label class=md-nav__title for=__nav_6_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python-vs-Go/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Python-vs-Go/ class=md-nav__link> Python-vs-Go </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_2> <label class=md-nav__link for=__nav_6_2 id=__nav_6_2_label tabindex=0> 1.对比学习 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_2_label aria-expanded=false> <label class=md-nav__title for=__nav_6_2> <span class="md-nav__icon md-icon"></span> 1.对比学习 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/1.Hello-World/ class=md-nav__link> Hello-World </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/2.Print/ class=md-nav__link> Print </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/3.%E6%B3%A8%E9%87%8A/ class=md-nav__link> 注释 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/4.%E5%A4%9A%E8%A1%8C%E5%AD%97%E7%AC%A6%E4%B8%B2/ class=md-nav__link> 多行字符串 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/5.Lists/ class=md-nav__link> Lists </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/6.Map/ class=md-nav__link> Map </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/7.Booleans/ class=md-nav__link> Booleans </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/8.Forloop/ class=md-nav__link> Forloop </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/9.Range/ class=md-nav__link> Range </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/10.Switch/ class=md-nav__link> Switch </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/11.%E5%8F%AF%E5%8F%98%E5%8F%82%E6%95%B0%E5%87%BD%E6%95%B0/ class=md-nav__link> 可变参数函数 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/12.%E6%97%B6%E9%97%B4%E8%AE%A1%E7%AE%97/ class=md-nav__link> 时间计算 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/13.%E5%87%BD%E6%95%B0%E7%9A%84%E9%97%AD%E5%8C%85/ class=md-nav__link> 函数的闭包 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/14.%E9%80%80%E5%87%BA%E5%A4%84%E7%90%86/ class=md-nav__link> 退出处理 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/15.%E5%BC%82%E5%B8%B8%E6%8D%95%E8%8E%B7/ class=md-nav__link> 异常捕获 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/16.%E5%8F%AF%E5%8F%98%E9%A1%B9/ class=md-nav__link> 可变项 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/17.%E7%B1%BB/ class=md-nav__link> 类 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/18.%E6%96%B9%E6%B3%95/ class=md-nav__link> 方法 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/19.%E5%B9%B6%E5%8F%91/ class=md-nav__link> 并发 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/20.Args/ class=md-nav__link> Args </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/21.%E5%AF%BC%E5%85%A5%E6%A8%A1%E5%9D%97%E5%88%AB%E5%90%8D/ class=md-nav__link> 导入模块别名 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/22.%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%A0%BC%E5%BC%8F%E5%8C%96/ class=md-nav__link> 字符串格式化 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/23.%E5%8E%BB%E9%87%8D/ class=md-nav__link> 去重 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/24.%E5%B8%A6%E9%A2%9C%E8%89%B2%E6%89%93%E5%8D%B0/ class=md-nav__link> 带颜色打印 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_3> <label class=md-nav__link for=__nav_6_3 id=__nav_6_3_label tabindex=0> 2.进阶 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_3_label aria-expanded=false> <label class=md-nav__title for=__nav_6_3> <span class="md-nav__icon md-icon"></span> 2.进阶 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python-vs-Go/2.%E8%BF%9B%E9%98%B6/1.%E4%BD%BF%E7%94%A8RPC/ class=md-nav__link> 使用RPC </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/2.%E8%BF%9B%E9%98%B6/2.%E4%BD%BF%E7%94%A8MySQL/ class=md-nav__link> 使用MySQL </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/2.%E8%BF%9B%E9%98%B6/3.%E4%BD%BF%E7%94%A8Redis/ class=md-nav__link> 使用Redis </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/2.%E8%BF%9B%E9%98%B6/4.%E4%BD%BF%E7%94%A8MongoDB/ class=md-nav__link> 使用MongoDB </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex=0> Linux <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Linux </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_1> <label class=md-nav__link for=__nav_7_1 id=__nav_7_1_label tabindex=0> Shell <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_1_label aria-expanded=false> <label class=md-nav__title for=__nav_7_1> <span class="md-nav__icon md-icon"></span> Shell </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Linux/shell/Shell%E7%AE%80%E4%BB%8B/ class=md-nav__link> Shell 教程概述 </a> </li> <li class=md-nav__item> <a href=../../../Linux/shell/1.%E7%AC%AC%E4%B8%80%E4%B8%AAshell%E7%A8%8B%E5%BA%8F/ class=md-nav__link> 1.第一个 Shell 程序 </a> </li> <li class=md-nav__item> <a href=../../../Linux/shell/2.Shell%E5%8F%98%E9%87%8F/ class=md-nav__link> 2.Shell 变量 </a> </li> <li class=md-nav__item> <a href=../../../Linux/shell/3.Shell%E5%8F%82%E6%95%B0/ class=md-nav__link> 3.Shell 参数 </a> </li> <li class=md-nav__item> <a href=../../../Linux/shell/4.Shell%E6%95%B0%E7%BB%84/ class=md-nav__link> 4.Shell数组 </a> </li> <li class=md-nav__item> <a href=../../../Linux/shell/5.Shell%E8%BF%90%E7%AE%97%E7%AC%A6/ class=md-nav__link> 5.Shell 运算符 </a> </li> <li class=md-nav__item> <a href=../../../Linux/shell/6.Shell-echo_printf%E5%91%BD%E4%BB%A4/ class=md-nav__link> 6.Shell echo/printf 命令 </a> </li> <li class=md-nav__item> <a href=../../../Linux/shell/7.Shell-test%E5%91%BD%E4%BB%A4/ class=md-nav__link> 7.Shell test命令 </a> </li> <li class=md-nav__item> <a href=../../../Linux/shell/8.Shell%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/ class=md-nav__link> 8.Shell流程控制 </a> </li> <li class=md-nav__item> <a href=../../../Linux/shell/9.Shell%E5%87%BD%E6%95%B0/ class=md-nav__link> 8.Shell函数 </a> </li> <li class=md-nav__item> <a href=../../../Linux/shell/10.Shell%E8%BE%93%E5%85%A5_%E8%BE%93%E5%87%BA%E9%87%8D%E5%AE%9A%E5%90%91/ class=md-nav__link> 10.Shell输入/输出重定向 </a> </li> <li class=md-nav__item> <a href=../../../Linux/shell/11.Shell%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/ class=md-nav__link> 11.Shell正则表达式 </a> </li> <li class=md-nav__item> <a href=../../../Linux/shell/12.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bgrep/ class=md-nav__link> 12.Shell三剑客之grep </a> </li> <li class=md-nav__item> <a href=../../../Linux/shell/13.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/ class=md-nav__link> 13.Shell三剑客之sed </a> </li> <li class=md-nav__item> <a href=../../../Linux/shell/14.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bawk/ class=md-nav__link> 14.Shell三剑客之awk </a> </li> <li class=md-nav__item> <a href=../../../Linux/shell/15.Shell%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/ class=md-nav__link> 15.Shell常用工具 </a> </li> <li class=md-nav__item> <a href=../../../Linux/shell/16.Shell%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/ class=md-nav__link> 16.Shell实战项目 </a> </li> <li class=md-nav__item> <a href=../../../Linux/shell/17.Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/ class=md-nav__link> 17.Shell脚本示例 </a> </li> <li class=md-nav__item> <a href=../../../Linux/shell/18.Shell%E8%84%9A%E6%9C%AC%E7%9A%84%E5%8F%82%E6%95%B0%E8%A7%A3%E6%9E%90%E5%B7%A5%E5%85%B7/ class=md-nav__link> 18.Shell脚本的参数解析工具 </a> </li> <li class=md-nav__item> <a href=../../../Linux/shell/19.%E5%AE%9E%E7%94%A8Linux-Shell%E8%84%9A%E6%9C%AC%E6%A1%88%E4%BE%8B/ class=md-nav__link> 19.实用Linux Shell脚本案例 </a> </li> <li class=md-nav__item> <a href=../../../Linux/shell/20.Shell%E8%84%9A%E6%9C%AC%E7%9A%84%E8%A7%84%E8%8C%83/ class=md-nav__link> 20.Shell脚本的规范 </a> </li> <li class=md-nav__item> <a href=../../../Linux/shell/21.DevOps%E4%B8%8B%E7%9A%84Shell%E8%84%9A%E6%9C%AC/ class=md-nav__link> 21.DevOps下的Shell脚本 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_2> <label class=md-nav__link for=__nav_7_2 id=__nav_7_2_label tabindex=0> Ansible <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_2_label aria-expanded=false> <label class=md-nav__title for=__nav_7_2> <span class="md-nav__icon md-icon"></span> Ansible </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/ class=md-nav__link> 1.Ansible入门和实践 </a> </li> <li class=md-nav__item> <a href=../../../Linux/Ansible/2.Ansible-wiki/ class=md-nav__link> 2.Ansible-wiki </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_3> <label class=md-nav__link for=__nav_7_3 id=__nav_7_3_label tabindex=0> Git <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_3_label aria-expanded=false> <label class=md-nav__title for=__nav_7_3> <span class="md-nav__icon md-icon"></span> Git </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Linux/Git/1.GitHub%E7%9A%84%E9%AB%98%E7%BA%A7%E6%90%9C%E7%B4%A2/ class=md-nav__link> 1.GitHub的高级搜索 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_4> <label class=md-nav__link for=__nav_7_4 id=__nav_7_4_label tabindex=0> system <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_4_label aria-expanded=false> <label class=md-nav__title for=__nav_7_4> <span class="md-nav__icon md-icon"></span> system </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Linux/system/0.Linux%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E4%B8%8B%E8%BD%BD/ class=md-nav__link> Linux系统镜像下载 </a> </li> <li class=md-nav__item> <a href=../../../Linux/system/1.Linux%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA/ class=md-nav__link> Linux安全加固 </a> </li> <li class=md-nav__item> <a href=../../../Linux/system/2.Systemd/ class=md-nav__link> Systemd </a> </li> <li class=md-nav__item> <a href=../../../Linux/system/3.Superivisor/ class=md-nav__link> Superivisor </a> </li> <li class=md-nav__item> <a href=../../../Linux/system/4.Linux%E7%B3%BB%E7%BB%9F%E4%BD%BF%E7%94%A8SSH%E7%99%BB%E5%BD%95%E4%B9%8B%E5%89%8D%E6%98%BE%E7%A4%BA%E6%A8%AA%E5%B9%85/ class=md-nav__link> Linux系统使用SSH登录之前显示横幅 </a> </li> <li class=md-nav__item> <a href=../../../Linux/system/5.Linux%E4%B8%AD%E7%AB%AF%E5%8F%A3%E5%8D%A0%E7%94%A8%E6%8E%92%E6%9F%A5/ class=md-nav__link> Linux中端口占用排查 </a> </li> <li class=md-nav__item> <a href=../../../Linux/system/6.%E4%BD%BF%E7%94%A8curl%E5%8F%91%E9%80%81REST-API%E8%AF%B7%E6%B1%82/ class=md-nav__link> 使用curl发送REST API请求 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_5> <label class=md-nav__link for=__nav_7_5 id=__nav_7_5_label tabindex=0> serveices <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_5_label aria-expanded=false> <label class=md-nav__title for=__nav_7_5> <span class="md-nav__icon md-icon"></span> serveices </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Linux/serveices/0.ubuntu-desktop-vmware/ class=md-nav__link> ubuntu-desktop-vmware </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8> <label class=md-nav__link for=__nav_8 id=__nav_8_label tabindex=0> Other <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_8_label aria-expanded=false> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> Other </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8_1> <label class=md-nav__link for=__nav_8_1 id=__nav_8_1_label tabindex=0> tools <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_8_1_label aria-expanded=false> <label class=md-nav__title for=__nav_8_1> <span class="md-nav__icon md-icon"></span> tools </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Other/tools/1.PicGo%E5%9B%BE%E5%BA%8A/ class=md-nav__link> 1.PicGo图床 </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#1replication-controller和replicaset class=md-nav__link> 1.Replication Controller和ReplicaSet </a> <nav class=md-nav aria-label="1.Replication Controller和ReplicaSet"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#11-replication-controller class=md-nav__link> 1.1 Replication Controller </a> </li> <li class=md-nav__item> <a href=#12-replicaset class=md-nav__link> 1.2 ReplicaSet </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2无状态应用管理deployment class=md-nav__link> 2.无状态应用管理Deployment </a> <nav class=md-nav aria-label=2.无状态应用管理Deployment> <ul class=md-nav__list> <li class=md-nav__item> <a href=#21-创建deployment class=md-nav__link> 2.1 创建Deployment </a> </li> <li class=md-nav__item> <a href=#22-更新deployment class=md-nav__link> 2.2 更新Deployment </a> </li> <li class=md-nav__item> <a href=#23-回滚deployment class=md-nav__link> 2.3 回滚Deployment </a> </li> <li class=md-nav__item> <a href=#24-扩容deployment class=md-nav__link> 2.4 扩容Deployment </a> </li> <li class=md-nav__item> <a href=#25-暂停和恢复deployment更新 class=md-nav__link> 2.5 暂停和恢复Deployment更新 </a> </li> <li class=md-nav__item> <a href=#26-更新deployment的注意事项 class=md-nav__link> 2.6 更新Deployment的注意事项 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#3有状态应用管理statefulset class=md-nav__link> 3.有状态应用管理StatefulSet </a> <nav class=md-nav aria-label=3.有状态应用管理StatefulSet> <ul class=md-nav__list> <li class=md-nav__item> <a href=#31-statefulset的基本概念 class=md-nav__link> 3.1 StatefulSet的基本概念 </a> </li> <li class=md-nav__item> <a href=#32-statefulset的注意事项 class=md-nav__link> 3.2 StatefulSet的注意事项 </a> </li> <li class=md-nav__item> <a href=#33-定义一个statefulset资源文件 class=md-nav__link> 3.3 定义一个StatefulSet资源文件 </a> </li> <li class=md-nav__item> <a href=#34-创建statefulset class=md-nav__link> 3.4 创建StatefulSet </a> </li> <li class=md-nav__item> <a href=#35-statefulset创建pod的流程 class=md-nav__link> 3.5 StatefulSet创建Pod的流程 </a> </li> <li class=md-nav__item> <a href=#36-statefulset扩容和缩容 class=md-nav__link> 3.6 StatefulSet扩容和缩容 </a> </li> <li class=md-nav__item> <a href=#37-statefulset更新策略 class=md-nav__link> 3.7 StatefulSet更新策略 </a> </li> <li class=md-nav__item> <a href=#38-删除statefulset class=md-nav__link> 3.8 删除StatefulSet </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#4守护进程集daemonset class=md-nav__link> 4.守护进程集DaemonSet </a> <nav class=md-nav aria-label=4.守护进程集DaemonSet> <ul class=md-nav__list> <li class=md-nav__item> <a href=#41-什么是daemonset class=md-nav__link> 4.1 什么是DaemonSet </a> </li> <li class=md-nav__item> <a href=#42-定义一个daemonset class=md-nav__link> 4.2 定义一个DaemonSet </a> </li> <li class=md-nav__item> <a href=#43-创建daemonset class=md-nav__link> 4.3 创建DaemonSet </a> </li> <li class=md-nav__item> <a href=#44-更新和回滚daemonset class=md-nav__link> 4.4 更新和回滚DaemonSet </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#5cronjob class=md-nav__link> 5.CronJob </a> <nav class=md-nav aria-label=5.CronJob> <ul class=md-nav__list> <li class=md-nav__item> <a href=#51-创建cronjob class=md-nav__link> 5.1 创建CronJob </a> </li> <li class=md-nav__item> <a href=#52-可用参数的配置 class=md-nav__link> 5.2 可用参数的配置 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#6小结 class=md-nav__link> 6.小结 </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=kubernetes调度基础>Kubernetes调度基础<a class=headerlink href=#kubernetes调度基础 title="Permanent link">&para;</a></h1> <p>对于Kubernetes的应用部署，我们之前提到过Pod就是用来配置容器的，容器就是用来运行应用的。</p> <p>也提到过，在实际使用时，不会创建单独的Pod运行应用，而是使用更高级的资源进行调度，比如Deployment等。</p> <p>本章的内容就是讲解Kubernetes原生的调度资源， 在讲解高级资源Deployment、StatefulSet之前，首先会介绍什么是 Replication Controller和ReplicaSet。</p> <h2 id=1replication-controller和replicaset>1.Replication Controller和ReplicaSet<a class=headerlink href=#1replication-controller和replicaset title="Permanent link">&para;</a></h2> <p>Replication Controller（复制控制器，RC）和ReplicaSet（复制集，RS）是两种简单部署Pod的方式。</p> <p>因为在生产环境中主要使用更高级的Deployment等方式进行Pod的管理和部署，所以本节只对Replication Controller和Replica Set的部署方式进行简单介绍。</p> <h3 id=11-replication-controller>1.1 Replication Controller<a class=headerlink href=#11-replication-controller title="Permanent link">&para;</a></h3> <p>Replication Controller可以确保Pod副本数达到期望值，也就是RC定义的数量。换句话说，Replication Controller可以确保一个Pod或一组同类Pod总是可用的。如果存在的Pod大于设定的值，则Replication Controller将终止额外的Pod。</p> <p>如果太小，Replication Controller将启动更多的Pod用于保证达到期望值。与手动创建Pod不同的是，用Replication Controller维护的Pod在失败、删除或终止时会自动替换。</p> <p>因此，即使应用程序只需要一个Pod，也应该使用Replication Controller或其他方式管理。Replication Controller类似于进程管理程序，但是Replication Controller不是监视单个节点上的各个进程，而是监视多个节点上的多个Pod。</p> <p>定义一个Replication Controller的示例如下：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ReplicationController</span>
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a><span class=w>  </span><span class=nt>selector</span><span class=p>:</span>
<a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a><span class=w>  </span><span class=nt>template</span><span class=p>:</span>
<a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a><span class=w>      </span><span class=nt>labels</span><span class=p>:</span>
<a id=__codelineno-0-13 name=__codelineno-0-13 href=#__codelineno-0-13></a><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<a id=__codelineno-0-14 name=__codelineno-0-14 href=#__codelineno-0-14></a><span class=w>    </span><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-0-15 name=__codelineno-0-15 href=#__codelineno-0-15></a><span class=w>      </span><span class=nt>containers</span><span class=p>:</span>
<a id=__codelineno-0-16 name=__codelineno-0-16 href=#__codelineno-0-16></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<a id=__codelineno-0-17 name=__codelineno-0-17 href=#__codelineno-0-17></a><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<a id=__codelineno-0-18 name=__codelineno-0-18 href=#__codelineno-0-18></a><span class=w>        </span><span class=nt>ports</span><span class=p>:</span>
<a id=__codelineno-0-19 name=__codelineno-0-19 href=#__codelineno-0-19></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
</code></pre></div> <h3 id=12-replicaset>1.2 ReplicaSet<a class=headerlink href=#12-replicaset title="Permanent link">&para;</a></h3> <p>ReplicaSet是支持基于集合的标签选择器的下一代Replication Controller，<strong><mark>它主要用作Deployment协调创建、删除和更新Pod，和Replication Controller唯一的区别是，ReplicaSet支持标签选择器。</mark></strong></p> <p><strong><mark>在实际应用中，虽然ReplicaSet可以单独使用，但是一般建议使用Deployment来自动管理ReplicaSet，除非自定义的Pod不需要更新或有其他编排等。</mark></strong></p> <p>定义一个ReplicaSet的示例如下：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ReplicaSet</span>
<a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">frontend</span>
<a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a><span class=w>  </span><span class=nt>labels</span><span class=p>:</span>
<a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">guestbook</span>
<a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a><span class=w>    </span><span class=nt>tier</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">frontend</span>
<a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a><span class=w>  </span><span class=c1># modify replicas according to your case</span>
<a id=__codelineno-1-10 name=__codelineno-1-10 href=#__codelineno-1-10></a><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<a id=__codelineno-1-11 name=__codelineno-1-11 href=#__codelineno-1-11></a><span class=w>  </span><span class=nt>selector</span><span class=p>:</span>
<a id=__codelineno-1-12 name=__codelineno-1-12 href=#__codelineno-1-12></a><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span>
<a id=__codelineno-1-13 name=__codelineno-1-13 href=#__codelineno-1-13></a><span class=w>      </span><span class=nt>tier</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">frontend</span>
<a id=__codelineno-1-14 name=__codelineno-1-14 href=#__codelineno-1-14></a><span class=w>    </span><span class=nt>matchExpressions</span><span class=p>:</span>
<a id=__codelineno-1-15 name=__codelineno-1-15 href=#__codelineno-1-15></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="p p-Indicator">{</span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=nv>tier</span><span class="p p-Indicator">,</span><span class=nt> operator</span><span class=p>:</span><span class=w> </span><span class=nv>In</span><span class="p p-Indicator">,</span><span class=nt> values</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=nv>frontend</span><span class="p p-Indicator">]}</span>
<a id=__codelineno-1-16 name=__codelineno-1-16 href=#__codelineno-1-16></a><span class=w>  </span><span class=nt>template</span><span class=p>:</span>
<a id=__codelineno-1-17 name=__codelineno-1-17 href=#__codelineno-1-17></a><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-1-18 name=__codelineno-1-18 href=#__codelineno-1-18></a><span class=w>      </span><span class=nt>labels</span><span class=p>:</span>
<a id=__codelineno-1-19 name=__codelineno-1-19 href=#__codelineno-1-19></a><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">guestbook</span>
<a id=__codelineno-1-20 name=__codelineno-1-20 href=#__codelineno-1-20></a><span class=w>        </span><span class=nt>tier</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">frontend</span>
<a id=__codelineno-1-21 name=__codelineno-1-21 href=#__codelineno-1-21></a><span class=w>    </span><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-1-22 name=__codelineno-1-22 href=#__codelineno-1-22></a><span class=w>      </span><span class=nt>containers</span><span class=p>:</span>
<a id=__codelineno-1-23 name=__codelineno-1-23 href=#__codelineno-1-23></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">php-redis</span>
<a id=__codelineno-1-24 name=__codelineno-1-24 href=#__codelineno-1-24></a><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">gcr.io/google_samples/gb-frontend:v3</span>
<a id=__codelineno-1-25 name=__codelineno-1-25 href=#__codelineno-1-25></a><span class=w>        </span><span class=nt>resources</span><span class=p>:</span>
<a id=__codelineno-1-26 name=__codelineno-1-26 href=#__codelineno-1-26></a><span class=w>          </span><span class=nt>requests</span><span class=p>:</span>
<a id=__codelineno-1-27 name=__codelineno-1-27 href=#__codelineno-1-27></a><span class=w>            </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">100m</span>
<a id=__codelineno-1-28 name=__codelineno-1-28 href=#__codelineno-1-28></a><span class=w>            </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">100Mi</span>
<a id=__codelineno-1-29 name=__codelineno-1-29 href=#__codelineno-1-29></a><span class=w>        </span><span class=nt>env</span><span class=p>:</span>
<a id=__codelineno-1-30 name=__codelineno-1-30 href=#__codelineno-1-30></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">GET_HOSTS_FROM</span>
<a id=__codelineno-1-31 name=__codelineno-1-31 href=#__codelineno-1-31></a><span class=w>          </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">dns</span>
<a id=__codelineno-1-32 name=__codelineno-1-32 href=#__codelineno-1-32></a><span class=w>          </span><span class=c1># If your cluster config does not include a dns service, then to</span>
<a id=__codelineno-1-33 name=__codelineno-1-33 href=#__codelineno-1-33></a><span class=w>          </span><span class=c1># instead access environment variables to find service host</span>
<a id=__codelineno-1-34 name=__codelineno-1-34 href=#__codelineno-1-34></a><span class=w>          </span><span class=c1># info, comment out the &#39;value: dns&#39; line above, and uncomment the</span>
<a id=__codelineno-1-35 name=__codelineno-1-35 href=#__codelineno-1-35></a><span class=w>          </span><span class=c1># line below.</span>
<a id=__codelineno-1-36 name=__codelineno-1-36 href=#__codelineno-1-36></a><span class=w>          </span><span class=c1># value: env</span>
<a id=__codelineno-1-37 name=__codelineno-1-37 href=#__codelineno-1-37></a><span class=w>        </span><span class=nt>ports</span><span class=p>:</span>
<a id=__codelineno-1-38 name=__codelineno-1-38 href=#__codelineno-1-38></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
</code></pre></div> <p>Replication Controller和ReplicaSet的创建、删除和Pod并无太大区别，</p> <p><strong>Replication Controller目前几乎已经不在生产环境中使用，ReplicaSet也很少单独被使用，都是使用更高级的资源Deployment、DaemonSet、StatefulSet管理Pod。</strong></p> <h2 id=2无状态应用管理deployment>2.无状态应用管理Deployment<a class=headerlink href=#2无状态应用管理deployment title="Permanent link">&para;</a></h2> <p>前文提到的ReplicaSet可以确保在任何给定时间运行的Pod副本达到指定的数量，但是Deployment是一个更高级的概念，它管理ReplicaSet并为Pod和ReplicaSet提供声明性更新以及许多其他有用的功能， 所以建议在生产环境下使用Deployment代替ReplicaSet。</p> <p>Deployment一般用于部署公司的无状态服务，这个也是最常用的控制器，因为企业内部现在都是以微服务为主，而微服务实现无状态化也是最佳实践， 可以利用Deployment的高级功能做到无缝迁移、自动扩容缩容、自动灾难恢复、一键回滚等功能。</p> <h3 id=21-创建deployment>2.1 创建Deployment<a class=headerlink href=#21-创建deployment title="Permanent link">&para;</a></h3> <p>创建一个Deployment也很简单，将前面章节创建Pod的YAML文件稍微更改一下即可变成Deployment的资源文件，比如创建一个有3个Nginx副本(实例)的Deployment，可以看到只是apiVersion和Kind有所变化，如下所示：</p> <p>dp-nginx.yml</p> <div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=c1># 从Kubernetes 1.16版本开始，彻底废弃了其他的APIVersion，只能使用apps/v1，1.16以上的版本可以使用extension等</span>
<a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx-deployment</span>
<a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a><span class=w>  </span><span class=nt>labels</span><span class=p>:</span>
<a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<a id=__codelineno-2-10 name=__codelineno-2-10 href=#__codelineno-2-10></a><span class=w>  </span><span class=nt>selector</span><span class=p>:</span>
<a id=__codelineno-2-11 name=__codelineno-2-11 href=#__codelineno-2-11></a><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span>
<a id=__codelineno-2-12 name=__codelineno-2-12 href=#__codelineno-2-12></a><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<a id=__codelineno-2-13 name=__codelineno-2-13 href=#__codelineno-2-13></a><span class=w>  </span><span class=nt>template</span><span class=p>:</span>
<a id=__codelineno-2-14 name=__codelineno-2-14 href=#__codelineno-2-14></a><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-2-15 name=__codelineno-2-15 href=#__codelineno-2-15></a><span class=w>      </span><span class=nt>labels</span><span class=p>:</span>
<a id=__codelineno-2-16 name=__codelineno-2-16 href=#__codelineno-2-16></a><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<a id=__codelineno-2-17 name=__codelineno-2-17 href=#__codelineno-2-17></a><span class=w>    </span><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-2-18 name=__codelineno-2-18 href=#__codelineno-2-18></a><span class=w>      </span><span class=nt>containers</span><span class=p>:</span>
<a id=__codelineno-2-19 name=__codelineno-2-19 href=#__codelineno-2-19></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<a id=__codelineno-2-20 name=__codelineno-2-20 href=#__codelineno-2-20></a><span class=w>          </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx:1.7.9</span>
<a id=__codelineno-2-21 name=__codelineno-2-21 href=#__codelineno-2-21></a><span class=w>          </span><span class=nt>ports</span><span class=p>:</span>
<a id=__codelineno-2-22 name=__codelineno-2-22 href=#__codelineno-2-22></a><span class=w>            </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
</code></pre></div> <p>示例解析：</p> <ul> <li>nginx-deployment：Deployment的名称。</li> <li>replicas：创建Pod的副本数。</li> <li>selector：定义Deployment如何找到要管理的Pod，与template的</li> </ul> <p>label（标签）对应，apiVersion为apps/v1必须指定该字段。 - template字段包含以下字段：</p> <p>◆ app: nginx使用label（标签）标记Pod。</p> <p>◆ spec：表示Pod运行一个名字为nginx的容器。</p> <p>◆ image：运行此Pod使用的镜像。</p> <p>◆ Port：容器用于发送和接收流量的端口。</p> <p>使用kubectl create创建此Deployment：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a>$<span class=w> </span>kubectl<span class=w> </span>apply<span class=w> </span>-f<span class=w>  </span>dp-nginx.yml
<a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a>deployment.apps/nginx-deployment<span class=w> </span>created
</code></pre></div> <p>使用kubectl get或者kubectl describe查看此Deployment的状态：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>deployment
<a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a>NAME<span class=w>               </span>READY<span class=w>   </span>UP-TO-DATE<span class=w>   </span>AVAILABLE<span class=w>   </span>AGE
<a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a>nginx-deployment<span class=w>   </span><span class=m>3</span>/3<span class=w>     </span><span class=m>3</span><span class=w>            </span><span class=m>3</span><span class=w>           </span>2m45s
</code></pre></div> <p>可以使用rollout命令查看整个Deployment创建的状态：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a>$<span class=w> </span>kubectl<span class=w> </span>rollout<span class=w> </span>status<span class=w> </span>deployment/nginx-deployment
<a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a>deployment<span class=w> </span><span class=s2>&quot;nginx-deployment&quot;</span><span class=w> </span>successfully<span class=w> </span>rolled<span class=w> </span>out
</code></pre></div> <p>当rollout结束时，再次查看此Deployment，可以看到AVAILABLE的数量和YAML文件中定义的replicas相同：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>deployment
<a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a>NAME<span class=w>               </span>READY<span class=w>   </span>UP-TO-DATE<span class=w>   </span>AVAILABLE<span class=w>   </span>AGE
<a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a>nginx-deployment<span class=w>   </span><span class=m>3</span>/3<span class=w>     </span><span class=m>3</span><span class=w>            </span><span class=m>3</span><span class=w>           </span>2m45s
</code></pre></div> <p>之前讲过Deployment通过ReplicaSet管理Pod，可以查看此Deployment当前对应的ReplicaSet：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>rs<span class=w> </span>-l<span class=w> </span><span class=nv>app</span><span class=o>=</span>nginx
<a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a>NAME<span class=w>                          </span>DESIRED<span class=w>   </span>CURRENT<span class=w>   </span>READY<span class=w>   </span>AGE
<a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a>nginx-deployment-5d59d67564<span class=w>   </span><span class=m>3</span><span class=w>         </span><span class=m>3</span><span class=w>         </span><span class=m>3</span><span class=w>       </span>4m44s
<a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a>
<a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a>
<a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>pod<span class=w> </span>-l<span class=w> </span><span class=nv>app</span><span class=o>=</span>nginx
<a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a>NAME<span class=w>                                </span>READY<span class=w>   </span>STATUS<span class=w>    </span>RESTARTS<span class=w>   </span>AGE
<a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a>nginx-deployment-5d59d67564-qns4q<span class=w>   </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>6m2s
<a id=__codelineno-7-9 name=__codelineno-7-9 href=#__codelineno-7-9></a>nginx-deployment-5d59d67564-vqqb9<span class=w>   </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>6m2s
<a id=__codelineno-7-10 name=__codelineno-7-10 href=#__codelineno-7-10></a>nginx-deployment-5d59d67564-xsssg<span class=w>   </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>6m2s
</code></pre></div> <div class="admonition warning 注意"> <p class=admonition-title>Warning</p> <p>ReplicaSet的命名格式为[DEPLOYMENT-NAME]-[POD-TEMPLATE-HASH-VALUE]POD-TEMPLATE-HASH-VALUE，是自动生成的，不用手动指定。</p> </div> <p>如果Deployment有过更新，对应的ReplicaSet可能不止一个，可以通过<code>-o yaml</code>获取当前对应的ReplicaSet是哪个，其余的ReplicaSet为保留的历史版本，用于回滚等操作。</p> <p>查看此Deployment创建的Pod，可以看到Pod的hash值5d59d67564和上述Deployment对应的ReplicaSet的hash值一致：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>pods<span class=w> </span>--show-labels
<a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a>NAME<span class=w>                                </span>READY<span class=w>   </span>STATUS<span class=w>    </span>RESTARTS<span class=w>   </span>AGE<span class=w>   </span>LABELS
<a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a>nginx-deployment-5d59d67564-qns4q<span class=w>   </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>14m<span class=w>   </span><span class=nv>app</span><span class=o>=</span>nginx,pod-template-hash<span class=o>=</span>5d59d67564
<a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a>nginx-deployment-5d59d67564-vqqb9<span class=w>   </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>14m<span class=w>   </span><span class=nv>app</span><span class=o>=</span>nginx,pod-template-hash<span class=o>=</span>5d59d67564
<a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a>nginx-deployment-5d59d67564-xsssg<span class=w>   </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>14m<span class=w>   </span><span class=nv>app</span><span class=o>=</span>nginx,pod-template-hash<span class=o>=</span>5d59d67564
</code></pre></div> <h3 id=22-更新deployment>2.2 更新Deployment<a class=headerlink href=#22-更新deployment title="Permanent link">&para;</a></h3> <p>通过Deployment部署应用后，经常会有Deployment文件的配置更改或者镜像版本迭代的需求，更改配置后该Deployment会创建新的ReplicaSet，之后会对管理的Pod进行滚动升级。</p> <div class="admonition warning 注意"> <p class=admonition-title>Warning</p> <p>当且仅当Deployment的Pod模板（即.spec.template）更改时，才会触发Deployment更新，例如更改内存、CPU配置或者容器的image。</p> </div> <p>假如更新Nginx Pod的image使用nginx:1.9.1，并使用--record记录当前更改的参数，后期回滚时可以查看到对应的信息：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a>$<span class=w> </span>kubectl<span class=w> </span><span class=nb>set</span><span class=w> </span>image<span class=w> </span>deployment<span class=w> </span>nginx-deployment<span class=w> </span><span class=nv>nginx</span><span class=o>=</span>nginx:1.9.1<span class=w> </span>--record
<a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a>deployment.extensions/nginx-deployment<span class=w> </span>image<span class=w> </span>updated
</code></pre></div> <p>当然，也可以使用edit命令直接编辑Deployment，效果相同：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a>$<span class=w> </span>kubectl<span class=w> </span>edit<span class=w> </span>deployment.v1.apps/nginx-deployment
<a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a>deployment.apps/nginx-deployment<span class=w> </span>edited
</code></pre></div> <p>同样，可以使用kubectl rollout status查看更新过程：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a>$<span class=w> </span>kubectl<span class=w> </span>rollout<span class=w> </span>status<span class=w> </span>deployment/nginx-deployment
<a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a>Waiting<span class=w> </span><span class=k>for</span><span class=w> </span>deployment<span class=w> </span><span class=s2>&quot;nginx-deployment&quot;</span><span class=w> </span>rollout<span class=w> </span>to<span class=w> </span>finish:<span class=w> </span><span class=m>1</span><span class=w> </span>out<span class=w> </span>of<span class=w> </span><span class=m>3</span><span class=w> </span>new<span class=w> </span>replicas<span class=w> </span>have<span class=w> </span>been<span class=w> </span>updated...
<a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a>Waiting<span class=w> </span><span class=k>for</span><span class=w> </span>deployment<span class=w> </span><span class=s2>&quot;nginx-deployment&quot;</span><span class=w> </span>rollout<span class=w> </span>to<span class=w> </span>finish:<span class=w> </span><span class=m>1</span><span class=w> </span>out<span class=w> </span>of<span class=w> </span><span class=m>3</span><span class=w> </span>new<span class=w> </span>replicas<span class=w> </span>have<span class=w> </span>been<span class=w> </span>updated...
<a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a>Waiting<span class=w> </span><span class=k>for</span><span class=w> </span>deployment<span class=w> </span><span class=s2>&quot;nginx-deployment&quot;</span><span class=w> </span>rollout<span class=w> </span>to<span class=w> </span>finish:<span class=w> </span><span class=m>1</span><span class=w> </span>out<span class=w> </span>of<span class=w> </span><span class=m>3</span><span class=w> </span>new<span class=w> </span>replicas<span class=w> </span>have<span class=w> </span>been<span class=w> </span>updated...
<a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a>Waiting<span class=w> </span><span class=k>for</span><span class=w> </span>deployment<span class=w> </span><span class=s2>&quot;nginx-deployment&quot;</span><span class=w> </span>rollout<span class=w> </span>to<span class=w> </span>finish:<span class=w> </span><span class=m>2</span><span class=w> </span>out<span class=w> </span>of<span class=w> </span><span class=m>3</span><span class=w> </span>new<span class=w> </span>replicas<span class=w> </span>have<span class=w> </span>been<span class=w> </span>updated...
<a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a>Waiting<span class=w> </span><span class=k>for</span><span class=w> </span>deployment<span class=w> </span><span class=s2>&quot;nginx-deployment&quot;</span><span class=w> </span>rollout<span class=w> </span>to<span class=w> </span>finish:<span class=w> </span><span class=m>2</span><span class=w> </span>out<span class=w> </span>of<span class=w> </span><span class=m>3</span><span class=w> </span>new<span class=w> </span>replicas<span class=w> </span>have<span class=w> </span>been<span class=w> </span>updated...
<a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a>Waiting<span class=w> </span><span class=k>for</span><span class=w> </span>deployment<span class=w> </span><span class=s2>&quot;nginx-deployment&quot;</span><span class=w> </span>rollout<span class=w> </span>to<span class=w> </span>finish:<span class=w> </span><span class=m>2</span><span class=w> </span>out<span class=w> </span>of<span class=w> </span><span class=m>3</span><span class=w> </span>new<span class=w> </span>replicas<span class=w> </span>have<span class=w> </span>been<span class=w> </span>updated...
<a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a>Waiting<span class=w> </span><span class=k>for</span><span class=w> </span>deployment<span class=w> </span><span class=s2>&quot;nginx-deployment&quot;</span><span class=w> </span>rollout<span class=w> </span>to<span class=w> </span>finish:<span class=w> </span><span class=m>1</span><span class=w> </span>old<span class=w> </span>replicas<span class=w> </span>are<span class=w> </span>pending<span class=w> </span>termination...
<a id=__codelineno-11-9 name=__codelineno-11-9 href=#__codelineno-11-9></a>Waiting<span class=w> </span><span class=k>for</span><span class=w> </span>deployment<span class=w> </span><span class=s2>&quot;nginx-deployment&quot;</span><span class=w> </span>rollout<span class=w> </span>to<span class=w> </span>finish:<span class=w> </span><span class=m>1</span><span class=w> </span>old<span class=w> </span>replicas<span class=w> </span>are<span class=w> </span>pending<span class=w> </span>termination...
<a id=__codelineno-11-10 name=__codelineno-11-10 href=#__codelineno-11-10></a>deployment<span class=w> </span><span class=s2>&quot;nginx-deployment&quot;</span><span class=w> </span>successfully<span class=w> </span>rolled<span class=w> </span>out
</code></pre></div> <p>可以看出更新过程为新旧交替更新，首先新建一个Pod，当Pod状态为Running时，删除一个旧的Pod，同时创建一个新的Pod。</p> <p>当触发一个更新后，会有新的ReplicaSet产生，旧的ReplicaSet会被保存，查看此时的ReplicaSet，可以从AGE或READY看出新旧ReplicaSet：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>rs
<a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a>NAME<span class=w>                          </span>DESIRED<span class=w>   </span>CURRENT<span class=w>   </span>READY<span class=w>   </span>AGE
<a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a>nginx-deployment-5d59d67564<span class=w>   </span><span class=m>0</span><span class=w>         </span><span class=m>0</span><span class=w>         </span><span class=m>0</span><span class=w>       </span>19m
<a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a>nginx-deployment-69c44dfb78<span class=w>   </span><span class=m>3</span><span class=w>         </span><span class=m>3</span><span class=w>         </span><span class=m>3</span><span class=w>       </span>3m25s
</code></pre></div> <p>通过describe查看Deployment的详细信息</p> <div class=highlight><pre><span></span><code><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a>$<span class=w> </span>kubectl<span class=w> </span>describe<span class=w> </span>deployment<span class=w> </span>nginx-deployment
<a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a>Name:<span class=w>                   </span>nginx-deployment
<a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a>Namespace:<span class=w>              </span>default
<a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a>CreationTimestamp:<span class=w>      </span>Wed,<span class=w> </span><span class=m>14</span><span class=w> </span>Sep<span class=w> </span><span class=m>2022</span><span class=w> </span><span class=m>16</span>:35:56<span class=w> </span>+0800
<a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a>Labels:<span class=w>                 </span><span class=nv>app</span><span class=o>=</span>nginx
<a id=__codelineno-13-6 name=__codelineno-13-6 href=#__codelineno-13-6></a>Annotations:<span class=w>            </span>deployment.kubernetes.io/revision:<span class=w> </span><span class=m>2</span>
<a id=__codelineno-13-7 name=__codelineno-13-7 href=#__codelineno-13-7></a><span class=w>                        </span>kubernetes.io/change-cause:<span class=w> </span>kubectl<span class=w> </span><span class=nb>set</span><span class=w> </span>image<span class=w> </span>deployment<span class=w> </span>nginx-deployment<span class=w> </span><span class=nv>nginx</span><span class=o>=</span>nginx:1.9.1<span class=w> </span>--record<span class=o>=</span><span class=nb>true</span>
<a id=__codelineno-13-8 name=__codelineno-13-8 href=#__codelineno-13-8></a>Selector:<span class=w>               </span><span class=nv>app</span><span class=o>=</span>nginx
<a id=__codelineno-13-9 name=__codelineno-13-9 href=#__codelineno-13-9></a>Replicas:<span class=w>               </span><span class=m>3</span><span class=w> </span>desired<span class=w> </span><span class=p>|</span><span class=w> </span><span class=m>3</span><span class=w> </span>updated<span class=w> </span><span class=p>|</span><span class=w> </span><span class=m>3</span><span class=w> </span>total<span class=w> </span><span class=p>|</span><span class=w> </span><span class=m>3</span><span class=w> </span>available<span class=w> </span><span class=p>|</span><span class=w> </span><span class=m>0</span><span class=w> </span>unavailable
<a id=__codelineno-13-10 name=__codelineno-13-10 href=#__codelineno-13-10></a>....
<a id=__codelineno-13-11 name=__codelineno-13-11 href=#__codelineno-13-11></a>Events:
<a id=__codelineno-13-12 name=__codelineno-13-12 href=#__codelineno-13-12></a><span class=w>  </span>Type<span class=w>    </span>Reason<span class=w>             </span>Age<span class=w>    </span>From<span class=w>                   </span>Message
<a id=__codelineno-13-13 name=__codelineno-13-13 href=#__codelineno-13-13></a><span class=w>  </span>----<span class=w>    </span>------<span class=w>             </span>----<span class=w>   </span>----<span class=w>                   </span>-------
<a id=__codelineno-13-14 name=__codelineno-13-14 href=#__codelineno-13-14></a><span class=w>  </span>Normal<span class=w>  </span>ScalingReplicaSet<span class=w>  </span>24m<span class=w>    </span>deployment-controller<span class=w>  </span>Scaled<span class=w> </span>up<span class=w> </span>replica<span class=w> </span><span class=nb>set</span><span class=w> </span>nginx-deployment-5d59d67564<span class=w> </span>to<span class=w> </span><span class=m>3</span>
<a id=__codelineno-13-15 name=__codelineno-13-15 href=#__codelineno-13-15></a><span class=w>  </span>Normal<span class=w>  </span>ScalingReplicaSet<span class=w>  </span>8m22s<span class=w>  </span>deployment-controller<span class=w>  </span>Scaled<span class=w> </span>up<span class=w> </span>replica<span class=w> </span><span class=nb>set</span><span class=w> </span>nginx-deployment-69c44dfb78<span class=w> </span>to<span class=w> </span><span class=m>1</span>
<a id=__codelineno-13-16 name=__codelineno-13-16 href=#__codelineno-13-16></a><span class=w>  </span>Normal<span class=w>  </span>ScalingReplicaSet<span class=w>  </span>7m47s<span class=w>  </span>deployment-controller<span class=w>  </span>Scaled<span class=w> </span>down<span class=w> </span>replica<span class=w> </span><span class=nb>set</span><span class=w> </span>nginx-deployment-5d59d67564<span class=w> </span>to<span class=w> </span><span class=m>2</span>
<a id=__codelineno-13-17 name=__codelineno-13-17 href=#__codelineno-13-17></a><span class=w>  </span>Normal<span class=w>  </span>ScalingReplicaSet<span class=w>  </span>7m46s<span class=w>  </span>deployment-controller<span class=w>  </span>Scaled<span class=w> </span>up<span class=w> </span>replica<span class=w> </span><span class=nb>set</span><span class=w> </span>nginx-deployment-69c44dfb78<span class=w> </span>to<span class=w> </span><span class=m>2</span>
<a id=__codelineno-13-18 name=__codelineno-13-18 href=#__codelineno-13-18></a><span class=w>  </span>Normal<span class=w>  </span>ScalingReplicaSet<span class=w>  </span>7m14s<span class=w>  </span>deployment-controller<span class=w>  </span>Scaled<span class=w> </span>down<span class=w> </span>replica<span class=w> </span><span class=nb>set</span><span class=w> </span>nginx-deployment-5d59d67564<span class=w> </span>to<span class=w> </span><span class=m>1</span>
<a id=__codelineno-13-19 name=__codelineno-13-19 href=#__codelineno-13-19></a><span class=w>  </span>Normal<span class=w>  </span>ScalingReplicaSet<span class=w>  </span>7m14s<span class=w>  </span>deployment-controller<span class=w>  </span>Scaled<span class=w> </span>up<span class=w> </span>replica<span class=w> </span><span class=nb>set</span><span class=w> </span>nginx-deployment-69c44dfb78<span class=w> </span>to<span class=w> </span><span class=m>3</span>
<a id=__codelineno-13-20 name=__codelineno-13-20 href=#__codelineno-13-20></a><span class=w>  </span>Normal<span class=w>  </span>ScalingReplicaSet<span class=w>  </span>6m49s<span class=w>  </span>deployment-controller<span class=w>  </span>Scaled<span class=w> </span>down<span class=w> </span>replica<span class=w> </span><span class=nb>set</span><span class=w> </span>nginx-deployment-5d59d67564<span class=w> </span>to<span class=w> </span><span class=m>0</span>
</code></pre></div> <p>在describe中可以看出，第一次创建时，它创建了一个名为nginx-deployment-5d59d67564，并直接将其扩展为3个副本。 更新部署时 ，它创建了一个新的ReplicaSet，命名为nginx-deployment-6987cdb55b，并将其副本数扩展为1，然后将旧的ReplicaSet缩小为2，这样至少可以有两个Pod可用，最多创建了4个Pod。</p> <p>以此类推，使用相同的滚动更新策略向上和向下扩展新旧ReplicaSet，最终新的ReplicaSet可以拥有3个副本，并将旧的ReplicaSet缩小为0。</p> <p>更新部署时，它创建了一个新的ReplicaSet，命名为nginx-deployment-69c44dfb78，并将其副本数扩展为1，然后将旧的ReplicaSet缩小为2，这样至少可以有两个Pod可用，最多创建了4个Pod。</p> <p>以此类推，使用相同的滚动更新策略向上和向下扩展新旧ReplicaSet，最终新的ReplicaSet可以拥有3个副本，并将旧的ReplicaSet缩小为0。</p> <h3 id=23-回滚deployment>2.3 回滚Deployment<a class=headerlink href=#23-回滚deployment title="Permanent link">&para;</a></h3> <p>当更新的版本不稳定或配置不合理时，可以对其进行回滚操作，假设我们又进行了几次更新(此处以更新镜像版本触发更新，更改配置效果类)：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a>$<span class=w> </span>kubectl<span class=w> </span><span class=nb>set</span><span class=w> </span>image<span class=w> </span>deployment<span class=w> </span>nginx-deployment<span class=w> </span><span class=nv>nginx</span><span class=o>=</span>dotbalo/canary:v1<span class=w> </span>--record
<a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a>$<span class=w> </span>kubectl<span class=w> </span><span class=nb>set</span><span class=w> </span>image<span class=w> </span>deployment<span class=w> </span>nginx-deployment<span class=w> </span><span class=nv>nginx</span><span class=o>=</span>dotbalo/canary:v2<span class=w> </span>--record
</code></pre></div> <p>使用kubectl rollout history查看更新历史：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a>$<span class=w> </span>kubectl<span class=w> </span>rollout<span class=w> </span><span class=nb>history</span><span class=w> </span>deployment/nginx-deployment
<a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a>deployment.apps/nginx-deployment
<a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a>REVISION<span class=w>  </span>CHANGE-CAUSE
<a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a><span class=m>1</span><span class=w>         </span>&lt;none&gt;
<a id=__codelineno-15-5 name=__codelineno-15-5 href=#__codelineno-15-5></a><span class=m>2</span><span class=w>         </span>kubectl<span class=w> </span><span class=nb>set</span><span class=w> </span>image<span class=w> </span>deployment<span class=w> </span>nginx-deployment<span class=w> </span><span class=nv>nginx</span><span class=o>=</span>nginx:1.9.1<span class=w> </span>--record<span class=o>=</span><span class=nb>true</span>
<a id=__codelineno-15-6 name=__codelineno-15-6 href=#__codelineno-15-6></a><span class=m>3</span><span class=w>         </span>kubectl<span class=w> </span><span class=nb>set</span><span class=w> </span>image<span class=w> </span>deployment<span class=w> </span>nginx-deployment<span class=w> </span><span class=nv>nginx</span><span class=o>=</span>dotbalo/canary:v1<span class=w> </span>--record<span class=o>=</span><span class=nb>true</span>
<a id=__codelineno-15-7 name=__codelineno-15-7 href=#__codelineno-15-7></a><span class=m>4</span><span class=w>         </span>kubectl<span class=w> </span><span class=nb>set</span><span class=w> </span>image<span class=w> </span>deployment<span class=w> </span>nginx-deployment<span class=w> </span><span class=nv>nginx</span><span class=o>=</span>dotbalo/canary:v2<span class=w> </span>--record<span class=o>=</span><span class=nb>true</span>
</code></pre></div> <p>查看Deployment某次更新的详细信息，使用--revision指定某次更新的版本号：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a>$<span class=w> </span>kubectl<span class=w> </span>rollout<span class=w> </span><span class=nb>history</span><span class=w> </span>deployment/nginx-deployment<span class=w> </span>--revision<span class=o>=</span><span class=m>3</span>
<a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a>deployment.apps/nginx-deployment<span class=w> </span>with<span class=w> </span>revision<span class=w> </span><span class=c1>#3</span>
<a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a>Pod<span class=w> </span>Template:
<a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a><span class=w>  </span>Labels:<span class=w>       </span><span class=nv>app</span><span class=o>=</span>nginx
<a id=__codelineno-16-5 name=__codelineno-16-5 href=#__codelineno-16-5></a><span class=w>        </span>pod-template-hash<span class=o>=</span>666f99dd56
<a id=__codelineno-16-6 name=__codelineno-16-6 href=#__codelineno-16-6></a><span class=w>  </span>Annotations:<span class=w>  </span>kubernetes.io/change-cause:<span class=w> </span>kubectl<span class=w> </span><span class=nb>set</span><span class=w> </span>image<span class=w> </span>deployment<span class=w> </span>nginx-deployment<span class=w> </span><span class=nv>nginx</span><span class=o>=</span>dotbalo/canary:v1<span class=w> </span>--record<span class=o>=</span><span class=nb>true</span>
<a id=__codelineno-16-7 name=__codelineno-16-7 href=#__codelineno-16-7></a><span class=w>  </span>Containers:
<a id=__codelineno-16-8 name=__codelineno-16-8 href=#__codelineno-16-8></a><span class=w>   </span>nginx:
<a id=__codelineno-16-9 name=__codelineno-16-9 href=#__codelineno-16-9></a><span class=w>    </span>Image:<span class=w>      </span>dotbalo/canary:v1
<a id=__codelineno-16-10 name=__codelineno-16-10 href=#__codelineno-16-10></a><span class=w>    </span>Port:<span class=w>       </span><span class=m>80</span>/TCP
<a id=__codelineno-16-11 name=__codelineno-16-11 href=#__codelineno-16-11></a><span class=w>    </span>Host<span class=w> </span>Port:<span class=w>  </span><span class=m>0</span>/TCP
<a id=__codelineno-16-12 name=__codelineno-16-12 href=#__codelineno-16-12></a><span class=w>    </span>Environment:<span class=w>        </span>&lt;none&gt;
<a id=__codelineno-16-13 name=__codelineno-16-13 href=#__codelineno-16-13></a><span class=w>    </span>Mounts:<span class=w>     </span>&lt;none&gt;
<a id=__codelineno-16-14 name=__codelineno-16-14 href=#__codelineno-16-14></a><span class=w>  </span>Volumes:<span class=w>      </span>&lt;none&gt;
</code></pre></div> <p>如果只需要回滚到上一个稳定版本，使用kubectl rollout undo即可：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a>$<span class=w> </span>kubectl<span class=w> </span>rollout<span class=w> </span>undo<span class=w> </span>deployment/nginx-deployment
<a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a>deployment.apps/nginx-deployment<span class=w> </span>rolled<span class=w> </span>back
<a id=__codelineno-17-3 name=__codelineno-17-3 href=#__codelineno-17-3></a>
<a id=__codelineno-17-4 name=__codelineno-17-4 href=#__codelineno-17-4></a><span class=c1># 再次查看更新历史，发现REVISION5回到了canary:v1：</span>
<a id=__codelineno-17-5 name=__codelineno-17-5 href=#__codelineno-17-5></a>$<span class=w> </span>kubectl<span class=w> </span>rollout<span class=w> </span><span class=nb>history</span><span class=w> </span>deployment/nginx-deployment
<a id=__codelineno-17-6 name=__codelineno-17-6 href=#__codelineno-17-6></a>deployment.apps/nginx-deployment
<a id=__codelineno-17-7 name=__codelineno-17-7 href=#__codelineno-17-7></a>REVISION<span class=w>  </span>CHANGE-CAUSE
<a id=__codelineno-17-8 name=__codelineno-17-8 href=#__codelineno-17-8></a><span class=m>1</span><span class=w>         </span>&lt;none&gt;
<a id=__codelineno-17-9 name=__codelineno-17-9 href=#__codelineno-17-9></a><span class=m>2</span><span class=w>         </span>kubectl<span class=w> </span><span class=nb>set</span><span class=w> </span>image<span class=w> </span>deployment<span class=w> </span>nginx-deployment<span class=w> </span><span class=nv>nginx</span><span class=o>=</span>nginx:1.9.1<span class=w> </span>--record<span class=o>=</span><span class=nb>true</span>
<a id=__codelineno-17-10 name=__codelineno-17-10 href=#__codelineno-17-10></a><span class=m>4</span><span class=w>         </span>kubectl<span class=w> </span><span class=nb>set</span><span class=w> </span>image<span class=w> </span>deployment<span class=w> </span>nginx-deployment<span class=w> </span><span class=nv>nginx</span><span class=o>=</span>dotbalo/canary:v2<span class=w> </span>--record<span class=o>=</span><span class=nb>true</span>
<a id=__codelineno-17-11 name=__codelineno-17-11 href=#__codelineno-17-11></a><span class=m>5</span><span class=w>         </span>kubectl<span class=w> </span><span class=nb>set</span><span class=w> </span>image<span class=w> </span>deployment<span class=w> </span>nginx-deployment<span class=w> </span><span class=nv>nginx</span><span class=o>=</span>dotbalo/canary:v1<span class=w> </span>--record<span class=o>=</span><span class=nb>true</span>
</code></pre></div> <p>如果要回滚到指定版本，使用--to-revision参数：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a>$<span class=w> </span>kubectl<span class=w> </span>rollout<span class=w> </span>undo<span class=w> </span>deployment/nginx-deployment<span class=w> </span>--to-revision<span class=o>=</span><span class=m>2</span>
<a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a>deployment.extensions/nginx-deployment
<a id=__codelineno-18-3 name=__codelineno-18-3 href=#__codelineno-18-3></a>
<a id=__codelineno-18-4 name=__codelineno-18-4 href=#__codelineno-18-4></a>$<span class=w> </span>kubectl<span class=w> </span>rollout<span class=w> </span><span class=nb>history</span><span class=w> </span>deployment/nginx-deployment
<a id=__codelineno-18-5 name=__codelineno-18-5 href=#__codelineno-18-5></a>deployment.apps/nginx-deployment
<a id=__codelineno-18-6 name=__codelineno-18-6 href=#__codelineno-18-6></a>REVISION<span class=w>  </span>CHANGE-CAUSE
<a id=__codelineno-18-7 name=__codelineno-18-7 href=#__codelineno-18-7></a><span class=m>1</span><span class=w>         </span>&lt;none&gt;
<a id=__codelineno-18-8 name=__codelineno-18-8 href=#__codelineno-18-8></a><span class=m>4</span><span class=w>         </span>kubectl<span class=w> </span><span class=nb>set</span><span class=w> </span>image<span class=w> </span>deployment<span class=w> </span>nginx-deployment<span class=w> </span><span class=nv>nginx</span><span class=o>=</span>dotbalo/canary:v2<span class=w> </span>--record<span class=o>=</span><span class=nb>true</span>
<a id=__codelineno-18-9 name=__codelineno-18-9 href=#__codelineno-18-9></a><span class=m>5</span><span class=w>         </span>kubectl<span class=w> </span><span class=nb>set</span><span class=w> </span>image<span class=w> </span>deployment<span class=w> </span>nginx-deployment<span class=w> </span><span class=nv>nginx</span><span class=o>=</span>dotbalo/canary:v1<span class=w> </span>--record<span class=o>=</span><span class=nb>true</span>
<a id=__codelineno-18-10 name=__codelineno-18-10 href=#__codelineno-18-10></a><span class=m>6</span><span class=w>         </span>kubectl<span class=w> </span><span class=nb>set</span><span class=w> </span>image<span class=w> </span>deployment<span class=w> </span>nginx-deployment<span class=w> </span><span class=nv>nginx</span><span class=o>=</span>nginx:1.9.1<span class=w> </span>--record<span class=o>=</span><span class=nb>true</span>
</code></pre></div> <h3 id=24-扩容deployment>2.4 扩容Deployment<a class=headerlink href=#24-扩容deployment title="Permanent link">&para;</a></h3> <p>当公司访问量变大，或者有预期内的活动时，3个Pod可能已无法支撑业务时，可以提前对其进行扩展。</p> <p>使用kubectl scale动态调整Pod的副本数，比如增加Pod为5个：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a>$<span class=w> </span>kubectl<span class=w> </span>scale<span class=w> </span>deployment.v1.apps/nginx-deployment<span class=w> </span>--replicas<span class=o>=</span><span class=m>5</span>
<a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a>deployment.apps/nginx-deployment<span class=w> </span>scaled
<a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a>
<a id=__codelineno-19-4 name=__codelineno-19-4 href=#__codelineno-19-4></a>$<span class=w> </span>kubectl<span class=w> </span>rollout<span class=w> </span>status<span class=w> </span>deployment/nginx-deployment
<a id=__codelineno-19-5 name=__codelineno-19-5 href=#__codelineno-19-5></a>Waiting<span class=w> </span><span class=k>for</span><span class=w> </span>deployment<span class=w> </span><span class=s2>&quot;nginx-deployment&quot;</span><span class=w> </span>rollout<span class=w> </span>to<span class=w> </span>finish:<span class=w> </span><span class=m>3</span><span class=w> </span>of<span class=w> </span><span class=m>5</span><span class=w> </span>updated<span class=w> </span>replicas<span class=w> </span>are<span class=w> </span>available...
<a id=__codelineno-19-6 name=__codelineno-19-6 href=#__codelineno-19-6></a>Waiting<span class=w> </span><span class=k>for</span><span class=w> </span>deployment<span class=w> </span><span class=s2>&quot;nginx-deployment&quot;</span><span class=w> </span>rollout<span class=w> </span>to<span class=w> </span>finish:<span class=w> </span><span class=m>4</span><span class=w> </span>of<span class=w> </span><span class=m>5</span><span class=w> </span>updated<span class=w> </span>replicas<span class=w> </span>are<span class=w> </span>available...
<a id=__codelineno-19-7 name=__codelineno-19-7 href=#__codelineno-19-7></a>deployment<span class=w> </span><span class=s2>&quot;nginx-deployment&quot;</span><span class=w> </span>successfully<span class=w> </span>rolled<span class=w> </span>out
</code></pre></div> <p>查看Pod，此时Pod已经变成了5个：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>pod
<a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a>NAME<span class=w>                                </span>READY<span class=w>   </span>STATUS<span class=w>    </span>RESTARTS<span class=w>   </span>AGE
<a id=__codelineno-20-3 name=__codelineno-20-3 href=#__codelineno-20-3></a>nginx-deployment-69c44dfb78-cqdd7<span class=w>   </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>50s
<a id=__codelineno-20-4 name=__codelineno-20-4 href=#__codelineno-20-4></a>nginx-deployment-69c44dfb78-lnx2s<span class=w>   </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>2m44s
<a id=__codelineno-20-5 name=__codelineno-20-5 href=#__codelineno-20-5></a>nginx-deployment-69c44dfb78-qz6gw<span class=w>   </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>2m40s
<a id=__codelineno-20-6 name=__codelineno-20-6 href=#__codelineno-20-6></a>nginx-deployment-69c44dfb78-tltjh<span class=w>   </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>2m42s
<a id=__codelineno-20-7 name=__codelineno-20-7 href=#__codelineno-20-7></a>nginx-deployment-69c44dfb78-xgwk6<span class=w>   </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>50s
</code></pre></div> <h3 id=25-暂停和恢复deployment更新>2.5 暂停和恢复Deployment更新<a class=headerlink href=#25-暂停和恢复deployment更新 title="Permanent link">&para;</a></h3> <p>上述演示的均为更改某一处的配置，更改后立即触发更新，大多数情况下可能需要针对一个资源文件更改多处地方，而并不需要多次触发更新， 此时可以使用Deployment暂停功能，临时禁用更新操作，对Deployment进行多次修改后再进行更新。</p> <p>使用kubectl rollout pause命令即可暂停Deployment更新：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a>$<span class=w> </span>kubectl<span class=w> </span>rollout<span class=w> </span>pause<span class=w> </span>deployment/nginx-deployment
<a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a>deployment.apps/nginx-deployment<span class=w> </span>paused
</code></pre></div> <p>然后对Deployment进行相关更新操作，比如先更新镜像，然后对其资源进行限制（如果使用的是kubectl edit命令，可以直接进行多次修改，无须暂停更新，kubectl set命令一般会集成在CICD流水线中）：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a>$<span class=w> </span>kubectl<span class=w> </span><span class=nb>set</span><span class=w> </span>image<span class=w> </span>deployment.v1.apps/nginx-deployment<span class=w> </span><span class=nv>nginx</span><span class=o>=</span>nginx:1.9.1
<a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a>
<a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a>$<span class=w> </span>kubectl<span class=w> </span><span class=nb>set</span><span class=w> </span>resources<span class=w> </span>deployment.v1.apps/nginx-deployment<span class=w> </span>-c<span class=o>=</span>nginx<span class=w> </span>--limits<span class=o>=</span><span class=nv>cpu</span><span class=o>=</span>200m,memory<span class=o>=</span>512Mi
<a id=__codelineno-22-4 name=__codelineno-22-4 href=#__codelineno-22-4></a>deployment.apps/nginx-deployment<span class=w> </span>resource<span class=w> </span>requirements<span class=w> </span>updated
</code></pre></div> <p>进行完最后一处配置更改后，使用kubectl rollout resume恢复Deployment更新：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a>$<span class=w> </span>kubectl<span class=w> </span>rollout<span class=w> </span>resume<span class=w> </span>deployment.v1.apps/nginx-deployment
<a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a>deployment.apps/nginx-deployment<span class=w> </span>resumed
</code></pre></div> <p>可以查看到恢复更新的Deployment创建了一个新的ReplicaSet：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>rs
<a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a>NAME<span class=w>                          </span>DESIRED<span class=w>   </span>CURRENT<span class=w>   </span>READY<span class=w>   </span>AGE
<a id=__codelineno-24-3 name=__codelineno-24-3 href=#__codelineno-24-3></a>nginx-deployment-5d59d67564<span class=w>   </span><span class=m>0</span><span class=w>         </span><span class=m>0</span><span class=w>         </span><span class=m>0</span><span class=w>       </span>73m
<a id=__codelineno-24-4 name=__codelineno-24-4 href=#__codelineno-24-4></a>nginx-deployment-666f99dd56<span class=w>   </span><span class=m>0</span><span class=w>         </span><span class=m>0</span><span class=w>         </span><span class=m>0</span><span class=w>       </span>36m
<a id=__codelineno-24-5 name=__codelineno-24-5 href=#__codelineno-24-5></a>nginx-deployment-69c44dfb78<span class=w>   </span><span class=m>0</span><span class=w>         </span><span class=m>0</span><span class=w>         </span><span class=m>0</span><span class=w>       </span>58m
<a id=__codelineno-24-6 name=__codelineno-24-6 href=#__codelineno-24-6></a>nginx-deployment-79d4d8c7d5<span class=w>   </span><span class=m>0</span><span class=w>         </span><span class=m>0</span><span class=w>         </span><span class=m>0</span><span class=w>       </span>35m
<a id=__codelineno-24-7 name=__codelineno-24-7 href=#__codelineno-24-7></a>nginx-deployment-f7fdb4ccd<span class=w>    </span><span class=m>5</span><span class=w>         </span><span class=m>5</span><span class=w>         </span><span class=m>4</span><span class=w>       </span>113s
</code></pre></div> <p>可以查看到Deployment的image（镜像）已经变为nginx:1.9.1：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a>$<span class=w> </span>kubectl<span class=w> </span>describe<span class=w> </span>deploy<span class=w> </span>nginx-deployment
<a id=__codelineno-25-2 name=__codelineno-25-2 href=#__codelineno-25-2></a>Name:<span class=w>                   </span>nginx-deployment
<a id=__codelineno-25-3 name=__codelineno-25-3 href=#__codelineno-25-3></a>Namespace:<span class=w>              </span>default
<a id=__codelineno-25-4 name=__codelineno-25-4 href=#__codelineno-25-4></a>......
<a id=__codelineno-25-5 name=__codelineno-25-5 href=#__codelineno-25-5></a>RollingUpdateStrategy:<span class=w>  </span><span class=m>25</span>%<span class=w> </span>max<span class=w> </span>unavailable,<span class=w> </span><span class=m>25</span>%<span class=w> </span>max<span class=w> </span>surge
<a id=__codelineno-25-6 name=__codelineno-25-6 href=#__codelineno-25-6></a>Pod<span class=w> </span>Template:
<a id=__codelineno-25-7 name=__codelineno-25-7 href=#__codelineno-25-7></a><span class=w>  </span>Labels:<span class=w>  </span><span class=nv>app</span><span class=o>=</span>nginx
<a id=__codelineno-25-8 name=__codelineno-25-8 href=#__codelineno-25-8></a><span class=w>  </span>Containers:
<a id=__codelineno-25-9 name=__codelineno-25-9 href=#__codelineno-25-9></a><span class=w>   </span>nginx:
<a id=__codelineno-25-10 name=__codelineno-25-10 href=#__codelineno-25-10></a><span class=w>    </span>Image:<span class=w>      </span>nginx:1.9.1
</code></pre></div> <h3 id=26-更新deployment的注意事项>2.6 更新Deployment的注意事项<a class=headerlink href=#26-更新deployment的注意事项 title="Permanent link">&para;</a></h3> <p>历史版本清理策略：</p> <p>在默认情况下，revision保留10个旧的ReplicaSet，其余的将在后台进行垃圾回收，可以在.spec.revisionHistoryLimit设置保留ReplicaSet的个数。当设置为0时，不保留历史记录。</p> <p>更新策略：</p> <ul> <li>.spec.strategy.type==Recreate：表示重建，先删掉旧的Pod，再创建新的Pod。</li> <li> <p>.spec.strategy.type==RollingUpdate：表示滚动更新，可以指定maxUnavailable和maxSurge来控制滚动更新过程。</p> <ul> <li> <p>.spec.strategy.rollingUpdate.maxUnavailable：指定在回滚更新时最大不可用的Pod数量，可选字段，默认为25%，可以设置为数字或百分比，如果maxSurge为0，则该值不能为0。</p> </li> <li> <p>.spec.strategy.rollingUpdate.maxSurge：可以超过期望值的最大Pod数，可选字段，默认为25%，可以设置成数字或百分比，如果maxUnavailable为0，则该值不能为0。</p> </li> </ul> </li> </ul> <p>Ready策略：</p> <ul> <li>.spec.minReadySeconds是可选参数，指定新创建的Pod应该在没有任何容器崩溃的情况下视为Ready（就绪）状态的最小秒数，默认为0，即一旦被创建就视为可用，通常和容器探针连用。</li> </ul> <h2 id=3有状态应用管理statefulset>3.有状态应用管理StatefulSet<a class=headerlink href=#3有状态应用管理statefulset title="Permanent link">&para;</a></h2> <p>StatefulSet（有状态集，缩写为sts）常用于部署有状态的且需要有序启动的应用程序，比如在进行Spring Cloud项目容器化时， Eureka的部署是比较适合用StatefulSet部署方式的，可以给每个Eureka实例创建一个唯一且固定的标识符，并且每个Eureka实例无须配置多余的Service， 其余Spring Boot应用可以直接通过Eureka的Headless Service进行注册。</p> <h3 id=31-statefulset的基本概念>3.1 StatefulSet的基本概念<a class=headerlink href=#31-statefulset的基本概念 title="Permanent link">&para;</a></h3> <p>StatefulSet主要用于管理有状态应用程序的工作负载API对象。</p> <p>比如在生产环境中，可以部署ElasticSearch集群、MongoDB集群或者需要持久化的RabbitMQ集群、Redis集群、Kafka集群和ZooKeeper集群等。</p> <p>和Deployment类似，一个StatefulSet也同样管理着基于相同容器规范的Pod。不同的是，StatefulSet为每个Pod维护了一个黏性标识。</p> <p>这些Pod是根据相同的规范创建的，但是不可互换，每个Pod都有一个持久的标识符，在重新调度时也会保留，一般格式为StatefulSetName-Number。 比如定义一个名字是Redis-Sentinel的StatefulSet，指定创建3个Pod，那么创建出来的Pod名字就为Redis-Sentinel-0、Redis-Sentinel-1、Redis-Sentinel-2。 而StatefulSet创建的Pod一般使用Headless Service（无头服务）进行通信，和普通的Service的区别在于Headless Service没有ClusterIP，它使用Endpoint进行互相通信，Headless一般的格式为：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a>statefulSetName-<span class=o>{</span><span class=m>0</span>..N-1<span class=o>}</span>.serviceName.namespace.svc.cluster.local
</code></pre></div> <p>配置说明：</p> <ul> <li>serviceName为Headless Service的名字，创建StatefulSet时必须指定Headless Service名称。</li> <li>0..N‒1为Pod所在的序号，从0开始到N‒1。</li> <li>statefulSetName为StatefulSet的名字。</li> <li>namespace为服务所在的命名空间。</li> <li>.cluster.local为Cluster Domain（集群域）。</li> </ul> <p>假如公司某个项目需要在Kubernetes中部署一个主从模式的Redis，此时使用StatefulSet部署就极为合适，因为StatefulSet启动时，只有当前一个容器完全启动时，后一个容器才会被调度，并且每个容器的标识符是固定的， 那么就可以通过标识符来断定当前Pod的角色。</p> <p>比如用一个名为redis-ms的StatefulSet部署主从架构的Redis，第一个容器启动时，它的标识符为redis-ms-0，并且Pod内主机名也为redis-ms-0，此时就可以根据主机名来判断， 当主机名为redis-ms-0的容器作为Redis的主节点，其余为从节点，那么Slave连接Master主机配置就可以使用不会更改的Master的Headless Service，此时Redis从节点（Slave）配置文件如下：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a> port 6379
<a id=__codelineno-27-2 name=__codelineno-27-2 href=#__codelineno-27-2></a> slaveof redis-ms-0.redis-ms.public-service.svc.cluster.local 6379
<a id=__codelineno-27-3 name=__codelineno-27-3 href=#__codelineno-27-3></a> tcp-backlog 511
<a id=__codelineno-27-4 name=__codelineno-27-4 href=#__codelineno-27-4></a> timeout 0
<a id=__codelineno-27-5 name=__codelineno-27-5 href=#__codelineno-27-5></a> tcp-keepalive 0
<a id=__codelineno-27-6 name=__codelineno-27-6 href=#__codelineno-27-6></a> ...
</code></pre></div> <p>其中redis-ms-0.redis-ms.public-service.svc.cluster.local是Redis Master的Headless Service，在同一命名空间下只需要写redis-ms-0.redis-ms即可，后面的public-service.svc.cluster.local可以省略。</p> <h3 id=32-statefulset的注意事项>3.2 StatefulSet的注意事项<a class=headerlink href=#32-statefulset的注意事项 title="Permanent link">&para;</a></h3> <p>一般StatefulSet用于有以下一个或者多个需求的应用程序：</p> <ul> <li>需要稳定的独一无二的网络标识符。</li> <li>需要持久化数据。</li> <li>需要有序的、优雅的部署和扩展。</li> <li>需要有序的自动滚动更新。</li> </ul> <p>如果应用程序不需要任何稳定的标识符或者有序的部署、删除或者扩展，应该使用无状态的控制器部署应用程序，比如Deployment或者ReplicaSet。StatefulSet是Kubernetes 1.9版本之前的beta资源，在1.5版本之前的任何Kubernetes版本都没有。</p> <p>Pod所用的存储必须由PersistentVolume Provisioner（持久化卷配置器）根据请求配置StorageClass，或者由管理员预先配置，当然也可以不配置存储。</p> <p>为了确保数据安全，删除和缩放StatefulSet不会删除与StatefulSet关联的卷，可以手动选择性地删除PVC和PV。</p> <p>StatefulSet目前使用Headless Service（无头服务）负责Pod的网络身份和通信，需要提前创建此服务。</p> <h3 id=33-定义一个statefulset资源文件>3.3 定义一个StatefulSet资源文件<a class=headerlink href=#33-定义一个statefulset资源文件 title="Permanent link">&para;</a></h3> <p>定义一个简单的StatefulSet的示例如下：</p> <p>sts-web.yml</p> <div class=highlight><pre><span></span><code><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id=__codelineno-28-2 name=__codelineno-28-2 href=#__codelineno-28-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<a id=__codelineno-28-3 name=__codelineno-28-3 href=#__codelineno-28-3></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-28-4 name=__codelineno-28-4 href=#__codelineno-28-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<a id=__codelineno-28-5 name=__codelineno-28-5 href=#__codelineno-28-5></a><span class=w>  </span><span class=nt>labels</span><span class=p>:</span>
<a id=__codelineno-28-6 name=__codelineno-28-6 href=#__codelineno-28-6></a><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<a id=__codelineno-28-7 name=__codelineno-28-7 href=#__codelineno-28-7></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-28-8 name=__codelineno-28-8 href=#__codelineno-28-8></a><span class=w>  </span><span class=nt>ports</span><span class=p>:</span>
<a id=__codelineno-28-9 name=__codelineno-28-9 href=#__codelineno-28-9></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<a id=__codelineno-28-10 name=__codelineno-28-10 href=#__codelineno-28-10></a><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">web</span>
<a id=__codelineno-28-11 name=__codelineno-28-11 href=#__codelineno-28-11></a><span class=w>  </span><span class=nt>clusterIP</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">None</span>
<a id=__codelineno-28-12 name=__codelineno-28-12 href=#__codelineno-28-12></a><span class=w>  </span><span class=nt>selector</span><span class=p>:</span>
<a id=__codelineno-28-13 name=__codelineno-28-13 href=#__codelineno-28-13></a><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<a id=__codelineno-28-14 name=__codelineno-28-14 href=#__codelineno-28-14></a><span class=nn>---</span>
<a id=__codelineno-28-15 name=__codelineno-28-15 href=#__codelineno-28-15></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<a id=__codelineno-28-16 name=__codelineno-28-16 href=#__codelineno-28-16></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">StatefulSet</span>
<a id=__codelineno-28-17 name=__codelineno-28-17 href=#__codelineno-28-17></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-28-18 name=__codelineno-28-18 href=#__codelineno-28-18></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">web</span>
<a id=__codelineno-28-19 name=__codelineno-28-19 href=#__codelineno-28-19></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-28-20 name=__codelineno-28-20 href=#__codelineno-28-20></a><span class=w>  </span><span class=nt>serviceName</span><span class=p>:</span><span class=w> </span><span class=s>&quot;nginx&quot;</span>
<a id=__codelineno-28-21 name=__codelineno-28-21 href=#__codelineno-28-21></a><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<a id=__codelineno-28-22 name=__codelineno-28-22 href=#__codelineno-28-22></a><span class=w>  </span><span class=nt>selector</span><span class=p>:</span>
<a id=__codelineno-28-23 name=__codelineno-28-23 href=#__codelineno-28-23></a><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span>
<a id=__codelineno-28-24 name=__codelineno-28-24 href=#__codelineno-28-24></a><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<a id=__codelineno-28-25 name=__codelineno-28-25 href=#__codelineno-28-25></a><span class=w>  </span><span class=nt>template</span><span class=p>:</span>
<a id=__codelineno-28-26 name=__codelineno-28-26 href=#__codelineno-28-26></a><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-28-27 name=__codelineno-28-27 href=#__codelineno-28-27></a><span class=w>      </span><span class=nt>labels</span><span class=p>:</span>
<a id=__codelineno-28-28 name=__codelineno-28-28 href=#__codelineno-28-28></a><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<a id=__codelineno-28-29 name=__codelineno-28-29 href=#__codelineno-28-29></a><span class=w>    </span><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-28-30 name=__codelineno-28-30 href=#__codelineno-28-30></a><span class=w>      </span><span class=nt>containers</span><span class=p>:</span>
<a id=__codelineno-28-31 name=__codelineno-28-31 href=#__codelineno-28-31></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<a id=__codelineno-28-32 name=__codelineno-28-32 href=#__codelineno-28-32></a><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<a id=__codelineno-28-33 name=__codelineno-28-33 href=#__codelineno-28-33></a><span class=w>        </span><span class=nt>ports</span><span class=p>:</span>
<a id=__codelineno-28-34 name=__codelineno-28-34 href=#__codelineno-28-34></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<a id=__codelineno-28-35 name=__codelineno-28-35 href=#__codelineno-28-35></a><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">web</span>
</code></pre></div> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>此示例没有添加存储配置，后面的章节会单独讲解存储相关的知识点。</p> </div> <p>其中：</p> <ul> <li>kind: Service定义了一个名字为Nginx的Headless Service，创建的Service格式为nginx-0.nginx.default.svc.cluster.local，其他的类似，因为没有指定Namespace（命名空间），所以默认部署在default。</li> <li>kind: StatefulSet定义了一个名字为web的StatefulSet，replicas表示部署Pod的副本数，本实例为2。</li> </ul> <p>在StatefulSet中必须设置Pod选择器（.spec.selector）用来匹配其标签（.spec.template.metadata.labels）。 在1.8版本之前，如果未配置该字段（.spec.selector），将被设置为默认值，在1.8版本之后，如果未指定匹配Pod Selector，则会导致StatefulSet创建错误。</p> <p>当StatefulSet控制器创建Pod时，它会添加一个标签statefulset.kubernetes.io/pod-name，该标签的值为Pod的名称，用于匹配Service。</p> <h3 id=34-创建statefulset>3.4 创建StatefulSet<a class=headerlink href=#34-创建statefulset title="Permanent link">&para;</a></h3> <p>创建StatefulSet：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-29-1 name=__codelineno-29-1 href=#__codelineno-29-1></a>$<span class=w> </span>kubectl<span class=w> </span>create<span class=w> </span>-f<span class=w> </span>sts-web.yml
<a id=__codelineno-29-2 name=__codelineno-29-2 href=#__codelineno-29-2></a>service/nginx<span class=w> </span>created
<a id=__codelineno-29-3 name=__codelineno-29-3 href=#__codelineno-29-3></a>statefulset.apps/web<span class=w> </span>created
<a id=__codelineno-29-4 name=__codelineno-29-4 href=#__codelineno-29-4></a>
<a id=__codelineno-29-5 name=__codelineno-29-5 href=#__codelineno-29-5></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>sts
<a id=__codelineno-29-6 name=__codelineno-29-6 href=#__codelineno-29-6></a>NAME<span class=w>   </span>READY<span class=w>   </span>AGE
<a id=__codelineno-29-7 name=__codelineno-29-7 href=#__codelineno-29-7></a>web<span class=w>    </span><span class=m>2</span>/2<span class=w>     </span>41s
<a id=__codelineno-29-8 name=__codelineno-29-8 href=#__codelineno-29-8></a>
<a id=__codelineno-29-9 name=__codelineno-29-9 href=#__codelineno-29-9></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>svc
<a id=__codelineno-29-10 name=__codelineno-29-10 href=#__codelineno-29-10></a>NAME<span class=w>         </span>TYPE<span class=w>        </span>CLUSTER-IP<span class=w>   </span>EXTERNAL-IP<span class=w>   </span>PORT<span class=o>(</span>S<span class=o>)</span><span class=w>   </span>AGE
<a id=__codelineno-29-11 name=__codelineno-29-11 href=#__codelineno-29-11></a>kubernetes<span class=w>   </span>ClusterIP<span class=w>   </span><span class=m>10</span>.96.0.1<span class=w>    </span>&lt;none&gt;<span class=w>        </span><span class=m>443</span>/TCP<span class=w>   </span>142d
<a id=__codelineno-29-12 name=__codelineno-29-12 href=#__codelineno-29-12></a>nginx<span class=w>        </span>ClusterIP<span class=w>   </span>None<span class=w>         </span>&lt;none&gt;<span class=w>        </span><span class=m>80</span>/TCP<span class=w>    </span>67s
<a id=__codelineno-29-13 name=__codelineno-29-13 href=#__codelineno-29-13></a>
<a id=__codelineno-29-14 name=__codelineno-29-14 href=#__codelineno-29-14></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>pod<span class=w> </span>-l<span class=w> </span><span class=nv>app</span><span class=o>=</span>nginx
<a id=__codelineno-29-15 name=__codelineno-29-15 href=#__codelineno-29-15></a>NAME<span class=w>    </span>READY<span class=w>   </span>STATUS<span class=w>    </span>RESTARTS<span class=w>   </span>AGE
<a id=__codelineno-29-16 name=__codelineno-29-16 href=#__codelineno-29-16></a>web-0<span class=w>   </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>6m57s
<a id=__codelineno-29-17 name=__codelineno-29-17 href=#__codelineno-29-17></a>web-1<span class=w>   </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>6m36s
</code></pre></div> <p>此时使用StatefulSet部署了两个Pod，分别为web-0、web-1，同时也创建一个CLUSTER-IP为None的Headless Service，</p> <p>在同一个命名空间内使用web-0.nginx和web-1.nginx即可访问这两个Pod，</p> <p>跨命名空间可以使用web-0.nginx.default访问（跨命名空间访问资源的情况很少，应当尽量规避）。</p> <p>向Headless Service对象请求服务</p> <div class=highlight><pre><span></span><code><a id=__codelineno-30-1 name=__codelineno-30-1 href=#__codelineno-30-1></a>$<span class=w> </span>kubectl<span class=w> </span>run<span class=w> </span>cirros-<span class=nv>$RANDOM</span><span class=w> </span>--rm<span class=w> </span>-it<span class=w> </span>--image<span class=o>=</span>cirros<span class=w> </span>--<span class=w> </span>sh
<a id=__codelineno-30-2 name=__codelineno-30-2 href=#__codelineno-30-2></a>If<span class=w> </span>you<span class=w> </span>don<span class=err>&#39;</span>t<span class=w> </span>see<span class=w> </span>a<span class=w> </span><span class=nb>command</span><span class=w> </span>prompt,<span class=w> </span>try<span class=w> </span>pressing<span class=w> </span>enter.
<a id=__codelineno-30-3 name=__codelineno-30-3 href=#__codelineno-30-3></a>/<span class=w> </span><span class=c1># / # curl web-0.nginx</span>
<a id=__codelineno-30-4 name=__codelineno-30-4 href=#__codelineno-30-4></a>&lt;!DOCTYPE<span class=w> </span>html&gt;
<a id=__codelineno-30-5 name=__codelineno-30-5 href=#__codelineno-30-5></a>&lt;html&gt;
<a id=__codelineno-30-6 name=__codelineno-30-6 href=#__codelineno-30-6></a>&lt;head&gt;
<a id=__codelineno-30-7 name=__codelineno-30-7 href=#__codelineno-30-7></a>&lt;title&gt;Welcome<span class=w> </span>to<span class=w> </span>nginx!&lt;/title&gt;
<a id=__codelineno-30-8 name=__codelineno-30-8 href=#__codelineno-30-8></a>&lt;style&gt;
<a id=__codelineno-30-9 name=__codelineno-30-9 href=#__codelineno-30-9></a>......
<a id=__codelineno-30-10 name=__codelineno-30-10 href=#__codelineno-30-10></a>&lt;/body&gt;
<a id=__codelineno-30-11 name=__codelineno-30-11 href=#__codelineno-30-11></a>&lt;/html&gt;
<a id=__codelineno-30-12 name=__codelineno-30-12 href=#__codelineno-30-12></a>
<a id=__codelineno-30-13 name=__codelineno-30-13 href=#__codelineno-30-13></a>/<span class=w> </span><span class=c1># curl web-1.nginx</span>
<a id=__codelineno-30-14 name=__codelineno-30-14 href=#__codelineno-30-14></a>&lt;!DOCTYPE<span class=w> </span>html&gt;
<a id=__codelineno-30-15 name=__codelineno-30-15 href=#__codelineno-30-15></a>&lt;html&gt;
<a id=__codelineno-30-16 name=__codelineno-30-16 href=#__codelineno-30-16></a>&lt;head&gt;
<a id=__codelineno-30-17 name=__codelineno-30-17 href=#__codelineno-30-17></a>&lt;title&gt;Welcome<span class=w> </span>to<span class=w> </span>nginx!&lt;/title&gt;
<a id=__codelineno-30-18 name=__codelineno-30-18 href=#__codelineno-30-18></a>&lt;style&gt;
<a id=__codelineno-30-19 name=__codelineno-30-19 href=#__codelineno-30-19></a>......
<a id=__codelineno-30-20 name=__codelineno-30-20 href=#__codelineno-30-20></a>&lt;/body&gt;
<a id=__codelineno-30-21 name=__codelineno-30-21 href=#__codelineno-30-21></a>&lt;/html&gt;
</code></pre></div> <h3 id=35-statefulset创建pod的流程>3.5 StatefulSet创建Pod的流程<a class=headerlink href=#35-statefulset创建pod的流程 title="Permanent link">&para;</a></h3> <p>StatefulSet管理的Pod部署和扩展规则如下：</p> <ul> <li>对于具有N个副本的StatefulSet，将按顺序从0到N‒1开始创建Pod。</li> <li>当删除Pod时，将按照N‒1到0的反顺序终止。</li> <li>在缩放Pod之前，必须保证当前的Pod是Running（运行中）或者Ready（就绪）。</li> <li>在终止Pod之前，它所有的继任者必须是完全关闭状态。</li> </ul> <p>StatefulSet的pod.Spec.TerminationGracePeriodSeconds（终止Pod的等待时间）不应该指定为0， 设置为0对StatefulSet的Pod是极其不安全的做法，优雅地删除StatefulSet的Pod是非常有必要的，而且是安全的，因为它可以确保在Kubelet从APIServer删除之前，让Pod正常关闭。</p> <p>当创建上面的Nginx实例时，Pod将按web-0、web-1、web-2的顺序部署3个Pod。</p> <p>在web-0处于Running或者Ready之前，web-1不会被部署，相同的，web-2在web-1未处于Running和Ready之前也不会被部署。</p> <p>如果在web-1处于Running和Ready状态时，web-0变成Failed（失败）状态，那么web-2将不会被启动，直到web-0恢复为Running和Ready状态。</p> <p>如果用户将StatefulSet的replicas设置为1，那么web-2将首先被终止，在完全关闭并删除web-2之前，不会删除web-1。</p> <p>如果web-2终止并且完全关闭后，web-0突然失败，那么在web-0未恢复成Running或者Ready时，web-1不会被删除。</p> <h3 id=36-statefulset扩容和缩容>3.6 StatefulSet扩容和缩容<a class=headerlink href=#36-statefulset扩容和缩容 title="Permanent link">&para;</a></h3> <p>和Deployment类似，可以通过更新replicas字段扩容/缩容StatefulSet，也可以使用kubectl scale、kubectl edit和kubectl patch来扩容/缩容一个StatefulSet。</p> <p><strong>（1）扩容</strong></p> <p>将上述创建的StatefulSet副本增加到5个（如果StatefulSet挂载的为静态PV，需要在扩容之前先创建PV）：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-31-1 name=__codelineno-31-1 href=#__codelineno-31-1></a>$<span class=w> </span>kubectl<span class=w> </span>scale<span class=w> </span>sts<span class=w> </span>web<span class=w> </span>--replicas<span class=o>=</span><span class=m>5</span>
<a id=__codelineno-31-2 name=__codelineno-31-2 href=#__codelineno-31-2></a>statefulset.apps/web<span class=w> </span>scaled
</code></pre></div> <p>查看扩容后Pod的状态：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-32-1 name=__codelineno-32-1 href=#__codelineno-32-1></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>pod
<a id=__codelineno-32-2 name=__codelineno-32-2 href=#__codelineno-32-2></a>NAME<span class=w>              </span>READY<span class=w>   </span>STATUS<span class=w>    </span>RESTARTS<span class=w>   </span>AGE
<a id=__codelineno-32-3 name=__codelineno-32-3 href=#__codelineno-32-3></a>web-0<span class=w>             </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>34m
<a id=__codelineno-32-4 name=__codelineno-32-4 href=#__codelineno-32-4></a>web-1<span class=w>             </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>34m
<a id=__codelineno-32-5 name=__codelineno-32-5 href=#__codelineno-32-5></a>web-2<span class=w>             </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>2m37s
<a id=__codelineno-32-6 name=__codelineno-32-6 href=#__codelineno-32-6></a>web-3<span class=w>             </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>2m12s
<a id=__codelineno-32-7 name=__codelineno-32-7 href=#__codelineno-32-7></a>web-4<span class=w>             </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>109s
</code></pre></div> <p>也可使用以下命令动态查看：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-33-1 name=__codelineno-33-1 href=#__codelineno-33-1></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>pod<span class=w> </span>-l<span class=w> </span><span class=nv>app</span><span class=o>=</span>nginx<span class=w> </span>-w
<a id=__codelineno-33-2 name=__codelineno-33-2 href=#__codelineno-33-2></a>NAME<span class=w>    </span>READY<span class=w>   </span>STATUS<span class=w>    </span>RESTARTS<span class=w>   </span>AGE
<a id=__codelineno-33-3 name=__codelineno-33-3 href=#__codelineno-33-3></a>web-0<span class=w>   </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>34m
<a id=__codelineno-33-4 name=__codelineno-33-4 href=#__codelineno-33-4></a>web-1<span class=w>   </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>33m
<a id=__codelineno-33-5 name=__codelineno-33-5 href=#__codelineno-33-5></a>web-2<span class=w>   </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>2m12s
<a id=__codelineno-33-6 name=__codelineno-33-6 href=#__codelineno-33-6></a>web-3<span class=w>   </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>107s
<a id=__codelineno-33-7 name=__codelineno-33-7 href=#__codelineno-33-7></a>web-4<span class=w>   </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>84s
</code></pre></div> <p><strong>（2）缩容</strong></p> <p>首先打开另一个终端动态查看缩容的流程：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-34-1 name=__codelineno-34-1 href=#__codelineno-34-1></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>pod<span class=w> </span>-l<span class=w> </span><span class=nv>app</span><span class=o>=</span>nginx<span class=w> </span>-w
</code></pre></div> <p>在另一个终端将副本数改为3（此处演示的为patch命令，patch比edit和scale稍复杂一些）：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-35-1 name=__codelineno-35-1 href=#__codelineno-35-1></a>$<span class=w> </span>kubectl<span class=w> </span>patch<span class=w> </span>sts<span class=w> </span>web<span class=w> </span>-p<span class=w> </span><span class=s1>&#39;{&quot;spec&quot;:{&quot;replicas&quot;:3}}&#39;</span>
<a id=__codelineno-35-2 name=__codelineno-35-2 href=#__codelineno-35-2></a>statefulset.apps/web<span class=w> </span>patched
</code></pre></div> <p>此时可以看到第一个终端显示web-4和web-3的Pod正在被有序地删除（或终止）：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-36-1 name=__codelineno-36-1 href=#__codelineno-36-1></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>pod<span class=w> </span>-l<span class=w> </span><span class=nv>app</span><span class=o>=</span>nginx<span class=w> </span>-w
<a id=__codelineno-36-2 name=__codelineno-36-2 href=#__codelineno-36-2></a>NAME<span class=w>    </span>READY<span class=w>   </span>STATUS<span class=w>    </span>RESTARTS<span class=w>   </span>AGE
<a id=__codelineno-36-3 name=__codelineno-36-3 href=#__codelineno-36-3></a>web-0<span class=w>   </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>34m
<a id=__codelineno-36-4 name=__codelineno-36-4 href=#__codelineno-36-4></a>web-1<span class=w>   </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>33m
<a id=__codelineno-36-5 name=__codelineno-36-5 href=#__codelineno-36-5></a>web-2<span class=w>   </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>2m12s
<a id=__codelineno-36-6 name=__codelineno-36-6 href=#__codelineno-36-6></a>web-3<span class=w>   </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>107s
<a id=__codelineno-36-7 name=__codelineno-36-7 href=#__codelineno-36-7></a>web-4<span class=w>   </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>84s
<a id=__codelineno-36-8 name=__codelineno-36-8 href=#__codelineno-36-8></a>web-4<span class=w>   </span><span class=m>1</span>/1<span class=w>     </span>Terminating<span class=w>   </span><span class=m>0</span><span class=w>          </span>3m17s
<a id=__codelineno-36-9 name=__codelineno-36-9 href=#__codelineno-36-9></a>web-4<span class=w>   </span><span class=m>0</span>/1<span class=w>     </span>Terminating<span class=w>   </span><span class=m>0</span><span class=w>          </span>3m18s
<a id=__codelineno-36-10 name=__codelineno-36-10 href=#__codelineno-36-10></a>web-4<span class=w>   </span><span class=m>0</span>/1<span class=w>     </span>Terminating<span class=w>   </span><span class=m>0</span><span class=w>          </span>3m19s
<a id=__codelineno-36-11 name=__codelineno-36-11 href=#__codelineno-36-11></a>web-4<span class=w>   </span><span class=m>0</span>/1<span class=w>     </span>Terminating<span class=w>   </span><span class=m>0</span><span class=w>          </span>3m19s
<a id=__codelineno-36-12 name=__codelineno-36-12 href=#__codelineno-36-12></a>web-3<span class=w>   </span><span class=m>1</span>/1<span class=w>     </span>Terminating<span class=w>   </span><span class=m>0</span><span class=w>          </span>3m42s
<a id=__codelineno-36-13 name=__codelineno-36-13 href=#__codelineno-36-13></a>web-3<span class=w>   </span><span class=m>0</span>/1<span class=w>     </span>Terminating<span class=w>   </span><span class=m>0</span><span class=w>          </span>3m43s
<a id=__codelineno-36-14 name=__codelineno-36-14 href=#__codelineno-36-14></a>web-3<span class=w>   </span><span class=m>0</span>/1<span class=w>     </span>Terminating<span class=w>   </span><span class=m>0</span><span class=w>          </span>3m47s
<a id=__codelineno-36-15 name=__codelineno-36-15 href=#__codelineno-36-15></a>web-3<span class=w>   </span><span class=m>0</span>/1<span class=w>     </span>Terminating<span class=w>   </span><span class=m>0</span><span class=w>          </span>3m47s
</code></pre></div> <h3 id=37-statefulset更新策略>3.7 StatefulSet更新策略<a class=headerlink href=#37-statefulset更新策略 title="Permanent link">&para;</a></h3> <p>StatefulSet和Deployment一样，也提供了多种更新策略，可以在.spec.updateStrategy字段中指定StatefulSet的更新策略。</p> <p>（1）OnDelete策略</p> <p>OnDelete更新策略实现了传统（1.7版本之前）的行为，它也是默认的更新策略。 当我们选择这个更新策略并修改StatefulSet的.spec.template字段时，StatefulSet控制器不会自动更新Pod，必须手动删除Pod才能使控制器创建新的Pod。</p> <p>（2）RollingUpdate策略</p> <p>RollingUpdate（滚动更新）策略会自动更新一个StatefulSet中所有的Pod，采用与序号索引相反的顺序进行滚动更新。</p> <p>比如更改一个名称为web的StatefulSet使用RollingUpdate方式更新：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-37-1 name=__codelineno-37-1 href=#__codelineno-37-1></a>$<span class=w> </span>kubectl<span class=w> </span>patch<span class=w> </span>sts<span class=w> </span>web<span class=w> </span>-p<span class=w> </span><span class=s1>&#39;{&quot;spec&quot;:{&quot;updateStrategy&quot;:{&quot;type&quot;:&quot;RollingUpdate&quot;}}}&#39;</span>
<a id=__codelineno-37-2 name=__codelineno-37-2 href=#__codelineno-37-2></a>statefulset.apps/web<span class=w> </span>patched<span class=w> </span><span class=o>(</span>no<span class=w> </span>change<span class=o>)</span>
</code></pre></div> <p>查看更改后的StatefulSet：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-38-1 name=__codelineno-38-1 href=#__codelineno-38-1></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>sts<span class=w> </span>web<span class=w> </span>-o<span class=w> </span>yaml<span class=p>|</span>grep<span class=w> </span>-A<span class=w> </span><span class=m>1</span><span class=w> </span><span class=s2>&quot;updateStrategy&quot;</span>
<a id=__codelineno-38-2 name=__codelineno-38-2 href=#__codelineno-38-2></a><span class=w>  </span>updateStrategy:
<a id=__codelineno-38-3 name=__codelineno-38-3 href=#__codelineno-38-3></a><span class=w>    </span>rollingUpdate:
</code></pre></div> <p>然后改变容器的镜像触发滚动更新（此处使用jsonPath的方式更改的资源配置，可以使用set或edit减少复杂度）：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-39-1 name=__codelineno-39-1 href=#__codelineno-39-1></a>$<span class=w> </span>kubectl<span class=w> </span>patch<span class=w> </span>statefulset<span class=w> </span>web<span class=w> </span>--type<span class=o>=</span><span class=s1>&#39;json&#39;</span><span class=w> </span>-p<span class=o>=</span><span class=s1>&#39;[{&quot;op&quot;: &quot;replace&quot;, &quot;path&quot;: &quot;/spec/template/spec/containers/0/image&quot;, &quot;value&quot;:&quot;gcr.io/google_containers/nginx-slim:0.8&quot;}]&#39;</span>
</code></pre></div> <p>如上所述，StatefulSet中的Pod采用和序号相反的顺序更新。</p> <p>在更新下一个Pod前，StatefulSet控制器会终止每一个Pod并等待它们变成Running和Ready状态。 在当前顺序变成Running和Ready状态之前，StatefulSet控制器不会更新下一个Pod，但它仍然会重建任何在更新过程中发生故障的Pod，使用它们当前的版本。 已经接收到请求的Pod将会被恢复为更新的版本，没有收到请求的Pod则会被恢复为之前的版本。</p> <p>在更新过程中可以使用<code>kubectl rollout status sts/&lt;name&gt;</code>来查看滚动更新的状态：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-40-1 name=__codelineno-40-1 href=#__codelineno-40-1></a>$<span class=w> </span>kubectl<span class=w> </span>rollout<span class=w> </span>status<span class=w> </span>sts/web
<a id=__codelineno-40-2 name=__codelineno-40-2 href=#__codelineno-40-2></a>Waiting<span class=w> </span><span class=k>for</span><span class=w> </span><span class=m>1</span><span class=w> </span>pods<span class=w> </span>to<span class=w> </span>be<span class=w> </span>ready...
<a id=__codelineno-40-3 name=__codelineno-40-3 href=#__codelineno-40-3></a>waiting<span class=w> </span><span class=k>for</span><span class=w> </span>statefulset<span class=w> </span>rolling<span class=w> </span>update<span class=w> </span>to<span class=w> </span><span class=nb>complete</span><span class=w> </span><span class=m>1</span><span class=w> </span>pods<span class=w> </span>at<span class=w> </span>revision<span class=w> </span>web-56b5798f76...
<a id=__codelineno-40-4 name=__codelineno-40-4 href=#__codelineno-40-4></a>Waiting<span class=w> </span><span class=k>for</span><span class=w> </span><span class=m>1</span><span class=w> </span>pods<span class=w> </span>to<span class=w> </span>be<span class=w> </span>ready...
<a id=__codelineno-40-5 name=__codelineno-40-5 href=#__codelineno-40-5></a>Waiting<span class=w> </span><span class=k>for</span><span class=w> </span><span class=m>1</span><span class=w> </span>pods<span class=w> </span>to<span class=w> </span>be<span class=w> </span>ready...
<a id=__codelineno-40-6 name=__codelineno-40-6 href=#__codelineno-40-6></a>waiting<span class=w> </span><span class=k>for</span><span class=w> </span>statefulset<span class=w> </span>rolling<span class=w> </span>update<span class=w> </span>to<span class=w> </span><span class=nb>complete</span><span class=w> </span><span class=m>2</span><span class=w> </span>pods<span class=w> </span>at<span class=w> </span>revision<span class=w> </span>web-56b5798f76...
<a id=__codelineno-40-7 name=__codelineno-40-7 href=#__codelineno-40-7></a>Waiting<span class=w> </span><span class=k>for</span><span class=w> </span><span class=m>1</span><span class=w> </span>pods<span class=w> </span>to<span class=w> </span>be<span class=w> </span>ready...
<a id=__codelineno-40-8 name=__codelineno-40-8 href=#__codelineno-40-8></a>Waiting<span class=w> </span><span class=k>for</span><span class=w> </span><span class=m>1</span><span class=w> </span>pods<span class=w> </span>to<span class=w> </span>be<span class=w> </span>ready...
<a id=__codelineno-40-9 name=__codelineno-40-9 href=#__codelineno-40-9></a>statefulset<span class=w> </span>rolling<span class=w> </span>update<span class=w> </span><span class=nb>complete</span><span class=w> </span><span class=m>3</span><span class=w> </span>pods<span class=w> </span>at<span class=w> </span>revision<span class=w> </span>web-56b5798f76...
</code></pre></div> <p>查看更新后的镜像：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-41-1 name=__codelineno-41-1 href=#__codelineno-41-1></a>$<span class=w> </span><span class=k>for</span><span class=w> </span>p<span class=w> </span><span class=k>in</span><span class=w> </span><span class=m>0</span><span class=w> </span><span class=m>1</span><span class=w> </span><span class=m>2</span><span class=p>;</span><span class=w> </span><span class=k>do</span><span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>pod<span class=w> </span><span class=s2>&quot;web-</span><span class=nv>$p</span><span class=s2>&quot;</span><span class=w> </span>--template<span class=w> </span><span class=s1>&#39;{{range $i, $c := .spec.containers}}{{$c.image}}{{end}}&#39;</span><span class=p>;</span><span class=w> </span>echo<span class=p>;</span><span class=w> </span><span class=k>done</span>
</code></pre></div> <p><strong>（3）分段更新</strong></p> <p>StatefulSet可以使用RollingUpdate更新策略的partition参数来分段更新一个StatefulSet。</p> <p>分段更新将会使StatefulSet中其余的所有Pod（序号小于分区）保持当前版本，只更新序号大于等于分区的Pod，利用此特性可以简单实现金丝雀发布（灰度发布）或者分阶段推出新功能等。</p> <div class="admonition info"> <p class=admonition-title>提示</p> <p>金丝雀发布是指在黑与白之间能够平滑过渡的一种发布方式。</p> </div> <p>比如我们定义一个分区"partition":3，可以使用patch或edit直接对StatefulSet进行设置：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-42-1 name=__codelineno-42-1 href=#__codelineno-42-1></a>$<span class=w> </span>kubectl<span class=w> </span>patch<span class=w> </span>statefulset<span class=w> </span>web<span class=w> </span>-p<span class=w> </span><span class=s1>&#39;{&quot;spec&quot;:{&quot;updateStrategy&quot;:{&quot;type&quot;:&quot;RollingUpdate&quot;,&quot;rollingUpdate&quot;:{&quot;partition&quot;:3}}}}&#39;</span>
</code></pre></div> <p>然后再次使用patch改变容器的镜像：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-43-1 name=__codelineno-43-1 href=#__codelineno-43-1></a>$<span class=w> </span>kubectl<span class=w> </span>patch<span class=w> </span>statefulset<span class=w> </span>web<span class=w> </span>--type<span class=o>=</span><span class=s1>&#39;json&#39;</span><span class=w> </span>-p<span class=o>=</span><span class=s1>&#39;[{&quot;op&quot;: &quot;replace&quot;, &quot;path&quot;: &quot;/spec/template/spec/containers/0/image&quot;, &quot;value&quot;:&quot;registry.k8s.io/nginx-slim:0.7&quot;}]&#39;</span>
<a id=__codelineno-43-2 name=__codelineno-43-2 href=#__codelineno-43-2></a>statefulset.apps/web<span class=w> </span>patched
</code></pre></div> <p>删除 StatefulSet 中的 Pod 触发更新：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-44-1 name=__codelineno-44-1 href=#__codelineno-44-1></a>$<span class=w> </span>kubectl<span class=w> </span>delete<span class=w> </span>pod<span class=w> </span>web-2
<a id=__codelineno-44-2 name=__codelineno-44-2 href=#__codelineno-44-2></a>pod<span class=w> </span><span class=s2>&quot;web-2&quot;</span><span class=w> </span>deleted
</code></pre></div> <p>此时，因为Pod web-2的序号小于分区3，所以Pod不会被更新，还是会使用以前的容器恢复Pod。</p> <p>等待Pod变成Running和Ready。</p> <div class=highlight><pre><span></span><code><a id=__codelineno-45-1 name=__codelineno-45-1 href=#__codelineno-45-1></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>pod<span class=w> </span>-l<span class=w> </span><span class=nv>app</span><span class=o>=</span>nginx<span class=w> </span>-w
<a id=__codelineno-45-2 name=__codelineno-45-2 href=#__codelineno-45-2></a>NAME<span class=w>      </span>READY<span class=w>     </span>STATUS<span class=w>              </span>RESTARTS<span class=w>   </span>AGE
<a id=__codelineno-45-3 name=__codelineno-45-3 href=#__codelineno-45-3></a>web-0<span class=w>     </span><span class=m>1</span>/1<span class=w>       </span>Running<span class=w>             </span><span class=m>0</span><span class=w>          </span>4m
<a id=__codelineno-45-4 name=__codelineno-45-4 href=#__codelineno-45-4></a>web-1<span class=w>     </span><span class=m>1</span>/1<span class=w>       </span>Running<span class=w>             </span><span class=m>0</span><span class=w>          </span>4m
<a id=__codelineno-45-5 name=__codelineno-45-5 href=#__codelineno-45-5></a>web-2<span class=w>     </span><span class=m>0</span>/1<span class=w>       </span>ContainerCreating<span class=w>   </span><span class=m>0</span><span class=w>          </span>11s
<a id=__codelineno-45-6 name=__codelineno-45-6 href=#__codelineno-45-6></a>web-2<span class=w>     </span><span class=m>1</span>/1<span class=w>       </span>Running<span class=w>   </span><span class=m>0</span><span class=w>         </span>18s
</code></pre></div> <p>将分区改为2，此时会自动更新web-2（因为之前更改了更新策略），但是不会更新web-0和web-1：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-46-1 name=__codelineno-46-1 href=#__codelineno-46-1></a>$<span class=w> </span>kubectl<span class=w> </span>patch<span class=w> </span>statefulset<span class=w> </span>web<span class=w> </span>-p<span class=w> </span><span class=s1>&#39;{&quot;spec&quot;:{&quot;updateStrategy&quot;:{&quot;type&quot;:&quot;RollingUpdate&quot;,&quot;rollingUpdate&quot;:{&quot;partition&quot;:2}}}}&#39;</span>
</code></pre></div> <p>按照上述方式可以实现分阶段更新，类似于灰度/金丝雀发布。查看最终的结果如下：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-47-1 name=__codelineno-47-1 href=#__codelineno-47-1></a>$<span class=w> </span><span class=k>for</span><span class=w> </span>p<span class=w> </span><span class=k>in</span><span class=w> </span><span class=m>0</span><span class=w> </span><span class=m>1</span><span class=w> </span><span class=m>2</span><span class=p>;</span><span class=w> </span><span class=k>do</span><span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>pod<span class=w> </span><span class=s2>&quot;web-</span><span class=nv>$p</span><span class=s2>&quot;</span><span class=w> </span>--template<span class=w> </span><span class=s1>&#39;{{range $i, $c := .spec.containers}}{{$c.image}}{{end}}&#39;</span><span class=p>;</span><span class=w> </span>echo<span class=p>;</span><span class=w> </span><span class=k>done</span>
<a id=__codelineno-47-2 name=__codelineno-47-2 href=#__codelineno-47-2></a>registry.k8s.io/nginx-slim:0.8
<a id=__codelineno-47-3 name=__codelineno-47-3 href=#__codelineno-47-3></a>registry.k8s.io/nginx-slim:0.8
<a id=__codelineno-47-4 name=__codelineno-47-4 href=#__codelineno-47-4></a>registry.k8s.io/nginx-slim:0.8
</code></pre></div> <div class="admonition info"> <p class=admonition-title>请注意</p> <p>虽然更新策略是RollingUpdate，StatefulSet 还是会使用原始的容器恢复Pod。 这是因为Pod的序号比updateStrategy指定的partition更小。</p> </div> <h3 id=38-删除statefulset>3.8 删除StatefulSet<a class=headerlink href=#38-删除statefulset title="Permanent link">&para;</a></h3> <p>删除StatefulSet有两种方式，即级联删除和非级联删除。使用非级联方式删除StatefulSet时，StatefulSet的Pod不会被删除；</p> <p>使用级联方式删除StatefulSet时，StatefulSet和它的Pod都会被删除。</p> <p><strong>（1）非级联删除</strong></p> <p>使用kubectl delete sts xxx删除StatefulSet时，只需提供--cascade=false参数，就会采用非级联删除，此时删除StatefulSet不会删除它的Pod：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-48-1 name=__codelineno-48-1 href=#__codelineno-48-1></a>$<span class=w> </span>kubectl<span class=w> </span>delete<span class=w> </span>statefulset<span class=w> </span>web<span class=w> </span>--cascade<span class=o>=</span><span class=nb>false</span>
<a id=__codelineno-48-2 name=__codelineno-48-2 href=#__codelineno-48-2></a>warning:<span class=w> </span>--cascade<span class=o>=</span><span class=nb>false</span><span class=w> </span>is<span class=w> </span>deprecated<span class=w> </span><span class=o>(</span>boolean<span class=w> </span>value<span class=o>)</span><span class=w> </span>and<span class=w> </span>can<span class=w> </span>be<span class=w> </span>replaced<span class=w> </span>with<span class=w> </span>--cascade<span class=o>=</span>orphan.
<a id=__codelineno-48-3 name=__codelineno-48-3 href=#__codelineno-48-3></a>statefulset.apps<span class=w> </span><span class=s2>&quot;web&quot;</span><span class=w> </span>deleted
<a id=__codelineno-48-4 name=__codelineno-48-4 href=#__codelineno-48-4></a>
<a id=__codelineno-48-5 name=__codelineno-48-5 href=#__codelineno-48-5></a>
<a id=__codelineno-48-6 name=__codelineno-48-6 href=#__codelineno-48-6></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>sts
<a id=__codelineno-48-7 name=__codelineno-48-7 href=#__codelineno-48-7></a>No<span class=w> </span>resources<span class=w> </span>found<span class=w> </span><span class=k>in</span><span class=w> </span>default<span class=w> </span>namespace.
<a id=__codelineno-48-8 name=__codelineno-48-8 href=#__codelineno-48-8></a>
<a id=__codelineno-48-9 name=__codelineno-48-9 href=#__codelineno-48-9></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>pod
<a id=__codelineno-48-10 name=__codelineno-48-10 href=#__codelineno-48-10></a>NAME<span class=w>              </span>READY<span class=w>   </span>STATUS<span class=w>    </span>RESTARTS<span class=w>   </span>AGE
<a id=__codelineno-48-11 name=__codelineno-48-11 href=#__codelineno-48-11></a>web-0<span class=w>             </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>10m
<a id=__codelineno-48-12 name=__codelineno-48-12 href=#__codelineno-48-12></a>web-1<span class=w>             </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>10m
<a id=__codelineno-48-13 name=__codelineno-48-13 href=#__codelineno-48-13></a>web-2<span class=w>             </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>7m28s
</code></pre></div> <p>由于此时删除了StatefulSet，它管理的Pod变成了“孤儿”Pod，因此单独删除Pod时，该Pod不会被重建：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-49-1 name=__codelineno-49-1 href=#__codelineno-49-1></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>pod
<a id=__codelineno-49-2 name=__codelineno-49-2 href=#__codelineno-49-2></a>NAME<span class=w>              </span>READY<span class=w>   </span>STATUS<span class=w>    </span>RESTARTS<span class=w>   </span>AGE
<a id=__codelineno-49-3 name=__codelineno-49-3 href=#__codelineno-49-3></a>web-0<span class=w>             </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>3m11s
<a id=__codelineno-49-4 name=__codelineno-49-4 href=#__codelineno-49-4></a>web-1<span class=w>             </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>2m51s
<a id=__codelineno-49-5 name=__codelineno-49-5 href=#__codelineno-49-5></a>web-2<span class=w>             </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>2m34s
<a id=__codelineno-49-6 name=__codelineno-49-6 href=#__codelineno-49-6></a>
<a id=__codelineno-49-7 name=__codelineno-49-7 href=#__codelineno-49-7></a>$<span class=w> </span>kubectl<span class=w> </span>delete<span class=w> </span>po<span class=w> </span>web-0
<a id=__codelineno-49-8 name=__codelineno-49-8 href=#__codelineno-49-8></a>pod<span class=w> </span><span class=s2>&quot;web-0&quot;</span><span class=w> </span>deleted
<a id=__codelineno-49-9 name=__codelineno-49-9 href=#__codelineno-49-9></a>
<a id=__codelineno-49-10 name=__codelineno-49-10 href=#__codelineno-49-10></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>pod
<a id=__codelineno-49-11 name=__codelineno-49-11 href=#__codelineno-49-11></a>NAME<span class=w>              </span>READY<span class=w>   </span>STATUS<span class=w>    </span>RESTARTS<span class=w>   </span>AGE
<a id=__codelineno-49-12 name=__codelineno-49-12 href=#__codelineno-49-12></a>web-1<span class=w>             </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>3m53s
<a id=__codelineno-49-13 name=__codelineno-49-13 href=#__codelineno-49-13></a>web-2<span class=w>             </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>3m36s
</code></pre></div> <p>当再次创建此StatefulSet时，web-0会被重新创建，由于web-1已经存在，因此不会被再次创建，因为最初此StatefulSet的replicas是2，所以web-2会被删除， 代码如下（忽略AlreadyExists错误，因为只删除了StatefulSet并没删除Service，所以在此创建Service时会提示已经存在该Service）：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-50-1 name=__codelineno-50-1 href=#__codelineno-50-1></a>$<span class=w> </span>kubectl<span class=w> </span>create<span class=w> </span>-f<span class=w> </span>sts-web.yml
<a id=__codelineno-50-2 name=__codelineno-50-2 href=#__codelineno-50-2></a>statefulset.apps/web<span class=w> </span>created
<a id=__codelineno-50-3 name=__codelineno-50-3 href=#__codelineno-50-3></a>Error<span class=w> </span>from<span class=w> </span>server<span class=w> </span><span class=o>(</span>AlreadyExists<span class=o>)</span>:<span class=w> </span>error<span class=w> </span>when<span class=w> </span>creating<span class=w> </span><span class=s2>&quot;sts-web.yml&quot;</span>:<span class=w> </span>services<span class=w> </span><span class=s2>&quot;nginx&quot;</span><span class=w> </span>already<span class=w> </span>exists
<a id=__codelineno-50-4 name=__codelineno-50-4 href=#__codelineno-50-4></a>
<a id=__codelineno-50-5 name=__codelineno-50-5 href=#__codelineno-50-5></a>$<span class=w>  </span>kubectl<span class=w> </span>get<span class=w> </span>pod
<a id=__codelineno-50-6 name=__codelineno-50-6 href=#__codelineno-50-6></a>NAME<span class=w>              </span>READY<span class=w>   </span>STATUS<span class=w>    </span>RESTARTS<span class=w>   </span>AGE
<a id=__codelineno-50-7 name=__codelineno-50-7 href=#__codelineno-50-7></a>web-0<span class=w>             </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>79s
<a id=__codelineno-50-8 name=__codelineno-50-8 href=#__codelineno-50-8></a>web-1<span class=w>             </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>4m28s
</code></pre></div> <p><strong>（2）级联删除</strong></p> <p>省略--cascade=false参数即为级联删除：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-51-1 name=__codelineno-51-1 href=#__codelineno-51-1></a>$<span class=w> </span>kubectl<span class=w> </span>delete<span class=w> </span>sts<span class=w> </span>web
<a id=__codelineno-51-2 name=__codelineno-51-2 href=#__codelineno-51-2></a>statefulset.apps<span class=w> </span><span class=s2>&quot;web&quot;</span><span class=w> </span>deleted
<a id=__codelineno-51-3 name=__codelineno-51-3 href=#__codelineno-51-3></a>
<a id=__codelineno-51-4 name=__codelineno-51-4 href=#__codelineno-51-4></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>pod
</code></pre></div> <p>也可以使用-f指定创建StatefulSet和Service的YAML文件，直接删除StatefulSet和Service（此文件将StatefulSet和Service写在了一起）：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-52-1 name=__codelineno-52-1 href=#__codelineno-52-1></a>$<span class=w> </span>kubectl<span class=w> </span>delete<span class=w> </span>-f<span class=w> </span>sts-web.yml
<a id=__codelineno-52-2 name=__codelineno-52-2 href=#__codelineno-52-2></a>service<span class=w> </span><span class=s2>&quot;nginx&quot;</span><span class=w> </span>deleted
<a id=__codelineno-52-3 name=__codelineno-52-3 href=#__codelineno-52-3></a>Error<span class=w> </span>from<span class=w> </span>server<span class=w> </span><span class=o>(</span>NotFound<span class=o>)</span>:<span class=w> </span>error<span class=w> </span>when<span class=w> </span>deleting<span class=w> </span><span class=s2>&quot;sts-web.yml&quot;</span>:<span class=w> </span>statefulsets.apps<span class=w> </span><span class=s2>&quot;web&quot;</span><span class=w> </span>not<span class=w> </span>found
</code></pre></div> <div class="admonition example"> <p class=admonition-title>参考文献</p> <blockquote> <p><a href=https://kubernetes.io/zh-cn/docs/tutorials/stateful-application/basic-stateful-set/ >https://kubernetes.io/zh-cn/docs/tutorials/stateful-application/basic-stateful-set/</a></p> </blockquote> </div> <h2 id=4守护进程集daemonset>4.守护进程集DaemonSet<a class=headerlink href=#4守护进程集daemonset title="Permanent link">&para;</a></h2> <p>DaemonSet（守护进程集，缩写为ds）和守护进程类似，它在符合匹配条 件的节点上均部署一个Pod。</p> <h3 id=41-什么是daemonset>4.1 什么是DaemonSet<a class=headerlink href=#41-什么是daemonset title="Permanent link">&para;</a></h3> <p>有时候我们需要在每个Kubernetes节点或符合条件的节点上都部署某个应用，那么就可以使用Kubernetes的DaemonSet调度Pod。 DaemonSet确保全部（或者某些符合条件）节点上运行一个Pod副本。</p> <p>当有新节点加入集群时，也会为它们新增一个Pod，当节点从集群中移除时，这些Pod也会被回收，删除DaemonSet将会删除它创建的所有Pod。</p> <p>使用DaemonSet的一些典型用法：</p> <ul> <li>运行集群存储daemon（守护进程），例如在每个节点上运行Glusterd、Ceph等。</li> <li>在每个节点上运行日志收集daemon，例如Fluentd、Logstash。</li> <li>在每个节点上运行监控daemon，比如Prometheus Node Exporter、Collectd、Datadog代理、New Relic代理或Ganglia gmond。</li> </ul> <h3 id=42-定义一个daemonset>4.2 定义一个DaemonSet<a class=headerlink href=#42-定义一个daemonset title="Permanent link">&para;</a></h3> <p>创建一个DaemonSet和Deployment类似，比如创建一个fluentd的DaemonSet：</p> <p>fluentd-ds.yml</p> <div class=highlight><pre><span></span><code><a id=__codelineno-53-1 name=__codelineno-53-1 href=#__codelineno-53-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<a id=__codelineno-53-2 name=__codelineno-53-2 href=#__codelineno-53-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">DaemonSet</span><span class=w> </span><span class=c1># kind为DaemonSet</span>
<a id=__codelineno-53-3 name=__codelineno-53-3 href=#__codelineno-53-3></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-53-4 name=__codelineno-53-4 href=#__codelineno-53-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">fluentd-es-v2.0.4</span>
<a id=__codelineno-53-5 name=__codelineno-53-5 href=#__codelineno-53-5></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">logging</span>
<a id=__codelineno-53-6 name=__codelineno-53-6 href=#__codelineno-53-6></a><span class=w>  </span><span class=nt>labels</span><span class=p>:</span>
<a id=__codelineno-53-7 name=__codelineno-53-7 href=#__codelineno-53-7></a><span class=w>    </span><span class=nt>k8s-app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">fluentd-es</span>
<a id=__codelineno-53-8 name=__codelineno-53-8 href=#__codelineno-53-8></a><span class=w>    </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v2.0.4</span>
<a id=__codelineno-53-9 name=__codelineno-53-9 href=#__codelineno-53-9></a><span class=w>    </span><span class=nt>kubernetes.io/cluster-service</span><span class=p>:</span><span class=w> </span><span class=s>&quot;true&quot;</span>
<a id=__codelineno-53-10 name=__codelineno-53-10 href=#__codelineno-53-10></a><span class=w>    </span><span class=nt>addonmanager.kubernetes.io/mode</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Reconcile</span>
<a id=__codelineno-53-11 name=__codelineno-53-11 href=#__codelineno-53-11></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-53-12 name=__codelineno-53-12 href=#__codelineno-53-12></a><span class=w>  </span><span class=nt>selector</span><span class=p>:</span>
<a id=__codelineno-53-13 name=__codelineno-53-13 href=#__codelineno-53-13></a><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span>
<a id=__codelineno-53-14 name=__codelineno-53-14 href=#__codelineno-53-14></a><span class=w>      </span><span class=nt>k8s-app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">fluentd-es</span>
<a id=__codelineno-53-15 name=__codelineno-53-15 href=#__codelineno-53-15></a><span class=w>      </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v2.0.4</span>
<a id=__codelineno-53-16 name=__codelineno-53-16 href=#__codelineno-53-16></a><span class=w>  </span><span class=nt>template</span><span class=p>:</span>
<a id=__codelineno-53-17 name=__codelineno-53-17 href=#__codelineno-53-17></a><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-53-18 name=__codelineno-53-18 href=#__codelineno-53-18></a><span class=w>      </span><span class=nt>labels</span><span class=p>:</span>
<a id=__codelineno-53-19 name=__codelineno-53-19 href=#__codelineno-53-19></a><span class=w>        </span><span class=nt>k8s-app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">fluentd-es</span>
<a id=__codelineno-53-20 name=__codelineno-53-20 href=#__codelineno-53-20></a><span class=w>        </span><span class=nt>kubernetes.io/cluster-service</span><span class=p>:</span><span class=w> </span><span class=s>&quot;true&quot;</span>
<a id=__codelineno-53-21 name=__codelineno-53-21 href=#__codelineno-53-21></a><span class=w>        </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v2.0.4</span>
<a id=__codelineno-53-22 name=__codelineno-53-22 href=#__codelineno-53-22></a><span class=w>      </span><span class=c1># This annotation ensures that fluentd does not get evicted if the node</span>
<a id=__codelineno-53-23 name=__codelineno-53-23 href=#__codelineno-53-23></a><span class=w>      </span><span class=c1># supports critical pod annotation based priority scheme.</span>
<a id=__codelineno-53-24 name=__codelineno-53-24 href=#__codelineno-53-24></a><span class=w>      </span><span class=c1># Note that this does not guarantee admission on the nodes (#40573).</span>
<a id=__codelineno-53-25 name=__codelineno-53-25 href=#__codelineno-53-25></a><span class=w>      </span><span class=nt>annotations</span><span class=p>:</span>
<a id=__codelineno-53-26 name=__codelineno-53-26 href=#__codelineno-53-26></a><span class=w>        </span><span class=nt>scheduler.alpha.kubernetes.io/critical-pod</span><span class=p>:</span><span class=w> </span><span class=s>&#39;&#39;</span>
<a id=__codelineno-53-27 name=__codelineno-53-27 href=#__codelineno-53-27></a><span class=w>        </span><span class=nt>seccomp.security.alpha.kubernetes.io/pod</span><span class=p>:</span><span class=w> </span><span class=s>&#39;docker/default&#39;</span>
<a id=__codelineno-53-28 name=__codelineno-53-28 href=#__codelineno-53-28></a><span class=w>    </span><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-53-29 name=__codelineno-53-29 href=#__codelineno-53-29></a><span class=w>      </span><span class=nt>serviceAccountName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">fluentd-es</span>
<a id=__codelineno-53-30 name=__codelineno-53-30 href=#__codelineno-53-30></a><span class=w>      </span><span class=nt>containers</span><span class=p>:</span>
<a id=__codelineno-53-31 name=__codelineno-53-31 href=#__codelineno-53-31></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">fluentd-es</span>
<a id=__codelineno-53-32 name=__codelineno-53-32 href=#__codelineno-53-32></a><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">k8s.gcr.io/fluentd-elasticsearch:v2.0.4</span>
<a id=__codelineno-53-33 name=__codelineno-53-33 href=#__codelineno-53-33></a><span class=w>        </span><span class=nt>env</span><span class=p>:</span>
<a id=__codelineno-53-34 name=__codelineno-53-34 href=#__codelineno-53-34></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">FLUENTD_ARGS</span>
<a id=__codelineno-53-35 name=__codelineno-53-35 href=#__codelineno-53-35></a><span class=w>          </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">--no-supervisor -q</span>
<a id=__codelineno-53-36 name=__codelineno-53-36 href=#__codelineno-53-36></a><span class=w>        </span><span class=nt>resources</span><span class=p>:</span>
<a id=__codelineno-53-37 name=__codelineno-53-37 href=#__codelineno-53-37></a><span class=w>          </span><span class=nt>limits</span><span class=p>:</span>
<a id=__codelineno-53-38 name=__codelineno-53-38 href=#__codelineno-53-38></a><span class=w>            </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">500Mi</span>
<a id=__codelineno-53-39 name=__codelineno-53-39 href=#__codelineno-53-39></a><span class=w>          </span><span class=nt>requests</span><span class=p>:</span>
<a id=__codelineno-53-40 name=__codelineno-53-40 href=#__codelineno-53-40></a><span class=w>            </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">100m</span>
<a id=__codelineno-53-41 name=__codelineno-53-41 href=#__codelineno-53-41></a><span class=w>            </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">200Mi</span>
<a id=__codelineno-53-42 name=__codelineno-53-42 href=#__codelineno-53-42></a><span class=w>        </span><span class=nt>volumeMounts</span><span class=p>:</span>
<a id=__codelineno-53-43 name=__codelineno-53-43 href=#__codelineno-53-43></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">varlog</span>
<a id=__codelineno-53-44 name=__codelineno-53-44 href=#__codelineno-53-44></a><span class=w>          </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/var/log</span>
<a id=__codelineno-53-45 name=__codelineno-53-45 href=#__codelineno-53-45></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">varlibdockercontainers</span>
<a id=__codelineno-53-46 name=__codelineno-53-46 href=#__codelineno-53-46></a><span class=w>          </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/var/lib/docker/containers</span>
<a id=__codelineno-53-47 name=__codelineno-53-47 href=#__codelineno-53-47></a><span class=w>          </span><span class=nt>readOnly</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id=__codelineno-53-48 name=__codelineno-53-48 href=#__codelineno-53-48></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">config-volume</span>
<a id=__codelineno-53-49 name=__codelineno-53-49 href=#__codelineno-53-49></a><span class=w>          </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/etc/fluent/config.d</span>
<a id=__codelineno-53-50 name=__codelineno-53-50 href=#__codelineno-53-50></a><span class=w>      </span><span class=nt>nodeSelector</span><span class=p>:</span>
<a id=__codelineno-53-51 name=__codelineno-53-51 href=#__codelineno-53-51></a><span class=w>        </span><span class=nt>beta.kubernetes.io/fluentd-ds-ready</span><span class=p>:</span><span class=w> </span><span class=s>&quot;true&quot;</span>
<a id=__codelineno-53-52 name=__codelineno-53-52 href=#__codelineno-53-52></a><span class=w>      </span><span class=nt>terminationGracePeriodSeconds</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">30</span>
<a id=__codelineno-53-53 name=__codelineno-53-53 href=#__codelineno-53-53></a><span class=w>      </span><span class=nt>volumes</span><span class=p>:</span>
<a id=__codelineno-53-54 name=__codelineno-53-54 href=#__codelineno-53-54></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">varlog</span>
<a id=__codelineno-53-55 name=__codelineno-53-55 href=#__codelineno-53-55></a><span class=w>        </span><span class=nt>hostPath</span><span class=p>:</span>
<a id=__codelineno-53-56 name=__codelineno-53-56 href=#__codelineno-53-56></a><span class=w>          </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/var/log</span>
<a id=__codelineno-53-57 name=__codelineno-53-57 href=#__codelineno-53-57></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">varlibdockercontainers</span>
<a id=__codelineno-53-58 name=__codelineno-53-58 href=#__codelineno-53-58></a><span class=w>        </span><span class=nt>hostPath</span><span class=p>:</span>
<a id=__codelineno-53-59 name=__codelineno-53-59 href=#__codelineno-53-59></a><span class=w>          </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/var/lib/docker/containers</span>
<a id=__codelineno-53-60 name=__codelineno-53-60 href=#__codelineno-53-60></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">config-volume</span>
<a id=__codelineno-53-61 name=__codelineno-53-61 href=#__codelineno-53-61></a><span class=w>        </span><span class=nt>configMap</span><span class=p>:</span>
<a id=__codelineno-53-62 name=__codelineno-53-62 href=#__codelineno-53-62></a><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">fluentd-es-config-v0.1.4</span>
</code></pre></div> <p><strong>（1）必需字段</strong></p> <p>和其他所有Kubernetes配置一样，DaemonSet需要apiVersion、kind和metadata字段，同时也需要一个.spec配置段。</p> <p><strong>（2）Pod模板</strong></p> <p>.spec唯一需要的字段是.spec.template。.spec.template是一个Pod模板，它与Pod具有相同的配置方式，但它不具有apiVersion和kind字段。除了Pod必需的字段外，在DaemonSet中的Pod模板必须指定合理的标签。</p> <p><strong><mark>在DaemonSet中的Pod模板必须具有一个RestartPolicy，默认为Always。</mark></strong></p> <p><strong>（3）Pod Selector</strong></p> <p>.spec.selector字段表示Pod Selector，它与其他资源的.spec.selector的作用相同。</p> <p>.spec.selector表示一个对象，它由如下两个字段组成：</p> <ul> <li>matchLabels：与ReplicationController的.spec.selector的作用相同，用于匹配符合条件的Pod。</li> <li>matchExpressions：允许构建更加复杂的Selector，可以通过指定key、value列表以及与key和value列表相关的操作符。</li> </ul> <p>如果上述两个字段都指定，结果表示的是AND关系（逻辑与的关系）。</p> <p>.spec.selector必须与.spec.template.metadata.labels相匹配。</p> <p>如果没有指定（APIVersion为apps/v1必须指定该字段），默认是等价的，如果它们的配置不匹配，则会被API拒绝。</p> <p><strong>（4）指定节点部署Pod</strong></p> <p>如果指定了.spec.template.spec.nodeSelector，DaemonSet Controller将在与Node Selector(节点选择器)匹配的节点上创建Pod，比如部署在磁盘类型为ssd的节点上(需要提前给节点定义标签Label)：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-54-1 name=__codelineno-54-1 href=#__codelineno-54-1></a>      nodeSelector:
<a id=__codelineno-54-2 name=__codelineno-54-2 href=#__codelineno-54-2></a>        disktype: ssd
</code></pre></div> <blockquote> <p><strong>提示</strong></p> <p>Node Selector同样适用于其他Controller。</p> </blockquote> <h3 id=43-创建daemonset>4.3 创建DaemonSet<a class=headerlink href=#43-创建daemonset title="Permanent link">&para;</a></h3> <p>在生产环境中，公司业务的应用程序一般无须使用DaemonSet部署，一般情况下只有像Fluentd（日志收集）、Ingress（集群服务入口）、Calico（集群网络组件）、 Node-Exporter（监控数据采集）等才需要使用DaemonSet部署到每个节点，本节只演示DaemonSet的使用。</p> <p>比如创建一个Nginx Ingress（可以在对应的章节找到该文件）</p> <div class=highlight><pre><span></span><code><a id=__codelineno-55-1 name=__codelineno-55-1 href=#__codelineno-55-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id=__codelineno-55-2 name=__codelineno-55-2 href=#__codelineno-55-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Namespace</span>
<a id=__codelineno-55-3 name=__codelineno-55-3 href=#__codelineno-55-3></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-55-4 name=__codelineno-55-4 href=#__codelineno-55-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ingress-nginx</span>
<a id=__codelineno-55-5 name=__codelineno-55-5 href=#__codelineno-55-5></a><span class=w>  </span><span class=nt>labels</span><span class=p>:</span>
<a id=__codelineno-55-6 name=__codelineno-55-6 href=#__codelineno-55-6></a><span class=w>    </span><span class=nt>app.kubernetes.io/name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ingress-nginx</span>
<a id=__codelineno-55-7 name=__codelineno-55-7 href=#__codelineno-55-7></a><span class=w>    </span><span class=nt>app.kubernetes.io/part-of</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ingress-nginx</span>
<a id=__codelineno-55-8 name=__codelineno-55-8 href=#__codelineno-55-8></a>
<a id=__codelineno-55-9 name=__codelineno-55-9 href=#__codelineno-55-9></a><span class=nn>---</span>
<a id=__codelineno-55-10 name=__codelineno-55-10 href=#__codelineno-55-10></a>
<a id=__codelineno-55-11 name=__codelineno-55-11 href=#__codelineno-55-11></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<a id=__codelineno-55-12 name=__codelineno-55-12 href=#__codelineno-55-12></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id=__codelineno-55-13 name=__codelineno-55-13 href=#__codelineno-55-13></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-55-14 name=__codelineno-55-14 href=#__codelineno-55-14></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx-configuration</span>
<a id=__codelineno-55-15 name=__codelineno-55-15 href=#__codelineno-55-15></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ingress-nginx</span>
<a id=__codelineno-55-16 name=__codelineno-55-16 href=#__codelineno-55-16></a><span class=w>  </span><span class=nt>labels</span><span class=p>:</span>
<a id=__codelineno-55-17 name=__codelineno-55-17 href=#__codelineno-55-17></a><span class=w>    </span><span class=nt>app.kubernetes.io/name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ingress-nginx</span>
<a id=__codelineno-55-18 name=__codelineno-55-18 href=#__codelineno-55-18></a><span class=w>    </span><span class=nt>app.kubernetes.io/part-of</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ingress-nginx</span>
<a id=__codelineno-55-19 name=__codelineno-55-19 href=#__codelineno-55-19></a>
<a id=__codelineno-55-20 name=__codelineno-55-20 href=#__codelineno-55-20></a><span class=nn>---</span>
<a id=__codelineno-55-21 name=__codelineno-55-21 href=#__codelineno-55-21></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<a id=__codelineno-55-22 name=__codelineno-55-22 href=#__codelineno-55-22></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id=__codelineno-55-23 name=__codelineno-55-23 href=#__codelineno-55-23></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-55-24 name=__codelineno-55-24 href=#__codelineno-55-24></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">tcp-services</span>
<a id=__codelineno-55-25 name=__codelineno-55-25 href=#__codelineno-55-25></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ingress-nginx</span>
<a id=__codelineno-55-26 name=__codelineno-55-26 href=#__codelineno-55-26></a><span class=w>  </span><span class=nt>labels</span><span class=p>:</span>
<a id=__codelineno-55-27 name=__codelineno-55-27 href=#__codelineno-55-27></a><span class=w>    </span><span class=nt>app.kubernetes.io/name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ingress-nginx</span>
<a id=__codelineno-55-28 name=__codelineno-55-28 href=#__codelineno-55-28></a><span class=w>    </span><span class=nt>app.kubernetes.io/part-of</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ingress-nginx</span>
<a id=__codelineno-55-29 name=__codelineno-55-29 href=#__codelineno-55-29></a>
<a id=__codelineno-55-30 name=__codelineno-55-30 href=#__codelineno-55-30></a><span class=nn>---</span>
<a id=__codelineno-55-31 name=__codelineno-55-31 href=#__codelineno-55-31></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<a id=__codelineno-55-32 name=__codelineno-55-32 href=#__codelineno-55-32></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id=__codelineno-55-33 name=__codelineno-55-33 href=#__codelineno-55-33></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-55-34 name=__codelineno-55-34 href=#__codelineno-55-34></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">udp-services</span>
<a id=__codelineno-55-35 name=__codelineno-55-35 href=#__codelineno-55-35></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ingress-nginx</span>
<a id=__codelineno-55-36 name=__codelineno-55-36 href=#__codelineno-55-36></a><span class=w>  </span><span class=nt>labels</span><span class=p>:</span>
<a id=__codelineno-55-37 name=__codelineno-55-37 href=#__codelineno-55-37></a><span class=w>    </span><span class=nt>app.kubernetes.io/name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ingress-nginx</span>
<a id=__codelineno-55-38 name=__codelineno-55-38 href=#__codelineno-55-38></a><span class=w>    </span><span class=nt>app.kubernetes.io/part-of</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ingress-nginx</span>
<a id=__codelineno-55-39 name=__codelineno-55-39 href=#__codelineno-55-39></a>
<a id=__codelineno-55-40 name=__codelineno-55-40 href=#__codelineno-55-40></a><span class=nn>---</span>
<a id=__codelineno-55-41 name=__codelineno-55-41 href=#__codelineno-55-41></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id=__codelineno-55-42 name=__codelineno-55-42 href=#__codelineno-55-42></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ServiceAccount</span>
<a id=__codelineno-55-43 name=__codelineno-55-43 href=#__codelineno-55-43></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-55-44 name=__codelineno-55-44 href=#__codelineno-55-44></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx-ingress-serviceaccount</span>
<a id=__codelineno-55-45 name=__codelineno-55-45 href=#__codelineno-55-45></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ingress-nginx</span>
<a id=__codelineno-55-46 name=__codelineno-55-46 href=#__codelineno-55-46></a><span class=w>  </span><span class=nt>labels</span><span class=p>:</span>
<a id=__codelineno-55-47 name=__codelineno-55-47 href=#__codelineno-55-47></a><span class=w>    </span><span class=nt>app.kubernetes.io/name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ingress-nginx</span>
<a id=__codelineno-55-48 name=__codelineno-55-48 href=#__codelineno-55-48></a><span class=w>    </span><span class=nt>app.kubernetes.io/part-of</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ingress-nginx</span>
<a id=__codelineno-55-49 name=__codelineno-55-49 href=#__codelineno-55-49></a>
<a id=__codelineno-55-50 name=__codelineno-55-50 href=#__codelineno-55-50></a><span class=nn>---</span>
<a id=__codelineno-55-51 name=__codelineno-55-51 href=#__codelineno-55-51></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1beta1</span>
<a id=__codelineno-55-52 name=__codelineno-55-52 href=#__codelineno-55-52></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ClusterRole</span>
<a id=__codelineno-55-53 name=__codelineno-55-53 href=#__codelineno-55-53></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-55-54 name=__codelineno-55-54 href=#__codelineno-55-54></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx-ingress-clusterrole</span>
<a id=__codelineno-55-55 name=__codelineno-55-55 href=#__codelineno-55-55></a><span class=w>  </span><span class=nt>labels</span><span class=p>:</span>
<a id=__codelineno-55-56 name=__codelineno-55-56 href=#__codelineno-55-56></a><span class=w>    </span><span class=nt>app.kubernetes.io/name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ingress-nginx</span>
<a id=__codelineno-55-57 name=__codelineno-55-57 href=#__codelineno-55-57></a><span class=w>    </span><span class=nt>app.kubernetes.io/part-of</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ingress-nginx</span>
<a id=__codelineno-55-58 name=__codelineno-55-58 href=#__codelineno-55-58></a><span class=nt>rules</span><span class=p>:</span>
<a id=__codelineno-55-59 name=__codelineno-55-59 href=#__codelineno-55-59></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>apiGroups</span><span class=p>:</span>
<a id=__codelineno-55-60 name=__codelineno-55-60 href=#__codelineno-55-60></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;&quot;</span>
<a id=__codelineno-55-61 name=__codelineno-55-61 href=#__codelineno-55-61></a><span class=w>    </span><span class=nt>resources</span><span class=p>:</span>
<a id=__codelineno-55-62 name=__codelineno-55-62 href=#__codelineno-55-62></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">configmaps</span>
<a id=__codelineno-55-63 name=__codelineno-55-63 href=#__codelineno-55-63></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">endpoints</span>
<a id=__codelineno-55-64 name=__codelineno-55-64 href=#__codelineno-55-64></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nodes</span>
<a id=__codelineno-55-65 name=__codelineno-55-65 href=#__codelineno-55-65></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">pods</span>
<a id=__codelineno-55-66 name=__codelineno-55-66 href=#__codelineno-55-66></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">secrets</span>
<a id=__codelineno-55-67 name=__codelineno-55-67 href=#__codelineno-55-67></a><span class=w>    </span><span class=nt>verbs</span><span class=p>:</span>
<a id=__codelineno-55-68 name=__codelineno-55-68 href=#__codelineno-55-68></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">list</span>
<a id=__codelineno-55-69 name=__codelineno-55-69 href=#__codelineno-55-69></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">watch</span>
<a id=__codelineno-55-70 name=__codelineno-55-70 href=#__codelineno-55-70></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>apiGroups</span><span class=p>:</span>
<a id=__codelineno-55-71 name=__codelineno-55-71 href=#__codelineno-55-71></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;&quot;</span>
<a id=__codelineno-55-72 name=__codelineno-55-72 href=#__codelineno-55-72></a><span class=w>    </span><span class=nt>resources</span><span class=p>:</span>
<a id=__codelineno-55-73 name=__codelineno-55-73 href=#__codelineno-55-73></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nodes</span>
<a id=__codelineno-55-74 name=__codelineno-55-74 href=#__codelineno-55-74></a><span class=w>    </span><span class=nt>verbs</span><span class=p>:</span>
<a id=__codelineno-55-75 name=__codelineno-55-75 href=#__codelineno-55-75></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">get</span>
<a id=__codelineno-55-76 name=__codelineno-55-76 href=#__codelineno-55-76></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>apiGroups</span><span class=p>:</span>
<a id=__codelineno-55-77 name=__codelineno-55-77 href=#__codelineno-55-77></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;&quot;</span>
<a id=__codelineno-55-78 name=__codelineno-55-78 href=#__codelineno-55-78></a><span class=w>    </span><span class=nt>resources</span><span class=p>:</span>
<a id=__codelineno-55-79 name=__codelineno-55-79 href=#__codelineno-55-79></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">services</span>
<a id=__codelineno-55-80 name=__codelineno-55-80 href=#__codelineno-55-80></a><span class=w>    </span><span class=nt>verbs</span><span class=p>:</span>
<a id=__codelineno-55-81 name=__codelineno-55-81 href=#__codelineno-55-81></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">get</span>
<a id=__codelineno-55-82 name=__codelineno-55-82 href=#__codelineno-55-82></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">list</span>
<a id=__codelineno-55-83 name=__codelineno-55-83 href=#__codelineno-55-83></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">watch</span>
<a id=__codelineno-55-84 name=__codelineno-55-84 href=#__codelineno-55-84></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>apiGroups</span><span class=p>:</span>
<a id=__codelineno-55-85 name=__codelineno-55-85 href=#__codelineno-55-85></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;extensions&quot;</span>
<a id=__codelineno-55-86 name=__codelineno-55-86 href=#__codelineno-55-86></a><span class=w>    </span><span class=nt>resources</span><span class=p>:</span>
<a id=__codelineno-55-87 name=__codelineno-55-87 href=#__codelineno-55-87></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ingresses</span>
<a id=__codelineno-55-88 name=__codelineno-55-88 href=#__codelineno-55-88></a><span class=w>    </span><span class=nt>verbs</span><span class=p>:</span>
<a id=__codelineno-55-89 name=__codelineno-55-89 href=#__codelineno-55-89></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">get</span>
<a id=__codelineno-55-90 name=__codelineno-55-90 href=#__codelineno-55-90></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">list</span>
<a id=__codelineno-55-91 name=__codelineno-55-91 href=#__codelineno-55-91></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">watch</span>
<a id=__codelineno-55-92 name=__codelineno-55-92 href=#__codelineno-55-92></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>apiGroups</span><span class=p>:</span>
<a id=__codelineno-55-93 name=__codelineno-55-93 href=#__codelineno-55-93></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;&quot;</span>
<a id=__codelineno-55-94 name=__codelineno-55-94 href=#__codelineno-55-94></a><span class=w>    </span><span class=nt>resources</span><span class=p>:</span>
<a id=__codelineno-55-95 name=__codelineno-55-95 href=#__codelineno-55-95></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">events</span>
<a id=__codelineno-55-96 name=__codelineno-55-96 href=#__codelineno-55-96></a><span class=w>    </span><span class=nt>verbs</span><span class=p>:</span>
<a id=__codelineno-55-97 name=__codelineno-55-97 href=#__codelineno-55-97></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">create</span>
<a id=__codelineno-55-98 name=__codelineno-55-98 href=#__codelineno-55-98></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">patch</span>
<a id=__codelineno-55-99 name=__codelineno-55-99 href=#__codelineno-55-99></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>apiGroups</span><span class=p>:</span>
<a id=__codelineno-55-100 name=__codelineno-55-100 href=#__codelineno-55-100></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;extensions&quot;</span>
<a id=__codelineno-55-101 name=__codelineno-55-101 href=#__codelineno-55-101></a><span class=w>    </span><span class=nt>resources</span><span class=p>:</span>
<a id=__codelineno-55-102 name=__codelineno-55-102 href=#__codelineno-55-102></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ingresses/status</span>
<a id=__codelineno-55-103 name=__codelineno-55-103 href=#__codelineno-55-103></a><span class=w>    </span><span class=nt>verbs</span><span class=p>:</span>
<a id=__codelineno-55-104 name=__codelineno-55-104 href=#__codelineno-55-104></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">update</span>
<a id=__codelineno-55-105 name=__codelineno-55-105 href=#__codelineno-55-105></a>
<a id=__codelineno-55-106 name=__codelineno-55-106 href=#__codelineno-55-106></a><span class=nn>---</span>
<a id=__codelineno-55-107 name=__codelineno-55-107 href=#__codelineno-55-107></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1beta1</span>
<a id=__codelineno-55-108 name=__codelineno-55-108 href=#__codelineno-55-108></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Role</span>
<a id=__codelineno-55-109 name=__codelineno-55-109 href=#__codelineno-55-109></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-55-110 name=__codelineno-55-110 href=#__codelineno-55-110></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx-ingress-role</span>
<a id=__codelineno-55-111 name=__codelineno-55-111 href=#__codelineno-55-111></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ingress-nginx</span>
<a id=__codelineno-55-112 name=__codelineno-55-112 href=#__codelineno-55-112></a><span class=w>  </span><span class=nt>labels</span><span class=p>:</span>
<a id=__codelineno-55-113 name=__codelineno-55-113 href=#__codelineno-55-113></a><span class=w>    </span><span class=nt>app.kubernetes.io/name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ingress-nginx</span>
<a id=__codelineno-55-114 name=__codelineno-55-114 href=#__codelineno-55-114></a><span class=w>    </span><span class=nt>app.kubernetes.io/part-of</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ingress-nginx</span>
<a id=__codelineno-55-115 name=__codelineno-55-115 href=#__codelineno-55-115></a><span class=nt>rules</span><span class=p>:</span>
<a id=__codelineno-55-116 name=__codelineno-55-116 href=#__codelineno-55-116></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>apiGroups</span><span class=p>:</span>
<a id=__codelineno-55-117 name=__codelineno-55-117 href=#__codelineno-55-117></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;&quot;</span>
<a id=__codelineno-55-118 name=__codelineno-55-118 href=#__codelineno-55-118></a><span class=w>    </span><span class=nt>resources</span><span class=p>:</span>
<a id=__codelineno-55-119 name=__codelineno-55-119 href=#__codelineno-55-119></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">configmaps</span>
<a id=__codelineno-55-120 name=__codelineno-55-120 href=#__codelineno-55-120></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">pods</span>
<a id=__codelineno-55-121 name=__codelineno-55-121 href=#__codelineno-55-121></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">secrets</span>
<a id=__codelineno-55-122 name=__codelineno-55-122 href=#__codelineno-55-122></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">namespaces</span>
<a id=__codelineno-55-123 name=__codelineno-55-123 href=#__codelineno-55-123></a><span class=w>    </span><span class=nt>verbs</span><span class=p>:</span>
<a id=__codelineno-55-124 name=__codelineno-55-124 href=#__codelineno-55-124></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">get</span>
<a id=__codelineno-55-125 name=__codelineno-55-125 href=#__codelineno-55-125></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>apiGroups</span><span class=p>:</span>
<a id=__codelineno-55-126 name=__codelineno-55-126 href=#__codelineno-55-126></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;&quot;</span>
<a id=__codelineno-55-127 name=__codelineno-55-127 href=#__codelineno-55-127></a><span class=w>    </span><span class=nt>resources</span><span class=p>:</span>
<a id=__codelineno-55-128 name=__codelineno-55-128 href=#__codelineno-55-128></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">configmaps</span>
<a id=__codelineno-55-129 name=__codelineno-55-129 href=#__codelineno-55-129></a><span class=w>    </span><span class=nt>resourceNames</span><span class=p>:</span>
<a id=__codelineno-55-130 name=__codelineno-55-130 href=#__codelineno-55-130></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;ingress-controller-leader-nginx&quot;</span>
<a id=__codelineno-55-131 name=__codelineno-55-131 href=#__codelineno-55-131></a><span class=w>    </span><span class=nt>verbs</span><span class=p>:</span>
<a id=__codelineno-55-132 name=__codelineno-55-132 href=#__codelineno-55-132></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">get</span>
<a id=__codelineno-55-133 name=__codelineno-55-133 href=#__codelineno-55-133></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">update</span>
<a id=__codelineno-55-134 name=__codelineno-55-134 href=#__codelineno-55-134></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>apiGroups</span><span class=p>:</span>
<a id=__codelineno-55-135 name=__codelineno-55-135 href=#__codelineno-55-135></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;&quot;</span>
<a id=__codelineno-55-136 name=__codelineno-55-136 href=#__codelineno-55-136></a><span class=w>    </span><span class=nt>resources</span><span class=p>:</span>
<a id=__codelineno-55-137 name=__codelineno-55-137 href=#__codelineno-55-137></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">configmaps</span>
<a id=__codelineno-55-138 name=__codelineno-55-138 href=#__codelineno-55-138></a><span class=w>    </span><span class=nt>verbs</span><span class=p>:</span>
<a id=__codelineno-55-139 name=__codelineno-55-139 href=#__codelineno-55-139></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">create</span>
<a id=__codelineno-55-140 name=__codelineno-55-140 href=#__codelineno-55-140></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>apiGroups</span><span class=p>:</span>
<a id=__codelineno-55-141 name=__codelineno-55-141 href=#__codelineno-55-141></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;&quot;</span>
<a id=__codelineno-55-142 name=__codelineno-55-142 href=#__codelineno-55-142></a><span class=w>    </span><span class=nt>resources</span><span class=p>:</span>
<a id=__codelineno-55-143 name=__codelineno-55-143 href=#__codelineno-55-143></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">endpoints</span>
<a id=__codelineno-55-144 name=__codelineno-55-144 href=#__codelineno-55-144></a><span class=w>    </span><span class=nt>verbs</span><span class=p>:</span>
<a id=__codelineno-55-145 name=__codelineno-55-145 href=#__codelineno-55-145></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">get</span>
<a id=__codelineno-55-146 name=__codelineno-55-146 href=#__codelineno-55-146></a>
<a id=__codelineno-55-147 name=__codelineno-55-147 href=#__codelineno-55-147></a><span class=nn>---</span>
<a id=__codelineno-55-148 name=__codelineno-55-148 href=#__codelineno-55-148></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1beta1</span>
<a id=__codelineno-55-149 name=__codelineno-55-149 href=#__codelineno-55-149></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">RoleBinding</span>
<a id=__codelineno-55-150 name=__codelineno-55-150 href=#__codelineno-55-150></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-55-151 name=__codelineno-55-151 href=#__codelineno-55-151></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx-ingress-role-nisa-binding</span>
<a id=__codelineno-55-152 name=__codelineno-55-152 href=#__codelineno-55-152></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ingress-nginx</span>
<a id=__codelineno-55-153 name=__codelineno-55-153 href=#__codelineno-55-153></a><span class=w>  </span><span class=nt>labels</span><span class=p>:</span>
<a id=__codelineno-55-154 name=__codelineno-55-154 href=#__codelineno-55-154></a><span class=w>    </span><span class=nt>app.kubernetes.io/name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ingress-nginx</span>
<a id=__codelineno-55-155 name=__codelineno-55-155 href=#__codelineno-55-155></a><span class=w>    </span><span class=nt>app.kubernetes.io/part-of</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ingress-nginx</span>
<a id=__codelineno-55-156 name=__codelineno-55-156 href=#__codelineno-55-156></a><span class=nt>roleRef</span><span class=p>:</span>
<a id=__codelineno-55-157 name=__codelineno-55-157 href=#__codelineno-55-157></a><span class=w>  </span><span class=nt>apiGroup</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io</span>
<a id=__codelineno-55-158 name=__codelineno-55-158 href=#__codelineno-55-158></a><span class=w>  </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Role</span>
<a id=__codelineno-55-159 name=__codelineno-55-159 href=#__codelineno-55-159></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx-ingress-role</span>
<a id=__codelineno-55-160 name=__codelineno-55-160 href=#__codelineno-55-160></a><span class=nt>subjects</span><span class=p>:</span>
<a id=__codelineno-55-161 name=__codelineno-55-161 href=#__codelineno-55-161></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ServiceAccount</span>
<a id=__codelineno-55-162 name=__codelineno-55-162 href=#__codelineno-55-162></a><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx-ingress-serviceaccount</span>
<a id=__codelineno-55-163 name=__codelineno-55-163 href=#__codelineno-55-163></a><span class=w>    </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ingress-nginx</span>
<a id=__codelineno-55-164 name=__codelineno-55-164 href=#__codelineno-55-164></a>
<a id=__codelineno-55-165 name=__codelineno-55-165 href=#__codelineno-55-165></a><span class=nn>---</span>
<a id=__codelineno-55-166 name=__codelineno-55-166 href=#__codelineno-55-166></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1beta1</span>
<a id=__codelineno-55-167 name=__codelineno-55-167 href=#__codelineno-55-167></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ClusterRoleBinding</span>
<a id=__codelineno-55-168 name=__codelineno-55-168 href=#__codelineno-55-168></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-55-169 name=__codelineno-55-169 href=#__codelineno-55-169></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx-ingress-clusterrole-nisa-binding</span>
<a id=__codelineno-55-170 name=__codelineno-55-170 href=#__codelineno-55-170></a><span class=w>  </span><span class=nt>labels</span><span class=p>:</span>
<a id=__codelineno-55-171 name=__codelineno-55-171 href=#__codelineno-55-171></a><span class=w>    </span><span class=nt>app.kubernetes.io/name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ingress-nginx</span>
<a id=__codelineno-55-172 name=__codelineno-55-172 href=#__codelineno-55-172></a><span class=w>    </span><span class=nt>app.kubernetes.io/part-of</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ingress-nginx</span>
<a id=__codelineno-55-173 name=__codelineno-55-173 href=#__codelineno-55-173></a><span class=nt>roleRef</span><span class=p>:</span>
<a id=__codelineno-55-174 name=__codelineno-55-174 href=#__codelineno-55-174></a><span class=w>  </span><span class=nt>apiGroup</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io</span>
<a id=__codelineno-55-175 name=__codelineno-55-175 href=#__codelineno-55-175></a><span class=w>  </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ClusterRole</span>
<a id=__codelineno-55-176 name=__codelineno-55-176 href=#__codelineno-55-176></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx-ingress-clusterrole</span>
<a id=__codelineno-55-177 name=__codelineno-55-177 href=#__codelineno-55-177></a><span class=nt>subjects</span><span class=p>:</span>
<a id=__codelineno-55-178 name=__codelineno-55-178 href=#__codelineno-55-178></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ServiceAccount</span>
<a id=__codelineno-55-179 name=__codelineno-55-179 href=#__codelineno-55-179></a><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx-ingress-serviceaccount</span>
<a id=__codelineno-55-180 name=__codelineno-55-180 href=#__codelineno-55-180></a><span class=w>    </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ingress-nginx</span>
<a id=__codelineno-55-181 name=__codelineno-55-181 href=#__codelineno-55-181></a>
<a id=__codelineno-55-182 name=__codelineno-55-182 href=#__codelineno-55-182></a><span class=nn>---</span>
<a id=__codelineno-55-183 name=__codelineno-55-183 href=#__codelineno-55-183></a>
<a id=__codelineno-55-184 name=__codelineno-55-184 href=#__codelineno-55-184></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<a id=__codelineno-55-185 name=__codelineno-55-185 href=#__codelineno-55-185></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">DaemonSet</span>
<a id=__codelineno-55-186 name=__codelineno-55-186 href=#__codelineno-55-186></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-55-187 name=__codelineno-55-187 href=#__codelineno-55-187></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx-ingress-controller</span>
<a id=__codelineno-55-188 name=__codelineno-55-188 href=#__codelineno-55-188></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ingress-nginx</span>
<a id=__codelineno-55-189 name=__codelineno-55-189 href=#__codelineno-55-189></a><span class=w>  </span><span class=nt>labels</span><span class=p>:</span>
<a id=__codelineno-55-190 name=__codelineno-55-190 href=#__codelineno-55-190></a><span class=w>    </span><span class=nt>app.kubernetes.io/name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ingress-nginx</span>
<a id=__codelineno-55-191 name=__codelineno-55-191 href=#__codelineno-55-191></a><span class=w>    </span><span class=nt>app.kubernetes.io/part-of</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ingress-nginx</span>
<a id=__codelineno-55-192 name=__codelineno-55-192 href=#__codelineno-55-192></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-55-193 name=__codelineno-55-193 href=#__codelineno-55-193></a><span class=w>  </span><span class=nt>selector</span><span class=p>:</span>
<a id=__codelineno-55-194 name=__codelineno-55-194 href=#__codelineno-55-194></a><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span>
<a id=__codelineno-55-195 name=__codelineno-55-195 href=#__codelineno-55-195></a><span class=w>      </span><span class=nt>app.kubernetes.io/name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ingress-nginx</span>
<a id=__codelineno-55-196 name=__codelineno-55-196 href=#__codelineno-55-196></a><span class=w>      </span><span class=nt>app.kubernetes.io/part-of</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ingress-nginx</span>
<a id=__codelineno-55-197 name=__codelineno-55-197 href=#__codelineno-55-197></a><span class=w>  </span><span class=nt>updateStrategy</span><span class=p>:</span>
<a id=__codelineno-55-198 name=__codelineno-55-198 href=#__codelineno-55-198></a><span class=w>    </span><span class=nt>rollingUpdate</span><span class=p>:</span>
<a id=__codelineno-55-199 name=__codelineno-55-199 href=#__codelineno-55-199></a><span class=w>      </span><span class=nt>maxUnavailable</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<a id=__codelineno-55-200 name=__codelineno-55-200 href=#__codelineno-55-200></a><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">RollingUpdate</span>
<a id=__codelineno-55-201 name=__codelineno-55-201 href=#__codelineno-55-201></a><span class=w>  </span><span class=nt>template</span><span class=p>:</span>
<a id=__codelineno-55-202 name=__codelineno-55-202 href=#__codelineno-55-202></a><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-55-203 name=__codelineno-55-203 href=#__codelineno-55-203></a><span class=w>      </span><span class=nt>labels</span><span class=p>:</span>
<a id=__codelineno-55-204 name=__codelineno-55-204 href=#__codelineno-55-204></a><span class=w>        </span><span class=nt>app.kubernetes.io/name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ingress-nginx</span>
<a id=__codelineno-55-205 name=__codelineno-55-205 href=#__codelineno-55-205></a><span class=w>        </span><span class=nt>app.kubernetes.io/part-of</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ingress-nginx</span>
<a id=__codelineno-55-206 name=__codelineno-55-206 href=#__codelineno-55-206></a><span class=w>      </span><span class=nt>annotations</span><span class=p>:</span>
<a id=__codelineno-55-207 name=__codelineno-55-207 href=#__codelineno-55-207></a><span class=w>        </span><span class=nt>prometheus.io/port</span><span class=p>:</span><span class=w> </span><span class=s>&quot;10254&quot;</span>
<a id=__codelineno-55-208 name=__codelineno-55-208 href=#__codelineno-55-208></a><span class=w>        </span><span class=nt>prometheus.io/scrape</span><span class=p>:</span><span class=w> </span><span class=s>&quot;true&quot;</span>
<a id=__codelineno-55-209 name=__codelineno-55-209 href=#__codelineno-55-209></a><span class=w>    </span><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-55-210 name=__codelineno-55-210 href=#__codelineno-55-210></a><span class=w>      </span><span class=nt>serviceAccountName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx-ingress-serviceaccount</span>
<a id=__codelineno-55-211 name=__codelineno-55-211 href=#__codelineno-55-211></a><span class=w>      </span><span class=nt>hostNetwork</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id=__codelineno-55-212 name=__codelineno-55-212 href=#__codelineno-55-212></a><span class=w>      </span><span class=nt>containers</span><span class=p>:</span>
<a id=__codelineno-55-213 name=__codelineno-55-213 href=#__codelineno-55-213></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx-ingress-controller</span>
<a id=__codelineno-55-214 name=__codelineno-55-214 href=#__codelineno-55-214></a><span class=w>          </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">quay.io/kubernetes-ingress-controller/nginx-ingress-controller:0.22.0</span>
<a id=__codelineno-55-215 name=__codelineno-55-215 href=#__codelineno-55-215></a><span class=w>          </span><span class=nt>args</span><span class=p>:</span>
<a id=__codelineno-55-216 name=__codelineno-55-216 href=#__codelineno-55-216></a><span class=w>            </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/nginx-ingress-controller</span>
<a id=__codelineno-55-217 name=__codelineno-55-217 href=#__codelineno-55-217></a><span class=w>            </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">--configmap=$(POD_NAMESPACE)/nginx-configuration</span>
<a id=__codelineno-55-218 name=__codelineno-55-218 href=#__codelineno-55-218></a><span class=w>            </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">--tcp-services-configmap=$(POD_NAMESPACE)/tcp-services</span>
<a id=__codelineno-55-219 name=__codelineno-55-219 href=#__codelineno-55-219></a><span class=w>            </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">--udp-services-configmap=$(POD_NAMESPACE)/udp-services</span>
<a id=__codelineno-55-220 name=__codelineno-55-220 href=#__codelineno-55-220></a><span class=w>            </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">--publish-service=$(POD_NAMESPACE)/ingress-nginx</span>
<a id=__codelineno-55-221 name=__codelineno-55-221 href=#__codelineno-55-221></a><span class=w>            </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">--annotations-prefix=nginx.ingress.kubernetes.io</span>
<a id=__codelineno-55-222 name=__codelineno-55-222 href=#__codelineno-55-222></a><span class=w>          </span><span class=nt>securityContext</span><span class=p>:</span>
<a id=__codelineno-55-223 name=__codelineno-55-223 href=#__codelineno-55-223></a><span class=w>            </span><span class=nt>allowPrivilegeEscalation</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id=__codelineno-55-224 name=__codelineno-55-224 href=#__codelineno-55-224></a><span class=w>            </span><span class=nt>capabilities</span><span class=p>:</span>
<a id=__codelineno-55-225 name=__codelineno-55-225 href=#__codelineno-55-225></a><span class=w>              </span><span class=nt>drop</span><span class=p>:</span>
<a id=__codelineno-55-226 name=__codelineno-55-226 href=#__codelineno-55-226></a><span class=w>                </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ALL</span>
<a id=__codelineno-55-227 name=__codelineno-55-227 href=#__codelineno-55-227></a><span class=w>              </span><span class=nt>add</span><span class=p>:</span>
<a id=__codelineno-55-228 name=__codelineno-55-228 href=#__codelineno-55-228></a><span class=w>                </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">NET_BIND_SERVICE</span>
<a id=__codelineno-55-229 name=__codelineno-55-229 href=#__codelineno-55-229></a><span class=w>            </span><span class=nt>runAsUser</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">33</span>
<a id=__codelineno-55-230 name=__codelineno-55-230 href=#__codelineno-55-230></a><span class=w>          </span><span class=nt>env</span><span class=p>:</span>
<a id=__codelineno-55-231 name=__codelineno-55-231 href=#__codelineno-55-231></a><span class=w>            </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">POD_NAME</span>
<a id=__codelineno-55-232 name=__codelineno-55-232 href=#__codelineno-55-232></a><span class=w>              </span><span class=nt>valueFrom</span><span class=p>:</span>
<a id=__codelineno-55-233 name=__codelineno-55-233 href=#__codelineno-55-233></a><span class=w>                </span><span class=nt>fieldRef</span><span class=p>:</span>
<a id=__codelineno-55-234 name=__codelineno-55-234 href=#__codelineno-55-234></a><span class=w>                  </span><span class=nt>fieldPath</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">metadata.name</span>
<a id=__codelineno-55-235 name=__codelineno-55-235 href=#__codelineno-55-235></a><span class=w>            </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">POD_NAMESPACE</span>
<a id=__codelineno-55-236 name=__codelineno-55-236 href=#__codelineno-55-236></a><span class=w>              </span><span class=nt>valueFrom</span><span class=p>:</span>
<a id=__codelineno-55-237 name=__codelineno-55-237 href=#__codelineno-55-237></a><span class=w>                </span><span class=nt>fieldRef</span><span class=p>:</span>
<a id=__codelineno-55-238 name=__codelineno-55-238 href=#__codelineno-55-238></a><span class=w>                  </span><span class=nt>fieldPath</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">metadata.namespace</span>
<a id=__codelineno-55-239 name=__codelineno-55-239 href=#__codelineno-55-239></a><span class=w>          </span><span class=nt>ports</span><span class=p>:</span>
<a id=__codelineno-55-240 name=__codelineno-55-240 href=#__codelineno-55-240></a><span class=w>            </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">http</span>
<a id=__codelineno-55-241 name=__codelineno-55-241 href=#__codelineno-55-241></a><span class=w>              </span><span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<a id=__codelineno-55-242 name=__codelineno-55-242 href=#__codelineno-55-242></a><span class=w>            </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">https</span>
<a id=__codelineno-55-243 name=__codelineno-55-243 href=#__codelineno-55-243></a><span class=w>              </span><span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">443</span>
<a id=__codelineno-55-244 name=__codelineno-55-244 href=#__codelineno-55-244></a><span class=w>          </span><span class=nt>livenessProbe</span><span class=p>:</span>
<a id=__codelineno-55-245 name=__codelineno-55-245 href=#__codelineno-55-245></a><span class=w>            </span><span class=nt>failureThreshold</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<a id=__codelineno-55-246 name=__codelineno-55-246 href=#__codelineno-55-246></a><span class=w>            </span><span class=nt>httpGet</span><span class=p>:</span>
<a id=__codelineno-55-247 name=__codelineno-55-247 href=#__codelineno-55-247></a><span class=w>              </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/healthz</span>
<a id=__codelineno-55-248 name=__codelineno-55-248 href=#__codelineno-55-248></a><span class=w>              </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10254</span>
<a id=__codelineno-55-249 name=__codelineno-55-249 href=#__codelineno-55-249></a><span class=w>              </span><span class=nt>scheme</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">HTTP</span>
<a id=__codelineno-55-250 name=__codelineno-55-250 href=#__codelineno-55-250></a><span class=w>            </span><span class=nt>initialDelaySeconds</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<a id=__codelineno-55-251 name=__codelineno-55-251 href=#__codelineno-55-251></a><span class=w>            </span><span class=nt>periodSeconds</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<a id=__codelineno-55-252 name=__codelineno-55-252 href=#__codelineno-55-252></a><span class=w>            </span><span class=nt>successThreshold</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<a id=__codelineno-55-253 name=__codelineno-55-253 href=#__codelineno-55-253></a><span class=w>            </span><span class=nt>timeoutSeconds</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<a id=__codelineno-55-254 name=__codelineno-55-254 href=#__codelineno-55-254></a><span class=w>          </span><span class=nt>readinessProbe</span><span class=p>:</span>
<a id=__codelineno-55-255 name=__codelineno-55-255 href=#__codelineno-55-255></a><span class=w>            </span><span class=nt>failureThreshold</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<a id=__codelineno-55-256 name=__codelineno-55-256 href=#__codelineno-55-256></a><span class=w>            </span><span class=nt>httpGet</span><span class=p>:</span>
<a id=__codelineno-55-257 name=__codelineno-55-257 href=#__codelineno-55-257></a><span class=w>              </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/healthz</span>
<a id=__codelineno-55-258 name=__codelineno-55-258 href=#__codelineno-55-258></a><span class=w>              </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10254</span>
<a id=__codelineno-55-259 name=__codelineno-55-259 href=#__codelineno-55-259></a><span class=w>              </span><span class=nt>scheme</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">HTTP</span>
<a id=__codelineno-55-260 name=__codelineno-55-260 href=#__codelineno-55-260></a><span class=w>            </span><span class=nt>periodSeconds</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<a id=__codelineno-55-261 name=__codelineno-55-261 href=#__codelineno-55-261></a><span class=w>            </span><span class=nt>successThreshold</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<a id=__codelineno-55-262 name=__codelineno-55-262 href=#__codelineno-55-262></a><span class=w>            </span><span class=nt>timeoutSeconds</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<a id=__codelineno-55-263 name=__codelineno-55-263 href=#__codelineno-55-263></a>
<a id=__codelineno-55-264 name=__codelineno-55-264 href=#__codelineno-55-264></a><span class=nn>---</span>
</code></pre></div> <p><div class=highlight><pre><span></span><code><a id=__codelineno-56-1 name=__codelineno-56-1 href=#__codelineno-56-1></a>$<span class=w> </span><span class=nb>pwd</span>
<a id=__codelineno-56-2 name=__codelineno-56-2 href=#__codelineno-56-2></a>$<span class=w> </span>kubectl<span class=w> </span>create<span class=w> </span>-f<span class=w> </span>nginx-ds.yaml
<a id=__codelineno-56-3 name=__codelineno-56-3 href=#__codelineno-56-3></a>namespace/ingress-nginx<span class=w> </span>created
<a id=__codelineno-56-4 name=__codelineno-56-4 href=#__codelineno-56-4></a>configmap/nginx-configuration<span class=w> </span>created
<a id=__codelineno-56-5 name=__codelineno-56-5 href=#__codelineno-56-5></a>configmap/tcp-services<span class=w> </span>created
<a id=__codelineno-56-6 name=__codelineno-56-6 href=#__codelineno-56-6></a>configmap/udp-services<span class=w> </span>created
<a id=__codelineno-56-7 name=__codelineno-56-7 href=#__codelineno-56-7></a>serviceaccount/nginx-ingress-serviceaccount<span class=w> </span>created
<a id=__codelineno-56-8 name=__codelineno-56-8 href=#__codelineno-56-8></a>clusterrole.rbac.authorization.k8s.io/nginx-ingress-clusterrole
<a id=__codelineno-56-9 name=__codelineno-56-9 href=#__codelineno-56-9></a>created
<a id=__codelineno-56-10 name=__codelineno-56-10 href=#__codelineno-56-10></a>role.rbac.authorization.k8s.io/nginx-ingress-role<span class=w> </span>created
<a id=__codelineno-56-11 name=__codelineno-56-11 href=#__codelineno-56-11></a>rolebinding.rbac.authorization.k8s.io/nginx-ingress-role-nisa-
<a id=__codelineno-56-12 name=__codelineno-56-12 href=#__codelineno-56-12></a>binding<span class=w> </span>created
<a id=__codelineno-56-13 name=__codelineno-56-13 href=#__codelineno-56-13></a>clusterrolebinding.rbac.authorization.k8s.io/nginx-ingress-
<a id=__codelineno-56-14 name=__codelineno-56-14 href=#__codelineno-56-14></a>clusterrole-nisa-bindi
<a id=__codelineno-56-15 name=__codelineno-56-15 href=#__codelineno-56-15></a>ng<span class=w> </span>created
<a id=__codelineno-56-16 name=__codelineno-56-16 href=#__codelineno-56-16></a>daemonset.extensions/nginx-ingress-controller<span class=w> </span>created
</code></pre></div> 此时会在每个节点上创建一个Pod： <div class=highlight><pre><span></span><code><a id=__codelineno-57-1 name=__codelineno-57-1 href=#__codelineno-57-1></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>pod<span class=w> </span>-n<span class=w> </span>ingress-nginx
<a id=__codelineno-57-2 name=__codelineno-57-2 href=#__codelineno-57-2></a>NAME<span class=w>                                           </span>READY<span class=w>   </span>STATUS<span class=w>    </span>RESTARTS<span class=w>   </span>AGE
<a id=__codelineno-57-3 name=__codelineno-57-3 href=#__codelineno-57-3></a>ingress-nginx-controller-267hs<span class=w>                 </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>3</span><span class=w>          </span>60d
<a id=__codelineno-57-4 name=__codelineno-57-4 href=#__codelineno-57-4></a>ingress-nginx-controller-zlwmm<span class=w>                 </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>2</span><span class=w>          </span>60d
<a id=__codelineno-57-5 name=__codelineno-57-5 href=#__codelineno-57-5></a>.......
<a id=__codelineno-57-6 name=__codelineno-57-6 href=#__codelineno-57-6></a>ingress-nginx-defaultbackend-b578d6c5b-svwsw<span class=w>   </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>19</span><span class=w>         </span>177d
<a id=__codelineno-57-7 name=__codelineno-57-7 href=#__codelineno-57-7></a>
<a id=__codelineno-57-8 name=__codelineno-57-8 href=#__codelineno-57-8></a>
<a id=__codelineno-57-9 name=__codelineno-57-9 href=#__codelineno-57-9></a><span class=c1># 使用-o wide查看pod所在节点</span>
<a id=__codelineno-57-10 name=__codelineno-57-10 href=#__codelineno-57-10></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>pod<span class=w> </span>-n<span class=w> </span>ingress-nginx<span class=w> </span>-o<span class=w> </span>wide
<a id=__codelineno-57-11 name=__codelineno-57-11 href=#__codelineno-57-11></a>NAME<span class=w>                                           </span>READY<span class=w>   </span>STATUS<span class=w>    </span>RESTARTS<span class=w>   </span>AGE<span class=w>    </span>IP<span class=w>             </span>NODE<span class=w>           </span>NOMINATED<span class=w> </span>NODE<span class=w>   </span>READINESS<span class=w> </span>GATES
<a id=__codelineno-57-12 name=__codelineno-57-12 href=#__codelineno-57-12></a>ingress-nginx-controller-267hs<span class=w>                 </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>3</span><span class=w>          </span>60d<span class=w>    </span><span class=m>192</span>.168.1.79<span class=w>   </span>gitee-k8s-n2<span class=w>   </span>&lt;none&gt;<span class=w>           </span>&lt;none&gt;
<a id=__codelineno-57-13 name=__codelineno-57-13 href=#__codelineno-57-13></a>ingress-nginx-controller-zlwmm<span class=w>                 </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>2</span><span class=w>          </span>60d<span class=w>    </span><span class=m>192</span>.168.1.32<span class=w>   </span>gitee-k8s-n1<span class=w>   </span>&lt;none&gt;<span class=w>           </span>&lt;none&gt;
<a id=__codelineno-57-14 name=__codelineno-57-14 href=#__codelineno-57-14></a>.......
<a id=__codelineno-57-15 name=__codelineno-57-15 href=#__codelineno-57-15></a>ingress-nginx-defaultbackend-b578d6c5b-svwsw<span class=w>   </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>19</span><span class=w>         </span>177d<span class=w>   </span><span class=m>10</span>.0.35.131<span class=w>    </span>gitee-k8s-n2<span class=w>   </span>&lt;none&gt;<span class=w>           </span>&lt;none&gt;
</code></pre></div></p> <div class="admonition warning"> <p class=admonition-title>注意</p> <p>注意 因为笔者的Master节点删除了Taint（Taint和Toleration内容见本书9.4 节），所以也能部署Ingress或者其他Pod，在生产环境中，在Master节点除了系统组件外最好不要部署其他Pod。</p> </div> <h3 id=44-更新和回滚daemonset>4.4 更新和回滚DaemonSet<a class=headerlink href=#44-更新和回滚daemonset title="Permanent link">&para;</a></h3> <p>如果添加了新节点或修改了节点标签（Label），DaemonSet将立刻向新匹配上的节点添加Pod，同时删除不能匹配的节点上的Pod。</p> <p>在Kubernetes 1.6以后的版本中，可以在DaemonSet上执行滚动更新，未来的Kubernetes版本将支持节点的可控更新。</p> <p>DaemonSet滚动更新可参考：<a href=https://kubernetes.io/docs/tasks/manage-daemon/update-daemon-set/ >https://kubernetes.io/docs/tasks/manage-daemon/update-daemon-set/</a>。</p> <p>DaemonSet更新策略和StatefulSet类似，也有OnDelete和RollingUpdate两种方式。</p> <p>查看上一节创建的DaemonSet更新方式： <div class=highlight><pre><span></span><code><a id=__codelineno-58-1 name=__codelineno-58-1 href=#__codelineno-58-1></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>ds<span class=w> </span>nginx-ds<span class=w> </span>-o<span class=w> </span>go-template<span class=o>=</span><span class=s1>&#39;{{.spec.updateStrategy.type}}{{&quot;\n&quot;}}&#39;</span>
<a id=__codelineno-58-2 name=__codelineno-58-2 href=#__codelineno-58-2></a>RollingUpdate
</code></pre></div></p> <p>命令式更新，和之前的Deployment、StatefulSet方式一致： <div class=highlight><pre><span></span><code><a id=__codelineno-59-1 name=__codelineno-59-1 href=#__codelineno-59-1></a>$<span class=w> </span>kubectl<span class=w> </span>edit<span class=w> </span>ds/&lt;daemonset-name&gt;
<a id=__codelineno-59-2 name=__codelineno-59-2 href=#__codelineno-59-2></a>$<span class=w> </span>kubectl<span class=w> </span>patch<span class=w> </span>ds/&lt;daemonset-name&gt;<span class=w> </span>-p<span class=o>=</span>&lt;strategic-merge-patch&gt;
</code></pre></div></p> <p>更新镜像： <div class=highlight><pre><span></span><code><a id=__codelineno-60-1 name=__codelineno-60-1 href=#__codelineno-60-1></a>$<span class=w> </span>kubectl<span class=w> </span><span class=nb>set</span><span class=w> </span>image<span class=w> </span>ds/&lt;daemonset-name&gt;&lt;container-name&gt;<span class=o>=</span>&lt;container-new-image&gt;<span class=w> </span>--record<span class=o>=</span><span class=nb>true</span>
</code></pre></div></p> <p>查看更新状态 <div class=highlight><pre><span></span><code><a id=__codelineno-61-1 name=__codelineno-61-1 href=#__codelineno-61-1></a>$<span class=w> </span>kubectl<span class=w> </span>rollout<span class=w> </span>status<span class=w> </span>ds/&lt;daemonset-name&gt;
</code></pre></div></p> <p>列出所有修订版本： <div class=highlight><pre><span></span><code><a id=__codelineno-62-1 name=__codelineno-62-1 href=#__codelineno-62-1></a>$<span class=w> </span>kubectl<span class=w> </span>rollout<span class=w> </span><span class=nb>history</span><span class=w> </span>daemonset<span class=w> </span>&lt;daemonset-name&gt;
</code></pre></div></p> <p>回滚到指定revision： <div class=highlight><pre><span></span><code><a id=__codelineno-63-1 name=__codelineno-63-1 href=#__codelineno-63-1></a>$<span class=w> </span>kubectl<span class=w> </span>rollout<span class=w> </span>undo<span class=w> </span>daemonset<span class=w> </span>&lt;daemonset-name&gt;<span class=w> </span>--to-revision<span class=o>=</span>&lt;revision&gt;
</code></pre></div></p> <p>DaemonSet的更新和回滚与Deployment类似，此处不再演示。</p> <details class=example> <summary>参考文献</summary> <p><a href=https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/daemonset/ >https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/daemonset/</a></p> <p><a href=https://kubernetes.io/docs/tasks/manage-daemon/update-daemon-set/ >https://kubernetes.io/docs/tasks/manage-daemon/update-daemon-set/</a></p> </details> <h2 id=5cronjob>5.CronJob<a class=headerlink href=#5cronjob title="Permanent link">&para;</a></h2> <p>CronJob（计划任务，缩写为cj）用于以时间为基准周期性地执行任务，这些自动化任务和运行在Linux或UNIX系统上的CronJob一样。</p> <p>CronJob对于创建定期和重复任务非常有用，例如执行备份任务、周期性调度程序接口、发送电子邮件等。</p> <p>对于Kubernetes 1.8以前的版本，需要添加--runtime-config=batch/v2alpha1=true参数至APIServer中，然后重启APIServer和Controller Manager才可启用CronJob功能，</p> <p>对于1.8以后的版本，无须修改任何参数，可以直接使用，本节的示例基于Kubernetes 1.8以上的版本。</p> <h3 id=51-创建cronjob>5.1 创建CronJob<a class=headerlink href=#51-创建cronjob title="Permanent link">&para;</a></h3> <p>创建CronJob有两种方式，一种是直接使用kubectl创建，另一种是使用YAML文件创建。</p> <p>使用kubectl创建CronJob的命令如下(新版本的run命令无法创建CronJob，需要直接使用YAML文件创建)：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-64-1 name=__codelineno-64-1 href=#__codelineno-64-1></a>$<span class=w> </span>kubectl<span class=w> </span>create<span class=w> </span>cronjob<span class=w> </span>hello<span class=w> </span>--image<span class=o>=</span>busybox<span class=w>   </span>--schedule<span class=o>=</span><span class=s2>&quot;*/1 * * * *&quot;</span><span class=w> </span>--restart<span class=o>=</span>OnFailure<span class=w> </span>--<span class=w> </span>/bin/sh<span class=w> </span>-c<span class=w> </span><span class=s2>&quot;date; echo Hello from the Kubernetes cluster&quot;</span>
<a id=__codelineno-64-2 name=__codelineno-64-2 href=#__codelineno-64-2></a>cronjob.batch/hello<span class=w> </span>created
</code></pre></div> <ul> <li>hello：计划任务的名称。</li> <li>schedule：调度周期，分别为分、时、日、月、周，和Linux配置方式一致。</li> <li>restart：重启策略。·　image：执行计划任务的镜像，一般是包含依赖工具的镜像，比如curl、Xtrabackup。</li> <li>/bin/sh：计划任务的操作。</li> </ul> <p>创建完成之后，可以使用kubectl get cj hello -o yaml查看创建的CronJob的详细信息，对应的YAML文件如下：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-65-1 name=__codelineno-65-1 href=#__codelineno-65-1></a><span class="l l-Scalar l-Scalar-Plain">$ kubectl get cj hello -o yaml</span>
<a id=__codelineno-65-2 name=__codelineno-65-2 href=#__codelineno-65-2></a><span class="l l-Scalar l-Scalar-Plain">apiVersion</span><span class="p p-Indicator">:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">batch/v1</span>
<a id=__codelineno-65-3 name=__codelineno-65-3 href=#__codelineno-65-3></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">CronJob</span>
<a id=__codelineno-65-4 name=__codelineno-65-4 href=#__codelineno-65-4></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-65-5 name=__codelineno-65-5 href=#__codelineno-65-5></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">hello</span>
<a id=__codelineno-65-6 name=__codelineno-65-6 href=#__codelineno-65-6></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<a id=__codelineno-65-7 name=__codelineno-65-7 href=#__codelineno-65-7></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-65-8 name=__codelineno-65-8 href=#__codelineno-65-8></a><span class=w>  </span><span class=nt>concurrencyPolicy</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Allow</span>
<a id=__codelineno-65-9 name=__codelineno-65-9 href=#__codelineno-65-9></a><span class=w>  </span><span class=nt>failedJobsHistoryLimit</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<a id=__codelineno-65-10 name=__codelineno-65-10 href=#__codelineno-65-10></a><span class=w>  </span><span class=nt>jobTemplate</span><span class=p>:</span>
<a id=__codelineno-65-11 name=__codelineno-65-11 href=#__codelineno-65-11></a><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-65-12 name=__codelineno-65-12 href=#__codelineno-65-12></a><span class=w>      </span><span class=nt>creationTimestamp</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
<a id=__codelineno-65-13 name=__codelineno-65-13 href=#__codelineno-65-13></a><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">hello</span>
<a id=__codelineno-65-14 name=__codelineno-65-14 href=#__codelineno-65-14></a><span class=w>    </span><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-65-15 name=__codelineno-65-15 href=#__codelineno-65-15></a><span class=w>      </span><span class=nt>template</span><span class=p>:</span>
<a id=__codelineno-65-16 name=__codelineno-65-16 href=#__codelineno-65-16></a><span class=w>        </span><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-65-17 name=__codelineno-65-17 href=#__codelineno-65-17></a><span class=w>          </span><span class=nt>creationTimestamp</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
<a id=__codelineno-65-18 name=__codelineno-65-18 href=#__codelineno-65-18></a><span class=w>        </span><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-65-19 name=__codelineno-65-19 href=#__codelineno-65-19></a><span class=w>          </span><span class=nt>containers</span><span class=p>:</span>
<a id=__codelineno-65-20 name=__codelineno-65-20 href=#__codelineno-65-20></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>command</span><span class=p>:</span>
<a id=__codelineno-65-21 name=__codelineno-65-21 href=#__codelineno-65-21></a><span class=w>            </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/bin/sh</span>
<a id=__codelineno-65-22 name=__codelineno-65-22 href=#__codelineno-65-22></a><span class=w>            </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">-c</span>
<a id=__codelineno-65-23 name=__codelineno-65-23 href=#__codelineno-65-23></a><span class=w>            </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">date; echo Hello from the Kubernetes cluster</span>
<a id=__codelineno-65-24 name=__codelineno-65-24 href=#__codelineno-65-24></a><span class=w>            </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">busybox</span>
<a id=__codelineno-65-25 name=__codelineno-65-25 href=#__codelineno-65-25></a><span class=w>            </span><span class=nt>imagePullPolicy</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Always</span>
<a id=__codelineno-65-26 name=__codelineno-65-26 href=#__codelineno-65-26></a><span class=w>            </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">hello</span>
<a id=__codelineno-65-27 name=__codelineno-65-27 href=#__codelineno-65-27></a><span class=w>            </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">{}</span>
<a id=__codelineno-65-28 name=__codelineno-65-28 href=#__codelineno-65-28></a><span class=w>            </span><span class=nt>terminationMessagePath</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/dev/termination-log</span>
<a id=__codelineno-65-29 name=__codelineno-65-29 href=#__codelineno-65-29></a><span class=w>            </span><span class=nt>terminationMessagePolicy</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">File</span>
<a id=__codelineno-65-30 name=__codelineno-65-30 href=#__codelineno-65-30></a><span class=w>          </span><span class=nt>dnsPolicy</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ClusterFirst</span>
<a id=__codelineno-65-31 name=__codelineno-65-31 href=#__codelineno-65-31></a><span class=w>          </span><span class=nt>restartPolicy</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">OnFailure</span>
<a id=__codelineno-65-32 name=__codelineno-65-32 href=#__codelineno-65-32></a><span class=w>          </span><span class=nt>schedulerName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">default-scheduler</span>
<a id=__codelineno-65-33 name=__codelineno-65-33 href=#__codelineno-65-33></a><span class=w>          </span><span class=nt>securityContext</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">{}</span>
<a id=__codelineno-65-34 name=__codelineno-65-34 href=#__codelineno-65-34></a><span class=w>          </span><span class=nt>terminationGracePeriodSeconds</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">30</span>
<a id=__codelineno-65-35 name=__codelineno-65-35 href=#__codelineno-65-35></a><span class=w>  </span><span class=nt>schedule</span><span class=p>:</span><span class=w> </span><span class=s>&#39;*/1</span><span class=nv> </span><span class=s>*</span><span class=nv> </span><span class=s>*</span><span class=nv> </span><span class=s>*</span><span class=nv> </span><span class=s>*&#39;</span>
<a id=__codelineno-65-36 name=__codelineno-65-36 href=#__codelineno-65-36></a><span class=w>  </span><span class=nt>successfulJobsHistoryLimit</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<a id=__codelineno-65-37 name=__codelineno-65-37 href=#__codelineno-65-37></a><span class=w>  </span><span class=nt>suspend</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<a id=__codelineno-65-38 name=__codelineno-65-38 href=#__codelineno-65-38></a><span class=nt>status</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">{}</span>
</code></pre></div> <blockquote> <p><strong>说明</strong></p> <p>本例创建一个每分钟执行一次、打印当前时间和Hello from the Kubernetes cluster的计划任务。</p> </blockquote> <p>查看创建的CronJob：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-66-1 name=__codelineno-66-1 href=#__codelineno-66-1></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>cj
<a id=__codelineno-66-2 name=__codelineno-66-2 href=#__codelineno-66-2></a>NAME<span class=w>    </span>SCHEDULE<span class=w>      </span>SUSPEND<span class=w>   </span>ACTIVE<span class=w>   </span>LAST<span class=w> </span>SCHEDULE<span class=w>   </span>AGE
<a id=__codelineno-66-3 name=__codelineno-66-3 href=#__codelineno-66-3></a>hello<span class=w>   </span>*/1<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w>   </span>False<span class=w>     </span><span class=m>0</span><span class=w>        </span>74s<span class=w>             </span>106s
</code></pre></div> <p>计划任务在执行时会启动一个名字为CRONJOB_NAME-xxxxx的Job去调度任务，等待1分钟可以查看执行的任务（Jobs）：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-67-1 name=__codelineno-67-1 href=#__codelineno-67-1></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span><span class=nb>jobs</span>
<a id=__codelineno-67-2 name=__codelineno-67-2 href=#__codelineno-67-2></a>NAME<span class=w>             </span>COMPLETIONS<span class=w>   </span>DURATION<span class=w>   </span>AGE
<a id=__codelineno-67-3 name=__codelineno-67-3 href=#__codelineno-67-3></a>hello-27720215<span class=w>   </span><span class=m>1</span>/1<span class=w>           </span>2s<span class=w>         </span>98s
</code></pre></div> <p>CronJob每次调用任务的时候会创建一个Job，Job会创建一个名为JOB_NAME-xxx的Pod执行命令，成功执行完任务后，Pod状态就会变成Completed，如下所示：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-68-1 name=__codelineno-68-1 href=#__codelineno-68-1></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>pod
<a id=__codelineno-68-2 name=__codelineno-68-2 href=#__codelineno-68-2></a>NAME<span class=w>                   </span>READY<span class=w>   </span>STATUS<span class=w>      </span>RESTARTS<span class=w>   </span>AGE
<a id=__codelineno-68-3 name=__codelineno-68-3 href=#__codelineno-68-3></a>hello-27720215-zsk5n<span class=w>   </span><span class=m>0</span>/1<span class=w>     </span>Completed<span class=w>   </span><span class=m>0</span><span class=w>          </span>2m22s
<a id=__codelineno-68-4 name=__codelineno-68-4 href=#__codelineno-68-4></a>hello-27720216-frh4w<span class=w>   </span><span class=m>0</span>/1<span class=w>     </span>Completed<span class=w>   </span><span class=m>0</span><span class=w>          </span>82s
<a id=__codelineno-68-5 name=__codelineno-68-5 href=#__codelineno-68-5></a>k9s-shell-15624<span class=w>        </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>     </span><span class=m>0</span><span class=w>          </span>56d
</code></pre></div> <p>此时可以通过logs查看Pod的执行日志：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-69-1 name=__codelineno-69-1 href=#__codelineno-69-1></a>$<span class=w> </span>kubectl<span class=w> </span>logs<span class=w> </span>pod/hello-27720215-zsk5n
<a id=__codelineno-69-2 name=__codelineno-69-2 href=#__codelineno-69-2></a>Thu<span class=w> </span>Sep<span class=w> </span><span class=m>15</span><span class=w> </span><span class=m>03</span>:36:13<span class=w> </span>UTC<span class=w> </span><span class=m>2022</span>
<a id=__codelineno-69-3 name=__codelineno-69-3 href=#__codelineno-69-3></a>Hello<span class=w> </span>from<span class=w> </span>the<span class=w> </span>Kubernetes<span class=w> </span>cluster
</code></pre></div> <p>如果要删除CronJob，直接使用delete即可：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-70-1 name=__codelineno-70-1 href=#__codelineno-70-1></a>$<span class=w> </span>kubectl<span class=w> </span>delete<span class=w> </span>cronjob<span class=w> </span>hello
<a id=__codelineno-70-2 name=__codelineno-70-2 href=#__codelineno-70-2></a>cronjob.batch<span class=w> </span><span class=s2>&quot;hello&quot;</span><span class=w> </span>deleted
</code></pre></div> <h3 id=52-可用参数的配置>5.2 可用参数的配置<a class=headerlink href=#52-可用参数的配置 title="Permanent link">&para;</a></h3> <p>定义一个CronJob的YAML文件如下：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-71-1 name=__codelineno-71-1 href=#__codelineno-71-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">batch/v1</span><span class=w> </span><span class=c1># K8s小于1.21 batch/v1beta1</span>
<a id=__codelineno-71-2 name=__codelineno-71-2 href=#__codelineno-71-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">CronJob</span>
<a id=__codelineno-71-3 name=__codelineno-71-3 href=#__codelineno-71-3></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-71-4 name=__codelineno-71-4 href=#__codelineno-71-4></a><span class=nt>labels</span><span class=p>:</span>
<a id=__codelineno-71-5 name=__codelineno-71-5 href=#__codelineno-71-5></a><span class=w>  </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">hello</span>
<a id=__codelineno-71-6 name=__codelineno-71-6 href=#__codelineno-71-6></a><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">hello</span>
<a id=__codelineno-71-7 name=__codelineno-71-7 href=#__codelineno-71-7></a><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<a id=__codelineno-71-8 name=__codelineno-71-8 href=#__codelineno-71-8></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-71-9 name=__codelineno-71-9 href=#__codelineno-71-9></a><span class=nt>concurrencyPolicy</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Allow</span>
<a id=__codelineno-71-10 name=__codelineno-71-10 href=#__codelineno-71-10></a><span class=nt>failedJobsHistoryLimit</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<a id=__codelineno-71-11 name=__codelineno-71-11 href=#__codelineno-71-11></a><span class=nt>jobTemplate</span><span class=p>:</span>
<a id=__codelineno-71-12 name=__codelineno-71-12 href=#__codelineno-71-12></a><span class=w>  </span><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-71-13 name=__codelineno-71-13 href=#__codelineno-71-13></a><span class=w>    </span><span class=nt>creationTimestamp</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
<a id=__codelineno-71-14 name=__codelineno-71-14 href=#__codelineno-71-14></a><span class=w>  </span><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-71-15 name=__codelineno-71-15 href=#__codelineno-71-15></a><span class=w>    </span><span class=nt>template</span><span class=p>:</span>
<a id=__codelineno-71-16 name=__codelineno-71-16 href=#__codelineno-71-16></a><span class=w>      </span><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-71-17 name=__codelineno-71-17 href=#__codelineno-71-17></a><span class=w>        </span><span class=nt>creationTimestamp</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
<a id=__codelineno-71-18 name=__codelineno-71-18 href=#__codelineno-71-18></a><span class=w>        </span><span class=nt>labels</span><span class=p>:</span>
<a id=__codelineno-71-19 name=__codelineno-71-19 href=#__codelineno-71-19></a><span class=w>          </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">hello</span>
<a id=__codelineno-71-20 name=__codelineno-71-20 href=#__codelineno-71-20></a><span class=w>      </span><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-71-21 name=__codelineno-71-21 href=#__codelineno-71-21></a><span class=w>        </span><span class=nt>containers</span><span class=p>:</span>
<a id=__codelineno-71-22 name=__codelineno-71-22 href=#__codelineno-71-22></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>args</span><span class=p>:</span>
<a id=__codelineno-71-23 name=__codelineno-71-23 href=#__codelineno-71-23></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/bin/sh</span>
<a id=__codelineno-71-24 name=__codelineno-71-24 href=#__codelineno-71-24></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">-c</span>
<a id=__codelineno-71-25 name=__codelineno-71-25 href=#__codelineno-71-25></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">date; echo Hello from the Kubernetes cluster</span>
<a id=__codelineno-71-26 name=__codelineno-71-26 href=#__codelineno-71-26></a><span class=w>          </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">busybox</span>
<a id=__codelineno-71-27 name=__codelineno-71-27 href=#__codelineno-71-27></a><span class=w>          </span><span class=nt>imagePullPolicy</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Always</span>
<a id=__codelineno-71-28 name=__codelineno-71-28 href=#__codelineno-71-28></a><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">hello</span>
<a id=__codelineno-71-29 name=__codelineno-71-29 href=#__codelineno-71-29></a><span class=w>          </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">{}</span>
<a id=__codelineno-71-30 name=__codelineno-71-30 href=#__codelineno-71-30></a><span class=w>          </span><span class=nt>terminationMessagePath</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/dev/termination-log</span>
<a id=__codelineno-71-31 name=__codelineno-71-31 href=#__codelineno-71-31></a><span class=w>          </span><span class=nt>terminationMessagePolicy</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">File</span>
<a id=__codelineno-71-32 name=__codelineno-71-32 href=#__codelineno-71-32></a><span class=w>        </span><span class=nt>dnsPolicy</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ClusterFirst</span>
<a id=__codelineno-71-33 name=__codelineno-71-33 href=#__codelineno-71-33></a><span class=w>        </span><span class=nt>restartPolicy</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">OnFailure</span>
<a id=__codelineno-71-34 name=__codelineno-71-34 href=#__codelineno-71-34></a><span class=w>        </span><span class=nt>schedulerName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">default-scheduler</span>
<a id=__codelineno-71-35 name=__codelineno-71-35 href=#__codelineno-71-35></a><span class=w>        </span><span class=nt>securityContext</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">{}</span>
<a id=__codelineno-71-36 name=__codelineno-71-36 href=#__codelineno-71-36></a><span class=w>        </span><span class=nt>terminationGracePeriodSeconds</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">30</span>
<a id=__codelineno-71-37 name=__codelineno-71-37 href=#__codelineno-71-37></a><span class=nt>schedule</span><span class=p>:</span><span class=w> </span><span class=s>&#39;*/1</span><span class=nv> </span><span class=s>*</span><span class=nv> </span><span class=s>*</span><span class=nv> </span><span class=s>*</span><span class=nv> </span><span class=s>*&#39;</span>
<a id=__codelineno-71-38 name=__codelineno-71-38 href=#__codelineno-71-38></a><span class=nt>successfulJobsHistoryLimit</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<a id=__codelineno-71-39 name=__codelineno-71-39 href=#__codelineno-71-39></a><span class=nt>suspend</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</code></pre></div> <p>其中各参数的说明如下，可以按需修改：</p> <ul> <li>schedule：调度周期，和Linux一致，分别是分、时、日、月、周。</li> <li>restartPolicy：重启策略，和Pod一致。</li> <li>concurrencyPolicy：并发调度策略。可选参数如下：</li> <li>Allow：允许同时运行多个任务。</li> <li>Forbid：不允许并发运行，如果之前的任务尚未完成，新的任务不会被创建。</li> <li> <p>Replace：如果之前的任务尚未完成，新的任务会替换之前的任务。</p> </li> <li> <p>suspend：如果设置为true，则暂停后续的任务，默认为false。</p> </li> <li>successfulJobsHistoryLimit：保留多少已完成的任务，按需配置。</li> <li>failedJobsHistoryLimit：保留多少失败的任务。</li> </ul> <p><strong>相对于Linux上的计划任务，Kubernetes的CronJob更具有可配置性，并且对于执行计划任务的环境只需启动相对应的镜像即可。</strong></p> <p>比如，如果需要Go或者PHP环境执行任务，就只需要更改任务的镜像为Go或者PHP即可，而对于Linux上的计划任务，则需要安装相对应的执行环境。此外，Kubernetes的CronJob是创建Pod来执行的，更加清晰明了，查看日志也比较方便。可见，Kubernetes的CronJob更加方便和简单。</p> <div class="admonition abstract"> <p class=admonition-title>更多CronJob的内容可以参考Kubernetes的官方文档</p> <p><a href=https://kubernetes.io/docs/home/ >https://kubernetes.io/docs/home/</a></p> </div> <h2 id=6小结>6.小结<a class=headerlink href=#6小结 title="Permanent link">&para;</a></h2> <p>本章学习了Kubernetes开箱即用的调度资源，Deployment是实际使用时用得最多的一种类型。</p> <p>Kubernetes原生的资源调度基本上可以满足大部分的需求，但是在实际使用时，可能还会有一些定制化的需求，比如计划任务需要在每台服务器都要执行等。</p> <p>此类需求可以根据实际情况开发定制化的资源调度，类似的有阿里云开源的OpenKruise等，有兴趣的读者可以关注一下。</p> <hr> <div class=md-source-file> <small> 最后更新: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime">March 26, 2023 18:26:01</span> <br> 创建日期: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime">March 23, 2023 18:59:28</span> </small> </div> <form class=md-feedback name=feedback hidden> <fieldset> <legend class=md-feedback__title> Was this page helpful? </legend> <div class=md-feedback__inner> <div class=md-feedback__list> <button class="md-feedback__icon md-icon" type=submit title="This page was helpful" data-md-value=1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m7 0c0 .8-.7 1.5-1.5 1.5S14 10.3 14 9.5 14.7 8 15.5 8s1.5.7 1.5 1.5m-5 7.73c-1.75 0-3.29-.73-4.19-1.81L9.23 14c.45.72 1.52 1.23 2.77 1.23s2.32-.51 2.77-1.23l1.42 1.42c-.9 1.08-2.44 1.81-4.19 1.81Z"/></svg> </button> <button class="md-feedback__icon md-icon" type=submit title="This page could be improved" data-md-value=0> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10m-6.5-4c.8 0 1.5.7 1.5 1.5s-.7 1.5-1.5 1.5-1.5-.7-1.5-1.5.7-1.5 1.5-1.5M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m2 4.5c1.75 0 3.29.72 4.19 1.81l-1.42 1.42C14.32 16.5 13.25 16 12 16s-2.32.5-2.77 1.23l-1.42-1.42C8.71 14.72 10.25 14 12 14Z"/></svg> </button> </div> <div class=md-feedback__note> <div data-md-value=1 hidden> Thanks for your feedback! </div> <div data-md-value=0 hidden> Thanks for your feedback! Help us improve this page by using our <a href="https://github.com/hujianli94/hujianli94.github.io/issues/new/?title=[Feedback]+Kubernetes%E8%B0%83%E5%BA%A6%E5%9F%BA%E7%A1%80+-+/Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Kubernetes%E8%B0%83%E5%BA%A6%E5%9F%BA%E7%A1%80/" target=_blank>feedback form</a>. </div> </div> </div> </fieldset> </form> </article> </div> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> 回到页面顶部 </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=页脚> <a href=../4.Kubernetes%E7%9A%84%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/ class="md-footer__link md-footer__link--prev" aria-label="上一页: Kubernetes的基础概念" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> 上一页 </span> <div class=md-ellipsis> Kubernetes的基础概念 </div> </div> </a> <a href=../6.Kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83%E5%9F%BA%E7%A1%80/ class="md-footer__link md-footer__link--next" aria-label="下一页: Kubernetes服务发布基础" rel=next> <div class=md-footer__title> <span class=md-footer__direction> 下一页 </span> <div class=md-ellipsis> Kubernetes服务发布基础 </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2023 - 2024 hujainli94 </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/hujianli94 target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> <a href=https://kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com/blog_img/20220125122524.png target=_blank rel=noopener title=kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 576 512"><!-- Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M385.2 167.6c6.4 0 12.6.3 18.8 1.1C387.4 90.3 303.3 32 207.7 32 100.5 32 13 104.8 13 197.4c0 53.4 29.3 97.5 77.9 131.6l-19.3 58.6 68-34.1c24.4 4.8 43.8 9.7 68.2 9.7 6.2 0 12.1-.3 18.3-.8-4-12.9-6.2-26.6-6.2-40.8-.1-84.9 72.9-154 165.3-154zm-104.5-52.9c14.5 0 24.2 9.7 24.2 24.4 0 14.5-9.7 24.2-24.2 24.2-14.8 0-29.3-9.7-29.3-24.2.1-14.7 14.6-24.4 29.3-24.4zm-136.4 48.6c-14.5 0-29.3-9.7-29.3-24.2 0-14.8 14.8-24.4 29.3-24.4 14.8 0 24.4 9.7 24.4 24.4 0 14.6-9.6 24.2-24.4 24.2zM563 319.4c0-77.9-77.9-141.3-165.4-141.3-92.7 0-165.4 63.4-165.4 141.3S305 460.7 397.6 460.7c19.3 0 38.9-5.1 58.6-9.9l53.4 29.3-14.8-48.6C534 402.1 563 363.2 563 319.4zm-219.1-24.5c-9.7 0-19.3-9.7-19.3-19.6 0-9.7 9.7-19.3 19.3-19.3 14.8 0 24.4 9.7 24.4 19.3 0 10-9.7 19.6-24.4 19.6zm107.1 0c-9.7 0-19.3-9.7-19.3-19.6 0-9.7 9.7-19.3 19.3-19.3 14.5 0 24.4 9.7 24.4 19.3.1 10-9.9 19.6-24.4 19.6z"/></svg> </a> <a href="mailto:<1879324764@qq.com>" target=_blank rel=noopener title=发送邮件 class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M498.1 5.6c10.1 7 15.4 19.1 13.5 31.2l-64 416c-1.5 9.7-7.4 18.2-16 23s-18.9 5.4-28 1.6L284 427.7l-68.5 74.1c-8.9 9.7-22.9 12.9-35.2 8.1S160 493.2 160 480v-83.6c0-4 1.5-7.8 4.2-10.7l167.6-182.9c5.8-6.3 5.6-16-.4-22s-15.7-6.4-22-.7L106 360.8l-88.3-44.2C7.1 311.3.3 300.7 0 288.9s5.9-22.8 16.1-28.7l448-256c10.7-6.1 23.9-5.5 34 1.4z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-consent data-md-component=consent id=__consent hidden> <div class=md-consent__overlay></div> <aside class=md-consent__inner> <form class="md-consent__form md-grid md-typeset" name=consent> <h4>Cookie consent</h4> <p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p> <input class=md-toggle type=checkbox id=__settings> <div class=md-consent__settings> <ul class=task-list> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=analytics checked> <span class=task-list-indicator></span> Google Analytics </label> </li> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=github checked> <span class=task-list-indicator></span> GitHub </label> </li> </ul> </div> <div class=md-consent__controls> <button class="md-button md-button--primary">同意</button> <label class=md-button for=__settings>管理设定</label> </div> </form> </aside> </div> <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout(function(){document.querySelector("[data-md-component=consent]").hidden=!1},250);var action,form=document.forms.consent;for(action of["submit","reset"])form.addEventListener(action,function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map(function(e){return[e,!0]}))),location.hash="",location.reload()})</script> <script id=__config type=application/json>{"base": "../../..", "features": ["content.action.edit", "content.action.view", "content.code.copy", "content.code.annotate", "navigation.indexes", "navigation.footer", "navigation.indexes", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest"], "search": "../../../assets/javascripts/workers/search.74e28a9f.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script> <script src=../../../assets/javascripts/bundle.220ee61c.min.js></script> <script src=../../../javascripts/extra.js></script> <script src=https://file.cdn.shafish.cn/blog/js/video.min.js></script> </body> </html>