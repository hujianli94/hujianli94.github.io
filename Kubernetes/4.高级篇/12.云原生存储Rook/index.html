<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="stay hungry,stay foolish #magic___^_^___line"><meta name=author content=hujainli94><link href=https://hujianli94.github.io/Kubernetes/4.%E9%AB%98%E7%BA%A7%E7%AF%87/12.%E4%BA%91%E5%8E%9F%E7%94%9F%E5%AD%98%E5%82%A8Rook/ rel=canonical><link href=../../3.%E8%BF%9B%E9%98%B6%E7%AF%87/9.Kubernetes%E9%AB%98%E7%BA%A7%E8%B0%83%E5%BA%A6/ rel=prev><link href=../13.%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%AE%B9%E5%99%A8%E5%8C%96/ rel=next><link rel=icon href=../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.0, mkdocs-material-9.5.21"><title>云原生存储Rook - DevOps运维开发</title><link rel=stylesheet href=../../../assets/stylesheets/main.66ac8b77.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.06af60db.min.css><style>:root{--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M1 7.775V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 0 1 0 2.474l-5.026 5.026a1.75 1.75 0 0 1-2.474 0l-6.25-6.25A1.752 1.752 0 0 1 1 7.775Zm1.5 0c0 .066.026.13.073.177l6.25 6.25a.25.25 0 0 0 .354 0l5.025-5.025a.25.25 0 0 0 0-.354l-6.25-6.25a.25.25 0 0 0-.177-.073H2.75a.25.25 0 0 0-.25.25ZM6 5a1 1 0 1 1 0 2 1 1 0 0 1 0-2Z"/></svg>');--md-admonition-icon--abstract:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M2.5 1.75v11.5c0 .138.112.25.25.25h3.17a.75.75 0 0 1 0 1.5H2.75A1.75 1.75 0 0 1 1 13.25V1.75C1 .784 1.784 0 2.75 0h8.5C12.216 0 13 .784 13 1.75v7.736a.75.75 0 0 1-1.5 0V1.75a.25.25 0 0 0-.25-.25h-8.5a.25.25 0 0 0-.25.25Zm13.274 9.537v-.001l-4.557 4.45a.75.75 0 0 1-1.055-.008l-1.943-1.95a.75.75 0 0 1 1.062-1.058l1.419 1.425 4.026-3.932a.75.75 0 1 1 1.048 1.074ZM4.75 4h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM4 7.75A.75.75 0 0 1 4.75 7h2a.75.75 0 0 1 0 1.5h-2A.75.75 0 0 1 4 7.75Z"/></svg>');--md-admonition-icon--info:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"/></svg>');--md-admonition-icon--tip:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M3.499.75a.75.75 0 0 1 1.5 0v.996C5.9 2.903 6.793 3.65 7.662 4.376l.24.202c-.036-.694.055-1.422.426-2.163C9.1.873 10.794-.045 12.622.26 14.408.558 16 1.94 16 4.25c0 1.278-.954 2.575-2.44 2.734l.146.508.065.22c.203.701.412 1.455.476 2.226.142 1.707-.4 3.03-1.487 3.898C11.714 14.671 10.27 15 8.75 15h-6a.75.75 0 0 1 0-1.5h1.376a4.484 4.484 0 0 1-.563-1.191 3.835 3.835 0 0 1-.05-2.063 4.647 4.647 0 0 1-2.025-.293.75.75 0 0 1 .525-1.406c1.357.507 2.376-.006 2.698-.318l.009-.01a.747.747 0 0 1 1.06 0 .748.748 0 0 1-.012 1.074c-.912.92-.992 1.835-.768 2.586.221.74.745 1.337 1.196 1.621H8.75c1.343 0 2.398-.296 3.074-.836.635-.507 1.036-1.31.928-2.602-.05-.603-.216-1.224-.422-1.93l-.064-.221c-.12-.407-.246-.84-.353-1.29a2.425 2.425 0 0 1-.507-.441 3.075 3.075 0 0 1-.633-1.248.75.75 0 0 1 1.455-.364c.046.185.144.436.31.627.146.168.353.305.712.305.738 0 1.25-.615 1.25-1.25 0-1.47-.95-2.315-2.123-2.51-1.172-.196-2.227.387-2.706 1.345-.46.92-.27 1.774.019 3.062l.042.19a.884.884 0 0 1 .01.05c.348.443.666.949.94 1.553a.75.75 0 1 1-1.365.62c-.553-1.217-1.32-1.94-2.3-2.768L6.7 5.527c-.814-.68-1.75-1.462-2.692-2.619a3.737 3.737 0 0 0-1.023.88c-.406.495-.663 1.036-.722 1.508.116.122.306.21.591.239.388.038.797-.06 1.032-.19a.75.75 0 0 1 .728 1.31c-.515.287-1.23.439-1.906.373-.682-.067-1.473-.38-1.879-1.193L.75 5.677V5.5c0-.984.48-1.94 1.077-2.664.46-.559 1.05-1.055 1.673-1.353V.75Z"/></svg>');--md-admonition-icon--success:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"/></svg>');--md-admonition-icon--question:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.92 6.085h.001a.749.749 0 1 1-1.342-.67c.169-.339.436-.701.849-.977C6.845 4.16 7.369 4 8 4a2.756 2.756 0 0 1 1.637.525c.503.377.863.965.863 1.725 0 .448-.115.83-.329 1.15-.205.307-.47.513-.692.662-.109.072-.22.138-.313.195l-.006.004a6.24 6.24 0 0 0-.26.16.952.952 0 0 0-.276.245.75.75 0 0 1-1.248-.832c.184-.264.42-.489.692-.661.103-.067.207-.132.313-.195l.007-.004c.1-.061.182-.11.258-.161a.969.969 0 0 0 .277-.245C8.96 6.514 9 6.427 9 6.25a.612.612 0 0 0-.262-.525A1.27 1.27 0 0 0 8 5.5c-.369 0-.595.09-.74.187a1.01 1.01 0 0 0-.34.398ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"/></svg>');--md-admonition-icon--warning:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"/></svg>');--md-admonition-icon--failure:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M2.344 2.343h-.001a8 8 0 0 1 11.314 11.314A8.002 8.002 0 0 1 .234 10.089a8 8 0 0 1 2.11-7.746Zm1.06 10.253a6.5 6.5 0 1 0 9.108-9.275 6.5 6.5 0 0 0-9.108 9.275ZM6.03 4.97 8 6.94l1.97-1.97a.749.749 0 0 1 1.275.326.749.749 0 0 1-.215.734L9.06 8l1.97 1.97a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215L8 9.06l-1.97 1.97a.749.749 0 0 1-1.275-.326.749.749 0 0 1 .215-.734L6.94 8 4.97 6.03a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018Z"/></svg>');--md-admonition-icon--danger:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M9.504.43a1.516 1.516 0 0 1 2.437 1.713L10.415 5.5h2.123c1.57 0 2.346 1.909 1.22 3.004l-7.34 7.142a1.249 1.249 0 0 1-.871.354h-.302a1.25 1.25 0 0 1-1.157-1.723L5.633 10.5H3.462c-1.57 0-2.346-1.909-1.22-3.004L9.503.429Zm1.047 1.074L3.286 8.571A.25.25 0 0 0 3.462 9H6.75a.75.75 0 0 1 .694 1.034l-1.713 4.188 6.982-6.793A.25.25 0 0 0 12.538 7H9.25a.75.75 0 0 1-.683-1.06l2.008-4.418.003-.006a.036.036 0 0 0-.004-.009l-.006-.006-.008-.001c-.003 0-.006.002-.009.004Z"/></svg>');--md-admonition-icon--bug:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M4.72.22a.75.75 0 0 1 1.06 0l1 .999a3.488 3.488 0 0 1 2.441 0l.999-1a.748.748 0 0 1 1.265.332.75.75 0 0 1-.205.729l-.775.776c.616.63.995 1.493.995 2.444v.327c0 .1-.009.197-.025.292.408.14.764.392 1.029.722l1.968-.787a.75.75 0 0 1 .556 1.392L13 7.258V9h2.25a.75.75 0 0 1 0 1.5H13v.5c0 .409-.049.806-.141 1.186l2.17.868a.75.75 0 0 1-.557 1.392l-2.184-.873A4.997 4.997 0 0 1 8 16a4.997 4.997 0 0 1-4.288-2.427l-2.183.873a.75.75 0 0 1-.558-1.392l2.17-.868A5.036 5.036 0 0 1 3 11v-.5H.75a.75.75 0 0 1 0-1.5H3V7.258L.971 6.446a.75.75 0 0 1 .558-1.392l1.967.787c.265-.33.62-.583 1.03-.722a1.677 1.677 0 0 1-.026-.292V4.5c0-.951.38-1.814.995-2.444L4.72 1.28a.75.75 0 0 1 0-1.06Zm.53 6.28a.75.75 0 0 0-.75.75V11a3.5 3.5 0 1 0 7 0V7.25a.75.75 0 0 0-.75-.75ZM6.173 5h3.654A.172.172 0 0 0 10 4.827V4.5a2 2 0 1 0-4 0v.327c0 .096.077.173.173.173Z"/></svg>');--md-admonition-icon--example:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M5 5.782V2.5h-.25a.75.75 0 0 1 0-1.5h6.5a.75.75 0 0 1 0 1.5H11v3.282l3.666 5.76C15.619 13.04 14.543 15 12.767 15H3.233c-1.776 0-2.852-1.96-1.899-3.458Zm-2.4 6.565a.75.75 0 0 0 .633 1.153h9.534a.75.75 0 0 0 .633-1.153L12.225 10.5h-8.45ZM9.5 2.5h-3V6c0 .143-.04.283-.117.403L4.73 9h6.54L9.617 6.403A.746.746 0 0 1 9.5 6Z"/></svg>');--md-admonition-icon--quote:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M1.75 2.5h10.5a.75.75 0 0 1 0 1.5H1.75a.75.75 0 0 1 0-1.5Zm4 5h8.5a.75.75 0 0 1 0 1.5h-8.5a.75.75 0 0 1 0-1.5Zm0 5h8.5a.75.75 0 0 1 0 1.5h-8.5a.75.75 0 0 1 0-1.5ZM2.5 7.75v6a.75.75 0 0 1-1.5 0v-6a.75.75 0 0 1 1.5 0Z"/></svg>');}</style><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../stylesheets/extra.css><link rel=stylesheet href=https://file.cdn.shafish.cn/blog/css/vssue.css><link rel=stylesheet href=https://file.cdn.shafish.cn/blog/css/video-js.min.css><link rel=stylesheet href=https://file.cdn.shafish.cn/blog/css/video.css><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","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"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","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",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=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",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script><script>var consent;"undefined"==typeof __md_analytics||(consent=__md_get("__consent"))&&consent.analytics&&__md_analytics()</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#云原生存储rook class=md-skip> 跳转至 </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=页眉> <a href=../../.. title=DevOps运维开发 class="md-header__button md-logo" aria-label=DevOps运维开发 data-md-component=logo> <img src=../../../assets/images/logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> DevOps运维开发 </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> 云原生存储Rook </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label=切换至深色模式 type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title=切换至深色模式 for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=blue data-md-color-accent=blue aria-label=切换至浅色模式 type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title=切换至浅色模式 for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg> </label> </form> <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=查找> <a href=javascript:void(0) class="md-search__icon md-icon" title=分享 aria-label=分享 data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=清空当前内容 aria-label=清空当前内容 tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> 正在初始化搜索引擎 </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/hujianli94/hujianli94.github.io title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> hujianli94.github.io </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=标签 data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> 首页 </a> </li> <li class=md-tabs__item> <a href=../../../k8s/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.k8s/ class=md-tabs__link> k8s </a> </li> <li class=md-tabs__item> <a href=../../../K8s-network/0.network-namespace/1.network-namespace/ class=md-tabs__link> K8s-network </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../../0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Kubernetes/ class=md-tabs__link> Kubernetes </a> </li> <li class=md-tabs__item> <a href=../../../Docker/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Docker/ class=md-tabs__link> Docker </a> </li> <li class=md-tabs__item> <a href=../../../Golang/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Go-Web%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98/ class=md-tabs__link> Golang </a> </li> <li class=md-tabs__item> <a href=../../../Python/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Pythjon-auto-ops/ class=md-tabs__link> Python </a> </li> <li class=md-tabs__item> <a href=../../../Openstack/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.OpenStack/ class=md-tabs__link> Openstack </a> </li> <li class=md-tabs__item> <a href=../../../Python-vs-Go/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Python-vs-Go/ class=md-tabs__link> Python-vs-Go </a> </li> <li class=md-tabs__item> <a href=../../../Linux/Shell/Shell%E7%AE%80%E4%BB%8B/ class=md-tabs__link> Linux </a> </li> <li class=md-tabs__item> <a href=../../../Other/tools/1.PicGo%E5%9B%BE%E5%BA%8A/ class=md-tabs__link> Other </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=导航栏 data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title=DevOps运维开发 class="md-nav__button md-logo" aria-label=DevOps运维开发 data-md-component=logo> <img src=../../../assets/images/logo.png alt=logo> </a> DevOps运维开发 </label> <div class=md-nav__source> <a href=https://github.com/hujianli94/hujianli94.github.io title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> hujianli94.github.io </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> <span class=md-ellipsis> 首页 </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> k8s </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> k8s </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_1> <label class=md-nav__link for=__nav_2_1 id=__nav_2_1_label tabindex=0> <span class=md-ellipsis> 0.学习线路 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_1_label aria-expanded=false> <label class=md-nav__title for=__nav_2_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.k8s/ class=md-nav__link> <span class=md-ellipsis> Kubernetes从入门到实践 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2> <label class=md-nav__link for=__nav_2_2 id=__nav_2_2_label tabindex=0> <span class=md-ellipsis> 1.容器的发展史 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2> <span class="md-nav__icon md-icon"></span> 1.容器的发展史 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/1.%E5%AE%B9%E5%99%A8%E7%9A%84%E5%8F%91%E5%B1%95%E5%8F%B2/1.1%E5%BC%80%E5%8F%91%E8%BF%87%E7%A8%8B%E7%9A%84%E5%8F%91%E5%B1%95/ class=md-nav__link> <span class=md-ellipsis> 1.1开发过程的发展 </span> </a> </li> <li class=md-nav__item> <a href=../../../k8s/1.%E5%AE%B9%E5%99%A8%E7%9A%84%E5%8F%91%E5%B1%95%E5%8F%B2/1.2%E5%BA%94%E7%94%A8%E6%9E%B6%E6%9E%84%E7%9A%84%E5%8F%91%E5%B1%95/ class=md-nav__link> <span class=md-ellipsis> 1.2应用架构的发展 </span> </a> </li> <li class=md-nav__item> <a href=../../../k8s/1.%E5%AE%B9%E5%99%A8%E7%9A%84%E5%8F%91%E5%B1%95%E5%8F%B2/1.3%E9%83%A8%E7%BD%B2%E6%89%93%E5%8C%85%E7%9A%84%E5%8F%91%E5%B1%95/ class=md-nav__link> <span class=md-ellipsis> 1.3部署打包的发展 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_3> <label class=md-nav__link for=__nav_2_3 id=__nav_2_3_label tabindex=0> <span class=md-ellipsis> 2.Kubernetes的核心概念 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_3_label aria-expanded=false> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> 2.Kubernetes的核心概念 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/2.Kubernetes%E7%9A%84%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/2.1Kubernetes%E7%9A%84%E8%AE%BE%E8%AE%A1%E6%9E%B6%E6%9E%84/ class=md-nav__link> <span class=md-ellipsis> 2.1Kubernetes的设计架构 </span> </a> </li> <li class=md-nav__item> <a href=../../../k8s/2.Kubernetes%E7%9A%84%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/2.2Kubernetes%E7%9A%84%E6%A0%B8%E5%BF%83%E5%AF%B9%E8%B1%A1/ class=md-nav__link> <span class=md-ellipsis> 2.2Kubernetes的核心对象 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_4> <label class=md-nav__link for=__nav_2_4 id=__nav_2_4_label tabindex=0> <span class=md-ellipsis> 3.Kubernetes的安装和部署 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_4_label aria-expanded=false> <label class=md-nav__title for=__nav_2_4> <span class="md-nav__icon md-icon"></span> 3.Kubernetes的安装和部署 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/3.Kubernetes%E7%9A%84%E5%AE%89%E8%A3%85%E5%92%8C%E9%83%A8%E7%BD%B2/3.1kubeadm%E6%90%AD%E5%BB%BA%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/ class=md-nav__link> <span class=md-ellipsis> 3.1kubeadm搭建开发环境 </span> </a> </li> <li class=md-nav__item> <a href=../../../k8s/3.Kubernetes%E7%9A%84%E5%AE%89%E8%A3%85%E5%92%8C%E9%83%A8%E7%BD%B2/3.2kubeadm%E6%90%AD%E5%BB%BA%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83/ class=md-nav__link> <span class=md-ellipsis> 3.2kubeadm搭建生产环境 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_5> <label class=md-nav__link for=__nav_2_5 id=__nav_2_5_label tabindex=0> <span class=md-ellipsis> 4.Pod </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_5_label aria-expanded=false> <label class=md-nav__title for=__nav_2_5> <span class="md-nav__icon md-icon"></span> 4.Pod </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/4.Pod/4.1Pod%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/ class=md-nav__link> <span class=md-ellipsis> 4.1Pod的基本操作 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_6> <label class=md-nav__link for=__nav_2_6 id=__nav_2_6_label tabindex=0> <span class=md-ellipsis> 5.控制器 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_6_label aria-expanded=false> <label class=md-nav__title for=__nav_2_6> <span class="md-nav__icon md-icon"></span> 5.控制器 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/5.%E6%8E%A7%E5%88%B6%E5%99%A8/5.1Deployment/ class=md-nav__link> <span class=md-ellipsis> 5.1Deployment </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> K8s-network </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> K8s-network </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1> <label class=md-nav__link for=__nav_3_1 id=__nav_3_1_label tabindex=0> <span class=md-ellipsis> 0.network-namespace </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_1_label aria-expanded=false> <label class=md-nav__title for=__nav_3_1> <span class="md-nav__icon md-icon"></span> 0.network-namespace </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../K8s-network/0.network-namespace/1.network-namespace/ class=md-nav__link> <span class=md-ellipsis> 1.network-namespace </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4 checked> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex> <span class=md-ellipsis> Kubernetes </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=true> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_1> <label class=md-nav__link for=__nav_4_1 id=__nav_4_1_label tabindex=0> <span class=md-ellipsis> 0.学习线路 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_1_label aria-expanded=false> <label class=md-nav__title for=__nav_4_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Kubernetes/ class=md-nav__link> <span class=md-ellipsis> Kubernetes </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_2> <label class=md-nav__link for=__nav_4_2 id=__nav_4_2_label tabindex=0> <span class=md-ellipsis> 1.安装篇 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_2_label aria-expanded=false> <label class=md-nav__title for=__nav_4_2> <span class="md-nav__icon md-icon"></span> 1.安装篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../1.%E5%AE%89%E8%A3%85%E7%AF%87/1.Kubeadm%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/ class=md-nav__link> <span class=md-ellipsis> Kubeadm安装高可用集群 </span> </a> </li> <li class=md-nav__item> <a href=../../1.%E5%AE%89%E8%A3%85%E7%AF%87/2.%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/ class=md-nav__link> <span class=md-ellipsis> 二进制安装高可用K8s集群 </span> </a> </li> <li class=md-nav__item> <a href=../../1.%E5%AE%89%E8%A3%85%E7%AF%87/3.%E5%AE%89%E8%A3%85%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/ class=md-nav__link> <span class=md-ellipsis> 安装常用工具 </span> </a> </li> <li class=md-nav__item> <a href=../../1.%E5%AE%89%E8%A3%85%E7%AF%87/4.Kubeadm%E5%AE%89%E8%A3%85%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/ class=md-nav__link> <span class=md-ellipsis> Kubeadm安装开发环境 </span> </a> </li> <li class=md-nav__item> <a href=../../1.%E5%AE%89%E8%A3%85%E7%AF%87/5.K3s%E5%92%8CMinikube/ class=md-nav__link> <span class=md-ellipsis> K3s和Minikube </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_3> <label class=md-nav__link for=__nav_4_3 id=__nav_4_3_label tabindex=0> <span class=md-ellipsis> 2.基础篇 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_3_label aria-expanded=false> <label class=md-nav__title for=__nav_4_3> <span class="md-nav__icon md-icon"></span> 2.基础篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../2.%E5%9F%BA%E7%A1%80%E7%AF%87/3.Docker%E5%9F%BA%E7%A1%80/ class=md-nav__link> <span class=md-ellipsis> Docker基础 </span> </a> </li> <li class=md-nav__item> <a href=../../2.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Kubernetes%E7%9A%84%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/ class=md-nav__link> <span class=md-ellipsis> Kubernetes的基础概念 </span> </a> </li> <li class=md-nav__item> <a href=../../2.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Kubernetes%E8%B0%83%E5%BA%A6%E5%9F%BA%E7%A1%80/ class=md-nav__link> <span class=md-ellipsis> Kubernetes调度基础 </span> </a> </li> <li class=md-nav__item> <a href=../../2.%E5%9F%BA%E7%A1%80%E7%AF%87/6.Kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83%E5%9F%BA%E7%A1%80/ class=md-nav__link> <span class=md-ellipsis> Kubernetes服务发布基础 </span> </a> </li> <li class=md-nav__item> <a href=../../2.%E5%9F%BA%E7%A1%80%E7%AF%87/7.Kubernetes%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> Kubernetes配置管理 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_4> <label class=md-nav__link for=__nav_4_4 id=__nav_4_4_label tabindex=0> <span class=md-ellipsis> 3.进阶篇 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4_4> <span class="md-nav__icon md-icon"></span> 3.进阶篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../3.%E8%BF%9B%E9%98%B6%E7%AF%87/8.Kubernetes%E5%AD%98%E5%82%A8%E5%85%A5%E9%97%A8/ class=md-nav__link> <span class=md-ellipsis> Kubernetes存储入门 </span> </a> </li> <li class=md-nav__item> <a href=../../3.%E8%BF%9B%E9%98%B6%E7%AF%87/9.Kubernetes%E9%AB%98%E7%BA%A7%E8%B0%83%E5%BA%A6/ class=md-nav__link> <span class=md-ellipsis> Kubernetes高级调度 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_5 checked> <label class=md-nav__link for=__nav_4_5 id=__nav_4_5_label tabindex=0> <span class=md-ellipsis> 4.高级篇 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_5_label aria-expanded=true> <label class=md-nav__title for=__nav_4_5> <span class="md-nav__icon md-icon"></span> 4.高级篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> 云原生存储Rook </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> 云原生存储Rook </span> </a> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#1-kubernetes-集群的高可用性原理 class=md-nav__link> <span class=md-ellipsis> 1. Kubernetes 集群的高可用性原理 </span> </a> </li> <li class=md-nav__item> <a href=#2-服务器基本信息 class=md-nav__link> <span class=md-ellipsis> 2. 服务器基本信息 </span> </a> </li> <li class=md-nav__item> <a href=#3-kubernetes-集群网络规划 class=md-nav__link> <span class=md-ellipsis> 3. Kubernetes 集群网络规划 </span> </a> </li> <li class=md-nav__item> <a href=#4-高可用环境安装 class=md-nav__link> <span class=md-ellipsis> 4. 高可用环境安装 </span> </a> <nav class=md-nav aria-label="4. 高可用环境安装"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#41-安装环境准备 class=md-nav__link> <span class=md-ellipsis> 4.1 安装环境准备 </span> </a> </li> <li class=md-nav__item> <a href=#42-安装-master-节点 class=md-nav__link> <span class=md-ellipsis> 4.2 安装 Master 节点 </span> </a> </li> <li class=md-nav__item> <a href=#43-安装-haproxy class=md-nav__link> <span class=md-ellipsis> 4.3 安装 haproxy </span> </a> <nav class=md-nav aria-label="4.3 安装 haproxy"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#安装-haproxy class=md-nav__link> <span class=md-ellipsis> 安装 haproxy </span> </a> </li> <li class=md-nav__item> <a href=#配置-haproxy class=md-nav__link> <span class=md-ellipsis> 配置 haproxy </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#44-安装-keepalived class=md-nav__link> <span class=md-ellipsis> 4.4 安装 keepalived </span> </a> <nav class=md-nav aria-label="4.4 安装 keepalived"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#安装-keepalived class=md-nav__link> <span class=md-ellipsis> 安装 keepalived </span> </a> </li> <li class=md-nav__item> <a href=#配置-keepalived class=md-nav__link> <span class=md-ellipsis> 配置 keepalived </span> </a> </li> <li class=md-nav__item> <a href=#健康检查脚本 class=md-nav__link> <span class=md-ellipsis> 健康检查脚本 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#45-初始化-master-节点 class=md-nav__link> <span class=md-ellipsis> 4.5 初始化 Master 节点 </span> </a> <nav class=md-nav aria-label="4.5 初始化 Master 节点"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#命令行方式初始化-k8s class=md-nav__link> <span class=md-ellipsis> 命令行方式初始化 k8s </span> </a> </li> <li class=md-nav__item> <a href=#基于-init-件初始化-k8s class=md-nav__link> <span class=md-ellipsis> 基于 init ⽂件初始化 k8s </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#46-安装-calico-网络 class=md-nav__link> <span class=md-ellipsis> 4.6 安装 Calico 网络 </span> </a> </li> <li class=md-nav__item> <a href=#47-加入其余-master-节点 class=md-nav__link> <span class=md-ellipsis> 4.7 加入其余 Master 节点 </span> </a> </li> <li class=md-nav__item> <a href=#48-加入工作节点 class=md-nav__link> <span class=md-ellipsis> 4.8 加入工作节点 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#5-安装常用工具 class=md-nav__link> <span class=md-ellipsis> 5. 安装常用工具 </span> </a> <nav class=md-nav aria-label="5. 安装常用工具"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#51-安装-kubectl class=md-nav__link> <span class=md-ellipsis> 5.1 安装 kubectl </span> </a> </li> <li class=md-nav__item> <a href=#52-安装-helm class=md-nav__link> <span class=md-ellipsis> 5.2 安装 helm </span> </a> </li> <li class=md-nav__item> <a href=#53-kubectx-kubens-and-fzf class=md-nav__link> <span class=md-ellipsis> 5.3 Kubectx Kubens and fzf </span> </a> </li> <li class=md-nav__item> <a href=#54-kubectl-插件管理器-krew class=md-nav__link> <span class=md-ellipsis> 5.4 kubectl 插件管理器 krew </span> </a> </li> <li class=md-nav__item> <a href=#55-kubectl-neat class=md-nav__link> <span class=md-ellipsis> 5.5 kubectl-neat </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#6-kubernetes-节点调度规划 class=md-nav__link> <span class=md-ellipsis> 6. kubernetes 节点调度规划 </span> </a> </li> <li class=md-nav__item> <a href=#7-metrics-部署 class=md-nav__link> <span class=md-ellipsis> 7. Metrics 部署 </span> </a> </li> <li class=md-nav__item> <a href=#8-dashboard-部署 class=md-nav__link> <span class=md-ellipsis> 8. Dashboard 部署 </span> </a> </li> <li class=md-nav__item> <a href=#9云原生存储-rook class=md-nav__link> <span class=md-ellipsis> 9.云原生存储 Rook </span> </a> <nav class=md-nav aria-label="9.云原生存储 Rook"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#91-动机 class=md-nav__link> <span class=md-ellipsis> 9.1 动机 </span> </a> </li> <li class=md-nav__item> <a href=#92-前置条件 class=md-nav__link> <span class=md-ellipsis> 9.2 前置条件 </span> </a> </li> <li class=md-nav__item> <a href=#93-部署 class=md-nav__link> <span class=md-ellipsis> 9.3 部署 </span> </a> <nav class=md-nav aria-label="9.3 部署"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#k8s-集群准备 class=md-nav__link> <span class=md-ellipsis> K8S 集群准备 </span> </a> </li> <li class=md-nav__item> <a href=#本地存储准备lvm-逻辑卷 class=md-nav__link> <span class=md-ellipsis> 本地存储准备(LVM 逻辑卷) </span> </a> </li> <li class=md-nav__item> <a href=#配置时间同步 class=md-nav__link> <span class=md-ellipsis> 配置时间同步 </span> </a> </li> <li class=md-nav__item> <a href=#安装-helm class=md-nav__link> <span class=md-ellipsis> 安装 helm </span> </a> </li> <li class=md-nav__item> <a href=#部署-rook-operator class=md-nav__link> <span class=md-ellipsis> 部署 Rook Operator </span> </a> </li> <li class=md-nav__item> <a href=#创建-ceph-集群 class=md-nav__link> <span class=md-ellipsis> 创建 Ceph 集群 </span> </a> <nav class=md-nav aria-label="创建 Ceph 集群"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#参考文档 class=md-nav__link> <span class=md-ellipsis> 参考文档 </span> </a> </li> <li class=md-nav__item> <a href=#创建集群 class=md-nav__link> <span class=md-ellipsis> 创建集群 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#验证集群状态 class=md-nav__link> <span class=md-ellipsis> 验证集群状态 </span> </a> </li> <li class=md-nav__item> <a href=#ceph-dashboard class=md-nav__link> <span class=md-ellipsis> Ceph Dashboard </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#94-使用存储-服务持久化 class=md-nav__link> <span class=md-ellipsis> 9.4 使用存储-服务持久化 </span> </a> <nav class=md-nav aria-label="9.4 使用存储-服务持久化"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#941-块存储block class=md-nav__link> <span class=md-ellipsis> 9.4.1 块存储（Block） </span> </a> <nav class=md-nav aria-label="9.4.1 块存储（Block）"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#9411-rbd-存储供给 class=md-nav__link> <span class=md-ellipsis> 9.4.1.1 RBD 存储供给 </span> </a> </li> <li class=md-nav__item> <a href=#9412-使用存储 class=md-nav__link> <span class=md-ellipsis> 9.4.1.2 使用存储 </span> </a> </li> <li class=md-nav__item> <a href=#9413-pvc-快照-块存储快照 class=md-nav__link> <span class=md-ellipsis> 9.4.1.3 PVC 快照-块存储快照 </span> </a> <nav class=md-nav aria-label="9.4.1.3 PVC 快照-块存储快照"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#制作快照 class=md-nav__link> <span class=md-ellipsis> 制作快照 </span> </a> </li> <li class=md-nav__item> <a href=#指定快照创建-pvc class=md-nav__link> <span class=md-ellipsis> 指定快照创建 PVC </span> </a> </li> <li class=md-nav__item> <a href=#数据验证 class=md-nav__link> <span class=md-ellipsis> 数据验证 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#9414-pvc-动态扩容 class=md-nav__link> <span class=md-ellipsis> 9.4.1.4 PVC 动态扩容 </span> </a> <nav class=md-nav aria-label="9.4.1.4 PVC 动态扩容"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#扩容操作 class=md-nav__link> <span class=md-ellipsis> 扩容操作 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#9415-pvc-克隆 class=md-nav__link> <span class=md-ellipsis> 9.4.1.5 PVC 克隆 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#942-cephfs-共享文件系统 class=md-nav__link> <span class=md-ellipsis> 9.4.2 CephFS 共享文件系统 </span> </a> <nav class=md-nav aria-label="9.4.2 CephFS 共享文件系统"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#9421-创建-cephfilesystem class=md-nav__link> <span class=md-ellipsis> 9.4.2.1 创建 CephFilesystem </span> </a> </li> <li class=md-nav__item> <a href=#9422-cephfs-存储供给 class=md-nav__link> <span class=md-ellipsis> 9.4.2.2 CephFS 存储供给 </span> </a> </li> <li class=md-nav__item> <a href=#9423-关于配额 class=md-nav__link> <span class=md-ellipsis> 9.4.2.3 关于配额 </span> </a> </li> <li class=md-nav__item> <a href=#9424-使用存储-多个-pod-挂载 class=md-nav__link> <span class=md-ellipsis> 9.4.2.4 使用存储: 多个 Pod 挂载 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#943-对象存储 class=md-nav__link> <span class=md-ellipsis> 9.4.3 对象存储 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fqa class=md-nav__link> <span class=md-ellipsis> FQA </span> </a> <nav class=md-nav aria-label=FQA> <ul class=md-nav__list> <li class=md-nav__item> <a href=#rook-ceph-卸载重新部署 class=md-nav__link> <span class=md-ellipsis> rook-ceph 卸载、重新部署 </span> </a> </li> <li class=md-nav__item> <a href=#测试数据清理 class=md-nav__link> <span class=md-ellipsis> 测试数据清理 </span> </a> <nav class=md-nav aria-label=测试数据清理> <ul class=md-nav__list> <li class=md-nav__item> <a href=#数据删除步骤 class=md-nav__link> <span class=md-ellipsis> 数据删除步骤 </span> </a> </li> <li class=md-nav__item> <a href=#删除-ceph-pool-存储池 class=md-nav__link> <span class=md-ellipsis> 删除 ceph pool 存储池 </span> </a> </li> <li class=md-nav__item> <a href=#删除-rbd-硬盘 class=md-nav__link> <span class=md-ellipsis> 删除 rbd 硬盘 </span> </a> </li> <li class=md-nav__item> <a href=#ceph-集群报daemons-have-recently-crashed问题处理 class=md-nav__link> <span class=md-ellipsis> ceph 集群报"daemons have recently crashed"问题处理 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#参考文档_1 class=md-nav__link> <span class=md-ellipsis> 参考文档 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../13.%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%AE%B9%E5%99%A8%E5%8C%96/ class=md-nav__link> <span class=md-ellipsis> 中间件容器化 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_6> <label class=md-nav__link for=__nav_4_6 id=__nav_4_6_label tabindex=0> <span class=md-ellipsis> 5.运维篇 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_6_label aria-expanded=false> <label class=md-nav__title for=__nav_4_6> <span class="md-nav__icon md-icon"></span> 5.运维篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../5.%E8%BF%90%E7%BB%B4%E7%AF%87/14.Kubernetes%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/ class=md-nav__link> <span class=md-ellipsis> Kubernetes日志收集 </span> </a> </li> <li class=md-nav__item> <a href=../../5.%E8%BF%90%E7%BB%B4%E7%AF%87/15.Kubernetes%E7%9B%91%E6%8E%A7%E5%91%8A%E8%AD%A6/ class=md-nav__link> <span class=md-ellipsis> Kubernetes监控告警 </span> </a> </li> <li class=md-nav__item> <a href=../../5.%E8%BF%90%E7%BB%B4%E7%AF%87/16.%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83Ingress%E8%BF%9B%E9%98%B6/ class=md-nav__link> <span class=md-ellipsis> 服务发布Ingress进阶 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_7> <label class=md-nav__link for=__nav_4_7 id=__nav_4_7_label tabindex=0> <span class=md-ellipsis> 6.DevOps篇 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_7_label aria-expanded=false> <label class=md-nav__title for=__nav_4_7> <span class="md-nav__icon md-icon"></span> 6.DevOps篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/ class=md-nav__link> <span class=md-ellipsis> DevOps实践 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> Docker </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Docker </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_1> <label class=md-nav__link for=__nav_5_1 id=__nav_5_1_label tabindex=0> <span class=md-ellipsis> 0.学习线路 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_1_label aria-expanded=false> <label class=md-nav__title for=__nav_5_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Docker/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Docker/ class=md-nav__link> <span class=md-ellipsis> Docker </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_2> <label class=md-nav__link for=__nav_5_2 id=__nav_5_2_label tabindex=0> <span class=md-ellipsis> 1.基础 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_2_label aria-expanded=false> <label class=md-nav__title for=__nav_5_2> <span class="md-nav__icon md-icon"></span> 1.基础 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Docker/1.%E5%9F%BA%E7%A1%80/1.%E5%AE%89%E8%A3%85Docker/ class=md-nav__link> <span class=md-ellipsis> 1.安装Docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.%E5%9F%BA%E7%A1%80/2.Docker%E9%95%9C%E5%83%8F/ class=md-nav__link> <span class=md-ellipsis> 2.Docker 镜像 </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.%E5%9F%BA%E7%A1%80/3.Docker%E5%AE%B9%E5%99%A8/ class=md-nav__link> <span class=md-ellipsis> 3.Docker容器 </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.%E5%9F%BA%E7%A1%80/4.%E4%BC%81%E4%B8%9A%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93harbor/ class=md-nav__link> <span class=md-ellipsis> 4.企业私有仓库harbor </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.%E5%9F%BA%E7%A1%80/5.Docker%E6%95%B0%E6%8D%AE/ class=md-nav__link> <span class=md-ellipsis> 5.Docker数据 </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.%E5%9F%BA%E7%A1%80/6.Docker%E7%BD%91%E7%BB%9C/ class=md-nav__link> <span class=md-ellipsis> 6.Docker网络 </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.%E5%9F%BA%E7%A1%80/7.Dockerfile/ class=md-nav__link> <span class=md-ellipsis> 7.Dockerfile </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.%E5%9F%BA%E7%A1%80/8.docker-compose/ class=md-nav__link> <span class=md-ellipsis> 8.docker-compose </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.%E5%9F%BA%E7%A1%80/9.Docker%E7%9B%B8%E5%85%B3%E8%84%9A%E6%9C%AC/ class=md-nav__link> <span class=md-ellipsis> 9.Docker相关脚本 </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.%E5%9F%BA%E7%A1%80/10.Docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/ class=md-nav__link> <span class=md-ellipsis> 10.Docker常用命令 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_3> <label class=md-nav__link for=__nav_5_3 id=__nav_5_3_label tabindex=0> <span class=md-ellipsis> 2.实战案例 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_3_label aria-expanded=false> <label class=md-nav__title for=__nav_5_3> <span class="md-nav__icon md-icon"></span> 2.实战案例 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/1.%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/ class=md-nav__link> <span class=md-ellipsis> 1.操作系统 </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/2.Web%E6%9C%8D%E5%8A%A1%E4%B8%8E%E5%BA%94%E7%94%A8/ class=md-nav__link> <span class=md-ellipsis> 2.Web服务与应用 </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/3.%E6%8C%81%E7%BB%AD%E5%BC%80%E5%8F%91%E4%B8%8E%E7%AE%A1%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 3.持续开发与管理 </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/4.%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BA%94%E7%94%A8/ class=md-nav__link> <span class=md-ellipsis> 4.数据库应用 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_4> <label class=md-nav__link for=__nav_5_4 id=__nav_5_4_label tabindex=0> <span class=md-ellipsis> 3.Devops </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_4_label aria-expanded=false> <label class=md-nav__title for=__nav_5_4> <span class="md-nav__icon md-icon"></span> 3.Devops </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Docker/3.Devops/1.confcenter-docker/ class=md-nav__link> <span class=md-ellipsis> 1.confcenter-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/2.simaple-jenkins/ class=md-nav__link> <span class=md-ellipsis> 2.simaple-jenkins </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/3.docker-nginx-spa/ class=md-nav__link> <span class=md-ellipsis> 3.docker-nginx-spa </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/4.fileserver-docker/ class=md-nav__link> <span class=md-ellipsis> 4.fileserver-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/5.haproxy-docker/ class=md-nav__link> <span class=md-ellipsis> 5.haproxy-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/6.mysql-docker/ class=md-nav__link> <span class=md-ellipsis> 6.mysql-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/7.frp-docker/ class=md-nav__link> <span class=md-ellipsis> 7.frp-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/8.coredns-docker/ class=md-nav__link> <span class=md-ellipsis> 8.coredns-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/9.simple-harbor/ class=md-nav__link> <span class=md-ellipsis> 9.simple-harbor </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/10.redis-docker/ class=md-nav__link> <span class=md-ellipsis> 10.redis-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/11.nexus3-docker/ class=md-nav__link> <span class=md-ellipsis> 11.nexus3-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/12.openvpn-docker/ class=md-nav__link> <span class=md-ellipsis> 12.openvpn-docker.md </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/13.nfs-docker/ class=md-nav__link> <span class=md-ellipsis> 13.nfs-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/14.jumpserver-docker/ class=md-nav__link> <span class=md-ellipsis> 14.jumpserver-docker.md </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/15.ansible-docker/ class=md-nav__link> <span class=md-ellipsis> 15.ansible-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/16.minio-docker/ class=md-nav__link> <span class=md-ellipsis> 16.minio-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/17.vaultwarden-docker/ class=md-nav__link> <span class=md-ellipsis> 17.vaultwarden-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/18.kasm-docker/ class=md-nav__link> <span class=md-ellipsis> 18.kasm-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/19.nginx-docker/ class=md-nav__link> <span class=md-ellipsis> 19.nginx-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/20.kafka-docker/ class=md-nav__link> <span class=md-ellipsis> 20.kafka-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/21.golang-docker/ class=md-nav__link> <span class=md-ellipsis> 21.golang-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/22.postgres-docker/ class=md-nav__link> <span class=md-ellipsis> 22.postgres-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/23.nginx-download-docker/ class=md-nav__link> <span class=md-ellipsis> 23.nginx-download-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/24.helm%E9%83%A8%E7%BD%B2%E5%B8%B8%E7%94%A8%E6%9C%8D%E5%8A%A1/ class=md-nav__link> <span class=md-ellipsis> 24.helm部署常用服务 </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/25.Python%E6%93%8D%E4%BD%9CDocker/ class=md-nav__link> <span class=md-ellipsis> 25.Python操作Docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/26.docker-compose-devops/ class=md-nav__link> <span class=md-ellipsis> 26.docker-compose-devops </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/27.DevOps%E4%B8%8B%E7%9A%84Shell%E8%84%9A%E6%9C%AC/ class=md-nav__link> <span class=md-ellipsis> 27.DevOps下的Shell脚本 </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/28.Devops%E4%B8%8B%E7%9A%84Python%E8%84%9A%E6%9C%AC/ class=md-nav__link> <span class=md-ellipsis> 28.Devops下的Python脚本 </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/29.Vagrant%E8%99%9A%E6%8B%9F%E6%9C%BA/ class=md-nav__link> <span class=md-ellipsis> 29.Vagrant虚拟机 </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/30.VMware-workstation/ class=md-nav__link> <span class=md-ellipsis> 30.VMware Workstation </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/31.VirtualBox/ class=md-nav__link> <span class=md-ellipsis> 31.VirtualBox </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/32.Devops%E7%9B%B8%E5%85%B3%E5%AD%98%E5%82%A8%E5%BA%93/ class=md-nav__link> <span class=md-ellipsis> 32.Devops相关存储库 </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/33.terraform%E6%A6%82%E8%BF%B0/ class=md-nav__link> <span class=md-ellipsis> 33.terraform概述 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> <span class=md-ellipsis> Golang </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Golang </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_1> <label class=md-nav__link for=__nav_6_1 id=__nav_6_1_label tabindex=0> <span class=md-ellipsis> 0.学习线路 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_1_label aria-expanded=false> <label class=md-nav__title for=__nav_6_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Go-Web%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98/ class=md-nav__link> <span class=md-ellipsis> Go Web开发实战 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_2> <label class=md-nav__link for=__nav_6_2 id=__nav_6_2_label tabindex=0> <span class=md-ellipsis> 1.Go基础 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_2_label aria-expanded=false> <label class=md-nav__title for=__nav_6_2> <span class="md-nav__icon md-icon"></span> 1.Go基础 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/1.Go%E5%9F%BA%E7%A1%80/1.%E5%AE%89%E8%A3%85Go/ class=md-nav__link> <span class=md-ellipsis> 安装 Go </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/1.Go%E5%9F%BA%E7%A1%80/2.%E7%AC%AC%E4%B8%80%E4%B8%AAGo%E7%A8%8B%E5%BA%8F/ class=md-nav__link> <span class=md-ellipsis> 第一个Go程序 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/ class=md-nav__link> <span class=md-ellipsis> Go 基础语法 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/1.Go%E5%9F%BA%E7%A1%80/4.Go-Module/ class=md-nav__link> <span class=md-ellipsis> Go Module </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/1.Go%E5%9F%BA%E7%A1%80/5.Go-%E6%A0%87%E5%87%86%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84/ class=md-nav__link> <span class=md-ellipsis> Go 标准目录结构 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_3> <label class=md-nav__link for=__nav_6_3 id=__nav_6_3_label tabindex=0> <span class=md-ellipsis> 2.Go-Web基础 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_3_label aria-expanded=false> <label class=md-nav__title for=__nav_6_3> <span class="md-nav__icon md-icon"></span> 2.Go-Web基础 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/2.Go-Web%E5%9F%BA%E7%A1%80/5.%E7%AC%AC%E4%B8%80%E4%B8%AAGo-Web%E7%A8%8B%E5%BA%8F/ class=md-nav__link> <span class=md-ellipsis> 第一个Go Web程序 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/2.Go-Web%E5%9F%BA%E7%A1%80/6.Web%E7%A8%8B%E5%BA%8F%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86%E7%AE%80%E4%BB%8B/ class=md-nav__link> <span class=md-ellipsis> Web程序运行原理简介 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/2.Go-Web%E5%9F%BA%E7%A1%80/7.net-http%E5%8C%85/ class=md-nav__link> <span class=md-ellipsis> net/http包 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/2.Go-Web%E5%9F%BA%E7%A1%80/8.html-template%E5%8C%85/ class=md-nav__link> <span class=md-ellipsis> html/template包 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_4> <label class=md-nav__link for=__nav_6_4 id=__nav_6_4_label tabindex=0> <span class=md-ellipsis> 3.Go-Web请求处理 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_4_label aria-expanded=false> <label class=md-nav__title for=__nav_6_4> <span class="md-nav__icon md-icon"></span> 3.Go-Web请求处理 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/3.Go-Web%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/9.%E7%AE%80%E5%8D%95Web%E6%9C%8D%E5%8A%A1%E5%99%A8/ class=md-nav__link> <span class=md-ellipsis> 简单Web服务器 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/3.Go-Web%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/10.%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82/ class=md-nav__link> <span class=md-ellipsis> 处理请求 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/3.Go-Web%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/11.session%E5%92%8Ccookie/ class=md-nav__link> <span class=md-ellipsis> session和cookie </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_5> <label class=md-nav__link for=__nav_6_5 id=__nav_6_5_label tabindex=0> <span class=md-ellipsis> 4.Go访问数据库 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_5_label aria-expanded=false> <label class=md-nav__title for=__nav_6_5> <span class="md-nav__icon md-icon"></span> 4.Go访问数据库 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/12.Go%E6%93%8D%E4%BD%9CMySQL/ class=md-nav__link> <span class=md-ellipsis> Go操作MySQL </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/13.Go%E6%93%8D%E4%BD%9CRedis/ class=md-nav__link> <span class=md-ellipsis> Go操作Redis </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/14.Go%E6%93%8D%E4%BD%9CMongoDB/ class=md-nav__link> <span class=md-ellipsis> Go操作MongoDB </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/15.Go%E7%9A%84%E5%B8%B8%E8%A7%81ORM%E5%BA%93/ class=md-nav__link> <span class=md-ellipsis> Go的常见ORM库 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/16.Go%E6%93%8D%E4%BD%9CSQLite/ class=md-nav__link> <span class=md-ellipsis> Go操作SQLite </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_6> <label class=md-nav__link for=__nav_6_6 id=__nav_6_6_label tabindex=0> <span class=md-ellipsis> 5.Go高级网络编程 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6_6> <span class="md-nav__icon md-icon"></span> 5.Go高级网络编程 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/5.Go%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/17.Go-Socket%E7%BC%96%E7%A8%8B/ class=md-nav__link> <span class=md-ellipsis> Go Socket编程 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/5.Go%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/18.Go-RPC%E7%BC%96%E7%A8%8B/ class=md-nav__link> <span class=md-ellipsis> Go RPC编程 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/5.Go%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/19.Go-%E5%BE%AE%E6%9C%8D%E5%8A%A1/ class=md-nav__link> <span class=md-ellipsis> Go 微服务 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_7> <label class=md-nav__link for=__nav_6_7 id=__nav_6_7_label tabindex=0> <span class=md-ellipsis> 6.Go文件处理 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_7_label aria-expanded=false> <label class=md-nav__title for=__nav_6_7> <span class="md-nav__icon md-icon"></span> 6.Go文件处理 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/20.%E5%A4%84%E7%90%86%E7%9B%AE%E5%BD%95%E4%B8%8E%E6%96%87%E4%BB%B6/ class=md-nav__link> <span class=md-ellipsis> 处理目录与文件 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/21.%E5%A4%84%E7%90%86XML%E6%96%87%E4%BB%B6/ class=md-nav__link> <span class=md-ellipsis> 处理XML文件 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/22.%E5%A4%84%E7%90%86JSON%E6%96%87%E4%BB%B6/ class=md-nav__link> <span class=md-ellipsis> 处理JSON文件 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/23.%E5%A4%84%E7%90%86CSV%E6%96%87%E4%BB%B6/ class=md-nav__link> <span class=md-ellipsis> 处理CSV文件 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/24.%E5%A4%84%E7%90%86Go%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95/ class=md-nav__link> <span class=md-ellipsis> 处理Go日志记录 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/25.%E5%A4%84%E7%90%86%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 处理正则表达式 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/26.%E5%A4%84%E7%90%86Excel%E6%96%87%E4%BB%B6/ class=md-nav__link> <span class=md-ellipsis> 处理Excel文件 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_8> <label class=md-nav__link for=__nav_6_8 id=__nav_6_8_label tabindex=0> <span class=md-ellipsis> 7.Go并发编程 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_8_label aria-expanded=false> <label class=md-nav__title for=__nav_6_8> <span class="md-nav__icon md-icon"></span> 7.Go并发编程 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/26.%E5%B9%B6%E5%8F%91-%E5%B9%B6%E8%A1%8C/ class=md-nav__link> <span class=md-ellipsis> 并发 并行 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/27.%E8%BF%9B%E7%A8%8B-%E7%BA%BF%E7%A8%8B-%E5%8D%8F%E7%A8%8B/ class=md-nav__link> <span class=md-ellipsis> 进程 线程 协程 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/28.Go%E5%B9%B6%E5%8F%91%E6%A8%A1%E5%9E%8B/ class=md-nav__link> <span class=md-ellipsis> Go并发模型 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/29.goroutine%E5%92%8Cchannel/ class=md-nav__link> <span class=md-ellipsis> goroutine和channel </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/30.sync%E5%AE%9E%E7%8E%B0%E5%B9%B6%E5%8F%91/ class=md-nav__link> <span class=md-ellipsis> sync实现并发 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/31.Go%E5%B9%B6%E5%8F%91%E7%9A%84Web%E5%BA%94%E7%94%A8/ class=md-nav__link> <span class=md-ellipsis> Go并发的Web应用 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_9> <label class=md-nav__link for=__nav_6_9 id=__nav_6_9_label tabindex=0> <span class=md-ellipsis> 8.Go标准库 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_9_label aria-expanded=false> <label class=md-nav__title for=__nav_6_9> <span class="md-nav__icon md-icon"></span> 8.Go标准库 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/32.time/ class=md-nav__link> <span class=md-ellipsis> time </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/33.strings/ class=md-nav__link> <span class=md-ellipsis> strings </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/34.bytes/ class=md-nav__link> <span class=md-ellipsis> bytes </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/35.json/ class=md-nav__link> <span class=md-ellipsis> json </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/36.io-bufio/ class=md-nav__link> <span class=md-ellipsis> io/bufio </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/37.fmt/ class=md-nav__link> <span class=md-ellipsis> fmt </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/38.strconv/ class=md-nav__link> <span class=md-ellipsis> strconv </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/39.regexp/ class=md-nav__link> <span class=md-ellipsis> regexp </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/40.log/ class=md-nav__link> <span class=md-ellipsis> log </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/41.reflect-unsafe/ class=md-nav__link> <span class=md-ellipsis> reflect/unsafe </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/42.os-path-filepath/ class=md-nav__link> <span class=md-ellipsis> os/path/filepath </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/43.unicode/ class=md-nav__link> <span class=md-ellipsis> unicode </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/44.flag/ class=md-nav__link> <span class=md-ellipsis> flag </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/45.net-url/ class=md-nav__link> <span class=md-ellipsis> net/url </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/46.net-http/ class=md-nav__link> <span class=md-ellipsis> net/http </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/47.sort/ class=md-nav__link> <span class=md-ellipsis> sort </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/48.errors/ class=md-nav__link> <span class=md-ellipsis> errors </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_10> <label class=md-nav__link for=__nav_6_10 id=__nav_6_10_label tabindex=0> <span class=md-ellipsis> 9.Go三方库 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_10_label aria-expanded=false> <label class=md-nav__title for=__nav_6_10> <span class="md-nav__icon md-icon"></span> 9.Go三方库 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/0.%E5%BC%80%E6%BA%90%E8%87%AA%E5%B7%B1%E7%9A%84Go%E5%BA%93/ class=md-nav__link> <span class=md-ellipsis> 开源自己的Go库 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/1.cobra/ class=md-nav__link> <span class=md-ellipsis> Cobra </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/2.viper/ class=md-nav__link> <span class=md-ellipsis> Viper </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/3.Zap/ class=md-nav__link> <span class=md-ellipsis> Zap </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/4.mahonia/ class=md-nav__link> <span class=md-ellipsis> mahonia </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/5.ssh/ class=md-nav__link> <span class=md-ellipsis> ssh </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/6.fsnotify/ class=md-nav__link> <span class=md-ellipsis> fsnotify </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/7.yaml/ class=md-nav__link> <span class=md-ellipsis> yaml </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/8.tail/ class=md-nav__link> <span class=md-ellipsis> tail </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/9.gRPC/ class=md-nav__link> <span class=md-ellipsis> gRPC </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/10.gopsutil/ class=md-nav__link> <span class=md-ellipsis> gopsutil </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/11.go-awesome/ class=md-nav__link> <span class=md-ellipsis> go-awesome </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/12.dmidecode/ class=md-nav__link> <span class=md-ellipsis> dmidecode </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/13.toml/ class=md-nav__link> <span class=md-ellipsis> toml </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_11> <label class=md-nav__link for=__nav_6_11 id=__nav_6_11_label tabindex=0> <span class=md-ellipsis> 10.Go-RESTful-API接口开发 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_11_label aria-expanded=false> <label class=md-nav__title for=__nav_6_11> <span class="md-nav__icon md-icon"></span> 10.Go-RESTful-API接口开发 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/10.Go-RESTful-API%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91/1.%E4%BB%80%E4%B9%88%E6%98%AFRESTful-API/ class=md-nav__link> <span class=md-ellipsis> 1.什么是RESTful-API </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/10.Go-RESTful-API%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91/2.GORMv2/ class=md-nav__link> <span class=md-ellipsis> 2.GORMv2 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/10.Go-RESTful-API%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91/3.Gin%E6%A1%86%E6%9E%B6%E7%9A%84%E4%BD%BF%E7%94%A8/ class=md-nav__link> <span class=md-ellipsis> 3.Gin 框架的使用 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/10.Go-RESTful-API%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91/4.%E5%9B%BE%E4%B9%A6%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-%E5%89%8D%E7%AB%AF/ class=md-nav__link> <span class=md-ellipsis> 4.图书管理系统-前端 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/10.Go-RESTful-API%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91/5.%E5%9B%BE%E4%B9%A6%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-%E5%90%8E%E7%AB%AF/ class=md-nav__link> <span class=md-ellipsis> 5.图书管理系统-后端 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/10.Go-RESTful-API%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91/6.Gin%2BVue%E5%85%A5%E9%97%A8%E9%A1%B9%E7%9B%AE/ class=md-nav__link> <span class=md-ellipsis> 6.Gin+Vue入门项目 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_12> <label class=md-nav__link for=__nav_6_12 id=__nav_6_12_label tabindex=0> <span class=md-ellipsis> 11.Web前端 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_12_label aria-expanded=false> <label class=md-nav__title for=__nav_6_12> <span class="md-nav__icon md-icon"></span> 11.Web前端 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/11.Web%E5%89%8D%E7%AB%AF/1.HTML%E6%A0%87%E8%AE%B0%E8%AF%AD%E8%A8%80/ class=md-nav__link> <span class=md-ellipsis> 1.HTML标记语言 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/11.Web%E5%89%8D%E7%AB%AF/2.CSS%E6%A0%B7%E5%BC%8F%E8%AF%AD%E8%A8%80/ class=md-nav__link> <span class=md-ellipsis> 2.CSS样式语言 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/11.Web%E5%89%8D%E7%AB%AF/3.JavaScript%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%84%9A%E6%9C%AC%E8%AF%AD%E8%A8%80/ class=md-nav__link> <span class=md-ellipsis> 3.JavaScript客户端脚本语言 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/11.Web%E5%89%8D%E7%AB%AF/4.JavaScript%E5%BA%93-JQuery/ class=md-nav__link> <span class=md-ellipsis> 4.JavaScript库:JQuery </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_13> <label class=md-nav__link for=__nav_6_13 id=__nav_6_13_label tabindex=0> <span class=md-ellipsis> 12.Vue前端开发 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_13_label aria-expanded=false> <label class=md-nav__title for=__nav_6_13> <span class="md-nav__icon md-icon"></span> 12.Vue前端开发 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/1.%E8%AE%A4%E8%AF%86Vue.js/ class=md-nav__link> <span class=md-ellipsis> 1.认识Vue.js.md </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/2.Vue%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4/ class=md-nav__link> <span class=md-ellipsis> 2.Vue常用指令 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/3.Vue%E5%B8%B8%E7%94%A8%E5%B1%9E%E6%80%A7/ class=md-nav__link> <span class=md-ellipsis> 3.Vue常用属性 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/4.Vue%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4%E4%B9%8B%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/ class=md-nav__link> <span class=md-ellipsis> 4.Vue常用指令之流程控制 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/5.Vue%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4%E4%B9%8B%E6%95%B0%E6%8D%AE%E5%8F%8C%E5%90%91%E7%BB%91%E5%AE%9A/ class=md-nav__link> <span class=md-ellipsis> 5.Vue常用指令之数据双向绑定 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/6.Vue%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E9%92%A9%E5%AD%90/ class=md-nav__link> <span class=md-ellipsis> 6.Vue生命周期钩子 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/7.VueCli%E8%84%9A%E6%89%8B%E6%9E%B6/ class=md-nav__link> <span class=md-ellipsis> 7.VueCli脚手架 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/8.Vue%E7%BB%84%E4%BB%B6/ class=md-nav__link> <span class=md-ellipsis> 8.Vue组件 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/9.Vue%E8%B7%AF%E7%94%B1/ class=md-nav__link> <span class=md-ellipsis> 9.Vue路由 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/10.Vuex%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 10.Vuex状态管理 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/11.%E5%89%8D%E5%90%8E%E7%AB%AF%E6%95%B0%E6%8D%AE%E4%BA%A4%E4%BA%92-Axios/ class=md-nav__link> <span class=md-ellipsis> 11.前后端数据交互 Axios </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/12.Element-Plus/ class=md-nav__link> <span class=md-ellipsis> 12.Element Plus </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_14> <label class=md-nav__link for=__nav_6_14 id=__nav_6_14_label tabindex=0> <span class=md-ellipsis> 13.K8s管理系统项目实战 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_14_label aria-expanded=false> <label class=md-nav__title for=__nav_6_14> <span class="md-nav__icon md-icon"></span> 13.K8s管理系统项目实战 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/13.K8s%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/1.K8s%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/ class=md-nav__link> <span class=md-ellipsis> K8s 管理系统-后端开发 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/13.K8s%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/2.K8s%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/ class=md-nav__link> <span class=md-ellipsis> K8s管理系统-前端开发 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_15> <label class=md-nav__link for=__nav_6_15 id=__nav_6_15_label tabindex=0> <span class=md-ellipsis> 14.Go开发的三方平台 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_15_label aria-expanded=false> <label class=md-nav__title for=__nav_6_15> <span class="md-nav__icon md-icon"></span> 14.Go开发的三方平台 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/14.Go%E5%BC%80%E5%8F%91%E7%9A%84%E4%B8%89%E6%96%B9%E5%B9%B3%E5%8F%B0/0.%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%BF%E7%94%A8Go%E5%81%9A%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/ class=md-nav__link> <span class=md-ellipsis> 为什么使用Go做后端开发 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/14.Go%E5%BC%80%E5%8F%91%E7%9A%84%E4%B8%89%E6%96%B9%E5%B9%B3%E5%8F%B0/1.TBak-System%E5%A4%87%E4%BB%BD%E5%B9%B3%E5%8F%B0/ class=md-nav__link> <span class=md-ellipsis> TBak System备份平台 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/14.Go%E5%BC%80%E5%8F%91%E7%9A%84%E4%B8%89%E6%96%B9%E5%B9%B3%E5%8F%B0/2.kubernetes%E5%AE%B9%E5%99%A8%E4%BA%91%E7%AE%A1%E7%90%86%E5%B9%B3%E5%8F%B0/ class=md-nav__link> <span class=md-ellipsis> kubernetes容器云管理平台 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/14.Go%E5%BC%80%E5%8F%91%E7%9A%84%E4%B8%89%E6%96%B9%E5%B9%B3%E5%8F%B0/3.Go%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/ class=md-nav__link> <span class=md-ellipsis> Go命令行工具 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/14.Go%E5%BC%80%E5%8F%91%E7%9A%84%E4%B8%89%E6%96%B9%E5%B9%B3%E5%8F%B0/4.%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/ class=md-nav__link> <span class=md-ellipsis> nps </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/14.Go%E5%BC%80%E5%8F%91%E7%9A%84%E4%B8%89%E6%96%B9%E5%B9%B3%E5%8F%B0/5.go-web%E9%A1%B9%E7%9B%AE/ class=md-nav__link> <span class=md-ellipsis> go-web项目 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/14.Go%E5%BC%80%E5%8F%91%E7%9A%84%E4%B8%89%E6%96%B9%E5%B9%B3%E5%8F%B0/6.go-%E4%B8%89%E6%96%B9%E5%B7%A5%E5%85%B7%E7%AE%80%E5%8D%95%E5%85%A5%E9%97%A8/ class=md-nav__link> <span class=md-ellipsis> go-三方工具简单入门 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_16> <label class=md-nav__link for=__nav_6_16 id=__nav_6_16_label tabindex=0> <span class=md-ellipsis> 15.容器化Go </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_16_label aria-expanded=false> <label class=md-nav__title for=__nav_6_16> <span class="md-nav__icon md-icon"></span> 15.容器化Go </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/15.%E5%AE%B9%E5%99%A8%E5%8C%96Go/0.%E6%9E%84%E5%BB%BAGo%E5%BA%94%E7%94%A8docker%E9%95%9C%E5%83%8F/ class=md-nav__link> <span class=md-ellipsis> 构建Go应用docker镜像 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex=0> <span class=md-ellipsis> Python </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Python </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_1> <label class=md-nav__link for=__nav_7_1 id=__nav_7_1_label tabindex=0> <span class=md-ellipsis> 0.学习线路 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_1_label aria-expanded=false> <label class=md-nav__title for=__nav_7_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Pythjon-auto-ops/ class=md-nav__link> <span class=md-ellipsis> Python Linux管理与自动化运维 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_2> <label class=md-nav__link for=__nav_7_2 id=__nav_7_2_label tabindex=0> <span class=md-ellipsis> 1.Python基础篇 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_2_label aria-expanded=false> <label class=md-nav__title for=__nav_7_2> <span class="md-nav__icon md-icon"></span> 1.Python基础篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/1.Python%E7%94%9F%E6%80%81%E5%B7%A5%E5%85%B7/ class=md-nav__link> <span class=md-ellipsis> 1.Python 生态工具 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/2.Python%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E5%AE%89%E8%A3%85/ class=md-nav__link> <span class=md-ellipsis> 2.Python 第三方库安装 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/3.Python%E5%B7%A5%E4%BD%9C%E7%8E%AF%E5%A2%83%E7%AE%A1%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 3.Python 工作环境管理 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/4.Python%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/ class=md-nav__link> <span class=md-ellipsis> 4.Python 开发环境 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/5.Python%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/ class=md-nav__link> <span class=md-ellipsis> 5.Python 数据结构 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/6.Python%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84/ class=md-nav__link> <span class=md-ellipsis> 6.Python 项目的组织结构 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/7.Python%E4%BB%A3%E7%A0%81%E8%A7%84%E8%8C%83/ class=md-nav__link> <span class=md-ellipsis> 7.Python 代码规范 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/8.Python%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/ class=md-nav__link> <span class=md-ellipsis> 8.Python 基础知识 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/9.Python%E5%AD%97%E7%AC%A6%E4%B8%B2/ class=md-nav__link> <span class=md-ellipsis> 9.Python 字符串 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/10.Python%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/ class=md-nav__link> <span class=md-ellipsis> 10.Python 数据类型 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/11.Python%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C/ class=md-nav__link> <span class=md-ellipsis> 11.Python 文件操作 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/12.Python%E5%87%BD%E6%95%B0/ class=md-nav__link> <span class=md-ellipsis> 12.Python 函数 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/13.Python%E5%B8%B8%E7%94%A8%E5%86%85%E5%BB%BA%E5%87%BD%E6%95%B0/ class=md-nav__link> <span class=md-ellipsis> 13.Python 常用内建函数 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/14.Python%E7%B1%BB/ class=md-nav__link> <span class=md-ellipsis> 14.Python 类 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/15.Python%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 15.Python 异常处理 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/16.Python%E6%A8%A1%E5%9D%97%E4%B8%8E%E5%8C%85/ class=md-nav__link> <span class=md-ellipsis> 16.Python 模块与包 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/17.Python%E6%A0%87%E5%87%86%E5%BA%93/ class=md-nav__link> <span class=md-ellipsis> 17.Python 标准库 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/18.Python%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 18.Python 正则表达式 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/19.Python%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BC%96%E7%A8%8B/ class=md-nav__link> <span class=md-ellipsis> 19.Python 数据库编程 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/20.Python%E6%89%B9%E9%87%8F%E7%AE%A1%E7%90%86%E4%B8%BB%E6%9C%BA/ class=md-nav__link> <span class=md-ellipsis> 20.Python 批量管理主机 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/21.Python%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%9A%E8%BF%9B%E7%A8%8B%E5%8D%8F%E7%A8%8B/ class=md-nav__link> <span class=md-ellipsis> 21.Python 多线程多进程协程 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_3> <label class=md-nav__link for=__nav_7_3 id=__nav_7_3_label tabindex=0> <span class=md-ellipsis> 2.Python运维开发 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_3_label aria-expanded=false> <label class=md-nav__title for=__nav_7_3> <span class="md-nav__icon md-icon"></span> 2.Python运维开发 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/1.%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/ class=md-nav__link> <span class=md-ellipsis> 1.命令行工具 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/2.%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 2.文本处理 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/3.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 3.Linux 系统管理 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/4.%E7%9B%91%E6%8E%A7Linux/ class=md-nav__link> <span class=md-ellipsis> 4.监控 Linux </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/5.%E6%96%87%E6%A1%A3%E4%B8%8E%E6%8A%A5%E5%91%8A/ class=md-nav__link> <span class=md-ellipsis> 5.文档与报告 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/6.%E7%BD%91%E7%BB%9C/ class=md-nav__link> <span class=md-ellipsis> 6.网络 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/7.%E8%87%AA%E5%8A%A8%E5%8C%96%E7%AE%A1%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 7.自动化管理 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/8.%E5%B8%B8%E7%94%A8%E6%A8%A1%E5%9D%97/ class=md-nav__link> <span class=md-ellipsis> 8.常用模块 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/9.Python%E6%89%93%E9%80%A0MySQL%E4%B8%93%E5%AE%B6%E7%B3%BB%E7%BB%9F/ class=md-nav__link> <span class=md-ellipsis> 9.Python打造MySQL专家系统 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/10.%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%BC%80%E5%8F%91/ class=md-nav__link> <span class=md-ellipsis> 10.自动化运维系统的开发 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/11.%E5%8D%8E%E4%B8%BA%E4%BA%91Python%E6%BC%94%E7%A4%BA%E4%BB%A3%E7%A0%81/ class=md-nav__link> <span class=md-ellipsis> 11.华为云Python演示代码 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/12.%E5%8D%8E%E4%B8%BA%E4%BA%91Go%E6%BC%94%E7%A4%BA%E4%BB%A3%E7%A0%81/ class=md-nav__link> <span class=md-ellipsis> 12.华为云Go演示代码 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/%E9%99%84-%E8%BF%90%E7%BB%B4%E7%9B%B8%E5%85%B3%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE/ class=md-nav__link> <span class=md-ellipsis> 附-运维相关开源项目 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/%E9%99%84-awesome-python-cn/ class=md-nav__link> <span class=md-ellipsis> 附-awesome-python-cn </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/%E9%99%84-CMDB/ class=md-nav__link> <span class=md-ellipsis> 附-CMDB </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/%E9%99%84-Django-web%E5%BC%80%E5%8F%91/ class=md-nav__link> <span class=md-ellipsis> 附-Django-web开发 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_4> <label class=md-nav__link for=__nav_7_4 id=__nav_7_4_label tabindex=0> <span class=md-ellipsis> 3.Python测试开发 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_4_label aria-expanded=false> <label class=md-nav__title for=__nav_7_4> <span class="md-nav__icon md-icon"></span> 3.Python测试开发 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/1.Python2%E4%B8%8EPython3%E5%8C%BA%E5%88%AB/ class=md-nav__link> <span class=md-ellipsis> 1.Python2 与 Python3 区别 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/2.Windows%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85Python/ class=md-nav__link> <span class=md-ellipsis> 2.Windows环境安装Python </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/3.Linux%E5%A4%9A%E7%89%88%E6%9C%ACPython%E5%AE%89%E8%A3%85/ class=md-nav__link> <span class=md-ellipsis> 3.Linux多版本Python安装 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/4.Python%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85/ class=md-nav__link> <span class=md-ellipsis> 4.Python虚拟环境安装 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/5.Pycharm%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8/ class=md-nav__link> <span class=md-ellipsis> 5.Pycharm安装与使用 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/6.Python%E9%97%B4%E6%8E%A5%E5%AE%9A%E4%B9%89%E5%B8%B8%E9%87%8F/ class=md-nav__link> <span class=md-ellipsis> 6.Python间接定义常量 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/7.Python%E8%BF%90%E7%AE%97%E7%AC%A6%E4%B8%8E%E8%A1%A8%E8%BE%BE%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 7.Python运算符与表达式 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/8.%E9%80%BB%E8%BE%91%E6%8E%A7%E5%88%B6%E8%AF%AD%E5%8F%A5/ class=md-nav__link> <span class=md-ellipsis> 8.逻辑控制语句 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/9.%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%BB%8B%E7%BB%8D/ class=md-nav__link> <span class=md-ellipsis> 9.数据结构 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/10.%E5%87%BD%E6%95%B0%E4%BB%8B%E7%BB%8D/ class=md-nav__link> <span class=md-ellipsis> 10.函数介绍 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/11.%E7%B1%BB%E4%B8%8E%E5%AF%B9%E8%B1%A1/ class=md-nav__link> <span class=md-ellipsis> 11.类与对象 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/12.%E6%89%93%E5%8C%85%E4%B8%8E%E5%8F%91%E5%B8%83/ class=md-nav__link> <span class=md-ellipsis> 12.打包与发布 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/13.%E5%BC%82%E5%B8%B8%E6%8D%95%E8%8E%B7%E4%B8%8E%E5%A4%84%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 13.异常捕获与处理 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/14.%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/ class=md-nav__link> <span class=md-ellipsis> 14.并发编程 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/15.%E6%A0%87%E5%87%86%E5%BA%93%E5%92%8C%E4%B8%89%E6%96%B9%E5%BA%93/ class=md-nav__link> <span class=md-ellipsis> 15.标准库和三方库 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/16.vue-cli%E8%84%9A%E6%89%8B%E6%9E%B6/ class=md-nav__link> <span class=md-ellipsis> 16.vue-cli脚手架 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/17.%E6%A1%88%E4%BE%8B%E5%AE%9E%E8%B7%B5-%E4%BB%BB%E5%8A%A1%E5%88%97%E8%A1%A8/ class=md-nav__link> <span class=md-ellipsis> 17.案例实践-任务列表 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_5> <label class=md-nav__link for=__nav_7_5 id=__nav_7_5_label tabindex=0> <span class=md-ellipsis> 4.Flask-Web全栈开发 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_5_label aria-expanded=false> <label class=md-nav__title for=__nav_7_5> <span class="md-nav__icon md-icon"></span> 4.Flask-Web全栈开发 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/1.Flask%E5%89%8D%E5%A5%8F/ class=md-nav__link> <span class=md-ellipsis> 1.Flask 前缀 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/2.%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AE/ class=md-nav__link> <span class=md-ellipsis> 2.项目配置 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/3.URL%E4%B8%8E%E8%A7%86%E5%9B%BE/ class=md-nav__link> <span class=md-ellipsis> 3.URL与视图 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/4.Jinja2%E6%A8%A1%E6%9D%BF/ class=md-nav__link> <span class=md-ellipsis> 4.Jinja2模板 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/5.%E6%95%B0%E6%8D%AE%E5%BA%93/ class=md-nav__link> <span class=md-ellipsis> 5.数据库 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/6.%E8%A1%A8%E5%8D%95/ class=md-nav__link> <span class=md-ellipsis> 6.表单 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/7.Flask%E8%BF%9B%E9%98%B6/ class=md-nav__link> <span class=md-ellipsis> 7.Flask进阶 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/8.%E7%BC%93%E5%AD%98%E7%B3%BB%E7%BB%9F/ class=md-nav__link> <span class=md-ellipsis> 8.缓存系统 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/9.Flask%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/ class=md-nav__link> <span class=md-ellipsis> 9.Flask 项目实战 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/10.WebSock%E5%AE%9E%E6%88%98/ class=md-nav__link> <span class=md-ellipsis> 10.WebSock实战 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/11.Flask%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B/ class=md-nav__link> <span class=md-ellipsis> 11.Flask异步编程 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/%E9%99%84-%E4%BD%BF%E7%94%A8Pytest%E6%B5%8B%E8%AF%95Flask/ class=md-nav__link> <span class=md-ellipsis> 附-使用 Pytest 测试 Flask </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/%E9%99%84-%E5%9B%BE%E4%B9%A6%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/ class=md-nav__link> <span class=md-ellipsis> 附-图书管理系统 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/%E9%99%84-Flask%E5%B8%B8%E7%94%A8%E6%89%A9%E5%B1%95/ class=md-nav__link> <span class=md-ellipsis> 附-Flask常用扩展 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/%E9%99%84-Flask%E5%92%8CRedis%E9%98%9F%E5%88%97%E7%9A%84%E5%BC%82%E6%AD%A5%E4%BB%BB%E5%8A%A1/ class=md-nav__link> <span class=md-ellipsis> 附-Flask和Redis队列的异步任务 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/%E9%99%84-Flask%E5%92%8CVue.js%E5%BC%80%E5%8F%91%E5%8D%95%E9%A1%B5%E5%BA%94%E7%94%A8/ class=md-nav__link> <span class=md-ellipsis> 附-Flask 和 Vue.js 开发单页应用 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/%E9%99%84-Flask%E5%AE%B9%E5%99%A8%E5%8C%96%E5%AE%9E%E8%B7%B5/ class=md-nav__link> <span class=md-ellipsis> 附-Flask容器化实践 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/%E9%99%84-Flask%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B/ class=md-nav__link> <span class=md-ellipsis> 附-Flask数据模型 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_6> <label class=md-nav__link for=__nav_7_6 id=__nav_7_6_label tabindex=0> <span class=md-ellipsis> 5.DevOps和自动化运维实践 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_6_label aria-expanded=false> <label class=md-nav__title for=__nav_7_6> <span class="md-nav__icon md-icon"></span> 5.DevOps和自动化运维实践 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python/5.DevOps%E5%92%8C%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%AE%9E%E8%B7%B5/1.Devops%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E7%9A%84%E6%84%8F%E4%B9%89/ class=md-nav__link> <span class=md-ellipsis> 1.Devops 与自动化运维的意义 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/5.DevOps%E5%92%8C%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%AE%9E%E8%B7%B5/2.Shell%E8%84%9A%E6%9C%AC%E5%9C%A8Devops%E4%B8%8B%E7%9A%84%E5%BA%94%E7%94%A8/ class=md-nav__link> <span class=md-ellipsis> 2.Shell脚本在Devops下的应用 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/5.DevOps%E5%92%8C%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%AE%9E%E8%B7%B5/3.%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E4%B8%8B%E7%9A%84Shell%E8%84%9A%E6%9C%AC/ class=md-nav__link> <span class=md-ellipsis> 3.生产环境下的 Shell 脚本 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/5.DevOps%E5%92%8C%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%AE%9E%E8%B7%B5/4.%E5%B7%A5%E4%BD%9C%E4%B8%AD%E7%9A%84Python%E8%84%9A%E6%9C%AC%E5%88%86%E4%BA%AB/ class=md-nav__link> <span class=md-ellipsis> 4.工作中的 Python 脚本分享 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_7> <label class=md-nav__link for=__nav_7_7 id=__nav_7_7_label tabindex=0> <span class=md-ellipsis> 6.CMDB项目实战 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7_7> <span class="md-nav__icon md-icon"></span> 6.CMDB项目实战 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python/6.CMDB%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/0.DRF%E5%89%8D%E5%A5%8F/ class=md-nav__link> <span class=md-ellipsis> 0.DRF前奏 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/6.CMDB%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/1.DRF%E5%85%A5%E9%97%A8/ class=md-nav__link> <span class=md-ellipsis> 1.DRF入门 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/6.CMDB%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/2.DRF%E8%BF%9B%E9%98%B6/ class=md-nav__link> <span class=md-ellipsis> 2.DRF进阶 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/6.CMDB%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/3.CMDB%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/ class=md-nav__link> <span class=md-ellipsis> 3.CMDB后端开发 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/6.CMDB%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/4.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91-%E4%B8%8A/ class=md-nav__link> <span class=md-ellipsis> 4.Vue前端开发-上 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/6.CMDB%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/5.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91-%E4%B8%8B/ class=md-nav__link> <span class=md-ellipsis> 5.Vue前端开发-下 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/6.CMDB%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/6.Element-Plus%E5%89%8D%E7%AB%AF%E7%BB%84%E4%BB%B6%E5%BA%93/ class=md-nav__link> <span class=md-ellipsis> 6.Element-Plus前端组件库 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/6.CMDB%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/7.CMDB%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91-%E4%B8%8A/ class=md-nav__link> <span class=md-ellipsis> 7.CMDB前端开发-上 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/6.CMDB%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/8.CMDB%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91-%E4%B8%8B/ class=md-nav__link> <span class=md-ellipsis> 8.CMDB前端开发-下 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_8> <label class=md-nav__link for=__nav_7_8 id=__nav_7_8_label tabindex=0> <span class=md-ellipsis> 7.Python网络编程攻略 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_8_label aria-expanded=false> <label class=md-nav__title for=__nav_7_8> <span class="md-nav__icon md-icon"></span> 7.Python网络编程攻略 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python/7.Python%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E6%94%BB%E7%95%A5/1.IPv4%E5%92%8C%E7%AE%80%E5%8D%95%E7%9A%84%E5%AE%A2%E6%88%B7%E7%AB%AF-%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B/ class=md-nav__link> <span class=md-ellipsis> 1.IPv4 和简单的客户端-服务器编程 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/7.Python%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E6%94%BB%E7%95%A5/2.%E4%BD%BF%E7%94%A8%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8%E5%A5%97%E6%8E%A5%E5%AD%97-IO%E6%8F%90%E5%8D%87%E6%80%A7%E8%83%BD/ class=md-nav__link> <span class=md-ellipsis> 2.使用多路复用套接字-IO 提升性能 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/7.Python%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E6%94%BB%E7%95%A5/3.IPv6-Unix%E5%9F%9F%E5%A5%97%E6%8E%A5%E5%AD%97%E5%92%8C%E7%BD%91%E7%BB%9C%E6%8E%A5%E5%8F%A3/ class=md-nav__link> <span class=md-ellipsis> 3.IPv6-Unix 域套接字和网络接口 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_9> <label class=md-nav__link for=__nav_7_9 id=__nav_7_9_label tabindex=0> <span class=md-ellipsis> 8.Python自动化运维实战 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_9_label aria-expanded=false> <label class=md-nav__title for=__nav_7_9> <span class="md-nav__icon md-icon"></span> 8.Python自动化运维实战 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python/8.Python%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%AE%9E%E6%88%98/1.%E6%90%AD%E5%BB%BAPython%E7%8E%AF%E5%A2%83/ class=md-nav__link> <span class=md-ellipsis> 1.搭建 Python 环境 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/8.Python%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%AE%9E%E6%88%98/2.%E5%B8%B8%E7%94%A8%E7%9A%84%E8%87%AA%E5%8A%A8%E5%8C%96%E5%BA%93/ class=md-nav__link> <span class=md-ellipsis> 2.常用的自动化库 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/8.Python%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%AE%9E%E6%88%98/3.%E6%90%AD%E5%BB%BA%E7%BD%91%E7%BB%9C%E5%AE%9E%E9%AA%8C%E5%AE%A4%E7%8E%AF%E5%A2%83/ class=md-nav__link> <span class=md-ellipsis> 3.搭建网络实验室环境 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8> <label class=md-nav__link for=__nav_8 id=__nav_8_label tabindex=0> <span class=md-ellipsis> Openstack </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_8_label aria-expanded=false> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> Openstack </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8_1> <label class=md-nav__link for=__nav_8_1 id=__nav_8_1_label tabindex=0> <span class=md-ellipsis> 0.学习线路 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_8_1_label aria-expanded=false> <label class=md-nav__title for=__nav_8_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Openstack/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.OpenStack/ class=md-nav__link> <span class=md-ellipsis> 基于 OpenStack 组件开发 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8_2> <label class=md-nav__link for=__nav_8_2 id=__nav_8_2_label tabindex=0> <span class=md-ellipsis> 1.OpenStack工程师工作 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_8_2_label aria-expanded=false> <label class=md-nav__title for=__nav_8_2> <span class="md-nav__icon md-icon"></span> 1.OpenStack工程师工作 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Openstack/1.OpenStack%E5%B7%A5%E7%A8%8B%E5%B8%88%E5%B7%A5%E4%BD%9C/1.Horizon%E7%95%8C%E9%9D%A2%E5%B7%A5%E7%A8%8B%E5%B8%88%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%86%85%E5%AE%B9/ class=md-nav__link> <span class=md-ellipsis> 1.Horizon 界面工程师的工作内容 </span> </a> </li> <li class=md-nav__item> <a href=../../../Openstack/1.OpenStack%E5%B7%A5%E7%A8%8B%E5%B8%88%E5%B7%A5%E4%BD%9C/2.Neutron%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E5%B8%88%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%86%85%E5%AE%B9/ class=md-nav__link> <span class=md-ellipsis> 2.Neutron 网络工程师的工作内容 </span> </a> </li> <li class=md-nav__item> <a href=../../../Openstack/1.OpenStack%E5%B7%A5%E7%A8%8B%E5%B8%88%E5%B7%A5%E4%BD%9C/3.Nova%E8%B5%84%E6%B7%B1%E5%B7%A5%E7%A8%8B%E5%B8%88%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%86%85%E5%AE%B9/ class=md-nav__link> <span class=md-ellipsis> 3.Nova 资深工程师的工作内容 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8_3> <label class=md-nav__link for=__nav_8_3 id=__nav_8_3_label tabindex=0> <span class=md-ellipsis> 2.开发环境的搭建 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_8_3_label aria-expanded=false> <label class=md-nav__title for=__nav_8_3> <span class="md-nav__icon md-icon"></span> 2.开发环境的搭建 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Openstack/2.%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/1.Windows%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/ class=md-nav__link> <span class=md-ellipsis> 1.Windows 开发环境的搭建 </span> </a> </li> <li class=md-nav__item> <a href=../../../Openstack/2.%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/2.Linux%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/ class=md-nav__link> <span class=md-ellipsis> 2.Linux 开发环境的搭建 </span> </a> </li> <li class=md-nav__item> <a href=../../../Openstack/2.%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/3.Launchpad%E8%B4%A6%E5%8F%B7/ class=md-nav__link> <span class=md-ellipsis> 3.Launchpad 账号 </span> </a> </li> <li class=md-nav__item> <a href=../../../Openstack/2.%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/4.Git%E7%9A%84%E4%BD%BF%E7%94%A8/ class=md-nav__link> <span class=md-ellipsis> 4.Git 的使用 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8_4> <label class=md-nav__link for=__nav_8_4 id=__nav_8_4_label tabindex=0> <span class=md-ellipsis> 3.Python模块 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_8_4_label aria-expanded=false> <label class=md-nav__title for=__nav_8_4> <span class="md-nav__icon md-icon"></span> 3.Python模块 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Openstack/3.Python%E6%A8%A1%E5%9D%97/0.Python%E5%8C%85%E7%9A%84%E6%9E%84%E5%BB%BA%E4%B8%8E%E5%88%86%E5%8F%91/ class=md-nav__link> <span class=md-ellipsis> 0.Python 包的构建与分发 </span> </a> </li> <li class=md-nav__item> <a href=../../../Openstack/3.Python%E6%A8%A1%E5%9D%97/1.SQLAlchemy/ class=md-nav__link> <span class=md-ellipsis> 1.SQLAlchemy </span> </a> </li> <li class=md-nav__item> <a href=../../../Openstack/3.Python%E6%A8%A1%E5%9D%97/2.logging/ class=md-nav__link> <span class=md-ellipsis> 2.logging </span> </a> </li> <li class=md-nav__item> <a href=../../../Openstack/3.Python%E6%A8%A1%E5%9D%97/3.cliff/ class=md-nav__link> <span class=md-ellipsis> 3.cliff </span> </a> </li> <li class=md-nav__item> <a href=../../../Openstack/3.Python%E6%A8%A1%E5%9D%97/4.Eventlet/ class=md-nav__link> <span class=md-ellipsis> 4.Eventlet </span> </a> </li> <li class=md-nav__item> <a href=../../../Openstack/3.Python%E6%A8%A1%E5%9D%97/5.WSGI/ class=md-nav__link> <span class=md-ellipsis> 5.WSGI </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_9> <label class=md-nav__link for=__nav_9 id=__nav_9_label tabindex=0> <span class=md-ellipsis> Python-vs-Go </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_9_label aria-expanded=false> <label class=md-nav__title for=__nav_9> <span class="md-nav__icon md-icon"></span> Python-vs-Go </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_9_1> <label class=md-nav__link for=__nav_9_1 id=__nav_9_1_label tabindex=0> <span class=md-ellipsis> 0.学习线路 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_9_1_label aria-expanded=false> <label class=md-nav__title for=__nav_9_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python-vs-Go/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Python-vs-Go/ class=md-nav__link> <span class=md-ellipsis> Python-vs-Go </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_9_2> <label class=md-nav__link for=__nav_9_2 id=__nav_9_2_label tabindex=0> <span class=md-ellipsis> 1.对比 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_9_2_label aria-expanded=false> <label class=md-nav__title for=__nav_9_2> <span class="md-nav__icon md-icon"></span> 1.对比 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/1.Hello-World/ class=md-nav__link> <span class=md-ellipsis> Hello-World </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/2.Print/ class=md-nav__link> <span class=md-ellipsis> Print </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/3.%E6%B3%A8%E9%87%8A/ class=md-nav__link> <span class=md-ellipsis> 注释 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/4.%E5%A4%9A%E8%A1%8C%E5%AD%97%E7%AC%A6%E4%B8%B2/ class=md-nav__link> <span class=md-ellipsis> 多行字符串 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/5.Lists/ class=md-nav__link> <span class=md-ellipsis> Lists </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/6.Map/ class=md-nav__link> <span class=md-ellipsis> Map </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/7.Booleans/ class=md-nav__link> <span class=md-ellipsis> Booleans </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/8.Forloop/ class=md-nav__link> <span class=md-ellipsis> Forloop </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/9.Range/ class=md-nav__link> <span class=md-ellipsis> Range </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/10.Switch/ class=md-nav__link> <span class=md-ellipsis> Switch </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/11.%E5%8F%AF%E5%8F%98%E5%8F%82%E6%95%B0%E5%87%BD%E6%95%B0/ class=md-nav__link> <span class=md-ellipsis> 可变参数函数 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/12.%E6%97%B6%E9%97%B4%E8%AE%A1%E7%AE%97/ class=md-nav__link> <span class=md-ellipsis> 时间计算 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/13.%E5%87%BD%E6%95%B0%E7%9A%84%E9%97%AD%E5%8C%85/ class=md-nav__link> <span class=md-ellipsis> 函数的闭包 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/14.%E9%80%80%E5%87%BA%E5%A4%84%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 退出处理 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/15.%E5%BC%82%E5%B8%B8%E6%8D%95%E8%8E%B7/ class=md-nav__link> <span class=md-ellipsis> 异常捕获 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/16.%E5%8F%AF%E5%8F%98%E9%A1%B9/ class=md-nav__link> <span class=md-ellipsis> 可变项 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/17.%E7%B1%BB/ class=md-nav__link> <span class=md-ellipsis> 类 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/18.%E6%96%B9%E6%B3%95/ class=md-nav__link> <span class=md-ellipsis> 方法 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/19.%E5%B9%B6%E5%8F%91/ class=md-nav__link> <span class=md-ellipsis> 并发 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/20.Args/ class=md-nav__link> <span class=md-ellipsis> Args </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/21.%E5%AF%BC%E5%85%A5%E6%A8%A1%E5%9D%97%E5%88%AB%E5%90%8D/ class=md-nav__link> <span class=md-ellipsis> 导入模块别名 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/22.%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%A0%BC%E5%BC%8F%E5%8C%96/ class=md-nav__link> <span class=md-ellipsis> 字符串格式化 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/23.%E5%8E%BB%E9%87%8D/ class=md-nav__link> <span class=md-ellipsis> 去重 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/24.%E5%B8%A6%E9%A2%9C%E8%89%B2%E6%89%93%E5%8D%B0/ class=md-nav__link> <span class=md-ellipsis> 带颜色打印 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/25.python-example/ class=md-nav__link> <span class=md-ellipsis> Python By Example </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/26.go-example/ class=md-nav__link> <span class=md-ellipsis> Go By Example </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_9_3> <label class=md-nav__link for=__nav_9_3 id=__nav_9_3_label tabindex=0> <span class=md-ellipsis> 2.进阶 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_9_3_label aria-expanded=false> <label class=md-nav__title for=__nav_9_3> <span class="md-nav__icon md-icon"></span> 2.进阶 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python-vs-Go/2.%E8%BF%9B%E9%98%B6/1.%E4%BD%BF%E7%94%A8RPC/ class=md-nav__link> <span class=md-ellipsis> 使用RPC </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/2.%E8%BF%9B%E9%98%B6/2.%E4%BD%BF%E7%94%A8MySQL/ class=md-nav__link> <span class=md-ellipsis> 使用MySQL </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/2.%E8%BF%9B%E9%98%B6/3.%E4%BD%BF%E7%94%A8Redis/ class=md-nav__link> <span class=md-ellipsis> 使用Redis </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/2.%E8%BF%9B%E9%98%B6/4.%E4%BD%BF%E7%94%A8MongoDB/ class=md-nav__link> <span class=md-ellipsis> 使用MongoDB </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/2.%E8%BF%9B%E9%98%B6/5.%E7%BB%83%E6%89%8B%E9%A1%B9%E7%9B%AE%E6%8E%A8%E8%8D%90/ class=md-nav__link> <span class=md-ellipsis> 练手项目推荐 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_10> <label class=md-nav__link for=__nav_10 id=__nav_10_label tabindex=0> <span class=md-ellipsis> Linux </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_10_label aria-expanded=false> <label class=md-nav__title for=__nav_10> <span class="md-nav__icon md-icon"></span> Linux </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_10_1> <label class=md-nav__link for=__nav_10_1 id=__nav_10_1_label tabindex=0> <span class=md-ellipsis> Shell </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_10_1_label aria-expanded=false> <label class=md-nav__title for=__nav_10_1> <span class="md-nav__icon md-icon"></span> Shell </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Linux/Shell/Shell%E7%AE%80%E4%BB%8B/ class=md-nav__link> <span class=md-ellipsis> Shell 教程概述 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/1.%E7%AC%AC%E4%B8%80%E4%B8%AAshell%E7%A8%8B%E5%BA%8F/ class=md-nav__link> <span class=md-ellipsis> 1.第一个 Shell 程序 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/2.Shell%E5%8F%98%E9%87%8F%E5%92%8C%E5%AD%97%E7%AC%A6%E4%B8%B2/ class=md-nav__link> <span class=md-ellipsis> 2.Shell变量和字符串 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/3.Shell%E5%8F%82%E6%95%B0/ class=md-nav__link> <span class=md-ellipsis> 3.Shell参数 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/4.Shell%E6%95%B0%E7%BB%84/ class=md-nav__link> <span class=md-ellipsis> 4.Shell数组 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/5.Shell%E8%BF%90%E7%AE%97%E7%AC%A6/ class=md-nav__link> <span class=md-ellipsis> 5.Shell运算符 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/6.Shell-echo_printf%E5%91%BD%E4%BB%A4/ class=md-nav__link> <span class=md-ellipsis> 6.Shell echo/printf 命令 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/7.Shell-test%E5%91%BD%E4%BB%A4/ class=md-nav__link> <span class=md-ellipsis> 7.Shell test命令 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/8.Shell%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/ class=md-nav__link> <span class=md-ellipsis> 8.Shell流程控制 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/9.Shell%E5%87%BD%E6%95%B0/ class=md-nav__link> <span class=md-ellipsis> 9.Shell函数 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/10.Shell%E8%BE%93%E5%85%A5_%E8%BE%93%E5%87%BA%E9%87%8D%E5%AE%9A%E5%90%91/ class=md-nav__link> <span class=md-ellipsis> 10.Shell输入/输出重定向 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/11.Shell%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 11.Shell正则表达式 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/12.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bgrep/ class=md-nav__link> <span class=md-ellipsis> 12.Shell三剑客之grep </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/13.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/ class=md-nav__link> <span class=md-ellipsis> 13.Shell三剑客之sed </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/14.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bawk/ class=md-nav__link> <span class=md-ellipsis> 14.Shell三剑客之awk </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/15.Shell%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/ class=md-nav__link> <span class=md-ellipsis> 15.Shell常用工具 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/16.Shell%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/ class=md-nav__link> <span class=md-ellipsis> 16.Shell实战项目 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/17.Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/ class=md-nav__link> <span class=md-ellipsis> 17.Shell脚本示例 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/18.Shell%E8%84%9A%E6%9C%AC%E7%9A%84%E5%8F%82%E6%95%B0%E8%A7%A3%E6%9E%90%E5%B7%A5%E5%85%B7/ class=md-nav__link> <span class=md-ellipsis> 18.Shell脚本的参数解析工具 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/19.%E5%AE%9E%E7%94%A8Shell%E8%84%9A%E6%9C%AC%E6%A1%88%E4%BE%8B/ class=md-nav__link> <span class=md-ellipsis> 19.实用 Shell 脚本案例 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/20.Shell%E8%84%9A%E6%9C%AC%E7%9A%84%E8%A7%84%E8%8C%83/ class=md-nav__link> <span class=md-ellipsis> 20.Shell脚本的规范 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/21.Shell%E5%A4%9A%E8%BF%9B%E7%A8%8B%E5%B9%B6%E5%8F%91/ class=md-nav__link> <span class=md-ellipsis> 21.Shell多进程并发 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/22.Bash_Library/ class=md-nav__link> <span class=md-ellipsis> 22.Bash Library </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/%E9%99%84-shell%E5%85%B6%E5%AE%83%E8%B5%84%E6%BA%90/ class=md-nav__link> <span class=md-ellipsis> 附-shell 其它资源 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/%E9%99%84-vim%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/ class=md-nav__link> <span class=md-ellipsis> 附-vim常用操作 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_10_2> <label class=md-nav__link for=__nav_10_2 id=__nav_10_2_label tabindex=0> <span class=md-ellipsis> Ansible </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_10_2_label aria-expanded=false> <label class=md-nav__title for=__nav_10_2> <span class="md-nav__icon md-icon"></span> Ansible </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/ class=md-nav__link> <span class=md-ellipsis> 1.Ansible 入门和实践 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Ansible/2.Ansible-wiki/ class=md-nav__link> <span class=md-ellipsis> 2.Ansible-wiki </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_10_3> <label class=md-nav__link for=__nav_10_3 id=__nav_10_3_label tabindex=0> <span class=md-ellipsis> Git </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_10_3_label aria-expanded=false> <label class=md-nav__title for=__nav_10_3> <span class="md-nav__icon md-icon"></span> Git </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Linux/Git/1.Git%E5%9F%BA%E7%A1%80/ class=md-nav__link> <span class=md-ellipsis> 1.Git基础 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Git/2.%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93/ class=md-nav__link> <span class=md-ellipsis> 2.远程仓库 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Git/3.%E5%88%86%E6%94%AF%E7%AE%A1%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 3.分支管理 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Git/4.%E5%88%86%E6%94%AF%E7%AE%A1%E7%90%86%E7%AD%96%E7%95%A5/ class=md-nav__link> <span class=md-ellipsis> 4.分支管理策略 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Git/7.%E4%BD%BF%E7%94%A8Github/ class=md-nav__link> <span class=md-ellipsis> 7.使用Github </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Git/8.%E5%AE%9E%E8%B7%B5GitHub-Flow/ class=md-nav__link> <span class=md-ellipsis> 8.实践GitHub Flow </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Git/9.%E5%AE%9E%E8%B7%B5Git-Flow/ class=md-nav__link> <span class=md-ellipsis> 9.实践Git Flow </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Git/10.%E9%A1%B9%E7%9B%AE%E8%A7%84%E8%8C%83/ class=md-nav__link> <span class=md-ellipsis> 10.项目规范 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_10_4> <label class=md-nav__link for=__nav_10_4 id=__nav_10_4_label tabindex=0> <span class=md-ellipsis> KVM </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_10_4_label aria-expanded=false> <label class=md-nav__title for=__nav_10_4> <span class="md-nav__icon md-icon"></span> KVM </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Linux/KVM/1.kvm%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4/ class=md-nav__link> <span class=md-ellipsis> 1.kvm相关命令 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/KVM/2.kvm%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%88%9B%E5%BB%BA/ class=md-nav__link> <span class=md-ellipsis> 2.kvm虚拟机创建 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/KVM/3.kvm%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE/ class=md-nav__link> <span class=md-ellipsis> 3.kvm网络配置 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_10_5> <label class=md-nav__link for=__nav_10_5 id=__nav_10_5_label tabindex=0> <span class=md-ellipsis> Nginx </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_10_5_label aria-expanded=false> <label class=md-nav__title for=__nav_10_5> <span class="md-nav__icon md-icon"></span> Nginx </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Linux/Nginx/1.Nginx%E7%AE%80%E4%BB%8B/ class=md-nav__link> <span class=md-ellipsis> 1.Nginx简介 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/2.Nginx%E5%AE%89%E8%A3%85%E5%8F%8A%E5%90%AF%E5%8A%A8/ class=md-nav__link> <span class=md-ellipsis> 2.Nginx安装及启动 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/3.Nginx%E9%85%8D%E7%BD%AE/ class=md-nav__link> <span class=md-ellipsis> 3.Nginx配置 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/4.Nginx%E9%85%8D%E7%BD%AE%E4%B8%8B%E8%BD%BD%E7%AB%99%E7%82%B9/ class=md-nav__link> <span class=md-ellipsis> 4.Nginx配置下载站点 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/5.Nginx%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6/ class=md-nav__link> <span class=md-ellipsis> 5.Nginx访问控制 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/6.Nginx%E8%99%9A%E6%8B%9F%E4%B8%BB%E6%9C%BA/ class=md-nav__link> <span class=md-ellipsis> 6.Nginx虚拟主机 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/7.Nginx%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90/ class=md-nav__link> <span class=md-ellipsis> 7.Nginx静态资源 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/8.Nginx%E7%BC%93%E5%AD%98%E9%85%8D%E7%BD%AE/ class=md-nav__link> <span class=md-ellipsis> 8.Nginx缓存配置 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/9.Nginx%E6%AD%A3%E5%8F%8D%E4%BB%A3%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 9.Nginx正反向代理 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/10.Nginx%E9%98%B2%E7%9B%97%E9%93%BE/ class=md-nav__link> <span class=md-ellipsis> 10.Nginx防盗链 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/11.Nginx%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/ class=md-nav__link> <span class=md-ellipsis> 11.Nginx负载均衡 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/12.Nginx%E5%8A%A8%E9%9D%99%E5%88%86%E7%A6%BB/ class=md-nav__link> <span class=md-ellipsis> 12.Nginx动静分离 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/13.Nginx%E8%B7%A8%E5%9F%9F%E9%85%8D%E7%BD%AE/ class=md-nav__link> <span class=md-ellipsis> 13.Nginx跨域配置 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/14.Nginx%E9%87%8D%E5%AE%9A%E5%90%91/ class=md-nav__link> <span class=md-ellipsis> 14.Nginx重定向 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/15.Nginx-HTTPS/ class=md-nav__link> <span class=md-ellipsis> 15.Nginx HTTPS </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/16.%E9%99%84-Nginx-location%E8%AF%AD%E6%B3%95/ class=md-nav__link> <span class=md-ellipsis> 16.附-Nginx-location语法 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Nginx/17.%E9%99%84-Nginx%E4%BB%A3%E7%90%86%E7%9B%B8%E5%85%B3%E6%A8%A1%E5%9D%97%E8%A7%A3%E6%9E%90/ class=md-nav__link> <span class=md-ellipsis> 17.附-Nginx代理相关模块解析 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_10_6> <label class=md-nav__link for=__nav_10_6 id=__nav_10_6_label tabindex=0> <span class=md-ellipsis> System </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_10_6_label aria-expanded=false> <label class=md-nav__title for=__nav_10_6> <span class="md-nav__icon md-icon"></span> System </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Linux/System/1.%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E5%92%8C%E8%BD%AF%E4%BB%B6%E6%BA%90/ class=md-nav__link> <span class=md-ellipsis> 1.系统镜像和软件源 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/System/2.Linux%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA/ class=md-nav__link> <span class=md-ellipsis> 2.Linux安全加固 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/System/3.Systemd/ class=md-nav__link> <span class=md-ellipsis> 3.Systemd </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/System/4.Superivisor/ class=md-nav__link> <span class=md-ellipsis> 4.Superivisor </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/System/5.SSH%E7%99%BB%E5%BD%95Linux%E6%98%BE%E7%A4%BA%E6%A8%AA%E5%B9%85/ class=md-nav__link> <span class=md-ellipsis> 5.SSH登录Linux显示横幅 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/System/6.Linux%E4%B8%AD%E7%AB%AF%E5%8F%A3%E5%8D%A0%E7%94%A8%E6%8E%92%E6%9F%A5/ class=md-nav__link> <span class=md-ellipsis> 6.Linux中端口占用排查 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/System/7.%E4%BD%BF%E7%94%A8curl%E5%8F%91%E9%80%81REST-API%E8%AF%B7%E6%B1%82/ class=md-nav__link> <span class=md-ellipsis> 7.使用curl发送REST API请求 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/System/8.%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%A8%A1%E7%B3%8A%E6%9F%A5%E6%89%BE%E5%99%A8fzf/ class=md-nav__link> <span class=md-ellipsis> 8.命令行模糊查找器fzf </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/System/9.Centos7.9%E7%B3%BB%E7%BB%9F%E7%9B%98%E6%89%A9%E5%AE%B9/ class=md-nav__link> <span class=md-ellipsis> 9.Centos7.9系统盘扩容 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/System/10.Centos%E5%9C%A8%E7%BA%BF-%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96/ class=md-nav__link> <span class=md-ellipsis> 10.Centos在线-离线安装依赖 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/System/11.rsync-ssh/ class=md-nav__link> <span class=md-ellipsis> 11.rsync ssh使用 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/System/12.%E5%90%84%E5%A4%A7%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%81%9ARAID/ class=md-nav__link> <span class=md-ellipsis> 12.各大服务器做RAID </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/System/13.Linux%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84%E4%B8%8E%E8%BF%90%E7%BB%B4%E5%AE%9E%E6%88%98/ class=md-nav__link> <span class=md-ellipsis> 13.Linux 系统架构与运维实战 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_10_7> <label class=md-nav__link for=__nav_10_7 id=__nav_10_7_label tabindex=0> <span class=md-ellipsis> Serveices </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_10_7_label aria-expanded=false> <label class=md-nav__title for=__nav_10_7> <span class="md-nav__icon md-icon"></span> Serveices </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Linux/Serveices/0.ubuntu-desktop-vmware/ class=md-nav__link> <span class=md-ellipsis> ubuntu-desktop-vmware </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_11> <label class=md-nav__link for=__nav_11 id=__nav_11_label tabindex=0> <span class=md-ellipsis> Other </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_11_label aria-expanded=false> <label class=md-nav__title for=__nav_11> <span class="md-nav__icon md-icon"></span> Other </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_11_1> <label class=md-nav__link for=__nav_11_1 id=__nav_11_1_label tabindex=0> <span class=md-ellipsis> tools </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_11_1_label aria-expanded=false> <label class=md-nav__title for=__nav_11_1> <span class="md-nav__icon md-icon"></span> tools </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Other/tools/1.PicGo%E5%9B%BE%E5%BA%8A/ class=md-nav__link> <span class=md-ellipsis> 1.PicGo图床 </span> </a> </li> <li class=md-nav__item> <a href=../../../Other/tools/2.PicX%E5%9B%BE%E5%BA%8A/ class=md-nav__link> <span class=md-ellipsis> 2.Picx图床 </span> </a> </li> <li class=md-nav__item> <a href=../../../Other/tools/3.Markdown%E8%AF%AD%E6%B3%95/ class=md-nav__link> <span class=md-ellipsis> 3.Markdown语法 </span> </a> </li> <li class=md-nav__item> <a href=../../../Other/tools/4.KeyManager/ class=md-nav__link> <span class=md-ellipsis> 4.KeyManager </span> </a> </li> <li class=md-nav__item> <a href=../../../Other/tools/5.mkdocs-material%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2/ class=md-nav__link> <span class=md-ellipsis> 5.mkdocs-material搭建博客 </span> </a> </li> <li class=md-nav__item> <a href=../../../Other/tools/6.sphinx%E6%9E%84%E5%BB%BA%E5%8D%9A%E5%AE%A2/ class=md-nav__link> <span class=md-ellipsis> 6.sphinx构建博客 </span> </a> </li> <li class=md-nav__item> <a href=../../../Other/tools/7.%E4%BC%81%E4%B8%9A%E7%BA%A7VPN%E8%BD%AF%E4%BB%B6AnyLink/ class=md-nav__link> <span class=md-ellipsis> 7.企业级VPN软件AnyLink </span> </a> </li> <li class=md-nav__item> <a href=../../../Other/tools/8.%E5%B9%B3%E5%8F%B0%E5%8F%8A%E5%B7%A5%E5%85%B7%E6%B1%87%E6%80%BB/ class=md-nav__link> <span class=md-ellipsis> 8.平台及工具汇总 </span> </a> </li> <li class=md-nav__item> <a href=../../../Other/tools/9.%E8%87%AA%E5%8A%A8%E6%9B%B4%E6%96%B0%E7%B3%BB%E7%BB%9F%E4%BB%A3%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 9.自动更新系统代理 </span> </a> </li> <li class=md-nav__item> <a href=../../../Other/tools/10.Bash-to-Bat-Converter/ class=md-nav__link> <span class=md-ellipsis> 10.Bash-to-Bat-Converter </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_11_2> <label class=md-nav__link for=__nav_11_2 id=__nav_11_2_label tabindex=0> <span class=md-ellipsis> windows </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_11_2_label aria-expanded=false> <label class=md-nav__title for=__nav_11_2> <span class="md-nav__icon md-icon"></span> windows </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Other/windows/1.%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6%E4%B8%8B%E8%BD%BD/ class=md-nav__link> <span class=md-ellipsis> 1.常用软件下载 </span> </a> </li> <li class=md-nav__item> <a href=../../../Other/windows/2.windows%E5%BF%AB%E6%8D%B7%E6%8C%87%E4%BB%A4/ class=md-nav__link> <span class=md-ellipsis> 2.windows 快捷指令 </span> </a> </li> <li class=md-nav__item> <a href=../../../Other/windows/3.DOS/ class=md-nav__link> <span class=md-ellipsis> 3.DOS </span> </a> </li> <li class=md-nav__item> <a href=../../../Other/windows/4.win11%E9%95%9C%E5%83%8F%E4%B8%8B%E8%BD%BD-%E6%BF%80%E6%B4%BB/ class=md-nav__link> <span class=md-ellipsis> 4.win11镜像下载-激活 </span> </a> </li> <li class=md-nav__item> <a href=../../../Other/windows/5.windows%E4%B8%8Bnetcat%E5%AE%89%E8%A3%85/ class=md-nav__link> <span class=md-ellipsis> 5.windows下netcat安装 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_11_3> <label class=md-nav__link for=__nav_11_3 id=__nav_11_3_label tabindex=0> <span class=md-ellipsis> Interview </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_11_3_label aria-expanded=false> <label class=md-nav__title for=__nav_11_3> <span class="md-nav__icon md-icon"></span> Interview </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Other/Interview/0.%E9%9D%A2%E8%AF%95%E5%AE%9D%E5%85%B8/ class=md-nav__link> <span class=md-ellipsis> 面试宝典 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#1-kubernetes-集群的高可用性原理 class=md-nav__link> <span class=md-ellipsis> 1. Kubernetes 集群的高可用性原理 </span> </a> </li> <li class=md-nav__item> <a href=#2-服务器基本信息 class=md-nav__link> <span class=md-ellipsis> 2. 服务器基本信息 </span> </a> </li> <li class=md-nav__item> <a href=#3-kubernetes-集群网络规划 class=md-nav__link> <span class=md-ellipsis> 3. Kubernetes 集群网络规划 </span> </a> </li> <li class=md-nav__item> <a href=#4-高可用环境安装 class=md-nav__link> <span class=md-ellipsis> 4. 高可用环境安装 </span> </a> <nav class=md-nav aria-label="4. 高可用环境安装"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#41-安装环境准备 class=md-nav__link> <span class=md-ellipsis> 4.1 安装环境准备 </span> </a> </li> <li class=md-nav__item> <a href=#42-安装-master-节点 class=md-nav__link> <span class=md-ellipsis> 4.2 安装 Master 节点 </span> </a> </li> <li class=md-nav__item> <a href=#43-安装-haproxy class=md-nav__link> <span class=md-ellipsis> 4.3 安装 haproxy </span> </a> <nav class=md-nav aria-label="4.3 安装 haproxy"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#安装-haproxy class=md-nav__link> <span class=md-ellipsis> 安装 haproxy </span> </a> </li> <li class=md-nav__item> <a href=#配置-haproxy class=md-nav__link> <span class=md-ellipsis> 配置 haproxy </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#44-安装-keepalived class=md-nav__link> <span class=md-ellipsis> 4.4 安装 keepalived </span> </a> <nav class=md-nav aria-label="4.4 安装 keepalived"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#安装-keepalived class=md-nav__link> <span class=md-ellipsis> 安装 keepalived </span> </a> </li> <li class=md-nav__item> <a href=#配置-keepalived class=md-nav__link> <span class=md-ellipsis> 配置 keepalived </span> </a> </li> <li class=md-nav__item> <a href=#健康检查脚本 class=md-nav__link> <span class=md-ellipsis> 健康检查脚本 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#45-初始化-master-节点 class=md-nav__link> <span class=md-ellipsis> 4.5 初始化 Master 节点 </span> </a> <nav class=md-nav aria-label="4.5 初始化 Master 节点"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#命令行方式初始化-k8s class=md-nav__link> <span class=md-ellipsis> 命令行方式初始化 k8s </span> </a> </li> <li class=md-nav__item> <a href=#基于-init-件初始化-k8s class=md-nav__link> <span class=md-ellipsis> 基于 init ⽂件初始化 k8s </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#46-安装-calico-网络 class=md-nav__link> <span class=md-ellipsis> 4.6 安装 Calico 网络 </span> </a> </li> <li class=md-nav__item> <a href=#47-加入其余-master-节点 class=md-nav__link> <span class=md-ellipsis> 4.7 加入其余 Master 节点 </span> </a> </li> <li class=md-nav__item> <a href=#48-加入工作节点 class=md-nav__link> <span class=md-ellipsis> 4.8 加入工作节点 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#5-安装常用工具 class=md-nav__link> <span class=md-ellipsis> 5. 安装常用工具 </span> </a> <nav class=md-nav aria-label="5. 安装常用工具"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#51-安装-kubectl class=md-nav__link> <span class=md-ellipsis> 5.1 安装 kubectl </span> </a> </li> <li class=md-nav__item> <a href=#52-安装-helm class=md-nav__link> <span class=md-ellipsis> 5.2 安装 helm </span> </a> </li> <li class=md-nav__item> <a href=#53-kubectx-kubens-and-fzf class=md-nav__link> <span class=md-ellipsis> 5.3 Kubectx Kubens and fzf </span> </a> </li> <li class=md-nav__item> <a href=#54-kubectl-插件管理器-krew class=md-nav__link> <span class=md-ellipsis> 5.4 kubectl 插件管理器 krew </span> </a> </li> <li class=md-nav__item> <a href=#55-kubectl-neat class=md-nav__link> <span class=md-ellipsis> 5.5 kubectl-neat </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#6-kubernetes-节点调度规划 class=md-nav__link> <span class=md-ellipsis> 6. kubernetes 节点调度规划 </span> </a> </li> <li class=md-nav__item> <a href=#7-metrics-部署 class=md-nav__link> <span class=md-ellipsis> 7. Metrics 部署 </span> </a> </li> <li class=md-nav__item> <a href=#8-dashboard-部署 class=md-nav__link> <span class=md-ellipsis> 8. Dashboard 部署 </span> </a> </li> <li class=md-nav__item> <a href=#9云原生存储-rook class=md-nav__link> <span class=md-ellipsis> 9.云原生存储 Rook </span> </a> <nav class=md-nav aria-label="9.云原生存储 Rook"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#91-动机 class=md-nav__link> <span class=md-ellipsis> 9.1 动机 </span> </a> </li> <li class=md-nav__item> <a href=#92-前置条件 class=md-nav__link> <span class=md-ellipsis> 9.2 前置条件 </span> </a> </li> <li class=md-nav__item> <a href=#93-部署 class=md-nav__link> <span class=md-ellipsis> 9.3 部署 </span> </a> <nav class=md-nav aria-label="9.3 部署"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#k8s-集群准备 class=md-nav__link> <span class=md-ellipsis> K8S 集群准备 </span> </a> </li> <li class=md-nav__item> <a href=#本地存储准备lvm-逻辑卷 class=md-nav__link> <span class=md-ellipsis> 本地存储准备(LVM 逻辑卷) </span> </a> </li> <li class=md-nav__item> <a href=#配置时间同步 class=md-nav__link> <span class=md-ellipsis> 配置时间同步 </span> </a> </li> <li class=md-nav__item> <a href=#安装-helm class=md-nav__link> <span class=md-ellipsis> 安装 helm </span> </a> </li> <li class=md-nav__item> <a href=#部署-rook-operator class=md-nav__link> <span class=md-ellipsis> 部署 Rook Operator </span> </a> </li> <li class=md-nav__item> <a href=#创建-ceph-集群 class=md-nav__link> <span class=md-ellipsis> 创建 Ceph 集群 </span> </a> <nav class=md-nav aria-label="创建 Ceph 集群"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#参考文档 class=md-nav__link> <span class=md-ellipsis> 参考文档 </span> </a> </li> <li class=md-nav__item> <a href=#创建集群 class=md-nav__link> <span class=md-ellipsis> 创建集群 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#验证集群状态 class=md-nav__link> <span class=md-ellipsis> 验证集群状态 </span> </a> </li> <li class=md-nav__item> <a href=#ceph-dashboard class=md-nav__link> <span class=md-ellipsis> Ceph Dashboard </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#94-使用存储-服务持久化 class=md-nav__link> <span class=md-ellipsis> 9.4 使用存储-服务持久化 </span> </a> <nav class=md-nav aria-label="9.4 使用存储-服务持久化"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#941-块存储block class=md-nav__link> <span class=md-ellipsis> 9.4.1 块存储（Block） </span> </a> <nav class=md-nav aria-label="9.4.1 块存储（Block）"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#9411-rbd-存储供给 class=md-nav__link> <span class=md-ellipsis> 9.4.1.1 RBD 存储供给 </span> </a> </li> <li class=md-nav__item> <a href=#9412-使用存储 class=md-nav__link> <span class=md-ellipsis> 9.4.1.2 使用存储 </span> </a> </li> <li class=md-nav__item> <a href=#9413-pvc-快照-块存储快照 class=md-nav__link> <span class=md-ellipsis> 9.4.1.3 PVC 快照-块存储快照 </span> </a> <nav class=md-nav aria-label="9.4.1.3 PVC 快照-块存储快照"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#制作快照 class=md-nav__link> <span class=md-ellipsis> 制作快照 </span> </a> </li> <li class=md-nav__item> <a href=#指定快照创建-pvc class=md-nav__link> <span class=md-ellipsis> 指定快照创建 PVC </span> </a> </li> <li class=md-nav__item> <a href=#数据验证 class=md-nav__link> <span class=md-ellipsis> 数据验证 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#9414-pvc-动态扩容 class=md-nav__link> <span class=md-ellipsis> 9.4.1.4 PVC 动态扩容 </span> </a> <nav class=md-nav aria-label="9.4.1.4 PVC 动态扩容"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#扩容操作 class=md-nav__link> <span class=md-ellipsis> 扩容操作 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#9415-pvc-克隆 class=md-nav__link> <span class=md-ellipsis> 9.4.1.5 PVC 克隆 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#942-cephfs-共享文件系统 class=md-nav__link> <span class=md-ellipsis> 9.4.2 CephFS 共享文件系统 </span> </a> <nav class=md-nav aria-label="9.4.2 CephFS 共享文件系统"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#9421-创建-cephfilesystem class=md-nav__link> <span class=md-ellipsis> 9.4.2.1 创建 CephFilesystem </span> </a> </li> <li class=md-nav__item> <a href=#9422-cephfs-存储供给 class=md-nav__link> <span class=md-ellipsis> 9.4.2.2 CephFS 存储供给 </span> </a> </li> <li class=md-nav__item> <a href=#9423-关于配额 class=md-nav__link> <span class=md-ellipsis> 9.4.2.3 关于配额 </span> </a> </li> <li class=md-nav__item> <a href=#9424-使用存储-多个-pod-挂载 class=md-nav__link> <span class=md-ellipsis> 9.4.2.4 使用存储: 多个 Pod 挂载 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#943-对象存储 class=md-nav__link> <span class=md-ellipsis> 9.4.3 对象存储 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fqa class=md-nav__link> <span class=md-ellipsis> FQA </span> </a> <nav class=md-nav aria-label=FQA> <ul class=md-nav__list> <li class=md-nav__item> <a href=#rook-ceph-卸载重新部署 class=md-nav__link> <span class=md-ellipsis> rook-ceph 卸载、重新部署 </span> </a> </li> <li class=md-nav__item> <a href=#测试数据清理 class=md-nav__link> <span class=md-ellipsis> 测试数据清理 </span> </a> <nav class=md-nav aria-label=测试数据清理> <ul class=md-nav__list> <li class=md-nav__item> <a href=#数据删除步骤 class=md-nav__link> <span class=md-ellipsis> 数据删除步骤 </span> </a> </li> <li class=md-nav__item> <a href=#删除-ceph-pool-存储池 class=md-nav__link> <span class=md-ellipsis> 删除 ceph pool 存储池 </span> </a> </li> <li class=md-nav__item> <a href=#删除-rbd-硬盘 class=md-nav__link> <span class=md-ellipsis> 删除 rbd 硬盘 </span> </a> </li> <li class=md-nav__item> <a href=#ceph-集群报daemons-have-recently-crashed问题处理 class=md-nav__link> <span class=md-ellipsis> ceph 集群报"daemons have recently crashed"问题处理 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#参考文档_1 class=md-nav__link> <span class=md-ellipsis> 参考文档 </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=云原生存储rook>云原生存储Rook<a class=headerlink href=#云原生存储rook title="Permanent link">&para;</a></h1> <blockquote> <p>Kubernetes 集群的高可用部署 + Rook-ceph</p> </blockquote> <h2 id=1-kubernetes-集群的高可用性原理>1. Kubernetes 集群的高可用性原理<a class=headerlink href=#1-kubernetes-集群的高可用性原理 title="Permanent link">&para;</a></h2> <p>在 Kubernetes 集群中主要有两种节点，分别为 Master 节点和工作节点 Node。</p> <p>其 中 Master 节 点 为 管 理 节 点 ， 管 理 整 个 Kubernetes 集群，接收外部命令，维护集群状态。</p> <p>如果 Master 节点出现故障，则整个集群会失去控制。在 Master 节点上面，运行的主要服务有 apiserver、etcd、scheduler 以及 controller-manager。</p> <p>工作节点（Node 节点），主要执行计算任务，运行的主要服务有 kubelet 和 kube-proxy。当工作节点出现故障，Kubernetes 会将 Pod 调度到其他的工作节点上，并不会影响整个集群的运行，甚至对应用系统的影响也非常小。</p> <p>因此，Kubernetes 集群的高可用主要是指 Master 节点的高可用。</p> <h2 id=2-服务器基本信息>2. 服务器基本信息<a class=headerlink href=#2-服务器基本信息 title="Permanent link">&para;</a></h2> <table> <thead> <tr> <th>节点角色</th> <th>架构</th> <th>操作系统</th> <th>规格</th> <th>IP</th> <th>k8s 版本</th> <th>容器运行时</th> <th>备注</th> </tr> </thead> <tbody> <tr> <td>gitee-kubernetes-master1</td> <td>Amd64/X86</td> <td>Ubuntu 20.04 LTS</td> <td>VCPU：8C<br>Mem：32G<br>System-Disk：200G</td> <td>10.4.145.92</td> <td>v1.26.0</td> <td>containerd=1.6.20</td> <td>VIP：10.4.145.100</td> </tr> <tr> <td>gitee-kubernetes-master2</td> <td>Amd64/X86</td> <td>Ubuntu 20.04 LTS</td> <td>VCPU：8C<br>Mem：32G<br>System-Disk：200G</td> <td>10.4.145.129</td> <td>v1.26.0</td> <td>containerd=1.6.20</td> <td>VIP：10.4.145.100</td> </tr> <tr> <td>gitee-kubernetes-master3</td> <td>Amd64/X86</td> <td>Ubuntu 20.04 LTS</td> <td>VCPU：8C<br>Mem：32G<br>System-Disk：200G</td> <td>10.4.145.169</td> <td>v1.26.0</td> <td>containerd=1.6.20</td> <td>VIP：10.4.145.100</td> </tr> <tr> <td>gitee-kubernetes-node01~node15</td> <td>Amd64/X86</td> <td>Ubuntu 20.04 LTS</td> <td>VCPU：16C<br>Mem：64G<br>System-Disk：200G<br></td> <td>省略</td> <td>v1.26.0</td> <td>containerd=1.6.20</td> <td>gitee-kubernetes-node09~11 安装 rook-ceph 存储集群</td> </tr> </tbody> </table> <h2 id=3-kubernetes-集群网络规划>3. Kubernetes 集群网络规划<a class=headerlink href=#3-kubernetes-集群网络规划 title="Permanent link">&para;</a></h2> <table> <thead> <tr> <th>网络</th> <th>CIDR 网段</th> <th>备注</th> </tr> </thead> <tbody> <tr> <td>Pod 网段</td> <td>10.200.0.0/16</td> <td>集群最多可以容纳 65534 个 Pod</td> </tr> <tr> <td>Service 网段</td> <td>10.100.0.0/16</td> <td>在集群内部用于服务发现和负载均衡</td> </tr> <tr> <td>calico 网段</td> <td>10.10.0.0/16</td> <td>通过 host 上路由配置完成跨 Host 转发。</td> </tr> </tbody> </table> <blockquote> <ul> <li> <p>网络代理: ipvs</p> </li> <li> <p>CNI 组件： <strong>calico ⽹络组件</strong> 参考： <a href=https://www.cnblogs.com/goldsunshine/p/10701242.html>k8s 网络之 Calico 网络</a></p> </li> <li> <p>DNS 域名为 <code>cluster.local</code>。这个域名是 Kubernetes 默认的 DNS 域名，用于解析 Kubernetes Service 和 Pod 的 DNS 记录。</p> </li> <li> <p>注意 宿主机网段、K8s Service 网段、Pod 网段不能重复。</p> </li> </ul> </blockquote> <h2 id=4-高可用环境安装>4. 高可用环境安装<a class=headerlink href=#4-高可用环境安装 title="Permanent link">&para;</a></h2> <h3 id=41-安装环境准备>4.1 安装环境准备<a class=headerlink href=#41-安装环境准备 title="Permanent link">&para;</a></h3> <p>为了能够顺利部署 Kubernetes，还需要做一些配置工作,已经将配置工作集成到如下脚本中</p> <p><code>pre_reboot.sh</code></p> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=ch>#!/bin/env bash</span>
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=nv>HOST_NAME</span><span class=o>=</span><span class=nv>$1</span>
<a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=nv>DNS_ADDRESS</span><span class=o>=</span><span class=nv>$2</span>
<a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a>
<a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a>usage<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a><span class=w>  </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Usage: </span><span class=nv>$0</span><span class=s2> &lt;HOSTNAME&gt; &lt;IP_ADDRESS&gt;&quot;</span>
<a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a><span class=o>}</span>
<a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a>
<a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$#</span><span class=s2>&quot;</span><span class=w> </span>-ne<span class=w> </span><span class=m>2</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a><span class=w>  </span>usage
<a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a><span class=w>  </span><span class=nb>exit</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-0-13 name=__codelineno-0-13 href=#__codelineno-0-13></a><span class=k>fi</span>
<a id=__codelineno-0-14 name=__codelineno-0-14 href=#__codelineno-0-14></a>
<a id=__codelineno-0-15 name=__codelineno-0-15 href=#__codelineno-0-15></a>
<a id=__codelineno-0-16 name=__codelineno-0-16 href=#__codelineno-0-16></a>validate_ip<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-0-17 name=__codelineno-0-17 href=#__codelineno-0-17></a><span class=w>  </span><span class=nb>local</span><span class=w> </span><span class=nv>ip</span><span class=o>=</span><span class=nv>$1</span>
<a id=__codelineno-0-18 name=__codelineno-0-18 href=#__codelineno-0-18></a><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=o>[[</span><span class=w> </span><span class=nv>$ip</span><span class=w> </span><span class=o>=</span>~<span class=w> </span>^<span class=o>[</span><span class=m>0</span>-9<span class=o>]</span>+<span class=se>\.</span><span class=o>[</span><span class=m>0</span>-9<span class=o>]</span>+<span class=se>\.</span><span class=o>[</span><span class=m>0</span>-9<span class=o>]</span>+<span class=se>\.</span><span class=o>[</span><span class=m>0</span>-9<span class=o>]</span>+$<span class=w> </span><span class=o>]]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-0-19 name=__codelineno-0-19 href=#__codelineno-0-19></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-0-20 name=__codelineno-0-20 href=#__codelineno-0-20></a><span class=w>  </span><span class=k>else</span>
<a id=__codelineno-0-21 name=__codelineno-0-21 href=#__codelineno-0-21></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-0-22 name=__codelineno-0-22 href=#__codelineno-0-22></a><span class=w>  </span><span class=k>fi</span>
<a id=__codelineno-0-23 name=__codelineno-0-23 href=#__codelineno-0-23></a><span class=o>}</span>
<a id=__codelineno-0-24 name=__codelineno-0-24 href=#__codelineno-0-24></a>
<a id=__codelineno-0-25 name=__codelineno-0-25 href=#__codelineno-0-25></a>
<a id=__codelineno-0-26 name=__codelineno-0-26 href=#__codelineno-0-26></a><span class=k>if</span><span class=w> </span>!<span class=w> </span>validate_ip<span class=w> </span><span class=s2>&quot;</span><span class=nv>$DNS_ADDRESS</span><span class=s2>&quot;</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-0-27 name=__codelineno-0-27 href=#__codelineno-0-27></a><span class=w>  </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Error: </span><span class=nv>$DNS_ADDRESS</span><span class=s2> is not a valid IP address.&quot;</span>
<a id=__codelineno-0-28 name=__codelineno-0-28 href=#__codelineno-0-28></a><span class=w>  </span>usage
<a id=__codelineno-0-29 name=__codelineno-0-29 href=#__codelineno-0-29></a><span class=w>  </span><span class=nb>exit</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-0-30 name=__codelineno-0-30 href=#__codelineno-0-30></a><span class=k>fi</span>
<a id=__codelineno-0-31 name=__codelineno-0-31 href=#__codelineno-0-31></a>
<a id=__codelineno-0-32 name=__codelineno-0-32 href=#__codelineno-0-32></a>
<a id=__codelineno-0-33 name=__codelineno-0-33 href=#__codelineno-0-33></a>
<a id=__codelineno-0-34 name=__codelineno-0-34 href=#__codelineno-0-34></a>install::installationOfToolsForEachNode<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-0-35 name=__codelineno-0-35 href=#__codelineno-0-35></a><span class=w>  </span><span class=c1># support ssl transmission</span>
<a id=__codelineno-0-36 name=__codelineno-0-36 href=#__codelineno-0-36></a><span class=w>  </span>sudo<span class=w> </span>apt<span class=w> </span>update
<a id=__codelineno-0-37 name=__codelineno-0-37 href=#__codelineno-0-37></a><span class=w>  </span>sudo<span class=w> </span>apt<span class=w> </span>-y<span class=w> </span>install<span class=w> </span><span class=se>\</span>
<a id=__codelineno-0-38 name=__codelineno-0-38 href=#__codelineno-0-38></a><span class=w>    </span>apt-transport-https<span class=w> </span><span class=se>\</span>
<a id=__codelineno-0-39 name=__codelineno-0-39 href=#__codelineno-0-39></a><span class=w>    </span>apt-transport-https<span class=w> </span><span class=se>\</span>
<a id=__codelineno-0-40 name=__codelineno-0-40 href=#__codelineno-0-40></a><span class=w>    </span>ca-certificates<span class=w> </span><span class=se>\</span>
<a id=__codelineno-0-41 name=__codelineno-0-41 href=#__codelineno-0-41></a><span class=w>    </span>curl<span class=w> </span><span class=se>\</span>
<a id=__codelineno-0-42 name=__codelineno-0-42 href=#__codelineno-0-42></a><span class=w>    </span>gnupg2<span class=w> </span><span class=se>\</span>
<a id=__codelineno-0-43 name=__codelineno-0-43 href=#__codelineno-0-43></a><span class=w>    </span>software-properties-common<span class=w> </span><span class=se>\</span>
<a id=__codelineno-0-44 name=__codelineno-0-44 href=#__codelineno-0-44></a><span class=w>    </span>apt-transport-https<span class=w> </span><span class=se>\</span>
<a id=__codelineno-0-45 name=__codelineno-0-45 href=#__codelineno-0-45></a><span class=w>    </span>ca-certificates<span class=w> </span><span class=se>\</span>
<a id=__codelineno-0-46 name=__codelineno-0-46 href=#__codelineno-0-46></a><span class=w>    </span>gnupg-agent<span class=w> </span><span class=se>\</span>
<a id=__codelineno-0-47 name=__codelineno-0-47 href=#__codelineno-0-47></a><span class=w>    </span>openssl<span class=w> </span><span class=se>\</span>
<a id=__codelineno-0-48 name=__codelineno-0-48 href=#__codelineno-0-48></a><span class=w>    </span>software-properties-common
<a id=__codelineno-0-49 name=__codelineno-0-49 href=#__codelineno-0-49></a><span class=o>}</span>
<a id=__codelineno-0-50 name=__codelineno-0-50 href=#__codelineno-0-50></a>
<a id=__codelineno-0-51 name=__codelineno-0-51 href=#__codelineno-0-51></a>setting::setDns<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-0-52 name=__codelineno-0-52 href=#__codelineno-0-52></a><span class=w>  </span><span class=nv>dns</span><span class=o>=</span><span class=nv>$1</span>
<a id=__codelineno-0-53 name=__codelineno-0-53 href=#__codelineno-0-53></a><span class=w>  </span>sudo<span class=w> </span>sed<span class=w> </span>-i<span class=w> </span><span class=s2>&quot;s/^#DNS=.*/DNS=</span><span class=si>${</span><span class=nv>dns</span><span class=si>}</span><span class=s2>/g&quot;</span><span class=w> </span>/etc/systemd/resolved.conf
<a id=__codelineno-0-54 name=__codelineno-0-54 href=#__codelineno-0-54></a><span class=w>  </span>sudo<span class=w> </span>sed<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;s/^#DNSStubListener=.*/DNSStubListener=no/g&#39;</span><span class=w> </span>/etc/systemd/resolved.conf
<a id=__codelineno-0-55 name=__codelineno-0-55 href=#__codelineno-0-55></a><span class=w>  </span>sudo<span class=w> </span>systemctl<span class=w> </span>daemon-reload
<a id=__codelineno-0-56 name=__codelineno-0-56 href=#__codelineno-0-56></a>
<a id=__codelineno-0-57 name=__codelineno-0-57 href=#__codelineno-0-57></a><span class=w>  </span>sudo<span class=w> </span>ln<span class=w> </span>-sf<span class=w> </span>/run/systemd/resolve/resolv.conf<span class=w> </span>/etc/resolv.conf
<a id=__codelineno-0-58 name=__codelineno-0-58 href=#__codelineno-0-58></a><span class=w>  </span>sudo<span class=w> </span>systemctl<span class=w> </span>restart<span class=w> </span>systemd-resolved
<a id=__codelineno-0-59 name=__codelineno-0-59 href=#__codelineno-0-59></a><span class=o>}</span>
<a id=__codelineno-0-60 name=__codelineno-0-60 href=#__codelineno-0-60></a>
<a id=__codelineno-0-61 name=__codelineno-0-61 href=#__codelineno-0-61></a>setting::set_hostname<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-0-62 name=__codelineno-0-62 href=#__codelineno-0-62></a><span class=w>  </span><span class=nv>new_hostname</span><span class=o>=</span><span class=nv>$1</span>
<a id=__codelineno-0-63 name=__codelineno-0-63 href=#__codelineno-0-63></a><span class=w>  </span>sudo<span class=w> </span>hostnamectl<span class=w> </span>set-hostname<span class=w> </span><span class=nv>$new_hostname</span>
<a id=__codelineno-0-64 name=__codelineno-0-64 href=#__codelineno-0-64></a><span class=w>  </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Hostname set to </span><span class=nv>$new_hostname</span><span class=s2>&quot;</span>
<a id=__codelineno-0-65 name=__codelineno-0-65 href=#__codelineno-0-65></a><span class=o>}</span>
<a id=__codelineno-0-66 name=__codelineno-0-66 href=#__codelineno-0-66></a>
<a id=__codelineno-0-67 name=__codelineno-0-67 href=#__codelineno-0-67></a>setting::turn_off_firewall_selinux<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-0-68 name=__codelineno-0-68 href=#__codelineno-0-68></a><span class=w>  </span>sudo<span class=w> </span>systemctl<span class=w> </span>stop<span class=w> </span>ufw
<a id=__codelineno-0-69 name=__codelineno-0-69 href=#__codelineno-0-69></a><span class=w>  </span>sudo<span class=w> </span>systemctl<span class=w> </span>disable<span class=w> </span>ufw
<a id=__codelineno-0-70 name=__codelineno-0-70 href=#__codelineno-0-70></a><span class=w>  </span>sudo<span class=w> </span>setenforce<span class=w> </span><span class=m>0</span>
<a id=__codelineno-0-71 name=__codelineno-0-71 href=#__codelineno-0-71></a><span class=o>}</span>
<a id=__codelineno-0-72 name=__codelineno-0-72 href=#__codelineno-0-72></a>setting::disable_swap<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-0-73 name=__codelineno-0-73 href=#__codelineno-0-73></a><span class=w>  </span>sudo<span class=w> </span>swapoff<span class=w> </span>-a
<a id=__codelineno-0-74 name=__codelineno-0-74 href=#__codelineno-0-74></a><span class=w>  </span>sudo<span class=w> </span>sed<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;/swap/ s/^\(.*\)$/#\1/g&#39;</span><span class=w> </span>/etc/fstab
<a id=__codelineno-0-75 name=__codelineno-0-75 href=#__codelineno-0-75></a><span class=o>}</span>
<a id=__codelineno-0-76 name=__codelineno-0-76 href=#__codelineno-0-76></a>setting::set_time_synchronization<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-0-77 name=__codelineno-0-77 href=#__codelineno-0-77></a><span class=w>  </span>sudo<span class=w> </span>apt<span class=w> </span>-y<span class=w> </span>install<span class=w> </span>chrony
<a id=__codelineno-0-78 name=__codelineno-0-78 href=#__codelineno-0-78></a><span class=w>  </span>sudo<span class=w> </span>systemctl<span class=w> </span>restart<span class=w> </span>chrony
<a id=__codelineno-0-79 name=__codelineno-0-79 href=#__codelineno-0-79></a><span class=o>}</span>
<a id=__codelineno-0-80 name=__codelineno-0-80 href=#__codelineno-0-80></a>
<a id=__codelineno-0-81 name=__codelineno-0-81 href=#__codelineno-0-81></a>
<a id=__codelineno-0-82 name=__codelineno-0-82 href=#__codelineno-0-82></a>upgrade::upgrade_system<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-0-83 name=__codelineno-0-83 href=#__codelineno-0-83></a><span class=w>  </span>sudo<span class=w> </span>apt<span class=w> </span>update
<a id=__codelineno-0-84 name=__codelineno-0-84 href=#__codelineno-0-84></a><span class=w>  </span>sudo<span class=w> </span>apt<span class=w> </span>-y<span class=w> </span>full-upgrade
<a id=__codelineno-0-85 name=__codelineno-0-85 href=#__codelineno-0-85></a><span class=w>  </span><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;即将重启服务器.倒计时..&quot;</span>
<a id=__codelineno-0-86 name=__codelineno-0-86 href=#__codelineno-0-86></a><span class=w>  </span>tput<span class=w> </span>sc
<a id=__codelineno-0-87 name=__codelineno-0-87 href=#__codelineno-0-87></a><span class=w>  </span><span class=c1># 循环20秒</span>
<a id=__codelineno-0-88 name=__codelineno-0-88 href=#__codelineno-0-88></a><span class=w>  </span><span class=k>for</span><span class=w> </span>count<span class=w> </span><span class=k>in</span><span class=w> </span><span class=sb>`</span>seq<span class=w> </span><span class=m>20</span><span class=w> </span>-1<span class=w> </span><span class=m>0</span><span class=sb>`</span>
<a id=__codelineno-0-89 name=__codelineno-0-89 href=#__codelineno-0-89></a><span class=w>  </span><span class=k>do</span>
<a id=__codelineno-0-90 name=__codelineno-0-90 href=#__codelineno-0-90></a><span class=w>    </span>tput<span class=w> </span>rc
<a id=__codelineno-0-91 name=__codelineno-0-91 href=#__codelineno-0-91></a><span class=w>    </span>tput<span class=w> </span>ed
<a id=__codelineno-0-92 name=__codelineno-0-92 href=#__codelineno-0-92></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-en<span class=w> </span><span class=s2>&quot;\033[1;31;40m </span><span class=si>${</span><span class=nv>count</span><span class=si>}</span><span class=s2>s \033[0m&quot;</span>
<a id=__codelineno-0-93 name=__codelineno-0-93 href=#__codelineno-0-93></a><span class=w>    </span>sleep<span class=w> </span><span class=m>1</span>
<a id=__codelineno-0-94 name=__codelineno-0-94 href=#__codelineno-0-94></a><span class=w>  </span><span class=k>done</span>
<a id=__codelineno-0-95 name=__codelineno-0-95 href=#__codelineno-0-95></a><span class=w>  </span><span class=o>[</span><span class=w> </span>-f<span class=w> </span>/var/run/reboot-required<span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>sudo<span class=w> </span>reboot<span class=w> </span>-f
<a id=__codelineno-0-96 name=__codelineno-0-96 href=#__codelineno-0-96></a><span class=o>}</span>
<a id=__codelineno-0-97 name=__codelineno-0-97 href=#__codelineno-0-97></a>
<a id=__codelineno-0-98 name=__codelineno-0-98 href=#__codelineno-0-98></a>
<a id=__codelineno-0-99 name=__codelineno-0-99 href=#__codelineno-0-99></a>setting<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-0-100 name=__codelineno-0-100 href=#__codelineno-0-100></a><span class=w>  </span>setting::set_hostname<span class=w> </span><span class=si>${</span><span class=nv>HOST_NAME</span><span class=si>}</span>
<a id=__codelineno-0-101 name=__codelineno-0-101 href=#__codelineno-0-101></a><span class=w>  </span>setting::setDns<span class=w> </span><span class=si>${</span><span class=nv>DNS_ADDRESS</span><span class=si>}</span>
<a id=__codelineno-0-102 name=__codelineno-0-102 href=#__codelineno-0-102></a><span class=w>  </span>setting::turn_off_firewall_selinux
<a id=__codelineno-0-103 name=__codelineno-0-103 href=#__codelineno-0-103></a><span class=w>  </span>setting::disable_swap
<a id=__codelineno-0-104 name=__codelineno-0-104 href=#__codelineno-0-104></a><span class=w>  </span>setting::set_time_synchronization
<a id=__codelineno-0-105 name=__codelineno-0-105 href=#__codelineno-0-105></a><span class=o>}</span>
<a id=__codelineno-0-106 name=__codelineno-0-106 href=#__codelineno-0-106></a>
<a id=__codelineno-0-107 name=__codelineno-0-107 href=#__codelineno-0-107></a>main<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-0-108 name=__codelineno-0-108 href=#__codelineno-0-108></a><span class=w>  </span>install::installationOfToolsForEachNode
<a id=__codelineno-0-109 name=__codelineno-0-109 href=#__codelineno-0-109></a><span class=w>  </span>setting
<a id=__codelineno-0-110 name=__codelineno-0-110 href=#__codelineno-0-110></a><span class=w>  </span>upgrade::upgrade_system
<a id=__codelineno-0-111 name=__codelineno-0-111 href=#__codelineno-0-111></a><span class=o>}</span>
<a id=__codelineno-0-112 name=__codelineno-0-112 href=#__codelineno-0-112></a>
<a id=__codelineno-0-113 name=__codelineno-0-113 href=#__codelineno-0-113></a>main
</code></pre></div> <div class=highlight><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=c1># 安装前系统预配置</span>
<a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a>$<span class=w> </span>bash<span class=w> </span>pre_reboot.sh<span class=w> </span>主机名<span class=w> </span>DNS地址
</code></pre></div> <h3 id=42-安装-master-节点>4.2 安装 Master 节点<a class=headerlink href=#42-安装-master-节点 title="Permanent link">&para;</a></h3> <p><code>post_reboot.sh</code></p> <div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=ch>#!/usr/bin/env bash</span>
<a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a>
<a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a><span class=nv>kubernetes_version</span><span class=o>=</span><span class=nv>$1</span>
<a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a><span class=nv>containerd_version</span><span class=o>=</span><span class=nv>$2</span>
<a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a><span class=nv>role</span><span class=o>=</span><span class=nv>$3</span>
<a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a>
<a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a>usage<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Usage: </span><span class=nv>$0</span><span class=s2> &lt;kubernetes_version&gt; &lt;containerd_version&gt; &lt;master|node&gt;&quot;</span>
<a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;  kubernetes_version: The desired Kubernetes version&quot;</span>
<a id=__codelineno-2-10 name=__codelineno-2-10 href=#__codelineno-2-10></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;  containerd_version: The desired containerd version&quot;</span>
<a id=__codelineno-2-11 name=__codelineno-2-11 href=#__codelineno-2-11></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;  example Usage: bash </span><span class=nv>$0</span><span class=s2> 1.26.3 1.6.20 master|node&quot;</span>
<a id=__codelineno-2-12 name=__codelineno-2-12 href=#__codelineno-2-12></a><span class=o>}</span>
<a id=__codelineno-2-13 name=__codelineno-2-13 href=#__codelineno-2-13></a>
<a id=__codelineno-2-14 name=__codelineno-2-14 href=#__codelineno-2-14></a><span class=k>if</span><span class=w> </span><span class=o>[[</span><span class=w> </span><span class=nv>$#</span><span class=w> </span>-ne<span class=w> </span><span class=m>3</span><span class=w> </span><span class=o>]]</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=o>[[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$role</span><span class=s2>&quot;</span><span class=w> </span>!<span class=o>=</span><span class=w> </span><span class=s2>&quot;master&quot;</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$role</span><span class=s2>&quot;</span><span class=w> </span>!<span class=o>=</span><span class=w> </span><span class=s2>&quot;node&quot;</span><span class=w> </span><span class=o>]]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-2-15 name=__codelineno-2-15 href=#__codelineno-2-15></a><span class=w>    </span>usage
<a id=__codelineno-2-16 name=__codelineno-2-16 href=#__codelineno-2-16></a><span class=w>    </span><span class=nb>exit</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-2-17 name=__codelineno-2-17 href=#__codelineno-2-17></a><span class=k>fi</span>
<a id=__codelineno-2-18 name=__codelineno-2-18 href=#__codelineno-2-18></a>
<a id=__codelineno-2-19 name=__codelineno-2-19 href=#__codelineno-2-19></a>
<a id=__codelineno-2-20 name=__codelineno-2-20 href=#__codelineno-2-20></a>set_kubernetes_cri_config<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-2-21 name=__codelineno-2-21 href=#__codelineno-2-21></a>sudo<span class=w> </span>sh<span class=w> </span>-c<span class=w> </span><span class=s1>&#39;cat &lt;&lt; EOF &gt; /etc/sysctl.d/99-kubernetes-cri.conf</span>
<a id=__codelineno-2-22 name=__codelineno-2-22 href=#__codelineno-2-22></a><span class=s1>net.bridge.bridge-nf-call-ip6tables = 1</span>
<a id=__codelineno-2-23 name=__codelineno-2-23 href=#__codelineno-2-23></a><span class=s1>net.bridge.bridge-nf-call-iptables = 1</span>
<a id=__codelineno-2-24 name=__codelineno-2-24 href=#__codelineno-2-24></a><span class=s1>net.ipv4.ip_forward = 1</span>
<a id=__codelineno-2-25 name=__codelineno-2-25 href=#__codelineno-2-25></a><span class=s1>user.max_user_namespaces=28633</span>
<a id=__codelineno-2-26 name=__codelineno-2-26 href=#__codelineno-2-26></a><span class=s1>EOF&#39;</span>
<a id=__codelineno-2-27 name=__codelineno-2-27 href=#__codelineno-2-27></a>
<a id=__codelineno-2-28 name=__codelineno-2-28 href=#__codelineno-2-28></a>sudo<span class=w> </span>sysctl<span class=w> </span>-p<span class=w> </span>/etc/sysctl.d/99-kubernetes-cri.conf
<a id=__codelineno-2-29 name=__codelineno-2-29 href=#__codelineno-2-29></a>
<a id=__codelineno-2-30 name=__codelineno-2-30 href=#__codelineno-2-30></a>
<a id=__codelineno-2-31 name=__codelineno-2-31 href=#__codelineno-2-31></a>sudo<span class=w> </span>sh<span class=w> </span>-c<span class=w> </span><span class=s1>&#39;sudo tee /etc/sysctl.d/kubernetes.conf &lt;&lt;EOF</span>
<a id=__codelineno-2-32 name=__codelineno-2-32 href=#__codelineno-2-32></a><span class=s1>net.bridge.bridge-nf-call-ip6tables = 1</span>
<a id=__codelineno-2-33 name=__codelineno-2-33 href=#__codelineno-2-33></a><span class=s1>net.bridge.bridge-nf-call-iptables = 1</span>
<a id=__codelineno-2-34 name=__codelineno-2-34 href=#__codelineno-2-34></a><span class=s1>net.ipv4.ip_forward = 1</span>
<a id=__codelineno-2-35 name=__codelineno-2-35 href=#__codelineno-2-35></a><span class=s1>EOF&#39;</span>
<a id=__codelineno-2-36 name=__codelineno-2-36 href=#__codelineno-2-36></a>
<a id=__codelineno-2-37 name=__codelineno-2-37 href=#__codelineno-2-37></a>sudo<span class=w> </span>sudo<span class=w> </span>sysctl<span class=w> </span>--system
<a id=__codelineno-2-38 name=__codelineno-2-38 href=#__codelineno-2-38></a><span class=o>}</span>
<a id=__codelineno-2-39 name=__codelineno-2-39 href=#__codelineno-2-39></a>
<a id=__codelineno-2-40 name=__codelineno-2-40 href=#__codelineno-2-40></a>kernel_parameter_optimization<span class=w> </span><span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-2-41 name=__codelineno-2-41 href=#__codelineno-2-41></a><span class=c1>#开启内核模块</span>
<a id=__codelineno-2-42 name=__codelineno-2-42 href=#__codelineno-2-42></a>sudo<span class=w> </span>modprobe<span class=w> </span>nf_conntrack<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>sudo<span class=w> </span>modprobe<span class=w> </span>br_netfilter
<a id=__codelineno-2-43 name=__codelineno-2-43 href=#__codelineno-2-43></a><span class=c1>#配置内核参数</span>
<a id=__codelineno-2-44 name=__codelineno-2-44 href=#__codelineno-2-44></a>sudo<span class=w> </span>sh<span class=w> </span>-c<span class=w> </span><span class=s1>&#39;cat &gt;&gt;/etc/sysctl.conf&lt;&lt;EOF</span>
<a id=__codelineno-2-45 name=__codelineno-2-45 href=#__codelineno-2-45></a><span class=s1>net.ipv4.ip_forward = 1</span>
<a id=__codelineno-2-46 name=__codelineno-2-46 href=#__codelineno-2-46></a><span class=s1>vm.max_map_count = 262144</span>
<a id=__codelineno-2-47 name=__codelineno-2-47 href=#__codelineno-2-47></a><span class=s1>kernel.pid_max = 4194303</span>
<a id=__codelineno-2-48 name=__codelineno-2-48 href=#__codelineno-2-48></a><span class=s1>fs.file-max = 1000000</span>
<a id=__codelineno-2-49 name=__codelineno-2-49 href=#__codelineno-2-49></a><span class=s1>net.ipv4.tcp_max_tw_buckets = 6000</span>
<a id=__codelineno-2-50 name=__codelineno-2-50 href=#__codelineno-2-50></a><span class=s1>net.netfilter.nf_conntrack_max = 2097152</span>
<a id=__codelineno-2-51 name=__codelineno-2-51 href=#__codelineno-2-51></a><span class=s1>net.bridge.bridge-nf-call-ip6tables = 1</span>
<a id=__codelineno-2-52 name=__codelineno-2-52 href=#__codelineno-2-52></a><span class=s1>net.bridge.bridge-nf-call-iptables = 1</span>
<a id=__codelineno-2-53 name=__codelineno-2-53 href=#__codelineno-2-53></a><span class=s1>vm.swappiness = 0</span>
<a id=__codelineno-2-54 name=__codelineno-2-54 href=#__codelineno-2-54></a><span class=s1>EOF&#39;</span>
<a id=__codelineno-2-55 name=__codelineno-2-55 href=#__codelineno-2-55></a>
<a id=__codelineno-2-56 name=__codelineno-2-56 href=#__codelineno-2-56></a><span class=c1>#添加内核模块开机挂载</span>
<a id=__codelineno-2-57 name=__codelineno-2-57 href=#__codelineno-2-57></a>sudo<span class=w> </span>sh<span class=w> </span>-c<span class=w> </span><span class=s1>&#39;cat &gt;&gt; /etc/modules-load.d/modules.conf &lt;&lt;EOF</span>
<a id=__codelineno-2-58 name=__codelineno-2-58 href=#__codelineno-2-58></a><span class=s1>ip_vs</span>
<a id=__codelineno-2-59 name=__codelineno-2-59 href=#__codelineno-2-59></a><span class=s1>ip_vs_lc</span>
<a id=__codelineno-2-60 name=__codelineno-2-60 href=#__codelineno-2-60></a><span class=s1>ip_vs_lblc</span>
<a id=__codelineno-2-61 name=__codelineno-2-61 href=#__codelineno-2-61></a><span class=s1>ip_vs_lblcr</span>
<a id=__codelineno-2-62 name=__codelineno-2-62 href=#__codelineno-2-62></a><span class=s1>ip_vs_rr</span>
<a id=__codelineno-2-63 name=__codelineno-2-63 href=#__codelineno-2-63></a><span class=s1>ip_vs_wrr</span>
<a id=__codelineno-2-64 name=__codelineno-2-64 href=#__codelineno-2-64></a><span class=s1>ip_vs_sh</span>
<a id=__codelineno-2-65 name=__codelineno-2-65 href=#__codelineno-2-65></a><span class=s1>ip_vs_dh</span>
<a id=__codelineno-2-66 name=__codelineno-2-66 href=#__codelineno-2-66></a><span class=s1>ip_vs_fo</span>
<a id=__codelineno-2-67 name=__codelineno-2-67 href=#__codelineno-2-67></a><span class=s1>ip_vs_nq</span>
<a id=__codelineno-2-68 name=__codelineno-2-68 href=#__codelineno-2-68></a><span class=s1>ip_vs_sed</span>
<a id=__codelineno-2-69 name=__codelineno-2-69 href=#__codelineno-2-69></a><span class=s1>ip_vs_ftp</span>
<a id=__codelineno-2-70 name=__codelineno-2-70 href=#__codelineno-2-70></a><span class=s1>ip_vs_sh</span>
<a id=__codelineno-2-71 name=__codelineno-2-71 href=#__codelineno-2-71></a><span class=s1>ip_tables</span>
<a id=__codelineno-2-72 name=__codelineno-2-72 href=#__codelineno-2-72></a><span class=s1>ip_set</span>
<a id=__codelineno-2-73 name=__codelineno-2-73 href=#__codelineno-2-73></a><span class=s1>ipt_set</span>
<a id=__codelineno-2-74 name=__codelineno-2-74 href=#__codelineno-2-74></a><span class=s1>ipt_rpfilter</span>
<a id=__codelineno-2-75 name=__codelineno-2-75 href=#__codelineno-2-75></a><span class=s1>ipt_REJECT</span>
<a id=__codelineno-2-76 name=__codelineno-2-76 href=#__codelineno-2-76></a><span class=s1>ipip</span>
<a id=__codelineno-2-77 name=__codelineno-2-77 href=#__codelineno-2-77></a><span class=s1>xt_set</span>
<a id=__codelineno-2-78 name=__codelineno-2-78 href=#__codelineno-2-78></a><span class=s1>br_netfilter</span>
<a id=__codelineno-2-79 name=__codelineno-2-79 href=#__codelineno-2-79></a><span class=s1>nf_conntrack</span>
<a id=__codelineno-2-80 name=__codelineno-2-80 href=#__codelineno-2-80></a><span class=s1>overlay</span>
<a id=__codelineno-2-81 name=__codelineno-2-81 href=#__codelineno-2-81></a><span class=s1>EOF&#39;</span>
<a id=__codelineno-2-82 name=__codelineno-2-82 href=#__codelineno-2-82></a>
<a id=__codelineno-2-83 name=__codelineno-2-83 href=#__codelineno-2-83></a><span class=c1>#重启后验证内核模块与内存参数</span>
<a id=__codelineno-2-84 name=__codelineno-2-84 href=#__codelineno-2-84></a>sudo<span class=w> </span>lsmod<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>br_netfilter
<a id=__codelineno-2-85 name=__codelineno-2-85 href=#__codelineno-2-85></a>sudo<span class=w> </span>sysctl<span class=w> </span>-a<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>bridge-nf-call-iptables
<a id=__codelineno-2-86 name=__codelineno-2-86 href=#__codelineno-2-86></a><span class=o>}</span>
<a id=__codelineno-2-87 name=__codelineno-2-87 href=#__codelineno-2-87></a>
<a id=__codelineno-2-88 name=__codelineno-2-88 href=#__codelineno-2-88></a>enable_ipvs<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-2-89 name=__codelineno-2-89 href=#__codelineno-2-89></a>sudo<span class=w> </span>apt<span class=w> </span>-y<span class=w> </span>install<span class=w> </span>ipvsadm
<a id=__codelineno-2-90 name=__codelineno-2-90 href=#__codelineno-2-90></a>sudo<span class=w> </span>mkdir<span class=w> </span>-p<span class=w> </span>/etc/sysconfig/modules/
<a id=__codelineno-2-91 name=__codelineno-2-91 href=#__codelineno-2-91></a>sudo<span class=w> </span>sh<span class=w> </span>-c<span class=w> </span><span class=s1>&#39;cat &gt; /etc/sysconfig/modules/ipvs.modules &lt;&lt;EOF</span>
<a id=__codelineno-2-92 name=__codelineno-2-92 href=#__codelineno-2-92></a><span class=s1>#!/bin/bash</span>
<a id=__codelineno-2-93 name=__codelineno-2-93 href=#__codelineno-2-93></a><span class=s1>modprobe -- ip_vs</span>
<a id=__codelineno-2-94 name=__codelineno-2-94 href=#__codelineno-2-94></a><span class=s1>modprobe -- ip_vs_rr</span>
<a id=__codelineno-2-95 name=__codelineno-2-95 href=#__codelineno-2-95></a><span class=s1>modprobe -- ip_vs_wrr</span>
<a id=__codelineno-2-96 name=__codelineno-2-96 href=#__codelineno-2-96></a><span class=s1>modprobe -- ip_vs_sh</span>
<a id=__codelineno-2-97 name=__codelineno-2-97 href=#__codelineno-2-97></a><span class=s1>modprobe -- nf_conntrack</span>
<a id=__codelineno-2-98 name=__codelineno-2-98 href=#__codelineno-2-98></a><span class=s1>EOF&#39;</span>
<a id=__codelineno-2-99 name=__codelineno-2-99 href=#__codelineno-2-99></a>
<a id=__codelineno-2-100 name=__codelineno-2-100 href=#__codelineno-2-100></a>sudo<span class=w> </span>chmod<span class=w> </span><span class=m>755</span><span class=w> </span>/etc/sysconfig/modules/ipvs.modules
<a id=__codelineno-2-101 name=__codelineno-2-101 href=#__codelineno-2-101></a>sudo<span class=w> </span>bash<span class=w> </span>/etc/sysconfig/modules/ipvs.modules
<a id=__codelineno-2-102 name=__codelineno-2-102 href=#__codelineno-2-102></a>sudo<span class=w> </span>lsmod<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>-e<span class=w> </span>-ip_vs<span class=w> </span>-e<span class=w> </span>nf_conntrack
<a id=__codelineno-2-103 name=__codelineno-2-103 href=#__codelineno-2-103></a><span class=o>}</span>
<a id=__codelineno-2-104 name=__codelineno-2-104 href=#__codelineno-2-104></a>
<a id=__codelineno-2-105 name=__codelineno-2-105 href=#__codelineno-2-105></a>install_containerd<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-2-106 name=__codelineno-2-106 href=#__codelineno-2-106></a><span class=nb>cd</span><span class=w> </span>/tmp<span class=w> </span><span class=o>||</span><span class=w> </span><span class=nb>exit</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-2-107 name=__codelineno-2-107 href=#__codelineno-2-107></a>sudo<span class=w> </span>wget<span class=w> </span>https://github.com/containerd/containerd/releases/download/v<span class=s2>&quot;</span><span class=si>${</span><span class=nv>containerd_version</span><span class=si>}</span><span class=s2>&quot;</span>/containerd-<span class=s2>&quot;</span><span class=si>${</span><span class=nv>containerd_version</span><span class=si>}</span><span class=s2>&quot;</span>-linux-amd64.tar.gz
<a id=__codelineno-2-108 name=__codelineno-2-108 href=#__codelineno-2-108></a>sudo<span class=w> </span>tar<span class=w> </span>xfv<span class=w> </span>containerd-<span class=s2>&quot;</span><span class=si>${</span><span class=nv>containerd_version</span><span class=si>}</span><span class=s2>&quot;</span>-linux-amd64.tar.gz
<a id=__codelineno-2-109 name=__codelineno-2-109 href=#__codelineno-2-109></a>sudo<span class=w> </span>cp<span class=w> </span>bin/*<span class=w> </span>/usr/bin/
<a id=__codelineno-2-110 name=__codelineno-2-110 href=#__codelineno-2-110></a>
<a id=__codelineno-2-111 name=__codelineno-2-111 href=#__codelineno-2-111></a>sudo<span class=w> </span>sh<span class=w> </span>-c<span class=w> </span><span class=s1>&#39;cat &gt; /lib/systemd/system/containerd.service &lt;&lt; EOF</span>
<a id=__codelineno-2-112 name=__codelineno-2-112 href=#__codelineno-2-112></a><span class=s1># Copyright The containerd Authors.</span>
<a id=__codelineno-2-113 name=__codelineno-2-113 href=#__codelineno-2-113></a><span class=s1>#</span>
<a id=__codelineno-2-114 name=__codelineno-2-114 href=#__codelineno-2-114></a><span class=s1># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<a id=__codelineno-2-115 name=__codelineno-2-115 href=#__codelineno-2-115></a><span class=s1># you may not use this file except in compliance with the License.</span>
<a id=__codelineno-2-116 name=__codelineno-2-116 href=#__codelineno-2-116></a><span class=s1># You may obtain a copy of the License at</span>
<a id=__codelineno-2-117 name=__codelineno-2-117 href=#__codelineno-2-117></a><span class=s1>#</span>
<a id=__codelineno-2-118 name=__codelineno-2-118 href=#__codelineno-2-118></a><span class=s1>#     http://www.apache.org/licenses/LICENSE-2.0</span>
<a id=__codelineno-2-119 name=__codelineno-2-119 href=#__codelineno-2-119></a><span class=s1>#</span>
<a id=__codelineno-2-120 name=__codelineno-2-120 href=#__codelineno-2-120></a><span class=s1># Unless required by applicable law or agreed to in writing, software</span>
<a id=__codelineno-2-121 name=__codelineno-2-121 href=#__codelineno-2-121></a><span class=s1># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<a id=__codelineno-2-122 name=__codelineno-2-122 href=#__codelineno-2-122></a><span class=s1># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<a id=__codelineno-2-123 name=__codelineno-2-123 href=#__codelineno-2-123></a><span class=s1># See the License for the specific language governing permissions and</span>
<a id=__codelineno-2-124 name=__codelineno-2-124 href=#__codelineno-2-124></a><span class=s1># limitations under the License.</span>
<a id=__codelineno-2-125 name=__codelineno-2-125 href=#__codelineno-2-125></a>
<a id=__codelineno-2-126 name=__codelineno-2-126 href=#__codelineno-2-126></a><span class=s1>[Unit]</span>
<a id=__codelineno-2-127 name=__codelineno-2-127 href=#__codelineno-2-127></a><span class=s1>Description=containerd container runtime</span>
<a id=__codelineno-2-128 name=__codelineno-2-128 href=#__codelineno-2-128></a><span class=s1>Documentation=https://containerd.io</span>
<a id=__codelineno-2-129 name=__codelineno-2-129 href=#__codelineno-2-129></a><span class=s1>After=network.target local-fs.target</span>
<a id=__codelineno-2-130 name=__codelineno-2-130 href=#__codelineno-2-130></a>
<a id=__codelineno-2-131 name=__codelineno-2-131 href=#__codelineno-2-131></a><span class=s1>[Service]</span>
<a id=__codelineno-2-132 name=__codelineno-2-132 href=#__codelineno-2-132></a><span class=s1>ExecStartPre=-/sbin/modprobe overlay</span>
<a id=__codelineno-2-133 name=__codelineno-2-133 href=#__codelineno-2-133></a><span class=s1>ExecStart=/usr/bin/containerd</span>
<a id=__codelineno-2-134 name=__codelineno-2-134 href=#__codelineno-2-134></a>
<a id=__codelineno-2-135 name=__codelineno-2-135 href=#__codelineno-2-135></a><span class=s1>Type=notify</span>
<a id=__codelineno-2-136 name=__codelineno-2-136 href=#__codelineno-2-136></a><span class=s1>Delegate=yes</span>
<a id=__codelineno-2-137 name=__codelineno-2-137 href=#__codelineno-2-137></a><span class=s1>KillMode=process</span>
<a id=__codelineno-2-138 name=__codelineno-2-138 href=#__codelineno-2-138></a><span class=s1>Restart=always</span>
<a id=__codelineno-2-139 name=__codelineno-2-139 href=#__codelineno-2-139></a><span class=s1>RestartSec=5</span>
<a id=__codelineno-2-140 name=__codelineno-2-140 href=#__codelineno-2-140></a><span class=s1># Having non-zero Limit*s causes performance problems due to accounting overhead</span>
<a id=__codelineno-2-141 name=__codelineno-2-141 href=#__codelineno-2-141></a><span class=s1># in the kernel. We recommend using cgroups to do container-local accounting.</span>
<a id=__codelineno-2-142 name=__codelineno-2-142 href=#__codelineno-2-142></a><span class=s1>LimitNPROC=infinity</span>
<a id=__codelineno-2-143 name=__codelineno-2-143 href=#__codelineno-2-143></a><span class=s1>LimitCORE=infinity</span>
<a id=__codelineno-2-144 name=__codelineno-2-144 href=#__codelineno-2-144></a><span class=s1>LimitNOFILE=infinity</span>
<a id=__codelineno-2-145 name=__codelineno-2-145 href=#__codelineno-2-145></a><span class=s1># Comment TasksMax if your systemd version does not supports it.</span>
<a id=__codelineno-2-146 name=__codelineno-2-146 href=#__codelineno-2-146></a><span class=s1># Only systemd 226 and above support this version.</span>
<a id=__codelineno-2-147 name=__codelineno-2-147 href=#__codelineno-2-147></a><span class=s1>TasksMax=infinity</span>
<a id=__codelineno-2-148 name=__codelineno-2-148 href=#__codelineno-2-148></a><span class=s1>OOMScoreAdjust=-999</span>
<a id=__codelineno-2-149 name=__codelineno-2-149 href=#__codelineno-2-149></a>
<a id=__codelineno-2-150 name=__codelineno-2-150 href=#__codelineno-2-150></a><span class=s1>[Install]</span>
<a id=__codelineno-2-151 name=__codelineno-2-151 href=#__codelineno-2-151></a><span class=s1>WantedBy=multi-user.target</span>
<a id=__codelineno-2-152 name=__codelineno-2-152 href=#__codelineno-2-152></a><span class=s1>EOF&#39;</span>
<a id=__codelineno-2-153 name=__codelineno-2-153 href=#__codelineno-2-153></a>
<a id=__codelineno-2-154 name=__codelineno-2-154 href=#__codelineno-2-154></a>
<a id=__codelineno-2-155 name=__codelineno-2-155 href=#__codelineno-2-155></a>sudo<span class=w> </span>sh<span class=w> </span>-c<span class=w> </span><span class=s1>&#39;cat &gt; /etc/crictl.yaml&lt;&lt;-&#39;</span>EOF<span class=s1>&#39;</span>
<a id=__codelineno-2-156 name=__codelineno-2-156 href=#__codelineno-2-156></a><span class=s1>runtime-endpoint: unix:///run/containerd/containerd.sock</span>
<a id=__codelineno-2-157 name=__codelineno-2-157 href=#__codelineno-2-157></a><span class=s1>image-endpoint: unix:///run/containerd/containerd.sock</span>
<a id=__codelineno-2-158 name=__codelineno-2-158 href=#__codelineno-2-158></a><span class=s1>timeout: 10</span>
<a id=__codelineno-2-159 name=__codelineno-2-159 href=#__codelineno-2-159></a><span class=s1>debug: false</span>
<a id=__codelineno-2-160 name=__codelineno-2-160 href=#__codelineno-2-160></a><span class=s1>EOF&#39;</span>
<a id=__codelineno-2-161 name=__codelineno-2-161 href=#__codelineno-2-161></a>
<a id=__codelineno-2-162 name=__codelineno-2-162 href=#__codelineno-2-162></a>
<a id=__codelineno-2-163 name=__codelineno-2-163 href=#__codelineno-2-163></a><span class=c1># 安装runc</span>
<a id=__codelineno-2-164 name=__codelineno-2-164 href=#__codelineno-2-164></a><span class=c1># runc是容器运行时，runc实现了容器的init，run，create，ps...我们在运行容器所需要的cmd：</span>
<a id=__codelineno-2-165 name=__codelineno-2-165 href=#__codelineno-2-165></a><span class=c1># https://github.com/opencontainers/runc/releases</span>
<a id=__codelineno-2-166 name=__codelineno-2-166 href=#__codelineno-2-166></a>sudo<span class=w> </span>wget<span class=w> </span>https://github.com/opencontainers/runc/releases/download/v1.1.6/runc.amd64
<a id=__codelineno-2-167 name=__codelineno-2-167 href=#__codelineno-2-167></a>sudo<span class=w> </span>chmod<span class=w> </span>a+x<span class=w> </span>runc.amd64
<a id=__codelineno-2-168 name=__codelineno-2-168 href=#__codelineno-2-168></a>sudo<span class=w> </span>mv<span class=w> </span>runc.amd64<span class=w> </span>/usr/bin/runc
<a id=__codelineno-2-169 name=__codelineno-2-169 href=#__codelineno-2-169></a>
<a id=__codelineno-2-170 name=__codelineno-2-170 href=#__codelineno-2-170></a><span class=c1># 修改containerd的配置，因为containerd默认从k8s官网拉取镜像</span>
<a id=__codelineno-2-171 name=__codelineno-2-171 href=#__codelineno-2-171></a>sudo<span class=w> </span>mkdir<span class=w> </span>-p<span class=w> </span>/etc/containerd
<a id=__codelineno-2-172 name=__codelineno-2-172 href=#__codelineno-2-172></a><span class=c1># 把containerd配置导出到文件</span>
<a id=__codelineno-2-173 name=__codelineno-2-173 href=#__codelineno-2-173></a>sudo<span class=w> </span>sh<span class=w> </span>-c<span class=w> </span><span class=s1>&#39;containerd config default &gt; /etc/containerd/config.toml&#39;</span>
<a id=__codelineno-2-174 name=__codelineno-2-174 href=#__codelineno-2-174></a>sudo<span class=w> </span>sh<span class=w> </span>-c<span class=w> </span><span class=s1>&#39;cp /etc/containerd/config.toml /etc/containerd/config.toml.backup&#39;</span>
<a id=__codelineno-2-175 name=__codelineno-2-175 href=#__codelineno-2-175></a>
<a id=__codelineno-2-176 name=__codelineno-2-176 href=#__codelineno-2-176></a><span class=c1># 修改配置文件</span>
<a id=__codelineno-2-177 name=__codelineno-2-177 href=#__codelineno-2-177></a><span class=c1>#sudo sed -i &quot;s#registry.k8s.io/pause#registry.aliyuncs.com/google_containers/pause#g&quot;  /etc/containerd/config.toml</span>
<a id=__codelineno-2-178 name=__codelineno-2-178 href=#__codelineno-2-178></a>sudo<span class=w> </span>sed<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;s#SystemdCgroup = false#SystemdCgroup = true#g&#39;</span><span class=w> </span>/etc/containerd/config.toml
<a id=__codelineno-2-179 name=__codelineno-2-179 href=#__codelineno-2-179></a>sudo<span class=w> </span>sed<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;s#config_path = &quot;&quot;#config_path = &quot;/etc/containerd/certs.d&quot;#g&#39;</span><span class=w> </span>/etc/containerd/config.toml
<a id=__codelineno-2-180 name=__codelineno-2-180 href=#__codelineno-2-180></a>
<a id=__codelineno-2-181 name=__codelineno-2-181 href=#__codelineno-2-181></a>
<a id=__codelineno-2-182 name=__codelineno-2-182 href=#__codelineno-2-182></a><span class=c1># 创建镜像加速的目录</span>
<a id=__codelineno-2-183 name=__codelineno-2-183 href=#__codelineno-2-183></a><span class=c1>#sudo mkdir /etc/containerd/certs.d/docker.io -pv</span>
<a id=__codelineno-2-184 name=__codelineno-2-184 href=#__codelineno-2-184></a><span class=c1>#sudo mkdir /etc/containerd/certs.d/quay.io -pv</span>
<a id=__codelineno-2-185 name=__codelineno-2-185 href=#__codelineno-2-185></a><span class=c1>#sudo mkdir /etc/containerd/certs.d/gcr.io -pv</span>
<a id=__codelineno-2-186 name=__codelineno-2-186 href=#__codelineno-2-186></a><span class=c1>#sudo mkdir /etc/containerd/certs.d/k8s.gcr.io -pv</span>
<a id=__codelineno-2-187 name=__codelineno-2-187 href=#__codelineno-2-187></a>sudo<span class=w> </span>mkdir<span class=w> </span>/etc/containerd/certs.d/harbor.io<span class=w> </span>-pv
<a id=__codelineno-2-188 name=__codelineno-2-188 href=#__codelineno-2-188></a>
<a id=__codelineno-2-189 name=__codelineno-2-189 href=#__codelineno-2-189></a>
<a id=__codelineno-2-190 name=__codelineno-2-190 href=#__codelineno-2-190></a>sudo<span class=w> </span>sh<span class=w> </span>-c<span class=w> </span><span class=s1>&#39;cat &gt; /etc/containerd/certs.d/harbor.io/hosts.toml &lt;&lt; EOF</span>
<a id=__codelineno-2-191 name=__codelineno-2-191 href=#__codelineno-2-191></a><span class=s1>server = &quot;https://hub.gitee.com&quot;</span>
<a id=__codelineno-2-192 name=__codelineno-2-192 href=#__codelineno-2-192></a><span class=s1>[host.&quot;https://hub.gitee.com&quot;]</span>
<a id=__codelineno-2-193 name=__codelineno-2-193 href=#__codelineno-2-193></a><span class=s1>  capabilities = [&quot;pull&quot;, &quot;resolve&quot;, &quot;push&quot;]</span>
<a id=__codelineno-2-194 name=__codelineno-2-194 href=#__codelineno-2-194></a><span class=s1>  skip_verify = true</span>
<a id=__codelineno-2-195 name=__codelineno-2-195 href=#__codelineno-2-195></a><span class=s1>EOF&#39;</span>
<a id=__codelineno-2-196 name=__codelineno-2-196 href=#__codelineno-2-196></a>
<a id=__codelineno-2-197 name=__codelineno-2-197 href=#__codelineno-2-197></a>
<a id=__codelineno-2-198 name=__codelineno-2-198 href=#__codelineno-2-198></a><span class=c1># 配置加速</span>
<a id=__codelineno-2-199 name=__codelineno-2-199 href=#__codelineno-2-199></a><span class=c1>#sudo sh -c &#39;cat &gt; /etc/containerd/certs.d/docker.io/hosts.toml &lt;&lt; EOF</span>
<a id=__codelineno-2-200 name=__codelineno-2-200 href=#__codelineno-2-200></a><span class=c1>#server = &quot;https://docker.io&quot;</span>
<a id=__codelineno-2-201 name=__codelineno-2-201 href=#__codelineno-2-201></a><span class=c1>#[host.&quot;https://registry-1.docker.io&quot;]</span>
<a id=__codelineno-2-202 name=__codelineno-2-202 href=#__codelineno-2-202></a><span class=c1>#  capabilities = [&quot;pull&quot;, &quot;resolve&quot;]</span>
<a id=__codelineno-2-203 name=__codelineno-2-203 href=#__codelineno-2-203></a><span class=c1>#EOF&#39;</span>
<a id=__codelineno-2-204 name=__codelineno-2-204 href=#__codelineno-2-204></a>
<a id=__codelineno-2-205 name=__codelineno-2-205 href=#__codelineno-2-205></a><span class=c1>#sudo sh -c &#39;cat &gt; /etc/containerd/certs.d/quay.io/hosts.toml &lt;&lt; EOF</span>
<a id=__codelineno-2-206 name=__codelineno-2-206 href=#__codelineno-2-206></a><span class=c1>#server = &quot;https://quay.io&quot;</span>
<a id=__codelineno-2-207 name=__codelineno-2-207 href=#__codelineno-2-207></a><span class=c1>#[host.&quot;https://quay.mirrors.ustc.edu.cn&quot;]</span>
<a id=__codelineno-2-208 name=__codelineno-2-208 href=#__codelineno-2-208></a><span class=c1>#  capabilities = [&quot;pull&quot;, &quot;resolve&quot;]</span>
<a id=__codelineno-2-209 name=__codelineno-2-209 href=#__codelineno-2-209></a><span class=c1>#  skip_verify = true</span>
<a id=__codelineno-2-210 name=__codelineno-2-210 href=#__codelineno-2-210></a><span class=c1>#EOF&#39;</span>
<a id=__codelineno-2-211 name=__codelineno-2-211 href=#__codelineno-2-211></a><span class=c1>#</span>
<a id=__codelineno-2-212 name=__codelineno-2-212 href=#__codelineno-2-212></a><span class=c1>#sudo sh -c &#39;cat &gt; /etc/containerd/certs.d/gcr.io/hosts.toml &lt;&lt; EOF</span>
<a id=__codelineno-2-213 name=__codelineno-2-213 href=#__codelineno-2-213></a><span class=c1>#server = &quot;https://gcr.io&quot;</span>
<a id=__codelineno-2-214 name=__codelineno-2-214 href=#__codelineno-2-214></a><span class=c1>#[host.&quot;https://gcr.mirrors.ustc.edu.cn&quot;]</span>
<a id=__codelineno-2-215 name=__codelineno-2-215 href=#__codelineno-2-215></a><span class=c1>#  capabilities = [&quot;pull&quot;, &quot;resolve&quot;]</span>
<a id=__codelineno-2-216 name=__codelineno-2-216 href=#__codelineno-2-216></a><span class=c1>#  skip_verify = true</span>
<a id=__codelineno-2-217 name=__codelineno-2-217 href=#__codelineno-2-217></a><span class=c1>#EOF&#39;</span>
<a id=__codelineno-2-218 name=__codelineno-2-218 href=#__codelineno-2-218></a><span class=c1>#</span>
<a id=__codelineno-2-219 name=__codelineno-2-219 href=#__codelineno-2-219></a><span class=c1>#sudo sh -c &#39;cat &gt; /etc/containerd/certs.d/k8s.gcr.io/hosts.toml &lt;&lt; EOF</span>
<a id=__codelineno-2-220 name=__codelineno-2-220 href=#__codelineno-2-220></a><span class=c1>#server = &quot;https://k8s.gcr.io&quot;</span>
<a id=__codelineno-2-221 name=__codelineno-2-221 href=#__codelineno-2-221></a><span class=c1>#[host.&quot;https://gcr.mirrors.ustc.edu.cn/google-containers/&quot;]</span>
<a id=__codelineno-2-222 name=__codelineno-2-222 href=#__codelineno-2-222></a><span class=c1>#  capabilities = [&quot;pull&quot;, &quot;resolve&quot;]</span>
<a id=__codelineno-2-223 name=__codelineno-2-223 href=#__codelineno-2-223></a><span class=c1>#  skip_verify = true</span>
<a id=__codelineno-2-224 name=__codelineno-2-224 href=#__codelineno-2-224></a><span class=c1>#EOF&#39;</span>
<a id=__codelineno-2-225 name=__codelineno-2-225 href=#__codelineno-2-225></a>
<a id=__codelineno-2-226 name=__codelineno-2-226 href=#__codelineno-2-226></a>
<a id=__codelineno-2-227 name=__codelineno-2-227 href=#__codelineno-2-227></a><span class=c1># 加载containerd的内核模块 创建配置文件</span>
<a id=__codelineno-2-228 name=__codelineno-2-228 href=#__codelineno-2-228></a>sudo<span class=w> </span>sh<span class=w> </span>-c<span class=w> </span><span class=s1>&#39;cat &lt;&lt;EOF | sudo tee /etc/modules-load.d/containerd.conf</span>
<a id=__codelineno-2-229 name=__codelineno-2-229 href=#__codelineno-2-229></a><span class=s1>overlay</span>
<a id=__codelineno-2-230 name=__codelineno-2-230 href=#__codelineno-2-230></a><span class=s1>br_netfilter</span>
<a id=__codelineno-2-231 name=__codelineno-2-231 href=#__codelineno-2-231></a><span class=s1>EOF&#39;</span>
<a id=__codelineno-2-232 name=__codelineno-2-232 href=#__codelineno-2-232></a>
<a id=__codelineno-2-233 name=__codelineno-2-233 href=#__codelineno-2-233></a><span class=c1># 将LimitNOFILE设置一个合适的值</span>
<a id=__codelineno-2-234 name=__codelineno-2-234 href=#__codelineno-2-234></a>sudo<span class=w> </span>mkdir<span class=w> </span>/etc/systemd/system/containerd.service.d<span class=w> </span>-pv
<a id=__codelineno-2-235 name=__codelineno-2-235 href=#__codelineno-2-235></a>sudo<span class=w> </span>sh<span class=w> </span>-c<span class=w> </span><span class=s1>&#39;cat &gt;/etc/systemd/system/containerd.service.d/LimitNOFILE.conf&lt;&lt;EOF</span>
<a id=__codelineno-2-236 name=__codelineno-2-236 href=#__codelineno-2-236></a><span class=s1>[Service]</span>
<a id=__codelineno-2-237 name=__codelineno-2-237 href=#__codelineno-2-237></a><span class=s1>LimitNOFILE=1048576</span>
<a id=__codelineno-2-238 name=__codelineno-2-238 href=#__codelineno-2-238></a><span class=s1>EOF&#39;</span>
<a id=__codelineno-2-239 name=__codelineno-2-239 href=#__codelineno-2-239></a>
<a id=__codelineno-2-240 name=__codelineno-2-240 href=#__codelineno-2-240></a><span class=c1>#执行以下命令使配置生效</span>
<a id=__codelineno-2-241 name=__codelineno-2-241 href=#__codelineno-2-241></a>sudo<span class=w> </span>modprobe<span class=w> </span>overlay
<a id=__codelineno-2-242 name=__codelineno-2-242 href=#__codelineno-2-242></a>sudo<span class=w> </span>modprobe<span class=w> </span>br_netfilter
<a id=__codelineno-2-243 name=__codelineno-2-243 href=#__codelineno-2-243></a>
<a id=__codelineno-2-244 name=__codelineno-2-244 href=#__codelineno-2-244></a>sudo<span class=w> </span>systemctl<span class=w> </span>daemon-reload
<a id=__codelineno-2-245 name=__codelineno-2-245 href=#__codelineno-2-245></a>sudo<span class=w> </span>systemctl<span class=w> </span><span class=nb>enable</span><span class=w> </span>--now<span class=w> </span>containerd
<a id=__codelineno-2-246 name=__codelineno-2-246 href=#__codelineno-2-246></a>sudo<span class=w> </span>systemctl<span class=w> </span>status<span class=w> </span>containerd
<a id=__codelineno-2-247 name=__codelineno-2-247 href=#__codelineno-2-247></a><span class=c1>#containerd -v</span>
<a id=__codelineno-2-248 name=__codelineno-2-248 href=#__codelineno-2-248></a><span class=o>}</span>
<a id=__codelineno-2-249 name=__codelineno-2-249 href=#__codelineno-2-249></a>
<a id=__codelineno-2-250 name=__codelineno-2-250 href=#__codelineno-2-250></a>install_nerdctl<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-2-251 name=__codelineno-2-251 href=#__codelineno-2-251></a><span class=nb>cd</span><span class=w> </span>/tmp<span class=w> </span><span class=o>||</span><span class=w> </span><span class=nb>exit</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-2-252 name=__codelineno-2-252 href=#__codelineno-2-252></a>sudo<span class=w> </span>wget<span class=w> </span>https://github.com/containerd/nerdctl/releases/download/v1.3.0/nerdctl-1.3.0-linux-amd64.tar.gz
<a id=__codelineno-2-253 name=__codelineno-2-253 href=#__codelineno-2-253></a>sudo<span class=w> </span>tar<span class=w> </span>xfv<span class=w> </span>nerdctl-1.3.0-linux-amd64.tar.gz<span class=w> </span>-C<span class=w> </span>/usr/bin/
<a id=__codelineno-2-254 name=__codelineno-2-254 href=#__codelineno-2-254></a><span class=c1>#nerdctl version</span>
<a id=__codelineno-2-255 name=__codelineno-2-255 href=#__codelineno-2-255></a>
<a id=__codelineno-2-256 name=__codelineno-2-256 href=#__codelineno-2-256></a><span class=c1># nerdctl 配置文件</span>
<a id=__codelineno-2-257 name=__codelineno-2-257 href=#__codelineno-2-257></a>sudo<span class=w> </span>mkdir<span class=w> </span>/etc/nerdctl/<span class=w> </span>-pv
<a id=__codelineno-2-258 name=__codelineno-2-258 href=#__codelineno-2-258></a>sudo<span class=w> </span>sh<span class=w> </span>-c<span class=w> </span><span class=s1>&#39;cat &gt; /etc/nerdctl/config.toml &lt;&lt;EOF</span>
<a id=__codelineno-2-259 name=__codelineno-2-259 href=#__codelineno-2-259></a><span class=s1>namespace = &quot;k8s.io&quot;</span>
<a id=__codelineno-2-260 name=__codelineno-2-260 href=#__codelineno-2-260></a><span class=s1>debug = false</span>
<a id=__codelineno-2-261 name=__codelineno-2-261 href=#__codelineno-2-261></a><span class=s1>debug_full = false</span>
<a id=__codelineno-2-262 name=__codelineno-2-262 href=#__codelineno-2-262></a><span class=s1>insecure_registry = true</span>
<a id=__codelineno-2-263 name=__codelineno-2-263 href=#__codelineno-2-263></a><span class=s1>EOF&#39;</span>
<a id=__codelineno-2-264 name=__codelineno-2-264 href=#__codelineno-2-264></a>
<a id=__codelineno-2-265 name=__codelineno-2-265 href=#__codelineno-2-265></a><span class=c1># 安装 CNI</span>
<a id=__codelineno-2-266 name=__codelineno-2-266 href=#__codelineno-2-266></a>sudo<span class=w> </span>wget<span class=w> </span>https://github.com/containernetworking/plugins/releases/download/v1.2.0/cni-plugins-linux-amd64-v1.2.0.tgz
<a id=__codelineno-2-267 name=__codelineno-2-267 href=#__codelineno-2-267></a>sudo<span class=w> </span>mkdir<span class=w> </span>/opt/cni/bin<span class=w> </span>-p
<a id=__codelineno-2-268 name=__codelineno-2-268 href=#__codelineno-2-268></a>sudo<span class=w> </span>tar<span class=w> </span>xfv<span class=w> </span>cni-plugins-linux-amd64-v1.2.0.tgz<span class=w> </span>-C<span class=w> </span>/opt/cni/bin/
<a id=__codelineno-2-269 name=__codelineno-2-269 href=#__codelineno-2-269></a><span class=o>}</span>
<a id=__codelineno-2-270 name=__codelineno-2-270 href=#__codelineno-2-270></a>
<a id=__codelineno-2-271 name=__codelineno-2-271 href=#__codelineno-2-271></a>install_kubeadm_kubelet_or_kubectl<span class=w> </span><span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-2-272 name=__codelineno-2-272 href=#__codelineno-2-272></a>sudo<span class=w> </span>sh<span class=w> </span>-c<span class=w> </span><span class=s1>&#39;curl https://packages.cloud.google.com/apt/doc/apt-key.gpg | apt-key add -&#39;</span>
<a id=__codelineno-2-273 name=__codelineno-2-273 href=#__codelineno-2-273></a>sudo<span class=w> </span>sh<span class=w> </span>-c<span class=w> </span><span class=s1>&#39;cat &gt; /etc/apt/sources.list.d/kubernetes.list &lt;&lt; EOF</span>
<a id=__codelineno-2-274 name=__codelineno-2-274 href=#__codelineno-2-274></a><span class=s1>deb https://apt.kubernetes.io/ kubernetes-xenial main</span>
<a id=__codelineno-2-275 name=__codelineno-2-275 href=#__codelineno-2-275></a><span class=s1>EOF&#39;</span>
<a id=__codelineno-2-276 name=__codelineno-2-276 href=#__codelineno-2-276></a>
<a id=__codelineno-2-277 name=__codelineno-2-277 href=#__codelineno-2-277></a>sudo<span class=w> </span>apt<span class=w> </span>update
<a id=__codelineno-2-278 name=__codelineno-2-278 href=#__codelineno-2-278></a>
<a id=__codelineno-2-279 name=__codelineno-2-279 href=#__codelineno-2-279></a><span class=c1># 在3个节点都安装kubeadm、kubectl和kubelet，其中 kubectl 在工作节点是可选的可以不安装</span>
<a id=__codelineno-2-280 name=__codelineno-2-280 href=#__codelineno-2-280></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$role</span><span class=s2>&quot;</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s2>&quot;master&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-2-281 name=__codelineno-2-281 href=#__codelineno-2-281></a><span class=w>  </span><span class=c1>#sudo apt install -y --allow-change-held-packages kubeadm=1.26.3-00 kubectl=1.26.3-00 kubelet=1.26.3-00</span>
<a id=__codelineno-2-282 name=__codelineno-2-282 href=#__codelineno-2-282></a><span class=w>  </span>sudo<span class=w> </span>apt<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>--allow-change-held-packages<span class=w> </span><span class=nv>kubeadm</span><span class=o>=</span><span class=si>${</span><span class=nv>kubernetes_version</span><span class=si>}</span>-00<span class=w> </span><span class=nv>kubectl</span><span class=o>=</span><span class=si>${</span><span class=nv>kubernetes_version</span><span class=si>}</span>-00<span class=w> </span><span class=nv>kubelet</span><span class=o>=</span><span class=si>${</span><span class=nv>kubernetes_version</span><span class=si>}</span>-00
<a id=__codelineno-2-283 name=__codelineno-2-283 href=#__codelineno-2-283></a><span class=w>  </span>sudo<span class=w> </span>apt-mark<span class=w> </span>hold<span class=w> </span>kubeadm<span class=w> </span>kubelet
<a id=__codelineno-2-284 name=__codelineno-2-284 href=#__codelineno-2-284></a><span class=w>  </span>sudo<span class=w> </span>systemctl<span class=w> </span><span class=nb>enable</span><span class=w> </span>kubelet.service
<a id=__codelineno-2-285 name=__codelineno-2-285 href=#__codelineno-2-285></a><span class=k>else</span>
<a id=__codelineno-2-286 name=__codelineno-2-286 href=#__codelineno-2-286></a><span class=w>  </span>sudo<span class=w> </span>apt<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>--allow-change-held-packages<span class=w> </span><span class=nv>kubeadm</span><span class=o>=</span><span class=si>${</span><span class=nv>kubernetes_version</span><span class=si>}</span>-00<span class=w> </span><span class=nv>kubelet</span><span class=o>=</span><span class=si>${</span><span class=nv>kubernetes_version</span><span class=si>}</span>-00
<a id=__codelineno-2-287 name=__codelineno-2-287 href=#__codelineno-2-287></a><span class=w>  </span>sudo<span class=w> </span>apt-mark<span class=w> </span>hold<span class=w> </span>kubeadm<span class=w> </span>kubelet
<a id=__codelineno-2-288 name=__codelineno-2-288 href=#__codelineno-2-288></a><span class=w>  </span>sudo<span class=w> </span>systemctl<span class=w> </span><span class=nb>enable</span><span class=w> </span>kubelet.service
<a id=__codelineno-2-289 name=__codelineno-2-289 href=#__codelineno-2-289></a><span class=k>fi</span>
<a id=__codelineno-2-290 name=__codelineno-2-290 href=#__codelineno-2-290></a><span class=o>}</span>
<a id=__codelineno-2-291 name=__codelineno-2-291 href=#__codelineno-2-291></a>
<a id=__codelineno-2-292 name=__codelineno-2-292 href=#__codelineno-2-292></a>
<a id=__codelineno-2-293 name=__codelineno-2-293 href=#__codelineno-2-293></a>main<span class=w> </span><span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-2-294 name=__codelineno-2-294 href=#__codelineno-2-294></a><span class=w>  </span>set_kubernetes_cri_config
<a id=__codelineno-2-295 name=__codelineno-2-295 href=#__codelineno-2-295></a><span class=w>  </span>kernel_parameter_optimization
<a id=__codelineno-2-296 name=__codelineno-2-296 href=#__codelineno-2-296></a><span class=w>  </span>enable_ipvs
<a id=__codelineno-2-297 name=__codelineno-2-297 href=#__codelineno-2-297></a><span class=w>  </span>install_containerd
<a id=__codelineno-2-298 name=__codelineno-2-298 href=#__codelineno-2-298></a><span class=w>  </span>install_nerdctl
<a id=__codelineno-2-299 name=__codelineno-2-299 href=#__codelineno-2-299></a><span class=w>  </span>install_kubeadm_kubelet_or_kubectl
<a id=__codelineno-2-300 name=__codelineno-2-300 href=#__codelineno-2-300></a><span class=o>}</span>
<a id=__codelineno-2-301 name=__codelineno-2-301 href=#__codelineno-2-301></a>
<a id=__codelineno-2-302 name=__codelineno-2-302 href=#__codelineno-2-302></a>main
</code></pre></div> <div class=highlight><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=c1># 安装master节点</span>
<a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a>$<span class=w> </span>bash<span class=w> </span>post_reboot.sh<span class=w> </span><span class=m>1</span>.26.3<span class=w> </span><span class=m>1</span>.6.20<span class=w> </span>master
<a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a><span class=c1># 安装node节点</span>
<a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a>$<span class=w> </span>bash<span class=w> </span>post_reboot.sh<span class=w> </span><span class=m>1</span>.26.3<span class=w> </span><span class=m>1</span>.6.20<span class=w> </span>node
</code></pre></div> <div class=highlight><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=c1># 安装完后版本查看</span>
<a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a>root@gitee-kubernetes-master1:/tmp#<span class=w> </span>kubelet<span class=w> </span>--version
<a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a>Kubernetes<span class=w> </span>v1.26.3
<a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a>root@gitee-kubernetes-master1:/tmp#<span class=w> </span>kubectl<span class=w> </span>version
<a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a>WARNING:<span class=w> </span>This<span class=w> </span>version<span class=w> </span>information<span class=w> </span>is<span class=w> </span>deprecated<span class=w> </span>and<span class=w> </span>will<span class=w> </span>be<span class=w> </span>replaced<span class=w> </span>with<span class=w> </span>the<span class=w> </span>output<span class=w> </span>from<span class=w> </span>kubectl<span class=w> </span>version<span class=w> </span>--short.<span class=w>  </span>Use<span class=w> </span>--output<span class=o>=</span>yaml<span class=p>|</span>json<span class=w> </span>to<span class=w> </span>get<span class=w> </span>the<span class=w> </span>full<span class=w> </span>version.
<a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a>Client<span class=w> </span>Version:<span class=w> </span>version.Info<span class=o>{</span>Major:<span class=s2>&quot;1&quot;</span>,<span class=w> </span>Minor:<span class=s2>&quot;26&quot;</span>,<span class=w> </span>GitVersion:<span class=s2>&quot;v1.26.3&quot;</span>,<span class=w> </span>GitCommit:<span class=s2>&quot;9e644106593f3f4aa98f8a84b23db5fa378900bd&quot;</span>,<span class=w> </span>GitTreeState:<span class=s2>&quot;clean&quot;</span>,<span class=w> </span>BuildDate:<span class=s2>&quot;2023-03-15T13:40:17Z&quot;</span>,<span class=w> </span>GoVersion:<span class=s2>&quot;go1.19.7&quot;</span>,<span class=w> </span>Compiler:<span class=s2>&quot;gc&quot;</span>,<span class=w> </span>Platform:<span class=s2>&quot;linux/amd64&quot;</span><span class=o>}</span>
<a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a>Kustomize<span class=w> </span>Version:<span class=w> </span>v4.5.7
<a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a>The<span class=w> </span>connection<span class=w> </span>to<span class=w> </span>the<span class=w> </span>server<span class=w> </span>localhost:8080<span class=w> </span>was<span class=w> </span>refused<span class=w> </span>-<span class=w> </span>did<span class=w> </span>you<span class=w> </span>specify<span class=w> </span>the<span class=w> </span>right<span class=w> </span>host<span class=w> </span>or<span class=w> </span>port?
<a id=__codelineno-4-9 name=__codelineno-4-9 href=#__codelineno-4-9></a>root@gitee-kubernetes-master1:/tmp#<span class=w> </span>kubeadm<span class=w> </span>version
<a id=__codelineno-4-10 name=__codelineno-4-10 href=#__codelineno-4-10></a>kubeadm<span class=w> </span>version:<span class=w> </span><span class=p>&amp;</span>version.Info<span class=o>{</span>Major:<span class=s2>&quot;1&quot;</span>,<span class=w> </span>Minor:<span class=s2>&quot;26&quot;</span>,<span class=w> </span>GitVersion:<span class=s2>&quot;v1.26.3&quot;</span>,<span class=w> </span>GitCommit:<span class=s2>&quot;9e644106593f3f4aa98f8a84b23db5fa378900bd&quot;</span>,<span class=w> </span>GitTreeState:<span class=s2>&quot;clean&quot;</span>,<span class=w> </span>BuildDate:<span class=s2>&quot;2023-03-15T13:38:47Z&quot;</span>,<span class=w> </span>GoVersion:<span class=s2>&quot;go1.19.7&quot;</span>,<span class=w> </span>Compiler:<span class=s2>&quot;gc&quot;</span>,<span class=w> </span>Platform:<span class=s2>&quot;linux/amd64&quot;</span><span class=o>}</span>
</code></pre></div> <h3 id=43-安装-haproxy>4.3 安装 haproxy<a class=headerlink href=#43-安装-haproxy title="Permanent link">&para;</a></h3> <p>haproxy 是一个高性能的负载均衡系统。</p> <p>通过 haproxy 实现 3 个 apiserver 的负载均衡。</p> <p>以下操作分别在 master1、master2 和 master3 上进行。</p> <h4 id=安装-haproxy>安装 haproxy<a class=headerlink href=#安装-haproxy title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a>$<span class=w> </span>apt<span class=w> </span>-y<span class=w> </span>install<span class=w> </span>haproxy
<a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=c1># 当并发访问量足够大时，使得HAProxy所在服务器的端口用光，则后续无法向后端建立新的tcp连接导致负载均衡失败</span>
<a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=c1># 使用如下命令增加端口号</span>
<a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a>$<span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=m>1024</span><span class=w> </span><span class=m>61000</span><span class=w> </span>&gt;<span class=w> </span>/proc/sys/net/ipv4/ip_local_port_range
</code></pre></div> <h4 id=配置-haproxy>配置 haproxy<a class=headerlink href=#配置-haproxy title="Permanent link">&para;</a></h4> <p>所有 Master 节点配置 HAProxy（详细配置可参考 HAProxy 官方文档，所有 Master 节点的 HAProxy 配置相同）：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a>$<span class=w> </span>sudo<span class=w> </span>cp<span class=w> </span>-rf<span class=w> </span>/etc/haproxy/haproxy.cfg<span class=o>{</span>,.bak<span class=o>}</span>
<a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a>$<span class=w> </span>sudo<span class=w> </span>sh<span class=w> </span>-c<span class=w> </span><span class=s1>&#39;cat &gt; /etc/haproxy/haproxy.cfg &lt;&lt; EOF</span>
<a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a><span class=s1>#---------------------------------------------------------------------</span>
<a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a><span class=s1># Global settings</span>
<a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a><span class=s1>#---------------------------------------------------------------------</span>
<a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a><span class=s1>global</span>
<a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a><span class=s1>    log         127.0.0.1 local2</span>
<a id=__codelineno-6-8 name=__codelineno-6-8 href=#__codelineno-6-8></a><span class=s1>    chroot      /var/lib/haproxy</span>
<a id=__codelineno-6-9 name=__codelineno-6-9 href=#__codelineno-6-9></a><span class=s1>    pidfile     /var/run/haproxy.pid</span>
<a id=__codelineno-6-10 name=__codelineno-6-10 href=#__codelineno-6-10></a><span class=s1>    maxconn     4000</span>
<a id=__codelineno-6-11 name=__codelineno-6-11 href=#__codelineno-6-11></a><span class=s1>    user        haproxy</span>
<a id=__codelineno-6-12 name=__codelineno-6-12 href=#__codelineno-6-12></a><span class=s1>    group       haproxy</span>
<a id=__codelineno-6-13 name=__codelineno-6-13 href=#__codelineno-6-13></a><span class=s1>    daemon</span>
<a id=__codelineno-6-14 name=__codelineno-6-14 href=#__codelineno-6-14></a>
<a id=__codelineno-6-15 name=__codelineno-6-15 href=#__codelineno-6-15></a><span class=s1>    stats socket /var/lib/haproxy/stats</span>
<a id=__codelineno-6-16 name=__codelineno-6-16 href=#__codelineno-6-16></a><span class=s1>defaults</span>
<a id=__codelineno-6-17 name=__codelineno-6-17 href=#__codelineno-6-17></a><span class=s1>    mode                    http</span>
<a id=__codelineno-6-18 name=__codelineno-6-18 href=#__codelineno-6-18></a><span class=s1>    log                     global</span>
<a id=__codelineno-6-19 name=__codelineno-6-19 href=#__codelineno-6-19></a><span class=s1>    option                  httplog</span>
<a id=__codelineno-6-20 name=__codelineno-6-20 href=#__codelineno-6-20></a><span class=s1>    option                  dontlognull</span>
<a id=__codelineno-6-21 name=__codelineno-6-21 href=#__codelineno-6-21></a><span class=s1>    option http-server-close</span>
<a id=__codelineno-6-22 name=__codelineno-6-22 href=#__codelineno-6-22></a><span class=s1>    option forwardfor       except 127.0.0.0/8</span>
<a id=__codelineno-6-23 name=__codelineno-6-23 href=#__codelineno-6-23></a><span class=s1>    option                  redispatch</span>
<a id=__codelineno-6-24 name=__codelineno-6-24 href=#__codelineno-6-24></a><span class=s1>    retries                 3</span>
<a id=__codelineno-6-25 name=__codelineno-6-25 href=#__codelineno-6-25></a><span class=s1>    timeout http-request    10s</span>
<a id=__codelineno-6-26 name=__codelineno-6-26 href=#__codelineno-6-26></a><span class=s1>    timeout queue           1m</span>
<a id=__codelineno-6-27 name=__codelineno-6-27 href=#__codelineno-6-27></a><span class=s1>    timeout connect         10s</span>
<a id=__codelineno-6-28 name=__codelineno-6-28 href=#__codelineno-6-28></a><span class=s1>    timeout client          1m</span>
<a id=__codelineno-6-29 name=__codelineno-6-29 href=#__codelineno-6-29></a><span class=s1>    timeout server          1m</span>
<a id=__codelineno-6-30 name=__codelineno-6-30 href=#__codelineno-6-30></a><span class=s1>    timeout http-keep-alive 10s</span>
<a id=__codelineno-6-31 name=__codelineno-6-31 href=#__codelineno-6-31></a><span class=s1>    timeout check           10s</span>
<a id=__codelineno-6-32 name=__codelineno-6-32 href=#__codelineno-6-32></a><span class=s1>    maxconn                 3000</span>
<a id=__codelineno-6-33 name=__codelineno-6-33 href=#__codelineno-6-33></a><span class=s1>#---------------------------------------------------------------------</span>
<a id=__codelineno-6-34 name=__codelineno-6-34 href=#__codelineno-6-34></a><span class=s1># kubernetes apiserver frontend which proxys to the backends</span>
<a id=__codelineno-6-35 name=__codelineno-6-35 href=#__codelineno-6-35></a><span class=s1>#---------------------------------------------------------------------</span>
<a id=__codelineno-6-36 name=__codelineno-6-36 href=#__codelineno-6-36></a><span class=s1>frontend kubernetes-apiserver</span>
<a id=__codelineno-6-37 name=__codelineno-6-37 href=#__codelineno-6-37></a><span class=s1>    mode                 tcp</span>
<a id=__codelineno-6-38 name=__codelineno-6-38 href=#__codelineno-6-38></a><span class=s1>    bind                 *:16443</span>
<a id=__codelineno-6-39 name=__codelineno-6-39 href=#__codelineno-6-39></a><span class=s1>    option               tcplog</span>
<a id=__codelineno-6-40 name=__codelineno-6-40 href=#__codelineno-6-40></a><span class=s1>    default_backend      kubernetes-apiserver</span>
<a id=__codelineno-6-41 name=__codelineno-6-41 href=#__codelineno-6-41></a><span class=s1>#---------------------------------------------------------------------</span>
<a id=__codelineno-6-42 name=__codelineno-6-42 href=#__codelineno-6-42></a><span class=s1># round robin balancing between the various backends</span>
<a id=__codelineno-6-43 name=__codelineno-6-43 href=#__codelineno-6-43></a><span class=s1>#---------------------------------------------------------------------</span>
<a id=__codelineno-6-44 name=__codelineno-6-44 href=#__codelineno-6-44></a><span class=s1>backend kubernetes-apiserver</span>
<a id=__codelineno-6-45 name=__codelineno-6-45 href=#__codelineno-6-45></a><span class=s1>    mode        tcp</span>
<a id=__codelineno-6-46 name=__codelineno-6-46 href=#__codelineno-6-46></a><span class=s1>    balance     roundrobin</span>
<a id=__codelineno-6-47 name=__codelineno-6-47 href=#__codelineno-6-47></a><span class=s1>    server      master01.k8s.io   10.4.145.92:6443 check</span>
<a id=__codelineno-6-48 name=__codelineno-6-48 href=#__codelineno-6-48></a><span class=s1>    server      master02.k8s.io   10.4.145.129:6443 check</span>
<a id=__codelineno-6-49 name=__codelineno-6-49 href=#__codelineno-6-49></a><span class=s1>    server      master03.k8s.io   10.4.145.169:6443 check</span>
<a id=__codelineno-6-50 name=__codelineno-6-50 href=#__codelineno-6-50></a><span class=s1>#---------------------------------------------------------------------</span>
<a id=__codelineno-6-51 name=__codelineno-6-51 href=#__codelineno-6-51></a><span class=s1># collection haproxy statistics message</span>
<a id=__codelineno-6-52 name=__codelineno-6-52 href=#__codelineno-6-52></a><span class=s1>#---------------------------------------------------------------------</span>
<a id=__codelineno-6-53 name=__codelineno-6-53 href=#__codelineno-6-53></a><span class=s1>listen stats</span>
<a id=__codelineno-6-54 name=__codelineno-6-54 href=#__codelineno-6-54></a><span class=s1>    mode                 http</span>
<a id=__codelineno-6-55 name=__codelineno-6-55 href=#__codelineno-6-55></a><span class=s1>    bind                 0.0.0.0:1080</span>
<a id=__codelineno-6-56 name=__codelineno-6-56 href=#__codelineno-6-56></a><span class=s1>    stats auth           admin:admin</span>
<a id=__codelineno-6-57 name=__codelineno-6-57 href=#__codelineno-6-57></a><span class=s1>    stats refresh        30s</span>
<a id=__codelineno-6-58 name=__codelineno-6-58 href=#__codelineno-6-58></a><span class=s1>    stats realm          HAProxy\ Statistics</span>
<a id=__codelineno-6-59 name=__codelineno-6-59 href=#__codelineno-6-59></a><span class=s1>    stats uri            /haproxy-status</span>
<a id=__codelineno-6-60 name=__codelineno-6-60 href=#__codelineno-6-60></a><span class=s1>EOF&#39;</span>
</code></pre></div> <div class=highlight><pre><span></span><code><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a>$<span class=w> </span>sudo<span class=w> </span>systemctl<span class=w> </span><span class=nb>enable</span><span class=w> </span>--now<span class=w> </span>haproxy
</code></pre></div> <p>开启 haproxy 的日志</p> <div class=highlight><pre><span></span><code><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=c1># vim /etc/haproxy/haproxy.cfg</span>
<a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a>
<a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a>log<span class=w> </span>/var/log/haproxy.log<span class=w>    </span>local0
<a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a>log<span class=w> </span>/var/log/haproxy.log<span class=w>    </span>local1<span class=w> </span>notice
<a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a>
<a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a><span class=c1># 重新启动haproxy服务以使更改生效</span>
<a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a>
<a id=__codelineno-8-8 name=__codelineno-8-8 href=#__codelineno-8-8></a><span class=c1># 接下来，确保/var/log/haproxy.log文件存在并可写</span>
<a id=__codelineno-8-9 name=__codelineno-8-9 href=#__codelineno-8-9></a>sudo<span class=w> </span>touch<span class=w> </span>/var/log/haproxy.log
<a id=__codelineno-8-10 name=__codelineno-8-10 href=#__codelineno-8-10></a>sudo<span class=w> </span>chown<span class=w> </span>syslog:adm<span class=w> </span>/var/log/haproxy.log
<a id=__codelineno-8-11 name=__codelineno-8-11 href=#__codelineno-8-11></a>
<a id=__codelineno-8-12 name=__codelineno-8-12 href=#__codelineno-8-12></a><span class=c1># 更新rsyslog配置以将haproxy的日志输出到指定的日志文件。编辑/etc/rsyslog.d/49-haproxy.conf文件：</span>
<a id=__codelineno-8-13 name=__codelineno-8-13 href=#__codelineno-8-13></a>vim<span class=w> </span>/etc/rsyslog.d/49-haproxy.conf
<a id=__codelineno-8-14 name=__codelineno-8-14 href=#__codelineno-8-14></a>local0.*<span class=w> </span>/var/log/haproxy.log
<a id=__codelineno-8-15 name=__codelineno-8-15 href=#__codelineno-8-15></a>local1.*<span class=w> </span>/var/log/haproxy.log
<a id=__codelineno-8-16 name=__codelineno-8-16 href=#__codelineno-8-16></a>
<a id=__codelineno-8-17 name=__codelineno-8-17 href=#__codelineno-8-17></a>sudo<span class=w> </span>service<span class=w> </span>rsyslog<span class=w> </span>restart
<a id=__codelineno-8-18 name=__codelineno-8-18 href=#__codelineno-8-18></a>sudo<span class=w> </span>service<span class=w> </span>haproxy<span class=w> </span>restart
<a id=__codelineno-8-19 name=__codelineno-8-19 href=#__codelineno-8-19></a>
<a id=__codelineno-8-20 name=__codelineno-8-20 href=#__codelineno-8-20></a><span class=c1># 现在，haproxy将开始将日志输出到/var/log/haproxy.log文件中。你可以使用tail命令来查看和监视日志文件的内容：</span>
<a id=__codelineno-8-21 name=__codelineno-8-21 href=#__codelineno-8-21></a>sudo<span class=w> </span>tail<span class=w> </span>-f<span class=w> </span>/var/log/haproxy.log
</code></pre></div> <h3 id=44-安装-keepalived>4.4 安装 keepalived<a class=headerlink href=#44-安装-keepalived title="Permanent link">&para;</a></h3> <p>keepalived 是一个非常流行的服务器高可用解决方案。通过 keepalived 实现 apiserver 的故障转移。</p> <p>以下操作分别在 master1、master2 和 master3 上进行。</p> <h4 id=安装-keepalived>安装 keepalived<a class=headerlink href=#安装-keepalived title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a>$<span class=w> </span>sudo<span class=w> </span>apt<span class=w> </span>-y<span class=w> </span>install<span class=w> </span>keepalived
</code></pre></div> <h4 id=配置-keepalived>配置 keepalived<a class=headerlink href=#配置-keepalived title="Permanent link">&para;</a></h4> <p>master1</p> <div class=highlight><pre><span></span><code><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a>; vim /etc/keepalived/keepalived.conf
<a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a>! Configuration File for keepalived
<a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a>global_defs {
<a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a>    router_id k8s
<a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a>    script_user root
<a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a>    enable_script_security
<a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a>}
<a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a>vrrp_script chk_apiserver {
<a id=__codelineno-10-9 name=__codelineno-10-9 href=#__codelineno-10-9></a>    script &quot;/etc/keepalived/check_apiserver.sh&quot;
<a id=__codelineno-10-10 name=__codelineno-10-10 href=#__codelineno-10-10></a>    interval 5
<a id=__codelineno-10-11 name=__codelineno-10-11 href=#__codelineno-10-11></a>    weight -5
<a id=__codelineno-10-12 name=__codelineno-10-12 href=#__codelineno-10-12></a>    fall 2
<a id=__codelineno-10-13 name=__codelineno-10-13 href=#__codelineno-10-13></a>    rise 1
<a id=__codelineno-10-14 name=__codelineno-10-14 href=#__codelineno-10-14></a>}
<a id=__codelineno-10-15 name=__codelineno-10-15 href=#__codelineno-10-15></a>vrrp_instance VI_1 {
<a id=__codelineno-10-16 name=__codelineno-10-16 href=#__codelineno-10-16></a>    state MASTER
<a id=__codelineno-10-17 name=__codelineno-10-17 href=#__codelineno-10-17></a>    interface enp3s0
<a id=__codelineno-10-18 name=__codelineno-10-18 href=#__codelineno-10-18></a>    mcast_src_ip 10.4.145.92
<a id=__codelineno-10-19 name=__codelineno-10-19 href=#__codelineno-10-19></a>    virtual_router_id 99
<a id=__codelineno-10-20 name=__codelineno-10-20 href=#__codelineno-10-20></a>    priority 101
<a id=__codelineno-10-21 name=__codelineno-10-21 href=#__codelineno-10-21></a>    advert_int 2
<a id=__codelineno-10-22 name=__codelineno-10-22 href=#__codelineno-10-22></a>    authentication {
<a id=__codelineno-10-23 name=__codelineno-10-23 href=#__codelineno-10-23></a>        auth_type PASS
<a id=__codelineno-10-24 name=__codelineno-10-24 href=#__codelineno-10-24></a>        auth_pass ceb1b3ec013d66163d6ab
<a id=__codelineno-10-25 name=__codelineno-10-25 href=#__codelineno-10-25></a>    }
<a id=__codelineno-10-26 name=__codelineno-10-26 href=#__codelineno-10-26></a>    virtual_ipaddress {
<a id=__codelineno-10-27 name=__codelineno-10-27 href=#__codelineno-10-27></a>        10.4.145.100
<a id=__codelineno-10-28 name=__codelineno-10-28 href=#__codelineno-10-28></a>    }
<a id=__codelineno-10-29 name=__codelineno-10-29 href=#__codelineno-10-29></a>    track_script {
<a id=__codelineno-10-30 name=__codelineno-10-30 href=#__codelineno-10-30></a>       chk_apiserver
<a id=__codelineno-10-31 name=__codelineno-10-31 href=#__codelineno-10-31></a>    }
<a id=__codelineno-10-32 name=__codelineno-10-32 href=#__codelineno-10-32></a>}
</code></pre></div> <p>master2</p> <div class=highlight><pre><span></span><code><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a>; vim /etc/keepalived/keepalived.conf
<a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a>! Configuration File for keepalived
<a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a>global_defs {
<a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a>    router_id k8s
<a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a>    script_user root
<a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a>    enable_script_security
<a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a>}
<a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a>vrrp_script chk_apiserver {
<a id=__codelineno-11-9 name=__codelineno-11-9 href=#__codelineno-11-9></a>    script &quot;/etc/keepalived/check_apiserver.sh&quot;
<a id=__codelineno-11-10 name=__codelineno-11-10 href=#__codelineno-11-10></a>    interval 5
<a id=__codelineno-11-11 name=__codelineno-11-11 href=#__codelineno-11-11></a>    weight -5
<a id=__codelineno-11-12 name=__codelineno-11-12 href=#__codelineno-11-12></a>    fall 2
<a id=__codelineno-11-13 name=__codelineno-11-13 href=#__codelineno-11-13></a>    rise 1
<a id=__codelineno-11-14 name=__codelineno-11-14 href=#__codelineno-11-14></a>}
<a id=__codelineno-11-15 name=__codelineno-11-15 href=#__codelineno-11-15></a>vrrp_instance VI_1 {
<a id=__codelineno-11-16 name=__codelineno-11-16 href=#__codelineno-11-16></a>    state BACKUP
<a id=__codelineno-11-17 name=__codelineno-11-17 href=#__codelineno-11-17></a>    interface enp3s0
<a id=__codelineno-11-18 name=__codelineno-11-18 href=#__codelineno-11-18></a>    mcast_src_ip 10.4.145.129
<a id=__codelineno-11-19 name=__codelineno-11-19 href=#__codelineno-11-19></a>    virtual_router_id 99
<a id=__codelineno-11-20 name=__codelineno-11-20 href=#__codelineno-11-20></a>    priority 101
<a id=__codelineno-11-21 name=__codelineno-11-21 href=#__codelineno-11-21></a>    advert_int 2
<a id=__codelineno-11-22 name=__codelineno-11-22 href=#__codelineno-11-22></a>    authentication {
<a id=__codelineno-11-23 name=__codelineno-11-23 href=#__codelineno-11-23></a>        auth_type PASS
<a id=__codelineno-11-24 name=__codelineno-11-24 href=#__codelineno-11-24></a>        auth_pass ceb1b3ec013d66163d6ab
<a id=__codelineno-11-25 name=__codelineno-11-25 href=#__codelineno-11-25></a>    }
<a id=__codelineno-11-26 name=__codelineno-11-26 href=#__codelineno-11-26></a>    virtual_ipaddress {
<a id=__codelineno-11-27 name=__codelineno-11-27 href=#__codelineno-11-27></a>        10.4.145.100
<a id=__codelineno-11-28 name=__codelineno-11-28 href=#__codelineno-11-28></a>    }
<a id=__codelineno-11-29 name=__codelineno-11-29 href=#__codelineno-11-29></a>    track_script {
<a id=__codelineno-11-30 name=__codelineno-11-30 href=#__codelineno-11-30></a>       chk_apiserver
<a id=__codelineno-11-31 name=__codelineno-11-31 href=#__codelineno-11-31></a>    }
<a id=__codelineno-11-32 name=__codelineno-11-32 href=#__codelineno-11-32></a>}
</code></pre></div> <p>master3</p> <div class=highlight><pre><span></span><code><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a>; vim /etc/keepalived/keepalived.conf
<a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a>! Configuration File for keepalived
<a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a>global_defs {
<a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a>    router_id k8s
<a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a>    script_user root
<a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a>    enable_script_security
<a id=__codelineno-12-7 name=__codelineno-12-7 href=#__codelineno-12-7></a>}
<a id=__codelineno-12-8 name=__codelineno-12-8 href=#__codelineno-12-8></a>vrrp_script chk_apiserver {
<a id=__codelineno-12-9 name=__codelineno-12-9 href=#__codelineno-12-9></a>    script &quot;/etc/keepalived/check_apiserver.sh&quot;
<a id=__codelineno-12-10 name=__codelineno-12-10 href=#__codelineno-12-10></a>    interval 5
<a id=__codelineno-12-11 name=__codelineno-12-11 href=#__codelineno-12-11></a>    weight -5
<a id=__codelineno-12-12 name=__codelineno-12-12 href=#__codelineno-12-12></a>    fall 2
<a id=__codelineno-12-13 name=__codelineno-12-13 href=#__codelineno-12-13></a>    rise 1
<a id=__codelineno-12-14 name=__codelineno-12-14 href=#__codelineno-12-14></a>}
<a id=__codelineno-12-15 name=__codelineno-12-15 href=#__codelineno-12-15></a>vrrp_instance VI_1 {
<a id=__codelineno-12-16 name=__codelineno-12-16 href=#__codelineno-12-16></a>    state BACKUP
<a id=__codelineno-12-17 name=__codelineno-12-17 href=#__codelineno-12-17></a>    interface enp3s0
<a id=__codelineno-12-18 name=__codelineno-12-18 href=#__codelineno-12-18></a>    mcast_src_ip 10.4.145.169
<a id=__codelineno-12-19 name=__codelineno-12-19 href=#__codelineno-12-19></a>    virtual_router_id 99
<a id=__codelineno-12-20 name=__codelineno-12-20 href=#__codelineno-12-20></a>    priority 101
<a id=__codelineno-12-21 name=__codelineno-12-21 href=#__codelineno-12-21></a>    advert_int 2
<a id=__codelineno-12-22 name=__codelineno-12-22 href=#__codelineno-12-22></a>    authentication {
<a id=__codelineno-12-23 name=__codelineno-12-23 href=#__codelineno-12-23></a>        auth_type PASS
<a id=__codelineno-12-24 name=__codelineno-12-24 href=#__codelineno-12-24></a>        auth_pass ceb1b3ec013d66163d6ab
<a id=__codelineno-12-25 name=__codelineno-12-25 href=#__codelineno-12-25></a>    }
<a id=__codelineno-12-26 name=__codelineno-12-26 href=#__codelineno-12-26></a>    virtual_ipaddress {
<a id=__codelineno-12-27 name=__codelineno-12-27 href=#__codelineno-12-27></a>        10.4.145.100
<a id=__codelineno-12-28 name=__codelineno-12-28 href=#__codelineno-12-28></a>    }
<a id=__codelineno-12-29 name=__codelineno-12-29 href=#__codelineno-12-29></a>    track_script {
<a id=__codelineno-12-30 name=__codelineno-12-30 href=#__codelineno-12-30></a>       chk_apiserver
<a id=__codelineno-12-31 name=__codelineno-12-31 href=#__codelineno-12-31></a>    }
<a id=__codelineno-12-32 name=__codelineno-12-32 href=#__codelineno-12-32></a>}
</code></pre></div> <h4 id=健康检查脚本>健康检查脚本<a class=headerlink href=#健康检查脚本 title="Permanent link">&para;</a></h4> <p>所有 Master 节点配置 KeepAlived 健康检查文件：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a>$<span class=w> </span>cat<span class=w> </span>&gt;/etc/keepalived/check_apiserver.sh&lt;&lt;<span class=s2>&quot;EOF&quot;</span>
<a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a><span class=c1>#!/bin/bash</span>
<a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a>
<a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a>errorExit<span class=w> </span><span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a><span class=w>  </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;*** </span><span class=nv>$*</span><span class=s2>&quot;</span><span class=w> </span><span class=m>1</span>&gt;<span class=p>&amp;</span><span class=m>2</span>
<a id=__codelineno-13-6 name=__codelineno-13-6 href=#__codelineno-13-6></a><span class=w>  </span><span class=nb>exit</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-13-7 name=__codelineno-13-7 href=#__codelineno-13-7></a><span class=o>}</span>
<a id=__codelineno-13-8 name=__codelineno-13-8 href=#__codelineno-13-8></a>
<a id=__codelineno-13-9 name=__codelineno-13-9 href=#__codelineno-13-9></a>curl<span class=w> </span>--silent<span class=w> </span>--max-time<span class=w> </span><span class=m>2</span><span class=w> </span>--insecure<span class=w> </span>https://localhost:6443/<span class=w> </span>-o<span class=w> </span>/dev/null<span class=w> </span><span class=o>||</span><span class=w> </span>errorExit<span class=w> </span><span class=s2>&quot;Error GET https://localhost:6443/&quot;</span>
<a id=__codelineno-13-10 name=__codelineno-13-10 href=#__codelineno-13-10></a>
<a id=__codelineno-13-11 name=__codelineno-13-11 href=#__codelineno-13-11></a>
<a id=__codelineno-13-12 name=__codelineno-13-12 href=#__codelineno-13-12></a><span class=k>if</span><span class=w> </span>ip<span class=w> </span>addr<span class=w> </span><span class=p>|</span>grep<span class=w> </span>-q<span class=w> </span><span class=m>10</span>.4.145.100<span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-13-13 name=__codelineno-13-13 href=#__codelineno-13-13></a><span class=w>  </span>curl<span class=w> </span>--silent<span class=w> </span>--max-time<span class=w> </span><span class=m>2</span><span class=w> </span>--insecure<span class=w> </span>https://10.4.145.100:16443/<span class=w> </span>-o<span class=w> </span>/dev/null<span class=w> </span><span class=o>||</span><span class=w> </span>errorExit<span class=w> </span><span class=s2>&quot;Error GET https://10.4.145.100:16443/&quot;</span>
<a id=__codelineno-13-14 name=__codelineno-13-14 href=#__codelineno-13-14></a><span class=k>fi</span>
<a id=__codelineno-13-15 name=__codelineno-13-15 href=#__codelineno-13-15></a>EOF
<a id=__codelineno-13-16 name=__codelineno-13-16 href=#__codelineno-13-16></a>$<span class=w> </span>chmod<span class=w> </span>+x<span class=w> </span>/etc/keepalived/check_apiserver.sh
</code></pre></div> <div class=highlight><pre><span></span><code><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a>$<span class=w> </span>sudo<span class=w> </span>systemctl<span class=w> </span><span class=nb>enable</span><span class=w> </span>--now<span class=w> </span>keepalived
</code></pre></div> <p>启动 haproxy 和 keepalived：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a>$<span class=w> </span>systemctl<span class=w> </span>daemon-reload
<a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a>$<span class=w> </span>systemctl<span class=w> </span><span class=nb>enable</span><span class=w> </span>--now<span class=w> </span>haproxy
<a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a>$<span class=w> </span>systemctl<span class=w> </span><span class=nb>enable</span><span class=w> </span>--now<span class=w> </span>keepalived
</code></pre></div> <p>如果是用 HAProxy 和 KeepAlived 实现的高可用，则需要测试 VIP 是否是正常的：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a><span class=c1>## 所有节点进行ping测试</span>
<a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a>$<span class=w> </span>ping<span class=w> </span><span class=m>10</span>.4.145.100<span class=w> </span>-c<span class=w> </span><span class=m>4</span>
<a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a>PING<span class=w> </span><span class=m>10</span>.4.145.100<span class=w> </span><span class=o>(</span><span class=m>10</span>.4.145.100<span class=o>)</span><span class=w> </span><span class=m>56</span><span class=o>(</span><span class=m>84</span><span class=o>)</span><span class=w> </span>bytes<span class=w> </span>of<span class=w> </span>data.
<a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a><span class=m>64</span><span class=w> </span>bytes<span class=w> </span>from<span class=w> </span><span class=m>10</span>.4.145.100:<span class=w> </span><span class=nv>icmp_seq</span><span class=o>=</span><span class=m>1</span><span class=w> </span><span class=nv>ttl</span><span class=o>=</span><span class=m>64</span><span class=w> </span><span class=nv>time</span><span class=o>=</span><span class=m>0</span>.076<span class=w> </span>ms
<a id=__codelineno-16-5 name=__codelineno-16-5 href=#__codelineno-16-5></a><span class=m>64</span><span class=w> </span>bytes<span class=w> </span>from<span class=w> </span><span class=m>10</span>.4.145.100:<span class=w> </span><span class=nv>icmp_seq</span><span class=o>=</span><span class=m>2</span><span class=w> </span><span class=nv>ttl</span><span class=o>=</span><span class=m>64</span><span class=w> </span><span class=nv>time</span><span class=o>=</span><span class=m>0</span>.072<span class=w> </span>ms
<a id=__codelineno-16-6 name=__codelineno-16-6 href=#__codelineno-16-6></a>....
<a id=__codelineno-16-7 name=__codelineno-16-7 href=#__codelineno-16-7></a>
<a id=__codelineno-16-8 name=__codelineno-16-8 href=#__codelineno-16-8></a>
<a id=__codelineno-16-9 name=__codelineno-16-9 href=#__codelineno-16-9></a><span class=c1>## 所有节点进行telnet测试</span>
<a id=__codelineno-16-10 name=__codelineno-16-10 href=#__codelineno-16-10></a>$<span class=w> </span>telnet<span class=w> </span><span class=m>10</span>.4.145.100<span class=w> </span><span class=m>16443</span>
<a id=__codelineno-16-11 name=__codelineno-16-11 href=#__codelineno-16-11></a>Trying<span class=w> </span><span class=m>10</span>.4.145.100...
<a id=__codelineno-16-12 name=__codelineno-16-12 href=#__codelineno-16-12></a>Connected<span class=w> </span>to<span class=w> </span><span class=m>10</span>.4.145.100.
<a id=__codelineno-16-13 name=__codelineno-16-13 href=#__codelineno-16-13></a>Escape<span class=w> </span>character<span class=w> </span>is<span class=w> </span><span class=s1>&#39;^]&#39;</span>.
<a id=__codelineno-16-14 name=__codelineno-16-14 href=#__codelineno-16-14></a>^<span class=o>]</span>
<a id=__codelineno-16-15 name=__codelineno-16-15 href=#__codelineno-16-15></a>telnet&gt;<span class=w> </span>quit
<a id=__codelineno-16-16 name=__codelineno-16-16 href=#__codelineno-16-16></a>Connection<span class=w> </span>closed.
</code></pre></div> <p>如果 ping 不通且 telnet 没有出现，则认为 VIP 不可用。</p> <p>如果 VIP 不可用，不可再继续往下执行，需要排查 VIP 的问题，比如防火墙和 SELinux、HAProxy 和 Keepalived 的状态，监听端口是否正常等。</p> <h3 id=45-初始化-master-节点>4.5 初始化 Master 节点<a class=headerlink href=#45-初始化-master-节点 title="Permanent link">&para;</a></h3> <p>接下来进行 Master 节点的初始化操作，需要特别注意，只需要初始化一个 Master 节点就可以了，其余的 Master 节点是通过 kubeadm join 命令加入的。</p> <p>master1 的初始化命令如下：</p> <h4 id=命令行方式初始化-k8s>命令行方式初始化 k8s<a class=headerlink href=#命令行方式初始化-k8s title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a><span class=c1># kubeadm init --apiserver-advertise-address=192.168.101.21 --control-plane-endpoint=192.168.101.18 --apiserver-bind-port=6443 --kubernetes-version=v1.26.3 --pod-network-cidr=10.200.0.0/16 --service-cidr=10.100.0.0/16 --service-dns-domain=cluster.local --image-repository=registry.cn-hangzhou.aliyuncs.com/google_containers --ignore-preflight-errors=swap</span>
</code></pre></div> <h4 id=基于-init-件初始化-k8s>基于 init ⽂件初始化 k8s<a class=headerlink href=#基于-init-件初始化-k8s title="Permanent link">&para;</a></h4> <p><strong>将默认配置输出⾄⽂件</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a>sudo<span class=w> </span>sh<span class=w> </span>-c<span class=w> </span><span class=s1>&#39;kubeadm config print init-defaults &gt; kubeadm-init.yaml&#39;</span>
<a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a>sudo<span class=w> </span>cp<span class=w> </span>-rf<span class=w> </span>kubeadm-init.yaml<span class=w> </span>kubeadm-init.yaml.bak
</code></pre></div> <p><strong>修改后的初始化⽂件内容</strong></p> <p><code>kubeadm-init.yaml</code></p> <div class=highlight><pre><span></span><code><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a>apiVersion: kubeadm.k8s.io/v1beta3
<a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a>bootstrapTokens:
<a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a>- groups:
<a id=__codelineno-19-4 name=__codelineno-19-4 href=#__codelineno-19-4></a>  - system:bootstrappers:kubeadm:default-node-token
<a id=__codelineno-19-5 name=__codelineno-19-5 href=#__codelineno-19-5></a>  token: abcdef.0123456789abcdef
<a id=__codelineno-19-6 name=__codelineno-19-6 href=#__codelineno-19-6></a>  ttl: 24h0m0s
<a id=__codelineno-19-7 name=__codelineno-19-7 href=#__codelineno-19-7></a>  usages:
<a id=__codelineno-19-8 name=__codelineno-19-8 href=#__codelineno-19-8></a>  - signing
<a id=__codelineno-19-9 name=__codelineno-19-9 href=#__codelineno-19-9></a>  - authentication
<a id=__codelineno-19-10 name=__codelineno-19-10 href=#__codelineno-19-10></a>kind: InitConfiguration
<a id=__codelineno-19-11 name=__codelineno-19-11 href=#__codelineno-19-11></a>localAPIEndpoint:
<a id=__codelineno-19-12 name=__codelineno-19-12 href=#__codelineno-19-12></a>  advertiseAddress: 10.4.145.92
<a id=__codelineno-19-13 name=__codelineno-19-13 href=#__codelineno-19-13></a>  bindPort: 6443
<a id=__codelineno-19-14 name=__codelineno-19-14 href=#__codelineno-19-14></a>nodeRegistration:
<a id=__codelineno-19-15 name=__codelineno-19-15 href=#__codelineno-19-15></a>  criSocket: unix:///var/run/containerd/containerd.sock
<a id=__codelineno-19-16 name=__codelineno-19-16 href=#__codelineno-19-16></a>  imagePullPolicy: IfNotPresent
<a id=__codelineno-19-17 name=__codelineno-19-17 href=#__codelineno-19-17></a>  name: gitee-kubernetes-master1
<a id=__codelineno-19-18 name=__codelineno-19-18 href=#__codelineno-19-18></a>  taints:
<a id=__codelineno-19-19 name=__codelineno-19-19 href=#__codelineno-19-19></a>  - effect: NoSchedule
<a id=__codelineno-19-20 name=__codelineno-19-20 href=#__codelineno-19-20></a>    key: node-role.kubernetes.io/master
<a id=__codelineno-19-21 name=__codelineno-19-21 href=#__codelineno-19-21></a>---
<a id=__codelineno-19-22 name=__codelineno-19-22 href=#__codelineno-19-22></a>apiServer:
<a id=__codelineno-19-23 name=__codelineno-19-23 href=#__codelineno-19-23></a>  certSANs:
<a id=__codelineno-19-24 name=__codelineno-19-24 href=#__codelineno-19-24></a>  - 10.4.145.100
<a id=__codelineno-19-25 name=__codelineno-19-25 href=#__codelineno-19-25></a>  timeoutForControlPlane: 4m0s
<a id=__codelineno-19-26 name=__codelineno-19-26 href=#__codelineno-19-26></a>apiVersion: kubeadm.k8s.io/v1beta3
<a id=__codelineno-19-27 name=__codelineno-19-27 href=#__codelineno-19-27></a>certificatesDir: /etc/kubernetes/pki
<a id=__codelineno-19-28 name=__codelineno-19-28 href=#__codelineno-19-28></a>clusterName: kubernetes
<a id=__codelineno-19-29 name=__codelineno-19-29 href=#__codelineno-19-29></a>controlPlaneEndpoint: 10.4.145.100:16443
<a id=__codelineno-19-30 name=__codelineno-19-30 href=#__codelineno-19-30></a>controllerManager: {}
<a id=__codelineno-19-31 name=__codelineno-19-31 href=#__codelineno-19-31></a>dns: {}
<a id=__codelineno-19-32 name=__codelineno-19-32 href=#__codelineno-19-32></a>etcd:
<a id=__codelineno-19-33 name=__codelineno-19-33 href=#__codelineno-19-33></a>  local:
<a id=__codelineno-19-34 name=__codelineno-19-34 href=#__codelineno-19-34></a>    dataDir: /var/lib/etcd
<a id=__codelineno-19-35 name=__codelineno-19-35 href=#__codelineno-19-35></a>imageRepository: registry.k8s.io
<a id=__codelineno-19-36 name=__codelineno-19-36 href=#__codelineno-19-36></a>kind: ClusterConfiguration
<a id=__codelineno-19-37 name=__codelineno-19-37 href=#__codelineno-19-37></a>kubernetesVersion: v1.26.3
<a id=__codelineno-19-38 name=__codelineno-19-38 href=#__codelineno-19-38></a>networking:
<a id=__codelineno-19-39 name=__codelineno-19-39 href=#__codelineno-19-39></a>  dnsDomain: cluster.local
<a id=__codelineno-19-40 name=__codelineno-19-40 href=#__codelineno-19-40></a>  podSubnet: 10.200.0.0/16
<a id=__codelineno-19-41 name=__codelineno-19-41 href=#__codelineno-19-41></a>  serviceSubnet: 10.100.0.0/16
<a id=__codelineno-19-42 name=__codelineno-19-42 href=#__codelineno-19-42></a>scheduler: {}
<a id=__codelineno-19-43 name=__codelineno-19-43 href=#__codelineno-19-43></a>
<a id=__codelineno-19-44 name=__codelineno-19-44 href=#__codelineno-19-44></a>---
<a id=__codelineno-19-45 name=__codelineno-19-45 href=#__codelineno-19-45></a>#Specify kubelet usage systemd
<a id=__codelineno-19-46 name=__codelineno-19-46 href=#__codelineno-19-46></a>kind: KubeletConfiguration
<a id=__codelineno-19-47 name=__codelineno-19-47 href=#__codelineno-19-47></a>apiVersion: kubelet.config.k8s.io/v1beta1
<a id=__codelineno-19-48 name=__codelineno-19-48 href=#__codelineno-19-48></a>cgroupDriver: systemd
<a id=__codelineno-19-49 name=__codelineno-19-49 href=#__codelineno-19-49></a>---
<a id=__codelineno-19-50 name=__codelineno-19-50 href=#__codelineno-19-50></a>#Specify KubeProxy to use ipvs
<a id=__codelineno-19-51 name=__codelineno-19-51 href=#__codelineno-19-51></a>apiVersion: kubeproxy.config.k8s.io/v1alpha1
<a id=__codelineno-19-52 name=__codelineno-19-52 href=#__codelineno-19-52></a>kind: KubeProxyConfiguration
<a id=__codelineno-19-53 name=__codelineno-19-53 href=#__codelineno-19-53></a>mode: ipvs
</code></pre></div> <p><strong>基于文件执行 k8s master 初始化</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a><span class=n>root</span><span class=o>@</span><span class=n>k8s</span><span class=o>-</span><span class=n>master</span><span class=o>-</span><span class=mi>1</span><span class=p>:</span><span class=o>/</span><span class=n>home</span><span class=o>/</span><span class=n>containerd</span><span class=o>#</span><span class=w> </span><span class=n>kubeadm</span><span class=w> </span><span class=n>init</span><span class=w> </span><span class=c1>--upload-certs --config kubeadm-init.yaml</span>
<a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a><span class=p>[</span><span class=n>init</span><span class=p>]</span><span class=w> </span><span class=k>Using</span><span class=w> </span><span class=n>Kubernetes</span><span class=w> </span><span class=k>version</span><span class=p>:</span><span class=w> </span><span class=n>v1</span><span class=p>.</span><span class=mi>26</span><span class=p>.</span><span class=mi>3</span>
<a id=__codelineno-20-3 name=__codelineno-20-3 href=#__codelineno-20-3></a><span class=p>[</span><span class=n>preflight</span><span class=p>]</span><span class=w> </span><span class=n>Running</span><span class=w> </span><span class=n>pre</span><span class=o>-</span><span class=n>flight</span><span class=w> </span><span class=n>checks</span>
<a id=__codelineno-20-4 name=__codelineno-20-4 href=#__codelineno-20-4></a><span class=w>        </span><span class=p>[</span><span class=n>WARNING</span><span class=w> </span><span class=n>Hostname</span><span class=p>]:</span><span class=w> </span><span class=n>hostname</span><span class=w> </span><span class=ss>&quot;k8s-master&quot;</span><span class=w> </span><span class=n>could</span><span class=w> </span><span class=k>not</span><span class=w> </span><span class=n>be</span><span class=w> </span><span class=n>reached</span>
<a id=__codelineno-20-5 name=__codelineno-20-5 href=#__codelineno-20-5></a><span class=w>        </span><span class=p>[</span><span class=n>WARNING</span><span class=w> </span><span class=n>Hostname</span><span class=p>]:</span><span class=w> </span><span class=n>hostname</span><span class=w> </span><span class=ss>&quot;k8s-master&quot;</span><span class=p>:</span><span class=w> </span><span class=n>lookup</span><span class=w> </span><span class=n>k8s</span><span class=o>-</span><span class=n>master</span><span class=w> </span><span class=k>on</span><span class=w> </span><span class=mi>10</span><span class=p>.</span><span class=mi>4</span><span class=p>.</span><span class=mi>145</span><span class=p>.</span><span class=mi>142</span><span class=p>:</span><span class=mi>53</span><span class=p>:</span><span class=w> </span><span class=k>no</span><span class=w> </span><span class=n>such</span><span class=w> </span><span class=k>host</span>
<a id=__codelineno-20-6 name=__codelineno-20-6 href=#__codelineno-20-6></a><span class=p>[</span><span class=n>preflight</span><span class=p>]</span><span class=w> </span><span class=n>Pulling</span><span class=w> </span><span class=n>images</span><span class=w> </span><span class=n>required</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=n>setting</span><span class=w> </span><span class=n>up</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=n>Kubernetes</span><span class=w> </span><span class=k>cluster</span>
<a id=__codelineno-20-7 name=__codelineno-20-7 href=#__codelineno-20-7></a><span class=p>[</span><span class=n>preflight</span><span class=p>]</span><span class=w> </span><span class=n>This</span><span class=w> </span><span class=n>might</span><span class=w> </span><span class=n>take</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=k>minute</span><span class=w> </span><span class=k>or</span><span class=w> </span><span class=n>two</span><span class=p>,</span><span class=w> </span><span class=n>depending</span><span class=w> </span><span class=k>on</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=n>speed</span><span class=w> </span><span class=k>of</span><span class=w> </span><span class=n>your</span><span class=w> </span><span class=n>internet</span><span class=w> </span><span class=k>connection</span>
<a id=__codelineno-20-8 name=__codelineno-20-8 href=#__codelineno-20-8></a><span class=p>[</span><span class=n>preflight</span><span class=p>]</span><span class=w> </span><span class=n>You</span><span class=w> </span><span class=n>can</span><span class=w> </span><span class=n>also</span><span class=w> </span><span class=n>perform</span><span class=w> </span><span class=n>this</span><span class=w> </span><span class=n>action</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=n>beforehand</span><span class=w> </span><span class=k>using</span><span class=w> </span><span class=s1>&#39;kubeadm config images pull&#39;</span>
<a id=__codelineno-20-9 name=__codelineno-20-9 href=#__codelineno-20-9></a><span class=p>[</span><span class=n>certs</span><span class=p>]</span><span class=w> </span><span class=k>Using</span><span class=w> </span><span class=n>certificateDir</span><span class=w> </span><span class=n>folder</span><span class=w> </span><span class=ss>&quot;/etc/kubernetes/pki&quot;</span>
<a id=__codelineno-20-10 name=__codelineno-20-10 href=#__codelineno-20-10></a><span class=p>[</span><span class=n>certs</span><span class=p>]</span><span class=w> </span><span class=n>Generating</span><span class=w> </span><span class=ss>&quot;ca&quot;</span><span class=w> </span><span class=n>certificate</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=k>key</span>
<a id=__codelineno-20-11 name=__codelineno-20-11 href=#__codelineno-20-11></a><span class=p>[</span><span class=n>certs</span><span class=p>]</span><span class=w> </span><span class=n>Generating</span><span class=w> </span><span class=ss>&quot;apiserver&quot;</span><span class=w> </span><span class=n>certificate</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=k>key</span>
<a id=__codelineno-20-12 name=__codelineno-20-12 href=#__codelineno-20-12></a><span class=p>[</span><span class=n>certs</span><span class=p>]</span><span class=w> </span><span class=n>apiserver</span><span class=w> </span><span class=n>serving</span><span class=w> </span><span class=n>cert</span><span class=w> </span><span class=k>is</span><span class=w> </span><span class=n>signed</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=n>DNS</span><span class=w> </span><span class=k>names</span><span class=w> </span><span class=p>[</span><span class=n>k8s</span><span class=o>-</span><span class=n>master</span><span class=w> </span><span class=n>kubernetes</span><span class=w> </span><span class=n>kubernetes</span><span class=p>.</span><span class=k>default</span><span class=w> </span><span class=n>kubernetes</span><span class=p>.</span><span class=k>default</span><span class=p>.</span><span class=n>svc</span><span class=w> </span><span class=n>kubernetes</span><span class=p>.</span><span class=k>default</span><span class=p>.</span><span class=n>svc</span><span class=p>.</span><span class=k>cluster</span><span class=p>.</span><span class=k>local</span><span class=p>]</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>IPs</span><span class=w> </span><span class=p>[</span><span class=mi>10</span><span class=p>.</span><span class=mi>1</span><span class=w>          </span><span class=mi>00</span><span class=p>.</span><span class=mi>0</span><span class=p>.</span><span class=mi>1</span><span class=w> </span><span class=mi>10</span><span class=p>.</span><span class=mi>4</span><span class=p>.</span><span class=mi>145</span><span class=p>.</span><span class=mi>92</span><span class=w> </span><span class=mi>10</span><span class=p>.</span><span class=mi>4</span><span class=p>.</span><span class=mi>145</span><span class=p>.</span><span class=mi>100</span><span class=p>]</span>
<a id=__codelineno-20-13 name=__codelineno-20-13 href=#__codelineno-20-13></a><span class=p>[</span><span class=n>certs</span><span class=p>]</span><span class=w> </span><span class=n>Generating</span><span class=w> </span><span class=ss>&quot;apiserver-kubelet-client&quot;</span><span class=w> </span><span class=n>certificate</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=k>key</span>
<a id=__codelineno-20-14 name=__codelineno-20-14 href=#__codelineno-20-14></a><span class=p>[</span><span class=n>certs</span><span class=p>]</span><span class=w> </span><span class=n>Generating</span><span class=w> </span><span class=ss>&quot;front-proxy-ca&quot;</span><span class=w> </span><span class=n>certificate</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=k>key</span>
<a id=__codelineno-20-15 name=__codelineno-20-15 href=#__codelineno-20-15></a><span class=p>[</span><span class=n>certs</span><span class=p>]</span><span class=w> </span><span class=n>Generating</span><span class=w> </span><span class=ss>&quot;front-proxy-client&quot;</span><span class=w> </span><span class=n>certificate</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=k>key</span>
<a id=__codelineno-20-16 name=__codelineno-20-16 href=#__codelineno-20-16></a><span class=p>[</span><span class=n>certs</span><span class=p>]</span><span class=w> </span><span class=n>Generating</span><span class=w> </span><span class=ss>&quot;etcd/ca&quot;</span><span class=w> </span><span class=n>certificate</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=k>key</span>
<a id=__codelineno-20-17 name=__codelineno-20-17 href=#__codelineno-20-17></a><span class=p>[</span><span class=n>certs</span><span class=p>]</span><span class=w> </span><span class=n>Generating</span><span class=w> </span><span class=ss>&quot;etcd/server&quot;</span><span class=w> </span><span class=n>certificate</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=k>key</span>
<a id=__codelineno-20-18 name=__codelineno-20-18 href=#__codelineno-20-18></a><span class=p>[</span><span class=n>certs</span><span class=p>]</span><span class=w> </span><span class=n>etcd</span><span class=o>/</span><span class=n>server</span><span class=w> </span><span class=n>serving</span><span class=w> </span><span class=n>cert</span><span class=w> </span><span class=k>is</span><span class=w> </span><span class=n>signed</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=n>DNS</span><span class=w> </span><span class=k>names</span><span class=w> </span><span class=p>[</span><span class=n>k8s</span><span class=o>-</span><span class=n>master</span><span class=w> </span><span class=n>localhost</span><span class=p>]</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>IPs</span><span class=w> </span><span class=p>[</span><span class=mi>10</span><span class=p>.</span><span class=mi>4</span><span class=p>.</span><span class=mi>145</span><span class=p>.</span><span class=mi>92</span><span class=w> </span><span class=mi>127</span><span class=p>.</span><span class=mi>0</span><span class=p>.</span><span class=mi>0</span><span class=p>.</span><span class=mi>1</span><span class=w> </span><span class=p>::</span><span class=mi>1</span><span class=p>]</span>
<a id=__codelineno-20-19 name=__codelineno-20-19 href=#__codelineno-20-19></a><span class=p>[</span><span class=n>certs</span><span class=p>]</span><span class=w> </span><span class=n>Generating</span><span class=w> </span><span class=ss>&quot;etcd/peer&quot;</span><span class=w> </span><span class=n>certificate</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=k>key</span>
<a id=__codelineno-20-20 name=__codelineno-20-20 href=#__codelineno-20-20></a><span class=p>[</span><span class=n>certs</span><span class=p>]</span><span class=w> </span><span class=n>etcd</span><span class=o>/</span><span class=n>peer</span><span class=w> </span><span class=n>serving</span><span class=w> </span><span class=n>cert</span><span class=w> </span><span class=k>is</span><span class=w> </span><span class=n>signed</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=n>DNS</span><span class=w> </span><span class=k>names</span><span class=w> </span><span class=p>[</span><span class=n>k8s</span><span class=o>-</span><span class=n>master</span><span class=w> </span><span class=n>localhost</span><span class=p>]</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>IPs</span><span class=w> </span><span class=p>[</span><span class=mi>10</span><span class=p>.</span><span class=mi>4</span><span class=p>.</span><span class=mi>145</span><span class=p>.</span><span class=mi>92</span><span class=w> </span><span class=mi>127</span><span class=p>.</span><span class=mi>0</span><span class=p>.</span><span class=mi>0</span><span class=p>.</span><span class=mi>1</span><span class=w> </span><span class=p>::</span><span class=mi>1</span><span class=p>]</span>
<a id=__codelineno-20-21 name=__codelineno-20-21 href=#__codelineno-20-21></a><span class=p>[</span><span class=n>certs</span><span class=p>]</span><span class=w> </span><span class=n>Generating</span><span class=w> </span><span class=ss>&quot;etcd/healthcheck-client&quot;</span><span class=w> </span><span class=n>certificate</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=k>key</span>
<a id=__codelineno-20-22 name=__codelineno-20-22 href=#__codelineno-20-22></a><span class=p>[</span><span class=n>certs</span><span class=p>]</span><span class=w> </span><span class=n>Generating</span><span class=w> </span><span class=ss>&quot;apiserver-etcd-client&quot;</span><span class=w> </span><span class=n>certificate</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=k>key</span>
<a id=__codelineno-20-23 name=__codelineno-20-23 href=#__codelineno-20-23></a><span class=p>[</span><span class=n>certs</span><span class=p>]</span><span class=w> </span><span class=n>Generating</span><span class=w> </span><span class=ss>&quot;sa&quot;</span><span class=w> </span><span class=k>key</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=k>public</span><span class=w> </span><span class=k>key</span>
<a id=__codelineno-20-24 name=__codelineno-20-24 href=#__codelineno-20-24></a><span class=p>[</span><span class=n>kubeconfig</span><span class=p>]</span><span class=w> </span><span class=k>Using</span><span class=w> </span><span class=n>kubeconfig</span><span class=w> </span><span class=n>folder</span><span class=w> </span><span class=ss>&quot;/etc/kubernetes&quot;</span>
<a id=__codelineno-20-25 name=__codelineno-20-25 href=#__codelineno-20-25></a><span class=n>W1213</span><span class=w> </span><span class=mi>03</span><span class=p>:</span><span class=mi>57</span><span class=p>:</span><span class=mi>54</span><span class=p>.</span><span class=mi>577508</span><span class=w>  </span><span class=mi>182309</span><span class=w> </span><span class=n>endpoint</span><span class=p>.</span><span class=k>go</span><span class=p>:</span><span class=mi>57</span><span class=p>]</span><span class=w> </span><span class=p>[</span><span class=n>endpoint</span><span class=p>]</span><span class=w> </span><span class=n>WARNING</span><span class=p>:</span><span class=w> </span><span class=n>port</span><span class=w> </span><span class=n>specified</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=n>controlPlaneEndpoint</span><span class=w> </span><span class=n>overrides</span><span class=w> </span><span class=n>bindPort</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=n>controlplane</span><span class=w> </span><span class=n>address</span>
<a id=__codelineno-20-26 name=__codelineno-20-26 href=#__codelineno-20-26></a><span class=p>[</span><span class=n>kubeconfig</span><span class=p>]</span><span class=w> </span><span class=n>Writing</span><span class=w> </span><span class=ss>&quot;admin.conf&quot;</span><span class=w> </span><span class=n>kubeconfig</span><span class=w> </span><span class=n>file</span>
<a id=__codelineno-20-27 name=__codelineno-20-27 href=#__codelineno-20-27></a><span class=n>W1213</span><span class=w> </span><span class=mi>03</span><span class=p>:</span><span class=mi>57</span><span class=p>:</span><span class=mi>54</span><span class=p>.</span><span class=mi>872731</span><span class=w>  </span><span class=mi>182309</span><span class=w> </span><span class=n>endpoint</span><span class=p>.</span><span class=k>go</span><span class=p>:</span><span class=mi>57</span><span class=p>]</span><span class=w> </span><span class=p>[</span><span class=n>endpoint</span><span class=p>]</span><span class=w> </span><span class=n>WARNING</span><span class=p>:</span><span class=w> </span><span class=n>port</span><span class=w> </span><span class=n>specified</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=n>controlPlaneEndpoint</span><span class=w> </span><span class=n>overrides</span><span class=w> </span><span class=n>bindPort</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=n>controlplane</span><span class=w> </span><span class=n>address</span>
<a id=__codelineno-20-28 name=__codelineno-20-28 href=#__codelineno-20-28></a><span class=p>[</span><span class=n>kubeconfig</span><span class=p>]</span><span class=w> </span><span class=n>Writing</span><span class=w> </span><span class=ss>&quot;kubelet.conf&quot;</span><span class=w> </span><span class=n>kubeconfig</span><span class=w> </span><span class=n>file</span>
<a id=__codelineno-20-29 name=__codelineno-20-29 href=#__codelineno-20-29></a><span class=n>W1213</span><span class=w> </span><span class=mi>03</span><span class=p>:</span><span class=mi>57</span><span class=p>:</span><span class=mi>55</span><span class=p>.</span><span class=mi>062089</span><span class=w>  </span><span class=mi>182309</span><span class=w> </span><span class=n>endpoint</span><span class=p>.</span><span class=k>go</span><span class=p>:</span><span class=mi>57</span><span class=p>]</span><span class=w> </span><span class=p>[</span><span class=n>endpoint</span><span class=p>]</span><span class=w> </span><span class=n>WARNING</span><span class=p>:</span><span class=w> </span><span class=n>port</span><span class=w> </span><span class=n>specified</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=n>controlPlaneEndpoint</span><span class=w> </span><span class=n>overrides</span><span class=w> </span><span class=n>bindPort</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=n>controlplane</span><span class=w> </span><span class=n>address</span>
<a id=__codelineno-20-30 name=__codelineno-20-30 href=#__codelineno-20-30></a><span class=p>[</span><span class=n>kubeconfig</span><span class=p>]</span><span class=w> </span><span class=n>Writing</span><span class=w> </span><span class=ss>&quot;controller-manager.conf&quot;</span><span class=w> </span><span class=n>kubeconfig</span><span class=w> </span><span class=n>file</span>
<a id=__codelineno-20-31 name=__codelineno-20-31 href=#__codelineno-20-31></a><span class=n>W1213</span><span class=w> </span><span class=mi>03</span><span class=p>:</span><span class=mi>57</span><span class=p>:</span><span class=mi>55</span><span class=p>.</span><span class=mi>192987</span><span class=w>  </span><span class=mi>182309</span><span class=w> </span><span class=n>endpoint</span><span class=p>.</span><span class=k>go</span><span class=p>:</span><span class=mi>57</span><span class=p>]</span><span class=w> </span><span class=p>[</span><span class=n>endpoint</span><span class=p>]</span><span class=w> </span><span class=n>WARNING</span><span class=p>:</span><span class=w> </span><span class=n>port</span><span class=w> </span><span class=n>specified</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=n>controlPlaneEndpoint</span><span class=w> </span><span class=n>overrides</span><span class=w> </span><span class=n>bindPort</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=n>controlplane</span><span class=w> </span><span class=n>address</span>
<a id=__codelineno-20-32 name=__codelineno-20-32 href=#__codelineno-20-32></a><span class=p>[</span><span class=n>kubeconfig</span><span class=p>]</span><span class=w> </span><span class=n>Writing</span><span class=w> </span><span class=ss>&quot;scheduler.conf&quot;</span><span class=w> </span><span class=n>kubeconfig</span><span class=w> </span><span class=n>file</span>
<a id=__codelineno-20-33 name=__codelineno-20-33 href=#__codelineno-20-33></a><span class=p>[</span><span class=n>kubelet</span><span class=o>-</span><span class=k>start</span><span class=p>]</span><span class=w> </span><span class=n>Writing</span><span class=w> </span><span class=n>kubelet</span><span class=w> </span><span class=n>environment</span><span class=w> </span><span class=n>file</span><span class=w> </span><span class=k>with</span><span class=w> </span><span class=n>flags</span><span class=w> </span><span class=k>to</span><span class=w> </span><span class=n>file</span><span class=w> </span><span class=ss>&quot;/var/lib/kubelet/kubeadm-flags.env&quot;</span>
<a id=__codelineno-20-34 name=__codelineno-20-34 href=#__codelineno-20-34></a><span class=p>[</span><span class=n>kubelet</span><span class=o>-</span><span class=k>start</span><span class=p>]</span><span class=w> </span><span class=n>Writing</span><span class=w> </span><span class=n>kubelet</span><span class=w> </span><span class=n>configuration</span><span class=w> </span><span class=k>to</span><span class=w> </span><span class=n>file</span><span class=w> </span><span class=ss>&quot;/var/lib/kubelet/config.yaml&quot;</span>
<a id=__codelineno-20-35 name=__codelineno-20-35 href=#__codelineno-20-35></a><span class=p>[</span><span class=n>kubelet</span><span class=o>-</span><span class=k>start</span><span class=p>]</span><span class=w> </span><span class=n>Starting</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=n>kubelet</span>
<a id=__codelineno-20-36 name=__codelineno-20-36 href=#__codelineno-20-36></a><span class=p>[</span><span class=n>control</span><span class=o>-</span><span class=n>plane</span><span class=p>]</span><span class=w> </span><span class=k>Using</span><span class=w> </span><span class=n>manifest</span><span class=w> </span><span class=n>folder</span><span class=w> </span><span class=ss>&quot;/etc/kubernetes/manifests&quot;</span>
<a id=__codelineno-20-37 name=__codelineno-20-37 href=#__codelineno-20-37></a><span class=p>[</span><span class=n>control</span><span class=o>-</span><span class=n>plane</span><span class=p>]</span><span class=w> </span><span class=n>Creating</span><span class=w> </span><span class=k>static</span><span class=w> </span><span class=n>Pod</span><span class=w> </span><span class=n>manifest</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=ss>&quot;kube-apiserver&quot;</span>
<a id=__codelineno-20-38 name=__codelineno-20-38 href=#__codelineno-20-38></a><span class=p>[</span><span class=n>control</span><span class=o>-</span><span class=n>plane</span><span class=p>]</span><span class=w> </span><span class=n>Creating</span><span class=w> </span><span class=k>static</span><span class=w> </span><span class=n>Pod</span><span class=w> </span><span class=n>manifest</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=ss>&quot;kube-controller-manager&quot;</span>
<a id=__codelineno-20-39 name=__codelineno-20-39 href=#__codelineno-20-39></a><span class=p>[</span><span class=n>control</span><span class=o>-</span><span class=n>plane</span><span class=p>]</span><span class=w> </span><span class=n>Creating</span><span class=w> </span><span class=k>static</span><span class=w> </span><span class=n>Pod</span><span class=w> </span><span class=n>manifest</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=ss>&quot;kube-scheduler&quot;</span>
<a id=__codelineno-20-40 name=__codelineno-20-40 href=#__codelineno-20-40></a><span class=p>[</span><span class=n>etcd</span><span class=p>]</span><span class=w> </span><span class=n>Creating</span><span class=w> </span><span class=k>static</span><span class=w> </span><span class=n>Pod</span><span class=w> </span><span class=n>manifest</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=k>local</span><span class=w> </span><span class=n>etcd</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=ss>&quot;/etc/kubernetes/manifests&quot;</span>
<a id=__codelineno-20-41 name=__codelineno-20-41 href=#__codelineno-20-41></a><span class=p>[</span><span class=n>wait</span><span class=o>-</span><span class=n>control</span><span class=o>-</span><span class=n>plane</span><span class=p>]</span><span class=w> </span><span class=n>Waiting</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=n>kubelet</span><span class=w> </span><span class=k>to</span><span class=w> </span><span class=n>boot</span><span class=w> </span><span class=n>up</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=n>control</span><span class=w> </span><span class=n>plane</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=k>static</span><span class=w> </span><span class=n>Pods</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>directory</span><span class=w> </span><span class=ss>&quot;/etc/kubernetes/manifests&quot;</span><span class=p>.</span><span class=w> </span><span class=n>This</span><span class=w> </span><span class=n>can</span><span class=w> </span><span class=n>take</span><span class=w> </span><span class=n>up</span><span class=w> </span><span class=k>to</span><span class=w> </span><span class=mi>4</span><span class=n>m0s</span>
<a id=__codelineno-20-42 name=__codelineno-20-42 href=#__codelineno-20-42></a><span class=p>[</span><span class=n>addons</span><span class=p>]</span><span class=w> </span><span class=n>Applied</span><span class=w> </span><span class=n>essential</span><span class=w> </span><span class=n>addon</span><span class=p>:</span><span class=w> </span><span class=n>kube</span><span class=o>-</span><span class=n>proxy</span>
<a id=__codelineno-20-43 name=__codelineno-20-43 href=#__codelineno-20-43></a>
<a id=__codelineno-20-44 name=__codelineno-20-44 href=#__codelineno-20-44></a><span class=n>Your</span><span class=w> </span><span class=n>Kubernetes</span><span class=w> </span><span class=n>control</span><span class=o>-</span><span class=n>plane</span><span class=w> </span><span class=n>has</span><span class=w> </span><span class=n>initialized</span><span class=w> </span><span class=n>successfully</span><span class=o>!</span>
<a id=__codelineno-20-45 name=__codelineno-20-45 href=#__codelineno-20-45></a>
<a id=__codelineno-20-46 name=__codelineno-20-46 href=#__codelineno-20-46></a><span class=k>To</span><span class=w> </span><span class=k>start</span><span class=w> </span><span class=k>using</span><span class=w> </span><span class=n>your</span><span class=w> </span><span class=k>cluster</span><span class=p>,</span><span class=w> </span><span class=n>you</span><span class=w> </span><span class=n>need</span><span class=w> </span><span class=k>to</span><span class=w> </span><span class=n>run</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=n>following</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=n>regular</span><span class=w> </span><span class=k>user</span><span class=p>:</span>
<a id=__codelineno-20-47 name=__codelineno-20-47 href=#__codelineno-20-47></a>
<a id=__codelineno-20-48 name=__codelineno-20-48 href=#__codelineno-20-48></a><span class=w>  </span><span class=n>mkdir</span><span class=w> </span><span class=o>-</span><span class=n>p</span><span class=w> </span><span class=err>$</span><span class=n>HOME</span><span class=o>/</span><span class=p>.</span><span class=n>kube</span>
<a id=__codelineno-20-49 name=__codelineno-20-49 href=#__codelineno-20-49></a><span class=w>  </span><span class=n>sudo</span><span class=w> </span><span class=n>cp</span><span class=w> </span><span class=o>-</span><span class=n>i</span><span class=w> </span><span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>kubernetes</span><span class=o>/</span><span class=k>admin</span><span class=p>.</span><span class=n>conf</span><span class=w> </span><span class=err>$</span><span class=n>HOME</span><span class=o>/</span><span class=p>.</span><span class=n>kube</span><span class=o>/</span><span class=n>config</span>
<a id=__codelineno-20-50 name=__codelineno-20-50 href=#__codelineno-20-50></a><span class=w>  </span><span class=n>sudo</span><span class=w> </span><span class=n>chown</span><span class=w> </span><span class=err>$</span><span class=p>(</span><span class=n>id</span><span class=w> </span><span class=o>-</span><span class=n>u</span><span class=p>):</span><span class=err>$</span><span class=p>(</span><span class=n>id</span><span class=w> </span><span class=o>-</span><span class=k>g</span><span class=p>)</span><span class=w> </span><span class=err>$</span><span class=n>HOME</span><span class=o>/</span><span class=p>.</span><span class=n>kube</span><span class=o>/</span><span class=n>config</span>
<a id=__codelineno-20-51 name=__codelineno-20-51 href=#__codelineno-20-51></a>
<a id=__codelineno-20-52 name=__codelineno-20-52 href=#__codelineno-20-52></a><span class=n>Alternatively</span><span class=p>,</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=n>you</span><span class=w> </span><span class=k>are</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=n>root</span><span class=w> </span><span class=k>user</span><span class=p>,</span><span class=w> </span><span class=n>you</span><span class=w> </span><span class=n>can</span><span class=w> </span><span class=n>run</span><span class=p>:</span>
<a id=__codelineno-20-53 name=__codelineno-20-53 href=#__codelineno-20-53></a>
<a id=__codelineno-20-54 name=__codelineno-20-54 href=#__codelineno-20-54></a><span class=w>  </span><span class=n>export</span><span class=w> </span><span class=n>KUBECONFIG</span><span class=o>=/</span><span class=n>etc</span><span class=o>/</span><span class=n>kubernetes</span><span class=o>/</span><span class=k>admin</span><span class=p>.</span><span class=n>conf</span>
<a id=__codelineno-20-55 name=__codelineno-20-55 href=#__codelineno-20-55></a>
<a id=__codelineno-20-56 name=__codelineno-20-56 href=#__codelineno-20-56></a><span class=n>You</span><span class=w> </span><span class=n>should</span><span class=w> </span><span class=n>now</span><span class=w> </span><span class=n>deploy</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=n>pod</span><span class=w> </span><span class=n>network</span><span class=w> </span><span class=k>to</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=k>cluster</span><span class=p>.</span>
<a id=__codelineno-20-57 name=__codelineno-20-57 href=#__codelineno-20-57></a><span class=n>Run</span><span class=w> </span><span class=ss>&quot;kubectl apply -f [podnetwork].yaml&quot;</span><span class=w> </span><span class=k>with</span><span class=w> </span><span class=n>one</span><span class=w> </span><span class=k>of</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=k>options</span><span class=w> </span><span class=n>listed</span><span class=w> </span><span class=k>at</span><span class=p>:</span>
<a id=__codelineno-20-58 name=__codelineno-20-58 href=#__codelineno-20-58></a><span class=w>  </span><span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>kubernetes</span><span class=p>.</span><span class=n>io</span><span class=o>/</span><span class=n>docs</span><span class=o>/</span><span class=n>concepts</span><span class=o>/</span><span class=k>cluster</span><span class=o>-</span><span class=n>administration</span><span class=o>/</span><span class=n>addons</span><span class=o>/</span>
<a id=__codelineno-20-59 name=__codelineno-20-59 href=#__codelineno-20-59></a>
<a id=__codelineno-20-60 name=__codelineno-20-60 href=#__codelineno-20-60></a><span class=n>You</span><span class=w> </span><span class=n>can</span><span class=w> </span><span class=n>now</span><span class=w> </span><span class=k>join</span><span class=w> </span><span class=k>any</span><span class=w> </span><span class=nb>number</span><span class=w> </span><span class=k>of</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=n>control</span><span class=o>-</span><span class=n>plane</span><span class=w> </span><span class=n>node</span><span class=w> </span><span class=n>running</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=n>following</span><span class=w> </span><span class=n>command</span><span class=w> </span><span class=k>on</span><span class=w> </span><span class=k>each</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>root</span><span class=p>:</span>
<a id=__codelineno-20-61 name=__codelineno-20-61 href=#__codelineno-20-61></a>
<a id=__codelineno-20-62 name=__codelineno-20-62 href=#__codelineno-20-62></a><span class=w>  </span><span class=n>kubeadm</span><span class=w> </span><span class=k>join</span><span class=w> </span><span class=mi>10</span><span class=p>.</span><span class=mi>4</span><span class=p>.</span><span class=mi>145</span><span class=p>.</span><span class=mi>100</span><span class=p>:</span><span class=mi>16443</span><span class=w> </span><span class=c1>--token abcdef.0123456789abcdef \</span>
<a id=__codelineno-20-63 name=__codelineno-20-63 href=#__codelineno-20-63></a><span class=w>        </span><span class=c1>--discovery-token-ca-cert-hash sha256:e0138c2df859fb695753e13273372da733144e7dc95634a20b49f42c5b36e76c \</span>
<a id=__codelineno-20-64 name=__codelineno-20-64 href=#__codelineno-20-64></a><span class=w>        </span><span class=c1>--control-plane --certificate-key 1ffac4970d53e793a1387ae4356949e8e4255c05574573dca2bd4ec73e369f38</span>
<a id=__codelineno-20-65 name=__codelineno-20-65 href=#__codelineno-20-65></a>
<a id=__codelineno-20-66 name=__codelineno-20-66 href=#__codelineno-20-66></a><span class=n>Please</span><span class=w> </span><span class=n>note</span><span class=w> </span><span class=n>that</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=n>certificate</span><span class=o>-</span><span class=k>key</span><span class=w> </span><span class=n>gives</span><span class=w> </span><span class=k>access</span><span class=w> </span><span class=k>to</span><span class=w> </span><span class=k>cluster</span><span class=w> </span><span class=k>sensitive</span><span class=w> </span><span class=k>data</span><span class=p>,</span><span class=w> </span><span class=n>keep</span><span class=w> </span><span class=n>it</span><span class=w> </span><span class=n>secret</span><span class=o>!</span>
<a id=__codelineno-20-67 name=__codelineno-20-67 href=#__codelineno-20-67></a><span class=k>As</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=n>safeguard</span><span class=p>,</span><span class=w> </span><span class=n>uploaded</span><span class=o>-</span><span class=n>certs</span><span class=w> </span><span class=n>will</span><span class=w> </span><span class=n>be</span><span class=w> </span><span class=n>deleted</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=n>two</span><span class=w> </span><span class=n>hours</span><span class=p>;</span><span class=w> </span><span class=k>If</span><span class=w> </span><span class=n>necessary</span><span class=p>,</span><span class=w> </span><span class=n>you</span><span class=w> </span><span class=n>can</span><span class=w> </span><span class=n>use</span>
<a id=__codelineno-20-68 name=__codelineno-20-68 href=#__codelineno-20-68></a><span class=ss>&quot;kubeadm init phase upload-certs --upload-certs&quot;</span><span class=w> </span><span class=k>to</span><span class=w> </span><span class=n>reload</span><span class=w> </span><span class=n>certs</span><span class=w> </span><span class=n>afterward</span><span class=p>.</span>
<a id=__codelineno-20-69 name=__codelineno-20-69 href=#__codelineno-20-69></a>
<a id=__codelineno-20-70 name=__codelineno-20-70 href=#__codelineno-20-70></a><span class=k>Then</span><span class=w> </span><span class=n>you</span><span class=w> </span><span class=n>can</span><span class=w> </span><span class=k>join</span><span class=w> </span><span class=k>any</span><span class=w> </span><span class=nb>number</span><span class=w> </span><span class=k>of</span><span class=w> </span><span class=n>worker</span><span class=w> </span><span class=n>nodes</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>running</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=n>following</span><span class=w> </span><span class=k>on</span><span class=w> </span><span class=k>each</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>root</span><span class=p>:</span>
<a id=__codelineno-20-71 name=__codelineno-20-71 href=#__codelineno-20-71></a>
<a id=__codelineno-20-72 name=__codelineno-20-72 href=#__codelineno-20-72></a><span class=n>kubeadm</span><span class=w> </span><span class=k>join</span><span class=w> </span><span class=mi>10</span><span class=p>.</span><span class=mi>4</span><span class=p>.</span><span class=mi>145</span><span class=p>.</span><span class=mi>100</span><span class=p>:</span><span class=mi>16443</span><span class=w> </span><span class=c1>--token abcdef.0123456789abcdef \</span>
<a id=__codelineno-20-73 name=__codelineno-20-73 href=#__codelineno-20-73></a><span class=w>        </span><span class=c1>--discovery-token-ca-cert-hash sha256:e0138c2df859fb695753e13273372da733144e7dc95634a20b49f42c5b36e76c</span>
</code></pre></div> <p><strong>根据提示，使用集群需要执行以下操作</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a><span class=n>root</span><span class=vi>@gitee</span><span class=o>-</span><span class=n>kubernetes</span><span class=o>-</span><span class=ss>master1</span><span class=p>:</span><span class=sr>/tmp# mkdir -p $HOME/</span><span class=o>.</span><span class=n>kube</span>
<a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a><span class=n>root</span><span class=vi>@gitee</span><span class=o>-</span><span class=n>kubernetes</span><span class=o>-</span><span class=ss>master1</span><span class=p>:</span><span class=sr>/tmp# sudo cp -i /e</span><span class=n>tc</span><span class=o>/</span><span class=n>kubernetes</span><span class=o>/</span><span class=n>admin</span><span class=o>.</span><span class=n>conf</span><span class=w> </span><span class=vg>$HOME</span><span class=o>/.</span><span class=n>kube</span><span class=o>/</span><span class=n>config</span>
<a id=__codelineno-21-3 name=__codelineno-21-3 href=#__codelineno-21-3></a><span class=n>root</span><span class=vi>@gitee</span><span class=o>-</span><span class=n>kubernetes</span><span class=o>-</span><span class=ss>master1</span><span class=p>:</span><span class=sr>/tmp# sudo chown $(id -u):$(id -g) $HOME/</span><span class=o>.</span><span class=n>kube</span><span class=o>/</span><span class=n>config</span>
</code></pre></div> <h3 id=46-安装-calico-网络>4.6 安装 Calico 网络<a class=headerlink href=#46-安装-calico-网络 title="Permanent link">&para;</a></h3> <p>在 master 里操作，这里选择使用 calico 网络插件</p> <div class=highlight><pre><span></span><code><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a>root@gitee-kubernetes-master1:~/workdir/kubernetes_install/calico#<span class=w> </span>wget<span class=w> </span>https://raw.githubusercontent.com/projectcalico/calico/v3.26.1/manifests/calico.yaml
<a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a>
<a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a>
<a id=__codelineno-22-4 name=__codelineno-22-4 href=#__codelineno-22-4></a>root@gitee-kubernetes-master1:~/workdir/kubernetes_install/calico#<span class=w> </span>cat<span class=w> </span>calico.yaml<span class=w> </span><span class=p>|</span>grep<span class=w> </span>-A1<span class=w> </span>CALICO_IPV4POOL_CIDR
<a id=__codelineno-22-5 name=__codelineno-22-5 href=#__codelineno-22-5></a><span class=w>            </span>-<span class=w> </span>name:<span class=w> </span>CALICO_IPV4POOL_CIDR
<a id=__codelineno-22-6 name=__codelineno-22-6 href=#__codelineno-22-6></a><span class=w>              </span>value:<span class=w> </span><span class=s2>&quot;10.10.0.0/16&quot;</span>
<a id=__codelineno-22-7 name=__codelineno-22-7 href=#__codelineno-22-7></a>root@gitee-kubernetes-master1:~/workdir/kubernetes_install/calico#<span class=w> </span>kubectl<span class=w> </span>apply<span class=w> </span>-f<span class=w> </span>calico.yaml
<a id=__codelineno-22-8 name=__codelineno-22-8 href=#__codelineno-22-8></a>poddisruptionbudget.policy/calico-kube-controllers<span class=w> </span>created
<a id=__codelineno-22-9 name=__codelineno-22-9 href=#__codelineno-22-9></a>serviceaccount/calico-kube-controllers<span class=w> </span>created
<a id=__codelineno-22-10 name=__codelineno-22-10 href=#__codelineno-22-10></a>serviceaccount/calico-node<span class=w> </span>created
<a id=__codelineno-22-11 name=__codelineno-22-11 href=#__codelineno-22-11></a>serviceaccount/calico-cni-plugin<span class=w> </span>created
<a id=__codelineno-22-12 name=__codelineno-22-12 href=#__codelineno-22-12></a>configmap/calico-config<span class=w> </span>created
<a id=__codelineno-22-13 name=__codelineno-22-13 href=#__codelineno-22-13></a>.....
<a id=__codelineno-22-14 name=__codelineno-22-14 href=#__codelineno-22-14></a>
<a id=__codelineno-22-15 name=__codelineno-22-15 href=#__codelineno-22-15></a>wget<span class=w> </span>https://github.com/projectcalico/calicoctl/releases/download/v2.0.0/calicoctl
<a id=__codelineno-22-16 name=__codelineno-22-16 href=#__codelineno-22-16></a>mv<span class=w> </span>calicoctl<span class=w> </span>/usr/bin<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>chmod<span class=w> </span>+x<span class=w> </span>/usr/bin/calicoctl
<a id=__codelineno-22-17 name=__codelineno-22-17 href=#__codelineno-22-17></a><span class=nb>export</span><span class=w> </span><span class=nv>CALICO_DATASTORE_TYPE</span><span class=o>=</span>kubernetes
<a id=__codelineno-22-18 name=__codelineno-22-18 href=#__codelineno-22-18></a><span class=nb>export</span><span class=w> </span><span class=nv>CALICO_KUBECONFIG</span><span class=o>=</span>~/.kube/config
<a id=__codelineno-22-19 name=__codelineno-22-19 href=#__codelineno-22-19></a>calicoctl<span class=w> </span>get<span class=w> </span>ippool
<a id=__codelineno-22-20 name=__codelineno-22-20 href=#__codelineno-22-20></a>NAME<span class=w>                  </span>CIDR
<a id=__codelineno-22-21 name=__codelineno-22-21 href=#__codelineno-22-21></a>default-ipv4-ippool<span class=w>   </span><span class=m>10</span>.10.0.0/16
<a id=__codelineno-22-22 name=__codelineno-22-22 href=#__codelineno-22-22></a>calicoctl<span class=w> </span>get<span class=w> </span>node
</code></pre></div> <h3 id=47-加入其余-master-节点>4.7 加入其余 Master 节点<a class=headerlink href=#47-加入其余-master-节点 title="Permanent link">&para;</a></h3> <p>下面将 master2 和 master3 这 2 个 Master 节点也加入到 Master 节点的控制层中。</p> <p>以下操作分别在 master2 和 master3 上面执行，其中 master2 节点的命令如下：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a>kubeadm<span class=w> </span>join<span class=w> </span><span class=m>10</span>.4.145.100:16443<span class=w> </span>--token<span class=w> </span>abcdef.0123456789abcdef<span class=w> </span><span class=se>\</span>
<a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a><span class=w>      </span>--discovery-token-ca-cert-hash<span class=w> </span>sha256:e0138c2df859fb695753e13273372da733144e7dc95634a20b49f42c5b36e76c<span class=w> </span><span class=se>\</span>
<a id=__codelineno-23-3 name=__codelineno-23-3 href=#__codelineno-23-3></a><span class=w>      </span>--control-plane<span class=w> </span>--certificate-key<span class=w> </span>1ffac4970d53e793a1387ae4356949e8e4255c05574573dca2bd4ec73e369f38
</code></pre></div> <p>等待命令执行完成之后，再次查看集群中的 Pod 状态，如下所示：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a>root@gitee-kubernetes-master1:/home/ubuntu#<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>node
<a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a>NAME<span class=w>                       </span>STATUS<span class=w>   </span>ROLES<span class=w>           </span>AGE<span class=w>    </span>VERSION
<a id=__codelineno-24-3 name=__codelineno-24-3 href=#__codelineno-24-3></a>gitee-kubernetes-master1<span class=w>   </span>Ready<span class=w>    </span>control-plane<span class=w>   </span>18m<span class=w>    </span>v1.26.3
<a id=__codelineno-24-4 name=__codelineno-24-4 href=#__codelineno-24-4></a>gitee-kubernetes-master2<span class=w>   </span>Ready<span class=w>    </span>control-plane<span class=w>   </span>111s<span class=w>   </span>v1.26.3
<a id=__codelineno-24-5 name=__codelineno-24-5 href=#__codelineno-24-5></a>gitee-kubernetes-master3<span class=w>   </span>Ready<span class=w>    </span>control-plane<span class=w>   </span>106s<span class=w>   </span>v1.26.3
<a id=__codelineno-24-6 name=__codelineno-24-6 href=#__codelineno-24-6></a>
<a id=__codelineno-24-7 name=__codelineno-24-7 href=#__codelineno-24-7></a>root@gitee-kubernetes-master1:/home/ubuntu#<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>pod<span class=w> </span>-A
<a id=__codelineno-24-8 name=__codelineno-24-8 href=#__codelineno-24-8></a>NAMESPACE<span class=w>     </span>NAME<span class=w>                                               </span>READY<span class=w>   </span>STATUS<span class=w>    </span>RESTARTS<span class=w>       </span>AGE
<a id=__codelineno-24-9 name=__codelineno-24-9 href=#__codelineno-24-9></a>kube-system<span class=w>   </span>calico-kube-controllers-949d58b75-dq9f4<span class=w>            </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>              </span>4m48s
<a id=__codelineno-24-10 name=__codelineno-24-10 href=#__codelineno-24-10></a>kube-system<span class=w>   </span>calico-node-4wxzt<span class=w>                                  </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>              </span>2m3s
<a id=__codelineno-24-11 name=__codelineno-24-11 href=#__codelineno-24-11></a>kube-system<span class=w>   </span>calico-node-74jjs<span class=w>                                  </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>              </span>2m12s
<a id=__codelineno-24-12 name=__codelineno-24-12 href=#__codelineno-24-12></a>kube-system<span class=w>   </span>calico-node-cwqw6<span class=w>                                  </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>              </span>4m48s
<a id=__codelineno-24-13 name=__codelineno-24-13 href=#__codelineno-24-13></a>kube-system<span class=w>   </span>coredns-787d4945fb-gqs9q<span class=w>                           </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>              </span>18m
<a id=__codelineno-24-14 name=__codelineno-24-14 href=#__codelineno-24-14></a>kube-system<span class=w>   </span>coredns-787d4945fb-vtwpv<span class=w>                           </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>              </span>18m
<a id=__codelineno-24-15 name=__codelineno-24-15 href=#__codelineno-24-15></a>kube-system<span class=w>   </span>etcd-gitee-kubernetes-master1<span class=w>                      </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>4</span><span class=w>              </span>18m
<a id=__codelineno-24-16 name=__codelineno-24-16 href=#__codelineno-24-16></a>kube-system<span class=w>   </span>etcd-gitee-kubernetes-master2<span class=w>                      </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>              </span>2m1s
<a id=__codelineno-24-17 name=__codelineno-24-17 href=#__codelineno-24-17></a>kube-system<span class=w>   </span>etcd-gitee-kubernetes-master3<span class=w>                      </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>              </span>117s
<a id=__codelineno-24-18 name=__codelineno-24-18 href=#__codelineno-24-18></a>kube-system<span class=w>   </span>kube-apiserver-gitee-kubernetes-master1<span class=w>            </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>4</span><span class=w>              </span>18m
<a id=__codelineno-24-19 name=__codelineno-24-19 href=#__codelineno-24-19></a>kube-system<span class=w>   </span>kube-apiserver-gitee-kubernetes-master2<span class=w>            </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>              </span>114s
<a id=__codelineno-24-20 name=__codelineno-24-20 href=#__codelineno-24-20></a>kube-system<span class=w>   </span>kube-apiserver-gitee-kubernetes-master3<span class=w>            </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>1</span><span class=w> </span><span class=o>(</span>117s<span class=w> </span>ago<span class=o>)</span><span class=w>   </span>116s
<a id=__codelineno-24-21 name=__codelineno-24-21 href=#__codelineno-24-21></a>kube-system<span class=w>   </span>kube-controller-manager-gitee-kubernetes-master1<span class=w>   </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>4</span><span class=w>              </span>18m
<a id=__codelineno-24-22 name=__codelineno-24-22 href=#__codelineno-24-22></a>kube-system<span class=w>   </span>kube-controller-manager-gitee-kubernetes-master2<span class=w>   </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>              </span>2m6s
<a id=__codelineno-24-23 name=__codelineno-24-23 href=#__codelineno-24-23></a>kube-system<span class=w>   </span>kube-controller-manager-gitee-kubernetes-master3<span class=w>   </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>              </span>2m
<a id=__codelineno-24-24 name=__codelineno-24-24 href=#__codelineno-24-24></a>kube-system<span class=w>   </span>kube-proxy-74k64<span class=w>                                   </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>              </span>18m
<a id=__codelineno-24-25 name=__codelineno-24-25 href=#__codelineno-24-25></a>kube-system<span class=w>   </span>kube-proxy-86tdt<span class=w>                                   </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>              </span>2m12s
<a id=__codelineno-24-26 name=__codelineno-24-26 href=#__codelineno-24-26></a>kube-system<span class=w>   </span>kube-proxy-jf77p<span class=w>                                   </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>              </span>2m3s
<a id=__codelineno-24-27 name=__codelineno-24-27 href=#__codelineno-24-27></a>kube-system<span class=w>   </span>kube-scheduler-gitee-kubernetes-master1<span class=w>            </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>4</span><span class=w>              </span>18m
<a id=__codelineno-24-28 name=__codelineno-24-28 href=#__codelineno-24-28></a>kube-system<span class=w>   </span>kube-scheduler-gitee-kubernetes-master2<span class=w>            </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>              </span>2m1s
<a id=__codelineno-24-29 name=__codelineno-24-29 href=#__codelineno-24-29></a>kube-system<span class=w>   </span>kube-scheduler-gitee-kubernetes-master3<span class=w>            </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>              </span>116s
</code></pre></div> <p>可 以 发 现 ， apiserver 、 controller-manager 、 etcd 以 及 scheduler 等重要组件都已经有 3 个节点在运行。</p> <p>此时，在 haproxy 的统计报告界面，可以发现 3 个 Master 节点都已经变成绿色了。</p> <ul> <li><a href=https://haproxy.autom.studio/haproxy-status>https://haproxy.autom.studio/haproxy-status</a></li> </ul> <h3 id=48-加入工作节点>4.8 加入工作节点<a class=headerlink href=#48-加入工作节点 title="Permanent link">&para;</a></h3> <p>工作节点的加入比较简单，在所有的安装环境中将 kubectl、kubelet 和 kubeadm 等组件都安装完成之后，使用在初始化 master01 时系统给出的命令即可。在本例中，加入命令为：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a><span class=c1># 查看token</span>
<a id=__codelineno-25-2 name=__codelineno-25-2 href=#__codelineno-25-2></a>$<span class=w> </span>kubeadm<span class=w> </span>token<span class=w> </span>create<span class=w> </span>--print-join-command
<a id=__codelineno-25-3 name=__codelineno-25-3 href=#__codelineno-25-3></a>kubeadm<span class=w> </span>join<span class=w> </span><span class=m>10</span>.4.145.100:16443<span class=w> </span>--token<span class=w> </span>x7j9gh.fw5mslqrn5w8hjvz<span class=w> </span>--discovery-token-ca-cert-hash<span class=w> </span>sha256:e0138c2df859fb695753e13273372da733144e7dc95634a20b49f42c5b36e76c
<a id=__codelineno-25-4 name=__codelineno-25-4 href=#__codelineno-25-4></a>
<a id=__codelineno-25-5 name=__codelineno-25-5 href=#__codelineno-25-5></a>$<span class=w> </span>kubeadm<span class=w> </span>join<span class=w> </span><span class=m>10</span>.4.145.100:16443<span class=w> </span>--token<span class=w> </span>x7j9gh.fw5mslqrn5w8hjvz<span class=w> </span>--discovery-token-ca-cert-hash<span class=w> </span>sha256:e0138c2df859fb695753e13273372da733144e7dc95634a20b49f42c5b36e76c
</code></pre></div> <h2 id=5-安装常用工具>5. 安装常用工具<a class=headerlink href=#5-安装常用工具 title="Permanent link">&para;</a></h2> <h3 id=51-安装-kubectl>5.1 安装 kubectl<a class=headerlink href=#51-安装-kubectl title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a>root@gitee-sre2:/home/ubuntu#<span class=w> </span>apt-get<span class=w> </span>-y<span class=w> </span>install<span class=w> </span>bash-completion
<a id=__codelineno-26-2 name=__codelineno-26-2 href=#__codelineno-26-2></a>root@gitee-sre2:/home/ubuntu#<span class=w> </span>curl<span class=w> </span>-SL<span class=w> </span>https://dl.k8s.io/release/v1.26.3/bin/linux/amd64/kubectl<span class=w> </span>-o<span class=w> </span>/usr/bin/kubectl
<a id=__codelineno-26-3 name=__codelineno-26-3 href=#__codelineno-26-3></a>root@gitee-sre2:/home/ubuntu#<span class=w> </span>chmod<span class=w> </span><span class=m>755</span><span class=w>  </span>/usr/bin/kubectl
<a id=__codelineno-26-4 name=__codelineno-26-4 href=#__codelineno-26-4></a>root@gitee-sre2:/home/ubuntu#<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>nodes
<a id=__codelineno-26-5 name=__codelineno-26-5 href=#__codelineno-26-5></a>NAME<span class=w>                       </span>STATUS<span class=w>   </span>ROLES<span class=w>           </span>AGE<span class=w>    </span>VERSION
<a id=__codelineno-26-6 name=__codelineno-26-6 href=#__codelineno-26-6></a>gitee-kubernetes-master1<span class=w>   </span>Ready<span class=w>    </span>control-plane<span class=w>   </span>129m<span class=w>   </span>v1.26.3
<a id=__codelineno-26-7 name=__codelineno-26-7 href=#__codelineno-26-7></a>gitee-kubernetes-master2<span class=w>   </span>Ready<span class=w>    </span>control-plane<span class=w>   </span>112m<span class=w>   </span>v1.26.3
<a id=__codelineno-26-8 name=__codelineno-26-8 href=#__codelineno-26-8></a>gitee-kubernetes-master3<span class=w>   </span>Ready<span class=w>    </span>control-plane<span class=w>   </span>112m<span class=w>   </span>v1.26.3
<a id=__codelineno-26-9 name=__codelineno-26-9 href=#__codelineno-26-9></a>gitee-kubernetes-node01<span class=w>    </span>Ready<span class=w>    </span>&lt;none&gt;<span class=w>          </span>59m<span class=w>    </span>v1.26.3
<a id=__codelineno-26-10 name=__codelineno-26-10 href=#__codelineno-26-10></a>.....
<a id=__codelineno-26-11 name=__codelineno-26-11 href=#__codelineno-26-11></a><span class=c1># kubectl补全</span>
<a id=__codelineno-26-12 name=__codelineno-26-12 href=#__codelineno-26-12></a><span class=nb>source</span><span class=w> </span>/etc/profile.d/bash_completion.sh
<a id=__codelineno-26-13 name=__codelineno-26-13 href=#__codelineno-26-13></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;source &lt;(kubectl completion bash)&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span>~/.bash_profile
<a id=__codelineno-26-14 name=__codelineno-26-14 href=#__codelineno-26-14></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;source /usr/share/bash-completion/bash_completion&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span>~/.bash_profile
<a id=__codelineno-26-15 name=__codelineno-26-15 href=#__codelineno-26-15></a><span class=nb>source</span><span class=w> </span>~/.bash_profile
<a id=__codelineno-26-16 name=__codelineno-26-16 href=#__codelineno-26-16></a>
<a id=__codelineno-26-17 name=__codelineno-26-17 href=#__codelineno-26-17></a><span class=c1># 快捷键</span>
<a id=__codelineno-26-18 name=__codelineno-26-18 href=#__codelineno-26-18></a>cat<span class=w> </span>&gt;&gt;<span class=w> </span>~/.bashrc<span class=w> </span><span class=s>&lt;&lt;EOF</span>
<a id=__codelineno-26-19 name=__codelineno-26-19 href=#__codelineno-26-19></a><span class=s>alias k=kubectl</span>
<a id=__codelineno-26-20 name=__codelineno-26-20 href=#__codelineno-26-20></a><span class=s>complete -o default -F __start_kubectl k</span>
<a id=__codelineno-26-21 name=__codelineno-26-21 href=#__codelineno-26-21></a><span class=s>EOF</span>
<a id=__codelineno-26-22 name=__codelineno-26-22 href=#__codelineno-26-22></a>
<a id=__codelineno-26-23 name=__codelineno-26-23 href=#__codelineno-26-23></a><span class=nb>source</span><span class=w>  </span>~/.bashrc
</code></pre></div> <h3 id=52-安装-helm>5.2 安装 helm<a class=headerlink href=#52-安装-helm title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a><span class=c1># helm</span>
<a id=__codelineno-27-2 name=__codelineno-27-2 href=#__codelineno-27-2></a>$<span class=w> </span>wget<span class=w> </span>-c<span class=w> </span>https://repo.huaweicloud.com/helm/v3.8.0/helm-v3.8.0-linux-386.tar.gz
<a id=__codelineno-27-3 name=__codelineno-27-3 href=#__codelineno-27-3></a>$<span class=w> </span>tar<span class=w> </span>-zxvf<span class=w> </span>helm-v3.8.0-linux-386.tar.gz
<a id=__codelineno-27-4 name=__codelineno-27-4 href=#__codelineno-27-4></a>$<span class=w> </span>cp<span class=w> </span>linux-386/helm<span class=w> </span>/usr/local/bin/
<a id=__codelineno-27-5 name=__codelineno-27-5 href=#__codelineno-27-5></a>$<span class=w> </span>chmod<span class=w> </span>a+x<span class=w>  </span>/usr/local/bin/helm
<a id=__codelineno-27-6 name=__codelineno-27-6 href=#__codelineno-27-6></a>$<span class=w> </span>chmod<span class=w> </span><span class=m>600</span><span class=w> </span>~/.kube/config
<a id=__codelineno-27-7 name=__codelineno-27-7 href=#__codelineno-27-7></a>$<span class=w> </span>helm<span class=w> </span>list<span class=w> </span>-A
<a id=__codelineno-27-8 name=__codelineno-27-8 href=#__codelineno-27-8></a>NAME<span class=w>    </span>NAMESPACE<span class=w>       </span>REVISION<span class=w>        </span>UPDATED<span class=w> </span>STATUS<span class=w>  </span>CHART<span class=w>   </span>APP<span class=w> </span>VERSION
<a id=__codelineno-27-9 name=__codelineno-27-9 href=#__codelineno-27-9></a>
<a id=__codelineno-27-10 name=__codelineno-27-10 href=#__codelineno-27-10></a><span class=c1># helm补全</span>
<a id=__codelineno-27-11 name=__codelineno-27-11 href=#__codelineno-27-11></a>$<span class=w> </span>helm<span class=w> </span>completion<span class=w> </span>bash<span class=w> </span>&gt;<span class=w> </span>/etc/bash_completion.d/helm
<a id=__codelineno-27-12 name=__codelineno-27-12 href=#__codelineno-27-12></a>
<a id=__codelineno-27-13 name=__codelineno-27-13 href=#__codelineno-27-13></a>$<span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;helm completion bash &gt; /etc/bash_completion.d/helm&quot;</span><span class=w> </span>&gt;&gt;<span class=w>  </span>~/.bashrc
</code></pre></div> <blockquote> <p>如何加速?</p> </blockquote> <p><a href="https://github.com/DaoCloud/public-binary-files-mirror?tab=readme-ov-file">DaoCloud/public-binary-files-mirror: 很多 binary 文件 都在国外。国内下载很慢，需要加速。 (github.com)</a></p> <h3 id=53-kubectx-kubens-and-fzf>5.3 Kubectx Kubens and fzf<a class=headerlink href=#53-kubectx-kubens-and-fzf title="Permanent link">&para;</a></h3> <p>通常情况下，可能会拥有多套集群，开发/测试/生产，本地或云集群。可以使用 Kubectx 和 Kubens 快速地在不同的集群和 namespace 直接切换。</p> <p>除此之外， fzf 提供了交互的方式来切换上下文，因此不必记住任何集群或 namespace。</p> <p>安装 kubectx 和 kubens 的依赖项：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a><span class=c1># 下载 kubectx 和 kubens 脚本文件</span>
<a id=__codelineno-28-2 name=__codelineno-28-2 href=#__codelineno-28-2></a>git<span class=w> </span>clone<span class=w> </span>https://github.com/ahmetb/kubectx.git<span class=w> </span>~/.kubectx
<a id=__codelineno-28-3 name=__codelineno-28-3 href=#__codelineno-28-3></a>sudo<span class=w> </span>ln<span class=w> </span>-s<span class=w> </span>~/.kubectx/kubectx<span class=w> </span>/usr/local/bin/kubectx
<a id=__codelineno-28-4 name=__codelineno-28-4 href=#__codelineno-28-4></a>sudo<span class=w> </span>ln<span class=w> </span>-s<span class=w> </span>~/.kubectx/kubens<span class=w> </span>/usr/local/bin/kubens
<a id=__codelineno-28-5 name=__codelineno-28-5 href=#__codelineno-28-5></a>
<a id=__codelineno-28-6 name=__codelineno-28-6 href=#__codelineno-28-6></a>
<a id=__codelineno-28-7 name=__codelineno-28-7 href=#__codelineno-28-7></a>
<a id=__codelineno-28-8 name=__codelineno-28-8 href=#__codelineno-28-8></a><span class=c1># 配置 bash 自动完成</span>
<a id=__codelineno-28-9 name=__codelineno-28-9 href=#__codelineno-28-9></a><span class=nb>echo</span><span class=w> </span><span class=s1>&#39;source ~/.kubectx/completion/kubectx.bash&#39;</span><span class=w> </span>&gt;&gt;<span class=w> </span>~/.bash_profile
<a id=__codelineno-28-10 name=__codelineno-28-10 href=#__codelineno-28-10></a><span class=nb>echo</span><span class=w> </span><span class=s1>&#39;source ~/.kubectx/completion/kubens.bash&#39;</span><span class=w> </span>&gt;&gt;<span class=w> </span>~/.bash_profile
<a id=__codelineno-28-11 name=__codelineno-28-11 href=#__codelineno-28-11></a><span class=nb>source</span><span class=w> </span>~/.bash_profile
</code></pre></div> <p>至此，kubectx 和 kubens 已成功安装。</p> <p>要安装 fzf，请按照以下步骤操作：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-29-1 name=__codelineno-29-1 href=#__codelineno-29-1></a><span class=c1># 1.下载和安装 fzf</span>
<a id=__codelineno-29-2 name=__codelineno-29-2 href=#__codelineno-29-2></a>git<span class=w> </span>clone<span class=w> </span>--depth<span class=w> </span><span class=m>1</span><span class=w> </span>https://github.com/junegunn/fzf.git<span class=w> </span>~/.fzf
<a id=__codelineno-29-3 name=__codelineno-29-3 href=#__codelineno-29-3></a>~/.fzf/install
<a id=__codelineno-29-4 name=__codelineno-29-4 href=#__codelineno-29-4></a>
<a id=__codelineno-29-5 name=__codelineno-29-5 href=#__codelineno-29-5></a>
<a id=__codelineno-29-6 name=__codelineno-29-6 href=#__codelineno-29-6></a><span class=c1># 2.配置 bash 自动完成：</span>
<a id=__codelineno-29-7 name=__codelineno-29-7 href=#__codelineno-29-7></a><span class=nb>echo</span><span class=w> </span><span class=s1>&#39;[ -f ~/.fzf.bash ] &amp;&amp; source ~/.fzf.bash&#39;</span><span class=w> </span>&gt;&gt;<span class=w> </span>~/.bashrc
<a id=__codelineno-29-8 name=__codelineno-29-8 href=#__codelineno-29-8></a><span class=nb>source</span><span class=w> </span>~/.bashrc
</code></pre></div> <p>现在，fzf 已成功安装。</p> <p>请记住，在安装之前，请确保您的系统已经安装了 git 和 curl。</p> <h3 id=54-kubectl-插件管理器-krew>5.4 kubectl 插件管理器 krew<a class=headerlink href=#54-kubectl-插件管理器-krew title="Permanent link">&para;</a></h3> <p>linux-x86_64 手动安装</p> <div class=highlight><pre><span></span><code><a id=__codelineno-30-1 name=__codelineno-30-1 href=#__codelineno-30-1></a>wget<span class=w> </span>https://github.com/kubernetes-sigs/krew/releases/download/v0.4.4/krew-linux_amd64.tar.gz
<a id=__codelineno-30-2 name=__codelineno-30-2 href=#__codelineno-30-2></a>tar<span class=w> </span>zxvf<span class=w> </span>krew-linux_amd64.tar.gz<span class=w> </span>./krew-linux_amd64
<a id=__codelineno-30-3 name=__codelineno-30-3 href=#__codelineno-30-3></a>./krew-linux_amd64<span class=w> </span>install<span class=w> </span>krew
<a id=__codelineno-30-4 name=__codelineno-30-4 href=#__codelineno-30-4></a>
<a id=__codelineno-30-5 name=__codelineno-30-5 href=#__codelineno-30-5></a><span class=c1># 配置环境变量</span>
<a id=__codelineno-30-6 name=__codelineno-30-6 href=#__codelineno-30-6></a><span class=nb>echo</span><span class=w> </span><span class=s1>&#39;export PATH=&quot;${KREW_ROOT:-$HOME/.krew}/bin:$PATH&quot;&#39;</span><span class=w> </span>&gt;&gt;<span class=w> </span>~/.bashrc
<a id=__codelineno-30-7 name=__codelineno-30-7 href=#__codelineno-30-7></a><span class=nb>source</span><span class=w> </span>~/.bashrc
</code></pre></div> <p>krew 的使用</p> <div class=highlight><pre><span></span><code><a id=__codelineno-31-1 name=__codelineno-31-1 href=#__codelineno-31-1></a><span class=err>kubectl</span><span class=w> </span><span class=err>krew</span><span class=w> </span><span class=err>search</span><span class=w>               </span><span class=c># 显示所有插件</span>
<a id=__codelineno-31-2 name=__codelineno-31-2 href=#__codelineno-31-2></a><span class=err>kubectl</span><span class=w> </span><span class=err>krew</span><span class=w> </span><span class=err>install</span><span class=w> </span><span class=err>view-secret</span><span class=w>  </span><span class=c># 安装名为view-secret的插件</span>
<a id=__codelineno-31-3 name=__codelineno-31-3 href=#__codelineno-31-3></a><span class=err>kubectl</span><span class=w> </span><span class=err>view-secret</span><span class=w>               </span><span class=c># 使用该插件</span>
<a id=__codelineno-31-4 name=__codelineno-31-4 href=#__codelineno-31-4></a><span class=err>kubectl</span><span class=w> </span><span class=err>krew</span><span class=w> </span><span class=err>upgrade</span><span class=w>              </span><span class=c># 升级安装的插件</span>
<a id=__codelineno-31-5 name=__codelineno-31-5 href=#__codelineno-31-5></a><span class=err>kubectl</span><span class=w> </span><span class=err>krew</span><span class=w> </span><span class=err>remove</span><span class=w> </span><span class=err>view-secret</span><span class=w>   </span><span class=c># 卸载插件</span>
</code></pre></div> <h3 id=55-kubectl-neat>5.5 kubectl-neat<a class=headerlink href=#55-kubectl-neat title="Permanent link">&para;</a></h3> <p>项目地址：kubectl-neat(opens new window)</p> <p>项目说明：一款在执行 kubectl 通过 -o 导出 yaml 时剔除无用信息的工具</p> <p><a href=https://github.com/itaysk/kubectl-neat>https://github.com/itaysk/kubectl-neat</a></p> <p>直接下载二进制文件到/usr/local/bin 下即可。</p> <div class=highlight><pre><span></span><code><a id=__codelineno-32-1 name=__codelineno-32-1 href=#__codelineno-32-1></a>$<span class=w> </span>wget<span class=w> </span><span class=s2>&quot;https://github.com/itaysk/kubectl-neat/releases/download/v2.0.3/kubectl-neat_linux_amd64.tar.gz&quot;</span>
<a id=__codelineno-32-2 name=__codelineno-32-2 href=#__codelineno-32-2></a>$<span class=w> </span>tar<span class=w> </span>zxvf<span class=w> </span>kubectl-neat_linux_amd64.tar.gz
<a id=__codelineno-32-3 name=__codelineno-32-3 href=#__codelineno-32-3></a>$<span class=w> </span>mv<span class=w> </span>kubectl-neat<span class=w> </span>/usr/local/bin/
</code></pre></div> <p>或者如下方式安装,需要安装 Go 开发环境</p> <div class=highlight><pre><span></span><code><a id=__codelineno-33-1 name=__codelineno-33-1 href=#__codelineno-33-1></a>$<span class=w> </span>git<span class=w> </span>clone<span class=w> </span>https://github.com/itaysk/kubectl-neat.git
<a id=__codelineno-33-2 name=__codelineno-33-2 href=#__codelineno-33-2></a>$<span class=w> </span><span class=nb>cd</span><span class=w> </span>kubectl-neat
<a id=__codelineno-33-3 name=__codelineno-33-3 href=#__codelineno-33-3></a>$<span class=w> </span>go<span class=w> </span>build<span class=w> </span>.
<a id=__codelineno-33-4 name=__codelineno-33-4 href=#__codelineno-33-4></a>$<span class=w> </span>mv<span class=w> </span>kubectl-neat<span class=w> </span>/usr/local/bin/
</code></pre></div> <h2 id=6-kubernetes-节点调度规划>6. kubernetes 节点调度规划<a class=headerlink href=#6-kubernetes-节点调度规划 title="Permanent link">&para;</a></h2> <table> <thead> <tr> <th>节点名称</th> <th>ROLES</th> <th>IP</th> <th>标签</th> <th>污点</th> <th>备注</th> </tr> </thead> <tbody> <tr> <td>master</td> <td>master</td> <td>10.4.145.92<br>10.4.145.129<br>10.4.145.169</td> <td>node-role.kubernetes.io/master</td> <td>node-role.kubernetes.io/control-plane:NoSchedule</td> <td>Master 节点默认不允许部署非系统 Pod</td> </tr> <tr> <td>gitee-kubernetes-node01</td> <td>worker</td> <td>10.4.145.107</td> <td>node_role=giteeInternal</td> <td>GiteeInternalOnly=yes:NoSchedule</td> <td>Internal 标签的 Pod</td> </tr> <tr> <td>gitee-kubernetes-node02</td> <td>worker</td> <td>10.4.145.32</td> <td>node_role=giteeInternal</td> <td>GiteeInternalOnly=yes:NoSchedule</td> <td>Internal 标签的 Pod</td> </tr> <tr> <td>gitee-kubernetes-node03</td> <td>worker</td> <td>10.4.145.79</td> <td>node_role=giteePubcomm</td> <td>GiteePubcommOnly=yes:NoSchedule</td> <td>Pubcomm 标签的 pod</td> </tr> <tr> <td>gitee-kubernetes-node04</td> <td>worker</td> <td>10.4.145.37</td> <td>node_role=giteePubcomm</td> <td>GiteePubcommOnly=yes:NoSchedule</td> <td>Pubcomm 标签的 pod</td> </tr> <tr> <td>gitee-kubernetes-node05</td> <td>worker</td> <td>10.4.145.168</td> <td>node_role=giteeRuby</td> <td>GiteeRubyOnly=yes:NoSchedule</td> <td>Ruby 标签的 pod</td> </tr> <tr> <td>gitee-kubernetes-node06</td> <td>worker</td> <td>10.4.145.113</td> <td>node_role=giteeRuby</td> <td>GiteeRubyOnly=yes:NoSchedule</td> <td>Ruby 标签的 pod</td> </tr> <tr> <td>gitee-kubernetes-node07</td> <td>worker</td> <td>10.4.145.34</td> <td>node_role=giteeRuby</td> <td>GiteeRubyOnly=yes:NoSchedule</td> <td>Ruby 标签的 pod</td> </tr> <tr> <td>gitee-kubernetes-node08</td> <td>worker</td> <td>10.4.145.25</td> <td>node_role=giteeMonitor</td> <td>无污点</td> <td>Monitor 标签的 pod</td> </tr> <tr> <td>gitee-kubernetes-node09</td> <td>worker</td> <td>10.4.145.57</td> <td>node_role=giteeFrontend</td> <td>GiteeFrontendOnly=yes:NoSchedule</td> <td>Frontend 标签的 pod</td> </tr> <tr> <td>gitee-kubernetes-node10</td> <td>worker</td> <td>10.4.145.116</td> <td>node_role=giteeFrontend</td> <td>GiteeFrontendOnly=yes:NoSchedule</td> <td>Frontend 标签的 pod</td> </tr> <tr> <td>gitee-kubernetes-node11</td> <td>worker</td> <td>10.4.145.26</td> <td>node_role=giteeFrontend</td> <td>GiteeFrontendOnly=yes:NoSchedule</td> <td>Frontend 标签的 pod</td> </tr> <tr> <td>gitee-kubernetes-node12</td> <td>worker</td> <td>10.4.145.123</td> <td>node_role=giteeMonitor</td> <td>无污点</td> <td>Monitor 标签的 pod</td> </tr> <tr> <td>gitee-kubernetes-node13</td> <td>worker</td> <td>10.4.145.144</td> <td>node_role=giteeRuby</td> <td>GiteeRubyOnly=yes:NoSchedule</td> <td>Ruby 标签的 pod</td> </tr> <tr> <td>gitee-kubernetes-node14</td> <td>worker</td> <td>10.4.145.53</td> <td>node_role=giteeRuby</td> <td>GiteeRubyOnly=yes:NoSchedule</td> <td>Ruby 标签的 pod</td> </tr> <tr> <td>gitee-kubernetes-node15</td> <td>worker</td> <td>10.4.145.52</td> <td>node_role=giteeRuby</td> <td>GiteeRubyOnly=yes:NoSchedule</td> <td>Ruby 标签的 pod</td> </tr> </tbody> </table> <p>设置标签和污点的命令如下：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-34-1 name=__codelineno-34-1 href=#__codelineno-34-1></a><span class=c1># ----------------gitee k8s--------------------------</span>
<a id=__codelineno-34-2 name=__codelineno-34-2 href=#__codelineno-34-2></a><span class=c1># 设置标签</span>
<a id=__codelineno-34-3 name=__codelineno-34-3 href=#__codelineno-34-3></a>kubectl<span class=w> </span>label<span class=w> </span>nodes<span class=w> </span>gitee-kubernetes-node01<span class=w> </span><span class=nv>node_role</span><span class=o>=</span>giteeInternal
<a id=__codelineno-34-4 name=__codelineno-34-4 href=#__codelineno-34-4></a>kubectl<span class=w> </span>label<span class=w> </span>nodes<span class=w> </span>gitee-kubernetes-node02<span class=w> </span><span class=nv>node_role</span><span class=o>=</span>giteeInternal
<a id=__codelineno-34-5 name=__codelineno-34-5 href=#__codelineno-34-5></a>
<a id=__codelineno-34-6 name=__codelineno-34-6 href=#__codelineno-34-6></a>kubectl<span class=w> </span>label<span class=w> </span>nodes<span class=w> </span>gitee-kubernetes-node03<span class=w> </span><span class=nv>node_role</span><span class=o>=</span>giteePubcomm
<a id=__codelineno-34-7 name=__codelineno-34-7 href=#__codelineno-34-7></a>kubectl<span class=w> </span>label<span class=w> </span>nodes<span class=w> </span>gitee-kubernetes-node04<span class=w> </span><span class=nv>node_role</span><span class=o>=</span>giteePubcomm
<a id=__codelineno-34-8 name=__codelineno-34-8 href=#__codelineno-34-8></a>
<a id=__codelineno-34-9 name=__codelineno-34-9 href=#__codelineno-34-9></a>kubectl<span class=w> </span>label<span class=w> </span>nodes<span class=w> </span>gitee-kubernetes-node05<span class=w> </span><span class=nv>node_role</span><span class=o>=</span>giteeRuby
<a id=__codelineno-34-10 name=__codelineno-34-10 href=#__codelineno-34-10></a>kubectl<span class=w> </span>label<span class=w> </span>nodes<span class=w> </span>gitee-kubernetes-node06<span class=w> </span><span class=nv>node_role</span><span class=o>=</span>giteeRuby
<a id=__codelineno-34-11 name=__codelineno-34-11 href=#__codelineno-34-11></a>kubectl<span class=w> </span>label<span class=w> </span>nodes<span class=w> </span>gitee-kubernetes-node07<span class=w> </span><span class=nv>node_role</span><span class=o>=</span>giteeRuby
<a id=__codelineno-34-12 name=__codelineno-34-12 href=#__codelineno-34-12></a>
<a id=__codelineno-34-13 name=__codelineno-34-13 href=#__codelineno-34-13></a>
<a id=__codelineno-34-14 name=__codelineno-34-14 href=#__codelineno-34-14></a>kubectl<span class=w> </span>label<span class=w> </span>nodes<span class=w> </span>gitee-kubernetes-node09<span class=w> </span><span class=nv>node_role</span><span class=o>=</span>giteeFrontend
<a id=__codelineno-34-15 name=__codelineno-34-15 href=#__codelineno-34-15></a>kubectl<span class=w> </span>label<span class=w> </span>nodes<span class=w> </span>gitee-kubernetes-node10<span class=w> </span><span class=nv>node_role</span><span class=o>=</span>giteeFrontend
<a id=__codelineno-34-16 name=__codelineno-34-16 href=#__codelineno-34-16></a>kubectl<span class=w> </span>label<span class=w> </span>nodes<span class=w> </span>gitee-kubernetes-node11<span class=w> </span><span class=nv>node_role</span><span class=o>=</span>giteeFrontend
<a id=__codelineno-34-17 name=__codelineno-34-17 href=#__codelineno-34-17></a>
<a id=__codelineno-34-18 name=__codelineno-34-18 href=#__codelineno-34-18></a><span class=c1># 监控节点</span>
<a id=__codelineno-34-19 name=__codelineno-34-19 href=#__codelineno-34-19></a>kubectl<span class=w> </span>label<span class=w> </span>nodes<span class=w> </span>gitee-kubernetes-node08<span class=w> </span><span class=nv>node_role</span><span class=o>=</span>giteeMonitor
<a id=__codelineno-34-20 name=__codelineno-34-20 href=#__codelineno-34-20></a>kubectl<span class=w> </span>label<span class=w> </span>nodes<span class=w> </span>gitee-kubernetes-node12<span class=w> </span><span class=nv>node_role</span><span class=o>=</span>giteeMonitor
<a id=__codelineno-34-21 name=__codelineno-34-21 href=#__codelineno-34-21></a>
<a id=__codelineno-34-22 name=__codelineno-34-22 href=#__codelineno-34-22></a>
<a id=__codelineno-34-23 name=__codelineno-34-23 href=#__codelineno-34-23></a>
<a id=__codelineno-34-24 name=__codelineno-34-24 href=#__codelineno-34-24></a><span class=c1># 设置污点</span>
<a id=__codelineno-34-25 name=__codelineno-34-25 href=#__codelineno-34-25></a>kubectl<span class=w> </span>taint<span class=w> </span>nodes<span class=w> </span>gitee-kubernetes-node01<span class=w> </span><span class=nv>GiteeInternalOnly</span><span class=o>=</span>yes:NoSchedule
<a id=__codelineno-34-26 name=__codelineno-34-26 href=#__codelineno-34-26></a>kubectl<span class=w> </span>taint<span class=w> </span>nodes<span class=w> </span>gitee-kubernetes-node02<span class=w> </span><span class=nv>GiteeInternalOnly</span><span class=o>=</span>yes:NoSchedule
<a id=__codelineno-34-27 name=__codelineno-34-27 href=#__codelineno-34-27></a>
<a id=__codelineno-34-28 name=__codelineno-34-28 href=#__codelineno-34-28></a>kubectl<span class=w> </span>taint<span class=w> </span>nodes<span class=w> </span>gitee-kubernetes-node03<span class=w> </span><span class=nv>GiteePubcommOnly</span><span class=o>=</span>yes:NoSchedule
<a id=__codelineno-34-29 name=__codelineno-34-29 href=#__codelineno-34-29></a>kubectl<span class=w> </span>taint<span class=w> </span>nodes<span class=w> </span>gitee-kubernetes-node04<span class=w> </span><span class=nv>GiteePubcommOnly</span><span class=o>=</span>yes:NoSchedule
<a id=__codelineno-34-30 name=__codelineno-34-30 href=#__codelineno-34-30></a>
<a id=__codelineno-34-31 name=__codelineno-34-31 href=#__codelineno-34-31></a>kubectl<span class=w> </span>taint<span class=w> </span>nodes<span class=w> </span>gitee-kubernetes-node05<span class=w> </span><span class=nv>GiteeRubyOnly</span><span class=o>=</span>yes:NoSchedule
<a id=__codelineno-34-32 name=__codelineno-34-32 href=#__codelineno-34-32></a>kubectl<span class=w> </span>taint<span class=w> </span>nodes<span class=w> </span>gitee-kubernetes-node06<span class=w> </span><span class=nv>GiteeRubyOnly</span><span class=o>=</span>yes:NoSchedule
<a id=__codelineno-34-33 name=__codelineno-34-33 href=#__codelineno-34-33></a>kubectl<span class=w> </span>taint<span class=w> </span>nodes<span class=w> </span>gitee-kubernetes-node07<span class=w> </span><span class=nv>GiteeRubyOnly</span><span class=o>=</span>yes:NoSchedule
<a id=__codelineno-34-34 name=__codelineno-34-34 href=#__codelineno-34-34></a>
<a id=__codelineno-34-35 name=__codelineno-34-35 href=#__codelineno-34-35></a>kubectl<span class=w> </span>taint<span class=w> </span>nodes<span class=w> </span>gitee-kubernetes-node09<span class=w> </span><span class=nv>GiteeFrontendOnly</span><span class=o>=</span>yes:NoSchedule
<a id=__codelineno-34-36 name=__codelineno-34-36 href=#__codelineno-34-36></a>kubectl<span class=w> </span>taint<span class=w> </span>nodes<span class=w> </span>gitee-kubernetes-node10<span class=w> </span><span class=nv>GiteeFrontendOnly</span><span class=o>=</span>yes:NoSchedule
<a id=__codelineno-34-37 name=__codelineno-34-37 href=#__codelineno-34-37></a>kubectl<span class=w> </span>taint<span class=w> </span>nodes<span class=w> </span>gitee-kubernetes-node11<span class=w> </span><span class=nv>GiteeFrontendOnly</span><span class=o>=</span>yes:NoSchedule
<a id=__codelineno-34-38 name=__codelineno-34-38 href=#__codelineno-34-38></a>
<a id=__codelineno-34-39 name=__codelineno-34-39 href=#__codelineno-34-39></a><span class=c1># 监控节点无污点</span>
<a id=__codelineno-34-40 name=__codelineno-34-40 href=#__codelineno-34-40></a><span class=c1># kubectl taint nodes gitee-kubernetes-node12 GiteeMonitorOnly=yes:NoSchedule</span>
<a id=__codelineno-34-41 name=__codelineno-34-41 href=#__codelineno-34-41></a>
<a id=__codelineno-34-42 name=__codelineno-34-42 href=#__codelineno-34-42></a>
<a id=__codelineno-34-43 name=__codelineno-34-43 href=#__codelineno-34-43></a><span class=c1># 查看标签</span>
<a id=__codelineno-34-44 name=__codelineno-34-44 href=#__codelineno-34-44></a>kubectl<span class=w> </span>get<span class=w> </span>node<span class=w> </span>--show-labels
<a id=__codelineno-34-45 name=__codelineno-34-45 href=#__codelineno-34-45></a><span class=c1># 查看单个节点标签</span>
<a id=__codelineno-34-46 name=__codelineno-34-46 href=#__codelineno-34-46></a>kubectl<span class=w> </span>get<span class=w> </span>node<span class=w> </span>gitee-kubernetes-node01<span class=w> </span>--show-labels<span class=p>|</span>grep<span class=w> </span>giteeInternal
<a id=__codelineno-34-47 name=__codelineno-34-47 href=#__codelineno-34-47></a>kubectl<span class=w> </span>get<span class=w> </span>node<span class=w> </span>gitee-kubernetes-node02<span class=w> </span>--show-labels<span class=p>|</span>grep<span class=w> </span>giteeInternal
<a id=__codelineno-34-48 name=__codelineno-34-48 href=#__codelineno-34-48></a>kubectl<span class=w> </span>get<span class=w> </span>node<span class=w> </span>gitee-kubernetes-node03<span class=w> </span>--show-labels<span class=p>|</span>grep<span class=w> </span>giteePubcomm
<a id=__codelineno-34-49 name=__codelineno-34-49 href=#__codelineno-34-49></a>kubectl<span class=w> </span>get<span class=w> </span>node<span class=w> </span>gitee-kubernetes-node04<span class=w> </span>--show-labels<span class=p>|</span>grep<span class=w> </span>giteePubcomm
<a id=__codelineno-34-50 name=__codelineno-34-50 href=#__codelineno-34-50></a>....
<a id=__codelineno-34-51 name=__codelineno-34-51 href=#__codelineno-34-51></a>
<a id=__codelineno-34-52 name=__codelineno-34-52 href=#__codelineno-34-52></a>
<a id=__codelineno-34-53 name=__codelineno-34-53 href=#__codelineno-34-53></a><span class=c1># 查看污点</span>
<a id=__codelineno-34-54 name=__codelineno-34-54 href=#__codelineno-34-54></a>kubectl<span class=w> </span>describe<span class=w> </span>nodes<span class=w> </span>gitee-kubernetes-node01<span class=p>|</span>grep<span class=w> </span>-A<span class=w> </span><span class=m>5</span><span class=w> </span>Taints
<a id=__codelineno-34-55 name=__codelineno-34-55 href=#__codelineno-34-55></a>kubectl<span class=w> </span>describe<span class=w> </span>nodes<span class=w> </span>gitee-kubernetes-node02<span class=p>|</span>grep<span class=w> </span>-A<span class=w> </span><span class=m>5</span><span class=w> </span>Taints
<a id=__codelineno-34-56 name=__codelineno-34-56 href=#__codelineno-34-56></a>kubectl<span class=w> </span>describe<span class=w> </span>nodes<span class=w> </span>gitee-kubernetes-node03<span class=p>|</span>grep<span class=w> </span>-A<span class=w> </span><span class=m>5</span><span class=w> </span>Taints
<a id=__codelineno-34-57 name=__codelineno-34-57 href=#__codelineno-34-57></a>kubectl<span class=w> </span>describe<span class=w> </span>nodes<span class=w> </span>gitee-kubernetes-node04<span class=p>|</span>grep<span class=w> </span>-A<span class=w> </span><span class=m>5</span><span class=w> </span>Taints
<a id=__codelineno-34-58 name=__codelineno-34-58 href=#__codelineno-34-58></a>....
</code></pre></div> <p>更多操作，参考如下：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-35-1 name=__codelineno-35-1 href=#__codelineno-35-1></a><span class=c1># Kubernetes 高级调度</span>
<a id=__codelineno-35-2 name=__codelineno-35-2 href=#__codelineno-35-2></a><span class=c1>############# 污点</span>
<a id=__codelineno-35-3 name=__codelineno-35-3 href=#__codelineno-35-3></a><span class=c1># 设置污点</span>
<a id=__codelineno-35-4 name=__codelineno-35-4 href=#__codelineno-35-4></a>kubectl<span class=w> </span>taint<span class=w> </span>node<span class=w> </span><span class=m>172</span>.18.0.66<span class=w> </span><span class=nv>GiteeInternalOnly</span><span class=o>=</span>yes:NoSchedule
<a id=__codelineno-35-5 name=__codelineno-35-5 href=#__codelineno-35-5></a>kubectl<span class=w> </span>taint<span class=w> </span>node<span class=w> </span><span class=m>172</span>.18.0.67<span class=w> </span><span class=nv>GiteeCronOnly</span><span class=o>=</span>yes:NoSchedule
<a id=__codelineno-35-6 name=__codelineno-35-6 href=#__codelineno-35-6></a>
<a id=__codelineno-35-7 name=__codelineno-35-7 href=#__codelineno-35-7></a><span class=c1># 查看污点</span>
<a id=__codelineno-35-8 name=__codelineno-35-8 href=#__codelineno-35-8></a>kubectl<span class=w> </span>describe<span class=w> </span>nodes<span class=w> </span><span class=m>172</span>.18.0.66<span class=p>|</span>grep<span class=w> </span>-A<span class=w> </span><span class=m>5</span><span class=w> </span>Taints
<a id=__codelineno-35-9 name=__codelineno-35-9 href=#__codelineno-35-9></a>
<a id=__codelineno-35-10 name=__codelineno-35-10 href=#__codelineno-35-10></a><span class=c1># 取消污点</span>
<a id=__codelineno-35-11 name=__codelineno-35-11 href=#__codelineno-35-11></a>kubectl<span class=w> </span>taint<span class=w> </span>node<span class=w> </span><span class=m>172</span>.18.0.66<span class=w> </span>GiteeInternalOnly:NoSchedule-
<a id=__codelineno-35-12 name=__codelineno-35-12 href=#__codelineno-35-12></a>kubectl<span class=w> </span>taint<span class=w> </span>node<span class=w> </span><span class=m>172</span>.18.0.70<span class=w> </span>GiteeRubyOnly:NoSchedule-
<a id=__codelineno-35-13 name=__codelineno-35-13 href=#__codelineno-35-13></a>kubectl<span class=w> </span>taint<span class=w> </span>node<span class=w> </span><span class=m>172</span>.18.0.68<span class=w> </span>GiteeFrontendOnly:NoSchedule-
<a id=__codelineno-35-14 name=__codelineno-35-14 href=#__codelineno-35-14></a>kubectl<span class=w> </span>taint<span class=w> </span>node<span class=w> </span><span class=m>172</span>.18.0.69<span class=w> </span>GiteeFrontendOnly:NoSchedule-
<a id=__codelineno-35-15 name=__codelineno-35-15 href=#__codelineno-35-15></a>
<a id=__codelineno-35-16 name=__codelineno-35-16 href=#__codelineno-35-16></a><span class=c1>############ 标签</span>
<a id=__codelineno-35-17 name=__codelineno-35-17 href=#__codelineno-35-17></a><span class=c1># 设置标签</span>
<a id=__codelineno-35-18 name=__codelineno-35-18 href=#__codelineno-35-18></a>kubectl<span class=w> </span>label<span class=w> </span>nodes<span class=w> </span><span class=m>172</span>.18.0.66<span class=w> </span><span class=nv>node_role</span><span class=o>=</span>giteeInternal
<a id=__codelineno-35-19 name=__codelineno-35-19 href=#__codelineno-35-19></a>kubectl<span class=w> </span>label<span class=w> </span>nodes<span class=w> </span><span class=m>172</span>.18.0.67<span class=w> </span><span class=nv>node_role</span><span class=o>=</span>giteeCron
<a id=__codelineno-35-20 name=__codelineno-35-20 href=#__codelineno-35-20></a>kubectl<span class=w> </span>label<span class=w> </span>nodes<span class=w> </span><span class=m>172</span>.18.0.68<span class=w> </span><span class=nv>node_role</span><span class=o>=</span>giteeFrontend
<a id=__codelineno-35-21 name=__codelineno-35-21 href=#__codelineno-35-21></a>kubectl<span class=w> </span>label<span class=w> </span>nodes<span class=w> </span><span class=m>172</span>.18.0.69<span class=w> </span><span class=nv>node_role</span><span class=o>=</span>giteeFrontend
<a id=__codelineno-35-22 name=__codelineno-35-22 href=#__codelineno-35-22></a>kubectl<span class=w> </span>label<span class=w> </span>nodes<span class=w> </span><span class=m>172</span>.18.0.70<span class=w> </span><span class=nv>node_role</span><span class=o>=</span>giteeRuby
<a id=__codelineno-35-23 name=__codelineno-35-23 href=#__codelineno-35-23></a>
<a id=__codelineno-35-24 name=__codelineno-35-24 href=#__codelineno-35-24></a>
<a id=__codelineno-35-25 name=__codelineno-35-25 href=#__codelineno-35-25></a><span class=c1># 查看标签</span>
<a id=__codelineno-35-26 name=__codelineno-35-26 href=#__codelineno-35-26></a>kubectl<span class=w> </span>get<span class=w> </span>node<span class=w> </span>--show-labels
<a id=__codelineno-35-27 name=__codelineno-35-27 href=#__codelineno-35-27></a>kubectl<span class=w> </span>get<span class=w> </span>node<span class=w> </span><span class=m>172</span>.18.0.66<span class=w> </span>--show-labels<span class=p>|</span>grep<span class=w> </span>giteeInternal
<a id=__codelineno-35-28 name=__codelineno-35-28 href=#__codelineno-35-28></a>kubectl<span class=w> </span>get<span class=w> </span>node<span class=w> </span><span class=m>172</span>.18.0.67<span class=w> </span>--show-labels<span class=p>|</span>grep<span class=w> </span>gitee
<a id=__codelineno-35-29 name=__codelineno-35-29 href=#__codelineno-35-29></a>
<a id=__codelineno-35-30 name=__codelineno-35-30 href=#__codelineno-35-30></a><span class=c1># 删除标签</span>
<a id=__codelineno-35-31 name=__codelineno-35-31 href=#__codelineno-35-31></a>kubectl<span class=w> </span>label<span class=w> </span>nodes<span class=w> </span><span class=m>172</span>.18.0.66<span class=w> </span>node_role-
</code></pre></div> <h2 id=7-metrics-部署>7. Metrics 部署<a class=headerlink href=#7-metrics-部署 title="Permanent link">&para;</a></h2> <p>在新版的 Kubernetes 中，系统资源的采集使用 Metrics-server，可以通过 Metrics 采集节点和 Pod 的内存、磁盘、CPU 和网络的使用率。</p> <div class=highlight><pre><span></span><code><a id=__codelineno-36-1 name=__codelineno-36-1 href=#__codelineno-36-1></a>root@ctrl:~#<span class=w> </span>git<span class=w> </span>clone<span class=w> </span>https://github.com/kubernetes-sigs/metrics-server
<a id=__codelineno-36-2 name=__codelineno-36-2 href=#__codelineno-36-2></a>root@ctrl:~#<span class=w> </span>vi<span class=w> </span>./metrics-server/manifests/base/deployment.yaml
<a id=__codelineno-36-3 name=__codelineno-36-3 href=#__codelineno-36-3></a>.....
<a id=__codelineno-36-4 name=__codelineno-36-4 href=#__codelineno-36-4></a>.....
<a id=__codelineno-36-5 name=__codelineno-36-5 href=#__codelineno-36-5></a><span class=w> </span>containers:
<a id=__codelineno-36-6 name=__codelineno-36-6 href=#__codelineno-36-6></a><span class=w>      </span>-<span class=w> </span>name:<span class=w> </span>metrics-server
<a id=__codelineno-36-7 name=__codelineno-36-7 href=#__codelineno-36-7></a><span class=w>        </span>image:<span class=w> </span>gcr.io/k8s-staging-metrics-server/metrics-server:master
<a id=__codelineno-36-8 name=__codelineno-36-8 href=#__codelineno-36-8></a><span class=w>        </span>imagePullPolicy:<span class=w> </span>IfNotPresent
<a id=__codelineno-36-9 name=__codelineno-36-9 href=#__codelineno-36-9></a><span class=w>        </span><span class=c1># line 23 : add</span>
<a id=__codelineno-36-10 name=__codelineno-36-10 href=#__codelineno-36-10></a><span class=w>        </span>command:
<a id=__codelineno-36-11 name=__codelineno-36-11 href=#__codelineno-36-11></a><span class=w>        </span>-<span class=w> </span>/metrics-server
<a id=__codelineno-36-12 name=__codelineno-36-12 href=#__codelineno-36-12></a><span class=w>        </span>-<span class=w> </span>--kubelet-insecure-tls
<a id=__codelineno-36-13 name=__codelineno-36-13 href=#__codelineno-36-13></a><span class=w>        </span>-<span class=w> </span>--kubelet-preferred-address-types<span class=o>=</span>InternalIP
<a id=__codelineno-36-14 name=__codelineno-36-14 href=#__codelineno-36-14></a><span class=w>        </span>args:
<a id=__codelineno-36-15 name=__codelineno-36-15 href=#__codelineno-36-15></a><span class=w>          </span>-<span class=w> </span>--cert-dir<span class=o>=</span>/tmp
<a id=__codelineno-36-16 name=__codelineno-36-16 href=#__codelineno-36-16></a><span class=w>          </span>-<span class=w> </span>--secure-port<span class=o>=</span><span class=m>10250</span>
<a id=__codelineno-36-17 name=__codelineno-36-17 href=#__codelineno-36-17></a><span class=w>          </span>-<span class=w> </span>--kubelet-preferred-address-types<span class=o>=</span>InternalIP,ExternalIP,Hostname
<a id=__codelineno-36-18 name=__codelineno-36-18 href=#__codelineno-36-18></a><span class=w>          </span>-<span class=w> </span>--kubelet-use-node-status-port
<a id=__codelineno-36-19 name=__codelineno-36-19 href=#__codelineno-36-19></a><span class=w>          </span>-<span class=w> </span>--metric-resolution<span class=o>=</span>15s
<a id=__codelineno-36-20 name=__codelineno-36-20 href=#__codelineno-36-20></a><span class=w>      </span>nodeSelector:
<a id=__codelineno-36-21 name=__codelineno-36-21 href=#__codelineno-36-21></a><span class=w>        </span>kubernetes.io/os:<span class=w> </span>linux
<a id=__codelineno-36-22 name=__codelineno-36-22 href=#__codelineno-36-22></a><span class=w>        </span>node_role:<span class=w> </span>giteePubcomm
<a id=__codelineno-36-23 name=__codelineno-36-23 href=#__codelineno-36-23></a><span class=w>      </span>tolerations:
<a id=__codelineno-36-24 name=__codelineno-36-24 href=#__codelineno-36-24></a><span class=w>      </span>-<span class=w> </span>key:<span class=w> </span><span class=s2>&quot;GiteePubcommOnly&quot;</span>
<a id=__codelineno-36-25 name=__codelineno-36-25 href=#__codelineno-36-25></a><span class=w>        </span>operator:<span class=w> </span><span class=s2>&quot;Equal&quot;</span>
<a id=__codelineno-36-26 name=__codelineno-36-26 href=#__codelineno-36-26></a><span class=w>        </span>value:<span class=w> </span><span class=s2>&quot;yes&quot;</span>
<a id=__codelineno-36-27 name=__codelineno-36-27 href=#__codelineno-36-27></a><span class=w>        </span>effect:<span class=w> </span><span class=s2>&quot;NoSchedule&quot;</span>
<a id=__codelineno-36-28 name=__codelineno-36-28 href=#__codelineno-36-28></a>.....
<a id=__codelineno-36-29 name=__codelineno-36-29 href=#__codelineno-36-29></a>.....
<a id=__codelineno-36-30 name=__codelineno-36-30 href=#__codelineno-36-30></a>
<a id=__codelineno-36-31 name=__codelineno-36-31 href=#__codelineno-36-31></a>
<a id=__codelineno-36-32 name=__codelineno-36-32 href=#__codelineno-36-32></a>root@ctrl:~#<span class=w> </span>kubectl<span class=w> </span>apply<span class=w> </span>-k<span class=w> </span>./metrics-server/manifests/base/
<a id=__codelineno-36-33 name=__codelineno-36-33 href=#__codelineno-36-33></a>serviceaccount/metrics-server<span class=w> </span>created
<a id=__codelineno-36-34 name=__codelineno-36-34 href=#__codelineno-36-34></a>clusterrole.rbac.authorization.k8s.io/system:aggregated-metrics-reader<span class=w> </span>created
<a id=__codelineno-36-35 name=__codelineno-36-35 href=#__codelineno-36-35></a>clusterrole.rbac.authorization.k8s.io/system:metrics-server<span class=w> </span>created
<a id=__codelineno-36-36 name=__codelineno-36-36 href=#__codelineno-36-36></a>rolebinding.rbac.authorization.k8s.io/metrics-server-auth-reader<span class=w> </span>created
<a id=__codelineno-36-37 name=__codelineno-36-37 href=#__codelineno-36-37></a>clusterrolebinding.rbac.authorization.k8s.io/metrics-server:system:auth-delegator<span class=w> </span>created
<a id=__codelineno-36-38 name=__codelineno-36-38 href=#__codelineno-36-38></a>clusterrolebinding.rbac.authorization.k8s.io/system:metrics-server<span class=w> </span>created
<a id=__codelineno-36-39 name=__codelineno-36-39 href=#__codelineno-36-39></a>service/metrics-server<span class=w> </span>created
<a id=__codelineno-36-40 name=__codelineno-36-40 href=#__codelineno-36-40></a>deployment.apps/metrics-server<span class=w> </span>created
<a id=__codelineno-36-41 name=__codelineno-36-41 href=#__codelineno-36-41></a>apiservice.apiregistration.k8s.io/v1beta1.metrics.k8s.io<span class=w> </span>created
<a id=__codelineno-36-42 name=__codelineno-36-42 href=#__codelineno-36-42></a>
<a id=__codelineno-36-43 name=__codelineno-36-43 href=#__codelineno-36-43></a>root@ctrl:~#<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>pods<span class=w> </span>-n<span class=w> </span>kube-system
<a id=__codelineno-36-44 name=__codelineno-36-44 href=#__codelineno-36-44></a>NAME<span class=w>                                       </span>READY<span class=w>   </span>STATUS<span class=w>    </span>RESTARTS<span class=w>        </span>AGE
<a id=__codelineno-36-45 name=__codelineno-36-45 href=#__codelineno-36-45></a>calico-kube-controllers-59697b644f-fgfqp<span class=w>   </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>1</span><span class=w> </span><span class=o>(</span>6m30s<span class=w> </span>ago<span class=o>)</span><span class=w>   </span>23h
<a id=__codelineno-36-46 name=__codelineno-36-46 href=#__codelineno-36-46></a>calico-node-8hjm5<span class=w>                          </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>1</span><span class=w> </span><span class=o>(</span>6m15s<span class=w> </span>ago<span class=o>)</span><span class=w>   </span>23h
<a id=__codelineno-36-47 name=__codelineno-36-47 href=#__codelineno-36-47></a>calico-node-ck5zq<span class=w>                          </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>1</span><span class=w> </span><span class=o>(</span>6m11s<span class=w> </span>ago<span class=o>)</span><span class=w>   </span>23h
<a id=__codelineno-36-48 name=__codelineno-36-48 href=#__codelineno-36-48></a>calico-node-z8vgs<span class=w>                          </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>1</span><span class=w> </span><span class=o>(</span>6m30s<span class=w> </span>ago<span class=o>)</span><span class=w>   </span>23h
<a id=__codelineno-36-49 name=__codelineno-36-49 href=#__codelineno-36-49></a>coredns-565d847f94-v8v2x<span class=w>                   </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>1</span><span class=w> </span><span class=o>(</span>6m30s<span class=w> </span>ago<span class=o>)</span><span class=w>   </span>24h
<a id=__codelineno-36-50 name=__codelineno-36-50 href=#__codelineno-36-50></a>coredns-565d847f94-zh4rd<span class=w>                   </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>1</span><span class=w> </span><span class=o>(</span>6m30s<span class=w> </span>ago<span class=o>)</span><span class=w>   </span>24h
<a id=__codelineno-36-51 name=__codelineno-36-51 href=#__codelineno-36-51></a>etcd-ctrl.srv.world<span class=w>                        </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>1</span><span class=w> </span><span class=o>(</span>6m30s<span class=w> </span>ago<span class=o>)</span><span class=w>   </span>24h
<a id=__codelineno-36-52 name=__codelineno-36-52 href=#__codelineno-36-52></a>kube-apiserver-ctrl.srv.world<span class=w>              </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>1</span><span class=w> </span><span class=o>(</span>6m30s<span class=w> </span>ago<span class=o>)</span><span class=w>   </span>24h
<a id=__codelineno-36-53 name=__codelineno-36-53 href=#__codelineno-36-53></a>kube-controller-manager-ctrl.srv.world<span class=w>     </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>1</span><span class=w> </span><span class=o>(</span>6m30s<span class=w> </span>ago<span class=o>)</span><span class=w>   </span>24h
<a id=__codelineno-36-54 name=__codelineno-36-54 href=#__codelineno-36-54></a>kube-proxy-9hmsh<span class=w>                           </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>1</span><span class=w> </span><span class=o>(</span>6m15s<span class=w> </span>ago<span class=o>)</span><span class=w>   </span>23h
<a id=__codelineno-36-55 name=__codelineno-36-55 href=#__codelineno-36-55></a>kube-proxy-lnvhj<span class=w>                           </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>1</span><span class=w> </span><span class=o>(</span>6m30s<span class=w> </span>ago<span class=o>)</span><span class=w>   </span>24h
<a id=__codelineno-36-56 name=__codelineno-36-56 href=#__codelineno-36-56></a>kube-proxy-zftff<span class=w>                           </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>1</span><span class=w> </span><span class=o>(</span>6m11s<span class=w> </span>ago<span class=o>)</span><span class=w>   </span>23h
<a id=__codelineno-36-57 name=__codelineno-36-57 href=#__codelineno-36-57></a>kube-scheduler-ctrl.srv.world<span class=w>              </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>1</span><span class=w> </span><span class=o>(</span>6m30s<span class=w> </span>ago<span class=o>)</span><span class=w>   </span>24h
<a id=__codelineno-36-58 name=__codelineno-36-58 href=#__codelineno-36-58></a>metrics-server-6776c5c959-5plm8<span class=w>            </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>               </span>88s
<a id=__codelineno-36-59 name=__codelineno-36-59 href=#__codelineno-36-59></a><span class=c1># [metrics-server] pod has been deployed</span>
</code></pre></div> <p>验证</p> <div class=highlight><pre><span></span><code><a id=__codelineno-37-1 name=__codelineno-37-1 href=#__codelineno-37-1></a>root@ctrl:~#<span class=w> </span>k<span class=w> </span>top<span class=w> </span>node
<a id=__codelineno-37-2 name=__codelineno-37-2 href=#__codelineno-37-2></a>NAME<span class=w>                       </span>CPU<span class=o>(</span>cores<span class=o>)</span><span class=w>   </span>CPU%<span class=w>   </span>MEMORY<span class=o>(</span>bytes<span class=o>)</span><span class=w>   </span>MEMORY%
<a id=__codelineno-37-3 name=__codelineno-37-3 href=#__codelineno-37-3></a>gitee-kubernetes-master1<span class=w>   </span>359m<span class=w>         </span><span class=m>4</span>%<span class=w>     </span>1895Mi<span class=w>          </span><span class=m>5</span>%
<a id=__codelineno-37-4 name=__codelineno-37-4 href=#__codelineno-37-4></a>gitee-kubernetes-master2<span class=w>   </span>319m<span class=w>         </span><span class=m>3</span>%<span class=w>     </span>1620Mi<span class=w>          </span><span class=m>5</span>%
<a id=__codelineno-37-5 name=__codelineno-37-5 href=#__codelineno-37-5></a>gitee-kubernetes-master3<span class=w>   </span>287m<span class=w>         </span><span class=m>3</span>%<span class=w>     </span>1491Mi<span class=w>          </span><span class=m>4</span>%
<a id=__codelineno-37-6 name=__codelineno-37-6 href=#__codelineno-37-6></a>gitee-kubernetes-node01<span class=w>    </span>137m<span class=w>         </span><span class=m>0</span>%<span class=w>     </span>900Mi<span class=w>           </span><span class=m>1</span>%
<a id=__codelineno-37-7 name=__codelineno-37-7 href=#__codelineno-37-7></a>gitee-kubernetes-node02<span class=w>    </span>117m<span class=w>         </span><span class=m>0</span>%<span class=w>     </span>939Mi<span class=w>           </span><span class=m>1</span>%
<a id=__codelineno-37-8 name=__codelineno-37-8 href=#__codelineno-37-8></a>gitee-kubernetes-node03<span class=w>    </span>126m<span class=w>         </span><span class=m>0</span>%<span class=w>     </span>959Mi<span class=w>           </span><span class=m>1</span>%
<a id=__codelineno-37-9 name=__codelineno-37-9 href=#__codelineno-37-9></a>gitee-kubernetes-node04<span class=w>    </span>150m<span class=w>         </span><span class=m>0</span>%<span class=w>     </span>1001Mi<span class=w>          </span><span class=m>1</span>%
<a id=__codelineno-37-10 name=__codelineno-37-10 href=#__codelineno-37-10></a>.....
<a id=__codelineno-37-11 name=__codelineno-37-11 href=#__codelineno-37-11></a>
<a id=__codelineno-37-12 name=__codelineno-37-12 href=#__codelineno-37-12></a>root@ctrl:~#<span class=w> </span>k<span class=w> </span>top<span class=w> </span>pod
<a id=__codelineno-37-13 name=__codelineno-37-13 href=#__codelineno-37-13></a>NAME<span class=w>                                               </span>CPU<span class=o>(</span>cores<span class=o>)</span><span class=w>   </span>MEMORY<span class=o>(</span>bytes<span class=o>)</span>
<a id=__codelineno-37-14 name=__codelineno-37-14 href=#__codelineno-37-14></a>calico-kube-controllers-949d58b75-dq9f4<span class=w>            </span>4m<span class=w>           </span>20Mi
<a id=__codelineno-37-15 name=__codelineno-37-15 href=#__codelineno-37-15></a>calico-node-2t646<span class=w>                                  </span>71m<span class=w>          </span>95Mi
<a id=__codelineno-37-16 name=__codelineno-37-16 href=#__codelineno-37-16></a>calico-node-4wxzt<span class=w>                                  </span>44m<span class=w>          </span>84Mi
<a id=__codelineno-37-17 name=__codelineno-37-17 href=#__codelineno-37-17></a>calico-node-5fx6g<span class=w>                                  </span>53m<span class=w>          </span>93Mi
<a id=__codelineno-37-18 name=__codelineno-37-18 href=#__codelineno-37-18></a>calico-node-74jjs<span class=w>                                  </span>64m<span class=w>          </span>85Mi
<a id=__codelineno-37-19 name=__codelineno-37-19 href=#__codelineno-37-19></a>calico-node-bfvpk<span class=w>                                  </span>43m<span class=w>          </span>95Mi
<a id=__codelineno-37-20 name=__codelineno-37-20 href=#__codelineno-37-20></a>calico-node-bv6zm<span class=w>                                  </span>45m<span class=w>          </span>94Mi
<a id=__codelineno-37-21 name=__codelineno-37-21 href=#__codelineno-37-21></a>.....
</code></pre></div> <h2 id=8-dashboard-部署>8. Dashboard 部署<a class=headerlink href=#8-dashboard-部署 title="Permanent link">&para;</a></h2> <p>helm 部署</p> <p>Chart 仓库地址：<a href=https://artifacthub.io/packages/helm/k8s-dashboard/kubernetes-dashboard>https://artifacthub.io/packages/helm/k8s-dashboard/kubernetes-dashboard</a></p> <div class=highlight><pre><span></span><code><a id=__codelineno-38-1 name=__codelineno-38-1 href=#__codelineno-38-1></a>$<span class=w> </span>helm<span class=w> </span>repo<span class=w> </span>add<span class=w> </span>kubernetes-dashboard<span class=w> </span>https://kubernetes.github.io/dashboard/
<a id=__codelineno-38-2 name=__codelineno-38-2 href=#__codelineno-38-2></a>$<span class=w> </span>helm<span class=w> </span>repo<span class=w> </span>update
<a id=__codelineno-38-3 name=__codelineno-38-3 href=#__codelineno-38-3></a>
<a id=__codelineno-38-4 name=__codelineno-38-4 href=#__codelineno-38-4></a><span class=c1># 下载到本地安装</span>
<a id=__codelineno-38-5 name=__codelineno-38-5 href=#__codelineno-38-5></a>$<span class=w> </span>helm<span class=w> </span>search<span class=w> </span>repo<span class=w> </span>kubernetes-dashboard/kubernetes-dashboard
<a id=__codelineno-38-6 name=__codelineno-38-6 href=#__codelineno-38-6></a>NAME<span class=w>                                            </span>CHART<span class=w> </span>VERSION<span class=w>   </span>APP<span class=w> </span>VERSION<span class=w>     </span>DESCRIPTION
<a id=__codelineno-38-7 name=__codelineno-38-7 href=#__codelineno-38-7></a>kubernetes-dashboard/kubernetes-dashboard<span class=w>       </span><span class=m>6</span>.0.0<span class=w>           </span><span class=m>2</span>.7.0<span class=w>           </span>General-purpose<span class=w> </span>web<span class=w> </span>UI<span class=w> </span><span class=k>for</span><span class=w> </span>Kubernetes<span class=w> </span>clusters
<a id=__codelineno-38-8 name=__codelineno-38-8 href=#__codelineno-38-8></a>
<a id=__codelineno-38-9 name=__codelineno-38-9 href=#__codelineno-38-9></a>$<span class=w> </span>helm<span class=w> </span>pull<span class=w> </span>kubernetes-dashboard/kubernetes-dashboard<span class=w> </span>--version<span class=w> </span><span class=m>6</span>.0.0<span class=w> </span>--untar
<a id=__codelineno-38-10 name=__codelineno-38-10 href=#__codelineno-38-10></a>
<a id=__codelineno-38-11 name=__codelineno-38-11 href=#__codelineno-38-11></a>$<span class=w> </span>cat<span class=w> </span>&gt;<span class=w> </span>values-pro.yaml<span class=s>&lt;&lt;EOF</span>
<a id=__codelineno-38-12 name=__codelineno-38-12 href=#__codelineno-38-12></a><span class=s>extraArgs:</span>
<a id=__codelineno-38-13 name=__codelineno-38-13 href=#__codelineno-38-13></a><span class=s>  - --token-ttl=0</span>
<a id=__codelineno-38-14 name=__codelineno-38-14 href=#__codelineno-38-14></a><span class=s>  - --system-banner=&quot;Welcome to Kubernetes Cluster. 俄罗斯生产环境 操作需谨慎！！！&quot;</span>
<a id=__codelineno-38-15 name=__codelineno-38-15 href=#__codelineno-38-15></a><span class=s>service:</span>
<a id=__codelineno-38-16 name=__codelineno-38-16 href=#__codelineno-38-16></a><span class=s>  type: NodePort</span>
<a id=__codelineno-38-17 name=__codelineno-38-17 href=#__codelineno-38-17></a><span class=s>  nodePort: 30443</span>
<a id=__codelineno-38-18 name=__codelineno-38-18 href=#__codelineno-38-18></a><span class=s># 节点Selector</span>
<a id=__codelineno-38-19 name=__codelineno-38-19 href=#__codelineno-38-19></a><span class=s>nodeSelector:</span>
<a id=__codelineno-38-20 name=__codelineno-38-20 href=#__codelineno-38-20></a><span class=s>  node_role: giteePubcomm</span>
<a id=__codelineno-38-21 name=__codelineno-38-21 href=#__codelineno-38-21></a><span class=s># 容忍污点</span>
<a id=__codelineno-38-22 name=__codelineno-38-22 href=#__codelineno-38-22></a><span class=s>tolerations:</span>
<a id=__codelineno-38-23 name=__codelineno-38-23 href=#__codelineno-38-23></a><span class=s>- key: &quot;GiteePubcommOnly&quot;</span>
<a id=__codelineno-38-24 name=__codelineno-38-24 href=#__codelineno-38-24></a><span class=s>  operator: &quot;Equal&quot;</span>
<a id=__codelineno-38-25 name=__codelineno-38-25 href=#__codelineno-38-25></a><span class=s>  value: &quot;yes&quot;</span>
<a id=__codelineno-38-26 name=__codelineno-38-26 href=#__codelineno-38-26></a><span class=s>  effect: &quot;NoSchedule&quot;</span>
<a id=__codelineno-38-27 name=__codelineno-38-27 href=#__codelineno-38-27></a>
<a id=__codelineno-38-28 name=__codelineno-38-28 href=#__codelineno-38-28></a><span class=s>rbac:</span>
<a id=__codelineno-38-29 name=__codelineno-38-29 href=#__codelineno-38-29></a><span class=s>  clusterReadOnlyRole: true</span>
<a id=__codelineno-38-30 name=__codelineno-38-30 href=#__codelineno-38-30></a><span class=s>metricsScraper:</span>
<a id=__codelineno-38-31 name=__codelineno-38-31 href=#__codelineno-38-31></a><span class=s>  enabled: true</span>
<a id=__codelineno-38-32 name=__codelineno-38-32 href=#__codelineno-38-32></a><span class=s>EOF</span>
<a id=__codelineno-38-33 name=__codelineno-38-33 href=#__codelineno-38-33></a>
<a id=__codelineno-38-34 name=__codelineno-38-34 href=#__codelineno-38-34></a>
<a id=__codelineno-38-35 name=__codelineno-38-35 href=#__codelineno-38-35></a>
<a id=__codelineno-38-36 name=__codelineno-38-36 href=#__codelineno-38-36></a><span class=c1># deploy</span>
<a id=__codelineno-38-37 name=__codelineno-38-37 href=#__codelineno-38-37></a>$<span class=w> </span>helm<span class=w> </span>install<span class=w> </span>kubernetes-dashboard<span class=w> </span>kubernetes-dashboard<span class=w> </span>-f<span class=w> </span>values-pro.yaml<span class=w> </span>--namespace<span class=w> </span>kubernetes-dashboard<span class=w> </span>--create-namespace
<a id=__codelineno-38-38 name=__codelineno-38-38 href=#__codelineno-38-38></a>
<a id=__codelineno-38-39 name=__codelineno-38-39 href=#__codelineno-38-39></a>NAME:<span class=w> </span>kubernetes-dashboard
<a id=__codelineno-38-40 name=__codelineno-38-40 href=#__codelineno-38-40></a>LAST<span class=w> </span>DEPLOYED:<span class=w> </span>Thu<span class=w> </span>Feb<span class=w>  </span><span class=m>9</span><span class=w> </span><span class=m>10</span>:52:32<span class=w> </span><span class=m>2023</span>
<a id=__codelineno-38-41 name=__codelineno-38-41 href=#__codelineno-38-41></a>NAMESPACE:<span class=w> </span>kubernetes-dashboard
<a id=__codelineno-38-42 name=__codelineno-38-42 href=#__codelineno-38-42></a>STATUS:<span class=w> </span>deployed
<a id=__codelineno-38-43 name=__codelineno-38-43 href=#__codelineno-38-43></a>REVISION:<span class=w> </span><span class=m>1</span>
<a id=__codelineno-38-44 name=__codelineno-38-44 href=#__codelineno-38-44></a>TEST<span class=w> </span>SUITE:<span class=w> </span>None
<a id=__codelineno-38-45 name=__codelineno-38-45 href=#__codelineno-38-45></a>NOTES:
<a id=__codelineno-38-46 name=__codelineno-38-46 href=#__codelineno-38-46></a>*********************************************************************************
<a id=__codelineno-38-47 name=__codelineno-38-47 href=#__codelineno-38-47></a>***<span class=w> </span>PLEASE<span class=w> </span>BE<span class=w> </span>PATIENT:<span class=w> </span>kubernetes-dashboard<span class=w> </span>may<span class=w> </span>take<span class=w> </span>a<span class=w> </span>few<span class=w> </span>minutes<span class=w> </span>to<span class=w> </span>install<span class=w> </span>***
<a id=__codelineno-38-48 name=__codelineno-38-48 href=#__codelineno-38-48></a>*********************************************************************************
<a id=__codelineno-38-49 name=__codelineno-38-49 href=#__codelineno-38-49></a>
<a id=__codelineno-38-50 name=__codelineno-38-50 href=#__codelineno-38-50></a>Get<span class=w> </span>the<span class=w> </span>Kubernetes<span class=w> </span>Dashboard<span class=w> </span>URL<span class=w> </span>by<span class=w> </span>running:
<a id=__codelineno-38-51 name=__codelineno-38-51 href=#__codelineno-38-51></a><span class=w>  </span><span class=nb>export</span><span class=w> </span><span class=nv>NODE_PORT</span><span class=o>=</span><span class=k>$(</span>kubectl<span class=w> </span>get<span class=w> </span>-n<span class=w> </span>kubernetes-dashboard<span class=w> </span>-o<span class=w> </span><span class=nv>jsonpath</span><span class=o>=</span><span class=s2>&quot;{.spec.ports[0].nodePort}&quot;</span><span class=w> </span>services<span class=w> </span>kubernetes-dashboard<span class=k>)</span>
<a id=__codelineno-38-52 name=__codelineno-38-52 href=#__codelineno-38-52></a><span class=w>  </span><span class=nb>export</span><span class=w> </span><span class=nv>NODE_IP</span><span class=o>=</span><span class=k>$(</span>kubectl<span class=w> </span>get<span class=w> </span>nodes<span class=w> </span>-o<span class=w> </span><span class=nv>jsonpath</span><span class=o>=</span><span class=s2>&quot;{.items[0].status.addresses[0].address}&quot;</span><span class=k>)</span>
<a id=__codelineno-38-53 name=__codelineno-38-53 href=#__codelineno-38-53></a><span class=w>  </span><span class=nb>echo</span><span class=w> </span>https://<span class=nv>$NODE_IP</span>:<span class=nv>$NODE_PORT</span>/
</code></pre></div> <p>检查 kubernetes-dashboard 部署状态</p> <div class=highlight><pre><span></span><code><a id=__codelineno-39-1 name=__codelineno-39-1 href=#__codelineno-39-1></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>pods,svc<span class=w> </span>-n<span class=w> </span>kubernetes-dashboard<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>kubernetes-dashboard
<a id=__codelineno-39-2 name=__codelineno-39-2 href=#__codelineno-39-2></a>pod/kubernetes-dashboard-5486c8f5bf-xff6r<span class=w>   </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>45s
<a id=__codelineno-39-3 name=__codelineno-39-3 href=#__codelineno-39-3></a>service/kubernetes-dashboard<span class=w>   </span>NodePort<span class=w>   </span><span class=m>192</span>.168.48.88<span class=w>   </span>&lt;none&gt;<span class=w>        </span><span class=m>443</span>:30443/TCP<span class=w>   </span>45s
</code></pre></div> <p>设置登录的 token 信息</p> <div class=highlight><pre><span></span><code><a id=__codelineno-40-1 name=__codelineno-40-1 href=#__codelineno-40-1></a>$<span class=w> </span>cat<span class=w> </span>&gt;admin.yaml<span class=s>&lt;&lt;EOF</span>
<a id=__codelineno-40-2 name=__codelineno-40-2 href=#__codelineno-40-2></a><span class=s>apiVersion: v1</span>
<a id=__codelineno-40-3 name=__codelineno-40-3 href=#__codelineno-40-3></a><span class=s>kind: ServiceAccount</span>
<a id=__codelineno-40-4 name=__codelineno-40-4 href=#__codelineno-40-4></a><span class=s>metadata:</span>
<a id=__codelineno-40-5 name=__codelineno-40-5 href=#__codelineno-40-5></a><span class=s>  name: admin-user</span>
<a id=__codelineno-40-6 name=__codelineno-40-6 href=#__codelineno-40-6></a><span class=s>  namespace: kubernetes-dashboard</span>
<a id=__codelineno-40-7 name=__codelineno-40-7 href=#__codelineno-40-7></a>
<a id=__codelineno-40-8 name=__codelineno-40-8 href=#__codelineno-40-8></a><span class=s>---</span>
<a id=__codelineno-40-9 name=__codelineno-40-9 href=#__codelineno-40-9></a><span class=s>apiVersion: rbac.authorization.k8s.io/v1</span>
<a id=__codelineno-40-10 name=__codelineno-40-10 href=#__codelineno-40-10></a><span class=s>kind: ClusterRoleBinding</span>
<a id=__codelineno-40-11 name=__codelineno-40-11 href=#__codelineno-40-11></a><span class=s>metadata:</span>
<a id=__codelineno-40-12 name=__codelineno-40-12 href=#__codelineno-40-12></a><span class=s>  name: admin-user</span>
<a id=__codelineno-40-13 name=__codelineno-40-13 href=#__codelineno-40-13></a><span class=s>roleRef:</span>
<a id=__codelineno-40-14 name=__codelineno-40-14 href=#__codelineno-40-14></a><span class=s>  apiGroup: rbac.authorization.k8s.io</span>
<a id=__codelineno-40-15 name=__codelineno-40-15 href=#__codelineno-40-15></a><span class=s>  kind: ClusterRole</span>
<a id=__codelineno-40-16 name=__codelineno-40-16 href=#__codelineno-40-16></a><span class=s>  name: cluster-admin</span>
<a id=__codelineno-40-17 name=__codelineno-40-17 href=#__codelineno-40-17></a><span class=s>subjects:</span>
<a id=__codelineno-40-18 name=__codelineno-40-18 href=#__codelineno-40-18></a><span class=s>- kind: ServiceAccount</span>
<a id=__codelineno-40-19 name=__codelineno-40-19 href=#__codelineno-40-19></a><span class=s>  name: admin-user</span>
<a id=__codelineno-40-20 name=__codelineno-40-20 href=#__codelineno-40-20></a><span class=s>  namespace: kubernetes-dashboard</span>
<a id=__codelineno-40-21 name=__codelineno-40-21 href=#__codelineno-40-21></a>
<a id=__codelineno-40-22 name=__codelineno-40-22 href=#__codelineno-40-22></a><span class=s>---</span>
<a id=__codelineno-40-23 name=__codelineno-40-23 href=#__codelineno-40-23></a><span class=s>apiVersion: v1</span>
<a id=__codelineno-40-24 name=__codelineno-40-24 href=#__codelineno-40-24></a><span class=s>kind: Secret</span>
<a id=__codelineno-40-25 name=__codelineno-40-25 href=#__codelineno-40-25></a><span class=s>type: kubernetes.io/service-account-token</span>
<a id=__codelineno-40-26 name=__codelineno-40-26 href=#__codelineno-40-26></a><span class=s>metadata:</span>
<a id=__codelineno-40-27 name=__codelineno-40-27 href=#__codelineno-40-27></a><span class=s>  name: admin-user</span>
<a id=__codelineno-40-28 name=__codelineno-40-28 href=#__codelineno-40-28></a><span class=s>  annotations:</span>
<a id=__codelineno-40-29 name=__codelineno-40-29 href=#__codelineno-40-29></a><span class=s>    kubernetes.io/service-account.name: &quot;admin-user&quot;</span>
<a id=__codelineno-40-30 name=__codelineno-40-30 href=#__codelineno-40-30></a><span class=s>EOF</span>
<a id=__codelineno-40-31 name=__codelineno-40-31 href=#__codelineno-40-31></a>
<a id=__codelineno-40-32 name=__codelineno-40-32 href=#__codelineno-40-32></a>
<a id=__codelineno-40-33 name=__codelineno-40-33 href=#__codelineno-40-33></a>
<a id=__codelineno-40-34 name=__codelineno-40-34 href=#__codelineno-40-34></a>直接创建：
<a id=__codelineno-40-35 name=__codelineno-40-35 href=#__codelineno-40-35></a>
<a id=__codelineno-40-36 name=__codelineno-40-36 href=#__codelineno-40-36></a>➜<span class=w>  </span>~<span class=w> </span>kubectl<span class=w> </span>apply<span class=w> </span>-f<span class=w> </span>admin.yaml
<a id=__codelineno-40-37 name=__codelineno-40-37 href=#__codelineno-40-37></a>➜<span class=w>  </span>~<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>secret<span class=w> </span>-n<span class=w> </span>kubernetes-dashboard<span class=p>|</span>grep<span class=w> </span>admin-token
<a id=__codelineno-40-38 name=__codelineno-40-38 href=#__codelineno-40-38></a>admin-token-lwmmx<span class=w>                  </span>kubernetes.io/service-account-token<span class=w>   </span><span class=m>3</span><span class=w>         </span>1d
<a id=__codelineno-40-39 name=__codelineno-40-39 href=#__codelineno-40-39></a>➜<span class=w>  </span>~<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>secret<span class=w> </span>admin-token-lwmmx<span class=w> </span>-o<span class=w> </span><span class=nv>jsonpath</span><span class=o>={</span>.data.token<span class=o>}</span><span class=w> </span>-n<span class=w> </span>kubernetes-dashboard<span class=w> </span><span class=p>|</span>base64<span class=w> </span>-d
<a id=__codelineno-40-40 name=__codelineno-40-40 href=#__codelineno-40-40></a><span class=c1># 会生成一串很长的base64后的字符串</span>
<a id=__codelineno-40-41 name=__codelineno-40-41 href=#__codelineno-40-41></a>
<a id=__codelineno-40-42 name=__codelineno-40-42 href=#__codelineno-40-42></a>
<a id=__codelineno-40-43 name=__codelineno-40-43 href=#__codelineno-40-43></a><span class=c1># 或者使用如下脚本</span>
<a id=__codelineno-40-44 name=__codelineno-40-44 href=#__codelineno-40-44></a>➜<span class=w>  </span>~cat<span class=w> </span>login-token.sh
<a id=__codelineno-40-45 name=__codelineno-40-45 href=#__codelineno-40-45></a>
<a id=__codelineno-40-46 name=__codelineno-40-46 href=#__codelineno-40-46></a><span class=c1>#!/bin/bash</span>
<a id=__codelineno-40-47 name=__codelineno-40-47 href=#__codelineno-40-47></a>
<a id=__codelineno-40-48 name=__codelineno-40-48 href=#__codelineno-40-48></a>kubectl<span class=w> </span>-n<span class=w> </span>kubernetes-dashboard<span class=w> </span>describe<span class=w> </span>secret<span class=w> </span><span class=k>$(</span>kubectl<span class=w> </span>-n<span class=w> </span>kubernetes-dashboard<span class=w> </span>get<span class=w> </span>secret<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>admin-user<span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span><span class=s1>&#39;{print $1}&#39;</span><span class=k>)</span>
<a id=__codelineno-40-49 name=__codelineno-40-49 href=#__codelineno-40-49></a>
<a id=__codelineno-40-50 name=__codelineno-40-50 href=#__codelineno-40-50></a><span class=c1># 获取token值进行登录</span>
</code></pre></div> <p>访问 <a href=https://node01IP:30443/就能看到登录界面>https://node01IP:30443/就能看到登录界面</a>。</p> <p>可以使用 nginx 进行反向代理，nginx 配置如下</p> <p><code>kubernetes-dashboard.conf</code></p> <div class=highlight><pre><span></span><code><a id=__codelineno-41-1 name=__codelineno-41-1 href=#__codelineno-41-1></a>upstream kubernetes-dashboard {
<a id=__codelineno-41-2 name=__codelineno-41-2 href=#__codelineno-41-2></a>    server 10.4.145.107:30443;
<a id=__codelineno-41-3 name=__codelineno-41-3 href=#__codelineno-41-3></a>    server 10.4.145.32:30443;
<a id=__codelineno-41-4 name=__codelineno-41-4 href=#__codelineno-41-4></a>    server 10.4.145.79:30443;
<a id=__codelineno-41-5 name=__codelineno-41-5 href=#__codelineno-41-5></a>    keepalive 32;
<a id=__codelineno-41-6 name=__codelineno-41-6 href=#__codelineno-41-6></a>}
<a id=__codelineno-41-7 name=__codelineno-41-7 href=#__codelineno-41-7></a>
<a id=__codelineno-41-8 name=__codelineno-41-8 href=#__codelineno-41-8></a>server {
<a id=__codelineno-41-9 name=__codelineno-41-9 href=#__codelineno-41-9></a>    listen 80;
<a id=__codelineno-41-10 name=__codelineno-41-10 href=#__codelineno-41-10></a>    server_name kubernetes-dashboard.autom.studio;
<a id=__codelineno-41-11 name=__codelineno-41-11 href=#__codelineno-41-11></a>    access_log /var/log/nginx/kubernetes-dashboard_302_access.log main;
<a id=__codelineno-41-12 name=__codelineno-41-12 href=#__codelineno-41-12></a>    error_log /var/log/nginx/kubernetes-dashboard_302_error.log;
<a id=__codelineno-41-13 name=__codelineno-41-13 href=#__codelineno-41-13></a>    return 302 https://$server_name$request_uri;
<a id=__codelineno-41-14 name=__codelineno-41-14 href=#__codelineno-41-14></a>}
<a id=__codelineno-41-15 name=__codelineno-41-15 href=#__codelineno-41-15></a>
<a id=__codelineno-41-16 name=__codelineno-41-16 href=#__codelineno-41-16></a>server {
<a id=__codelineno-41-17 name=__codelineno-41-17 href=#__codelineno-41-17></a>    include ssl.d/autom_ssl.conf;
<a id=__codelineno-41-18 name=__codelineno-41-18 href=#__codelineno-41-18></a>    server_name kubernetes-dashboard.autom.studio;
<a id=__codelineno-41-19 name=__codelineno-41-19 href=#__codelineno-41-19></a>    access_log /var/log/nginx/kubernetes-dashboard_access.log main;
<a id=__codelineno-41-20 name=__codelineno-41-20 href=#__codelineno-41-20></a>    error_log /var/log/nginx/kubernetes-dashboard_error.log;
<a id=__codelineno-41-21 name=__codelineno-41-21 href=#__codelineno-41-21></a>
<a id=__codelineno-41-22 name=__codelineno-41-22 href=#__codelineno-41-22></a>    if ($http_user_agent ~ &quot;MSIE&quot; ) {
<a id=__codelineno-41-23 name=__codelineno-41-23 href=#__codelineno-41-23></a>        return 303 https://browser-update.org/update.html;
<a id=__codelineno-41-24 name=__codelineno-41-24 href=#__codelineno-41-24></a>    }
<a id=__codelineno-41-25 name=__codelineno-41-25 href=#__codelineno-41-25></a>
<a id=__codelineno-41-26 name=__codelineno-41-26 href=#__codelineno-41-26></a>    location / {
<a id=__codelineno-41-27 name=__codelineno-41-27 href=#__codelineno-41-27></a>        proxy_pass https://kubernetes-dashboard/;
<a id=__codelineno-41-28 name=__codelineno-41-28 href=#__codelineno-41-28></a>        # 禁用缓存
<a id=__codelineno-41-29 name=__codelineno-41-29 href=#__codelineno-41-29></a>        proxy_no_cache 1;
<a id=__codelineno-41-30 name=__codelineno-41-30 href=#__codelineno-41-30></a>        proxy_cache_bypass 1;
<a id=__codelineno-41-31 name=__codelineno-41-31 href=#__codelineno-41-31></a>        proxy_set_header Host $host;
<a id=__codelineno-41-32 name=__codelineno-41-32 href=#__codelineno-41-32></a>        proxy_set_header X-Real-IP $remote_addr;
<a id=__codelineno-41-33 name=__codelineno-41-33 href=#__codelineno-41-33></a>        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
<a id=__codelineno-41-34 name=__codelineno-41-34 href=#__codelineno-41-34></a>        proxy_set_header REMOTE-HOST $remote_addr;
<a id=__codelineno-41-35 name=__codelineno-41-35 href=#__codelineno-41-35></a>        proxy_set_header X-Forwarded-Proto $scheme;
<a id=__codelineno-41-36 name=__codelineno-41-36 href=#__codelineno-41-36></a>    }
<a id=__codelineno-41-37 name=__codelineno-41-37 href=#__codelineno-41-37></a>
<a id=__codelineno-41-38 name=__codelineno-41-38 href=#__codelineno-41-38></a>    error_page 500 502 503 504 /50x.html;
<a id=__codelineno-41-39 name=__codelineno-41-39 href=#__codelineno-41-39></a>    location = /50x.html {
<a id=__codelineno-41-40 name=__codelineno-41-40 href=#__codelineno-41-40></a>        root /usr/share/nginx/html;
<a id=__codelineno-41-41 name=__codelineno-41-41 href=#__codelineno-41-41></a>    }
<a id=__codelineno-41-42 name=__codelineno-41-42 href=#__codelineno-41-42></a>}
</code></pre></div> <h2 id=9云原生存储-rook>9.云原生存储 Rook<a class=headerlink href=#9云原生存储-rook title="Permanent link">&para;</a></h2> <h3 id=91-动机>9.1 动机<a class=headerlink href=#91-动机 title="Permanent link">&para;</a></h3> <p>云环境 kubernetes 集群要使用后端存储有很多选择，比如 oss ， nas ， 云盘 等。但是有时候我们可能会出于其他各种原因需要自建存储服务器来为 kubernetes 提供存储卷，一般我们都会选择 ceph 存储，但如果使用物理机或者 ecs 去部署，需要花费大量人力不说，维护起来也相当割裂，幸好有 rook ceph 这种方案，很好地与云原生环境集成，可以让 ceph 直接跑在 kubernetes 集群上，这样一来便可大大方便维护还是管理。</p> <h3 id=92-前置条件>9.2 前置条件<a class=headerlink href=#92-前置条件 title="Permanent link">&para;</a></h3> <ol> <li>生产环境需要至少 3 台以上节点，用于作为 osd 节点存储数据使用。</li> <li>每个 osd 节点，至少拥有一块裸盘，用于部署 rook ceph 时初始化用。</li> <li>我们使用的 rook ceph 版本较高，需要 kubernetes 版本 1.22 或更高。</li> </ol> <table> <thead> <tr> <th>名称</th> <th>信息</th> </tr> </thead> <tbody> <tr> <td>节点配置</td> <td>16c64g 200G SSD *1 500G SSD *1(一个系统盘一个 ceph 元数据) 节点数 3</td> </tr> <tr> <td>Kubernetes 集群</td> <td>v1.26.0</td> </tr> <tr> <td>helm</td> <td>v3.8.0</td> </tr> <tr> <td>Rook</td> <td>v1.13.1</td> </tr> <tr> <td>Ceph</td> <td>v18.2.1</td> </tr> <tr> <td>Mon 组件</td> <td>3 个</td> </tr> <tr> <td>Mgr 组件</td> <td>2 个</td> </tr> </tbody> </table> <h3 id=93-部署>9.3 部署<a class=headerlink href=#93-部署 title="Permanent link">&para;</a></h3> <h4 id=k8s-集群准备>K8S 集群准备<a class=headerlink href=#k8s-集群准备 title="Permanent link">&para;</a></h4> <p>Rook 1.13 支持 Kubernetes v1.23 或更高版本。</p> <p>本文使用的 Kubernetes 集群如下:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-42-1 name=__codelineno-42-1 href=#__codelineno-42-1></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>node
<a id=__codelineno-42-2 name=__codelineno-42-2 href=#__codelineno-42-2></a>NAME<span class=w>                       </span>STATUS<span class=w>   </span>ROLES<span class=w>           </span>AGE<span class=w>   </span>VERSION
<a id=__codelineno-42-3 name=__codelineno-42-3 href=#__codelineno-42-3></a>gitee-kubernetes-master1<span class=w>   </span>Ready<span class=w>    </span>control-plane<span class=w>   </span>20d<span class=w>   </span>v1.26.3
<a id=__codelineno-42-4 name=__codelineno-42-4 href=#__codelineno-42-4></a>gitee-kubernetes-master2<span class=w>   </span>Ready<span class=w>    </span>control-plane<span class=w>   </span>20d<span class=w>   </span>v1.26.3
<a id=__codelineno-42-5 name=__codelineno-42-5 href=#__codelineno-42-5></a>gitee-kubernetes-master3<span class=w>   </span>Ready<span class=w>    </span>control-plane<span class=w>   </span>20d<span class=w>   </span>v1.26.3
<a id=__codelineno-42-6 name=__codelineno-42-6 href=#__codelineno-42-6></a>gitee-kubernetes-node01<span class=w>    </span>Ready<span class=w>    </span>&lt;none&gt;<span class=w>          </span>20d<span class=w>   </span>v1.26.3
<a id=__codelineno-42-7 name=__codelineno-42-7 href=#__codelineno-42-7></a>gitee-kubernetes-node02<span class=w>    </span>Ready<span class=w>    </span>&lt;none&gt;<span class=w>          </span>20d<span class=w>   </span>v1.26.3
<a id=__codelineno-42-8 name=__codelineno-42-8 href=#__codelineno-42-8></a>gitee-kubernetes-node03<span class=w>    </span>Ready<span class=w>    </span>&lt;none&gt;<span class=w>          </span>20d<span class=w>   </span>v1.26.3
<a id=__codelineno-42-9 name=__codelineno-42-9 href=#__codelineno-42-9></a>gitee-kubernetes-node04<span class=w>    </span>Ready<span class=w>    </span>&lt;none&gt;<span class=w>          </span>20d<span class=w>   </span>v1.26.3
<a id=__codelineno-42-10 name=__codelineno-42-10 href=#__codelineno-42-10></a>gitee-kubernetes-node05<span class=w>    </span>Ready<span class=w>    </span>&lt;none&gt;<span class=w>          </span>20d<span class=w>   </span>v1.26.3
<a id=__codelineno-42-11 name=__codelineno-42-11 href=#__codelineno-42-11></a>gitee-kubernetes-node06<span class=w>    </span>Ready<span class=w>    </span>&lt;none&gt;<span class=w>          </span>20d<span class=w>   </span>v1.26.3
<a id=__codelineno-42-12 name=__codelineno-42-12 href=#__codelineno-42-12></a>gitee-kubernetes-node07<span class=w>    </span>Ready<span class=w>    </span>&lt;none&gt;<span class=w>          </span>20d<span class=w>   </span>v1.26.3
<a id=__codelineno-42-13 name=__codelineno-42-13 href=#__codelineno-42-13></a>gitee-kubernetes-node08<span class=w>    </span>Ready<span class=w>    </span>&lt;none&gt;<span class=w>          </span>20d<span class=w>   </span>v1.26.3
<a id=__codelineno-42-14 name=__codelineno-42-14 href=#__codelineno-42-14></a>gitee-kubernetes-node09<span class=w>    </span>Ready<span class=w>    </span>&lt;none&gt;<span class=w>          </span>20d<span class=w>   </span>v1.26.3
<a id=__codelineno-42-15 name=__codelineno-42-15 href=#__codelineno-42-15></a>gitee-kubernetes-node10<span class=w>    </span>Ready<span class=w>    </span>&lt;none&gt;<span class=w>          </span>20d<span class=w>   </span>v1.26.3
<a id=__codelineno-42-16 name=__codelineno-42-16 href=#__codelineno-42-16></a>gitee-kubernetes-node11<span class=w>    </span>Ready<span class=w>    </span>&lt;none&gt;<span class=w>          </span>20d<span class=w>   </span>v1.26.3
<a id=__codelineno-42-17 name=__codelineno-42-17 href=#__codelineno-42-17></a>gitee-kubernetes-node12<span class=w>    </span>Ready<span class=w>    </span>&lt;none&gt;<span class=w>          </span>20d<span class=w>   </span>v1.26.3
</code></pre></div> <p>关于容器运行时的配置，这里的 Kubernetes 集群的容器运行时是 Containerd。</p> <p>注意如果 Containerd 的 systemd 配置 containerd.service 中如果有<code>LimitNOFILE=infinity</code>的配置，后边在使用 rook 启动 Ceph 集群时，Ceph 的 Mon 组件会有问题，会出现<code>ms_dispatch</code>进程的 cpu 一直是 100%，Rook 社区有两个 ISSUES <a href=https://github.com/rook/rook/issues/11253>ISSUE 11253</a>和<a href=https://github.com/rook/rook/issues/10110>ISSUE 10110</a>讨论了这个问题，需要将<code>LimitNOFILE</code>设置一个合适的值，我这里设置的是<code>1048576</code>。</p> <p>How to fix?</p> <div class=highlight><pre><span></span><code><a id=__codelineno-43-1 name=__codelineno-43-1 href=#__codelineno-43-1></a>$<span class=w> </span>cat<span class=w> </span>&gt;/etc/systemd/system/containerd.service.d/LimitNOFILE.conf<span class=s>&lt;&lt;EOF</span>
<a id=__codelineno-43-2 name=__codelineno-43-2 href=#__codelineno-43-2></a><span class=s>[Service]</span>
<a id=__codelineno-43-3 name=__codelineno-43-3 href=#__codelineno-43-3></a><span class=s>LimitNOFILE=1048576</span>
<a id=__codelineno-43-4 name=__codelineno-43-4 href=#__codelineno-43-4></a><span class=s>EOF</span>
<a id=__codelineno-43-5 name=__codelineno-43-5 href=#__codelineno-43-5></a>$<span class=w> </span>systemctl<span class=w> </span>daemon-reload
<a id=__codelineno-43-6 name=__codelineno-43-6 href=#__codelineno-43-6></a>$<span class=w> </span>systemctl<span class=w> </span>restart<span class=w> </span>containerd
</code></pre></div> <h4 id=本地存储准备lvm-逻辑卷>本地存储准备(LVM 逻辑卷)<a class=headerlink href=#本地存储准备lvm-逻辑卷 title="Permanent link">&para;</a></h4> <p>要配置 Ceph 存储集群，至少需要以下其中一种本地存储：</p> <ul> <li>原始设备(Raw devices)（无分区或格式化文件系统）</li> <li>原始分区(Raw partitions)（无格式化文件系统）</li> <li>LVM 逻辑卷（无格式化文件系统）</li> <li>以块模式(block mode)在存储类(storage class)中提供的持久卷。</li> </ul> <p>我们将使用的本地存储是<code>LVM逻辑卷</code>。</p> <p>gitee-kubernetes-node09~gitee-kubernetes-node11 三台主机上都有一个未分区的本地磁盘将用作 Ceph 集群的本地存储。</p> <div class=highlight><pre><span></span><code><a id=__codelineno-44-1 name=__codelineno-44-1 href=#__codelineno-44-1></a><span class=c1># gitee-kubernetes-node09</span>
<a id=__codelineno-44-2 name=__codelineno-44-2 href=#__codelineno-44-2></a>root@gitee-kubernetes-node09:/home/ubuntu#<span class=w> </span>fdisk<span class=w> </span>-l<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>/dev/vdb
<a id=__codelineno-44-3 name=__codelineno-44-3 href=#__codelineno-44-3></a>Disk<span class=w> </span>/dev/vdb:<span class=w> </span><span class=m>500</span><span class=w> </span>GiB,<span class=w> </span><span class=m>536870912000</span><span class=w> </span>bytes,<span class=w> </span><span class=m>1048576000</span><span class=w> </span>sectors
<a id=__codelineno-44-4 name=__codelineno-44-4 href=#__codelineno-44-4></a>
<a id=__codelineno-44-5 name=__codelineno-44-5 href=#__codelineno-44-5></a><span class=c1># gitee-kubernetes-node10</span>
<a id=__codelineno-44-6 name=__codelineno-44-6 href=#__codelineno-44-6></a>root@gitee-kubernetes-node10:/home/ubuntu#<span class=w> </span>fdisk<span class=w> </span>-l<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>/dev/vdb
<a id=__codelineno-44-7 name=__codelineno-44-7 href=#__codelineno-44-7></a>Disk<span class=w> </span>/dev/vdb:<span class=w> </span><span class=m>500</span><span class=w> </span>GiB,<span class=w> </span><span class=m>536870912000</span><span class=w> </span>bytes,<span class=w> </span><span class=m>1048576000</span><span class=w> </span>sectors
<a id=__codelineno-44-8 name=__codelineno-44-8 href=#__codelineno-44-8></a>
<a id=__codelineno-44-9 name=__codelineno-44-9 href=#__codelineno-44-9></a><span class=c1># # gitee-kubernetes-node11</span>
<a id=__codelineno-44-10 name=__codelineno-44-10 href=#__codelineno-44-10></a>root@gitee-kubernetes-node11:/home/ubuntu#<span class=w> </span>fdisk<span class=w> </span>-l<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>/dev/vdb
<a id=__codelineno-44-11 name=__codelineno-44-11 href=#__codelineno-44-11></a>Disk<span class=w> </span>/dev/vdb:<span class=w> </span><span class=m>500</span><span class=w> </span>GiB,<span class=w> </span><span class=m>536870912000</span><span class=w> </span>bytes,<span class=w> </span><span class=m>1048576000</span><span class=w> </span>sectors
</code></pre></div> <blockquote> <p>注意：在执行以下步骤之前，请确保磁盘上没有重要数据，因为这些步骤将擦除磁盘上的所有数据。</p> </blockquote> <div class=highlight><pre><span></span><code><a id=__codelineno-45-1 name=__codelineno-45-1 href=#__codelineno-45-1></a><span class=c1># 首先创建物理卷</span>
<a id=__codelineno-45-2 name=__codelineno-45-2 href=#__codelineno-45-2></a>pvcreate<span class=w> </span>/dev/vdb
<a id=__codelineno-45-3 name=__codelineno-45-3 href=#__codelineno-45-3></a><span class=c1># 接下来创建名称为ceph的卷组</span>
<a id=__codelineno-45-4 name=__codelineno-45-4 href=#__codelineno-45-4></a>vgcreate<span class=w> </span>ceph<span class=w> </span>/dev/vdb
<a id=__codelineno-45-5 name=__codelineno-45-5 href=#__codelineno-45-5></a><span class=c1># 最后从卷组ceph创建逻辑卷， 使用lvcreate命令来创建逻辑卷。</span>
<a id=__codelineno-45-6 name=__codelineno-45-6 href=#__codelineno-45-6></a><span class=c1># 使用卷组ceph的所有可用空间创建了名称为osd的逻辑卷</span>
<a id=__codelineno-45-7 name=__codelineno-45-7 href=#__codelineno-45-7></a>lvcreate<span class=w> </span>-n<span class=w> </span>osd<span class=w> </span>-l<span class=w> </span><span class=m>100</span>%FREE<span class=w> </span>ceph
<a id=__codelineno-45-8 name=__codelineno-45-8 href=#__codelineno-45-8></a>
<a id=__codelineno-45-9 name=__codelineno-45-9 href=#__codelineno-45-9></a><span class=c1># 如果想指定逻辑卷的具体大小可以使用下面的命令:</span>
<a id=__codelineno-45-10 name=__codelineno-45-10 href=#__codelineno-45-10></a><span class=c1># lvcreate -n osd -L 400G ceph</span>
<a id=__codelineno-45-11 name=__codelineno-45-11 href=#__codelineno-45-11></a>
<a id=__codelineno-45-12 name=__codelineno-45-12 href=#__codelineno-45-12></a><span class=c1># 删除lvm</span>
<a id=__codelineno-45-13 name=__codelineno-45-13 href=#__codelineno-45-13></a><span class=c1>#yes | lvremove /dev/ceph/osd</span>
<a id=__codelineno-45-14 name=__codelineno-45-14 href=#__codelineno-45-14></a><span class=c1>#vgremove ceph</span>
<a id=__codelineno-45-15 name=__codelineno-45-15 href=#__codelineno-45-15></a><span class=c1>#pvremove /dev/vdb</span>
</code></pre></div> <p>因为 Ceph 集群所需要的本地存储是未格式化为文件系统的 LVM 逻辑卷，所以注意一定不要使用<code>mkfs.ext4</code>或<code>mkfs.xfs</code>格式化逻辑卷。</p> <p>最后查看一下逻辑卷:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-46-1 name=__codelineno-46-1 href=#__codelineno-46-1></a>$<span class=w> </span>lvdisplay
<a id=__codelineno-46-2 name=__codelineno-46-2 href=#__codelineno-46-2></a><span class=w>  </span>---<span class=w> </span>Logical<span class=w> </span>volume<span class=w> </span>---
<a id=__codelineno-46-3 name=__codelineno-46-3 href=#__codelineno-46-3></a><span class=w>  </span>LV<span class=w> </span>Path<span class=w>                </span>/dev/ceph/osd
<a id=__codelineno-46-4 name=__codelineno-46-4 href=#__codelineno-46-4></a><span class=w>  </span>LV<span class=w> </span>Name<span class=w>                </span>osd
<a id=__codelineno-46-5 name=__codelineno-46-5 href=#__codelineno-46-5></a><span class=w>  </span>VG<span class=w> </span>Name<span class=w>                </span>ceph
<a id=__codelineno-46-6 name=__codelineno-46-6 href=#__codelineno-46-6></a><span class=w>  </span>LV<span class=w> </span>UUID<span class=w>                </span>cVsDhP-hUtV-7Eoe-XID1-Uvdt-TZ3z-7IEAXG
<a id=__codelineno-46-7 name=__codelineno-46-7 href=#__codelineno-46-7></a><span class=w>  </span>LV<span class=w> </span>Write<span class=w> </span>Access<span class=w>        </span>read/write
<a id=__codelineno-46-8 name=__codelineno-46-8 href=#__codelineno-46-8></a><span class=w>  </span>LV<span class=w> </span>Creation<span class=w> </span>host,<span class=w> </span><span class=nb>time</span><span class=w> </span>gitee-kubernetes-node09,<span class=w> </span><span class=m>2024</span>-01-02<span class=w> </span><span class=m>10</span>:37:19<span class=w> </span>+0000
<a id=__codelineno-46-9 name=__codelineno-46-9 href=#__codelineno-46-9></a><span class=w>  </span>LV<span class=w> </span>Status<span class=w>              </span>available
<a id=__codelineno-46-10 name=__codelineno-46-10 href=#__codelineno-46-10></a><span class=w>  </span><span class=c1># open                 0</span>
<a id=__codelineno-46-11 name=__codelineno-46-11 href=#__codelineno-46-11></a><span class=w>  </span>LV<span class=w> </span>Size<span class=w>                </span>&lt;<span class=m>500</span>.00<span class=w> </span>GiB
<a id=__codelineno-46-12 name=__codelineno-46-12 href=#__codelineno-46-12></a><span class=w>  </span>Current<span class=w> </span>LE<span class=w>             </span><span class=m>127999</span>
<a id=__codelineno-46-13 name=__codelineno-46-13 href=#__codelineno-46-13></a><span class=w>  </span>Segments<span class=w>               </span><span class=m>1</span>
<a id=__codelineno-46-14 name=__codelineno-46-14 href=#__codelineno-46-14></a><span class=w>  </span>Allocation<span class=w>             </span>inherit
<a id=__codelineno-46-15 name=__codelineno-46-15 href=#__codelineno-46-15></a><span class=w>  </span>Read<span class=w> </span>ahead<span class=w> </span>sectors<span class=w>     </span>auto
<a id=__codelineno-46-16 name=__codelineno-46-16 href=#__codelineno-46-16></a><span class=w>  </span>-<span class=w> </span>currently<span class=w> </span><span class=nb>set</span><span class=w> </span>to<span class=w>     </span><span class=m>256</span>
<a id=__codelineno-46-17 name=__codelineno-46-17 href=#__codelineno-46-17></a><span class=w>  </span>Block<span class=w> </span>device<span class=w>           </span><span class=m>253</span>:0
</code></pre></div> <h4 id=配置时间同步>配置时间同步<a class=headerlink href=#配置时间同步 title="Permanent link">&para;</a></h4> <p>注意设置各个服务器节点的时间同步，这个是否重要，否则如果各个服务器节点时间不同步时，rook ceph operator 在操作时，ceph mon 组件的可能会无法正常工作。</p> <p>关于时间同步推荐使用 chronyd。</p> <h4 id=安装-helm>安装 helm<a class=headerlink href=#安装-helm title="Permanent link">&para;</a></h4> <p>参考 5.2 安装 helm</p> <h4 id=部署-rook-operator>部署 Rook Operator<a class=headerlink href=#部署-rook-operator title="Permanent link">&para;</a></h4> <p>我们将 Ceph 的 mon,osd,mrg 等调度到 gitee-kubernetes-node09, gitee-kubernetes-node10, gitee-kubernetes-node11 上。</p> <p>下面给这 3 个节点打上<code>role=ceph</code>的 label，并加上<code>GiteeFrontendOnly=yes:NoSchedule</code>的 taint。</p> <div class=highlight><pre><span></span><code><a id=__codelineno-47-1 name=__codelineno-47-1 href=#__codelineno-47-1></a><span class=c1># kubectl label node gitee-kubernetes-node09 role=ceph</span>
<a id=__codelineno-47-2 name=__codelineno-47-2 href=#__codelineno-47-2></a><span class=c1># 注意：ceph和前端服务器部署在一起。</span>
<a id=__codelineno-47-3 name=__codelineno-47-3 href=#__codelineno-47-3></a>kubectl<span class=w> </span>label<span class=w> </span>node<span class=w> </span>gitee-kubernetes-node09<span class=w> </span><span class=nv>role</span><span class=o>=</span>ceph
<a id=__codelineno-47-4 name=__codelineno-47-4 href=#__codelineno-47-4></a>kubectl<span class=w> </span>label<span class=w> </span>node<span class=w> </span>gitee-kubernetes-node10<span class=w> </span><span class=nv>role</span><span class=o>=</span>ceph
<a id=__codelineno-47-5 name=__codelineno-47-5 href=#__codelineno-47-5></a>kubectl<span class=w> </span>label<span class=w> </span>node<span class=w> </span>gitee-kubernetes-node11<span class=w> </span><span class=nv>role</span><span class=o>=</span>ceph
<a id=__codelineno-47-6 name=__codelineno-47-6 href=#__codelineno-47-6></a>
<a id=__codelineno-47-7 name=__codelineno-47-7 href=#__codelineno-47-7></a><span class=c1># kubectl taint nodes node4 dedicated=ceph:NoSchedule</span>
<a id=__codelineno-47-8 name=__codelineno-47-8 href=#__codelineno-47-8></a>kubectl<span class=w> </span>taint<span class=w> </span>nodes<span class=w> </span>gitee-kubernetes-node09<span class=w> </span><span class=nv>GiteeFrontendOnly</span><span class=o>=</span>yes:NoSchedule
<a id=__codelineno-47-9 name=__codelineno-47-9 href=#__codelineno-47-9></a>kubectl<span class=w> </span>taint<span class=w> </span>nodes<span class=w> </span>gitee-kubernetes-node10<span class=w> </span><span class=nv>GiteeFrontendOnly</span><span class=o>=</span>yes:NoSchedule
<a id=__codelineno-47-10 name=__codelineno-47-10 href=#__codelineno-47-10></a>kubectl<span class=w> </span>taint<span class=w> </span>nodes<span class=w> </span>gitee-kubernetes-node11<span class=w> </span><span class=nv>GiteeFrontendOnly</span><span class=o>=</span>yes:NoSchedule
</code></pre></div> <p>我们将通过使用 Rook Helm Chart 来部署 rook ceph operator。</p> <p>Rook 目前将 Ceph Operator 的构建版本发布到发布（release）和主要（master）通道。发布通道是 Rook 的最新稳定版。</p> <div class=highlight><pre><span></span><code><a id=__codelineno-48-1 name=__codelineno-48-1 href=#__codelineno-48-1></a>$<span class=w> </span>helm<span class=w> </span>repo<span class=w> </span>add<span class=w> </span>rook-release<span class=w> </span>https://charts.rook.io/release
<a id=__codelineno-48-2 name=__codelineno-48-2 href=#__codelineno-48-2></a>$<span class=w> </span>helm<span class=w> </span>repo<span class=w> </span>update
<a id=__codelineno-48-3 name=__codelineno-48-3 href=#__codelineno-48-3></a><span class=c1>#$ helm install --create-namespace --namespace rook-ceph rook-ceph rook-release/rook-ceph -f values.yaml</span>
</code></pre></div> <p>或者从https://charts.rook.io/release/rook-ceph-v1.13.1.tgz下载rook-ceph的helm chart，再使用下面的命令安装:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-49-1 name=__codelineno-49-1 href=#__codelineno-49-1></a>$<span class=w> </span>helm<span class=w> </span>pull<span class=w> </span>rook-release/rook-ceph<span class=w> </span>--version<span class=w> </span>v1.13.1<span class=w> </span>--untar
<a id=__codelineno-49-2 name=__codelineno-49-2 href=#__codelineno-49-2></a><span class=c1># $ helm pull rook-release/rook-ceph --version v1.13.1</span>
<a id=__codelineno-49-3 name=__codelineno-49-3 href=#__codelineno-49-3></a>$<span class=w> </span>helm<span class=w> </span>install<span class=w> </span>--create-namespace<span class=w> </span>--namespace<span class=w> </span>rook-ceph<span class=w> </span>rook-ceph<span class=w> </span>rook-ceph-v1.13.1.tgz<span class=w> </span>-f<span class=w> </span>values.yaml
</code></pre></div> <p>关于 values.yaml 中配置的内容，可以根据文档https://github.com/rook/rook/blob/master/deploy/charts/rook-ceph-cluster/values.yaml中的内容按需定制。</p> <p>以下是当前我所定制的内容，主要配置了在部署 Rook Operator 和 Ceph 时使用私有的镜像仓库地址，以及调度相关的配置。</p> <p><code>values-prod.yaml</code></p> <div class=highlight><pre><span></span><code><a id=__codelineno-50-1 name=__codelineno-50-1 href=#__codelineno-50-1></a><span class=nt>image</span><span class=p>:</span>
<a id=__codelineno-50-2 name=__codelineno-50-2 href=#__codelineno-50-2></a><span class=w>  </span><span class=c1># -- Image</span>
<a id=__codelineno-50-3 name=__codelineno-50-3 href=#__codelineno-50-3></a><span class=w>  </span><span class=nt>repository</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rook/ceph</span>
<a id=__codelineno-50-4 name=__codelineno-50-4 href=#__codelineno-50-4></a><span class=w>  </span><span class=c1># -- Image tag</span>
<a id=__codelineno-50-5 name=__codelineno-50-5 href=#__codelineno-50-5></a><span class=w>  </span><span class=c1># @default -- `v1.13.1`</span>
<a id=__codelineno-50-6 name=__codelineno-50-6 href=#__codelineno-50-6></a><span class=w>  </span><span class=nt>tag</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1.13.1</span>
<a id=__codelineno-50-7 name=__codelineno-50-7 href=#__codelineno-50-7></a><span class=w>  </span><span class=c1># -- Image pull policy</span>
<a id=__codelineno-50-8 name=__codelineno-50-8 href=#__codelineno-50-8></a><span class=w>  </span><span class=nt>pullPolicy</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
<a id=__codelineno-50-9 name=__codelineno-50-9 href=#__codelineno-50-9></a>
<a id=__codelineno-50-10 name=__codelineno-50-10 href=#__codelineno-50-10></a><span class=nt>tolerations</span><span class=p>:</span>
<a id=__codelineno-50-11 name=__codelineno-50-11 href=#__codelineno-50-11></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=s>&quot;GiteeFrontendOnly&quot;</span>
<a id=__codelineno-50-12 name=__codelineno-50-12 href=#__codelineno-50-12></a><span class=w>    </span><span class=nt>operator</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Equal&quot;</span>
<a id=__codelineno-50-13 name=__codelineno-50-13 href=#__codelineno-50-13></a><span class=w>    </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s>&quot;yes&quot;</span>
<a id=__codelineno-50-14 name=__codelineno-50-14 href=#__codelineno-50-14></a><span class=w>    </span><span class=nt>effect</span><span class=p>:</span><span class=w> </span><span class=s>&quot;NoSchedule&quot;</span>
<a id=__codelineno-50-15 name=__codelineno-50-15 href=#__codelineno-50-15></a>
<a id=__codelineno-50-16 name=__codelineno-50-16 href=#__codelineno-50-16></a><span class=nt>provisionerNodeAffinity</span><span class=p>:</span>
<a id=__codelineno-50-17 name=__codelineno-50-17 href=#__codelineno-50-17></a><span class=w>  </span><span class=nt>requiredDuringSchedulingIgnoredDuringExecution</span><span class=p>:</span>
<a id=__codelineno-50-18 name=__codelineno-50-18 href=#__codelineno-50-18></a><span class=w>    </span><span class=nt>nodeSelectorTerms</span><span class=p>:</span>
<a id=__codelineno-50-19 name=__codelineno-50-19 href=#__codelineno-50-19></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>matchExpressions</span><span class=p>:</span>
<a id=__codelineno-50-20 name=__codelineno-50-20 href=#__codelineno-50-20></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">role</span>
<a id=__codelineno-50-21 name=__codelineno-50-21 href=#__codelineno-50-21></a><span class=w>            </span><span class=nt>operator</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">In</span>
<a id=__codelineno-50-22 name=__codelineno-50-22 href=#__codelineno-50-22></a><span class=w>            </span><span class=nt>values</span><span class=p>:</span>
<a id=__codelineno-50-23 name=__codelineno-50-23 href=#__codelineno-50-23></a><span class=w>              </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ceph</span>
<a id=__codelineno-50-24 name=__codelineno-50-24 href=#__codelineno-50-24></a><span class=nt>provisionerTolerations</span><span class=p>:</span>
<a id=__codelineno-50-25 name=__codelineno-50-25 href=#__codelineno-50-25></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=s>&quot;GiteeFrontendOnly&quot;</span>
<a id=__codelineno-50-26 name=__codelineno-50-26 href=#__codelineno-50-26></a><span class=w>    </span><span class=nt>operator</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Equal&quot;</span>
<a id=__codelineno-50-27 name=__codelineno-50-27 href=#__codelineno-50-27></a><span class=w>    </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s>&quot;yes&quot;</span>
<a id=__codelineno-50-28 name=__codelineno-50-28 href=#__codelineno-50-28></a><span class=w>    </span><span class=nt>effect</span><span class=p>:</span><span class=w> </span><span class=s>&quot;NoSchedule&quot;</span>
<a id=__codelineno-50-29 name=__codelineno-50-29 href=#__codelineno-50-29></a><span class=nt>pluginNodeAffinity</span><span class=p>:</span>
<a id=__codelineno-50-30 name=__codelineno-50-30 href=#__codelineno-50-30></a><span class=w>  </span><span class=nt>requiredDuringSchedulingIgnoredDuringExecution</span><span class=p>:</span>
<a id=__codelineno-50-31 name=__codelineno-50-31 href=#__codelineno-50-31></a><span class=w>    </span><span class=nt>nodeSelectorTerms</span><span class=p>:</span>
<a id=__codelineno-50-32 name=__codelineno-50-32 href=#__codelineno-50-32></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>matchExpressions</span><span class=p>:</span>
<a id=__codelineno-50-33 name=__codelineno-50-33 href=#__codelineno-50-33></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">role</span>
<a id=__codelineno-50-34 name=__codelineno-50-34 href=#__codelineno-50-34></a><span class=w>            </span><span class=nt>operator</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">In</span>
<a id=__codelineno-50-35 name=__codelineno-50-35 href=#__codelineno-50-35></a><span class=w>            </span><span class=nt>values</span><span class=p>:</span>
<a id=__codelineno-50-36 name=__codelineno-50-36 href=#__codelineno-50-36></a><span class=w>              </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ceph</span>
<a id=__codelineno-50-37 name=__codelineno-50-37 href=#__codelineno-50-37></a><span class=nt>pluginTolerations</span><span class=p>:</span>
<a id=__codelineno-50-38 name=__codelineno-50-38 href=#__codelineno-50-38></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=s>&quot;GiteeFrontendOnly&quot;</span>
<a id=__codelineno-50-39 name=__codelineno-50-39 href=#__codelineno-50-39></a><span class=w>    </span><span class=nt>operator</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Equal&quot;</span>
<a id=__codelineno-50-40 name=__codelineno-50-40 href=#__codelineno-50-40></a><span class=w>    </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s>&quot;yes&quot;</span>
<a id=__codelineno-50-41 name=__codelineno-50-41 href=#__codelineno-50-41></a><span class=w>    </span><span class=nt>effect</span><span class=p>:</span><span class=w> </span><span class=s>&quot;NoSchedule&quot;</span>
<a id=__codelineno-50-42 name=__codelineno-50-42 href=#__codelineno-50-42></a>
<a id=__codelineno-50-43 name=__codelineno-50-43 href=#__codelineno-50-43></a><span class=nt>discover</span><span class=p>:</span>
<a id=__codelineno-50-44 name=__codelineno-50-44 href=#__codelineno-50-44></a><span class=w>  </span><span class=nt>tolerations</span><span class=p>:</span>
<a id=__codelineno-50-45 name=__codelineno-50-45 href=#__codelineno-50-45></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=s>&quot;GiteeFrontendOnly&quot;</span>
<a id=__codelineno-50-46 name=__codelineno-50-46 href=#__codelineno-50-46></a><span class=w>      </span><span class=nt>operator</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Equal&quot;</span>
<a id=__codelineno-50-47 name=__codelineno-50-47 href=#__codelineno-50-47></a><span class=w>      </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s>&quot;yes&quot;</span>
<a id=__codelineno-50-48 name=__codelineno-50-48 href=#__codelineno-50-48></a><span class=w>      </span><span class=nt>effect</span><span class=p>:</span><span class=w> </span><span class=s>&quot;NoSchedule&quot;</span>
<a id=__codelineno-50-49 name=__codelineno-50-49 href=#__codelineno-50-49></a><span class=w>  </span><span class=nt>nodeAffinity</span><span class=p>:</span>
<a id=__codelineno-50-50 name=__codelineno-50-50 href=#__codelineno-50-50></a><span class=w>    </span><span class=nt>nodeSelectorTerms</span><span class=p>:</span>
<a id=__codelineno-50-51 name=__codelineno-50-51 href=#__codelineno-50-51></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>matchExpressions</span><span class=p>:</span>
<a id=__codelineno-50-52 name=__codelineno-50-52 href=#__codelineno-50-52></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">role</span>
<a id=__codelineno-50-53 name=__codelineno-50-53 href=#__codelineno-50-53></a><span class=w>            </span><span class=nt>operator</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">In</span>
<a id=__codelineno-50-54 name=__codelineno-50-54 href=#__codelineno-50-54></a><span class=w>            </span><span class=nt>values</span><span class=p>:</span>
<a id=__codelineno-50-55 name=__codelineno-50-55 href=#__codelineno-50-55></a><span class=w>              </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ceph</span>
<a id=__codelineno-50-56 name=__codelineno-50-56 href=#__codelineno-50-56></a>
<a id=__codelineno-50-57 name=__codelineno-50-57 href=#__codelineno-50-57></a><span class=nt>admissionController</span><span class=p>:</span>
<a id=__codelineno-50-58 name=__codelineno-50-58 href=#__codelineno-50-58></a><span class=w>  </span><span class=nt>tolerations</span><span class=p>:</span>
<a id=__codelineno-50-59 name=__codelineno-50-59 href=#__codelineno-50-59></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=s>&quot;GiteeFrontendOnly&quot;</span>
<a id=__codelineno-50-60 name=__codelineno-50-60 href=#__codelineno-50-60></a><span class=w>      </span><span class=nt>operator</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Equal&quot;</span>
<a id=__codelineno-50-61 name=__codelineno-50-61 href=#__codelineno-50-61></a><span class=w>      </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s>&quot;yes&quot;</span>
<a id=__codelineno-50-62 name=__codelineno-50-62 href=#__codelineno-50-62></a><span class=w>      </span><span class=nt>effect</span><span class=p>:</span><span class=w> </span><span class=s>&quot;NoSchedule&quot;</span>
<a id=__codelineno-50-63 name=__codelineno-50-63 href=#__codelineno-50-63></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=s>&quot;node-role.kubernetes.io/master&quot;</span>
<a id=__codelineno-50-64 name=__codelineno-50-64 href=#__codelineno-50-64></a><span class=w>      </span><span class=nt>operator</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Exists&quot;</span>
<a id=__codelineno-50-65 name=__codelineno-50-65 href=#__codelineno-50-65></a><span class=w>      </span><span class=nt>effect</span><span class=p>:</span><span class=w> </span><span class=s>&quot;PreferNoSchedule&quot;</span>
<a id=__codelineno-50-66 name=__codelineno-50-66 href=#__codelineno-50-66></a><span class=w>  </span><span class=nt>nodeAffinity</span><span class=p>:</span>
<a id=__codelineno-50-67 name=__codelineno-50-67 href=#__codelineno-50-67></a><span class=w>    </span><span class=nt>nodeSelectorTerms</span><span class=p>:</span>
<a id=__codelineno-50-68 name=__codelineno-50-68 href=#__codelineno-50-68></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>matchExpressions</span><span class=p>:</span>
<a id=__codelineno-50-69 name=__codelineno-50-69 href=#__codelineno-50-69></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">role</span>
<a id=__codelineno-50-70 name=__codelineno-50-70 href=#__codelineno-50-70></a><span class=w>            </span><span class=nt>operator</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">In</span>
<a id=__codelineno-50-71 name=__codelineno-50-71 href=#__codelineno-50-71></a><span class=w>            </span><span class=nt>values</span><span class=p>:</span>
<a id=__codelineno-50-72 name=__codelineno-50-72 href=#__codelineno-50-72></a><span class=w>              </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ceph</span>
</code></pre></div> <p>部署</p> <div class=highlight><pre><span></span><code><a id=__codelineno-51-1 name=__codelineno-51-1 href=#__codelineno-51-1></a>$<span class=w> </span>kubectl<span class=w> </span>create<span class=w> </span>ns<span class=w> </span>rook-ceph
<a id=__codelineno-51-2 name=__codelineno-51-2 href=#__codelineno-51-2></a>$<span class=w> </span><span class=nb>cd</span><span class=w> </span>rook-ceph
<a id=__codelineno-51-3 name=__codelineno-51-3 href=#__codelineno-51-3></a>$<span class=w> </span>helm<span class=w> </span>install<span class=w> </span>-n<span class=w> </span>rook-ceph<span class=w> </span>rook-ceph<span class=w> </span>-f<span class=w> </span>values-prod.yaml<span class=w> </span>.
</code></pre></div> <p>部署完成后，确认 rook-ceph-operator 的正常启动:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-52-1 name=__codelineno-52-1 href=#__codelineno-52-1></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>pods<span class=w> </span>-n<span class=w> </span>rook-ceph<span class=w> </span>-l<span class=w> </span><span class=s2>&quot;app=rook-ceph-operator&quot;</span>
<a id=__codelineno-52-2 name=__codelineno-52-2 href=#__codelineno-52-2></a>NAME<span class=w>                                  </span>READY<span class=w>   </span>STATUS<span class=w>    </span>RESTARTS<span class=w>   </span>AGE
<a id=__codelineno-52-3 name=__codelineno-52-3 href=#__codelineno-52-3></a>rook-ceph-operator-5bb7fbf69c-hn785<span class=w>   </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>64s
</code></pre></div> <h4 id=创建-ceph-集群>创建 Ceph 集群<a class=headerlink href=#创建-ceph-集群 title="Permanent link">&para;</a></h4> <h5 id=参考文档>参考文档<a class=headerlink href=#参考文档 title="Permanent link">&para;</a></h5> <p>Rook 文档侧重于在各种环境中启动 Rook。在创建 Ceph 集群时，可以考虑在以下的示例集群清单基础上做定制：</p> <ul> <li><a href=https://github.com/rook/rook/blob/release-1.12/deploy/examples/cluster.yaml>cluster.yaml</a>：用于在裸机上运行的生产集群的集群设置。需要至少三个工作节点。</li> <li><a href=https://github.com/rook/rook/blob/release-1.12/deploy/examples/cluster-on-pvc.yaml>cluster-on-pvc.yaml</a>：用于在动态云环境中运行的生产集群的集群设置。</li> <li><a href=https://github.com/rook/rook/blob/release-1.12/deploy/examples/cluster-test.yaml>cluster-test.yaml</a>：用于测试环境（如 minikube）的集群设置。</li> </ul> <p>有关更多详细信息，可参考<a href=https://rook.io/docs/rook/v1.12/Getting-Started/example-configurations/ >Ceph 的示例配置</a>。</p> <p>Rook Ceph Operator 已经部署完成并正常运行，我们可以创建 Ceph 集群了，这里选择的是<code>cluster.yaml</code>。</p> <h5 id=创建集群>创建集群<a class=headerlink href=#创建集群 title="Permanent link">&para;</a></h5> <div class=highlight><pre><span></span><code><a id=__codelineno-53-1 name=__codelineno-53-1 href=#__codelineno-53-1></a>$<span class=w> </span>git<span class=w> </span>clone<span class=w> </span>--single-branch<span class=w> </span>--branch<span class=w> </span>v1.13.1<span class=w> </span>https://github.com/rook/rook.git
</code></pre></div> <p>基于<a href=https://github.com/rook/rook/blob/release-1.12/deploy/examples/cluster.yaml>cluster-prod.yaml</a>定制我们自己的 cluster.yaml，以下是只包含 cluster.yaml 的修改内容:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-54-1 name=__codelineno-54-1 href=#__codelineno-54-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ceph.rook.io/v1</span>
<a id=__codelineno-54-2 name=__codelineno-54-2 href=#__codelineno-54-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">CephCluster</span>
<a id=__codelineno-54-3 name=__codelineno-54-3 href=#__codelineno-54-3></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-54-4 name=__codelineno-54-4 href=#__codelineno-54-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rook-ceph</span>
<a id=__codelineno-54-5 name=__codelineno-54-5 href=#__codelineno-54-5></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rook-ceph</span>
<a id=__codelineno-54-6 name=__codelineno-54-6 href=#__codelineno-54-6></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-54-7 name=__codelineno-54-7 href=#__codelineno-54-7></a><span class=w>  </span><span class=nt>cephVersion</span><span class=p>:</span>
<a id=__codelineno-54-8 name=__codelineno-54-8 href=#__codelineno-54-8></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">quay.io/ceph/ceph:v18.2.1</span>
<a id=__codelineno-54-9 name=__codelineno-54-9 href=#__codelineno-54-9></a><span class=w>  </span><span class=nt>mon</span><span class=p>:</span>
<a id=__codelineno-54-10 name=__codelineno-54-10 href=#__codelineno-54-10></a><span class=w>    </span><span class=nt>count</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<a id=__codelineno-54-11 name=__codelineno-54-11 href=#__codelineno-54-11></a><span class=w>    </span><span class=nt>allowMultiplePerNode</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<a id=__codelineno-54-12 name=__codelineno-54-12 href=#__codelineno-54-12></a><span class=w>  </span><span class=nt>mgr</span><span class=p>:</span>
<a id=__codelineno-54-13 name=__codelineno-54-13 href=#__codelineno-54-13></a><span class=w>    </span><span class=nt>count</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<a id=__codelineno-54-14 name=__codelineno-54-14 href=#__codelineno-54-14></a><span class=w>    </span><span class=nt>allowMultiplePerNode</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<a id=__codelineno-54-15 name=__codelineno-54-15 href=#__codelineno-54-15></a><span class=w>    </span><span class=nt>modules</span><span class=p>:</span>
<a id=__codelineno-54-16 name=__codelineno-54-16 href=#__codelineno-54-16></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">pg_autoscaler</span>
<a id=__codelineno-54-17 name=__codelineno-54-17 href=#__codelineno-54-17></a><span class=w>        </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id=__codelineno-54-18 name=__codelineno-54-18 href=#__codelineno-54-18></a><span class=w>  </span><span class=nt>dashboard</span><span class=p>:</span>
<a id=__codelineno-54-19 name=__codelineno-54-19 href=#__codelineno-54-19></a><span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id=__codelineno-54-20 name=__codelineno-54-20 href=#__codelineno-54-20></a><span class=w>    </span><span class=nt>ssl</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<a id=__codelineno-54-21 name=__codelineno-54-21 href=#__codelineno-54-21></a><span class=w>  </span><span class=nt>storage</span><span class=p>:</span>
<a id=__codelineno-54-22 name=__codelineno-54-22 href=#__codelineno-54-22></a><span class=w>    </span><span class=nt>useAllNodes</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id=__codelineno-54-23 name=__codelineno-54-23 href=#__codelineno-54-23></a><span class=w>    </span><span class=nt>useAllDevices</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id=__codelineno-54-24 name=__codelineno-54-24 href=#__codelineno-54-24></a><span class=w>    </span><span class=nt>devices</span><span class=p>:</span>
<a id=__codelineno-54-25 name=__codelineno-54-25 href=#__codelineno-54-25></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/dev/ceph/osd</span>
<a id=__codelineno-54-26 name=__codelineno-54-26 href=#__codelineno-54-26></a><span class=w>    </span><span class=nt>config</span><span class=p>:</span>
<a id=__codelineno-54-27 name=__codelineno-54-27 href=#__codelineno-54-27></a><span class=w>      </span><span class=nt>osdsPerDevice</span><span class=p>:</span><span class=w> </span><span class=s>&quot;1&quot;</span>
<a id=__codelineno-54-28 name=__codelineno-54-28 href=#__codelineno-54-28></a><span class=w>    </span><span class=nt>onlyApplyOSDPlacement</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<a id=__codelineno-54-29 name=__codelineno-54-29 href=#__codelineno-54-29></a>
<a id=__codelineno-54-30 name=__codelineno-54-30 href=#__codelineno-54-30></a><span class=w>  </span><span class=nt>placement</span><span class=p>:</span>
<a id=__codelineno-54-31 name=__codelineno-54-31 href=#__codelineno-54-31></a><span class=w>    </span><span class=nt>all</span><span class=p>:</span>
<a id=__codelineno-54-32 name=__codelineno-54-32 href=#__codelineno-54-32></a><span class=w>      </span><span class=nt>nodeAffinity</span><span class=p>:</span>
<a id=__codelineno-54-33 name=__codelineno-54-33 href=#__codelineno-54-33></a><span class=w>        </span><span class=nt>requiredDuringSchedulingIgnoredDuringExecution</span><span class=p>:</span>
<a id=__codelineno-54-34 name=__codelineno-54-34 href=#__codelineno-54-34></a><span class=w>          </span><span class=nt>nodeSelectorTerms</span><span class=p>:</span>
<a id=__codelineno-54-35 name=__codelineno-54-35 href=#__codelineno-54-35></a><span class=w>            </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>matchExpressions</span><span class=p>:</span>
<a id=__codelineno-54-36 name=__codelineno-54-36 href=#__codelineno-54-36></a><span class=w>                </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">role</span>
<a id=__codelineno-54-37 name=__codelineno-54-37 href=#__codelineno-54-37></a><span class=w>                  </span><span class=nt>operator</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">In</span>
<a id=__codelineno-54-38 name=__codelineno-54-38 href=#__codelineno-54-38></a><span class=w>                  </span><span class=nt>values</span><span class=p>:</span>
<a id=__codelineno-54-39 name=__codelineno-54-39 href=#__codelineno-54-39></a><span class=w>                    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ceph</span>
<a id=__codelineno-54-40 name=__codelineno-54-40 href=#__codelineno-54-40></a><span class=w>      </span><span class=nt>podAffinity</span><span class=p>:</span>
<a id=__codelineno-54-41 name=__codelineno-54-41 href=#__codelineno-54-41></a><span class=w>      </span><span class=nt>podAntiAffinity</span><span class=p>:</span>
<a id=__codelineno-54-42 name=__codelineno-54-42 href=#__codelineno-54-42></a><span class=w>      </span><span class=nt>topologySpreadConstraints</span><span class=p>:</span>
<a id=__codelineno-54-43 name=__codelineno-54-43 href=#__codelineno-54-43></a><span class=w>      </span><span class=nt>tolerations</span><span class=p>:</span>
<a id=__codelineno-54-44 name=__codelineno-54-44 href=#__codelineno-54-44></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=s>&quot;GiteeFrontendOnly&quot;</span>
<a id=__codelineno-54-45 name=__codelineno-54-45 href=#__codelineno-54-45></a><span class=w>          </span><span class=nt>operator</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Equal&quot;</span>
<a id=__codelineno-54-46 name=__codelineno-54-46 href=#__codelineno-54-46></a><span class=w>          </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s>&quot;yes&quot;</span>
<a id=__codelineno-54-47 name=__codelineno-54-47 href=#__codelineno-54-47></a><span class=w>          </span><span class=nt>effect</span><span class=p>:</span><span class=w> </span><span class=s>&quot;NoSchedule&quot;</span>
<a id=__codelineno-54-48 name=__codelineno-54-48 href=#__codelineno-54-48></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=s>&quot;node-role.kubernetes.io/master&quot;</span>
<a id=__codelineno-54-49 name=__codelineno-54-49 href=#__codelineno-54-49></a><span class=w>          </span><span class=nt>operator</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Exists&quot;</span>
<a id=__codelineno-54-50 name=__codelineno-54-50 href=#__codelineno-54-50></a><span class=w>          </span><span class=nt>effect</span><span class=p>:</span><span class=w> </span><span class=s>&quot;PreferNoSchedule&quot;</span>
</code></pre></div> <p>因为 Ceph 集群的本地存储将使用前面创建的未格式化文件系统的 LVM 逻辑卷，我们创建的逻辑卷的名称为<code>osd</code>，所属的卷组为<code>ceph</code>，逻辑卷的路径为<code>/dev/ceph/osd</code>。</p> <p>Rook 是从 1.9 开始支持使用 LVM 逻辑卷作为本地存储的，具体实现的代码是这个 PR <a href=https://github.com/rook/rook/pull/7967>https://github.com/rook/rook/pull/7967</a>。 文档<a href=https://rook.io/docs/rook/v1.13/CRDs/Cluster/ceph-cluster-crd/ >CephCluster CRD</a>中对如何使用逻辑卷作存储的说明不是特别详细。从 PR 的实现代码上看，当前是要在 CephCluster 的资源定义中的<code>spec.storage.devices[].name</code>配置为<code>/dev/disk/by-id/dm-name-&lt;vgName&gt;-&lt;lvName&gt;</code>。</p> <p>所以我们的 cluster.yaml 配置的<code>spec.storage</code>部分， <code>devices[].name</code>的值是<code>/dev/disk/by-id/dm-name-ceph-osd</code>。</p> <p>创建 Ceph 集群:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-55-1 name=__codelineno-55-1 href=#__codelineno-55-1></a>$<span class=w> </span>kubectl<span class=w> </span>create<span class=w> </span>-f<span class=w> </span>cluster-prod.yaml
<a id=__codelineno-55-2 name=__codelineno-55-2 href=#__codelineno-55-2></a>cephcluster.ceph.rook.io/rook-ceph<span class=w> </span>created
</code></pre></div> <p>通过查看<code>rook-ceph</code>命名空间中的 pod，验证集群是否正在运行。</p> <div class=highlight><pre><span></span><code><a id=__codelineno-56-1 name=__codelineno-56-1 href=#__codelineno-56-1></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>pod
<a id=__codelineno-56-2 name=__codelineno-56-2 href=#__codelineno-56-2></a>NAME<span class=w>                                                              </span>READY<span class=w>   </span>STATUS<span class=w>      </span>RESTARTS<span class=w>       </span>AGE
<a id=__codelineno-56-3 name=__codelineno-56-3 href=#__codelineno-56-3></a>csi-cephfsplugin-8l9t7<span class=w>                                            </span><span class=m>2</span>/2<span class=w>     </span>Running<span class=w>     </span><span class=m>1</span><span class=w> </span><span class=o>(</span>112s<span class=w> </span>ago<span class=o>)</span><span class=w>   </span>2m26s
<a id=__codelineno-56-4 name=__codelineno-56-4 href=#__codelineno-56-4></a>csi-cephfsplugin-provisioner-76bfc9dcd9-42zjb<span class=w>                     </span><span class=m>5</span>/5<span class=w>     </span>Running<span class=w>     </span><span class=m>0</span><span class=w>              </span>15m
<a id=__codelineno-56-5 name=__codelineno-56-5 href=#__codelineno-56-5></a>csi-cephfsplugin-provisioner-76bfc9dcd9-jfpxt<span class=w>                     </span><span class=m>5</span>/5<span class=w>     </span>Running<span class=w>     </span><span class=m>0</span><span class=w>              </span>15m
<a id=__codelineno-56-6 name=__codelineno-56-6 href=#__codelineno-56-6></a>csi-cephfsplugin-vvjb9<span class=w>                                            </span><span class=m>2</span>/2<span class=w>     </span>Running<span class=w>     </span><span class=m>0</span><span class=w>              </span>15m
<a id=__codelineno-56-7 name=__codelineno-56-7 href=#__codelineno-56-7></a>csi-rbdplugin-provisioner-56f7bf6d4d-kr6vq<span class=w>                        </span><span class=m>5</span>/5<span class=w>     </span>Running<span class=w>     </span><span class=m>0</span><span class=w>              </span>15m
<a id=__codelineno-56-8 name=__codelineno-56-8 href=#__codelineno-56-8></a>csi-rbdplugin-provisioner-56f7bf6d4d-wjgcn<span class=w>                        </span><span class=m>5</span>/5<span class=w>     </span>Running<span class=w>     </span><span class=m>0</span><span class=w>              </span>15m
<a id=__codelineno-56-9 name=__codelineno-56-9 href=#__codelineno-56-9></a>csi-rbdplugin-r5qsw<span class=w>                                               </span><span class=m>2</span>/2<span class=w>     </span>Running<span class=w>     </span><span class=m>1</span><span class=w> </span><span class=o>(</span>112s<span class=w> </span>ago<span class=o>)</span><span class=w>   </span>2m26s
<a id=__codelineno-56-10 name=__codelineno-56-10 href=#__codelineno-56-10></a>csi-rbdplugin-slgs2<span class=w>                                               </span><span class=m>2</span>/2<span class=w>     </span>Running<span class=w>     </span><span class=m>0</span><span class=w>              </span>15m
<a id=__codelineno-56-11 name=__codelineno-56-11 href=#__codelineno-56-11></a>rook-ceph-crashcollector-gitee-kubernetes-node09-748dd9c59wpldm<span class=w>   </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>     </span><span class=m>0</span><span class=w>              </span>19h
<a id=__codelineno-56-12 name=__codelineno-56-12 href=#__codelineno-56-12></a>rook-ceph-crashcollector-gitee-kubernetes-node10-765b7b857xxbds<span class=w>   </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>     </span><span class=m>0</span><span class=w>              </span>19h
<a id=__codelineno-56-13 name=__codelineno-56-13 href=#__codelineno-56-13></a>rook-ceph-crashcollector-gitee-kubernetes-node11-6fbb8b47bmrdzs<span class=w>   </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>     </span><span class=m>0</span><span class=w>              </span>19h
<a id=__codelineno-56-14 name=__codelineno-56-14 href=#__codelineno-56-14></a>rook-ceph-exporter-gitee-kubernetes-node09-5d5db7d54f-4hhlj<span class=w>       </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>     </span><span class=m>0</span><span class=w>              </span>19h
<a id=__codelineno-56-15 name=__codelineno-56-15 href=#__codelineno-56-15></a>rook-ceph-exporter-gitee-kubernetes-node10-75c4755979-jsqsd<span class=w>       </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>     </span><span class=m>0</span><span class=w>              </span>19h
<a id=__codelineno-56-16 name=__codelineno-56-16 href=#__codelineno-56-16></a>rook-ceph-exporter-gitee-kubernetes-node11-5f6744dd9b-m7ktj<span class=w>       </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>     </span><span class=m>0</span><span class=w>              </span>19h
<a id=__codelineno-56-17 name=__codelineno-56-17 href=#__codelineno-56-17></a>rook-ceph-mgr-a-587ff77854-t96j8<span class=w>                                  </span><span class=m>2</span>/2<span class=w>     </span>Running<span class=w>     </span><span class=m>0</span><span class=w>              </span>19h
<a id=__codelineno-56-18 name=__codelineno-56-18 href=#__codelineno-56-18></a>rook-ceph-mgr-b-578f895c7b-l2hqd<span class=w>                                  </span><span class=m>2</span>/2<span class=w>     </span>Running<span class=w>     </span><span class=m>0</span><span class=w>              </span>19h
<a id=__codelineno-56-19 name=__codelineno-56-19 href=#__codelineno-56-19></a>rook-ceph-mon-a-84589c6b44-6rlv7<span class=w>                                  </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>     </span><span class=m>0</span><span class=w>              </span>19h
<a id=__codelineno-56-20 name=__codelineno-56-20 href=#__codelineno-56-20></a>rook-ceph-mon-b-664b5fc9cf-9wv82<span class=w>                                  </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>     </span><span class=m>0</span><span class=w>              </span>19h
<a id=__codelineno-56-21 name=__codelineno-56-21 href=#__codelineno-56-21></a>rook-ceph-mon-c-648796588d-x9zkf<span class=w>                                  </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>     </span><span class=m>0</span><span class=w>              </span>19h
<a id=__codelineno-56-22 name=__codelineno-56-22 href=#__codelineno-56-22></a>rook-ceph-operator-5bb7fbf69c-5r2cq<span class=w>                               </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>     </span><span class=m>0</span><span class=w>              </span>20h
<a id=__codelineno-56-23 name=__codelineno-56-23 href=#__codelineno-56-23></a>rook-ceph-osd-0-ddff98578-v2vzr<span class=w>                                   </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>     </span><span class=m>0</span><span class=w>              </span>19h
<a id=__codelineno-56-24 name=__codelineno-56-24 href=#__codelineno-56-24></a>rook-ceph-osd-1-85b7486f99-9x5k6<span class=w>                                  </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>     </span><span class=m>0</span><span class=w>              </span>19h
<a id=__codelineno-56-25 name=__codelineno-56-25 href=#__codelineno-56-25></a>rook-ceph-osd-2-55dbd68f47-9lh95<span class=w>                                  </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>     </span><span class=m>0</span><span class=w>              </span>19h
<a id=__codelineno-56-26 name=__codelineno-56-26 href=#__codelineno-56-26></a>rook-ceph-osd-prepare-gitee-kubernetes-node09-l29rj<span class=w>               </span><span class=m>0</span>/1<span class=w>     </span>Completed<span class=w>   </span><span class=m>0</span><span class=w>              </span>95s
<a id=__codelineno-56-27 name=__codelineno-56-27 href=#__codelineno-56-27></a>rook-ceph-osd-prepare-gitee-kubernetes-node10-js8tx<span class=w>               </span><span class=m>0</span>/1<span class=w>     </span>Completed<span class=w>   </span><span class=m>0</span><span class=w>              </span>98s
<a id=__codelineno-56-28 name=__codelineno-56-28 href=#__codelineno-56-28></a>rook-ceph-osd-prepare-gitee-kubernetes-node11-p92dn<span class=w>               </span><span class=m>0</span>/1<span class=w>     </span>Completed<span class=w>   </span><span class=m>0</span><span class=w>              </span>91s
<a id=__codelineno-56-29 name=__codelineno-56-29 href=#__codelineno-56-29></a>rook-ceph-tools-5996f89559-b4tch<span class=w>                                  </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>     </span><span class=m>0</span><span class=w>              </span>18h
</code></pre></div> <p>osd pod 的数量取决于集群中的节点数量和配置的设备数量。对于上述默认的 cluster.yaml，将为每个节点上找到的每个可用设备创建一个 OSD。</p> <p>创建过程如果遇到问题可以查看<code>rook-ceph-operator</code>的 Pod 的日志。</p> <p>如需重新运行<code>rook-ceph-osd-prepare-&lt;nodename&gt;</code> Job，扫描可用本地存储添加 OSD，可以执行以下命令:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-57-1 name=__codelineno-57-1 href=#__codelineno-57-1></a><span class=c1># 删除旧的job</span>
<a id=__codelineno-57-2 name=__codelineno-57-2 href=#__codelineno-57-2></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>job<span class=w> </span>-n<span class=w> </span>rook-ceph<span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span><span class=s1>&#39;{system(&quot;kubectl delete job &quot;$1&quot; -n rook-ceph&quot;)}&#39;</span>
<a id=__codelineno-57-3 name=__codelineno-57-3 href=#__codelineno-57-3></a><span class=c1># 重启operator</span>
<a id=__codelineno-57-4 name=__codelineno-57-4 href=#__codelineno-57-4></a>$<span class=w> </span>kubectl<span class=w> </span>rollout<span class=w> </span>restart<span class=w> </span>deploy<span class=w> </span>rook-ceph-operator<span class=w>  </span>-n<span class=w> </span>rook-ceph
</code></pre></div> <p>每个节点上的 osd 能否添加成功，要注意查看<code>rook-ceph-osd-prepare-&lt;nodename&gt;</code> Job 对应 Pod 的日志。</p> <h4 id=验证集群状态>验证集群状态<a class=headerlink href=#验证集群状态 title="Permanent link">&para;</a></h4> <p>为了验证集群处于健康状态， 需要<a href=https://rook.io/docs/rook/v1.13/Troubleshooting/ceph-toolbox/ >Rook 工具箱</a>。</p> <div class=highlight><pre><span></span><code><a id=__codelineno-58-1 name=__codelineno-58-1 href=#__codelineno-58-1></a>$<span class=w> </span>kubectl<span class=w> </span>apply<span class=w> </span>-f<span class=w> </span>https://raw.githubusercontent.com/rook/rook/release-1.13/deploy/examples/toolbox.yaml
<a id=__codelineno-58-2 name=__codelineno-58-2 href=#__codelineno-58-2></a>
<a id=__codelineno-58-3 name=__codelineno-58-3 href=#__codelineno-58-3></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>po<span class=w> </span>-n<span class=w> </span>rook-ceph<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>rook-ceph-tools
<a id=__codelineno-58-4 name=__codelineno-58-4 href=#__codelineno-58-4></a>rook-ceph-tools-68b98695bb-gh76t<span class=w>                  </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>     </span><span class=m>0</span><span class=w>             </span>23s
</code></pre></div> <blockquote> <p>注: 当前 release-1.13/deploy/examples/toolbox.yaml 中的 Ceph 镜像还是 v17.2.6，可以手动修改成 v18.2.1 还需加上污点容忍和亲和性</p> </blockquote> <div class=highlight><pre><span></span><code><a id=__codelineno-59-1 name=__codelineno-59-1 href=#__codelineno-59-1></a><span class=w>      </span>nodeSelector:
<a id=__codelineno-59-2 name=__codelineno-59-2 href=#__codelineno-59-2></a><span class=w>        </span>role:<span class=w> </span>ceph
<a id=__codelineno-59-3 name=__codelineno-59-3 href=#__codelineno-59-3></a><span class=w>      </span>tolerations:
<a id=__codelineno-59-4 name=__codelineno-59-4 href=#__codelineno-59-4></a><span class=w>        </span>-<span class=w> </span>key:<span class=w> </span><span class=s2>&quot;node.kubernetes.io/unreachable&quot;</span>
<a id=__codelineno-59-5 name=__codelineno-59-5 href=#__codelineno-59-5></a><span class=w>          </span>operator:<span class=w> </span><span class=s2>&quot;Exists&quot;</span>
<a id=__codelineno-59-6 name=__codelineno-59-6 href=#__codelineno-59-6></a><span class=w>          </span>effect:<span class=w> </span><span class=s2>&quot;NoExecute&quot;</span>
<a id=__codelineno-59-7 name=__codelineno-59-7 href=#__codelineno-59-7></a><span class=w>          </span>tolerationSeconds:<span class=w> </span><span class=m>5</span>
<a id=__codelineno-59-8 name=__codelineno-59-8 href=#__codelineno-59-8></a><span class=w>        </span>-<span class=w> </span>key:<span class=w> </span><span class=s2>&quot;GiteeFrontendOnly&quot;</span>
<a id=__codelineno-59-9 name=__codelineno-59-9 href=#__codelineno-59-9></a><span class=w>          </span>operator:<span class=w> </span><span class=s2>&quot;Equal&quot;</span>
<a id=__codelineno-59-10 name=__codelineno-59-10 href=#__codelineno-59-10></a><span class=w>          </span>value:<span class=w> </span><span class=s2>&quot;yes&quot;</span>
<a id=__codelineno-59-11 name=__codelineno-59-11 href=#__codelineno-59-11></a><span class=w>          </span>effect:<span class=w> </span><span class=s2>&quot;NoSchedule&quot;</span>
</code></pre></div> <p>连接到工具箱，并运行<code>ceph status</code> 命令:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-60-1 name=__codelineno-60-1 href=#__codelineno-60-1></a>$<span class=w> </span>kubectl<span class=w> </span>-n<span class=w> </span>rook-ceph<span class=w> </span><span class=nb>exec</span><span class=w> </span>-it<span class=w> </span>deploy/rook-ceph-tools<span class=w> </span>--<span class=w> </span>bash
<a id=__codelineno-60-2 name=__codelineno-60-2 href=#__codelineno-60-2></a><span class=c1># 或者如下</span>
<a id=__codelineno-60-3 name=__codelineno-60-3 href=#__codelineno-60-3></a>$<span class=w> </span>kubectl<span class=w> </span>-n<span class=w> </span>rook-ceph<span class=w> </span><span class=nb>exec</span><span class=w> </span>-it<span class=w> </span><span class=k>$(</span>kubectl<span class=w> </span>-n<span class=w> </span>rook-ceph<span class=w> </span>get<span class=w> </span>pod<span class=w> </span>-l<span class=w> </span><span class=s2>&quot;app=rook-ceph-tools&quot;</span><span class=w> </span>-o<span class=w> </span><span class=nv>jsonpath</span><span class=o>=</span><span class=s1>&#39;{.items[0].metadata.name}&#39;</span><span class=k>)</span><span class=w> </span>--<span class=w> </span>bash
</code></pre></div> <p>以下是健康状态的验证要点：</p> <ul> <li>所有的 monitor (mon) 节点应该处于 quorum（一致性）状态。</li> <li>一个管理器 (mgr) 节点应该处于活动状态。</li> <li>至少有三个 OSD 节点应该处于上线并可用状态。</li> </ul> <p>如果健康状态不是 <code>HEALTH_OK</code>，则应该调查警告或错误的原因。</p> <div class=highlight><pre><span></span><code><a id=__codelineno-61-1 name=__codelineno-61-1 href=#__codelineno-61-1></a>bash-4.4$<span class=w> </span>ceph<span class=w> </span>status
<a id=__codelineno-61-2 name=__codelineno-61-2 href=#__codelineno-61-2></a><span class=w>  </span>cluster:
<a id=__codelineno-61-3 name=__codelineno-61-3 href=#__codelineno-61-3></a><span class=w>    </span>id:<span class=w>     </span>80acf00a-a7e1-40fe-b6c2-30f546e519bb
<a id=__codelineno-61-4 name=__codelineno-61-4 href=#__codelineno-61-4></a><span class=w>    </span>health:<span class=w> </span>HEALTH_OK
<a id=__codelineno-61-5 name=__codelineno-61-5 href=#__codelineno-61-5></a>
<a id=__codelineno-61-6 name=__codelineno-61-6 href=#__codelineno-61-6></a><span class=w>  </span>services:
<a id=__codelineno-61-7 name=__codelineno-61-7 href=#__codelineno-61-7></a><span class=w>    </span>mon:<span class=w> </span><span class=m>3</span><span class=w> </span>daemons,<span class=w> </span>quorum<span class=w> </span>a,b,c<span class=w> </span><span class=o>(</span>age<span class=w> </span>71m<span class=o>)</span>
<a id=__codelineno-61-8 name=__codelineno-61-8 href=#__codelineno-61-8></a><span class=w>    </span>mgr:<span class=w> </span>a<span class=o>(</span>active,<span class=w> </span>since<span class=w> </span>68m<span class=o>)</span>,<span class=w> </span>standbys:<span class=w> </span>b
<a id=__codelineno-61-9 name=__codelineno-61-9 href=#__codelineno-61-9></a><span class=w>    </span>osd:<span class=w> </span><span class=m>3</span><span class=w> </span>osds:<span class=w> </span><span class=m>3</span><span class=w> </span>up<span class=w> </span><span class=o>(</span>since<span class=w> </span>70m<span class=o>)</span>,<span class=w> </span><span class=m>3</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=o>(</span>since<span class=w> </span>70m<span class=o>)</span>
<a id=__codelineno-61-10 name=__codelineno-61-10 href=#__codelineno-61-10></a>
<a id=__codelineno-61-11 name=__codelineno-61-11 href=#__codelineno-61-11></a><span class=w>  </span>data:
<a id=__codelineno-61-12 name=__codelineno-61-12 href=#__codelineno-61-12></a><span class=w>    </span>pools:<span class=w>   </span><span class=m>1</span><span class=w> </span>pools,<span class=w> </span><span class=m>1</span><span class=w> </span>pgs
<a id=__codelineno-61-13 name=__codelineno-61-13 href=#__codelineno-61-13></a><span class=w>    </span>objects:<span class=w> </span><span class=m>2</span><span class=w> </span>objects,<span class=w> </span><span class=m>449</span><span class=w> </span>KiB
<a id=__codelineno-61-14 name=__codelineno-61-14 href=#__codelineno-61-14></a><span class=w>    </span>usage:<span class=w>   </span><span class=m>80</span><span class=w> </span>MiB<span class=w> </span>used,<span class=w> </span><span class=m>1</span>.5<span class=w> </span>TiB<span class=w> </span>/<span class=w> </span><span class=m>1</span>.5<span class=w> </span>TiB<span class=w> </span>avail
<a id=__codelineno-61-15 name=__codelineno-61-15 href=#__codelineno-61-15></a><span class=w>    </span>pgs:<span class=w>     </span><span class=m>1</span><span class=w> </span>active+clean
<a id=__codelineno-61-16 name=__codelineno-61-16 href=#__codelineno-61-16></a>
<a id=__codelineno-61-17 name=__codelineno-61-17 href=#__codelineno-61-17></a>bash-4.4$<span class=w> </span>ceph<span class=w> </span>osd<span class=w> </span>status
<a id=__codelineno-61-18 name=__codelineno-61-18 href=#__codelineno-61-18></a>ID<span class=w>  </span>HOST<span class=w>                      </span>USED<span class=w>  </span>AVAIL<span class=w>  </span>WR<span class=w> </span>OPS<span class=w>  </span>WR<span class=w> </span>DATA<span class=w>  </span>RD<span class=w> </span>OPS<span class=w>  </span>RD<span class=w> </span>DATA<span class=w>  </span>STATE
<a id=__codelineno-61-19 name=__codelineno-61-19 href=#__codelineno-61-19></a><span class=w> </span><span class=m>0</span><span class=w>  </span>gitee-kubernetes-node10<span class=w>  </span><span class=m>26</span>.7M<span class=w>   </span>499G<span class=w>      </span><span class=m>0</span><span class=w>        </span><span class=m>0</span><span class=w>       </span><span class=m>0</span><span class=w>        </span><span class=m>0</span><span class=w>   </span>exists,up
<a id=__codelineno-61-20 name=__codelineno-61-20 href=#__codelineno-61-20></a><span class=w> </span><span class=m>1</span><span class=w>  </span>gitee-kubernetes-node09<span class=w>  </span><span class=m>26</span>.7M<span class=w>   </span>499G<span class=w>      </span><span class=m>0</span><span class=w>        </span><span class=m>0</span><span class=w>       </span><span class=m>0</span><span class=w>        </span><span class=m>0</span><span class=w>   </span>exists,up
<a id=__codelineno-61-21 name=__codelineno-61-21 href=#__codelineno-61-21></a><span class=w> </span><span class=m>2</span><span class=w>  </span>gitee-kubernetes-node11<span class=w>  </span><span class=m>26</span>.7M<span class=w>   </span>499G<span class=w>      </span><span class=m>0</span><span class=w>        </span><span class=m>0</span><span class=w>       </span><span class=m>0</span><span class=w>        </span><span class=m>0</span><span class=w>   </span>exists,up
<a id=__codelineno-61-22 name=__codelineno-61-22 href=#__codelineno-61-22></a>
<a id=__codelineno-61-23 name=__codelineno-61-23 href=#__codelineno-61-23></a>bash-4.4$<span class=w> </span>ceph<span class=w> </span>df
<a id=__codelineno-61-24 name=__codelineno-61-24 href=#__codelineno-61-24></a>---<span class=w> </span>RAW<span class=w> </span>STORAGE<span class=w> </span>---
<a id=__codelineno-61-25 name=__codelineno-61-25 href=#__codelineno-61-25></a>CLASS<span class=w>     </span>SIZE<span class=w>    </span>AVAIL<span class=w>    </span>USED<span class=w>  </span>RAW<span class=w> </span>USED<span class=w>  </span>%RAW<span class=w> </span>USED
<a id=__codelineno-61-26 name=__codelineno-61-26 href=#__codelineno-61-26></a>hdd<span class=w>    </span><span class=m>1</span>.5<span class=w> </span>TiB<span class=w>  </span><span class=m>1</span>.5<span class=w> </span>TiB<span class=w>  </span><span class=m>80</span><span class=w> </span>MiB<span class=w>    </span><span class=m>80</span><span class=w> </span>MiB<span class=w>          </span><span class=m>0</span>
<a id=__codelineno-61-27 name=__codelineno-61-27 href=#__codelineno-61-27></a>TOTAL<span class=w>  </span><span class=m>1</span>.5<span class=w> </span>TiB<span class=w>  </span><span class=m>1</span>.5<span class=w> </span>TiB<span class=w>  </span><span class=m>80</span><span class=w> </span>MiB<span class=w>    </span><span class=m>80</span><span class=w> </span>MiB<span class=w>          </span><span class=m>0</span>
<a id=__codelineno-61-28 name=__codelineno-61-28 href=#__codelineno-61-28></a>
<a id=__codelineno-61-29 name=__codelineno-61-29 href=#__codelineno-61-29></a>---<span class=w> </span>POOLS<span class=w> </span>---
<a id=__codelineno-61-30 name=__codelineno-61-30 href=#__codelineno-61-30></a>POOL<span class=w>  </span>ID<span class=w>  </span>PGS<span class=w>   </span>STORED<span class=w>  </span>OBJECTS<span class=w>     </span>USED<span class=w>  </span>%USED<span class=w>  </span>MAX<span class=w> </span>AVAIL
<a id=__codelineno-61-31 name=__codelineno-61-31 href=#__codelineno-61-31></a>.mgr<span class=w>   </span><span class=m>1</span><span class=w>    </span><span class=m>1</span><span class=w>  </span><span class=m>449</span><span class=w> </span>KiB<span class=w>        </span><span class=m>2</span><span class=w>  </span><span class=m>1</span>.3<span class=w> </span>MiB<span class=w>      </span><span class=m>0</span><span class=w>    </span><span class=m>475</span><span class=w> </span>GiB
<a id=__codelineno-61-32 name=__codelineno-61-32 href=#__codelineno-61-32></a>
<a id=__codelineno-61-33 name=__codelineno-61-33 href=#__codelineno-61-33></a>
<a id=__codelineno-61-34 name=__codelineno-61-34 href=#__codelineno-61-34></a>bash-4.4$<span class=w> </span>ceph<span class=w> </span>osd<span class=w> </span>tree
<a id=__codelineno-61-35 name=__codelineno-61-35 href=#__codelineno-61-35></a>ID<span class=w>  </span>CLASS<span class=w>  </span>WEIGHT<span class=w>   </span>TYPE<span class=w> </span>NAME<span class=w>                         </span>STATUS<span class=w>  </span>REWEIGHT<span class=w>  </span>PRI-AFF
<a id=__codelineno-61-36 name=__codelineno-61-36 href=#__codelineno-61-36></a>-1<span class=w>         </span><span class=m>1</span>.46489<span class=w>  </span>root<span class=w> </span>default
<a id=__codelineno-61-37 name=__codelineno-61-37 href=#__codelineno-61-37></a>-5<span class=w>         </span><span class=m>0</span>.48830<span class=w>      </span>host<span class=w> </span>gitee-kubernetes-node09
<a id=__codelineno-61-38 name=__codelineno-61-38 href=#__codelineno-61-38></a><span class=w> </span><span class=m>1</span><span class=w>    </span>hdd<span class=w>  </span><span class=m>0</span>.48830<span class=w>          </span>osd.1<span class=w>                         </span>up<span class=w>   </span><span class=m>1</span>.00000<span class=w>  </span><span class=m>1</span>.00000
<a id=__codelineno-61-39 name=__codelineno-61-39 href=#__codelineno-61-39></a>-3<span class=w>         </span><span class=m>0</span>.48830<span class=w>      </span>host<span class=w> </span>gitee-kubernetes-node10
<a id=__codelineno-61-40 name=__codelineno-61-40 href=#__codelineno-61-40></a><span class=w> </span><span class=m>0</span><span class=w>    </span>hdd<span class=w>  </span><span class=m>0</span>.48830<span class=w>          </span>osd.0<span class=w>                         </span>up<span class=w>   </span><span class=m>1</span>.00000<span class=w>  </span><span class=m>1</span>.00000
<a id=__codelineno-61-41 name=__codelineno-61-41 href=#__codelineno-61-41></a>-7<span class=w>         </span><span class=m>0</span>.48830<span class=w>      </span>host<span class=w> </span>gitee-kubernetes-node11
<a id=__codelineno-61-42 name=__codelineno-61-42 href=#__codelineno-61-42></a><span class=w> </span><span class=m>2</span><span class=w>    </span>hdd<span class=w>  </span><span class=m>0</span>.48830<span class=w>          </span>osd.2<span class=w>                         </span>up<span class=w>   </span><span class=m>1</span>.00000<span class=w>  </span><span class=m>1</span>.00000
<a id=__codelineno-61-43 name=__codelineno-61-43 href=#__codelineno-61-43></a>
<a id=__codelineno-61-44 name=__codelineno-61-44 href=#__codelineno-61-44></a>bash-4.4$<span class=w> </span>rados<span class=w> </span>df
<a id=__codelineno-61-45 name=__codelineno-61-45 href=#__codelineno-61-45></a>POOL_NAME<span class=w>       </span>USED<span class=w>  </span>OBJECTS<span class=w>  </span>CLONES<span class=w>  </span>COPIES<span class=w>  </span>MISSING_ON_PRIMARY<span class=w>  </span>UNFOUND<span class=w>  </span>DEGRADED<span class=w>  </span>RD_OPS<span class=w>       </span>RD<span class=w>  </span>WR_OPS<span class=w>       </span>WR<span class=w>  </span>USED<span class=w> </span>COMPR<span class=w>  </span>UNDER<span class=w> </span>COMPR
<a id=__codelineno-61-46 name=__codelineno-61-46 href=#__codelineno-61-46></a>.mgr<span class=w>         </span><span class=m>1</span>.3<span class=w> </span>MiB<span class=w>        </span><span class=m>2</span><span class=w>       </span><span class=m>0</span><span class=w>       </span><span class=m>6</span><span class=w>                   </span><span class=m>0</span><span class=w>        </span><span class=m>0</span><span class=w>         </span><span class=m>0</span><span class=w>     </span><span class=m>192</span><span class=w>  </span><span class=m>288</span><span class=w> </span>KiB<span class=w>     </span><span class=m>133</span><span class=w>  </span><span class=m>1</span>.3<span class=w> </span>MiB<span class=w>         </span><span class=m>0</span><span class=w> </span>B<span class=w>          </span><span class=m>0</span><span class=w> </span>B
<a id=__codelineno-61-47 name=__codelineno-61-47 href=#__codelineno-61-47></a>replicapool<span class=w>   </span><span class=m>12</span><span class=w> </span>KiB<span class=w>        </span><span class=m>1</span><span class=w>       </span><span class=m>0</span><span class=w>       </span><span class=m>3</span><span class=w>                   </span><span class=m>0</span><span class=w>        </span><span class=m>0</span><span class=w>         </span><span class=m>0</span><span class=w>       </span><span class=m>0</span><span class=w>      </span><span class=m>0</span><span class=w> </span>B<span class=w>       </span><span class=m>0</span><span class=w>      </span><span class=m>0</span><span class=w> </span>B<span class=w>         </span><span class=m>0</span><span class=w> </span>B<span class=w>          </span><span class=m>0</span><span class=w> </span>B
<a id=__codelineno-61-48 name=__codelineno-61-48 href=#__codelineno-61-48></a>
<a id=__codelineno-61-49 name=__codelineno-61-49 href=#__codelineno-61-49></a>total_objects<span class=w>    </span><span class=m>3</span>
<a id=__codelineno-61-50 name=__codelineno-61-50 href=#__codelineno-61-50></a>total_used<span class=w>       </span><span class=m>81</span><span class=w> </span>MiB
<a id=__codelineno-61-51 name=__codelineno-61-51 href=#__codelineno-61-51></a>total_avail<span class=w>      </span><span class=m>1</span>.5<span class=w> </span>TiB
<a id=__codelineno-61-52 name=__codelineno-61-52 href=#__codelineno-61-52></a>total_space<span class=w>      </span><span class=m>1</span>.5<span class=w> </span>TiB
</code></pre></div> <p>从输出可以看出集群状态一切正常，集群中部署了 3 个 mon, 2 个 mgr, 3 个 osd。</p> <p>查看一下当前集群中的存储池:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-62-1 name=__codelineno-62-1 href=#__codelineno-62-1></a>bash-4.4$<span class=w> </span>ceph<span class=w> </span>osd<span class=w> </span>lspools
<a id=__codelineno-62-2 name=__codelineno-62-2 href=#__codelineno-62-2></a><span class=m>1</span><span class=w> </span>.mgr
</code></pre></div> <p>可以看到当前集群中只有一个名称为<code>.mgr</code>的存储池。这表示在这个 Ceph 集群中只创建了默认的管理池（mgr pool），这是一个特殊的池，用于存储管理和监控相关的数据。</p> <p>工具箱相关查询命令</p> <div class=highlight><pre><span></span><code><a id=__codelineno-63-1 name=__codelineno-63-1 href=#__codelineno-63-1></a>ceph status
<a id=__codelineno-63-2 name=__codelineno-63-2 href=#__codelineno-63-2></a>ceph osd status
<a id=__codelineno-63-3 name=__codelineno-63-3 href=#__codelineno-63-3></a>ceph df
<a id=__codelineno-63-4 name=__codelineno-63-4 href=#__codelineno-63-4></a>rados df
<a id=__codelineno-63-5 name=__codelineno-63-5 href=#__codelineno-63-5></a>ceph osd lspools
</code></pre></div> <h4 id=ceph-dashboard>Ceph Dashboard<a class=headerlink href=#ceph-dashboard title="Permanent link">&para;</a></h4> <p>通过使用 Ceph Dashboard 可以查看集群的状态。使用 Rook 部署的 Ceph 集群已经默认启用了 Ceph Dashboard。</p> <p><img alt src=https://blog.frognew.com/images/2023/09/ceph-v18-dashboard.png></p> <p><code>rook-ceph-mgr-dashboard</code>是其在 Kubernetes 集群中的 Service:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-64-1 name=__codelineno-64-1 href=#__codelineno-64-1></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>svc<span class=w> </span>rook-ceph-mgr-dashboard<span class=w> </span>-n<span class=w> </span>rook-ceph
<a id=__codelineno-64-2 name=__codelineno-64-2 href=#__codelineno-64-2></a>NAME<span class=w>                      </span>TYPE<span class=w>        </span>CLUSTER-IP<span class=w>      </span>EXTERNAL-IP<span class=w>   </span>PORT<span class=o>(</span>S<span class=o>)</span><span class=w>    </span>AGE
<a id=__codelineno-64-3 name=__codelineno-64-3 href=#__codelineno-64-3></a>rook-ceph-mgr-dashboard<span class=w>   </span>ClusterIP<span class=w>   </span><span class=m>10</span>.100.133.87<span class=w>   </span>&lt;none&gt;<span class=w>        </span><span class=m>7000</span>/TCP<span class=w>   </span>73m
</code></pre></div> <p>可通过 Ingress 或创建一个 NodePort 的 Service <a href=https://github.com/rook/rook/blob/master/deploy/examples/dashboard-external-http.yaml>dashboard-external-http</a>将其暴露的 Kubernetes 集群外部。</p> <div class=highlight><pre><span></span><code><a id=__codelineno-65-1 name=__codelineno-65-1 href=#__codelineno-65-1></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>svc<span class=w>  </span>-n<span class=w> </span>rook-ceph
<a id=__codelineno-65-2 name=__codelineno-65-2 href=#__codelineno-65-2></a>NAME<span class=w>                                    </span>TYPE<span class=w>        </span>CLUSTER-IP<span class=w>       </span>EXTERNAL-IP<span class=w>   </span>PORT<span class=o>(</span>S<span class=o>)</span><span class=w>             </span>AGE
<a id=__codelineno-65-3 name=__codelineno-65-3 href=#__codelineno-65-3></a>rook-ceph-exporter<span class=w>                      </span>ClusterIP<span class=w>   </span><span class=m>10</span>.100.135.90<span class=w>    </span>&lt;none&gt;<span class=w>        </span><span class=m>9926</span>/TCP<span class=w>            </span>75m
<a id=__codelineno-65-4 name=__codelineno-65-4 href=#__codelineno-65-4></a>rook-ceph-mgr<span class=w>                           </span>ClusterIP<span class=w>   </span><span class=m>10</span>.100.15.109<span class=w>    </span>&lt;none&gt;<span class=w>        </span><span class=m>9283</span>/TCP<span class=w>            </span>75m
<a id=__codelineno-65-5 name=__codelineno-65-5 href=#__codelineno-65-5></a>rook-ceph-mgr-dashboard<span class=w>                 </span>ClusterIP<span class=w>   </span><span class=m>10</span>.100.133.87<span class=w>    </span>&lt;none&gt;<span class=w>        </span><span class=m>7000</span>/TCP<span class=w>            </span>75m
<a id=__codelineno-65-6 name=__codelineno-65-6 href=#__codelineno-65-6></a>rook-ceph-mgr-dashboard-external-http<span class=w>   </span>NodePort<span class=w>    </span><span class=m>10</span>.100.213.184<span class=w>   </span>&lt;none&gt;<span class=w>        </span><span class=m>7000</span>:32396/TCP<span class=w>      </span>33s
<a id=__codelineno-65-7 name=__codelineno-65-7 href=#__codelineno-65-7></a>rook-ceph-mon-a<span class=w>                         </span>ClusterIP<span class=w>   </span><span class=m>10</span>.100.29.79<span class=w>     </span>&lt;none&gt;<span class=w>        </span><span class=m>6789</span>/TCP,3300/TCP<span class=w>   </span>76m
<a id=__codelineno-65-8 name=__codelineno-65-8 href=#__codelineno-65-8></a>rook-ceph-mon-b<span class=w>                         </span>ClusterIP<span class=w>   </span><span class=m>10</span>.100.73.21<span class=w>     </span>&lt;none&gt;<span class=w>        </span><span class=m>6789</span>/TCP,3300/TCP<span class=w>   </span>75m
<a id=__codelineno-65-9 name=__codelineno-65-9 href=#__codelineno-65-9></a>rook-ceph-mon-c<span class=w>                         </span>ClusterIP<span class=w>   </span><span class=m>10</span>.100.159.142<span class=w>   </span>&lt;none&gt;<span class=w>        </span><span class=m>6789</span>/TCP,3300/TCP<span class=w>   </span>75m
</code></pre></div> <p>Ceph Dashboard admin 用户的命名可以通过下面的命令查看:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-66-1 name=__codelineno-66-1 href=#__codelineno-66-1></a>$<span class=w> </span>kubectl<span class=w> </span>-n<span class=w> </span>rook-ceph<span class=w> </span>get<span class=w> </span>secret<span class=w> </span>rook-ceph-dashboard-password<span class=w> </span>-o<span class=w> </span><span class=nv>jsonpath</span><span class=o>=</span><span class=s2>&quot;{[&#39;data&#39;][&#39;password&#39;]}&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>base64<span class=w> </span>--decode<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nb>echo</span>
</code></pre></div> <h3 id=94-使用存储-服务持久化>9.4 使用存储-服务持久化<a class=headerlink href=#94-使用存储-服务持久化 title="Permanent link">&para;</a></h3> <p>Ceph 提供三种类型的存储接口: 块存储（Block）、共享文件系统（Shared Filesystem）、对象存储（Object）。</p> <p>下面演示对于使用 Rook 部署和管理的 Ceph 集群，如何使用这三种存储。</p> <p>通过 Rook 使用 Ceph 提供的三种存储类型以及它们的用途如下:</p> <ul> <li>块存储（Block）适用于为单个 Pod 提供读写一致性（RWO）的存储</li> <li>CephFS 共享文件系统（Shared Filesystem）适用于多个 Pod 之间共享读写（RWX）的存储</li> <li>对象存储（Object）提供了一个可通过内部或外部的 Kubernetes 集群的 S3 端点访问的存储</li> </ul> <p><img alt=image class=zoom src=https://cdn.jsdelivr.net/gh/hujianli94/picx-images-hosting@master/image.7zq5xow547.webp></p> <h4 id=941-块存储block>9.4.1 块存储（Block）<a class=headerlink href=#941-块存储block title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><a id=__codelineno-67-1 name=__codelineno-67-1 href=#__codelineno-67-1></a>块存储是一种数据存储技术，它以块为单位将数据写入磁盘或其他存储介质中。块存储通常被用于服务器、数据中心和云计算等环境中，以存储大规模数据集。
<a id=__codelineno-67-2 name=__codelineno-67-2 href=#__codelineno-67-2></a>
<a id=__codelineno-67-3 name=__codelineno-67-3 href=#__codelineno-67-3></a>块存储系统通常由一个或多个块存储设备组成，这些设备可以是磁盘、固态硬盘<span class=w> </span><span class=o>(</span>SSD<span class=o>)</span><span class=w> </span>或其他存储介质。块存储设备通常具有高速读写能力和高可靠性。每个块存储设备都有一个控制器，负责管理块设备的读写操作，并将数据块复制到多个设备上以提高容错性和数据冗余性。
<a id=__codelineno-67-4 name=__codelineno-67-4 href=#__codelineno-67-4></a>
<a id=__codelineno-67-5 name=__codelineno-67-5 href=#__codelineno-67-5></a>块存储的主要优点是高速读写能力、高可靠性和数据冗余性。块存储设备可以快速地读取和写入数据，并且可以自动处理数据的复制、备份和恢复等操作。此外，块存储设备还具有高度的容错性和可靠性，因为它们可以将数据复制到多个设备上，并在其中一个设备失败时自动切换到其他设备上。
<a id=__codelineno-67-6 name=__codelineno-67-6 href=#__codelineno-67-6></a>
<a id=__codelineno-67-7 name=__codelineno-67-7 href=#__codelineno-67-7></a>块存储系统通常被用于存储大规模数据集，如数据库、文件系统、云计算平台等。它们也被用于存储关键数据，如服务器操作系统、应用程序和数据仓库等。
<a id=__codelineno-67-8 name=__codelineno-67-8 href=#__codelineno-67-8></a>
<a id=__codelineno-67-9 name=__codelineno-67-9 href=#__codelineno-67-9></a><span class=m>1</span>：阿里云：EBS
<a id=__codelineno-67-10 name=__codelineno-67-10 href=#__codelineno-67-10></a><span class=m>2</span>：腾讯云：CBS
<a id=__codelineno-67-11 name=__codelineno-67-11 href=#__codelineno-67-11></a><span class=m>3</span>：Ceph：RBD
<a id=__codelineno-67-12 name=__codelineno-67-12 href=#__codelineno-67-12></a>......
<a id=__codelineno-67-13 name=__codelineno-67-13 href=#__codelineno-67-13></a>
<a id=__codelineno-67-14 name=__codelineno-67-14 href=#__codelineno-67-14></a>相信大家也都用过云盘，那么云盘可以做什么，当然我们的RBD也就可以做什么，比如快照备份，增量备份，内核驱动等，都是可以支持到的
</code></pre></div> <p><strong>块存储允许单个 Pod 挂载存储。</strong></p> <p>本指南介绍了如何使用 Rook 启用的持久卷，在 Kubernetes 上创建一个简单的多层 Web 应用程序。</p> <h5 id=9411-rbd-存储供给>9.4.1.1 RBD 存储供给<a class=headerlink href=#9411-rbd-存储供给 title="Permanent link">&para;</a></h5> <p>在 Rook 可以提供存储之前，需要创建 StorageClass 和 CephBlockPool CR。这将使 Kubernetes 在提供持久卷时与 Rook 进行交互操作。</p> <blockquote> <p>这个示例需要每个节点至少有 1 个 OSD，并且每个 OSD 需要位于 3 个不同的节点上。每个 OSD 必须位于不同的节点上，因为 <code>failureDomain</code> 被设置为 <code>host</code>，并且 <code>replicated.size</code> 被设置为 3。</p> </blockquote> <p>直接使用</p> <p><code>rook/deploy/examples/csi/rbd/storageclass.yaml</code>文件创建 CephBlockPool 存储池和 StorageClass 动态存储卷。</p> <p>或者创建下面的<code>storageclass.yaml</code>文件:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-68-1 name=__codelineno-68-1 href=#__codelineno-68-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ceph.rook.io/v1</span>
<a id=__codelineno-68-2 name=__codelineno-68-2 href=#__codelineno-68-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">CephBlockPool</span>
<a id=__codelineno-68-3 name=__codelineno-68-3 href=#__codelineno-68-3></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-68-4 name=__codelineno-68-4 href=#__codelineno-68-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">replicapool</span>
<a id=__codelineno-68-5 name=__codelineno-68-5 href=#__codelineno-68-5></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rook-ceph</span>
<a id=__codelineno-68-6 name=__codelineno-68-6 href=#__codelineno-68-6></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-68-7 name=__codelineno-68-7 href=#__codelineno-68-7></a><span class=w>  </span><span class=nt>failureDomain</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">host</span>
<a id=__codelineno-68-8 name=__codelineno-68-8 href=#__codelineno-68-8></a><span class=w>  </span><span class=nt>replicated</span><span class=p>:</span>
<a id=__codelineno-68-9 name=__codelineno-68-9 href=#__codelineno-68-9></a><span class=w>    </span><span class=nt>size</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<a id=__codelineno-68-10 name=__codelineno-68-10 href=#__codelineno-68-10></a><span class=nn>---</span>
<a id=__codelineno-68-11 name=__codelineno-68-11 href=#__codelineno-68-11></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">storage.k8s.io/v1</span>
<a id=__codelineno-68-12 name=__codelineno-68-12 href=#__codelineno-68-12></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">StorageClass</span>
<a id=__codelineno-68-13 name=__codelineno-68-13 href=#__codelineno-68-13></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-68-14 name=__codelineno-68-14 href=#__codelineno-68-14></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rook-ceph-block</span>
<a id=__codelineno-68-15 name=__codelineno-68-15 href=#__codelineno-68-15></a><span class=c1># Change &quot;rook-ceph&quot; provisioner prefix to match the operator namespace if needed</span>
<a id=__codelineno-68-16 name=__codelineno-68-16 href=#__codelineno-68-16></a><span class=nt>provisioner</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rook-ceph.rbd.csi.ceph.com</span>
<a id=__codelineno-68-17 name=__codelineno-68-17 href=#__codelineno-68-17></a><span class=nt>parameters</span><span class=p>:</span>
<a id=__codelineno-68-18 name=__codelineno-68-18 href=#__codelineno-68-18></a><span class=w>  </span><span class=c1># clusterID is the namespace where the rook cluster is running</span>
<a id=__codelineno-68-19 name=__codelineno-68-19 href=#__codelineno-68-19></a><span class=w>  </span><span class=nt>clusterID</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rook-ceph</span>
<a id=__codelineno-68-20 name=__codelineno-68-20 href=#__codelineno-68-20></a><span class=w>  </span><span class=c1># Ceph pool into which the RBD image shall be created</span>
<a id=__codelineno-68-21 name=__codelineno-68-21 href=#__codelineno-68-21></a><span class=w>  </span><span class=nt>pool</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">replicapool</span>
<a id=__codelineno-68-22 name=__codelineno-68-22 href=#__codelineno-68-22></a>
<a id=__codelineno-68-23 name=__codelineno-68-23 href=#__codelineno-68-23></a><span class=w>  </span><span class=nt>imageFormat</span><span class=p>:</span><span class=w> </span><span class=s>&quot;2&quot;</span>
<a id=__codelineno-68-24 name=__codelineno-68-24 href=#__codelineno-68-24></a><span class=w>  </span><span class=nt>imageFeatures</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">layering</span>
<a id=__codelineno-68-25 name=__codelineno-68-25 href=#__codelineno-68-25></a>
<a id=__codelineno-68-26 name=__codelineno-68-26 href=#__codelineno-68-26></a><span class=w>  </span><span class=nt>csi.storage.k8s.io/provisioner-secret-name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rook-csi-rbd-provisioner</span>
<a id=__codelineno-68-27 name=__codelineno-68-27 href=#__codelineno-68-27></a><span class=w>  </span><span class=nt>csi.storage.k8s.io/provisioner-secret-namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rook-ceph</span>
<a id=__codelineno-68-28 name=__codelineno-68-28 href=#__codelineno-68-28></a><span class=w>  </span><span class=nt>csi.storage.k8s.io/controller-expand-secret-name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rook-csi-rbd-provisioner</span>
<a id=__codelineno-68-29 name=__codelineno-68-29 href=#__codelineno-68-29></a><span class=w>  </span><span class=nt>csi.storage.k8s.io/controller-expand-secret-namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rook-ceph</span>
<a id=__codelineno-68-30 name=__codelineno-68-30 href=#__codelineno-68-30></a><span class=w>  </span><span class=nt>csi.storage.k8s.io/node-stage-secret-name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rook-csi-rbd-node</span>
<a id=__codelineno-68-31 name=__codelineno-68-31 href=#__codelineno-68-31></a><span class=w>  </span><span class=nt>csi.storage.k8s.io/node-stage-secret-namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rook-ceph</span>
<a id=__codelineno-68-32 name=__codelineno-68-32 href=#__codelineno-68-32></a><span class=w>  </span><span class=nt>csi.storage.k8s.io/fstype</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ext4</span>
<a id=__codelineno-68-33 name=__codelineno-68-33 href=#__codelineno-68-33></a>
<a id=__codelineno-68-34 name=__codelineno-68-34 href=#__codelineno-68-34></a><span class=nt>reclaimPolicy</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Delete</span>
<a id=__codelineno-68-35 name=__codelineno-68-35 href=#__codelineno-68-35></a>
<a id=__codelineno-68-36 name=__codelineno-68-36 href=#__codelineno-68-36></a><span class=nt>allowVolumeExpansion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div> <p>这个 storageclass.yaml 文件中包含了 StorageClass <code>rook-ceph-block</code>和 CephBlockPool <code>replicapool</code>的定义。</p> <p>如果你在一个名为"rook-ceph"以外的命名空间中部署了 Rook Operator，请将该文件中的<code>provisioner</code>中的前缀更改为与你使用的命名空间匹配。例如，如果 Rook Operator 在命名空间"my-namespace"中运行，则 provisioner 的值应为<code>my-namespace.rbd.csi.ceph.com</code>。</p> <p>接下来创建这个 StorageClass 和 CephBlockPool:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-69-1 name=__codelineno-69-1 href=#__codelineno-69-1></a>$<span class=w> </span>kubectl<span class=w> </span>apply<span class=w> </span>-f<span class=w> </span>storageclass.yaml
<a id=__codelineno-69-2 name=__codelineno-69-2 href=#__codelineno-69-2></a>cephblockpool.ceph.rook.io/replicapool<span class=w> </span>created
<a id=__codelineno-69-3 name=__codelineno-69-3 href=#__codelineno-69-3></a>storageclass.storage.k8s.io/rook-ceph-block<span class=w> </span>created
</code></pre></div> <blockquote> <p>根据 Kubernetes 的规定，在使用"Retain"回收策略时，任何由 PersistentVolume 支持的 Ceph RBD 镜像将在 PersistentVolume 被删除后继续存在。这些 Ceph RBD 镜像需要使用<code>rbd rm</code>命令手动清理。</p> </blockquote> <p>上面在创建名称为<code>replicapool</code>的 CephBlockPool 资源时，会自动在 Ceph 集群中创建名称为<code>replicapool</code>的存储池。</p> <p>这个操作是由 Ceph Operator 完成的，如果查看发现没有创建这个存储池，可以通过查看 Ceph Operator 的日志进行问题定位。</p> <div class=highlight><pre><span></span><code><a id=__codelineno-70-1 name=__codelineno-70-1 href=#__codelineno-70-1></a>$<span class=w> </span>kubectl<span class=w> </span>-n<span class=w> </span>rook-ceph<span class=w> </span><span class=nb>exec</span><span class=w> </span>-it<span class=w> </span>deploy/rook-ceph-tools<span class=w> </span>--<span class=w> </span>bash
<a id=__codelineno-70-2 name=__codelineno-70-2 href=#__codelineno-70-2></a>bash-4.4$<span class=w> </span>ceph<span class=w> </span>osd<span class=w> </span>lspools
<a id=__codelineno-70-3 name=__codelineno-70-3 href=#__codelineno-70-3></a><span class=m>1</span><span class=w> </span>.mgr
<a id=__codelineno-70-4 name=__codelineno-70-4 href=#__codelineno-70-4></a><span class=m>2</span><span class=w> </span>replicapool
</code></pre></div> <p>上面命令的输出说明已经创建了存储池<code>replicapool</code>。</p> <p>将 Ceph 设置为默认存储卷</p> <div class=highlight><pre><span></span><code><a id=__codelineno-71-1 name=__codelineno-71-1 href=#__codelineno-71-1></a><span class=o>[</span>root@k8s-master1<span class=w> </span>~<span class=o>]</span><span class=c1># kubectl patch storageclass rook-ceph-block -p &#39;{&quot;metadata&quot;: {&quot;annotations&quot;:{&quot;storageclass.kubernetes.io/is-default-class&quot;:&quot;true&quot;}}}&#39;</span>
</code></pre></div> <p>修改完成后再查看 StorageClass 状态（<strong>有个 default 标识</strong>）</p> <div class=highlight><pre><span></span><code><a id=__codelineno-72-1 name=__codelineno-72-1 href=#__codelineno-72-1></a>$ kubectl get sc
<a id=__codelineno-72-2 name=__codelineno-72-2 href=#__codelineno-72-2></a>NAME                        PROVISIONER                  RECLAIMPOLICY   VOLUMEBINDINGMODE   ALLOWVOLUMEEXPANSION   AGE
<a id=__codelineno-72-3 name=__codelineno-72-3 href=#__codelineno-72-3></a>rook-ceph-block (default)   rook-ceph.rbd.csi.ceph.com   Delete          Immediate           true                   2m5s
</code></pre></div> <h5 id=9412-使用存储>9.4.1.2 使用存储<a class=headerlink href=#9412-使用存储 title="Permanent link">&para;</a></h5> <p><code>rook/deploy/examples/csi/rbd/pvc.yaml</code></p> <div class=highlight><pre><span></span><code><a id=__codelineno-73-1 name=__codelineno-73-1 href=#__codelineno-73-1></a>---
<a id=__codelineno-73-2 name=__codelineno-73-2 href=#__codelineno-73-2></a>apiVersion: v1
<a id=__codelineno-73-3 name=__codelineno-73-3 href=#__codelineno-73-3></a>kind: PersistentVolumeClaim
<a id=__codelineno-73-4 name=__codelineno-73-4 href=#__codelineno-73-4></a>metadata:
<a id=__codelineno-73-5 name=__codelineno-73-5 href=#__codelineno-73-5></a>  name: rbd-pvc
<a id=__codelineno-73-6 name=__codelineno-73-6 href=#__codelineno-73-6></a>spec:
<a id=__codelineno-73-7 name=__codelineno-73-7 href=#__codelineno-73-7></a>  accessModes:
<a id=__codelineno-73-8 name=__codelineno-73-8 href=#__codelineno-73-8></a>    - ReadWriteOnce
<a id=__codelineno-73-9 name=__codelineno-73-9 href=#__codelineno-73-9></a>  resources:
<a id=__codelineno-73-10 name=__codelineno-73-10 href=#__codelineno-73-10></a>    requests:
<a id=__codelineno-73-11 name=__codelineno-73-11 href=#__codelineno-73-11></a>      storage: 1Gi
<a id=__codelineno-73-12 name=__codelineno-73-12 href=#__codelineno-73-12></a>  storageClassName: rook-ceph-block
</code></pre></div> <p>通过运行以下命令来查看 Kubernetes 的 PVC(卷声明)：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-74-1 name=__codelineno-74-1 href=#__codelineno-74-1></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>pvc
<a id=__codelineno-74-2 name=__codelineno-74-2 href=#__codelineno-74-2></a>NAME<span class=w>      </span>STATUS<span class=w>   </span>VOLUME<span class=w>                                     </span>CAPACITY<span class=w>   </span>ACCESS<span class=w> </span>MODES<span class=w>   </span>STORAGECLASS<span class=w>      </span>AGE
<a id=__codelineno-74-3 name=__codelineno-74-3 href=#__codelineno-74-3></a>rbd-pvc<span class=w>   </span>Bound<span class=w>    </span>pvc-f6fa10da-9e2e-4ca1-aec2-0a1b9b457f86<span class=w>   </span>1Gi<span class=w>        </span>RWO<span class=w>            </span>rook-ceph-block<span class=w>   </span>8m55s
</code></pre></div> <p>查看一下创建的持久卷:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-75-1 name=__codelineno-75-1 href=#__codelineno-75-1></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>pv
<a id=__codelineno-75-2 name=__codelineno-75-2 href=#__codelineno-75-2></a>NAME<span class=w>                                       </span>CAPACITY<span class=w>   </span>ACCESS<span class=w> </span>MODES<span class=w>   </span>RECLAIM<span class=w> </span>POLICY<span class=w>   </span>STATUS<span class=w>   </span>CLAIM<span class=w>               </span>STORAGECLASS<span class=w>      </span>REASON<span class=w>   </span>AGE
<a id=__codelineno-75-3 name=__codelineno-75-3 href=#__codelineno-75-3></a>pvc-f6fa10da-9e2e-4ca1-aec2-0a1b9b457f86<span class=w>   </span>1Gi<span class=w>        </span>RWO<span class=w>            </span>Delete<span class=w>           </span>Bound<span class=w>    </span>rook-ceph/rbd-pvc<span class=w>   </span>rook-ceph-block<span class=w>            </span>11m
</code></pre></div> <p>查看其中一个持久化卷的具体信息:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-76-1 name=__codelineno-76-1 href=#__codelineno-76-1></a>$<span class=w> </span>kubectl<span class=w> </span>describe<span class=w> </span>pv<span class=w> </span>pvc-f6fa10da-9e2e-4ca1-aec2-0a1b9b457f86
<a id=__codelineno-76-2 name=__codelineno-76-2 href=#__codelineno-76-2></a>Name:<span class=w>            </span>pvc-f6fa10da-9e2e-4ca1-aec2-0a1b9b457f86
<a id=__codelineno-76-3 name=__codelineno-76-3 href=#__codelineno-76-3></a>Labels:<span class=w>          </span>&lt;none&gt;
<a id=__codelineno-76-4 name=__codelineno-76-4 href=#__codelineno-76-4></a>Annotations:<span class=w>     </span>pv.kubernetes.io/provisioned-by:<span class=w> </span>rook-ceph.rbd.csi.ceph.com
<a id=__codelineno-76-5 name=__codelineno-76-5 href=#__codelineno-76-5></a><span class=w>                 </span>volume.kubernetes.io/provisioner-deletion-secret-name:<span class=w> </span>rook-csi-rbd-provisioner
<a id=__codelineno-76-6 name=__codelineno-76-6 href=#__codelineno-76-6></a><span class=w>                 </span>volume.kubernetes.io/provisioner-deletion-secret-namespace:<span class=w> </span>rook-ceph
<a id=__codelineno-76-7 name=__codelineno-76-7 href=#__codelineno-76-7></a>Finalizers:<span class=w>      </span><span class=o>[</span>kubernetes.io/pv-protection<span class=o>]</span>
<a id=__codelineno-76-8 name=__codelineno-76-8 href=#__codelineno-76-8></a>StorageClass:<span class=w>    </span>rook-ceph-block
<a id=__codelineno-76-9 name=__codelineno-76-9 href=#__codelineno-76-9></a>Status:<span class=w>          </span>Bound
<a id=__codelineno-76-10 name=__codelineno-76-10 href=#__codelineno-76-10></a>Claim:<span class=w>           </span>rook-ceph/rbd-pvc
<a id=__codelineno-76-11 name=__codelineno-76-11 href=#__codelineno-76-11></a>Reclaim<span class=w> </span>Policy:<span class=w>  </span>Delete
<a id=__codelineno-76-12 name=__codelineno-76-12 href=#__codelineno-76-12></a>Access<span class=w> </span>Modes:<span class=w>    </span>RWO
<a id=__codelineno-76-13 name=__codelineno-76-13 href=#__codelineno-76-13></a>VolumeMode:<span class=w>      </span>Filesystem
<a id=__codelineno-76-14 name=__codelineno-76-14 href=#__codelineno-76-14></a>Capacity:<span class=w>        </span>1Gi
<a id=__codelineno-76-15 name=__codelineno-76-15 href=#__codelineno-76-15></a>Node<span class=w> </span>Affinity:<span class=w>   </span>&lt;none&gt;
<a id=__codelineno-76-16 name=__codelineno-76-16 href=#__codelineno-76-16></a>Message:
<a id=__codelineno-76-17 name=__codelineno-76-17 href=#__codelineno-76-17></a>Source:
<a id=__codelineno-76-18 name=__codelineno-76-18 href=#__codelineno-76-18></a><span class=w>    </span>Type:<span class=w>              </span>CSI<span class=w> </span><span class=o>(</span>a<span class=w> </span>Container<span class=w> </span>Storage<span class=w> </span>Interface<span class=w> </span><span class=o>(</span>CSI<span class=o>)</span><span class=w> </span>volume<span class=w> </span><span class=nb>source</span><span class=o>)</span>
<a id=__codelineno-76-19 name=__codelineno-76-19 href=#__codelineno-76-19></a><span class=w>    </span>Driver:<span class=w>            </span>rook-ceph.rbd.csi.ceph.com
<a id=__codelineno-76-20 name=__codelineno-76-20 href=#__codelineno-76-20></a><span class=w>    </span>FSType:<span class=w>            </span>ext4
<a id=__codelineno-76-21 name=__codelineno-76-21 href=#__codelineno-76-21></a><span class=w>    </span>VolumeHandle:<span class=w>      </span><span class=m>0001</span>-0009-rook-ceph-0000000000000003-487f0510-6c2c-4a39-8198-3c411598a777
<a id=__codelineno-76-22 name=__codelineno-76-22 href=#__codelineno-76-22></a><span class=w>    </span>ReadOnly:<span class=w>          </span><span class=nb>false</span>
<a id=__codelineno-76-23 name=__codelineno-76-23 href=#__codelineno-76-23></a><span class=w>    </span>VolumeAttributes:<span class=w>      </span><span class=nv>clusterID</span><span class=o>=</span>rook-ceph
<a id=__codelineno-76-24 name=__codelineno-76-24 href=#__codelineno-76-24></a><span class=w>                           </span><span class=nv>imageFeatures</span><span class=o>=</span>layering
<a id=__codelineno-76-25 name=__codelineno-76-25 href=#__codelineno-76-25></a><span class=w>                           </span><span class=nv>imageFormat</span><span class=o>=</span><span class=m>2</span>
<a id=__codelineno-76-26 name=__codelineno-76-26 href=#__codelineno-76-26></a><span class=w>                           </span><span class=nv>imageName</span><span class=o>=</span>csi-vol-487f0510-6c2c-4a39-8198-3c411598a777
<a id=__codelineno-76-27 name=__codelineno-76-27 href=#__codelineno-76-27></a><span class=w>                           </span><span class=nv>journalPool</span><span class=o>=</span>replicapool
<a id=__codelineno-76-28 name=__codelineno-76-28 href=#__codelineno-76-28></a><span class=w>                           </span><span class=nv>pool</span><span class=o>=</span>replicapool
<a id=__codelineno-76-29 name=__codelineno-76-29 href=#__codelineno-76-29></a><span class=w>                           </span>storage.kubernetes.io/csiProvisionerIdentity<span class=o>=</span><span class=m>1704334037395</span>-4473-rook-ceph.rbd.csi.ceph.com
<a id=__codelineno-76-30 name=__codelineno-76-30 href=#__codelineno-76-30></a>Events:<span class=w>                </span>&lt;none&gt;
</code></pre></div> <p>查看一下存储池 replicapool 中的 rbd 镜像:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-77-1 name=__codelineno-77-1 href=#__codelineno-77-1></a>$<span class=w> </span>kubectl<span class=w> </span>-n<span class=w> </span>rook-ceph<span class=w> </span><span class=nb>exec</span><span class=w> </span>-it<span class=w> </span>deploy/rook-ceph-tools<span class=w> </span>--<span class=w> </span>bash
<a id=__codelineno-77-2 name=__codelineno-77-2 href=#__codelineno-77-2></a>bash-4.4$<span class=w> </span>rbd<span class=w> </span>ls<span class=w> </span>-p<span class=w> </span>replicapool
<a id=__codelineno-77-3 name=__codelineno-77-3 href=#__codelineno-77-3></a>csi-vol-487f0510-6c2c-4a39-8198-3c411598a777
</code></pre></div> <p>我们创建了一个 Pod 示例应用程序，使用经由 Rook 提供的块存储</p> <p><code>rook/deploy/examples/csi/rbd/pod.yaml</code></p> <div class=highlight><pre><span></span><code><a id=__codelineno-78-1 name=__codelineno-78-1 href=#__codelineno-78-1></a>---
<a id=__codelineno-78-2 name=__codelineno-78-2 href=#__codelineno-78-2></a>apiVersion: v1
<a id=__codelineno-78-3 name=__codelineno-78-3 href=#__codelineno-78-3></a>kind: Pod
<a id=__codelineno-78-4 name=__codelineno-78-4 href=#__codelineno-78-4></a>metadata:
<a id=__codelineno-78-5 name=__codelineno-78-5 href=#__codelineno-78-5></a>  name: csirbd-demo-pod
<a id=__codelineno-78-6 name=__codelineno-78-6 href=#__codelineno-78-6></a>spec:
<a id=__codelineno-78-7 name=__codelineno-78-7 href=#__codelineno-78-7></a>  containers:
<a id=__codelineno-78-8 name=__codelineno-78-8 href=#__codelineno-78-8></a>    - name: web-server
<a id=__codelineno-78-9 name=__codelineno-78-9 href=#__codelineno-78-9></a>      image: nginx
<a id=__codelineno-78-10 name=__codelineno-78-10 href=#__codelineno-78-10></a>      volumeMounts:
<a id=__codelineno-78-11 name=__codelineno-78-11 href=#__codelineno-78-11></a>        - name: mypvc
<a id=__codelineno-78-12 name=__codelineno-78-12 href=#__codelineno-78-12></a>          mountPath: /var/lib/www/html
<a id=__codelineno-78-13 name=__codelineno-78-13 href=#__codelineno-78-13></a>  volumes:
<a id=__codelineno-78-14 name=__codelineno-78-14 href=#__codelineno-78-14></a>    - name: mypvc
<a id=__codelineno-78-15 name=__codelineno-78-15 href=#__codelineno-78-15></a>      persistentVolumeClaim:
<a id=__codelineno-78-16 name=__codelineno-78-16 href=#__codelineno-78-16></a>        claimName: rbd-pvc
<a id=__codelineno-78-17 name=__codelineno-78-17 href=#__codelineno-78-17></a>        readOnly: false
</code></pre></div> <div class=highlight><pre><span></span><code><a id=__codelineno-79-1 name=__codelineno-79-1 href=#__codelineno-79-1></a>$<span class=w> </span>kubectl<span class=w> </span>apply<span class=w> </span>-f<span class=w> </span>pod.yaml
<a id=__codelineno-79-2 name=__codelineno-79-2 href=#__codelineno-79-2></a>pod/csirbd-demo-pod<span class=w> </span>created
<a id=__codelineno-79-3 name=__codelineno-79-3 href=#__codelineno-79-3></a>
<a id=__codelineno-79-4 name=__codelineno-79-4 href=#__codelineno-79-4></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>pod<span class=w> </span>csirbd-demo-pod
<a id=__codelineno-79-5 name=__codelineno-79-5 href=#__codelineno-79-5></a>NAME<span class=w>              </span>READY<span class=w>   </span>STATUS<span class=w>    </span>RESTARTS<span class=w>   </span>AGE
<a id=__codelineno-79-6 name=__codelineno-79-6 href=#__codelineno-79-6></a>csirbd-demo-pod<span class=w>   </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>2m1s
</code></pre></div> <p>或者直接创建一个短暂的 pod</p> <div class=highlight><pre><span></span><code><a id=__codelineno-80-1 name=__codelineno-80-1 href=#__codelineno-80-1></a>$<span class=w> </span>kubectl<span class=w> </span>apply<span class=w> </span>-f<span class=w> </span>pod-ephemeral.yaml
<a id=__codelineno-80-2 name=__codelineno-80-2 href=#__codelineno-80-2></a>pod/csi-rbd-demo-ephemeral-pod<span class=w> </span>created
<a id=__codelineno-80-3 name=__codelineno-80-3 href=#__codelineno-80-3></a>
<a id=__codelineno-80-4 name=__codelineno-80-4 href=#__codelineno-80-4></a>$<span class=w> </span>cat<span class=w> </span>pod-ephemeral.yaml
<a id=__codelineno-80-5 name=__codelineno-80-5 href=#__codelineno-80-5></a>kind:<span class=w> </span>Pod
<a id=__codelineno-80-6 name=__codelineno-80-6 href=#__codelineno-80-6></a>apiVersion:<span class=w> </span>v1
<a id=__codelineno-80-7 name=__codelineno-80-7 href=#__codelineno-80-7></a>metadata:
<a id=__codelineno-80-8 name=__codelineno-80-8 href=#__codelineno-80-8></a><span class=w>  </span>name:<span class=w> </span>csi-rbd-demo-ephemeral-pod
<a id=__codelineno-80-9 name=__codelineno-80-9 href=#__codelineno-80-9></a>spec:
<a id=__codelineno-80-10 name=__codelineno-80-10 href=#__codelineno-80-10></a><span class=w>  </span>containers:
<a id=__codelineno-80-11 name=__codelineno-80-11 href=#__codelineno-80-11></a><span class=w>    </span>-<span class=w> </span>name:<span class=w> </span>web-server
<a id=__codelineno-80-12 name=__codelineno-80-12 href=#__codelineno-80-12></a><span class=w>      </span>image:<span class=w> </span>docker.io/library/nginx:latest
<a id=__codelineno-80-13 name=__codelineno-80-13 href=#__codelineno-80-13></a><span class=w>      </span>volumeMounts:
<a id=__codelineno-80-14 name=__codelineno-80-14 href=#__codelineno-80-14></a><span class=w>        </span>-<span class=w> </span>mountPath:<span class=w> </span><span class=s2>&quot;/myspace&quot;</span>
<a id=__codelineno-80-15 name=__codelineno-80-15 href=#__codelineno-80-15></a><span class=w>          </span>name:<span class=w> </span>mypvc
<a id=__codelineno-80-16 name=__codelineno-80-16 href=#__codelineno-80-16></a><span class=w>  </span>volumes:
<a id=__codelineno-80-17 name=__codelineno-80-17 href=#__codelineno-80-17></a><span class=w>    </span>-<span class=w> </span>name:<span class=w> </span>mypvc
<a id=__codelineno-80-18 name=__codelineno-80-18 href=#__codelineno-80-18></a><span class=w>      </span>ephemeral:
<a id=__codelineno-80-19 name=__codelineno-80-19 href=#__codelineno-80-19></a><span class=w>        </span>volumeClaimTemplate:
<a id=__codelineno-80-20 name=__codelineno-80-20 href=#__codelineno-80-20></a><span class=w>          </span>spec:
<a id=__codelineno-80-21 name=__codelineno-80-21 href=#__codelineno-80-21></a><span class=w>            </span>accessModes:<span class=w> </span><span class=o>[</span><span class=s2>&quot;ReadWriteOnce&quot;</span><span class=o>]</span>
<a id=__codelineno-80-22 name=__codelineno-80-22 href=#__codelineno-80-22></a><span class=w>            </span>storageClassName:<span class=w> </span><span class=s2>&quot;rook-ceph-block&quot;</span>
<a id=__codelineno-80-23 name=__codelineno-80-23 href=#__codelineno-80-23></a><span class=w>            </span>resources:
<a id=__codelineno-80-24 name=__codelineno-80-24 href=#__codelineno-80-24></a><span class=w>              </span>requests:
<a id=__codelineno-80-25 name=__codelineno-80-25 href=#__codelineno-80-25></a><span class=w>                </span>storage:<span class=w> </span>1Gi
<a id=__codelineno-80-26 name=__codelineno-80-26 href=#__codelineno-80-26></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>pod<span class=w> </span>csi-rbd-demo-ephemeral-pod
<a id=__codelineno-80-27 name=__codelineno-80-27 href=#__codelineno-80-27></a>NAME<span class=w>                         </span>READY<span class=w>   </span>STATUS<span class=w>    </span>RESTARTS<span class=w>   </span>AGE
<a id=__codelineno-80-28 name=__codelineno-80-28 href=#__codelineno-80-28></a>csi-rbd-demo-ephemeral-pod<span class=w>   </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>14s
</code></pre></div> <p>查看一下存储池 replicapool 中的 rbd 镜像:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-81-1 name=__codelineno-81-1 href=#__codelineno-81-1></a>$ rbd ls -p replicapool
<a id=__codelineno-81-2 name=__codelineno-81-2 href=#__codelineno-81-2></a>csi-vol-487f0510-6c2c-4a39-8198-3c411598a777
<a id=__codelineno-81-3 name=__codelineno-81-3 href=#__codelineno-81-3></a>csi-vol-75a8fa65-83b7-469e-baa2-5856fc96721e
</code></pre></div> <h5 id=9413-pvc-快照-块存储快照>9.4.1.3 PVC 快照-块存储快照<a class=headerlink href=#9413-pvc-快照-块存储快照 title="Permanent link">&para;</a></h5> <p>snapshotclass 的作用：</p> <p>和 StorageClass 一样，提供一种管理 volume 供给的方式。VolumeSnapshotClass 也提供一种管理卷快照的方式。</p> <p>Kubernetes 1.19 以上版本需要单独安装 Snapshot 控制器，才能完成 PVC 的快照功能，所以在此提前安装一下，如果是 1.19 以下的版本，则不需要单独安装。</p> <p>安装方式如下：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-82-1 name=__codelineno-82-1 href=#__codelineno-82-1></a>kubectl<span class=w> </span>apply<span class=w> </span>-f<span class=w> </span>https://raw.githubusercontent.com/kubernetes-csi/external-snapshotter/master/client/config/crd/snapshot.storage.k8s.io_volumesnapshots.yaml
<a id=__codelineno-82-2 name=__codelineno-82-2 href=#__codelineno-82-2></a>
<a id=__codelineno-82-3 name=__codelineno-82-3 href=#__codelineno-82-3></a>kubectl<span class=w> </span>apply<span class=w> </span>-f<span class=w> </span>https://raw.githubusercontent.com/kubernetes-csi/external-snapshotter/master/client/config/crd/snapshot.storage.k8s.io_volumesnapshotcontents.yaml
<a id=__codelineno-82-4 name=__codelineno-82-4 href=#__codelineno-82-4></a>
<a id=__codelineno-82-5 name=__codelineno-82-5 href=#__codelineno-82-5></a>kubectl<span class=w> </span>apply<span class=w> </span>-f<span class=w> </span>https://raw.githubusercontent.com/kubernetes-csi/external-snapshotter/master/client/config/crd/snapshot.storage.k8s.io_volumesnapshotclasses.yaml
<a id=__codelineno-82-6 name=__codelineno-82-6 href=#__codelineno-82-6></a>
<a id=__codelineno-82-7 name=__codelineno-82-7 href=#__codelineno-82-7></a>kubectl<span class=w> </span>apply<span class=w> </span>-f<span class=w> </span>https://raw.githubusercontent.com/kubernetes-csi/external-snapshotter/master/deploy/kubernetes/snapshot-controller/rbac-snapshot-controller.yaml
<a id=__codelineno-82-8 name=__codelineno-82-8 href=#__codelineno-82-8></a>
<a id=__codelineno-82-9 name=__codelineno-82-9 href=#__codelineno-82-9></a>kubectl<span class=w> </span>apply<span class=w> </span>-f<span class=w> </span>https://raw.githubusercontent.com/kubernetes-csi/external-snapshotter/master/deploy/kubernetes/snapshot-controller/setup-snapshot-controller.yaml
</code></pre></div> <p>参考：<a href=https://github.com/rook/rook/issues/6819>I get an error when deploying an existing snapshotclass.yaml. · Issue #6819 · rook/rook (github.com)</a></p> <p><a href=https://rook.github.io/docs/rook/v1.5/ceph-csi-snapshot.html>Ceph Docs (rook.github.io)</a></p> <p>文件位置 <code>rook/deploy/examples/csi/rbd/snapshotclass.yaml</code></p> <p>创建：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-83-1 name=__codelineno-83-1 href=#__codelineno-83-1></a>$<span class=w> </span>kubectl<span class=w> </span>create<span class=w> </span>-f<span class=w> </span>snapshotclass.yaml
<a id=__codelineno-83-2 name=__codelineno-83-2 href=#__codelineno-83-2></a>volumesnapshotclass.snapshot.storage.k8s.io/csi-rbdplugin-snapclass<span class=w> </span>created
</code></pre></div> <p>内容：实际上就是通过 parameters 指定提供 snapshot 资源的信息。通过 snapshot.storage.k8s.io/v1 这个 api 接口进行管理。</p> <div class=highlight><pre><span></span><code><a id=__codelineno-84-1 name=__codelineno-84-1 href=#__codelineno-84-1></a>cat<span class=w> </span>csi/rbd/snapshotclass.yaml
<a id=__codelineno-84-2 name=__codelineno-84-2 href=#__codelineno-84-2></a>---
<a id=__codelineno-84-3 name=__codelineno-84-3 href=#__codelineno-84-3></a><span class=c1># 1.17 &lt;= K8s &lt;= v1.19</span>
<a id=__codelineno-84-4 name=__codelineno-84-4 href=#__codelineno-84-4></a><span class=c1># apiVersion: snapshot.storage.k8s.io/v1beta1</span>
<a id=__codelineno-84-5 name=__codelineno-84-5 href=#__codelineno-84-5></a><span class=c1># K8s &gt;= v1.20</span>
<a id=__codelineno-84-6 name=__codelineno-84-6 href=#__codelineno-84-6></a>apiVersion:<span class=w> </span>snapshot.storage.k8s.io/v1
<a id=__codelineno-84-7 name=__codelineno-84-7 href=#__codelineno-84-7></a>kind:<span class=w> </span>VolumeSnapshotClass
<a id=__codelineno-84-8 name=__codelineno-84-8 href=#__codelineno-84-8></a>metadata:
<a id=__codelineno-84-9 name=__codelineno-84-9 href=#__codelineno-84-9></a><span class=w>  </span>name:<span class=w> </span>csi-rbdplugin-snapclass
<a id=__codelineno-84-10 name=__codelineno-84-10 href=#__codelineno-84-10></a>driver:<span class=w> </span>rook-ceph.rbd.csi.ceph.com<span class=w> </span><span class=c1># driver:namespace:operator</span>
<a id=__codelineno-84-11 name=__codelineno-84-11 href=#__codelineno-84-11></a>parameters:
<a id=__codelineno-84-12 name=__codelineno-84-12 href=#__codelineno-84-12></a><span class=w>  </span><span class=c1># Specify a string that identifies your cluster. Ceph CSI supports any</span>
<a id=__codelineno-84-13 name=__codelineno-84-13 href=#__codelineno-84-13></a><span class=w>  </span><span class=c1># unique string. When Ceph CSI is deployed by Rook use the Rook namespace,</span>
<a id=__codelineno-84-14 name=__codelineno-84-14 href=#__codelineno-84-14></a><span class=w>  </span><span class=c1># for example &quot;rook-ceph&quot;.</span>
<a id=__codelineno-84-15 name=__codelineno-84-15 href=#__codelineno-84-15></a><span class=w>  </span>clusterID:<span class=w> </span>rook-ceph<span class=w> </span><span class=c1># namespace:cluster</span>
<a id=__codelineno-84-16 name=__codelineno-84-16 href=#__codelineno-84-16></a><span class=w>  </span>csi.storage.k8s.io/snapshotter-secret-name:<span class=w> </span>rook-csi-rbd-provisioner
<a id=__codelineno-84-17 name=__codelineno-84-17 href=#__codelineno-84-17></a><span class=w>  </span>csi.storage.k8s.io/snapshotter-secret-namespace:<span class=w> </span>rook-ceph<span class=w> </span><span class=c1># namespace:cluster</span>
<a id=__codelineno-84-18 name=__codelineno-84-18 href=#__codelineno-84-18></a>deletionPolicy:<span class=w> </span>Delete
</code></pre></div> <h6 id=制作快照>制作快照<a class=headerlink href=#制作快照 title="Permanent link">&para;</a></h6> <p>创建快照之前，我们在给需要创建快照的卷里面新增一些内容，以便后面来进行数据验证。</p> <p>在 web-0-pvc 的 pod 里面增加一个 nginx 的主页数据，后面用于测试。</p> <p>创建测试容器和 pvc</p> <div class=highlight><pre><span></span><code><a id=__codelineno-85-1 name=__codelineno-85-1 href=#__codelineno-85-1></a><span class=nn>---</span>
<a id=__codelineno-85-2 name=__codelineno-85-2 href=#__codelineno-85-2></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id=__codelineno-85-3 name=__codelineno-85-3 href=#__codelineno-85-3></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<a id=__codelineno-85-4 name=__codelineno-85-4 href=#__codelineno-85-4></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-85-5 name=__codelineno-85-5 href=#__codelineno-85-5></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<a id=__codelineno-85-6 name=__codelineno-85-6 href=#__codelineno-85-6></a><span class=w>  </span><span class=nt>labels</span><span class=p>:</span>
<a id=__codelineno-85-7 name=__codelineno-85-7 href=#__codelineno-85-7></a><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<a id=__codelineno-85-8 name=__codelineno-85-8 href=#__codelineno-85-8></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-85-9 name=__codelineno-85-9 href=#__codelineno-85-9></a><span class=w>  </span><span class=nt>ports</span><span class=p>:</span>
<a id=__codelineno-85-10 name=__codelineno-85-10 href=#__codelineno-85-10></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<a id=__codelineno-85-11 name=__codelineno-85-11 href=#__codelineno-85-11></a><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">web</span>
<a id=__codelineno-85-12 name=__codelineno-85-12 href=#__codelineno-85-12></a><span class=w>  </span><span class=nt>selector</span><span class=p>:</span>
<a id=__codelineno-85-13 name=__codelineno-85-13 href=#__codelineno-85-13></a><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<a id=__codelineno-85-14 name=__codelineno-85-14 href=#__codelineno-85-14></a><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ClusterIP</span>
<a id=__codelineno-85-15 name=__codelineno-85-15 href=#__codelineno-85-15></a>
<a id=__codelineno-85-16 name=__codelineno-85-16 href=#__codelineno-85-16></a><span class=nn>---</span>
<a id=__codelineno-85-17 name=__codelineno-85-17 href=#__codelineno-85-17></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id=__codelineno-85-18 name=__codelineno-85-18 href=#__codelineno-85-18></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
<a id=__codelineno-85-19 name=__codelineno-85-19 href=#__codelineno-85-19></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-85-20 name=__codelineno-85-20 href=#__codelineno-85-20></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">web-0-pvc</span>
<a id=__codelineno-85-21 name=__codelineno-85-21 href=#__codelineno-85-21></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-85-22 name=__codelineno-85-22 href=#__codelineno-85-22></a><span class=w>  </span><span class=nt>accessModes</span><span class=p>:</span>
<a id=__codelineno-85-23 name=__codelineno-85-23 href=#__codelineno-85-23></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
<a id=__codelineno-85-24 name=__codelineno-85-24 href=#__codelineno-85-24></a><span class=w>  </span><span class=nt>resources</span><span class=p>:</span>
<a id=__codelineno-85-25 name=__codelineno-85-25 href=#__codelineno-85-25></a><span class=w>    </span><span class=nt>requests</span><span class=p>:</span>
<a id=__codelineno-85-26 name=__codelineno-85-26 href=#__codelineno-85-26></a><span class=w>      </span><span class=nt>storage</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1Gi</span>
<a id=__codelineno-85-27 name=__codelineno-85-27 href=#__codelineno-85-27></a><span class=w>  </span><span class=nt>storageClassName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rook-ceph-block</span>
<a id=__codelineno-85-28 name=__codelineno-85-28 href=#__codelineno-85-28></a>
<a id=__codelineno-85-29 name=__codelineno-85-29 href=#__codelineno-85-29></a><span class=nn>---</span>
<a id=__codelineno-85-30 name=__codelineno-85-30 href=#__codelineno-85-30></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<a id=__codelineno-85-31 name=__codelineno-85-31 href=#__codelineno-85-31></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<a id=__codelineno-85-32 name=__codelineno-85-32 href=#__codelineno-85-32></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-85-33 name=__codelineno-85-33 href=#__codelineno-85-33></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">web</span>
<a id=__codelineno-85-34 name=__codelineno-85-34 href=#__codelineno-85-34></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-85-35 name=__codelineno-85-35 href=#__codelineno-85-35></a><span class=w>  </span><span class=nt>selector</span><span class=p>:</span>
<a id=__codelineno-85-36 name=__codelineno-85-36 href=#__codelineno-85-36></a><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span>
<a id=__codelineno-85-37 name=__codelineno-85-37 href=#__codelineno-85-37></a><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<a id=__codelineno-85-38 name=__codelineno-85-38 href=#__codelineno-85-38></a><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<a id=__codelineno-85-39 name=__codelineno-85-39 href=#__codelineno-85-39></a><span class=w>  </span><span class=nt>template</span><span class=p>:</span>
<a id=__codelineno-85-40 name=__codelineno-85-40 href=#__codelineno-85-40></a><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-85-41 name=__codelineno-85-41 href=#__codelineno-85-41></a><span class=w>      </span><span class=nt>labels</span><span class=p>:</span>
<a id=__codelineno-85-42 name=__codelineno-85-42 href=#__codelineno-85-42></a><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<a id=__codelineno-85-43 name=__codelineno-85-43 href=#__codelineno-85-43></a><span class=w>    </span><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-85-44 name=__codelineno-85-44 href=#__codelineno-85-44></a><span class=w>      </span><span class=nt>containers</span><span class=p>:</span>
<a id=__codelineno-85-45 name=__codelineno-85-45 href=#__codelineno-85-45></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<a id=__codelineno-85-46 name=__codelineno-85-46 href=#__codelineno-85-46></a><span class=w>          </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<a id=__codelineno-85-47 name=__codelineno-85-47 href=#__codelineno-85-47></a><span class=w>          </span><span class=nt>imagePullPolicy</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
<a id=__codelineno-85-48 name=__codelineno-85-48 href=#__codelineno-85-48></a><span class=w>          </span><span class=nt>ports</span><span class=p>:</span>
<a id=__codelineno-85-49 name=__codelineno-85-49 href=#__codelineno-85-49></a><span class=w>            </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<a id=__codelineno-85-50 name=__codelineno-85-50 href=#__codelineno-85-50></a><span class=w>              </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">web</span>
<a id=__codelineno-85-51 name=__codelineno-85-51 href=#__codelineno-85-51></a><span class=w>          </span><span class=nt>volumeMounts</span><span class=p>:</span>
<a id=__codelineno-85-52 name=__codelineno-85-52 href=#__codelineno-85-52></a><span class=w>            </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">www</span>
<a id=__codelineno-85-53 name=__codelineno-85-53 href=#__codelineno-85-53></a><span class=w>              </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/usr/share/nginx/html</span>
<a id=__codelineno-85-54 name=__codelineno-85-54 href=#__codelineno-85-54></a><span class=w>      </span><span class=nt>volumes</span><span class=p>:</span>
<a id=__codelineno-85-55 name=__codelineno-85-55 href=#__codelineno-85-55></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">www</span>
<a id=__codelineno-85-56 name=__codelineno-85-56 href=#__codelineno-85-56></a><span class=w>          </span><span class=nt>persistentVolumeClaim</span><span class=p>:</span>
<a id=__codelineno-85-57 name=__codelineno-85-57 href=#__codelineno-85-57></a><span class=w>            </span><span class=nt>claimName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">web-0-pvc</span>
</code></pre></div> <div class=highlight><pre><span></span><code><a id=__codelineno-86-1 name=__codelineno-86-1 href=#__codelineno-86-1></a>$<span class=w> </span>k<span class=w> </span>apply<span class=w> </span>-f<span class=w> </span>deployment-pvc-restore.yaml
<a id=__codelineno-86-2 name=__codelineno-86-2 href=#__codelineno-86-2></a>service/nginx<span class=w> </span>created
<a id=__codelineno-86-3 name=__codelineno-86-3 href=#__codelineno-86-3></a>persistentvolumeclaim/web-0-pvc<span class=w> </span>created
<a id=__codelineno-86-4 name=__codelineno-86-4 href=#__codelineno-86-4></a>
<a id=__codelineno-86-5 name=__codelineno-86-5 href=#__codelineno-86-5></a>$<span class=w>  </span>k<span class=w> </span>get<span class=w> </span>pvc<span class=w> </span>web-0-pvc
<a id=__codelineno-86-6 name=__codelineno-86-6 href=#__codelineno-86-6></a>NAME<span class=w>        </span>STATUS<span class=w>   </span>VOLUME<span class=w>                                     </span>CAPACITY<span class=w>   </span>ACCESS<span class=w> </span>MODES<span class=w>   </span>STORAGECLASS<span class=w>      </span>AGE
<a id=__codelineno-86-7 name=__codelineno-86-7 href=#__codelineno-86-7></a>web-0-pvc<span class=w>   </span>Bound<span class=w>    </span>pvc-1a93a247-e78c-4d6e-838f-929a520d1343<span class=w>   </span>1Gi<span class=w>        </span>RWO<span class=w>            </span>rook-ceph-block<span class=w>   </span>73s
<a id=__codelineno-86-8 name=__codelineno-86-8 href=#__codelineno-86-8></a>
<a id=__codelineno-86-9 name=__codelineno-86-9 href=#__codelineno-86-9></a>$<span class=w> </span>k<span class=w> </span><span class=nb>exec</span><span class=w> </span>-it<span class=w> </span>pod/web-54c59df478-znqpp<span class=w> </span>-n<span class=w> </span>rook-ceph<span class=w> </span>--<span class=w> </span>bash
<a id=__codelineno-86-10 name=__codelineno-86-10 href=#__codelineno-86-10></a>root@web-54c59df478-znqpp:/#<span class=w> </span><span class=nb>cd</span><span class=w> </span>/usr/share/nginx/html/
<a id=__codelineno-86-11 name=__codelineno-86-11 href=#__codelineno-86-11></a>root@web-54c59df478-znqpp:/usr/share/nginx/html#<span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;this is pvc snapshot rbd test!&quot;</span><span class=w> </span>&gt;<span class=w> </span>index.html
<a id=__codelineno-86-12 name=__codelineno-86-12 href=#__codelineno-86-12></a>root@web-54c59df478-znqpp:/usr/share/nginx/html#<span class=w> </span>ls<span class=w> </span>-l
<a id=__codelineno-86-13 name=__codelineno-86-13 href=#__codelineno-86-13></a>total<span class=w> </span><span class=m>20</span>
<a id=__codelineno-86-14 name=__codelineno-86-14 href=#__codelineno-86-14></a>-rw-r--r--<span class=w> </span><span class=m>1</span><span class=w> </span>root<span class=w> </span>root<span class=w>    </span><span class=m>31</span><span class=w> </span>Jan<span class=w>  </span><span class=m>4</span><span class=w> </span><span class=m>06</span>:50<span class=w> </span>index.html
<a id=__codelineno-86-15 name=__codelineno-86-15 href=#__codelineno-86-15></a>drwx------<span class=w> </span><span class=m>2</span><span class=w> </span>root<span class=w> </span>root<span class=w> </span><span class=m>16384</span><span class=w> </span>Jan<span class=w>  </span><span class=m>4</span><span class=w> </span><span class=m>06</span>:35<span class=w> </span>lost+found
<a id=__codelineno-86-16 name=__codelineno-86-16 href=#__codelineno-86-16></a>root@web-54c59df478-znqpp:/usr/share/nginx/html#<span class=w> </span><span class=nb>exit</span>
</code></pre></div> <p>修改了<code>index.html</code>文件，接下来，我们进行快照制作</p> <p>snapsho 定义了类型为 VolumeSnapshot，来源是已经存在的一个 PVC，同时注意：PVC 是有 namespace 区分的，所以必须在同一个 namespace 中，不然无法 Bound。</p> <p><code>snapshot.yaml</code></p> <div class=highlight><pre><span></span><code><a id=__codelineno-87-1 name=__codelineno-87-1 href=#__codelineno-87-1></a>---
<a id=__codelineno-87-2 name=__codelineno-87-2 href=#__codelineno-87-2></a>apiVersion: snapshot.storage.k8s.io/v1
<a id=__codelineno-87-3 name=__codelineno-87-3 href=#__codelineno-87-3></a>kind: VolumeSnapshot
<a id=__codelineno-87-4 name=__codelineno-87-4 href=#__codelineno-87-4></a>metadata:
<a id=__codelineno-87-5 name=__codelineno-87-5 href=#__codelineno-87-5></a>  name: rbd-pvc-snapshot
<a id=__codelineno-87-6 name=__codelineno-87-6 href=#__codelineno-87-6></a>spec:
<a id=__codelineno-87-7 name=__codelineno-87-7 href=#__codelineno-87-7></a>  volumeSnapshotClassName: csi-rbdplugin-snapclass
<a id=__codelineno-87-8 name=__codelineno-87-8 href=#__codelineno-87-8></a>  source:
<a id=__codelineno-87-9 name=__codelineno-87-9 href=#__codelineno-87-9></a>    persistentVolumeClaimName: web-0-pvc
</code></pre></div> <div class=highlight><pre><span></span><code><a id=__codelineno-88-1 name=__codelineno-88-1 href=#__codelineno-88-1></a>$<span class=w> </span>k<span class=w> </span>get<span class=w> </span>pvc<span class=w> </span>-n<span class=w> </span>rook-ceph
<a id=__codelineno-88-2 name=__codelineno-88-2 href=#__codelineno-88-2></a>NAME<span class=w>               </span>STATUS<span class=w>   </span>VOLUME<span class=w>                                     </span>CAPACITY<span class=w>   </span>ACCESS<span class=w> </span>MODES<span class=w>   </span>STORAGECLASS<span class=w>      </span>AGE
<a id=__codelineno-88-3 name=__codelineno-88-3 href=#__codelineno-88-3></a>web-0-pvc<span class=w>          </span>Bound<span class=w>    </span>pvc-1a93a247-e78c-4d6e-838f-929a520d1343<span class=w>   </span>1Gi<span class=w>        </span>RWO<span class=w>            </span>rook-ceph-block<span class=w>   </span>118s
<a id=__codelineno-88-4 name=__codelineno-88-4 href=#__codelineno-88-4></a>
<a id=__codelineno-88-5 name=__codelineno-88-5 href=#__codelineno-88-5></a>$<span class=w> </span>k<span class=w> </span>apply<span class=w> </span>-f<span class=w> </span>snapshot.yaml
<a id=__codelineno-88-6 name=__codelineno-88-6 href=#__codelineno-88-6></a>volumesnapshot.snapshot.storage.k8s.io/rbd-pvc-snapshot<span class=w> </span>created
<a id=__codelineno-88-7 name=__codelineno-88-7 href=#__codelineno-88-7></a>
<a id=__codelineno-88-8 name=__codelineno-88-8 href=#__codelineno-88-8></a><span class=c1># 查看快照，READYTOUSE必须为true才算成功</span>
<a id=__codelineno-88-9 name=__codelineno-88-9 href=#__codelineno-88-9></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>VolumeSnapshot<span class=w> </span>-n<span class=w> </span>rook-ceph
<a id=__codelineno-88-10 name=__codelineno-88-10 href=#__codelineno-88-10></a>NAME<span class=w>               </span>READYTOUSE<span class=w>   </span>SOURCEPVC<span class=w>   </span>SOURCESNAPSHOTCONTENT<span class=w>   </span>RESTORESIZE<span class=w>   </span>SNAPSHOTCLASS<span class=w>             </span>SNAPSHOTCONTENT<span class=w>                                    </span>CREATIONTIME<span class=w>   </span>AGE
<a id=__codelineno-88-11 name=__codelineno-88-11 href=#__codelineno-88-11></a>rbd-pvc-snapshot<span class=w>   </span><span class=nb>true</span><span class=w>         </span>web-0-pvc<span class=w>                           </span>1Gi<span class=w>           </span>csi-rbdplugin-snapclass<span class=w>   </span>snapcontent-7cecab7b-297f-4899-8046-4813f08b58b6<span class=w>   </span>3s<span class=w>             </span>5s
</code></pre></div> <h6 id=指定快照创建-pvc>指定快照创建 PVC<a class=headerlink href=#指定快照创建-pvc title="Permanent link">&para;</a></h6> <p><code>pvc-restore.yaml</code></p> <div class=highlight><pre><span></span><code><a id=__codelineno-89-1 name=__codelineno-89-1 href=#__codelineno-89-1></a><span class=nn>---</span>
<a id=__codelineno-89-2 name=__codelineno-89-2 href=#__codelineno-89-2></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id=__codelineno-89-3 name=__codelineno-89-3 href=#__codelineno-89-3></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
<a id=__codelineno-89-4 name=__codelineno-89-4 href=#__codelineno-89-4></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-89-5 name=__codelineno-89-5 href=#__codelineno-89-5></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rbd-pvc-restore</span>
<a id=__codelineno-89-6 name=__codelineno-89-6 href=#__codelineno-89-6></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-89-7 name=__codelineno-89-7 href=#__codelineno-89-7></a><span class=w>  </span><span class=nt>storageClassName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rook-ceph-block</span>
<a id=__codelineno-89-8 name=__codelineno-89-8 href=#__codelineno-89-8></a><span class=w>  </span><span class=nt>dataSource</span><span class=p>:</span>
<a id=__codelineno-89-9 name=__codelineno-89-9 href=#__codelineno-89-9></a><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rbd-pvc-snapshot</span>
<a id=__codelineno-89-10 name=__codelineno-89-10 href=#__codelineno-89-10></a><span class=w>    </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">VolumeSnapshot</span>
<a id=__codelineno-89-11 name=__codelineno-89-11 href=#__codelineno-89-11></a><span class=w>    </span><span class=nt>apiGroup</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">snapshot.storage.k8s.io</span>
<a id=__codelineno-89-12 name=__codelineno-89-12 href=#__codelineno-89-12></a><span class=w>  </span><span class=nt>accessModes</span><span class=p>:</span>
<a id=__codelineno-89-13 name=__codelineno-89-13 href=#__codelineno-89-13></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
<a id=__codelineno-89-14 name=__codelineno-89-14 href=#__codelineno-89-14></a><span class=w>  </span><span class=nt>resources</span><span class=p>:</span>
<a id=__codelineno-89-15 name=__codelineno-89-15 href=#__codelineno-89-15></a><span class=w>    </span><span class=nt>requests</span><span class=p>:</span>
<a id=__codelineno-89-16 name=__codelineno-89-16 href=#__codelineno-89-16></a><span class=w>      </span><span class=nt>storage</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1Gi</span>
</code></pre></div> <blockquote> <p>注意：指定快照创建 PVC 时，需要满足如下条件：</p> <p>1、在同一个 namespace；</p> <p>2、存储大小必须小于等于快照的大小。不然无法 Bound。</p> </blockquote> <div class=highlight><pre><span></span><code><a id=__codelineno-90-1 name=__codelineno-90-1 href=#__codelineno-90-1></a>$<span class=w> </span>kubectl<span class=w> </span>create<span class=w> </span>-f<span class=w> </span>pvc-restore.yaml<span class=w> </span>-n<span class=w> </span>rook-ceph
<a id=__codelineno-90-2 name=__codelineno-90-2 href=#__codelineno-90-2></a>persistentvolumeclaim/rbd-pvc-restore<span class=w> </span>created
<a id=__codelineno-90-3 name=__codelineno-90-3 href=#__codelineno-90-3></a>
<a id=__codelineno-90-4 name=__codelineno-90-4 href=#__codelineno-90-4></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>pvc
<a id=__codelineno-90-5 name=__codelineno-90-5 href=#__codelineno-90-5></a>NAME<span class=w>               </span>STATUS<span class=w>   </span>VOLUME<span class=w>                                     </span>CAPACITY<span class=w>   </span>ACCESS<span class=w> </span>MODES<span class=w>   </span>STORAGECLASS<span class=w>      </span>AGE
<a id=__codelineno-90-6 name=__codelineno-90-6 href=#__codelineno-90-6></a>rbd-pvc-restore<span class=w>    </span>Bound<span class=w>    </span>pvc-84e3a64e-3740-406e-ae30-38f57312cbc9<span class=w>   </span>1Gi<span class=w>        </span>RWO<span class=w>            </span>rook-ceph-block<span class=w>   </span>14s
<a id=__codelineno-90-7 name=__codelineno-90-7 href=#__codelineno-90-7></a>web-0-pvc<span class=w>          </span>Bound<span class=w>    </span>pvc-1a93a247-e78c-4d6e-838f-929a520d1343<span class=w>   </span>1Gi<span class=w>        </span>RWO<span class=w>            </span>rook-ceph-block<span class=w>   </span>9m41s
</code></pre></div> <h6 id=数据验证>数据验证<a class=headerlink href=#数据验证 title="Permanent link">&para;</a></h6> <p><code>restore-nginx.yaml</code></p> <div class=highlight><pre><span></span><code><a id=__codelineno-91-1 name=__codelineno-91-1 href=#__codelineno-91-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<a id=__codelineno-91-2 name=__codelineno-91-2 href=#__codelineno-91-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<a id=__codelineno-91-3 name=__codelineno-91-3 href=#__codelineno-91-3></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-91-4 name=__codelineno-91-4 href=#__codelineno-91-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">wordpress-restore</span>
<a id=__codelineno-91-5 name=__codelineno-91-5 href=#__codelineno-91-5></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rook-ceph</span>
<a id=__codelineno-91-6 name=__codelineno-91-6 href=#__codelineno-91-6></a><span class=w>  </span><span class=nt>labels</span><span class=p>:</span>
<a id=__codelineno-91-7 name=__codelineno-91-7 href=#__codelineno-91-7></a><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">wordpress</span>
<a id=__codelineno-91-8 name=__codelineno-91-8 href=#__codelineno-91-8></a><span class=w>    </span><span class=nt>tier</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">frontend</span>
<a id=__codelineno-91-9 name=__codelineno-91-9 href=#__codelineno-91-9></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-91-10 name=__codelineno-91-10 href=#__codelineno-91-10></a><span class=w>  </span><span class=nt>selector</span><span class=p>:</span>
<a id=__codelineno-91-11 name=__codelineno-91-11 href=#__codelineno-91-11></a><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span>
<a id=__codelineno-91-12 name=__codelineno-91-12 href=#__codelineno-91-12></a><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">wordpress</span>
<a id=__codelineno-91-13 name=__codelineno-91-13 href=#__codelineno-91-13></a><span class=w>      </span><span class=nt>tier</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">frontend</span>
<a id=__codelineno-91-14 name=__codelineno-91-14 href=#__codelineno-91-14></a><span class=w>  </span><span class=nt>strategy</span><span class=p>:</span>
<a id=__codelineno-91-15 name=__codelineno-91-15 href=#__codelineno-91-15></a><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Recreate</span>
<a id=__codelineno-91-16 name=__codelineno-91-16 href=#__codelineno-91-16></a><span class=w>  </span><span class=nt>template</span><span class=p>:</span>
<a id=__codelineno-91-17 name=__codelineno-91-17 href=#__codelineno-91-17></a><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-91-18 name=__codelineno-91-18 href=#__codelineno-91-18></a><span class=w>      </span><span class=nt>labels</span><span class=p>:</span>
<a id=__codelineno-91-19 name=__codelineno-91-19 href=#__codelineno-91-19></a><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">wordpress</span>
<a id=__codelineno-91-20 name=__codelineno-91-20 href=#__codelineno-91-20></a><span class=w>        </span><span class=nt>tier</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">frontend</span>
<a id=__codelineno-91-21 name=__codelineno-91-21 href=#__codelineno-91-21></a><span class=w>    </span><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-91-22 name=__codelineno-91-22 href=#__codelineno-91-22></a><span class=w>      </span><span class=nt>containers</span><span class=p>:</span>
<a id=__codelineno-91-23 name=__codelineno-91-23 href=#__codelineno-91-23></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<a id=__codelineno-91-24 name=__codelineno-91-24 href=#__codelineno-91-24></a><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<a id=__codelineno-91-25 name=__codelineno-91-25 href=#__codelineno-91-25></a><span class=w>          </span><span class=nt>volumeMounts</span><span class=p>:</span>
<a id=__codelineno-91-26 name=__codelineno-91-26 href=#__codelineno-91-26></a><span class=w>            </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">wordpress-persistent-storage-restore</span>
<a id=__codelineno-91-27 name=__codelineno-91-27 href=#__codelineno-91-27></a><span class=w>              </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/var/www/html</span>
<a id=__codelineno-91-28 name=__codelineno-91-28 href=#__codelineno-91-28></a><span class=w>      </span><span class=nt>volumes</span><span class=p>:</span>
<a id=__codelineno-91-29 name=__codelineno-91-29 href=#__codelineno-91-29></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">wordpress-persistent-storage-restore</span>
<a id=__codelineno-91-30 name=__codelineno-91-30 href=#__codelineno-91-30></a><span class=w>          </span><span class=nt>persistentVolumeClaim</span><span class=p>:</span>
<a id=__codelineno-91-31 name=__codelineno-91-31 href=#__codelineno-91-31></a><span class=w>            </span><span class=nt>claimName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rbd-pvc-restore</span>
</code></pre></div> <p>通过创建一个 nginx，把刚刚通过快照创建好的 pvc 进行挂载到 pod 里面。</p> <div class=highlight><pre><span></span><code><a id=__codelineno-92-1 name=__codelineno-92-1 href=#__codelineno-92-1></a>$<span class=w> </span>kubectl<span class=w> </span>create<span class=w> </span>-f<span class=w> </span>restore-nginx.yaml<span class=w> </span>-n<span class=w> </span>rook-ceph
</code></pre></div> <div class=highlight><pre><span></span><code><a id=__codelineno-93-1 name=__codelineno-93-1 href=#__codelineno-93-1></a>$<span class=w>  </span>k<span class=w> </span>get<span class=w> </span>pod
<a id=__codelineno-93-2 name=__codelineno-93-2 href=#__codelineno-93-2></a>web-54c59df478-znqpp<span class=w>                                              </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>     </span><span class=m>0</span><span class=w>               </span>20m
<a id=__codelineno-93-3 name=__codelineno-93-3 href=#__codelineno-93-3></a>wordpress-restore-69bb6c76b8-zmb87<span class=w>                                </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>     </span><span class=m>0</span><span class=w>               </span>21s
<a id=__codelineno-93-4 name=__codelineno-93-4 href=#__codelineno-93-4></a>$<span class=w> </span>k<span class=w> </span><span class=nb>exec</span><span class=w> </span>pod/web-54c59df478-znqpp<span class=w> </span>--<span class=w> </span>cat<span class=w> </span>/usr/share/nginx/html/index.html
<a id=__codelineno-93-5 name=__codelineno-93-5 href=#__codelineno-93-5></a>this<span class=w> </span>is<span class=w> </span>pvc<span class=w> </span>snapshot<span class=w> </span>rbd<span class=w> </span>test!
<a id=__codelineno-93-6 name=__codelineno-93-6 href=#__codelineno-93-6></a>
<a id=__codelineno-93-7 name=__codelineno-93-7 href=#__codelineno-93-7></a>$<span class=w> </span>k<span class=w> </span><span class=nb>exec</span><span class=w> </span>pod/wordpress-restore-69bb6c76b8-zmb87<span class=w> </span>--<span class=w> </span>cat<span class=w> </span>/var/www/html/index.html
<a id=__codelineno-93-8 name=__codelineno-93-8 href=#__codelineno-93-8></a>this<span class=w> </span>is<span class=w> </span>pvc<span class=w> </span>snapshot<span class=w> </span>rbd<span class=w> </span>test!
</code></pre></div> <p>从上面可以看出，数据是 OK 的。</p> <p>web-0 的挂载点：/usr/share/nginx/html/</p> <p>wordproess-restore 的挂载点：/var/www/html/</p> <p>因为快照的数据也是直接挂载的 PVC，所以数据直接落到了 PVC 的挂载点。</p> <h5 id=9414-pvc-动态扩容>9.4.1.4 PVC 动态扩容<a class=headerlink href=#9414-pvc-动态扩容 title="Permanent link">&para;</a></h5> <p>扩容需求</p> <ul> <li>文件共享类型的 PVC 扩容需要 k8s 1.15+</li> <li>块存储类型的 PVC 扩容需要 k8s 1.16+</li> </ul> <p>PVC 扩容需要开启<code>ExpandCSIVolumes</code>，新版本的 k8s 已经默认打开了这个功能，可以查看自己的 k8s 版本是否已经默认打开了该功能：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-94-1 name=__codelineno-94-1 href=#__codelineno-94-1></a>$<span class=w> </span>kube-apiserver<span class=w> </span>-h<span class=p>|</span>grep<span class=w> </span>ExpandCSIVolumes
</code></pre></div> <p>如果 default 为 true 就不需要打开此功能，如果 default 为 false，需要开启该功能。</p> <ul> <li>storageclass 也必须支持动态扩容 <code>allowVolumeExpansion: true</code></li> </ul> <div class=highlight><pre><span></span><code><a id=__codelineno-95-1 name=__codelineno-95-1 href=#__codelineno-95-1></a><span class="l l-Scalar l-Scalar-Plain">$ kubectl get sc rook-cephfs -o yaml</span>
<a id=__codelineno-95-2 name=__codelineno-95-2 href=#__codelineno-95-2></a><span class="l l-Scalar l-Scalar-Plain">allowVolumeExpansion</span><span class="p p-Indicator">:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id=__codelineno-95-3 name=__codelineno-95-3 href=#__codelineno-95-3></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">storage.k8s.io/v1</span>
<a id=__codelineno-95-4 name=__codelineno-95-4 href=#__codelineno-95-4></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">StorageClass</span>
</code></pre></div> <h6 id=扩容操作>扩容操作<a class=headerlink href=#扩容操作 title="Permanent link">&para;</a></h6> <p>扩容前，PVC 是 1GB 的容量：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-96-1 name=__codelineno-96-1 href=#__codelineno-96-1></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>pvc<span class=w> </span>-n<span class=w> </span>rook-ceph
<a id=__codelineno-96-2 name=__codelineno-96-2 href=#__codelineno-96-2></a>NAME<span class=w>               </span>STATUS<span class=w>   </span>VOLUME<span class=w>                                     </span>CAPACITY<span class=w>   </span>ACCESS<span class=w> </span>MODES<span class=w>   </span>STORAGECLASS<span class=w>      </span>AGE
<a id=__codelineno-96-3 name=__codelineno-96-3 href=#__codelineno-96-3></a>web-0-pvc<span class=w>          </span>Bound<span class=w>    </span>pvc-1a93a247-e78c-4d6e-838f-929a520d1343<span class=w>   </span>1Gi<span class=w>        </span>RWO<span class=w>            </span>rook-ceph-block<span class=w>   </span>28m
<a id=__codelineno-96-4 name=__codelineno-96-4 href=#__codelineno-96-4></a>
<a id=__codelineno-96-5 name=__codelineno-96-5 href=#__codelineno-96-5></a>$<span class=w> </span>root@gitee-sre2:/home/ubuntu#<span class=w> </span>k<span class=w> </span><span class=nb>exec</span><span class=w> </span>-it<span class=w> </span>pod/web-54c59df478-znqpp<span class=w> </span>-n<span class=w> </span>rook-ceph<span class=w> </span>--<span class=w> </span>bash
<a id=__codelineno-96-6 name=__codelineno-96-6 href=#__codelineno-96-6></a>root@web-54c59df478-znqpp:/#<span class=w> </span>df<span class=w> </span>-Th
<a id=__codelineno-96-7 name=__codelineno-96-7 href=#__codelineno-96-7></a>Filesystem<span class=w>     </span>Type<span class=w>     </span>Size<span class=w>  </span>Used<span class=w> </span>Avail<span class=w> </span>Use%<span class=w> </span>Mounted<span class=w> </span>on
<a id=__codelineno-96-8 name=__codelineno-96-8 href=#__codelineno-96-8></a>overlay<span class=w>        </span>overlay<span class=w>  </span>194G<span class=w>   </span>15G<span class=w>  </span>180G<span class=w>   </span><span class=m>8</span>%<span class=w> </span>/
<a id=__codelineno-96-9 name=__codelineno-96-9 href=#__codelineno-96-9></a>tmpfs<span class=w>          </span>tmpfs<span class=w>     </span>64M<span class=w>     </span><span class=m>0</span><span class=w>   </span>64M<span class=w>   </span><span class=m>0</span>%<span class=w> </span>/dev
<a id=__codelineno-96-10 name=__codelineno-96-10 href=#__codelineno-96-10></a>tmpfs<span class=w>          </span>tmpfs<span class=w>     </span>32G<span class=w>     </span><span class=m>0</span><span class=w>   </span>32G<span class=w>   </span><span class=m>0</span>%<span class=w> </span>/sys/fs/cgroup
<a id=__codelineno-96-11 name=__codelineno-96-11 href=#__codelineno-96-11></a>/dev/vda1<span class=w>      </span>ext4<span class=w>     </span>194G<span class=w>   </span>15G<span class=w>  </span>180G<span class=w>   </span><span class=m>8</span>%<span class=w> </span>/etc/hosts
<a id=__codelineno-96-12 name=__codelineno-96-12 href=#__codelineno-96-12></a>shm<span class=w>            </span>tmpfs<span class=w>     </span>64M<span class=w>     </span><span class=m>0</span><span class=w>   </span>64M<span class=w>   </span><span class=m>0</span>%<span class=w> </span>/dev/shm
<a id=__codelineno-96-13 name=__codelineno-96-13 href=#__codelineno-96-13></a>/dev/rbd0<span class=w>      </span>ext4<span class=w>     </span>974M<span class=w>   </span>28K<span class=w>  </span>958M<span class=w>   </span><span class=m>1</span>%<span class=w> </span>/usr/share/nginx/html
<a id=__codelineno-96-14 name=__codelineno-96-14 href=#__codelineno-96-14></a>tmpfs<span class=w>          </span>tmpfs<span class=w>     </span>63G<span class=w>   </span>12K<span class=w>   </span>63G<span class=w>   </span><span class=m>1</span>%<span class=w> </span>/run/secrets/kubernetes.io/serviceaccount
<a id=__codelineno-96-15 name=__codelineno-96-15 href=#__codelineno-96-15></a>tmpfs<span class=w>          </span>tmpfs<span class=w>     </span>32G<span class=w>     </span><span class=m>0</span><span class=w>   </span>32G<span class=w>   </span><span class=m>0</span>%<span class=w> </span>/proc/acpi
<a id=__codelineno-96-16 name=__codelineno-96-16 href=#__codelineno-96-16></a>tmpfs<span class=w>          </span>tmpfs<span class=w>     </span>32G<span class=w>     </span><span class=m>0</span><span class=w>   </span>32G<span class=w>   </span><span class=m>0</span>%<span class=w> </span>/proc/scsi
<a id=__codelineno-96-17 name=__codelineno-96-17 href=#__codelineno-96-17></a>tmpfs<span class=w>          </span>tmpfs<span class=w>     </span>32G<span class=w>     </span><span class=m>0</span><span class=w>   </span>32G<span class=w>   </span><span class=m>0</span>%<span class=w> </span>/sys/firmware
</code></pre></div> <p>扩容后：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-97-1 name=__codelineno-97-1 href=#__codelineno-97-1></a>$<span class=w> </span>kubectl<span class=w> </span>edit<span class=w> </span>pvc/web-0-pvc<span class=w> </span>-n<span class=w> </span>rook-ceph
<a id=__codelineno-97-2 name=__codelineno-97-2 href=#__codelineno-97-2></a>persistentvolumeclaim/web-0-pvc<span class=w> </span>edited
<a id=__codelineno-97-3 name=__codelineno-97-3 href=#__codelineno-97-3></a>
<a id=__codelineno-97-4 name=__codelineno-97-4 href=#__codelineno-97-4></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>pv,pvc<span class=w> </span>-n<span class=w> </span>rook-ceph
<a id=__codelineno-97-5 name=__codelineno-97-5 href=#__codelineno-97-5></a>NAME<span class=w>                                                        </span>CAPACITY<span class=w>   </span>ACCESS<span class=w> </span>MODES<span class=w>   </span>RECLAIM<span class=w> </span>POLICY<span class=w>   </span>STATUS<span class=w>   </span>CLAIM<span class=w>                        </span>STORAGECLASS<span class=w>      </span>REASON<span class=w>   </span>AGE
<a id=__codelineno-97-6 name=__codelineno-97-6 href=#__codelineno-97-6></a>persistentvolume/pvc-0375f153-0f61-4e0e-93fd-c0caafc9f22c<span class=w>   </span>2Gi<span class=w>        </span>RWX<span class=w>            </span>Delete<span class=w>           </span>Bound<span class=w>    </span>rook-ceph/busybox-data-pvc<span class=w>   </span>rook-cephfs<span class=w>                </span>83m
<a id=__codelineno-97-7 name=__codelineno-97-7 href=#__codelineno-97-7></a>persistentvolume/pvc-1a93a247-e78c-4d6e-838f-929a520d1343<span class=w>   </span>2Gi<span class=w>        </span>RWO<span class=w>            </span>Delete<span class=w>           </span>Bound<span class=w>    </span>rook-ceph/web-0-pvc<span class=w>          </span>rook-ceph-block<span class=w>            </span>33m
<a id=__codelineno-97-8 name=__codelineno-97-8 href=#__codelineno-97-8></a>
<a id=__codelineno-97-9 name=__codelineno-97-9 href=#__codelineno-97-9></a>NAME<span class=w>                                     </span>STATUS<span class=w>   </span>VOLUME<span class=w>                                     </span>CAPACITY<span class=w>   </span>ACCESS<span class=w> </span>MODES<span class=w>   </span>STORAGECLASS<span class=w>      </span>AGE
<a id=__codelineno-97-10 name=__codelineno-97-10 href=#__codelineno-97-10></a>persistentvolumeclaim/busybox-data-pvc<span class=w>   </span>Bound<span class=w>    </span>pvc-0375f153-0f61-4e0e-93fd-c0caafc9f22c<span class=w>   </span>2Gi<span class=w>        </span>RWX<span class=w>            </span>rook-cephfs<span class=w>       </span>83m
<a id=__codelineno-97-11 name=__codelineno-97-11 href=#__codelineno-97-11></a>persistentvolumeclaim/web-0-pvc<span class=w>          </span>Bound<span class=w>    </span>pvc-1a93a247-e78c-4d6e-838f-929a520d1343<span class=w>   </span>2Gi<span class=w>        </span>RWO<span class=w>            </span>rook-ceph-block<span class=w>   </span>33m
<a id=__codelineno-97-12 name=__codelineno-97-12 href=#__codelineno-97-12></a>
<a id=__codelineno-97-13 name=__codelineno-97-13 href=#__codelineno-97-13></a>$<span class=w> </span>k<span class=w> </span><span class=nb>exec</span><span class=w> </span>-it<span class=w> </span>pod/web-54c59df478-znqpp<span class=w> </span>-n<span class=w> </span>rook-ceph<span class=w> </span>--<span class=w> </span>bash
<a id=__codelineno-97-14 name=__codelineno-97-14 href=#__codelineno-97-14></a>root@web-54c59df478-znqpp:/#<span class=w> </span>df<span class=w> </span>-Th
<a id=__codelineno-97-15 name=__codelineno-97-15 href=#__codelineno-97-15></a>Filesystem<span class=w>     </span>Type<span class=w>     </span>Size<span class=w>  </span>Used<span class=w> </span>Avail<span class=w> </span>Use%<span class=w> </span>Mounted<span class=w> </span>on
<a id=__codelineno-97-16 name=__codelineno-97-16 href=#__codelineno-97-16></a>overlay<span class=w>        </span>overlay<span class=w>  </span>194G<span class=w>   </span>15G<span class=w>  </span>180G<span class=w>   </span><span class=m>8</span>%<span class=w> </span>/
<a id=__codelineno-97-17 name=__codelineno-97-17 href=#__codelineno-97-17></a>tmpfs<span class=w>          </span>tmpfs<span class=w>     </span>64M<span class=w>     </span><span class=m>0</span><span class=w>   </span>64M<span class=w>   </span><span class=m>0</span>%<span class=w> </span>/dev
<a id=__codelineno-97-18 name=__codelineno-97-18 href=#__codelineno-97-18></a>tmpfs<span class=w>          </span>tmpfs<span class=w>     </span>32G<span class=w>     </span><span class=m>0</span><span class=w>   </span>32G<span class=w>   </span><span class=m>0</span>%<span class=w> </span>/sys/fs/cgroup
<a id=__codelineno-97-19 name=__codelineno-97-19 href=#__codelineno-97-19></a>/dev/vda1<span class=w>      </span>ext4<span class=w>     </span>194G<span class=w>   </span>15G<span class=w>  </span>180G<span class=w>   </span><span class=m>8</span>%<span class=w> </span>/etc/hosts
<a id=__codelineno-97-20 name=__codelineno-97-20 href=#__codelineno-97-20></a>shm<span class=w>            </span>tmpfs<span class=w>     </span>64M<span class=w>     </span><span class=m>0</span><span class=w>   </span>64M<span class=w>   </span><span class=m>0</span>%<span class=w> </span>/dev/shm
<a id=__codelineno-97-21 name=__codelineno-97-21 href=#__codelineno-97-21></a>/dev/rbd0<span class=w>      </span>ext4<span class=w>     </span><span class=m>2</span>.0G<span class=w>   </span>28K<span class=w>  </span><span class=m>2</span>.0G<span class=w>   </span><span class=m>1</span>%<span class=w> </span>/usr/share/nginx/html
<a id=__codelineno-97-22 name=__codelineno-97-22 href=#__codelineno-97-22></a>tmpfs<span class=w>          </span>tmpfs<span class=w>     </span>63G<span class=w>   </span>12K<span class=w>   </span>63G<span class=w>   </span><span class=m>1</span>%<span class=w> </span>/run/secrets/kubernetes.io/serviceaccount
<a id=__codelineno-97-23 name=__codelineno-97-23 href=#__codelineno-97-23></a>tmpfs<span class=w>          </span>tmpfs<span class=w>     </span>32G<span class=w>     </span><span class=m>0</span><span class=w>   </span>32G<span class=w>   </span><span class=m>0</span>%<span class=w> </span>/proc/acpi
<a id=__codelineno-97-24 name=__codelineno-97-24 href=#__codelineno-97-24></a>tmpfs<span class=w>          </span>tmpfs<span class=w>     </span>32G<span class=w>     </span><span class=m>0</span><span class=w>   </span>32G<span class=w>   </span><span class=m>0</span>%<span class=w> </span>/proc/scsi
<a id=__codelineno-97-25 name=__codelineno-97-25 href=#__codelineno-97-25></a>tmpfs<span class=w>          </span>tmpfs<span class=w>     </span>32G<span class=w>     </span><span class=m>0</span><span class=w>   </span>32G<span class=w>   </span><span class=m>0</span>%<span class=w> </span>/sys/firmware
<a id=__codelineno-97-26 name=__codelineno-97-26 href=#__codelineno-97-26></a>root@web-54c59df478-znqpp:/#
</code></pre></div> <h5 id=9415-pvc-克隆>9.4.1.5 PVC 克隆<a class=headerlink href=#9415-pvc-克隆 title="Permanent link">&para;</a></h5> <p>PVC 克隆和 PVC 的 snapshot 类似：</p> <p>创建测试环境</p> <div class=highlight><pre><span></span><code><a id=__codelineno-98-1 name=__codelineno-98-1 href=#__codelineno-98-1></a>$<span class=w> </span>k<span class=w> </span>apply<span class=w> </span>-f<span class=w> </span>deployment-pvc-restore.yaml
<a id=__codelineno-98-2 name=__codelineno-98-2 href=#__codelineno-98-2></a>service/nginx<span class=w> </span>created
<a id=__codelineno-98-3 name=__codelineno-98-3 href=#__codelineno-98-3></a>persistentvolumeclaim/web-0-pvc<span class=w> </span>created
<a id=__codelineno-98-4 name=__codelineno-98-4 href=#__codelineno-98-4></a>deployment.apps/web<span class=w> </span>created
<a id=__codelineno-98-5 name=__codelineno-98-5 href=#__codelineno-98-5></a>
<a id=__codelineno-98-6 name=__codelineno-98-6 href=#__codelineno-98-6></a>$<span class=w> </span>k<span class=w> </span>get<span class=w> </span>pv,pvc
<a id=__codelineno-98-7 name=__codelineno-98-7 href=#__codelineno-98-7></a>NAME<span class=w>                                                        </span>CAPACITY<span class=w>   </span>ACCESS<span class=w> </span>MODES<span class=w>   </span>RECLAIM<span class=w> </span>POLICY<span class=w>   </span>STATUS<span class=w>   </span>CLAIM<span class=w>                        </span>STORAGECLASS<span class=w>      </span>REASON<span class=w>   </span>AGE
<a id=__codelineno-98-8 name=__codelineno-98-8 href=#__codelineno-98-8></a>persistentvolume/pvc-0375f153-0f61-4e0e-93fd-c0caafc9f22c<span class=w>   </span>2Gi<span class=w>        </span>RWX<span class=w>            </span>Delete<span class=w>           </span>Bound<span class=w>    </span>rook-ceph/busybox-data-pvc<span class=w>   </span>rook-cephfs<span class=w>                </span>87m
<a id=__codelineno-98-9 name=__codelineno-98-9 href=#__codelineno-98-9></a>persistentvolume/pvc-7568c98a-0225-4db0-9e88-d5ea27925440<span class=w>   </span>1Gi<span class=w>        </span>RWO<span class=w>            </span>Delete<span class=w>           </span>Bound<span class=w>    </span>rook-ceph/web-0-pvc<span class=w>          </span>rook-ceph-block<span class=w>            </span>5s
<a id=__codelineno-98-10 name=__codelineno-98-10 href=#__codelineno-98-10></a>
<a id=__codelineno-98-11 name=__codelineno-98-11 href=#__codelineno-98-11></a>NAME<span class=w>                                     </span>STATUS<span class=w>   </span>VOLUME<span class=w>                                     </span>CAPACITY<span class=w>   </span>ACCESS<span class=w> </span>MODES<span class=w>   </span>STORAGECLASS<span class=w>      </span>AGE
<a id=__codelineno-98-12 name=__codelineno-98-12 href=#__codelineno-98-12></a>persistentvolumeclaim/busybox-data-pvc<span class=w>   </span>Bound<span class=w>    </span>pvc-0375f153-0f61-4e0e-93fd-c0caafc9f22c<span class=w>   </span>2Gi<span class=w>        </span>RWX<span class=w>            </span>rook-cephfs<span class=w>       </span>87m
<a id=__codelineno-98-13 name=__codelineno-98-13 href=#__codelineno-98-13></a>persistentvolumeclaim/web-0-pvc<span class=w>          </span>Bound<span class=w>    </span>pvc-7568c98a-0225-4db0-9e88-d5ea27925440<span class=w>   </span>1Gi<span class=w>        </span>RWO<span class=w>            </span>rook-ceph-block<span class=w>   </span>5s
</code></pre></div> <p><code>pvc-clone.yaml</code></p> <div class=highlight><pre><span></span><code><a id=__codelineno-99-1 name=__codelineno-99-1 href=#__codelineno-99-1></a>---
<a id=__codelineno-99-2 name=__codelineno-99-2 href=#__codelineno-99-2></a>apiVersion: v1
<a id=__codelineno-99-3 name=__codelineno-99-3 href=#__codelineno-99-3></a>kind: PersistentVolumeClaim
<a id=__codelineno-99-4 name=__codelineno-99-4 href=#__codelineno-99-4></a>metadata:
<a id=__codelineno-99-5 name=__codelineno-99-5 href=#__codelineno-99-5></a>  name: rbd-pvc-clone
<a id=__codelineno-99-6 name=__codelineno-99-6 href=#__codelineno-99-6></a>spec:
<a id=__codelineno-99-7 name=__codelineno-99-7 href=#__codelineno-99-7></a>  storageClassName: rook-ceph-block
<a id=__codelineno-99-8 name=__codelineno-99-8 href=#__codelineno-99-8></a>  dataSource:
<a id=__codelineno-99-9 name=__codelineno-99-9 href=#__codelineno-99-9></a>    name: web-0-pvc
<a id=__codelineno-99-10 name=__codelineno-99-10 href=#__codelineno-99-10></a>    kind: PersistentVolumeClaim
<a id=__codelineno-99-11 name=__codelineno-99-11 href=#__codelineno-99-11></a>  accessModes:
<a id=__codelineno-99-12 name=__codelineno-99-12 href=#__codelineno-99-12></a>    - ReadWriteOnce
<a id=__codelineno-99-13 name=__codelineno-99-13 href=#__codelineno-99-13></a>  resources:
<a id=__codelineno-99-14 name=__codelineno-99-14 href=#__codelineno-99-14></a>    requests:
<a id=__codelineno-99-15 name=__codelineno-99-15 href=#__codelineno-99-15></a>      storage: 1Gi
</code></pre></div> <div class=highlight><pre><span></span><code><a id=__codelineno-100-1 name=__codelineno-100-1 href=#__codelineno-100-1></a>$<span class=w> </span>k<span class=w> </span>apply<span class=w> </span>-f<span class=w> </span>pvc-clone.yaml
<a id=__codelineno-100-2 name=__codelineno-100-2 href=#__codelineno-100-2></a>persistentvolumeclaim/rbd-pvc-clone<span class=w> </span>created
<a id=__codelineno-100-3 name=__codelineno-100-3 href=#__codelineno-100-3></a>
<a id=__codelineno-100-4 name=__codelineno-100-4 href=#__codelineno-100-4></a>$<span class=w> </span>k<span class=w> </span>get<span class=w> </span>pvc
<a id=__codelineno-100-5 name=__codelineno-100-5 href=#__codelineno-100-5></a>NAME<span class=w>               </span>STATUS<span class=w>   </span>VOLUME<span class=w>                                     </span>CAPACITY<span class=w>   </span>ACCESS<span class=w> </span>MODES<span class=w>   </span>STORAGECLASS<span class=w>      </span>AGE
<a id=__codelineno-100-6 name=__codelineno-100-6 href=#__codelineno-100-6></a>busybox-data-pvc<span class=w>   </span>Bound<span class=w>    </span>pvc-0375f153-0f61-4e0e-93fd-c0caafc9f22c<span class=w>   </span>2Gi<span class=w>        </span>RWX<span class=w>            </span>rook-cephfs<span class=w>       </span>89m
<a id=__codelineno-100-7 name=__codelineno-100-7 href=#__codelineno-100-7></a>rbd-pvc-clone<span class=w>      </span>Bound<span class=w>    </span>pvc-d3466f64-639b-4720-b094-064121b9ed6b<span class=w>   </span>1Gi<span class=w>        </span>RWO<span class=w>            </span>rook-ceph-block<span class=w>   </span>2s
<a id=__codelineno-100-8 name=__codelineno-100-8 href=#__codelineno-100-8></a>web-0-pvc<span class=w>          </span>Bound<span class=w>    </span>pvc-7568c98a-0225-4db0-9e88-d5ea27925440<span class=w>   </span>1Gi<span class=w>        </span>RWO<span class=w>            </span>rook-ceph-block<span class=w>   </span>115s
</code></pre></div> <p><strong>注意事项：</strong></p> <p><strong>1、克隆只能在相同 namespace 下进行；</strong></p> <p><strong>2、克隆后的 pvc 大小必须小于等于克隆前的</strong></p> <h4 id=942-cephfs-共享文件系统>9.4.2 CephFS 共享文件系统<a class=headerlink href=#942-cephfs-共享文件系统 title="Permanent link">&para;</a></h4> <p><strong>CephFS 文件系统存储（也称为共享文件系统）可以从多个 Pod 中以读/写权限挂载。这对于可以使用共享文件系统进行集群化的应用程序可能非常有用。</strong></p> <p>Ceph 从自 Pacific 版本(Ceph 16)开始，支持多个文件系统。</p> <div class=highlight><pre><span></span><code><a id=__codelineno-101-1 name=__codelineno-101-1 href=#__codelineno-101-1></a><span class=m>1</span>：RBD的特点：
<a id=__codelineno-101-2 name=__codelineno-101-2 href=#__codelineno-101-2></a>RBD块存储只能用于单个<span class=w> </span>VM<span class=w> </span>或者单个<span class=w> </span>pods<span class=w> </span>使用，无法提供给多个虚拟机或者多个<span class=w> </span>pods<span class=w> </span>”同时“使用，如果虚拟机或<span class=w> </span>pods<span class=w> </span>有共同访问存储的需求需要使用<span class=w> </span>CephFS<span class=w> </span>实现。
<a id=__codelineno-101-3 name=__codelineno-101-3 href=#__codelineno-101-3></a>
<a id=__codelineno-101-4 name=__codelineno-101-4 href=#__codelineno-101-4></a><span class=m>2</span>：NAS<span class=w> </span>网络附加存储：多个客户端同时访问
<a id=__codelineno-101-5 name=__codelineno-101-5 href=#__codelineno-101-5></a><span class=w>    </span><span class=m>1</span>：EFS
<a id=__codelineno-101-6 name=__codelineno-101-6 href=#__codelineno-101-6></a><span class=w>    </span><span class=m>2</span>：NAS
<a id=__codelineno-101-7 name=__codelineno-101-7 href=#__codelineno-101-7></a><span class=w>    </span><span class=m>3</span>：CFS
<a id=__codelineno-101-8 name=__codelineno-101-8 href=#__codelineno-101-8></a>
<a id=__codelineno-101-9 name=__codelineno-101-9 href=#__codelineno-101-9></a><span class=m>3</span>：CephFS<span class=w> </span>特点：
<a id=__codelineno-101-10 name=__codelineno-101-10 href=#__codelineno-101-10></a><span class=w>    </span><span class=m>1</span>：POSIX-compliant<span class=w> </span>semantics<span class=w> </span>（符合<span class=w> </span>POSIX<span class=w> </span>的语法）
<a id=__codelineno-101-11 name=__codelineno-101-11 href=#__codelineno-101-11></a><span class=w>    </span><span class=m>2</span>：Separates<span class=w> </span>metadata<span class=w> </span>from<span class=w> </span>data<span class=w> </span>（metadata和data<span class=w> </span>分离，数据放入data，元数据放入metadata）
<a id=__codelineno-101-12 name=__codelineno-101-12 href=#__codelineno-101-12></a><span class=w>    </span><span class=m>3</span>：Dynamic<span class=w> </span>rebalancing<span class=w> </span>（动态从分布，自愈）
<a id=__codelineno-101-13 name=__codelineno-101-13 href=#__codelineno-101-13></a><span class=w>    </span><span class=m>4</span>：Subdirectory<span class=w> </span>snapshots<span class=w> </span>（子目录筷子）
<a id=__codelineno-101-14 name=__codelineno-101-14 href=#__codelineno-101-14></a><span class=w>    </span><span class=m>5</span>：Configurable<span class=w> </span>striping<span class=w> </span>（可配置切片）
<a id=__codelineno-101-15 name=__codelineno-101-15 href=#__codelineno-101-15></a><span class=w>    </span><span class=m>6</span>：Kernel<span class=w> </span>driver<span class=w> </span>support<span class=w> </span>（内核级别挂载）
<a id=__codelineno-101-16 name=__codelineno-101-16 href=#__codelineno-101-16></a><span class=w>    </span><span class=m>7</span>：FUSE<span class=w> </span>support<span class=w> </span>（用户空间级别挂载）
<a id=__codelineno-101-17 name=__codelineno-101-17 href=#__codelineno-101-17></a><span class=w>    </span><span class=m>8</span>：NFS/CIFS<span class=w> </span>deployable<span class=w> </span>（NFS/CIFS方式共享出去提供使用）
<a id=__codelineno-101-18 name=__codelineno-101-18 href=#__codelineno-101-18></a><span class=w>    </span><span class=m>9</span>：Use<span class=w> </span>with<span class=w> </span>Hadoop<span class=w> </span><span class=o>(</span>replace<span class=w> </span>HDFS<span class=o>)</span><span class=w> </span>（支持Hadoop<span class=w> </span>的<span class=w> </span>HDFS）
</code></pre></div> <h5 id=9421-创建-cephfilesystem>9.4.2.1 创建 CephFilesystem<a class=headerlink href=#9421-创建-cephfilesystem title="Permanent link">&para;</a></h5> <p>通过在<code>CephFilesystem</code> CRD 中指定元数据池(metadata pool)、数据池(data pools)和元数据服务(metadata server)的所需设置来创建文件系统。</p> <p>在这里，我们创建的是 3 个副本的元数据池和 3 个副本的单个数据池。有关更多选项，请参阅<a href=https://rook.io/docs/rook/v1.11/CRDs/Shared-Filesystem/ceph-filesystem-crd/ >创建共享文件系统的文档</a>。</p> <p>创建下面的 filesystem.yaml 文件:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-102-1 name=__codelineno-102-1 href=#__codelineno-102-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ceph.rook.io/v1</span>
<a id=__codelineno-102-2 name=__codelineno-102-2 href=#__codelineno-102-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">CephFilesystem</span>
<a id=__codelineno-102-3 name=__codelineno-102-3 href=#__codelineno-102-3></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-102-4 name=__codelineno-102-4 href=#__codelineno-102-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">myfs</span>
<a id=__codelineno-102-5 name=__codelineno-102-5 href=#__codelineno-102-5></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rook-ceph</span>
<a id=__codelineno-102-6 name=__codelineno-102-6 href=#__codelineno-102-6></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-102-7 name=__codelineno-102-7 href=#__codelineno-102-7></a><span class=w>  </span><span class=nt>metadataPool</span><span class=p>:</span>
<a id=__codelineno-102-8 name=__codelineno-102-8 href=#__codelineno-102-8></a><span class=w>    </span><span class=nt>replicated</span><span class=p>:</span>
<a id=__codelineno-102-9 name=__codelineno-102-9 href=#__codelineno-102-9></a><span class=w>      </span><span class=nt>size</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<a id=__codelineno-102-10 name=__codelineno-102-10 href=#__codelineno-102-10></a><span class=w>  </span><span class=nt>dataPools</span><span class=p>:</span>
<a id=__codelineno-102-11 name=__codelineno-102-11 href=#__codelineno-102-11></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">replicated</span>
<a id=__codelineno-102-12 name=__codelineno-102-12 href=#__codelineno-102-12></a><span class=w>      </span><span class=nt>replicated</span><span class=p>:</span>
<a id=__codelineno-102-13 name=__codelineno-102-13 href=#__codelineno-102-13></a><span class=w>        </span><span class=nt>size</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<a id=__codelineno-102-14 name=__codelineno-102-14 href=#__codelineno-102-14></a><span class=w>  </span><span class=nt>preserveFilesystemOnDelete</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id=__codelineno-102-15 name=__codelineno-102-15 href=#__codelineno-102-15></a><span class=w>  </span><span class=nt>metadataServer</span><span class=p>:</span>
<a id=__codelineno-102-16 name=__codelineno-102-16 href=#__codelineno-102-16></a><span class=w>    </span><span class=nt>activeCount</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<a id=__codelineno-102-17 name=__codelineno-102-17 href=#__codelineno-102-17></a><span class=w>    </span><span class=nt>activeStandby</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div> <p>Rook Ceph Operator 将创建启动服务所需的所有池和其他资源。这可能需要一些时间来完成。</p> <div class=highlight><pre><span></span><code><a id=__codelineno-103-1 name=__codelineno-103-1 href=#__codelineno-103-1></a>$<span class=w> </span>kubectl<span class=w> </span>create<span class=w> </span>-f<span class=w> </span>filesystem.yaml
</code></pre></div> <p>要确认文件系统已配置完成，请等待 mds Pod 启动：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-104-1 name=__codelineno-104-1 href=#__codelineno-104-1></a>$<span class=w> </span>kubectl<span class=w> </span>-n<span class=w> </span>rook-ceph<span class=w> </span>get<span class=w> </span>pod<span class=w> </span>-l<span class=w> </span><span class=nv>app</span><span class=o>=</span>rook-ceph-mds
<a id=__codelineno-104-2 name=__codelineno-104-2 href=#__codelineno-104-2></a>NAME<span class=w>                                   </span>READY<span class=w>   </span>STATUS<span class=w>    </span>RESTARTS<span class=w>   </span>AGE
<a id=__codelineno-104-3 name=__codelineno-104-3 href=#__codelineno-104-3></a>rook-ceph-mds-myfs-a-9cc6945cf-tvv9x<span class=w>   </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>44s
<a id=__codelineno-104-4 name=__codelineno-104-4 href=#__codelineno-104-4></a>rook-ceph-mds-myfs-b-b988647d4-spmh5<span class=w>   </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>42s
</code></pre></div> <p>要查看文件系统的详细状态，进入 Rook toolbox 中，使用<code>ceph status</code>查看， 确认输出中包含 MDS 服务的状态。在这个示例中，有一个处于活动状态的 MDS 实例，并且还有一个处于备用 MDS 实例，以防发生故障切换。</p> <div class=highlight><pre><span></span><code><a id=__codelineno-105-1 name=__codelineno-105-1 href=#__codelineno-105-1></a>bash-4.4$<span class=w> </span>ceph<span class=w> </span>-s
<a id=__codelineno-105-2 name=__codelineno-105-2 href=#__codelineno-105-2></a><span class=w>  </span>cluster:
<a id=__codelineno-105-3 name=__codelineno-105-3 href=#__codelineno-105-3></a><span class=w>    </span>id:<span class=w>     </span>80acf00a-a7e1-40fe-b6c2-30f546e519bb
<a id=__codelineno-105-4 name=__codelineno-105-4 href=#__codelineno-105-4></a><span class=w>    </span>health:<span class=w> </span>HEALTH_OK
<a id=__codelineno-105-5 name=__codelineno-105-5 href=#__codelineno-105-5></a>
<a id=__codelineno-105-6 name=__codelineno-105-6 href=#__codelineno-105-6></a><span class=w>  </span>services:
<a id=__codelineno-105-7 name=__codelineno-105-7 href=#__codelineno-105-7></a><span class=w>    </span>mon:<span class=w> </span><span class=m>3</span><span class=w> </span>daemons,<span class=w> </span>quorum<span class=w> </span>a,b,c<span class=w> </span><span class=o>(</span>age<span class=w> </span>20h<span class=o>)</span>
<a id=__codelineno-105-8 name=__codelineno-105-8 href=#__codelineno-105-8></a><span class=w>    </span>mgr:<span class=w> </span>a<span class=o>(</span>active,<span class=w> </span>since<span class=w> </span>20h<span class=o>)</span>,<span class=w> </span>standbys:<span class=w> </span>b
<a id=__codelineno-105-9 name=__codelineno-105-9 href=#__codelineno-105-9></a><span class=w>    </span>mds:<span class=w> </span><span class=m>1</span>/1<span class=w> </span>daemons<span class=w> </span>up,<span class=w> </span><span class=m>1</span><span class=w> </span>hot<span class=w> </span>standby
<a id=__codelineno-105-10 name=__codelineno-105-10 href=#__codelineno-105-10></a><span class=w>    </span>osd:<span class=w> </span><span class=m>3</span><span class=w> </span>osds:<span class=w> </span><span class=m>3</span><span class=w> </span>up<span class=w> </span><span class=o>(</span>since<span class=w> </span>20h<span class=o>)</span>,<span class=w> </span><span class=m>3</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=o>(</span>since<span class=w> </span>20h<span class=o>)</span>
<a id=__codelineno-105-11 name=__codelineno-105-11 href=#__codelineno-105-11></a>
<a id=__codelineno-105-12 name=__codelineno-105-12 href=#__codelineno-105-12></a><span class=w>  </span>data:
<a id=__codelineno-105-13 name=__codelineno-105-13 href=#__codelineno-105-13></a><span class=w>    </span>volumes:<span class=w> </span><span class=m>1</span>/1<span class=w> </span>healthy
<a id=__codelineno-105-14 name=__codelineno-105-14 href=#__codelineno-105-14></a><span class=w>    </span>pools:<span class=w>   </span><span class=m>4</span><span class=w> </span>pools,<span class=w> </span><span class=m>81</span><span class=w> </span>pgs
<a id=__codelineno-105-15 name=__codelineno-105-15 href=#__codelineno-105-15></a><span class=w>    </span>objects:<span class=w> </span><span class=m>39</span><span class=w> </span>objects,<span class=w> </span><span class=m>3</span>.7<span class=w> </span>MiB
<a id=__codelineno-105-16 name=__codelineno-105-16 href=#__codelineno-105-16></a><span class=w>    </span>usage:<span class=w>   </span><span class=m>149</span><span class=w> </span>MiB<span class=w> </span>used,<span class=w> </span><span class=m>1</span>.5<span class=w> </span>TiB<span class=w> </span>/<span class=w> </span><span class=m>1</span>.5<span class=w> </span>TiB<span class=w> </span>avail
<a id=__codelineno-105-17 name=__codelineno-105-17 href=#__codelineno-105-17></a><span class=w>    </span>pgs:<span class=w>     </span><span class=m>81</span><span class=w> </span>active+clean
<a id=__codelineno-105-18 name=__codelineno-105-18 href=#__codelineno-105-18></a>
<a id=__codelineno-105-19 name=__codelineno-105-19 href=#__codelineno-105-19></a><span class=w>  </span>io:
<a id=__codelineno-105-20 name=__codelineno-105-20 href=#__codelineno-105-20></a><span class=w>    </span>client:<span class=w>   </span><span class=m>852</span><span class=w> </span>B/s<span class=w> </span>rd,<span class=w> </span><span class=m>1</span><span class=w> </span>op/s<span class=w> </span>rd,<span class=w> </span><span class=m>0</span><span class=w> </span>op/s<span class=w> </span>wr
</code></pre></div> <p>使用<code>ceph osd lspools</code>查看，确认创建了<code>myfs-metadata</code>和<code>myfs-replicated</code>的存储池。</p> <div class=highlight><pre><span></span><code><a id=__codelineno-106-1 name=__codelineno-106-1 href=#__codelineno-106-1></a>bash-4.4$<span class=w> </span>ceph<span class=w> </span>osd<span class=w> </span>lspools
<a id=__codelineno-106-2 name=__codelineno-106-2 href=#__codelineno-106-2></a><span class=m>1</span><span class=w> </span>.mgr
<a id=__codelineno-106-3 name=__codelineno-106-3 href=#__codelineno-106-3></a><span class=m>3</span><span class=w> </span>replicapool
<a id=__codelineno-106-4 name=__codelineno-106-4 href=#__codelineno-106-4></a><span class=m>4</span><span class=w> </span>myfs-metadata
<a id=__codelineno-106-5 name=__codelineno-106-5 href=#__codelineno-106-5></a><span class=m>5</span><span class=w> </span>myfs-replicated
</code></pre></div> <h5 id=9422-cephfs-存储供给>9.4.2.2 CephFS 存储供给<a class=headerlink href=#9422-cephfs-存储供给 title="Permanent link">&para;</a></h5> <p>在 Rook 开始提供 CephFS 存储之前，需要基于文件系统创建一个 StorageClass。这对于 Kubernetes 与 CSI 驱动程序进行交互以创建持久卷是必需的。</p> <p>将以下存储类定义保存为 storageclass.yaml 文件：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-107-1 name=__codelineno-107-1 href=#__codelineno-107-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">storage.k8s.io/v1</span>
<a id=__codelineno-107-2 name=__codelineno-107-2 href=#__codelineno-107-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">StorageClass</span>
<a id=__codelineno-107-3 name=__codelineno-107-3 href=#__codelineno-107-3></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-107-4 name=__codelineno-107-4 href=#__codelineno-107-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rook-cephfs</span>
<a id=__codelineno-107-5 name=__codelineno-107-5 href=#__codelineno-107-5></a><span class=c1># Change &quot;rook-ceph&quot; provisioner prefix to match the operator namespace if needed</span>
<a id=__codelineno-107-6 name=__codelineno-107-6 href=#__codelineno-107-6></a><span class=nt>provisioner</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rook-ceph.cephfs.csi.ceph.com</span><span class=w> </span><span class=c1># driver:namespace:operator</span>
<a id=__codelineno-107-7 name=__codelineno-107-7 href=#__codelineno-107-7></a><span class=nt>parameters</span><span class=p>:</span>
<a id=__codelineno-107-8 name=__codelineno-107-8 href=#__codelineno-107-8></a><span class=w>  </span><span class=c1># clusterID is the namespace where the rook cluster is running</span>
<a id=__codelineno-107-9 name=__codelineno-107-9 href=#__codelineno-107-9></a><span class=w>  </span><span class=c1># If you change this namespace, also change the namespace below where the secret namespaces are defined</span>
<a id=__codelineno-107-10 name=__codelineno-107-10 href=#__codelineno-107-10></a><span class=w>  </span><span class=nt>clusterID</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rook-ceph</span><span class=w> </span><span class=c1># namespace:cluster</span>
<a id=__codelineno-107-11 name=__codelineno-107-11 href=#__codelineno-107-11></a>
<a id=__codelineno-107-12 name=__codelineno-107-12 href=#__codelineno-107-12></a><span class=w>  </span><span class=c1># CephFS filesystem name into which the volume shall be created</span>
<a id=__codelineno-107-13 name=__codelineno-107-13 href=#__codelineno-107-13></a><span class=w>  </span><span class=nt>fsName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">myfs</span>
<a id=__codelineno-107-14 name=__codelineno-107-14 href=#__codelineno-107-14></a>
<a id=__codelineno-107-15 name=__codelineno-107-15 href=#__codelineno-107-15></a><span class=w>  </span><span class=c1># Ceph pool into which the volume shall be created</span>
<a id=__codelineno-107-16 name=__codelineno-107-16 href=#__codelineno-107-16></a><span class=w>  </span><span class=c1># Required for provisionVolume: &quot;true&quot;</span>
<a id=__codelineno-107-17 name=__codelineno-107-17 href=#__codelineno-107-17></a><span class=w>  </span><span class=nt>pool</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">myfs-replicated</span>
<a id=__codelineno-107-18 name=__codelineno-107-18 href=#__codelineno-107-18></a>
<a id=__codelineno-107-19 name=__codelineno-107-19 href=#__codelineno-107-19></a><span class=w>  </span><span class=c1># The secrets contain Ceph admin credentials. These are generated automatically by the operator</span>
<a id=__codelineno-107-20 name=__codelineno-107-20 href=#__codelineno-107-20></a><span class=w>  </span><span class=c1># in the same namespace as the cluster.</span>
<a id=__codelineno-107-21 name=__codelineno-107-21 href=#__codelineno-107-21></a><span class=w>  </span><span class=nt>csi.storage.k8s.io/provisioner-secret-name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rook-csi-cephfs-provisioner</span>
<a id=__codelineno-107-22 name=__codelineno-107-22 href=#__codelineno-107-22></a><span class=w>  </span><span class=nt>csi.storage.k8s.io/provisioner-secret-namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rook-ceph</span><span class=w> </span><span class=c1># namespace:cluster</span>
<a id=__codelineno-107-23 name=__codelineno-107-23 href=#__codelineno-107-23></a><span class=w>  </span><span class=nt>csi.storage.k8s.io/controller-expand-secret-name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rook-csi-cephfs-provisioner</span>
<a id=__codelineno-107-24 name=__codelineno-107-24 href=#__codelineno-107-24></a><span class=w>  </span><span class=nt>csi.storage.k8s.io/controller-expand-secret-namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rook-ceph</span><span class=w> </span><span class=c1># namespace:cluster</span>
<a id=__codelineno-107-25 name=__codelineno-107-25 href=#__codelineno-107-25></a><span class=w>  </span><span class=nt>csi.storage.k8s.io/node-stage-secret-name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rook-csi-cephfs-node</span>
<a id=__codelineno-107-26 name=__codelineno-107-26 href=#__codelineno-107-26></a><span class=w>  </span><span class=nt>csi.storage.k8s.io/node-stage-secret-namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rook-ceph</span><span class=w> </span><span class=c1># namespace:cluster</span>
<a id=__codelineno-107-27 name=__codelineno-107-27 href=#__codelineno-107-27></a>
<a id=__codelineno-107-28 name=__codelineno-107-28 href=#__codelineno-107-28></a><span class=w>  </span><span class=c1># (optional) The driver can use either ceph-fuse (fuse) or ceph kernel client (kernel)</span>
<a id=__codelineno-107-29 name=__codelineno-107-29 href=#__codelineno-107-29></a><span class=w>  </span><span class=c1># If omitted, default volume mounter will be used - this is determined by probing for ceph-fuse</span>
<a id=__codelineno-107-30 name=__codelineno-107-30 href=#__codelineno-107-30></a><span class=w>  </span><span class=c1># or by setting the default mounter explicitly via --volumemounter command-line argument.</span>
<a id=__codelineno-107-31 name=__codelineno-107-31 href=#__codelineno-107-31></a><span class=w>  </span><span class=c1># mounter: kernel</span>
<a id=__codelineno-107-32 name=__codelineno-107-32 href=#__codelineno-107-32></a><span class=nt>reclaimPolicy</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Delete</span>
<a id=__codelineno-107-33 name=__codelineno-107-33 href=#__codelineno-107-33></a><span class=nt>allowVolumeExpansion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id=__codelineno-107-34 name=__codelineno-107-34 href=#__codelineno-107-34></a><span class=nt>mountOptions</span><span class=p>:</span>
<a id=__codelineno-107-35 name=__codelineno-107-35 href=#__codelineno-107-35></a><span class=w>  </span><span class=c1># uncomment the following line for debugging</span>
<a id=__codelineno-107-36 name=__codelineno-107-36 href=#__codelineno-107-36></a><span class=w>  </span><span class=c1>#- debug</span>
</code></pre></div> <p>如果你将 Rook Operator 部署在了一个与"rook-ceph"不同的命名空间中，请修改 provisioner 中的前缀以匹配你使用的命名空间。</p> <p>例如，如果 Rook Operator 运行在"rook-op"命名空间中，那么 provisioner 的值应该是<code>rook-op.rbd.csi.ceph.com</code>。</p> <p>创建存储类:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-108-1 name=__codelineno-108-1 href=#__codelineno-108-1></a>$<span class=w> </span>kubectl<span class=w> </span>create<span class=w> </span>-f<span class=w> </span>storageclass.yaml
<a id=__codelineno-108-2 name=__codelineno-108-2 href=#__codelineno-108-2></a>storageclass.storage.k8s.io/rook-cephfs<span class=w> </span>created
<a id=__codelineno-108-3 name=__codelineno-108-3 href=#__codelineno-108-3></a>
<a id=__codelineno-108-4 name=__codelineno-108-4 href=#__codelineno-108-4></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>sc<span class=w> </span>rook-cephfs
<a id=__codelineno-108-5 name=__codelineno-108-5 href=#__codelineno-108-5></a>NAME<span class=w>          </span>PROVISIONER<span class=w>                     </span>RECLAIMPOLICY<span class=w>   </span>VOLUMEBINDINGMODE<span class=w>   </span>ALLOWVOLUMEEXPANSION<span class=w>   </span>AGE
<a id=__codelineno-108-6 name=__codelineno-108-6 href=#__codelineno-108-6></a>rook-cephfs<span class=w>   </span>rook-ceph.cephfs.csi.ceph.com<span class=w>   </span>Delete<span class=w>          </span>Immediate<span class=w>           </span><span class=nb>true</span><span class=w>                   </span>4m39s
</code></pre></div> <h5 id=9423-关于配额>9.4.2.3 关于配额<a class=headerlink href=#9423-关于配额 title="Permanent link">&para;</a></h5> <p>CephFS CSI 驱动程序使用配额来强制执行所请求的 PVC 大小。只有较新的 Linux 内核支持 CephFS 配额，至少是 4.17 版本的内核。</p> <h5 id=9424-使用存储-多个-pod-挂载>9.4.2.4 使用存储: 多个 Pod 挂载<a class=headerlink href=#9424-使用存储-多个-pod-挂载 title="Permanent link">&para;</a></h5> <p>创建下面的 busybox.yaml:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-109-1 name=__codelineno-109-1 href=#__codelineno-109-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id=__codelineno-109-2 name=__codelineno-109-2 href=#__codelineno-109-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
<a id=__codelineno-109-3 name=__codelineno-109-3 href=#__codelineno-109-3></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-109-4 name=__codelineno-109-4 href=#__codelineno-109-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">busybox-data-pvc</span>
<a id=__codelineno-109-5 name=__codelineno-109-5 href=#__codelineno-109-5></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-109-6 name=__codelineno-109-6 href=#__codelineno-109-6></a><span class=w>  </span><span class=nt>accessModes</span><span class=p>:</span>
<a id=__codelineno-109-7 name=__codelineno-109-7 href=#__codelineno-109-7></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteMany</span>
<a id=__codelineno-109-8 name=__codelineno-109-8 href=#__codelineno-109-8></a><span class=w>  </span><span class=nt>resources</span><span class=p>:</span>
<a id=__codelineno-109-9 name=__codelineno-109-9 href=#__codelineno-109-9></a><span class=w>    </span><span class=nt>requests</span><span class=p>:</span>
<a id=__codelineno-109-10 name=__codelineno-109-10 href=#__codelineno-109-10></a><span class=w>      </span><span class=nt>storage</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">2Gi</span>
<a id=__codelineno-109-11 name=__codelineno-109-11 href=#__codelineno-109-11></a><span class=w>  </span><span class=nt>storageClassName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rook-cephfs</span>
<a id=__codelineno-109-12 name=__codelineno-109-12 href=#__codelineno-109-12></a>
<a id=__codelineno-109-13 name=__codelineno-109-13 href=#__codelineno-109-13></a><span class=nn>---</span>
<a id=__codelineno-109-14 name=__codelineno-109-14 href=#__codelineno-109-14></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<a id=__codelineno-109-15 name=__codelineno-109-15 href=#__codelineno-109-15></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<a id=__codelineno-109-16 name=__codelineno-109-16 href=#__codelineno-109-16></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-109-17 name=__codelineno-109-17 href=#__codelineno-109-17></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">busybox</span>
<a id=__codelineno-109-18 name=__codelineno-109-18 href=#__codelineno-109-18></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-109-19 name=__codelineno-109-19 href=#__codelineno-109-19></a><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<a id=__codelineno-109-20 name=__codelineno-109-20 href=#__codelineno-109-20></a><span class=w>  </span><span class=nt>selector</span><span class=p>:</span>
<a id=__codelineno-109-21 name=__codelineno-109-21 href=#__codelineno-109-21></a><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span>
<a id=__codelineno-109-22 name=__codelineno-109-22 href=#__codelineno-109-22></a><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">busybox</span>
<a id=__codelineno-109-23 name=__codelineno-109-23 href=#__codelineno-109-23></a><span class=w>  </span><span class=nt>template</span><span class=p>:</span>
<a id=__codelineno-109-24 name=__codelineno-109-24 href=#__codelineno-109-24></a><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-109-25 name=__codelineno-109-25 href=#__codelineno-109-25></a><span class=w>      </span><span class=nt>labels</span><span class=p>:</span>
<a id=__codelineno-109-26 name=__codelineno-109-26 href=#__codelineno-109-26></a><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">busybox</span>
<a id=__codelineno-109-27 name=__codelineno-109-27 href=#__codelineno-109-27></a><span class=w>    </span><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-109-28 name=__codelineno-109-28 href=#__codelineno-109-28></a><span class=w>      </span><span class=nt>containers</span><span class=p>:</span>
<a id=__codelineno-109-29 name=__codelineno-109-29 href=#__codelineno-109-29></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">busybox-container</span>
<a id=__codelineno-109-30 name=__codelineno-109-30 href=#__codelineno-109-30></a><span class=w>          </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">busybox:stable-glibc</span>
<a id=__codelineno-109-31 name=__codelineno-109-31 href=#__codelineno-109-31></a><span class=w>          </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;sleep&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;3600&quot;</span><span class="p p-Indicator">]</span>
<a id=__codelineno-109-32 name=__codelineno-109-32 href=#__codelineno-109-32></a><span class=w>          </span><span class=nt>volumeMounts</span><span class=p>:</span>
<a id=__codelineno-109-33 name=__codelineno-109-33 href=#__codelineno-109-33></a><span class=w>            </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">data-volume</span>
<a id=__codelineno-109-34 name=__codelineno-109-34 href=#__codelineno-109-34></a><span class=w>              </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/data</span>
<a id=__codelineno-109-35 name=__codelineno-109-35 href=#__codelineno-109-35></a><span class=w>      </span><span class=nt>volumes</span><span class=p>:</span>
<a id=__codelineno-109-36 name=__codelineno-109-36 href=#__codelineno-109-36></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">data-volume</span>
<a id=__codelineno-109-37 name=__codelineno-109-37 href=#__codelineno-109-37></a><span class=w>          </span><span class=nt>persistentVolumeClaim</span><span class=p>:</span>
<a id=__codelineno-109-38 name=__codelineno-109-38 href=#__codelineno-109-38></a><span class=w>            </span><span class=nt>claimName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">busybox-data-pvc</span>
</code></pre></div> <p>创建这个 busybox 的 deployment 和 pvc:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-110-1 name=__codelineno-110-1 href=#__codelineno-110-1></a>$<span class=w> </span>kubectl<span class=w> </span>apply<span class=w> </span>-f<span class=w> </span>busybox.yaml
<a id=__codelineno-110-2 name=__codelineno-110-2 href=#__codelineno-110-2></a>persistentvolumeclaim/busybox-data-pvc<span class=w> </span>created
<a id=__codelineno-110-3 name=__codelineno-110-3 href=#__codelineno-110-3></a>deployment.apps/busybox<span class=w> </span>created
</code></pre></div> <p>查看创建的 PVC 和自动供给的 PV:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-111-1 name=__codelineno-111-1 href=#__codelineno-111-1></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>pvc
<a id=__codelineno-111-2 name=__codelineno-111-2 href=#__codelineno-111-2></a>NAME<span class=w>                               </span>STATUS<span class=w>   </span>VOLUME<span class=w>                                     </span>CAPACITY<span class=w>   </span>ACCESS<span class=w> </span>MODES<span class=w>   </span>STORAGECLASS<span class=w>      </span>AGE
<a id=__codelineno-111-3 name=__codelineno-111-3 href=#__codelineno-111-3></a>busybox-data-pvc<span class=w>                   </span>Bound<span class=w>    </span>pvc-38fe93c8-c55b-4e18-b955-15a09dc45943<span class=w>   </span>2Gi<span class=w>        </span>RWX<span class=w>            </span>rook-cephfs<span class=w>       </span>21s
<a id=__codelineno-111-4 name=__codelineno-111-4 href=#__codelineno-111-4></a>
<a id=__codelineno-111-5 name=__codelineno-111-5 href=#__codelineno-111-5></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>pv
<a id=__codelineno-111-6 name=__codelineno-111-6 href=#__codelineno-111-6></a>NAME<span class=w>                                       </span>CAPACITY<span class=w>   </span>ACCESS<span class=w> </span>MODES<span class=w>   </span>RECLAIM<span class=w> </span>POLICY<span class=w>   </span>STATUS<span class=w>   </span>CLAIM<span class=w>                                        </span>STORAGECLASS<span class=w>      </span>REASON<span class=w>   </span>AGE
<a id=__codelineno-111-7 name=__codelineno-111-7 href=#__codelineno-111-7></a>pvc-38fe93c8-c55b-4e18-b955-15a09dc45943<span class=w>   </span>2Gi<span class=w>        </span>RWX<span class=w>            </span>Delete<span class=w>           </span>Bound<span class=w>    </span>rook-ceph/busybox-data-pvc<span class=w>                   </span>rook-cephfs<span class=w>                </span>25s
</code></pre></div> <p>查看 PV 的的具体信息:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-112-1 name=__codelineno-112-1 href=#__codelineno-112-1></a>$<span class=w> </span>kubectl<span class=w> </span>describe<span class=w> </span>pv<span class=w> </span>pvc-38fe93c8-c55b-4e18-b955-15a09dc45943
<a id=__codelineno-112-2 name=__codelineno-112-2 href=#__codelineno-112-2></a>Name:<span class=w>            </span>pvc-38fe93c8-c55b-4e18-b955-15a09dc45943
<a id=__codelineno-112-3 name=__codelineno-112-3 href=#__codelineno-112-3></a>Labels:<span class=w>          </span>&lt;none&gt;
<a id=__codelineno-112-4 name=__codelineno-112-4 href=#__codelineno-112-4></a>Annotations:<span class=w>     </span>pv.kubernetes.io/provisioned-by:<span class=w> </span>rook-ceph.cephfs.csi.ceph.com
<a id=__codelineno-112-5 name=__codelineno-112-5 href=#__codelineno-112-5></a><span class=w>                 </span>volume.kubernetes.io/provisioner-deletion-secret-name:<span class=w> </span>rook-csi-cephfs-provisioner
<a id=__codelineno-112-6 name=__codelineno-112-6 href=#__codelineno-112-6></a><span class=w>                 </span>volume.kubernetes.io/provisioner-deletion-secret-namespace:<span class=w> </span>rook-ceph
<a id=__codelineno-112-7 name=__codelineno-112-7 href=#__codelineno-112-7></a>Finalizers:<span class=w>      </span><span class=o>[</span>kubernetes.io/pv-protection<span class=o>]</span>
<a id=__codelineno-112-8 name=__codelineno-112-8 href=#__codelineno-112-8></a>StorageClass:<span class=w>    </span>rook-cephfs
<a id=__codelineno-112-9 name=__codelineno-112-9 href=#__codelineno-112-9></a>Status:<span class=w>          </span>Bound
<a id=__codelineno-112-10 name=__codelineno-112-10 href=#__codelineno-112-10></a>Claim:<span class=w>           </span>rook-ceph/busybox-data-pvc
<a id=__codelineno-112-11 name=__codelineno-112-11 href=#__codelineno-112-11></a>Reclaim<span class=w> </span>Policy:<span class=w>  </span>Delete
<a id=__codelineno-112-12 name=__codelineno-112-12 href=#__codelineno-112-12></a>Access<span class=w> </span>Modes:<span class=w>    </span>RWX
<a id=__codelineno-112-13 name=__codelineno-112-13 href=#__codelineno-112-13></a>VolumeMode:<span class=w>      </span>Filesystem
<a id=__codelineno-112-14 name=__codelineno-112-14 href=#__codelineno-112-14></a>Capacity:<span class=w>        </span>2Gi
<a id=__codelineno-112-15 name=__codelineno-112-15 href=#__codelineno-112-15></a>Node<span class=w> </span>Affinity:<span class=w>   </span>&lt;none&gt;
<a id=__codelineno-112-16 name=__codelineno-112-16 href=#__codelineno-112-16></a>Message:
<a id=__codelineno-112-17 name=__codelineno-112-17 href=#__codelineno-112-17></a>Source:
<a id=__codelineno-112-18 name=__codelineno-112-18 href=#__codelineno-112-18></a><span class=w>    </span>Type:<span class=w>              </span>CSI<span class=w> </span><span class=o>(</span>a<span class=w> </span>Container<span class=w> </span>Storage<span class=w> </span>Interface<span class=w> </span><span class=o>(</span>CSI<span class=o>)</span><span class=w> </span>volume<span class=w> </span><span class=nb>source</span><span class=o>)</span>
<a id=__codelineno-112-19 name=__codelineno-112-19 href=#__codelineno-112-19></a><span class=w>    </span>Driver:<span class=w>            </span>rook-ceph.cephfs.csi.ceph.com
<a id=__codelineno-112-20 name=__codelineno-112-20 href=#__codelineno-112-20></a><span class=w>    </span>FSType:
<a id=__codelineno-112-21 name=__codelineno-112-21 href=#__codelineno-112-21></a><span class=w>    </span>VolumeHandle:<span class=w>      </span><span class=m>0001</span>-0009-rook-ceph-0000000000000001-4f7108ef-5d3e-4763-b429-f2437c2db4c2
<a id=__codelineno-112-22 name=__codelineno-112-22 href=#__codelineno-112-22></a><span class=w>    </span>ReadOnly:<span class=w>          </span><span class=nb>false</span>
<a id=__codelineno-112-23 name=__codelineno-112-23 href=#__codelineno-112-23></a><span class=w>    </span>VolumeAttributes:<span class=w>      </span><span class=nv>clusterID</span><span class=o>=</span>rook-ceph
<a id=__codelineno-112-24 name=__codelineno-112-24 href=#__codelineno-112-24></a><span class=w>                           </span><span class=nv>fsName</span><span class=o>=</span>myfs
<a id=__codelineno-112-25 name=__codelineno-112-25 href=#__codelineno-112-25></a><span class=w>                           </span><span class=nv>pool</span><span class=o>=</span>myfs-replicated
<a id=__codelineno-112-26 name=__codelineno-112-26 href=#__codelineno-112-26></a><span class=w>                           </span>storage.kubernetes.io/csiProvisionerIdentity<span class=o>=</span><span class=m>1704338799133</span>-1100-rook-ceph.cephfs.csi.ceph.com
<a id=__codelineno-112-27 name=__codelineno-112-27 href=#__codelineno-112-27></a><span class=w>                           </span><span class=nv>subvolumeName</span><span class=o>=</span>csi-vol-4f7108ef-5d3e-4763-b429-f2437c2db4c2
<a id=__codelineno-112-28 name=__codelineno-112-28 href=#__codelineno-112-28></a><span class=w>                           </span><span class=nv>subvolumePath</span><span class=o>=</span>/volumes/csi/csi-vol-4f7108ef-5d3e-4763-b429-f2437c2db4c2/81a009f7-8e8c-471a-ae4c-4caf1b898e6d
<a id=__codelineno-112-29 name=__codelineno-112-29 href=#__codelineno-112-29></a>Events:<span class=w>                </span>&lt;none&gt;
</code></pre></div> <p>可以看到持久化卷挂载是 CephFS 实例 myfs 中的<code>/volumes/csi/csi-vol-4f7108ef-5d3e-4763-b429-f2437c2db4c2/81a009f7-8e8c-471a-ae4c-4caf1b898e6d</code>。</p> <h4 id=943-对象存储>9.4.3 对象存储<a class=headerlink href=#943-对象存储 title="Permanent link">&para;</a></h4> <p>TODO</p> <p>参考文章</p> <p><a href=https://blog.frognew.com/2023/06/rook-quick-start.html>使用 Rook 自动部署和管理 Ceph 集群 | 青蛙小白 (frognew.com)</a></p> <h2 id=fqa>FQA<a class=headerlink href=#fqa title="Permanent link">&para;</a></h2> <h3 id=rook-ceph-卸载重新部署>rook-ceph 卸载、重新部署<a class=headerlink href=#rook-ceph-卸载重新部署 title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-113-1 name=__codelineno-113-1 href=#__codelineno-113-1></a><span class=c1>#First: Uninstall the chart.</span>
<a id=__codelineno-113-2 name=__codelineno-113-2 href=#__codelineno-113-2></a>$<span class=w> </span>helm<span class=w> </span>uninstall<span class=w> </span>-n<span class=w> </span>rook-ceph<span class=w> </span>rook-ceph
<a id=__codelineno-113-3 name=__codelineno-113-3 href=#__codelineno-113-3></a>$<span class=w> </span>helm<span class=w> </span>-n<span class=w> </span>rook-ceph<span class=w> </span>uninstall<span class=w> </span>rook-ceph-cluster
<a id=__codelineno-113-4 name=__codelineno-113-4 href=#__codelineno-113-4></a>
<a id=__codelineno-113-5 name=__codelineno-113-5 href=#__codelineno-113-5></a>
<a id=__codelineno-113-6 name=__codelineno-113-6 href=#__codelineno-113-6></a><span class=c1>#Second: Delete the remains secrets and configmaps:</span>
<a id=__codelineno-113-7 name=__codelineno-113-7 href=#__codelineno-113-7></a>$<span class=w> </span>k<span class=w> </span>-n<span class=w> </span>rook-ceph<span class=w> </span>get<span class=w> </span>cm,secrets
<a id=__codelineno-113-8 name=__codelineno-113-8 href=#__codelineno-113-8></a>NOTE:<span class=w> </span>If<span class=w> </span>they<span class=w> </span>still<span class=w> </span>remain,<span class=w> </span>use<span class=w> </span>k<span class=w> </span>-n<span class=w> </span>rook-ceph<span class=w> </span>edit<span class=w> </span>cm/NAME<span class=w> </span>and<span class=w> </span>delete<span class=w> </span>the<span class=w> </span>finalizer<span class=w> </span>from<span class=w> </span>it,<span class=w> </span>save,<span class=w> </span>and<span class=w> </span>quit.
<a id=__codelineno-113-9 name=__codelineno-113-9 href=#__codelineno-113-9></a>
<a id=__codelineno-113-10 name=__codelineno-113-10 href=#__codelineno-113-10></a>
<a id=__codelineno-113-11 name=__codelineno-113-11 href=#__codelineno-113-11></a><span class=c1>#Third: Delete the Rook Resources itself:</span>
<a id=__codelineno-113-12 name=__codelineno-113-12 href=#__codelineno-113-12></a>$<span class=w> </span>k<span class=w> </span>-n<span class=w> </span>rook-ceph<span class=w> </span>delete<span class=w> </span>CephObjectStore<span class=w> </span>ceph-objectstore
<a id=__codelineno-113-13 name=__codelineno-113-13 href=#__codelineno-113-13></a>$<span class=w> </span>k<span class=w> </span>-n<span class=w> </span>rook-ceph<span class=w> </span>delete<span class=w> </span>CephFilesystem<span class=w> </span>ceph-filesystem
<a id=__codelineno-113-14 name=__codelineno-113-14 href=#__codelineno-113-14></a>$<span class=w> </span>k<span class=w> </span>-n<span class=w> </span>rook-ceph<span class=w> </span>delete<span class=w> </span>CephBlockPool<span class=w> </span>ceph-blockpool
<a id=__codelineno-113-15 name=__codelineno-113-15 href=#__codelineno-113-15></a>$<span class=w> </span>k<span class=w> </span>-n<span class=w> </span>rook-ceph<span class=w> </span>delete<span class=w> </span>CephBlockPool<span class=w> </span>rook-ceph
<a id=__codelineno-113-16 name=__codelineno-113-16 href=#__codelineno-113-16></a>
<a id=__codelineno-113-17 name=__codelineno-113-17 href=#__codelineno-113-17></a><span class=c1>#Fourth: Delete the Rook CRDs:</span>
<a id=__codelineno-113-18 name=__codelineno-113-18 href=#__codelineno-113-18></a>kubectl<span class=w> </span>delete<span class=w> </span>-f<span class=w> </span>rook/deploy/examples/crds.yaml
<a id=__codelineno-113-19 name=__codelineno-113-19 href=#__codelineno-113-19></a>NOTE:<span class=w> </span>If<span class=w> </span>they<span class=w> </span>still<span class=w> </span>remain,<span class=w> </span>use<span class=w> </span>the<span class=w> </span>below<span class=w> </span>command:
<a id=__codelineno-113-20 name=__codelineno-113-20 href=#__codelineno-113-20></a><span class=c1># 或者使用如下</span>
<a id=__codelineno-113-21 name=__codelineno-113-21 href=#__codelineno-113-21></a><span class=k>for</span><span class=w> </span>CRD<span class=w> </span><span class=k>in</span><span class=w> </span><span class=k>$(</span>kubectl<span class=w> </span>get<span class=w> </span>crd<span class=w> </span>-n<span class=w> </span>rook-ceph<span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span><span class=s1>&#39;/ceph.rook.io/ {print $1}&#39;</span><span class=k>)</span><span class=p>;</span><span class=w> </span><span class=k>do</span>
<a id=__codelineno-113-22 name=__codelineno-113-22 href=#__codelineno-113-22></a><span class=w>    </span>kubectl<span class=w> </span>get<span class=w> </span>-n<span class=w> </span>rook-ceph<span class=w> </span><span class=s2>&quot;</span><span class=nv>$CRD</span><span class=s2>&quot;</span><span class=w> </span>-o<span class=w> </span>name<span class=w> </span><span class=p>|</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-113-23 name=__codelineno-113-23 href=#__codelineno-113-23></a><span class=w>    </span>xargs<span class=w> </span>-I<span class=w> </span><span class=o>{}</span><span class=w> </span>kubectl<span class=w> </span>patch<span class=w> </span>-n<span class=w> </span>rook-ceph<span class=w> </span><span class=o>{}</span><span class=w> </span>--type<span class=w> </span>merge<span class=w> </span>-p<span class=w> </span><span class=s1>&#39;{&quot;metadata&quot;:{&quot;finalizers&quot;: []}}&#39;</span>
<a id=__codelineno-113-24 name=__codelineno-113-24 href=#__codelineno-113-24></a><span class=k>done</span>
<a id=__codelineno-113-25 name=__codelineno-113-25 href=#__codelineno-113-25></a>
<a id=__codelineno-113-26 name=__codelineno-113-26 href=#__codelineno-113-26></a><span class=c1># 如果出现删不掉使用如下</span>
<a id=__codelineno-113-27 name=__codelineno-113-27 href=#__codelineno-113-27></a>kubectl<span class=w> </span>patch<span class=w> </span>crd/NAME<span class=w> </span>-p<span class=w> </span><span class=s1>&#39;{&quot;metadata&quot;:{&quot;finalizers&quot;:[]}}&#39;</span><span class=w> </span>--type<span class=o>=</span>merge
<a id=__codelineno-113-28 name=__codelineno-113-28 href=#__codelineno-113-28></a>
<a id=__codelineno-113-29 name=__codelineno-113-29 href=#__codelineno-113-29></a>
<a id=__codelineno-113-30 name=__codelineno-113-30 href=#__codelineno-113-30></a><span class=c1># Finally: Delete /var/lib/rook on every worker node.</span>
<a id=__codelineno-113-31 name=__codelineno-113-31 href=#__codelineno-113-31></a>sudo<span class=w> </span>rm<span class=w> </span>-rf<span class=w> </span>/var/lib/rook
</code></pre></div> <h3 id=测试数据清理>测试数据清理<a class=headerlink href=#测试数据清理 title="Permanent link">&para;</a></h3> <p>如果 Rook 要继续使用，可以只清理创建的 deploy、pod、pvc 即可。之后可以直接投入使用。</p> <h4 id=数据删除步骤>数据删除步骤<a class=headerlink href=#数据删除步骤 title="Permanent link">&para;</a></h4> <p>数据清理步骤：</p> <ol> <li>首先清理挂载了 PVC 和 Pod，可能需要清理单独创建的 Pod 和 Deployment 或者是其他的高级资源</li> <li>之后清理 PVC，清理掉所有通过 ceph StorageClass 创建的 PVC 后，最好检查下 PV 是否被清理</li> <li>之后清理快照：<code>kubectl delete volumesnapshot XXXXXXXX</code></li> <li>之后清理创建的 Pool，包括块存储和文件存储</li> </ol> <div class=highlight><pre><span></span><code><a id=__codelineno-114-1 name=__codelineno-114-1 href=#__codelineno-114-1></a>$<span class=w> </span>kubectl<span class=w> </span>delete<span class=w> </span>-n<span class=w> </span>rook-ceph<span class=w> </span>cephblockpool<span class=w> </span>replicapool
<a id=__codelineno-114-2 name=__codelineno-114-2 href=#__codelineno-114-2></a>$<span class=w> </span>kubectl<span class=w> </span>delete<span class=w> </span>-n<span class=w> </span>rook-ceph<span class=w> </span>cephfilesystem<span class=w> </span>myfs
</code></pre></div> <ul> <li>清理 StorageClass：</li> </ul> <div class=highlight><pre><span></span><code><a id=__codelineno-115-1 name=__codelineno-115-1 href=#__codelineno-115-1></a>$<span class=w> </span>kubectl<span class=w> </span>delete<span class=w> </span>sc<span class=w> </span>rook-ceph-block<span class=w> </span>rook-cephfs
</code></pre></div> <ul> <li>清理 Ceph 集群：</li> </ul> <div class=highlight><pre><span></span><code><a id=__codelineno-116-1 name=__codelineno-116-1 href=#__codelineno-116-1></a>kubectl -n rook-ceph delete cephcluster rook-ceph
</code></pre></div> <ul> <li>删除 Rook 资源：</li> </ul> <div class=highlight><pre><span></span><code><a id=__codelineno-117-1 name=__codelineno-117-1 href=#__codelineno-117-1></a>$<span class=w> </span>kubectl<span class=w> </span>delete<span class=w> </span>-f<span class=w> </span>operator.yaml
<a id=__codelineno-117-2 name=__codelineno-117-2 href=#__codelineno-117-2></a>$<span class=w> </span>kubectl<span class=w> </span>delete<span class=w> </span>-f<span class=w> </span>common.yaml
<a id=__codelineno-117-3 name=__codelineno-117-3 href=#__codelineno-117-3></a>$<span class=w> </span>kubectl<span class=w> </span>delete<span class=w> </span>-f<span class=w> </span>crds.yaml
</code></pre></div> <p>1.如果卡住需要参考 Rook 的<a href=https://rook.io/docs/rook/v1.6/ceph-teardown.html#troubleshooting>troubleshooting</a></p> <div class=highlight><pre><span></span><code><a id=__codelineno-118-1 name=__codelineno-118-1 href=#__codelineno-118-1></a><span class=k>for</span><span class=w> </span>CRD<span class=w> </span><span class=k>in</span><span class=w> </span><span class=k>$(</span>kubectl<span class=w> </span>get<span class=w> </span>crd<span class=w> </span>-n<span class=w> </span>rook-ceph<span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span><span class=s1>&#39;/ceph.rook.io/ {print $1}&#39;</span><span class=k>)</span><span class=p>;</span>
<a id=__codelineno-118-2 name=__codelineno-118-2 href=#__codelineno-118-2></a><span class=k>do</span>
<a id=__codelineno-118-3 name=__codelineno-118-3 href=#__codelineno-118-3></a><span class=w>    </span>kubectl<span class=w> </span>get<span class=w> </span>-n<span class=w> </span>rook-ceph<span class=w> </span><span class=s2>&quot;</span><span class=nv>$CRD</span><span class=s2>&quot;</span><span class=w> </span>-o<span class=w> </span>name<span class=w> </span><span class=p>|</span><span class=w>   </span>xargs<span class=w> </span>-I<span class=w> </span><span class=o>{}</span><span class=w> </span>kubectl<span class=w> </span>patch<span class=w> </span><span class=o>{}</span><span class=w> </span>--type<span class=w> </span>merge<span class=w> </span>-p<span class=w> </span><span class=s1>&#39;{&quot;metadata&quot;:{&quot;finalizers&quot;: [null]}}&#39;</span><span class=w> </span>-n<span class=w> </span>rook-ceph<span class=p>;</span>
<a id=__codelineno-118-4 name=__codelineno-118-4 href=#__codelineno-118-4></a><span class=k>done</span>
</code></pre></div> <p>2.清理数据目录和磁盘</p> <p>参考链接：<a href=https://rook.io/docs/rook/v1.6/ceph-teardown.html#delete-the-data-on-hosts>https://rook.io/docs/rook/v1.6/ceph-teardown.html#delete-the-data-on-hosts</a></p> <p>参考链接：<a href=https://rook.io/docs/rook/v1.6/ceph-teardown.html>https://rook.io/docs/rook/v1.6/ceph-teardown.html</a></p> <div class=highlight><pre><span></span><code><a id=__codelineno-119-1 name=__codelineno-119-1 href=#__codelineno-119-1></a>kubectl<span class=w> </span>-n<span class=w> </span>rook-ceph<span class=w> </span>patch<span class=w> </span>configmap<span class=w> </span>rook-ceph-mon-endpoints<span class=w> </span>--type<span class=w> </span>merge<span class=w> </span>-p<span class=w> </span><span class=s1>&#39;{&quot;metadata&quot;:{&quot;finalizers&quot;: [null]}}&#39;</span>
<a id=__codelineno-119-2 name=__codelineno-119-2 href=#__codelineno-119-2></a>kubectl<span class=w> </span>-n<span class=w> </span>rook-ceph<span class=w> </span>patch<span class=w> </span>secrets<span class=w> </span>rook-ceph-mon<span class=w> </span>--type<span class=w> </span>merge<span class=w> </span>-p<span class=w> </span><span class=s1>&#39;{&quot;metadata&quot;:{&quot;finalizers&quot;: [null]}}&#39;</span>
</code></pre></div> <h4 id=删除-ceph-pool-存储池>删除 ceph pool 存储池<a class=headerlink href=#删除-ceph-pool-存储池 title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><a id=__codelineno-120-1 name=__codelineno-120-1 href=#__codelineno-120-1></a>kubectl<span class=w> </span>-n<span class=w> </span>rook-ceph<span class=w> </span><span class=nb>exec</span><span class=w> </span>-it<span class=w> </span>deploy/rook-ceph-tools<span class=w> </span>--<span class=w> </span>bash
<a id=__codelineno-120-2 name=__codelineno-120-2 href=#__codelineno-120-2></a>bash-4.4$<span class=w> </span>ceph<span class=w> </span>fs<span class=w> </span>status
<a id=__codelineno-120-3 name=__codelineno-120-3 href=#__codelineno-120-3></a>myfs<span class=w> </span>-<span class=w> </span><span class=m>0</span><span class=w> </span><span class=nv>clients</span>
<a id=__codelineno-120-4 name=__codelineno-120-4 href=#__codelineno-120-4></a><span class=o>====</span>
<a id=__codelineno-120-5 name=__codelineno-120-5 href=#__codelineno-120-5></a>RANK<span class=w>  </span>STATE<span class=w>   </span>MDS<span class=w>  </span>ACTIVITY<span class=w>  </span>DNS<span class=w>  </span>INOS<span class=w>  </span>DIRS<span class=w>  </span>CAPS
<a id=__codelineno-120-6 name=__codelineno-120-6 href=#__codelineno-120-6></a><span class=w> </span><span class=m>0</span><span class=w>    </span>failed
<a id=__codelineno-120-7 name=__codelineno-120-7 href=#__codelineno-120-7></a><span class=w>      </span>POOL<span class=w>         </span>TYPE<span class=w>     </span>USED<span class=w>  </span>AVAIL
<a id=__codelineno-120-8 name=__codelineno-120-8 href=#__codelineno-120-8></a><span class=w> </span>myfs-metadata<span class=w>   </span>metadata<span class=w>  </span>1632k<span class=w>   </span>474G
<a id=__codelineno-120-9 name=__codelineno-120-9 href=#__codelineno-120-9></a>myfs-replicated<span class=w>    </span>data<span class=w>       </span><span class=m>0</span><span class=w>    </span>474G
<a id=__codelineno-120-10 name=__codelineno-120-10 href=#__codelineno-120-10></a>bash-4.4$<span class=w> </span>ceph<span class=w> </span>fs<span class=w> </span><span class=nb>set</span><span class=w> </span>myfs<span class=w> </span>down<span class=w> </span><span class=nb>true</span>
<a id=__codelineno-120-11 name=__codelineno-120-11 href=#__codelineno-120-11></a>myfs<span class=w> </span>marked<span class=w> </span>down.
<a id=__codelineno-120-12 name=__codelineno-120-12 href=#__codelineno-120-12></a>
<a id=__codelineno-120-13 name=__codelineno-120-13 href=#__codelineno-120-13></a>bash-4.4$<span class=w> </span>ceph<span class=w> </span>fs<span class=w> </span>status
<a id=__codelineno-120-14 name=__codelineno-120-14 href=#__codelineno-120-14></a>myfs<span class=w> </span>-<span class=w> </span><span class=m>0</span><span class=w> </span><span class=nv>clients</span>
<a id=__codelineno-120-15 name=__codelineno-120-15 href=#__codelineno-120-15></a><span class=o>====</span>
<a id=__codelineno-120-16 name=__codelineno-120-16 href=#__codelineno-120-16></a>RANK<span class=w>  </span>STATE<span class=w>   </span>MDS<span class=w>  </span>ACTIVITY<span class=w>  </span>DNS<span class=w>  </span>INOS<span class=w>  </span>DIRS<span class=w>  </span>CAPS
<a id=__codelineno-120-17 name=__codelineno-120-17 href=#__codelineno-120-17></a><span class=w> </span><span class=m>0</span><span class=w>    </span>failed
<a id=__codelineno-120-18 name=__codelineno-120-18 href=#__codelineno-120-18></a><span class=w>      </span>POOL<span class=w>         </span>TYPE<span class=w>     </span>USED<span class=w>  </span>AVAIL
<a id=__codelineno-120-19 name=__codelineno-120-19 href=#__codelineno-120-19></a><span class=w> </span>myfs-metadata<span class=w>   </span>metadata<span class=w>  </span>1632k<span class=w>   </span>474G
<a id=__codelineno-120-20 name=__codelineno-120-20 href=#__codelineno-120-20></a>myfs-replicated<span class=w>    </span>data<span class=w>       </span><span class=m>0</span><span class=w>    </span>474G
<a id=__codelineno-120-21 name=__codelineno-120-21 href=#__codelineno-120-21></a>
<a id=__codelineno-120-22 name=__codelineno-120-22 href=#__codelineno-120-22></a>bash-4.4$<span class=w> </span>ceph<span class=w> </span>fs<span class=w> </span>rm<span class=w> </span>myfs<span class=w> </span>--yes-i-really-mean-it
<a id=__codelineno-120-23 name=__codelineno-120-23 href=#__codelineno-120-23></a>bash-4.4$<span class=w> </span>ceph<span class=w> </span>fs<span class=w> </span>status
<a id=__codelineno-120-24 name=__codelineno-120-24 href=#__codelineno-120-24></a>bash-4.4$<span class=w> </span>ceph<span class=w> </span>osd<span class=w> </span>pool<span class=w> </span>ls
<a id=__codelineno-120-25 name=__codelineno-120-25 href=#__codelineno-120-25></a>.mgr
<a id=__codelineno-120-26 name=__codelineno-120-26 href=#__codelineno-120-26></a>replicapool
<a id=__codelineno-120-27 name=__codelineno-120-27 href=#__codelineno-120-27></a>myfs-metadata
<a id=__codelineno-120-28 name=__codelineno-120-28 href=#__codelineno-120-28></a>myfs-replicated
<a id=__codelineno-120-29 name=__codelineno-120-29 href=#__codelineno-120-29></a>
<a id=__codelineno-120-30 name=__codelineno-120-30 href=#__codelineno-120-30></a>bash-4.4$<span class=w> </span>ceph<span class=w> </span>osd<span class=w> </span>pool<span class=w> </span>delete<span class=w> </span>myfs-metadata<span class=w> </span>myfs-metadata<span class=w> </span>--yes-i-really-really-mean-it
<a id=__codelineno-120-31 name=__codelineno-120-31 href=#__codelineno-120-31></a>pool<span class=w> </span><span class=s1>&#39;myfs-metadata&#39;</span><span class=w> </span>removed
<a id=__codelineno-120-32 name=__codelineno-120-32 href=#__codelineno-120-32></a>
<a id=__codelineno-120-33 name=__codelineno-120-33 href=#__codelineno-120-33></a>bash-4.4$<span class=w> </span>ceph<span class=w> </span>osd<span class=w> </span>pool<span class=w> </span>delete<span class=w> </span>myfs-replicated<span class=w> </span>myfs-replicated<span class=w> </span>--yes-i-really-really-mean-it
<a id=__codelineno-120-34 name=__codelineno-120-34 href=#__codelineno-120-34></a>pool<span class=w> </span><span class=s1>&#39;myfs-replicated&#39;</span><span class=w> </span>removed
<a id=__codelineno-120-35 name=__codelineno-120-35 href=#__codelineno-120-35></a>
<a id=__codelineno-120-36 name=__codelineno-120-36 href=#__codelineno-120-36></a>bash-4.4$<span class=w> </span>ceph<span class=w> </span>fs<span class=w> </span>status
<a id=__codelineno-120-37 name=__codelineno-120-37 href=#__codelineno-120-37></a>bash-4.4$<span class=w> </span>ceph<span class=w> </span>-s
</code></pre></div> <p>参考：</p> <p><a href=https://access.redhat.com/documentation/zh-cn/red_hat_ceph_storage/4/html/file_system_guide/removing-a-ceph-file-system-using-the-command-line-interface_fs#doc-wrapper>4.12. 使用命令行界面删除 Ceph 文件系统 Red Hat Ceph Storage 4 | Red Hat Customer Portal</a></p> <h4 id=删除-rbd-硬盘>删除 rbd 硬盘<a class=headerlink href=#删除-rbd-硬盘 title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><a id=__codelineno-121-1 name=__codelineno-121-1 href=#__codelineno-121-1></a>bash-4.4$<span class=w> </span>rbd<span class=w> </span>ls<span class=w> </span>-p<span class=w> </span>replicapool
<a id=__codelineno-121-2 name=__codelineno-121-2 href=#__codelineno-121-2></a>csi-vol-5e4e1cd5-d889-4705-9575-c65f0e0b4d01
<a id=__codelineno-121-3 name=__codelineno-121-3 href=#__codelineno-121-3></a>
<a id=__codelineno-121-4 name=__codelineno-121-4 href=#__codelineno-121-4></a>bash-4.4$<span class=w> </span>rbd<span class=w> </span>rm<span class=w> </span>replicapool/csi-vol-5e4e1cd5-d889-4705-9575-c65f0e0b4d01
<a id=__codelineno-121-5 name=__codelineno-121-5 href=#__codelineno-121-5></a>Removing<span class=w> </span>image:<span class=w> </span><span class=m>100</span>%<span class=w> </span>complete...done.
</code></pre></div> <h4 id=ceph-集群报daemons-have-recently-crashed问题处理>ceph 集群报"daemons have recently crashed"问题处理<a class=headerlink href=#ceph-集群报daemons-have-recently-crashed问题处理 title="Permanent link">&para;</a></h4> <p>1.产生该问题的原因是数据在均衡或者回滚等操作的时候，导致其某个守护进程崩溃了，且没有及时归档，所以集群产生告警。</p> <p>2.解决办法</p> <div class=highlight><pre><span></span><code><a id=__codelineno-122-1 name=__codelineno-122-1 href=#__codelineno-122-1></a>$<span class=w> </span>ceph<span class=w> </span>crash<span class=w> </span>ls
<a id=__codelineno-122-2 name=__codelineno-122-2 href=#__codelineno-122-2></a>$<span class=w> </span>ceph<span class=w> </span>crash<span class=w> </span>archive<span class=w> </span>&lt;id&gt;
<a id=__codelineno-122-3 name=__codelineno-122-3 href=#__codelineno-122-3></a>OR
<a id=__codelineno-122-4 name=__codelineno-122-4 href=#__codelineno-122-4></a>$<span class=w> </span>ceph<span class=w> </span>crash<span class=w> </span>archive-all
</code></pre></div> <p>３.查看集群状态</p> <div class=highlight><pre><span></span><code><a id=__codelineno-123-1 name=__codelineno-123-1 href=#__codelineno-123-1></a>$<span class=w> </span>ceph<span class=w> </span>-s
</code></pre></div> <h2 id=参考文档_1>参考文档<a class=headerlink href=#参考文档_1 title="Permanent link">&para;</a></h2> <p>rook 的 GitHub 地址：<a href=https://github.com/rook/rook>https://github.com/rook/rook</a></p> <p><a href=https://rook.io/docs/rook/latest/Getting-Started/quickstart/#create-a-ceph-cluster>Quickstart - Rook Ceph Documentation</a></p> <p><a href=https://blog.frognew.com/2023/12/rook-1.13-deploy.html#2部署rook-operator>Rook 1.13 部署指南: 使用 Rook 1.13 部署和管理 Ceph(Reef) 18.2.1 | 青蛙小白 (frognew.com)</a></p> <p><a href=https://blog.frognew.com/2023/06/rook-quick-start.html>使用 Rook 自动部署和管理 Ceph 集群 | 青蛙小白 (frognew.com)</a></p> <p><a href=https://www.cnblogs.com/layzer/articles/rook_notes.html>Rook 云原生存储 - Layzer - 博客园 (cnblogs.com)</a></p> <p><a href=https://isekiro.com/kubernetes应用-rook-ceph集群内部署/#cephfs>kubernetes 应用-rook ceph 集群内部署 - 可乐去冰 (isekiro.com)</a></p> <p><a href=https://www.cnblogs.com/deny/p/14239635.html>Kubernetes 安装 Rook-ceph 1.3.11 - 流年晕开时光 - 博客园 (cnblogs.com)</a></p> <p><a href=https://www.cnblogs.com/bixiaoyu/p/16135309.html>基于现有 Kubernetes 集群使用 Rook 部署 Ceph 集群</a></p> <p><a href=https://www.cnblogs.com/wsjhk/p/13710569.html>【原创】K8S 使用 ceph-csi 持久化存储之 RBD - wsjhk - 博客园 (cnblogs.com)</a></p> <p><a href=https://www.cnblogs.com/skyflask/p/16844097.html#_caption_8>K8S 进阶篇-云原生存储进阶 Rook - skyflask - 博客园 (cnblogs.com)</a></p> <p><a href=https://www.cnblogs.com/hahaha111122222/p/14842496.html>k8s 集群中安装 rook-ceph - 哈喽哈喽 111111 - 博客园 (cnblogs.com)</a></p> <p><a href=https://www.putianhui.cn/posts/07bbf6bfd606/ >Helm3 通过 Rook 安装 Ceph 集群 | Mr.Pu 个站博客 (putianhui.cn)</a></p> <p><a href=https://www.putianhui.cn/posts/b0b8b25fba89/ >Ceph 常用命令详解 | Mr.Pu 个站博客 (putianhui.cn)</a></p> <p><a href=https://www.jianshu.com/p/87a006bca19b>Rook v1.11.2 operator 部署 Ceph - 简书 (jianshu.com)</a></p> <p><a href=https://developer.aliyun.com/article/1256382>Kuberntes 云原生实战六 使用 Rook 搭建 Ceph 集群-阿里云开发者社区 (aliyun.com)</a></p> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title=最后更新> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1-2.1-2M12.5 7v5.2l4 2.4-1 1L11 13V7h1.5M11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2v1.8Z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime">February 26, 2024 18:23:09</span> </span> <span class=md-source-file__fact> <span class=md-icon title=创建日期> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3h-2Z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime">March 23, 2023 18:59:28</span> </span> </aside> <form class=md-feedback name=feedback hidden> <fieldset> <legend class=md-feedback__title> Was this page helpful? </legend> <div class=md-feedback__inner> <div class=md-feedback__list> <button class="md-feedback__icon md-icon" type=submit title="This page was helpful" data-md-value=1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m7 0c0 .8-.7 1.5-1.5 1.5S14 10.3 14 9.5 14.7 8 15.5 8s1.5.7 1.5 1.5m-5 7.73c-1.75 0-3.29-.73-4.19-1.81L9.23 14c.45.72 1.52 1.23 2.77 1.23s2.32-.51 2.77-1.23l1.42 1.42c-.9 1.08-2.44 1.81-4.19 1.81Z"/></svg> </button> <button class="md-feedback__icon md-icon" type=submit title="This page could be improved" data-md-value=0> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10m-6.5-4c.8 0 1.5.7 1.5 1.5s-.7 1.5-1.5 1.5-1.5-.7-1.5-1.5.7-1.5 1.5-1.5M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m2 4.5c1.75 0 3.29.72 4.19 1.81l-1.42 1.42C14.32 16.5 13.25 16 12 16s-2.32.5-2.77 1.23l-1.42-1.42C8.71 14.72 10.25 14 12 14Z"/></svg> </button> </div> <div class=md-feedback__note> <div data-md-value=1 hidden> Thanks for your feedback! </div> <div data-md-value=0 hidden> Thanks for your feedback! Help us improve this page by using our <a href="https://github.com/hujianli94/hujianli94.github.io/issues/new/?title=[Feedback]+%E4%BA%91%E5%8E%9F%E7%94%9F%E5%AD%98%E5%82%A8Rook+-+/Kubernetes/4.%E9%AB%98%E7%BA%A7%E7%AF%87/12.%E4%BA%91%E5%8E%9F%E7%94%9F%E5%AD%98%E5%82%A8Rook/" target=_blank>feedback form</a>. </div> </div> </div> </fieldset> </form> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> 回到页面顶部 </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=页脚> <a href=../../3.%E8%BF%9B%E9%98%B6%E7%AF%87/9.Kubernetes%E9%AB%98%E7%BA%A7%E8%B0%83%E5%BA%A6/ class="md-footer__link md-footer__link--prev" aria-label="上一页: Kubernetes高级调度"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> 上一页 </span> <div class=md-ellipsis> Kubernetes高级调度 </div> </div> </a> <a href=../13.%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%AE%B9%E5%99%A8%E5%8C%96/ class="md-footer__link md-footer__link--next" aria-label="下一页: 中间件容器化"> <div class=md-footer__title> <span class=md-footer__direction> 下一页 </span> <div class=md-ellipsis> 中间件容器化 </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2023 - 2024 hujainli94 </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/hujianli94 target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> <a href=https://kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com/blog_img/20220125122524.png target=_blank rel=noopener title=kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 576 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M385.2 167.6c6.4 0 12.6.3 18.8 1.1C387.4 90.3 303.3 32 207.7 32 100.5 32 13 104.8 13 197.4c0 53.4 29.3 97.5 77.9 131.6l-19.3 58.6 68-34.1c24.4 4.8 43.8 9.7 68.2 9.7 6.2 0 12.1-.3 18.3-.8-4-12.9-6.2-26.6-6.2-40.8-.1-84.9 72.9-154 165.3-154zm-104.5-52.9c14.5 0 24.2 9.7 24.2 24.4 0 14.5-9.7 24.2-24.2 24.2-14.8 0-29.3-9.7-29.3-24.2.1-14.7 14.6-24.4 29.3-24.4zm-136.4 48.6c-14.5 0-29.3-9.7-29.3-24.2 0-14.8 14.8-24.4 29.3-24.4 14.8 0 24.4 9.7 24.4 24.4 0 14.6-9.6 24.2-24.4 24.2zM563 319.4c0-77.9-77.9-141.3-165.4-141.3-92.7 0-165.4 63.4-165.4 141.3S305 460.7 397.6 460.7c19.3 0 38.9-5.1 58.6-9.9l53.4 29.3-14.8-48.6C534 402.1 563 363.2 563 319.4zm-219.1-24.5c-9.7 0-19.3-9.7-19.3-19.6 0-9.7 9.7-19.3 19.3-19.3 14.8 0 24.4 9.7 24.4 19.3 0 10-9.7 19.6-24.4 19.6zm107.1 0c-9.7 0-19.3-9.7-19.3-19.6 0-9.7 9.7-19.3 19.3-19.3 14.5 0 24.4 9.7 24.4 19.3.1 10-9.9 19.6-24.4 19.6z"/></svg> </a> <a href="mailto:<1879324764@qq.com>" target=_blank rel=noopener title=发送邮件 class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M498.1 5.6c10.1 7 15.4 19.1 13.5 31.2l-64 416c-1.5 9.7-7.4 18.2-16 23s-18.9 5.4-28 1.6L284 427.7l-68.5 74.1c-8.9 9.7-22.9 12.9-35.2 8.1S160 493.2 160 480v-83.6c0-4 1.5-7.8 4.2-10.7l167.6-182.9c5.8-6.3 5.6-16-.4-22s-15.7-6.4-22-.7L106 360.8l-88.3-44.2C7.1 311.3.3 300.7 0 288.9s5.9-22.8 16.1-28.7l448-256c10.7-6.1 23.9-5.5 34 1.4z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-consent data-md-component=consent id=__consent hidden> <div class=md-consent__overlay></div> <aside class=md-consent__inner> <form class="md-consent__form md-grid md-typeset" name=consent> <h4>Cookie consent</h4> <p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p> <input class=md-toggle type=checkbox id=__settings> <div class=md-consent__settings> <ul class=task-list> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=analytics checked> <span class=task-list-indicator></span> Google Analytics </label> </li> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=github checked> <span class=task-list-indicator></span> GitHub </label> </li> </ul> </div> <div class=md-consent__controls> <button class="md-button md-button--primary">同意</button> <label class=md-button for=__settings>管理设定</label> </div> </form> </aside> </div> <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout(function(){document.querySelector("[data-md-component=consent]").hidden=!1},250);var action,form=document.forms.consent;for(action of["submit","reset"])form.addEventListener(action,function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map(function(e){return[e,!0]}))),location.hash="",location.reload()})</script> <script id=__config type=application/json>{"base": "../../..", "features": ["content.action.edit", "content.action.view", "content.code.copy", "content.code.annotate", "navigation.indexes", "navigation.footer", "navigation.indexes", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest"], "search": "../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script> <script src=../../../assets/javascripts/bundle.a7c05c9e.min.js></script> <script src=../../../javascripts/extra.js></script> <script src=https://file.cdn.shafish.cn/blog/js/video.min.js></script> </body> </html>