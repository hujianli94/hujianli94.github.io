<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="stay hungry,stay foolish"><meta name=author content=hujainli94><link href=https://hujianli94.github.io/Kubernetes/3.%E8%BF%9B%E9%98%B6%E7%AF%87/8.Kubernetes%E5%AD%98%E5%82%A8%E5%85%A5%E9%97%A8/ rel=canonical><link href=../../2.%E5%9F%BA%E7%A1%80%E7%AF%87/7.Kubernetes%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/ rel=prev><link href=../9.Kubernetes%E9%AB%98%E7%BA%A7%E8%B0%83%E5%BA%A6/ rel=next><link rel=icon href=../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.5.3, mkdocs-material-9.4.6"><title>Kubernetes存储入门 - DevOps运维开发</title><link rel=stylesheet href=../../../assets/stylesheets/main.35e1ed30.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.356b1318.min.css><style>:root{--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M1 7.775V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 0 1 0 2.474l-5.026 5.026a1.75 1.75 0 0 1-2.474 0l-6.25-6.25A1.752 1.752 0 0 1 1 7.775Zm1.5 0c0 .066.026.13.073.177l6.25 6.25a.25.25 0 0 0 .354 0l5.025-5.025a.25.25 0 0 0 0-.354l-6.25-6.25a.25.25 0 0 0-.177-.073H2.75a.25.25 0 0 0-.25.25ZM6 5a1 1 0 1 1 0 2 1 1 0 0 1 0-2Z"/></svg>');--md-admonition-icon--abstract:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M2.5 1.75v11.5c0 .138.112.25.25.25h3.17a.75.75 0 0 1 0 1.5H2.75A1.75 1.75 0 0 1 1 13.25V1.75C1 .784 1.784 0 2.75 0h8.5C12.216 0 13 .784 13 1.75v7.736a.75.75 0 0 1-1.5 0V1.75a.25.25 0 0 0-.25-.25h-8.5a.25.25 0 0 0-.25.25Zm13.274 9.537v-.001l-4.557 4.45a.75.75 0 0 1-1.055-.008l-1.943-1.95a.75.75 0 0 1 1.062-1.058l1.419 1.425 4.026-3.932a.75.75 0 1 1 1.048 1.074ZM4.75 4h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM4 7.75A.75.75 0 0 1 4.75 7h2a.75.75 0 0 1 0 1.5h-2A.75.75 0 0 1 4 7.75Z"/></svg>');--md-admonition-icon--info:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"/></svg>');--md-admonition-icon--tip:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M3.499.75a.75.75 0 0 1 1.5 0v.996C5.9 2.903 6.793 3.65 7.662 4.376l.24.202c-.036-.694.055-1.422.426-2.163C9.1.873 10.794-.045 12.622.26 14.408.558 16 1.94 16 4.25c0 1.278-.954 2.575-2.44 2.734l.146.508.065.22c.203.701.412 1.455.476 2.226.142 1.707-.4 3.03-1.487 3.898C11.714 14.671 10.27 15 8.75 15h-6a.75.75 0 0 1 0-1.5h1.376a4.484 4.484 0 0 1-.563-1.191 3.835 3.835 0 0 1-.05-2.063 4.647 4.647 0 0 1-2.025-.293.75.75 0 0 1 .525-1.406c1.357.507 2.376-.006 2.698-.318l.009-.01a.747.747 0 0 1 1.06 0 .748.748 0 0 1-.012 1.074c-.912.92-.992 1.835-.768 2.586.221.74.745 1.337 1.196 1.621H8.75c1.343 0 2.398-.296 3.074-.836.635-.507 1.036-1.31.928-2.602-.05-.603-.216-1.224-.422-1.93l-.064-.221c-.12-.407-.246-.84-.353-1.29a2.425 2.425 0 0 1-.507-.441 3.075 3.075 0 0 1-.633-1.248.75.75 0 0 1 1.455-.364c.046.185.144.436.31.627.146.168.353.305.712.305.738 0 1.25-.615 1.25-1.25 0-1.47-.95-2.315-2.123-2.51-1.172-.196-2.227.387-2.706 1.345-.46.92-.27 1.774.019 3.062l.042.19a.884.884 0 0 1 .01.05c.348.443.666.949.94 1.553a.75.75 0 1 1-1.365.62c-.553-1.217-1.32-1.94-2.3-2.768L6.7 5.527c-.814-.68-1.75-1.462-2.692-2.619a3.737 3.737 0 0 0-1.023.88c-.406.495-.663 1.036-.722 1.508.116.122.306.21.591.239.388.038.797-.06 1.032-.19a.75.75 0 0 1 .728 1.31c-.515.287-1.23.439-1.906.373-.682-.067-1.473-.38-1.879-1.193L.75 5.677V5.5c0-.984.48-1.94 1.077-2.664.46-.559 1.05-1.055 1.673-1.353V.75Z"/></svg>');--md-admonition-icon--success:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"/></svg>');--md-admonition-icon--question:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.92 6.085h.001a.749.749 0 1 1-1.342-.67c.169-.339.436-.701.849-.977C6.845 4.16 7.369 4 8 4a2.756 2.756 0 0 1 1.637.525c.503.377.863.965.863 1.725 0 .448-.115.83-.329 1.15-.205.307-.47.513-.692.662-.109.072-.22.138-.313.195l-.006.004a6.24 6.24 0 0 0-.26.16.952.952 0 0 0-.276.245.75.75 0 0 1-1.248-.832c.184-.264.42-.489.692-.661.103-.067.207-.132.313-.195l.007-.004c.1-.061.182-.11.258-.161a.969.969 0 0 0 .277-.245C8.96 6.514 9 6.427 9 6.25a.612.612 0 0 0-.262-.525A1.27 1.27 0 0 0 8 5.5c-.369 0-.595.09-.74.187a1.01 1.01 0 0 0-.34.398ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"/></svg>');--md-admonition-icon--warning:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"/></svg>');--md-admonition-icon--failure:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M2.344 2.343h-.001a8 8 0 0 1 11.314 11.314A8.002 8.002 0 0 1 .234 10.089a8 8 0 0 1 2.11-7.746Zm1.06 10.253a6.5 6.5 0 1 0 9.108-9.275 6.5 6.5 0 0 0-9.108 9.275ZM6.03 4.97 8 6.94l1.97-1.97a.749.749 0 0 1 1.275.326.749.749 0 0 1-.215.734L9.06 8l1.97 1.97a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215L8 9.06l-1.97 1.97a.749.749 0 0 1-1.275-.326.749.749 0 0 1 .215-.734L6.94 8 4.97 6.03a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018Z"/></svg>');--md-admonition-icon--danger:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M9.504.43a1.516 1.516 0 0 1 2.437 1.713L10.415 5.5h2.123c1.57 0 2.346 1.909 1.22 3.004l-7.34 7.142a1.249 1.249 0 0 1-.871.354h-.302a1.25 1.25 0 0 1-1.157-1.723L5.633 10.5H3.462c-1.57 0-2.346-1.909-1.22-3.004L9.503.429Zm1.047 1.074L3.286 8.571A.25.25 0 0 0 3.462 9H6.75a.75.75 0 0 1 .694 1.034l-1.713 4.188 6.982-6.793A.25.25 0 0 0 12.538 7H9.25a.75.75 0 0 1-.683-1.06l2.008-4.418.003-.006a.036.036 0 0 0-.004-.009l-.006-.006-.008-.001c-.003 0-.006.002-.009.004Z"/></svg>');--md-admonition-icon--bug:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M4.72.22a.75.75 0 0 1 1.06 0l1 .999a3.488 3.488 0 0 1 2.441 0l.999-1a.748.748 0 0 1 1.265.332.75.75 0 0 1-.205.729l-.775.776c.616.63.995 1.493.995 2.444v.327c0 .1-.009.197-.025.292.408.14.764.392 1.029.722l1.968-.787a.75.75 0 0 1 .556 1.392L13 7.258V9h2.25a.75.75 0 0 1 0 1.5H13v.5c0 .409-.049.806-.141 1.186l2.17.868a.75.75 0 0 1-.557 1.392l-2.184-.873A4.997 4.997 0 0 1 8 16a4.997 4.997 0 0 1-4.288-2.427l-2.183.873a.75.75 0 0 1-.558-1.392l2.17-.868A5.036 5.036 0 0 1 3 11v-.5H.75a.75.75 0 0 1 0-1.5H3V7.258L.971 6.446a.75.75 0 0 1 .558-1.392l1.967.787c.265-.33.62-.583 1.03-.722a1.677 1.677 0 0 1-.026-.292V4.5c0-.951.38-1.814.995-2.444L4.72 1.28a.75.75 0 0 1 0-1.06Zm.53 6.28a.75.75 0 0 0-.75.75V11a3.5 3.5 0 1 0 7 0V7.25a.75.75 0 0 0-.75-.75ZM6.173 5h3.654A.172.172 0 0 0 10 4.827V4.5a2 2 0 1 0-4 0v.327c0 .096.077.173.173.173Z"/></svg>');--md-admonition-icon--example:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M5 5.782V2.5h-.25a.75.75 0 0 1 0-1.5h6.5a.75.75 0 0 1 0 1.5H11v3.282l3.666 5.76C15.619 13.04 14.543 15 12.767 15H3.233c-1.776 0-2.852-1.96-1.899-3.458Zm-2.4 6.565a.75.75 0 0 0 .633 1.153h9.534a.75.75 0 0 0 .633-1.153L12.225 10.5h-8.45ZM9.5 2.5h-3V6c0 .143-.04.283-.117.403L4.73 9h6.54L9.617 6.403A.746.746 0 0 1 9.5 6Z"/></svg>');--md-admonition-icon--quote:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M1.75 2.5h10.5a.75.75 0 0 1 0 1.5H1.75a.75.75 0 0 1 0-1.5Zm4 5h8.5a.75.75 0 0 1 0 1.5h-8.5a.75.75 0 0 1 0-1.5Zm0 5h8.5a.75.75 0 0 1 0 1.5h-8.5a.75.75 0 0 1 0-1.5ZM2.5 7.75v6a.75.75 0 0 1-1.5 0v-6a.75.75 0 0 1 1.5 0Z"/></svg>');}</style><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../stylesheets/extra.css><link rel=stylesheet href=https://file.cdn.shafish.cn/blog/css/vssue.css><link rel=stylesheet href=https://file.cdn.shafish.cn/blog/css/video-js.min.css><link rel=stylesheet href=https://file.cdn.shafish.cn/blog/css/video.css><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","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"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","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",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=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",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script><script>var consent;"undefined"==typeof __md_analytics||(consent=__md_get("__consent"))&&consent.analytics&&__md_analytics()</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#kubernetes存储入门 class=md-skip> 跳转至 </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=页眉> <a href=../../.. title=DevOps运维开发 class="md-header__button md-logo" aria-label=DevOps运维开发 data-md-component=logo> <img src=../../../assets/images/logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> DevOps运维开发 </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Kubernetes存储入门 </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label=切换至深色模式 type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title=切换至深色模式 for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=blue data-md-color-accent=blue aria-label=切换至浅色模式 type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title=切换至浅色模式 for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=查找> <a href=javascript:void(0) class="md-search__icon md-icon" title=分享 aria-label=分享 data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=清空当前内容 aria-label=清空当前内容 tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> 正在初始化搜索引擎 </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/hujianli94/hujianli94.github.io title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> hujianli94.github.io </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=标签 data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> 首页 </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../../0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Kubernetes/ class=md-tabs__link> Kubernetes </a> </li> <li class=md-tabs__item> <a href=../../../Docker/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Docker/ class=md-tabs__link> Docker </a> </li> <li class=md-tabs__item> <a href=../../../Golang/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Go-Web%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98/ class=md-tabs__link> Golang </a> </li> <li class=md-tabs__item> <a href=../../../Python/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Pythjon-auto-ops/ class=md-tabs__link> Python </a> </li> <li class=md-tabs__item> <a href=../../../Python-vs-Go/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Python-vs-Go/ class=md-tabs__link> Python-vs-Go </a> </li> <li class=md-tabs__item> <a href=../../../Linux/Shell/Shell%E7%AE%80%E4%BB%8B/ class=md-tabs__link> Linux </a> </li> <li class=md-tabs__item> <a href=../../../Other/tools/1.PicGo%E5%9B%BE%E5%BA%8A/ class=md-tabs__link> Other </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=导航栏 data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title=DevOps运维开发 class="md-nav__button md-logo" aria-label=DevOps运维开发 data-md-component=logo> <img src=../../../assets/images/logo.png alt=logo> </a> DevOps运维开发 </label> <div class=md-nav__source> <a href=https://github.com/hujianli94/hujianli94.github.io title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> hujianli94.github.io </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> <span class=md-ellipsis> 首页 </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2 checked> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex> <span class=md-ellipsis> Kubernetes </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=true> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_1> <label class=md-nav__link for=__nav_2_1 id=__nav_2_1_label tabindex=0> <span class=md-ellipsis> 0.学习线路 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_1_label aria-expanded=false> <label class=md-nav__title for=__nav_2_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Kubernetes/ class=md-nav__link> <span class=md-ellipsis> Kubernetes </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2> <label class=md-nav__link for=__nav_2_2 id=__nav_2_2_label tabindex=0> <span class=md-ellipsis> 1.安装篇 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2> <span class="md-nav__icon md-icon"></span> 1.安装篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../1.%E5%AE%89%E8%A3%85%E7%AF%87/1.Kubeadm%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/ class=md-nav__link> <span class=md-ellipsis> Kubeadm安装高可用集群 </span> </a> </li> <li class=md-nav__item> <a href=../../1.%E5%AE%89%E8%A3%85%E7%AF%87/2.%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/ class=md-nav__link> <span class=md-ellipsis> 二进制安装高可用K8s集群 </span> </a> </li> <li class=md-nav__item> <a href=../../1.%E5%AE%89%E8%A3%85%E7%AF%87/3.%E5%AE%89%E8%A3%85%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/ class=md-nav__link> <span class=md-ellipsis> 安装常用工具 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_3> <label class=md-nav__link for=__nav_2_3 id=__nav_2_3_label tabindex=0> <span class=md-ellipsis> 2.基础篇 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_3_label aria-expanded=false> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> 2.基础篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../2.%E5%9F%BA%E7%A1%80%E7%AF%87/3.Docker%E5%9F%BA%E7%A1%80/ class=md-nav__link> <span class=md-ellipsis> Docker基础 </span> </a> </li> <li class=md-nav__item> <a href=../../2.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Kubernetes%E7%9A%84%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/ class=md-nav__link> <span class=md-ellipsis> Kubernetes的基础概念 </span> </a> </li> <li class=md-nav__item> <a href=../../2.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Kubernetes%E8%B0%83%E5%BA%A6%E5%9F%BA%E7%A1%80/ class=md-nav__link> <span class=md-ellipsis> Kubernetes调度基础 </span> </a> </li> <li class=md-nav__item> <a href=../../2.%E5%9F%BA%E7%A1%80%E7%AF%87/6.Kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83%E5%9F%BA%E7%A1%80/ class=md-nav__link> <span class=md-ellipsis> Kubernetes服务发布基础 </span> </a> </li> <li class=md-nav__item> <a href=../../2.%E5%9F%BA%E7%A1%80%E7%AF%87/7.Kubernetes%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> Kubernetes配置管理 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_4 checked> <label class=md-nav__link for=__nav_2_4 id=__nav_2_4_label tabindex=0> <span class=md-ellipsis> 3.进阶篇 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_4_label aria-expanded=true> <label class=md-nav__title for=__nav_2_4> <span class="md-nav__icon md-icon"></span> 3.进阶篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Kubernetes存储入门 </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Kubernetes存储入门 </span> </a> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#1-volume的概念 class=md-nav__link> 1. Volume的概念 </a> </li> <li class=md-nav__item> <a href=#2-volume的类型 class=md-nav__link> 2. Volume的类型 </a> </li> <li class=md-nav__item> <a href=#3-示例1-通过emptydir共享数据 class=md-nav__link> 3. 示例1: 通过emptyDir共享数据 </a> </li> <li class=md-nav__item> <a href=#4-示例2-使用hostpath挂载宿主机文件 class=md-nav__link> 4. 示例2: 使用HostPath挂载宿主机文件 </a> </li> <li class=md-nav__item> <a href=#5-示例3-挂载nfs至容器 class=md-nav__link> 5. 示例3: 挂载NFS至容器 </a> </li> <li class=md-nav__item> <a href=#6-persistentvolume class=md-nav__link> 6. PersistentVolume </a> <nav class=md-nav aria-label="6. PersistentVolume"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#61-pv回收策略 class=md-nav__link> 6.1 PV回收策略 </a> </li> <li class=md-nav__item> <a href=#62-pv访问策略 class=md-nav__link> 6.2 PV访问策略 </a> </li> <li class=md-nav__item> <a href=#63-基于nfs的pv class=md-nav__link> 6.3 基于NFS的PV </a> </li> <li class=md-nav__item> <a href=#64-基于hostpath的pv class=md-nav__link> 6.4 基于HostPath的PV </a> </li> <li class=md-nav__item> <a href=#65-基于ceph-rbd的pv class=md-nav__link> 6.5 基于Ceph RBD的PV </a> </li> <li class=md-nav__item> <a href=#66-pv的状态 class=md-nav__link> 6.6 PV的状态 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#7-persistentvolumeclaim class=md-nav__link> 7. PersistentVolumeClaim </a> <nav class=md-nav aria-label="7. PersistentVolumeClaim"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#71-pvc的创建 class=md-nav__link> 7.1 PVC的创建 </a> </li> <li class=md-nav__item> <a href=#72-pvc的使用 class=md-nav__link> 7.2 PVC的使用 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#8动态存储storageclass class=md-nav__link> 8.动态存储StorageClass </a> <nav class=md-nav aria-label=8.动态存储StorageClass> <ul class=md-nav__list> <li class=md-nav__item> <a href=#81-定义storageclass class=md-nav__link> 8.1 定义StorageClass </a> </li> <li class=md-nav__item> <a href=#82-整合storageclass和ceph-rbd class=md-nav__link> 8.2 整合StorageClass和Ceph RBD </a> <nav class=md-nav aria-label="8.2 整合StorageClass和Ceph RBD"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#821-部署ceph-rbd-provisioner class=md-nav__link> 8.2.1 部署Ceph RBD Provisioner </a> </li> <li class=md-nav__item> <a href=#822-创建ceph-pool class=md-nav__link> 8.2.2 创建Ceph Pool </a> </li> <li class=md-nav__item> <a href=#823-创建storageclass class=md-nav__link> 8.2.3 创建StorageClass </a> </li> <li class=md-nav__item> <a href=#824-创建pvc class=md-nav__link> 8.2.4 创建PVC </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#9存储的未来csi class=md-nav__link> 9.存储的未来：CSI </a> <nav class=md-nav aria-label=9.存储的未来：CSI> <ul class=md-nav__list> <li class=md-nav__item> <a href=#91-通过csi连接cephfs class=md-nav__link> 9.1 通过CSI连接CephFS </a> </li> <li class=md-nav__item> <a href=#92-通过csi连接ceph-rbd class=md-nav__link> 9.2 通过CSI连接Ceph RBD </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#10-小结 class=md-nav__link> 10. 小结 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../9.Kubernetes%E9%AB%98%E7%BA%A7%E8%B0%83%E5%BA%A6/ class=md-nav__link> <span class=md-ellipsis> Kubernetes高级调度 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_5> <label class=md-nav__link for=__nav_2_5 id=__nav_2_5_label tabindex=0> <span class=md-ellipsis> 4.高级篇 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_5_label aria-expanded=false> <label class=md-nav__title for=__nav_2_5> <span class="md-nav__icon md-icon"></span> 4.高级篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../4.%E9%AB%98%E7%BA%A7%E7%AF%87/12.%E4%BA%91%E5%8E%9F%E7%94%9F%E5%AD%98%E5%82%A8Rook/ class=md-nav__link> <span class=md-ellipsis> 云原生存储Rook </span> </a> </li> <li class=md-nav__item> <a href=../../4.%E9%AB%98%E7%BA%A7%E7%AF%87/13.%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%AE%B9%E5%99%A8%E5%8C%96/ class=md-nav__link> <span class=md-ellipsis> 中间件容器化 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_6> <label class=md-nav__link for=__nav_2_6 id=__nav_2_6_label tabindex=0> <span class=md-ellipsis> 5.运维篇 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_6_label aria-expanded=false> <label class=md-nav__title for=__nav_2_6> <span class="md-nav__icon md-icon"></span> 5.运维篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../5.%E8%BF%90%E7%BB%B4%E7%AF%87/14.Kubernetes%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/ class=md-nav__link> <span class=md-ellipsis> Kubernetes日志收集 </span> </a> </li> <li class=md-nav__item> <a href=../../5.%E8%BF%90%E7%BB%B4%E7%AF%87/15.Kubernetes%E7%9B%91%E6%8E%A7%E5%91%8A%E8%AD%A6/ class=md-nav__link> <span class=md-ellipsis> Kubernetes监控告警 </span> </a> </li> <li class=md-nav__item> <a href=../../5.%E8%BF%90%E7%BB%B4%E7%AF%87/16.%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83Ingress%E8%BF%9B%E9%98%B6/ class=md-nav__link> <span class=md-ellipsis> 服务发布Ingress进阶 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_7> <label class=md-nav__link for=__nav_2_7 id=__nav_2_7_label tabindex=0> <span class=md-ellipsis> 6.DevOps篇 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_7_label aria-expanded=false> <label class=md-nav__title for=__nav_2_7> <span class="md-nav__icon md-icon"></span> 6.DevOps篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/ class=md-nav__link> <span class=md-ellipsis> DevOps实践 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex> <span class=md-ellipsis> Docker </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Docker </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1> <label class=md-nav__link for=__nav_3_1 id=__nav_3_1_label tabindex=0> <span class=md-ellipsis> 0.学习线路 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_1_label aria-expanded=false> <label class=md-nav__title for=__nav_3_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Docker/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Docker/ class=md-nav__link> <span class=md-ellipsis> Docker </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2> <label class=md-nav__link for=__nav_3_2 id=__nav_3_2_label tabindex=0> <span class=md-ellipsis> 1.基础 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> 1.基础 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Docker/1.%E5%9F%BA%E7%A1%80/1.%E5%AE%89%E8%A3%85Docker/ class=md-nav__link> <span class=md-ellipsis> 1.安装Docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.%E5%9F%BA%E7%A1%80/2.Docker%E9%95%9C%E5%83%8F/ class=md-nav__link> <span class=md-ellipsis> 2.Docker镜像 </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.%E5%9F%BA%E7%A1%80/3.Docker%E5%AE%B9%E5%99%A8/ class=md-nav__link> <span class=md-ellipsis> 3.Docker容器 </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.%E5%9F%BA%E7%A1%80/4.%E4%BC%81%E4%B8%9A%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93harbor/ class=md-nav__link> <span class=md-ellipsis> 4.企业私有仓库harbor </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.%E5%9F%BA%E7%A1%80/5.Docker%E6%95%B0%E6%8D%AE/ class=md-nav__link> <span class=md-ellipsis> 5.Docker数据 </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.%E5%9F%BA%E7%A1%80/6.Docker%E7%BD%91%E7%BB%9C/ class=md-nav__link> <span class=md-ellipsis> 6.Docker网络 </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.%E5%9F%BA%E7%A1%80/7.Dockerfile/ class=md-nav__link> <span class=md-ellipsis> 7.Dockerfile </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.%E5%9F%BA%E7%A1%80/8.docker-compose/ class=md-nav__link> <span class=md-ellipsis> 8.docker-compose </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.%E5%9F%BA%E7%A1%80/9.Docker%E7%9B%B8%E5%85%B3%E8%84%9A%E6%9C%AC/ class=md-nav__link> <span class=md-ellipsis> 9.Docker相关脚本 </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.%E5%9F%BA%E7%A1%80/10.Docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/ class=md-nav__link> <span class=md-ellipsis> 10.Docker常用命令 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_3> <label class=md-nav__link for=__nav_3_3 id=__nav_3_3_label tabindex=0> <span class=md-ellipsis> 2.实战案例 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> 2.实战案例 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/1.%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/ class=md-nav__link> <span class=md-ellipsis> 1.操作系统 </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/2.Web%E6%9C%8D%E5%8A%A1%E4%B8%8E%E5%BA%94%E7%94%A8/ class=md-nav__link> <span class=md-ellipsis> 2.Web服务与应用 </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/3.%E6%8C%81%E7%BB%AD%E5%BC%80%E5%8F%91%E4%B8%8E%E7%AE%A1%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 3.持续开发与管理 </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/4.%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BA%94%E7%94%A8/ class=md-nav__link> <span class=md-ellipsis> 4.数据库应用 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_4> <label class=md-nav__link for=__nav_3_4 id=__nav_3_4_label tabindex=0> <span class=md-ellipsis> 3.Devops </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_4_label aria-expanded=false> <label class=md-nav__title for=__nav_3_4> <span class="md-nav__icon md-icon"></span> 3.Devops </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Docker/3.Devops/1.confcenter-docker/ class=md-nav__link> <span class=md-ellipsis> 1.confcenter-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/2.simaple-jenkins/ class=md-nav__link> <span class=md-ellipsis> 2.simaple-jenkins </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/3.docker-nginx-spa/ class=md-nav__link> <span class=md-ellipsis> 3.docker-nginx-spa </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/4.fileserver-docker/ class=md-nav__link> <span class=md-ellipsis> 4.fileserver-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/5.haproxy-docker/ class=md-nav__link> <span class=md-ellipsis> 5.haproxy-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/6.mysql-docker/ class=md-nav__link> <span class=md-ellipsis> 6.mysql-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/7.frp-docker/ class=md-nav__link> <span class=md-ellipsis> 7.frp-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/8.coredns-docker/ class=md-nav__link> <span class=md-ellipsis> 8.coredns-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/9.simple-harbor/ class=md-nav__link> <span class=md-ellipsis> 9.simple-harbor </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/10.redis-docker/ class=md-nav__link> <span class=md-ellipsis> 10.redis-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/11.nexus3-docker/ class=md-nav__link> <span class=md-ellipsis> 11.nexus3-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/12.openvpn-docker/ class=md-nav__link> <span class=md-ellipsis> 12.openvpn-docker.md </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/13.nfs-docker/ class=md-nav__link> <span class=md-ellipsis> 13.nfs-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/14.jumpserver-docker/ class=md-nav__link> <span class=md-ellipsis> 14.jumpserver-docker.md </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/15.ansible-docker/ class=md-nav__link> <span class=md-ellipsis> 15.ansible-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/16.minio-docker/ class=md-nav__link> <span class=md-ellipsis> 16.minio-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/17.vaultwarden-docker/ class=md-nav__link> <span class=md-ellipsis> 17.vaultwarden-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/18.kasm-docker/ class=md-nav__link> <span class=md-ellipsis> 18.kasm-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/19.nginx-docker/ class=md-nav__link> <span class=md-ellipsis> 19.nginx-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/20.kafka-docker/ class=md-nav__link> <span class=md-ellipsis> 20.kafka-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/21.golang-docker/ class=md-nav__link> <span class=md-ellipsis> 21.golang-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/22.postgres-docker/ class=md-nav__link> <span class=md-ellipsis> 22.postgres-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/23.nginx-download-docker/ class=md-nav__link> <span class=md-ellipsis> 23.nginx-download-docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/24.helm%E9%83%A8%E7%BD%B2%E5%B8%B8%E7%94%A8%E6%9C%8D%E5%8A%A1/ class=md-nav__link> <span class=md-ellipsis> 24.helm部署常用服务 </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/25.Python%E6%93%8D%E4%BD%9CDocker/ class=md-nav__link> <span class=md-ellipsis> 25.Python操作Docker </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/26.docker-compose-devops/ class=md-nav__link> <span class=md-ellipsis> 26.docker-compose-devops </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/27.DevOps%E4%B8%8B%E7%9A%84Shell%E8%84%9A%E6%9C%AC/ class=md-nav__link> <span class=md-ellipsis> 27.DevOps下的Shell脚本 </span> </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/28.Devops%E4%B8%8B%E7%9A%84Python%E8%84%9A%E6%9C%AC/ class=md-nav__link> <span class=md-ellipsis> 28.Devops下的Python脚本 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex> <span class=md-ellipsis> Golang </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Golang </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_1> <label class=md-nav__link for=__nav_4_1 id=__nav_4_1_label tabindex=0> <span class=md-ellipsis> 0.学习线路 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_1_label aria-expanded=false> <label class=md-nav__title for=__nav_4_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Go-Web%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98/ class=md-nav__link> <span class=md-ellipsis> Go Web开发实战 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_2> <label class=md-nav__link for=__nav_4_2 id=__nav_4_2_label tabindex=0> <span class=md-ellipsis> 1.Go基础 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_2_label aria-expanded=false> <label class=md-nav__title for=__nav_4_2> <span class="md-nav__icon md-icon"></span> 1.Go基础 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/1.Go%E5%9F%BA%E7%A1%80/1.%E5%AE%89%E8%A3%85Go/ class=md-nav__link> <span class=md-ellipsis> 安装Go </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/1.Go%E5%9F%BA%E7%A1%80/2.%E7%AC%AC%E4%B8%80%E4%B8%AAGo%E7%A8%8B%E5%BA%8F/ class=md-nav__link> <span class=md-ellipsis> 第一个Go程序 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/ class=md-nav__link> <span class=md-ellipsis> Go基础语法 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/1.Go%E5%9F%BA%E7%A1%80/4.Go-Module/ class=md-nav__link> <span class=md-ellipsis> Go Module </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_3> <label class=md-nav__link for=__nav_4_3 id=__nav_4_3_label tabindex=0> <span class=md-ellipsis> 2.Go-Web基础 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_3_label aria-expanded=false> <label class=md-nav__title for=__nav_4_3> <span class="md-nav__icon md-icon"></span> 2.Go-Web基础 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/2.Go-Web%E5%9F%BA%E7%A1%80/5.%E7%AC%AC%E4%B8%80%E4%B8%AAGo-Web%E7%A8%8B%E5%BA%8F/ class=md-nav__link> <span class=md-ellipsis> 第一个Go Web程序 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/2.Go-Web%E5%9F%BA%E7%A1%80/6.Web%E7%A8%8B%E5%BA%8F%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86%E7%AE%80%E4%BB%8B/ class=md-nav__link> <span class=md-ellipsis> Web程序运行原理简介 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/2.Go-Web%E5%9F%BA%E7%A1%80/7.net-http%E5%8C%85/ class=md-nav__link> <span class=md-ellipsis> net/http包 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/2.Go-Web%E5%9F%BA%E7%A1%80/8.html-template%E5%8C%85/ class=md-nav__link> <span class=md-ellipsis> html/template包 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_4> <label class=md-nav__link for=__nav_4_4 id=__nav_4_4_label tabindex=0> <span class=md-ellipsis> 3.Go-Web请求处理 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4_4> <span class="md-nav__icon md-icon"></span> 3.Go-Web请求处理 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/3.Go-Web%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/9.%E7%AE%80%E5%8D%95Web%E6%9C%8D%E5%8A%A1%E5%99%A8/ class=md-nav__link> <span class=md-ellipsis> 简单Web服务器 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/3.Go-Web%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/10.%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82/ class=md-nav__link> <span class=md-ellipsis> 处理请求 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/3.Go-Web%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/11.session%E5%92%8Ccookie/ class=md-nav__link> <span class=md-ellipsis> session和cookie </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_5> <label class=md-nav__link for=__nav_4_5 id=__nav_4_5_label tabindex=0> <span class=md-ellipsis> 4.Go访问数据库 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_5_label aria-expanded=false> <label class=md-nav__title for=__nav_4_5> <span class="md-nav__icon md-icon"></span> 4.Go访问数据库 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/12.Go%E6%93%8D%E4%BD%9CMySQL/ class=md-nav__link> <span class=md-ellipsis> Go操作MySQL </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/13.Go%E6%93%8D%E4%BD%9CRedis/ class=md-nav__link> <span class=md-ellipsis> Go操作Redis </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/14.Go%E6%93%8D%E4%BD%9CMongoDB/ class=md-nav__link> <span class=md-ellipsis> Go操作MongoDB </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/15.Go%E7%9A%84%E5%B8%B8%E8%A7%81ORM%E5%BA%93/ class=md-nav__link> <span class=md-ellipsis> Go的常见ORM库 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/16.Go%E6%93%8D%E4%BD%9CSQLite/ class=md-nav__link> <span class=md-ellipsis> Go操作SQLite </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_6> <label class=md-nav__link for=__nav_4_6 id=__nav_4_6_label tabindex=0> <span class=md-ellipsis> 5.Go高级网络编程 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_6_label aria-expanded=false> <label class=md-nav__title for=__nav_4_6> <span class="md-nav__icon md-icon"></span> 5.Go高级网络编程 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/5.Go%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/17.Go-Socket%E7%BC%96%E7%A8%8B/ class=md-nav__link> <span class=md-ellipsis> Go Socket编程 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/5.Go%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/18.Go-RPC%E7%BC%96%E7%A8%8B/ class=md-nav__link> <span class=md-ellipsis> Go RPC编程 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/5.Go%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/19.Go-%E5%BE%AE%E6%9C%8D%E5%8A%A1/ class=md-nav__link> <span class=md-ellipsis> Go 微服务 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_7> <label class=md-nav__link for=__nav_4_7 id=__nav_4_7_label tabindex=0> <span class=md-ellipsis> 6.Go文件处理 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_7_label aria-expanded=false> <label class=md-nav__title for=__nav_4_7> <span class="md-nav__icon md-icon"></span> 6.Go文件处理 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/20.%E5%A4%84%E7%90%86%E7%9B%AE%E5%BD%95%E4%B8%8E%E6%96%87%E4%BB%B6/ class=md-nav__link> <span class=md-ellipsis> 处理目录与文件 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/21.%E5%A4%84%E7%90%86XML%E6%96%87%E4%BB%B6/ class=md-nav__link> <span class=md-ellipsis> 处理XML文件 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/22.%E5%A4%84%E7%90%86JSON%E6%96%87%E4%BB%B6/ class=md-nav__link> <span class=md-ellipsis> 处理JSON文件 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/23.%E5%A4%84%E7%90%86CSV%E6%96%87%E4%BB%B6/ class=md-nav__link> <span class=md-ellipsis> 处理CSV文件 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/24.%E5%A4%84%E7%90%86Go%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95/ class=md-nav__link> <span class=md-ellipsis> 处理Go日志记录 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/25.%E5%A4%84%E7%90%86%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 处理正则表达式 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/26.%E5%A4%84%E7%90%86Excel%E6%96%87%E4%BB%B6/ class=md-nav__link> <span class=md-ellipsis> 处理Excel文件 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_8> <label class=md-nav__link for=__nav_4_8 id=__nav_4_8_label tabindex=0> <span class=md-ellipsis> 7.Go并发编程 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_8_label aria-expanded=false> <label class=md-nav__title for=__nav_4_8> <span class="md-nav__icon md-icon"></span> 7.Go并发编程 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/26.%E5%B9%B6%E5%8F%91-%E5%B9%B6%E8%A1%8C/ class=md-nav__link> <span class=md-ellipsis> 并发 并行 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/27.%E8%BF%9B%E7%A8%8B-%E7%BA%BF%E7%A8%8B-%E5%8D%8F%E7%A8%8B/ class=md-nav__link> <span class=md-ellipsis> 进程 线程 协程 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/28.Go%E5%B9%B6%E5%8F%91%E6%A8%A1%E5%9E%8B/ class=md-nav__link> <span class=md-ellipsis> Go并发模型 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/29.goroutine%E5%92%8Cchannel/ class=md-nav__link> <span class=md-ellipsis> goroutine和channel </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/30.sync%E5%AE%9E%E7%8E%B0%E5%B9%B6%E5%8F%91/ class=md-nav__link> <span class=md-ellipsis> sync实现并发 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/31.Go%E5%B9%B6%E5%8F%91%E7%9A%84Web%E5%BA%94%E7%94%A8/ class=md-nav__link> <span class=md-ellipsis> Go并发的Web应用 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_9> <label class=md-nav__link for=__nav_4_9 id=__nav_4_9_label tabindex=0> <span class=md-ellipsis> 8.Go标准库 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_9_label aria-expanded=false> <label class=md-nav__title for=__nav_4_9> <span class="md-nav__icon md-icon"></span> 8.Go标准库 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/32.time/ class=md-nav__link> <span class=md-ellipsis> time </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/33.strings/ class=md-nav__link> <span class=md-ellipsis> strings </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/34.bytes/ class=md-nav__link> <span class=md-ellipsis> bytes </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/35.json/ class=md-nav__link> <span class=md-ellipsis> json </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/36.io-bufio/ class=md-nav__link> <span class=md-ellipsis> io/bufio </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/37.fmt/ class=md-nav__link> <span class=md-ellipsis> fmt </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/38.strconv/ class=md-nav__link> <span class=md-ellipsis> strconv </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/39.regexp/ class=md-nav__link> <span class=md-ellipsis> regexp </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/40.log/ class=md-nav__link> <span class=md-ellipsis> log </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/41.reflect-unsafe/ class=md-nav__link> <span class=md-ellipsis> reflect/unsafe </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/42.os-path-filepath/ class=md-nav__link> <span class=md-ellipsis> os/path/filepath </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/43.unicode/ class=md-nav__link> <span class=md-ellipsis> unicode </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/44.flag/ class=md-nav__link> <span class=md-ellipsis> flag </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/45.net-url/ class=md-nav__link> <span class=md-ellipsis> net/url </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/46.net-http/ class=md-nav__link> <span class=md-ellipsis> net/http </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/47.sort/ class=md-nav__link> <span class=md-ellipsis> sort </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/48.errors/ class=md-nav__link> <span class=md-ellipsis> errors </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_10> <label class=md-nav__link for=__nav_4_10 id=__nav_4_10_label tabindex=0> <span class=md-ellipsis> 9.Go三方库 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_10_label aria-expanded=false> <label class=md-nav__title for=__nav_4_10> <span class="md-nav__icon md-icon"></span> 9.Go三方库 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/0.%E5%BC%80%E6%BA%90%E8%87%AA%E5%B7%B1%E7%9A%84Go%E5%BA%93/ class=md-nav__link> <span class=md-ellipsis> 开源自己的Go库 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/1.cobra/ class=md-nav__link> <span class=md-ellipsis> Cobra </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/2.viper/ class=md-nav__link> <span class=md-ellipsis> Viper </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/3.mahonia/ class=md-nav__link> <span class=md-ellipsis> mahonia </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/4.ssh/ class=md-nav__link> <span class=md-ellipsis> ssh </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/5.fsnotify/ class=md-nav__link> <span class=md-ellipsis> fsnotify </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/6.yaml/ class=md-nav__link> <span class=md-ellipsis> yaml </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/7.tail/ class=md-nav__link> <span class=md-ellipsis> tail </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/8.gopsutil/ class=md-nav__link> <span class=md-ellipsis> gopsutil </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_11> <label class=md-nav__link for=__nav_4_11 id=__nav_4_11_label tabindex=0> <span class=md-ellipsis> 10.Go-RESTful-API接口开发 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_11_label aria-expanded=false> <label class=md-nav__title for=__nav_4_11> <span class="md-nav__icon md-icon"></span> 10.Go-RESTful-API接口开发 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/10.Go-RESTful-API%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91/1.%E4%BB%80%E4%B9%88%E6%98%AFRESTful-API/ class=md-nav__link> <span class=md-ellipsis> 1.什么是RESTful-API </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/10.Go-RESTful-API%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91/2.GORMv2/ class=md-nav__link> <span class=md-ellipsis> 2.GORMv2 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/10.Go-RESTful-API%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91/3.Gin%E6%A1%86%E6%9E%B6%E7%9A%84%E4%BD%BF%E7%94%A8/ class=md-nav__link> <span class=md-ellipsis> 3.Gin框架的使用 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/10.Go-RESTful-API%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91/4.%E5%9B%BE%E4%B9%A6%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-%E5%89%8D%E7%AB%AF/ class=md-nav__link> <span class=md-ellipsis> 4.图书管理系统-前端 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/10.Go-RESTful-API%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91/5.%E5%9B%BE%E4%B9%A6%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-%E5%90%8E%E7%AB%AF/ class=md-nav__link> <span class=md-ellipsis> 5.图书管理系统-后端 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_12> <label class=md-nav__link for=__nav_4_12 id=__nav_4_12_label tabindex=0> <span class=md-ellipsis> 11.Web前端 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_12_label aria-expanded=false> <label class=md-nav__title for=__nav_4_12> <span class="md-nav__icon md-icon"></span> 11.Web前端 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/11.Web%E5%89%8D%E7%AB%AF/1.HTML%E6%A0%87%E8%AE%B0%E8%AF%AD%E8%A8%80/ class=md-nav__link> <span class=md-ellipsis> 1.HTML标记语言 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/11.Web%E5%89%8D%E7%AB%AF/2.CSS%E6%A0%B7%E5%BC%8F%E8%AF%AD%E8%A8%80/ class=md-nav__link> <span class=md-ellipsis> 2.CSS样式语言 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/11.Web%E5%89%8D%E7%AB%AF/3.JavaScript%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%84%9A%E6%9C%AC%E8%AF%AD%E8%A8%80/ class=md-nav__link> <span class=md-ellipsis> 3.JavaScript客户端脚本语言 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/11.Web%E5%89%8D%E7%AB%AF/4.JavaScript%E5%BA%93-JQuery/ class=md-nav__link> <span class=md-ellipsis> 4.JavaScript库:JQuery </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_13> <label class=md-nav__link for=__nav_4_13 id=__nav_4_13_label tabindex=0> <span class=md-ellipsis> 12.Vue前端开发 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_13_label aria-expanded=false> <label class=md-nav__title for=__nav_4_13> <span class="md-nav__icon md-icon"></span> 12.Vue前端开发 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/1.%E8%AE%A4%E8%AF%86Vue.js/ class=md-nav__link> <span class=md-ellipsis> 1.认识Vue.js.md </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/2.Vue%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4/ class=md-nav__link> <span class=md-ellipsis> 2.Vue常用指令 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/3.Vue%E5%B8%B8%E7%94%A8%E5%B1%9E%E6%80%A7/ class=md-nav__link> <span class=md-ellipsis> 3.Vue常用属性 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/4.Vue%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4%E4%B9%8B%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/ class=md-nav__link> <span class=md-ellipsis> 4.Vue常用指令之流程控制 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/5.Vue%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4%E4%B9%8B%E6%95%B0%E6%8D%AE%E5%8F%8C%E5%90%91%E7%BB%91%E5%AE%9A/ class=md-nav__link> <span class=md-ellipsis> 5.Vue常用指令之数据双向绑定 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/6.Vue%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E9%92%A9%E5%AD%90/ class=md-nav__link> <span class=md-ellipsis> 6.Vue生命周期钩子 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/7.VueCli%E8%84%9A%E6%89%8B%E6%9E%B6/ class=md-nav__link> <span class=md-ellipsis> 7.VueCli脚手架 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/8.Vue%E7%BB%84%E4%BB%B6/ class=md-nav__link> <span class=md-ellipsis> 8.Vue组件 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/9.%E5%89%8D%E5%90%8E%E7%AB%AF%E6%95%B0%E6%8D%AE%E4%BA%A4%E4%BA%92-Axios/ class=md-nav__link> <span class=md-ellipsis> 9.前后端数据交互 Axios </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_14> <label class=md-nav__link for=__nav_4_14 id=__nav_4_14_label tabindex=0> <span class=md-ellipsis> 13.K8s管理系统项目实战 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_14_label aria-expanded=false> <label class=md-nav__title for=__nav_4_14> <span class="md-nav__icon md-icon"></span> 13.K8s管理系统项目实战 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/13.K8s%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/1.%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/ class=md-nav__link> <span class=md-ellipsis> 1.前端开发 </span> </a> </li> <li class=md-nav__item> <a href=../../../Golang/13.K8s%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/2.%E5%90%8E%E7%AB%AFAPI%E5%BC%80%E5%8F%91/ class=md-nav__link> <span class=md-ellipsis> 2.后端API开发 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex> <span class=md-ellipsis> Python </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Python </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_1> <label class=md-nav__link for=__nav_5_1 id=__nav_5_1_label tabindex=0> <span class=md-ellipsis> 0.学习线路 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_1_label aria-expanded=false> <label class=md-nav__title for=__nav_5_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Pythjon-auto-ops/ class=md-nav__link> <span class=md-ellipsis> Python Linux管理与自动化运维 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_2> <label class=md-nav__link for=__nav_5_2 id=__nav_5_2_label tabindex=0> <span class=md-ellipsis> 1.Python基础篇 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_2_label aria-expanded=false> <label class=md-nav__title for=__nav_5_2> <span class="md-nav__icon md-icon"></span> 1.Python基础篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/1.Python%E7%94%9F%E6%80%81%E5%B7%A5%E5%85%B7/ class=md-nav__link> <span class=md-ellipsis> 1.Python生态工具 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/2.Python%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E5%AE%89%E8%A3%85/ class=md-nav__link> <span class=md-ellipsis> 2.Python第三方库安装 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/3.Python%E5%B7%A5%E4%BD%9C%E7%8E%AF%E5%A2%83%E7%AE%A1%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 3.Python工作环境管理 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/4.Python%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/ class=md-nav__link> <span class=md-ellipsis> 4.Python开发环境 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/5.Python%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/ class=md-nav__link> <span class=md-ellipsis> 5.Python数据结构 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/6.Python%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84/ class=md-nav__link> <span class=md-ellipsis> 6.Python项目的组织结构 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/7.Python%E5%86%85%E7%BD%AE%E5%87%BD%E6%95%B0/ class=md-nav__link> <span class=md-ellipsis> 7.Python内置函数 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_3> <label class=md-nav__link for=__nav_5_3 id=__nav_5_3_label tabindex=0> <span class=md-ellipsis> 2.Python运维开发 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_3_label aria-expanded=false> <label class=md-nav__title for=__nav_5_3> <span class="md-nav__icon md-icon"></span> 2.Python运维开发 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/1.%E6%89%93%E9%80%A0%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/ class=md-nav__link> <span class=md-ellipsis> 1.打造命令行工具 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/2.%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 2.文本处理 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/3.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 3.Linux系统管理 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/4.%E7%9B%91%E6%8E%A7Linux/ class=md-nav__link> <span class=md-ellipsis> 4.监控Linux </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/5.%E6%96%87%E6%A1%A3%E4%B8%8E%E6%8A%A5%E5%91%8A/ class=md-nav__link> <span class=md-ellipsis> 5.文档与报告 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_4> <label class=md-nav__link for=__nav_5_4 id=__nav_5_4_label tabindex=0> <span class=md-ellipsis> 3.Python测试开发 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_4_label aria-expanded=false> <label class=md-nav__title for=__nav_5_4> <span class="md-nav__icon md-icon"></span> 3.Python测试开发 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/1.Python%E8%BF%9B%E9%98%B6/ class=md-nav__link> <span class=md-ellipsis> 1.Python进阶 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/2.%E5%B8%B8%E7%94%A8%E5%BA%93%E5%AE%9E%E8%B7%B5/ class=md-nav__link> <span class=md-ellipsis> 2.常用库实践 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_5> <label class=md-nav__link for=__nav_5_5 id=__nav_5_5_label tabindex=0> <span class=md-ellipsis> 4.Flask-Web全栈开发 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5_5> <span class="md-nav__icon md-icon"></span> 4.Flask-Web全栈开发 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/1.Flask%E5%89%8D%E5%A5%8F/ class=md-nav__link> <span class=md-ellipsis> 1.Flask前缀 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/2.%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AE/ class=md-nav__link> <span class=md-ellipsis> 2.项目配置 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/3.URL%E4%B8%8E%E8%A7%86%E5%9B%BE/ class=md-nav__link> <span class=md-ellipsis> 3.URL与视图 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/4.Jinja2%E6%A8%A1%E6%9D%BF/ class=md-nav__link> <span class=md-ellipsis> 4.Jinja2模板 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/5.%E6%95%B0%E6%8D%AE%E5%BA%93/ class=md-nav__link> <span class=md-ellipsis> 5.数据库 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/6.%E8%A1%A8%E5%8D%95/ class=md-nav__link> <span class=md-ellipsis> 6.表单 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/7.Flask%E8%BF%9B%E9%98%B6/ class=md-nav__link> <span class=md-ellipsis> 7.Flask进阶 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/8.%E7%BC%93%E5%AD%98%E7%B3%BB%E7%BB%9F/ class=md-nav__link> <span class=md-ellipsis> 8.缓存系统 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/9.%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/ class=md-nav__link> <span class=md-ellipsis> 9.项目实战 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/10.WebSock%E5%AE%9E%E6%88%98/ class=md-nav__link> <span class=md-ellipsis> 10.WebSock实战 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/11.Flask%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B/ class=md-nav__link> <span class=md-ellipsis> 11.Flask异步编程 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python/4.Flask-Web%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/%E9%99%84-Flask%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B/ class=md-nav__link> <span class=md-ellipsis> 附-Flask数据模型 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex> <span class=md-ellipsis> Python-vs-Go </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Python-vs-Go </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_1> <label class=md-nav__link for=__nav_6_1 id=__nav_6_1_label tabindex=0> <span class=md-ellipsis> 0.学习线路 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_1_label aria-expanded=false> <label class=md-nav__title for=__nav_6_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python-vs-Go/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Python-vs-Go/ class=md-nav__link> <span class=md-ellipsis> Python-vs-Go </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_2> <label class=md-nav__link for=__nav_6_2 id=__nav_6_2_label tabindex=0> <span class=md-ellipsis> 1.对比学习 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_2_label aria-expanded=false> <label class=md-nav__title for=__nav_6_2> <span class="md-nav__icon md-icon"></span> 1.对比学习 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/1.Hello-World/ class=md-nav__link> <span class=md-ellipsis> Hello-World </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/2.Print/ class=md-nav__link> <span class=md-ellipsis> Print </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/3.%E6%B3%A8%E9%87%8A/ class=md-nav__link> <span class=md-ellipsis> 注释 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/4.%E5%A4%9A%E8%A1%8C%E5%AD%97%E7%AC%A6%E4%B8%B2/ class=md-nav__link> <span class=md-ellipsis> 多行字符串 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/5.Lists/ class=md-nav__link> <span class=md-ellipsis> Lists </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/6.Map/ class=md-nav__link> <span class=md-ellipsis> Map </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/7.Booleans/ class=md-nav__link> <span class=md-ellipsis> Booleans </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/8.Forloop/ class=md-nav__link> <span class=md-ellipsis> Forloop </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/9.Range/ class=md-nav__link> <span class=md-ellipsis> Range </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/10.Switch/ class=md-nav__link> <span class=md-ellipsis> Switch </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/11.%E5%8F%AF%E5%8F%98%E5%8F%82%E6%95%B0%E5%87%BD%E6%95%B0/ class=md-nav__link> <span class=md-ellipsis> 可变参数函数 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/12.%E6%97%B6%E9%97%B4%E8%AE%A1%E7%AE%97/ class=md-nav__link> <span class=md-ellipsis> 时间计算 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/13.%E5%87%BD%E6%95%B0%E7%9A%84%E9%97%AD%E5%8C%85/ class=md-nav__link> <span class=md-ellipsis> 函数的闭包 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/14.%E9%80%80%E5%87%BA%E5%A4%84%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 退出处理 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/15.%E5%BC%82%E5%B8%B8%E6%8D%95%E8%8E%B7/ class=md-nav__link> <span class=md-ellipsis> 异常捕获 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/16.%E5%8F%AF%E5%8F%98%E9%A1%B9/ class=md-nav__link> <span class=md-ellipsis> 可变项 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/17.%E7%B1%BB/ class=md-nav__link> <span class=md-ellipsis> 类 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/18.%E6%96%B9%E6%B3%95/ class=md-nav__link> <span class=md-ellipsis> 方法 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/19.%E5%B9%B6%E5%8F%91/ class=md-nav__link> <span class=md-ellipsis> 并发 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/20.Args/ class=md-nav__link> <span class=md-ellipsis> Args </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/21.%E5%AF%BC%E5%85%A5%E6%A8%A1%E5%9D%97%E5%88%AB%E5%90%8D/ class=md-nav__link> <span class=md-ellipsis> 导入模块别名 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/22.%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%A0%BC%E5%BC%8F%E5%8C%96/ class=md-nav__link> <span class=md-ellipsis> 字符串格式化 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/23.%E5%8E%BB%E9%87%8D/ class=md-nav__link> <span class=md-ellipsis> 去重 </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/24.%E5%B8%A6%E9%A2%9C%E8%89%B2%E6%89%93%E5%8D%B0/ class=md-nav__link> <span class=md-ellipsis> 带颜色打印 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_3> <label class=md-nav__link for=__nav_6_3 id=__nav_6_3_label tabindex=0> <span class=md-ellipsis> 2.进阶 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_3_label aria-expanded=false> <label class=md-nav__title for=__nav_6_3> <span class="md-nav__icon md-icon"></span> 2.进阶 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python-vs-Go/2.%E8%BF%9B%E9%98%B6/1.%E4%BD%BF%E7%94%A8RPC/ class=md-nav__link> <span class=md-ellipsis> 使用RPC </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/2.%E8%BF%9B%E9%98%B6/2.%E4%BD%BF%E7%94%A8MySQL/ class=md-nav__link> <span class=md-ellipsis> 使用MySQL </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/2.%E8%BF%9B%E9%98%B6/3.%E4%BD%BF%E7%94%A8Redis/ class=md-nav__link> <span class=md-ellipsis> 使用Redis </span> </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/2.%E8%BF%9B%E9%98%B6/4.%E4%BD%BF%E7%94%A8MongoDB/ class=md-nav__link> <span class=md-ellipsis> 使用MongoDB </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex> <span class=md-ellipsis> Linux </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Linux </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_1> <label class=md-nav__link for=__nav_7_1 id=__nav_7_1_label tabindex=0> <span class=md-ellipsis> Shell </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_1_label aria-expanded=false> <label class=md-nav__title for=__nav_7_1> <span class="md-nav__icon md-icon"></span> Shell </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Linux/Shell/Shell%E7%AE%80%E4%BB%8B/ class=md-nav__link> <span class=md-ellipsis> Shell 教程概述 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/1.%E7%AC%AC%E4%B8%80%E4%B8%AAshell%E7%A8%8B%E5%BA%8F/ class=md-nav__link> <span class=md-ellipsis> 1.第一个 Shell 程序 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/2.Shell%E5%8F%98%E9%87%8F%E5%92%8C%E5%AD%97%E7%AC%A6%E4%B8%B2/ class=md-nav__link> <span class=md-ellipsis> 2.Shell变量和字符串 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/3.Shell%E5%8F%82%E6%95%B0/ class=md-nav__link> <span class=md-ellipsis> 3.Shell参数 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/4.Shell%E6%95%B0%E7%BB%84/ class=md-nav__link> <span class=md-ellipsis> 4.Shell数组 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/5.Shell%E8%BF%90%E7%AE%97%E7%AC%A6/ class=md-nav__link> <span class=md-ellipsis> 5.Shell运算符 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/6.Shell-echo_printf%E5%91%BD%E4%BB%A4/ class=md-nav__link> <span class=md-ellipsis> 6.Shell echo/printf 命令 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/7.Shell-test%E5%91%BD%E4%BB%A4/ class=md-nav__link> <span class=md-ellipsis> 7.Shell test命令 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/8.Shell%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/ class=md-nav__link> <span class=md-ellipsis> 8.Shell流程控制 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/9.Shell%E5%87%BD%E6%95%B0/ class=md-nav__link> <span class=md-ellipsis> 9.Shell函数 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/10.Shell%E8%BE%93%E5%85%A5_%E8%BE%93%E5%87%BA%E9%87%8D%E5%AE%9A%E5%90%91/ class=md-nav__link> <span class=md-ellipsis> 10.Shell输入/输出重定向 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/11.Shell%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 11.Shell正则表达式 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/12.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bgrep/ class=md-nav__link> <span class=md-ellipsis> 12.Shell三剑客之grep </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/13.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/ class=md-nav__link> <span class=md-ellipsis> 13.Shell三剑客之sed </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/14.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bawk/ class=md-nav__link> <span class=md-ellipsis> 14.Shell三剑客之awk </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/15.Shell%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/ class=md-nav__link> <span class=md-ellipsis> 15.Shell常用工具 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/16.Shell%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/ class=md-nav__link> <span class=md-ellipsis> 16.Shell实战项目 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/17.Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/ class=md-nav__link> <span class=md-ellipsis> 17.Shell脚本示例 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/18.Shell%E8%84%9A%E6%9C%AC%E7%9A%84%E5%8F%82%E6%95%B0%E8%A7%A3%E6%9E%90%E5%B7%A5%E5%85%B7/ class=md-nav__link> <span class=md-ellipsis> 18.Shell脚本的参数解析工具 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/19.%E5%AE%9E%E7%94%A8Linux-Shell%E8%84%9A%E6%9C%AC%E6%A1%88%E4%BE%8B/ class=md-nav__link> <span class=md-ellipsis> 19.实用Linux Shell脚本案例 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/20.Shell%E8%84%9A%E6%9C%AC%E7%9A%84%E8%A7%84%E8%8C%83/ class=md-nav__link> <span class=md-ellipsis> 20.Shell脚本的规范 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Shell/21.Shell%E5%A4%9A%E8%BF%9B%E7%A8%8B%E5%B9%B6%E5%8F%91/ class=md-nav__link> <span class=md-ellipsis> 21.Shell多进程并发 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_2> <label class=md-nav__link for=__nav_7_2 id=__nav_7_2_label tabindex=0> <span class=md-ellipsis> Ansible </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_2_label aria-expanded=false> <label class=md-nav__title for=__nav_7_2> <span class="md-nav__icon md-icon"></span> Ansible </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/ class=md-nav__link> <span class=md-ellipsis> 1.Ansible入门和实践 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Ansible/2.Ansible-wiki/ class=md-nav__link> <span class=md-ellipsis> 2.Ansible-wiki </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_3> <label class=md-nav__link for=__nav_7_3 id=__nav_7_3_label tabindex=0> <span class=md-ellipsis> Git </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_3_label aria-expanded=false> <label class=md-nav__title for=__nav_7_3> <span class="md-nav__icon md-icon"></span> Git </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Linux/Git/1.Git%E5%9F%BA%E7%A1%80/ class=md-nav__link> <span class=md-ellipsis> 1.Git基础 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Git/2.%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93/ class=md-nav__link> <span class=md-ellipsis> 2.远程仓库 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Git/3.%E5%88%86%E6%94%AF%E7%AE%A1%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 3.分支管理 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Git/4.%E5%88%86%E6%94%AF%E7%AE%A1%E7%90%86%E7%AD%96%E7%95%A5/ class=md-nav__link> <span class=md-ellipsis> 4.分支管理策略 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Git/7.%E4%BD%BF%E7%94%A8Github/ class=md-nav__link> <span class=md-ellipsis> 7.使用Github </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Git/8.%E5%AE%9E%E8%B7%B5GitHub-Flow/ class=md-nav__link> <span class=md-ellipsis> 8.实践GitHub Flow </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Git/9.%E5%AE%9E%E8%B7%B5Git-Flow/ class=md-nav__link> <span class=md-ellipsis> 9.实践Git Flow </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/Git/10.%E9%A1%B9%E7%9B%AE%E8%A7%84%E8%8C%83/ class=md-nav__link> <span class=md-ellipsis> 10.项目规范 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_4> <label class=md-nav__link for=__nav_7_4 id=__nav_7_4_label tabindex=0> <span class=md-ellipsis> KVM </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_4_label aria-expanded=false> <label class=md-nav__title for=__nav_7_4> <span class="md-nav__icon md-icon"></span> KVM </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Linux/KVM/1.kvm%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4/ class=md-nav__link> <span class=md-ellipsis> 1.kvm相关命令 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/KVM/2.kvm%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%88%9B%E5%BB%BA/ class=md-nav__link> <span class=md-ellipsis> 2.kvm虚拟机创建 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/KVM/3.kvm%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE/ class=md-nav__link> <span class=md-ellipsis> 3.kvm网络配置 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_5> <label class=md-nav__link for=__nav_7_5 id=__nav_7_5_label tabindex=0> <span class=md-ellipsis> System </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_5_label aria-expanded=false> <label class=md-nav__title for=__nav_7_5> <span class="md-nav__icon md-icon"></span> System </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Linux/System/1.%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E5%92%8C%E8%BD%AF%E4%BB%B6%E6%BA%90/ class=md-nav__link> <span class=md-ellipsis> 1.系统镜像和软件源 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/System/2.Linux%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA/ class=md-nav__link> <span class=md-ellipsis> 2.Linux安全加固 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/System/3.Systemd/ class=md-nav__link> <span class=md-ellipsis> 3.Systemd </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/System/4.Superivisor/ class=md-nav__link> <span class=md-ellipsis> 4.Superivisor </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/System/5.SSH%E7%99%BB%E5%BD%95Linux%E6%98%BE%E7%A4%BA%E6%A8%AA%E5%B9%85/ class=md-nav__link> <span class=md-ellipsis> 5.SSH登录Linux显示横幅.md </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/System/6.Linux%E4%B8%AD%E7%AB%AF%E5%8F%A3%E5%8D%A0%E7%94%A8%E6%8E%92%E6%9F%A5/ class=md-nav__link> <span class=md-ellipsis> 6.Linux中端口占用排查 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/System/7.%E4%BD%BF%E7%94%A8curl%E5%8F%91%E9%80%81REST-API%E8%AF%B7%E6%B1%82/ class=md-nav__link> <span class=md-ellipsis> 7.使用curl发送REST API请求 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/System/8.%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%A8%A1%E7%B3%8A%E6%9F%A5%E6%89%BE%E5%99%A8fzf/ class=md-nav__link> <span class=md-ellipsis> 8.命令行模糊查找器fzf </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/System/9.Centos7.9%E7%B3%BB%E7%BB%9F%E7%9B%98%E6%89%A9%E5%AE%B9/ class=md-nav__link> <span class=md-ellipsis> 9.Centos7.9系统盘扩容 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/System/10.Centos%E5%9C%A8%E7%BA%BF-%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96/ class=md-nav__link> <span class=md-ellipsis> 10.Centos在线-离线安装依赖 </span> </a> </li> <li class=md-nav__item> <a href=../../../Linux/System/11.rsync-ssh/ class=md-nav__link> <span class=md-ellipsis> 11.rsync ssh使用 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_6> <label class=md-nav__link for=__nav_7_6 id=__nav_7_6_label tabindex=0> <span class=md-ellipsis> Serveices </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_6_label aria-expanded=false> <label class=md-nav__title for=__nav_7_6> <span class="md-nav__icon md-icon"></span> Serveices </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Linux/Serveices/0.ubuntu-desktop-vmware/ class=md-nav__link> <span class=md-ellipsis> ubuntu-desktop-vmware </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8> <label class=md-nav__link for=__nav_8 id=__nav_8_label tabindex> <span class=md-ellipsis> Other </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_8_label aria-expanded=false> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> Other </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8_1> <label class=md-nav__link for=__nav_8_1 id=__nav_8_1_label tabindex=0> <span class=md-ellipsis> tools </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_8_1_label aria-expanded=false> <label class=md-nav__title for=__nav_8_1> <span class="md-nav__icon md-icon"></span> tools </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Other/tools/1.PicGo%E5%9B%BE%E5%BA%8A/ class=md-nav__link> <span class=md-ellipsis> 1.PicGo图床 </span> </a> </li> <li class=md-nav__item> <a href=../../../Other/tools/2.PicX%E5%9B%BE%E5%BA%8A/ class=md-nav__link> <span class=md-ellipsis> 2.Picx图床 </span> </a> </li> <li class=md-nav__item> <a href=../../../Other/tools/3.Markdown%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/ class=md-nav__link> <span class=md-ellipsis> 3.Markdown基础语法 </span> </a> </li> <li class=md-nav__item> <a href=../../../Other/tools/4.KeyManager/ class=md-nav__link> <span class=md-ellipsis> 4.KeyManager </span> </a> </li> <li class=md-nav__item> <a href=../../../Other/tools/5.mkdocs-material%E6%90%AD%E5%BB%BA%E9%9D%99%E6%80%81%E5%8D%9A%E5%AE%A2/ class=md-nav__link> <span class=md-ellipsis> 5.mkdocs-material搭建静态博客 </span> </a> </li> <li class=md-nav__item> <a href=../../../Other/tools/6.%E5%88%A9%E7%94%A8sphinx%E6%9E%84%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/ class=md-nav__link> <span class=md-ellipsis> 6.利用sphinx构建个人博客 </span> </a> </li> <li class=md-nav__item> <a href=../../../Other/tools/7.%E4%BC%81%E4%B8%9A%E7%BA%A7%E8%BF%9C%E7%A8%8B%E5%8A%9E%E5%85%ACVPN%E8%BD%AF%E4%BB%B6AnyLink/ class=md-nav__link> <span class=md-ellipsis> 7.企业级远程办公VPN软件AnyLink </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8_2> <label class=md-nav__link for=__nav_8_2 id=__nav_8_2_label tabindex=0> <span class=md-ellipsis> windows </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_8_2_label aria-expanded=false> <label class=md-nav__title for=__nav_8_2> <span class="md-nav__icon md-icon"></span> windows </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Other/windows/1.windows%E6%9F%A5%E7%9C%8B%E7%AB%AF%E5%8F%A3%E5%8D%A0%E7%94%A8/ class=md-nav__link> <span class=md-ellipsis> 1.windows查看端口占用 </span> </a> </li> <li class=md-nav__item> <a href=../../../Other/windows/2.Win11%E9%95%9C%E5%83%8F%E4%B8%8B%E8%BD%BD%E3%80%81%E5%A3%81%E7%BA%B8%E5%8F%8AKMS%E6%BF%80%E6%B4%BB/ class=md-nav__link> <span class=md-ellipsis> 2.Win11镜像下载、壁纸及KMS激活 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#1-volume的概念 class=md-nav__link> 1. Volume的概念 </a> </li> <li class=md-nav__item> <a href=#2-volume的类型 class=md-nav__link> 2. Volume的类型 </a> </li> <li class=md-nav__item> <a href=#3-示例1-通过emptydir共享数据 class=md-nav__link> 3. 示例1: 通过emptyDir共享数据 </a> </li> <li class=md-nav__item> <a href=#4-示例2-使用hostpath挂载宿主机文件 class=md-nav__link> 4. 示例2: 使用HostPath挂载宿主机文件 </a> </li> <li class=md-nav__item> <a href=#5-示例3-挂载nfs至容器 class=md-nav__link> 5. 示例3: 挂载NFS至容器 </a> </li> <li class=md-nav__item> <a href=#6-persistentvolume class=md-nav__link> 6. PersistentVolume </a> <nav class=md-nav aria-label="6. PersistentVolume"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#61-pv回收策略 class=md-nav__link> 6.1 PV回收策略 </a> </li> <li class=md-nav__item> <a href=#62-pv访问策略 class=md-nav__link> 6.2 PV访问策略 </a> </li> <li class=md-nav__item> <a href=#63-基于nfs的pv class=md-nav__link> 6.3 基于NFS的PV </a> </li> <li class=md-nav__item> <a href=#64-基于hostpath的pv class=md-nav__link> 6.4 基于HostPath的PV </a> </li> <li class=md-nav__item> <a href=#65-基于ceph-rbd的pv class=md-nav__link> 6.5 基于Ceph RBD的PV </a> </li> <li class=md-nav__item> <a href=#66-pv的状态 class=md-nav__link> 6.6 PV的状态 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#7-persistentvolumeclaim class=md-nav__link> 7. PersistentVolumeClaim </a> <nav class=md-nav aria-label="7. PersistentVolumeClaim"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#71-pvc的创建 class=md-nav__link> 7.1 PVC的创建 </a> </li> <li class=md-nav__item> <a href=#72-pvc的使用 class=md-nav__link> 7.2 PVC的使用 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#8动态存储storageclass class=md-nav__link> 8.动态存储StorageClass </a> <nav class=md-nav aria-label=8.动态存储StorageClass> <ul class=md-nav__list> <li class=md-nav__item> <a href=#81-定义storageclass class=md-nav__link> 8.1 定义StorageClass </a> </li> <li class=md-nav__item> <a href=#82-整合storageclass和ceph-rbd class=md-nav__link> 8.2 整合StorageClass和Ceph RBD </a> <nav class=md-nav aria-label="8.2 整合StorageClass和Ceph RBD"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#821-部署ceph-rbd-provisioner class=md-nav__link> 8.2.1 部署Ceph RBD Provisioner </a> </li> <li class=md-nav__item> <a href=#822-创建ceph-pool class=md-nav__link> 8.2.2 创建Ceph Pool </a> </li> <li class=md-nav__item> <a href=#823-创建storageclass class=md-nav__link> 8.2.3 创建StorageClass </a> </li> <li class=md-nav__item> <a href=#824-创建pvc class=md-nav__link> 8.2.4 创建PVC </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#9存储的未来csi class=md-nav__link> 9.存储的未来：CSI </a> <nav class=md-nav aria-label=9.存储的未来：CSI> <ul class=md-nav__list> <li class=md-nav__item> <a href=#91-通过csi连接cephfs class=md-nav__link> 9.1 通过CSI连接CephFS </a> </li> <li class=md-nav__item> <a href=#92-通过csi连接ceph-rbd class=md-nav__link> 9.2 通过CSI连接Ceph RBD </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#10-小结 class=md-nav__link> 10. 小结 </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=kubernetes存储入门>Kubernetes存储入门<a class=headerlink href=#kubernetes存储入门 title="Permanent link">&para;</a></h1> <p>前面已经讲解了Kubernetes的大部分知识点，相信读者已经慢慢领悟到了Kubernetes的精髓。但是在生产环境中，还不足以满足企业内各种复杂的场景，因为我们并没有讲到任何关于数据存储和数据交换的内容。</p> <p>而数据是一个企业发展的核心，在生产中是尤为重要的一部分，所以本章将带领读者学习Kubernetes另一个比较重要并且稍微有些难度的知识点——数据持久化Volume。</p> <h2 id=1-volume的概念>1. Volume的概念<a class=headerlink href=#1-volume的概念 title="Permanent link">&para;</a></h2> <p>对于大多数项目而言，数据文件的存储是非常常见的需求，比如存储用户上传的头像、上传的文件以及数据库的数据。</p> <p>在Kubernetes中，由于应用的部署具有高度的可扩展性和编排能力（不像传统架构部署在固定的位置），因此把数据存放在本地是非常不可取的，这样做也无法保障数据的安全。</p> <p>如果读者对云原生应用有所了解，就会知道其中的一个概念——把有状态应用变成无状态应用，意指把数据从应用中剥离出来，把产生的数据文件或者缓存信息都放在“云端”， 比如常用的NFS（生产环境极不建议使用，因为NFS存在单点故障，推荐使用分布式存储或者公有云的NAS服务）、Ceph、GlusterFS（可能会停止维护）、Minio等。</p> <p>在传统架构中，如果要使用这些存储，需要提前在宿主机挂载，然后程序才能访问，在实际使用时，经常碰到新加节点忘记挂载存储导致的一系列问题。而Kubernetes在设计之初就考虑了这些问题，并抽象出Volume的概念用于解决数据存储的问题。</p> <p>在容器中的磁盘文件是短暂的，当容器崩溃时，Kubelet会重新启动容器，但容器运行时产生的数据文件都将会丢失，之后容器会以最干净的状态启动。</p> <p>另外，当一个Pod运行多个容器时，各个容器可能需要共享一些文件，诸如此类的需求都可以使用Volume解决。</p> <p>Docker也有卷的概念，但是在Docker中，卷只是磁盘上或另一个容器中的目录，其生命周期不受管理。</p> <p>虽然Docker已经提供了卷驱动程序，但是功能非常有限，例如从Docker 1.7版本开始，每个容器只允许一个卷驱动程序，并且无法将一些特殊的参数传递给后端存储。</p> <p>从本质上讲，和虚拟机或者物理机一样，卷被挂载后，在容器中也只是一个目录，可能包含一些数据，Pod中的容器也可以对其进行增删改查操作，使用方式和裸机挂载几乎没有区别。</p> <p>要使用卷也非常简单，和其他参数类似，Pod只需要通过.spec.volumes字段指定为Pod提供的卷， 然后在容器中配置块，使用.spec.containers.volumeMounts字段指定卷挂载的目录即可。</p> <h2 id=2-volume的类型>2. Volume的类型<a class=headerlink href=#2-volume的类型 title="Permanent link">&para;</a></h2> <p>在传统架构中，企业内可能有自己的存储平台，比如NFS、Ceph、GlusterFS、Minio等。如果读者的环境在公有云，可以使用公有云提供的NAS、对象存储等。在Kubernetes中，Volume也支持配置以上存储，用于挂载到Pod中实现数据的持久化。</p> <p>Kubernetes Volume支持的卷的类型有很多，以下为常用的卷：</p> <ul> <li>CephFS。</li> <li>GlusterFS。</li> <li>ISCSI。</li> <li>Cinder。</li> <li>NFS。</li> <li>RBD。</li> <li>HostPath。</li> </ul> <p>当然，也支持一些Kubernetes独有的类型：</p> <ul> <li>ConfigMap：用于存储配置文件。</li> <li>Secret：用于存储敏感数据。</li> <li>EmptyDir：用于一个Pod内多个容器的数据共享。</li> <li>PersistentVolumeClaim：对PersistentVolume的申请。</li> </ul> <p>以上列举的是一些比较常用的类型，其他支持的类型可以查看Volume的官方文档：</p> <p><a href=https://kubernetes.io/docs/concepts/storage/volumes/ >https://kubernetes.io/docs/concepts/storage/volumes/</a></p> <p>接下来通过几个比较常用的类型的Volume配置演示一下Volume的使用。</p> <h2 id=3-示例1-通过emptydir共享数据>3. 示例1: 通过emptyDir共享数据<a class=headerlink href=#3-示例1-通过emptydir共享数据 title="Permanent link">&para;</a></h2> <p>EmptyDir是一个特殊的Volume类型，与上述Volume不同的是， <strong>如果删除Pod，emptyDir卷中的数据也将被删除，所以一般emptyDir用于Pod中的不同Container共享数据，</strong></p> <p>比如一个Pod存在两个容器A和B，容器A需要使用容器B产生的数据，此时可以采用emptyDir共享数据，类似的使用如Filebeat收集容器内程序产生的日志。</p> <p>使用emptyDir卷的示例如下，直接指定emptyDir为{}即可：</p> <p>nginx-empty.yaml</p> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=w>  </span><span class=nt>labels</span><span class=p>:</span>
<a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a><span class=w>  </span><span class=nt>selector</span><span class=p>:</span>
<a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span>
<a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<a id=__codelineno-0-13 name=__codelineno-0-13 href=#__codelineno-0-13></a><span class=w>  </span><span class=nt>template</span><span class=p>:</span>
<a id=__codelineno-0-14 name=__codelineno-0-14 href=#__codelineno-0-14></a><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-0-15 name=__codelineno-0-15 href=#__codelineno-0-15></a><span class=w>      </span><span class=nt>labels</span><span class=p>:</span>
<a id=__codelineno-0-16 name=__codelineno-0-16 href=#__codelineno-0-16></a><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<a id=__codelineno-0-17 name=__codelineno-0-17 href=#__codelineno-0-17></a><span class=w>    </span><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-0-18 name=__codelineno-0-18 href=#__codelineno-0-18></a><span class=w>      </span><span class=nt>containers</span><span class=p>:</span>
<a id=__codelineno-0-19 name=__codelineno-0-19 href=#__codelineno-0-19></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx:1.15.2</span>
<a id=__codelineno-0-20 name=__codelineno-0-20 href=#__codelineno-0-20></a><span class=w>        </span><span class=nt>imagePullPolicy</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
<a id=__codelineno-0-21 name=__codelineno-0-21 href=#__codelineno-0-21></a><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<a id=__codelineno-0-22 name=__codelineno-0-22 href=#__codelineno-0-22></a><span class=w>        </span><span class=nt>volumeMounts</span><span class=p>:</span>
<a id=__codelineno-0-23 name=__codelineno-0-23 href=#__codelineno-0-23></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/opt</span>
<a id=__codelineno-0-24 name=__codelineno-0-24 href=#__codelineno-0-24></a><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">share-volume</span>
<a id=__codelineno-0-25 name=__codelineno-0-25 href=#__codelineno-0-25></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx:1.15.2</span>
<a id=__codelineno-0-26 name=__codelineno-0-26 href=#__codelineno-0-26></a><span class=w>        </span><span class=nt>imagePullPolicy</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
<a id=__codelineno-0-27 name=__codelineno-0-27 href=#__codelineno-0-27></a><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx2</span>
<a id=__codelineno-0-28 name=__codelineno-0-28 href=#__codelineno-0-28></a><span class=w>        </span><span class=nt>command</span><span class=p>:</span>
<a id=__codelineno-0-29 name=__codelineno-0-29 href=#__codelineno-0-29></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">sh</span>
<a id=__codelineno-0-30 name=__codelineno-0-30 href=#__codelineno-0-30></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">-c</span>
<a id=__codelineno-0-31 name=__codelineno-0-31 href=#__codelineno-0-31></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">sleep 3600</span>
<a id=__codelineno-0-32 name=__codelineno-0-32 href=#__codelineno-0-32></a><span class=w>        </span><span class=nt>volumeMounts</span><span class=p>:</span>
<a id=__codelineno-0-33 name=__codelineno-0-33 href=#__codelineno-0-33></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/mnt</span>
<a id=__codelineno-0-34 name=__codelineno-0-34 href=#__codelineno-0-34></a><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">share-volume</span>
<a id=__codelineno-0-35 name=__codelineno-0-35 href=#__codelineno-0-35></a><span class=w>      </span><span class=nt>volumes</span><span class=p>:</span>
<a id=__codelineno-0-36 name=__codelineno-0-36 href=#__codelineno-0-36></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">share-volume</span>
<a id=__codelineno-0-37 name=__codelineno-0-37 href=#__codelineno-0-37></a><span class=w>        </span><span class=nt>emptyDir</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">{}</span>
<a id=__codelineno-0-38 name=__codelineno-0-38 href=#__codelineno-0-38></a><span class=w>          </span><span class=c1>#medium: Memory</span>
</code></pre></div> <p>此部署文件创建一个Deployment，采用spec.volumes字段配置了一个名字为share-volume、类型为emptyDir的Volume，同时里面包含两个容器nginx和nginx2， 并将该Volume挂载到了/opt和/mnt目录下，此时/opt和/mnt目录的数据就实现了共享。</p> <p>默认情况下，emptyDir支持节点上的任何介质，可能是SSD、磁盘或网络存储，具体取决于自身的环境。</p> <p>可以将emptyDir.medium字段设置为Memory，让Kubernetes使用tmpfs（内存支持的文件系统）， 虽然tmpfs非常快，但是tmpfs在节点重启时，数据同样会被清除，并且设置的大小会被计入Container的内存限制中。</p> <h2 id=4-示例2-使用hostpath挂载宿主机文件>4. 示例2: 使用HostPath挂载宿主机文件<a class=headerlink href=#4-示例2-使用hostpath挂载宿主机文件 title="Permanent link">&para;</a></h2> <p><strong>HostPath卷可将节点上的文件或目录挂载到Pod上，用于实现Pod和宿主机之间的数据共享</strong>，</p> <p>常用的示例有挂载宿主机的时区至Pod，或者将Pod的日志文件挂载到宿主机等。</p> <p>以下为使用hostPath卷的示例，实现将主机的/etc/timezone文件挂载到Pod的/etc/timezone（挂载路径可以不一致）：</p> <p>nginx-hostPath.yaml</p> <div class=highlight><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a><span class=w>  </span><span class=nt>labels</span><span class=p>:</span>
<a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<a id=__codelineno-1-10 name=__codelineno-1-10 href=#__codelineno-1-10></a><span class=w>  </span><span class=nt>selector</span><span class=p>:</span>
<a id=__codelineno-1-11 name=__codelineno-1-11 href=#__codelineno-1-11></a><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span>
<a id=__codelineno-1-12 name=__codelineno-1-12 href=#__codelineno-1-12></a><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<a id=__codelineno-1-13 name=__codelineno-1-13 href=#__codelineno-1-13></a><span class=w>  </span><span class=nt>template</span><span class=p>:</span>
<a id=__codelineno-1-14 name=__codelineno-1-14 href=#__codelineno-1-14></a><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-1-15 name=__codelineno-1-15 href=#__codelineno-1-15></a><span class=w>      </span><span class=nt>labels</span><span class=p>:</span>
<a id=__codelineno-1-16 name=__codelineno-1-16 href=#__codelineno-1-16></a><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<a id=__codelineno-1-17 name=__codelineno-1-17 href=#__codelineno-1-17></a><span class=w>    </span><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-1-18 name=__codelineno-1-18 href=#__codelineno-1-18></a><span class=w>      </span><span class=nt>containers</span><span class=p>:</span>
<a id=__codelineno-1-19 name=__codelineno-1-19 href=#__codelineno-1-19></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx:1.15.2</span>
<a id=__codelineno-1-20 name=__codelineno-1-20 href=#__codelineno-1-20></a><span class=w>        </span><span class=nt>imagePullPolicy</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
<a id=__codelineno-1-21 name=__codelineno-1-21 href=#__codelineno-1-21></a><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<a id=__codelineno-1-22 name=__codelineno-1-22 href=#__codelineno-1-22></a><span class=w>        </span><span class=nt>volumeMounts</span><span class=p>:</span>
<a id=__codelineno-1-23 name=__codelineno-1-23 href=#__codelineno-1-23></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/opt</span>
<a id=__codelineno-1-24 name=__codelineno-1-24 href=#__codelineno-1-24></a><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">share-volume</span>
<a id=__codelineno-1-25 name=__codelineno-1-25 href=#__codelineno-1-25></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/etc/timezone</span>
<a id=__codelineno-1-26 name=__codelineno-1-26 href=#__codelineno-1-26></a><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">timezone</span>
<a id=__codelineno-1-27 name=__codelineno-1-27 href=#__codelineno-1-27></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx:1.15.2</span>
<a id=__codelineno-1-28 name=__codelineno-1-28 href=#__codelineno-1-28></a><span class=w>        </span><span class=nt>imagePullPolicy</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
<a id=__codelineno-1-29 name=__codelineno-1-29 href=#__codelineno-1-29></a><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx2</span>
<a id=__codelineno-1-30 name=__codelineno-1-30 href=#__codelineno-1-30></a><span class=w>        </span><span class=nt>command</span><span class=p>:</span>
<a id=__codelineno-1-31 name=__codelineno-1-31 href=#__codelineno-1-31></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">sh</span>
<a id=__codelineno-1-32 name=__codelineno-1-32 href=#__codelineno-1-32></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">-c</span>
<a id=__codelineno-1-33 name=__codelineno-1-33 href=#__codelineno-1-33></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">sleep 3600</span>
<a id=__codelineno-1-34 name=__codelineno-1-34 href=#__codelineno-1-34></a><span class=w>        </span><span class=nt>volumeMounts</span><span class=p>:</span>
<a id=__codelineno-1-35 name=__codelineno-1-35 href=#__codelineno-1-35></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/mnt</span>
<a id=__codelineno-1-36 name=__codelineno-1-36 href=#__codelineno-1-36></a><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">share-volume</span>
<a id=__codelineno-1-37 name=__codelineno-1-37 href=#__codelineno-1-37></a><span class=w>      </span><span class=nt>volumes</span><span class=p>:</span>
<a id=__codelineno-1-38 name=__codelineno-1-38 href=#__codelineno-1-38></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">share-volume</span>
<a id=__codelineno-1-39 name=__codelineno-1-39 href=#__codelineno-1-39></a><span class=w>        </span><span class=nt>emptyDir</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">{}</span>
<a id=__codelineno-1-40 name=__codelineno-1-40 href=#__codelineno-1-40></a><span class=w>          </span><span class=c1>#medium: Memory</span>
<a id=__codelineno-1-41 name=__codelineno-1-41 href=#__codelineno-1-41></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">timezone</span>
<a id=__codelineno-1-42 name=__codelineno-1-42 href=#__codelineno-1-42></a><span class=w>        </span><span class=nt>hostPath</span><span class=p>:</span>
<a id=__codelineno-1-43 name=__codelineno-1-43 href=#__codelineno-1-43></a><span class=w>          </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/etc/timezone</span>
<a id=__codelineno-1-44 name=__codelineno-1-44 href=#__codelineno-1-44></a><span class=w>          </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">File</span>
</code></pre></div> <p>在配置HostPath时，有一个type的参数，用于表达不同的挂载类型，HostPath卷常用的type（类型）如下：</p> <ul> <li> <p>type为空字符串：默认选项，意味着挂载hostPath卷之前不会执行任何检查。</p> </li> <li> <p>DirectoryOrCreate：如果给定的path不存在任何东西，那么将根据需要创建一个权限为0755的空目录，和Kubelet具有相同的组和权限</p> </li> <li>Directory：目录必须存在于给定的路径下。</li> <li>FileOrCreate：如果给定的路径不存储任何内容，则会根据需要创建一个空文件，权限设置为0644，和Kubelet具有相同的组和所有权。</li> <li>File：文件，必须存在于给定路径中。</li> <li>Socket：UNIX套接字，必须存在于给定路径中。</li> <li>CharDevice：字符设备，必须存在于给定路径中。</li> <li>BlockDevice：块设备，必须存在于给定路径中。</li> </ul> <h2 id=5-示例3-挂载nfs至容器>5. 示例3: 挂载NFS至容器<a class=headerlink href=#5-示例3-挂载nfs至容器 title="Permanent link">&para;</a></h2> <p>在生产环境中，考虑到数据的高可用性，仍然不建议使用NFS作为后端存储。</p> <p>因为NFS存在单点故障，很多企业并非对其实现高可用，并且NFS的性能存在很大的瓶颈。</p> <p>所以生产中，建议使用分布式存储，在公有云中建议使用公有云提供的NAS存储来替代NFS，并且NAS性能更好，可用性更高。</p> <p>NFS作为一个比较流行的远端存储工具，在非生产环境中是一个比较好用的选择，可以快速地搭建使用。接下来演示如何使用Volume挂载NFS为容器提供持久化存储。</p> <p>在开始之前，需要提前配置NFS的权限和数据目录，具体可以参考NFS的文档，此处只提供NFS的exporter配置，</p> <p>假设NFS提供的数据目录为/data/nfs，授权可挂载该目录的IP段为192.168.0.0/24：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a>/data/nfs/<span class=w> </span><span class=m>192</span>.168.0.0/24<span class=o>(</span>rw,sync,no_subtree_check,no_root_squash<span class=o>)</span>
</code></pre></div> <p>和emptyDir、HostPath的配置方法类似，NFS的Volume配置也是在Volumes字段中配置的，和emptyDir不同的是，NFS属于持久化存储的一种，在Pod删除或者重启后，数据依旧会存储在NFS节点上。</p> <p>NFS 是 Network File System 的缩写，即网络文件系统。Kubernetes 中通过简单地配置就可以挂载 NFS 到 Pod 中，而 NFS 中的数据是可以永久保存的，同时 NFS 支持同时写操作。</p> <p>配置NFS也相对简单，代码如下（挂载方式和hostPath、emptyDir类似，在此不再演示）：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=nt>volumes</span><span class=p>:</span>
<a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nfs</span>
<a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a><span class=w>  </span><span class=nt>nfs</span><span class=p>:</span>
<a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a><span class=w>    </span><span class=c1># FIXME: use the right hostname</span>
<a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a><span class=w>    </span><span class=nt>server</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10.254.234.223</span>
<a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/&quot;</span>
</code></pre></div> <ul> <li>Server：NFS服务器的IP。</li> <li>Path：NFS服务器的共享目录。</li> </ul> <p>示例如下</p> <div class=highlight><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=w>      </span><span class=nt>volumeMounts</span><span class=p>:</span>
<a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">localtime</span>
<a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a><span class=w>        </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/etc/localtime</span>
<a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">grms-config-toml</span>
<a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a><span class=w>        </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/app/config.toml</span>
<a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a><span class=w>        </span><span class=nt>subPath</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">config.toml</span>
<a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a><span class=w> </span><span class="w w-Error"> </span><span class=nt>volumes</span><span class=p>:</span>
<a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">localtime</span>
<a id=__codelineno-4-9 name=__codelineno-4-9 href=#__codelineno-4-9></a><span class=w>    </span><span class=nt>hostPath</span><span class=p>:</span>
<a id=__codelineno-4-10 name=__codelineno-4-10 href=#__codelineno-4-10></a><span class=w>      </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/usr/share/zoneinfo/Asia/Shanghai</span>
<a id=__codelineno-4-11 name=__codelineno-4-11 href=#__codelineno-4-11></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">grms-config-toml</span>
<a id=__codelineno-4-12 name=__codelineno-4-12 href=#__codelineno-4-12></a><span class=w>    </span><span class=nt>nfs</span><span class=p>:</span>
<a id=__codelineno-4-13 name=__codelineno-4-13 href=#__codelineno-4-13></a><span class=w>      </span><span class=c1># FIXME: use the right hostname</span>
<a id=__codelineno-4-14 name=__codelineno-4-14 href=#__codelineno-4-14></a><span class=w>      </span><span class=nt>server</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">192.168.240.23</span>
<a id=__codelineno-4-15 name=__codelineno-4-15 href=#__codelineno-4-15></a><span class=w>      </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/confcenter-data/data/conf/config.toml&quot;</span>
</code></pre></div> <div class="admonition warning"> <p class=admonition-title><strong>注意</strong></p> <p>Kubernetes所有的节点都需要安装上nfs-utils才可以正常挂载NFS。</p> </div> <p>本节演示了类型为emptyDir、hostPath、NFS的Volume的使用，在配置管理ConfigMap、Secret时也讲解了类型为Secret和ConfigMap的使用，后面的章节将为读者讲解persistentVolumeClaim以及更高级的存储配置的使用。</p> <p>对于其他类型的Volume配置，原理和配置方法类似，</p> <div class="admonition example"> <p class=admonition-title>具体参考</p> <blockquote> <p><a href=https://kubernetes.io/docs/concepts/storage/volumes/ >https://kubernetes.io/docs/concepts/storage/volumes/</a>。</p> </blockquote> </div> <h2 id=6-persistentvolume>6. PersistentVolume<a class=headerlink href=#6-persistentvolume title="Permanent link">&para;</a></h2> <p>上一节讲解了Volume的概念和使用，虽然Volume已经可以接入大部分存储后端，但是实际使用时还有诸多问题，比如：</p> <ul> <li>当某个数据卷不再被挂载使用时，里面的数据如何处理？</li> <li>如果想要实现只读挂载如何处理？</li> <li>如果想要只能有一个Pod挂载如何处理？</li> </ul> <p>如上所述，对于很多复杂的需求Volume可能难以实现，并且无法对存储卷的生命周期进行管理。另一个很大的问题是，在企业内使用Kubernetes的不仅仅是Kubernetes管理员，可能还有开发人员、测试人员以及初学Kubernetes的技术人员，对于Kubernetes的Volume或者相关存储平台的配置参数并不了解，所以无法自行完成存储的配置。</p> <p>为此，Kubernetes引入了两个新的API资源：PersistentVolume和PersistentVolumeClaim。PersistentVolume（简称PV）是由Kubernetes管理员设置的存储，PersistentVolumeClaim（简称PVC）是对PV的请求，表示需要什么类型的PV。它们同样是集群中的一类资源，但其生命周期比较独立，管理员可以单独对PV进行增删改查，不受Pod的影响，生命周期可能比挂载它的其他资源还要长。</p> <p>如果一个Kubernetes集群的使用者并非只有Kubernetes管理员，那么可以通过提前创建PV，用以解决对存储概念不是很了解的技术人员对存储的需求。和单独配置Volume类似，PV也可以使用NFS、GFS、CEPH等常用的存储后端，并且可以提供更加高级的配置，比如访问模式、空间大小以及回收策略等。</p> <p>目前PV的提供方式有两种：<strong>静态或动态。静态PV由管理员提前创建，动态PV无须提前创建</strong>（动态PV在8.8节进行讲解）。</p> <h3 id=61-pv回收策略>6.1 PV回收策略<a class=headerlink href=#61-pv回收策略 title="Permanent link">&para;</a></h3> <p>当用户使用完卷时，可以从API中删除PVC对象，从而允许回收资源。回收策略会告诉PV如何处理该卷。</p> <p>目前回收策略可以设置为Retain、Recycle和Delete：</p> <ul> <li>Retain：保留，该策略允许手动回收资源，当删除PVC时，PV仍然存在，Volume被视为已释放，管理员可以手动回收卷。</li> <li>Recycle：回收，如果Volume插件支持，Recycle策略会对卷执行rm -rf清理该PV，并使其可用于下一个新的PVC，但是本策略将来会被弃用，目前只有NFS和HostPath支持该策略。</li> <li>Delete：删除，如果Volume插件支持，删除PVC时会同时删除PV，动态卷默认为Delete，目前支持Delete的存储后端包括AWS EBS、GCE PD、Azure Disk、OpenStack Cinder等。</li> </ul> <h3 id=62-pv访问策略>6.2 PV访问策略<a class=headerlink href=#62-pv访问策略 title="Permanent link">&para;</a></h3> <p>在实际使用PV时，可能针对不同的应用会有不同的访问策略，比如某类Pod可以读写，某类Pod只能读，或者需要配置是否可以被多个不同的Pod同时读写等，此时可以使用PV的访问策略进行简单控制，目前支持的访问策略如下：</p> <ul> <li>ReadWriteOnce：可以被单节点以读写模式挂载，命令行中可以被缩写为RWO。</li> <li>ReadOnlyMany：可以被多个节点以只读模式挂载，命令行中可以被缩写为ROX。</li> <li>ReadWriteMany：可以被多个节点以读写模式挂载，命令行中可以被缩写为RWX。</li> <li>ReadWriteOncePod：只能被一个Pod以读写的模式挂载，命令中可以被缩写为RWOP（1.22以上版本）。</li> </ul> <p>虽然PV在创建时可以指定不同的访问策略，但是也要后端的存储支持才行。</p> <p>比如一般情况下大部分块存储是不支持ReadWriteMany的，</p> <p>具体后端存储支持的访问模式可以参考：<a href=https://kubernetes.io/docs/concepts/storage/persistent-volumes/#access-modes>https://kubernetes.io/docs/concepts/storage/persistent-volumes/#access-modes</a>。</p> <p>在企业内，可能存储很多不同类型的存储，比如NFS、Ceph、GlusterFS等，针对不同类型的后端存储具有不同的配置方式，这也是对集群管理员的一种挑战，因为集群管理员需要对每种存储都有所了解。接下来看一下几个常用的PV配置示例。</p> <h3 id=63-基于nfs的pv>6.3 基于NFS的PV<a class=headerlink href=#63-基于nfs的pv title="Permanent link">&para;</a></h3> <p>创建一个基于NFS的PV（PV目前没有Namespace隔离，不需要指定命名空间，在任意命名空间下创建的PV均可以在其他Namespace使用）：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolume</span>
<a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">pv0003</span>
<a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a><span class=w>  </span><span class=nt>capacity</span><span class=p>:</span>
<a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a><span class=w>    </span><span class=nt>storage</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5Gi</span>
<a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a><span class=w>  </span><span class=nt>volumeMode</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Filesystem</span>
<a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a><span class=w>  </span><span class=nt>accessModes</span><span class=p>:</span>
<a id=__codelineno-5-10 name=__codelineno-5-10 href=#__codelineno-5-10></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
<a id=__codelineno-5-11 name=__codelineno-5-11 href=#__codelineno-5-11></a><span class=w>  </span><span class=nt>persistentVolumeReclaimPolicy</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Recycle</span>
<a id=__codelineno-5-12 name=__codelineno-5-12 href=#__codelineno-5-12></a><span class=w>  </span><span class=nt>storageClassName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nfs-slow</span>
<a id=__codelineno-5-13 name=__codelineno-5-13 href=#__codelineno-5-13></a><span class=w>  </span><span class=nt>mountOptions</span><span class=p>:</span>
<a id=__codelineno-5-14 name=__codelineno-5-14 href=#__codelineno-5-14></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">hard</span>
<a id=__codelineno-5-15 name=__codelineno-5-15 href=#__codelineno-5-15></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nfsvers=4.1</span>
<a id=__codelineno-5-16 name=__codelineno-5-16 href=#__codelineno-5-16></a><span class=w>  </span><span class=nt>nfs</span><span class=p>:</span>
<a id=__codelineno-5-17 name=__codelineno-5-17 href=#__codelineno-5-17></a><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/tmp</span>
<a id=__codelineno-5-18 name=__codelineno-5-18 href=#__codelineno-5-18></a><span class=w>    </span><span class=nt>server</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">172.17.0.2</span>
</code></pre></div> <ul> <li>capacity：容量配置。</li> <li>volumeMode：卷的模式，目前支持Filesystem（文件系统）和Block（块），其中Block类型需要后端存储支持，默认为文件系统。l accessModes：该PV的访问模式。</li> <li>storageClassName：PV的类，一个特定类型的PV只能绑定到特定类别的PVC。</li> <li>persistentVolumeReclaimPolicy：回收策略。</li> <li>mountOptions：非必需，新版本中已弃用。</li> <li>nfs：NFS服务配置，包括以下两个选项。</li> <li>path：NFS上的共享目录。</li> <li>server：NFS的IP地址。</li> </ul> <div class="admonition warning"> <p class=admonition-title><strong>注意</strong></p> <p>一般情况下，企业内的NFS很有可能是没有高可用性的，所以在企业内部要谨慎使用NFS作为后台存储，可以使用公有云的NAS服务，和NFS的协议一致，或者使用支持文件系统类型的分布式存储，比如Ceph等。</p> </div> <h3 id=64-基于hostpath的pv>6.4 基于HostPath的PV<a class=headerlink href=#64-基于hostpath的pv title="Permanent link">&para;</a></h3> <p>可以创建一个基于hostPath的PV，和配置NFS的PV类似，只需要配置hostPath字段即可，其他配置基本一致：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolume</span>
<a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">task-pv-volume</span>
<a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a><span class=w>  </span><span class=nt>labels</span><span class=p>:</span>
<a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">local</span>
<a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-6-8 name=__codelineno-6-8 href=#__codelineno-6-8></a><span class=w>  </span><span class=nt>storageClassName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">manual</span>
<a id=__codelineno-6-9 name=__codelineno-6-9 href=#__codelineno-6-9></a><span class=w>  </span><span class=nt>capacity</span><span class=p>:</span>
<a id=__codelineno-6-10 name=__codelineno-6-10 href=#__codelineno-6-10></a><span class=w>    </span><span class=nt>storage</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10Gi</span>
<a id=__codelineno-6-11 name=__codelineno-6-11 href=#__codelineno-6-11></a><span class=w>  </span><span class=nt>accessModes</span><span class=p>:</span>
<a id=__codelineno-6-12 name=__codelineno-6-12 href=#__codelineno-6-12></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
<a id=__codelineno-6-13 name=__codelineno-6-13 href=#__codelineno-6-13></a><span class=w>  </span><span class=nt>hostPath</span><span class=p>:</span>
<a id=__codelineno-6-14 name=__codelineno-6-14 href=#__codelineno-6-14></a><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/mnt/data&quot;</span>
</code></pre></div> <p>配置参数说明：</p> <ul> <li>hostPath：宿主机路径配置。</li> </ul> <div class="admonition warning"> <p class=admonition-title><strong>注意</strong></p> <p>使用hostPath类型需要固定Pod所在的节点，防止Pod漂移造成数据丢失。</p> </div> <h3 id=65-基于ceph-rbd的pv>6.5 基于Ceph RBD的PV<a class=headerlink href=#65-基于ceph-rbd的pv title="Permanent link">&para;</a></h3> <p>Ceph可能是目前企业内最常用的一种分布式存储之一，同时支持文件系统、块存储及对象存储，和上述NFS和HostPath相比，具有高可用性和读写高效性。 接下来看一下Ceph RBD类型的PV配置：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolume</span>
<a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ceph-rbd-pv</span>
<a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a><span class=w>  </span><span class=nt>capacity</span><span class=p>:</span>
<a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a><span class=w>    </span><span class=nt>storage</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1Gi</span>
<a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a><span class=w>  </span><span class=nt>accessModes</span><span class=p>:</span>
<a id=__codelineno-7-9 name=__codelineno-7-9 href=#__codelineno-7-9></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
<a id=__codelineno-7-10 name=__codelineno-7-10 href=#__codelineno-7-10></a><span class=w>  </span><span class=nt>rbd</span><span class=p>:</span>
<a id=__codelineno-7-11 name=__codelineno-7-11 href=#__codelineno-7-11></a><span class=w>    </span><span class=nt>monitors</span><span class=p>:</span>
<a id=__codelineno-7-12 name=__codelineno-7-12 href=#__codelineno-7-12></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">192.168.1.123:6789</span>
<a id=__codelineno-7-13 name=__codelineno-7-13 href=#__codelineno-7-13></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">192.168.1.124:6789</span>
<a id=__codelineno-7-14 name=__codelineno-7-14 href=#__codelineno-7-14></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">192.168.1.125:6789</span>
<a id=__codelineno-7-15 name=__codelineno-7-15 href=#__codelineno-7-15></a><span class=w>    </span><span class=nt>pool</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rbd</span>
<a id=__codelineno-7-16 name=__codelineno-7-16 href=#__codelineno-7-16></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ceph-rbd-pv-test</span>
<a id=__codelineno-7-17 name=__codelineno-7-17 href=#__codelineno-7-17></a><span class=w>    </span><span class=nt>user</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">admin</span>
<a id=__codelineno-7-18 name=__codelineno-7-18 href=#__codelineno-7-18></a><span class=w>    </span><span class=nt>secretRef</span><span class=p>:</span>
<a id=__codelineno-7-19 name=__codelineno-7-19 href=#__codelineno-7-19></a><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ceph-secret</span>
<a id=__codelineno-7-20 name=__codelineno-7-20 href=#__codelineno-7-20></a><span class=w>    </span><span class=nt>fsType</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ext4</span>
<a id=__codelineno-7-21 name=__codelineno-7-21 href=#__codelineno-7-21></a><span class=w>    </span><span class=nt>readOnly</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</code></pre></div> <p>配置参数说明：</p> <ul> <li>monitors：Ceph的monitor节点的IP。</li> <li>pool：所用Ceph Pool的名称，可以使用ceph osd pool ls查看。</li> <li>image：Ceph块设备中的磁盘映像文件，可以使用rbd create POOL_NAME/IMAGE_NAME--size 1024创建，使用rbd list POOL_NAME查看。</li> <li>user：Rados的用户名，默认是admin。</li> <li>secretRef：用于验证Ceph身份的密钥。</li> <li>fsType：文件类型，可以是Ext4、XFS等。</li> <li>readOnly：是否是只读挂载。</li> </ul> <div class="admonition warning"> <p class=admonition-title><strong>注意</strong></p> <p>Ceph的Pool和Image需要提前创建才能使用。</p> <p>虽然前面讲述了RBD类型的PV配置示例，但是在实际使用时，大多数Ceph存储的使用都是采用动态存储的方式，很少通过静态方式去管理。</p> <p>同时，Kubernetes所有的节点都需要安装ceph-common才能正常挂载Ceph。</p> </div> <h3 id=66-pv的状态>6.6 PV的状态<a class=headerlink href=#66-pv的状态 title="Permanent link">&para;</a></h3> <p>在创建PV后，可以通过kubectl get pv查看已经创建的PV的状态：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>pv
<a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a>NAME<span class=w>                                       </span>CAPACITY<span class=w>   </span>ACCESS<span class=w> </span>MODES<span class=w>   </span>RECLAIM<span class=w> </span>POLICY<span class=w>   </span>STATUS<span class=w>   </span>CLAIM<span class=w>                            </span>STORAGECLASS<span class=w>                        </span>REASON<span class=w>   </span>AGE
<a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a>gitlab-postgresql-pv<span class=w>                       </span>200Gi<span class=w>      </span>RWO<span class=w>            </span>Retain<span class=w>           </span>Bound<span class=w>    </span>kube-ops/gitlab-postgresql-pvc<span class=w>   </span>managed-nfs-storage<span class=w>                          </span>115d
<a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a>gitlab-pv<span class=w>                                  </span>500Gi<span class=w>      </span>RWO<span class=w>            </span>Retain<span class=w>           </span>Bound<span class=w>    </span>kube-ops/gitlab-pvc<span class=w>              </span>managed-nfs-storage<span class=w>  </span>
</code></pre></div> <p>其中有一个字段STATUS表示当前PV的状态，会有以下几种状态：</p> <ul> <li>Available：可用，没有被PVC绑定的空闲资源。</li> <li>Bound：已绑定，已经被PVC绑定。</li> <li>Released：已释放，PVC被删除，但是资源还未被重新使用。</li> <li>Failed：失败，自动回收失败。</li> </ul> <h2 id=7-persistentvolumeclaim>7. PersistentVolumeClaim<a class=headerlink href=#7-persistentvolumeclaim title="Permanent link">&para;</a></h2> <p>由Kubernetes管理员提前创建了PV，我们应该怎样使用它呢？</p> <p>这里介绍Kubernetes的另一个概念PersistentVolumeClaim（ 简 称 PVC）。</p> <p>PVC是其他技术人员在Kubernetes上对存储的申请，它可以标明一个程序需要用到什么样的后端存储、多大的空间以及以什么访问模式进行挂载。 这一点和Pod的QoS配置类似，Pod消耗节点资源，PVC消耗PV资源，Pod可以请求特定级别的资源（CPU和内存），PVC可以请求特定的大小和访问模式的PV。</p> <p>例如申请一个大小为5Gi且只能被一个Pod只读访问的存储。</p> <p>在实际使用时，虽然用户通过PVC获取存储支持，但是用户可能需要具有不同性质的PV来解决不同的问题，比如使用SSD硬盘来提高性能。 所以集群管理员需要根据不同的存储后端来提供各种PV，而不仅仅是大小和访问模式的区别，并且无须让用户了解这些卷的具体实现方式和存储类型，达到了存储 的解藕，降低了存储使用的复杂度。</p> <p>在8.6节的PV部分，我们列举了几个常用的存储类型的配置方式，接下来看一下如何让PVC和这些PV绑定。</p> <div class="admonition warning"> <p class=admonition-title><strong>注意</strong></p> <p>PVC和PV进行绑定的前提条件是一些参数必须匹配，比如accessModes、storageClassName、volumeMode都需要相同， 并且PVC的storage需要小于等于PV的storage配置。</p> </div> <h3 id=71-pvc的创建>7.1 PVC的创建<a class=headerlink href=#71-pvc的创建 title="Permanent link">&para;</a></h3> <p>此时可以创建一个PVC即可与其绑定（注意PV和PVC加粗的部分，PV和PVC进行绑定并非是名字相同，而是StorageClassName相同且其他参数一致才可以进行绑定），代码如下：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolume</span>
<a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">task-pv-volume</span>
<a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a><span class=w>  </span><span class=nt>labels</span><span class=p>:</span>
<a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">local</span>
<a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-9-8 name=__codelineno-9-8 href=#__codelineno-9-8></a><span class=w>  </span><span class=nt>storageClassName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">manual</span>
<a id=__codelineno-9-9 name=__codelineno-9-9 href=#__codelineno-9-9></a><span class=w>  </span><span class=nt>capacity</span><span class=p>:</span>
<a id=__codelineno-9-10 name=__codelineno-9-10 href=#__codelineno-9-10></a><span class=w>    </span><span class=nt>storage</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10Gi</span>
<a id=__codelineno-9-11 name=__codelineno-9-11 href=#__codelineno-9-11></a><span class=w>  </span><span class=nt>accessModes</span><span class=p>:</span>
<a id=__codelineno-9-12 name=__codelineno-9-12 href=#__codelineno-9-12></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
<a id=__codelineno-9-13 name=__codelineno-9-13 href=#__codelineno-9-13></a><span class=w>  </span><span class=nt>hostPath</span><span class=p>:</span>
<a id=__codelineno-9-14 name=__codelineno-9-14 href=#__codelineno-9-14></a><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/mnt/data&quot;</span>
<a id=__codelineno-9-15 name=__codelineno-9-15 href=#__codelineno-9-15></a><span class=nn>---</span>
<a id=__codelineno-9-16 name=__codelineno-9-16 href=#__codelineno-9-16></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
<a id=__codelineno-9-17 name=__codelineno-9-17 href=#__codelineno-9-17></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id=__codelineno-9-18 name=__codelineno-9-18 href=#__codelineno-9-18></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-9-19 name=__codelineno-9-19 href=#__codelineno-9-19></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">task-pv-claim</span>
<a id=__codelineno-9-20 name=__codelineno-9-20 href=#__codelineno-9-20></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-9-21 name=__codelineno-9-21 href=#__codelineno-9-21></a><span class=w>  </span><span class=nt>storageClassName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">manual</span>
<a id=__codelineno-9-22 name=__codelineno-9-22 href=#__codelineno-9-22></a><span class=w>  </span><span class=nt>accessModes</span><span class=p>:</span>
<a id=__codelineno-9-23 name=__codelineno-9-23 href=#__codelineno-9-23></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
<a id=__codelineno-9-24 name=__codelineno-9-24 href=#__codelineno-9-24></a><span class=w>  </span><span class=nt>resources</span><span class=p>:</span>
<a id=__codelineno-9-25 name=__codelineno-9-25 href=#__codelineno-9-25></a><span class=w>    </span><span class=nt>requests</span><span class=p>:</span>
<a id=__codelineno-9-26 name=__codelineno-9-26 href=#__codelineno-9-26></a><span class=w>      </span><span class=nt>storage</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3Gi</span>
</code></pre></div> <div class="admonition warning"> <p class=admonition-title><strong>注意</strong></p> <blockquote> <p>PVC具有命名空间隔离性，上述代码没有添加namespace参数，会默认创建在default命名空间。</p> <p>如果需要给其他命名空间的Pod使用，就应将其创建在指定的命名空间。</p> </blockquote> </div> <p>同样的方式也可以给NFS类型的PV创建一个PVC：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
<a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">pvc-nfs</span>
<a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a><span class=w>  </span><span class=nt>storageClassName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nfs-slow</span>
<a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a><span class=w>  </span><span class=nt>accessModes</span><span class=p>:</span>
<a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
<a id=__codelineno-10-9 name=__codelineno-10-9 href=#__codelineno-10-9></a><span class=w>  </span><span class=nt>resources</span><span class=p>:</span>
<a id=__codelineno-10-10 name=__codelineno-10-10 href=#__codelineno-10-10></a><span class=w>    </span><span class=nt>requests</span><span class=p>:</span>
<a id=__codelineno-10-11 name=__codelineno-10-11 href=#__codelineno-10-11></a><span class=w>      </span><span class=nt>storage</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3Gi</span>
</code></pre></div> <p>从上述两个简单的例子可以看出，PVC的定义和后端存储并没有关系。</p> <p>对于有存储需求的技术人员，直接定义PVC即可绑定一块PV，之后就可以供Pod使用，而不用去关心具体的实现细节，大大降低了存储的复杂度。</p> <p>接下来我们看一下PVC如何提供给Pod使用。</p> <h3 id=72-pvc的使用>7.2 PVC的使用<a class=headerlink href=#72-pvc的使用 title="Permanent link">&para;</a></h3> <p>上述创建了PV，并使用PVC与其绑定，现在还差一步就能让程序使用这块存储，那就是将PVC挂载到Pod。和之前的挂载方式类似，PVC的挂载也是通过volumes字段进行配置的，只不过之前需要根据不同的存储后端填写很多复杂的参数，而使用PVC进行挂载时，只填写PVC的名字即可，不需要再关心任何的存储细节，这样即使不是Kubernetes管理员，不懂存储的其他技术人员想要使用存储，也可以非常简单地进行配置和使用。</p> <p>比如我们将之前创建的hostPath类型的PVC挂载到Pod中，可以看到只需要配置一个persistentVolumeClaim类型的volumes，claimName配置为PVC的名称即可：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span>
<a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">task-pv-pod</span>
<a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a><span class=w>  </span><span class=nt>volumes</span><span class=p>:</span>
<a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">task-pv-storage</span>
<a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a><span class=w>      </span><span class=nt>persistentVolumeClaim</span><span class=p>:</span>
<a id=__codelineno-11-9 name=__codelineno-11-9 href=#__codelineno-11-9></a><span class=w>       </span><span class=nt>claimName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">task-pv-claim</span>
<a id=__codelineno-11-10 name=__codelineno-11-10 href=#__codelineno-11-10></a><span class=w>  </span><span class=nt>containers</span><span class=p>:</span>
<a id=__codelineno-11-11 name=__codelineno-11-11 href=#__codelineno-11-11></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">task-pv-container</span>
<a id=__codelineno-11-12 name=__codelineno-11-12 href=#__codelineno-11-12></a><span class=w>      </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<a id=__codelineno-11-13 name=__codelineno-11-13 href=#__codelineno-11-13></a><span class=w>      </span><span class=nt>ports</span><span class=p>:</span>
<a id=__codelineno-11-14 name=__codelineno-11-14 href=#__codelineno-11-14></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<a id=__codelineno-11-15 name=__codelineno-11-15 href=#__codelineno-11-15></a><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;http-server&quot;</span>
<a id=__codelineno-11-16 name=__codelineno-11-16 href=#__codelineno-11-16></a><span class=w>      </span><span class=nt>volumeMounts</span><span class=p>:</span>
<a id=__codelineno-11-17 name=__codelineno-11-17 href=#__codelineno-11-17></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/usr/share/nginx/html&quot;</span>
<a id=__codelineno-11-18 name=__codelineno-11-18 href=#__codelineno-11-18></a><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">task-pv-storage</span>
</code></pre></div> <div class="admonition warning"> <p class=admonition-title><strong>注意</strong></p> <blockquote> <p>claimName需要和上述定义的PVC名称task-pv-claim一致。</p> </blockquote> </div> <h2 id=8动态存储storageclass>8.动态存储StorageClass<a class=headerlink href=#8动态存储storageclass title="Permanent link">&para;</a></h2> <p>虽然使用PV和PVC能屏蔽一些存储使用上的细节，降低了存储使用的复杂度，但是也会有另一个问题无法解决。</p> <p>当公司Kubernetes集群很多，并且使用它们的技术人员过多时，对于PV的创建是一个很耗时、耗力的工作，并且达到一定规模后，过多的PV将难以维护。</p> <p>所以就需要某种机制用于自动管理PV的生命周期，比如创建、删除、自动扩容等，于是Kubernetes就设计了一个名为StorageClass（缩写为SC，没有命名空间隔离性）的东西，通过它可以动态管理集群中的PV，这样Kubernetes管理员就无须浪费大量的时间在PV的管理中。</p> <p>在Kubernetes中，管理员可以只创建StorageClass“链接”到后端不同的存储，比如Ceph、GlusterFS、OpenStack的Cinder、其他公有云提供的存储等，之后有存储需求的技术人员，创建一个PVC指向对应的StorageClass即可，StorageClass会自动创建PV供Pod使用，也可以使用StatefulSet的volumeClaimTemplate自动分别为每个Pod申请一个PVC。</p> <p>接下来看一下如何定义一个StorageClass。</p> <h3 id=81-定义storageclass>8.1 定义StorageClass<a class=headerlink href=#81-定义storageclass title="Permanent link">&para;</a></h3> <p>定义一个StorageClass的示例如下：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">storage.k8s.io/v1</span>
<a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">StorageClass</span>
<a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">slow</span>
<a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a><span class=nt>provisioner</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes.io/glusterfs</span>
<a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a><span class=nt>parameters</span><span class=p>:</span>
<a id=__codelineno-12-7 name=__codelineno-12-7 href=#__codelineno-12-7></a><span class=w>  </span><span class=nt>resturl</span><span class=p>:</span><span class=w> </span><span class=s>&quot;http://127.0.0.1:8081&quot;</span>
<a id=__codelineno-12-8 name=__codelineno-12-8 href=#__codelineno-12-8></a><span class=w>  </span><span class=nt>clusterid</span><span class=p>:</span><span class=w> </span><span class=s>&quot;630372ccdc720a92c681fb928f27b53f&quot;</span>
<a id=__codelineno-12-9 name=__codelineno-12-9 href=#__codelineno-12-9></a><span class=w>  </span><span class=nt>restauthenabled</span><span class=p>:</span><span class=w> </span><span class=s>&quot;true&quot;</span>
<a id=__codelineno-12-10 name=__codelineno-12-10 href=#__codelineno-12-10></a><span class=w>  </span><span class=nt>restuser</span><span class=p>:</span><span class=w> </span><span class=s>&quot;admin&quot;</span>
<a id=__codelineno-12-11 name=__codelineno-12-11 href=#__codelineno-12-11></a><span class=w>  </span><span class=nt>secretNamespace</span><span class=p>:</span><span class=w> </span><span class=s>&quot;default&quot;</span>
<a id=__codelineno-12-12 name=__codelineno-12-12 href=#__codelineno-12-12></a><span class=w>  </span><span class=nt>secretName</span><span class=p>:</span><span class=w> </span><span class=s>&quot;heketi-secret&quot;</span>
<a id=__codelineno-12-13 name=__codelineno-12-13 href=#__codelineno-12-13></a><span class=w>  </span><span class=nt>gidMin</span><span class=p>:</span><span class=w> </span><span class=s>&quot;40000&quot;</span>
<a id=__codelineno-12-14 name=__codelineno-12-14 href=#__codelineno-12-14></a><span class=w>  </span><span class=nt>gidMax</span><span class=p>:</span><span class=w> </span><span class=s>&quot;50000&quot;</span>
<a id=__codelineno-12-15 name=__codelineno-12-15 href=#__codelineno-12-15></a><span class=w>  </span><span class=nt>volumetype</span><span class=p>:</span><span class=w> </span><span class=s>&quot;replicate:3&quot;</span>
</code></pre></div> <p>该示例是使用StorageClass链接GlusterFS的一个示例，PV和Volume可以直接配置GlusterFS，其配置参数和StorageClass的parameters类似，只不过PV是单独供PVC使用的，</p> <p>Volume是针对某个Pod使用的，而StorageClass是一个全局的配置，没有命名空间隔离性，任何命名空间下有存储需求的应用都可以配置对应的StorageClass来获取存储。</p> <p>StorageClass还提供了一些更高级的配置，比如provisioner、parameters、reclaimPolicy、allowVolumeExpansion等。</p> <ul> <li>Provisioner：直译过来是供应商的意思，也就是通过该参数来标明对于PV的创建使用哪个插件来执行，比如创建GlusterFS类型的PV，需要使用GlusterFS的插件才能创建，必须指定此字段。</li> </ul> <blockquote> <p>目前官方支持的Provisioner可以在此处查看：<a href=https://kubernetes.io/docs/concepts/storage/storage-classes/#provisioner>https://kubernetes.io/docs/concepts/storage/storage-classes/#provisioner</a>。</p> </blockquote> <div class="admonition warning"> <p class=admonition-title><strong>注意</strong></p> <blockquote> <p>Provisioner不仅限于官方列出的内部provisioner，还可以运行和指定外部供应商。</p> <p>例如，NFS不提供内部配置程序，但是可以使用外部配置程序，外部配置方式参见网址（其他类型的存储可以在其官方文档或者GitHub进行查找）：</p> <p><a href=https://github.com/kubernetes-incubator/external-storage>https://github.com/kubernetes-incubator/external-storage</a>。</p> </blockquote> </div> <ul> <li>Parameters：针对后端配置的不同参数，比如上述的GlusterFS类型的StorageClass，可以指定数据的副本数（replicate:3）、Gluster REST服务/Heketi服务的URL等。该参数的定义取决于provisioner，不同的provisioner配置的参数不同。如果该参数省略会使用默认值。</li> <li>ReclaimPolicy：回收策略，可以是Delete、Retain，默认为Delete，也就是PVC被删除后，对应的PV如何处理。</li> <li>MountOptions：通过StorageClass动态创建的PV可以使用MountOptions指定挂载参数。如果指定的卷插件不支持指定的挂载选项，就不会被创建成功，因此在设置时需要进行确认。</li> <li>AllowVolumeExpansion：是否允许对PV进行扩容，需要后端存储支持，一般不推荐进行缩容。目前支持扩容的存储类型可以在以下文档查看：<a href=https://kubernetes.io/docs/concepts/storage/storage-classes/#allow-volume-expansion>https://kubernetes.io/docs/concepts/storage/storage-classes/#allow-volume-expansion</a>。</li> </ul> <p>该小节通过一个简单的示例来说明如何配置一个StorageClass，对于其他不同类型的存储配置方式只是parameters不一样，使用方式都是一样的。</p> <blockquote> <p>其他类型的存储可以参考官方文档：<a href=https://kubernetes.io/docs/concepts/storage/storage-classes/#parameters>https://kubernetes.io/docs/concepts/storage/storage-classes/#parameters</a>。</p> </blockquote> <p>接下来通过一个Ceph RBD的示例来演示一下StorageClass的使用方法。</p> <h3 id=82-整合storageclass和ceph-rbd>8.2 整合StorageClass和Ceph RBD<a class=headerlink href=#82-整合storageclass和ceph-rbd title="Permanent link">&para;</a></h3> <ol> <li>Kubernetes集群的安装可以参考本书安装篇</li> <li>Ceph集群的搭建可以参考其官方文档：<a href=https://docs.ceph.com/en/latest/install/ >https://docs.ceph.com/en/latest/install/</a></li> </ol> <p>本小节内容假定实验环境已经有了Kubernetes集群和Ceph集群。</p> <h4 id=821-部署ceph-rbd-provisioner>8.2.1 部署Ceph RBD Provisioner<a class=headerlink href=#821-部署ceph-rbd-provisioner title="Permanent link">&para;</a></h4> <p>provi-cephrbd.yaml</p> <div class=highlight><pre><span></span><code><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=nn>---</span>
<a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ClusterRole</span>
<a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
<a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rbd-provisioner</span>
<a id=__codelineno-13-6 name=__codelineno-13-6 href=#__codelineno-13-6></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kube-system</span>
<a id=__codelineno-13-7 name=__codelineno-13-7 href=#__codelineno-13-7></a><span class=nt>rules</span><span class=p>:</span>
<a id=__codelineno-13-8 name=__codelineno-13-8 href=#__codelineno-13-8></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;&quot;</span><span class="p p-Indicator">]</span>
<a id=__codelineno-13-9 name=__codelineno-13-9 href=#__codelineno-13-9></a><span class=w>    </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;persistentvolumes&quot;</span><span class="p p-Indicator">]</span>
<a id=__codelineno-13-10 name=__codelineno-13-10 href=#__codelineno-13-10></a><span class=w>    </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;get&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;list&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;watch&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;create&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;delete&quot;</span><span class="p p-Indicator">]</span>
<a id=__codelineno-13-11 name=__codelineno-13-11 href=#__codelineno-13-11></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;&quot;</span><span class="p p-Indicator">]</span>
<a id=__codelineno-13-12 name=__codelineno-13-12 href=#__codelineno-13-12></a><span class=w>    </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;persistentvolumeclaims&quot;</span><span class="p p-Indicator">]</span>
<a id=__codelineno-13-13 name=__codelineno-13-13 href=#__codelineno-13-13></a><span class=w>    </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;get&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;list&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;watch&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;update&quot;</span><span class="p p-Indicator">]</span>
<a id=__codelineno-13-14 name=__codelineno-13-14 href=#__codelineno-13-14></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;storage.k8s.io&quot;</span><span class="p p-Indicator">]</span>
<a id=__codelineno-13-15 name=__codelineno-13-15 href=#__codelineno-13-15></a><span class=w>    </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;storageclasses&quot;</span><span class="p p-Indicator">]</span>
<a id=__codelineno-13-16 name=__codelineno-13-16 href=#__codelineno-13-16></a><span class=w>    </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;get&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;list&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;watch&quot;</span><span class="p p-Indicator">]</span>
<a id=__codelineno-13-17 name=__codelineno-13-17 href=#__codelineno-13-17></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;&quot;</span><span class="p p-Indicator">]</span>
<a id=__codelineno-13-18 name=__codelineno-13-18 href=#__codelineno-13-18></a><span class=w>    </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;events&quot;</span><span class="p p-Indicator">]</span>
<a id=__codelineno-13-19 name=__codelineno-13-19 href=#__codelineno-13-19></a><span class=w>    </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;create&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;update&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;patch&quot;</span><span class="p p-Indicator">]</span>
<a id=__codelineno-13-20 name=__codelineno-13-20 href=#__codelineno-13-20></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;&quot;</span><span class="p p-Indicator">]</span>
<a id=__codelineno-13-21 name=__codelineno-13-21 href=#__codelineno-13-21></a><span class=w>    </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;services&quot;</span><span class="p p-Indicator">]</span>
<a id=__codelineno-13-22 name=__codelineno-13-22 href=#__codelineno-13-22></a><span class=w>    </span><span class=nt>resourceNames</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;kube-dns&quot;</span><span class="p p-Indicator">,</span><span class=s>&quot;coredns&quot;</span><span class="p p-Indicator">]</span>
<a id=__codelineno-13-23 name=__codelineno-13-23 href=#__codelineno-13-23></a><span class=w>    </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;list&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;get&quot;</span><span class="p p-Indicator">]</span>
<a id=__codelineno-13-24 name=__codelineno-13-24 href=#__codelineno-13-24></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;&quot;</span><span class="p p-Indicator">]</span>
<a id=__codelineno-13-25 name=__codelineno-13-25 href=#__codelineno-13-25></a><span class=w>    </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;endpoints&quot;</span><span class="p p-Indicator">]</span>
<a id=__codelineno-13-26 name=__codelineno-13-26 href=#__codelineno-13-26></a><span class=w>    </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;get&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;list&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;watch&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;create&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;update&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;patch&quot;</span><span class="p p-Indicator">]</span>
<a id=__codelineno-13-27 name=__codelineno-13-27 href=#__codelineno-13-27></a>
<a id=__codelineno-13-28 name=__codelineno-13-28 href=#__codelineno-13-28></a><span class=nn>---</span>
<a id=__codelineno-13-29 name=__codelineno-13-29 href=#__codelineno-13-29></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ClusterRoleBinding</span>
<a id=__codelineno-13-30 name=__codelineno-13-30 href=#__codelineno-13-30></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
<a id=__codelineno-13-31 name=__codelineno-13-31 href=#__codelineno-13-31></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-13-32 name=__codelineno-13-32 href=#__codelineno-13-32></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rbd-provisioner</span>
<a id=__codelineno-13-33 name=__codelineno-13-33 href=#__codelineno-13-33></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kube-system</span>
<a id=__codelineno-13-34 name=__codelineno-13-34 href=#__codelineno-13-34></a><span class=nt>subjects</span><span class=p>:</span>
<a id=__codelineno-13-35 name=__codelineno-13-35 href=#__codelineno-13-35></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ServiceAccount</span>
<a id=__codelineno-13-36 name=__codelineno-13-36 href=#__codelineno-13-36></a><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rbd-provisioner</span>
<a id=__codelineno-13-37 name=__codelineno-13-37 href=#__codelineno-13-37></a><span class=w>    </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kube-system</span>
<a id=__codelineno-13-38 name=__codelineno-13-38 href=#__codelineno-13-38></a><span class=nt>roleRef</span><span class=p>:</span>
<a id=__codelineno-13-39 name=__codelineno-13-39 href=#__codelineno-13-39></a><span class=w>  </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ClusterRole</span>
<a id=__codelineno-13-40 name=__codelineno-13-40 href=#__codelineno-13-40></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rbd-provisioner</span>
<a id=__codelineno-13-41 name=__codelineno-13-41 href=#__codelineno-13-41></a><span class=w>  </span><span class=nt>apiGroup</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io</span>
<a id=__codelineno-13-42 name=__codelineno-13-42 href=#__codelineno-13-42></a>
<a id=__codelineno-13-43 name=__codelineno-13-43 href=#__codelineno-13-43></a><span class=nn>---</span>
<a id=__codelineno-13-44 name=__codelineno-13-44 href=#__codelineno-13-44></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
<a id=__codelineno-13-45 name=__codelineno-13-45 href=#__codelineno-13-45></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Role</span>
<a id=__codelineno-13-46 name=__codelineno-13-46 href=#__codelineno-13-46></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-13-47 name=__codelineno-13-47 href=#__codelineno-13-47></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rbd-provisioner</span>
<a id=__codelineno-13-48 name=__codelineno-13-48 href=#__codelineno-13-48></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kube-system</span>
<a id=__codelineno-13-49 name=__codelineno-13-49 href=#__codelineno-13-49></a><span class=nt>rules</span><span class=p>:</span>
<a id=__codelineno-13-50 name=__codelineno-13-50 href=#__codelineno-13-50></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;&quot;</span><span class="p p-Indicator">]</span>
<a id=__codelineno-13-51 name=__codelineno-13-51 href=#__codelineno-13-51></a><span class=w>  </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;secrets&quot;</span><span class="p p-Indicator">]</span>
<a id=__codelineno-13-52 name=__codelineno-13-52 href=#__codelineno-13-52></a><span class=w>  </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;get&quot;</span><span class="p p-Indicator">]</span>
<a id=__codelineno-13-53 name=__codelineno-13-53 href=#__codelineno-13-53></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;&quot;</span><span class="p p-Indicator">]</span>
<a id=__codelineno-13-54 name=__codelineno-13-54 href=#__codelineno-13-54></a><span class=w>  </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;endpoints&quot;</span><span class="p p-Indicator">]</span>
<a id=__codelineno-13-55 name=__codelineno-13-55 href=#__codelineno-13-55></a><span class=w>  </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;get&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;list&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;watch&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;create&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;update&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;patch&quot;</span><span class="p p-Indicator">]</span>
<a id=__codelineno-13-56 name=__codelineno-13-56 href=#__codelineno-13-56></a>
<a id=__codelineno-13-57 name=__codelineno-13-57 href=#__codelineno-13-57></a><span class=nn>---</span>
<a id=__codelineno-13-58 name=__codelineno-13-58 href=#__codelineno-13-58></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
<a id=__codelineno-13-59 name=__codelineno-13-59 href=#__codelineno-13-59></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">RoleBinding</span>
<a id=__codelineno-13-60 name=__codelineno-13-60 href=#__codelineno-13-60></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-13-61 name=__codelineno-13-61 href=#__codelineno-13-61></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rbd-provisioner</span>
<a id=__codelineno-13-62 name=__codelineno-13-62 href=#__codelineno-13-62></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kube-system</span>
<a id=__codelineno-13-63 name=__codelineno-13-63 href=#__codelineno-13-63></a><span class=nt>roleRef</span><span class=p>:</span>
<a id=__codelineno-13-64 name=__codelineno-13-64 href=#__codelineno-13-64></a><span class=w>  </span><span class=nt>apiGroup</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io</span>
<a id=__codelineno-13-65 name=__codelineno-13-65 href=#__codelineno-13-65></a><span class=w>  </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Role</span>
<a id=__codelineno-13-66 name=__codelineno-13-66 href=#__codelineno-13-66></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rbd-provisioner</span>
<a id=__codelineno-13-67 name=__codelineno-13-67 href=#__codelineno-13-67></a><span class=nt>subjects</span><span class=p>:</span>
<a id=__codelineno-13-68 name=__codelineno-13-68 href=#__codelineno-13-68></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ServiceAccount</span>
<a id=__codelineno-13-69 name=__codelineno-13-69 href=#__codelineno-13-69></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rbd-provisioner</span>
<a id=__codelineno-13-70 name=__codelineno-13-70 href=#__codelineno-13-70></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kube-system</span>
<a id=__codelineno-13-71 name=__codelineno-13-71 href=#__codelineno-13-71></a>
<a id=__codelineno-13-72 name=__codelineno-13-72 href=#__codelineno-13-72></a><span class=nn>---</span>
<a id=__codelineno-13-73 name=__codelineno-13-73 href=#__codelineno-13-73></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<a id=__codelineno-13-74 name=__codelineno-13-74 href=#__codelineno-13-74></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<a id=__codelineno-13-75 name=__codelineno-13-75 href=#__codelineno-13-75></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-13-76 name=__codelineno-13-76 href=#__codelineno-13-76></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rbd-provisioner</span>
<a id=__codelineno-13-77 name=__codelineno-13-77 href=#__codelineno-13-77></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kube-system</span>
<a id=__codelineno-13-78 name=__codelineno-13-78 href=#__codelineno-13-78></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-13-79 name=__codelineno-13-79 href=#__codelineno-13-79></a><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<a id=__codelineno-13-80 name=__codelineno-13-80 href=#__codelineno-13-80></a><span class=w>  </span><span class=nt>selector</span><span class=p>:</span>
<a id=__codelineno-13-81 name=__codelineno-13-81 href=#__codelineno-13-81></a><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span>
<a id=__codelineno-13-82 name=__codelineno-13-82 href=#__codelineno-13-82></a><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rbd-provisioner</span>
<a id=__codelineno-13-83 name=__codelineno-13-83 href=#__codelineno-13-83></a><span class=w>  </span><span class=nt>strategy</span><span class=p>:</span>
<a id=__codelineno-13-84 name=__codelineno-13-84 href=#__codelineno-13-84></a><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Recreate</span>
<a id=__codelineno-13-85 name=__codelineno-13-85 href=#__codelineno-13-85></a><span class=w>  </span><span class=nt>template</span><span class=p>:</span>
<a id=__codelineno-13-86 name=__codelineno-13-86 href=#__codelineno-13-86></a><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-13-87 name=__codelineno-13-87 href=#__codelineno-13-87></a><span class=w>      </span><span class=nt>labels</span><span class=p>:</span>
<a id=__codelineno-13-88 name=__codelineno-13-88 href=#__codelineno-13-88></a><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rbd-provisioner</span>
<a id=__codelineno-13-89 name=__codelineno-13-89 href=#__codelineno-13-89></a><span class=w>    </span><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-13-90 name=__codelineno-13-90 href=#__codelineno-13-90></a><span class=w>      </span><span class=nt>containers</span><span class=p>:</span>
<a id=__codelineno-13-91 name=__codelineno-13-91 href=#__codelineno-13-91></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rbd-provisioner</span>
<a id=__codelineno-13-92 name=__codelineno-13-92 href=#__codelineno-13-92></a><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=s>&quot;registry.cn-beijing.aliyuncs.com/dotbalo/rbd-provisioner:latest&quot;</span>
<a id=__codelineno-13-93 name=__codelineno-13-93 href=#__codelineno-13-93></a><span class=w>        </span><span class=nt>env</span><span class=p>:</span>
<a id=__codelineno-13-94 name=__codelineno-13-94 href=#__codelineno-13-94></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">PROVISIONER_NAME</span>
<a id=__codelineno-13-95 name=__codelineno-13-95 href=#__codelineno-13-95></a><span class=w>          </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ceph.com/rbd</span>
</code></pre></div> <p>首先安装Ceph RBD的Provisioner，直接执行以下命令即可安装Ceph RBD Provisioner，并创建其相关的权限：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a>$<span class=w> </span>kubectl<span class=w>  </span>apply<span class=w> </span>-f<span class=w> </span>provi-cephrbd.yaml
<a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a>serviceaccount/rbd-provisioner<span class=w> </span>created
<a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a>clusterrole.rbac.authorization.k8s.io/rbd-provisioner<span class=w> </span>created
<a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a>clusterrolebinding.rbac.authorization.k8s.io/rbd-provisioner<span class=w> </span>created
<a id=__codelineno-14-5 name=__codelineno-14-5 href=#__codelineno-14-5></a>role.rbac.authorization.k8s.io/rbd-provisioner<span class=w> </span>created
<a id=__codelineno-14-6 name=__codelineno-14-6 href=#__codelineno-14-6></a>rolebinding.rbac.authorization.k8s.io/rbd-provisioner<span class=w> </span>created
<a id=__codelineno-14-7 name=__codelineno-14-7 href=#__codelineno-14-7></a>deployment.apps/rbd-provisioner<span class=w> </span>created
</code></pre></div> <p>查看Pod状态：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>pods<span class=w> </span>-n<span class=w> </span>kube-system<span class=w> </span>-l<span class=w> </span><span class=nv>app</span><span class=o>=</span>rbd-provisioner
</code></pre></div> <h4 id=822-创建ceph-pool>8.2.2 创建Ceph Pool<a class=headerlink href=#822-创建ceph-pool title="Permanent link">&para;</a></h4> <p>接下来创建一个Kubernetes专用的Pool为Pod提供PV，当然也可以使用已经存在的Pool。</p> <p>登录Ceph的管理端，创建一个名为rbdfork8s、pg_num为128（生产环境根据实际情况配置pg_num，具体可以参考Ceph文档）的Pool：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a>$<span class=w> </span>ceph<span class=w> </span>osd<span class=w> </span>pool<span class=w> </span>create<span class=w> </span>rbdfork8s<span class=w> </span><span class=m>128</span>
<a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a>pool<span class=w> </span><span class=s1>&#39;rbdfork8s&#39;</span><span class=w> </span>created
</code></pre></div> <p>对新建的Pool进行单独授权：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a>$<span class=w> </span>ceph<span class=w> </span>auth<span class=w> </span>add<span class=w> </span>client.kube<span class=w> </span>mon<span class=w> </span><span class=s1>&#39;allow r&#39;</span><span class=w> </span>osd<span class=w> </span><span class=s1>&#39;allow rwx pool=rbdfork8s&#39;</span>
<a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a>added<span class=w> </span>key<span class=w> </span><span class=k>for</span><span class=w> </span>client.kube
</code></pre></div> <p>初始化该Pool（不是新建的Pool无须初始化）：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a>$<span class=w> </span>ceph<span class=w> </span>osd<span class=w> </span>pool<span class=w> </span>application<span class=w> </span><span class=nb>enable</span><span class=w> </span>rbdfork8s<span class=w> </span>rbd
<a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a>enabled<span class=w> </span>application<span class=w> </span><span class=s1>&#39;rbd&#39;</span><span class=w> </span>on<span class=w> </span>pool<span class=w> </span><span class=s1>&#39;rbdfork8s&#39;</span>
<a id=__codelineno-18-3 name=__codelineno-18-3 href=#__codelineno-18-3></a>
<a id=__codelineno-18-4 name=__codelineno-18-4 href=#__codelineno-18-4></a>$<span class=w> </span>rbd<span class=w> </span>pool<span class=w> </span>init<span class=w> </span>rbdfork8s
</code></pre></div> <p>查看client.kube的Key：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a>$<span class=w> </span>ceph<span class=w> </span>auth<span class=w> </span>get-key<span class=w> </span>client.kube
<a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a>AQB/eopgaqSRJxAAYDs2gKTXSpcpY2m+yHJaJw<span class=o>==</span>
</code></pre></div> <p>在Kubernetes中创建具有该Key的Secret，供StorageClass配置使用：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a>$<span class=w> </span>kubectl<span class=w> </span>create<span class=w> </span>secret<span class=w> </span>generic<span class=w> </span>ceph-k8s-secret<span class=w> </span><span class=se>\</span>
<a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a>--type<span class=o>=</span><span class=s2>&quot;kubernetes.io/rbd&quot;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-20-3 name=__codelineno-20-3 href=#__codelineno-20-3></a>--from-literal<span class=o>=</span><span class=nv>key</span><span class=o>=</span><span class=s1>&#39;AQB/eopgaqSRJxAAYDs2gKTXSpcpY2m+yHJaJw==&#39;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-20-4 name=__codelineno-20-4 href=#__codelineno-20-4></a>-n<span class=w> </span>kube-system
</code></pre></div> <p>admin用户的Key也要创建一个Secret供StorageClass使用，查看ceph admin的Key：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a>$<span class=w> </span>ceph<span class=w> </span>auth<span class=w> </span>get-key<span class=w> </span>client.admin
<a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a>AQA8HP9ezBHPDBAAdL+NteK0d1mjXZV47r4I7w<span class=o>==</span>
</code></pre></div> <p>将Key保存在Kubernetes的Secret中：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a>$<span class=w> </span>kubectl<span class=w> </span>create<span class=w> </span>secret<span class=w> </span>generic<span class=w> </span>ceph-admin-secret<span class=w> </span><span class=se>\</span>
<a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a>--type<span class=o>=</span><span class=s2>&quot;kubernetes.io/rbd&quot;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a>--from-literal<span class=o>=</span><span class=nv>key</span><span class=o>=</span><span class=s1>&#39;AQA8HP9ezBHPDBAAdL+NteK0d1mjXZV47r4I7w==&#39;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-22-4 name=__codelineno-22-4 href=#__codelineno-22-4></a>-n<span class=w> </span>kube-system
<a id=__codelineno-22-5 name=__codelineno-22-5 href=#__codelineno-22-5></a>
<a id=__codelineno-22-6 name=__codelineno-22-6 href=#__codelineno-22-6></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>secret<span class=w> </span>-n<span class=w> </span>kube-system<span class=w> </span>ceph-admin-secret
</code></pre></div> <h4 id=823-创建storageclass>8.2.3 创建StorageClass<a class=headerlink href=#823-创建storageclass title="Permanent link">&para;</a></h4> <p>在Ceph的管理端查看Monitor的节点信息：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a>$<span class=w> </span>ceph<span class=w> </span>mon<span class=w> </span>dump
</code></pre></div> <p>将打印的结果中的Monitor的IP地址填写到StorageClass中，一般为IP地址+6789端口（替换以下文件的monitors参数）：</p> <p>rbd-sc.yaml</p> <div class=highlight><pre><span></span><code><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a><span class=nn>---</span>
<a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">StorageClass</span>
<a id=__codelineno-24-3 name=__codelineno-24-3 href=#__codelineno-24-3></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">storage.k8s.io/v1</span>
<a id=__codelineno-24-4 name=__codelineno-24-4 href=#__codelineno-24-4></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-24-5 name=__codelineno-24-5 href=#__codelineno-24-5></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ceph-rbd</span>
<a id=__codelineno-24-6 name=__codelineno-24-6 href=#__codelineno-24-6></a><span class=nt>provisioner</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ceph.com/rbd</span>
<a id=__codelineno-24-7 name=__codelineno-24-7 href=#__codelineno-24-7></a><span class=nt>parameters</span><span class=p>:</span>
<a id=__codelineno-24-8 name=__codelineno-24-8 href=#__codelineno-24-8></a><span class=w>  </span><span class=nt>monitors</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">x.x.x.x:6789,x.x.x.x:6789,x.x.x.x:6789</span>
<a id=__codelineno-24-9 name=__codelineno-24-9 href=#__codelineno-24-9></a><span class=w>  </span><span class=nt>pool</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rbdfork8s</span>
<a id=__codelineno-24-10 name=__codelineno-24-10 href=#__codelineno-24-10></a><span class=w>  </span><span class=nt>adminId</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">admin</span>
<a id=__codelineno-24-11 name=__codelineno-24-11 href=#__codelineno-24-11></a><span class=w>  </span><span class=nt>adminSecretNamespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kube-system</span>
<a id=__codelineno-24-12 name=__codelineno-24-12 href=#__codelineno-24-12></a><span class=w>  </span><span class=nt>adminSecretName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ceph-admin-secret</span>
<a id=__codelineno-24-13 name=__codelineno-24-13 href=#__codelineno-24-13></a><span class=w>  </span><span class=nt>userId</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kube</span>
<a id=__codelineno-24-14 name=__codelineno-24-14 href=#__codelineno-24-14></a><span class=w>  </span><span class=nt>userSecretNamespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kube-system</span>
<a id=__codelineno-24-15 name=__codelineno-24-15 href=#__codelineno-24-15></a><span class=w>  </span><span class=nt>userSecretName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ceph-k8s-secret</span>
<a id=__codelineno-24-16 name=__codelineno-24-16 href=#__codelineno-24-16></a><span class=w>  </span><span class=nt>imageFormat</span><span class=p>:</span><span class=w> </span><span class=s>&quot;2&quot;</span>
<a id=__codelineno-24-17 name=__codelineno-24-17 href=#__codelineno-24-17></a><span class=w>  </span><span class=nt>imageFeatures</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">layering</span>
</code></pre></div> <p>创建该StorageClass：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a>$<span class=w> </span>kubectl<span class=w> </span>create<span class=w> </span>-f<span class=w> </span>rbd-sc.yaml
<a id=__codelineno-25-2 name=__codelineno-25-2 href=#__codelineno-25-2></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>sc
</code></pre></div> <h4 id=824-创建pvc>8.2.4 创建PVC<a class=headerlink href=#824-创建pvc title="Permanent link">&para;</a></h4> <p>之后创建一个PVC指向该StorageClass（注意storageClassName为上述创建的StorageClass的名字）：</p> <p>rbd-pvc.yaml</p> <div class=highlight><pre><span></span><code><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a><span class=nn>---</span>
<a id=__codelineno-26-2 name=__codelineno-26-2 href=#__codelineno-26-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
<a id=__codelineno-26-3 name=__codelineno-26-3 href=#__codelineno-26-3></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id=__codelineno-26-4 name=__codelineno-26-4 href=#__codelineno-26-4></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-26-5 name=__codelineno-26-5 href=#__codelineno-26-5></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rbd-pvc-test</span>
<a id=__codelineno-26-6 name=__codelineno-26-6 href=#__codelineno-26-6></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-26-7 name=__codelineno-26-7 href=#__codelineno-26-7></a><span class=w>  </span><span class=nt>accessModes</span><span class=p>:</span>
<a id=__codelineno-26-8 name=__codelineno-26-8 href=#__codelineno-26-8></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
<a id=__codelineno-26-9 name=__codelineno-26-9 href=#__codelineno-26-9></a><span class=w>  </span><span class=nt>storageClassName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ceph-rbd</span>
<a id=__codelineno-26-10 name=__codelineno-26-10 href=#__codelineno-26-10></a><span class=w>  </span><span class=nt>resources</span><span class=p>:</span>
<a id=__codelineno-26-11 name=__codelineno-26-11 href=#__codelineno-26-11></a><span class=w>    </span><span class=nt>requests</span><span class=p>:</span>
<a id=__codelineno-26-12 name=__codelineno-26-12 href=#__codelineno-26-12></a><span class=w>      </span><span class=nt>storage</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">100Mi</span>
</code></pre></div> <div class=highlight><pre><span></span><code><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a>$<span class=w> </span>kubectl<span class=w> </span>create<span class=w> </span>-f<span class=w> </span>rbd-pvc.yaml<span class=w> </span>
</code></pre></div> <p>创建完成之后，StorageClass会自动创建PV，然后与PVC进行绑定。</p> <h2 id=9存储的未来csi>9.存储的未来：CSI<a class=headerlink href=#9存储的未来csi title="Permanent link">&para;</a></h2> <p>前面讲解了Kubernetes存储的多种使用方式，比如Volumes直连、PV和动态存储StorageClass，虽然PV降低了其他人员使用存储 的复杂性 ， StorageClass也降低了Kubernetes管理员管理PV的难度。</p> <p>但是在Kubernetes 发展中还有一个棘手的问题，就是市面上目前有很多存储提供商，比如NFS、 Ceph、NAS等，它们都属于不同的“厂商”，由不同的团队维护，而每个公司根据自己的实际情况选择不同的存储，</p> <p>Kubernetes作为一个比较流行的云原 生操作系统，想要有更好的兼容性，就需要去兼容这些存储，这就意味着 Kubernetes的维护人员需要学习每种存储的使用方法，才能开发出使用某类 存储的功能，这对于Kubernetes维护人员来说将是一种挑战，同时随着存储的增多，Kubernetes的代码会显得越来越臃肿、难以维护，所以要有一种方式来解决这类问题。</p> <p>在之前的章节提到过，Kubernetes作为一个容器的编排平台，能够调度 多种不同的容器引擎，比如Containerd、Docker（1.24版本之前）、CRI-O 等。</p> <p>为了能够兼容更多的容器引擎，无须Kubernetes管理员编写多余的代 码，Kubernetes提出了CRI（Container Runtime Interface，容器运行时接 口）的概念，任何开发容器引擎的公司只需要兼容这个接口，就可以被 Kubernetes调度。</p> <p>为实现上述目标，Kubernetes又提出了一个新的标准CSI（Container Storage Interface，容器存储接口），该标准相当于在容器编排平台和存储 之间提供了一个“桥梁”，只要存储平台实现了这个接口，就能为编排平台 （不限于Kubernetes）提供存储功能。这种存储的实现需要存储厂商提供符合CSI标准的驱动，只要配置StorageClass链接该驱动即可为Kubernetes提供 存储。 CSI标准将存储的代码下沉到了存储厂商，而Kubernetes维护人员无须 再关注存储细节，只需要关注Kubernetes核心代码即可。</p> <p>这类开发方式称为out-of-tree，意思就是在Kubernetes核心代码外维护实现各类存储的接入， 之前的Volume 、 PV 、 StorageClass称为in-tree的开发方式，意思是在Kubernetes内部维护存储的接入。</p> <p>相比之下，out-of-tree是更佳的实现方式，于是现在很多in-tree的实现方式都在慢慢地向out-of-tree迁移。</p> <div class="admonition tip"> <p class=admonition-title>提示</p> <p>外置存储驱动除CSI外，还有一种实现方式，称为Flex Volume，由于已经过时，本书不再介绍。针对存储的接入，应该更倾向于CSI的方式。</p> </div> <p>以上简单讲解了CSI的概念，下面通过示例了解一下CSI具体的实现方式。其实CSI的配置也是比较简单的，可以简单理解为以下几个步骤：</p> <p>1）找到对应存储的CSI驱动及安装方式。 2）在Kubernetes集群中安装该驱动。 3）配置StorageClass链接至该驱动即可使用。</p> <p>接下来通过两个简单的例子，即CSI对接CephFS和Ceph RBD来学习CSI具体的使用方法。</p> <h3 id=91-通过csi连接cephfs>9.1 通过CSI连接CephFS<a class=headerlink href=#91-通过csi连接cephfs title="Permanent link">&para;</a></h3> <p>首先我们介绍如何通过CSI配置Ceph的文件存储， Ceph CSI的文档可以在https://github.com/ceph/ceph-csi查看， CephFS CSI的部署文档可以通过链接：<a href=https://github.com/ceph/ceph-csi/blob/devel/docs/deploy-cephfs.md>https://github.com/ceph/ceph-csi/blob/devel/docs/deploy-cephfs.md</a> 查看（该链接可能会有所变化，可以从https://github.com/ceph/ceph-csi的目录中查找）。</p> <p>CephFS和Ceph RBD的部署方式分为两种： Helm安装和直接使用YAML进行安装。</p> <p>由于两者涉及的YAML文件过多，在此使用Helm（Helm是Kubernetes的一种包管理工具，可以很方便地对复杂的平台进行一键式安装，Helm官方文 档：<a href=https://helm.sh/ >https://helm.sh/</a>）进行安装。</p> <p>首先需要在Kubernetes（本小节实验需要有Kubernetes和Ceph环境）的控制端（也就是执行Kubectl命令的机器）安装Helm的客户端工具，只需要下载Helm的二进制包即可：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a>$<span class=w> </span>curl<span class=w> </span>https://raw.githubusercontent.com/helm/helm/master/scripts/get-helm-3<span class=w> </span><span class=p>|</span><span class=w> </span>bash
<a id=__codelineno-28-2 name=__codelineno-28-2 href=#__codelineno-28-2></a>Downloading<span class=w> </span>https://get.helm.sh/helm-v3.5.4-linux-amd64.tar.gz
<a id=__codelineno-28-3 name=__codelineno-28-3 href=#__codelineno-28-3></a>Verifying<span class=w> </span>checksum...<span class=w> </span>Done.
<a id=__codelineno-28-4 name=__codelineno-28-4 href=#__codelineno-28-4></a>Preparing<span class=w> </span>to<span class=w> </span>install<span class=w> </span>helm<span class=w> </span>into<span class=w> </span>/usr/local/bin
</code></pre></div> <p>查看安装的Helm版本： <div class=highlight><pre><span></span><code><a id=__codelineno-29-1 name=__codelineno-29-1 href=#__codelineno-29-1></a>$<span class=w> </span>helm<span class=w> </span>version
<a id=__codelineno-29-2 name=__codelineno-29-2 href=#__codelineno-29-2></a>version.BuildInfo<span class=o>{</span>Version:<span class=s2>&quot;v3.5.4&quot;</span>,<span class=w> </span>GitCommit:<span class=s2>&quot;fe51cd1e31e6a202cba7dead9552a6d418ded79a&quot;</span>,<span class=w> </span>GitTreeState:<span class=s2>&quot;clean&quot;</span>,<span class=w> </span>GoVersion:<span class=s2>&quot;go1.15.11&quot;</span><span class=o>}</span>
</code></pre></div></p> <p>1．CephFS驱动安装 Helm安装完成后，进入本书该小节的文档目录，然后进入install文件夹，安装CephFS CSI： <div class=highlight><pre><span></span><code><a id=__codelineno-30-1 name=__codelineno-30-1 href=#__codelineno-30-1></a>$<span class=w> </span>kubectl<span class=w> </span>create<span class=w> </span>namespace<span class=w> </span>ceph-csi-cephfs
<a id=__codelineno-30-2 name=__codelineno-30-2 href=#__codelineno-30-2></a>namespace/ceph-csi-cephfs<span class=w> </span>created
<a id=__codelineno-30-3 name=__codelineno-30-3 href=#__codelineno-30-3></a>
<a id=__codelineno-30-4 name=__codelineno-30-4 href=#__codelineno-30-4></a>$<span class=w> </span>helm<span class=w> </span>install<span class=w> </span>--namespace<span class=w> </span><span class=s2>&quot;ceph-csi-cephfs&quot;</span><span class=w> </span><span class=s2>&quot;ceph-csi-cephfs&quot;</span><span class=w> </span>.
</code></pre></div></p> <div class="admonition warning"> <p class=admonition-title><strong>注意</strong></p> <blockquote> <p>由于Helm包默认的镜像地址是gcr.io仓库，国内可能无法访问，因此本书所用的包已经为读者将相关gcr镜像同步到了阿里云，可以直接安装。 如果 使用的是新的Helm包，需要自行同步gcr镜像至阿里云或公司内的镜像仓库，新版安装文档： <a href=https://github.com/ceph/ceph-csi/blob/devel/charts/ceph-csi-cephfs/README.md>https://github.com/ceph/ceph-csi/blob/devel/charts/ceph-csi-cephfs/README.md</a></p> </blockquote> </div> <p>查看CSI驱动Pod的状态： <div class=highlight><pre><span></span><code><a id=__codelineno-31-1 name=__codelineno-31-1 href=#__codelineno-31-1></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>pod<span class=w> </span>-n<span class=w> </span>ceph-csi-cephfs
</code></pre></div></p> <p>2．Ceph配置</p> <p>之后需要在Ceph中创建一个Pool为Kubernetes集群提供存储，当然也可以使用已经存在的Pool。 </p> <p>首先查看当前Ceph集群有无Filesystem类型的Pool，如果有则无须再创建，可以直接使用：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-32-1 name=__codelineno-32-1 href=#__codelineno-32-1></a>$<span class=w> </span>ceph<span class=w> </span>fs<span class=w> </span>ls
<a id=__codelineno-32-2 name=__codelineno-32-2 href=#__codelineno-32-2></a>name:<span class=w> </span>sharefs,<span class=w> </span>metadata<span class=w> </span>pool:<span class=w> </span>sharefs-metadata,<span class=w> </span>data<span class=w> </span>pools:<span class=w> </span><span class=o>[</span>sharefs-data0<span class=w> </span><span class=o>]</span>
</code></pre></div> <p>如果没有的话，可以创建一个文件系统类型的Pool（大小根据实际情况进行配置）： <div class=highlight><pre><span></span><code><a id=__codelineno-33-1 name=__codelineno-33-1 href=#__codelineno-33-1></a>$<span class=w> </span>ceph<span class=w> </span>osd<span class=w> </span>pool<span class=w> </span>create<span class=w> </span>sharefs-data0<span class=w> </span><span class=m>128</span><span class=w> </span><span class=m>128</span>
<a id=__codelineno-33-2 name=__codelineno-33-2 href=#__codelineno-33-2></a>$<span class=w> </span>ceph<span class=w> </span>osd<span class=w> </span>pool<span class=w> </span>create<span class=w> </span>sharefs-metadata<span class=w> </span><span class=m>64</span><span class=w> </span><span class=m>64</span>
<a id=__codelineno-33-3 name=__codelineno-33-3 href=#__codelineno-33-3></a>$<span class=w> </span>ceph<span class=w> </span>fs<span class=w> </span>new<span class=w> </span>sharefs<span class=w> </span>sharefs-metadata<span class=w> </span>sharefs-data0
<a id=__codelineno-33-4 name=__codelineno-33-4 href=#__codelineno-33-4></a>$<span class=w> </span>ceph<span class=w> </span>fs<span class=w> </span>ls
<a id=__codelineno-33-5 name=__codelineno-33-5 href=#__codelineno-33-5></a>name:<span class=w> </span>sharefs,<span class=w> </span>metadata<span class=w> </span>pool:<span class=w> </span>sharefs-metadata,<span class=w> </span>data<span class=w> </span>pools:<span class=w> </span><span class=o>[</span>sharefs-data0<span class=w> </span><span class=o>]</span>
</code></pre></div></p> <p>Kubernetes使用Ceph作为后端存储，会对Ceph集群的卷进行相关操作， 比如创建、删除、更改等，所以Kubernetes需要有相关的权限， 此时可以把 Ceph的认证信息保存在Secret中，之后配置StorageClass使用该Secret即可。</p> <p>查看client.admin的Key： <div class=highlight><pre><span></span><code><a id=__codelineno-34-1 name=__codelineno-34-1 href=#__codelineno-34-1></a>$<span class=w> </span>ceph<span class=w> </span>auth<span class=w> </span>get-key<span class=w> </span>client.admin
<a id=__codelineno-34-2 name=__codelineno-34-2 href=#__codelineno-34-2></a>AQA8HP9ezBHPDBAAdL+NteK0d1mjXZV47r4I7w<span class=o>==</span>
</code></pre></div></p> <p>创建Secret： <div class=highlight><pre><span></span><code><a id=__codelineno-35-1 name=__codelineno-35-1 href=#__codelineno-35-1></a>$<span class=w> </span>kubectl<span class=w> </span>create<span class=w> </span>secret<span class=w> </span>generic<span class=w> </span>csi-cephfs-secret<span class=w> </span><span class=se>\</span>
<a id=__codelineno-35-2 name=__codelineno-35-2 href=#__codelineno-35-2></a>--type<span class=o>=</span><span class=s2>&quot;kubernetes.io/cephfs&quot;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-35-3 name=__codelineno-35-3 href=#__codelineno-35-3></a>--from-literal<span class=o>=</span><span class=nv>adminKey</span><span class=o>=</span><span class=s1>&#39;AQA8HP9ezBHPDBAAdL+NteK0d1mjXZV47r4I7w==&#39;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-35-4 name=__codelineno-35-4 href=#__codelineno-35-4></a>--from-literal-adminID<span class=o>=</span><span class=s1>&#39;admin&#39;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-35-5 name=__codelineno-35-5 href=#__codelineno-35-5></a>--namespace<span class=o>=</span>ceph-csi-cephfs
</code></pre></div> 查看并记录集群的fsid： <div class=highlight><pre><span></span><code><a id=__codelineno-36-1 name=__codelineno-36-1 href=#__codelineno-36-1></a>$<span class=w> </span>ceph<span class=w> </span>fsid
<a id=__codelineno-36-2 name=__codelineno-36-2 href=#__codelineno-36-2></a>48ddd55b-28ce-43f3-92a8-d17d9ad2c0de
</code></pre></div></p> <p>查看Ceph的Monitors节点信息：</p> <p><div class=highlight><pre><span></span><code><a id=__codelineno-37-1 name=__codelineno-37-1 href=#__codelineno-37-1></a>$<span class=w> </span>ceph<span class=w> </span>mon<span class=w> </span>dump
</code></pre></div> 结果中的Monitor的IP+6789端口即为Ceph Monitor的地址，之后需要在StorageClass使用。</p> <p>3．创建文件共享型StorageClass</p> <p>创建连接Ceph的信息，其中clusterID是上述查询的fsid，monitors是上述查询的Monitor地址，subvolumeGroup相当于子目录：</p> <p>ceph-configmap.yaml</p> <div class=highlight><pre><span></span><code><a id=__codelineno-38-1 name=__codelineno-38-1 href=#__codelineno-38-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id=__codelineno-38-2 name=__codelineno-38-2 href=#__codelineno-38-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<a id=__codelineno-38-3 name=__codelineno-38-3 href=#__codelineno-38-3></a><span class=nt>data</span><span class=p>:</span>
<a id=__codelineno-38-4 name=__codelineno-38-4 href=#__codelineno-38-4></a><span class=w>  </span><span class=nt>config.json</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|-</span>
<a id=__codelineno-38-5 name=__codelineno-38-5 href=#__codelineno-38-5></a><span class=w>    </span><span class=no>[</span>
<a id=__codelineno-38-6 name=__codelineno-38-6 href=#__codelineno-38-6></a><span class=w>      </span><span class=no>{</span>
<a id=__codelineno-38-7 name=__codelineno-38-7 href=#__codelineno-38-7></a><span class=w>        </span><span class=no>&quot;clusterID&quot;: &quot;48ddd55b-28ce-43f3-92a8-d17d9ad2c0de&quot;,</span>
<a id=__codelineno-38-8 name=__codelineno-38-8 href=#__codelineno-38-8></a><span class=w>        </span><span class=no>&quot;monitors&quot;: [</span>
<a id=__codelineno-38-9 name=__codelineno-38-9 href=#__codelineno-38-9></a><span class=w>          </span><span class=no>&quot;xxx:6789&quot;,</span>
<a id=__codelineno-38-10 name=__codelineno-38-10 href=#__codelineno-38-10></a><span class=w>          </span><span class=no>&quot;xxx:6789&quot;,</span>
<a id=__codelineno-38-11 name=__codelineno-38-11 href=#__codelineno-38-11></a><span class=w>          </span><span class=no>&quot;xxx:6789&quot;</span>
<a id=__codelineno-38-12 name=__codelineno-38-12 href=#__codelineno-38-12></a><span class=w>        </span><span class=no>],</span>
<a id=__codelineno-38-13 name=__codelineno-38-13 href=#__codelineno-38-13></a><span class=w>        </span><span class=no>&quot;cephFS&quot;: {</span>
<a id=__codelineno-38-14 name=__codelineno-38-14 href=#__codelineno-38-14></a><span class=w>          </span><span class=no>&quot;subvolumeGroup&quot;: &quot;cephfs-k8s-csi&quot;</span>
<a id=__codelineno-38-15 name=__codelineno-38-15 href=#__codelineno-38-15></a><span class=w>        </span><span class=no>}</span>
<a id=__codelineno-38-16 name=__codelineno-38-16 href=#__codelineno-38-16></a><span class=w>      </span><span class=no>}</span>
<a id=__codelineno-38-17 name=__codelineno-38-17 href=#__codelineno-38-17></a><span class=w>    </span><span class=no>]</span>
<a id=__codelineno-38-18 name=__codelineno-38-18 href=#__codelineno-38-18></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-38-19 name=__codelineno-38-19 href=#__codelineno-38-19></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ceph-csi-config</span>
</code></pre></div> <div class=highlight><pre><span></span><code><a id=__codelineno-39-1 name=__codelineno-39-1 href=#__codelineno-39-1></a>$<span class=w> </span>kubectl<span class=w> </span>create<span class=w> </span>-f<span class=w> </span>ceph-configmap.yaml<span class=w> </span>-n<span class=w> </span>ceph-csi-cephfs
</code></pre></div> <p>创建StorageClass：</p> <p>cephfs-csi-sc.yaml</p> <div class=highlight><pre><span></span><code><a id=__codelineno-40-1 name=__codelineno-40-1 href=#__codelineno-40-1></a><span class=nn>---</span>
<a id=__codelineno-40-2 name=__codelineno-40-2 href=#__codelineno-40-2></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">storage.k8s.io/v1</span>
<a id=__codelineno-40-3 name=__codelineno-40-3 href=#__codelineno-40-3></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">StorageClass</span>
<a id=__codelineno-40-4 name=__codelineno-40-4 href=#__codelineno-40-4></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-40-5 name=__codelineno-40-5 href=#__codelineno-40-5></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">csi-cephfs-sc</span>
<a id=__codelineno-40-6 name=__codelineno-40-6 href=#__codelineno-40-6></a><span class=nt>provisioner</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">cephfs.csi.ceph.com</span>
<a id=__codelineno-40-7 name=__codelineno-40-7 href=#__codelineno-40-7></a><span class=nt>parameters</span><span class=p>:</span>
<a id=__codelineno-40-8 name=__codelineno-40-8 href=#__codelineno-40-8></a><span class=w>  </span><span class=nt>clusterID</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">48ddd55b-28ce-43f3-92a8-d17d9ad2c0de</span><span class=w> </span>
<a id=__codelineno-40-9 name=__codelineno-40-9 href=#__codelineno-40-9></a>
<a id=__codelineno-40-10 name=__codelineno-40-10 href=#__codelineno-40-10></a><span class=w>  </span><span class=nt>fsName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">sharefs</span>
<a id=__codelineno-40-11 name=__codelineno-40-11 href=#__codelineno-40-11></a>
<a id=__codelineno-40-12 name=__codelineno-40-12 href=#__codelineno-40-12></a><span class=w>  </span><span class=nt>pool</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">sharefs-data0</span>
<a id=__codelineno-40-13 name=__codelineno-40-13 href=#__codelineno-40-13></a>
<a id=__codelineno-40-14 name=__codelineno-40-14 href=#__codelineno-40-14></a><span class=w>  </span><span class=c1># The secrets have to contain user and/or Ceph admin credentials.</span>
<a id=__codelineno-40-15 name=__codelineno-40-15 href=#__codelineno-40-15></a><span class=w>  </span><span class=nt>csi.storage.k8s.io/provisioner-secret-name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">csi-cephfs-secret</span>
<a id=__codelineno-40-16 name=__codelineno-40-16 href=#__codelineno-40-16></a><span class=w>  </span><span class=nt>csi.storage.k8s.io/provisioner-secret-namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ceph-csi-cephfs</span>
<a id=__codelineno-40-17 name=__codelineno-40-17 href=#__codelineno-40-17></a><span class=w>  </span><span class=nt>csi.storage.k8s.io/controller-expand-secret-name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">csi-cephfs-secret</span>
<a id=__codelineno-40-18 name=__codelineno-40-18 href=#__codelineno-40-18></a><span class=w>  </span><span class=nt>csi.storage.k8s.io/controller-expand-secret-namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ceph-csi-cephfs</span>
<a id=__codelineno-40-19 name=__codelineno-40-19 href=#__codelineno-40-19></a><span class=w>  </span><span class=nt>csi.storage.k8s.io/node-stage-secret-name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">csi-cephfs-secret</span>
<a id=__codelineno-40-20 name=__codelineno-40-20 href=#__codelineno-40-20></a><span class=w>  </span><span class=nt>csi.storage.k8s.io/node-stage-secret-namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ceph-csi-cephfs</span>
<a id=__codelineno-40-21 name=__codelineno-40-21 href=#__codelineno-40-21></a>
<a id=__codelineno-40-22 name=__codelineno-40-22 href=#__codelineno-40-22></a><span class=w>  </span><span class=c1># (optional) The driver can use either ceph-fuse (fuse) or</span>
<a id=__codelineno-40-23 name=__codelineno-40-23 href=#__codelineno-40-23></a><span class=w>  </span><span class=c1># ceph kernelclient (kernel).</span>
<a id=__codelineno-40-24 name=__codelineno-40-24 href=#__codelineno-40-24></a><span class=w>  </span><span class=c1># If omitted, default volume mounter will be used - this is</span>
<a id=__codelineno-40-25 name=__codelineno-40-25 href=#__codelineno-40-25></a><span class=w>  </span><span class=c1># determined by probing for ceph-fuse and mount.ceph</span>
<a id=__codelineno-40-26 name=__codelineno-40-26 href=#__codelineno-40-26></a><span class=w>  </span><span class=c1># mounter: kernel</span>
<a id=__codelineno-40-27 name=__codelineno-40-27 href=#__codelineno-40-27></a>
<a id=__codelineno-40-28 name=__codelineno-40-28 href=#__codelineno-40-28></a><span class=w>  </span><span class=c1># (optional) Prefix to use for naming subvolumes.</span>
<a id=__codelineno-40-29 name=__codelineno-40-29 href=#__codelineno-40-29></a><span class=w>  </span><span class=c1># If omitted, defaults to &quot;csi-vol-&quot;.</span>
<a id=__codelineno-40-30 name=__codelineno-40-30 href=#__codelineno-40-30></a><span class=w>  </span><span class=c1># volumeNamePrefix: &quot;foo-bar-&quot;</span>
<a id=__codelineno-40-31 name=__codelineno-40-31 href=#__codelineno-40-31></a>
<a id=__codelineno-40-32 name=__codelineno-40-32 href=#__codelineno-40-32></a><span class=nt>reclaimPolicy</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Delete</span>
<a id=__codelineno-40-33 name=__codelineno-40-33 href=#__codelineno-40-33></a><span class=nt>allowVolumeExpansion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id=__codelineno-40-34 name=__codelineno-40-34 href=#__codelineno-40-34></a><span class=nt>mountOptions</span><span class=p>:</span>
<a id=__codelineno-40-35 name=__codelineno-40-35 href=#__codelineno-40-35></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">debug</span>
</code></pre></div> <ul> <li>clusterID：Ceph集群的fsid。</li> <li>fsName：Ceph文件系统的名字。</li> <li>pool：Data Pool的名字。</li> </ul> <p>csi.storage.k8s.io/provisioner-secret-name：连接信息的Secret，其他的类似。</p> <ul> <li>reclaimPolicy：回收策略，默认是删除。</li> <li>allowVolumeExpansion：允许扩容，需要后端存储支持。</li> </ul> <p>创建StorageClass： <div class=highlight><pre><span></span><code><a id=__codelineno-41-1 name=__codelineno-41-1 href=#__codelineno-41-1></a>$<span class=w> </span>kubectl<span class=w> </span>create<span class=w> </span>-f<span class=w> </span>cephfs-csi-sc.yaml
<a id=__codelineno-41-2 name=__codelineno-41-2 href=#__codelineno-41-2></a>storageclass.storage.k8s.io/csi-cephfs-sc<span class=w> </span>created
</code></pre></div></p> <p>查看StorageClass： <div class=highlight><pre><span></span><code><a id=__codelineno-42-1 name=__codelineno-42-1 href=#__codelineno-42-1></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>sc<span class=w> </span>csi-cephfs-sc
</code></pre></div></p> <p>4．Ceph CSI验证 创建一个PVC指向该StorageClass（storageClassName参数），查看一下是否能正常创建PV：</p> <p><strong>vim pvc.yaml</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-43-1 name=__codelineno-43-1 href=#__codelineno-43-1></a><span class=nn>---</span>
<a id=__codelineno-43-2 name=__codelineno-43-2 href=#__codelineno-43-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
<a id=__codelineno-43-3 name=__codelineno-43-3 href=#__codelineno-43-3></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id=__codelineno-43-4 name=__codelineno-43-4 href=#__codelineno-43-4></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-43-5 name=__codelineno-43-5 href=#__codelineno-43-5></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">cephfs-pvc-test-csi</span>
<a id=__codelineno-43-6 name=__codelineno-43-6 href=#__codelineno-43-6></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-43-7 name=__codelineno-43-7 href=#__codelineno-43-7></a><span class=w>  </span><span class=nt>accessModes</span><span class=p>:</span>
<a id=__codelineno-43-8 name=__codelineno-43-8 href=#__codelineno-43-8></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteMany</span>
<a id=__codelineno-43-9 name=__codelineno-43-9 href=#__codelineno-43-9></a><span class=w>  </span><span class=nt>storageClassName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">csi-cephfs-sc</span>
<a id=__codelineno-43-10 name=__codelineno-43-10 href=#__codelineno-43-10></a><span class=w>  </span><span class=nt>resources</span><span class=p>:</span>
<a id=__codelineno-43-11 name=__codelineno-43-11 href=#__codelineno-43-11></a><span class=w>    </span><span class=nt>requests</span><span class=p>:</span>
<a id=__codelineno-43-12 name=__codelineno-43-12 href=#__codelineno-43-12></a><span class=w>      </span><span class=nt>storage</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">100Mi</span>
</code></pre></div> <p>test-pvc-dp.yaml</p> <div class=highlight><pre><span></span><code><a id=__codelineno-44-1 name=__codelineno-44-1 href=#__codelineno-44-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<a id=__codelineno-44-2 name=__codelineno-44-2 href=#__codelineno-44-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<a id=__codelineno-44-3 name=__codelineno-44-3 href=#__codelineno-44-3></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-44-4 name=__codelineno-44-4 href=#__codelineno-44-4></a><span class=w>  </span><span class=nt>labels</span><span class=p>:</span>
<a id=__codelineno-44-5 name=__codelineno-44-5 href=#__codelineno-44-5></a><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">test-cephfs</span>
<a id=__codelineno-44-6 name=__codelineno-44-6 href=#__codelineno-44-6></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">test-cephfs</span>
<a id=__codelineno-44-7 name=__codelineno-44-7 href=#__codelineno-44-7></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<a id=__codelineno-44-8 name=__codelineno-44-8 href=#__codelineno-44-8></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-44-9 name=__codelineno-44-9 href=#__codelineno-44-9></a><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<a id=__codelineno-44-10 name=__codelineno-44-10 href=#__codelineno-44-10></a><span class=w>  </span><span class=nt>selector</span><span class=p>:</span>
<a id=__codelineno-44-11 name=__codelineno-44-11 href=#__codelineno-44-11></a><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span>
<a id=__codelineno-44-12 name=__codelineno-44-12 href=#__codelineno-44-12></a><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">test-cephfs</span>
<a id=__codelineno-44-13 name=__codelineno-44-13 href=#__codelineno-44-13></a><span class=w>  </span><span class=nt>strategy</span><span class=p>:</span>
<a id=__codelineno-44-14 name=__codelineno-44-14 href=#__codelineno-44-14></a><span class=w>    </span><span class=nt>rollingUpdate</span><span class=p>:</span>
<a id=__codelineno-44-15 name=__codelineno-44-15 href=#__codelineno-44-15></a><span class=w>      </span><span class=nt>maxSurge</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<a id=__codelineno-44-16 name=__codelineno-44-16 href=#__codelineno-44-16></a><span class=w>      </span><span class=nt>maxUnavailable</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<a id=__codelineno-44-17 name=__codelineno-44-17 href=#__codelineno-44-17></a><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">RollingUpdate</span>
<a id=__codelineno-44-18 name=__codelineno-44-18 href=#__codelineno-44-18></a><span class=w>  </span><span class=nt>template</span><span class=p>:</span>
<a id=__codelineno-44-19 name=__codelineno-44-19 href=#__codelineno-44-19></a><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-44-20 name=__codelineno-44-20 href=#__codelineno-44-20></a><span class=w>      </span><span class=nt>labels</span><span class=p>:</span>
<a id=__codelineno-44-21 name=__codelineno-44-21 href=#__codelineno-44-21></a><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">test-cephfs</span>
<a id=__codelineno-44-22 name=__codelineno-44-22 href=#__codelineno-44-22></a><span class=w>    </span><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-44-23 name=__codelineno-44-23 href=#__codelineno-44-23></a><span class=w>      </span><span class=nt>containers</span><span class=p>:</span>
<a id=__codelineno-44-24 name=__codelineno-44-24 href=#__codelineno-44-24></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>command</span><span class=p>:</span>
<a id=__codelineno-44-25 name=__codelineno-44-25 href=#__codelineno-44-25></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">sh</span>
<a id=__codelineno-44-26 name=__codelineno-44-26 href=#__codelineno-44-26></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">-c</span>
<a id=__codelineno-44-27 name=__codelineno-44-27 href=#__codelineno-44-27></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">sleep 36000</span>
<a id=__codelineno-44-28 name=__codelineno-44-28 href=#__codelineno-44-28></a><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">registry.cn-beijing.aliyuncs.com/dotbalo/debug-tools</span>
<a id=__codelineno-44-29 name=__codelineno-44-29 href=#__codelineno-44-29></a><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">test-cephfs</span>
<a id=__codelineno-44-30 name=__codelineno-44-30 href=#__codelineno-44-30></a><span class=w>        </span><span class=nt>volumeMounts</span><span class=p>:</span>
<a id=__codelineno-44-31 name=__codelineno-44-31 href=#__codelineno-44-31></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/mnt</span>
<a id=__codelineno-44-32 name=__codelineno-44-32 href=#__codelineno-44-32></a><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">cephfs-pvc-test</span>
<a id=__codelineno-44-33 name=__codelineno-44-33 href=#__codelineno-44-33></a><span class=w>      </span><span class=nt>volumes</span><span class=p>:</span>
<a id=__codelineno-44-34 name=__codelineno-44-34 href=#__codelineno-44-34></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">cephfs-pvc-test</span>
<a id=__codelineno-44-35 name=__codelineno-44-35 href=#__codelineno-44-35></a><span class=w>        </span><span class=nt>persistentVolumeClaim</span><span class=p>:</span>
<a id=__codelineno-44-36 name=__codelineno-44-36 href=#__codelineno-44-36></a><span class=w>          </span><span class=nt>claimName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">cephfs-pvc-test-csi</span>
</code></pre></div> <p><div class=highlight><pre><span></span><code><a id=__codelineno-45-1 name=__codelineno-45-1 href=#__codelineno-45-1></a>$<span class=w> </span>kubectl<span class=w> </span>create<span class=w> </span>-f<span class=w> </span>pvc.yaml
<a id=__codelineno-45-2 name=__codelineno-45-2 href=#__codelineno-45-2></a>
<a id=__codelineno-45-3 name=__codelineno-45-3 href=#__codelineno-45-3></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>pvc
</code></pre></div> 可以看到已经成功创建了一个名为pvc-9cad122e-632e-408e-bce1-69186ae71cb6的PV， 状态也变成了Bound，之后可以创建一个Pod进行数据读写测试，将PV挂载到/mnt目录，可以按需修改：</p> <p>test-pvc-dp.yaml</p> <p><div class=highlight><pre><span></span><code><a id=__codelineno-46-1 name=__codelineno-46-1 href=#__codelineno-46-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<a id=__codelineno-46-2 name=__codelineno-46-2 href=#__codelineno-46-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<a id=__codelineno-46-3 name=__codelineno-46-3 href=#__codelineno-46-3></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-46-4 name=__codelineno-46-4 href=#__codelineno-46-4></a><span class=w>  </span><span class=nt>labels</span><span class=p>:</span>
<a id=__codelineno-46-5 name=__codelineno-46-5 href=#__codelineno-46-5></a><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">test-rbd</span>
<a id=__codelineno-46-6 name=__codelineno-46-6 href=#__codelineno-46-6></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">test-rbd</span>
<a id=__codelineno-46-7 name=__codelineno-46-7 href=#__codelineno-46-7></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<a id=__codelineno-46-8 name=__codelineno-46-8 href=#__codelineno-46-8></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-46-9 name=__codelineno-46-9 href=#__codelineno-46-9></a><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<a id=__codelineno-46-10 name=__codelineno-46-10 href=#__codelineno-46-10></a><span class=w>  </span><span class=nt>selector</span><span class=p>:</span>
<a id=__codelineno-46-11 name=__codelineno-46-11 href=#__codelineno-46-11></a><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span>
<a id=__codelineno-46-12 name=__codelineno-46-12 href=#__codelineno-46-12></a><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">test-rbd</span>
<a id=__codelineno-46-13 name=__codelineno-46-13 href=#__codelineno-46-13></a><span class=w>  </span><span class=nt>strategy</span><span class=p>:</span>
<a id=__codelineno-46-14 name=__codelineno-46-14 href=#__codelineno-46-14></a><span class=w>    </span><span class=nt>rollingUpdate</span><span class=p>:</span>
<a id=__codelineno-46-15 name=__codelineno-46-15 href=#__codelineno-46-15></a><span class=w>      </span><span class=nt>maxSurge</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<a id=__codelineno-46-16 name=__codelineno-46-16 href=#__codelineno-46-16></a><span class=w>      </span><span class=nt>maxUnavailable</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<a id=__codelineno-46-17 name=__codelineno-46-17 href=#__codelineno-46-17></a><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">RollingUpdate</span>
<a id=__codelineno-46-18 name=__codelineno-46-18 href=#__codelineno-46-18></a><span class=w>  </span><span class=nt>template</span><span class=p>:</span>
<a id=__codelineno-46-19 name=__codelineno-46-19 href=#__codelineno-46-19></a><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-46-20 name=__codelineno-46-20 href=#__codelineno-46-20></a><span class=w>      </span><span class=nt>labels</span><span class=p>:</span>
<a id=__codelineno-46-21 name=__codelineno-46-21 href=#__codelineno-46-21></a><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">test-rbd</span>
<a id=__codelineno-46-22 name=__codelineno-46-22 href=#__codelineno-46-22></a><span class=w>    </span><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-46-23 name=__codelineno-46-23 href=#__codelineno-46-23></a><span class=w>      </span><span class=nt>containers</span><span class=p>:</span>
<a id=__codelineno-46-24 name=__codelineno-46-24 href=#__codelineno-46-24></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>command</span><span class=p>:</span>
<a id=__codelineno-46-25 name=__codelineno-46-25 href=#__codelineno-46-25></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">sh</span>
<a id=__codelineno-46-26 name=__codelineno-46-26 href=#__codelineno-46-26></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">-c</span>
<a id=__codelineno-46-27 name=__codelineno-46-27 href=#__codelineno-46-27></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">sleep 36000</span>
<a id=__codelineno-46-28 name=__codelineno-46-28 href=#__codelineno-46-28></a><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">registry.cn-beijing.aliyuncs.com/dotbalo/debug-tools</span>
<a id=__codelineno-46-29 name=__codelineno-46-29 href=#__codelineno-46-29></a><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">test-rbd</span>
<a id=__codelineno-46-30 name=__codelineno-46-30 href=#__codelineno-46-30></a><span class=w>        </span><span class=nt>volumeMounts</span><span class=p>:</span>
<a id=__codelineno-46-31 name=__codelineno-46-31 href=#__codelineno-46-31></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/mnt</span>
<a id=__codelineno-46-32 name=__codelineno-46-32 href=#__codelineno-46-32></a><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rbd-pvc-test</span>
<a id=__codelineno-46-33 name=__codelineno-46-33 href=#__codelineno-46-33></a><span class=w>      </span><span class=nt>volumes</span><span class=p>:</span>
<a id=__codelineno-46-34 name=__codelineno-46-34 href=#__codelineno-46-34></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rbd-pvc-test</span>
<a id=__codelineno-46-35 name=__codelineno-46-35 href=#__codelineno-46-35></a><span class=w>        </span><span class=nt>persistentVolumeClaim</span><span class=p>:</span>
<a id=__codelineno-46-36 name=__codelineno-46-36 href=#__codelineno-46-36></a><span class=w>          </span><span class=nt>claimName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rbd-pvc-test-csi</span>
</code></pre></div> 创建该Deployment： <div class=highlight><pre><span></span><code><a id=__codelineno-47-1 name=__codelineno-47-1 href=#__codelineno-47-1></a>$<span class=w> </span>kubectl<span class=w> </span>apply<span class=w> </span>-f<span class=w> </span>test-pvc-dp.yaml
<a id=__codelineno-47-2 name=__codelineno-47-2 href=#__codelineno-47-2></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>pod<span class=w> </span>-l<span class=w> </span><span class=nv>app</span><span class=o>=</span>test-cephfs
</code></pre></div> 在其中的副本进行数据写入： <div class=highlight><pre><span></span><code><a id=__codelineno-48-1 name=__codelineno-48-1 href=#__codelineno-48-1></a>$<span class=w> </span>kubectl<span class=w> </span><span class=nb>exec</span><span class=w> </span>test-cephfs-811238bfb7-splxx<span class=w> </span>--<span class=w> </span>bash
<a id=__codelineno-48-2 name=__codelineno-48-2 href=#__codelineno-48-2></a><span class=c1># echo &quot;hello, csi&quot; &gt; /mnt/test.txt </span>
<a id=__codelineno-48-3 name=__codelineno-48-3 href=#__codelineno-48-3></a><span class=c1># exit</span>
</code></pre></div></p> <p>在另一个副本中查看数据： <div class=highlight><pre><span></span><code><a id=__codelineno-49-1 name=__codelineno-49-1 href=#__codelineno-49-1></a>$<span class=w> </span>kubectl<span class=w> </span><span class=nb>exec</span><span class=w> </span>test-cephfs-85f8f8bfb7-splxg<span class=w> </span>--<span class=w> </span>cat<span class=w> </span>/mnt/test.txt
<a id=__codelineno-49-2 name=__codelineno-49-2 href=#__codelineno-49-2></a>hello,<span class=w> </span>csi
</code></pre></div></p> <h3 id=92-通过csi连接ceph-rbd>9.2 通过CSI连接Ceph RBD<a class=headerlink href=#92-通过csi连接ceph-rbd title="Permanent link">&para;</a></h3> <p>和CephFS CSI类似，安装Ceph RBD CSI的步骤几乎一样，只是对应的安装文件不一样 ， </p> <blockquote> <p>RBD CSI的文档可以通过https://github.com/ceph/ceph-csi/blob/devel/docs/deploy-rbd.md查看， 通过Helm安装文档地址 ： <a href=https://github.com/ceph/ceph-csi/blob/devel/charts/ceph-csi-rbd/README.md>https://github.com/ceph/ceph-csi/blob/devel/charts/ceph-csi-rbd/README.md</a>。</p> </blockquote> <p>1．Ceph RBD驱动安装</p> <p>同样，该Helm包默认的镜像地址也是gcr.io，笔者已经为读者同步了相关镜像，放在了本小节的install目录，可以直接进行安装（Helm安装可以参 考8.9.1节）：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-50-1 name=__codelineno-50-1 href=#__codelineno-50-1></a>$<span class=w> </span>kubectl<span class=w> </span>create<span class=w> </span>namespace<span class=w> </span><span class=s2>&quot;ceph-csi-rbd&quot;</span>
<a id=__codelineno-50-2 name=__codelineno-50-2 href=#__codelineno-50-2></a>namespace/ceph-csi-rbd<span class=w> </span>created
<a id=__codelineno-50-3 name=__codelineno-50-3 href=#__codelineno-50-3></a>
<a id=__codelineno-50-4 name=__codelineno-50-4 href=#__codelineno-50-4></a><span class=c1># 注意命令最后的一个点</span>
<a id=__codelineno-50-5 name=__codelineno-50-5 href=#__codelineno-50-5></a>$<span class=w> </span>helm<span class=w> </span>install<span class=w> </span>--namespace<span class=w> </span><span class=s2>&quot;ceph-csi-rbd&quot;</span><span class=w> </span><span class=s2>&quot;ceph-csi-rbd&quot;</span><span class=w> </span>.
<a id=__codelineno-50-6 name=__codelineno-50-6 href=#__codelineno-50-6></a>NAME:<span class=w> </span>ceph-csi-rbd
<a id=__codelineno-50-7 name=__codelineno-50-7 href=#__codelineno-50-7></a>...
<a id=__codelineno-50-8 name=__codelineno-50-8 href=#__codelineno-50-8></a>NOTES:
<a id=__codelineno-50-9 name=__codelineno-50-9 href=#__codelineno-50-9></a>Examples<span class=w> </span>on<span class=w> </span>how<span class=w> </span>to<span class=w> </span>configure<span class=w> </span>a<span class=w> </span>storage<span class=w> </span>class<span class=w> </span>and<span class=w> </span>start<span class=w> </span>using<span class=w> </span>thedriver<span class=w> </span>are<span class=w> </span>here:
<a id=__codelineno-50-10 name=__codelineno-50-10 href=#__codelineno-50-10></a>https://github.com/ceph/ceph-csi/tree/v3.3.1/examples/rbd
</code></pre></div> <p>查看Pod状态 <div class=highlight><pre><span></span><code><a id=__codelineno-51-1 name=__codelineno-51-1 href=#__codelineno-51-1></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>po<span class=w> </span>-n<span class=w> </span>ceph-csi-rbd
</code></pre></div></p> <p>2．Ceph配置</p> <p>创建Ceph Pool，如果有Pool的话可以不用创建（大小根据实际情况进行配置）：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-52-1 name=__codelineno-52-1 href=#__codelineno-52-1></a>$<span class=w> </span>ceph<span class=w> </span>osd<span class=w> </span>pool<span class=w> </span>create<span class=w> </span>rbdfork8s<span class=w> </span><span class=m>128</span>
<a id=__codelineno-52-2 name=__codelineno-52-2 href=#__codelineno-52-2></a>pool<span class=w> </span><span class=s1>&#39;rbdfork8s&#39;</span><span class=w> </span>created
</code></pre></div> <p>相对于管理员用户，RBD可以单独授权一个低权限的用户管理Pool，比如 创建一个kube用户，对osd有查看权限，对rbdfork8s有读写权限（具体权限 配置可以参考Ceph文档）：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-53-1 name=__codelineno-53-1 href=#__codelineno-53-1></a>$<span class=w> </span>ceph<span class=w> </span>auth<span class=w> </span>add<span class=w> </span>client.kube<span class=w> </span>mon<span class=w> </span><span class=s1>&#39;allow r&#39;</span><span class=w> </span>osd<span class=w> </span><span class=s1>&#39;allow rwx pool=rbdfork8s&#39;</span>
<a id=__codelineno-53-2 name=__codelineno-53-2 href=#__codelineno-53-2></a>added<span class=w> </span>key<span class=w> </span><span class=k>for</span><span class=w> </span>client.kube
</code></pre></div> <p>初始化Pool，注意如果不是新建的就不用初始化： <div class=highlight><pre><span></span><code><a id=__codelineno-54-1 name=__codelineno-54-1 href=#__codelineno-54-1></a>$<span class=w> </span>ceph<span class=w> </span>osd<span class=w> </span>pool<span class=w> </span>application<span class=w> </span><span class=nb>enable</span><span class=w> </span>rbdfork8s<span class=w> </span>rbd
<a id=__codelineno-54-2 name=__codelineno-54-2 href=#__codelineno-54-2></a>enabled<span class=w> </span>application<span class=w> </span><span class=s1>&#39;rbd&#39;</span><span class=w> </span>on<span class=w> </span>pool<span class=w> </span><span class=s1>&#39;rbdfork8s&#39;</span>
<a id=__codelineno-54-3 name=__codelineno-54-3 href=#__codelineno-54-3></a>
<a id=__codelineno-54-4 name=__codelineno-54-4 href=#__codelineno-54-4></a>$<span class=w> </span>rbd<span class=w> </span>pool<span class=w> </span>init<span class=w> </span>rbdfork8s
</code></pre></div></p> <p>查看client.kube的key： <div class=highlight><pre><span></span><code><a id=__codelineno-55-1 name=__codelineno-55-1 href=#__codelineno-55-1></a>$<span class=w> </span>ceph<span class=w> </span>auth<span class=w> </span>get-key<span class=w> </span>client.kube
<a id=__codelineno-55-2 name=__codelineno-55-2 href=#__codelineno-55-2></a>AQB/eopgaqSRJxAAYDs2gKTXSpcpY2m+yHJaJw<span class=o>==</span>
</code></pre></div></p> <p>创建Secret： <div class=highlight><pre><span></span><code><a id=__codelineno-56-1 name=__codelineno-56-1 href=#__codelineno-56-1></a>$<span class=w> </span>kubectl<span class=w> </span>create<span class=w> </span>secret<span class=w> </span>generic<span class=w> </span>csi-rbd-secret<span class=w> </span><span class=se>\</span>
<a id=__codelineno-56-2 name=__codelineno-56-2 href=#__codelineno-56-2></a>--type<span class=o>=</span><span class=s2>&quot;kubernetes.io/rbd&quot;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-56-3 name=__codelineno-56-3 href=#__codelineno-56-3></a>--from-literal<span class=o>=</span><span class=nv>userKey</span><span class=o>=</span><span class=s2>&quot;AQB/eopgaqSRJxAAYDs2gKTXSpcpY2m+yHJaJw==&quot;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-56-4 name=__codelineno-56-4 href=#__codelineno-56-4></a>--from-literal<span class=o>=</span><span class=nv>userID</span><span class=o>=</span><span class=s2>&quot;kube&quot;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-56-5 name=__codelineno-56-5 href=#__codelineno-56-5></a>--namespace<span class=o>=</span>ceph-csi-rbd
</code></pre></div></p> <p>查看并记录集群的fsid： <div class=highlight><pre><span></span><code><a id=__codelineno-57-1 name=__codelineno-57-1 href=#__codelineno-57-1></a>$<span class=w> </span>ceph<span class=w> </span>fsid
<a id=__codelineno-57-2 name=__codelineno-57-2 href=#__codelineno-57-2></a>48ddd55b-28ce-43f3-92a8-d17d9ad2c0de
</code></pre></div></p> <p>查看Ceph的Monitors节点信息： <div class=highlight><pre><span></span><code><a id=__codelineno-58-1 name=__codelineno-58-1 href=#__codelineno-58-1></a>$<span class=w> </span>ceph<span class=w> </span>mon<span class=w> </span>dump
</code></pre></div></p> <p>结果中的Monitor的IP+6789端口即为Ceph Monitor的地址，之后需要在StorageClass中使用。</p> <p>3．创建StorageClass</p> <p>创建StorageClass和CephFS的类似，具体细节可以参考CephFS CSI的StorageClass配置：</p> <p>ceph-configmap.yaml</p> <p><div class=highlight><pre><span></span><code><a id=__codelineno-59-1 name=__codelineno-59-1 href=#__codelineno-59-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id=__codelineno-59-2 name=__codelineno-59-2 href=#__codelineno-59-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<a id=__codelineno-59-3 name=__codelineno-59-3 href=#__codelineno-59-3></a><span class=nt>data</span><span class=p>:</span>
<a id=__codelineno-59-4 name=__codelineno-59-4 href=#__codelineno-59-4></a><span class=w>  </span><span class=nt>config.json</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|-</span>
<a id=__codelineno-59-5 name=__codelineno-59-5 href=#__codelineno-59-5></a><span class=w>    </span><span class=no>[</span>
<a id=__codelineno-59-6 name=__codelineno-59-6 href=#__codelineno-59-6></a><span class=w>      </span><span class=no>{</span>
<a id=__codelineno-59-7 name=__codelineno-59-7 href=#__codelineno-59-7></a><span class=w>        </span><span class=no>&quot;clusterID&quot;: &quot;48ddd55b-28ce-43f3-92a8-d17d9ad2c0de&quot;,</span>
<a id=__codelineno-59-8 name=__codelineno-59-8 href=#__codelineno-59-8></a><span class=w>        </span><span class=no>&quot;monitors&quot;: [</span>
<a id=__codelineno-59-9 name=__codelineno-59-9 href=#__codelineno-59-9></a><span class=w>          </span><span class=no>&quot;xxx:6789&quot;,</span>
<a id=__codelineno-59-10 name=__codelineno-59-10 href=#__codelineno-59-10></a><span class=w>          </span><span class=no>&quot;xxx:6789&quot;,</span>
<a id=__codelineno-59-11 name=__codelineno-59-11 href=#__codelineno-59-11></a><span class=w>          </span><span class=no>&quot;xxx:6789&quot;</span>
<a id=__codelineno-59-12 name=__codelineno-59-12 href=#__codelineno-59-12></a><span class=w>        </span><span class=no>],</span>
<a id=__codelineno-59-13 name=__codelineno-59-13 href=#__codelineno-59-13></a><span class=w>        </span><span class=no>&quot;cephFS&quot;: {</span>
<a id=__codelineno-59-14 name=__codelineno-59-14 href=#__codelineno-59-14></a><span class=w>          </span><span class=no>&quot;subvolumeGroup&quot;: &quot;cephrbd-k8s-csi&quot;</span>
<a id=__codelineno-59-15 name=__codelineno-59-15 href=#__codelineno-59-15></a><span class=w>        </span><span class=no>}</span>
<a id=__codelineno-59-16 name=__codelineno-59-16 href=#__codelineno-59-16></a><span class=w>      </span><span class=no>}</span>
<a id=__codelineno-59-17 name=__codelineno-59-17 href=#__codelineno-59-17></a><span class=w>    </span><span class=no>]</span>
<a id=__codelineno-59-18 name=__codelineno-59-18 href=#__codelineno-59-18></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-59-19 name=__codelineno-59-19 href=#__codelineno-59-19></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ceph-csi-config</span>
</code></pre></div> <div class=highlight><pre><span></span><code><a id=__codelineno-60-1 name=__codelineno-60-1 href=#__codelineno-60-1></a>$<span class=w> </span>kubectl<span class=w> </span>create<span class=w> </span>-f<span class=w> </span>ceph-configmap.yaml<span class=w> </span>-n<span class=w> </span>ceph-csi-rbd
</code></pre></div></p> <p>创建StorageClass：</p> <p>rbd-csi-sc.yaml</p> <div class=highlight><pre><span></span><code><a id=__codelineno-61-1 name=__codelineno-61-1 href=#__codelineno-61-1></a><span class=nn>---</span>
<a id=__codelineno-61-2 name=__codelineno-61-2 href=#__codelineno-61-2></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">storage.k8s.io/v1</span>
<a id=__codelineno-61-3 name=__codelineno-61-3 href=#__codelineno-61-3></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">StorageClass</span>
<a id=__codelineno-61-4 name=__codelineno-61-4 href=#__codelineno-61-4></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-61-5 name=__codelineno-61-5 href=#__codelineno-61-5></a><span class=w>   </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">csi-rbd-sc</span>
<a id=__codelineno-61-6 name=__codelineno-61-6 href=#__codelineno-61-6></a><span class=nt>provisioner</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rbd.csi.ceph.com</span>
<a id=__codelineno-61-7 name=__codelineno-61-7 href=#__codelineno-61-7></a><span class=nt>parameters</span><span class=p>:</span>
<a id=__codelineno-61-8 name=__codelineno-61-8 href=#__codelineno-61-8></a><span class=w>   </span><span class=nt>clusterID</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">48ddd55b-28ce-43f3-92a8-d17d9ad2c0de</span><span class=w> </span>
<a id=__codelineno-61-9 name=__codelineno-61-9 href=#__codelineno-61-9></a><span class=w>   </span><span class=nt>pool</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rbdfork8s</span>
<a id=__codelineno-61-10 name=__codelineno-61-10 href=#__codelineno-61-10></a><span class=w>   </span><span class=nt>imageFeatures</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">layering</span>
<a id=__codelineno-61-11 name=__codelineno-61-11 href=#__codelineno-61-11></a>
<a id=__codelineno-61-12 name=__codelineno-61-12 href=#__codelineno-61-12></a><span class=w>   </span><span class=nt>csi.storage.k8s.io/provisioner-secret-name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">csi-rbd-secret</span>
<a id=__codelineno-61-13 name=__codelineno-61-13 href=#__codelineno-61-13></a><span class=w>   </span><span class=nt>csi.storage.k8s.io/provisioner-secret-namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ceph-csi-rbd</span><span class=w> </span>
<a id=__codelineno-61-14 name=__codelineno-61-14 href=#__codelineno-61-14></a><span class=w>   </span><span class=nt>csi.storage.k8s.io/controller-expand-secret-name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">csi-rbd-secret</span>
<a id=__codelineno-61-15 name=__codelineno-61-15 href=#__codelineno-61-15></a><span class=w>   </span><span class=nt>csi.storage.k8s.io/controller-expand-secret-namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ceph-csi-rbd</span>
<a id=__codelineno-61-16 name=__codelineno-61-16 href=#__codelineno-61-16></a><span class=w>   </span><span class=nt>csi.storage.k8s.io/node-stage-secret-name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">csi-rbd-secret</span>
<a id=__codelineno-61-17 name=__codelineno-61-17 href=#__codelineno-61-17></a><span class=w>   </span><span class=nt>csi.storage.k8s.io/node-stage-secret-namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ceph-csi-rbd</span>
<a id=__codelineno-61-18 name=__codelineno-61-18 href=#__codelineno-61-18></a><span class=w>   </span><span class=nt>csi.storage.k8s.io/fstype</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ext4</span>
<a id=__codelineno-61-19 name=__codelineno-61-19 href=#__codelineno-61-19></a><span class=nt>reclaimPolicy</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Delete</span>
<a id=__codelineno-61-20 name=__codelineno-61-20 href=#__codelineno-61-20></a><span class=nt>allowVolumeExpansion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id=__codelineno-61-21 name=__codelineno-61-21 href=#__codelineno-61-21></a><span class=nt>mountOptions</span><span class=p>:</span>
<a id=__codelineno-61-22 name=__codelineno-61-22 href=#__codelineno-61-22></a><span class=w>   </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">discard</span>
</code></pre></div> <p>4．Ceph RBD验证</p> <p>创建PVC，查看是否能自动创建PV，创建的配置和之前并无太大区别，只是storageClassName换成了RBD的StorageClass名称：</p> <p>pvc.yaml <div class=highlight><pre><span></span><code><a id=__codelineno-62-1 name=__codelineno-62-1 href=#__codelineno-62-1></a><span class=nn>---</span>
<a id=__codelineno-62-2 name=__codelineno-62-2 href=#__codelineno-62-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
<a id=__codelineno-62-3 name=__codelineno-62-3 href=#__codelineno-62-3></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id=__codelineno-62-4 name=__codelineno-62-4 href=#__codelineno-62-4></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-62-5 name=__codelineno-62-5 href=#__codelineno-62-5></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rbd-pvc-test-csi</span>
<a id=__codelineno-62-6 name=__codelineno-62-6 href=#__codelineno-62-6></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-62-7 name=__codelineno-62-7 href=#__codelineno-62-7></a><span class=w>  </span><span class=nt>accessModes</span><span class=p>:</span>
<a id=__codelineno-62-8 name=__codelineno-62-8 href=#__codelineno-62-8></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
<a id=__codelineno-62-9 name=__codelineno-62-9 href=#__codelineno-62-9></a><span class=w>  </span><span class=nt>storageClassName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">csi-rbd-sc</span>
<a id=__codelineno-62-10 name=__codelineno-62-10 href=#__codelineno-62-10></a><span class=w>  </span><span class=nt>resources</span><span class=p>:</span>
<a id=__codelineno-62-11 name=__codelineno-62-11 href=#__codelineno-62-11></a><span class=w>    </span><span class=nt>requests</span><span class=p>:</span>
<a id=__codelineno-62-12 name=__codelineno-62-12 href=#__codelineno-62-12></a><span class=w>      </span><span class=nt>storage</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">100Mi</span>
</code></pre></div></p> <p>test-pvc-dp.yaml</p> <div class=highlight><pre><span></span><code><a id=__codelineno-63-1 name=__codelineno-63-1 href=#__codelineno-63-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<a id=__codelineno-63-2 name=__codelineno-63-2 href=#__codelineno-63-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<a id=__codelineno-63-3 name=__codelineno-63-3 href=#__codelineno-63-3></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-63-4 name=__codelineno-63-4 href=#__codelineno-63-4></a><span class=w>  </span><span class=nt>labels</span><span class=p>:</span>
<a id=__codelineno-63-5 name=__codelineno-63-5 href=#__codelineno-63-5></a><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">test-rbd</span>
<a id=__codelineno-63-6 name=__codelineno-63-6 href=#__codelineno-63-6></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">test-rbd</span>
<a id=__codelineno-63-7 name=__codelineno-63-7 href=#__codelineno-63-7></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<a id=__codelineno-63-8 name=__codelineno-63-8 href=#__codelineno-63-8></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-63-9 name=__codelineno-63-9 href=#__codelineno-63-9></a><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<a id=__codelineno-63-10 name=__codelineno-63-10 href=#__codelineno-63-10></a><span class=w>  </span><span class=nt>selector</span><span class=p>:</span>
<a id=__codelineno-63-11 name=__codelineno-63-11 href=#__codelineno-63-11></a><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span>
<a id=__codelineno-63-12 name=__codelineno-63-12 href=#__codelineno-63-12></a><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">test-rbd</span>
<a id=__codelineno-63-13 name=__codelineno-63-13 href=#__codelineno-63-13></a><span class=w>  </span><span class=nt>strategy</span><span class=p>:</span>
<a id=__codelineno-63-14 name=__codelineno-63-14 href=#__codelineno-63-14></a><span class=w>    </span><span class=nt>rollingUpdate</span><span class=p>:</span>
<a id=__codelineno-63-15 name=__codelineno-63-15 href=#__codelineno-63-15></a><span class=w>      </span><span class=nt>maxSurge</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<a id=__codelineno-63-16 name=__codelineno-63-16 href=#__codelineno-63-16></a><span class=w>      </span><span class=nt>maxUnavailable</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<a id=__codelineno-63-17 name=__codelineno-63-17 href=#__codelineno-63-17></a><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">RollingUpdate</span>
<a id=__codelineno-63-18 name=__codelineno-63-18 href=#__codelineno-63-18></a><span class=w>  </span><span class=nt>template</span><span class=p>:</span>
<a id=__codelineno-63-19 name=__codelineno-63-19 href=#__codelineno-63-19></a><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-63-20 name=__codelineno-63-20 href=#__codelineno-63-20></a><span class=w>      </span><span class=nt>labels</span><span class=p>:</span>
<a id=__codelineno-63-21 name=__codelineno-63-21 href=#__codelineno-63-21></a><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">test-rbd</span>
<a id=__codelineno-63-22 name=__codelineno-63-22 href=#__codelineno-63-22></a><span class=w>    </span><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-63-23 name=__codelineno-63-23 href=#__codelineno-63-23></a><span class=w>      </span><span class=nt>containers</span><span class=p>:</span>
<a id=__codelineno-63-24 name=__codelineno-63-24 href=#__codelineno-63-24></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>command</span><span class=p>:</span>
<a id=__codelineno-63-25 name=__codelineno-63-25 href=#__codelineno-63-25></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">sh</span>
<a id=__codelineno-63-26 name=__codelineno-63-26 href=#__codelineno-63-26></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">-c</span>
<a id=__codelineno-63-27 name=__codelineno-63-27 href=#__codelineno-63-27></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">sleep 36000</span>
<a id=__codelineno-63-28 name=__codelineno-63-28 href=#__codelineno-63-28></a><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">registry.cn-beijing.aliyuncs.com/dotbalo/debug-tools</span>
<a id=__codelineno-63-29 name=__codelineno-63-29 href=#__codelineno-63-29></a><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">test-rbd</span>
<a id=__codelineno-63-30 name=__codelineno-63-30 href=#__codelineno-63-30></a><span class=w>        </span><span class=nt>volumeMounts</span><span class=p>:</span>
<a id=__codelineno-63-31 name=__codelineno-63-31 href=#__codelineno-63-31></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/mnt</span>
<a id=__codelineno-63-32 name=__codelineno-63-32 href=#__codelineno-63-32></a><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rbd-pvc-test</span>
<a id=__codelineno-63-33 name=__codelineno-63-33 href=#__codelineno-63-33></a><span class=w>      </span><span class=nt>volumes</span><span class=p>:</span>
<a id=__codelineno-63-34 name=__codelineno-63-34 href=#__codelineno-63-34></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rbd-pvc-test</span>
<a id=__codelineno-63-35 name=__codelineno-63-35 href=#__codelineno-63-35></a><span class=w>        </span><span class=nt>persistentVolumeClaim</span><span class=p>:</span>
<a id=__codelineno-63-36 name=__codelineno-63-36 href=#__codelineno-63-36></a><span class=w>          </span><span class=nt>claimName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rbd-pvc-test-csi</span>
</code></pre></div> <p>创建该Deployment：</p> <p><div class=highlight><pre><span></span><code><a id=__codelineno-64-1 name=__codelineno-64-1 href=#__codelineno-64-1></a>$<span class=w> </span>kubectl<span class=w> </span>apply<span class=w> </span>-f<span class=w> </span>test-pvc-dp.yaml
<a id=__codelineno-64-2 name=__codelineno-64-2 href=#__codelineno-64-2></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>pod<span class=w> </span>-l<span class=w> </span><span class=nv>app</span><span class=o>=</span>test-cephfs
</code></pre></div> 在其中的副本进行数据写入： <div class=highlight><pre><span></span><code><a id=__codelineno-65-1 name=__codelineno-65-1 href=#__codelineno-65-1></a>$<span class=w> </span>kubectl<span class=w> </span><span class=nb>exec</span><span class=w> </span>test-cephfs-811238bfb7-splxx<span class=w> </span>--<span class=w> </span>bash
<a id=__codelineno-65-2 name=__codelineno-65-2 href=#__codelineno-65-2></a><span class=c1># echo &quot;hello, csi rbd&quot; &gt; /mnt/test.txt </span>
<a id=__codelineno-65-3 name=__codelineno-65-3 href=#__codelineno-65-3></a><span class=c1># exit</span>
</code></pre></div></p> <p>在另一个副本中查看数据： <div class=highlight><pre><span></span><code><a id=__codelineno-66-1 name=__codelineno-66-1 href=#__codelineno-66-1></a>$<span class=w> </span>kubectl<span class=w> </span><span class=nb>exec</span><span class=w> </span>test-cephfs-85f8f8bfb7-splxg<span class=w> </span>--<span class=w> </span>cat<span class=w> </span>/mnt/test.txt
<a id=__codelineno-66-2 name=__codelineno-66-2 href=#__codelineno-66-2></a>hello,<span class=w> </span>csi<span class=w> </span>rbd
</code></pre></div></p> <p>K8S使用ceph-csi持久化存储之RBD</p> <blockquote> <p><a href="https://mp.weixin.qq.com/s?__biz=MzAxMjk0MTYzNw==&mid=2247484067">https://mp.weixin.qq.com/s?__biz=MzAxMjk0MTYzNw==&amp;mid=2247484067</a></p> </blockquote> <h2 id=10-小结>10. 小结<a class=headerlink href=#10-小结 title="Permanent link">&para;</a></h2> <p>本章主要讲解了Kubernetes存储编排功能，目前存储的方向更偏向于CSI的管理方式。</p> <p>所以读者想要Kubernetes集群接入存储平台，首选的方式应该是CSI。</p> <p>目前大部分存储平台的供应商都提供了CSI的驱动，读者直接安装即可使用（需要在GitHub或者对应存储平台的官方网站进行查找）， CSI的管理 方式大大降低了存储的复杂度，可以更加方便地实现存储的管理，比如创建 存储、删除、扩容、备份等。</p> <p>相对于配置分离，存储分离也是云原生设计非常重要的因素，即有状态应用无状态化——把存储交给远端。</p> <p>在之前的程序设计中，可能会把一些数据放在本地或者内存中，因为之前的部署方式不会具有很大的变化，所以这种架构不会有大的问题。</p> <p>但是现在的架构具有很高的弹性，我们往往并不知道服务到底部署在了哪台服务器、哪个位置，所以仍旧将程序的数据放置于本地和内存中是不可取的方式。</p> <p>对于文件型存储，可以使用对象存储的方式将文件直接存储在对象存储平台上。</p> <p>对于缓存数据，可以使用类似Redis的中间件进行存取。</p> <p>这样的话，我们的程序将会彻底变成无状态的形式，无论如何部署、重启、迁移都不会 造成数据的丢失，所以在设计程序时也要有此类意识，将有状态设计变成无状态设计。</p> <p>参考文献：</p> <p><a href=https://www.qikqiak.com/k8strain2/storage/ceph/ >https://www.qikqiak.com/k8strain2/storage/ceph/</a></p> <p><a href=https://imszz.com/p/4aa1a279/ >https://imszz.com/p/4aa1a279/</a></p> <hr> <div class=md-source-file> <small> 最后更新: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime">August 30, 2023 18:57:25</span> <br> 创建日期: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime">March 23, 2023 18:59:28</span> </small> </div> <form class=md-feedback name=feedback hidden> <fieldset> <legend class=md-feedback__title> Was this page helpful? </legend> <div class=md-feedback__inner> <div class=md-feedback__list> <button class="md-feedback__icon md-icon" type=submit title="This page was helpful" data-md-value=1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m7 0c0 .8-.7 1.5-1.5 1.5S14 10.3 14 9.5 14.7 8 15.5 8s1.5.7 1.5 1.5m-5 7.73c-1.75 0-3.29-.73-4.19-1.81L9.23 14c.45.72 1.52 1.23 2.77 1.23s2.32-.51 2.77-1.23l1.42 1.42c-.9 1.08-2.44 1.81-4.19 1.81Z"/></svg> </button> <button class="md-feedback__icon md-icon" type=submit title="This page could be improved" data-md-value=0> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10m-6.5-4c.8 0 1.5.7 1.5 1.5s-.7 1.5-1.5 1.5-1.5-.7-1.5-1.5.7-1.5 1.5-1.5M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m2 4.5c1.75 0 3.29.72 4.19 1.81l-1.42 1.42C14.32 16.5 13.25 16 12 16s-2.32.5-2.77 1.23l-1.42-1.42C8.71 14.72 10.25 14 12 14Z"/></svg> </button> </div> <div class=md-feedback__note> <div data-md-value=1 hidden> Thanks for your feedback! </div> <div data-md-value=0 hidden> Thanks for your feedback! Help us improve this page by using our <a href="https://github.com/hujianli94/hujianli94.github.io/issues/new/?title=[Feedback]+Kubernetes%E5%AD%98%E5%82%A8%E5%85%A5%E9%97%A8+-+/Kubernetes/3.%E8%BF%9B%E9%98%B6%E7%AF%87/8.Kubernetes%E5%AD%98%E5%82%A8%E5%85%A5%E9%97%A8/" target=_blank>feedback form</a>. </div> </div> </div> </fieldset> </form> </article> </div> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> 回到页面顶部 </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=页脚> <a href=../../2.%E5%9F%BA%E7%A1%80%E7%AF%87/7.Kubernetes%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/ class="md-footer__link md-footer__link--prev" aria-label="上一页: Kubernetes配置管理"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> 上一页 </span> <div class=md-ellipsis> Kubernetes配置管理 </div> </div> </a> <a href=../9.Kubernetes%E9%AB%98%E7%BA%A7%E8%B0%83%E5%BA%A6/ class="md-footer__link md-footer__link--next" aria-label="下一页: Kubernetes高级调度"> <div class=md-footer__title> <span class=md-footer__direction> 下一页 </span> <div class=md-ellipsis> Kubernetes高级调度 </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2023 - 2024 hujainli94 </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/hujianli94 target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> <a href=https://kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com/blog_img/20220125122524.png target=_blank rel=noopener title=kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 576 512"><!-- Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M385.2 167.6c6.4 0 12.6.3 18.8 1.1C387.4 90.3 303.3 32 207.7 32 100.5 32 13 104.8 13 197.4c0 53.4 29.3 97.5 77.9 131.6l-19.3 58.6 68-34.1c24.4 4.8 43.8 9.7 68.2 9.7 6.2 0 12.1-.3 18.3-.8-4-12.9-6.2-26.6-6.2-40.8-.1-84.9 72.9-154 165.3-154zm-104.5-52.9c14.5 0 24.2 9.7 24.2 24.4 0 14.5-9.7 24.2-24.2 24.2-14.8 0-29.3-9.7-29.3-24.2.1-14.7 14.6-24.4 29.3-24.4zm-136.4 48.6c-14.5 0-29.3-9.7-29.3-24.2 0-14.8 14.8-24.4 29.3-24.4 14.8 0 24.4 9.7 24.4 24.4 0 14.6-9.6 24.2-24.4 24.2zM563 319.4c0-77.9-77.9-141.3-165.4-141.3-92.7 0-165.4 63.4-165.4 141.3S305 460.7 397.6 460.7c19.3 0 38.9-5.1 58.6-9.9l53.4 29.3-14.8-48.6C534 402.1 563 363.2 563 319.4zm-219.1-24.5c-9.7 0-19.3-9.7-19.3-19.6 0-9.7 9.7-19.3 19.3-19.3 14.8 0 24.4 9.7 24.4 19.3 0 10-9.7 19.6-24.4 19.6zm107.1 0c-9.7 0-19.3-9.7-19.3-19.6 0-9.7 9.7-19.3 19.3-19.3 14.5 0 24.4 9.7 24.4 19.3.1 10-9.9 19.6-24.4 19.6z"/></svg> </a> <a href="mailto:<1879324764@qq.com>" target=_blank rel=noopener title=发送邮件 class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M498.1 5.6c10.1 7 15.4 19.1 13.5 31.2l-64 416c-1.5 9.7-7.4 18.2-16 23s-18.9 5.4-28 1.6L284 427.7l-68.5 74.1c-8.9 9.7-22.9 12.9-35.2 8.1S160 493.2 160 480v-83.6c0-4 1.5-7.8 4.2-10.7l167.6-182.9c5.8-6.3 5.6-16-.4-22s-15.7-6.4-22-.7L106 360.8l-88.3-44.2C7.1 311.3.3 300.7 0 288.9s5.9-22.8 16.1-28.7l448-256c10.7-6.1 23.9-5.5 34 1.4z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-consent data-md-component=consent id=__consent hidden> <div class=md-consent__overlay></div> <aside class=md-consent__inner> <form class="md-consent__form md-grid md-typeset" name=consent> <h4>Cookie consent</h4> <p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p> <input class=md-toggle type=checkbox id=__settings> <div class=md-consent__settings> <ul class=task-list> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=analytics checked> <span class=task-list-indicator></span> Google Analytics </label> </li> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=github checked> <span class=task-list-indicator></span> GitHub </label> </li> </ul> </div> <div class=md-consent__controls> <button class="md-button md-button--primary">同意</button> <label class=md-button for=__settings>管理设定</label> </div> </form> </aside> </div> <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout(function(){document.querySelector("[data-md-component=consent]").hidden=!1},250);var action,form=document.forms.consent;for(action of["submit","reset"])form.addEventListener(action,function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map(function(e){return[e,!0]}))),location.hash="",location.reload()})</script> <script id=__config type=application/json>{"base": "../../..", "features": ["content.action.edit", "content.action.view", "content.code.copy", "content.code.annotate", "navigation.indexes", "navigation.footer", "navigation.indexes", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest"], "search": "../../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script> <script src=../../../assets/javascripts/bundle.aecac24b.min.js></script> <script src=../../../javascripts/extra.js></script> <script src=https://file.cdn.shafish.cn/blog/js/video.min.js></script> </body> </html>