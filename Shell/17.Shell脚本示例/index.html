<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="stay hungry,stay foolish #magic___^_^___line"><meta name=author content=hujainli94><link href=https://hujianli94.github.io/Shell/17.Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/ rel=canonical><link href=../16.Shell%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/ rel=prev><link href=../18.Shell%E8%84%9A%E6%9C%AC%E7%9A%84%E5%8F%82%E6%95%B0%E8%A7%A3%E6%9E%90%E5%B7%A5%E5%85%B7/ rel=next><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.5.48"><title>17.Shell 脚本示例 - DevOps运维开发</title><link rel=stylesheet href=../../assets/stylesheets/main.6f8fc17f.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.06af60db.min.css><style>:root{--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M1 7.775V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 0 1 0 2.474l-5.026 5.026a1.75 1.75 0 0 1-2.474 0l-6.25-6.25A1.75 1.75 0 0 1 1 7.775m1.5 0c0 .066.026.13.073.177l6.25 6.25a.25.25 0 0 0 .354 0l5.025-5.025a.25.25 0 0 0 0-.354l-6.25-6.25a.25.25 0 0 0-.177-.073H2.75a.25.25 0 0 0-.25.25ZM6 5a1 1 0 1 1 0 2 1 1 0 0 1 0-2"/></svg>');--md-admonition-icon--abstract:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M2.5 1.75v11.5c0 .138.112.25.25.25h3.17a.75.75 0 0 1 0 1.5H2.75A1.75 1.75 0 0 1 1 13.25V1.75C1 .784 1.784 0 2.75 0h8.5C12.216 0 13 .784 13 1.75v7.736a.75.75 0 0 1-1.5 0V1.75a.25.25 0 0 0-.25-.25h-8.5a.25.25 0 0 0-.25.25m13.274 9.537zl-4.557 4.45a.75.75 0 0 1-1.055-.008l-1.943-1.95a.75.75 0 0 1 1.062-1.058l1.419 1.425 4.026-3.932a.75.75 0 1 1 1.048 1.074M4.75 4h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5M4 7.75A.75.75 0 0 1 4.75 7h2a.75.75 0 0 1 0 1.5h-2A.75.75 0 0 1 4 7.75"/></svg>');--md-admonition-icon--info:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8m8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13M6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75M8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2"/></svg>');--md-admonition-icon--tip:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M3.499.75a.75.75 0 0 1 1.5 0v.996C5.9 2.903 6.793 3.65 7.662 4.376l.24.202c-.036-.694.055-1.422.426-2.163C9.1.873 10.794-.045 12.622.26 14.408.558 16 1.94 16 4.25c0 1.278-.954 2.575-2.44 2.734l.146.508.065.22c.203.701.412 1.455.476 2.226.142 1.707-.4 3.03-1.487 3.898C11.714 14.671 10.27 15 8.75 15h-6a.75.75 0 0 1 0-1.5h1.376a4.5 4.5 0 0 1-.563-1.191 3.84 3.84 0 0 1-.05-2.063 4.65 4.65 0 0 1-2.025-.293.75.75 0 0 1 .525-1.406c1.357.507 2.376-.006 2.698-.318l.009-.01a.747.747 0 0 1 1.06 0 .75.75 0 0 1-.012 1.074c-.912.92-.992 1.835-.768 2.586.221.74.745 1.337 1.196 1.621H8.75c1.343 0 2.398-.296 3.074-.836.635-.507 1.036-1.31.928-2.602-.05-.603-.216-1.224-.422-1.93l-.064-.221c-.12-.407-.246-.84-.353-1.29a2.4 2.4 0 0 1-.507-.441 3.1 3.1 0 0 1-.633-1.248.75.75 0 0 1 1.455-.364c.046.185.144.436.31.627.146.168.353.305.712.305.738 0 1.25-.615 1.25-1.25 0-1.47-.95-2.315-2.123-2.51-1.172-.196-2.227.387-2.706 1.345-.46.92-.27 1.774.019 3.062l.042.19.01.05c.348.443.666.949.94 1.553a.75.75 0 1 1-1.365.62c-.553-1.217-1.32-1.94-2.3-2.768L6.7 5.527c-.814-.68-1.75-1.462-2.692-2.619a3.7 3.7 0 0 0-1.023.88c-.406.495-.663 1.036-.722 1.508.116.122.306.21.591.239.388.038.797-.06 1.032-.19a.75.75 0 0 1 .728 1.31c-.515.287-1.23.439-1.906.373-.682-.067-1.473-.38-1.879-1.193L.75 5.677V5.5c0-.984.48-1.94 1.077-2.664.46-.559 1.05-1.055 1.673-1.353z"/></svg>');--md-admonition-icon--success:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.75.75 0 0 1 .018-1.042.75.75 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0"/></svg>');--md-admonition-icon--question:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8m8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13M6.92 6.085h.001a.749.749 0 1 1-1.342-.67c.169-.339.436-.701.849-.977C6.845 4.16 7.369 4 8 4a2.76 2.76 0 0 1 1.637.525c.503.377.863.965.863 1.725 0 .448-.115.83-.329 1.15-.205.307-.47.513-.692.662-.109.072-.22.138-.313.195l-.006.004a6 6 0 0 0-.26.16 1 1 0 0 0-.276.245.75.75 0 0 1-1.248-.832c.184-.264.42-.489.692-.661q.154-.1.313-.195l.007-.004c.1-.061.182-.11.258-.161a1 1 0 0 0 .277-.245C8.96 6.514 9 6.427 9 6.25a.61.61 0 0 0-.262-.525A1.27 1.27 0 0 0 8 5.5c-.369 0-.595.09-.74.187a1 1 0 0 0-.34.398M9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0"/></svg>');--md-admonition-icon--warning:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0M9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0"/></svg>');--md-admonition-icon--failure:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M2.344 2.343za8 8 0 0 1 11.314 11.314A8.002 8.002 0 0 1 .234 10.089a8 8 0 0 1 2.11-7.746m1.06 10.253a6.5 6.5 0 1 0 9.108-9.275 6.5 6.5 0 0 0-9.108 9.275M6.03 4.97 8 6.94l1.97-1.97a.749.749 0 0 1 1.275.326.75.75 0 0 1-.215.734L9.06 8l1.97 1.97a.749.749 0 0 1-.326 1.275.75.75 0 0 1-.734-.215L8 9.06l-1.97 1.97a.749.749 0 0 1-1.275-.326.75.75 0 0 1 .215-.734L6.94 8 4.97 6.03a.75.75 0 0 1 .018-1.042.75.75 0 0 1 1.042-.018"/></svg>');--md-admonition-icon--danger:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M9.504.43a1.516 1.516 0 0 1 2.437 1.713L10.415 5.5h2.123c1.57 0 2.346 1.909 1.22 3.004l-7.34 7.142a1.25 1.25 0 0 1-.871.354h-.302a1.25 1.25 0 0 1-1.157-1.723L5.633 10.5H3.462c-1.57 0-2.346-1.909-1.22-3.004zm1.047 1.074L3.286 8.571A.25.25 0 0 0 3.462 9H6.75a.75.75 0 0 1 .694 1.034l-1.713 4.188 6.982-6.793A.25.25 0 0 0 12.538 7H9.25a.75.75 0 0 1-.683-1.06l2.008-4.418.003-.006-.004-.009-.006-.006-.008-.001q-.005 0-.009.004"/></svg>');--md-admonition-icon--bug:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M4.72.22a.75.75 0 0 1 1.06 0l1 .999a3.5 3.5 0 0 1 2.441 0l.999-1a.748.748 0 0 1 1.265.332.75.75 0 0 1-.205.729l-.775.776c.616.63.995 1.493.995 2.444v.327q0 .15-.025.292c.408.14.764.392 1.029.722l1.968-.787a.75.75 0 0 1 .556 1.392L13 7.258V9h2.25a.75.75 0 0 1 0 1.5H13v.5q-.002.615-.141 1.186l2.17.868a.75.75 0 0 1-.557 1.392l-2.184-.873A5 5 0 0 1 8 16a5 5 0 0 1-4.288-2.427l-2.183.873a.75.75 0 0 1-.558-1.392l2.17-.868A5 5 0 0 1 3 11v-.5H.75a.75.75 0 0 1 0-1.5H3V7.258L.971 6.446a.75.75 0 0 1 .558-1.392l1.967.787c.265-.33.62-.583 1.03-.722a1.7 1.7 0 0 1-.026-.292V4.5c0-.951.38-1.814.995-2.444L4.72 1.28a.75.75 0 0 1 0-1.06m.53 6.28a.75.75 0 0 0-.75.75V11a3.5 3.5 0 1 0 7 0V7.25a.75.75 0 0 0-.75-.75ZM6.173 5h3.654A.17.17 0 0 0 10 4.827V4.5a2 2 0 1 0-4 0v.327c0 .096.077.173.173.173"/></svg>');--md-admonition-icon--example:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M5 5.782V2.5h-.25a.75.75 0 0 1 0-1.5h6.5a.75.75 0 0 1 0 1.5H11v3.282l3.666 5.76C15.619 13.04 14.543 15 12.767 15H3.233c-1.776 0-2.852-1.96-1.899-3.458Zm-2.4 6.565a.75.75 0 0 0 .633 1.153h9.534a.75.75 0 0 0 .633-1.153L12.225 10.5h-8.45ZM9.5 2.5h-3V6c0 .143-.04.283-.117.403L4.73 9h6.54L9.617 6.403A.75.75 0 0 1 9.5 6Z"/></svg>');--md-admonition-icon--quote:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M1.75 2.5h10.5a.75.75 0 0 1 0 1.5H1.75a.75.75 0 0 1 0-1.5m4 5h8.5a.75.75 0 0 1 0 1.5h-8.5a.75.75 0 0 1 0-1.5m0 5h8.5a.75.75 0 0 1 0 1.5h-8.5a.75.75 0 0 1 0-1.5M2.5 7.75v6a.75.75 0 0 1-1.5 0v-6a.75.75 0 0 1 1.5 0"/></svg>');}</style><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../stylesheets/extra.css><link rel=stylesheet href=https://file.cdn.shafish.cn/blog/css/vssue.css><link rel=stylesheet href=https://file.cdn.shafish.cn/blog/css/video-js.min.css><link rel=stylesheet href=https://file.cdn.shafish.cn/blog/css/video.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","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"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","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",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=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",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>if("undefined"!=typeof __md_analytics){var consent=__md_get("__consent");consent&&consent.analytics&&__md_analytics()}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#17shell-脚本示例 class=md-skip> 跳转至 </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=页眉> <a href=../.. title=DevOps运维开发 class="md-header__button md-logo" aria-label=DevOps运维开发 data-md-component=logo> <img src=../../assets/images/logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> DevOps运维开发 </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> 17.Shell 脚本示例 </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label=切换至深色模式 type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title=切换至深色模式 for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=blue data-md-color-accent=blue aria-label=切换至浅色模式 type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title=切换至浅色模式 for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=查找> <a href=javascript:void(0) class="md-search__icon md-icon" title=分享 aria-label=分享 data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=清空当前内容 aria-label=清空当前内容 tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> 正在初始化搜索引擎 </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/hujianli94/hujianli94.github.io title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> hujianli94.github.io </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=标签 data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> 首页 </a> </li> <li class=md-tabs__item> <a href=../../k8s/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.k8s/ class=md-tabs__link> k8s </a> </li> <li class=md-tabs__item> <a href=../../Kubernetes/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Kubernetes/ class=md-tabs__link> Kubernetes </a> </li> <li class=md-tabs__item> <a href=../../Docker/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Docker/ class=md-tabs__link> Docker </a> </li> <li class=md-tabs__item> <a href=../../Golang/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Go-Web%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98/ class=md-tabs__link> Golang </a> </li> <li class=md-tabs__item> <a href=../../Python/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Pythjon-auto-ops/ class=md-tabs__link> Python </a> </li> <li class=md-tabs__item> <a href=../../Openstack/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.OpenStack/ class=md-tabs__link> Openstack </a> </li> <li class=md-tabs__item> <a href=../../Python-vs-Go/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Python-vs-Go/ class=md-tabs__link> Python-vs-Go </a> </li> <li class=md-tabs__item> <a href=../../Git/1.Git%E5%9F%BA%E7%A1%80/ class=md-tabs__link> Git </a> </li> <li class=md-tabs__item> <a href=../../Ansible/1.Ansible%E7%AE%80%E4%BB%8B/ class=md-tabs__link> Ansible </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../Shell%E7%AE%80%E4%BB%8B/ class=md-tabs__link> Shell </a> </li> <li class=md-tabs__item> <a href=../../Linux/KVM/1.kvm%E5%B8%B8%E8%A7%81%E6%93%8D%E4%BD%9C/ class=md-tabs__link> Linux </a> </li> <li class=md-tabs__item> <a href=../../middleware/db/1.postgres/ class=md-tabs__link> middleware </a> </li> <li class=md-tabs__item> <a href=../../Other/tools/1.PicGo%E5%9B%BE%E5%BA%8A/ class=md-tabs__link> Other </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=导航栏 data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title=DevOps运维开发 class="md-nav__button md-logo" aria-label=DevOps运维开发 data-md-component=logo> <img src=../../assets/images/logo.png alt=logo> </a> DevOps运维开发 </label> <div class=md-nav__source> <a href=https://github.com/hujianli94/hujianli94.github.io title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> hujianli94.github.io </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> 首页 </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> k8s </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> k8s </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_1> <label class=md-nav__link for=__nav_2_1 id=__nav_2_1_label tabindex=0> <span class=md-ellipsis> 0.学习线路 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_1_label aria-expanded=false> <label class=md-nav__title for=__nav_2_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../k8s/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.k8s/ class=md-nav__link> <span class=md-ellipsis> Kubernetes 从入门到实践 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2> <label class=md-nav__link for=__nav_2_2 id=__nav_2_2_label tabindex=0> <span class=md-ellipsis> 1.容器的发展史 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2> <span class="md-nav__icon md-icon"></span> 1.容器的发展史 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../k8s/1.%E5%AE%B9%E5%99%A8%E7%9A%84%E5%8F%91%E5%B1%95%E5%8F%B2/1.1%E5%BC%80%E5%8F%91%E8%BF%87%E7%A8%8B%E7%9A%84%E5%8F%91%E5%B1%95/ class=md-nav__link> <span class=md-ellipsis> 1.1开发过程的发展 </span> </a> </li> <li class=md-nav__item> <a href=../../k8s/1.%E5%AE%B9%E5%99%A8%E7%9A%84%E5%8F%91%E5%B1%95%E5%8F%B2/1.2%E5%BA%94%E7%94%A8%E6%9E%B6%E6%9E%84%E7%9A%84%E5%8F%91%E5%B1%95/ class=md-nav__link> <span class=md-ellipsis> 1.2应用架构的发展 </span> </a> </li> <li class=md-nav__item> <a href=../../k8s/1.%E5%AE%B9%E5%99%A8%E7%9A%84%E5%8F%91%E5%B1%95%E5%8F%B2/1.3%E9%83%A8%E7%BD%B2%E6%89%93%E5%8C%85%E7%9A%84%E5%8F%91%E5%B1%95/ class=md-nav__link> <span class=md-ellipsis> 1.3部署打包的发展 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_3> <label class=md-nav__link for=__nav_2_3 id=__nav_2_3_label tabindex=0> <span class=md-ellipsis> 2.Kubernetes的核心概念 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_3_label aria-expanded=false> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> 2.Kubernetes的核心概念 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../k8s/2.Kubernetes%E7%9A%84%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/2.1Kubernetes%E7%9A%84%E8%AE%BE%E8%AE%A1%E6%9E%B6%E6%9E%84/ class=md-nav__link> <span class=md-ellipsis> 2.1Kubernetes的设计架构 </span> </a> </li> <li class=md-nav__item> <a href=../../k8s/2.Kubernetes%E7%9A%84%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/2.2Kubernetes%E7%9A%84%E6%A0%B8%E5%BF%83%E5%AF%B9%E8%B1%A1/ class=md-nav__link> <span class=md-ellipsis> 2.2Kubernetes的核心对象 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_4> <label class=md-nav__link for=__nav_2_4 id=__nav_2_4_label tabindex=0> <span class=md-ellipsis> 3.Kubernetes的安装和部署 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_4_label aria-expanded=false> <label class=md-nav__title for=__nav_2_4> <span class="md-nav__icon md-icon"></span> 3.Kubernetes的安装和部署 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../k8s/3.Kubernetes%E7%9A%84%E5%AE%89%E8%A3%85%E5%92%8C%E9%83%A8%E7%BD%B2/3.1kubeadm%E6%90%AD%E5%BB%BA%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/ class=md-nav__link> <span class=md-ellipsis> 3.1kubeadm搭建开发环境 </span> </a> </li> <li class=md-nav__item> <a href=../../k8s/3.Kubernetes%E7%9A%84%E5%AE%89%E8%A3%85%E5%92%8C%E9%83%A8%E7%BD%B2/3.2kubeadm%E6%90%AD%E5%BB%BA%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83/ class=md-nav__link> <span class=md-ellipsis> 3.2kubeadm搭建生产环境 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_5> <label class=md-nav__link for=__nav_2_5 id=__nav_2_5_label tabindex=0> <span class=md-ellipsis> 4.Pod </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_5_label aria-expanded=false> <label class=md-nav__title for=__nav_2_5> <span class="md-nav__icon md-icon"></span> 4.Pod </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../k8s/4.Pod/4.1Pod%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/ class=md-nav__link> <span class=md-ellipsis> 4.1Pod的基本操作 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_6> <label class=md-nav__link for=__nav_2_6 id=__nav_2_6_label tabindex=0> <span class=md-ellipsis> 5.控制器 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_6_label aria-expanded=false> <label class=md-nav__title for=__nav_2_6> <span class="md-nav__icon md-icon"></span> 5.控制器 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../k8s/5.%E6%8E%A7%E5%88%B6%E5%99%A8/5.1Deployment/ class=md-nav__link> <span class=md-ellipsis> 5.1Deployment </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> Kubernetes </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1> <label class=md-nav__link for=__nav_3_1 id=__nav_3_1_label tabindex=0> <span class=md-ellipsis> 0.学习线路 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_1_label aria-expanded=false> <label class=md-nav__title for=__nav_3_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Kubernetes/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Kubernetes/ class=md-nav__link> <span class=md-ellipsis> Kubernetes </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2> <label class=md-nav__link for=__nav_3_2 id=__nav_3_2_label tabindex=0> <span class=md-ellipsis> 1.安装篇 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> 1.安装篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/1.Kubeadm%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/ class=md-nav__link> <span class=md-ellipsis> Kubeadm安装高可用集群 </span> </a> </li> <li class=md-nav__item> <a href=../../Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/2.%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/ class=md-nav__link> <span class=md-ellipsis> 二进制安装高可用K8s集群 </span> </a> </li> <li class=md-nav__item> <a href=../../Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/3.%E5%AE%89%E8%A3%85%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/ class=md-nav__link> <span class=md-ellipsis> 安装常用工具 </span> </a> </li> <li class=md-nav__item> <a href=../../Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/4.Kubeadm%E5%AE%89%E8%A3%85%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/ class=md-nav__link> <span class=md-ellipsis> Kubeadm安装开发环境 </span> </a> </li> <li class=md-nav__item> <a href=../../Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/5.K3s%E5%92%8CMinikube/ class=md-nav__link> <span class=md-ellipsis> K3s和Minikube </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_3> <label class=md-nav__link for=__nav_3_3 id=__nav_3_3_label tabindex=0> <span class=md-ellipsis> 2.基础篇 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> 2.基础篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/3.Docker%E5%9F%BA%E7%A1%80/ class=md-nav__link> <span class=md-ellipsis> Docker基础 </span> </a> </li> <li class=md-nav__item> <a href=../../Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Kubernetes%E7%9A%84%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/ class=md-nav__link> <span class=md-ellipsis> Kubernetes的基础概念 </span> </a> </li> <li class=md-nav__item> <a href=../../Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Kubernetes%E8%B0%83%E5%BA%A6%E5%9F%BA%E7%A1%80/ class=md-nav__link> <span class=md-ellipsis> Kubernetes调度基础 </span> </a> </li> <li class=md-nav__item> <a href=../../Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/6.Kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83%E5%9F%BA%E7%A1%80/ class=md-nav__link> <span class=md-ellipsis> Kubernetes服务发布基础 </span> </a> </li> <li class=md-nav__item> <a href=../../Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/7.Kubernetes%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> Kubernetes配置管理 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_4> <label class=md-nav__link for=__nav_3_4 id=__nav_3_4_label tabindex=0> <span class=md-ellipsis> 3.进阶篇 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_4_label aria-expanded=false> <label class=md-nav__title for=__nav_3_4> <span class="md-nav__icon md-icon"></span> 3.进阶篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Kubernetes/3.%E8%BF%9B%E9%98%B6%E7%AF%87/8.Kubernetes%E5%AD%98%E5%82%A8%E5%85%A5%E9%97%A8/ class=md-nav__link> <span class=md-ellipsis> Kubernetes存储入门 </span> </a> </li> <li class=md-nav__item> <a href=../../Kubernetes/3.%E8%BF%9B%E9%98%B6%E7%AF%87/9.Kubernetes%E9%AB%98%E7%BA%A7%E8%B0%83%E5%BA%A6/ class=md-nav__link> <span class=md-ellipsis> Kubernetes高级调度 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_5> <label class=md-nav__link for=__nav_3_5 id=__nav_3_5_label tabindex=0> <span class=md-ellipsis> 4.高级篇 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_5_label aria-expanded=false> <label class=md-nav__title for=__nav_3_5> <span class="md-nav__icon md-icon"></span> 4.高级篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Kubernetes/4.%E9%AB%98%E7%BA%A7%E7%AF%87/12.%E4%BA%91%E5%8E%9F%E7%94%9F%E5%AD%98%E5%82%A8Rook/ class=md-nav__link> <span class=md-ellipsis> 云原生存储Rook </span> </a> </li> <li class=md-nav__item> <a href=../../Kubernetes/4.%E9%AB%98%E7%BA%A7%E7%AF%87/13.%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%AE%B9%E5%99%A8%E5%8C%96/ class=md-nav__link> <span class=md-ellipsis> 中间件容器化 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_6> <label class=md-nav__link for=__nav_3_6 id=__nav_3_6_label tabindex=0> <span class=md-ellipsis> 5.运维篇 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_6_label aria-expanded=false> <label class=md-nav__title for=__nav_3_6> <span class="md-nav__icon md-icon"></span> 5.运维篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/14.Kubernetes%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/ class=md-nav__link> <span class=md-ellipsis> Kubernetes 日志收集 </span> </a> </li> <li class=md-nav__item> <a href=../../Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/15.Kubernetes%E7%9B%91%E6%8E%A7%E5%91%8A%E8%AD%A6/ class=md-nav__link> <span class=md-ellipsis> Kubernetes监控告警 </span> </a> </li> <li class=md-nav__item> <a href=../../Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/16.%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83Ingress%E8%BF%9B%E9%98%B6/ class=md-nav__link> <span class=md-ellipsis> 服务发布Ingress进阶 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_7> <label class=md-nav__link for=__nav_3_7 id=__nav_3_7_label tabindex=0> <span class=md-ellipsis> 6.DevOps篇 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_7_label aria-expanded=false> <label class=md-nav__title for=__nav_3_7> <span class="md-nav__icon md-icon"></span> 6.DevOps篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/ class=md-nav__link> <span class=md-ellipsis> DevOps 实践 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_8> <label class=md-nav__link for=__nav_3_8 id=__nav_3_8_label tabindex=0> <span class=md-ellipsis> 7.Kubernetes面试 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_8_label aria-expanded=false> <label class=md-nav__title for=__nav_3_8> <span class="md-nav__icon md-icon"></span> 7.Kubernetes面试 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Kubernetes/7.Kubernetes%E9%9D%A2%E8%AF%95/1.Kubernetes%E9%9D%A2%E8%AF%95%E9%A2%98/ class=md-nav__link> <span class=md-ellipsis> Kubernetes 面试题 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_9> <label class=md-nav__link for=__nav_3_9 id=__nav_3_9_label tabindex=0> <span class=md-ellipsis> 8.Kubernetes-网络权威指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_9_label aria-expanded=false> <label class=md-nav__title for=__nav_3_9> <span class="md-nav__icon md-icon"></span> 8.Kubernetes-网络权威指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Kubernetes/8.Kubernetes-%E7%BD%91%E7%BB%9C%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97/1.network-namespace/ class=md-nav__link> <span class=md-ellipsis> 1.network-namespace </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> Docker </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Docker </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_1> <label class=md-nav__link for=__nav_4_1 id=__nav_4_1_label tabindex=0> <span class=md-ellipsis> 0.学习线路 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_1_label aria-expanded=false> <label class=md-nav__title for=__nav_4_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Docker/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Docker/ class=md-nav__link> <span class=md-ellipsis> Docker </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_2> <label class=md-nav__link for=__nav_4_2 id=__nav_4_2_label tabindex=0> <span class=md-ellipsis> 1.基础 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_2_label aria-expanded=false> <label class=md-nav__title for=__nav_4_2> <span class="md-nav__icon md-icon"></span> 1.基础 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Docker/1.%E5%9F%BA%E7%A1%80/1.%E5%AE%89%E8%A3%85Docker/ class=md-nav__link> <span class=md-ellipsis> 1.安装Docker </span> </a> </li> <li class=md-nav__item> <a href=../../Docker/1.%E5%9F%BA%E7%A1%80/2.Docker%E9%95%9C%E5%83%8F/ class=md-nav__link> <span class=md-ellipsis> 2.Docker 镜像 </span> </a> </li> <li class=md-nav__item> <a href=../../Docker/1.%E5%9F%BA%E7%A1%80/3.Docker%E5%AE%B9%E5%99%A8/ class=md-nav__link> <span class=md-ellipsis> 3.Docker容器 </span> </a> </li> <li class=md-nav__item> <a href=../../Docker/1.%E5%9F%BA%E7%A1%80/4.%E4%BC%81%E4%B8%9A%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93harbor/ class=md-nav__link> <span class=md-ellipsis> 4.企业私有仓库 harbor </span> </a> </li> <li class=md-nav__item> <a href=../../Docker/1.%E5%9F%BA%E7%A1%80/5.Docker%E6%95%B0%E6%8D%AE/ class=md-nav__link> <span class=md-ellipsis> 5.Docker数据 </span> </a> </li> <li class=md-nav__item> <a href=../../Docker/1.%E5%9F%BA%E7%A1%80/6.Docker%E7%BD%91%E7%BB%9C/ class=md-nav__link> <span class=md-ellipsis> 6.Docker网络 </span> </a> </li> <li class=md-nav__item> <a href=../../Docker/1.%E5%9F%BA%E7%A1%80/7.Dockerfile/ class=md-nav__link> <span class=md-ellipsis> 7.Dockerfile </span> </a> </li> <li class=md-nav__item> <a href=../../Docker/1.%E5%9F%BA%E7%A1%80/8.docker-compose/ class=md-nav__link> <span class=md-ellipsis> 8.docker-compose </span> </a> </li> <li class=md-nav__item> <a href=../../Docker/1.%E5%9F%BA%E7%A1%80/9.Docker%E7%9B%B8%E5%85%B3%E8%84%9A%E6%9C%AC/ class=md-nav__link> <span class=md-ellipsis> 9.Docker相关脚本 </span> </a> </li> <li class=md-nav__item> <a href=../../Docker/1.%E5%9F%BA%E7%A1%80/10.Docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/ class=md-nav__link> <span class=md-ellipsis> 10.Docker常用命令 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_3> <label class=md-nav__link for=__nav_4_3 id=__nav_4_3_label tabindex=0> <span class=md-ellipsis> 2.实战案例 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_3_label aria-expanded=false> <label class=md-nav__title for=__nav_4_3> <span class="md-nav__icon md-icon"></span> 2.实战案例 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/1.%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/ class=md-nav__link> <span class=md-ellipsis> 1.操作系统 </span> </a> </li> <li class=md-nav__item> <a href=../../Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/2.Web%E6%9C%8D%E5%8A%A1%E4%B8%8E%E5%BA%94%E7%94%A8/ class=md-nav__link> <span class=md-ellipsis> 2.Web服务与应用 </span> </a> </li> <li class=md-nav__item> <a href=../../Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/3.%E6%8C%81%E7%BB%AD%E5%BC%80%E5%8F%91%E4%B8%8E%E7%AE%A1%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 3.持续开发与管理 </span> </a> </li> <li class=md-nav__item> <a href=../../Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/4.%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BA%94%E7%94%A8/ class=md-nav__link> <span class=md-ellipsis> 4.数据库应用 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_4> <label class=md-nav__link for=__nav_4_4 id=__nav_4_4_label tabindex=0> <span class=md-ellipsis> 3.Devops </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4_4> <span class="md-nav__icon md-icon"></span> 3.Devops </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Docker/3.Devops/0.keepalived-docker/ class=md-nav__link> <span class=md-ellipsis> 0.keepalived-docker </span> </a> </li> <li class=md-nav__item> <a href=../../Docker/3.Devops/1.confcenter-docker/ class=md-nav__link> <span class=md-ellipsis> 1.confcenter-docker </span> </a> </li> <li class=md-nav__item> <a href=../../Docker/3.Devops/2.simaple-jenkins/ class=md-nav__link> <span class=md-ellipsis> 2.simaple-jenkins </span> </a> </li> <li class=md-nav__item> <a href=../../Docker/3.Devops/3.docker-nginx-spa/ class=md-nav__link> <span class=md-ellipsis> 3.docker-nginx-spa </span> </a> </li> <li class=md-nav__item> <a href=../../Docker/3.Devops/4.fileserver-docker/ class=md-nav__link> <span class=md-ellipsis> 4.fileserver-docker </span> </a> </li> <li class=md-nav__item> <a href=../../Docker/3.Devops/5.haproxy-docker/ class=md-nav__link> <span class=md-ellipsis> 5.haproxy-docker </span> </a> </li> <li class=md-nav__item> <a href=../../Docker/3.Devops/6.mysql-docker/ class=md-nav__link> <span class=md-ellipsis> 6.mysql-docker </span> </a> </li> <li class=md-nav__item> <a href=../../Docker/3.Devops/7.frp-docker/ class=md-nav__link> <span class=md-ellipsis> 7.frp-docker </span> </a> </li> <li class=md-nav__item> <a href=../../Docker/3.Devops/8.coredns-docker/ class=md-nav__link> <span class=md-ellipsis> 8.coredns-docker </span> </a> </li> <li class=md-nav__item> <a href=../../Docker/3.Devops/9.simple-harbor/ class=md-nav__link> <span class=md-ellipsis> 9.simple-harbor </span> </a> </li> <li class=md-nav__item> <a href=../../Docker/3.Devops/10.redis-docker/ class=md-nav__link> <span class=md-ellipsis> 10.redis-docker </span> </a> </li> <li class=md-nav__item> <a href=../../Docker/3.Devops/11.nexus3-docker/ class=md-nav__link> <span class=md-ellipsis> 11.nexus3-docker </span> </a> </li> <li class=md-nav__item> <a href=../../Docker/3.Devops/12.openvpn-docker/ class=md-nav__link> <span class=md-ellipsis> 12.openvpn-docker </span> </a> </li> <li class=md-nav__item> <a href=../../Docker/3.Devops/13.nfs-docker/ class=md-nav__link> <span class=md-ellipsis> 13.nfs-docker </span> </a> </li> <li class=md-nav__item> <a href=../../Docker/3.Devops/14.jumpserver-docker/ class=md-nav__link> <span class=md-ellipsis> 14.jumpserver-docker </span> </a> </li> <li class=md-nav__item> <a href=../../Docker/3.Devops/15.ansible-docker/ class=md-nav__link> <span class=md-ellipsis> 15.ansible-docker </span> </a> </li> <li class=md-nav__item> <a href=../../Docker/3.Devops/16.minio-docker/ class=md-nav__link> <span class=md-ellipsis> 16.minio-docker </span> </a> </li> <li class=md-nav__item> <a href=../../Docker/3.Devops/17.vaultwarden-docker/ class=md-nav__link> <span class=md-ellipsis> 17.vaultwarden-docker </span> </a> </li> <li class=md-nav__item> <a href=../../Docker/3.Devops/18.kasm-docker/ class=md-nav__link> <span class=md-ellipsis> 18.kasm-docker </span> </a> </li> <li class=md-nav__item> <a href=../../Docker/3.Devops/19.nginx-docker/ class=md-nav__link> <span class=md-ellipsis> 19.nginx-docker </span> </a> </li> <li class=md-nav__item> <a href=../../Docker/3.Devops/20.kafka-docker/ class=md-nav__link> <span class=md-ellipsis> 20.kafka-docker </span> </a> </li> <li class=md-nav__item> <a href=../../Docker/3.Devops/21.golang-docker/ class=md-nav__link> <span class=md-ellipsis> 21.golang-docker </span> </a> </li> <li class=md-nav__item> <a href=../../Docker/3.Devops/22.postgres-docker/ class=md-nav__link> <span class=md-ellipsis> 22.postgres-docker </span> </a> </li> <li class=md-nav__item> <a href=../../Docker/3.Devops/23.nginx-download-docker/ class=md-nav__link> <span class=md-ellipsis> 23.nginx-download-docker </span> </a> </li> <li class=md-nav__item> <a href=../../Docker/3.Devops/24.helm%E9%83%A8%E7%BD%B2%E5%B8%B8%E7%94%A8%E6%9C%8D%E5%8A%A1/ class=md-nav__link> <span class=md-ellipsis> 24.helm部署常用服务 </span> </a> </li> <li class=md-nav__item> <a href=../../Docker/3.Devops/25.Python%E6%93%8D%E4%BD%9CDocker/ class=md-nav__link> <span class=md-ellipsis> 25.Python 操作 Docker </span> </a> </li> <li class=md-nav__item> <a href=../../Docker/3.Devops/26.docker-compose-devops/ class=md-nav__link> <span class=md-ellipsis> 26.docker-compose-devops </span> </a> </li> <li class=md-nav__item> <a href=../../Docker/3.Devops/27.DevOps%E4%B8%8B%E7%9A%84Shell%E8%84%9A%E6%9C%AC/ class=md-nav__link> <span class=md-ellipsis> 27.DevOps 下的 Shell 脚本 </span> </a> </li> <li class=md-nav__item> <a href=../../Docker/3.Devops/28.Devops%E4%B8%8B%E7%9A%84Python%E8%84%9A%E6%9C%AC/ class=md-nav__link> <span class=md-ellipsis> 28.Devops下的Python脚本 </span> </a> </li> <li class=md-nav__item> <a href=../../Docker/3.Devops/29.Vagrant%E8%99%9A%E6%8B%9F%E6%9C%BA/ class=md-nav__link> <span class=md-ellipsis> 29.Vagrant虚拟机 </span> </a> </li> <li class=md-nav__item> <a href=../../Docker/3.Devops/30.VMware-workstation/ class=md-nav__link> <span class=md-ellipsis> 30.VMware Workstation </span> </a> </li> <li class=md-nav__item> <a href=../../Docker/3.Devops/31.VirtualBox/ class=md-nav__link> <span class=md-ellipsis> 31.VirtualBox </span> </a> </li> <li class=md-nav__item> <a href=../../Docker/3.Devops/32.Devops%E7%9B%B8%E5%85%B3%E5%AD%98%E5%82%A8%E5%BA%93/ class=md-nav__link> <span class=md-ellipsis> 32.Devops相关存储库 </span> </a> </li> <li class=md-nav__item> <a href=../../Docker/3.Devops/33.terraform%E6%A6%82%E8%BF%B0/ class=md-nav__link> <span class=md-ellipsis> 33.terraform概述 </span> </a> </li> <li class=md-nav__item> <a href=../../Docker/3.Devops/34.%E5%8A%A0%E9%80%9Fdockerhub/ class=md-nav__link> <span class=md-ellipsis> 34.加速 dockerhub </span> </a> </li> <li class=md-nav__item> <a href=../../Docker/3.Devops/35.instantbox/ class=md-nav__link> <span class=md-ellipsis> 35.instantbox </span> </a> </li> <li class=md-nav__item> <a href=../../Docker/3.Devops/36.docker-prometheus-stack/ class=md-nav__link> <span class=md-ellipsis> 36.docker-prometheus-stack </span> </a> </li> <li class=md-nav__item> <a href=../../Docker/3.Devops/37.grabber/ class=md-nav__link> <span class=md-ellipsis> 37.grabber </span> </a> </li> <li class=md-nav__item> <a href=../../Docker/3.Devops/38.webhookbot/ class=md-nav__link> <span class=md-ellipsis> 38.webhookbot </span> </a> </li> <li class=md-nav__item> <a href=../../Docker/3.Devops/39.docker_pull/ class=md-nav__link> <span class=md-ellipsis> 39.docker_pull </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> Golang </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Golang </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_1> <label class=md-nav__link for=__nav_5_1 id=__nav_5_1_label tabindex=0> <span class=md-ellipsis> 0.学习线路 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_1_label aria-expanded=false> <label class=md-nav__title for=__nav_5_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Golang/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Go-Web%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98/ class=md-nav__link> <span class=md-ellipsis> Go Web 开发实战 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_2> <label class=md-nav__link for=__nav_5_2 id=__nav_5_2_label tabindex=0> <span class=md-ellipsis> 1.Go基础 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_2_label aria-expanded=false> <label class=md-nav__title for=__nav_5_2> <span class="md-nav__icon md-icon"></span> 1.Go基础 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Golang/1.Go%E5%9F%BA%E7%A1%80/1.%E5%AE%89%E8%A3%85Go/ class=md-nav__link> <span class=md-ellipsis> 安装 Go </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/1.Go%E5%9F%BA%E7%A1%80/2.%E7%AC%AC%E4%B8%80%E4%B8%AAGo%E7%A8%8B%E5%BA%8F/ class=md-nav__link> <span class=md-ellipsis> 第一个Go程序 </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/ class=md-nav__link> <span class=md-ellipsis> Go 基础语法 </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/1.Go%E5%9F%BA%E7%A1%80/4.Go-Module/ class=md-nav__link> <span class=md-ellipsis> Go Module </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/1.Go%E5%9F%BA%E7%A1%80/5.Go-%E6%A0%87%E5%87%86%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84/ class=md-nav__link> <span class=md-ellipsis> Go 标准目录结构 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_3> <label class=md-nav__link for=__nav_5_3 id=__nav_5_3_label tabindex=0> <span class=md-ellipsis> 2.Go-Web基础 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_3_label aria-expanded=false> <label class=md-nav__title for=__nav_5_3> <span class="md-nav__icon md-icon"></span> 2.Go-Web基础 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Golang/2.Go-Web%E5%9F%BA%E7%A1%80/5.%E7%AC%AC%E4%B8%80%E4%B8%AAGo-Web%E7%A8%8B%E5%BA%8F/ class=md-nav__link> <span class=md-ellipsis> 第一个Go Web程序 </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/2.Go-Web%E5%9F%BA%E7%A1%80/6.Web%E7%A8%8B%E5%BA%8F%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86%E7%AE%80%E4%BB%8B/ class=md-nav__link> <span class=md-ellipsis> Web程序运行原理简介 </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/2.Go-Web%E5%9F%BA%E7%A1%80/7.net-http%E5%8C%85/ class=md-nav__link> <span class=md-ellipsis> net/http包 </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/2.Go-Web%E5%9F%BA%E7%A1%80/8.html-template%E5%8C%85/ class=md-nav__link> <span class=md-ellipsis> html/template包 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_4> <label class=md-nav__link for=__nav_5_4 id=__nav_5_4_label tabindex=0> <span class=md-ellipsis> 3.Go-Web请求处理 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_4_label aria-expanded=false> <label class=md-nav__title for=__nav_5_4> <span class="md-nav__icon md-icon"></span> 3.Go-Web请求处理 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Golang/3.Go-Web%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/9.%E7%AE%80%E5%8D%95Web%E6%9C%8D%E5%8A%A1%E5%99%A8/ class=md-nav__link> <span class=md-ellipsis> 简单Web服务器 </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/3.Go-Web%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/10.%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82/ class=md-nav__link> <span class=md-ellipsis> 处理请求 </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/3.Go-Web%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/11.session%E5%92%8Ccookie/ class=md-nav__link> <span class=md-ellipsis> session和cookie </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_5> <label class=md-nav__link for=__nav_5_5 id=__nav_5_5_label tabindex=0> <span class=md-ellipsis> 4.Go访问数据库 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5_5> <span class="md-nav__icon md-icon"></span> 4.Go访问数据库 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/12.Go%E6%93%8D%E4%BD%9CMySQL/ class=md-nav__link> <span class=md-ellipsis> Go操作MySQL </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/13.Go%E6%93%8D%E4%BD%9CRedis/ class=md-nav__link> <span class=md-ellipsis> Go操作Redis </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/14.Go%E6%93%8D%E4%BD%9CMongoDB/ class=md-nav__link> <span class=md-ellipsis> Go操作MongoDB </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/15.Go%E7%9A%84%E5%B8%B8%E8%A7%81ORM%E5%BA%93/ class=md-nav__link> <span class=md-ellipsis> Go 的常见 ORM 库 </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/16.Go%E6%93%8D%E4%BD%9CSQLite/ class=md-nav__link> <span class=md-ellipsis> Go操作SQLite </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_6> <label class=md-nav__link for=__nav_5_6 id=__nav_5_6_label tabindex=0> <span class=md-ellipsis> 5.Go高级网络编程 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_6_label aria-expanded=false> <label class=md-nav__title for=__nav_5_6> <span class="md-nav__icon md-icon"></span> 5.Go高级网络编程 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Golang/5.Go%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/17.Go-Socket%E7%BC%96%E7%A8%8B/ class=md-nav__link> <span class=md-ellipsis> Go Socket编程 </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/5.Go%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/18.Go-RPC%E7%BC%96%E7%A8%8B/ class=md-nav__link> <span class=md-ellipsis> Go RPC编程 </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/5.Go%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/19.Go-%E5%BE%AE%E6%9C%8D%E5%8A%A1/ class=md-nav__link> <span class=md-ellipsis> Go 微服务 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_7> <label class=md-nav__link for=__nav_5_7 id=__nav_5_7_label tabindex=0> <span class=md-ellipsis> 6.Go文件处理 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_7_label aria-expanded=false> <label class=md-nav__title for=__nav_5_7> <span class="md-nav__icon md-icon"></span> 6.Go文件处理 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/20.%E5%A4%84%E7%90%86%E7%9B%AE%E5%BD%95%E4%B8%8E%E6%96%87%E4%BB%B6/ class=md-nav__link> <span class=md-ellipsis> 处理目录与文件 </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/21.%E5%A4%84%E7%90%86XML%E6%96%87%E4%BB%B6/ class=md-nav__link> <span class=md-ellipsis> 处理XML文件 </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/22.%E5%A4%84%E7%90%86JSON%E6%96%87%E4%BB%B6/ class=md-nav__link> <span class=md-ellipsis> 处理JSON文件 </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/23.%E5%A4%84%E7%90%86CSV%E6%96%87%E4%BB%B6/ class=md-nav__link> <span class=md-ellipsis> 处理CSV文件 </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/24.%E5%A4%84%E7%90%86Go%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95/ class=md-nav__link> <span class=md-ellipsis> 处理Go日志记录 </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/25.%E5%A4%84%E7%90%86%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 处理正则表达式 </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/26.%E5%A4%84%E7%90%86Excel%E6%96%87%E4%BB%B6/ class=md-nav__link> <span class=md-ellipsis> 处理Excel文件 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_8> <label class=md-nav__link for=__nav_5_8 id=__nav_5_8_label tabindex=0> <span class=md-ellipsis> 7.Go并发编程 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_8_label aria-expanded=false> <label class=md-nav__title for=__nav_5_8> <span class="md-nav__icon md-icon"></span> 7.Go并发编程 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/26.%E5%B9%B6%E5%8F%91-%E5%B9%B6%E8%A1%8C/ class=md-nav__link> <span class=md-ellipsis> 并发 并行 </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/27.%E8%BF%9B%E7%A8%8B-%E7%BA%BF%E7%A8%8B-%E5%8D%8F%E7%A8%8B/ class=md-nav__link> <span class=md-ellipsis> 进程 线程 协程 </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/28.Go%E5%B9%B6%E5%8F%91%E6%A8%A1%E5%9E%8B/ class=md-nav__link> <span class=md-ellipsis> Go并发模型 </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/29.goroutine%E5%92%8Cchannel/ class=md-nav__link> <span class=md-ellipsis> goroutine和channel </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/30.sync%E5%AE%9E%E7%8E%B0%E5%B9%B6%E5%8F%91/ class=md-nav__link> <span class=md-ellipsis> sync实现并发 </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/31.Go%E5%B9%B6%E5%8F%91%E7%9A%84Web%E5%BA%94%E7%94%A8/ class=md-nav__link> <span class=md-ellipsis> Go并发的Web应用 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_9> <label class=md-nav__link for=__nav_5_9 id=__nav_5_9_label tabindex=0> <span class=md-ellipsis> 8.Go标准库 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_9_label aria-expanded=false> <label class=md-nav__title for=__nav_5_9> <span class="md-nav__icon md-icon"></span> 8.Go标准库 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/32.time/ class=md-nav__link> <span class=md-ellipsis> time </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/33.strings/ class=md-nav__link> <span class=md-ellipsis> strings </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/34.bytes/ class=md-nav__link> <span class=md-ellipsis> bytes </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/35.json/ class=md-nav__link> <span class=md-ellipsis> json </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/36.io-bufio/ class=md-nav__link> <span class=md-ellipsis> io/bufio </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/37.fmt/ class=md-nav__link> <span class=md-ellipsis> fmt </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/38.strconv/ class=md-nav__link> <span class=md-ellipsis> strconv </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/39.regexp/ class=md-nav__link> <span class=md-ellipsis> regexp </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/40.log/ class=md-nav__link> <span class=md-ellipsis> log </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/41.reflect-unsafe/ class=md-nav__link> <span class=md-ellipsis> reflect/unsafe </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/42.os-path-filepath/ class=md-nav__link> <span class=md-ellipsis> os/path/filepath </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/43.unicode/ class=md-nav__link> <span class=md-ellipsis> unicode </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/44.flag/ class=md-nav__link> <span class=md-ellipsis> flag </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/45.net-url/ class=md-nav__link> <span class=md-ellipsis> net/url </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/46.net-http/ class=md-nav__link> <span class=md-ellipsis> net/http </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/47.sort/ class=md-nav__link> <span class=md-ellipsis> sort </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/48.errors/ class=md-nav__link> <span class=md-ellipsis> errors </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/49.%E5%87%BD%E6%95%B0%E5%B7%A5%E5%85%B7%E5%BA%93/ class=md-nav__link> <span class=md-ellipsis> 函数工具库 </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/50.Go%E8%AF%AD%E8%A8%80%E5%9C%A8%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/ class=md-nav__link> <span class=md-ellipsis> Go语言在运维开发中的应用 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_10> <label class=md-nav__link for=__nav_5_10 id=__nav_5_10_label tabindex=0> <span class=md-ellipsis> 9.Go三方库 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_10_label aria-expanded=false> <label class=md-nav__title for=__nav_5_10> <span class="md-nav__icon md-icon"></span> 9.Go三方库 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/0.%E5%BC%80%E6%BA%90%E8%87%AA%E5%B7%B1%E7%9A%84Go%E5%BA%93/ class=md-nav__link> <span class=md-ellipsis> 开源自己的Go库 </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/1.cobra/ class=md-nav__link> <span class=md-ellipsis> Cobra </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/2.viper/ class=md-nav__link> <span class=md-ellipsis> Viper </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/3.Zap/ class=md-nav__link> <span class=md-ellipsis> Zap </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/4.mahonia/ class=md-nav__link> <span class=md-ellipsis> mahonia </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/5.ssh/ class=md-nav__link> <span class=md-ellipsis> ssh </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/6.fsnotify/ class=md-nav__link> <span class=md-ellipsis> fsnotify </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/7.yaml/ class=md-nav__link> <span class=md-ellipsis> yaml </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/8.tail/ class=md-nav__link> <span class=md-ellipsis> tail </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/9.gRPC/ class=md-nav__link> <span class=md-ellipsis> gRPC </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/10.gopsutil/ class=md-nav__link> <span class=md-ellipsis> gopsutil </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/11.go-awesome/ class=md-nav__link> <span class=md-ellipsis> go-awesome </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/12.dmidecode/ class=md-nav__link> <span class=md-ellipsis> dmidecode </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/13.toml/ class=md-nav__link> <span class=md-ellipsis> toml </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/14.cli/ class=md-nav__link> <span class=md-ellipsis> cli </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/15.goconfig/ class=md-nav__link> <span class=md-ellipsis> goconfig </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/%E9%99%84-%E5%85%B6%E4%BB%96%E4%B8%89%E6%96%B9%E5%BA%93/ class=md-nav__link> <span class=md-ellipsis> 附-其他三方库 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_11> <label class=md-nav__link for=__nav_5_11 id=__nav_5_11_label tabindex=0> <span class=md-ellipsis> 10.Go-RESTful-API接口开发 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_11_label aria-expanded=false> <label class=md-nav__title for=__nav_5_11> <span class="md-nav__icon md-icon"></span> 10.Go-RESTful-API接口开发 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Golang/10.Go-RESTful-API%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91/1.%E4%BB%80%E4%B9%88%E6%98%AFRESTful-API/ class=md-nav__link> <span class=md-ellipsis> 1.什么是 RESTful-API </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/10.Go-RESTful-API%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91/2.GORMv2/ class=md-nav__link> <span class=md-ellipsis> 2.GORMv2 </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/10.Go-RESTful-API%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91/3.Gin%E6%A1%86%E6%9E%B6%E7%9A%84%E4%BD%BF%E7%94%A8/ class=md-nav__link> <span class=md-ellipsis> 3.Gin 框架的使用 </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/10.Go-RESTful-API%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91/4.%E5%9B%BE%E4%B9%A6%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-%E5%89%8D%E7%AB%AF/ class=md-nav__link> <span class=md-ellipsis> 4.图书管理系统-前端 </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/10.Go-RESTful-API%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91/5.%E5%9B%BE%E4%B9%A6%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-%E5%90%8E%E7%AB%AF/ class=md-nav__link> <span class=md-ellipsis> 5.图书管理系统-后端 </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/10.Go-RESTful-API%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91/6.Gin%2BVue%E5%85%A5%E9%97%A8%E9%A1%B9%E7%9B%AE/ class=md-nav__link> <span class=md-ellipsis> 6.Gin+Vue入门项目 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_12> <label class=md-nav__link for=__nav_5_12 id=__nav_5_12_label tabindex=0> <span class=md-ellipsis> 11.Web前端 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_12_label aria-expanded=false> <label class=md-nav__title for=__nav_5_12> <span class="md-nav__icon md-icon"></span> 11.Web前端 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Golang/11.Web%E5%89%8D%E7%AB%AF/1.HTML%E6%A0%87%E8%AE%B0%E8%AF%AD%E8%A8%80/ class=md-nav__link> <span class=md-ellipsis> 1.HTML标记语言 </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/11.Web%E5%89%8D%E7%AB%AF/2.CSS%E6%A0%B7%E5%BC%8F%E8%AF%AD%E8%A8%80/ class=md-nav__link> <span class=md-ellipsis> 2.CSS样式语言 </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/11.Web%E5%89%8D%E7%AB%AF/3.JavaScript%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%84%9A%E6%9C%AC%E8%AF%AD%E8%A8%80/ class=md-nav__link> <span class=md-ellipsis> 3.JavaScript客户端脚本语言 </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/11.Web%E5%89%8D%E7%AB%AF/4.JavaScript%E5%BA%93-JQuery/ class=md-nav__link> <span class=md-ellipsis> 4.JavaScript库:JQuery </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_13> <label class=md-nav__link for=__nav_5_13 id=__nav_5_13_label tabindex=0> <span class=md-ellipsis> 12.Vue前端开发 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_13_label aria-expanded=false> <label class=md-nav__title for=__nav_5_13> <span class="md-nav__icon md-icon"></span> 12.Vue前端开发 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Golang/12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/1.%E8%AE%A4%E8%AF%86Vue.js/ class=md-nav__link> <span class=md-ellipsis> 1.认识Vue.js.md </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/2.Vue%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4/ class=md-nav__link> <span class=md-ellipsis> 2.Vue常用指令 </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/3.Vue%E5%B8%B8%E7%94%A8%E5%B1%9E%E6%80%A7/ class=md-nav__link> <span class=md-ellipsis> 3.Vue常用属性 </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/4.Vue%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4%E4%B9%8B%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/ class=md-nav__link> <span class=md-ellipsis> 4.Vue常用指令之流程控制 </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/5.Vue%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4%E4%B9%8B%E6%95%B0%E6%8D%AE%E5%8F%8C%E5%90%91%E7%BB%91%E5%AE%9A/ class=md-nav__link> <span class=md-ellipsis> 5.Vue常用指令之数据双向绑定 </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/6.Vue%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E9%92%A9%E5%AD%90/ class=md-nav__link> <span class=md-ellipsis> 6.Vue生命周期钩子 </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/7.VueCli%E8%84%9A%E6%89%8B%E6%9E%B6/ class=md-nav__link> <span class=md-ellipsis> 7.VueCli脚手架 </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/8.Vue%E7%BB%84%E4%BB%B6/ class=md-nav__link> <span class=md-ellipsis> 8.Vue组件 </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/9.Vue%E8%B7%AF%E7%94%B1/ class=md-nav__link> <span class=md-ellipsis> 9.Vue路由 </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/10.Vuex%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 10.Vuex状态管理 </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/11.%E5%89%8D%E5%90%8E%E7%AB%AF%E6%95%B0%E6%8D%AE%E4%BA%A4%E4%BA%92-Axios/ class=md-nav__link> <span class=md-ellipsis> 11.前后端数据交互 Axios </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/12.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/12.Element-Plus/ class=md-nav__link> <span class=md-ellipsis> 12.Element Plus </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_14> <label class=md-nav__link for=__nav_5_14 id=__nav_5_14_label tabindex=0> <span class=md-ellipsis> 13.K8s管理系统项目实战 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_14_label aria-expanded=false> <label class=md-nav__title for=__nav_5_14> <span class="md-nav__icon md-icon"></span> 13.K8s管理系统项目实战 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Golang/13.K8s%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/1.K8s%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/ class=md-nav__link> <span class=md-ellipsis> K8s 管理系统-后端开发 </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/13.K8s%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/2.K8s%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/ class=md-nav__link> <span class=md-ellipsis> K8s管理系统-前端开发 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_15> <label class=md-nav__link for=__nav_5_15 id=__nav_5_15_label tabindex=0> <span class=md-ellipsis> 14.Go开发的三方平台 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_15_label aria-expanded=false> <label class=md-nav__title for=__nav_5_15> <span class="md-nav__icon md-icon"></span> 14.Go开发的三方平台 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Golang/14.Go%E5%BC%80%E5%8F%91%E7%9A%84%E4%B8%89%E6%96%B9%E5%B9%B3%E5%8F%B0/0.%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%BF%E7%94%A8Go%E5%81%9A%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/ class=md-nav__link> <span class=md-ellipsis> 为什么使用Go做后端开发 </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/14.Go%E5%BC%80%E5%8F%91%E7%9A%84%E4%B8%89%E6%96%B9%E5%B9%B3%E5%8F%B0/1.TBak-System%E5%A4%87%E4%BB%BD%E5%B9%B3%E5%8F%B0/ class=md-nav__link> <span class=md-ellipsis> TBak System备份平台 </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/14.Go%E5%BC%80%E5%8F%91%E7%9A%84%E4%B8%89%E6%96%B9%E5%B9%B3%E5%8F%B0/2.kubernetes%E5%AE%B9%E5%99%A8%E4%BA%91%E7%AE%A1%E7%90%86%E5%B9%B3%E5%8F%B0/ class=md-nav__link> <span class=md-ellipsis> kubernetes容器云管理平台 </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/14.Go%E5%BC%80%E5%8F%91%E7%9A%84%E4%B8%89%E6%96%B9%E5%B9%B3%E5%8F%B0/3.Go%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/ class=md-nav__link> <span class=md-ellipsis> Go 命令行工具 </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/14.Go%E5%BC%80%E5%8F%91%E7%9A%84%E4%B8%89%E6%96%B9%E5%B9%B3%E5%8F%B0/4.%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/ class=md-nav__link> <span class=md-ellipsis> nps </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/14.Go%E5%BC%80%E5%8F%91%E7%9A%84%E4%B8%89%E6%96%B9%E5%B9%B3%E5%8F%B0/5.go-web%E9%A1%B9%E7%9B%AE/ class=md-nav__link> <span class=md-ellipsis> go-web项目 </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/14.Go%E5%BC%80%E5%8F%91%E7%9A%84%E4%B8%89%E6%96%B9%E5%B9%B3%E5%8F%B0/6.go-%E4%B8%89%E6%96%B9%E5%B7%A5%E5%85%B7%E7%AE%80%E5%8D%95%E5%85%A5%E9%97%A8/ class=md-nav__link> <span class=md-ellipsis> go-三方工具简单入门 </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/14.Go%E5%BC%80%E5%8F%91%E7%9A%84%E4%B8%89%E6%96%B9%E5%B9%B3%E5%8F%B0/7.diamond-devops/ class=md-nav__link> <span class=md-ellipsis> diamond-devops </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/14.Go%E5%BC%80%E5%8F%91%E7%9A%84%E4%B8%89%E6%96%B9%E5%B9%B3%E5%8F%B0/8.Go%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E7%9B%AE%E5%BD%95/ class=md-nav__link> <span class=md-ellipsis> Go语言学习目录 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_16> <label class=md-nav__link for=__nav_5_16 id=__nav_5_16_label tabindex=0> <span class=md-ellipsis> 15.容器化Go </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_16_label aria-expanded=false> <label class=md-nav__title for=__nav_5_16> <span class="md-nav__icon md-icon"></span> 15.容器化Go </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Golang/15.%E5%AE%B9%E5%99%A8%E5%8C%96Go/0.%E6%9E%84%E5%BB%BAGo%E5%BA%94%E7%94%A8docker%E9%95%9C%E5%83%8F/ class=md-nav__link> <span class=md-ellipsis> 构建Go应用docker镜像 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_17> <label class=md-nav__link for=__nav_5_17 id=__nav_5_17_label tabindex=0> <span class=md-ellipsis> 16.算法 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_17_label aria-expanded=false> <label class=md-nav__title for=__nav_5_17> <span class="md-nav__icon md-icon"></span> 16.算法 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Golang/16.%E7%AE%97%E6%B3%95/0.Go%E5%AE%9E%E7%8E%B0%E7%9A%84%E6%96%90%E6%B3%A2%E9%82%A3%E5%A5%91%E6%95%B0%E5%88%97/ class=md-nav__link> <span class=md-ellipsis> 0.Go 实现的斐波那契数列 </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/16.%E7%AE%97%E6%B3%95/1.Go%E5%AE%9E%E7%8E%B0%E7%9A%84%E5%86%92%E6%B3%A1%E7%AE%97%E6%B3%95/ class=md-nav__link> <span class=md-ellipsis> 1.Go 实现的冒泡算法 </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/16.%E7%AE%97%E6%B3%95/2.Go%E5%AE%9E%E7%8E%B0%E7%9A%84%E9%80%89%E6%8B%A9%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/ class=md-nav__link> <span class=md-ellipsis> 2.Go 实现的选择排序算法 </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/16.%E7%AE%97%E6%B3%95/3.Go%E5%AE%9E%E7%8E%B0%E7%9A%84%E6%8F%92%E5%85%A5%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/ class=md-nav__link> <span class=md-ellipsis> 3.Go 实现的插入排序算法 </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/16.%E7%AE%97%E6%B3%95/4.Go%E5%AE%9E%E7%8E%B0%E7%9A%84%E5%B8%8C%E5%B0%94%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/ class=md-nav__link> <span class=md-ellipsis> 4.Go 实现的希尔排序算法 </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/16.%E7%AE%97%E6%B3%95/5.Go%E5%AE%9E%E7%8E%B0%E7%9A%84%E5%BF%AB%E9%80%9F%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/ class=md-nav__link> <span class=md-ellipsis> 5.Go 实现的快速排序算法 </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/16.%E7%AE%97%E6%B3%95/6.Go%E5%AE%9E%E7%8E%B0%E7%9A%84%E5%BD%92%E5%B9%B6%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/ class=md-nav__link> <span class=md-ellipsis> 6.Go 实现的归并排序算法 </span> </a> </li> <li class=md-nav__item> <a href=../../Golang/16.%E7%AE%97%E6%B3%95/7.Go%E5%AE%9E%E7%8E%B0%E7%9A%84%E5%A0%86%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/ class=md-nav__link> <span class=md-ellipsis> 7.Go 实现的堆排序算法 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> <span class=md-ellipsis> Python </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Python </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_1> <label class=md-nav__link for=__nav_6_1 id=__nav_6_1_label tabindex=0> <span class=md-ellipsis> 0.学习线路 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_1_label aria-expanded=false> <label class=md-nav__title for=__nav_6_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Python/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Pythjon-auto-ops/ class=md-nav__link> <span class=md-ellipsis> Python Linux 管理与自动化运维 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_2> <label class=md-nav__link for=__nav_6_2 id=__nav_6_2_label tabindex=0> <span class=md-ellipsis> 1.Python基础篇 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_2_label aria-expanded=false> <label class=md-nav__title for=__nav_6_2> <span class="md-nav__icon md-icon"></span> 1.Python基础篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/1.Python%E7%94%9F%E6%80%81%E5%B7%A5%E5%85%B7/ class=md-nav__link> <span class=md-ellipsis> 1.Python 生态工具 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/2.Python%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E5%AE%89%E8%A3%85/ class=md-nav__link> <span class=md-ellipsis> 2.Python 第三方库安装 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/3.Python%E5%B7%A5%E4%BD%9C%E7%8E%AF%E5%A2%83%E7%AE%A1%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 3.Python 工作环境管理 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/4.Python%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/ class=md-nav__link> <span class=md-ellipsis> 4.Python 开发环境 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/5.Python%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/ class=md-nav__link> <span class=md-ellipsis> 5.Python 数据结构 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/6.Python%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84/ class=md-nav__link> <span class=md-ellipsis> 6.Python 项目的组织结构 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/7.Python%E4%BB%A3%E7%A0%81%E8%A7%84%E8%8C%83/ class=md-nav__link> <span class=md-ellipsis> 7.Python 代码规范 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/8.Python%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/ class=md-nav__link> <span class=md-ellipsis> 8.Python 基础知识 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/9.Python%E5%AD%97%E7%AC%A6%E4%B8%B2/ class=md-nav__link> <span class=md-ellipsis> 9.Python 字符串 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/10.Python%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/ class=md-nav__link> <span class=md-ellipsis> 10.Python 数据类型 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/11.Python%E8%BF%90%E7%AE%97%E7%AC%A6%E5%92%8C%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/ class=md-nav__link> <span class=md-ellipsis> 11.Python 运算符和流程控制 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/12.Python%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C/ class=md-nav__link> <span class=md-ellipsis> 12.Python 文件操作 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/13.Python%E5%87%BD%E6%95%B0/ class=md-nav__link> <span class=md-ellipsis> 13.Python 函数 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/14.Python%E5%B8%B8%E7%94%A8%E5%86%85%E5%BB%BA%E5%87%BD%E6%95%B0/ class=md-nav__link> <span class=md-ellipsis> 14.Python 常用内建函数 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/15.Python%E7%B1%BB/ class=md-nav__link> <span class=md-ellipsis> 15.Python 类 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/16.Python%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 16.Python 异常处理 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/17.Python%E6%A8%A1%E5%9D%97%E4%B8%8E%E5%8C%85/ class=md-nav__link> <span class=md-ellipsis> 17.Python 模块与包 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/18.Python%E6%A0%87%E5%87%86%E5%BA%93/ class=md-nav__link> <span class=md-ellipsis> 18.Python 标准库 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/19.Python%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 19.Python 正则表达式 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/20.Python%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BC%96%E7%A8%8B/ class=md-nav__link> <span class=md-ellipsis> 20.Python 数据库编程 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/21.Python%E6%89%B9%E9%87%8F%E7%AE%A1%E7%90%86%E4%B8%BB%E6%9C%BA/ class=md-nav__link> <span class=md-ellipsis> 21.Python 批量管理主机 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/22.Python%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%9A%E8%BF%9B%E7%A8%8B%E5%8D%8F%E7%A8%8B/ class=md-nav__link> <span class=md-ellipsis> 22.Python 多线程多进程协程 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/23.Python%E4%BB%A3%E7%A0%81%E8%B0%83%E8%AF%95/ class=md-nav__link> <span class=md-ellipsis> 23.Python 代码调试 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/24.Python%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/ class=md-nav__link> <span class=md-ellipsis> 24.Python 单元测试 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/25.%E7%8E%A9%E8%BD%ACDjango2.0/ class=md-nav__link> <span class=md-ellipsis> 25.玩转 Django2.0 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/%E9%99%84%E5%BD%950-%E5%86%85%E5%BB%BA%E6%A8%A1%E5%9D%97/ class=md-nav__link> <span class=md-ellipsis> 附录 0-内建模块 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/%E9%99%84%E5%BD%951-%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83/ class=md-nav__link> <span class=md-ellipsis> 附录 1-虚拟环境 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/%E9%99%84%E5%BD%952-%E6%89%93%E5%8C%85%E5%92%8C%E5%88%86%E5%8F%91/ class=md-nav__link> <span class=md-ellipsis> 附录 2-打包和分发 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/%E9%99%84%E5%BD%953-%E5%AE%89%E8%A3%85%E7%AC%AC%E4%B8%89%E6%96%B9%E8%BD%AF%E4%BB%B6%E5%8C%85/ class=md-nav__link> <span class=md-ellipsis> 附录 3-安装第三方软件包 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/%E9%99%84%E5%BD%954-%E5%B8%B8%E7%94%A8%E7%AC%AC%E4%B8%89%E6%96%B9%E6%A8%A1%E5%9D%97/ class=md-nav__link> <span class=md-ellipsis> 附录 4-常用第三方模块 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/%E9%99%84%E5%BD%955-Python%E9%9D%A2%E8%AF%95%E5%AE%9D%E5%85%B8/ class=md-nav__link> <span class=md-ellipsis> 附录 5-Python 面试宝典 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/%E9%99%84%E5%BD%956-%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2/ class=md-nav__link> <span class=md-ellipsis> 附录 6-项目部署 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/%E9%99%84%E5%BD%957-Python%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E6%88%98/ class=md-nav__link> <span class=md-ellipsis> 附录 7-Python 微服务实战 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/%E9%99%84%E5%BD%958-Python-rpm%E7%BC%96%E8%AF%91/ class=md-nav__link> <span class=md-ellipsis> 附录 8-Python-rpm 编译 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/1.Python%E5%9F%BA%E7%A1%80%E7%AF%87/%E9%99%84%E5%BD%959-IPython%E7%9A%84%E4%BD%BF%E7%94%A8/ class=md-nav__link> <span class=md-ellipsis> 附录 9-IPython 的使用 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_3> <label class=md-nav__link for=__nav_6_3 id=__nav_6_3_label tabindex=0> <span class=md-ellipsis> 2.Python运维开发 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_3_label aria-expanded=false> <label class=md-nav__title for=__nav_6_3> <span class="md-nav__icon md-icon"></span> 2.Python运维开发 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/1.%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/ class=md-nav__link> <span class=md-ellipsis> 1.命令行工具 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/2.%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 2.文本处理 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/3.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 3.Linux 系统管理 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/4.%E7%9B%91%E6%8E%A7Linux/ class=md-nav__link> <span class=md-ellipsis> 4.监控 Linux </span> </a> </li> <li class=md-nav__item> <a href=../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/5.%E6%96%87%E6%A1%A3%E4%B8%8E%E6%8A%A5%E5%91%8A/ class=md-nav__link> <span class=md-ellipsis> 5.文档与报告 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/6.%E7%BD%91%E7%BB%9C/ class=md-nav__link> <span class=md-ellipsis> 6.网络 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/7.%E8%87%AA%E5%8A%A8%E5%8C%96%E7%AE%A1%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 7.自动化管理 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/8.%E5%B8%B8%E7%94%A8%E6%A8%A1%E5%9D%97/ class=md-nav__link> <span class=md-ellipsis> 8.常用模块 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/9.Python%E6%89%93%E9%80%A0MySQL%E4%B8%93%E5%AE%B6%E7%B3%BB%E7%BB%9F/ class=md-nav__link> <span class=md-ellipsis> 9.Python 打造 MySQL 专家系统 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/10.%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%BC%80%E5%8F%91/ class=md-nav__link> <span class=md-ellipsis> 10.自动化运维系统的开发 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/11.%E5%8D%8E%E4%B8%BA%E4%BA%91Python%E6%BC%94%E7%A4%BA%E4%BB%A3%E7%A0%81/ class=md-nav__link> <span class=md-ellipsis> 11.华为云 Python 演示代码 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/12.%E5%8D%8E%E4%B8%BA%E4%BA%91Go%E6%BC%94%E7%A4%BA%E4%BB%A3%E7%A0%81/ class=md-nav__link> <span class=md-ellipsis> 12.华为云 Go 演示代码 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/13.Tornado%E6%A1%86%E6%9E%B6/ class=md-nav__link> <span class=md-ellipsis> 13.Tornado 框架 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/%E9%99%84-%E5%AD%A6%E4%B9%A0API%E7%9A%84demo/ class=md-nav__link> <span class=md-ellipsis> 附-学习 API 的 demo </span> </a> </li> <li class=md-nav__item> <a href=../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/%E9%99%84-%E8%BF%90%E7%BB%B4%E7%9B%B8%E5%85%B3%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE/ class=md-nav__link> <span class=md-ellipsis> 附-运维相关开源项目 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/%E9%99%84-awesome-python-cn/ class=md-nav__link> <span class=md-ellipsis> 附-awesome-python-cn </span> </a> </li> <li class=md-nav__item> <a href=../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/%E9%99%84-CMDB/ class=md-nav__link> <span class=md-ellipsis> 附-CMDB </span> </a> </li> <li class=md-nav__item> <a href=../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/%E9%99%84-Django-web%E5%BC%80%E5%8F%91/ class=md-nav__link> <span class=md-ellipsis> 附-Django-web 开发 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/%E9%99%84-Django%E5%AE%9E%E7%8E%B0%E7%9A%84%E7%AE%80%E6%98%93%E5%8F%91%E5%B8%83%E4%BC%9A%E7%AD%BE%E5%88%B0%E7%B3%BB%E7%BB%9F/ class=md-nav__link> <span class=md-ellipsis> 附-Django 实现的简易发布会签到系统 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/%E9%99%84-Kubernetes%E7%AE%A1%E7%90%86%E5%B9%B3%E5%8F%B0/ class=md-nav__link> <span class=md-ellipsis> 附-Kubernetes 管理平台 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/2.Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/%E9%99%84-varnish%E7%AE%A1%E7%90%86%E5%B9%B3%E5%8F%B0/ class=md-nav__link> <span class=md-ellipsis> 附-varnish 管理平台 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_4> <label class=md-nav__link for=__nav_6_4 id=__nav_6_4_label tabindex=0> <span class=md-ellipsis> 3.Python测试开发 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_4_label aria-expanded=false> <label class=md-nav__title for=__nav_6_4> <span class="md-nav__icon md-icon"></span> 3.Python测试开发 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/1.Python2%E4%B8%8EPython3%E5%8C%BA%E5%88%AB/ class=md-nav__link> <span class=md-ellipsis> 1.Python2 与 Python3 区别 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/2.Windows%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85Python/ class=md-nav__link> <span class=md-ellipsis> 2.Windows环境安装Python </span> </a> </li> <li class=md-nav__item> <a href=../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/3.Linux%E5%A4%9A%E7%89%88%E6%9C%ACPython%E5%AE%89%E8%A3%85/ class=md-nav__link> <span class=md-ellipsis> 3.Linux多版本Python安装 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/4.Python%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85/ class=md-nav__link> <span class=md-ellipsis> 4.Python虚拟环境安装 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/5.Pycharm%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8/ class=md-nav__link> <span class=md-ellipsis> 5.Pycharm安装与使用 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/6.Python%E9%97%B4%E6%8E%A5%E5%AE%9A%E4%B9%89%E5%B8%B8%E9%87%8F/ class=md-nav__link> <span class=md-ellipsis> 6.Python间接定义常量 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/7.Python%E8%BF%90%E7%AE%97%E7%AC%A6%E4%B8%8E%E8%A1%A8%E8%BE%BE%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 7.Python运算符与表达式 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/8.%E9%80%BB%E8%BE%91%E6%8E%A7%E5%88%B6%E8%AF%AD%E5%8F%A5/ class=md-nav__link> <span class=md-ellipsis> 8.逻辑控制语句 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/9.%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%BB%8B%E7%BB%8D/ class=md-nav__link> <span class=md-ellipsis> 9.数据结构 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/10.%E5%87%BD%E6%95%B0%E4%BB%8B%E7%BB%8D/ class=md-nav__link> <span class=md-ellipsis> 10.函数介绍 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/11.%E7%B1%BB%E4%B8%8E%E5%AF%B9%E8%B1%A1/ class=md-nav__link> <span class=md-ellipsis> 11.类与对象 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/12.%E6%89%93%E5%8C%85%E4%B8%8E%E5%8F%91%E5%B8%83/ class=md-nav__link> <span class=md-ellipsis> 12.打包与发布 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/13.%E5%BC%82%E5%B8%B8%E6%8D%95%E8%8E%B7%E4%B8%8E%E5%A4%84%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 13.异常捕获与处理 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/14.%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/ class=md-nav__link> <span class=md-ellipsis> 14.并发编程 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/15.%E6%A0%87%E5%87%86%E5%BA%93%E5%92%8C%E4%B8%89%E6%96%B9%E5%BA%93/ class=md-nav__link> <span class=md-ellipsis> 15.标准库和三方库 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/16.vue-cli%E8%84%9A%E6%89%8B%E6%9E%B6/ class=md-nav__link> <span class=md-ellipsis> 16.vue-cli脚手架 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/17.%E6%A1%88%E4%BE%8B%E5%AE%9E%E8%B7%B5-%E4%BB%BB%E5%8A%A1%E5%88%97%E8%A1%A8/ class=md-nav__link> <span class=md-ellipsis> 17.案例实践-任务列表 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/%E9%99%84%E5%BD%95-%E5%89%8D%E5%90%8E%E7%AB%AF%E4%BB%A3%E7%A0%81%E4%BB%93%E5%BA%93%E6%B1%87%E6%80%BB/ class=md-nav__link> <span class=md-ellipsis> 附录-前后端代码仓库汇总 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/3.Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/%E9%99%84%E5%BD%95-Nginx%E5%AE%8C%E6%95%B4%E9%85%8D%E7%BD%AE%E6%A0%B7%E4%BE%8B/ class=md-nav__link> <span class=md-ellipsis> 附录-Nginx 完整配置样例 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_5> <label class=md-nav__link for=__nav_6_5 id=__nav_6_5_label tabindex=0> <span class=md-ellipsis> 4.Flask学习 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_5_label aria-expanded=false> <label class=md-nav__title for=__nav_6_5> <span class="md-nav__icon md-icon"></span> 4.Flask学习 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Python/4.Flask%E5%AD%A6%E4%B9%A0/1.Flask%E5%89%8D%E5%A5%8F/ class=md-nav__link> <span class=md-ellipsis> 1.Flask 前缀 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/4.Flask%E5%AD%A6%E4%B9%A0/2.%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AE/ class=md-nav__link> <span class=md-ellipsis> 2.项目配置 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/4.Flask%E5%AD%A6%E4%B9%A0/3.URL%E4%B8%8E%E8%A7%86%E5%9B%BE/ class=md-nav__link> <span class=md-ellipsis> 3.URL与视图 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/4.Flask%E5%AD%A6%E4%B9%A0/4.Jinja2%E6%A8%A1%E6%9D%BF/ class=md-nav__link> <span class=md-ellipsis> 4.Jinja2模板 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/4.Flask%E5%AD%A6%E4%B9%A0/5.%E6%95%B0%E6%8D%AE%E5%BA%93/ class=md-nav__link> <span class=md-ellipsis> 5.数据库 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/4.Flask%E5%AD%A6%E4%B9%A0/6.%E8%A1%A8%E5%8D%95/ class=md-nav__link> <span class=md-ellipsis> 6.表单 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/4.Flask%E5%AD%A6%E4%B9%A0/7.Flask%E8%BF%9B%E9%98%B6/ class=md-nav__link> <span class=md-ellipsis> 7.Flask 进阶 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/4.Flask%E5%AD%A6%E4%B9%A0/8.%E7%BC%93%E5%AD%98%E7%B3%BB%E7%BB%9F/ class=md-nav__link> <span class=md-ellipsis> 8.缓存系统 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/4.Flask%E5%AD%A6%E4%B9%A0/9.Flask_Restful/ class=md-nav__link> <span class=md-ellipsis> 9.Flask_Restful </span> </a> </li> <li class=md-nav__item> <a href=../../Python/4.Flask%E5%AD%A6%E4%B9%A0/10.Flask%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/ class=md-nav__link> <span class=md-ellipsis> 10.Flask 项目实战 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/4.Flask%E5%AD%A6%E4%B9%A0/11.WebSock%E5%AE%9E%E6%88%98/ class=md-nav__link> <span class=md-ellipsis> 11.WebSock 实战 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/4.Flask%E5%AD%A6%E4%B9%A0/12.Flask%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B/ class=md-nav__link> <span class=md-ellipsis> 12.Flask 异步编程 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/4.Flask%E5%AD%A6%E4%B9%A0/%E9%99%84-%E4%BD%BF%E7%94%A8Pytest%E6%B5%8B%E8%AF%95Flask/ class=md-nav__link> <span class=md-ellipsis> 附-使用 Pytest 测试 Flask </span> </a> </li> <li class=md-nav__item> <a href=../../Python/4.Flask%E5%AD%A6%E4%B9%A0/%E9%99%84-%E5%9B%BE%E4%B9%A6%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/ class=md-nav__link> <span class=md-ellipsis> 附-图书管理系统 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/4.Flask%E5%AD%A6%E4%B9%A0/%E9%99%84-%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0-flask/ class=md-nav__link> <span class=md-ellipsis> 附-自动化测试平台-flask </span> </a> </li> <li class=md-nav__item> <a href=../../Python/4.Flask%E5%AD%A6%E4%B9%A0/%E9%99%84-Flask%E5%B8%B8%E7%94%A8%E6%89%A9%E5%B1%95/ class=md-nav__link> <span class=md-ellipsis> 附-Flask常用扩展 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/4.Flask%E5%AD%A6%E4%B9%A0/%E9%99%84-Flask%E5%92%8CRedis%E9%98%9F%E5%88%97%E7%9A%84%E5%BC%82%E6%AD%A5%E4%BB%BB%E5%8A%A1/ class=md-nav__link> <span class=md-ellipsis> 附-Flask和Redis队列的异步任务 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/4.Flask%E5%AD%A6%E4%B9%A0/%E9%99%84-Flask%E5%92%8CVue.js%E5%BC%80%E5%8F%91%E5%8D%95%E9%A1%B5%E5%BA%94%E7%94%A8/ class=md-nav__link> <span class=md-ellipsis> 附-Flask 和 Vue.js 开发单页应用 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/4.Flask%E5%AD%A6%E4%B9%A0/%E9%99%84-flask%E8%84%9A%E6%89%8B%E6%9E%B6/ class=md-nav__link> <span class=md-ellipsis> 附-flask 脚手架 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/4.Flask%E5%AD%A6%E4%B9%A0/%E9%99%84-Flask%E6%A1%86%E6%9E%B6/ class=md-nav__link> <span class=md-ellipsis> 附-Flask 框架 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/4.Flask%E5%AD%A6%E4%B9%A0/%E9%99%84-Flask%E5%AE%B9%E5%99%A8%E5%8C%96%E9%83%A8%E7%BD%B2/ class=md-nav__link> <span class=md-ellipsis> 附-Flask 容器化部署 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/4.Flask%E5%AD%A6%E4%B9%A0/%E9%99%84-Flask%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B/ class=md-nav__link> <span class=md-ellipsis> 附-Flask数据模型 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/4.Flask%E5%AD%A6%E4%B9%A0/%E9%99%84-Flask%E8%87%AA%E5%AE%9A%E4%B9%89exporter%E5%BC%80%E5%8F%91/ class=md-nav__link> <span class=md-ellipsis> 附-Flask 自定义 exporter 开发 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_6> <label class=md-nav__link for=__nav_6_6 id=__nav_6_6_label tabindex=0> <span class=md-ellipsis> 5.DevOps和自动化运维实践 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6_6> <span class="md-nav__icon md-icon"></span> 5.DevOps和自动化运维实践 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Python/5.DevOps%E5%92%8C%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%AE%9E%E8%B7%B5/1.Devops%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E7%9A%84%E6%84%8F%E4%B9%89/ class=md-nav__link> <span class=md-ellipsis> 1.Devops 与自动化运维的意义 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/5.DevOps%E5%92%8C%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%AE%9E%E8%B7%B5/2.Shell%E8%84%9A%E6%9C%AC%E5%9C%A8Devops%E4%B8%8B%E7%9A%84%E5%BA%94%E7%94%A8/ class=md-nav__link> <span class=md-ellipsis> 2.Shell 脚本在 Devops 下的应用 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/5.DevOps%E5%92%8C%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%AE%9E%E8%B7%B5/3.%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E4%B8%8B%E7%9A%84Shell%E8%84%9A%E6%9C%AC/ class=md-nav__link> <span class=md-ellipsis> 3.生产环境下的 Shell 脚本 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/5.DevOps%E5%92%8C%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%AE%9E%E8%B7%B5/4.%E5%B7%A5%E4%BD%9C%E4%B8%AD%E7%9A%84Python%E8%84%9A%E6%9C%AC%E5%88%86%E4%BA%AB/ class=md-nav__link> <span class=md-ellipsis> 4.工作中的 Python 脚本分享 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/5.DevOps%E5%92%8C%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%AE%9E%E8%B7%B5/5.Python%E5%BC%80%E5%8F%91%E4%BA%BA%E5%91%98%E7%9A%84Docker%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/ class=md-nav__link> <span class=md-ellipsis> 5.Python 开发人员的 Docker 最佳实践 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_7> <label class=md-nav__link for=__nav_6_7 id=__nav_6_7_label tabindex=0> <span class=md-ellipsis> 6.CMDB项目实战 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_7_label aria-expanded=false> <label class=md-nav__title for=__nav_6_7> <span class="md-nav__icon md-icon"></span> 6.CMDB项目实战 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Python/6.CMDB%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/0.DRF%E5%89%8D%E5%A5%8F/ class=md-nav__link> <span class=md-ellipsis> 0.DRF 前奏 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/6.CMDB%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/1.DRF%E5%85%A5%E9%97%A8/ class=md-nav__link> <span class=md-ellipsis> 1.DRF 入门 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/6.CMDB%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/2.DRF%E8%BF%9B%E9%98%B6/ class=md-nav__link> <span class=md-ellipsis> 2.DRF 进阶 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/6.CMDB%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/3.CMDB%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/ class=md-nav__link> <span class=md-ellipsis> 3.CMDB 后端开发 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/6.CMDB%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/4.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91-%E4%B8%8A/ class=md-nav__link> <span class=md-ellipsis> 4.Vue前端开发-上 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/6.CMDB%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/5.Vue%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91-%E4%B8%8B/ class=md-nav__link> <span class=md-ellipsis> 5.Vue前端开发-下 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/6.CMDB%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/6.Element-Plus%E5%89%8D%E7%AB%AF%E7%BB%84%E4%BB%B6%E5%BA%93/ class=md-nav__link> <span class=md-ellipsis> 6.Element-Plus前端组件库 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/6.CMDB%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/7.CMDB%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91-%E4%B8%8A/ class=md-nav__link> <span class=md-ellipsis> 7.CMDB前端开发-上 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/6.CMDB%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/8.CMDB%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91-%E4%B8%8B/ class=md-nav__link> <span class=md-ellipsis> 8.CMDB前端开发-下 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/6.CMDB%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/9.celery%E7%BB%84%E4%BB%B6/ class=md-nav__link> <span class=md-ellipsis> 9.celery 组件 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/6.CMDB%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/10.Django%E8%87%AA%E5%AE%9A%E4%B9%89%E5%91%BD%E4%BB%A4/ class=md-nav__link> <span class=md-ellipsis> 10.Django 自定义命令 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/6.CMDB%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/11.Django%E5%AE%B9%E5%99%A8%E5%8C%96%E9%83%A8%E7%BD%B2/ class=md-nav__link> <span class=md-ellipsis> 11.Django 容器化部署 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_8> <label class=md-nav__link for=__nav_6_8 id=__nav_6_8_label tabindex=0> <span class=md-ellipsis> 7.Python网络编程攻略 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_8_label aria-expanded=false> <label class=md-nav__title for=__nav_6_8> <span class="md-nav__icon md-icon"></span> 7.Python网络编程攻略 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Python/7.Python%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E6%94%BB%E7%95%A5/1.IPv4%E5%92%8C%E7%AE%80%E5%8D%95%E7%9A%84%E5%AE%A2%E6%88%B7%E7%AB%AF-%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B/ class=md-nav__link> <span class=md-ellipsis> 1.IPv4 和简单的客户端-服务器编程 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/7.Python%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E6%94%BB%E7%95%A5/2.%E4%BD%BF%E7%94%A8%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8%E5%A5%97%E6%8E%A5%E5%AD%97-IO%E6%8F%90%E5%8D%87%E6%80%A7%E8%83%BD/ class=md-nav__link> <span class=md-ellipsis> 2.使用多路复用套接字-IO 提升性能 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/7.Python%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E6%94%BB%E7%95%A5/3.IPv6-Unix%E5%9F%9F%E5%A5%97%E6%8E%A5%E5%AD%97%E5%92%8C%E7%BD%91%E7%BB%9C%E6%8E%A5%E5%8F%A3/ class=md-nav__link> <span class=md-ellipsis> 3.IPv6-Unix 域套接字和网络接口 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/7.Python%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E6%94%BB%E7%95%A5/4.HTTP%E5%8D%8F%E8%AE%AE%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/ class=md-nav__link> <span class=md-ellipsis> 4.HTTP 协议网络编程 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_9> <label class=md-nav__link for=__nav_6_9 id=__nav_6_9_label tabindex=0> <span class=md-ellipsis> 8.Python自动化运维实战 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_9_label aria-expanded=false> <label class=md-nav__title for=__nav_6_9> <span class="md-nav__icon md-icon"></span> 8.Python自动化运维实战 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Python/8.Python%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%AE%9E%E6%88%98/1.%E6%90%AD%E5%BB%BAPython%E7%8E%AF%E5%A2%83/ class=md-nav__link> <span class=md-ellipsis> 1.搭建 Python 环境 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/8.Python%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%AE%9E%E6%88%98/2.%E5%B8%B8%E7%94%A8%E7%9A%84%E8%87%AA%E5%8A%A8%E5%8C%96%E5%BA%93/ class=md-nav__link> <span class=md-ellipsis> 2.常用的自动化库 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/8.Python%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%AE%9E%E6%88%98/3.%E6%90%AD%E5%BB%BA%E7%BD%91%E7%BB%9C%E5%AE%9E%E9%AA%8C%E5%AE%A4%E7%8E%AF%E5%A2%83/ class=md-nav__link> <span class=md-ellipsis> 3.搭建网络实验室环境 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/8.Python%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%AE%9E%E6%88%98/4.%E4%BD%BF%E7%94%A8Python%E7%AE%A1%E7%90%86%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87/ class=md-nav__link> <span class=md-ellipsis> 4.使用 Python 管理网络设备 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/8.Python%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%AE%9E%E6%88%98/5.%E4%BB%8E%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87%E4%B8%AD%E6%8F%90%E5%8F%96%E6%95%B0%E6%8D%AE/ class=md-nav__link> <span class=md-ellipsis> 5.从网络设备中提取数据 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/8.Python%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%AE%9E%E6%88%98/6.Python%E5%92%8CJinja2%E9%85%8D%E7%BD%AE%E7%94%9F%E6%88%90%E5%99%A8/ class=md-nav__link> <span class=md-ellipsis> 6.Python和Jinja2配置生成器 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/8.Python%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%AE%9E%E6%88%98/7.%E5%B9%B6%E8%A1%8C%E6%89%A7%E8%A1%8CPython%E8%84%9A%E6%9C%AC/ class=md-nav__link> <span class=md-ellipsis> 7.并行执行 Python 脚本 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/8.Python%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%AE%9E%E6%88%98/8.%E5%87%86%E5%A4%87%E5%AE%9E%E9%AA%8C%E5%AE%A4%E7%8E%AF%E5%A2%83/ class=md-nav__link> <span class=md-ellipsis> 8.准备实验室环境 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/8.Python%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%AE%9E%E6%88%98/9.%E4%BD%BF%E7%94%A8Subprocess%E6%A8%A1%E5%9D%97/ class=md-nav__link> <span class=md-ellipsis> 9.使用 Subprocess 模块 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/8.Python%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%AE%9E%E6%88%98/10.%E4%BD%BF%E7%94%A8Fabric%E7%AE%A1%E7%90%86%E4%BB%BB%E5%8A%A1/ class=md-nav__link> <span class=md-ellipsis> 10.使用 Fabric 管理任务 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/8.Python%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%AE%9E%E6%88%98/11.%E7%94%9F%E6%88%90%E7%B3%BB%E7%BB%9F%E6%8A%A5%E5%91%8A%E5%92%8C%E7%B3%BB%E7%BB%9F%E7%9B%91%E6%8E%A7/ class=md-nav__link> <span class=md-ellipsis> 11.生成系统报告和系统监控 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/8.Python%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%AE%9E%E6%88%98/12.%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%A4%E4%BA%92/ class=md-nav__link> <span class=md-ellipsis> 12.与数据库交互 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/8.Python%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%AE%9E%E6%88%98/13.%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86%E7%9A%84Ansible/ class=md-nav__link> <span class=md-ellipsis> 13.系统管理的 Ansible </span> </a> </li> <li class=md-nav__item> <a href=../../Python/8.Python%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%AE%9E%E6%88%98/14.%E4%B8%8EOpenStack-API%E4%BA%A4%E4%BA%92/ class=md-nav__link> <span class=md-ellipsis> 14.与 OpenStack-API 交互 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_10> <label class=md-nav__link for=__nav_6_10 id=__nav_6_10_label tabindex=0> <span class=md-ellipsis> 9.源码解读 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_10_label aria-expanded=false> <label class=md-nav__title for=__nav_6_10> <span class="md-nav__icon md-icon"></span> 9.源码解读 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Python/9.%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/1.envoy%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/ class=md-nav__link> <span class=md-ellipsis> 1.envoy 源码分析 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/9.%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/2.pssh%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/ class=md-nav__link> <span class=md-ellipsis> 2.pssh 源码分析 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/9.%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/%E9%99%84%E5%BD%951-Ansible%E6%A0%B8%E5%BF%83%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90-1/ class=md-nav__link> <span class=md-ellipsis> 附录 1-Ansible 核心源码剖析-1 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/9.%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/%E9%99%84%E5%BD%952-Ansible-1.1%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/ class=md-nav__link> <span class=md-ellipsis> 附录 2-Ansible 1.1 的基本使用 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_11> <label class=md-nav__link for=__nav_6_11 id=__nav_6_11_label tabindex=0> <span class=md-ellipsis> 10.Python进阶 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_11_label aria-expanded=false> <label class=md-nav__title for=__nav_6_11> <span class="md-nav__icon md-icon"></span> 10.Python进阶 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Python/10.Python%E8%BF%9B%E9%98%B6/1.%E7%90%86%E8%A7%A3%E4%B8%8E%E4%BD%BF%E7%94%A8%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 1.理解与使用单例模式 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/10.Python%E8%BF%9B%E9%98%B6/2.argparse%E8%A7%A3%E6%9E%90%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%8F%82%E6%95%B0/ class=md-nav__link> <span class=md-ellipsis> 2.argparse 解析命令行参数 </span> </a> </li> <li class=md-nav__item> <a href=../../Python/10.Python%E8%BF%9B%E9%98%B6/3.utils-%E5%BC%BA%E5%A4%A7%E7%9A%84%E5%B7%A5%E5%85%B7%E7%AE%B1/ class=md-nav__link> <span class=md-ellipsis> 3.utils-强大的工具箱 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex=0> <span class=md-ellipsis> Openstack </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Openstack </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_1> <label class=md-nav__link for=__nav_7_1 id=__nav_7_1_label tabindex=0> <span class=md-ellipsis> 0.学习线路 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_1_label aria-expanded=false> <label class=md-nav__title for=__nav_7_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Openstack/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.OpenStack/ class=md-nav__link> <span class=md-ellipsis> 基于 OpenStack 组件开发 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_2> <label class=md-nav__link for=__nav_7_2 id=__nav_7_2_label tabindex=0> <span class=md-ellipsis> 1.OpenStack工程师工作 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_2_label aria-expanded=false> <label class=md-nav__title for=__nav_7_2> <span class="md-nav__icon md-icon"></span> 1.OpenStack工程师工作 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Openstack/1.OpenStack%E5%B7%A5%E7%A8%8B%E5%B8%88%E5%B7%A5%E4%BD%9C/1.Horizon%E7%95%8C%E9%9D%A2%E5%B7%A5%E7%A8%8B%E5%B8%88/ class=md-nav__link> <span class=md-ellipsis> 1.Horizon 界面工程师 </span> </a> </li> <li class=md-nav__item> <a href=../../Openstack/1.OpenStack%E5%B7%A5%E7%A8%8B%E5%B8%88%E5%B7%A5%E4%BD%9C/2.Neutron%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E5%B8%88/ class=md-nav__link> <span class=md-ellipsis> 2.Neutron 网络工程师 </span> </a> </li> <li class=md-nav__item> <a href=../../Openstack/1.OpenStack%E5%B7%A5%E7%A8%8B%E5%B8%88%E5%B7%A5%E4%BD%9C/3.Nova%E8%B5%84%E6%B7%B1%E5%B7%A5%E7%A8%8B%E5%B8%88/ class=md-nav__link> <span class=md-ellipsis> 3.Nova 资深工程师 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_3> <label class=md-nav__link for=__nav_7_3 id=__nav_7_3_label tabindex=0> <span class=md-ellipsis> 2.开发环境的搭建 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_3_label aria-expanded=false> <label class=md-nav__title for=__nav_7_3> <span class="md-nav__icon md-icon"></span> 2.开发环境的搭建 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Openstack/2.%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/1.Windows%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/ class=md-nav__link> <span class=md-ellipsis> 1.Windows 开发环境的搭建 </span> </a> </li> <li class=md-nav__item> <a href=../../Openstack/2.%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/2.Linux%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/ class=md-nav__link> <span class=md-ellipsis> 2.Linux 开发环境的搭建 </span> </a> </li> <li class=md-nav__item> <a href=../../Openstack/2.%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/3.Launchpad%E8%B4%A6%E5%8F%B7/ class=md-nav__link> <span class=md-ellipsis> 3.Launchpad 账号 </span> </a> </li> <li class=md-nav__item> <a href=../../Openstack/2.%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/4.Git%E7%9A%84%E4%BD%BF%E7%94%A8/ class=md-nav__link> <span class=md-ellipsis> 4.Git 的使用 </span> </a> </li> <li class=md-nav__item> <a href=../../Openstack/2.%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/5.%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%BF%AE%E6%94%B9/ class=md-nav__link> <span class=md-ellipsis> 5.配置文件修改 </span> </a> </li> <li class=md-nav__item> <a href=../../Openstack/2.%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/6.RPM%E8%BD%AF%E4%BB%B6%E5%8C%85%E7%AE%A1%E7%90%86%E5%99%A8/ class=md-nav__link> <span class=md-ellipsis> 6.RPM软件包管理器 </span> </a> </li> <li class=md-nav__item> <a href=../../Openstack/2.%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/7.%E5%88%B6%E4%BD%9Cdeb%E5%8C%85/ class=md-nav__link> <span class=md-ellipsis> 7.制作deb包 </span> </a> </li> <li class=md-nav__item> <a href=../../Openstack/2.%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/8.Linux%E8%87%AA%E5%BB%BA%E8%BD%AF%E4%BB%B6%E6%BA%90/ class=md-nav__link> <span class=md-ellipsis> 8.Linux自建软件源 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_4> <label class=md-nav__link for=__nav_7_4 id=__nav_7_4_label tabindex=0> <span class=md-ellipsis> 3.Openstack通用技术 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_4_label aria-expanded=false> <label class=md-nav__title for=__nav_7_4> <span class="md-nav__icon md-icon"></span> 3.Openstack通用技术 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Openstack/3.Openstack%E9%80%9A%E7%94%A8%E6%8A%80%E6%9C%AF/1.%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%E6%89%93%E5%8C%85/ class=md-nav__link> <span class=md-ellipsis> 1.持续集成打包 </span> </a> </li> <li class=md-nav__item> <a href=../../Openstack/3.Openstack%E9%80%9A%E7%94%A8%E6%8A%80%E6%9C%AF/2.SQLAlchemy/ class=md-nav__link> <span class=md-ellipsis> 2.SQLAlchemy </span> </a> </li> <li class=md-nav__item> <a href=../../Openstack/3.Openstack%E9%80%9A%E7%94%A8%E6%8A%80%E6%9C%AF/3.logging/ class=md-nav__link> <span class=md-ellipsis> 3.logging </span> </a> </li> <li class=md-nav__item> <a href=../../Openstack/3.Openstack%E9%80%9A%E7%94%A8%E6%8A%80%E6%9C%AF/4.cliff/ class=md-nav__link> <span class=md-ellipsis> 4.cliff </span> </a> </li> <li class=md-nav__item> <a href=../../Openstack/3.Openstack%E9%80%9A%E7%94%A8%E6%8A%80%E6%9C%AF/5.Eventlet/ class=md-nav__link> <span class=md-ellipsis> 5.Eventlet </span> </a> </li> <li class=md-nav__item> <a href=../../Openstack/3.Openstack%E9%80%9A%E7%94%A8%E6%8A%80%E6%9C%AF/6.WSGI/ class=md-nav__link> <span class=md-ellipsis> 6.WSGI </span> </a> </li> <li class=md-nav__item> <a href=../../Openstack/3.Openstack%E9%80%9A%E7%94%A8%E6%8A%80%E6%9C%AF/7.Oslo/ class=md-nav__link> <span class=md-ellipsis> 7.Oslo </span> </a> </li> <li class=md-nav__item> <a href=../../Openstack/3.Openstack%E9%80%9A%E7%94%A8%E6%8A%80%E6%9C%AF/8.oslo-config/ class=md-nav__link> <span class=md-ellipsis> 8.oslo.config </span> </a> </li> <li class=md-nav__item> <a href=../../Openstack/3.Openstack%E9%80%9A%E7%94%A8%E6%8A%80%E6%9C%AF/9.oslo-db/ class=md-nav__link> <span class=md-ellipsis> 9.oslo.db </span> </a> </li> <li class=md-nav__item> <a href=../../Openstack/3.Openstack%E9%80%9A%E7%94%A8%E6%8A%80%E6%9C%AF/10.oslo-log/ class=md-nav__link> <span class=md-ellipsis> 10.oslo.log </span> </a> </li> <li class=md-nav__item> <a href=../../Openstack/3.Openstack%E9%80%9A%E7%94%A8%E6%8A%80%E6%9C%AF/11.oslo-i18n/ class=md-nav__link> <span class=md-ellipsis> 11.oslo.i18n </span> </a> </li> <li class=md-nav__item> <a href=../../Openstack/3.Openstack%E9%80%9A%E7%94%A8%E6%8A%80%E6%9C%AF/12.oslo-utils/ class=md-nav__link> <span class=md-ellipsis> 12.oslo.utils </span> </a> </li> <li class=md-nav__item> <a href=../../Openstack/3.Openstack%E9%80%9A%E7%94%A8%E6%8A%80%E6%9C%AF/13.oslo-messaging/ class=md-nav__link> <span class=md-ellipsis> 13.oslo.messaging </span> </a> </li> <li class=md-nav__item> <a href=../../Openstack/3.Openstack%E9%80%9A%E7%94%A8%E6%8A%80%E6%9C%AF/14.oslo-service/ class=md-nav__link> <span class=md-ellipsis> 14.oslo.service </span> </a> </li> <li class=md-nav__item> <a href=../../Openstack/3.Openstack%E9%80%9A%E7%94%A8%E6%8A%80%E6%9C%AF/15.cookiecutter/ class=md-nav__link> <span class=md-ellipsis> 15.cookiecutter </span> </a> </li> <li class=md-nav__item> <a href=../../Openstack/3.Openstack%E9%80%9A%E7%94%A8%E6%8A%80%E6%9C%AF/16.stevedore/ class=md-nav__link> <span class=md-ellipsis> 16.stevedore </span> </a> </li> <li class=md-nav__item> <a href=../../Openstack/3.Openstack%E9%80%9A%E7%94%A8%E6%8A%80%E6%9C%AF/%E9%99%84-%E7%BC%96%E8%AF%91-%E6%89%93%E5%8C%85%E6%80%BB%E7%BB%93/ class=md-nav__link> <span class=md-ellipsis> 附-编译-打包总结 </span> </a> </li> <li class=md-nav__item> <a href=../../Openstack/3.Openstack%E9%80%9A%E7%94%A8%E6%8A%80%E6%9C%AF/%E9%99%84-%E6%A8%A1%E4%BB%BFOpenStack%E5%86%99%E8%87%AA%E5%B7%B1%E7%9A%84RPC/ class=md-nav__link> <span class=md-ellipsis> 附-模仿 OpenStack 写自己的 RPC </span> </a> </li> <li class=md-nav__item> <a href=../../Openstack/3.Openstack%E9%80%9A%E7%94%A8%E6%8A%80%E6%9C%AF/%E9%99%84-%E6%A8%A1%E4%BB%BFOpenstack%E5%86%99Restful-API/ class=md-nav__link> <span class=md-ellipsis> 附-模仿 Openstack 写 Restful API </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_5> <label class=md-nav__link for=__nav_7_5 id=__nav_7_5_label tabindex=0> <span class=md-ellipsis> 4.OpenStack容器手册 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_5_label aria-expanded=false> <label class=md-nav__title for=__nav_7_5> <span class="md-nav__icon md-icon"></span> 4.OpenStack容器手册 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Openstack/4.OpenStack%E5%AE%B9%E5%99%A8%E6%89%8B%E5%86%8C/1.OpenStack-Kolla%E9%A1%B9%E7%9B%AE/ class=md-nav__link> <span class=md-ellipsis> 1.OpenStack-Kolla项目 </span> </a> </li> <li class=md-nav__item> <a href=../../Openstack/4.OpenStack%E5%AE%B9%E5%99%A8%E6%89%8B%E5%86%8C/2.kolla%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/ class=md-nav__link> <span class=md-ellipsis> 2.kolla 源码阅读 </span> </a> </li> <li class=md-nav__item> <a href=../../Openstack/4.OpenStack%E5%AE%B9%E5%99%A8%E6%89%8B%E5%86%8C/3.kolla-ansible%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/ class=md-nav__link> <span class=md-ellipsis> 3.kolla-ansible 源码阅读 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8> <label class=md-nav__link for=__nav_8 id=__nav_8_label tabindex=0> <span class=md-ellipsis> Python-vs-Go </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_8_label aria-expanded=false> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> Python-vs-Go </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8_1> <label class=md-nav__link for=__nav_8_1 id=__nav_8_1_label tabindex=0> <span class=md-ellipsis> 0.学习线路 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_8_1_label aria-expanded=false> <label class=md-nav__title for=__nav_8_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Python-vs-Go/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Python-vs-Go/ class=md-nav__link> <span class=md-ellipsis> Python-vs-Go </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8_2> <label class=md-nav__link for=__nav_8_2 id=__nav_8_2_label tabindex=0> <span class=md-ellipsis> 1.对比 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_8_2_label aria-expanded=false> <label class=md-nav__title for=__nav_8_2> <span class="md-nav__icon md-icon"></span> 1.对比 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/1.Hello-World/ class=md-nav__link> <span class=md-ellipsis> Hello-World </span> </a> </li> <li class=md-nav__item> <a href=../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/2.Print/ class=md-nav__link> <span class=md-ellipsis> Print </span> </a> </li> <li class=md-nav__item> <a href=../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/3.%E6%B3%A8%E9%87%8A/ class=md-nav__link> <span class=md-ellipsis> 注释 </span> </a> </li> <li class=md-nav__item> <a href=../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/4.%E5%A4%9A%E8%A1%8C%E5%AD%97%E7%AC%A6%E4%B8%B2/ class=md-nav__link> <span class=md-ellipsis> 多行字符串 </span> </a> </li> <li class=md-nav__item> <a href=../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/5.Lists/ class=md-nav__link> <span class=md-ellipsis> Lists </span> </a> </li> <li class=md-nav__item> <a href=../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/6.Map/ class=md-nav__link> <span class=md-ellipsis> Map </span> </a> </li> <li class=md-nav__item> <a href=../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/7.Booleans/ class=md-nav__link> <span class=md-ellipsis> Booleans </span> </a> </li> <li class=md-nav__item> <a href=../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/8.Forloop/ class=md-nav__link> <span class=md-ellipsis> Forloop </span> </a> </li> <li class=md-nav__item> <a href=../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/9.Range/ class=md-nav__link> <span class=md-ellipsis> Range </span> </a> </li> <li class=md-nav__item> <a href=../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/10.Switch/ class=md-nav__link> <span class=md-ellipsis> Switch </span> </a> </li> <li class=md-nav__item> <a href=../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/11.%E5%8F%AF%E5%8F%98%E5%8F%82%E6%95%B0%E5%87%BD%E6%95%B0/ class=md-nav__link> <span class=md-ellipsis> 可变参数函数 </span> </a> </li> <li class=md-nav__item> <a href=../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/12.%E6%97%B6%E9%97%B4%E8%AE%A1%E7%AE%97/ class=md-nav__link> <span class=md-ellipsis> 时间计算 </span> </a> </li> <li class=md-nav__item> <a href=../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/13.%E5%87%BD%E6%95%B0%E7%9A%84%E9%97%AD%E5%8C%85/ class=md-nav__link> <span class=md-ellipsis> 函数的闭包 </span> </a> </li> <li class=md-nav__item> <a href=../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/14.%E9%80%80%E5%87%BA%E5%A4%84%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 退出处理 </span> </a> </li> <li class=md-nav__item> <a href=../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/15.%E5%BC%82%E5%B8%B8%E6%8D%95%E8%8E%B7/ class=md-nav__link> <span class=md-ellipsis> 异常捕获 </span> </a> </li> <li class=md-nav__item> <a href=../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/16.%E5%8F%AF%E5%8F%98%E9%A1%B9/ class=md-nav__link> <span class=md-ellipsis> 可变项 </span> </a> </li> <li class=md-nav__item> <a href=../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/17.%E7%B1%BB/ class=md-nav__link> <span class=md-ellipsis> 类 </span> </a> </li> <li class=md-nav__item> <a href=../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/18.%E6%96%B9%E6%B3%95/ class=md-nav__link> <span class=md-ellipsis> 方法 </span> </a> </li> <li class=md-nav__item> <a href=../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/19.%E5%B9%B6%E5%8F%91/ class=md-nav__link> <span class=md-ellipsis> 并发 </span> </a> </li> <li class=md-nav__item> <a href=../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/20.Args/ class=md-nav__link> <span class=md-ellipsis> Args </span> </a> </li> <li class=md-nav__item> <a href=../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/21.%E5%AF%BC%E5%85%A5%E6%A8%A1%E5%9D%97%E5%88%AB%E5%90%8D/ class=md-nav__link> <span class=md-ellipsis> 导入模块别名 </span> </a> </li> <li class=md-nav__item> <a href=../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/22.%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%A0%BC%E5%BC%8F%E5%8C%96/ class=md-nav__link> <span class=md-ellipsis> 字符串格式化 </span> </a> </li> <li class=md-nav__item> <a href=../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/23.%E5%8E%BB%E9%87%8D/ class=md-nav__link> <span class=md-ellipsis> 去重 </span> </a> </li> <li class=md-nav__item> <a href=../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/24.%E5%B8%A6%E9%A2%9C%E8%89%B2%E6%89%93%E5%8D%B0/ class=md-nav__link> <span class=md-ellipsis> 带颜色打印 </span> </a> </li> <li class=md-nav__item> <a href=../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/25.python-example/ class=md-nav__link> <span class=md-ellipsis> Python By Example </span> </a> </li> <li class=md-nav__item> <a href=../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94/26.go-example/ class=md-nav__link> <span class=md-ellipsis> Go By Example </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8_3> <label class=md-nav__link for=__nav_8_3 id=__nav_8_3_label tabindex=0> <span class=md-ellipsis> 2.进阶 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_8_3_label aria-expanded=false> <label class=md-nav__title for=__nav_8_3> <span class="md-nav__icon md-icon"></span> 2.进阶 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Python-vs-Go/2.%E8%BF%9B%E9%98%B6/1.%E4%BD%BF%E7%94%A8RPC/ class=md-nav__link> <span class=md-ellipsis> 使用RPC </span> </a> </li> <li class=md-nav__item> <a href=../../Python-vs-Go/2.%E8%BF%9B%E9%98%B6/2.%E4%BD%BF%E7%94%A8MySQL/ class=md-nav__link> <span class=md-ellipsis> 使用MySQL </span> </a> </li> <li class=md-nav__item> <a href=../../Python-vs-Go/2.%E8%BF%9B%E9%98%B6/3.%E4%BD%BF%E7%94%A8Redis/ class=md-nav__link> <span class=md-ellipsis> 使用Redis </span> </a> </li> <li class=md-nav__item> <a href=../../Python-vs-Go/2.%E8%BF%9B%E9%98%B6/4.%E4%BD%BF%E7%94%A8MongoDB/ class=md-nav__link> <span class=md-ellipsis> 使用MongoDB </span> </a> </li> <li class=md-nav__item> <a href=../../Python-vs-Go/2.%E8%BF%9B%E9%98%B6/5.%E7%BB%83%E6%89%8B%E9%A1%B9%E7%9B%AE%E6%8E%A8%E8%8D%90/ class=md-nav__link> <span class=md-ellipsis> 练手项目推荐 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8_4> <label class=md-nav__link for=__nav_8_4 id=__nav_8_4_label tabindex=0> <span class=md-ellipsis> 3.开发之路 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_8_4_label aria-expanded=false> <label class=md-nav__title for=__nav_8_4> <span class="md-nav__icon md-icon"></span> 3.开发之路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Python-vs-Go/3.%E5%BC%80%E5%8F%91%E4%B9%8B%E8%B7%AF/1.Go%E5%BC%80%E5%8F%91%E4%B9%8B%E8%B7%AF/ class=md-nav__link> <span class=md-ellipsis> 1.Go 开发之路 </span> </a> </li> <li class=md-nav__item> <a href=../../Python-vs-Go/3.%E5%BC%80%E5%8F%91%E4%B9%8B%E8%B7%AF/2.Python%E5%BC%80%E5%8F%91%E4%B9%8B%E8%B7%AF/ class=md-nav__link> <span class=md-ellipsis> 2.Python 开发之路 </span> </a> </li> <li class=md-nav__item> <a href=../../Python-vs-Go/3.%E5%BC%80%E5%8F%91%E4%B9%8B%E8%B7%AF/3.Vue3%E6%A1%86%E6%9E%B6/ class=md-nav__link> <span class=md-ellipsis> 3.Vue3 框架 </span> </a> </li> <li class=md-nav__item> <a href=../../Python-vs-Go/3.%E5%BC%80%E5%8F%91%E4%B9%8B%E8%B7%AF/4.Git%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/ class=md-nav__link> <span class=md-ellipsis> 4.Git 版本控制 </span> </a> </li> <li class=md-nav__item> <a href=../../Python-vs-Go/3.%E5%BC%80%E5%8F%91%E4%B9%8B%E8%B7%AF/5.Python%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%B9%B3%E5%8F%B0/ class=md-nav__link> <span class=md-ellipsis> 5.Python 自动化运维平台 </span> </a> </li> <li class=md-nav__item> <a href=../../Python-vs-Go/3.%E5%BC%80%E5%8F%91%E4%B9%8B%E8%B7%AF/6.Go%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%B9%B3%E5%8F%B0/ class=md-nav__link> <span class=md-ellipsis> 6.Go 自动化运维平台 </span> </a> </li> <li class=md-nav__item> <a href=../../Python-vs-Go/3.%E5%BC%80%E5%8F%91%E4%B9%8B%E8%B7%AF/7.Shell%E5%BC%80%E5%8F%91/ class=md-nav__link> <span class=md-ellipsis> 7.Shell 开发 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_9> <label class=md-nav__link for=__nav_9 id=__nav_9_label tabindex=0> <span class=md-ellipsis> Git </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_9_label aria-expanded=false> <label class=md-nav__title for=__nav_9> <span class="md-nav__icon md-icon"></span> Git </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_9_1> <label class=md-nav__link for=__nav_9_1 id=__nav_9_1_label tabindex=0> <span class=md-ellipsis> Git基础 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_9_1_label aria-expanded=false> <label class=md-nav__title for=__nav_9_1> <span class="md-nav__icon md-icon"></span> Git基础 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Git/1.Git%E5%9F%BA%E7%A1%80/ class=md-nav__link> <span class=md-ellipsis> 1.Git 基础 </span> </a> </li> <li class=md-nav__item> <a href=../../Git/2.%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93/ class=md-nav__link> <span class=md-ellipsis> 2.远程仓库 </span> </a> </li> <li class=md-nav__item> <a href=../../Git/3.%E5%88%86%E6%94%AF%E7%AE%A1%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 3.分支管理 </span> </a> </li> <li class=md-nav__item> <a href=../../Git/4.%E5%88%86%E6%94%AF%E7%AE%A1%E7%90%86%E7%AD%96%E7%95%A5/ class=md-nav__link> <span class=md-ellipsis> 4.分支管理策略 </span> </a> </li> <li class=md-nav__item> <a href=../../Git/5.%E6%A0%87%E7%AD%BE%E7%AE%A1%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 5.标签管理 </span> </a> </li> <li class=md-nav__item> <a href=../../Git/6.%E4%BD%BF%E7%94%A8Gitee/ class=md-nav__link> <span class=md-ellipsis> 6.使用Gitee </span> </a> </li> <li class=md-nav__item> <a href=../../Git/7.%E4%BD%BF%E7%94%A8Github/ class=md-nav__link> <span class=md-ellipsis> 7.使用 Github </span> </a> </li> <li class=md-nav__item> <a href=../../Git/8.%E5%AE%9E%E8%B7%B5GitHub-Flow/ class=md-nav__link> <span class=md-ellipsis> 8.实践GitHub Flow </span> </a> </li> <li class=md-nav__item> <a href=../../Git/9.%E5%AE%9E%E8%B7%B5Git-Flow/ class=md-nav__link> <span class=md-ellipsis> 9.实践 Git Flow </span> </a> </li> <li class=md-nav__item> <a href=../../Git/10.%E9%A1%B9%E7%9B%AE%E8%A7%84%E8%8C%83/ class=md-nav__link> <span class=md-ellipsis> 10.项目规范 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_10> <label class=md-nav__link for=__nav_10 id=__nav_10_label tabindex=0> <span class=md-ellipsis> Ansible </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_10_label aria-expanded=false> <label class=md-nav__title for=__nav_10> <span class="md-nav__icon md-icon"></span> Ansible </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_10_1> <label class=md-nav__link for=__nav_10_1 id=__nav_10_1_label tabindex=0> <span class=md-ellipsis> Ansible实践 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_10_1_label aria-expanded=false> <label class=md-nav__title for=__nav_10_1> <span class="md-nav__icon md-icon"></span> Ansible实践 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Ansible/1.Ansible%E7%AE%80%E4%BB%8B/ class=md-nav__link> <span class=md-ellipsis> 1.Ansible简介 </span> </a> </li> <li class=md-nav__item> <a href=../../Ansible/2.YAML%E4%BB%8B%E7%BB%8D/ class=md-nav__link> <span class=md-ellipsis> 2.YAML 介绍 </span> </a> </li> <li class=md-nav__item> <a href=../../Ansible/3.%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE/ class=md-nav__link> <span class=md-ellipsis> 3.安装和配置 </span> </a> </li> <li class=md-nav__item> <a href=../../Ansible/4.Inventory/ class=md-nav__link> <span class=md-ellipsis> 4.Inventory </span> </a> </li> <li class=md-nav__item> <a href=../../Ansible/5.%E5%B8%B8%E7%94%A8%E6%A8%A1%E5%9D%97/ class=md-nav__link> <span class=md-ellipsis> 5.常用模块 </span> </a> </li> <li class=md-nav__item> <a href=../../Ansible/6.playbook/ class=md-nav__link> <span class=md-ellipsis> 6.playbook </span> </a> </li> <li class=md-nav__item> <a href=../../Ansible/7.role/ class=md-nav__link> <span class=md-ellipsis> 7.role </span> </a> </li> <li class=md-nav__item> <a href=../../Ansible/8.Galaxy/ class=md-nav__link> <span class=md-ellipsis> 8.Galaxy </span> </a> </li> <li class=md-nav__item> <a href=../../Ansible/9.Jinja2/ class=md-nav__link> <span class=md-ellipsis> 9.Jinja2 </span> </a> </li> <li class=md-nav__item> <a href=../../Ansible/10.Ansible%E9%80%9F%E5%BA%A6%E4%BC%98%E5%8C%96/ class=md-nav__link> <span class=md-ellipsis> 10.Ansible 速度优化 </span> </a> </li> <li class=md-nav__item> <a href=../../Ansible/11.Ansible-API/ class=md-nav__link> <span class=md-ellipsis> 11.Ansible API </span> </a> </li> <li class=md-nav__item> <a href=../../Ansible/12.flask%2Bansible%E8%BF%90%E7%BB%B4%E5%90%8E%E7%AB%AF/ class=md-nav__link> <span class=md-ellipsis> 12.flask+ansible运维后端 </span> </a> </li> <li class=md-nav__item> <a href=../../Ansible/13.Module%E5%BC%80%E5%8F%91/ class=md-nav__link> <span class=md-ellipsis> 13.Module 开发 </span> </a> </li> <li class=md-nav__item> <a href=../../Ansible/14.Plugin%E5%BC%80%E5%8F%91/ class=md-nav__link> <span class=md-ellipsis> 14.Plugin 开发 </span> </a> </li> <li class=md-nav__item> <a href=../../Ansible/15.Ansible%E8%B0%83%E8%AF%95/ class=md-nav__link> <span class=md-ellipsis> 15.Ansible 调试 </span> </a> </li> <li class=md-nav__item> <a href=../../Ansible/16.playbook%E5%AE%9E%E4%BE%8B/ class=md-nav__link> <span class=md-ellipsis> 16.playbook 实例 </span> </a> </li> <li class=md-nav__item> <a href=../../Ansible/17.role%E5%AE%9E%E4%BE%8B/ class=md-nav__link> <span class=md-ellipsis> 17.role 实例 </span> </a> </li> <li class=md-nav__item> <a href=../../Ansible/%E9%99%84%E5%BD%95-Ansible-wiki/ class=md-nav__link> <span class=md-ellipsis> 附录-Ansible wiki </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_11 checked> <label class=md-nav__link for=__nav_11 id=__nav_11_label tabindex> <span class=md-ellipsis> Shell </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_11_label aria-expanded=true> <label class=md-nav__title for=__nav_11> <span class="md-nav__icon md-icon"></span> Shell </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_11_1 checked> <label class=md-nav__link for=__nav_11_1 id=__nav_11_1_label tabindex=0> <span class=md-ellipsis> Shell实践 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_11_1_label aria-expanded=true> <label class=md-nav__title for=__nav_11_1> <span class="md-nav__icon md-icon"></span> Shell实践 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Shell%E7%AE%80%E4%BB%8B/ class=md-nav__link> <span class=md-ellipsis> Shell 教程概述 </span> </a> </li> <li class=md-nav__item> <a href=../1.%E7%AC%AC%E4%B8%80%E4%B8%AAshell%E7%A8%8B%E5%BA%8F/ class=md-nav__link> <span class=md-ellipsis> 1.第一个 Shell 程序 </span> </a> </li> <li class=md-nav__item> <a href=../2.Shell%E5%8F%98%E9%87%8F%E5%92%8C%E5%AD%97%E7%AC%A6%E4%B8%B2/ class=md-nav__link> <span class=md-ellipsis> 2.Shell 变量和字符串 </span> </a> </li> <li class=md-nav__item> <a href=../3.Shell%E5%8F%82%E6%95%B0/ class=md-nav__link> <span class=md-ellipsis> 3.Shell 参数 </span> </a> </li> <li class=md-nav__item> <a href=../4.Shell%E6%95%B0%E7%BB%84/ class=md-nav__link> <span class=md-ellipsis> 4.Shell数组 </span> </a> </li> <li class=md-nav__item> <a href=../5.Shell%E8%BF%90%E7%AE%97%E7%AC%A6/ class=md-nav__link> <span class=md-ellipsis> 5.Shell 运算符 </span> </a> </li> <li class=md-nav__item> <a href=../6.Shell-echo_printf%E5%91%BD%E4%BB%A4/ class=md-nav__link> <span class=md-ellipsis> 6.Shell echo/printf 命令 </span> </a> </li> <li class=md-nav__item> <a href=../7.Shell%E6%9D%A1%E4%BB%B6%E8%A1%A8%E8%BE%BE%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 7.Shell 条件表达式 </span> </a> </li> <li class=md-nav__item> <a href=../8.Shell%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/ class=md-nav__link> <span class=md-ellipsis> 8.Shell 流程控制 </span> </a> </li> <li class=md-nav__item> <a href=../9.Shell%E5%87%BD%E6%95%B0/ class=md-nav__link> <span class=md-ellipsis> 9.Shell 函数 </span> </a> </li> <li class=md-nav__item> <a href=../10.Shell%E9%87%8D%E5%AE%9A%E5%90%91/ class=md-nav__link> <span class=md-ellipsis> 10.Shell 重定向 </span> </a> </li> <li class=md-nav__item> <a href=../11.Shell%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 11.Shell 正则表达式 </span> </a> </li> <li class=md-nav__item> <a href=../12.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bgrep/ class=md-nav__link> <span class=md-ellipsis> 12.Shell 三剑客之 grep </span> </a> </li> <li class=md-nav__item> <a href=../13.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/ class=md-nav__link> <span class=md-ellipsis> 13.Shell 三剑客之 sed </span> </a> </li> <li class=md-nav__item> <a href=../14.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bawk/ class=md-nav__link> <span class=md-ellipsis> 14.Shell 三剑客之 awk </span> </a> </li> <li class=md-nav__item> <a href=../15.Shell%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/ class=md-nav__link> <span class=md-ellipsis> 15.Shell 常用命令 </span> </a> </li> <li class=md-nav__item> <a href=../16.Shell%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/ class=md-nav__link> <span class=md-ellipsis> 16.Shell实战项目 </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> 17.Shell 脚本示例 </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> 17.Shell 脚本示例 </span> </a> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#1判断-curl-返回状态码 class=md-nav__link> <span class=md-ellipsis> 1.判断 curl 返回状态码 </span> </a> </li> <li class=md-nav__item> <a href=#2读取文件中的配置到变量中 class=md-nav__link> <span class=md-ellipsis> 2.读取文件中的配置到变量中 </span> </a> </li> <li class=md-nav__item> <a href=#3根据-console-输入条件执行 class=md-nav__link> <span class=md-ellipsis> 3.根据 console 输入条件执行 </span> </a> </li> <li class=md-nav__item> <a href=#4将指定输出内容写入文件 class=md-nav__link> <span class=md-ellipsis> 4.将指定输出内容写入文件 </span> </a> </li> <li class=md-nav__item> <a href=#5判断变量是否存在或为空 class=md-nav__link> <span class=md-ellipsis> 5.判断变量是否存在或为空 </span> </a> <nav class=md-nav aria-label=5.判断变量是否存在或为空> <ul class=md-nav__list> <li class=md-nav__item> <a href=#51-字符串判断中-x-的作用 class=md-nav__link> <span class=md-ellipsis> 5.1 字符串判断中 x 的作用 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#6文件扫描校验 class=md-nav__link> <span class=md-ellipsis> 6.文件扫描校验 </span> </a> </li> <li class=md-nav__item> <a href=#7linux-系统检测 class=md-nav__link> <span class=md-ellipsis> 7.Linux 系统检测 </span> </a> <nav class=md-nav aria-label="7.Linux 系统检测"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#71-监控-100-台服务器磁盘利用率脚本 class=md-nav__link> <span class=md-ellipsis> 7.1 监控 100 台服务器磁盘利用率脚本 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#8启动脚本示例 class=md-nav__link> <span class=md-ellipsis> 8.启动脚本示例 </span> </a> </li> <li class=md-nav__item> <a href=#9备份-24-小时被修改的文件 class=md-nav__link> <span class=md-ellipsis> 9.备份 24 小时被修改的文件 </span> </a> </li> <li class=md-nav__item> <a href=#10卸载相关的-rpm-包 class=md-nav__link> <span class=md-ellipsis> 10.卸载相关的 rpm 包 </span> </a> </li> <li class=md-nav__item> <a href=#11检查-rpm-包的方法 class=md-nav__link> <span class=md-ellipsis> 11.检查 rpm 包的方法 </span> </a> </li> <li class=md-nav__item> <a href=#12检查软件状态 class=md-nav__link> <span class=md-ellipsis> 12.检查软件状态 </span> </a> </li> <li class=md-nav__item> <a href=#13color-输出 class=md-nav__link> <span class=md-ellipsis> 13.color 输出 </span> </a> </li> <li class=md-nav__item> <a href=#14日志备份切割 class=md-nav__link> <span class=md-ellipsis> 14.日志备份切割 </span> </a> <nav class=md-nav aria-label=14.日志备份切割> <ul class=md-nav__list> <li class=md-nav__item> <a href=#通过脚本管理-nginx-服务器日志 class=md-nav__link> <span class=md-ellipsis> 通过脚本管理 Nginx 服务器日志 </span> </a> </li> <li class=md-nav__item> <a href=#通过脚本管理-apache-服务器日志 class=md-nav__link> <span class=md-ellipsis> 通过脚本管理 Apache 服务器日志 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#15一键安装-docker class=md-nav__link> <span class=md-ellipsis> 15.一键安装 docker </span> </a> </li> <li class=md-nav__item> <a href=#16-备份-mongodb class=md-nav__link> <span class=md-ellipsis> 16. 备份 MongoDB </span> </a> </li> <li class=md-nav__item> <a href=#17linux-下以秒为单位执行脚本 class=md-nav__link> <span class=md-ellipsis> 17.Linux 下以秒为单位执行脚本 </span> </a> <nav class=md-nav aria-label="17.Linux 下以秒为单位执行脚本"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#example1 class=md-nav__link> <span class=md-ellipsis> example1 </span> </a> </li> <li class=md-nav__item> <a href=#example2 class=md-nav__link> <span class=md-ellipsis> example2 </span> </a> </li> <li class=md-nav__item> <a href=#example3 class=md-nav__link> <span class=md-ellipsis> example3 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#18备份文件 class=md-nav__link> <span class=md-ellipsis> 18.备份文件 </span> </a> </li> <li class=md-nav__item> <a href=#19修改-ip-主机名网卡信息 class=md-nav__link> <span class=md-ellipsis> 19.修改 IP 主机名网卡信息 </span> </a> </li> <li class=md-nav__item> <a href=#20检查恶意-ip-登录拒绝-ssh class=md-nav__link> <span class=md-ellipsis> 20.检查恶意 IP 登录,拒绝 SSH </span> </a> </li> <li class=md-nav__item> <a href=#21数据库备份 class=md-nav__link> <span class=md-ellipsis> 21.数据库备份 </span> </a> <nav class=md-nav aria-label=21.数据库备份> <ul class=md-nav__list> <li class=md-nav__item> <a href=#备份数据库 class=md-nav__link> <span class=md-ellipsis> 备份数据库 </span> </a> </li> <li class=md-nav__item> <a href=#mysql-定时备份脚本 class=md-nav__link> <span class=md-ellipsis> MySQL 定时备份脚本 </span> </a> </li> <li class=md-nav__item> <a href=#mysql-数据库分库备份 class=md-nav__link> <span class=md-ellipsis> MySQL 数据库分库备份 </span> </a> </li> <li class=md-nav__item> <a href=#mysql-数据库分库分表备份 class=md-nav__link> <span class=md-ellipsis> MySQL 数据库分库分表备份 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#22开机性能优化 class=md-nav__link> <span class=md-ellipsis> 22.开机性能优化 </span> </a> </li> <li class=md-nav__item> <a href=#23函数输出帮助信息 class=md-nav__link> <span class=md-ellipsis> 23.函数输出帮助信息 </span> </a> </li> <li class=md-nav__item> <a href=#24设置锁文件防止脚本重复执行 class=md-nav__link> <span class=md-ellipsis> 24.设置锁文件防止脚本重复执行 </span> </a> </li> <li class=md-nav__item> <a href=#25对一组-url-测试能否访问成功 class=md-nav__link> <span class=md-ellipsis> 25.对一组 url 测试能否访问成功 </span> </a> </li> <li class=md-nav__item> <a href=#26mysql-单表数据同步脚本 class=md-nav__link> <span class=md-ellipsis> 26.MySQL 单表数据同步脚本 </span> </a> </li> <li class=md-nav__item> <a href=#27shell-实现多并发控制 class=md-nav__link> <span class=md-ellipsis> 27.shell 实现多并发控制 </span> </a> <nav class=md-nav aria-label="27.shell 实现多并发控制"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#不并发 class=md-nav__link> <span class=md-ellipsis> 不并发 </span> </a> </li> <li class=md-nav__item> <a href=#控制并发 class=md-nav__link> <span class=md-ellipsis> 控制并发 </span> </a> <nav class=md-nav aria-label=控制并发> <ul class=md-nav__list> <li class=md-nav__item> <a href=#示例-1 class=md-nav__link> <span class=md-ellipsis> 示例 1 </span> </a> </li> <li class=md-nav__item> <a href=#示例-2 class=md-nav__link> <span class=md-ellipsis> 示例 2 </span> </a> </li> <li class=md-nav__item> <a href=#示例-3 class=md-nav__link> <span class=md-ellipsis> 示例 3 </span> </a> </li> <li class=md-nav__item> <a href=#示例-4 class=md-nav__link> <span class=md-ellipsis> 示例 4 </span> </a> </li> <li class=md-nav__item> <a href=#示例-5 class=md-nav__link> <span class=md-ellipsis> 示例 5 </span> </a> </li> <li class=md-nav__item> <a href=#示例-6 class=md-nav__link> <span class=md-ellipsis> 示例 6 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#28一些常用的函数 class=md-nav__link> <span class=md-ellipsis> 28.一些常用的函数 </span> </a> </li> <li class=md-nav__item> <a href=#30猜随机数 class=md-nav__link> <span class=md-ellipsis> 30.猜随机数 </span> </a> </li> <li class=md-nav__item> <a href=#31test-多种写法 class=md-nav__link> <span class=md-ellipsis> 31.test 多种写法 </span> </a> </li> <li class=md-nav__item> <a href=#32换算秒为分钟小时 class=md-nav__link> <span class=md-ellipsis> 32.换算秒为分钟、小时 </span> </a> </li> <li class=md-nav__item> <a href=#33脚本命令行参数的传递与判断 class=md-nav__link> <span class=md-ellipsis> 33.脚本命令行参数的传递与判断 </span> </a> </li> <li class=md-nav__item> <a href=#34检测-docker-容器的启动状态 class=md-nav__link> <span class=md-ellipsis> 34.检测 docker 容器的启动状态 </span> </a> </li> <li class=md-nav__item> <a href=#35检查常见系统命令是否安装 class=md-nav__link> <span class=md-ellipsis> 35.检查常见系统命令是否安装 </span> </a> </li> <li class=md-nav__item> <a href=#36发送钉钉通知 class=md-nav__link> <span class=md-ellipsis> 36.发送钉钉通知 </span> </a> </li> <li class=md-nav__item> <a href=#37function-函数库 class=md-nav__link> <span class=md-ellipsis> 37.function 函数库 </span> </a> </li> <li class=md-nav__item> <a href=#38bash-公共库 class=md-nav__link> <span class=md-ellipsis> 38.Bash 公共库 </span> </a> <nav class=md-nav aria-label="38.Bash 公共库"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1bash-shell-function-library class=md-nav__link> <span class=md-ellipsis> 1.Bash Shell Function Library </span> </a> </li> <li class=md-nav__item> <a href=#2bash-lib class=md-nav__link> <span class=md-ellipsis> 2.Bash Lib </span> </a> </li> <li class=md-nav__item> <a href=#3shellbash库函数 class=md-nav__link> <span class=md-ellipsis> 3.Shell(Bash)库函数 </span> </a> </li> <li class=md-nav__item> <a href=#4bash-libs class=md-nav__link> <span class=md-ellipsis> 4.bash-libs </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#39数据库备份-shell-脚本 class=md-nav__link> <span class=md-ellipsis> 39.数据库备份 Shell 脚本 </span> </a> <nav class=md-nav aria-label="39.数据库备份 Shell 脚本"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#mysql class=md-nav__link> <span class=md-ellipsis> MySQL </span> </a> </li> <li class=md-nav__item> <a href=#oracle class=md-nav__link> <span class=md-ellipsis> Oracle </span> </a> </li> <li class=md-nav__item> <a href=#postgresql class=md-nav__link> <span class=md-ellipsis> PostgreSQL </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#40-deploy-highly-mysql-mha-clusters class=md-nav__link> <span class=md-ellipsis> 40. deploy highly MySQL MHA clusters </span> </a> </li> <li class=md-nav__item> <a href=#41-deploy-a-highly-available-mongodb-en class=md-nav__link> <span class=md-ellipsis> 41. deploy-a-highly-available-mongodb-en </span> </a> </li> <li class=md-nav__item> <a href=#42-deploy-开源运维监控系统-prometheus class=md-nav__link> <span class=md-ellipsis> 42. deploy 开源运维监控系统 Prometheus </span> </a> </li> <li class=md-nav__item> <a href=#43-deploy-高可用-rabbitmq-集群 class=md-nav__link> <span class=md-ellipsis> 43. deploy 高可用 RabbitMQ 集群 </span> </a> </li> <li class=md-nav__item> <a href=#44-deploy-redis-集群 class=md-nav__link> <span class=md-ellipsis> 44. deploy Redis 集群 </span> </a> </li> <li class=md-nav__item> <a href=#45-docker-swarm-集群 class=md-nav__link> <span class=md-ellipsis> 45. Docker Swarm 集群 </span> </a> </li> <li class=md-nav__item> <a href=#46-deploy-nginxkeepalived class=md-nav__link> <span class=md-ellipsis> 46. deploy Nginx+Keepalived </span> </a> </li> <li class=md-nav__item> <a href=#47-deploy-openvpn class=md-nav__link> <span class=md-ellipsis> 47. deploy OpenVPN </span> </a> </li> <li class=md-nav__item> <a href=#48-deploy-zpan class=md-nav__link> <span class=md-ellipsis> 48. deploy Zpan </span> </a> </li> <li class=md-nav__item> <a href=#49-deploy-vsftpd-软件 class=md-nav__link> <span class=md-ellipsis> 49. deploy VSFTPD 软件 </span> </a> </li> <li class=md-nav__item> <a href=#50-deploy-lvskeepalived class=md-nav__link> <span class=md-ellipsis> 50. deploy LVS+Keepalived </span> </a> </li> <li class=md-nav__item> <a href=#51-deploy-流复制的高可用-postgresql-集群 class=md-nav__link> <span class=md-ellipsis> 51. deploy 流复制的高可用 PostgreSQL 集群 </span> </a> </li> <li class=md-nav__item> <a href=#52-deploy-lnmp class=md-nav__link> <span class=md-ellipsis> 52. deploy lnmp </span> </a> </li> <li class=md-nav__item> <a href=#53自动分区格式化挂载脚本 class=md-nav__link> <span class=md-ellipsis> 53.自动分区、格式化、挂载脚本 </span> </a> </li> <li class=md-nav__item> <a href=#54站长常用-shell-脚本整理分享 class=md-nav__link> <span class=md-ellipsis> 54.站长常用 Shell 脚本整理分享 </span> </a> </li> <li class=md-nav__item> <a href=#55整理一些常用的脚本持续更新 class=md-nav__link> <span class=md-ellipsis> 55.整理一些常用的脚本(持续更新) </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../18.Shell%E8%84%9A%E6%9C%AC%E7%9A%84%E5%8F%82%E6%95%B0%E8%A7%A3%E6%9E%90%E5%B7%A5%E5%85%B7/ class=md-nav__link> <span class=md-ellipsis> 18.Shell 脚本的参数解析工具 </span> </a> </li> <li class=md-nav__item> <a href=../19.%E5%AE%9E%E7%94%A8Shell%E8%84%9A%E6%9C%AC%E6%A1%88%E4%BE%8B/ class=md-nav__link> <span class=md-ellipsis> 19.实用 Shell 脚本案例 </span> </a> </li> <li class=md-nav__item> <a href=../20.Shell%E8%84%9A%E6%9C%AC%E7%9A%84%E8%A7%84%E8%8C%83/ class=md-nav__link> <span class=md-ellipsis> 20.Shell 脚本的规范 </span> </a> </li> <li class=md-nav__item> <a href=../21.Shell%E5%A4%9A%E8%BF%9B%E7%A8%8B%E5%B9%B6%E5%8F%91/ class=md-nav__link> <span class=md-ellipsis> 21.Shell多进程并发 </span> </a> </li> <li class=md-nav__item> <a href=../22.Shell_Library/ class=md-nav__link> <span class=md-ellipsis> 22.Shell_Library </span> </a> </li> <li class=md-nav__item> <a href=../23.Shell%E8%84%9A%E6%9C%AC%E8%B0%83%E8%AF%95%E6%8A%80%E6%9C%AF/ class=md-nav__link> <span class=md-ellipsis> 23.Shell 脚本调试技术 </span> </a> </li> <li class=md-nav__item> <a href=../24.Linux_Shell%E8%84%9A%E6%9C%AC%E6%94%BB%E7%95%A5/ class=md-nav__link> <span class=md-ellipsis> 24.Linux Shell脚本攻略 </span> </a> </li> <li class=md-nav__item> <a href=../25.Shell%E8%84%9A%E6%9C%AC%E5%8A%A0%E5%AF%86/ class=md-nav__link> <span class=md-ellipsis> 25.Shell 脚本加密 </span> </a> </li> <li class=md-nav__item> <a href=../%E9%99%84-shell%E5%85%B6%E5%AE%83%E8%B5%84%E6%BA%90/ class=md-nav__link> <span class=md-ellipsis> 附-shell 其它资源 </span> </a> </li> <li class=md-nav__item> <a href=../%E9%99%84-vim%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/ class=md-nav__link> <span class=md-ellipsis> 附-vim 常用操作 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_12> <label class=md-nav__link for=__nav_12 id=__nav_12_label tabindex=0> <span class=md-ellipsis> Linux </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_12_label aria-expanded=false> <label class=md-nav__title for=__nav_12> <span class="md-nav__icon md-icon"></span> Linux </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_12_1> <label class=md-nav__link for=__nav_12_1 id=__nav_12_1_label tabindex=0> <span class=md-ellipsis> KVM </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_12_1_label aria-expanded=false> <label class=md-nav__title for=__nav_12_1> <span class="md-nav__icon md-icon"></span> KVM </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Linux/KVM/1.kvm%E5%B8%B8%E8%A7%81%E6%93%8D%E4%BD%9C/ class=md-nav__link> <span class=md-ellipsis> 1.kvm 常见操作 </span> </a> </li> <li class=md-nav__item> <a href=../../Linux/KVM/2.kvm%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%88%9B%E5%BB%BA/ class=md-nav__link> <span class=md-ellipsis> 2.kvm虚拟机创建 </span> </a> </li> <li class=md-nav__item> <a href=../../Linux/KVM/3.kvm%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE/ class=md-nav__link> <span class=md-ellipsis> 3.kvm网络配置 </span> </a> </li> <li class=md-nav__item> <a href=../../Linux/KVM/4.%E5%AE%89%E8%A3%85KVM/ class=md-nav__link> <span class=md-ellipsis> 4.安装 KVM </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_12_2> <label class=md-nav__link for=__nav_12_2 id=__nav_12_2_label tabindex=0> <span class=md-ellipsis> Nginx </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_12_2_label aria-expanded=false> <label class=md-nav__title for=__nav_12_2> <span class="md-nav__icon md-icon"></span> Nginx </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Linux/Nginx/1.Nginx%E7%AE%80%E4%BB%8B/ class=md-nav__link> <span class=md-ellipsis> 1.Nginx 简介 </span> </a> </li> <li class=md-nav__item> <a href=../../Linux/Nginx/2.Nginx%E5%AE%89%E8%A3%85%E5%8F%8A%E5%90%AF%E5%8A%A8/ class=md-nav__link> <span class=md-ellipsis> 2.Nginx安装及启动 </span> </a> </li> <li class=md-nav__item> <a href=../../Linux/Nginx/3.Nginx%E9%85%8D%E7%BD%AE/ class=md-nav__link> <span class=md-ellipsis> 3.Nginx配置 </span> </a> </li> <li class=md-nav__item> <a href=../../Linux/Nginx/4.Nginx%E9%85%8D%E7%BD%AE%E4%B8%8B%E8%BD%BD%E7%AB%99%E7%82%B9/ class=md-nav__link> <span class=md-ellipsis> 4.Nginx配置下载站点 </span> </a> </li> <li class=md-nav__item> <a href=../../Linux/Nginx/5.Nginx%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6/ class=md-nav__link> <span class=md-ellipsis> 5.Nginx访问控制 </span> </a> </li> <li class=md-nav__item> <a href=../../Linux/Nginx/6.Nginx%E8%99%9A%E6%8B%9F%E4%B8%BB%E6%9C%BA/ class=md-nav__link> <span class=md-ellipsis> 6.Nginx虚拟主机 </span> </a> </li> <li class=md-nav__item> <a href=../../Linux/Nginx/7.Nginx%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90/ class=md-nav__link> <span class=md-ellipsis> 7.Nginx静态资源 </span> </a> </li> <li class=md-nav__item> <a href=../../Linux/Nginx/8.Nginx%E7%BC%93%E5%AD%98%E9%85%8D%E7%BD%AE/ class=md-nav__link> <span class=md-ellipsis> 8.Nginx缓存配置 </span> </a> </li> <li class=md-nav__item> <a href=../../Linux/Nginx/9.Nginx%E6%AD%A3%E5%8F%8D%E4%BB%A3%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 9.Nginx 正反向代理 </span> </a> </li> <li class=md-nav__item> <a href=../../Linux/Nginx/10.Nginx%E9%98%B2%E7%9B%97%E9%93%BE/ class=md-nav__link> <span class=md-ellipsis> 10.Nginx 防盗链 </span> </a> </li> <li class=md-nav__item> <a href=../../Linux/Nginx/11.Nginx%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/ class=md-nav__link> <span class=md-ellipsis> 11.Nginx 负载均衡 </span> </a> </li> <li class=md-nav__item> <a href=../../Linux/Nginx/12.Nginx%E5%8A%A8%E9%9D%99%E5%88%86%E7%A6%BB/ class=md-nav__link> <span class=md-ellipsis> 12.Nginx 动静分离 </span> </a> </li> <li class=md-nav__item> <a href=../../Linux/Nginx/13.Nginx%E8%B7%A8%E5%9F%9F%E9%85%8D%E7%BD%AE/ class=md-nav__link> <span class=md-ellipsis> 13.Nginx 跨域配置 </span> </a> </li> <li class=md-nav__item> <a href=../../Linux/Nginx/14.Nginx%E9%87%8D%E5%AE%9A%E5%90%91/ class=md-nav__link> <span class=md-ellipsis> 14.Nginx重定向 </span> </a> </li> <li class=md-nav__item> <a href=../../Linux/Nginx/15.Nginx-HTTPS/ class=md-nav__link> <span class=md-ellipsis> 15.Nginx HTTPS </span> </a> </li> <li class=md-nav__item> <a href=../../Linux/Nginx/16.%E9%99%84-Nginx-location%E8%AF%AD%E6%B3%95/ class=md-nav__link> <span class=md-ellipsis> 16.附-Nginx-location语法 </span> </a> </li> <li class=md-nav__item> <a href=../../Linux/Nginx/17.%E9%99%84-Nginx-wiki/ class=md-nav__link> <span class=md-ellipsis> 17.附-Nginx-wiki </span> </a> </li> <li class=md-nav__item> <a href=../../Linux/Nginx/18.%E9%99%84-Nginx%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/ class=md-nav__link> <span class=md-ellipsis> 18.附-Nginx 综合实践 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_12_3> <label class=md-nav__link for=__nav_12_3 id=__nav_12_3_label tabindex=0> <span class=md-ellipsis> System </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_12_3_label aria-expanded=false> <label class=md-nav__title for=__nav_12_3> <span class="md-nav__icon md-icon"></span> System </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Linux/System/1.%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E5%92%8C%E8%BD%AF%E4%BB%B6%E6%BA%90/ class=md-nav__link> <span class=md-ellipsis> 1.系统镜像和软件源 </span> </a> </li> <li class=md-nav__item> <a href=../../Linux/System/2.Linux%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA/ class=md-nav__link> <span class=md-ellipsis> 2.Linux安全加固 </span> </a> </li> <li class=md-nav__item> <a href=../../Linux/System/3.Systemd/ class=md-nav__link> <span class=md-ellipsis> 3.Systemd </span> </a> </li> <li class=md-nav__item> <a href=../../Linux/System/4.Superivisor/ class=md-nav__link> <span class=md-ellipsis> 4.Superivisor </span> </a> </li> <li class=md-nav__item> <a href=../../Linux/System/5.SSH%E7%99%BB%E5%BD%95Linux%E6%98%BE%E7%A4%BA%E6%A8%AA%E5%B9%85/ class=md-nav__link> <span class=md-ellipsis> 5.SSH登录Linux显示横幅 </span> </a> </li> <li class=md-nav__item> <a href=../../Linux/System/6.Linux%E4%B8%AD%E7%AB%AF%E5%8F%A3%E5%8D%A0%E7%94%A8%E6%8E%92%E6%9F%A5/ class=md-nav__link> <span class=md-ellipsis> 6.Linux 中端口占用排查 </span> </a> </li> <li class=md-nav__item> <a href=../../Linux/System/7.%E4%BD%BF%E7%94%A8curl%E5%8F%91%E9%80%81REST-API%E8%AF%B7%E6%B1%82/ class=md-nav__link> <span class=md-ellipsis> 7.使用 curl 发送 REST API 请求 </span> </a> </li> <li class=md-nav__item> <a href=../../Linux/System/8.%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%A8%A1%E7%B3%8A%E6%9F%A5%E6%89%BE%E5%99%A8fzf/ class=md-nav__link> <span class=md-ellipsis> 8.命令行模糊查找器fzf </span> </a> </li> <li class=md-nav__item> <a href=../../Linux/System/10.Centos%E5%9C%A8%E7%BA%BF-%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96/ class=md-nav__link> <span class=md-ellipsis> 10.Centos 在线-离线安装依赖 </span> </a> </li> <li class=md-nav__item> <a href=../../Linux/System/11.rsync-ssh/ class=md-nav__link> <span class=md-ellipsis> 11.rsync ssh 使用 </span> </a> </li> <li class=md-nav__item> <a href=../../Linux/System/12.%E5%90%84%E5%A4%A7%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%81%9ARAID/ class=md-nav__link> <span class=md-ellipsis> 12.各大服务器做RAID </span> </a> </li> <li class=md-nav__item> <a href=../../Linux/System/13.Linux%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84%E4%B8%8E%E8%BF%90%E7%BB%B4%E5%AE%9E%E6%88%98/ class=md-nav__link> <span class=md-ellipsis> 13.Linux 系统架构与运维实战 </span> </a> </li> <li class=md-nav__item> <a href=../../Linux/System/14.Linux%E4%B8%8B%E8%BD%AF%E4%BB%B6%E6%89%93%E5%8C%85/ class=md-nav__link> <span class=md-ellipsis> 14.Linux 下软件打包 </span> </a> </li> <li class=md-nav__item> <a href=../../Linux/System/15.Linux%E7%B3%BB%E7%BB%9F%E7%A3%81%E7%9B%98%E7%AE%A1%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 15.Linux 系统磁盘管理 </span> </a> </li> <li class=md-nav__item> <a href=../../Linux/System/16.Linux%E7%B3%BB%E7%BB%9F%E7%A3%81%E7%9B%98%E8%BF%9B%E9%98%B6/ class=md-nav__link> <span class=md-ellipsis> 16.Linux 系统磁盘进阶 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_12_4> <label class=md-nav__link for=__nav_12_4 id=__nav_12_4_label tabindex=0> <span class=md-ellipsis> Ubuntu </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_12_4_label aria-expanded=false> <label class=md-nav__title for=__nav_12_4> <span class="md-nav__icon md-icon"></span> Ubuntu </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Linux/Ubuntu/1.Ubuntu%E6%A1%8C%E9%9D%A2%E5%88%9D%E5%A7%8B%E5%8C%96%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/ class=md-nav__link> <span class=md-ellipsis> 1.Ubuntu 桌面初始化安装配置 </span> </a> </li> <li class=md-nav__item> <a href=../../Linux/Ubuntu/2.ubuntu-desktop-vmware/ class=md-nav__link> <span class=md-ellipsis> 2.Ubuntu-desktop-vmware </span> </a> </li> <li class=md-nav__item> <a href=../../Linux/Ubuntu/3.Ubuntu_UFW%E9%98%B2%E7%81%AB%E5%A2%99/ class=md-nav__link> <span class=md-ellipsis> 3.Ubuntu_UFW 防火墙 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_12_5> <label class=md-nav__link for=__nav_12_5 id=__nav_12_5_label tabindex=0> <span class=md-ellipsis> VM </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_12_5_label aria-expanded=false> <label class=md-nav__title for=__nav_12_5> <span class="md-nav__icon md-icon"></span> VM </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Linux/VM/1.Vagrant%E8%99%9A%E6%8B%9F%E6%9C%BA/ class=md-nav__link> <span class=md-ellipsis> 1.Vagrant虚拟机 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_13> <label class=md-nav__link for=__nav_13 id=__nav_13_label tabindex=0> <span class=md-ellipsis> middleware </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_13_label aria-expanded=false> <label class=md-nav__title for=__nav_13> <span class="md-nav__icon md-icon"></span> middleware </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_13_1> <label class=md-nav__link for=__nav_13_1 id=__nav_13_1_label tabindex=0> <span class=md-ellipsis> db </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_13_1_label aria-expanded=false> <label class=md-nav__title for=__nav_13_1> <span class="md-nav__icon md-icon"></span> db </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../middleware/db/1.postgres/ class=md-nav__link> <span class=md-ellipsis> 1.postgres </span> </a> </li> <li class=md-nav__item> <a href=../../middleware/db/2.redis/ class=md-nav__link> <span class=md-ellipsis> 2.redis </span> </a> </li> <li class=md-nav__item> <a href=../../middleware/db/3.Mysql/ class=md-nav__link> <span class=md-ellipsis> 3.Mysql </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_13_2> <label class=md-nav__link for=__nav_13_2 id=__nav_13_2_label tabindex=0> <span class=md-ellipsis> mq </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_13_2_label aria-expanded=false> <label class=md-nav__title for=__nav_13_2> <span class="md-nav__icon md-icon"></span> mq </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../middleware/mq/1.rabbitMQ/ class=md-nav__link> <span class=md-ellipsis> 1.rabbitMQ </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_14> <label class=md-nav__link for=__nav_14 id=__nav_14_label tabindex=0> <span class=md-ellipsis> Other </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_14_label aria-expanded=false> <label class=md-nav__title for=__nav_14> <span class="md-nav__icon md-icon"></span> Other </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_14_1> <label class=md-nav__link for=__nav_14_1 id=__nav_14_1_label tabindex=0> <span class=md-ellipsis> tools </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_14_1_label aria-expanded=false> <label class=md-nav__title for=__nav_14_1> <span class="md-nav__icon md-icon"></span> tools </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Other/tools/1.PicGo%E5%9B%BE%E5%BA%8A/ class=md-nav__link> <span class=md-ellipsis> 1.PicGo图床 </span> </a> </li> <li class=md-nav__item> <a href=../../Other/tools/2.PicX%E5%9B%BE%E5%BA%8A/ class=md-nav__link> <span class=md-ellipsis> 2.Picx图床 </span> </a> </li> <li class=md-nav__item> <a href=../../Other/tools/3.Markdown%E8%AF%AD%E6%B3%95/ class=md-nav__link> <span class=md-ellipsis> 3.Markdown语法 </span> </a> </li> <li class=md-nav__item> <a href=../../Other/tools/4.KeyManager/ class=md-nav__link> <span class=md-ellipsis> 4.KeyManager </span> </a> </li> <li class=md-nav__item> <a href=../../Other/tools/5.mkdocs-material%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2/ class=md-nav__link> <span class=md-ellipsis> 5.mkdocs-material搭建博客 </span> </a> </li> <li class=md-nav__item> <a href=../../Other/tools/6.sphinx%E6%9E%84%E5%BB%BA%E5%8D%9A%E5%AE%A2/ class=md-nav__link> <span class=md-ellipsis> 6.sphinx构建博客 </span> </a> </li> <li class=md-nav__item> <a href=../../Other/tools/7.%E4%BC%81%E4%B8%9A%E7%BA%A7VPN%E8%BD%AF%E4%BB%B6AnyLink/ class=md-nav__link> <span class=md-ellipsis> 7.企业级VPN软件AnyLink </span> </a> </li> <li class=md-nav__item> <a href=../../Other/tools/8.%E5%B9%B3%E5%8F%B0%E5%8F%8A%E5%B7%A5%E5%85%B7%E6%B1%87%E6%80%BB/ class=md-nav__link> <span class=md-ellipsis> 8.平台及工具汇总 </span> </a> </li> <li class=md-nav__item> <a href=../../Other/tools/9.%E8%87%AA%E5%8A%A8%E6%9B%B4%E6%96%B0%E7%B3%BB%E7%BB%9F%E4%BB%A3%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 9.自动更新系统代理 </span> </a> </li> <li class=md-nav__item> <a href=../../Other/tools/10.Bash-to-Bat-Converter/ class=md-nav__link> <span class=md-ellipsis> 10.Bash-to-Bat-Converter </span> </a> </li> <li class=md-nav__item> <a href=../../Other/tools/11.%E7%94%B5%E5%AD%90%E4%B9%A6%E9%98%85%E8%AF%BB%E5%99%A8/ class=md-nav__link> <span class=md-ellipsis> 11.电子书阅读器 </span> </a> </li> <li class=md-nav__item> <a href=../../Other/tools/12.ssh%E5%B7%A5%E5%85%B7/ class=md-nav__link> <span class=md-ellipsis> 12.ssh 工具 </span> </a> </li> <li class=md-nav__item> <a href=../../Other/tools/13.%E8%87%AA%E7%94%A8%E5%B7%A5%E5%85%B7%E9%9B%86/ class=md-nav__link> <span class=md-ellipsis> 13.自用工具集 </span> </a> </li> <li class=md-nav__item> <a href=../../Other/tools/14.%E7%A8%8B%E5%BA%8F%E5%91%98%E7%94%BB%E5%9B%BE%E5%B7%A5%E5%85%B7/ class=md-nav__link> <span class=md-ellipsis> 14.程序员画图工具 </span> </a> </li> <li class=md-nav__item> <a href=../../Other/tools/15.%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%96%87%E6%A1%A3%E7%AE%A1%E7%90%86%E7%BD%91%E7%AB%99/ class=md-nav__link> <span class=md-ellipsis> 15.搭建一个文档管理网站 </span> </a> </li> <li class=md-nav__item> <a href=../../Other/tools/16.%E5%9C%A8%E7%BA%BF%E5%B7%A5%E5%85%B7%E7%AE%B1/ class=md-nav__link> <span class=md-ellipsis> 16.在线工具箱 </span> </a> </li> <li class=md-nav__item> <a href=../../Other/tools/17.GitHub%E6%8E%92%E8%A1%8C%E6%A6%9C/ class=md-nav__link> <span class=md-ellipsis> 17.GitHub 排行榜 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_14_2> <label class=md-nav__link for=__nav_14_2 id=__nav_14_2_label tabindex=0> <span class=md-ellipsis> windows </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_14_2_label aria-expanded=false> <label class=md-nav__title for=__nav_14_2> <span class="md-nav__icon md-icon"></span> windows </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Other/windows/1.%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6%E4%B8%8B%E8%BD%BD/ class=md-nav__link> <span class=md-ellipsis> 1.常用软件下载 </span> </a> </li> <li class=md-nav__item> <a href=../../Other/windows/2.windows%E5%BF%AB%E6%8D%B7%E6%8C%87%E4%BB%A4/ class=md-nav__link> <span class=md-ellipsis> 2.windows 快捷指令 </span> </a> </li> <li class=md-nav__item> <a href=../../Other/windows/3.DOS/ class=md-nav__link> <span class=md-ellipsis> 3.DOS </span> </a> </li> <li class=md-nav__item> <a href=../../Other/windows/4.Windows%E6%BF%80%E6%B4%BB%E5%B7%A5%E5%85%B7/ class=md-nav__link> <span class=md-ellipsis> 4.Windows 激活工具 </span> </a> </li> <li class=md-nav__item> <a href=../../Other/windows/5.windows%E4%B8%8Bnetcat%E5%AE%89%E8%A3%85/ class=md-nav__link> <span class=md-ellipsis> 5.windows下netcat安装 </span> </a> </li> <li class=md-nav__item> <a href=../../Other/windows/6.U%E7%9B%98%E5%88%B6%E4%BD%9C%E5%B7%A5%E5%85%B7/ class=md-nav__link> <span class=md-ellipsis> 6.U 盘制作工具 </span> </a> </li> <li class=md-nav__item> <a href=../../Other/windows/7.rustdesk/ class=md-nav__link> <span class=md-ellipsis> 7.rustdesk </span> </a> </li> <li class=md-nav__item> <a href=../../Other/windows/8.Docker%E4%B8%AD%E8%BF%90%E8%A1%8CWindows%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/ class=md-nav__link> <span class=md-ellipsis> 8.Docker 中运行 Windows 操作系统 </span> </a> </li> <li class=md-nav__item> <a href=../../Other/windows/9.Cygwin%E5%B7%A5%E5%85%B7%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/ class=md-nav__link> <span class=md-ellipsis> 9.Cygwin 工具安装和使用指导 </span> </a> </li> <li class=md-nav__item> <a href=../../Other/windows/10.%E6%88%91%E4%BD%BF%E7%94%A8%E7%9A%84GPT/ class=md-nav__link> <span class=md-ellipsis> 10.我使用的 GPT </span> </a> </li> <li class=md-nav__item> <a href=../../Other/windows/11.win10%E5%AE%89%E8%A3%85wsl2/ class=md-nav__link> <span class=md-ellipsis> 11.win10 安装 wsl2 </span> </a> </li> <li class=md-nav__item> <a href=../../Other/windows/12.wsl%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AEminiconda/ class=md-nav__link> <span class=md-ellipsis> 12.wsl 安装配置 miniconda </span> </a> </li> <li class=md-nav__item> <a href=../../Other/windows/13.wsl%E5%AE%89%E8%A3%85docker/ class=md-nav__link> <span class=md-ellipsis> 13.wsl 安装 docker </span> </a> </li> <li class=md-nav__item> <a href=../../Other/windows/14.wsl%E5%AE%89%E8%A3%85nodejs/ class=md-nav__link> <span class=md-ellipsis> 14.wsl 安装 nodejs </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_14_3> <label class=md-nav__link for=__nav_14_3 id=__nav_14_3_label tabindex=0> <span class=md-ellipsis> Interview </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_14_3_label aria-expanded=false> <label class=md-nav__title for=__nav_14_3> <span class="md-nav__icon md-icon"></span> Interview </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Other/Interview/0.%E9%9D%A2%E8%AF%95%E5%AE%9D%E5%85%B8/ class=md-nav__link> <span class=md-ellipsis> 面试宝典 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#1判断-curl-返回状态码 class=md-nav__link> <span class=md-ellipsis> 1.判断 curl 返回状态码 </span> </a> </li> <li class=md-nav__item> <a href=#2读取文件中的配置到变量中 class=md-nav__link> <span class=md-ellipsis> 2.读取文件中的配置到变量中 </span> </a> </li> <li class=md-nav__item> <a href=#3根据-console-输入条件执行 class=md-nav__link> <span class=md-ellipsis> 3.根据 console 输入条件执行 </span> </a> </li> <li class=md-nav__item> <a href=#4将指定输出内容写入文件 class=md-nav__link> <span class=md-ellipsis> 4.将指定输出内容写入文件 </span> </a> </li> <li class=md-nav__item> <a href=#5判断变量是否存在或为空 class=md-nav__link> <span class=md-ellipsis> 5.判断变量是否存在或为空 </span> </a> <nav class=md-nav aria-label=5.判断变量是否存在或为空> <ul class=md-nav__list> <li class=md-nav__item> <a href=#51-字符串判断中-x-的作用 class=md-nav__link> <span class=md-ellipsis> 5.1 字符串判断中 x 的作用 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#6文件扫描校验 class=md-nav__link> <span class=md-ellipsis> 6.文件扫描校验 </span> </a> </li> <li class=md-nav__item> <a href=#7linux-系统检测 class=md-nav__link> <span class=md-ellipsis> 7.Linux 系统检测 </span> </a> <nav class=md-nav aria-label="7.Linux 系统检测"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#71-监控-100-台服务器磁盘利用率脚本 class=md-nav__link> <span class=md-ellipsis> 7.1 监控 100 台服务器磁盘利用率脚本 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#8启动脚本示例 class=md-nav__link> <span class=md-ellipsis> 8.启动脚本示例 </span> </a> </li> <li class=md-nav__item> <a href=#9备份-24-小时被修改的文件 class=md-nav__link> <span class=md-ellipsis> 9.备份 24 小时被修改的文件 </span> </a> </li> <li class=md-nav__item> <a href=#10卸载相关的-rpm-包 class=md-nav__link> <span class=md-ellipsis> 10.卸载相关的 rpm 包 </span> </a> </li> <li class=md-nav__item> <a href=#11检查-rpm-包的方法 class=md-nav__link> <span class=md-ellipsis> 11.检查 rpm 包的方法 </span> </a> </li> <li class=md-nav__item> <a href=#12检查软件状态 class=md-nav__link> <span class=md-ellipsis> 12.检查软件状态 </span> </a> </li> <li class=md-nav__item> <a href=#13color-输出 class=md-nav__link> <span class=md-ellipsis> 13.color 输出 </span> </a> </li> <li class=md-nav__item> <a href=#14日志备份切割 class=md-nav__link> <span class=md-ellipsis> 14.日志备份切割 </span> </a> <nav class=md-nav aria-label=14.日志备份切割> <ul class=md-nav__list> <li class=md-nav__item> <a href=#通过脚本管理-nginx-服务器日志 class=md-nav__link> <span class=md-ellipsis> 通过脚本管理 Nginx 服务器日志 </span> </a> </li> <li class=md-nav__item> <a href=#通过脚本管理-apache-服务器日志 class=md-nav__link> <span class=md-ellipsis> 通过脚本管理 Apache 服务器日志 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#15一键安装-docker class=md-nav__link> <span class=md-ellipsis> 15.一键安装 docker </span> </a> </li> <li class=md-nav__item> <a href=#16-备份-mongodb class=md-nav__link> <span class=md-ellipsis> 16. 备份 MongoDB </span> </a> </li> <li class=md-nav__item> <a href=#17linux-下以秒为单位执行脚本 class=md-nav__link> <span class=md-ellipsis> 17.Linux 下以秒为单位执行脚本 </span> </a> <nav class=md-nav aria-label="17.Linux 下以秒为单位执行脚本"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#example1 class=md-nav__link> <span class=md-ellipsis> example1 </span> </a> </li> <li class=md-nav__item> <a href=#example2 class=md-nav__link> <span class=md-ellipsis> example2 </span> </a> </li> <li class=md-nav__item> <a href=#example3 class=md-nav__link> <span class=md-ellipsis> example3 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#18备份文件 class=md-nav__link> <span class=md-ellipsis> 18.备份文件 </span> </a> </li> <li class=md-nav__item> <a href=#19修改-ip-主机名网卡信息 class=md-nav__link> <span class=md-ellipsis> 19.修改 IP 主机名网卡信息 </span> </a> </li> <li class=md-nav__item> <a href=#20检查恶意-ip-登录拒绝-ssh class=md-nav__link> <span class=md-ellipsis> 20.检查恶意 IP 登录,拒绝 SSH </span> </a> </li> <li class=md-nav__item> <a href=#21数据库备份 class=md-nav__link> <span class=md-ellipsis> 21.数据库备份 </span> </a> <nav class=md-nav aria-label=21.数据库备份> <ul class=md-nav__list> <li class=md-nav__item> <a href=#备份数据库 class=md-nav__link> <span class=md-ellipsis> 备份数据库 </span> </a> </li> <li class=md-nav__item> <a href=#mysql-定时备份脚本 class=md-nav__link> <span class=md-ellipsis> MySQL 定时备份脚本 </span> </a> </li> <li class=md-nav__item> <a href=#mysql-数据库分库备份 class=md-nav__link> <span class=md-ellipsis> MySQL 数据库分库备份 </span> </a> </li> <li class=md-nav__item> <a href=#mysql-数据库分库分表备份 class=md-nav__link> <span class=md-ellipsis> MySQL 数据库分库分表备份 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#22开机性能优化 class=md-nav__link> <span class=md-ellipsis> 22.开机性能优化 </span> </a> </li> <li class=md-nav__item> <a href=#23函数输出帮助信息 class=md-nav__link> <span class=md-ellipsis> 23.函数输出帮助信息 </span> </a> </li> <li class=md-nav__item> <a href=#24设置锁文件防止脚本重复执行 class=md-nav__link> <span class=md-ellipsis> 24.设置锁文件防止脚本重复执行 </span> </a> </li> <li class=md-nav__item> <a href=#25对一组-url-测试能否访问成功 class=md-nav__link> <span class=md-ellipsis> 25.对一组 url 测试能否访问成功 </span> </a> </li> <li class=md-nav__item> <a href=#26mysql-单表数据同步脚本 class=md-nav__link> <span class=md-ellipsis> 26.MySQL 单表数据同步脚本 </span> </a> </li> <li class=md-nav__item> <a href=#27shell-实现多并发控制 class=md-nav__link> <span class=md-ellipsis> 27.shell 实现多并发控制 </span> </a> <nav class=md-nav aria-label="27.shell 实现多并发控制"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#不并发 class=md-nav__link> <span class=md-ellipsis> 不并发 </span> </a> </li> <li class=md-nav__item> <a href=#控制并发 class=md-nav__link> <span class=md-ellipsis> 控制并发 </span> </a> <nav class=md-nav aria-label=控制并发> <ul class=md-nav__list> <li class=md-nav__item> <a href=#示例-1 class=md-nav__link> <span class=md-ellipsis> 示例 1 </span> </a> </li> <li class=md-nav__item> <a href=#示例-2 class=md-nav__link> <span class=md-ellipsis> 示例 2 </span> </a> </li> <li class=md-nav__item> <a href=#示例-3 class=md-nav__link> <span class=md-ellipsis> 示例 3 </span> </a> </li> <li class=md-nav__item> <a href=#示例-4 class=md-nav__link> <span class=md-ellipsis> 示例 4 </span> </a> </li> <li class=md-nav__item> <a href=#示例-5 class=md-nav__link> <span class=md-ellipsis> 示例 5 </span> </a> </li> <li class=md-nav__item> <a href=#示例-6 class=md-nav__link> <span class=md-ellipsis> 示例 6 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#28一些常用的函数 class=md-nav__link> <span class=md-ellipsis> 28.一些常用的函数 </span> </a> </li> <li class=md-nav__item> <a href=#30猜随机数 class=md-nav__link> <span class=md-ellipsis> 30.猜随机数 </span> </a> </li> <li class=md-nav__item> <a href=#31test-多种写法 class=md-nav__link> <span class=md-ellipsis> 31.test 多种写法 </span> </a> </li> <li class=md-nav__item> <a href=#32换算秒为分钟小时 class=md-nav__link> <span class=md-ellipsis> 32.换算秒为分钟、小时 </span> </a> </li> <li class=md-nav__item> <a href=#33脚本命令行参数的传递与判断 class=md-nav__link> <span class=md-ellipsis> 33.脚本命令行参数的传递与判断 </span> </a> </li> <li class=md-nav__item> <a href=#34检测-docker-容器的启动状态 class=md-nav__link> <span class=md-ellipsis> 34.检测 docker 容器的启动状态 </span> </a> </li> <li class=md-nav__item> <a href=#35检查常见系统命令是否安装 class=md-nav__link> <span class=md-ellipsis> 35.检查常见系统命令是否安装 </span> </a> </li> <li class=md-nav__item> <a href=#36发送钉钉通知 class=md-nav__link> <span class=md-ellipsis> 36.发送钉钉通知 </span> </a> </li> <li class=md-nav__item> <a href=#37function-函数库 class=md-nav__link> <span class=md-ellipsis> 37.function 函数库 </span> </a> </li> <li class=md-nav__item> <a href=#38bash-公共库 class=md-nav__link> <span class=md-ellipsis> 38.Bash 公共库 </span> </a> <nav class=md-nav aria-label="38.Bash 公共库"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1bash-shell-function-library class=md-nav__link> <span class=md-ellipsis> 1.Bash Shell Function Library </span> </a> </li> <li class=md-nav__item> <a href=#2bash-lib class=md-nav__link> <span class=md-ellipsis> 2.Bash Lib </span> </a> </li> <li class=md-nav__item> <a href=#3shellbash库函数 class=md-nav__link> <span class=md-ellipsis> 3.Shell(Bash)库函数 </span> </a> </li> <li class=md-nav__item> <a href=#4bash-libs class=md-nav__link> <span class=md-ellipsis> 4.bash-libs </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#39数据库备份-shell-脚本 class=md-nav__link> <span class=md-ellipsis> 39.数据库备份 Shell 脚本 </span> </a> <nav class=md-nav aria-label="39.数据库备份 Shell 脚本"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#mysql class=md-nav__link> <span class=md-ellipsis> MySQL </span> </a> </li> <li class=md-nav__item> <a href=#oracle class=md-nav__link> <span class=md-ellipsis> Oracle </span> </a> </li> <li class=md-nav__item> <a href=#postgresql class=md-nav__link> <span class=md-ellipsis> PostgreSQL </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#40-deploy-highly-mysql-mha-clusters class=md-nav__link> <span class=md-ellipsis> 40. deploy highly MySQL MHA clusters </span> </a> </li> <li class=md-nav__item> <a href=#41-deploy-a-highly-available-mongodb-en class=md-nav__link> <span class=md-ellipsis> 41. deploy-a-highly-available-mongodb-en </span> </a> </li> <li class=md-nav__item> <a href=#42-deploy-开源运维监控系统-prometheus class=md-nav__link> <span class=md-ellipsis> 42. deploy 开源运维监控系统 Prometheus </span> </a> </li> <li class=md-nav__item> <a href=#43-deploy-高可用-rabbitmq-集群 class=md-nav__link> <span class=md-ellipsis> 43. deploy 高可用 RabbitMQ 集群 </span> </a> </li> <li class=md-nav__item> <a href=#44-deploy-redis-集群 class=md-nav__link> <span class=md-ellipsis> 44. deploy Redis 集群 </span> </a> </li> <li class=md-nav__item> <a href=#45-docker-swarm-集群 class=md-nav__link> <span class=md-ellipsis> 45. Docker Swarm 集群 </span> </a> </li> <li class=md-nav__item> <a href=#46-deploy-nginxkeepalived class=md-nav__link> <span class=md-ellipsis> 46. deploy Nginx+Keepalived </span> </a> </li> <li class=md-nav__item> <a href=#47-deploy-openvpn class=md-nav__link> <span class=md-ellipsis> 47. deploy OpenVPN </span> </a> </li> <li class=md-nav__item> <a href=#48-deploy-zpan class=md-nav__link> <span class=md-ellipsis> 48. deploy Zpan </span> </a> </li> <li class=md-nav__item> <a href=#49-deploy-vsftpd-软件 class=md-nav__link> <span class=md-ellipsis> 49. deploy VSFTPD 软件 </span> </a> </li> <li class=md-nav__item> <a href=#50-deploy-lvskeepalived class=md-nav__link> <span class=md-ellipsis> 50. deploy LVS+Keepalived </span> </a> </li> <li class=md-nav__item> <a href=#51-deploy-流复制的高可用-postgresql-集群 class=md-nav__link> <span class=md-ellipsis> 51. deploy 流复制的高可用 PostgreSQL 集群 </span> </a> </li> <li class=md-nav__item> <a href=#52-deploy-lnmp class=md-nav__link> <span class=md-ellipsis> 52. deploy lnmp </span> </a> </li> <li class=md-nav__item> <a href=#53自动分区格式化挂载脚本 class=md-nav__link> <span class=md-ellipsis> 53.自动分区、格式化、挂载脚本 </span> </a> </li> <li class=md-nav__item> <a href=#54站长常用-shell-脚本整理分享 class=md-nav__link> <span class=md-ellipsis> 54.站长常用 Shell 脚本整理分享 </span> </a> </li> <li class=md-nav__item> <a href=#55整理一些常用的脚本持续更新 class=md-nav__link> <span class=md-ellipsis> 55.整理一些常用的脚本(持续更新) </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=17shell-脚本示例>17.Shell 脚本示例<a class=headerlink href=#17shell-脚本示例 title="Permanent link">&para;</a></h1> <p>脚本编写注意事项</p> <ol> <li>开头加解释器：#!/bin/bash</li> <li>语法缩进，使用四个空格；多加注释说明。</li> <li>命名建议规则：变量名大写、局部变量小写，函数名小写，名字体现出实际作用。</li> <li>默认变量是全局的，在函数中变量 local 指定为局部变量，避免污染其他作用域。</li> <li>有两个命令能帮助我调试脚本：set -e 遇到执行非 0 时退出脚本，set -x 和 set +x 打印执行过程。set-x 和 set+x 常用于调试函数。</li> <li>写脚本一定先测试再到生产上。</li> </ol> <p><a href="https://gitbook.curiouser.top/origin/bash-scirpts.html?h=shell">常用 Shell 脚本-生产可用</a></p> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nb>set</span><span class=w> </span>-x
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=k>function</span><span class=o>(){</span>
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=o>}</span>
<a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=nb>set</span><span class=w> </span>+x
</code></pre></div> <div class=highlight><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=c1># set 的一些用法：</span>
<a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=w>    </span><span class=nb>shopt</span><span class=w> </span>-s<span class=w> </span>-o<span class=w> </span>nounset<span class=w>         </span><span class=c1>#强调变量必须先声明才能使用</span>
<a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a>
<a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a><span class=w>    </span><span class=nb>set</span><span class=w> </span>x<span class=w> </span>y<span class=w> </span>z<span class=w>               </span><span class=c1># 将x,y,z的值赋予位置参数1,2,3</span>
<a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a>
<a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a><span class=w>    </span><span class=c1>#把 set -u 或 set -o nounset 插入到脚本中, 并运行它, 就会在每个试图使用未声明变量的地方给出一个unbound variable错误信息.</span>
<a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a><span class=w>    </span><span class=c1>#set -e     # 遇到执行非 0 时退出脚本，set -x 打印执行过程</span>
<a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a>
<a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a><span class=w>    </span><span class=nb>set</span><span class=w> </span>-o<span class=w> </span>pipefail<span class=w> </span><span class=c1>#在这个设置执行后，其后面的代码，包括管道命令的返回值，为最后一个非零的命令的返回值，或者当管道内的所有命令都执行成功后返回零。</span>
<a id=__codelineno-1-10 name=__codelineno-1-10 href=#__codelineno-1-10></a>
<a id=__codelineno-1-11 name=__codelineno-1-11 href=#__codelineno-1-11></a><span class=w>    </span><span class=nb>set</span><span class=w> </span>-o<span class=w> </span>nounset<span class=w>      </span><span class=c1>#未声明变量就报错，强制退出</span>
<a id=__codelineno-1-12 name=__codelineno-1-12 href=#__codelineno-1-12></a><span class=w>    </span><span class=nb>set</span><span class=w> </span>+o<span class=w> </span>nounset<span class=w>      </span><span class=c1># set -/+u,简写</span>
<a id=__codelineno-1-13 name=__codelineno-1-13 href=#__codelineno-1-13></a>
<a id=__codelineno-1-14 name=__codelineno-1-14 href=#__codelineno-1-14></a><span class=w>    </span><span class=nb>set</span><span class=w> </span>-o<span class=w> </span>errexit<span class=w>      </span><span class=c1># 脚本只要发生错误，执行出现非0的结果,当脚本发生第一个错误时退出脚本</span>
<a id=__codelineno-1-15 name=__codelineno-1-15 href=#__codelineno-1-15></a><span class=w>    </span><span class=nb>set</span><span class=w> </span>+o<span class=w> </span>errexit<span class=w>      </span><span class=c1># set -/+e,简写</span>
<a id=__codelineno-1-16 name=__codelineno-1-16 href=#__codelineno-1-16></a>
<a id=__codelineno-1-17 name=__codelineno-1-17 href=#__codelineno-1-17></a><span class=w>    </span><span class=nb>set</span><span class=w> </span>-o<span class=w> </span>xtrace<span class=w>       </span><span class=c1># 表示跟踪脚本的执行过程，有利于调试,运行结果之前，先输出执行的那一行命令,比set -v更加完整详细</span>
<a id=__codelineno-1-18 name=__codelineno-1-18 href=#__codelineno-1-18></a><span class=w>    </span><span class=nb>set</span><span class=w> </span>+o<span class=w> </span>xtrace<span class=w>       </span><span class=c1># set -/+x,简写</span>
<a id=__codelineno-1-19 name=__codelineno-1-19 href=#__codelineno-1-19></a>
<a id=__codelineno-1-20 name=__codelineno-1-20 href=#__codelineno-1-20></a><span class=w>    </span><span class=nb>set</span><span class=w> </span>-o<span class=w> </span>noclobber<span class=w>    </span><span class=c1># 防止文件覆盖，文件存在就报错，不存在就正常创建</span>
<a id=__codelineno-1-21 name=__codelineno-1-21 href=#__codelineno-1-21></a><span class=w>    </span><span class=nb>set</span><span class=w> </span>+o<span class=w> </span>noclobber<span class=w>    </span><span class=c1># set -/+C,简写</span>
<a id=__codelineno-1-22 name=__codelineno-1-22 href=#__codelineno-1-22></a>
<a id=__codelineno-1-23 name=__codelineno-1-23 href=#__codelineno-1-23></a><span class=w>    </span><span class=nb>set</span><span class=w> </span>-o<span class=w> </span>allexport<span class=w>    </span><span class=c1># export 所有已定于的变量</span>
<a id=__codelineno-1-24 name=__codelineno-1-24 href=#__codelineno-1-24></a><span class=w>    </span><span class=nb>set</span><span class=w> </span>+o<span class=w> </span>allexport<span class=w>    </span><span class=c1># set -/+a,简写</span>
<a id=__codelineno-1-25 name=__codelineno-1-25 href=#__codelineno-1-25></a>
<a id=__codelineno-1-26 name=__codelineno-1-26 href=#__codelineno-1-26></a><span class=w>    </span><span class=nb>set</span><span class=w> </span>-o<span class=w> </span>noexec<span class=w>       </span><span class=c1># 读取脚本命令，不执行，进行语法检查</span>
<a id=__codelineno-1-27 name=__codelineno-1-27 href=#__codelineno-1-27></a><span class=w>    </span><span class=nb>set</span><span class=w> </span>+o<span class=w> </span>noexec<span class=w>       </span><span class=c1># set -/+n,简写</span>
<a id=__codelineno-1-28 name=__codelineno-1-28 href=#__codelineno-1-28></a>
<a id=__codelineno-1-29 name=__codelineno-1-29 href=#__codelineno-1-29></a><span class=w>    </span><span class=nb>set</span><span class=w> </span>-o<span class=w> </span>verbose<span class=w>      </span><span class=c1># 执行一个命令前打印出这个命令</span>
<a id=__codelineno-1-30 name=__codelineno-1-30 href=#__codelineno-1-30></a><span class=w>    </span><span class=nb>set</span><span class=w> </span>+o<span class=w> </span>verbose<span class=w>      </span><span class=c1># set -/+v,简写</span>
<a id=__codelineno-1-31 name=__codelineno-1-31 href=#__codelineno-1-31></a>
<a id=__codelineno-1-32 name=__codelineno-1-32 href=#__codelineno-1-32></a>
<a id=__codelineno-1-33 name=__codelineno-1-33 href=#__codelineno-1-33></a>
<a id=__codelineno-1-34 name=__codelineno-1-34 href=#__codelineno-1-34></a><span class=w>    </span><span class=nb>set</span><span class=w> </span>-x
<a id=__codelineno-1-35 name=__codelineno-1-35 href=#__codelineno-1-35></a><span class=w>    </span>uname<span class=w> </span>-a
<a id=__codelineno-1-36 name=__codelineno-1-36 href=#__codelineno-1-36></a><span class=w>    </span>......
<a id=__codelineno-1-37 name=__codelineno-1-37 href=#__codelineno-1-37></a><span class=w>    </span><span class=nb>set</span><span class=w> </span>+x<span class=w>              </span><span class=c1>#调试某一个区域  打印执行过程,用于调试函数居多</span>
</code></pre></div> <p>脚本开头执行时，执行如下命令， 在执行过程中若遇到使用了未定义的变量或命令返回值为非零，将直接报错退出：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=nb>set</span><span class=w> </span>-eu
<a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=nb>set</span><span class=w> </span>-euo<span class=w> </span>pipefail
</code></pre></div> <h2 id=1判断-curl-返回状态码>1.判断 curl 返回状态码<a class=headerlink href=#1判断-curl-返回状态码 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=nv>response</span><span class=o>=</span><span class=k>$(</span>curl<span class=w> </span>-sL<span class=w> </span>-o<span class=w> </span>/dev/null<span class=w> </span>-w<span class=w> </span>%<span class=o>{</span>http_code<span class=o>}</span><span class=w> </span>https://baidu.com<span class=k>)</span>
<a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a><span class=k>if</span><span class=w> </span><span class=o>[[</span><span class=w> </span><span class=nv>$response</span><span class=w> </span>-ge<span class=w> </span><span class=m>200</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nv>$response</span><span class=w> </span>-le<span class=w> </span><span class=m>299</span><span class=w> </span><span class=o>]]</span><span class=w> </span><span class=p>;</span><span class=k>then</span>
<a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s1>&#39;check point success&#39;</span>
<a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a><span class=k>else</span>
<a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s1>&#39;check point fail&#39;</span>
<a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a><span class=k>fi</span>
</code></pre></div> <h2 id=2读取文件中的配置到变量中>2.读取文件中的配置到变量中<a class=headerlink href=#2读取文件中的配置到变量中 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=c1># 配置文件中的配置项格式为key1=value1，一行一个配置项</span>
<a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a><span class=k>while</span><span class=w> </span><span class=nb>read</span><span class=w> </span>line<span class=p>;</span><span class=k>do</span>
<a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a><span class=w>    </span><span class=nb>eval</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$line</span><span class=s2>&quot;</span>
<a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a><span class=k>done</span><span class=w> </span>&lt;<span class=w> </span>/etc/openvpn/server/smtp.conf
<a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a><span class=nb>echo</span><span class=w> </span><span class=nv>$key1</span>
</code></pre></div> <h2 id=3根据-console-输入条件执行>3.根据 console 输入条件执行<a class=headerlink href=#3根据-console-输入条件执行 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;选择以下功能:&quot;</span>
<a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;   0) 功能0&quot;</span>
<a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;   1) 功能1&quot;</span>
<a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;   2) 功能2&quot;</span>
<a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;   3) 功能3&quot;</span>
<a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;   4) 功能4&quot;</span>
<a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a><span class=nb>read</span><span class=w> </span>-p<span class=w> </span><span class=s2>&quot;功能选项[4]: &quot;</span><span class=w> </span>option
<a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a><span class=k>until</span><span class=w> </span><span class=o>[[</span><span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=nv>$option</span><span class=s2>&quot;</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$option</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span>~<span class=w> </span>^<span class=o>[</span><span class=m>0</span>-4<span class=o>]</span>$<span class=w> </span><span class=o>]]</span><span class=p>;</span><span class=w> </span><span class=k>do</span>
<a id=__codelineno-5-10 name=__codelineno-5-10 href=#__codelineno-5-10></a><span class=w>    </span><span class=nb>read</span><span class=w> </span>-p<span class=w> </span><span class=s2>&quot;</span><span class=nv>$option为无效的选项</span><span class=s2>，请重新输入功能选项: &quot;</span><span class=w> </span>option
<a id=__codelineno-5-11 name=__codelineno-5-11 href=#__codelineno-5-11></a><span class=k>done</span>
<a id=__codelineno-5-12 name=__codelineno-5-12 href=#__codelineno-5-12></a><span class=k>case</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$option</span><span class=s2>&quot;</span><span class=w> </span><span class=k>in</span>
<a id=__codelineno-5-13 name=__codelineno-5-13 href=#__codelineno-5-13></a><span class=w>    </span><span class=m>0</span><span class=o>)</span>
<a id=__codelineno-5-14 name=__codelineno-5-14 href=#__codelineno-5-14></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;功能0已执行!&quot;</span>
<a id=__codelineno-5-15 name=__codelineno-5-15 href=#__codelineno-5-15></a><span class=w>    </span><span class=p>;;</span>
<a id=__codelineno-5-16 name=__codelineno-5-16 href=#__codelineno-5-16></a><span class=w>        </span><span class=m>1</span><span class=o>)</span>
<a id=__codelineno-5-17 name=__codelineno-5-17 href=#__codelineno-5-17></a><span class=w>            </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;功能1已执行!&quot;</span>
<a id=__codelineno-5-18 name=__codelineno-5-18 href=#__codelineno-5-18></a><span class=w>      </span><span class=nb>exit</span>
<a id=__codelineno-5-19 name=__codelineno-5-19 href=#__codelineno-5-19></a><span class=w>    </span><span class=p>;;</span>
<a id=__codelineno-5-20 name=__codelineno-5-20 href=#__codelineno-5-20></a><span class=w>        </span><span class=m>2</span><span class=o>)</span>
<a id=__codelineno-5-21 name=__codelineno-5-21 href=#__codelineno-5-21></a><span class=w>            </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;功能2已执行!&quot;</span>
<a id=__codelineno-5-22 name=__codelineno-5-22 href=#__codelineno-5-22></a><span class=w>            </span><span class=nb>exit</span>
<a id=__codelineno-5-23 name=__codelineno-5-23 href=#__codelineno-5-23></a><span class=w>        </span><span class=p>;;</span>
<a id=__codelineno-5-24 name=__codelineno-5-24 href=#__codelineno-5-24></a><span class=w>        </span><span class=m>3</span><span class=o>)</span>
<a id=__codelineno-5-25 name=__codelineno-5-25 href=#__codelineno-5-25></a><span class=w>            </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;功能3已执行!&quot;</span>
<a id=__codelineno-5-26 name=__codelineno-5-26 href=#__codelineno-5-26></a><span class=w>            </span><span class=nb>exit</span>
<a id=__codelineno-5-27 name=__codelineno-5-27 href=#__codelineno-5-27></a><span class=w>        </span><span class=p>;;</span>
<a id=__codelineno-5-28 name=__codelineno-5-28 href=#__codelineno-5-28></a><span class=w>        </span><span class=c1># 默认选项</span>
<a id=__codelineno-5-29 name=__codelineno-5-29 href=#__codelineno-5-29></a><span class=w>        </span><span class=m>4</span><span class=p>|</span><span class=s2>&quot;&quot;</span><span class=o>)</span>
<a id=__codelineno-5-30 name=__codelineno-5-30 href=#__codelineno-5-30></a><span class=w>            </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;功能4已执行!&quot;</span>
<a id=__codelineno-5-31 name=__codelineno-5-31 href=#__codelineno-5-31></a><span class=w>            </span><span class=nb>exit</span>
<a id=__codelineno-5-32 name=__codelineno-5-32 href=#__codelineno-5-32></a><span class=w>        </span><span class=p>;;</span>
<a id=__codelineno-5-33 name=__codelineno-5-33 href=#__codelineno-5-33></a><span class=k>esac</span>
</code></pre></div> <h2 id=4将指定输出内容写入文件>4.将指定输出内容写入文件<a class=headerlink href=#4将指定输出内容写入文件 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=o>{</span>
<a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;hahh&quot;</span>
<a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;lalal&quot;</span>
<a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a><span class=o>}</span><span class=w> </span>&gt;<span class=w> </span>/tmp/test
</code></pre></div> <h2 id=5判断变量是否存在或为空>5.判断变量是否存在或为空<a class=headerlink href=#5判断变量是否存在或为空 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=si>${</span><span class=nv>var</span><span class=p>+x</span><span class=si>}</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;var is unset&quot;</span><span class=p>;</span>
<a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a><span class=k>else</span>
<a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;var is set to &#39;</span><span class=nv>$var</span><span class=s2>&#39;&quot;</span><span class=p>;</span>
<a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a><span class=k>fi</span>
</code></pre></div> <p>参考：<a href=https://stackoverflow.com/questions/3601515/how-to-check-if-a-variable-is-set-in-bash>https://stackoverflow.com/questions/3601515/how-to-check-if-a-variable-is-set-in-bash</a></p> <div class=highlight><pre><span></span><code><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a>
<a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a><span class=c1># -z 选项用于检查变量是否为空字符串，如果是，则返回true</span>
<a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>VAR</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;VAR is empty&quot;</span>
<a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a><span class=k>fi</span>
<a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a>
<a id=__codelineno-8-8 name=__codelineno-8-8 href=#__codelineno-8-8></a><span class=c1># -n 选项用于检查变量是否为非空字符串，如果是，则返回true。</span>
<a id=__codelineno-8-9 name=__codelineno-8-9 href=#__codelineno-8-9></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>VAR</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-8-10 name=__codelineno-8-10 href=#__codelineno-8-10></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;VAR is not empty&quot;</span>
<a id=__codelineno-8-11 name=__codelineno-8-11 href=#__codelineno-8-11></a><span class=k>fi</span>
</code></pre></div> <p>在测试变量是否为空时，最好使用双引号将变量括起来，以避免在变量为空时出现语法错误。</p> <h3 id=51-字符串判断中-x-的作用>5.1 字符串判断中 x 的作用<a class=headerlink href=#51-字符串判断中-x-的作用 title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=c1># 范例</span>
<a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a>
<a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;x</span><span class=si>${</span><span class=nv>var</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s2>&quot;x&quot;</span><span class=w> </span><span class=o>]</span>
<a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>x<span class=s2>&quot;</span><span class=nv>$DPVS_TYPE</span><span class=s2>&quot;</span><span class=w> </span><span class=o>==</span><span class=w> </span>x<span class=s2>&quot;SNAT&quot;</span><span class=w> </span><span class=o>]</span>
<a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a>
<a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a><span class=c1># 目的:防止出现语法错误。</span>
<a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a>
<a id=__codelineno-9-8 name=__codelineno-9-8 href=#__codelineno-9-8></a><span class=o>[</span><span class=w> </span>x<span class=nv>$1</span><span class=w> </span><span class=o>=</span><span class=w> </span>x<span class=w> </span><span class=o>]</span><span class=w> </span>is<span class=w> </span><span class=nb>true</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=nv>$1</span><span class=w> </span>is<span class=w> </span>unset/null/empty<span class=w> </span>or<span class=w> </span>not.
<a id=__codelineno-9-9 name=__codelineno-9-9 href=#__codelineno-9-9></a>
<a id=__codelineno-9-10 name=__codelineno-9-10 href=#__codelineno-9-10></a>Try<span class=w> </span>yourself<span class=w> </span>with:
<a id=__codelineno-9-11 name=__codelineno-9-11 href=#__codelineno-9-11></a><span class=nv>TEST</span><span class=o>=</span><span class=w> </span><span class=p>;</span><span class=o>[</span><span class=w> </span>x<span class=nv>$TEST</span><span class=w> </span><span class=o>=</span><span class=w> </span>x<span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;TEST is unset&quot;</span>
<a id=__codelineno-9-12 name=__codelineno-9-12 href=#__codelineno-9-12></a>and
<a id=__codelineno-9-13 name=__codelineno-9-13 href=#__codelineno-9-13></a><span class=nv>TEST</span><span class=o>=</span>lolz<span class=w> </span><span class=p>;</span><span class=o>[</span><span class=w> </span>x<span class=nv>$TEST</span><span class=w> </span><span class=o>=</span><span class=w> </span>x<span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;TEST is unset&quot;</span>
<a id=__codelineno-9-14 name=__codelineno-9-14 href=#__codelineno-9-14></a>
<a id=__codelineno-9-15 name=__codelineno-9-15 href=#__codelineno-9-15></a><span class=c1># 类似于[ -z &quot;${1:+x}&quot; ] 操作，当$1为空时，赋值给x，避免判断直接报错。</span>
</code></pre></div> <h2 id=6文件扫描校验>6.文件扫描校验<a class=headerlink href=#6文件扫描校验 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a><span class=c1>#func:scan file</span>
<a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a><span class=c1>#md5sum -c $SCAN_FILE</span>
<a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a>
<a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a>
<a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a><span class=nv>SCAN_DIR</span><span class=o>=</span><span class=sb>`</span><span class=nb>echo</span><span class=w> </span><span class=nv>$PATH</span><span class=w> </span><span class=p>|</span>sed<span class=w> </span><span class=s1>&#39;s/:/ /g&#39;</span><span class=sb>`</span>
<a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a><span class=nv>SCAN_CMD</span><span class=o>=</span><span class=sb>`</span>which<span class=w> </span>md5sum<span class=sb>`</span>
<a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a><span class=nv>SCAN_FILE_FALL</span><span class=o>=</span><span class=s2>&quot;/tmp/scan_</span><span class=k>$(</span>date<span class=w> </span>+%F%H%m<span class=k>)</span><span class=s2>_fall.txt&quot;</span>
<a id=__codelineno-10-9 name=__codelineno-10-9 href=#__codelineno-10-9></a><span class=nv>SCAN_FILE_BIN</span><span class=o>=</span><span class=s2>&quot;/tmp/scan_</span><span class=k>$(</span>date<span class=w> </span>+%F%H%m<span class=k>)</span><span class=s2>_bin.txt&quot;</span>
<a id=__codelineno-10-10 name=__codelineno-10-10 href=#__codelineno-10-10></a>
<a id=__codelineno-10-11 name=__codelineno-10-11 href=#__codelineno-10-11></a>scan_fall_disk<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-10-12 name=__codelineno-10-12 href=#__codelineno-10-12></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;正在全盘扫描，请稍等！文件路径:</span><span class=nv>$SCAN_FILE_FALL</span><span class=s2>&quot;</span>
<a id=__codelineno-10-13 name=__codelineno-10-13 href=#__codelineno-10-13></a><span class=w>        </span>find<span class=w> </span>/<span class=w> </span>-type<span class=w> </span>f<span class=w> </span>-exec<span class=w> </span><span class=nv>$SCAN_CMD</span><span class=w> </span><span class=se>\{\}</span><span class=w> </span><span class=se>\;</span>&gt;&gt;<span class=w> </span><span class=nv>$SCAN_FILE_FALL</span><span class=w> </span><span class=m>2</span>&gt;/dev/null
<a id=__codelineno-10-14 name=__codelineno-10-14 href=#__codelineno-10-14></a><span class=o>}</span>
<a id=__codelineno-10-15 name=__codelineno-10-15 href=#__codelineno-10-15></a>
<a id=__codelineno-10-16 name=__codelineno-10-16 href=#__codelineno-10-16></a>scan_bin<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-10-17 name=__codelineno-10-17 href=#__codelineno-10-17></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;正在扫描PATH可执行文件，请稍等，文件路径：</span><span class=nv>$SCAN_FILE_BIN</span><span class=s2>&quot;</span>
<a id=__codelineno-10-18 name=__codelineno-10-18 href=#__codelineno-10-18></a><span class=w>    </span><span class=k>for</span><span class=w> </span>file<span class=w> </span><span class=k>in</span><span class=w> </span><span class=nv>$SCAN_DIR</span>
<a id=__codelineno-10-19 name=__codelineno-10-19 href=#__codelineno-10-19></a><span class=w>    </span><span class=k>do</span>
<a id=__codelineno-10-20 name=__codelineno-10-20 href=#__codelineno-10-20></a><span class=w>        </span>find<span class=w> </span><span class=nv>$filae</span><span class=w> </span>-type<span class=w> </span>f<span class=w> </span>-exec<span class=w> </span><span class=nv>$SCAN_CMD</span><span class=w> </span><span class=se>\{\}</span><span class=w> </span><span class=se>\;</span>&gt;&gt;<span class=w> </span><span class=nv>$SCAN_FILE_BIN</span><span class=w> </span><span class=m>2</span>&gt;/dev/null
<a id=__codelineno-10-21 name=__codelineno-10-21 href=#__codelineno-10-21></a><span class=w>    </span><span class=k>done</span>
<a id=__codelineno-10-22 name=__codelineno-10-22 href=#__codelineno-10-22></a><span class=o>}</span>
<a id=__codelineno-10-23 name=__codelineno-10-23 href=#__codelineno-10-23></a>
<a id=__codelineno-10-24 name=__codelineno-10-24 href=#__codelineno-10-24></a>main<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-10-25 name=__codelineno-10-25 href=#__codelineno-10-25></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=nv>$#</span><span class=w> </span>-lt<span class=w> </span><span class=m>1</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;请使用参数，1表示全盘扫描，2表示二进制可执行文件扫描&quot;</span>
<a id=__codelineno-10-26 name=__codelineno-10-26 href=#__codelineno-10-26></a><span class=w>    </span><span class=nb>read</span><span class=w> </span>number
<a id=__codelineno-10-27 name=__codelineno-10-27 href=#__codelineno-10-27></a><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=nv>$number</span><span class=w> </span><span class=k>in</span>
<a id=__codelineno-10-28 name=__codelineno-10-28 href=#__codelineno-10-28></a><span class=w>    </span><span class=m>1</span><span class=o>)</span>
<a id=__codelineno-10-29 name=__codelineno-10-29 href=#__codelineno-10-29></a><span class=w>        </span>scan_fall_disk<span class=p>;;</span>
<a id=__codelineno-10-30 name=__codelineno-10-30 href=#__codelineno-10-30></a><span class=w>    </span><span class=m>2</span><span class=o>)</span>
<a id=__codelineno-10-31 name=__codelineno-10-31 href=#__codelineno-10-31></a><span class=w>        </span>scan_bin<span class=p>;;</span>
<a id=__codelineno-10-32 name=__codelineno-10-32 href=#__codelineno-10-32></a><span class=w>    </span>*<span class=o>)</span>
<a id=__codelineno-10-33 name=__codelineno-10-33 href=#__codelineno-10-33></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;参数错误，1，表示全盘扫描，2表示二进制文件扫描&quot;</span>
<a id=__codelineno-10-34 name=__codelineno-10-34 href=#__codelineno-10-34></a><span class=w>    </span><span class=k>esac</span>
<a id=__codelineno-10-35 name=__codelineno-10-35 href=#__codelineno-10-35></a><span class=o>}</span>
<a id=__codelineno-10-36 name=__codelineno-10-36 href=#__codelineno-10-36></a>
<a id=__codelineno-10-37 name=__codelineno-10-37 href=#__codelineno-10-37></a>
<a id=__codelineno-10-38 name=__codelineno-10-38 href=#__codelineno-10-38></a>main
</code></pre></div> <h2 id=7linux-系统检测>7.Linux 系统检测<a class=headerlink href=#7linux-系统检测 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a><span class=c1># auth:kaliarch</span>
<a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a><span class=c1># func:sys info check</span>
<a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a><span class=c1># version:v1.0</span>
<a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a><span class=c1># sys:centos6.x/7.x</span>
<a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a>
<a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a><span class=o>[</span><span class=w> </span><span class=k>$(</span>id<span class=w> </span>-u<span class=k>)</span><span class=w> </span>-gt<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;请用root用户执行此脚本！&quot;</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nb>exit</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a><span class=nv>sysversion</span><span class=o>=</span><span class=k>$(</span>rpm<span class=w> </span>-q<span class=w> </span>centos-release<span class=p>|</span>cut<span class=w> </span>-d-<span class=w> </span>-f3<span class=k>)</span>
<a id=__codelineno-11-9 name=__codelineno-11-9 href=#__codelineno-11-9></a><span class=nv>line</span><span class=o>=</span><span class=s2>&quot;-------------------------------------------------&quot;</span>
<a id=__codelineno-11-10 name=__codelineno-11-10 href=#__codelineno-11-10></a>
<a id=__codelineno-11-11 name=__codelineno-11-11 href=#__codelineno-11-11></a>
<a id=__codelineno-11-12 name=__codelineno-11-12 href=#__codelineno-11-12></a><span class=o>[</span><span class=w> </span>-d<span class=w> </span>logs<span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>||</span><span class=w> </span>mkdir<span class=w> </span>logs
<a id=__codelineno-11-13 name=__codelineno-11-13 href=#__codelineno-11-13></a>
<a id=__codelineno-11-14 name=__codelineno-11-14 href=#__codelineno-11-14></a><span class=nv>sys_check_file</span><span class=o>=</span><span class=s2>&quot;logs/</span><span class=k>$(</span>ip<span class=w> </span>a<span class=w> </span>show<span class=w> </span>dev<span class=w> </span>eth0<span class=p>|</span>grep<span class=w> </span>-w<span class=w> </span>inet<span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;{print $2}&#39;</span><span class=p>|</span>awk<span class=w> </span>-F<span class=w> </span><span class=s1>&#39;/&#39;</span><span class=w> </span><span class=s1>&#39;{print $1}&#39;</span><span class=k>)</span><span class=s2>-`date +%Y%m%d`.txt&quot;</span>
<a id=__codelineno-11-15 name=__codelineno-11-15 href=#__codelineno-11-15></a>
<a id=__codelineno-11-16 name=__codelineno-11-16 href=#__codelineno-11-16></a><span class=c1># 获取系统cpu信息</span>
<a id=__codelineno-11-17 name=__codelineno-11-17 href=#__codelineno-11-17></a><span class=k>function</span><span class=w> </span>get_cpu_info<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-11-18 name=__codelineno-11-18 href=#__codelineno-11-18></a><span class=w>    </span><span class=nv>Physical_CPUs</span><span class=o>=</span><span class=k>$(</span>grep<span class=w> </span><span class=s2>&quot;physical id&quot;</span><span class=w> </span>/proc/cpuinfo<span class=p>|</span><span class=w> </span>sort<span class=w> </span><span class=p>|</span><span class=w> </span>uniq<span class=w> </span><span class=p>|</span><span class=w> </span>wc<span class=w> </span>-l<span class=k>)</span>
<a id=__codelineno-11-19 name=__codelineno-11-19 href=#__codelineno-11-19></a><span class=w>    </span><span class=nv>Virt_CPUs</span><span class=o>=</span><span class=k>$(</span>grep<span class=w> </span><span class=s2>&quot;processor&quot;</span><span class=w> </span>/proc/cpuinfo<span class=w> </span><span class=p>|</span><span class=w> </span>wc<span class=w> </span>-l<span class=k>)</span>
<a id=__codelineno-11-20 name=__codelineno-11-20 href=#__codelineno-11-20></a><span class=w>    </span><span class=nv>CPU_Kernels</span><span class=o>=</span><span class=k>$(</span>grep<span class=w> </span><span class=s2>&quot;cores&quot;</span><span class=w> </span>/proc/cpuinfo<span class=p>|</span>uniq<span class=p>|</span><span class=w> </span>awk<span class=w> </span>-F<span class=w> </span><span class=s1>&#39;: &#39;</span><span class=w> </span><span class=s1>&#39;{print $2}&#39;</span><span class=k>)</span>
<a id=__codelineno-11-21 name=__codelineno-11-21 href=#__codelineno-11-21></a><span class=w>    </span><span class=nv>CPU_Type</span><span class=o>=</span><span class=k>$(</span>grep<span class=w> </span><span class=s2>&quot;model name&quot;</span><span class=w> </span>/proc/cpuinfo<span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span>-F<span class=w> </span><span class=s1>&#39;: &#39;</span><span class=w> </span><span class=s1>&#39;{print $2}&#39;</span><span class=w> </span><span class=p>|</span><span class=w> </span>sort<span class=w> </span><span class=p>|</span><span class=w> </span>uniq<span class=k>)</span>
<a id=__codelineno-11-22 name=__codelineno-11-22 href=#__codelineno-11-22></a><span class=w>    </span><span class=nv>CPU_Arch</span><span class=o>=</span><span class=k>$(</span>uname<span class=w> </span>-m<span class=k>)</span>
<a id=__codelineno-11-23 name=__codelineno-11-23 href=#__codelineno-11-23></a>cat<span class=w> </span><span class=s>&lt;&lt;EOF | column -t</span>
<a id=__codelineno-11-24 name=__codelineno-11-24 href=#__codelineno-11-24></a><span class=s>CPU信息:</span>
<a id=__codelineno-11-25 name=__codelineno-11-25 href=#__codelineno-11-25></a>
<a id=__codelineno-11-26 name=__codelineno-11-26 href=#__codelineno-11-26></a><span class=s>物理CPU个数: $Physical_CPUs</span>
<a id=__codelineno-11-27 name=__codelineno-11-27 href=#__codelineno-11-27></a><span class=s>逻辑CPU个数: $Virt_CPUs</span>
<a id=__codelineno-11-28 name=__codelineno-11-28 href=#__codelineno-11-28></a><span class=s>每CPU核心数: $CPU_Kernels</span>
<a id=__codelineno-11-29 name=__codelineno-11-29 href=#__codelineno-11-29></a><span class=s>CPU型号: $CPU_Type</span>
<a id=__codelineno-11-30 name=__codelineno-11-30 href=#__codelineno-11-30></a><span class=s>CPU架构: $CPU_Arch</span>
<a id=__codelineno-11-31 name=__codelineno-11-31 href=#__codelineno-11-31></a><span class=s>EOF</span>
<a id=__codelineno-11-32 name=__codelineno-11-32 href=#__codelineno-11-32></a><span class=o>}</span>
<a id=__codelineno-11-33 name=__codelineno-11-33 href=#__codelineno-11-33></a>
<a id=__codelineno-11-34 name=__codelineno-11-34 href=#__codelineno-11-34></a><span class=c1># 获取系统内存信息</span>
<a id=__codelineno-11-35 name=__codelineno-11-35 href=#__codelineno-11-35></a><span class=k>function</span><span class=w> </span>get_mem_info<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-11-36 name=__codelineno-11-36 href=#__codelineno-11-36></a><span class=w>    </span><span class=nv>check_mem</span><span class=o>=</span><span class=k>$(</span>free<span class=w> </span>-m<span class=k>)</span>
<a id=__codelineno-11-37 name=__codelineno-11-37 href=#__codelineno-11-37></a><span class=w>    </span><span class=nv>MemTotal</span><span class=o>=</span><span class=k>$(</span>grep<span class=w> </span>MemTotal<span class=w> </span>/proc/meminfo<span class=p>|</span><span class=w> </span>awk<span class=w> </span><span class=s1>&#39;{print $2}&#39;</span><span class=k>)</span><span class=w>  </span><span class=c1>#KB</span>
<a id=__codelineno-11-38 name=__codelineno-11-38 href=#__codelineno-11-38></a><span class=w>    </span><span class=nv>MemFree</span><span class=o>=</span><span class=k>$(</span>grep<span class=w> </span>MemFree<span class=w> </span>/proc/meminfo<span class=p>|</span><span class=w> </span>awk<span class=w> </span><span class=s1>&#39;{print $2}&#39;</span><span class=k>)</span><span class=w>    </span><span class=c1>#KB</span>
<a id=__codelineno-11-39 name=__codelineno-11-39 href=#__codelineno-11-39></a><span class=w>    </span><span class=nb>let</span><span class=w> </span><span class=nv>MemUsed</span><span class=o>=</span>MemTotal-MemFree
<a id=__codelineno-11-40 name=__codelineno-11-40 href=#__codelineno-11-40></a><span class=w>    </span><span class=nv>MemPercent</span><span class=o>=</span><span class=k>$(</span>awk<span class=w> </span><span class=s2>&quot;BEGIN {if(</span><span class=nv>$MemTotal</span><span class=s2>==0){printf 100}else{printf \&quot;%.2f\&quot;,</span><span class=nv>$MemUsed</span><span class=s2>*100/</span><span class=nv>$MemTotal</span><span class=s2>}}&quot;</span><span class=k>)</span>
<a id=__codelineno-11-41 name=__codelineno-11-41 href=#__codelineno-11-41></a><span class=w>    </span><span class=nv>report_MemTotal</span><span class=o>=</span><span class=s2>&quot;</span><span class=k>$((</span><span class=nv>MemTotal</span><span class=o>/</span><span class=m>1024</span><span class=k>))</span><span class=s2>&quot;&quot;MB&quot;</span><span class=w>        </span><span class=c1>#内存总容量(MB)</span>
<a id=__codelineno-11-42 name=__codelineno-11-42 href=#__codelineno-11-42></a><span class=w>    </span><span class=nv>report_MemFree</span><span class=o>=</span><span class=s2>&quot;</span><span class=k>$((</span><span class=nv>MemFree</span><span class=o>/</span><span class=m>1024</span><span class=k>))</span><span class=s2>&quot;&quot;MB&quot;</span><span class=w>          </span><span class=c1>#内存剩余(MB)</span>
<a id=__codelineno-11-43 name=__codelineno-11-43 href=#__codelineno-11-43></a><span class=w>    </span><span class=nv>report_MemUsedPercent</span><span class=o>=</span><span class=s2>&quot;</span><span class=k>$(</span>awk<span class=w> </span><span class=s2>&quot;BEGIN {if(</span><span class=nv>$MemTotal</span><span class=s2>==0){printf 100}else{printf \&quot;%.2f\&quot;,</span><span class=nv>$MemUsed</span><span class=s2>*100/</span><span class=nv>$MemTotal</span><span class=s2>}}&quot;</span><span class=k>)</span><span class=s2>&quot;&quot;%&quot;</span><span class=w>   </span><span class=c1>#内存使用率%</span>
<a id=__codelineno-11-44 name=__codelineno-11-44 href=#__codelineno-11-44></a>
<a id=__codelineno-11-45 name=__codelineno-11-45 href=#__codelineno-11-45></a>cat<span class=w> </span><span class=s>&lt;&lt;EOF</span>
<a id=__codelineno-11-46 name=__codelineno-11-46 href=#__codelineno-11-46></a><span class=s>内存信息：</span>
<a id=__codelineno-11-47 name=__codelineno-11-47 href=#__codelineno-11-47></a>
<a id=__codelineno-11-48 name=__codelineno-11-48 href=#__codelineno-11-48></a><span class=s>${check_mem}</span>
<a id=__codelineno-11-49 name=__codelineno-11-49 href=#__codelineno-11-49></a><span class=s>EOF</span>
<a id=__codelineno-11-50 name=__codelineno-11-50 href=#__codelineno-11-50></a><span class=o>}</span>
<a id=__codelineno-11-51 name=__codelineno-11-51 href=#__codelineno-11-51></a>
<a id=__codelineno-11-52 name=__codelineno-11-52 href=#__codelineno-11-52></a><span class=c1># 获取系统网络信息</span>
<a id=__codelineno-11-53 name=__codelineno-11-53 href=#__codelineno-11-53></a><span class=k>function</span><span class=w> </span>get_net_info<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-11-54 name=__codelineno-11-54 href=#__codelineno-11-54></a><span class=w>    </span><span class=nv>pri_ipadd</span><span class=o>=</span><span class=k>$(</span>ip<span class=w> </span>a<span class=w> </span>show<span class=w> </span>dev<span class=w> </span>eth0<span class=p>|</span>grep<span class=w> </span>-w<span class=w> </span>inet<span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;{print $2}&#39;</span><span class=p>|</span>awk<span class=w> </span>-F<span class=w> </span><span class=s1>&#39;/&#39;</span><span class=w> </span><span class=s1>&#39;{print $1}&#39;</span><span class=k>)</span>
<a id=__codelineno-11-55 name=__codelineno-11-55 href=#__codelineno-11-55></a><span class=w>    </span><span class=nv>pub_ipadd</span><span class=o>=</span><span class=k>$(</span>curl<span class=w> </span>ifconfig.me<span class=w> </span>-s<span class=k>)</span>
<a id=__codelineno-11-56 name=__codelineno-11-56 href=#__codelineno-11-56></a><span class=w>    </span><span class=nv>gateway</span><span class=o>=</span><span class=k>$(</span>ip<span class=w> </span>route<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>default<span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span><span class=s1>&#39;{print $3}&#39;</span><span class=k>)</span>
<a id=__codelineno-11-57 name=__codelineno-11-57 href=#__codelineno-11-57></a><span class=w>    </span><span class=nv>mac_info</span><span class=o>=</span><span class=k>$(</span>ip<span class=w> </span>link<span class=p>|</span><span class=w> </span>egrep<span class=w> </span>-v<span class=w> </span><span class=s2>&quot;lo&quot;</span><span class=p>|</span>grep<span class=w> </span>link<span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;{print $2}&#39;</span><span class=k>)</span>
<a id=__codelineno-11-58 name=__codelineno-11-58 href=#__codelineno-11-58></a><span class=w>    </span><span class=nv>dns_config</span><span class=o>=</span><span class=k>$(</span>egrep<span class=w> </span>-v<span class=w> </span><span class=s2>&quot;^</span>$<span class=s2>|^#&quot;</span><span class=w> </span>/etc/resolv.conf<span class=k>)</span>
<a id=__codelineno-11-59 name=__codelineno-11-59 href=#__codelineno-11-59></a><span class=w>    </span><span class=nv>route_info</span><span class=o>=</span><span class=k>$(</span>route<span class=w> </span>-n<span class=k>)</span>
<a id=__codelineno-11-60 name=__codelineno-11-60 href=#__codelineno-11-60></a>cat<span class=w> </span><span class=s>&lt;&lt;EOF | column -t</span>
<a id=__codelineno-11-61 name=__codelineno-11-61 href=#__codelineno-11-61></a><span class=s>IP信息:</span>
<a id=__codelineno-11-62 name=__codelineno-11-62 href=#__codelineno-11-62></a>
<a id=__codelineno-11-63 name=__codelineno-11-63 href=#__codelineno-11-63></a><span class=s>系统公网地址: ${pub_ipadd}</span>
<a id=__codelineno-11-64 name=__codelineno-11-64 href=#__codelineno-11-64></a><span class=s>系统私网地址: ${pri_ipadd}</span>
<a id=__codelineno-11-65 name=__codelineno-11-65 href=#__codelineno-11-65></a><span class=s>网关地址: ${gateway}</span>
<a id=__codelineno-11-66 name=__codelineno-11-66 href=#__codelineno-11-66></a><span class=s>MAC地址: ${mac_info}</span>
<a id=__codelineno-11-67 name=__codelineno-11-67 href=#__codelineno-11-67></a>
<a id=__codelineno-11-68 name=__codelineno-11-68 href=#__codelineno-11-68></a><span class=s>路由信息:</span>
<a id=__codelineno-11-69 name=__codelineno-11-69 href=#__codelineno-11-69></a><span class=s>${route_info}</span>
<a id=__codelineno-11-70 name=__codelineno-11-70 href=#__codelineno-11-70></a>
<a id=__codelineno-11-71 name=__codelineno-11-71 href=#__codelineno-11-71></a><span class=s>DNS 信息:</span>
<a id=__codelineno-11-72 name=__codelineno-11-72 href=#__codelineno-11-72></a><span class=s>${dns_config}</span>
<a id=__codelineno-11-73 name=__codelineno-11-73 href=#__codelineno-11-73></a><span class=s>EOF</span>
<a id=__codelineno-11-74 name=__codelineno-11-74 href=#__codelineno-11-74></a><span class=o>}</span>
<a id=__codelineno-11-75 name=__codelineno-11-75 href=#__codelineno-11-75></a>
<a id=__codelineno-11-76 name=__codelineno-11-76 href=#__codelineno-11-76></a><span class=c1># 获取系统磁盘信息</span>
<a id=__codelineno-11-77 name=__codelineno-11-77 href=#__codelineno-11-77></a><span class=k>function</span><span class=w> </span>get_disk_info<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-11-78 name=__codelineno-11-78 href=#__codelineno-11-78></a><span class=w>    </span><span class=nv>disk_info</span><span class=o>=</span><span class=k>$(</span>fdisk<span class=w> </span>-l<span class=p>|</span>grep<span class=w> </span><span class=s2>&quot;Disk /dev&quot;</span><span class=p>|</span>cut<span class=w> </span>-d,<span class=w> </span>-f1<span class=k>)</span>
<a id=__codelineno-11-79 name=__codelineno-11-79 href=#__codelineno-11-79></a><span class=w>    </span><span class=nv>disk_use</span><span class=o>=</span><span class=k>$(</span>df<span class=w> </span>-hTP<span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;$2!=&quot;tmpfs&quot;{print}&#39;</span><span class=k>)</span>
<a id=__codelineno-11-80 name=__codelineno-11-80 href=#__codelineno-11-80></a><span class=w>    </span><span class=nv>disk_inode</span><span class=o>=</span><span class=k>$(</span>df<span class=w> </span>-hiP<span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;$1!=&quot;tmpfs&quot;{print}&#39;</span><span class=k>)</span>
<a id=__codelineno-11-81 name=__codelineno-11-81 href=#__codelineno-11-81></a>
<a id=__codelineno-11-82 name=__codelineno-11-82 href=#__codelineno-11-82></a>cat<span class=w> </span><span class=s>&lt;&lt;EOF</span>
<a id=__codelineno-11-83 name=__codelineno-11-83 href=#__codelineno-11-83></a><span class=s>磁盘信息:</span>
<a id=__codelineno-11-84 name=__codelineno-11-84 href=#__codelineno-11-84></a>
<a id=__codelineno-11-85 name=__codelineno-11-85 href=#__codelineno-11-85></a><span class=s>${disk_info}</span>
<a id=__codelineno-11-86 name=__codelineno-11-86 href=#__codelineno-11-86></a><span class=s>磁盘使用:</span>
<a id=__codelineno-11-87 name=__codelineno-11-87 href=#__codelineno-11-87></a>
<a id=__codelineno-11-88 name=__codelineno-11-88 href=#__codelineno-11-88></a><span class=s>${disk_use}</span>
<a id=__codelineno-11-89 name=__codelineno-11-89 href=#__codelineno-11-89></a><span class=s>inode信息:</span>
<a id=__codelineno-11-90 name=__codelineno-11-90 href=#__codelineno-11-90></a>
<a id=__codelineno-11-91 name=__codelineno-11-91 href=#__codelineno-11-91></a><span class=s>${disk_inode}</span>
<a id=__codelineno-11-92 name=__codelineno-11-92 href=#__codelineno-11-92></a><span class=s>EOF</span>
<a id=__codelineno-11-93 name=__codelineno-11-93 href=#__codelineno-11-93></a>
<a id=__codelineno-11-94 name=__codelineno-11-94 href=#__codelineno-11-94></a>
<a id=__codelineno-11-95 name=__codelineno-11-95 href=#__codelineno-11-95></a><span class=o>}</span>
<a id=__codelineno-11-96 name=__codelineno-11-96 href=#__codelineno-11-96></a>
<a id=__codelineno-11-97 name=__codelineno-11-97 href=#__codelineno-11-97></a><span class=c1># 获取系统信息</span>
<a id=__codelineno-11-98 name=__codelineno-11-98 href=#__codelineno-11-98></a><span class=k>function</span><span class=w> </span>get_systatus_info<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-11-99 name=__codelineno-11-99 href=#__codelineno-11-99></a><span class=w>    </span><span class=nv>sys_os</span><span class=o>=</span><span class=k>$(</span>uname<span class=w> </span>-o<span class=k>)</span>
<a id=__codelineno-11-100 name=__codelineno-11-100 href=#__codelineno-11-100></a><span class=w>    </span><span class=nv>sys_release</span><span class=o>=</span><span class=k>$(</span>cat<span class=w> </span>/etc/redhat-release<span class=k>)</span>
<a id=__codelineno-11-101 name=__codelineno-11-101 href=#__codelineno-11-101></a><span class=w>    </span><span class=nv>sys_kernel</span><span class=o>=</span><span class=k>$(</span>uname<span class=w> </span>-r<span class=k>)</span>
<a id=__codelineno-11-102 name=__codelineno-11-102 href=#__codelineno-11-102></a><span class=w>    </span><span class=nv>sys_hostname</span><span class=o>=</span><span class=k>$(</span>hostname<span class=k>)</span>
<a id=__codelineno-11-103 name=__codelineno-11-103 href=#__codelineno-11-103></a><span class=w>    </span><span class=nv>sys_selinux</span><span class=o>=</span><span class=k>$(</span>getenforce<span class=k>)</span>
<a id=__codelineno-11-104 name=__codelineno-11-104 href=#__codelineno-11-104></a><span class=w>    </span><span class=nv>sys_lang</span><span class=o>=</span><span class=k>$(</span><span class=nb>echo</span><span class=w> </span><span class=nv>$LANG</span><span class=k>)</span>
<a id=__codelineno-11-105 name=__codelineno-11-105 href=#__codelineno-11-105></a><span class=w>    </span><span class=nv>sys_lastreboot</span><span class=o>=</span><span class=k>$(</span>who<span class=w> </span>-b<span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span><span class=s1>&#39;{print $3,$4}&#39;</span><span class=k>)</span>
<a id=__codelineno-11-106 name=__codelineno-11-106 href=#__codelineno-11-106></a><span class=w>    </span><span class=nv>sys_runtime</span><span class=o>=</span><span class=k>$(</span>uptime<span class=w> </span><span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;{print  $3,$4}&#39;</span><span class=p>|</span>cut<span class=w> </span>-d,<span class=w> </span>-f1<span class=k>)</span>
<a id=__codelineno-11-107 name=__codelineno-11-107 href=#__codelineno-11-107></a><span class=w>    </span><span class=nv>sys_time</span><span class=o>=</span><span class=k>$(</span>date<span class=k>)</span>
<a id=__codelineno-11-108 name=__codelineno-11-108 href=#__codelineno-11-108></a><span class=w>    </span><span class=nv>sys_load</span><span class=o>=</span><span class=k>$(</span>uptime<span class=w> </span><span class=p>|</span>cut<span class=w> </span>-d:<span class=w> </span>-f5<span class=k>)</span>
<a id=__codelineno-11-109 name=__codelineno-11-109 href=#__codelineno-11-109></a>
<a id=__codelineno-11-110 name=__codelineno-11-110 href=#__codelineno-11-110></a>cat<span class=w> </span><span class=s>&lt;&lt;EOF | column -t</span>
<a id=__codelineno-11-111 name=__codelineno-11-111 href=#__codelineno-11-111></a><span class=s>系统信息:</span>
<a id=__codelineno-11-112 name=__codelineno-11-112 href=#__codelineno-11-112></a>
<a id=__codelineno-11-113 name=__codelineno-11-113 href=#__codelineno-11-113></a><span class=s>系统: ${sys_os}</span>
<a id=__codelineno-11-114 name=__codelineno-11-114 href=#__codelineno-11-114></a><span class=s>发行版本:   ${sys_release}</span>
<a id=__codelineno-11-115 name=__codelineno-11-115 href=#__codelineno-11-115></a><span class=s>系统内核:   ${sys_kernel}</span>
<a id=__codelineno-11-116 name=__codelineno-11-116 href=#__codelineno-11-116></a><span class=s>主机名:    ${sys_hostname}</span>
<a id=__codelineno-11-117 name=__codelineno-11-117 href=#__codelineno-11-117></a><span class=s>selinux状态:  ${sys_selinux}</span>
<a id=__codelineno-11-118 name=__codelineno-11-118 href=#__codelineno-11-118></a><span class=s>系统语言:   ${sys_lang}</span>
<a id=__codelineno-11-119 name=__codelineno-11-119 href=#__codelineno-11-119></a><span class=s>系统当前时间: ${sys_time}</span>
<a id=__codelineno-11-120 name=__codelineno-11-120 href=#__codelineno-11-120></a><span class=s>系统最后重启时间:   ${sys_lastreboot}</span>
<a id=__codelineno-11-121 name=__codelineno-11-121 href=#__codelineno-11-121></a><span class=s>系统运行时间: ${sys_runtime}</span>
<a id=__codelineno-11-122 name=__codelineno-11-122 href=#__codelineno-11-122></a><span class=s>系统负载:   ${sys_load}</span>
<a id=__codelineno-11-123 name=__codelineno-11-123 href=#__codelineno-11-123></a><span class=s>EOF</span>
<a id=__codelineno-11-124 name=__codelineno-11-124 href=#__codelineno-11-124></a><span class=o>}</span>
<a id=__codelineno-11-125 name=__codelineno-11-125 href=#__codelineno-11-125></a>
<a id=__codelineno-11-126 name=__codelineno-11-126 href=#__codelineno-11-126></a><span class=c1># 获取服务信息</span>
<a id=__codelineno-11-127 name=__codelineno-11-127 href=#__codelineno-11-127></a><span class=k>function</span><span class=w> </span>get_service_info<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-11-128 name=__codelineno-11-128 href=#__codelineno-11-128></a><span class=w>    </span><span class=nv>port_listen</span><span class=o>=</span><span class=k>$(</span>netstat<span class=w> </span>-lntup<span class=p>|</span>grep<span class=w> </span>-v<span class=w> </span><span class=s2>&quot;Active Internet&quot;</span><span class=k>)</span>
<a id=__codelineno-11-129 name=__codelineno-11-129 href=#__codelineno-11-129></a><span class=w>    </span><span class=nv>kernel_config</span><span class=o>=</span><span class=k>$(</span>sysctl<span class=w> </span>-p<span class=w> </span><span class=m>2</span>&gt;/dev/null<span class=k>)</span>
<a id=__codelineno-11-130 name=__codelineno-11-130 href=#__codelineno-11-130></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=si>${</span><span class=nv>sysversion</span><span class=si>}</span><span class=w> </span>-gt<span class=w> </span><span class=m>6</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=k>then</span>
<a id=__codelineno-11-131 name=__codelineno-11-131 href=#__codelineno-11-131></a><span class=w>        </span><span class=nv>service_config</span><span class=o>=</span><span class=k>$(</span>systemctl<span class=w> </span>list-unit-files<span class=w> </span>--type<span class=o>=</span>service<span class=w> </span>--state<span class=o>=</span>enabled<span class=p>|</span>grep<span class=w> </span><span class=s2>&quot;enabled&quot;</span><span class=k>)</span>
<a id=__codelineno-11-132 name=__codelineno-11-132 href=#__codelineno-11-132></a><span class=w>        </span><span class=nv>run_service</span><span class=o>=</span><span class=k>$(</span>systemctl<span class=w> </span>list-units<span class=w> </span>--type<span class=o>=</span>service<span class=w> </span>--state<span class=o>=</span>running<span class=w> </span><span class=p>|</span>grep<span class=w> </span><span class=s2>&quot;.service&quot;</span><span class=k>)</span>
<a id=__codelineno-11-133 name=__codelineno-11-133 href=#__codelineno-11-133></a><span class=w>    </span><span class=k>else</span>
<a id=__codelineno-11-134 name=__codelineno-11-134 href=#__codelineno-11-134></a><span class=w>        </span><span class=nv>service_config</span><span class=o>=</span><span class=k>$(</span>/sbin/chkconfig<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>-E<span class=w> </span><span class=s2>&quot;:on|:启用&quot;</span><span class=w> </span><span class=p>|</span>column<span class=w> </span>-t<span class=k>)</span>
<a id=__codelineno-11-135 name=__codelineno-11-135 href=#__codelineno-11-135></a><span class=w>        </span><span class=nv>run_service</span><span class=o>=</span><span class=k>$(</span>/sbin/service<span class=w> </span>--status-all<span class=p>|</span>grep<span class=w> </span>-E<span class=w> </span><span class=s2>&quot;running&quot;</span><span class=k>)</span>
<a id=__codelineno-11-136 name=__codelineno-11-136 href=#__codelineno-11-136></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-11-137 name=__codelineno-11-137 href=#__codelineno-11-137></a>cat<span class=w> </span><span class=s>&lt;&lt;EOF</span>
<a id=__codelineno-11-138 name=__codelineno-11-138 href=#__codelineno-11-138></a><span class=s>服务启动配置:</span>
<a id=__codelineno-11-139 name=__codelineno-11-139 href=#__codelineno-11-139></a>
<a id=__codelineno-11-140 name=__codelineno-11-140 href=#__codelineno-11-140></a><span class=s>${service_config}</span>
<a id=__codelineno-11-141 name=__codelineno-11-141 href=#__codelineno-11-141></a><span class=s>${line}</span>
<a id=__codelineno-11-142 name=__codelineno-11-142 href=#__codelineno-11-142></a><span class=s>运行的服务:</span>
<a id=__codelineno-11-143 name=__codelineno-11-143 href=#__codelineno-11-143></a>
<a id=__codelineno-11-144 name=__codelineno-11-144 href=#__codelineno-11-144></a><span class=s>${run_service}</span>
<a id=__codelineno-11-145 name=__codelineno-11-145 href=#__codelineno-11-145></a><span class=s>${line}</span>
<a id=__codelineno-11-146 name=__codelineno-11-146 href=#__codelineno-11-146></a><span class=s>监听端口:</span>
<a id=__codelineno-11-147 name=__codelineno-11-147 href=#__codelineno-11-147></a>
<a id=__codelineno-11-148 name=__codelineno-11-148 href=#__codelineno-11-148></a><span class=s>${port_listen}</span>
<a id=__codelineno-11-149 name=__codelineno-11-149 href=#__codelineno-11-149></a><span class=s>${line}</span>
<a id=__codelineno-11-150 name=__codelineno-11-150 href=#__codelineno-11-150></a><span class=s>内核参考配置:</span>
<a id=__codelineno-11-151 name=__codelineno-11-151 href=#__codelineno-11-151></a>
<a id=__codelineno-11-152 name=__codelineno-11-152 href=#__codelineno-11-152></a><span class=s>${kernel_config}</span>
<a id=__codelineno-11-153 name=__codelineno-11-153 href=#__codelineno-11-153></a><span class=s>EOF</span>
<a id=__codelineno-11-154 name=__codelineno-11-154 href=#__codelineno-11-154></a><span class=o>}</span>
<a id=__codelineno-11-155 name=__codelineno-11-155 href=#__codelineno-11-155></a>
<a id=__codelineno-11-156 name=__codelineno-11-156 href=#__codelineno-11-156></a>
<a id=__codelineno-11-157 name=__codelineno-11-157 href=#__codelineno-11-157></a><span class=k>function</span><span class=w> </span>get_sys_user<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-11-158 name=__codelineno-11-158 href=#__codelineno-11-158></a><span class=w>    </span><span class=nv>login_user</span><span class=o>=</span><span class=k>$(</span>awk<span class=w> </span>-F:<span class=w> </span><span class=s1>&#39;{if ($NF==&quot;/bin/bash&quot;) print $0}&#39;</span><span class=w> </span>/etc/passwd<span class=k>)</span>
<a id=__codelineno-11-159 name=__codelineno-11-159 href=#__codelineno-11-159></a><span class=w>    </span><span class=nv>ssh_config</span><span class=o>=</span><span class=k>$(</span>egrep<span class=w> </span>-v<span class=w> </span><span class=s2>&quot;^#|^</span>$<span class=s2>&quot;</span><span class=w> </span>/etc/ssh/sshd_config<span class=k>)</span>
<a id=__codelineno-11-160 name=__codelineno-11-160 href=#__codelineno-11-160></a><span class=w>    </span><span class=nv>sudo_config</span><span class=o>=</span><span class=k>$(</span>egrep<span class=w> </span>-v<span class=w> </span><span class=s2>&quot;^#|^</span>$<span class=s2>&quot;</span><span class=w> </span>/etc/sudoers<span class=w> </span><span class=p>|</span>grep<span class=w> </span>-v<span class=w> </span><span class=s2>&quot;^Defaults&quot;</span><span class=k>)</span>
<a id=__codelineno-11-161 name=__codelineno-11-161 href=#__codelineno-11-161></a><span class=w>    </span><span class=nv>host_config</span><span class=o>=</span><span class=k>$(</span>egrep<span class=w> </span>-v<span class=w> </span><span class=s2>&quot;^#|^</span>$<span class=s2>&quot;</span><span class=w> </span>/etc/hosts<span class=k>)</span>
<a id=__codelineno-11-162 name=__codelineno-11-162 href=#__codelineno-11-162></a><span class=w>    </span><span class=nv>crond_config</span><span class=o>=</span><span class=k>$(for</span><span class=w> </span>cronuser<span class=w> </span><span class=k>in</span><span class=w> </span>/var/spool/cron/*<span class=w> </span><span class=p>;</span><span class=k>do</span><span class=w> </span>ls<span class=w> </span><span class=si>${</span><span class=nv>cronuser</span><span class=si>}</span><span class=w> </span><span class=m>2</span>&gt;/dev/null<span class=p>|</span>cut<span class=w> </span>-d/<span class=w> </span>-f5<span class=p>;</span>egrep<span class=w> </span>-v<span class=w> </span><span class=s2>&quot;^</span>$<span class=s2>|^#&quot;</span><span class=w> </span><span class=si>${</span><span class=nv>cronuser</span><span class=si>}</span><span class=w> </span><span class=m>2</span>&gt;/dev/null<span class=p>;</span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;&quot;</span><span class=p>;</span><span class=k>done)</span>
<a id=__codelineno-11-163 name=__codelineno-11-163 href=#__codelineno-11-163></a>cat<span class=w> </span><span class=s>&lt;&lt;EOF</span>
<a id=__codelineno-11-164 name=__codelineno-11-164 href=#__codelineno-11-164></a><span class=s>系统登录用户:</span>
<a id=__codelineno-11-165 name=__codelineno-11-165 href=#__codelineno-11-165></a>
<a id=__codelineno-11-166 name=__codelineno-11-166 href=#__codelineno-11-166></a><span class=s>${login_user}</span>
<a id=__codelineno-11-167 name=__codelineno-11-167 href=#__codelineno-11-167></a><span class=s>${line}</span>
<a id=__codelineno-11-168 name=__codelineno-11-168 href=#__codelineno-11-168></a><span class=s>ssh 配置信息:</span>
<a id=__codelineno-11-169 name=__codelineno-11-169 href=#__codelineno-11-169></a>
<a id=__codelineno-11-170 name=__codelineno-11-170 href=#__codelineno-11-170></a><span class=s>${ssh_config}</span>
<a id=__codelineno-11-171 name=__codelineno-11-171 href=#__codelineno-11-171></a><span class=s>${line}</span>
<a id=__codelineno-11-172 name=__codelineno-11-172 href=#__codelineno-11-172></a><span class=s>sudo 配置用户:</span>
<a id=__codelineno-11-173 name=__codelineno-11-173 href=#__codelineno-11-173></a>
<a id=__codelineno-11-174 name=__codelineno-11-174 href=#__codelineno-11-174></a><span class=s>${sudo_config}</span>
<a id=__codelineno-11-175 name=__codelineno-11-175 href=#__codelineno-11-175></a><span class=s>${line}</span>
<a id=__codelineno-11-176 name=__codelineno-11-176 href=#__codelineno-11-176></a><span class=s>定时任务配置:</span>
<a id=__codelineno-11-177 name=__codelineno-11-177 href=#__codelineno-11-177></a>
<a id=__codelineno-11-178 name=__codelineno-11-178 href=#__codelineno-11-178></a><span class=s>${crond_config}</span>
<a id=__codelineno-11-179 name=__codelineno-11-179 href=#__codelineno-11-179></a><span class=s>${line}</span>
<a id=__codelineno-11-180 name=__codelineno-11-180 href=#__codelineno-11-180></a><span class=s>hosts 信息:</span>
<a id=__codelineno-11-181 name=__codelineno-11-181 href=#__codelineno-11-181></a>
<a id=__codelineno-11-182 name=__codelineno-11-182 href=#__codelineno-11-182></a><span class=s>${host_config}</span>
<a id=__codelineno-11-183 name=__codelineno-11-183 href=#__codelineno-11-183></a><span class=s>EOF</span>
<a id=__codelineno-11-184 name=__codelineno-11-184 href=#__codelineno-11-184></a><span class=o>}</span>
<a id=__codelineno-11-185 name=__codelineno-11-185 href=#__codelineno-11-185></a>
<a id=__codelineno-11-186 name=__codelineno-11-186 href=#__codelineno-11-186></a>
<a id=__codelineno-11-187 name=__codelineno-11-187 href=#__codelineno-11-187></a><span class=k>function</span><span class=w> </span>process_top_info<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-11-188 name=__codelineno-11-188 href=#__codelineno-11-188></a>
<a id=__codelineno-11-189 name=__codelineno-11-189 href=#__codelineno-11-189></a><span class=w>    </span><span class=nv>top_title</span><span class=o>=</span><span class=k>$(</span>top<span class=w> </span>-b<span class=w> </span>n1<span class=p>|</span>head<span class=w> </span>-7<span class=p>|</span>tail<span class=w> </span>-1<span class=k>)</span>
<a id=__codelineno-11-190 name=__codelineno-11-190 href=#__codelineno-11-190></a><span class=w>    </span><span class=nv>cpu_top10</span><span class=o>=</span><span class=k>$(</span>top<span class=w> </span>b<span class=w> </span>-n1<span class=w> </span><span class=p>|</span><span class=w> </span>head<span class=w> </span>-17<span class=w> </span><span class=p>|</span><span class=w> </span>tail<span class=w> </span>-10<span class=k>)</span>
<a id=__codelineno-11-191 name=__codelineno-11-191 href=#__codelineno-11-191></a><span class=w>    </span><span class=nv>mem_top10</span><span class=o>=</span><span class=k>$(</span>top<span class=w> </span>-b<span class=w> </span>n1<span class=p>|</span>head<span class=w> </span>-17<span class=p>|</span>tail<span class=w> </span>-10<span class=p>|</span>sort<span class=w> </span>-k10<span class=w> </span>-r<span class=k>)</span>
<a id=__codelineno-11-192 name=__codelineno-11-192 href=#__codelineno-11-192></a>
<a id=__codelineno-11-193 name=__codelineno-11-193 href=#__codelineno-11-193></a>cat<span class=w> </span><span class=s>&lt;&lt;EOF</span>
<a id=__codelineno-11-194 name=__codelineno-11-194 href=#__codelineno-11-194></a><span class=s>CPU占用top10:</span>
<a id=__codelineno-11-195 name=__codelineno-11-195 href=#__codelineno-11-195></a>
<a id=__codelineno-11-196 name=__codelineno-11-196 href=#__codelineno-11-196></a><span class=s>${top_title}</span>
<a id=__codelineno-11-197 name=__codelineno-11-197 href=#__codelineno-11-197></a><span class=s>${cpu_top10}</span>
<a id=__codelineno-11-198 name=__codelineno-11-198 href=#__codelineno-11-198></a>
<a id=__codelineno-11-199 name=__codelineno-11-199 href=#__codelineno-11-199></a><span class=s>内存占用top10:</span>
<a id=__codelineno-11-200 name=__codelineno-11-200 href=#__codelineno-11-200></a>
<a id=__codelineno-11-201 name=__codelineno-11-201 href=#__codelineno-11-201></a><span class=s>${top_title}</span>
<a id=__codelineno-11-202 name=__codelineno-11-202 href=#__codelineno-11-202></a><span class=s>${mem_top10}</span>
<a id=__codelineno-11-203 name=__codelineno-11-203 href=#__codelineno-11-203></a><span class=s>EOF</span>
<a id=__codelineno-11-204 name=__codelineno-11-204 href=#__codelineno-11-204></a><span class=o>}</span>
<a id=__codelineno-11-205 name=__codelineno-11-205 href=#__codelineno-11-205></a>
<a id=__codelineno-11-206 name=__codelineno-11-206 href=#__codelineno-11-206></a>
<a id=__codelineno-11-207 name=__codelineno-11-207 href=#__codelineno-11-207></a><span class=k>function</span><span class=w> </span>sys_check<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-11-208 name=__codelineno-11-208 href=#__codelineno-11-208></a><span class=w>    </span>get_cpu_info
<a id=__codelineno-11-209 name=__codelineno-11-209 href=#__codelineno-11-209></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=si>${</span><span class=nv>line</span><span class=si>}</span>
<a id=__codelineno-11-210 name=__codelineno-11-210 href=#__codelineno-11-210></a><span class=w>    </span>get_mem_info
<a id=__codelineno-11-211 name=__codelineno-11-211 href=#__codelineno-11-211></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=si>${</span><span class=nv>line</span><span class=si>}</span>
<a id=__codelineno-11-212 name=__codelineno-11-212 href=#__codelineno-11-212></a><span class=w>    </span>get_net_info
<a id=__codelineno-11-213 name=__codelineno-11-213 href=#__codelineno-11-213></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=si>${</span><span class=nv>line</span><span class=si>}</span>
<a id=__codelineno-11-214 name=__codelineno-11-214 href=#__codelineno-11-214></a><span class=w>    </span>get_disk_info
<a id=__codelineno-11-215 name=__codelineno-11-215 href=#__codelineno-11-215></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=si>${</span><span class=nv>line</span><span class=si>}</span>
<a id=__codelineno-11-216 name=__codelineno-11-216 href=#__codelineno-11-216></a><span class=w>    </span>get_systatus_info
<a id=__codelineno-11-217 name=__codelineno-11-217 href=#__codelineno-11-217></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=si>${</span><span class=nv>line</span><span class=si>}</span>
<a id=__codelineno-11-218 name=__codelineno-11-218 href=#__codelineno-11-218></a><span class=w>    </span>get_service_info
<a id=__codelineno-11-219 name=__codelineno-11-219 href=#__codelineno-11-219></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=si>${</span><span class=nv>line</span><span class=si>}</span>
<a id=__codelineno-11-220 name=__codelineno-11-220 href=#__codelineno-11-220></a><span class=w>    </span>get_sys_user
<a id=__codelineno-11-221 name=__codelineno-11-221 href=#__codelineno-11-221></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=si>${</span><span class=nv>line</span><span class=si>}</span>
<a id=__codelineno-11-222 name=__codelineno-11-222 href=#__codelineno-11-222></a><span class=w>    </span>process_top_info
<a id=__codelineno-11-223 name=__codelineno-11-223 href=#__codelineno-11-223></a><span class=o>}</span>
<a id=__codelineno-11-224 name=__codelineno-11-224 href=#__codelineno-11-224></a>
<a id=__codelineno-11-225 name=__codelineno-11-225 href=#__codelineno-11-225></a>sys_check<span class=w> </span>&gt;<span class=w> </span><span class=si>${</span><span class=nv>sys_check_file</span><span class=si>}</span>
</code></pre></div> <h3 id=71-监控-100-台服务器磁盘利用率脚本>7.1 监控 100 台服务器磁盘利用率脚本<a class=headerlink href=#71-监控-100-台服务器磁盘利用率脚本 title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a><span class=nv>HOST_INFO</span><span class=o>=</span>host.info
<a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a><span class=k>for</span><span class=w> </span>IP<span class=w> </span><span class=k>in</span><span class=w> </span><span class=k>$(</span>awk<span class=w> </span><span class=s1>&#39;/^[^#]/{print $1}&#39;</span><span class=w> </span><span class=nv>$HOST_INFO</span><span class=k>)</span><span class=p>;</span><span class=w> </span><span class=k>do</span>
<a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a><span class=w>    </span><span class=nv>USER</span><span class=o>=</span><span class=k>$(</span>awk<span class=w> </span>-v<span class=w> </span><span class=nv>ip</span><span class=o>=</span><span class=nv>$IP</span><span class=w> </span><span class=s1>&#39;ip==$1{print $2}&#39;</span><span class=w> </span><span class=nv>$HOST_INFO</span><span class=k>)</span>
<a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a><span class=w>    </span><span class=nv>PORT</span><span class=o>=</span><span class=k>$(</span>awk<span class=w> </span>-v<span class=w> </span><span class=nv>ip</span><span class=o>=</span><span class=nv>$IP</span><span class=w> </span><span class=s1>&#39;ip==$1{print $3}&#39;</span><span class=w> </span><span class=nv>$HOST_INFO</span><span class=k>)</span>
<a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a><span class=w>    </span><span class=nv>TMP_FILE</span><span class=o>=</span>/tmp/disk.tmp
<a id=__codelineno-12-7 name=__codelineno-12-7 href=#__codelineno-12-7></a><span class=w>    </span>ssh<span class=w> </span>-p<span class=w> </span><span class=nv>$PORT</span><span class=w> </span><span class=nv>$USER</span>@<span class=nv>$IP</span><span class=w> </span><span class=s1>&#39;df -h&#39;</span><span class=w> </span>&gt;<span class=w> </span><span class=nv>$TMP_FILE</span>
<a id=__codelineno-12-8 name=__codelineno-12-8 href=#__codelineno-12-8></a><span class=w>    </span><span class=nv>USE_RATE_LIST</span><span class=o>=</span><span class=k>$(</span>awk<span class=w> </span><span class=s1>&#39;BEGIN{OFS=&quot;=&quot;}/^\/dev/{print $NF,int($5)}&#39;</span><span class=w> </span><span class=nv>$TMP_FILE</span><span class=k>)</span>
<a id=__codelineno-12-9 name=__codelineno-12-9 href=#__codelineno-12-9></a><span class=w>    </span><span class=k>for</span><span class=w> </span>USE_RATE<span class=w> </span><span class=k>in</span><span class=w> </span><span class=nv>$USE_RATE_LIST</span><span class=p>;</span><span class=w> </span><span class=k>do</span>
<a id=__codelineno-12-10 name=__codelineno-12-10 href=#__codelineno-12-10></a><span class=w>        </span><span class=nv>PART_NAME</span><span class=o>=</span><span class=si>${</span><span class=nv>USE_RATE</span><span class=p>%=*</span><span class=si>}</span>
<a id=__codelineno-12-11 name=__codelineno-12-11 href=#__codelineno-12-11></a><span class=w>        </span><span class=nv>USE_RATE</span><span class=o>=</span><span class=si>${</span><span class=nv>USE_RATE</span><span class=p>#*=</span><span class=si>}</span>
<a id=__codelineno-12-12 name=__codelineno-12-12 href=#__codelineno-12-12></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=nv>$USE_RATE</span><span class=w> </span>-ge<span class=w> </span><span class=m>80</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-12-13 name=__codelineno-12-13 href=#__codelineno-12-13></a><span class=w>            </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Warning: </span><span class=nv>$PART_NAME</span><span class=s2> Partition usage </span><span class=nv>$USE_RATE</span><span class=s2>%!&quot;</span>
<a id=__codelineno-12-14 name=__codelineno-12-14 href=#__codelineno-12-14></a><span class=w>        </span><span class=k>fi</span>
<a id=__codelineno-12-15 name=__codelineno-12-15 href=#__codelineno-12-15></a><span class=w>    </span><span class=k>done</span>
<a id=__codelineno-12-16 name=__codelineno-12-16 href=#__codelineno-12-16></a><span class=k>done</span>
</code></pre></div> <h2 id=8启动脚本示例>8.启动脚本示例<a class=headerlink href=#8启动脚本示例 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=ch>#!/usr/bin/env bash</span>
<a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a><span class=c1>#?$Id:?gmond.init?180?2003-03-07?20:38:36Z?sacerdoti $</span>
<a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a><span class=c1># chkconfig:?2345?70?40</span>
<a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a><span class=c1># description:?gmond?startup?script</span>
<a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a>
<a id=__codelineno-13-6 name=__codelineno-13-6 href=#__codelineno-13-6></a><span class=c1>#定义变量GMOND，指定gmond守护进程路径</span>
<a id=__codelineno-13-7 name=__codelineno-13-7 href=#__codelineno-13-7></a><span class=nv>GMOND</span><span class=o>=</span>/usr/sbin/gmond
<a id=__codelineno-13-8 name=__codelineno-13-8 href=#__codelineno-13-8></a>
<a id=__codelineno-13-9 name=__codelineno-13-9 href=#__codelineno-13-9></a><span class=c1>#读取并执行文件 /etc/rc.d/init.d/functions的内容</span>
<a id=__codelineno-13-10 name=__codelineno-13-10 href=#__codelineno-13-10></a>.<span class=w> </span>/etc/rc.d/init.d/functions
<a id=__codelineno-13-11 name=__codelineno-13-11 href=#__codelineno-13-11></a>
<a id=__codelineno-13-12 name=__codelineno-13-12 href=#__codelineno-13-12></a><span class=c1>#定义变量RETVAL</span>
<a id=__codelineno-13-13 name=__codelineno-13-13 href=#__codelineno-13-13></a><span class=nv>RETVAL</span><span class=o>=</span><span class=m>0</span>
<a id=__codelineno-13-14 name=__codelineno-13-14 href=#__codelineno-13-14></a>
<a id=__codelineno-13-15 name=__codelineno-13-15 href=#__codelineno-13-15></a><span class=c1>#使用case语句来根据指定的不同参数，执行不同的行为</span>
<a id=__codelineno-13-16 name=__codelineno-13-16 href=#__codelineno-13-16></a><span class=k>case</span><span class=w> </span><span class=nv>$1</span><span class=w> </span><span class=k>in</span>
<a id=__codelineno-13-17 name=__codelineno-13-17 href=#__codelineno-13-17></a><span class=w>    </span>start<span class=o>)</span>
<a id=__codelineno-13-18 name=__codelineno-13-18 href=#__codelineno-13-18></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;Starting GANGLIA gmond: &quot;</span>
<a id=__codelineno-13-19 name=__codelineno-13-19 href=#__codelineno-13-19></a><span class=w>    </span><span class=c1>#如果gmond守护进程不存在，则退出脚本的执行，退出状态码为1</span>
<a id=__codelineno-13-20 name=__codelineno-13-20 href=#__codelineno-13-20></a><span class=w>    </span><span class=o>[</span><span class=w> </span>-f<span class=w> </span><span class=nv>$GMOND</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=nb>exit</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-13-21 name=__codelineno-13-21 href=#__codelineno-13-21></a><span class=w>    </span><span class=c1>#将gmond守护进程放在后台运行，daemon是function中的函数</span>
<a id=__codelineno-13-22 name=__codelineno-13-22 href=#__codelineno-13-22></a><span class=w>    </span>daemon<span class=w> </span><span class=nv>$GMOND</span>
<a id=__codelineno-13-23 name=__codelineno-13-23 href=#__codelineno-13-23></a><span class=w>    </span><span class=c1>#将上一命令的退出状态码赋值给变量RETVAL</span>
<a id=__codelineno-13-24 name=__codelineno-13-24 href=#__codelineno-13-24></a><span class=w>    </span><span class=nv>RETVAL</span><span class=o>=</span><span class=nv>$?</span>
<a id=__codelineno-13-25 name=__codelineno-13-25 href=#__codelineno-13-25></a><span class=w>    </span><span class=nb>echo</span>
<a id=__codelineno-13-26 name=__codelineno-13-26 href=#__codelineno-13-26></a><span class=w>    </span><span class=c1>##若gmond守护进程成功运行，则创建一个lock文件/var/lock/subsys/gmond</span>
<a id=__codelineno-13-27 name=__codelineno-13-27 href=#__codelineno-13-27></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=nv>$RETVAL</span><span class=w> </span>-eq<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>touch<span class=w> </span>/var/lock/subsys/gmond
<a id=__codelineno-13-28 name=__codelineno-13-28 href=#__codelineno-13-28></a><span class=w>   </span><span class=p>;;</span>
<a id=__codelineno-13-29 name=__codelineno-13-29 href=#__codelineno-13-29></a><span class=w>    </span>stop<span class=o>)</span>
<a id=__codelineno-13-30 name=__codelineno-13-30 href=#__codelineno-13-30></a><span class=w>        </span><span class=c1>#显示停止ganglia gmond的信息</span>
<a id=__codelineno-13-31 name=__codelineno-13-31 href=#__codelineno-13-31></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;Shutting down GANGLIA gmond: &quot;</span>
<a id=__codelineno-13-32 name=__codelineno-13-32 href=#__codelineno-13-32></a><span class=w>        </span><span class=c1>#停止gmond守护进程，killproc是functions中定义的函数</span>
<a id=__codelineno-13-33 name=__codelineno-13-33 href=#__codelineno-13-33></a><span class=w>        </span>killproc<span class=w> </span>gmond
<a id=__codelineno-13-34 name=__codelineno-13-34 href=#__codelineno-13-34></a><span class=w>        </span><span class=c1>#将上一命令的退出状态码赋值给变量RETVAL</span>
<a id=__codelineno-13-35 name=__codelineno-13-35 href=#__codelineno-13-35></a><span class=w>        </span><span class=nv>RETVAL</span><span class=o>=</span><span class=nv>$?</span>
<a id=__codelineno-13-36 name=__codelineno-13-36 href=#__codelineno-13-36></a><span class=w>        </span><span class=nb>echo</span>
<a id=__codelineno-13-37 name=__codelineno-13-37 href=#__codelineno-13-37></a><span class=w>        </span><span class=c1>#若gmond守护进程成功停止，则删除lock文件 /var/lock/subsys/gmond</span>
<a id=__codelineno-13-38 name=__codelineno-13-38 href=#__codelineno-13-38></a><span class=w>        </span><span class=o>[</span><span class=w> </span><span class=nv>$RETVAL</span><span class=w> </span>-eq<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>rm<span class=w> </span>-rf<span class=w> </span>/var/lock/subsys/gmond
<a id=__codelineno-13-39 name=__codelineno-13-39 href=#__codelineno-13-39></a><span class=w>   </span><span class=p>;;</span>
<a id=__codelineno-13-40 name=__codelineno-13-40 href=#__codelineno-13-40></a><span class=w>    </span>restart<span class=p>|</span>reload<span class=o>)</span>
<a id=__codelineno-13-41 name=__codelineno-13-41 href=#__codelineno-13-41></a><span class=w>        </span><span class=c1>#重新调用此脚本，命令行参数为stop</span>
<a id=__codelineno-13-42 name=__codelineno-13-42 href=#__codelineno-13-42></a><span class=w>        </span><span class=nv>$0</span><span class=w> </span>stop
<a id=__codelineno-13-43 name=__codelineno-13-43 href=#__codelineno-13-43></a><span class=w>        </span><span class=c1>#重新调用此脚本，命令行参数为start</span>
<a id=__codelineno-13-44 name=__codelineno-13-44 href=#__codelineno-13-44></a><span class=w>        </span><span class=nv>$0</span><span class=w> </span>start
<a id=__codelineno-13-45 name=__codelineno-13-45 href=#__codelineno-13-45></a><span class=w>        </span><span class=nv>RETVAL</span><span class=o>=</span><span class=nv>$?</span>
<a id=__codelineno-13-46 name=__codelineno-13-46 href=#__codelineno-13-46></a><span class=w>   </span><span class=p>;;</span>
<a id=__codelineno-13-47 name=__codelineno-13-47 href=#__codelineno-13-47></a><span class=w>    </span>status<span class=o>)</span>
<a id=__codelineno-13-48 name=__codelineno-13-48 href=#__codelineno-13-48></a><span class=w>        </span><span class=c1>#显示gmond守护进程的运行状态，其中status是functions 定义的函数</span>
<a id=__codelineno-13-49 name=__codelineno-13-49 href=#__codelineno-13-49></a><span class=w>        </span>status<span class=w> </span>gmond
<a id=__codelineno-13-50 name=__codelineno-13-50 href=#__codelineno-13-50></a><span class=w>        </span><span class=nv>RETVAL</span><span class=o>=</span><span class=nv>$?</span>
<a id=__codelineno-13-51 name=__codelineno-13-51 href=#__codelineno-13-51></a><span class=w>   </span><span class=p>;;</span>
<a id=__codelineno-13-52 name=__codelineno-13-52 href=#__codelineno-13-52></a><span class=w>    </span>*<span class=o>)</span>
<a id=__codelineno-13-53 name=__codelineno-13-53 href=#__codelineno-13-53></a><span class=w>        </span><span class=c1>#显示脚本的使用方法信息到标准输出</span>
<a id=__codelineno-13-54 name=__codelineno-13-54 href=#__codelineno-13-54></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Usage: </span><span class=nv>$0</span><span class=s2> {start|stop|restart|status}&quot;</span>
<a id=__codelineno-13-55 name=__codelineno-13-55 href=#__codelineno-13-55></a><span class=w>        </span><span class=c1>#退出脚本的运行，退出状态码为1</span>
<a id=__codelineno-13-56 name=__codelineno-13-56 href=#__codelineno-13-56></a><span class=w>        </span><span class=nb>exit</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-13-57 name=__codelineno-13-57 href=#__codelineno-13-57></a><span class=w>   </span><span class=p>;;</span>
<a id=__codelineno-13-58 name=__codelineno-13-58 href=#__codelineno-13-58></a><span class=k>esac</span>
<a id=__codelineno-13-59 name=__codelineno-13-59 href=#__codelineno-13-59></a>
<a id=__codelineno-13-60 name=__codelineno-13-60 href=#__codelineno-13-60></a><span class=c1>#退出脚本的运行，退出状态码为变量RETVAL的值</span>
<a id=__codelineno-13-61 name=__codelineno-13-61 href=#__codelineno-13-61></a><span class=nb>exit</span><span class=w> </span><span class=nv>$RETVAL</span>
</code></pre></div> <h2 id=9备份-24-小时被修改的文件>9.备份 24 小时被修改的文件<a class=headerlink href=#9备份-24-小时被修改的文件 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=ch>#!/usr/bin/env bash</span>
<a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a>
<a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a><span class=c1>#备份当前目录下所有前24小时被修改的文件为一个归档压缩包</span>
<a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a><span class=nv>BACKUPFILE</span><span class=o>=</span>back-<span class=k>$(</span>date<span class=w> </span>+%m-%d-%Y<span class=k>)</span><span class=w>   </span><span class=c1>#备份文件中嵌入日期</span>
<a id=__codelineno-14-5 name=__codelineno-14-5 href=#__codelineno-14-5></a><span class=nv>archive</span><span class=o>=</span><span class=si>${</span><span class=nv>1</span><span class=k>:-</span><span class=nv>$BACKUPFILE</span><span class=si>}</span><span class=w>   </span><span class=c1>#如果没有在命令行上指定备份的归档文件名，默认以&quot;back-xxxx作为默认的文件名&quot;</span>
<a id=__codelineno-14-6 name=__codelineno-14-6 href=#__codelineno-14-6></a>
<a id=__codelineno-14-7 name=__codelineno-14-7 href=#__codelineno-14-7></a>tar<span class=w> </span>cvf<span class=w> </span>-<span class=w> </span><span class=k>$(</span>find<span class=w> </span>.<span class=w> </span>-mtime<span class=w> </span>-1<span class=w> </span>-type<span class=w> </span>f<span class=w> </span>-print<span class=k>)</span><span class=w> </span>&gt;<span class=si>${</span><span class=nv>archive</span><span class=si>}</span>.tar
<a id=__codelineno-14-8 name=__codelineno-14-8 href=#__codelineno-14-8></a>gzip<span class=w> </span><span class=si>${</span><span class=nv>archive</span><span class=si>}</span>.tar
<a id=__codelineno-14-9 name=__codelineno-14-9 href=#__codelineno-14-9></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Directory </span><span class=nv>$PWD</span><span class=s2> backed up in archive file \&quot;</span><span class=nv>$archive</span><span class=s2>.tar.gz\&quot;.&quot;</span>
<a id=__codelineno-14-10 name=__codelineno-14-10 href=#__codelineno-14-10></a>
<a id=__codelineno-14-11 name=__codelineno-14-11 href=#__codelineno-14-11></a><span class=c1>#建议使用xagrs或者-exec</span>
<a id=__codelineno-14-12 name=__codelineno-14-12 href=#__codelineno-14-12></a>find<span class=w> </span>.<span class=w> </span>-mtime<span class=w> </span>-1<span class=w> </span>-type<span class=w> </span>f<span class=w> </span>-print0<span class=w> </span><span class=p>|</span><span class=w> </span>xargs<span class=w> </span>-0<span class=w> </span>tar<span class=w> </span>rvf<span class=w> </span><span class=s2>&quot;</span><span class=nv>$archive</span><span class=s2>.tar&quot;</span>
<a id=__codelineno-14-13 name=__codelineno-14-13 href=#__codelineno-14-13></a>find<span class=w> </span>.<span class=w> </span>-mitime<span class=w> </span>-1<span class=w> </span>-type<span class=w> </span>f<span class=w> </span>-exec<span class=w> </span>tar<span class=w> </span>rvf<span class=w> </span><span class=s2>&quot;</span><span class=nv>$archive</span><span class=s2>.tar&quot;</span><span class=w> </span><span class=s1>&#39;{}&#39;</span><span class=w> </span><span class=se>\ </span><span class=p>;</span>
</code></pre></div> <h2 id=10卸载相关的-rpm-包>10.卸载相关的 rpm 包<a class=headerlink href=#10卸载相关的-rpm-包 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a><span class=ch>#!/usr/bin/env bash</span>
<a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a><span class=nv>File_1</span><span class=o>=</span>unstall.txt
<a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a>rpm<span class=w> </span>-qa<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>ssh<span class=w> </span>&gt;<span class=w> </span><span class=nv>$File_1</span>
<a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a>
<a id=__codelineno-15-5 name=__codelineno-15-5 href=#__codelineno-15-5></a><span class=k>while</span><span class=w> </span><span class=nb>read</span><span class=w> </span>-r<span class=w> </span>line
<a id=__codelineno-15-6 name=__codelineno-15-6 href=#__codelineno-15-6></a><span class=k>do</span>
<a id=__codelineno-15-7 name=__codelineno-15-7 href=#__codelineno-15-7></a><span class=w>    </span>rpm<span class=w> </span>-e<span class=w> </span><span class=nv>$line</span>
<a id=__codelineno-15-8 name=__codelineno-15-8 href=#__codelineno-15-8></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=nv>$?</span><span class=w> </span>-eq<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;unstall is successful!!&quot;</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=nb>exit</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-15-9 name=__codelineno-15-9 href=#__codelineno-15-9></a><span class=k>done</span><span class=w> </span>&lt;<span class=w> </span><span class=nv>$File_1</span>
</code></pre></div> <h2 id=11检查-rpm-包的方法>11.检查 rpm 包的方法<a class=headerlink href=#11检查-rpm-包的方法 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a><span class=ch>#!/usr/bin/env bash</span>
<a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a><span class=k>if</span><span class=w> </span>rpm<span class=w> </span>-qa<span class=w> </span>sysstat<span class=w> </span><span class=p>&amp;</span>&gt;<span class=w> </span>/dev/null<span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;sysstat is already  install&quot;</span>
<a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a><span class=k>else</span>
<a id=__codelineno-16-5 name=__codelineno-16-5 href=#__codelineno-16-5></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;sysstat is not  install&quot;</span>
<a id=__codelineno-16-6 name=__codelineno-16-6 href=#__codelineno-16-6></a><span class=k>fi</span>
</code></pre></div> <h2 id=12检查软件状态>12.检查软件状态<a class=headerlink href=#12检查软件状态 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a><span class=ch>#!/usr/bin/env bash</span>
<a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a><span class=nv>PORT_C</span><span class=o>=</span><span class=k>$(</span>ss<span class=w> </span>-anu<span class=p>|</span><span class=w> </span>grep<span class=w> </span>-c<span class=w> </span><span class=m>123</span><span class=k>)</span>
<a id=__codelineno-17-3 name=__codelineno-17-3 href=#__codelineno-17-3></a><span class=nv>PS_C</span><span class=o>=</span><span class=k>$(</span>ps<span class=w> </span>-aux<span class=p>|</span><span class=w> </span>grep<span class=w> </span>ntp<span class=p>|</span><span class=w> </span>grep<span class=w> </span>-vc<span class=w> </span>grep<span class=k>)</span>
<a id=__codelineno-17-4 name=__codelineno-17-4 href=#__codelineno-17-4></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=nv>$PORT_C</span><span class=w> </span>-eq<span class=w> </span><span class=m>0</span><span class=w> </span>-o<span class=w> </span><span class=nv>$PS_C</span><span class=w> </span>-eq<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-17-5 name=__codelineno-17-5 href=#__codelineno-17-5></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Server is fail,restart !!&quot;</span>
<a id=__codelineno-17-6 name=__codelineno-17-6 href=#__codelineno-17-6></a><span class=w>    </span>:
<a id=__codelineno-17-7 name=__codelineno-17-7 href=#__codelineno-17-7></a><span class=k>fi</span>
</code></pre></div> <h2 id=13color-输出>13.color 输出<a class=headerlink href=#13color-输出 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a>!/usr/bin/env<span class=w> </span>bash
<a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a><span class=c1>#方法1</span>
<a id=__codelineno-18-3 name=__codelineno-18-3 href=#__codelineno-18-3></a>color_printf1<span class=o>(){</span>
<a id=__codelineno-18-4 name=__codelineno-18-4 href=#__codelineno-18-4></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[[</span><span class=w> </span><span class=nv>$1</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s2>&quot;red&quot;</span><span class=w> </span><span class=o>]]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-18-5 name=__codelineno-18-5 href=#__codelineno-18-5></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;\033[32;40m</span><span class=nv>$2</span><span class=s2>\033[0m&quot;</span>
<a id=__codelineno-18-6 name=__codelineno-18-6 href=#__codelineno-18-6></a><span class=w>    </span><span class=k>elif</span><span class=w> </span><span class=o>[[</span><span class=w> </span><span class=nv>$1</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s2>&quot;green&quot;</span><span class=w> </span><span class=o>]]</span><span class=p>;</span><span class=k>then</span>
<a id=__codelineno-18-7 name=__codelineno-18-7 href=#__codelineno-18-7></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;\033[31;40m</span><span class=nv>$2</span><span class=s2>\033[0m&quot;</span>
<a id=__codelineno-18-8 name=__codelineno-18-8 href=#__codelineno-18-8></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-18-9 name=__codelineno-18-9 href=#__codelineno-18-9></a><span class=o>}</span>
<a id=__codelineno-18-10 name=__codelineno-18-10 href=#__codelineno-18-10></a>
<a id=__codelineno-18-11 name=__codelineno-18-11 href=#__codelineno-18-11></a><span class=c1>#方法2</span>
<a id=__codelineno-18-12 name=__codelineno-18-12 href=#__codelineno-18-12></a>color_printf2<span class=o>(){</span>
<a id=__codelineno-18-13 name=__codelineno-18-13 href=#__codelineno-18-13></a><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=k>in</span>
<a id=__codelineno-18-14 name=__codelineno-18-14 href=#__codelineno-18-14></a><span class=w>    </span><span class=s2>&quot;red&quot;</span><span class=o>)</span>
<a id=__codelineno-18-15 name=__codelineno-18-15 href=#__codelineno-18-15></a><span class=w>       </span><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;\033[32;40m</span><span class=nv>$2</span><span class=s2>\033[0m&quot;</span>
<a id=__codelineno-18-16 name=__codelineno-18-16 href=#__codelineno-18-16></a><span class=w>       </span><span class=p>;;</span>
<a id=__codelineno-18-17 name=__codelineno-18-17 href=#__codelineno-18-17></a><span class=w>    </span><span class=s2>&quot;green&quot;</span><span class=o>)</span>
<a id=__codelineno-18-18 name=__codelineno-18-18 href=#__codelineno-18-18></a><span class=w>       </span><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;\033[31;40m</span><span class=nv>$2</span><span class=s2>\033[0m&quot;</span>
<a id=__codelineno-18-19 name=__codelineno-18-19 href=#__codelineno-18-19></a><span class=w>       </span><span class=p>;;</span>
<a id=__codelineno-18-20 name=__codelineno-18-20 href=#__codelineno-18-20></a><span class=w>    </span>*<span class=o>)</span>
<a id=__codelineno-18-21 name=__codelineno-18-21 href=#__codelineno-18-21></a><span class=w>       </span><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;Example: color_printf2 red xxxxxx&quot;</span>
<a id=__codelineno-18-22 name=__codelineno-18-22 href=#__codelineno-18-22></a><span class=w>       </span><span class=p>;;</span>
<a id=__codelineno-18-23 name=__codelineno-18-23 href=#__codelineno-18-23></a><span class=w>    </span><span class=k>esac</span>
<a id=__codelineno-18-24 name=__codelineno-18-24 href=#__codelineno-18-24></a>
<a id=__codelineno-18-25 name=__codelineno-18-25 href=#__codelineno-18-25></a><span class=o>}</span>
<a id=__codelineno-18-26 name=__codelineno-18-26 href=#__codelineno-18-26></a>
<a id=__codelineno-18-27 name=__codelineno-18-27 href=#__codelineno-18-27></a><span class=k>function</span><span class=w> </span>echo_r<span class=w> </span><span class=o>(){</span>
<a id=__codelineno-18-28 name=__codelineno-18-28 href=#__codelineno-18-28></a><span class=w>    </span><span class=c1># Color red: Error, Failed</span>
<a id=__codelineno-18-29 name=__codelineno-18-29 href=#__codelineno-18-29></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=nv>$#</span><span class=w> </span>-ne<span class=w> </span><span class=m>1</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-18-30 name=__codelineno-18-30 href=#__codelineno-18-30></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;\033[31m</span><span class=nv>$1</span><span class=s2>\033[0m&quot;</span>
<a id=__codelineno-18-31 name=__codelineno-18-31 href=#__codelineno-18-31></a><span class=o>}</span>
<a id=__codelineno-18-32 name=__codelineno-18-32 href=#__codelineno-18-32></a>
<a id=__codelineno-18-33 name=__codelineno-18-33 href=#__codelineno-18-33></a><span class=k>function</span><span class=w> </span>echo_g<span class=w> </span><span class=o>(){</span>
<a id=__codelineno-18-34 name=__codelineno-18-34 href=#__codelineno-18-34></a><span class=w>    </span><span class=c1># Color green: Success</span>
<a id=__codelineno-18-35 name=__codelineno-18-35 href=#__codelineno-18-35></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=nv>$#</span><span class=w> </span>-ne<span class=w> </span><span class=m>1</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-18-36 name=__codelineno-18-36 href=#__codelineno-18-36></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;\033[32m</span><span class=nv>$1</span><span class=s2>\033[0m&quot;</span>
<a id=__codelineno-18-37 name=__codelineno-18-37 href=#__codelineno-18-37></a><span class=o>}</span>
</code></pre></div> <h2 id=14日志备份切割>14.日志备份切割<a class=headerlink href=#14日志备份切割 title="Permanent link">&para;</a></h2> <h3 id=通过脚本管理-nginx-服务器日志>通过脚本管理 Nginx 服务器日志<a class=headerlink href=#通过脚本管理-nginx-服务器日志 title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a><span class=ch>#!/usr/bin/env bash</span>
<a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a><span class=c1>#usage:xxx</span>
<a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a><span class=c1>#scripts_name:xxx.sh</span>
<a id=__codelineno-19-4 name=__codelineno-19-4 href=#__codelineno-19-4></a><span class=c1># author：xiaojian</span>
<a id=__codelineno-19-5 name=__codelineno-19-5 href=#__codelineno-19-5></a>
<a id=__codelineno-19-6 name=__codelineno-19-6 href=#__codelineno-19-6></a><span class=nv>S_LOG</span><span class=o>=</span>/usr/local/nginx/logs/access.log
<a id=__codelineno-19-7 name=__codelineno-19-7 href=#__codelineno-19-7></a><span class=nv>D_LOG</span><span class=o>=</span>/data/backup/<span class=sb>`</span>date<span class=w> </span>+%Y-%m-%d<span class=sb>`</span>
<a id=__codelineno-19-8 name=__codelineno-19-8 href=#__codelineno-19-8></a><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;\033[32mPlease wait start cut shell scripts ....\033[0m&quot;</span>
<a id=__codelineno-19-9 name=__codelineno-19-9 href=#__codelineno-19-9></a>sleep<span class=w> </span><span class=m>2</span>
<a id=__codelineno-19-10 name=__codelineno-19-10 href=#__codelineno-19-10></a>
<a id=__codelineno-19-11 name=__codelineno-19-11 href=#__codelineno-19-11></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>!<span class=w> </span>-d<span class=w> </span><span class=nv>$D_LOG</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-19-12 name=__codelineno-19-12 href=#__codelineno-19-12></a><span class=w>    </span>mkdir<span class=w> </span>-p<span class=w> </span><span class=nv>$D_LOG</span>
<a id=__codelineno-19-13 name=__codelineno-19-13 href=#__codelineno-19-13></a><span class=k>fi</span>
<a id=__codelineno-19-14 name=__codelineno-19-14 href=#__codelineno-19-14></a>
<a id=__codelineno-19-15 name=__codelineno-19-15 href=#__codelineno-19-15></a>mv<span class=w> </span><span class=nv>$S_LOG</span><span class=w> </span><span class=nv>$D_LOG</span>
<a id=__codelineno-19-16 name=__codelineno-19-16 href=#__codelineno-19-16></a><span class=nb>kill</span><span class=w> </span>-USR1<span class=w> </span><span class=sb>`</span>cat<span class=w> </span>/usr/local/nginx/logs/nginx.pid<span class=sb>`</span>
<a id=__codelineno-19-17 name=__codelineno-19-17 href=#__codelineno-19-17></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;---------------------------------------------&quot;</span>
<a id=__codelineno-19-18 name=__codelineno-19-18 href=#__codelineno-19-18></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;The Nginx log Cutting Successfully! &quot;</span>
<a id=__codelineno-19-19 name=__codelineno-19-19 href=#__codelineno-19-19></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;You can access backup nginx log </span><span class=si>${</span><span class=nv>D_LOG</span><span class=si>}</span><span class=s2>/access.log files.&quot;</span>
</code></pre></div> <div class=highlight><pre><span></span><code><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a><span class=ch>#!/bin/sh</span>
<a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a><span class=c1>#nginx日志切割</span>
<a id=__codelineno-20-3 name=__codelineno-20-3 href=#__codelineno-20-3></a>
<a id=__codelineno-20-4 name=__codelineno-20-4 href=#__codelineno-20-4></a><span class=c1>#设置</span>
<a id=__codelineno-20-5 name=__codelineno-20-5 href=#__codelineno-20-5></a><span class=nv>Log_path</span><span class=o>=</span>/www/server/nginx/logs
<a id=__codelineno-20-6 name=__codelineno-20-6 href=#__codelineno-20-6></a><span class=nv>Yesterday</span><span class=o>=</span><span class=k>$(</span>date<span class=w> </span>-d<span class=w> </span><span class=s2>&quot;yesterday&quot;</span><span class=w> </span>+%Y-%m-%d_%S<span class=k>)</span>
<a id=__codelineno-20-7 name=__codelineno-20-7 href=#__codelineno-20-7></a><span class=nv>Nginxbin</span><span class=o>=</span>/www/server/nginx/sbin/nginx
<a id=__codelineno-20-8 name=__codelineno-20-8 href=#__codelineno-20-8></a>
<a id=__codelineno-20-9 name=__codelineno-20-9 href=#__codelineno-20-9></a><span class=c1>#日志改名</span>
<a id=__codelineno-20-10 name=__codelineno-20-10 href=#__codelineno-20-10></a>/bin/mv<span class=w> </span><span class=nv>$Log_path</span>/access.log<span class=w> </span><span class=nv>$Log_path</span>/access.<span class=nv>$Yesterday</span>.log
<a id=__codelineno-20-11 name=__codelineno-20-11 href=#__codelineno-20-11></a>/bin/mv<span class=w> </span><span class=nv>$Log_path</span>/error.log<span class=w>  </span><span class=nv>$Log_path</span>/error.<span class=nv>$Yesterday</span>.log
<a id=__codelineno-20-12 name=__codelineno-20-12 href=#__codelineno-20-12></a>
<a id=__codelineno-20-13 name=__codelineno-20-13 href=#__codelineno-20-13></a><span class=c1>#重新生成日志</span>
<a id=__codelineno-20-14 name=__codelineno-20-14 href=#__codelineno-20-14></a><span class=nv>$Nginxbin</span><span class=w> </span>-s<span class=w> </span>reopen
<a id=__codelineno-20-15 name=__codelineno-20-15 href=#__codelineno-20-15></a>
<a id=__codelineno-20-16 name=__codelineno-20-16 href=#__codelineno-20-16></a><span class=c1># #定时任务</span>
<a id=__codelineno-20-17 name=__codelineno-20-17 href=#__codelineno-20-17></a><span class=c1># #nginx日志切割</span>
<a id=__codelineno-20-18 name=__codelineno-20-18 href=#__codelineno-20-18></a><span class=c1># 00 00 * * *  /root/sh/cut_log.sh</span>
<a id=__codelineno-20-19 name=__codelineno-20-19 href=#__codelineno-20-19></a><span class=c1># #</span>
</code></pre></div> <h3 id=通过脚本管理-apache-服务器日志>通过脚本管理 Apache 服务器日志<a class=headerlink href=#通过脚本管理-apache-服务器日志 title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a><span class=ch>#! /bin/bash</span>
<a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a>
<a id=__codelineno-21-3 name=__codelineno-21-3 href=#__codelineno-21-3></a><span class=c1># 归档文件名生成函数</span>
<a id=__codelineno-21-4 name=__codelineno-21-4 href=#__codelineno-21-4></a><span class=k>function</span><span class=w> </span>filename<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-21-5 name=__codelineno-21-5 href=#__codelineno-21-5></a><span class=w>  </span><span class=nv>timestamp</span><span class=o>=</span><span class=k>$(</span>date<span class=w> </span>+%Y%m%d%H%M%S<span class=k>)</span>
<a id=__codelineno-21-6 name=__codelineno-21-6 href=#__codelineno-21-6></a><span class=w>  </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span>.<span class=nv>$timestamp</span>.<span class=s2>&quot;tar&quot;</span>
<a id=__codelineno-21-7 name=__codelineno-21-7 href=#__codelineno-21-7></a><span class=o>}</span>
<a id=__codelineno-21-8 name=__codelineno-21-8 href=#__codelineno-21-8></a>
<a id=__codelineno-21-9 name=__codelineno-21-9 href=#__codelineno-21-9></a><span class=c1># 过期日志归档函数</span>
<a id=__codelineno-21-10 name=__codelineno-21-10 href=#__codelineno-21-10></a><span class=k>function</span><span class=w> </span>archivelog<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-21-11 name=__codelineno-21-11 href=#__codelineno-21-11></a><span class=w>  </span><span class=nv>archivefile</span><span class=o>=</span><span class=k>$(</span>filename<span class=w> </span>httpd_log<span class=k>)</span>
<a id=__codelineno-21-12 name=__codelineno-21-12 href=#__codelineno-21-12></a><span class=w>  </span><span class=c1># echo $archivefile</span>
<a id=__codelineno-21-13 name=__codelineno-21-13 href=#__codelineno-21-13></a><span class=w>  </span><span class=nb>local</span><span class=w> </span><span class=nv>archivedest</span><span class=o>=</span><span class=nv>$1</span>
<a id=__codelineno-21-14 name=__codelineno-21-14 href=#__codelineno-21-14></a><span class=w>  </span><span class=o>[</span><span class=w> </span>!<span class=w> </span>-d<span class=w> </span><span class=nv>$archivedest</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>mkdir<span class=w> </span>-p<span class=w> </span><span class=s2>&quot;</span><span class=nv>$archivedest</span><span class=s2>&quot;</span>
<a id=__codelineno-21-15 name=__codelineno-21-15 href=#__codelineno-21-15></a><span class=w>  </span><span class=nb>cd</span><span class=w> </span>/var/log/httpd<span class=w> </span><span class=o>||</span><span class=w> </span><span class=nb>exit</span>
<a id=__codelineno-21-16 name=__codelineno-21-16 href=#__codelineno-21-16></a>
<a id=__codelineno-21-17 name=__codelineno-21-17 href=#__codelineno-21-17></a><span class=w>  </span>find<span class=w> </span>.<span class=w> </span>-mtime<span class=w> </span>+1<span class=w> </span>-exec<span class=w> </span>tar<span class=w> </span>-rf<span class=w> </span><span class=si>${</span><span class=nv>archivedest</span><span class=si>}${</span><span class=nv>archivefile</span><span class=si>}</span><span class=w> </span><span class=o>{}</span><span class=w> </span><span class=se>\;</span>
<a id=__codelineno-21-18 name=__codelineno-21-18 href=#__codelineno-21-18></a><span class=w>  </span>zip<span class=w> </span><span class=nv>$archivedest$archivefile</span><span class=s2>&quot;.zip&quot;</span><span class=w> </span><span class=nv>$archivedest$archivefile</span>
<a id=__codelineno-21-19 name=__codelineno-21-19 href=#__codelineno-21-19></a><span class=w>  </span><span class=o>[</span><span class=w> </span><span class=nv>$?</span><span class=w> </span>-eq<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>rm<span class=w> </span>-f<span class=w> </span><span class=nv>$archivedest$archivefile</span>
<a id=__codelineno-21-20 name=__codelineno-21-20 href=#__codelineno-21-20></a>
<a id=__codelineno-21-21 name=__codelineno-21-21 href=#__codelineno-21-21></a><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=nv>$?</span>
<a id=__codelineno-21-22 name=__codelineno-21-22 href=#__codelineno-21-22></a><span class=o>}</span>
<a id=__codelineno-21-23 name=__codelineno-21-23 href=#__codelineno-21-23></a>
<a id=__codelineno-21-24 name=__codelineno-21-24 href=#__codelineno-21-24></a><span class=c1># 已归档日志删除函数</span>
<a id=__codelineno-21-25 name=__codelineno-21-25 href=#__codelineno-21-25></a><span class=k>function</span><span class=w> </span>removearchivedlog<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-21-26 name=__codelineno-21-26 href=#__codelineno-21-26></a><span class=w>  </span><span class=nb>cd</span><span class=w> </span>/var/log/httpd
<a id=__codelineno-21-27 name=__codelineno-21-27 href=#__codelineno-21-27></a><span class=w>  </span>find<span class=w> </span>.<span class=w> </span>-mtime<span class=w> </span>+1<span class=w> </span>-exec<span class=w> </span>rm<span class=w> </span>-f<span class=w> </span><span class=si>${</span><span class=nv>archivedest</span><span class=si>}${</span><span class=nv>archivefile</span><span class=si>}</span><span class=w> </span><span class=o>{}</span><span class=w> </span><span class=se>\;</span>
<a id=__codelineno-21-28 name=__codelineno-21-28 href=#__codelineno-21-28></a><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=nv>$?</span>
<a id=__codelineno-21-29 name=__codelineno-21-29 href=#__codelineno-21-29></a><span class=o>}</span>
<a id=__codelineno-21-30 name=__codelineno-21-30 href=#__codelineno-21-30></a>
<a id=__codelineno-21-31 name=__codelineno-21-31 href=#__codelineno-21-31></a><span class=c1># 主函数</span>
<a id=__codelineno-21-32 name=__codelineno-21-32 href=#__codelineno-21-32></a><span class=k>function</span><span class=w> </span>main<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-21-33 name=__codelineno-21-33 href=#__codelineno-21-33></a>
<a id=__codelineno-21-34 name=__codelineno-21-34 href=#__codelineno-21-34></a><span class=w>  </span><span class=c1># 归档过期日志</span>
<a id=__codelineno-21-35 name=__codelineno-21-35 href=#__codelineno-21-35></a><span class=w>  </span>archivelog<span class=w> </span><span class=s2>&quot;/root/chapter15/&quot;</span>
<a id=__codelineno-21-36 name=__codelineno-21-36 href=#__codelineno-21-36></a><span class=w>  </span><span class=c1># 删除已归档日志</span>
<a id=__codelineno-21-37 name=__codelineno-21-37 href=#__codelineno-21-37></a><span class=w>  </span><span class=o>[</span><span class=w> </span><span class=nv>$?</span><span class=w> </span>-eq<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>removearchivedlog
<a id=__codelineno-21-38 name=__codelineno-21-38 href=#__codelineno-21-38></a><span class=w>  </span><span class=nb>exit</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-21-39 name=__codelineno-21-39 href=#__codelineno-21-39></a><span class=o>}</span>
<a id=__codelineno-21-40 name=__codelineno-21-40 href=#__codelineno-21-40></a>
<a id=__codelineno-21-41 name=__codelineno-21-41 href=#__codelineno-21-41></a><span class=c1># 脚本入口</span>
<a id=__codelineno-21-42 name=__codelineno-21-42 href=#__codelineno-21-42></a>main<span class=w> </span><span class=s2>&quot;</span><span class=nv>$@</span><span class=s2>&quot;</span>
</code></pre></div> <h2 id=15一键安装-docker>15.一键安装 docker<a class=headerlink href=#15一键安装-docker title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a><span class=c1>#Author:</span>
<a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a><span class=c1>#Date: 2019-06-06</span>
<a id=__codelineno-22-4 name=__codelineno-22-4 href=#__codelineno-22-4></a><span class=c1>#install docker in ubuntu and centos</span>
<a id=__codelineno-22-5 name=__codelineno-22-5 href=#__codelineno-22-5></a>
<a id=__codelineno-22-6 name=__codelineno-22-6 href=#__codelineno-22-6></a>
<a id=__codelineno-22-7 name=__codelineno-22-7 href=#__codelineno-22-7></a><span class=k>function</span><span class=w> </span>install_docker_in_ubuntu
<a id=__codelineno-22-8 name=__codelineno-22-8 href=#__codelineno-22-8></a><span class=o>{</span>
<a id=__codelineno-22-9 name=__codelineno-22-9 href=#__codelineno-22-9></a><span class=w>    </span>sudo<span class=w>  </span>apt-get<span class=w> </span>update<span class=w> </span>-y
<a id=__codelineno-22-10 name=__codelineno-22-10 href=#__codelineno-22-10></a><span class=w>    </span><span class=c1># install some tools</span>
<a id=__codelineno-22-11 name=__codelineno-22-11 href=#__codelineno-22-11></a><span class=w>    </span>sudo<span class=w> </span>apt-get<span class=w> </span>install<span class=w> </span><span class=se>\</span>
<a id=__codelineno-22-12 name=__codelineno-22-12 href=#__codelineno-22-12></a><span class=w>        </span>apt-transport-https<span class=w> </span><span class=se>\</span>
<a id=__codelineno-22-13 name=__codelineno-22-13 href=#__codelineno-22-13></a><span class=w>        </span>ca-certificates<span class=w> </span><span class=se>\</span>
<a id=__codelineno-22-14 name=__codelineno-22-14 href=#__codelineno-22-14></a><span class=w>        </span>curl<span class=w> </span><span class=se>\</span>
<a id=__codelineno-22-15 name=__codelineno-22-15 href=#__codelineno-22-15></a><span class=w>        </span>gnupg-agent<span class=w> </span><span class=se>\</span>
<a id=__codelineno-22-16 name=__codelineno-22-16 href=#__codelineno-22-16></a><span class=w>        </span>software-properties-common<span class=w> </span><span class=se>\</span>
<a id=__codelineno-22-17 name=__codelineno-22-17 href=#__codelineno-22-17></a><span class=w>        </span>net-tools<span class=w> </span><span class=se>\</span>
<a id=__codelineno-22-18 name=__codelineno-22-18 href=#__codelineno-22-18></a><span class=w>        </span>wget<span class=w> </span>-y
<a id=__codelineno-22-19 name=__codelineno-22-19 href=#__codelineno-22-19></a>
<a id=__codelineno-22-20 name=__codelineno-22-20 href=#__codelineno-22-20></a><span class=w>    </span><span class=c1># install docker</span>
<a id=__codelineno-22-21 name=__codelineno-22-21 href=#__codelineno-22-21></a><span class=w>    </span>curl<span class=w> </span>-fsSL<span class=w> </span>get.docker.com<span class=w> </span>-o<span class=w> </span>get-docker.sh
<a id=__codelineno-22-22 name=__codelineno-22-22 href=#__codelineno-22-22></a><span class=w>    </span>sh<span class=w> </span>get-docker.sh
<a id=__codelineno-22-23 name=__codelineno-22-23 href=#__codelineno-22-23></a>
<a id=__codelineno-22-24 name=__codelineno-22-24 href=#__codelineno-22-24></a><span class=w>    </span><span class=c1># start docker service</span>
<a id=__codelineno-22-25 name=__codelineno-22-25 href=#__codelineno-22-25></a><span class=w>    </span>sudo<span class=w> </span>groupadd<span class=w> </span>docker<span class=w> </span><span class=p>&amp;</span>&gt;<span class=w> </span>/dev/null
<a id=__codelineno-22-26 name=__codelineno-22-26 href=#__codelineno-22-26></a><span class=w>    </span>sudo<span class=w> </span>gpasswd<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>USER</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span>docker
<a id=__codelineno-22-27 name=__codelineno-22-27 href=#__codelineno-22-27></a><span class=w>    </span>sudo<span class=w> </span>systemctl<span class=w> </span>start<span class=w> </span>docker
<a id=__codelineno-22-28 name=__codelineno-22-28 href=#__codelineno-22-28></a>
<a id=__codelineno-22-29 name=__codelineno-22-29 href=#__codelineno-22-29></a><span class=w>    </span>rm<span class=w> </span>-rf<span class=w> </span>get-docker.sh
<a id=__codelineno-22-30 name=__codelineno-22-30 href=#__codelineno-22-30></a><span class=o>}</span>
<a id=__codelineno-22-31 name=__codelineno-22-31 href=#__codelineno-22-31></a>
<a id=__codelineno-22-32 name=__codelineno-22-32 href=#__codelineno-22-32></a>
<a id=__codelineno-22-33 name=__codelineno-22-33 href=#__codelineno-22-33></a><span class=k>function</span><span class=w> </span>install_docker_in_centos
<a id=__codelineno-22-34 name=__codelineno-22-34 href=#__codelineno-22-34></a><span class=o>{</span>
<a id=__codelineno-22-35 name=__codelineno-22-35 href=#__codelineno-22-35></a><span class=w>    </span><span class=c1># install some tools</span>
<a id=__codelineno-22-36 name=__codelineno-22-36 href=#__codelineno-22-36></a><span class=w>    </span>sudo<span class=w> </span>yum<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>git<span class=w> </span>vim<span class=w> </span>gcc<span class=w> </span>glibc-static<span class=w> </span>telnet<span class=w> </span>bridge-utils
<a id=__codelineno-22-37 name=__codelineno-22-37 href=#__codelineno-22-37></a>
<a id=__codelineno-22-38 name=__codelineno-22-38 href=#__codelineno-22-38></a><span class=w>    </span><span class=c1># install docker</span>
<a id=__codelineno-22-39 name=__codelineno-22-39 href=#__codelineno-22-39></a><span class=w>    </span>curl<span class=w> </span>-fsSL<span class=w> </span>get.docker.com<span class=w> </span>-o<span class=w> </span>get-docker.sh
<a id=__codelineno-22-40 name=__codelineno-22-40 href=#__codelineno-22-40></a><span class=w>    </span>sh<span class=w> </span>get-docker.sh
<a id=__codelineno-22-41 name=__codelineno-22-41 href=#__codelineno-22-41></a>
<a id=__codelineno-22-42 name=__codelineno-22-42 href=#__codelineno-22-42></a><span class=w>    </span><span class=c1># start docker service</span>
<a id=__codelineno-22-43 name=__codelineno-22-43 href=#__codelineno-22-43></a><span class=w>    </span>sudo<span class=w> </span>groupadd<span class=w> </span>docker<span class=w> </span><span class=p>&amp;</span>&gt;<span class=w> </span>/dev/null
<a id=__codelineno-22-44 name=__codelineno-22-44 href=#__codelineno-22-44></a><span class=w>    </span>sudo<span class=w> </span>gpasswd<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>USER</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span>docker
<a id=__codelineno-22-45 name=__codelineno-22-45 href=#__codelineno-22-45></a><span class=w>    </span>sudo<span class=w> </span>systemctl<span class=w> </span>start<span class=w> </span>docker
<a id=__codelineno-22-46 name=__codelineno-22-46 href=#__codelineno-22-46></a>
<a id=__codelineno-22-47 name=__codelineno-22-47 href=#__codelineno-22-47></a><span class=w>    </span>rm<span class=w> </span>-rf<span class=w> </span>get-docker.sh
<a id=__codelineno-22-48 name=__codelineno-22-48 href=#__codelineno-22-48></a>
<a id=__codelineno-22-49 name=__codelineno-22-49 href=#__codelineno-22-49></a><span class=o>}</span>
<a id=__codelineno-22-50 name=__codelineno-22-50 href=#__codelineno-22-50></a>
<a id=__codelineno-22-51 name=__codelineno-22-51 href=#__codelineno-22-51></a>
<a id=__codelineno-22-52 name=__codelineno-22-52 href=#__codelineno-22-52></a><span class=nv>SYSTEM_NAME</span><span class=o>=</span><span class=s2>&quot;</span><span class=k>$(</span>awk<span class=w> </span>-F<span class=o>=</span><span class=w> </span><span class=s1>&#39;/^NAME/{print $2}&#39;</span><span class=w> </span>/etc/os-release<span class=k>)</span><span class=s2>&quot;</span>
<a id=__codelineno-22-53 name=__codelineno-22-53 href=#__codelineno-22-53></a><span class=k>if</span><span class=w> </span><span class=o>[[</span><span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>SYSTEM_NAME</span><span class=p>,,</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span>~<span class=w> </span><span class=s2>&quot;ubuntu&quot;</span><span class=w>  </span><span class=o>]]</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-22-54 name=__codelineno-22-54 href=#__codelineno-22-54></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Your system is ubuntu.&quot;</span>
<a id=__codelineno-22-55 name=__codelineno-22-55 href=#__codelineno-22-55></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Installing Docker in ubuntu...&quot;</span>
<a id=__codelineno-22-56 name=__codelineno-22-56 href=#__codelineno-22-56></a><span class=w>    </span>install_docker_in_ubuntu
<a id=__codelineno-22-57 name=__codelineno-22-57 href=#__codelineno-22-57></a><span class=k>elif</span><span class=w> </span><span class=o>[[</span><span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>SYSTEM_NAME</span><span class=p>,,</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span>~<span class=w> </span><span class=s2>&quot;centos&quot;</span><span class=w> </span><span class=o>]]</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-22-58 name=__codelineno-22-58 href=#__codelineno-22-58></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Your system is centos.&quot;</span>
<a id=__codelineno-22-59 name=__codelineno-22-59 href=#__codelineno-22-59></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Installing Docker in centos...&quot;</span>
<a id=__codelineno-22-60 name=__codelineno-22-60 href=#__codelineno-22-60></a><span class=w>    </span>install_docker_in_centos
<a id=__codelineno-22-61 name=__codelineno-22-61 href=#__codelineno-22-61></a><span class=k>else</span>
<a id=__codelineno-22-62 name=__codelineno-22-62 href=#__codelineno-22-62></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;This script can only run in ubuntu and centos system.&quot;</span>
<a id=__codelineno-22-63 name=__codelineno-22-63 href=#__codelineno-22-63></a><span class=w>    </span><span class=nb>exit</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-22-64 name=__codelineno-22-64 href=#__codelineno-22-64></a><span class=k>fi</span>
</code></pre></div> <h2 id=16-备份-mongodb>16. 备份 MongoDB<a class=headerlink href=#16-备份-mongodb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a><span class=c1>#backup mongodb</span>
<a id=__codelineno-23-3 name=__codelineno-23-3 href=#__codelineno-23-3></a>
<a id=__codelineno-23-4 name=__codelineno-23-4 href=#__codelineno-23-4></a>.<span class=w> </span>/etc/profile
<a id=__codelineno-23-5 name=__codelineno-23-5 href=#__codelineno-23-5></a><span class=nv>CMD</span><span class=o>=</span><span class=sb>`</span>which<span class=w> </span>mongodump<span class=sb>`</span>
<a id=__codelineno-23-6 name=__codelineno-23-6 href=#__codelineno-23-6></a><span class=nv>DATE</span><span class=o>=</span><span class=sb>`</span>date<span class=w> </span>+%F<span class=sb>`</span>
<a id=__codelineno-23-7 name=__codelineno-23-7 href=#__codelineno-23-7></a><span class=nv>DB</span><span class=o>=</span><span class=s2>&quot;test&quot;</span>
<a id=__codelineno-23-8 name=__codelineno-23-8 href=#__codelineno-23-8></a><span class=nv>DB_HOST</span><span class=o>=</span><span class=s2>&quot;localhost&quot;</span>
<a id=__codelineno-23-9 name=__codelineno-23-9 href=#__codelineno-23-9></a><span class=nv>DB_PORT</span><span class=o>=</span><span class=s2>&quot;27017&quot;</span>
<a id=__codelineno-23-10 name=__codelineno-23-10 href=#__codelineno-23-10></a><span class=nv>DB_USER</span><span class=o>=</span><span class=s2>&quot;testuser&quot;</span>
<a id=__codelineno-23-11 name=__codelineno-23-11 href=#__codelineno-23-11></a><span class=nv>DB_PWD</span><span class=o>=</span><span class=s2>&quot;testpass&quot;</span>
<a id=__codelineno-23-12 name=__codelineno-23-12 href=#__codelineno-23-12></a><span class=nv>BACKUP_DIR</span><span class=o>=</span><span class=s2>&quot;/data/mongodb/&quot;</span>
<a id=__codelineno-23-13 name=__codelineno-23-13 href=#__codelineno-23-13></a><span class=nv>TAR_DIR</span><span class=o>=</span><span class=s2>&quot;/data/tardir/&quot;</span>
<a id=__codelineno-23-14 name=__codelineno-23-14 href=#__codelineno-23-14></a><span class=nv>TAR_DIR_DATE</span><span class=o>=</span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>TAR_DIR</span><span class=si>}${</span><span class=nv>DATE</span><span class=si>}</span><span class=s2>&quot;</span>
<a id=__codelineno-23-15 name=__codelineno-23-15 href=#__codelineno-23-15></a><span class=nv>TAR_BAK</span><span class=o>=</span><span class=s2>&quot;mongodb_bak_</span><span class=nv>$DATE</span><span class=s2>.tar.gz&quot;</span>
<a id=__codelineno-23-16 name=__codelineno-23-16 href=#__codelineno-23-16></a>
<a id=__codelineno-23-17 name=__codelineno-23-17 href=#__codelineno-23-17></a>check_dir<span class=o>(){</span>
<a id=__codelineno-23-18 name=__codelineno-23-18 href=#__codelineno-23-18></a><span class=w>    </span><span class=k>for</span><span class=w> </span>DIR<span class=w> </span><span class=k>in</span><span class=w> </span><span class=si>${</span><span class=nv>BACKUP_DIR</span><span class=si>}</span><span class=w> </span><span class=si>${</span><span class=nv>TAR_DIR_DATE</span><span class=si>}</span>
<a id=__codelineno-23-19 name=__codelineno-23-19 href=#__codelineno-23-19></a><span class=w>    </span><span class=k>do</span>
<a id=__codelineno-23-20 name=__codelineno-23-20 href=#__codelineno-23-20></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>!<span class=w> </span>-d<span class=w> </span><span class=nv>$DIR</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=k>then</span>
<a id=__codelineno-23-21 name=__codelineno-23-21 href=#__codelineno-23-21></a><span class=w>            </span>mkdir<span class=w> </span>-p<span class=w> </span><span class=nv>$DIR</span>
<a id=__codelineno-23-22 name=__codelineno-23-22 href=#__codelineno-23-22></a><span class=w>        </span><span class=k>fi</span>
<a id=__codelineno-23-23 name=__codelineno-23-23 href=#__codelineno-23-23></a><span class=w>    </span><span class=k>done</span>
<a id=__codelineno-23-24 name=__codelineno-23-24 href=#__codelineno-23-24></a><span class=o>}</span>
<a id=__codelineno-23-25 name=__codelineno-23-25 href=#__codelineno-23-25></a>backup_mongodb<span class=o>(){</span>
<a id=__codelineno-23-26 name=__codelineno-23-26 href=#__codelineno-23-26></a><span class=w>    </span><span class=nv>$CMD</span><span class=w> </span>-h<span class=w> </span><span class=si>${</span><span class=nv>DB_HOST</span><span class=si>}</span>:<span class=si>${</span><span class=nv>DB_PORT</span><span class=si>}</span><span class=w> </span>-u<span class=w> </span><span class=nv>$DB_USER</span><span class=w> </span>-p<span class=w> </span><span class=nv>$DB_PWD</span><span class=w> </span>-d<span class=w> </span><span class=si>${</span><span class=nv>DB</span><span class=si>}</span><span class=w> </span>-o<span class=w> </span><span class=si>${</span><span class=nv>BACKUP_DIR</span><span class=si>}${</span><span class=nv>DATE</span><span class=si>}</span><span class=w> </span>&gt;/dev/null
<a id=__codelineno-23-27 name=__codelineno-23-27 href=#__codelineno-23-27></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=nv>$?</span><span class=w> </span>-eq<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=k>then</span>
<a id=__codelineno-23-28 name=__codelineno-23-28 href=#__codelineno-23-28></a><span class=w>        </span>tar<span class=w> </span>-zcf<span class=w> </span><span class=si>${</span><span class=nv>TAR_DIR_DATE</span><span class=si>}</span>/<span class=si>${</span><span class=nv>TAR_BAK</span><span class=si>}</span><span class=w> </span><span class=si>${</span><span class=nv>BACKUP_DIR</span><span class=si>}${</span><span class=nv>DATE</span><span class=si>}</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-23-29 name=__codelineno-23-29 href=#__codelineno-23-29></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-23-30 name=__codelineno-23-30 href=#__codelineno-23-30></a><span class=o>}</span>
<a id=__codelineno-23-31 name=__codelineno-23-31 href=#__codelineno-23-31></a>clean_tar<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-23-32 name=__codelineno-23-32 href=#__codelineno-23-32></a><span class=w>    </span>find<span class=w> </span><span class=si>${</span><span class=nv>TAR_DIR</span><span class=si>}</span><span class=w> </span>-mtime<span class=w> </span>+7<span class=w> </span>-exec<span class=w> </span>rm<span class=w> </span>-rf<span class=w> </span><span class=o>{}</span><span class=w> </span><span class=se>\;</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-23-33 name=__codelineno-23-33 href=#__codelineno-23-33></a><span class=o>}</span>
<a id=__codelineno-23-34 name=__codelineno-23-34 href=#__codelineno-23-34></a>
<a id=__codelineno-23-35 name=__codelineno-23-35 href=#__codelineno-23-35></a>main<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-23-36 name=__codelineno-23-36 href=#__codelineno-23-36></a><span class=w>    </span>check_dir
<a id=__codelineno-23-37 name=__codelineno-23-37 href=#__codelineno-23-37></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=nv>$?</span><span class=w> </span>-eq<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>backup_mongodb
<a id=__codelineno-23-38 name=__codelineno-23-38 href=#__codelineno-23-38></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=nv>$?</span><span class=w> </span>-eq<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>clean_tar
<a id=__codelineno-23-39 name=__codelineno-23-39 href=#__codelineno-23-39></a><span class=o>}</span>
<a id=__codelineno-23-40 name=__codelineno-23-40 href=#__codelineno-23-40></a>
<a id=__codelineno-23-41 name=__codelineno-23-41 href=#__codelineno-23-41></a>main
</code></pre></div> <h2 id=17linux-下以秒为单位执行脚本>17.Linux 下以秒为单位执行脚本<a class=headerlink href=#17linux-下以秒为单位执行脚本 title="Permanent link">&para;</a></h2> <h3 id=example1>example1<a class=headerlink href=#example1 title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a>写一个触发的脚本，在触发脚本中使用死循环来解决此问题
<a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a><span class=o>[</span>root@test<span class=w> </span>~<span class=o>]</span><span class=c1># cat kevin.sh</span>
<a id=__codelineno-24-3 name=__codelineno-24-3 href=#__codelineno-24-3></a><span class=c1>#!/bin/bash</span>
<a id=__codelineno-24-4 name=__codelineno-24-4 href=#__codelineno-24-4></a><span class=k>while</span><span class=w> </span>:<span class=w> </span><span class=p>;</span><span class=k>do</span>
<a id=__codelineno-24-5 name=__codelineno-24-5 href=#__codelineno-24-5></a>
<a id=__codelineno-24-6 name=__codelineno-24-6 href=#__codelineno-24-6></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;beijing is so good!&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span>/root/test.log
<a id=__codelineno-24-7 name=__codelineno-24-7 href=#__codelineno-24-7></a>sleep<span class=w> </span><span class=m>2</span>
<a id=__codelineno-24-8 name=__codelineno-24-8 href=#__codelineno-24-8></a>
<a id=__codelineno-24-9 name=__codelineno-24-9 href=#__codelineno-24-9></a><span class=k>done</span>
<a id=__codelineno-24-10 name=__codelineno-24-10 href=#__codelineno-24-10></a>
<a id=__codelineno-24-11 name=__codelineno-24-11 href=#__codelineno-24-11></a><span class=o>[</span>root@test<span class=w> </span>~<span class=o>]</span><span class=c1># chmod 755 kevin.sh</span>
<a id=__codelineno-24-12 name=__codelineno-24-12 href=#__codelineno-24-12></a>
<a id=__codelineno-24-13 name=__codelineno-24-13 href=#__codelineno-24-13></a>可以把它放到计划任务使其运行
<a id=__codelineno-24-14 name=__codelineno-24-14 href=#__codelineno-24-14></a><span class=o>[</span>root@test<span class=w> </span>~<span class=o>]</span><span class=c1># crontab -e</span>
<a id=__codelineno-24-15 name=__codelineno-24-15 href=#__codelineno-24-15></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-24-16 name=__codelineno-24-16 href=#__codelineno-24-16></a>
<a id=__codelineno-24-17 name=__codelineno-24-17 href=#__codelineno-24-17></a>等待这个计划任务执行后，就将计划任务中的此条目删除或注释！防止该计划条目无限制地执行下去（只需执行一次就可以，因为kevin.sh脚本里本身就有死循环）
<a id=__codelineno-24-18 name=__codelineno-24-18 href=#__codelineno-24-18></a><span class=o>[</span>root@test<span class=w> </span>~<span class=o>]</span><span class=c1># ps -ef|grep kevin.sh</span>
<a id=__codelineno-24-19 name=__codelineno-24-19 href=#__codelineno-24-19></a>root<span class=w>     </span><span class=m>29839</span><span class=w> </span><span class=m>29835</span><span class=w>  </span><span class=m>0</span><span class=w> </span><span class=m>16</span>:05<span class=w> </span>?<span class=w>        </span><span class=m>00</span>:00:00<span class=w> </span>/bin/sh<span class=w> </span>-c<span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-24-20 name=__codelineno-24-20 href=#__codelineno-24-20></a>root<span class=w>     </span><span class=m>29842</span><span class=w> </span><span class=m>29839</span><span class=w>  </span><span class=m>0</span><span class=w> </span><span class=m>16</span>:05<span class=w> </span>?<span class=w>        </span><span class=m>00</span>:00:00<span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh
<a id=__codelineno-24-21 name=__codelineno-24-21 href=#__codelineno-24-21></a>root<span class=w>     </span><span class=m>29852</span><span class=w> </span><span class=m>16356</span><span class=w>  </span><span class=m>0</span><span class=w> </span><span class=m>16</span>:05<span class=w> </span>pts/0<span class=w>    </span><span class=m>00</span>:00:00<span class=w> </span>grep<span class=w> </span>kevin.sh
<a id=__codelineno-24-22 name=__codelineno-24-22 href=#__codelineno-24-22></a>
<a id=__codelineno-24-23 name=__codelineno-24-23 href=#__codelineno-24-23></a><span class=o>[</span>root@test<span class=w> </span>~<span class=o>]</span><span class=c1># crontab -e</span>
<a id=__codelineno-24-24 name=__codelineno-24-24 href=#__codelineno-24-24></a><span class=c1>#* * * * * /bin/bash -x /root/kevin.sh &gt;/dev/null 2&gt;&amp;1</span>
<a id=__codelineno-24-25 name=__codelineno-24-25 href=#__codelineno-24-25></a>
<a id=__codelineno-24-26 name=__codelineno-24-26 href=#__codelineno-24-26></a>最后把这个脚本放到<span class=w> </span>/etc/rc.local<span class=w> </span>让它每次开机都可以被运行
<a id=__codelineno-24-27 name=__codelineno-24-27 href=#__codelineno-24-27></a><span class=o>[</span>root@test<span class=w> </span>~<span class=o>]</span><span class=c1># vim /etc/rc.local</span>
<a id=__codelineno-24-28 name=__codelineno-24-28 href=#__codelineno-24-28></a>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-24-29 name=__codelineno-24-29 href=#__codelineno-24-29></a>
<a id=__codelineno-24-30 name=__codelineno-24-30 href=#__codelineno-24-30></a>验证（查看是不是每隔2秒在/root/test.log文件中写入了）
<a id=__codelineno-24-31 name=__codelineno-24-31 href=#__codelineno-24-31></a><span class=o>[</span>root@test<span class=w> </span>~<span class=o>]</span><span class=c1># tail -f /root/test.log</span>
<a id=__codelineno-24-32 name=__codelineno-24-32 href=#__codelineno-24-32></a>beijing<span class=w> </span>is<span class=w> </span>so<span class=w> </span>good!
<a id=__codelineno-24-33 name=__codelineno-24-33 href=#__codelineno-24-33></a>beijing<span class=w> </span>is<span class=w> </span>so<span class=w> </span>good!
<a id=__codelineno-24-34 name=__codelineno-24-34 href=#__codelineno-24-34></a>beijing<span class=w> </span>is<span class=w> </span>so<span class=w> </span>good!
<a id=__codelineno-24-35 name=__codelineno-24-35 href=#__codelineno-24-35></a>beijing<span class=w> </span>is<span class=w> </span>so<span class=w> </span>good!
<a id=__codelineno-24-36 name=__codelineno-24-36 href=#__codelineno-24-36></a>beijing<span class=w> </span>is<span class=w> </span>so<span class=w> </span>good!
<a id=__codelineno-24-37 name=__codelineno-24-37 href=#__codelineno-24-37></a>beijing<span class=w> </span>is<span class=w> </span>so<span class=w> </span>good!
<a id=__codelineno-24-38 name=__codelineno-24-38 href=#__codelineno-24-38></a>beijing<span class=w> </span>is<span class=w> </span>so<span class=w> </span>good!
</code></pre></div> <h3 id=example2>example2<a class=headerlink href=#example2 title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a><span class=o>[</span>root@test<span class=w> </span>~<span class=o>]</span><span class=c1># vim kevin.sh</span>
<a id=__codelineno-25-2 name=__codelineno-25-2 href=#__codelineno-25-2></a><span class=c1>#!/bin/bash</span>
<a id=__codelineno-25-3 name=__codelineno-25-3 href=#__codelineno-25-3></a>
<a id=__codelineno-25-4 name=__codelineno-25-4 href=#__codelineno-25-4></a><span class=k>for</span><span class=o>((</span><span class=nv>i</span><span class=o>=</span><span class=m>1</span><span class=p>;</span>i&lt;<span class=o>=</span><span class=m>20</span><span class=p>;</span>i++<span class=o>))</span><span class=p>;</span><span class=k>do</span>
<a id=__codelineno-25-5 name=__codelineno-25-5 href=#__codelineno-25-5></a>
<a id=__codelineno-25-6 name=__codelineno-25-6 href=#__codelineno-25-6></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;beijing is so good!&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span>/root/test.log
<a id=__codelineno-25-7 name=__codelineno-25-7 href=#__codelineno-25-7></a>sleep<span class=w> </span><span class=m>2</span>
<a id=__codelineno-25-8 name=__codelineno-25-8 href=#__codelineno-25-8></a>
<a id=__codelineno-25-9 name=__codelineno-25-9 href=#__codelineno-25-9></a><span class=k>done</span>
<a id=__codelineno-25-10 name=__codelineno-25-10 href=#__codelineno-25-10></a>
<a id=__codelineno-25-11 name=__codelineno-25-11 href=#__codelineno-25-11></a>然后添加脚本执行权限，<span class=w> </span>写入的crontab里每分钟执行一次
<a id=__codelineno-25-12 name=__codelineno-25-12 href=#__codelineno-25-12></a><span class=o>[</span>root@test<span class=w> </span>~<span class=o>]</span><span class=c1># chmod 755 kevin.sh</span>
<a id=__codelineno-25-13 name=__codelineno-25-13 href=#__codelineno-25-13></a><span class=o>[</span>root@test<span class=w> </span>~<span class=o>]</span><span class=c1># crontab -e</span>
<a id=__codelineno-25-14 name=__codelineno-25-14 href=#__codelineno-25-14></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-25-15 name=__codelineno-25-15 href=#__codelineno-25-15></a>
<a id=__codelineno-25-16 name=__codelineno-25-16 href=#__codelineno-25-16></a><span class=o>[</span>root@test<span class=w> </span>~<span class=o>]</span><span class=c1># ps -ef|grep kevin.sh</span>
<a id=__codelineno-25-17 name=__codelineno-25-17 href=#__codelineno-25-17></a>root<span class=w>     </span><span class=m>30515</span><span class=w> </span><span class=m>30514</span><span class=w>  </span><span class=m>0</span><span class=w> </span><span class=m>16</span>:27<span class=w> </span>?<span class=w>        </span><span class=m>00</span>:00:00<span class=w> </span>/bin/sh<span class=w> </span>-c<span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-25-18 name=__codelineno-25-18 href=#__codelineno-25-18></a>root<span class=w>     </span><span class=m>30516</span><span class=w> </span><span class=m>30515</span><span class=w>  </span><span class=m>0</span><span class=w> </span><span class=m>16</span>:27<span class=w> </span>?<span class=w>        </span><span class=m>00</span>:00:00<span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh
<a id=__codelineno-25-19 name=__codelineno-25-19 href=#__codelineno-25-19></a>root<span class=w>     </span><span class=m>30527</span><span class=w> </span><span class=m>16356</span><span class=w>  </span><span class=m>0</span><span class=w> </span><span class=m>16</span>:27<span class=w> </span>pts/0<span class=w>    </span><span class=m>00</span>:00:00<span class=w> </span>grep<span class=w> </span>kevin.sh
<a id=__codelineno-25-20 name=__codelineno-25-20 href=#__codelineno-25-20></a>
<a id=__codelineno-25-21 name=__codelineno-25-21 href=#__codelineno-25-21></a><span class=o>[</span>root@test<span class=w> </span>~<span class=o>]</span><span class=c1># tail -f /root/test.log</span>
<a id=__codelineno-25-22 name=__codelineno-25-22 href=#__codelineno-25-22></a>beijing<span class=w> </span>is<span class=w> </span>so<span class=w> </span>good!
<a id=__codelineno-25-23 name=__codelineno-25-23 href=#__codelineno-25-23></a>beijing<span class=w> </span>is<span class=w> </span>so<span class=w> </span>good!
<a id=__codelineno-25-24 name=__codelineno-25-24 href=#__codelineno-25-24></a>beijing<span class=w> </span>is<span class=w> </span>so<span class=w> </span>good!
<a id=__codelineno-25-25 name=__codelineno-25-25 href=#__codelineno-25-25></a>beijing<span class=w> </span>is<span class=w> </span>so<span class=w> </span>good!
<a id=__codelineno-25-26 name=__codelineno-25-26 href=#__codelineno-25-26></a>beijing<span class=w> </span>is<span class=w> </span>so<span class=w> </span>good!
<a id=__codelineno-25-27 name=__codelineno-25-27 href=#__codelineno-25-27></a>beijing<span class=w> </span>is<span class=w> </span>so<span class=w> </span>good!
<a id=__codelineno-25-28 name=__codelineno-25-28 href=#__codelineno-25-28></a>.......
</code></pre></div> <h3 id=example3>example3<a class=headerlink href=#example3 title="Permanent link">&para;</a></h3> <ul> <li>使用 crontab 计划任务来直接实现！经验证，这种方式是最靠谱，最稳妥的！</li> </ul> <div class=highlight><pre><span></span><code><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a><span class=o>[</span>root@test<span class=w> </span>~<span class=o>]</span><span class=c1># cat /root/kevin.sh</span>
<a id=__codelineno-26-2 name=__codelineno-26-2 href=#__codelineno-26-2></a><span class=c1>#!/bin/bash</span>
<a id=__codelineno-26-3 name=__codelineno-26-3 href=#__codelineno-26-3></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;beijing is so good!&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span>/root/test.log
<a id=__codelineno-26-4 name=__codelineno-26-4 href=#__codelineno-26-4></a>
<a id=__codelineno-26-5 name=__codelineno-26-5 href=#__codelineno-26-5></a>添加脚本执行权限，并配置到crontab计划任务里（使用<span class=o>&amp;&amp;</span><span class=w> </span>或者<span class=w> </span>；都是一样的效果）。思路：先过一分钟执行第一次，接着就是每隔2秒钟执行一次。
<a id=__codelineno-26-6 name=__codelineno-26-6 href=#__codelineno-26-6></a><span class=o>[</span>root@test<span class=w> </span>~<span class=o>]</span><span class=c1># chmod 755 /root/kevin.sh</span>
<a id=__codelineno-26-7 name=__codelineno-26-7 href=#__codelineno-26-7></a><span class=o>[</span>root@test<span class=w> </span>~<span class=o>]</span><span class=c1># crontab -e</span>
<a id=__codelineno-26-8 name=__codelineno-26-8 href=#__codelineno-26-8></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-26-9 name=__codelineno-26-9 href=#__codelineno-26-9></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>sleep<span class=w> </span><span class=m>2</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w>  </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-26-10 name=__codelineno-26-10 href=#__codelineno-26-10></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>sleep<span class=w> </span><span class=m>4</span><span class=p>;</span><span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-26-11 name=__codelineno-26-11 href=#__codelineno-26-11></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>sleep<span class=w> </span><span class=m>6</span><span class=p>;</span><span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-26-12 name=__codelineno-26-12 href=#__codelineno-26-12></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>sleep<span class=w> </span><span class=m>8</span><span class=p>;</span><span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-26-13 name=__codelineno-26-13 href=#__codelineno-26-13></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>sleep<span class=w> </span><span class=m>10</span><span class=p>;</span><span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-26-14 name=__codelineno-26-14 href=#__codelineno-26-14></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>sleep<span class=w> </span><span class=m>12</span><span class=p>;</span><span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-26-15 name=__codelineno-26-15 href=#__codelineno-26-15></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>sleep<span class=w> </span><span class=m>14</span><span class=p>;</span><span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-26-16 name=__codelineno-26-16 href=#__codelineno-26-16></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>sleep<span class=w> </span><span class=m>16</span><span class=p>;</span><span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-26-17 name=__codelineno-26-17 href=#__codelineno-26-17></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>sleep<span class=w> </span><span class=m>18</span><span class=p>;</span><span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-26-18 name=__codelineno-26-18 href=#__codelineno-26-18></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>sleep<span class=w> </span><span class=m>20</span><span class=p>;</span><span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-26-19 name=__codelineno-26-19 href=#__codelineno-26-19></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>sleep<span class=w> </span><span class=m>22</span><span class=p>;</span><span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-26-20 name=__codelineno-26-20 href=#__codelineno-26-20></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>sleep<span class=w> </span><span class=m>24</span><span class=p>;</span><span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-26-21 name=__codelineno-26-21 href=#__codelineno-26-21></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>sleep<span class=w> </span><span class=m>26</span><span class=p>;</span><span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-26-22 name=__codelineno-26-22 href=#__codelineno-26-22></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>sleep<span class=w> </span><span class=m>28</span><span class=p>;</span><span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-26-23 name=__codelineno-26-23 href=#__codelineno-26-23></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>sleep<span class=w> </span><span class=m>30</span><span class=p>;</span><span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-26-24 name=__codelineno-26-24 href=#__codelineno-26-24></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>sleep<span class=w> </span><span class=m>32</span><span class=p>;</span><span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-26-25 name=__codelineno-26-25 href=#__codelineno-26-25></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>sleep<span class=w> </span><span class=m>34</span><span class=p>;</span><span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-26-26 name=__codelineno-26-26 href=#__codelineno-26-26></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>sleep<span class=w> </span><span class=m>36</span><span class=p>;</span><span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-26-27 name=__codelineno-26-27 href=#__codelineno-26-27></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>sleep<span class=w> </span><span class=m>38</span><span class=p>;</span><span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-26-28 name=__codelineno-26-28 href=#__codelineno-26-28></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>sleep<span class=w> </span><span class=m>40</span><span class=p>;</span><span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-26-29 name=__codelineno-26-29 href=#__codelineno-26-29></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>sleep<span class=w> </span><span class=m>42</span><span class=p>;</span><span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-26-30 name=__codelineno-26-30 href=#__codelineno-26-30></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>sleep<span class=w> </span><span class=m>44</span><span class=p>;</span><span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-26-31 name=__codelineno-26-31 href=#__codelineno-26-31></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>sleep<span class=w> </span><span class=m>46</span><span class=p>;</span><span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-26-32 name=__codelineno-26-32 href=#__codelineno-26-32></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>sleep<span class=w> </span><span class=m>48</span><span class=p>;</span><span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-26-33 name=__codelineno-26-33 href=#__codelineno-26-33></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>sleep<span class=w> </span><span class=m>50</span><span class=p>;</span><span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-26-34 name=__codelineno-26-34 href=#__codelineno-26-34></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>sleep<span class=w> </span><span class=m>52</span><span class=p>;</span><span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-26-35 name=__codelineno-26-35 href=#__codelineno-26-35></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>sleep<span class=w> </span><span class=m>54</span><span class=p>;</span><span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-26-36 name=__codelineno-26-36 href=#__codelineno-26-36></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>sleep<span class=w> </span><span class=m>56</span><span class=p>;</span><span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-26-37 name=__codelineno-26-37 href=#__codelineno-26-37></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>sleep<span class=w> </span><span class=m>58</span><span class=p>;</span><span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-26-38 name=__codelineno-26-38 href=#__codelineno-26-38></a>
<a id=__codelineno-26-39 name=__codelineno-26-39 href=#__codelineno-26-39></a><span class=o>[</span>root@test<span class=w> </span>~<span class=o>]</span><span class=c1># tail -f /root/test.log</span>
<a id=__codelineno-26-40 name=__codelineno-26-40 href=#__codelineno-26-40></a>beijing<span class=w> </span>is<span class=w> </span>so<span class=w> </span>good!
<a id=__codelineno-26-41 name=__codelineno-26-41 href=#__codelineno-26-41></a>beijing<span class=w> </span>is<span class=w> </span>so<span class=w> </span>good!
<a id=__codelineno-26-42 name=__codelineno-26-42 href=#__codelineno-26-42></a>beijing<span class=w> </span>is<span class=w> </span>so<span class=w> </span>good!
<a id=__codelineno-26-43 name=__codelineno-26-43 href=#__codelineno-26-43></a>beijing<span class=w> </span>is<span class=w> </span>so<span class=w> </span>good!
<a id=__codelineno-26-44 name=__codelineno-26-44 href=#__codelineno-26-44></a>beijing<span class=w> </span>is<span class=w> </span>so<span class=w> </span>good!
<a id=__codelineno-26-45 name=__codelineno-26-45 href=#__codelineno-26-45></a>beijing<span class=w> </span>is<span class=w> </span>so<span class=w> </span>good!
<a id=__codelineno-26-46 name=__codelineno-26-46 href=#__codelineno-26-46></a>beijing<span class=w> </span>is<span class=w> </span>so<span class=w> </span>good!
<a id=__codelineno-26-47 name=__codelineno-26-47 href=#__codelineno-26-47></a>beijing<span class=w> </span>is<span class=w> </span>so<span class=w> </span>good!
<a id=__codelineno-26-48 name=__codelineno-26-48 href=#__codelineno-26-48></a>beijing<span class=w> </span>is<span class=w> </span>so<span class=w> </span>good!
</code></pre></div> <p>一个取巧的方法如下。</p> <p>行秒级的定时任务</p> <div class=highlight><pre><span></span><code><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>cmd
<a id=__codelineno-27-2 name=__codelineno-27-2 href=#__codelineno-27-2></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>sleep<span class=w> </span><span class=m>20</span><span class=p>;</span><span class=w> </span>cmd
<a id=__codelineno-27-3 name=__codelineno-27-3 href=#__codelineno-27-3></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>sleep<span class=w> </span><span class=m>40</span><span class=p>;</span><span class=w> </span>cmd
</code></pre></div> <h2 id=18备份文件>18.备份文件<a class=headerlink href=#18备份文件 title="Permanent link">&para;</a></h2> <ul> <li>Auto_Backup_Linux_System_Files.sh</li> </ul> <div class=highlight><pre><span></span><code><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a><span class=ch>#!/usr/bin/env bash</span>
<a id=__codelineno-28-2 name=__codelineno-28-2 href=#__codelineno-28-2></a>
<a id=__codelineno-28-3 name=__codelineno-28-3 href=#__codelineno-28-3></a><span class=nv>SOURCE_DIR</span><span class=o>=(</span>
<a id=__codelineno-28-4 name=__codelineno-28-4 href=#__codelineno-28-4></a><span class=w>    </span><span class=nv>$*</span>
<a id=__codelineno-28-5 name=__codelineno-28-5 href=#__codelineno-28-5></a><span class=o>)</span>
<a id=__codelineno-28-6 name=__codelineno-28-6 href=#__codelineno-28-6></a><span class=nv>TARGET_DIR</span><span class=o>=</span>/data/backup/
<a id=__codelineno-28-7 name=__codelineno-28-7 href=#__codelineno-28-7></a><span class=nv>YEAR</span><span class=o>=</span><span class=sb>`</span>date<span class=w> </span>+%Y<span class=sb>`</span>
<a id=__codelineno-28-8 name=__codelineno-28-8 href=#__codelineno-28-8></a><span class=nv>MONTH</span><span class=o>=</span><span class=sb>`</span>date<span class=w> </span>+%m<span class=sb>`</span>
<a id=__codelineno-28-9 name=__codelineno-28-9 href=#__codelineno-28-9></a><span class=nv>DAY</span><span class=o>=</span><span class=sb>`</span>date<span class=w> </span>+%d<span class=sb>`</span>
<a id=__codelineno-28-10 name=__codelineno-28-10 href=#__codelineno-28-10></a><span class=nv>WEEK</span><span class=o>=</span><span class=sb>`</span>date<span class=w> </span>+%u<span class=sb>`</span>
<a id=__codelineno-28-11 name=__codelineno-28-11 href=#__codelineno-28-11></a><span class=nv>FILES</span><span class=o>=</span>system_backup.tgz
<a id=__codelineno-28-12 name=__codelineno-28-12 href=#__codelineno-28-12></a><span class=nv>CODE</span><span class=o>=</span><span class=nv>$?</span>
<a id=__codelineno-28-13 name=__codelineno-28-13 href=#__codelineno-28-13></a>
<a id=__codelineno-28-14 name=__codelineno-28-14 href=#__codelineno-28-14></a>
<a id=__codelineno-28-15 name=__codelineno-28-15 href=#__codelineno-28-15></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=nv>$*</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-28-16 name=__codelineno-28-16 href=#__codelineno-28-16></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;\033[32mUsage:\nPlease Ebter Your Backup Files or Directories\n--------------------------------------------\n</span>
<a id=__codelineno-28-17 name=__codelineno-28-17 href=#__codelineno-28-17></a><span class=s2>    \nUsage:{ </span><span class=nv>$0</span><span class=s2> /boot/etc}\033[0m&quot;</span>
<a id=__codelineno-28-18 name=__codelineno-28-18 href=#__codelineno-28-18></a><span class=w>    </span><span class=nb>exit</span>
<a id=__codelineno-28-19 name=__codelineno-28-19 href=#__codelineno-28-19></a><span class=k>fi</span>
<a id=__codelineno-28-20 name=__codelineno-28-20 href=#__codelineno-28-20></a>
<a id=__codelineno-28-21 name=__codelineno-28-21 href=#__codelineno-28-21></a><span class=c1># Deternube Wgether the Target Directory Exists</span>
<a id=__codelineno-28-22 name=__codelineno-28-22 href=#__codelineno-28-22></a>
<a id=__codelineno-28-23 name=__codelineno-28-23 href=#__codelineno-28-23></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>!<span class=w> </span>-d<span class=w> </span><span class=nv>$TARGET_DIR</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-28-24 name=__codelineno-28-24 href=#__codelineno-28-24></a><span class=w>    </span>mkdir<span class=w> </span>-p<span class=w> </span><span class=nv>$TARGET_DIR</span>/<span class=nv>$YEAR</span>/<span class=nv>$MONTH</span>/<span class=nv>$DAY</span>
<a id=__codelineno-28-25 name=__codelineno-28-25 href=#__codelineno-28-25></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;\033[32mThe </span><span class=nv>$TARGET_DIR</span><span class=s2> Create Successfully ! \033[0m&quot;</span>
<a id=__codelineno-28-26 name=__codelineno-28-26 href=#__codelineno-28-26></a><span class=k>fi</span>
<a id=__codelineno-28-27 name=__codelineno-28-27 href=#__codelineno-28-27></a>
<a id=__codelineno-28-28 name=__codelineno-28-28 href=#__codelineno-28-28></a><span class=c1>#EXEC Full_Backup Function Command</span>
<a id=__codelineno-28-29 name=__codelineno-28-29 href=#__codelineno-28-29></a><span class=c1>#EXEC Full_Backup Function Command</span>
<a id=__codelineno-28-30 name=__codelineno-28-30 href=#__codelineno-28-30></a>Full_Backup<span class=o>()</span>
<a id=__codelineno-28-31 name=__codelineno-28-31 href=#__codelineno-28-31></a><span class=o>{</span>
<a id=__codelineno-28-32 name=__codelineno-28-32 href=#__codelineno-28-32></a><span class=k>if</span>
<a id=__codelineno-28-33 name=__codelineno-28-33 href=#__codelineno-28-33></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$WEEK</span><span class=s2>&quot;</span><span class=w> </span>-eq<span class=w> </span><span class=s2>&quot;7&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=k>then</span>
<a id=__codelineno-28-34 name=__codelineno-28-34 href=#__codelineno-28-34></a><span class=w>    </span>rm<span class=w> </span>-rf<span class=w> </span><span class=nv>$TARGET_DIR</span>/snapshot
<a id=__codelineno-28-35 name=__codelineno-28-35 href=#__codelineno-28-35></a><span class=w>    </span><span class=nb>cd</span><span class=w> </span><span class=nv>$TARGET_DIR</span>/<span class=nv>$YEAR</span>/<span class=nv>$MONTH</span>/<span class=nv>$DAY</span><span class=w> </span><span class=p>;</span>tar<span class=w> </span>-g<span class=w> </span><span class=nv>$TARGET_DIR</span>/snapshot<span class=w> </span>-czvf<span class=w> </span><span class=nv>$FILES</span><span class=w> </span><span class=sb>`</span><span class=nb>echo</span><span class=w> </span><span class=si>${</span><span class=nv>SOURCE_DIR</span><span class=p>[@]</span><span class=si>}</span><span class=sb>`</span>
<a id=__codelineno-28-36 name=__codelineno-28-36 href=#__codelineno-28-36></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$CODE</span><span class=s2>&quot;</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s2>&quot;0&quot;</span><span class=w> </span><span class=o>]&amp;&amp;</span><span class=nb>echo</span><span class=w> </span>-e<span class=w>  </span><span class=s2>&quot;--------------------------------------------\nFull_Backup System Files Backup Successfully !&quot;</span>
<a id=__codelineno-28-37 name=__codelineno-28-37 href=#__codelineno-28-37></a><span class=k>fi</span>
<a id=__codelineno-28-38 name=__codelineno-28-38 href=#__codelineno-28-38></a><span class=o>}</span>
<a id=__codelineno-28-39 name=__codelineno-28-39 href=#__codelineno-28-39></a><span class=c1>#Perform incremental BACKUP Function Command</span>
<a id=__codelineno-28-40 name=__codelineno-28-40 href=#__codelineno-28-40></a>Add_Backup<span class=o>()</span>
<a id=__codelineno-28-41 name=__codelineno-28-41 href=#__codelineno-28-41></a><span class=o>{</span>
<a id=__codelineno-28-42 name=__codelineno-28-42 href=#__codelineno-28-42></a><span class=w>   </span><span class=nb>cd</span><span class=w> </span><span class=nv>$TARGET_DIR</span>/<span class=nv>$YEAR</span>/<span class=nv>$MONTH</span>/<span class=nv>$DAY</span><span class=w> </span><span class=p>;</span>
<a id=__codelineno-28-43 name=__codelineno-28-43 href=#__codelineno-28-43></a><span class=k>if</span>
<a id=__codelineno-28-44 name=__codelineno-28-44 href=#__codelineno-28-44></a><span class=w>    </span><span class=o>[</span><span class=w> </span>-f<span class=w> </span><span class=nv>$TARGET_DIR</span>/<span class=nv>$YEAR</span>/<span class=nv>$MONTH</span>/<span class=nv>$DAY</span>/<span class=nv>$FILES</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=k>then</span>
<a id=__codelineno-28-45 name=__codelineno-28-45 href=#__codelineno-28-45></a><span class=w>    </span><span class=nb>read</span><span class=w> </span>-p<span class=w> </span><span class=s2>&quot;</span><span class=nv>$FILES</span><span class=s2> Already Exists, overwrite confirmation yes or no ? : &quot;</span><span class=w> </span>SURE
<a id=__codelineno-28-46 name=__codelineno-28-46 href=#__codelineno-28-46></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=nv>$SURE</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s2>&quot;no&quot;</span><span class=w> </span>-o<span class=w> </span><span class=nv>$SURE</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s2>&quot;n&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=k>then</span>
<a id=__codelineno-28-47 name=__codelineno-28-47 href=#__codelineno-28-47></a><span class=w>    </span>sleep<span class=w> </span><span class=m>1</span><span class=p>;</span><span class=nb>exit</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-28-48 name=__codelineno-28-48 href=#__codelineno-28-48></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-28-49 name=__codelineno-28-49 href=#__codelineno-28-49></a><span class=c1>#Add_Backup Files System</span>
<a id=__codelineno-28-50 name=__codelineno-28-50 href=#__codelineno-28-50></a><span class=w>    </span><span class=k>if</span>
<a id=__codelineno-28-51 name=__codelineno-28-51 href=#__codelineno-28-51></a><span class=w>        </span><span class=o>[</span><span class=w> </span><span class=nv>$WEEK</span><span class=w> </span>-ne<span class=w> </span><span class=s2>&quot;7&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=k>then</span>
<a id=__codelineno-28-52 name=__codelineno-28-52 href=#__codelineno-28-52></a><span class=w>        </span><span class=nb>cd</span><span class=w> </span><span class=nv>$TARGET_DIR</span>/<span class=nv>$YEAR</span>/<span class=nv>$MONTH</span>/<span class=nv>$DAY</span><span class=p>;</span>tar<span class=w> </span>-g<span class=w> </span><span class=nv>$TARGET_DIR</span>/snapshot<span class=w> </span>-czvf<span class=w> </span><span class=nv>$$</span>_<span class=nv>$FILES</span><span class=w> </span><span class=sb>`</span><span class=nb>echo</span><span class=w> </span><span class=si>${</span><span class=nv>SOURCE_DIR</span><span class=p>[@]</span><span class=si>}</span><span class=sb>`</span>
<a id=__codelineno-28-53 name=__codelineno-28-53 href=#__codelineno-28-53></a><span class=w>        </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$CODE</span><span class=s2>&quot;</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s2>&quot;0&quot;</span><span class=w> </span><span class=o>]&amp;&amp;</span><span class=nb>echo</span><span class=w> </span>-e<span class=w>  </span><span class=s2>&quot;-----------------------------------------\n\033[32mAdd_Backup System Files Backup Successfully !\033[0m&quot;</span>
<a id=__codelineno-28-54 name=__codelineno-28-54 href=#__codelineno-28-54></a><span class=w>   </span><span class=k>fi</span>
<a id=__codelineno-28-55 name=__codelineno-28-55 href=#__codelineno-28-55></a><span class=k>else</span>
<a id=__codelineno-28-56 name=__codelineno-28-56 href=#__codelineno-28-56></a><span class=w>   </span><span class=k>if</span>
<a id=__codelineno-28-57 name=__codelineno-28-57 href=#__codelineno-28-57></a><span class=w>      </span><span class=o>[</span><span class=w> </span><span class=nv>$WEEK</span><span class=w> </span>-ne<span class=w> </span><span class=s2>&quot;7&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=k>then</span>
<a id=__codelineno-28-58 name=__codelineno-28-58 href=#__codelineno-28-58></a><span class=w>      </span><span class=nb>cd</span><span class=w> </span><span class=nv>$TARGET_DIR</span>/<span class=nv>$YEAR</span>/<span class=nv>$MONTH</span>/<span class=nv>$DAY</span><span class=w> </span><span class=p>;</span>tar<span class=w> </span>-g<span class=w> </span><span class=nv>$TARGET_DIR</span>/snapshot<span class=w> </span>-czvf<span class=w> </span><span class=nv>$FILES</span><span class=w> </span><span class=sb>`</span><span class=nb>echo</span><span class=w> </span><span class=si>${</span><span class=nv>SOURCE_DIR</span><span class=p>[@]</span><span class=si>}</span><span class=sb>`</span>
<a id=__codelineno-28-59 name=__codelineno-28-59 href=#__codelineno-28-59></a><span class=w>      </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$CODE</span><span class=s2>&quot;</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s2>&quot;0&quot;</span><span class=w> </span><span class=o>]&amp;&amp;</span><span class=nb>echo</span><span class=w> </span>-e<span class=w>  </span><span class=s2>&quot;-------------------------------------------\n\033[32mAdd_Backup System Files Backup Successfully !\033[0m&quot;</span>
<a id=__codelineno-28-60 name=__codelineno-28-60 href=#__codelineno-28-60></a><span class=w>   </span><span class=k>fi</span>
<a id=__codelineno-28-61 name=__codelineno-28-61 href=#__codelineno-28-61></a><span class=k>fi</span>
<a id=__codelineno-28-62 name=__codelineno-28-62 href=#__codelineno-28-62></a><span class=o>}</span>
<a id=__codelineno-28-63 name=__codelineno-28-63 href=#__codelineno-28-63></a>Full_Backup
<a id=__codelineno-28-64 name=__codelineno-28-64 href=#__codelineno-28-64></a>Add_Backup
<a id=__codelineno-28-65 name=__codelineno-28-65 href=#__codelineno-28-65></a>
<a id=__codelineno-28-66 name=__codelineno-28-66 href=#__codelineno-28-66></a>
<a id=__codelineno-28-67 name=__codelineno-28-67 href=#__codelineno-28-67></a><span class=c1># crontab计划任务中加入如下语句，每天凌晨1点整执行备份脚本。</span>
<a id=__codelineno-28-68 name=__codelineno-28-68 href=#__codelineno-28-68></a><span class=c1># 0 1 *  *  * /bin/sh /data/sh/Auto_Backup_Linux_System_Files.sh /boot /etc/ &gt;&gt; /tmp/back.log 2&gt;&amp;1</span>
</code></pre></div> <h2 id=19修改-ip-主机名网卡信息>19.修改 IP 主机名网卡信息<a class=headerlink href=#19修改-ip-主机名网卡信息 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-29-1 name=__codelineno-29-1 href=#__codelineno-29-1></a><span class=ch>#!/usr/bin/env bash</span>
<a id=__codelineno-29-2 name=__codelineno-29-2 href=#__codelineno-29-2></a>
<a id=__codelineno-29-3 name=__codelineno-29-3 href=#__codelineno-29-3></a><span class=c1>#静态IP修改</span>
<a id=__codelineno-29-4 name=__codelineno-29-4 href=#__codelineno-29-4></a><span class=c1>#动态IP修改</span>
<a id=__codelineno-29-5 name=__codelineno-29-5 href=#__codelineno-29-5></a><span class=c1>#根据IP生产主机名并配置</span>
<a id=__codelineno-29-6 name=__codelineno-29-6 href=#__codelineno-29-6></a><span class=c1>#修改DNS域名解析</span>
<a id=__codelineno-29-7 name=__codelineno-29-7 href=#__codelineno-29-7></a><span class=nv>ETHCONF</span><span class=o>=</span>/etc/sysconfig/network-scripts/ifcfg-ens32
<a id=__codelineno-29-8 name=__codelineno-29-8 href=#__codelineno-29-8></a><span class=nv>HOSTS</span><span class=o>=</span>/etc/hosts
<a id=__codelineno-29-9 name=__codelineno-29-9 href=#__codelineno-29-9></a><span class=nv>NETWORK</span><span class=o>=</span>/etc/sysconfig/network
<a id=__codelineno-29-10 name=__codelineno-29-10 href=#__codelineno-29-10></a><span class=nv>DIR</span><span class=o>=</span>/data/backup/<span class=sb>`</span>date<span class=w> </span>+%Y%m%d<span class=sb>`</span>
<a id=__codelineno-29-11 name=__codelineno-29-11 href=#__codelineno-29-11></a><span class=nv>NETMASK</span><span class=o>=</span><span class=m>255</span>.255.255.0
<a id=__codelineno-29-12 name=__codelineno-29-12 href=#__codelineno-29-12></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;------------------------------------------------------------------&quot;</span>
<a id=__codelineno-29-13 name=__codelineno-29-13 href=#__codelineno-29-13></a>judeg_ip<span class=o>(){</span>
<a id=__codelineno-29-14 name=__codelineno-29-14 href=#__codelineno-29-14></a><span class=w>    </span><span class=nb>read</span><span class=w> </span>-p<span class=w> </span><span class=s2>&quot;Please enter ip Address,example 192.168.0.11 ip&quot;</span>:IPADDR
<a id=__codelineno-29-15 name=__codelineno-29-15 href=#__codelineno-29-15></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=nv>$IPADDR</span><span class=p>|</span>grep<span class=w> </span>-v<span class=w> </span><span class=s2>&quot;[Az-Zz]&quot;</span><span class=p>|</span>grep<span class=w> </span>--color<span class=w> </span>-E<span class=w> </span><span class=s2>&quot;([0-9]{1,3}\.){3}[0-9]{1,3}&quot;</span>
<a id=__codelineno-29-16 name=__codelineno-29-16 href=#__codelineno-29-16></a><span class=o>}</span>
<a id=__codelineno-29-17 name=__codelineno-29-17 href=#__codelineno-29-17></a>
<a id=__codelineno-29-18 name=__codelineno-29-18 href=#__codelineno-29-18></a>count_ip<span class=o>(){</span>
<a id=__codelineno-29-19 name=__codelineno-29-19 href=#__codelineno-29-19></a><span class=w>    </span><span class=nv>count</span><span class=o>=(</span><span class=sb>`</span><span class=nb>echo</span><span class=w> </span><span class=si>${</span><span class=nv>IPADDR</span><span class=si>}</span><span class=p>|</span>awk<span class=w> </span>-F.<span class=w> </span><span class=s1>&#39;{print $1,$2,$3,$4}&#39;</span><span class=sb>`</span><span class=o>)</span>
<a id=__codelineno-29-20 name=__codelineno-29-20 href=#__codelineno-29-20></a><span class=w>    </span><span class=nv>IP1</span><span class=o>=</span><span class=si>${</span><span class=nv>count</span><span class=p>[0]</span><span class=si>}</span>
<a id=__codelineno-29-21 name=__codelineno-29-21 href=#__codelineno-29-21></a><span class=w>    </span><span class=nv>IP2</span><span class=o>=</span><span class=si>${</span><span class=nv>count</span><span class=p>[1]</span><span class=si>}</span>
<a id=__codelineno-29-22 name=__codelineno-29-22 href=#__codelineno-29-22></a><span class=w>    </span><span class=nv>IP3</span><span class=o>=</span><span class=si>${</span><span class=nv>count</span><span class=p>[2]</span><span class=si>}</span>
<a id=__codelineno-29-23 name=__codelineno-29-23 href=#__codelineno-29-23></a><span class=w>    </span><span class=nv>IP4</span><span class=o>=</span><span class=si>${</span><span class=nv>count</span><span class=p>[3]</span><span class=si>}</span>
<a id=__codelineno-29-24 name=__codelineno-29-24 href=#__codelineno-29-24></a><span class=o>}</span>
<a id=__codelineno-29-25 name=__codelineno-29-25 href=#__codelineno-29-25></a>
<a id=__codelineno-29-26 name=__codelineno-29-26 href=#__codelineno-29-26></a>
<a id=__codelineno-29-27 name=__codelineno-29-27 href=#__codelineno-29-27></a>ip_check<span class=o>(){</span>
<a id=__codelineno-29-28 name=__codelineno-29-28 href=#__codelineno-29-28></a>judeg_ip
<a id=__codelineno-29-29 name=__codelineno-29-29 href=#__codelineno-29-29></a>
<a id=__codelineno-29-30 name=__codelineno-29-30 href=#__codelineno-29-30></a><span class=k>while</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$?</span><span class=s2>&quot;</span><span class=w> </span>-ne<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>do</span>
<a id=__codelineno-29-31 name=__codelineno-29-31 href=#__codelineno-29-31></a><span class=w>    </span>judeg_ip
<a id=__codelineno-29-32 name=__codelineno-29-32 href=#__codelineno-29-32></a><span class=k>done</span>
<a id=__codelineno-29-33 name=__codelineno-29-33 href=#__codelineno-29-33></a>
<a id=__codelineno-29-34 name=__codelineno-29-34 href=#__codelineno-29-34></a>count_ip
<a id=__codelineno-29-35 name=__codelineno-29-35 href=#__codelineno-29-35></a><span class=k>while</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$IP1</span><span class=s2>&quot;</span><span class=w> </span>-lt<span class=w> </span><span class=m>0</span><span class=w> </span>-o<span class=w> </span><span class=s2>&quot;</span><span class=nv>$IP1</span><span class=s2>&quot;</span><span class=w> </span>-ge<span class=w> </span><span class=m>255</span><span class=w> </span>-o<span class=w> </span><span class=s2>&quot;</span><span class=nv>$IP2</span><span class=s2>&quot;</span><span class=w> </span>-ge<span class=w> </span><span class=m>255</span><span class=w> </span>-o<span class=w> </span><span class=s2>&quot;</span><span class=nv>$IP3</span><span class=s2>&quot;</span><span class=w> </span>-ge<span class=w> </span><span class=m>255</span><span class=w> </span>-o<span class=w> </span><span class=s2>&quot;</span><span class=nv>$IP4</span><span class=s2>&quot;</span><span class=w> </span>-ge<span class=w> </span><span class=m>255</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>do</span>
<a id=__codelineno-29-36 name=__codelineno-29-36 href=#__codelineno-29-36></a><span class=w>    </span>judeg_ip
<a id=__codelineno-29-37 name=__codelineno-29-37 href=#__codelineno-29-37></a><span class=w>    </span><span class=k>while</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$?</span><span class=s2>&quot;</span><span class=w> </span>-ne<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>do</span>
<a id=__codelineno-29-38 name=__codelineno-29-38 href=#__codelineno-29-38></a><span class=w>        </span>judeg_ip
<a id=__codelineno-29-39 name=__codelineno-29-39 href=#__codelineno-29-39></a><span class=w>    </span><span class=k>done</span>
<a id=__codelineno-29-40 name=__codelineno-29-40 href=#__codelineno-29-40></a><span class=w>    </span>count_ip
<a id=__codelineno-29-41 name=__codelineno-29-41 href=#__codelineno-29-41></a><span class=k>done</span>
<a id=__codelineno-29-42 name=__codelineno-29-42 href=#__codelineno-29-42></a><span class=o>}</span>
<a id=__codelineno-29-43 name=__codelineno-29-43 href=#__codelineno-29-43></a>
<a id=__codelineno-29-44 name=__codelineno-29-44 href=#__codelineno-29-44></a>
<a id=__codelineno-29-45 name=__codelineno-29-45 href=#__codelineno-29-45></a>change_ip<span class=o>(){</span>
<a id=__codelineno-29-46 name=__codelineno-29-46 href=#__codelineno-29-46></a>
<a id=__codelineno-29-47 name=__codelineno-29-47 href=#__codelineno-29-47></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>!<span class=w> </span>-d<span class=w> </span><span class=nv>$DIR</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-29-48 name=__codelineno-29-48 href=#__codelineno-29-48></a><span class=w>    </span>mkdir<span class=w> </span>-p<span class=w> </span><span class=nv>$DIR</span>
<a id=__codelineno-29-49 name=__codelineno-29-49 href=#__codelineno-29-49></a><span class=k>fi</span>
<a id=__codelineno-29-50 name=__codelineno-29-50 href=#__codelineno-29-50></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;The Change ip address to Backup Interface eth0&quot;</span>
<a id=__codelineno-29-51 name=__codelineno-29-51 href=#__codelineno-29-51></a>cp<span class=w> </span><span class=nv>$ETHCONF</span><span class=w> </span><span class=nv>$DIR</span>
<a id=__codelineno-29-52 name=__codelineno-29-52 href=#__codelineno-29-52></a>grep<span class=w> </span><span class=s2>&quot;dhcp&quot;</span><span class=w> </span><span class=nv>$ETHCONF</span>
<a id=__codelineno-29-53 name=__codelineno-29-53 href=#__codelineno-29-53></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$?</span><span class=s2>&quot;</span><span class=w> </span>-eq<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-29-54 name=__codelineno-29-54 href=#__codelineno-29-54></a><span class=w>    </span><span class=nb>read</span><span class=w> </span>-p<span class=w> </span><span class=s2>&quot;Please enter ip Address:&quot;</span><span class=w> </span>IPADDR
<a id=__codelineno-29-55 name=__codelineno-29-55 href=#__codelineno-29-55></a><span class=w>    </span>sed<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;s/dhcp/static/g&#39;</span><span class=w> </span><span class=nv>$ETHCONF</span>
<a id=__codelineno-29-56 name=__codelineno-29-56 href=#__codelineno-29-56></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;IPADDR=</span><span class=nv>$IPADDR</span><span class=s2>\nNERMASK=</span><span class=nv>$NETMASK</span><span class=s2>\nGATEWAY=`echo </span><span class=nv>$IPADDR</span><span class=s2>|awk -F. &#39;{print </span><span class=nv>$1</span><span class=s2>&quot;</span>.<span class=s2>&quot;</span><span class=nv>$2</span><span class=s2>&quot;</span>.<span class=s2>&quot;</span><span class=nv>$3</span><span class=s2>}&#39;`.2&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span><span class=nv>$ETHCONF</span>
<a id=__codelineno-29-57 name=__codelineno-29-57 href=#__codelineno-29-57></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;The IP configuration success. !&quot;</span>
<a id=__codelineno-29-58 name=__codelineno-29-58 href=#__codelineno-29-58></a><span class=k>else</span>
<a id=__codelineno-29-59 name=__codelineno-29-59 href=#__codelineno-29-59></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;Static IP has been configured,please confirm whether to modify,yes or No&quot;</span><span class=p>;</span>
<a id=__codelineno-29-60 name=__codelineno-29-60 href=#__codelineno-29-60></a><span class=w>    </span><span class=nb>read</span><span class=w> </span>i
<a id=__codelineno-29-61 name=__codelineno-29-61 href=#__codelineno-29-61></a><span class=k>fi</span>
<a id=__codelineno-29-62 name=__codelineno-29-62 href=#__codelineno-29-62></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$i</span><span class=s2>&quot;</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s2>&quot;y&quot;</span><span class=w> </span>-o<span class=w> </span><span class=s2>&quot;</span><span class=nv>$i</span><span class=s2>&quot;</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s2>&quot;yes&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-29-63 name=__codelineno-29-63 href=#__codelineno-29-63></a><span class=w>    </span>ip_check
<a id=__codelineno-29-64 name=__codelineno-29-64 href=#__codelineno-29-64></a><span class=w>    </span>sed<span class=w> </span>-i<span class=w> </span>-e<span class=w> </span><span class=s1>&#39;/IPADDR/d&#39;</span><span class=w> </span>-e<span class=w> </span><span class=s1>&#39;/NETMASK/d&#39;</span><span class=w> </span>-e<span class=w> </span><span class=s1>&#39;/GATEWAY/d&#39;</span><span class=w> </span><span class=nv>$ETHCONF</span>
<a id=__codelineno-29-65 name=__codelineno-29-65 href=#__codelineno-29-65></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;IPADDR=</span><span class=nv>$IPADDR</span><span class=s2>\nNETMASK=</span><span class=nv>$NETMASK</span><span class=s2>\nGATEWAY=`echo  </span><span class=nv>$IPADDR</span><span class=s2>|awk -F. &#39;{print </span><span class=nv>$1</span><span class=s2>&quot;</span>.<span class=s2>&quot;</span><span class=nv>$2</span><span class=s2>&quot;</span>.<span class=s2>&quot;</span><span class=nv>$3</span><span class=s2>}&#39;`.2&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span><span class=nv>$ETHCONF</span>
<a id=__codelineno-29-66 name=__codelineno-29-66 href=#__codelineno-29-66></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;The IP configuration success. !&quot;</span>
<a id=__codelineno-29-67 name=__codelineno-29-67 href=#__codelineno-29-67></a><span class=w>    </span><span class=nb>echo</span>
<a id=__codelineno-29-68 name=__codelineno-29-68 href=#__codelineno-29-68></a><span class=k>else</span>
<a id=__codelineno-29-69 name=__codelineno-29-69 href=#__codelineno-29-69></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Static IP already exists,please exit.&quot;</span>
<a id=__codelineno-29-70 name=__codelineno-29-70 href=#__codelineno-29-70></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=nv>$?</span>
<a id=__codelineno-29-71 name=__codelineno-29-71 href=#__codelineno-29-71></a><span class=k>fi</span>
<a id=__codelineno-29-72 name=__codelineno-29-72 href=#__codelineno-29-72></a><span class=o>}</span>
<a id=__codelineno-29-73 name=__codelineno-29-73 href=#__codelineno-29-73></a>
<a id=__codelineno-29-74 name=__codelineno-29-74 href=#__codelineno-29-74></a>change_hosts<span class=o>(){</span>
<a id=__codelineno-29-75 name=__codelineno-29-75 href=#__codelineno-29-75></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>!<span class=w> </span>-d<span class=w> </span><span class=nv>$DIR</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-29-76 name=__codelineno-29-76 href=#__codelineno-29-76></a><span class=w>        </span>mkdir<span class=w> </span>-p<span class=w> </span><span class=nv>$DIR</span>
<a id=__codelineno-29-77 name=__codelineno-29-77 href=#__codelineno-29-77></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-29-78 name=__codelineno-29-78 href=#__codelineno-29-78></a><span class=w>    </span>cp<span class=w> </span><span class=nv>$HOSTS</span><span class=w> </span><span class=nv>$DIR</span>
<a id=__codelineno-29-79 name=__codelineno-29-79 href=#__codelineno-29-79></a><span class=w>    </span>ip_check
<a id=__codelineno-29-80 name=__codelineno-29-80 href=#__codelineno-29-80></a><span class=w>    </span><span class=nv>host</span><span class=o>=</span><span class=sb>`</span><span class=nb>echo</span><span class=w> </span><span class=nv>$IPADDR</span><span class=p>|</span>sed<span class=w> </span><span class=s1>&#39;s/\./-/g&#39;</span><span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;{print &quot;BJ-IDC-&quot; $0 &quot;-Hujianli.net&quot;}&#39;</span><span class=sb>`</span>
<a id=__codelineno-29-81 name=__codelineno-29-81 href=#__codelineno-29-81></a><span class=w>    </span>cat<span class=w> </span><span class=nv>$HOSTS</span><span class=p>|</span>grep<span class=w> </span><span class=s2>&quot;</span><span class=nv>$host</span><span class=s2>&quot;</span>
<a id=__codelineno-29-82 name=__codelineno-29-82 href=#__codelineno-29-82></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$?</span><span class=s2>&quot;</span><span class=w> </span>-ne<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-29-83 name=__codelineno-29-83 href=#__codelineno-29-83></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$IPADDR</span><span class=s2>    </span><span class=nv>$host</span><span class=s2>&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span><span class=nv>$HOSTS</span>
<a id=__codelineno-29-84 name=__codelineno-29-84 href=#__codelineno-29-84></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;The hosts modify success&quot;</span>
<a id=__codelineno-29-85 name=__codelineno-29-85 href=#__codelineno-29-85></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-29-86 name=__codelineno-29-86 href=#__codelineno-29-86></a><span class=w>    </span>grep<span class=w> </span><span class=s2>&quot;</span><span class=nv>$host</span><span class=s2>&quot;</span><span class=w> </span><span class=nv>$NETWORK</span>
<a id=__codelineno-29-87 name=__codelineno-29-87 href=#__codelineno-29-87></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$?</span><span class=s2>&quot;</span><span class=w> </span>-ne<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-29-88 name=__codelineno-29-88 href=#__codelineno-29-88></a><span class=w>        </span>sed<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;s/^HOSTNAME/#HOSTNAME/g&#39;</span><span class=w> </span><span class=nv>$NETWORK</span>
<a id=__codelineno-29-89 name=__codelineno-29-89 href=#__codelineno-29-89></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;NETWORK=</span><span class=nv>$host</span><span class=s2>&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span><span class=nv>$NETWORK</span>
<a id=__codelineno-29-90 name=__codelineno-29-90 href=#__codelineno-29-90></a><span class=w>        </span>hostname<span class=w> </span><span class=nv>$host</span><span class=p>;</span>su
<a id=__codelineno-29-91 name=__codelineno-29-91 href=#__codelineno-29-91></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-29-92 name=__codelineno-29-92 href=#__codelineno-29-92></a><span class=o>}</span>
<a id=__codelineno-29-93 name=__codelineno-29-93 href=#__codelineno-29-93></a>
<a id=__codelineno-29-94 name=__codelineno-29-94 href=#__codelineno-29-94></a>
<a id=__codelineno-29-95 name=__codelineno-29-95 href=#__codelineno-29-95></a><span class=nv>PS3</span><span class=o>=</span><span class=s2>&quot;Please Select configuration ip or configuration host:&quot;</span>
<a id=__codelineno-29-96 name=__codelineno-29-96 href=#__codelineno-29-96></a><span class=k>select</span><span class=w> </span>i<span class=w> </span><span class=k>in</span><span class=w> </span><span class=s2>&quot;modify_ip&quot;</span><span class=w> </span><span class=s2>&quot;modify_hosts&quot;</span><span class=w> </span><span class=s2>&quot;exit&quot;</span>
<a id=__codelineno-29-97 name=__codelineno-29-97 href=#__codelineno-29-97></a><span class=k>do</span>
<a id=__codelineno-29-98 name=__codelineno-29-98 href=#__codelineno-29-98></a><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$i</span><span class=s2>&quot;</span><span class=w> </span><span class=k>in</span>
<a id=__codelineno-29-99 name=__codelineno-29-99 href=#__codelineno-29-99></a><span class=w>    </span>modify_ip<span class=o>)</span>
<a id=__codelineno-29-100 name=__codelineno-29-100 href=#__codelineno-29-100></a><span class=w>        </span>change_ip
<a id=__codelineno-29-101 name=__codelineno-29-101 href=#__codelineno-29-101></a><span class=w>       </span><span class=p>;;</span>
<a id=__codelineno-29-102 name=__codelineno-29-102 href=#__codelineno-29-102></a><span class=w>    </span>modify_hosts<span class=o>)</span>
<a id=__codelineno-29-103 name=__codelineno-29-103 href=#__codelineno-29-103></a><span class=w>        </span>change_hosts
<a id=__codelineno-29-104 name=__codelineno-29-104 href=#__codelineno-29-104></a><span class=w>       </span><span class=p>;;</span>
<a id=__codelineno-29-105 name=__codelineno-29-105 href=#__codelineno-29-105></a><span class=w>    </span><span class=nb>exit</span><span class=o>)</span>
<a id=__codelineno-29-106 name=__codelineno-29-106 href=#__codelineno-29-106></a><span class=w>        </span><span class=nb>exit</span>
<a id=__codelineno-29-107 name=__codelineno-29-107 href=#__codelineno-29-107></a><span class=w>       </span><span class=p>;;</span>
<a id=__codelineno-29-108 name=__codelineno-29-108 href=#__codelineno-29-108></a><span class=w>    </span>*<span class=o>)</span>
<a id=__codelineno-29-109 name=__codelineno-29-109 href=#__codelineno-29-109></a><span class=w>       </span><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;1)modify_ip\n2)modify_host\n3)exit&quot;</span>
<a id=__codelineno-29-110 name=__codelineno-29-110 href=#__codelineno-29-110></a><span class=w>    </span><span class=k>esac</span>
<a id=__codelineno-29-111 name=__codelineno-29-111 href=#__codelineno-29-111></a><span class=k>done</span>
</code></pre></div> <h2 id=20检查恶意-ip-登录拒绝-ssh>20.检查恶意 IP 登录,拒绝 SSH<a class=headerlink href=#20检查恶意-ip-登录拒绝-ssh title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-30-1 name=__codelineno-30-1 href=#__codelineno-30-1></a><span class=ch>#!/usr/bin/env bash</span>
<a id=__codelineno-30-2 name=__codelineno-30-2 href=#__codelineno-30-2></a><span class=c1>#usage:xxx</span>
<a id=__codelineno-30-3 name=__codelineno-30-3 href=#__codelineno-30-3></a><span class=c1>#scripts_name:xxx.sh</span>
<a id=__codelineno-30-4 name=__codelineno-30-4 href=#__codelineno-30-4></a><span class=nv>SEC_FILE</span><span class=o>=</span>/var/log/secure
<a id=__codelineno-30-5 name=__codelineno-30-5 href=#__codelineno-30-5></a><span class=nv>IP_ADDR</span><span class=o>=</span><span class=sb>`</span>awk<span class=w> </span><span class=s1>&#39;{print $0}&#39;</span><span class=w> </span>/var/log/secure<span class=w> </span><span class=p>|</span>grep<span class=w> </span>-i<span class=w> </span><span class=s2>&quot;fail&quot;</span><span class=p>|</span>egrep<span class=w> </span>-o<span class=w> </span><span class=s2>&quot;([0-9]{1,3}\.){3}[0-9]{1,3}&quot;</span><span class=p>|</span>sort<span class=w> </span>-nr<span class=p>|</span>uniq<span class=w> </span>-c<span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;$1&gt;=15 {prin</span>
<a id=__codelineno-30-6 name=__codelineno-30-6 href=#__codelineno-30-6></a><span class=s1>t $2}&#39;</span><span class=sb>`</span>
<a id=__codelineno-30-7 name=__codelineno-30-7 href=#__codelineno-30-7></a><span class=nv>IPTABLE_CONF</span><span class=o>=</span>/etc/sysconfig/iptables
<a id=__codelineno-30-8 name=__codelineno-30-8 href=#__codelineno-30-8></a><span class=nb>echo</span>
<a id=__codelineno-30-9 name=__codelineno-30-9 href=#__codelineno-30-9></a>
<a id=__codelineno-30-10 name=__codelineno-30-10 href=#__codelineno-30-10></a>cat<span class=w> </span><span class=s>&lt;&lt;EOF</span>
<a id=__codelineno-30-11 name=__codelineno-30-11 href=#__codelineno-30-11></a><span class=s>+++++++++++++++++++++++++++++++++++++= Welcome to yse ssh login drop failed ip ++++++++++++++++++++++++++++++</span>
<a id=__codelineno-30-12 name=__codelineno-30-12 href=#__codelineno-30-12></a><span class=s>++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>
<a id=__codelineno-30-13 name=__codelineno-30-13 href=#__codelineno-30-13></a><span class=s>+++++++++++++++++++++++++++++++++++-----------------------------------------------=++++++++++++++++++++++++++</span>
<a id=__codelineno-30-14 name=__codelineno-30-14 href=#__codelineno-30-14></a><span class=s>EOF</span>
<a id=__codelineno-30-15 name=__codelineno-30-15 href=#__codelineno-30-15></a><span class=nb>echo</span>
<a id=__codelineno-30-16 name=__codelineno-30-16 href=#__codelineno-30-16></a><span class=k>for</span><span class=w> </span><span class=o>((</span><span class=w> </span><span class=nv>VAR</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>0</span><span class=p>;</span><span class=w> </span>VAR<span class=w> </span>&lt;<span class=o>=</span><span class=m>6</span><span class=w> </span><span class=p>;</span><span class=w> </span>++VAR<span class=w> </span><span class=o>))</span><span class=p>;</span><span class=w> </span><span class=k>do</span><span class=w> </span><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;-&quot;</span><span class=p>;</span>sleep<span class=w> </span><span class=m>1</span><span class=p>;</span><span class=k>done</span>
<a id=__codelineno-30-17 name=__codelineno-30-17 href=#__codelineno-30-17></a><span class=nb>echo</span>
<a id=__codelineno-30-18 name=__codelineno-30-18 href=#__codelineno-30-18></a><span class=k>for</span><span class=w> </span>i<span class=w> </span><span class=k>in</span><span class=w> </span><span class=sb>`</span>cat<span class=w> </span><span class=nv>$IP_ADDR</span><span class=sb>`</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>do</span>
<a id=__codelineno-30-19 name=__codelineno-30-19 href=#__codelineno-30-19></a><span class=w>    </span>cat<span class=w> </span><span class=nv>$IPTABLE_CONF</span><span class=p>|</span>grep<span class=w> </span><span class=nv>$i</span><span class=w> </span>&gt;<span class=w> </span>/dev/null
<a id=__codelineno-30-20 name=__codelineno-30-20 href=#__codelineno-30-20></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$?</span><span class=s2>&quot;</span><span class=w> </span>-ne<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-30-21 name=__codelineno-30-21 href=#__codelineno-30-21></a><span class=w>        </span>sed<span class=w> </span>-i<span class=w> </span><span class=s2>&quot;/lo/a -A INPUT -s </span><span class=nv>$i</span><span class=s2> -m state --state NEW -m tcp -p tcp --dport 22 -j DROP&quot;</span><span class=w> </span><span class=nv>$IPTABLE_CONF</span>
<a id=__codelineno-30-22 name=__codelineno-30-22 href=#__codelineno-30-22></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-30-23 name=__codelineno-30-23 href=#__codelineno-30-23></a><span class=k>done</span>
<a id=__codelineno-30-24 name=__codelineno-30-24 href=#__codelineno-30-24></a><span class=nv>NUM</span><span class=o>=</span><span class=sb>`</span>find<span class=w> </span>/etc/sysconfig/<span class=w> </span>-<span class=w> </span>name<span class=w> </span>-a<span class=w> </span>-mmin<span class=w> </span>-1<span class=p>|</span>wc<span class=w> </span>-l<span class=w> </span><span class=sb>`</span>
<a id=__codelineno-30-25 name=__codelineno-30-25 href=#__codelineno-30-25></a>
<a id=__codelineno-30-26 name=__codelineno-30-26 href=#__codelineno-30-26></a><span class=k>if</span><span class=w> </span><span class=nb>test</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$NUM</span><span class=s2>&quot;</span><span class=w> </span>-eq<span class=w> </span><span class=m>1</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-30-27 name=__codelineno-30-27 href=#__codelineno-30-27></a><span class=w>     </span>/etc/init.d/iptables<span class=w> </span>restart
<a id=__codelineno-30-28 name=__codelineno-30-28 href=#__codelineno-30-28></a><span class=k>fi</span>
</code></pre></div> <h2 id=21数据库备份>21.数据库备份<a class=headerlink href=#21数据库备份 title="Permanent link">&para;</a></h2> <h3 id=备份数据库>备份数据库<a class=headerlink href=#备份数据库 title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-31-1 name=__codelineno-31-1 href=#__codelineno-31-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-31-2 name=__codelineno-31-2 href=#__codelineno-31-2></a><span class=c1>#</span>
<a id=__codelineno-31-3 name=__codelineno-31-3 href=#__codelineno-31-3></a><span class=c1># Filename:</span>
<a id=__codelineno-31-4 name=__codelineno-31-4 href=#__codelineno-31-4></a><span class=c1># backupdatabase.sh</span>
<a id=__codelineno-31-5 name=__codelineno-31-5 href=#__codelineno-31-5></a><span class=c1># Description:</span>
<a id=__codelineno-31-6 name=__codelineno-31-6 href=#__codelineno-31-6></a><span class=c1># backup cms database and remove backup data before 7 days</span>
<a id=__codelineno-31-7 name=__codelineno-31-7 href=#__codelineno-31-7></a><span class=c1># crontab</span>
<a id=__codelineno-31-8 name=__codelineno-31-8 href=#__codelineno-31-8></a><span class=c1># 55 23 * * * /bin/sh /yundisk/cms/crontab/backupdatabase.sh &gt;&gt; /yundisk/cms/crontab/backupdatabase.log 2&gt;&amp;1</span>
<a id=__codelineno-31-9 name=__codelineno-31-9 href=#__codelineno-31-9></a>
<a id=__codelineno-31-10 name=__codelineno-31-10 href=#__codelineno-31-10></a><span class=nv>DATE</span><span class=o>=</span><span class=sb>`</span>date<span class=w> </span>+%Y-%m-%d<span class=sb>`</span>
<a id=__codelineno-31-11 name=__codelineno-31-11 href=#__codelineno-31-11></a><span class=nv>OLDDATE</span><span class=o>=</span><span class=sb>`</span>date<span class=w> </span>+%Y-%m-%d<span class=w> </span>-d<span class=w> </span><span class=s1>&#39;-7 days&#39;</span><span class=sb>`</span>
<a id=__codelineno-31-12 name=__codelineno-31-12 href=#__codelineno-31-12></a>
<a id=__codelineno-31-13 name=__codelineno-31-13 href=#__codelineno-31-13></a><span class=c1>#MYSQL=/usr/local/mysql/bin/mysql</span>
<a id=__codelineno-31-14 name=__codelineno-31-14 href=#__codelineno-31-14></a><span class=c1>#MYSQLDUMP=/usr/local/mysql/bin/mysqldump</span>
<a id=__codelineno-31-15 name=__codelineno-31-15 href=#__codelineno-31-15></a><span class=c1>#MYSQLADMIN=/usr/local/mysql/bin/mysqladmin</span>
<a id=__codelineno-31-16 name=__codelineno-31-16 href=#__codelineno-31-16></a>
<a id=__codelineno-31-17 name=__codelineno-31-17 href=#__codelineno-31-17></a><span class=nv>BACKDIR</span><span class=o>=</span>/yundisk/cms/database
<a id=__codelineno-31-18 name=__codelineno-31-18 href=#__codelineno-31-18></a><span class=o>[</span><span class=w> </span>-d<span class=w> </span><span class=si>${</span><span class=nv>BACKDIR</span><span class=si>}</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>||</span><span class=w> </span>mkdir<span class=w> </span>-p<span class=w> </span><span class=si>${</span><span class=nv>BACKDIR</span><span class=si>}</span>
<a id=__codelineno-31-19 name=__codelineno-31-19 href=#__codelineno-31-19></a><span class=o>[</span><span class=w> </span>-d<span class=w> </span><span class=si>${</span><span class=nv>BACKDIR</span><span class=si>}</span>/<span class=si>${</span><span class=nv>DATE</span><span class=si>}</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>||</span><span class=w> </span>mkdir<span class=w> </span><span class=si>${</span><span class=nv>BACKDIR</span><span class=si>}</span>/<span class=si>${</span><span class=nv>DATE</span><span class=si>}</span>
<a id=__codelineno-31-20 name=__codelineno-31-20 href=#__codelineno-31-20></a><span class=o>[</span><span class=w> </span>!<span class=w> </span>-d<span class=w> </span><span class=si>${</span><span class=nv>BACKDIR</span><span class=si>}</span>/<span class=si>${</span><span class=nv>OLDDATE</span><span class=si>}</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>||</span><span class=w> </span>rm<span class=w> </span>-rf<span class=w> </span><span class=si>${</span><span class=nv>BACKDIR</span><span class=si>}</span>/<span class=si>${</span><span class=nv>OLDDATE</span><span class=si>}</span>
<a id=__codelineno-31-21 name=__codelineno-31-21 href=#__codelineno-31-21></a>
<a id=__codelineno-31-22 name=__codelineno-31-22 href=#__codelineno-31-22></a>mysqldump<span class=w> </span>--default-character-set<span class=o>=</span>utf8<span class=w> </span>--no-autocommit<span class=w> </span>--quick<span class=w> </span>--hex-blob<span class=w> </span>--single-transaction<span class=w> </span>-uroot<span class=w>  </span>cms_production<span class=w>  </span><span class=p>|</span><span class=w> </span>gzip<span class=w> </span>&gt;<span class=w> </span><span class=si>${</span><span class=nv>BACKDIR</span><span class=si>}</span>/<span class=si>${</span><span class=nv>DATE</span><span class=si>}</span>/cms-backup-<span class=si>${</span><span class=nv>DATE</span><span class=si>}</span>.sql.gz
<a id=__codelineno-31-23 name=__codelineno-31-23 href=#__codelineno-31-23></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Database cms_production and bbs has been backup successful&quot;</span>
<a id=__codelineno-31-24 name=__codelineno-31-24 href=#__codelineno-31-24></a>/bin/sleep<span class=w> </span><span class=m>5</span>
<a id=__codelineno-31-25 name=__codelineno-31-25 href=#__codelineno-31-25></a>
<a id=__codelineno-31-26 name=__codelineno-31-26 href=#__codelineno-31-26></a>aws<span class=w> </span>s3<span class=w> </span>cp<span class=w> </span><span class=si>${</span><span class=nv>BACKDIR</span><span class=si>}</span>/<span class=si>${</span><span class=nv>DATE</span><span class=si>}</span>/*<span class=w> </span>s3://example-share/cms/databackup/
</code></pre></div> <div class="admonition example"> <p class=admonition-title>参考文献</p> <p><a href=http://www.04007.cn/article/1050.html>使用mysqldump进行mysql数据库备份的完整shell</a> <a href=https://www.naraku.cn/posts/92.html>Linux定时备份数据库到COS</a></p> </div> <h3 id=mysql-定时备份脚本>MySQL 定时备份脚本<a class=headerlink href=#mysql-定时备份脚本 title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-32-1 name=__codelineno-32-1 href=#__codelineno-32-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-32-2 name=__codelineno-32-2 href=#__codelineno-32-2></a><span class=c1># 初始化时，创建相应目录</span>
<a id=__codelineno-32-3 name=__codelineno-32-3 href=#__codelineno-32-3></a><span class=c1># mkdir /home/node/bakmysql/sql/</span>
<a id=__codelineno-32-4 name=__codelineno-32-4 href=#__codelineno-32-4></a>
<a id=__codelineno-32-5 name=__codelineno-32-5 href=#__codelineno-32-5></a><span class=c1># 定时任务</span>
<a id=__codelineno-32-6 name=__codelineno-32-6 href=#__codelineno-32-6></a><span class=c1># 每天凌晨1:00执行备份脚本</span>
<a id=__codelineno-32-7 name=__codelineno-32-7 href=#__codelineno-32-7></a><span class=c1>#0 1 * * * /bin/bash -x /home/node/bakmysql/backup.sh &gt;/dev/null 2&gt;&amp;1</span>
<a id=__codelineno-32-8 name=__codelineno-32-8 href=#__codelineno-32-8></a><span class=c1>#2分钟运行一次-测试用</span>
<a id=__codelineno-32-9 name=__codelineno-32-9 href=#__codelineno-32-9></a><span class=c1>#*/2 * * * * /bin/bash -x /home/node/bakmysql/backup.sh &gt;/dev/null 2&gt;&amp;1</span>
<a id=__codelineno-32-10 name=__codelineno-32-10 href=#__codelineno-32-10></a>
<a id=__codelineno-32-11 name=__codelineno-32-11 href=#__codelineno-32-11></a><span class=nv>BakDir</span><span class=o>=</span>/home/node/bakmysql/sql
<a id=__codelineno-32-12 name=__codelineno-32-12 href=#__codelineno-32-12></a><span class=nv>LogFile</span><span class=o>=</span>/home/node/bakmysql/sql/bak.log
<a id=__codelineno-32-13 name=__codelineno-32-13 href=#__codelineno-32-13></a><span class=nv>Date</span><span class=o>=</span><span class=sb>`</span>date<span class=w> </span>+%Y%m%d<span class=sb>`</span>
<a id=__codelineno-32-14 name=__codelineno-32-14 href=#__codelineno-32-14></a><span class=nv>Begin</span><span class=o>=</span><span class=sb>`</span>date<span class=w> </span>+<span class=s2>&quot;%Y年%m月%d日 %H:%M:%S&quot;</span><span class=sb>`</span>
<a id=__codelineno-32-15 name=__codelineno-32-15 href=#__codelineno-32-15></a><span class=nb>cd</span><span class=w> </span><span class=nv>$BakDir</span>
<a id=__codelineno-32-16 name=__codelineno-32-16 href=#__codelineno-32-16></a><span class=nv>DumpFile</span><span class=o>=</span><span class=nv>$Date</span>.sql
<a id=__codelineno-32-17 name=__codelineno-32-17 href=#__codelineno-32-17></a>
<a id=__codelineno-32-18 name=__codelineno-32-18 href=#__codelineno-32-18></a>
<a id=__codelineno-32-19 name=__codelineno-32-19 href=#__codelineno-32-19></a><span class=c1># 导出到本地</span>
<a id=__codelineno-32-20 name=__codelineno-32-20 href=#__codelineno-32-20></a>mysqldump<span class=w> </span>-uroot<span class=w> </span>-p123456<span class=w> </span><span class=nb>test</span><span class=w> </span>--quick<span class=w> </span>--single-transaction<span class=w> </span><span class=p>|</span><span class=w> </span>gzip<span class=w> </span>&gt;<span class=w> </span><span class=nv>$DumpFile</span>.gz
<a id=__codelineno-32-21 name=__codelineno-32-21 href=#__codelineno-32-21></a><span class=nv>Last</span><span class=o>=</span><span class=sb>`</span>date<span class=w> </span>+<span class=s2>&quot;%Y年%m月%d日 %H:%M:%S&quot;</span><span class=sb>`</span>
<a id=__codelineno-32-22 name=__codelineno-32-22 href=#__codelineno-32-22></a><span class=nb>echo</span><span class=w> </span><span class=o>[</span>FullBack<span class=o>]</span><span class=w> </span>开始:<span class=nv>$Begin</span><span class=w> </span>结束:<span class=nv>$Last</span><span class=w> </span><span class=nv>$DumpFile</span>.gz<span class=w> </span>successful<span class=w> </span>&gt;&gt;<span class=w> </span><span class=nv>$LogFile</span>
<a id=__codelineno-32-23 name=__codelineno-32-23 href=#__codelineno-32-23></a>
<a id=__codelineno-32-24 name=__codelineno-32-24 href=#__codelineno-32-24></a>
<a id=__codelineno-32-25 name=__codelineno-32-25 href=#__codelineno-32-25></a><span class=c1># 删除7天前的备份文件</span>
<a id=__codelineno-32-26 name=__codelineno-32-26 href=#__codelineno-32-26></a>find<span class=w> </span><span class=nv>$BakDir</span><span class=w> </span>-mtime<span class=w> </span>+7<span class=w> </span>-type<span class=w> </span>f<span class=w> </span>-name<span class=w> </span><span class=s2>&quot;*.sql.gz&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>xargs<span class=w> </span>rm<span class=w> </span>-f
</code></pre></div> <p>你需要做的就是修改数据库配置，然后就是配置一下定时任务即可</p> <h3 id=mysql-数据库分库备份>MySQL 数据库分库备份<a class=headerlink href=#mysql-数据库分库备份 title="Permanent link">&para;</a></h3> <p>数据库密码保存在/etc/my.cnf 文件中，所以在执行与 mysql 相关的命令不需要输入密码</p> <p>分库备份思路：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-33-1 name=__codelineno-33-1 href=#__codelineno-33-1></a>mysqldump<span class=w>  </span>db1<span class=w> </span>&gt;db1.sql.gz
<a id=__codelineno-33-2 name=__codelineno-33-2 href=#__codelineno-33-2></a>mysqldump<span class=w>  </span>db2<span class=w> </span>&gt;db2.sql.gz
</code></pre></div> <p>拿到库名</p> <div class=highlight><pre><span></span><code><a id=__codelineno-34-1 name=__codelineno-34-1 href=#__codelineno-34-1></a>mysql<span class=w>  </span>-e<span class=w> </span><span class=s1>&#39;show databases&#39;</span><span class=w> </span><span class=p>|</span>sed<span class=w> </span><span class=s1>&#39;1d&#39;</span><span class=w> </span><span class=p>|</span>grep<span class=w> </span>-v<span class=w> </span><span class=s2>&quot;_schema&quot;</span>
</code></pre></div> <p>注意看注释信息</p> <div class=highlight><pre><span></span><code><a id=__codelineno-35-1 name=__codelineno-35-1 href=#__codelineno-35-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-35-2 name=__codelineno-35-2 href=#__codelineno-35-2></a><span class=c1># author: xiongminghao</span>
<a id=__codelineno-35-3 name=__codelineno-35-3 href=#__codelineno-35-3></a><span class=c1># mail: jasonminghao@163.com</span>
<a id=__codelineno-35-4 name=__codelineno-35-4 href=#__codelineno-35-4></a><span class=c1># describe：Mysql database backup</span>
<a id=__codelineno-35-5 name=__codelineno-35-5 href=#__codelineno-35-5></a><span class=c1># 定义变量</span>
<a id=__codelineno-35-6 name=__codelineno-35-6 href=#__codelineno-35-6></a><span class=nv>IP</span><span class=o>=</span><span class=k>$(</span>ifconfig<span class=w> </span>eth1<span class=w> </span><span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;NR==2{print $2}&#39;</span><span class=k>)</span>
<a id=__codelineno-35-7 name=__codelineno-35-7 href=#__codelineno-35-7></a><span class=nv>Path</span><span class=o>=</span>/backup/database<span class=w>  </span><span class=c1># 备份目录路径</span>
<a id=__codelineno-35-8 name=__codelineno-35-8 href=#__codelineno-35-8></a><span class=nv>Time</span><span class=o>=</span><span class=k>$(</span>date<span class=w> </span>+%F<span class=k>)</span>
<a id=__codelineno-35-9 name=__codelineno-35-9 href=#__codelineno-35-9></a><span class=nv>Ba_Path</span><span class=o>=</span><span class=nv>$Path</span>/<span class=nv>$Time</span>
<a id=__codelineno-35-10 name=__codelineno-35-10 href=#__codelineno-35-10></a><span class=nv>Ba_Logs</span><span class=o>=</span>/var/log/db_database_<span class=nv>$Time</span><span class=w> </span><span class=c1># 定义一个存放日志的文件</span>
<a id=__codelineno-35-11 name=__codelineno-35-11 href=#__codelineno-35-11></a><span class=nv>Md5_Path</span><span class=o>=</span><span class=nv>$Path</span>/<span class=nv>$Time</span>/md5<span class=w> </span><span class=c1># 定义一个存放md5校验的目录</span>
<a id=__codelineno-35-12 name=__codelineno-35-12 href=#__codelineno-35-12></a>
<a id=__codelineno-35-13 name=__codelineno-35-13 href=#__codelineno-35-13></a>
<a id=__codelineno-35-14 name=__codelineno-35-14 href=#__codelineno-35-14></a><span class=c1># 创建两个目录以当天时间为命名</span>
<a id=__codelineno-35-15 name=__codelineno-35-15 href=#__codelineno-35-15></a><span class=o>[</span><span class=w> </span>!<span class=w> </span>-d<span class=w> </span><span class=nv>$Ba_Path</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>mkdir<span class=w> </span><span class=nv>$Ba_Path</span>
<a id=__codelineno-35-16 name=__codelineno-35-16 href=#__codelineno-35-16></a><span class=o>[</span><span class=w> </span>!<span class=w> </span>-d<span class=w> </span><span class=nv>$Md5_Path</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>mkdir<span class=w> </span><span class=nv>$Md5_Path</span>
<a id=__codelineno-35-17 name=__codelineno-35-17 href=#__codelineno-35-17></a>
<a id=__codelineno-35-18 name=__codelineno-35-18 href=#__codelineno-35-18></a><span class=c1># 循环获取数据库名进行备份和生成MD5校验文件</span>
<a id=__codelineno-35-19 name=__codelineno-35-19 href=#__codelineno-35-19></a><span class=k>for</span><span class=w> </span>dbname<span class=w> </span><span class=k>in</span><span class=w> </span><span class=sb>`</span>mysql<span class=w>  </span>-e<span class=w> </span><span class=s1>&#39;show databases&#39;</span><span class=w> </span><span class=p>|</span>sed<span class=w> </span><span class=s1>&#39;1d&#39;</span><span class=w> </span><span class=p>|</span>grep<span class=w> </span>-v<span class=w> </span><span class=s2>&quot;_schema&quot;</span><span class=sb>`</span>
<a id=__codelineno-35-20 name=__codelineno-35-20 href=#__codelineno-35-20></a><span class=k>do</span>
<a id=__codelineno-35-21 name=__codelineno-35-21 href=#__codelineno-35-21></a><span class=c1># 判断是否有数据库已经备份了,如果备份了则continue 调出当次循环，否则进行备份</span>
<a id=__codelineno-35-22 name=__codelineno-35-22 href=#__codelineno-35-22></a>
<a id=__codelineno-35-23 name=__codelineno-35-23 href=#__codelineno-35-23></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>!<span class=w> </span>-f<span class=w> </span><span class=nv>$Ba_Path</span>/<span class=si>${</span><span class=nv>dbname</span><span class=si>}</span>.sql.gz<span class=w> </span><span class=o>]</span><span class=p>;</span><span class=k>then</span>
<a id=__codelineno-35-24 name=__codelineno-35-24 href=#__codelineno-35-24></a>
<a id=__codelineno-35-25 name=__codelineno-35-25 href=#__codelineno-35-25></a><span class=w>   </span><span class=c1># 备份参数</span>
<a id=__codelineno-35-26 name=__codelineno-35-26 href=#__codelineno-35-26></a><span class=w>   </span><span class=c1># -B 增加use[name]语句, -R 备份存储过程和函数数据</span>
<a id=__codelineno-35-27 name=__codelineno-35-27 href=#__codelineno-35-27></a><span class=w>   </span><span class=c1># --master=data2 记录备份时刻的binlog位置点，2表示将其位置点注释</span>
<a id=__codelineno-35-28 name=__codelineno-35-28 href=#__codelineno-35-28></a><span class=w>   </span><span class=c1># --single-ransaction 对innodb引擎进行热备（对数据进行快照）</span>
<a id=__codelineno-35-29 name=__codelineno-35-29 href=#__codelineno-35-29></a><span class=w>   </span><span class=c1># gzip 对备份的数据进行gzip压缩</span>
<a id=__codelineno-35-30 name=__codelineno-35-30 href=#__codelineno-35-30></a><span class=w>   </span>mysqldump<span class=w>  </span>-B<span class=w> </span>-R<span class=w> </span>--master-data<span class=o>=</span><span class=m>2</span><span class=w> </span>--single-transaction<span class=w>  </span><span class=p>|</span>gzip<span class=w> </span>&gt;<span class=nv>$Ba_Path</span>/<span class=si>${</span><span class=nv>dbname</span><span class=si>}</span>.sql.gz
<a id=__codelineno-35-31 name=__codelineno-35-31 href=#__codelineno-35-31></a><span class=w>   </span><span class=nv>RETVAL</span><span class=o>=</span><span class=nv>$?</span>
<a id=__codelineno-35-32 name=__codelineno-35-32 href=#__codelineno-35-32></a>
<a id=__codelineno-35-33 name=__codelineno-35-33 href=#__codelineno-35-33></a><span class=w>   </span><span class=c1># 通过返回值判断备份是否执行成功,把执行的成功与否纪录到日志中</span>
<a id=__codelineno-35-34 name=__codelineno-35-34 href=#__codelineno-35-34></a><span class=w>   </span><span class=o>[</span><span class=w> </span><span class=nv>$?</span><span class=w> </span>-eq<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>dbname</span><span class=si>}</span><span class=s2> successful&quot;</span><span class=w> </span>&gt;&gt;<span class=nv>$Ba_Logs</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>dbname</span><span class=si>}</span><span class=s2> failed&quot;</span><span class=w> </span>&gt;&gt;<span class=nv>$Ba_Logs</span>
<a id=__codelineno-35-35 name=__codelineno-35-35 href=#__codelineno-35-35></a>
<a id=__codelineno-35-36 name=__codelineno-35-36 href=#__codelineno-35-36></a><span class=w>   </span><span class=c1># 对数据库的数据完整性做MD5校验</span>
<a id=__codelineno-35-37 name=__codelineno-35-37 href=#__codelineno-35-37></a><span class=w>   </span>md5sum<span class=w> </span><span class=nv>$Ba_Path</span>/<span class=si>${</span><span class=nv>dbname</span><span class=si>}</span>.sql.gz<span class=w>  </span>&gt;<span class=nv>$Md5_Path</span>/<span class=si>${</span><span class=nv>dbname</span><span class=si>}</span>_md5.log
<a id=__codelineno-35-38 name=__codelineno-35-38 href=#__codelineno-35-38></a>
<a id=__codelineno-35-39 name=__codelineno-35-39 href=#__codelineno-35-39></a><span class=w> </span><span class=k>else</span>
<a id=__codelineno-35-40 name=__codelineno-35-40 href=#__codelineno-35-40></a><span class=w>    </span><span class=c1># 如果备份已存在则跳出当次循环,进行下次循环</span>
<a id=__codelineno-35-41 name=__codelineno-35-41 href=#__codelineno-35-41></a><span class=w>    </span><span class=k>continue</span>
<a id=__codelineno-35-42 name=__codelineno-35-42 href=#__codelineno-35-42></a>
<a id=__codelineno-35-43 name=__codelineno-35-43 href=#__codelineno-35-43></a><span class=w>  </span><span class=k>fi</span>
<a id=__codelineno-35-44 name=__codelineno-35-44 href=#__codelineno-35-44></a><span class=k>done</span>
<a id=__codelineno-35-45 name=__codelineno-35-45 href=#__codelineno-35-45></a>
<a id=__codelineno-35-46 name=__codelineno-35-46 href=#__codelineno-35-46></a><span class=c1># 将备份日志结果邮件方式发送给管理员</span>
<a id=__codelineno-35-47 name=__codelineno-35-47 href=#__codelineno-35-47></a><span class=w> </span>mail<span class=w> </span>-s<span class=w> </span><span class=s2>&quot;</span><span class=nv>$HOSTNAME</span><span class=s2> </span><span class=nv>$IP</span><span class=s2>&quot;</span><span class=w> </span>jasonminghao@163.com<span class=w> </span>&lt;<span class=w> </span><span class=nv>$Ba_Logs</span>
</code></pre></div> <h3 id=mysql-数据库分库分表备份>MySQL 数据库分库分表备份<a class=headerlink href=#mysql-数据库分库分表备份 title="Permanent link">&para;</a></h3> <p>数据库密码保存在/etc/my.cnf 文件中，所以在执行与 mysql 相关的命令不需要输入密码</p> <p>分库分表备份思路：</p> <p>库名 db1，两张表</p> <div class=highlight><pre><span></span><code><a id=__codelineno-36-1 name=__codelineno-36-1 href=#__codelineno-36-1></a>mysqldump<span class=w>  </span>db1<span class=w> </span>table01<span class=w> </span>&gt;db1_table01.sql.gz
<a id=__codelineno-36-2 name=__codelineno-36-2 href=#__codelineno-36-2></a>mysqldump<span class=w>  </span>db1<span class=w> </span>table02<span class=w> </span>&gt;db1_table01.sql.gz
</code></pre></div> <p>库名 db2，两张表</p> <div class=highlight><pre><span></span><code><a id=__codelineno-37-1 name=__codelineno-37-1 href=#__codelineno-37-1></a>mysqldump<span class=w>  </span>db2<span class=w> </span>table01<span class=w> </span>&gt;db2_table01.sql.gz
<a id=__codelineno-37-2 name=__codelineno-37-2 href=#__codelineno-37-2></a>mysqldump<span class=w>  </span>db2<span class=w> </span>table02<span class=w> </span>&gt;db2_table02.sql.gz
</code></pre></div> <p>拿到表名列表</p> <div class=highlight><pre><span></span><code><a id=__codelineno-38-1 name=__codelineno-38-1 href=#__codelineno-38-1></a>mysql<span class=w>  </span>-e<span class=w> </span><span class=s2>&quot;show tables from db1;&quot;</span><span class=w> </span><span class=p>|</span>sed<span class=w> </span>1d
</code></pre></div> <p>注意看注释信息</p> <div class=highlight><pre><span></span><code><a id=__codelineno-39-1 name=__codelineno-39-1 href=#__codelineno-39-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-39-2 name=__codelineno-39-2 href=#__codelineno-39-2></a><span class=c1># author: xiongminghao</span>
<a id=__codelineno-39-3 name=__codelineno-39-3 href=#__codelineno-39-3></a><span class=c1># mail: jasonminghao@163.com</span>
<a id=__codelineno-39-4 name=__codelineno-39-4 href=#__codelineno-39-4></a><span class=c1># describe：Mysql database table backup</span>
<a id=__codelineno-39-5 name=__codelineno-39-5 href=#__codelineno-39-5></a><span class=c1># 定义变量</span>
<a id=__codelineno-39-6 name=__codelineno-39-6 href=#__codelineno-39-6></a><span class=nv>IP</span><span class=o>=</span><span class=k>$(</span>ifconfig<span class=w> </span>eth1<span class=w> </span><span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;NR==2{print $2}&#39;</span><span class=k>)</span>
<a id=__codelineno-39-7 name=__codelineno-39-7 href=#__codelineno-39-7></a><span class=nv>Path</span><span class=o>=</span>/backup/table<span class=w> </span><span class=c1># 备份目录</span>
<a id=__codelineno-39-8 name=__codelineno-39-8 href=#__codelineno-39-8></a><span class=nv>Time</span><span class=o>=</span><span class=k>$(</span>date<span class=w> </span>+%F<span class=k>)</span>
<a id=__codelineno-39-9 name=__codelineno-39-9 href=#__codelineno-39-9></a><span class=nv>Ba_Path</span><span class=o>=</span><span class=nv>$Path</span>/<span class=nv>$Time</span>
<a id=__codelineno-39-10 name=__codelineno-39-10 href=#__codelineno-39-10></a><span class=nv>Ba_Logs</span><span class=o>=</span>/var/log/db_table_<span class=nv>$Time</span><span class=w>  </span><span class=c1># 定义一个存放日志的文件</span>
<a id=__codelineno-39-11 name=__codelineno-39-11 href=#__codelineno-39-11></a><span class=nv>Md5_Path</span><span class=o>=</span><span class=nv>$Path</span>/<span class=nv>$Time</span>/md5<span class=w> </span><span class=c1># 定义一个存放md5校验的目录</span>
<a id=__codelineno-39-12 name=__codelineno-39-12 href=#__codelineno-39-12></a>
<a id=__codelineno-39-13 name=__codelineno-39-13 href=#__codelineno-39-13></a><span class=c1># 创建两个目录以当天时间为命名</span>
<a id=__codelineno-39-14 name=__codelineno-39-14 href=#__codelineno-39-14></a><span class=o>[</span><span class=w> </span>!<span class=w> </span>-d<span class=w> </span><span class=nv>$Ba_Path</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>mkdir<span class=w> </span><span class=nv>$Ba_Path</span>
<a id=__codelineno-39-15 name=__codelineno-39-15 href=#__codelineno-39-15></a><span class=o>[</span><span class=w> </span>!<span class=w> </span>-d<span class=w> </span><span class=nv>$Md5_Path</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>mkdir<span class=w> </span><span class=nv>$Md5_Path</span>
<a id=__codelineno-39-16 name=__codelineno-39-16 href=#__codelineno-39-16></a>
<a id=__codelineno-39-17 name=__codelineno-39-17 href=#__codelineno-39-17></a><span class=c1># 循环获取数据库名</span>
<a id=__codelineno-39-18 name=__codelineno-39-18 href=#__codelineno-39-18></a><span class=k>for</span><span class=w> </span>dbname<span class=w> </span><span class=k>in</span><span class=w> </span><span class=sb>`</span>mysql<span class=w>  </span>-e<span class=w> </span><span class=s1>&#39;show databases&#39;</span><span class=w> </span><span class=p>|</span>sed<span class=w> </span><span class=s1>&#39;1d&#39;</span><span class=w> </span><span class=p>|</span>grep<span class=w> </span>-v<span class=w> </span><span class=s2>&quot;_schema&quot;</span><span class=sb>`</span>
<a id=__codelineno-39-19 name=__codelineno-39-19 href=#__codelineno-39-19></a><span class=k>do</span>
<a id=__codelineno-39-20 name=__codelineno-39-20 href=#__codelineno-39-20></a>
<a id=__codelineno-39-21 name=__codelineno-39-21 href=#__codelineno-39-21></a><span class=w>  </span><span class=c1># 循环获取到数据库名后再次循环获取到该库名下的表，进行备份和MD5校验</span>
<a id=__codelineno-39-22 name=__codelineno-39-22 href=#__codelineno-39-22></a><span class=w>  </span><span class=k>for</span><span class=w> </span>tablename<span class=w> </span><span class=k>in</span><span class=w> </span><span class=sb>`</span>mysql<span class=w> </span>-e<span class=w> </span><span class=s2>&quot;show tables from </span><span class=nv>$dbname</span><span class=s2>&quot;</span><span class=w> </span><span class=p>|</span>sed<span class=w> </span><span class=s1>&#39;1d&#39;</span><span class=sb>`</span>
<a id=__codelineno-39-23 name=__codelineno-39-23 href=#__codelineno-39-23></a><span class=w>  </span><span class=k>do</span>
<a id=__codelineno-39-24 name=__codelineno-39-24 href=#__codelineno-39-24></a>
<a id=__codelineno-39-25 name=__codelineno-39-25 href=#__codelineno-39-25></a><span class=w>  </span><span class=c1># 判断是否有表已经备份了,如果备份了则continue 调出当次循环，否则进行备份</span>
<a id=__codelineno-39-26 name=__codelineno-39-26 href=#__codelineno-39-26></a><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>!<span class=w> </span>-f<span class=w> </span><span class=nv>$Ba_Path</span>/<span class=si>${</span><span class=nv>dbname</span><span class=si>}</span>_<span class=si>${</span><span class=nv>tablename</span><span class=si>}</span>.sql.gz<span class=w> </span><span class=o>]</span><span class=p>;</span><span class=k>then</span>
<a id=__codelineno-39-27 name=__codelineno-39-27 href=#__codelineno-39-27></a>
<a id=__codelineno-39-28 name=__codelineno-39-28 href=#__codelineno-39-28></a><span class=w>   </span>mysqldump<span class=w> </span>-R<span class=w> </span>--master-data<span class=o>=</span><span class=m>2</span><span class=w> </span>--single-transaction<span class=w>  </span><span class=si>${</span><span class=nv>dbname</span><span class=si>}</span><span class=w> </span><span class=si>${</span><span class=nv>tablename</span><span class=si>}</span><span class=w> </span><span class=p>|</span>gzip<span class=w> </span>&gt;<span class=nv>$Ba_Path</span>/<span class=si>${</span><span class=nv>dbname</span><span class=si>}</span>_<span class=si>${</span><span class=nv>tablename</span><span class=si>}</span>.sql.gz
<a id=__codelineno-39-29 name=__codelineno-39-29 href=#__codelineno-39-29></a><span class=w>   </span><span class=nv>RETVAL</span><span class=o>=</span><span class=nv>$?</span>
<a id=__codelineno-39-30 name=__codelineno-39-30 href=#__codelineno-39-30></a>
<a id=__codelineno-39-31 name=__codelineno-39-31 href=#__codelineno-39-31></a><span class=w>   </span><span class=c1># 通过返回值判断备份是否执行成功,把执行的成功与否纪录到日志中</span>
<a id=__codelineno-39-32 name=__codelineno-39-32 href=#__codelineno-39-32></a><span class=w>   </span><span class=o>[</span><span class=w> </span><span class=nv>$?</span><span class=w> </span>-eq<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>dbname</span><span class=si>}</span><span class=s2>_</span><span class=si>${</span><span class=nv>tablename</span><span class=si>}</span><span class=s2> successful&quot;</span><span class=w> </span>&gt;&gt;<span class=nv>$Ba_Logs</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>dbname</span><span class=si>}</span><span class=s2>_</span><span class=si>${</span><span class=nv>tablename</span><span class=si>}</span><span class=s2> failed&quot;</span><span class=w> </span>&gt;&gt;<span class=nv>$Ba_Logs</span>
<a id=__codelineno-39-33 name=__codelineno-39-33 href=#__codelineno-39-33></a><span class=w>   </span><span class=c1># 对表的数据完整性做MD5校验</span>
<a id=__codelineno-39-34 name=__codelineno-39-34 href=#__codelineno-39-34></a><span class=w>   </span>md5sum<span class=w> </span><span class=nv>$Ba_Path</span>/<span class=si>${</span><span class=nv>dbname</span><span class=si>}</span>_<span class=si>${</span><span class=nv>tablename</span><span class=si>}</span>.sql.gz<span class=w>  </span>&gt;<span class=nv>$Md5_Path</span>/<span class=si>${</span><span class=nv>dbname</span><span class=si>}</span>_<span class=si>${</span><span class=nv>tablename</span><span class=si>}</span>_md5.log
<a id=__codelineno-39-35 name=__codelineno-39-35 href=#__codelineno-39-35></a>
<a id=__codelineno-39-36 name=__codelineno-39-36 href=#__codelineno-39-36></a><span class=w> </span><span class=k>else</span>
<a id=__codelineno-39-37 name=__codelineno-39-37 href=#__codelineno-39-37></a><span class=w>    </span><span class=k>continue</span>
<a id=__codelineno-39-38 name=__codelineno-39-38 href=#__codelineno-39-38></a>
<a id=__codelineno-39-39 name=__codelineno-39-39 href=#__codelineno-39-39></a><span class=w>  </span><span class=k>fi</span>
<a id=__codelineno-39-40 name=__codelineno-39-40 href=#__codelineno-39-40></a><span class=w> </span><span class=k>done</span>
<a id=__codelineno-39-41 name=__codelineno-39-41 href=#__codelineno-39-41></a><span class=k>done</span>
<a id=__codelineno-39-42 name=__codelineno-39-42 href=#__codelineno-39-42></a><span class=c1># 将备份日志结果邮件方式发送给管理员</span>
<a id=__codelineno-39-43 name=__codelineno-39-43 href=#__codelineno-39-43></a>mail<span class=w> </span>-s<span class=w> </span><span class=s2>&quot;</span><span class=nv>$HOSTNAME</span><span class=s2> </span><span class=nv>$IP</span><span class=s2>&quot;</span><span class=w> </span>jasonminghao@163.com<span class=w> </span>&lt;<span class=w> </span><span class=nv>$Ba_Logs</span>
</code></pre></div> <h2 id=22开机性能优化>22.开机性能优化<a class=headerlink href=#22开机性能优化 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-40-1 name=__codelineno-40-1 href=#__codelineno-40-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-40-2 name=__codelineno-40-2 href=#__codelineno-40-2></a><span class=c1>#添加epel外部yum扩展源</span>
<a id=__codelineno-40-3 name=__codelineno-40-3 href=#__codelineno-40-3></a><span class=nb>cd</span><span class=w> </span>/usr/local/src
<a id=__codelineno-40-4 name=__codelineno-40-4 href=#__codelineno-40-4></a>wget<span class=w> </span>http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm
<a id=__codelineno-40-5 name=__codelineno-40-5 href=#__codelineno-40-5></a>rpm<span class=w> </span>-ivh<span class=w> </span>epel-release-6-8.noarch.rpm
<a id=__codelineno-40-6 name=__codelineno-40-6 href=#__codelineno-40-6></a><span class=c1>#安装gcc基础库文件以及sysstat工具</span>
<a id=__codelineno-40-7 name=__codelineno-40-7 href=#__codelineno-40-7></a>yum<span class=w> </span>-y<span class=w> </span>install<span class=w> </span>gcc<span class=w> </span>gcc-c++<span class=w> </span>vim-enhanced<span class=w> </span>unzip<span class=w> </span>unrar<span class=w> </span>sysstat
<a id=__codelineno-40-8 name=__codelineno-40-8 href=#__codelineno-40-8></a><span class=c1>#配置ntpdate自动对时</span>
<a id=__codelineno-40-9 name=__codelineno-40-9 href=#__codelineno-40-9></a>yum<span class=w> </span>-y<span class=w> </span>install<span class=w> </span>ntp
<a id=__codelineno-40-10 name=__codelineno-40-10 href=#__codelineno-40-10></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;01 01 * * * /usr/sbin/ntpdate ntp.api.bz    &gt;&gt; /dev/null 2&gt;&amp;1&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span>/etc/crontab
<a id=__codelineno-40-11 name=__codelineno-40-11 href=#__codelineno-40-11></a>ntpdate<span class=w> </span>ntp.api.bz
<a id=__codelineno-40-12 name=__codelineno-40-12 href=#__codelineno-40-12></a>service<span class=w> </span>crond<span class=w> </span>restart
<a id=__codelineno-40-13 name=__codelineno-40-13 href=#__codelineno-40-13></a><span class=c1>#配置文件的ulimit值</span>
<a id=__codelineno-40-14 name=__codelineno-40-14 href=#__codelineno-40-14></a><span class=nb>ulimit</span><span class=w> </span>-SHn<span class=w> </span><span class=m>65535</span>
<a id=__codelineno-40-15 name=__codelineno-40-15 href=#__codelineno-40-15></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;ulimit -SHn 65535&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span>/etc/rc.local
<a id=__codelineno-40-16 name=__codelineno-40-16 href=#__codelineno-40-16></a>cat&gt;&gt;<span class=w> </span>/etc/security/limits.conf<span class=w> </span><span class=s>&lt;&lt; EOF</span>
<a id=__codelineno-40-17 name=__codelineno-40-17 href=#__codelineno-40-17></a><span class=s>*                     soft     nofile             65535</span>
<a id=__codelineno-40-18 name=__codelineno-40-18 href=#__codelineno-40-18></a><span class=s>*                     hard     nofile             65535</span>
<a id=__codelineno-40-19 name=__codelineno-40-19 href=#__codelineno-40-19></a><span class=s>EOF</span>
<a id=__codelineno-40-20 name=__codelineno-40-20 href=#__codelineno-40-20></a>
<a id=__codelineno-40-21 name=__codelineno-40-21 href=#__codelineno-40-21></a><span class=c1>#基础系统内核优化</span>
<a id=__codelineno-40-22 name=__codelineno-40-22 href=#__codelineno-40-22></a>cat&gt;&gt;<span class=w> </span>/etc/sysctl.conf<span class=w> </span><span class=s>&lt;&lt; EOF</span>
<a id=__codelineno-40-23 name=__codelineno-40-23 href=#__codelineno-40-23></a><span class=s>fs.file-max=419430</span>
<a id=__codelineno-40-24 name=__codelineno-40-24 href=#__codelineno-40-24></a><span class=s>net.ipv4.tcp_syncookies = 1</span>
<a id=__codelineno-40-25 name=__codelineno-40-25 href=#__codelineno-40-25></a><span class=s>net.ipv4.tcp_syn_retries = 1</span>
<a id=__codelineno-40-26 name=__codelineno-40-26 href=#__codelineno-40-26></a><span class=s>net.ipv4.tcp_tw_recycle = 1</span>
<a id=__codelineno-40-27 name=__codelineno-40-27 href=#__codelineno-40-27></a><span class=s>net.ipv4.tcp_tw_reuse = 1</span>
<a id=__codelineno-40-28 name=__codelineno-40-28 href=#__codelineno-40-28></a><span class=s>net.ipv4.tcp_fin_timeout = 1</span>
<a id=__codelineno-40-29 name=__codelineno-40-29 href=#__codelineno-40-29></a><span class=s>net.ipv4.tcp_keepalive_time = 1200</span>
<a id=__codelineno-40-30 name=__codelineno-40-30 href=#__codelineno-40-30></a><span class=s>net.ipv4.ip_local_port_range = 1024 65535</span>
<a id=__codelineno-40-31 name=__codelineno-40-31 href=#__codelineno-40-31></a><span class=s>net.ipv4.tcp_max_syn_backlog = 16384</span>
<a id=__codelineno-40-32 name=__codelineno-40-32 href=#__codelineno-40-32></a><span class=s>net.ipv4.tcp_max_tw_buckets = 36000</span>
<a id=__codelineno-40-33 name=__codelineno-40-33 href=#__codelineno-40-33></a><span class=s>net.ipv4.route.gc_timeout = 100</span>
<a id=__codelineno-40-34 name=__codelineno-40-34 href=#__codelineno-40-34></a><span class=s>net.ipv4.tcp_syn_retries = 1</span>
<a id=__codelineno-40-35 name=__codelineno-40-35 href=#__codelineno-40-35></a><span class=s>net.ipv4.tcp_synack_retries = 1</span>
<a id=__codelineno-40-36 name=__codelineno-40-36 href=#__codelineno-40-36></a><span class=s>net.core.somaxconn = 16384</span>
<a id=__codelineno-40-37 name=__codelineno-40-37 href=#__codelineno-40-37></a><span class=s>net.core.netdev_max_backlog = 16384</span>
<a id=__codelineno-40-38 name=__codelineno-40-38 href=#__codelineno-40-38></a><span class=s>net.ipv4.tcp_max_orphans = 16384</span>
<a id=__codelineno-40-39 name=__codelineno-40-39 href=#__codelineno-40-39></a><span class=s>EOF</span>
<a id=__codelineno-40-40 name=__codelineno-40-40 href=#__codelineno-40-40></a>/sbin/sysctl<span class=w> </span>-p
<a id=__codelineno-40-41 name=__codelineno-40-41 href=#__codelineno-40-41></a>
<a id=__codelineno-40-42 name=__codelineno-40-42 href=#__codelineno-40-42></a><span class=c1>#禁用control-alt-delete组合键以防止误操作</span>
<a id=__codelineno-40-43 name=__codelineno-40-43 href=#__codelineno-40-43></a>sed<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;s@ca::ctrlaltdel:/sbin/shutdown -t3 -r now@#ca::ctrlaltdel:/sbin/shutdown -t3 -r now@&#39;</span><span class=w> </span>/etc/inittab
<a id=__codelineno-40-44 name=__codelineno-40-44 href=#__codelineno-40-44></a><span class=c1>#关闭SElinux</span>
<a id=__codelineno-40-45 name=__codelineno-40-45 href=#__codelineno-40-45></a>sed<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;s@SELINUX=enforcing@SELINUX=disabled@&#39;</span><span class=w> </span>/etc/selinux/config
<a id=__codelineno-40-46 name=__codelineno-40-46 href=#__codelineno-40-46></a><span class=c1>#关闭iptables</span>
<a id=__codelineno-40-47 name=__codelineno-40-47 href=#__codelineno-40-47></a>service<span class=w> </span>iptables<span class=w> </span>stop
<a id=__codelineno-40-48 name=__codelineno-40-48 href=#__codelineno-40-48></a>chkconfig<span class=w> </span>iptables<span class=w> </span>off
<a id=__codelineno-40-49 name=__codelineno-40-49 href=#__codelineno-40-49></a><span class=c1>#ssh服务配置优化,请至少保持机器中至少有一个具有sudo权限的用户，下面的配置会禁止root远程登录</span>
<a id=__codelineno-40-50 name=__codelineno-40-50 href=#__codelineno-40-50></a>sed<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;s@#PermitRootLogin yes@PermitRootLogin no@&#39;</span><span class=w> </span>/etc/ssh/sshd_config<span class=w> </span><span class=c1>#禁止root远程登录</span>
<a id=__codelineno-40-51 name=__codelineno-40-51 href=#__codelineno-40-51></a>sed<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;s@#PermitEmptyPasswords no@PermitEmptyPasswords no@&#39;</span><span class=w> </span>/etc/ssh/sshd_config<span class=w> </span><span class=c1>#禁止空密码登录</span>
<a id=__codelineno-40-52 name=__codelineno-40-52 href=#__codelineno-40-52></a>sed<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;s@#UseDNS yes@UseDNS no@&#39;</span><span class=w> </span>/etc/ssh/sshd_config<span class=w> </span>/etc/ssh/sshd_config
<a id=__codelineno-40-53 name=__codelineno-40-53 href=#__codelineno-40-53></a>service<span class=w> </span>sshd<span class=w> </span>restart
<a id=__codelineno-40-54 name=__codelineno-40-54 href=#__codelineno-40-54></a><span class=c1>#禁用ipv6地址</span>
<a id=__codelineno-40-55 name=__codelineno-40-55 href=#__codelineno-40-55></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;alias net-pf-10 off&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span>/etc/modprobe.d/dist.conf
<a id=__codelineno-40-56 name=__codelineno-40-56 href=#__codelineno-40-56></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;alias ipv6 off&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span>/etc/modprobe.d/dist.conf
<a id=__codelineno-40-57 name=__codelineno-40-57 href=#__codelineno-40-57></a>chkconfig<span class=w> </span>ip6tables<span class=w> </span>off
<a id=__codelineno-40-58 name=__codelineno-40-58 href=#__codelineno-40-58></a><span class=c1>#vim基础语法优化</span>
<a id=__codelineno-40-59 name=__codelineno-40-59 href=#__codelineno-40-59></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;syntax on&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span>/root/.vimrc
<a id=__codelineno-40-60 name=__codelineno-40-60 href=#__codelineno-40-60></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;set nohlsearch&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span>/root/.vimrc
<a id=__codelineno-40-61 name=__codelineno-40-61 href=#__codelineno-40-61></a><span class=c1>#精简开机自启动服务，安装最小化服务的机器初始可以只保留crond，network，rsyslog，sshd这四个服务。</span>
<a id=__codelineno-40-62 name=__codelineno-40-62 href=#__codelineno-40-62></a><span class=k>for</span><span class=w> </span>i<span class=w> </span><span class=k>in</span><span class=w> </span><span class=sb>`</span>chkconfig<span class=w> </span>--list<span class=p>|</span>grep<span class=w> </span><span class=m>3</span>:on<span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;{print $1}&#39;</span><span class=sb>`</span><span class=p>;</span><span class=k>do</span><span class=w> </span>chkconfig<span class=w> </span>--level<span class=w> </span><span class=m>3</span><span class=w> </span><span class=nv>$i</span><span class=w> </span>off<span class=p>;</span><span class=k>done</span>
<a id=__codelineno-40-63 name=__codelineno-40-63 href=#__codelineno-40-63></a><span class=k>for</span><span class=w> </span>CURSRV<span class=w>  </span><span class=k>in</span><span class=w> </span>crond<span class=w> </span>rsyslog<span class=w> </span>sshd<span class=w> </span>network<span class=p>;</span><span class=k>do</span><span class=w> </span>chkconfig<span class=w> </span>--level<span class=w> </span><span class=m>3</span><span class=w> </span><span class=nv>$CURSRV</span><span class=w> </span>on<span class=p>;</span><span class=k>done</span>
<a id=__codelineno-40-64 name=__codelineno-40-64 href=#__codelineno-40-64></a><span class=c1>#重启服务器</span>
<a id=__codelineno-40-65 name=__codelineno-40-65 href=#__codelineno-40-65></a>reboot
</code></pre></div> <p>服务器系统配置初始化脚本</p> <div class=highlight><pre><span></span><code><a id=__codelineno-41-1 name=__codelineno-41-1 href=#__codelineno-41-1></a><span class=c1>#/bin/bash</span>
<a id=__codelineno-41-2 name=__codelineno-41-2 href=#__codelineno-41-2></a><span class=c1># 设置时区并同步时间</span>
<a id=__codelineno-41-3 name=__codelineno-41-3 href=#__codelineno-41-3></a>ln<span class=w> </span>-s<span class=w> </span>/usr/share/zoneinfo/Asia/Shanghai<span class=w> </span>/etc/localtime
<a id=__codelineno-41-4 name=__codelineno-41-4 href=#__codelineno-41-4></a><span class=k>if</span><span class=w> </span>!<span class=w> </span>crontab<span class=w> </span>-l<span class=w> </span><span class=p>|</span>grep<span class=w> </span>ntpdate<span class=w> </span><span class=p>&amp;</span>&gt;/dev/null<span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-41-5 name=__codelineno-41-5 href=#__codelineno-41-5></a><span class=w>    </span><span class=o>(</span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;* 1 * * * ntpdate time.windows.com &gt;/dev/null 2&gt;&amp;1&quot;</span><span class=p>;</span>crontab<span class=w> </span>-l<span class=o>)</span><span class=w> </span><span class=p>|</span>crontab
<a id=__codelineno-41-6 name=__codelineno-41-6 href=#__codelineno-41-6></a><span class=k>fi</span>
<a id=__codelineno-41-7 name=__codelineno-41-7 href=#__codelineno-41-7></a>
<a id=__codelineno-41-8 name=__codelineno-41-8 href=#__codelineno-41-8></a><span class=c1># 禁用selinux</span>
<a id=__codelineno-41-9 name=__codelineno-41-9 href=#__codelineno-41-9></a>sed<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;/SELINUX/{s/permissive/disabled/}&#39;</span><span class=w> </span>/etc/selinux/config
<a id=__codelineno-41-10 name=__codelineno-41-10 href=#__codelineno-41-10></a>
<a id=__codelineno-41-11 name=__codelineno-41-11 href=#__codelineno-41-11></a><span class=c1># 关闭防火墙</span>
<a id=__codelineno-41-12 name=__codelineno-41-12 href=#__codelineno-41-12></a><span class=k>if</span><span class=w> </span>egrep<span class=w> </span><span class=s2>&quot;7.[0-9]&quot;</span><span class=w> </span>/etc/redhat-release<span class=w> </span><span class=p>&amp;</span>&gt;/dev/null<span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-41-13 name=__codelineno-41-13 href=#__codelineno-41-13></a><span class=w>    </span>systemctl<span class=w> </span>stop<span class=w> </span>firewalld
<a id=__codelineno-41-14 name=__codelineno-41-14 href=#__codelineno-41-14></a><span class=w>    </span>systemctl<span class=w> </span>disable<span class=w> </span>firewalld
<a id=__codelineno-41-15 name=__codelineno-41-15 href=#__codelineno-41-15></a><span class=k>elif</span><span class=w> </span>egrep<span class=w> </span><span class=s2>&quot;6.[0-9]&quot;</span><span class=w> </span>/etc/redhat-release<span class=w> </span><span class=p>&amp;</span>&gt;/dev/null<span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-41-16 name=__codelineno-41-16 href=#__codelineno-41-16></a><span class=w>    </span>service<span class=w> </span>iptables<span class=w> </span>stop
<a id=__codelineno-41-17 name=__codelineno-41-17 href=#__codelineno-41-17></a><span class=w>    </span>chkconfig<span class=w> </span>iptables<span class=w> </span>off
<a id=__codelineno-41-18 name=__codelineno-41-18 href=#__codelineno-41-18></a><span class=k>fi</span>
<a id=__codelineno-41-19 name=__codelineno-41-19 href=#__codelineno-41-19></a>
<a id=__codelineno-41-20 name=__codelineno-41-20 href=#__codelineno-41-20></a><span class=c1># 历史命令显示操作时间</span>
<a id=__codelineno-41-21 name=__codelineno-41-21 href=#__codelineno-41-21></a><span class=k>if</span><span class=w> </span>!<span class=w> </span>grep<span class=w> </span>HISTTIMEFORMAT<span class=w> </span>/etc/bashrc<span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-41-22 name=__codelineno-41-22 href=#__codelineno-41-22></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s1>&#39;export HISTTIMEFORMAT=&quot;%F %T `whoami` &quot;&#39;</span><span class=w> </span>&gt;&gt;<span class=w> </span>/etc/bashrc
<a id=__codelineno-41-23 name=__codelineno-41-23 href=#__codelineno-41-23></a><span class=k>fi</span>
<a id=__codelineno-41-24 name=__codelineno-41-24 href=#__codelineno-41-24></a>
<a id=__codelineno-41-25 name=__codelineno-41-25 href=#__codelineno-41-25></a><span class=c1># SSH超时时间</span>
<a id=__codelineno-41-26 name=__codelineno-41-26 href=#__codelineno-41-26></a><span class=k>if</span><span class=w> </span>!<span class=w> </span>grep<span class=w> </span><span class=s2>&quot;TMOUT=600&quot;</span><span class=w> </span>/etc/profile<span class=w> </span><span class=p>&amp;</span>&gt;/dev/null<span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-41-27 name=__codelineno-41-27 href=#__codelineno-41-27></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;export TMOUT=600&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span>/etc/profile
<a id=__codelineno-41-28 name=__codelineno-41-28 href=#__codelineno-41-28></a><span class=k>fi</span>
<a id=__codelineno-41-29 name=__codelineno-41-29 href=#__codelineno-41-29></a>
<a id=__codelineno-41-30 name=__codelineno-41-30 href=#__codelineno-41-30></a><span class=c1># 禁止root远程登录</span>
<a id=__codelineno-41-31 name=__codelineno-41-31 href=#__codelineno-41-31></a>sed<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;s/#PermitRootLogin yes/PermitRootLogin no/&#39;</span><span class=w> </span>/etc/ssh/sshd_config
<a id=__codelineno-41-32 name=__codelineno-41-32 href=#__codelineno-41-32></a>
<a id=__codelineno-41-33 name=__codelineno-41-33 href=#__codelineno-41-33></a><span class=c1># 禁止定时任务向发送邮件</span>
<a id=__codelineno-41-34 name=__codelineno-41-34 href=#__codelineno-41-34></a>sed<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;s/^MAILTO=root/MAILTO=&quot;&quot;/&#39;</span><span class=w> </span>/etc/crontab
<a id=__codelineno-41-35 name=__codelineno-41-35 href=#__codelineno-41-35></a>
<a id=__codelineno-41-36 name=__codelineno-41-36 href=#__codelineno-41-36></a><span class=c1># 设置最大打开文件数</span>
<a id=__codelineno-41-37 name=__codelineno-41-37 href=#__codelineno-41-37></a><span class=k>if</span><span class=w> </span>!<span class=w> </span>grep<span class=w> </span><span class=s2>&quot;* soft nofile 65535&quot;</span><span class=w> </span>/etc/security/limits.conf<span class=w> </span><span class=p>&amp;</span>&gt;/dev/null<span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-41-38 name=__codelineno-41-38 href=#__codelineno-41-38></a><span class=w>    </span>cat<span class=w> </span>&gt;&gt;<span class=w> </span>/etc/security/limits.conf<span class=w> </span><span class=s>&lt;&lt; EOF</span>
<a id=__codelineno-41-39 name=__codelineno-41-39 href=#__codelineno-41-39></a><span class=s>    * soft nofile 65535</span>
<a id=__codelineno-41-40 name=__codelineno-41-40 href=#__codelineno-41-40></a><span class=s>    * hard nofile 65535</span>
<a id=__codelineno-41-41 name=__codelineno-41-41 href=#__codelineno-41-41></a><span class=s>EOF</span>
<a id=__codelineno-41-42 name=__codelineno-41-42 href=#__codelineno-41-42></a><span class=k>fi</span>
<a id=__codelineno-41-43 name=__codelineno-41-43 href=#__codelineno-41-43></a>
<a id=__codelineno-41-44 name=__codelineno-41-44 href=#__codelineno-41-44></a><span class=c1># 系统内核优化</span>
<a id=__codelineno-41-45 name=__codelineno-41-45 href=#__codelineno-41-45></a>cat<span class=w> </span>&gt;&gt;<span class=w> </span>/etc/sysctl.conf<span class=w> </span><span class=s>&lt;&lt; EOF</span>
<a id=__codelineno-41-46 name=__codelineno-41-46 href=#__codelineno-41-46></a><span class=s>net.ipv4.tcp_syncookies = 1</span>
<a id=__codelineno-41-47 name=__codelineno-41-47 href=#__codelineno-41-47></a><span class=s>net.ipv4.tcp_max_tw_buckets = 20480</span>
<a id=__codelineno-41-48 name=__codelineno-41-48 href=#__codelineno-41-48></a><span class=s>net.ipv4.tcp_max_syn_backlog = 20480</span>
<a id=__codelineno-41-49 name=__codelineno-41-49 href=#__codelineno-41-49></a><span class=s>net.core.netdev_max_backlog = 262144</span>
<a id=__codelineno-41-50 name=__codelineno-41-50 href=#__codelineno-41-50></a><span class=s>net.ipv4.tcp_fin_timeout = 20</span>
<a id=__codelineno-41-51 name=__codelineno-41-51 href=#__codelineno-41-51></a><span class=s>EOF</span>
<a id=__codelineno-41-52 name=__codelineno-41-52 href=#__codelineno-41-52></a>
<a id=__codelineno-41-53 name=__codelineno-41-53 href=#__codelineno-41-53></a><span class=c1># 减少SWAP使用</span>
<a id=__codelineno-41-54 name=__codelineno-41-54 href=#__codelineno-41-54></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;0&quot;</span><span class=w> </span>&gt;<span class=w> </span>/proc/sys/vm/swappiness
<a id=__codelineno-41-55 name=__codelineno-41-55 href=#__codelineno-41-55></a>
<a id=__codelineno-41-56 name=__codelineno-41-56 href=#__codelineno-41-56></a><span class=c1># 安装系统性能分析工具及其他</span>
<a id=__codelineno-41-57 name=__codelineno-41-57 href=#__codelineno-41-57></a>yum<span class=w> </span>install<span class=w> </span>gcc<span class=w> </span>make<span class=w> </span>autoconf<span class=w> </span>vim<span class=w> </span>sysstat<span class=w> </span>net-tools<span class=w> </span>iostat<span class=w> </span><span class=k>if</span>
</code></pre></div> <h2 id=23函数输出帮助信息>23.函数输出帮助信息<a class=headerlink href=#23函数输出帮助信息 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-42-1 name=__codelineno-42-1 href=#__codelineno-42-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-42-2 name=__codelineno-42-2 href=#__codelineno-42-2></a><span class=c1>#功能描述(Description):使用函数输出帮助信息.</span>
<a id=__codelineno-42-3 name=__codelineno-42-3 href=#__codelineno-42-3></a>
<a id=__codelineno-42-4 name=__codelineno-42-4 href=#__codelineno-42-4></a><span class=k>function</span><span class=w> </span>print_usage<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-42-5 name=__codelineno-42-5 href=#__codelineno-42-5></a><span class=w>    </span>cat<span class=w> </span><span class=s>&lt;&lt; EOF</span>
<a id=__codelineno-42-6 name=__codelineno-42-6 href=#__codelineno-42-6></a><span class=s>Usage: --help | -h</span>
<a id=__codelineno-42-7 name=__codelineno-42-7 href=#__codelineno-42-7></a><span class=s>  Print help information for script.</span>
<a id=__codelineno-42-8 name=__codelineno-42-8 href=#__codelineno-42-8></a><span class=s>Usage: --memory | -m</span>
<a id=__codelineno-42-9 name=__codelineno-42-9 href=#__codelineno-42-9></a><span class=s>  Monitor memory information.</span>
<a id=__codelineno-42-10 name=__codelineno-42-10 href=#__codelineno-42-10></a><span class=s>Usage: --network | -n</span>
<a id=__codelineno-42-11 name=__codelineno-42-11 href=#__codelineno-42-11></a><span class=s>  Monitor network interface information.</span>
<a id=__codelineno-42-12 name=__codelineno-42-12 href=#__codelineno-42-12></a><span class=s>EOF</span>
<a id=__codelineno-42-13 name=__codelineno-42-13 href=#__codelineno-42-13></a><span class=o>}</span>
<a id=__codelineno-42-14 name=__codelineno-42-14 href=#__codelineno-42-14></a>
<a id=__codelineno-42-15 name=__codelineno-42-15 href=#__codelineno-42-15></a><span class=k>case</span><span class=w> </span><span class=nv>$1</span><span class=w> </span><span class=k>in</span>
<a id=__codelineno-42-16 name=__codelineno-42-16 href=#__codelineno-42-16></a>--memory<span class=p>|</span>-m<span class=o>)</span>
<a id=__codelineno-42-17 name=__codelineno-42-17 href=#__codelineno-42-17></a><span class=w>    </span>free<span class=p>;;</span>
<a id=__codelineno-42-18 name=__codelineno-42-18 href=#__codelineno-42-18></a>--network<span class=p>|</span>-n<span class=o>)</span>
<a id=__codelineno-42-19 name=__codelineno-42-19 href=#__codelineno-42-19></a><span class=w>    </span>ip<span class=w> </span>-s<span class=w> </span>link<span class=p>;;</span>
<a id=__codelineno-42-20 name=__codelineno-42-20 href=#__codelineno-42-20></a>--help<span class=p>|</span>-h<span class=o>)</span>
<a id=__codelineno-42-21 name=__codelineno-42-21 href=#__codelineno-42-21></a><span class=w>    </span>print_usage<span class=p>;;</span>
<a id=__codelineno-42-22 name=__codelineno-42-22 href=#__codelineno-42-22></a>*<span class=o>)</span>
<a id=__codelineno-42-23 name=__codelineno-42-23 href=#__codelineno-42-23></a><span class=w>    </span>print_usage<span class=p>;;</span>
<a id=__codelineno-42-24 name=__codelineno-42-24 href=#__codelineno-42-24></a><span class=k>esac</span>
</code></pre></div> <h2 id=24设置锁文件防止脚本重复执行>24.设置锁文件防止脚本重复执行<a class=headerlink href=#24设置锁文件防止脚本重复执行 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-43-1 name=__codelineno-43-1 href=#__codelineno-43-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-43-2 name=__codelineno-43-2 href=#__codelineno-43-2></a><span class=c1>#功能描述(Description):通过设置锁文件防止脚本重复执行.</span>
<a id=__codelineno-43-3 name=__codelineno-43-3 href=#__codelineno-43-3></a>
<a id=__codelineno-43-4 name=__codelineno-43-4 href=#__codelineno-43-4></a><span class=c1>#使用Ctrl+C中断脚本时,删除锁文件.</span>
<a id=__codelineno-43-5 name=__codelineno-43-5 href=#__codelineno-43-5></a><span class=nb>trap</span><span class=w> </span><span class=s1>&#39;rm -rf /tmp/lockfile;exit&#39;</span><span class=w> </span>HUP<span class=w> </span>INT
<a id=__codelineno-43-6 name=__codelineno-43-6 href=#__codelineno-43-6></a>
<a id=__codelineno-43-7 name=__codelineno-43-7 href=#__codelineno-43-7></a><span class=c1>#检查是否存在锁文件,没有锁文件就执行backup备份函数,如果有锁文件脚本则脚本直接退出.</span>
<a id=__codelineno-43-8 name=__codelineno-43-8 href=#__codelineno-43-8></a>lock_check<span class=o>(){</span>
<a id=__codelineno-43-9 name=__codelineno-43-9 href=#__codelineno-43-9></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>(</span><span class=nb>set</span><span class=w> </span>-C<span class=p>;</span><span class=w> </span>:&gt;<span class=w> </span>/tmp/lockfile<span class=o>)</span><span class=w> </span><span class=m>2</span>&gt;/dev/null<span class=w> </span><span class=p>;</span><span class=k>then</span>
<a id=__codelineno-43-10 name=__codelineno-43-10 href=#__codelineno-43-10></a><span class=w>        </span>backup
<a id=__codelineno-43-11 name=__codelineno-43-11 href=#__codelineno-43-11></a><span class=w>    </span><span class=k>else</span>
<a id=__codelineno-43-12 name=__codelineno-43-12 href=#__codelineno-43-12></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;\033[91mWarning:其他用户在执行该脚本.\033[0m&quot;</span>
<a id=__codelineno-43-13 name=__codelineno-43-13 href=#__codelineno-43-13></a><span class=w>        </span><span class=nb>exit</span><span class=w> </span><span class=m>66</span>
<a id=__codelineno-43-14 name=__codelineno-43-14 href=#__codelineno-43-14></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-43-15 name=__codelineno-43-15 href=#__codelineno-43-15></a><span class=o>}</span>
<a id=__codelineno-43-16 name=__codelineno-43-16 href=#__codelineno-43-16></a>
<a id=__codelineno-43-17 name=__codelineno-43-17 href=#__codelineno-43-17></a><span class=c1>#执行备份前创建所文件,然后执行备份数据库的操作,备份完成后删除锁文件.</span>
<a id=__codelineno-43-18 name=__codelineno-43-18 href=#__codelineno-43-18></a><span class=c1>#sleep 10实验测试时使用,为了防止小数据库备份太快,无法验证重复执行脚本的效果.</span>
<a id=__codelineno-43-19 name=__codelineno-43-19 href=#__codelineno-43-19></a>backup<span class=o>(){</span>
<a id=__codelineno-43-20 name=__codelineno-43-20 href=#__codelineno-43-20></a><span class=w>    </span>touch<span class=w> </span>/tmp/lockfile
<a id=__codelineno-43-21 name=__codelineno-43-21 href=#__codelineno-43-21></a><span class=w>    </span>mysqldump<span class=w> </span>--all-database<span class=w> </span>&gt;<span class=w> </span>/var/log/mysql-<span class=k>$(</span>date<span class=w> </span>+%Y%m%d<span class=k>)</span>.bak
<a id=__codelineno-43-22 name=__codelineno-43-22 href=#__codelineno-43-22></a><span class=w>    </span>sleep<span class=w> </span><span class=m>10</span>
<a id=__codelineno-43-23 name=__codelineno-43-23 href=#__codelineno-43-23></a><span class=w>    </span>rm<span class=w> </span>-rf<span class=w> </span>/tmp/lockfile
<a id=__codelineno-43-24 name=__codelineno-43-24 href=#__codelineno-43-24></a><span class=o>}</span>
<a id=__codelineno-43-25 name=__codelineno-43-25 href=#__codelineno-43-25></a>
<a id=__codelineno-43-26 name=__codelineno-43-26 href=#__codelineno-43-26></a>lock_check
<a id=__codelineno-43-27 name=__codelineno-43-27 href=#__codelineno-43-27></a>backup
</code></pre></div> <h2 id=25对一组-url-测试能否访问成功>25.对一组 url 测试能否访问成功<a class=headerlink href=#25对一组-url-测试能否访问成功 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-44-1 name=__codelineno-44-1 href=#__codelineno-44-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-44-2 name=__codelineno-44-2 href=#__codelineno-44-2></a>
<a id=__codelineno-44-3 name=__codelineno-44-3 href=#__codelineno-44-3></a><span class=nv>url_list</span><span class=o>=(</span><span class=w>  </span><span class=c1>#定义一个包含三个网址的数组 url_list</span>
<a id=__codelineno-44-4 name=__codelineno-44-4 href=#__codelineno-44-4></a>http://www.baidu.com
<a id=__codelineno-44-5 name=__codelineno-44-5 href=#__codelineno-44-5></a>https://www.shiyanlou.com
<a id=__codelineno-44-6 name=__codelineno-44-6 href=#__codelineno-44-6></a>http://www.google.com
<a id=__codelineno-44-7 name=__codelineno-44-7 href=#__codelineno-44-7></a><span class=o>)</span>
<a id=__codelineno-44-8 name=__codelineno-44-8 href=#__codelineno-44-8></a>
<a id=__codelineno-44-9 name=__codelineno-44-9 href=#__codelineno-44-9></a>wait<span class=o>(){</span><span class=w>   </span><span class=c1>#定义倒计时函数 wait</span>
<a id=__codelineno-44-10 name=__codelineno-44-10 href=#__codelineno-44-10></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s1>&#39;wait 3 second...&#39;</span>
<a id=__codelineno-44-11 name=__codelineno-44-11 href=#__codelineno-44-11></a><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=o>((</span><span class=nv>i</span><span class=o>=</span><span class=m>0</span><span class=p>;</span>i&lt;<span class=m>3</span><span class=p>;</span>i++<span class=o>))</span>
<a id=__codelineno-44-12 name=__codelineno-44-12 href=#__codelineno-44-12></a><span class=w>    </span><span class=k>do</span>
<a id=__codelineno-44-13 name=__codelineno-44-13 href=#__codelineno-44-13></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;.&quot;</span><span class=p>;</span>sleep<span class=w> </span><span class=m>1</span><span class=w>  </span><span class=c1>#每隔1秒打印一个点</span>
<a id=__codelineno-44-14 name=__codelineno-44-14 href=#__codelineno-44-14></a><span class=w>    </span><span class=k>done</span>
<a id=__codelineno-44-15 name=__codelineno-44-15 href=#__codelineno-44-15></a><span class=w>    </span><span class=nb>echo</span>
<a id=__codelineno-44-16 name=__codelineno-44-16 href=#__codelineno-44-16></a><span class=o>}</span>
<a id=__codelineno-44-17 name=__codelineno-44-17 href=#__codelineno-44-17></a>
<a id=__codelineno-44-18 name=__codelineno-44-18 href=#__codelineno-44-18></a>check_url<span class=o>(){</span>
<a id=__codelineno-44-19 name=__codelineno-44-19 href=#__codelineno-44-19></a><span class=w>    </span><span class=nb>wait</span><span class=w>   </span><span class=c1># 调用已经定义的 wait 函数</span>
<a id=__codelineno-44-20 name=__codelineno-44-20 href=#__codelineno-44-20></a>
<a id=__codelineno-44-21 name=__codelineno-44-21 href=#__codelineno-44-21></a><span class=w>    </span><span class=c1>#循环遍历 url_list 中的地址</span>
<a id=__codelineno-44-22 name=__codelineno-44-22 href=#__codelineno-44-22></a><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=o>((</span><span class=nv>i</span><span class=o>=</span><span class=m>0</span><span class=p>;</span>i&lt;<span class=sb>`</span><span class=nb>echo</span><span class=w> </span><span class=si>${#</span><span class=nv>url_list</span><span class=p>[*]</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>i++<span class=o>))</span>
<a id=__codelineno-44-23 name=__codelineno-44-23 href=#__codelineno-44-23></a><span class=w>    </span><span class=k>do</span>
<a id=__codelineno-44-24 name=__codelineno-44-24 href=#__codelineno-44-24></a>
<a id=__codelineno-44-25 name=__codelineno-44-25 href=#__codelineno-44-25></a><span class=w>        </span><span class=c1>#检测是否可以访问数组元素中的地址</span>
<a id=__codelineno-44-26 name=__codelineno-44-26 href=#__codelineno-44-26></a><span class=w>        </span>wget<span class=w> </span>-o<span class=w> </span>/dev/null<span class=w> </span>-T<span class=w> </span><span class=m>3</span><span class=w> </span>--tries<span class=o>=</span><span class=m>1</span><span class=w> </span>--spider<span class=w> </span><span class=si>${</span><span class=nv>url_list</span><span class=p>[</span><span class=nv>$i</span><span class=p>]</span><span class=si>}</span><span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span><span class=w>  </span><span class=c1>#--tries是设置尝试次数，--spider检查网址，后面的&gt;/dev/null 2&gt;&amp;1是不保留任何输出</span>
<a id=__codelineno-44-27 name=__codelineno-44-27 href=#__codelineno-44-27></a>
<a id=__codelineno-44-28 name=__codelineno-44-28 href=#__codelineno-44-28></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=nv>$?</span><span class=w> </span>-eq<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=k>then</span><span class=w>   </span><span class=c1>#如果返回值为0则表示访问成功</span>
<a id=__codelineno-44-29 name=__codelineno-44-29 href=#__codelineno-44-29></a><span class=w>            </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>url_list</span><span class=p>[</span><span class=nv>$i</span><span class=p>]</span><span class=si>}</span><span class=s2> success&quot;</span>
<a id=__codelineno-44-30 name=__codelineno-44-30 href=#__codelineno-44-30></a><span class=w>        </span><span class=k>else</span>
<a id=__codelineno-44-31 name=__codelineno-44-31 href=#__codelineno-44-31></a><span class=w>            </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>url_list</span><span class=p>[</span><span class=nv>$i</span><span class=p>]</span><span class=si>}</span><span class=s2> false&quot;</span>
<a id=__codelineno-44-32 name=__codelineno-44-32 href=#__codelineno-44-32></a><span class=w>        </span><span class=k>fi</span>
<a id=__codelineno-44-33 name=__codelineno-44-33 href=#__codelineno-44-33></a><span class=w>    </span><span class=k>done</span>
<a id=__codelineno-44-34 name=__codelineno-44-34 href=#__codelineno-44-34></a><span class=o>}</span>
<a id=__codelineno-44-35 name=__codelineno-44-35 href=#__codelineno-44-35></a>
<a id=__codelineno-44-36 name=__codelineno-44-36 href=#__codelineno-44-36></a>main<span class=o>(){</span><span class=w>  </span><span class=c1>#定义主函数，即入口函数，应用程序运行时首先执行的代码</span>
<a id=__codelineno-44-37 name=__codelineno-44-37 href=#__codelineno-44-37></a><span class=w>        </span>check_url<span class=w>   </span><span class=c1>#调用定义的 check_url 函数</span>
<a id=__codelineno-44-38 name=__codelineno-44-38 href=#__codelineno-44-38></a><span class=o>}</span>
<a id=__codelineno-44-39 name=__codelineno-44-39 href=#__codelineno-44-39></a>
<a id=__codelineno-44-40 name=__codelineno-44-40 href=#__codelineno-44-40></a>
<a id=__codelineno-44-41 name=__codelineno-44-41 href=#__codelineno-44-41></a>main<span class=w>    </span><span class=c1>#调用主函数</span>
</code></pre></div> <h2 id=26mysql-单表数据同步脚本>26.MySQL 单表数据同步脚本<a class=headerlink href=#26mysql-单表数据同步脚本 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-45-1 name=__codelineno-45-1 href=#__codelineno-45-1></a><span class=ch>#!/usr/bin/env bash</span>
<a id=__codelineno-45-2 name=__codelineno-45-2 href=#__codelineno-45-2></a><span class=c1># Auth: liuli</span>
<a id=__codelineno-45-3 name=__codelineno-45-3 href=#__codelineno-45-3></a><span class=c1># Version: v1.0, 2020/6/17</span>
<a id=__codelineno-45-4 name=__codelineno-45-4 href=#__codelineno-45-4></a><span class=c1># Sys: CentOS 7.6</span>
<a id=__codelineno-45-5 name=__codelineno-45-5 href=#__codelineno-45-5></a><span class=c1># Features: 用于同步研发数据库中的某些表至生产数据库</span>
<a id=__codelineno-45-6 name=__codelineno-45-6 href=#__codelineno-45-6></a>
<a id=__codelineno-45-7 name=__codelineno-45-7 href=#__codelineno-45-7></a><span class=c1># set -xeuo pipefail</span>
<a id=__codelineno-45-8 name=__codelineno-45-8 href=#__codelineno-45-8></a>
<a id=__codelineno-45-9 name=__codelineno-45-9 href=#__codelineno-45-9></a><span class=nv>time</span><span class=o>=</span><span class=sb>`</span>date<span class=w> </span><span class=s1>&#39;+%Y-%m-%d-%H:%M&#39;</span><span class=sb>`</span>
<a id=__codelineno-45-10 name=__codelineno-45-10 href=#__codelineno-45-10></a>mkdir<span class=w> </span>-p<span class=w> </span>./sql/<span class=si>${</span><span class=nv>time</span><span class=si>}</span>
<a id=__codelineno-45-11 name=__codelineno-45-11 href=#__codelineno-45-11></a>
<a id=__codelineno-45-12 name=__codelineno-45-12 href=#__codelineno-45-12></a><span class=nv>db_Name</span><span class=o>=</span><span class=s2>&quot;temp-tenant&quot;</span>
<a id=__codelineno-45-13 name=__codelineno-45-13 href=#__codelineno-45-13></a><span class=nv>table_Name</span><span class=o>=(</span>
<a id=__codelineno-45-14 name=__codelineno-45-14 href=#__codelineno-45-14></a>interface_authority
<a id=__codelineno-45-15 name=__codelineno-45-15 href=#__codelineno-45-15></a>interface_permissions
<a id=__codelineno-45-16 name=__codelineno-45-16 href=#__codelineno-45-16></a>t_user_function_authority
<a id=__codelineno-45-17 name=__codelineno-45-17 href=#__codelineno-45-17></a>t_user_function_permission
<a id=__codelineno-45-18 name=__codelineno-45-18 href=#__codelineno-45-18></a>t_menu
<a id=__codelineno-45-19 name=__codelineno-45-19 href=#__codelineno-45-19></a><span class=o>)</span>
<a id=__codelineno-45-20 name=__codelineno-45-20 href=#__codelineno-45-20></a><span class=c1># 研发环境</span>
<a id=__codelineno-45-21 name=__codelineno-45-21 href=#__codelineno-45-21></a><span class=nv>dev_IP</span><span class=o>=</span><span class=s2>&quot;192.168.1.xxx&quot;</span>
<a id=__codelineno-45-22 name=__codelineno-45-22 href=#__codelineno-45-22></a><span class=nv>dev_Port</span><span class=o>=</span><span class=s2>&quot;3306&quot;</span>
<a id=__codelineno-45-23 name=__codelineno-45-23 href=#__codelineno-45-23></a><span class=nv>dev_Pass</span><span class=o>=</span><span class=s2>&quot;xxxxx.&quot;</span>
<a id=__codelineno-45-24 name=__codelineno-45-24 href=#__codelineno-45-24></a><span class=c1># 生产环境</span>
<a id=__codelineno-45-25 name=__codelineno-45-25 href=#__codelineno-45-25></a><span class=nv>prod_IP</span><span class=o>=</span><span class=s2>&quot;192.168.1.16&quot;</span>
<a id=__codelineno-45-26 name=__codelineno-45-26 href=#__codelineno-45-26></a><span class=nv>prod_Port</span><span class=o>=</span><span class=s2>&quot;23306&quot;</span>
<a id=__codelineno-45-27 name=__codelineno-45-27 href=#__codelineno-45-27></a><span class=nv>prod_Pass</span><span class=o>=</span><span class=s2>&quot;xxxxx.&quot;</span>
<a id=__codelineno-45-28 name=__codelineno-45-28 href=#__codelineno-45-28></a>
<a id=__codelineno-45-29 name=__codelineno-45-29 href=#__codelineno-45-29></a><span class=c1># 导出研发环境的表</span>
<a id=__codelineno-45-30 name=__codelineno-45-30 href=#__codelineno-45-30></a><span class=k>for</span><span class=w> </span>i<span class=w> </span><span class=k>in</span><span class=w> </span><span class=si>${</span><span class=nv>table_Name</span><span class=p>[*]</span><span class=si>}</span>
<a id=__codelineno-45-31 name=__codelineno-45-31 href=#__codelineno-45-31></a><span class=k>do</span>
<a id=__codelineno-45-32 name=__codelineno-45-32 href=#__codelineno-45-32></a><span class=w>        </span>mysqldump<span class=w> </span>-h<span class=si>${</span><span class=nv>dev_IP</span><span class=si>}</span><span class=w> </span>-uroot<span class=w> </span>-P<span class=si>${</span><span class=nv>dev_Port</span><span class=si>}</span><span class=w> </span>-p<span class=si>${</span><span class=nv>dev_Pass</span><span class=si>}</span><span class=w> </span><span class=si>${</span><span class=nv>db_Name</span><span class=si>}</span><span class=w> </span><span class=si>${</span><span class=nv>i</span><span class=si>}</span><span class=w> </span>&gt;<span class=w> </span>./sql/<span class=si>${</span><span class=nv>time</span><span class=si>}</span>/dev.sql
<a id=__codelineno-45-33 name=__codelineno-45-33 href=#__codelineno-45-33></a><span class=k>done</span>
<a id=__codelineno-45-34 name=__codelineno-45-34 href=#__codelineno-45-34></a>
<a id=__codelineno-45-35 name=__codelineno-45-35 href=#__codelineno-45-35></a><span class=c1># 导出生产环境的整个库</span>
<a id=__codelineno-45-36 name=__codelineno-45-36 href=#__codelineno-45-36></a>mysqldump<span class=w> </span>-h<span class=si>${</span><span class=nv>prod_IP</span><span class=si>}</span><span class=w> </span>-uroot<span class=w> </span>-P<span class=si>${</span><span class=nv>prod_Port</span><span class=si>}</span><span class=w> </span>-p<span class=si>${</span><span class=nv>prod_Pass</span><span class=si>}</span><span class=w> </span><span class=si>${</span><span class=nv>db_Name</span><span class=si>}</span><span class=w> </span>&gt;<span class=w> </span>./sql/<span class=si>${</span><span class=nv>time</span><span class=si>}</span>/<span class=si>${</span><span class=nv>db_Name</span><span class=si>}</span>.sql
<a id=__codelineno-45-37 name=__codelineno-45-37 href=#__codelineno-45-37></a>
<a id=__codelineno-45-38 name=__codelineno-45-38 href=#__codelineno-45-38></a><span class=c1># 删除生产环境的表</span>
<a id=__codelineno-45-39 name=__codelineno-45-39 href=#__codelineno-45-39></a><span class=k>for</span><span class=w> </span>i<span class=w> </span><span class=k>in</span><span class=w> </span><span class=si>${</span><span class=nv>table_Name</span><span class=p>[*]</span><span class=si>}</span>
<a id=__codelineno-45-40 name=__codelineno-45-40 href=#__codelineno-45-40></a><span class=k>do</span>
<a id=__codelineno-45-41 name=__codelineno-45-41 href=#__codelineno-45-41></a><span class=w>        </span>mysql<span class=w> </span>-h<span class=si>${</span><span class=nv>prod_IP</span><span class=si>}</span><span class=w> </span>-uroot<span class=w> </span>-P<span class=si>${</span><span class=nv>prod_Port</span><span class=si>}</span><span class=w> </span>-p<span class=si>${</span><span class=nv>prod_Pass</span><span class=si>}</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;USE </span><span class=si>${</span><span class=nv>db_Name</span><span class=si>}</span><span class=s2>;DROP TABLE </span><span class=si>${</span><span class=nv>i</span><span class=si>}</span><span class=s2>&quot;</span>
<a id=__codelineno-45-42 name=__codelineno-45-42 href=#__codelineno-45-42></a><span class=k>done</span>
<a id=__codelineno-45-43 name=__codelineno-45-43 href=#__codelineno-45-43></a>
<a id=__codelineno-45-44 name=__codelineno-45-44 href=#__codelineno-45-44></a><span class=c1># 导入研发环境的表</span>
<a id=__codelineno-45-45 name=__codelineno-45-45 href=#__codelineno-45-45></a>mysql<span class=w> </span>-h<span class=si>${</span><span class=nv>prod_IP</span><span class=si>}</span><span class=w> </span>-uroot<span class=w> </span>-P<span class=si>${</span><span class=nv>prod_Port</span><span class=si>}</span><span class=w> </span>-p<span class=si>${</span><span class=nv>prod_Pass</span><span class=si>}</span><span class=w> </span><span class=si>${</span><span class=nv>db_Name</span><span class=si>}</span><span class=w> </span>&lt;<span class=w> </span>./sql/<span class=si>${</span><span class=nv>time</span><span class=si>}</span>/dev.sql
</code></pre></div> <h2 id=27shell-实现多并发控制>27.shell 实现多并发控制<a class=headerlink href=#27shell-实现多并发控制 title="Permanent link">&para;</a></h2> <h3 id=不并发>不并发<a class=headerlink href=#不并发 title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-46-1 name=__codelineno-46-1 href=#__codelineno-46-1></a><span class=ch>#!/usr/bin/env bash</span>
<a id=__codelineno-46-2 name=__codelineno-46-2 href=#__codelineno-46-2></a><span class=c1>#usage:xxx</span>
<a id=__codelineno-46-3 name=__codelineno-46-3 href=#__codelineno-46-3></a><span class=c1>#scripts_name:xxx.sh</span>
<a id=__codelineno-46-4 name=__codelineno-46-4 href=#__codelineno-46-4></a><span class=nv>shutdown_instance_array</span><span class=o>=(</span><span class=k>$(</span>nova<span class=w> </span>list<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>SHUTOFF<span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span>-F<span class=w> </span><span class=s2>&quot;|&quot;</span><span class=w> </span><span class=s1>&#39;{print $2}&#39;</span><span class=k>)</span><span class=o>)</span>
<a id=__codelineno-46-5 name=__codelineno-46-5 href=#__codelineno-46-5></a><span class=nv>shutdown_instance_Name</span><span class=o>=(</span><span class=k>$(</span>nova<span class=w> </span>list<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>SHUTOFF<span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span>-F<span class=w> </span><span class=s2>&quot;|&quot;</span><span class=w> </span><span class=s1>&#39;{print $3}&#39;</span><span class=k>)</span><span class=o>)</span>
<a id=__codelineno-46-6 name=__codelineno-46-6 href=#__codelineno-46-6></a><span class=nb>declare</span><span class=w> </span>-A<span class=w> </span>array_instance
<a id=__codelineno-46-7 name=__codelineno-46-7 href=#__codelineno-46-7></a>
<a id=__codelineno-46-8 name=__codelineno-46-8 href=#__codelineno-46-8></a><span class=c1># 设置关联数组</span>
<a id=__codelineno-46-9 name=__codelineno-46-9 href=#__codelineno-46-9></a><span class=k>for</span><span class=w> </span>i<span class=w> </span><span class=k>in</span><span class=w> </span><span class=si>${</span><span class=p>!shutdown_instance_array[@]</span><span class=si>}</span><span class=p>;</span><span class=w> </span><span class=k>do</span><span class=w> </span>array_instance<span class=o>[</span><span class=si>${</span><span class=nv>shutdown_instance_Name</span><span class=p>[</span><span class=nv>$i</span><span class=p>]</span><span class=si>}</span><span class=o>]=</span><span class=si>${</span><span class=nv>shutdown_instance_array</span><span class=p>[</span><span class=nv>$i</span><span class=p>]</span><span class=si>}</span><span class=p>;</span><span class=w> </span><span class=k>done</span>
<a id=__codelineno-46-10 name=__codelineno-46-10 href=#__codelineno-46-10></a>
<a id=__codelineno-46-11 name=__codelineno-46-11 href=#__codelineno-46-11></a><span class=nv>name_arry</span><span class=o>=(</span><span class=si>${</span><span class=p>!array_instance[@]</span><span class=si>}</span><span class=o>)</span><span class=w> </span><span class=c1>#key -name</span>
<a id=__codelineno-46-12 name=__codelineno-46-12 href=#__codelineno-46-12></a><span class=nv>id_arry</span><span class=o>=(</span><span class=si>${</span><span class=nv>array_instance</span><span class=p>[@]</span><span class=si>}</span><span class=o>)</span><span class=w>    </span><span class=c1>#value -id</span>
<a id=__codelineno-46-13 name=__codelineno-46-13 href=#__codelineno-46-13></a>
<a id=__codelineno-46-14 name=__codelineno-46-14 href=#__codelineno-46-14></a><span class=k>for</span><span class=w> </span><span class=o>((</span><span class=nv>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>0</span><span class=p>;</span><span class=w> </span>i<span class=w> </span>&lt;<span class=w> </span><span class=si>${#</span><span class=nv>shutdown_instance_array</span><span class=p>[@]</span><span class=si>}</span><span class=p>;</span><span class=w> </span>i++<span class=o>))</span><span class=p>;</span><span class=w> </span><span class=k>do</span>
<a id=__codelineno-46-15 name=__codelineno-46-15 href=#__codelineno-46-15></a><span class=o>{</span>
<a id=__codelineno-46-16 name=__codelineno-46-16 href=#__codelineno-46-16></a><span class=c1>#     echo ${name_arry[$i]}</span>
<a id=__codelineno-46-17 name=__codelineno-46-17 href=#__codelineno-46-17></a><span class=w>    </span><span class=nv>map_dev</span><span class=o>=</span><span class=k>$(</span>rbd<span class=w> </span>map<span class=w> </span><span class=si>${</span><span class=nv>id_arry</span><span class=p>[</span><span class=nv>$i</span><span class=p>]</span><span class=si>}</span>_disk<span class=w> </span>-p<span class=w> </span>vms<span class=k>)</span>
<a id=__codelineno-46-18 name=__codelineno-46-18 href=#__codelineno-46-18></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;xfs_repair -L </span><span class=nv>$map_dev</span><span class=s2> &gt; </span><span class=si>${</span><span class=nv>name_arry</span><span class=p>[</span><span class=nv>$i</span><span class=p>]</span><span class=si>}</span><span class=s2>.log 2&gt;&amp;1 &amp;&quot;</span>
<a id=__codelineno-46-19 name=__codelineno-46-19 href=#__codelineno-46-19></a><span class=w>  </span><span class=o>}</span><span class=w> </span><span class=p>&amp;</span>
<a id=__codelineno-46-20 name=__codelineno-46-20 href=#__codelineno-46-20></a><span class=w>    </span>sleep<span class=w> </span><span class=m>1</span>
<a id=__codelineno-46-21 name=__codelineno-46-21 href=#__codelineno-46-21></a><span class=k>done</span>
<a id=__codelineno-46-22 name=__codelineno-46-22 href=#__codelineno-46-22></a><span class=nb>wait</span>
<a id=__codelineno-46-23 name=__codelineno-46-23 href=#__codelineno-46-23></a>
<a id=__codelineno-46-24 name=__codelineno-46-24 href=#__codelineno-46-24></a><span class=nv>stop_time</span><span class=o>=</span><span class=k>$(</span>date<span class=w> </span>+%s<span class=k>)</span><span class=w> </span><span class=c1>#定义脚本运行的结束时间</span>
<a id=__codelineno-46-25 name=__codelineno-46-25 href=#__codelineno-46-25></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;TIME:`expr </span><span class=nv>$stop_time</span><span class=s2> - </span><span class=nv>$start_time</span><span class=s2>`&quot;</span>
</code></pre></div> <h3 id=控制并发>控制并发<a class=headerlink href=#控制并发 title="Permanent link">&para;</a></h3> <h4 id=示例-1>示例 1<a class=headerlink href=#示例-1 title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><a id=__codelineno-47-1 name=__codelineno-47-1 href=#__codelineno-47-1></a><span class=ch>#!/usr/bin/env bash</span>
<a id=__codelineno-47-2 name=__codelineno-47-2 href=#__codelineno-47-2></a><span class=c1>#usage: To repair the virtual machine hard disk, the virtual machine must be off</span>
<a id=__codelineno-47-3 name=__codelineno-47-3 href=#__codelineno-47-3></a><span class=nb>source</span><span class=w> </span>/etc/kolla/admin-openrc.sh
<a id=__codelineno-47-4 name=__codelineno-47-4 href=#__codelineno-47-4></a><span class=nv>start_time</span><span class=o>=</span><span class=k>$(</span>date<span class=w> </span>+%s<span class=k>)</span>
<a id=__codelineno-47-5 name=__codelineno-47-5 href=#__codelineno-47-5></a>
<a id=__codelineno-47-6 name=__codelineno-47-6 href=#__codelineno-47-6></a><span class=nv>Nproc</span><span class=o>=</span><span class=m>5</span>
<a id=__codelineno-47-7 name=__codelineno-47-7 href=#__codelineno-47-7></a>
<a id=__codelineno-47-8 name=__codelineno-47-8 href=#__codelineno-47-8></a><span class=nv>shutdown_instance_array</span><span class=o>=(</span><span class=k>$(</span>nova<span class=w> </span>list<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>SHUTOFF<span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span>-F<span class=w> </span><span class=s2>&quot;|&quot;</span><span class=w> </span><span class=s1>&#39;{print $2}&#39;</span><span class=k>)</span><span class=o>)</span>
<a id=__codelineno-47-9 name=__codelineno-47-9 href=#__codelineno-47-9></a><span class=nv>shutdown_instance_Name</span><span class=o>=(</span><span class=k>$(</span>nova<span class=w> </span>list<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>SHUTOFF<span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span>-F<span class=w> </span><span class=s2>&quot;|&quot;</span><span class=w> </span><span class=s1>&#39;{print $3}&#39;</span><span class=k>)</span><span class=o>)</span>
<a id=__codelineno-47-10 name=__codelineno-47-10 href=#__codelineno-47-10></a><span class=nb>declare</span><span class=w> </span>-A<span class=w> </span>array_instance
<a id=__codelineno-47-11 name=__codelineno-47-11 href=#__codelineno-47-11></a>
<a id=__codelineno-47-12 name=__codelineno-47-12 href=#__codelineno-47-12></a><span class=c1># 设置关联数组</span>
<a id=__codelineno-47-13 name=__codelineno-47-13 href=#__codelineno-47-13></a><span class=k>for</span><span class=w> </span>i<span class=w> </span><span class=k>in</span><span class=w> </span><span class=si>${</span><span class=p>!shutdown_instance_array[@]</span><span class=si>}</span><span class=p>;</span><span class=w> </span><span class=k>do</span><span class=w> </span>array_instance<span class=o>[</span><span class=si>${</span><span class=nv>shutdown_instance_Name</span><span class=p>[</span><span class=nv>$i</span><span class=p>]</span><span class=si>}</span><span class=o>]=</span><span class=si>${</span><span class=nv>shutdown_instance_array</span><span class=p>[</span><span class=nv>$i</span><span class=p>]</span><span class=si>}</span><span class=p>;</span><span class=w> </span><span class=k>done</span>
<a id=__codelineno-47-14 name=__codelineno-47-14 href=#__codelineno-47-14></a><span class=nv>name_arry</span><span class=o>=(</span><span class=si>${</span><span class=p>!array_instance[@]</span><span class=si>}</span><span class=o>)</span><span class=w> </span><span class=c1>#key -name</span>
<a id=__codelineno-47-15 name=__codelineno-47-15 href=#__codelineno-47-15></a><span class=nv>id_arry</span><span class=o>=(</span><span class=si>${</span><span class=nv>array_instance</span><span class=p>[@]</span><span class=si>}</span><span class=o>)</span><span class=w>    </span><span class=c1>#value -id</span>
<a id=__codelineno-47-16 name=__codelineno-47-16 href=#__codelineno-47-16></a>
<a id=__codelineno-47-17 name=__codelineno-47-17 href=#__codelineno-47-17></a>
<a id=__codelineno-47-18 name=__codelineno-47-18 href=#__codelineno-47-18></a><span class=o>[</span><span class=w> </span>-e<span class=w> </span>/tmp/fifo.<span class=nv>$$</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>||</span><span class=w> </span>mkfifo<span class=w> </span>/tmp/fifo.<span class=nv>$$</span>
<a id=__codelineno-47-19 name=__codelineno-47-19 href=#__codelineno-47-19></a><span class=nb>exec</span><span class=w> </span><span class=m>3</span>&lt;&gt;/tmp/fifo.<span class=nv>$$</span>
<a id=__codelineno-47-20 name=__codelineno-47-20 href=#__codelineno-47-20></a>rm<span class=w> </span>-f<span class=w> </span>/tmp/fifo.<span class=nv>$$</span>
<a id=__codelineno-47-21 name=__codelineno-47-21 href=#__codelineno-47-21></a>
<a id=__codelineno-47-22 name=__codelineno-47-22 href=#__codelineno-47-22></a><span class=k>for</span><span class=w> </span><span class=o>((</span><span class=nv>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>0</span><span class=p>;</span><span class=w> </span>i<span class=w> </span>&lt;<span class=w> </span><span class=nv>$Nproc</span><span class=p>;</span><span class=w> </span>i++<span class=o>))</span><span class=p>;</span><span class=w> </span><span class=k>do</span>
<a id=__codelineno-47-23 name=__codelineno-47-23 href=#__codelineno-47-23></a><span class=w>  </span><span class=nb>echo</span><span class=w> </span>&gt;<span class=p>&amp;</span><span class=m>3</span>
<a id=__codelineno-47-24 name=__codelineno-47-24 href=#__codelineno-47-24></a><span class=k>done</span>
<a id=__codelineno-47-25 name=__codelineno-47-25 href=#__codelineno-47-25></a>
<a id=__codelineno-47-26 name=__codelineno-47-26 href=#__codelineno-47-26></a><span class=k>for</span><span class=w> </span><span class=o>((</span><span class=nv>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>0</span><span class=p>;</span><span class=w> </span>i<span class=w> </span>&lt;<span class=w> </span><span class=si>${#</span><span class=nv>shutdown_instance_array</span><span class=p>[@]</span><span class=si>}</span><span class=p>;</span><span class=w> </span>i++<span class=o>))</span><span class=p>;</span><span class=w> </span><span class=k>do</span>
<a id=__codelineno-47-27 name=__codelineno-47-27 href=#__codelineno-47-27></a><span class=w>  </span><span class=o>{</span>
<a id=__codelineno-47-28 name=__codelineno-47-28 href=#__codelineno-47-28></a><span class=w>    </span><span class=nb>read</span><span class=w> </span>-u3
<a id=__codelineno-47-29 name=__codelineno-47-29 href=#__codelineno-47-29></a><span class=w>    </span>sleep<span class=w> </span><span class=m>1</span>
<a id=__codelineno-47-30 name=__codelineno-47-30 href=#__codelineno-47-30></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;xfs_repair instamceName: </span><span class=si>${</span><span class=nv>name_arry</span><span class=p>[</span><span class=nv>$i</span><span class=p>]</span><span class=si>}</span><span class=s2> instamceID: </span><span class=si>${</span><span class=nv>id_arry</span><span class=p>[</span><span class=nv>$i</span><span class=p>]</span><span class=si>}</span><span class=s2> &quot;</span>
<a id=__codelineno-47-31 name=__codelineno-47-31 href=#__codelineno-47-31></a><span class=w>    </span><span class=nv>device_name</span><span class=o>=</span><span class=k>$(</span>rbd<span class=w> </span>map<span class=w> </span><span class=si>${</span><span class=nv>id_arry</span><span class=p>[</span><span class=nv>$i</span><span class=p>]</span><span class=si>}</span>_disk<span class=w> </span>-p<span class=w> </span>vms<span class=k>)</span>
<a id=__codelineno-47-32 name=__codelineno-47-32 href=#__codelineno-47-32></a><span class=w>    </span>xfs_repair<span class=w> </span>-L<span class=w> </span><span class=si>${</span><span class=nv>device_name</span><span class=si>}</span><span class=w> </span>&gt;<span class=w> </span><span class=si>${</span><span class=nv>name_arry</span><span class=p>[</span><span class=nv>$i</span><span class=p>]</span><span class=si>}</span>_<span class=nv>$$</span>.log<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-47-33 name=__codelineno-47-33 href=#__codelineno-47-33></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;instamceName: </span><span class=si>${</span><span class=nv>name_arry</span><span class=p>[</span><span class=nv>$i</span><span class=p>]</span><span class=si>}</span><span class=s2> instamceID: </span><span class=si>${</span><span class=nv>id_arry</span><span class=p>[</span><span class=nv>$i</span><span class=p>]</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span>repairInformationSummary.log
<a id=__codelineno-47-34 name=__codelineno-47-34 href=#__codelineno-47-34></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>&gt;<span class=p>&amp;</span><span class=m>3</span><span class=w> </span><span class=c1>#执行到最后，把令牌放回管道</span>
<a id=__codelineno-47-35 name=__codelineno-47-35 href=#__codelineno-47-35></a>
<a id=__codelineno-47-36 name=__codelineno-47-36 href=#__codelineno-47-36></a><span class=w>  </span><span class=o>}</span><span class=p>&amp;</span>
<a id=__codelineno-47-37 name=__codelineno-47-37 href=#__codelineno-47-37></a><span class=k>done</span>
<a id=__codelineno-47-38 name=__codelineno-47-38 href=#__codelineno-47-38></a><span class=nb>wait</span>
<a id=__codelineno-47-39 name=__codelineno-47-39 href=#__codelineno-47-39></a>
<a id=__codelineno-47-40 name=__codelineno-47-40 href=#__codelineno-47-40></a><span class=nv>stop_time</span><span class=o>=</span><span class=k>$(</span>date<span class=w> </span>+%s<span class=k>)</span>
<a id=__codelineno-47-41 name=__codelineno-47-41 href=#__codelineno-47-41></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;TIME:</span><span class=k>$(</span>expr<span class=w> </span><span class=nv>$stop_time</span><span class=w> </span>-<span class=w> </span><span class=nv>$start_time</span><span class=k>)</span><span class=s2>&quot;</span>
<a id=__codelineno-47-42 name=__codelineno-47-42 href=#__codelineno-47-42></a>
<a id=__codelineno-47-43 name=__codelineno-47-43 href=#__codelineno-47-43></a><span class=nb>exec</span><span class=w> </span><span class=m>3</span>&lt;<span class=p>&amp;</span>-
</code></pre></div> <h4 id=示例-2>示例 2<a class=headerlink href=#示例-2 title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><a id=__codelineno-48-1 name=__codelineno-48-1 href=#__codelineno-48-1></a><span class=ch>#!/usr/bin/env bash</span>
<a id=__codelineno-48-2 name=__codelineno-48-2 href=#__codelineno-48-2></a><span class=c1>#usage:xxx</span>
<a id=__codelineno-48-3 name=__codelineno-48-3 href=#__codelineno-48-3></a><span class=c1>#scripts_name:xxx.sh</span>
<a id=__codelineno-48-4 name=__codelineno-48-4 href=#__codelineno-48-4></a>
<a id=__codelineno-48-5 name=__codelineno-48-5 href=#__codelineno-48-5></a><span class=nv>thread</span><span class=o>=</span><span class=m>5</span>
<a id=__codelineno-48-6 name=__codelineno-48-6 href=#__codelineno-48-6></a><span class=nv>tmp_fifofile</span><span class=o>=</span>/tmp/<span class=nv>$$</span>.fifo
<a id=__codelineno-48-7 name=__codelineno-48-7 href=#__codelineno-48-7></a>
<a id=__codelineno-48-8 name=__codelineno-48-8 href=#__codelineno-48-8></a>mkfifo<span class=w> </span><span class=nv>$tmp_fifofile</span>
<a id=__codelineno-48-9 name=__codelineno-48-9 href=#__codelineno-48-9></a><span class=nb>exec</span><span class=w> </span><span class=m>8</span>&lt;&gt;<span class=w> </span><span class=nv>$tmp_fifofile</span>
<a id=__codelineno-48-10 name=__codelineno-48-10 href=#__codelineno-48-10></a>rm<span class=w> </span><span class=nv>$tmp_fifofile</span>
<a id=__codelineno-48-11 name=__codelineno-48-11 href=#__codelineno-48-11></a>
<a id=__codelineno-48-12 name=__codelineno-48-12 href=#__codelineno-48-12></a><span class=k>for</span><span class=w> </span>i<span class=w> </span><span class=k>in</span><span class=w> </span><span class=sb>`</span>seq<span class=w> </span><span class=nv>$thread</span><span class=sb>`</span>
<a id=__codelineno-48-13 name=__codelineno-48-13 href=#__codelineno-48-13></a><span class=k>do</span>
<a id=__codelineno-48-14 name=__codelineno-48-14 href=#__codelineno-48-14></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=nv>$i</span><span class=w> </span><span class=p>&amp;</span>&gt;<span class=w> </span><span class=m>8</span>
<a id=__codelineno-48-15 name=__codelineno-48-15 href=#__codelineno-48-15></a><span class=k>done</span>
<a id=__codelineno-48-16 name=__codelineno-48-16 href=#__codelineno-48-16></a>
<a id=__codelineno-48-17 name=__codelineno-48-17 href=#__codelineno-48-17></a><span class=k>for</span><span class=w> </span>i<span class=w> </span><span class=k>in</span><span class=w> </span><span class=o>{</span><span class=m>1</span>..245<span class=o>}</span>
<a id=__codelineno-48-18 name=__codelineno-48-18 href=#__codelineno-48-18></a><span class=k>do</span>
<a id=__codelineno-48-19 name=__codelineno-48-19 href=#__codelineno-48-19></a><span class=w>    </span><span class=nb>read</span><span class=w> </span>-u8
<a id=__codelineno-48-20 name=__codelineno-48-20 href=#__codelineno-48-20></a><span class=w>    </span><span class=o>{</span>
<a id=__codelineno-48-21 name=__codelineno-48-21 href=#__codelineno-48-21></a><span class=w>        </span><span class=nv>ip</span><span class=o>=</span><span class=m>192</span>.168.122.<span class=nv>$i</span>
<a id=__codelineno-48-22 name=__codelineno-48-22 href=#__codelineno-48-22></a><span class=w>        </span>ping<span class=w> </span>-c1<span class=w> </span>-W1<span class=w> </span><span class=nv>$ip</span><span class=w> </span><span class=p>&amp;</span>&gt;/dev/null
<a id=__codelineno-48-23 name=__codelineno-48-23 href=#__codelineno-48-23></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=nv>$?</span><span class=w> </span>-eq<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=k>then</span>
<a id=__codelineno-48-24 name=__codelineno-48-24 href=#__codelineno-48-24></a><span class=w>            </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$ip</span><span class=s2> is down!&quot;</span>
<a id=__codelineno-48-25 name=__codelineno-48-25 href=#__codelineno-48-25></a><span class=w>        </span><span class=k>else</span>
<a id=__codelineno-48-26 name=__codelineno-48-26 href=#__codelineno-48-26></a><span class=w>            </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$ip</span><span class=s2> is up&quot;</span>
<a id=__codelineno-48-27 name=__codelineno-48-27 href=#__codelineno-48-27></a><span class=w>        </span><span class=k>fi</span>
<a id=__codelineno-48-28 name=__codelineno-48-28 href=#__codelineno-48-28></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=nv>$i</span><span class=w> </span>&gt;<span class=p>&amp;</span><span class=w> </span><span class=m>8</span>
<a id=__codelineno-48-29 name=__codelineno-48-29 href=#__codelineno-48-29></a><span class=w>    </span><span class=o>}</span><span class=p>&amp;</span>
<a id=__codelineno-48-30 name=__codelineno-48-30 href=#__codelineno-48-30></a><span class=k>done</span>
<a id=__codelineno-48-31 name=__codelineno-48-31 href=#__codelineno-48-31></a><span class=nb>wait</span>
<a id=__codelineno-48-32 name=__codelineno-48-32 href=#__codelineno-48-32></a><span class=nb>exec</span><span class=w> </span><span class=m>8</span><span class=w> </span>&lt;<span class=p>&amp;</span>-
<a id=__codelineno-48-33 name=__codelineno-48-33 href=#__codelineno-48-33></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;all finished......&quot;</span>
</code></pre></div> <h4 id=示例-3>示例 3<a class=headerlink href=#示例-3 title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><a id=__codelineno-49-1 name=__codelineno-49-1 href=#__codelineno-49-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-49-2 name=__codelineno-49-2 href=#__codelineno-49-2></a>date
<a id=__codelineno-49-3 name=__codelineno-49-3 href=#__codelineno-49-3></a>
<a id=__codelineno-49-4 name=__codelineno-49-4 href=#__codelineno-49-4></a><span class=nv>DIR</span><span class=o>=</span>/test/log/
<a id=__codelineno-49-5 name=__codelineno-49-5 href=#__codelineno-49-5></a>
<a id=__codelineno-49-6 name=__codelineno-49-6 href=#__codelineno-49-6></a><span class=nv>FILE_NAME</span><span class=o>=</span>65535_<span class=sb>`</span>date<span class=w> </span>+<span class=s2>&quot;%Y%m%d&quot;</span><span class=sb>`</span><span class=p>;</span>
<a id=__codelineno-49-7 name=__codelineno-49-7 href=#__codelineno-49-7></a><span class=nv>FILE_NAME_LAST_DAY</span><span class=o>=</span><span class=sb>`</span>date<span class=w> </span>-d<span class=w> </span><span class=s2>&quot;yesterday&quot;</span><span class=w> </span>+<span class=s2>&quot;%Y%m%d&quot;</span><span class=sb>`</span><span class=p>;</span>
<a id=__codelineno-49-8 name=__codelineno-49-8 href=#__codelineno-49-8></a>
<a id=__codelineno-49-9 name=__codelineno-49-9 href=#__codelineno-49-9></a><span class=nv>time_of_system</span><span class=o>=</span><span class=sb>`</span>date<span class=w> </span>+<span class=s2>&quot;%Y-%m-%d&quot;</span><span class=sb>`</span>
<a id=__codelineno-49-10 name=__codelineno-49-10 href=#__codelineno-49-10></a>
<a id=__codelineno-49-11 name=__codelineno-49-11 href=#__codelineno-49-11></a><span class=k>function</span><span class=w> </span>multi_processor<span class=o>(){</span>
<a id=__codelineno-49-12 name=__codelineno-49-12 href=#__codelineno-49-12></a><span class=w>    </span><span class=o>[</span><span class=w> </span>-e<span class=w> </span>/tmp/fd1<span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>||</span><span class=w> </span>mkfifo<span class=w> </span>/tmp/fd1
<a id=__codelineno-49-13 name=__codelineno-49-13 href=#__codelineno-49-13></a><span class=w>    </span><span class=nb>exec</span><span class=w> </span><span class=m>3</span>&lt;&gt;/tmp/fd1
<a id=__codelineno-49-14 name=__codelineno-49-14 href=#__codelineno-49-14></a><span class=w>    </span>rm<span class=w> </span>-rf<span class=w> </span>/tmp/fd1
<a id=__codelineno-49-15 name=__codelineno-49-15 href=#__codelineno-49-15></a><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=o>((</span><span class=nv>i</span><span class=o>=</span><span class=m>1</span><span class=p>;</span>i&lt;<span class=o>=</span><span class=m>30</span><span class=p>;</span>i++<span class=o>))</span>
<a id=__codelineno-49-16 name=__codelineno-49-16 href=#__codelineno-49-16></a><span class=w>    </span><span class=k>do</span>
<a id=__codelineno-49-17 name=__codelineno-49-17 href=#__codelineno-49-17></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span>&gt;<span class=p>&amp;</span><span class=m>3</span>
<a id=__codelineno-49-18 name=__codelineno-49-18 href=#__codelineno-49-18></a><span class=w>    </span><span class=k>done</span>
<a id=__codelineno-49-19 name=__codelineno-49-19 href=#__codelineno-49-19></a>
<a id=__codelineno-49-20 name=__codelineno-49-20 href=#__codelineno-49-20></a><span class=w>    </span><span class=k>for</span><span class=w> </span>file<span class=w> </span><span class=k>in</span><span class=w> </span><span class=nv>$1</span>
<a id=__codelineno-49-21 name=__codelineno-49-21 href=#__codelineno-49-21></a><span class=w>    </span><span class=k>do</span>
<a id=__codelineno-49-22 name=__codelineno-49-22 href=#__codelineno-49-22></a><span class=w>    </span><span class=nb>read</span><span class=w> </span>-u3
<a id=__codelineno-49-23 name=__codelineno-49-23 href=#__codelineno-49-23></a><span class=w>    </span><span class=o>{</span>
<a id=__codelineno-49-24 name=__codelineno-49-24 href=#__codelineno-49-24></a><span class=w>        </span>grep<span class=w> </span><span class=nv>$3</span><span class=w> </span><span class=nv>$file</span><span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span>-F<span class=s2>&quot;|&quot;</span><span class=w> </span><span class=s1>&#39;{print $7}&#39;</span><span class=w> </span><span class=p>|</span><span class=w> </span>sort<span class=w> </span><span class=p>|</span><span class=w> </span>uniq<span class=w> </span>&gt;&gt;<span class=w> </span><span class=nv>$2</span><span class=p>;</span>
<a id=__codelineno-49-25 name=__codelineno-49-25 href=#__codelineno-49-25></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span>&gt;<span class=p>&amp;</span><span class=m>3</span>
<a id=__codelineno-49-26 name=__codelineno-49-26 href=#__codelineno-49-26></a><span class=w>    </span><span class=o>}</span><span class=p>&amp;</span>
<a id=__codelineno-49-27 name=__codelineno-49-27 href=#__codelineno-49-27></a><span class=w>    </span><span class=k>done</span>
<a id=__codelineno-49-28 name=__codelineno-49-28 href=#__codelineno-49-28></a><span class=w>    </span><span class=nb>wait</span>
<a id=__codelineno-49-29 name=__codelineno-49-29 href=#__codelineno-49-29></a>
<a id=__codelineno-49-30 name=__codelineno-49-30 href=#__codelineno-49-30></a><span class=w>    </span><span class=nb>exec</span><span class=w> </span><span class=m>3</span>&lt;<span class=p>&amp;</span>-
<a id=__codelineno-49-31 name=__codelineno-49-31 href=#__codelineno-49-31></a><span class=w>    </span><span class=nb>exec</span><span class=w> </span><span class=m>3</span>&gt;<span class=p>&amp;</span>-
<a id=__codelineno-49-32 name=__codelineno-49-32 href=#__codelineno-49-32></a><span class=o>}</span>
<a id=__codelineno-49-33 name=__codelineno-49-33 href=#__codelineno-49-33></a>
<a id=__codelineno-49-34 name=__codelineno-49-34 href=#__codelineno-49-34></a><span class=c1>#register 1 day ago</span>
<a id=__codelineno-49-35 name=__codelineno-49-35 href=#__codelineno-49-35></a><span class=nv>register_file</span><span class=o>=</span>register_file_1_day_ago_<span class=nv>$HOSTNAME</span>.txt
<a id=__codelineno-49-36 name=__codelineno-49-36 href=#__codelineno-49-36></a><span class=nv>file_modify_time</span><span class=o>=</span><span class=sb>`</span>stat<span class=w> </span><span class=nv>$register_file</span><span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>Modify<span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span><span class=s1>&#39;{print $2}&#39;</span><span class=sb>`</span>
<a id=__codelineno-49-37 name=__codelineno-49-37 href=#__codelineno-49-37></a><span class=nv>files_last_day</span><span class=o>=</span><span class=sb>`</span>find<span class=w> </span><span class=nv>$DIR</span><span class=w> </span>-type<span class=w> </span>f<span class=w> </span>-name<span class=w> </span><span class=s2>&quot;</span><span class=nv>$FILE_NAME_LAST_DAY</span><span class=s2>*&quot;</span><span class=sb>`</span>
<a id=__codelineno-49-38 name=__codelineno-49-38 href=#__codelineno-49-38></a><span class=k>if</span><span class=w> </span><span class=o>[[</span><span class=w> </span><span class=nv>$file_modify_time</span><span class=w> </span>!<span class=o>=</span><span class=w> </span><span class=nv>$time_of_system</span><span class=w> </span><span class=o>]]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-49-39 name=__codelineno-49-39 href=#__codelineno-49-39></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$register_file</span><span class=s2> file_modify_time(</span><span class=si>${</span><span class=nv>file_modify_time</span><span class=si>}</span><span class=s2>) time_of_system(</span><span class=si>${</span><span class=nv>time_of_system</span><span class=si>}</span><span class=s2>)&quot;</span>
<a id=__codelineno-49-40 name=__codelineno-49-40 href=#__codelineno-49-40></a><span class=w>    </span>rm<span class=w> </span><span class=nv>$register_file</span>
<a id=__codelineno-49-41 name=__codelineno-49-41 href=#__codelineno-49-41></a><span class=w>    </span>multi_processor<span class=w> </span><span class=s2>&quot;</span><span class=nv>$files_last_day</span><span class=s2>&quot;</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$register_file</span><span class=s2>&quot;</span><span class=w> </span><span class=s2>&quot;REGISTER&quot;</span>
<a id=__codelineno-49-42 name=__codelineno-49-42 href=#__codelineno-49-42></a><span class=k>fi</span>
</code></pre></div> <h4 id=示例-4>示例 4<a class=headerlink href=#示例-4 title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><a id=__codelineno-50-1 name=__codelineno-50-1 href=#__codelineno-50-1></a><span class=ch>#!/usr/bin/env bash</span>
<a id=__codelineno-50-2 name=__codelineno-50-2 href=#__codelineno-50-2></a><span class=c1>#usage:xxx</span>
<a id=__codelineno-50-3 name=__codelineno-50-3 href=#__codelineno-50-3></a><span class=c1>#scripts_name:xxx.sh</span>
<a id=__codelineno-50-4 name=__codelineno-50-4 href=#__codelineno-50-4></a><span class=c1># author：xiaojian</span>
<a id=__codelineno-50-5 name=__codelineno-50-5 href=#__codelineno-50-5></a>
<a id=__codelineno-50-6 name=__codelineno-50-6 href=#__codelineno-50-6></a><span class=nv>Njob</span><span class=o>=</span><span class=m>15</span><span class=w> </span><span class=c1>#任务总数</span>
<a id=__codelineno-50-7 name=__codelineno-50-7 href=#__codelineno-50-7></a>
<a id=__codelineno-50-8 name=__codelineno-50-8 href=#__codelineno-50-8></a><span class=nv>Nproc</span><span class=o>=</span><span class=m>5</span><span class=w> </span><span class=c1>#最大并发进程数</span>
<a id=__codelineno-50-9 name=__codelineno-50-9 href=#__codelineno-50-9></a>
<a id=__codelineno-50-10 name=__codelineno-50-10 href=#__codelineno-50-10></a>mkfifo<span class=w> </span>./fifo.<span class=nv>$$</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nb>exec</span><span class=w> </span><span class=m>777</span>&lt;&gt;<span class=w> </span>./fifo.<span class=nv>$$</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>rm<span class=w> </span>-f<span class=w> </span>./fifo.<span class=nv>$$</span><span class=w> </span><span class=c1>#通过文件描述符777访问fifo文件</span>
<a id=__codelineno-50-11 name=__codelineno-50-11 href=#__codelineno-50-11></a>
<a id=__codelineno-50-12 name=__codelineno-50-12 href=#__codelineno-50-12></a><span class=k>for</span><span class=w> </span><span class=o>((</span><span class=nv>i</span><span class=o>=</span><span class=m>0</span><span class=p>;</span><span class=w> </span>i&lt;<span class=nv>$Nproc</span><span class=p>;</span><span class=w> </span>i++<span class=o>))</span><span class=p>;</span><span class=w> </span><span class=k>do</span><span class=w> </span><span class=c1>#向fifo文件先填充等于Nproc值的行数</span>
<a id=__codelineno-50-13 name=__codelineno-50-13 href=#__codelineno-50-13></a>
<a id=__codelineno-50-14 name=__codelineno-50-14 href=#__codelineno-50-14></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;init time add </span><span class=nv>$i</span><span class=s2>&quot;</span><span class=w> </span>&gt;<span class=p>&amp;</span><span class=m>777</span>
<a id=__codelineno-50-15 name=__codelineno-50-15 href=#__codelineno-50-15></a>
<a id=__codelineno-50-16 name=__codelineno-50-16 href=#__codelineno-50-16></a><span class=k>done</span>
<a id=__codelineno-50-17 name=__codelineno-50-17 href=#__codelineno-50-17></a>
<a id=__codelineno-50-18 name=__codelineno-50-18 href=#__codelineno-50-18></a><span class=k>for</span><span class=w> </span><span class=o>((</span><span class=nv>i</span><span class=o>=</span><span class=m>0</span><span class=p>;</span><span class=w> </span>i&lt;<span class=nv>$Njob</span><span class=p>;</span><span class=w> </span>i++<span class=o>))</span><span class=p>;</span><span class=w> </span><span class=k>do</span>
<a id=__codelineno-50-19 name=__codelineno-50-19 href=#__codelineno-50-19></a>
<a id=__codelineno-50-20 name=__codelineno-50-20 href=#__codelineno-50-20></a><span class=w>        </span><span class=o>{</span>
<a id=__codelineno-50-21 name=__codelineno-50-21 href=#__codelineno-50-21></a>
<a id=__codelineno-50-22 name=__codelineno-50-22 href=#__codelineno-50-22></a><span class=w>        </span><span class=nb>read</span><span class=w> </span>-u<span class=w> </span><span class=m>777</span><span class=w> </span><span class=c1>#从fifo文件读一行</span>
<a id=__codelineno-50-23 name=__codelineno-50-23 href=#__codelineno-50-23></a>
<a id=__codelineno-50-24 name=__codelineno-50-24 href=#__codelineno-50-24></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;progress </span><span class=nv>$i</span><span class=s2> is sleeping for 3 seconds zzz…&quot;</span>
<a id=__codelineno-50-25 name=__codelineno-50-25 href=#__codelineno-50-25></a>
<a id=__codelineno-50-26 name=__codelineno-50-26 href=#__codelineno-50-26></a><span class=w>        </span>sleep<span class=w> </span><span class=m>3</span>
<a id=__codelineno-50-27 name=__codelineno-50-27 href=#__codelineno-50-27></a>
<a id=__codelineno-50-28 name=__codelineno-50-28 href=#__codelineno-50-28></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;real time add </span><span class=k>$((</span><span class=nv>$i</span><span class=o>+</span><span class=nv>$Nproc</span><span class=k>))</span><span class=s2>&quot;</span><span class=w> </span>&gt;<span class=p>&amp;</span><span class=m>777</span><span class=w> </span><span class=c1>#sleep完成后，向fifo文件重新写入一行</span>
<a id=__codelineno-50-29 name=__codelineno-50-29 href=#__codelineno-50-29></a>
<a id=__codelineno-50-30 name=__codelineno-50-30 href=#__codelineno-50-30></a><span class=w>        </span><span class=o>}</span><span class=w> </span><span class=p>&amp;</span>
<a id=__codelineno-50-31 name=__codelineno-50-31 href=#__codelineno-50-31></a>
<a id=__codelineno-50-32 name=__codelineno-50-32 href=#__codelineno-50-32></a><span class=k>done</span>
<a id=__codelineno-50-33 name=__codelineno-50-33 href=#__codelineno-50-33></a>
<a id=__codelineno-50-34 name=__codelineno-50-34 href=#__codelineno-50-34></a><span class=nb>wait</span>
<a id=__codelineno-50-35 name=__codelineno-50-35 href=#__codelineno-50-35></a>
<a id=__codelineno-50-36 name=__codelineno-50-36 href=#__codelineno-50-36></a><span class=nb>exec</span><span class=w> </span><span class=m>777</span><span class=w> </span>&gt;<span class=p>&amp;</span>-
<a id=__codelineno-50-37 name=__codelineno-50-37 href=#__codelineno-50-37></a><span class=nb>exec</span><span class=w> </span><span class=m>777</span><span class=w> </span>&lt;<span class=p>&amp;</span>-
<a id=__codelineno-50-38 name=__codelineno-50-38 href=#__codelineno-50-38></a><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;time-consuming: </span><span class=nv>$SECONDS</span><span class=s2> seconds&quot;</span>
</code></pre></div> <h4 id=示例-5>示例 5<a class=headerlink href=#示例-5 title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><a id=__codelineno-51-1 name=__codelineno-51-1 href=#__codelineno-51-1></a><span class=ch>#!/usr/bin/env bash</span>
<a id=__codelineno-51-2 name=__codelineno-51-2 href=#__codelineno-51-2></a><span class=c1>#usage:xxx</span>
<a id=__codelineno-51-3 name=__codelineno-51-3 href=#__codelineno-51-3></a><span class=c1>#scripts_name:${NAME}.sh</span>
<a id=__codelineno-51-4 name=__codelineno-51-4 href=#__codelineno-51-4></a><span class=c1># author：xiaojian</span>
<a id=__codelineno-51-5 name=__codelineno-51-5 href=#__codelineno-51-5></a>
<a id=__codelineno-51-6 name=__codelineno-51-6 href=#__codelineno-51-6></a><span class=nv>CE_HOME</span><span class=o>=</span><span class=s2>&quot;/data/ContentEnginne&quot;</span>
<a id=__codelineno-51-7 name=__codelineno-51-7 href=#__codelineno-51-7></a><span class=nv>LOG_PATH</span><span class=o>=</span><span class=s2>&quot;/data/logs&quot;</span>
<a id=__codelineno-51-8 name=__codelineno-51-8 href=#__codelineno-51-8></a>
<a id=__codelineno-51-9 name=__codelineno-51-9 href=#__codelineno-51-9></a><span class=c1># 控制爬虫数量为8</span>
<a id=__codelineno-51-10 name=__codelineno-51-10 href=#__codelineno-51-10></a><span class=nv>MAX_SPIDER_COUNT</span><span class=o>=</span><span class=m>8</span>
<a id=__codelineno-51-11 name=__codelineno-51-11 href=#__codelineno-51-11></a>
<a id=__codelineno-51-12 name=__codelineno-51-12 href=#__codelineno-51-12></a><span class=nv>count</span><span class=o>=</span><span class=sb>`</span>ps<span class=w> </span>-ef<span class=p>|</span>grep<span class=w> </span>-v<span class=w> </span>grep<span class=p>|</span>grep<span class=w> </span>run.py<span class=p>|</span>wc<span class=w> </span>-l<span class=sb>`</span>
<a id=__codelineno-51-13 name=__codelineno-51-13 href=#__codelineno-51-13></a><span class=nv>try_time</span><span class=o>=</span><span class=m>0</span>
<a id=__codelineno-51-14 name=__codelineno-51-14 href=#__codelineno-51-14></a><span class=nb>cd</span><span class=w> </span><span class=nv>$CE_HOME</span>
<a id=__codelineno-51-15 name=__codelineno-51-15 href=#__codelineno-51-15></a><span class=k>while</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=nv>$count</span><span class=w> </span>-lt<span class=w> </span><span class=nv>$MAX_SPIDER_COUNT</span><span class=w> </span>-a<span class=w> </span><span class=nv>$try_time</span><span class=w> </span>-lt<span class=w> </span><span class=nv>$MAX_SPIDER_COUNT</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>do</span>
<a id=__codelineno-51-16 name=__codelineno-51-16 href=#__codelineno-51-16></a><span class=w>    </span><span class=nb>let</span><span class=w> </span><span class=nv>try_time</span><span class=w> </span><span class=o>+=</span><span class=m>1</span>
<a id=__codelineno-51-17 name=__codelineno-51-17 href=#__codelineno-51-17></a><span class=w>    </span>python<span class=w> </span>run.py<span class=w> </span>&gt;&gt;<span class=w> </span><span class=si>${</span><span class=nv>LOG_PATH</span><span class=si>}</span>/spider.log<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span><span class=w> </span><span class=p>&amp;</span>
<a id=__codelineno-51-18 name=__codelineno-51-18 href=#__codelineno-51-18></a><span class=w>    </span><span class=nv>count</span><span class=o>=</span><span class=sb>`</span>ps<span class=w> </span>-ef<span class=p>|</span>grep<span class=w> </span>-v<span class=w> </span>grep<span class=p>|</span>grep<span class=w> </span>run.py<span class=p>|</span>wc<span class=w> </span>-l<span class=sb>`</span>
<a id=__codelineno-51-19 name=__codelineno-51-19 href=#__codelineno-51-19></a><span class=k>done</span>
</code></pre></div> <h4 id=示例-6>示例 6<a class=headerlink href=#示例-6 title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><a id=__codelineno-52-1 name=__codelineno-52-1 href=#__codelineno-52-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-52-2 name=__codelineno-52-2 href=#__codelineno-52-2></a><span class=c1>#Version:3.0</span>
<a id=__codelineno-52-3 name=__codelineno-52-3 href=#__codelineno-52-3></a><span class=c1>#功能描述(Description):控制进程数量的ping测试脚本.</span>
<a id=__codelineno-52-4 name=__codelineno-52-4 href=#__codelineno-52-4></a><span class=c1>#使用wait命令等待所有子进程结束后再退出脚本.</span>
<a id=__codelineno-52-5 name=__codelineno-52-5 href=#__codelineno-52-5></a>
<a id=__codelineno-52-6 name=__codelineno-52-6 href=#__codelineno-52-6></a><span class=nv>num</span><span class=o>=</span><span class=m>10</span><span class=w>             </span><span class=c1>#控制进程数量.</span>
<a id=__codelineno-52-7 name=__codelineno-52-7 href=#__codelineno-52-7></a><span class=nv>net</span><span class=o>=</span><span class=s2>&quot;192.168.4&quot;</span>
<a id=__codelineno-52-8 name=__codelineno-52-8 href=#__codelineno-52-8></a><span class=nv>pipefile</span><span class=o>=</span><span class=s2>&quot;/tmp/multiping_</span><span class=nv>$$</span><span class=s2>.tmp&quot;</span>
<a id=__codelineno-52-9 name=__codelineno-52-9 href=#__codelineno-52-9></a>
<a id=__codelineno-52-10 name=__codelineno-52-10 href=#__codelineno-52-10></a>multi_ping<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-52-11 name=__codelineno-52-11 href=#__codelineno-52-11></a><span class=w>    </span>ping<span class=w> </span>-c2<span class=w> </span>-i0.2<span class=w> </span>-W1<span class=w> </span><span class=nv>$1</span><span class=w> </span><span class=p>&amp;</span>&gt;/dev/null<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2> is up.&quot;</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2> is down.&quot;</span>
<a id=__codelineno-52-12 name=__codelineno-52-12 href=#__codelineno-52-12></a><span class=o>}</span>
<a id=__codelineno-52-13 name=__codelineno-52-13 href=#__codelineno-52-13></a>
<a id=__codelineno-52-14 name=__codelineno-52-14 href=#__codelineno-52-14></a><span class=c1>#创建命名管道文件,创建其文件描述符,通过重定向导入数据到管道文件中.</span>
<a id=__codelineno-52-15 name=__codelineno-52-15 href=#__codelineno-52-15></a>mkfifo<span class=w> </span><span class=nv>$pipefile</span>
<a id=__codelineno-52-16 name=__codelineno-52-16 href=#__codelineno-52-16></a><span class=nb>exec</span><span class=w> </span><span class=m>12</span>&lt;&gt;<span class=nv>$pipefile</span>
<a id=__codelineno-52-17 name=__codelineno-52-17 href=#__codelineno-52-17></a><span class=k>for</span><span class=w> </span>i<span class=w> </span><span class=k>in</span><span class=w> </span><span class=k>$(</span>seq<span class=w> </span><span class=nv>$num</span><span class=k>)</span>
<a id=__codelineno-52-18 name=__codelineno-52-18 href=#__codelineno-52-18></a><span class=k>do</span>
<a id=__codelineno-52-19 name=__codelineno-52-19 href=#__codelineno-52-19></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;&quot;</span><span class=w> </span>&gt;<span class=p>&amp;</span><span class=m>12</span><span class=w> </span><span class=p>&amp;</span>
<a id=__codelineno-52-20 name=__codelineno-52-20 href=#__codelineno-52-20></a><span class=k>done</span>
<a id=__codelineno-52-21 name=__codelineno-52-21 href=#__codelineno-52-21></a>
<a id=__codelineno-52-22 name=__codelineno-52-22 href=#__codelineno-52-22></a><span class=c1>#通过循环反复调用函数并将其放入后台并行执行.</span>
<a id=__codelineno-52-23 name=__codelineno-52-23 href=#__codelineno-52-23></a><span class=c1>#成功读取命名管道中的数据后开启新的进程.</span>
<a id=__codelineno-52-24 name=__codelineno-52-24 href=#__codelineno-52-24></a><span class=c1>#所有内容读取完后read被阻塞,无法再启动新进程.</span>
<a id=__codelineno-52-25 name=__codelineno-52-25 href=#__codelineno-52-25></a><span class=c1>#等待前面启动的进程结束后,继续往管道文件中写入数据,释放阻塞,再次开启新的进程.</span>
<a id=__codelineno-52-26 name=__codelineno-52-26 href=#__codelineno-52-26></a><span class=k>for</span><span class=w> </span>j<span class=w> </span><span class=k>in</span><span class=w> </span><span class=o>{</span><span class=m>1</span>..254<span class=o>}</span>
<a id=__codelineno-52-27 name=__codelineno-52-27 href=#__codelineno-52-27></a><span class=k>do</span>
<a id=__codelineno-52-28 name=__codelineno-52-28 href=#__codelineno-52-28></a><span class=w>    </span><span class=nb>read</span><span class=w> </span>-u12
<a id=__codelineno-52-29 name=__codelineno-52-29 href=#__codelineno-52-29></a><span class=w>    </span><span class=o>{</span>
<a id=__codelineno-52-30 name=__codelineno-52-30 href=#__codelineno-52-30></a><span class=w>        </span>multi_ping<span class=w> </span><span class=nv>$net</span>.<span class=nv>$j</span>
<a id=__codelineno-52-31 name=__codelineno-52-31 href=#__codelineno-52-31></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;&quot;</span><span class=w> </span>&gt;<span class=p>&amp;</span><span class=m>12</span>
<a id=__codelineno-52-32 name=__codelineno-52-32 href=#__codelineno-52-32></a><span class=w>    </span><span class=o>}</span><span class=w> </span><span class=p>&amp;</span>
<a id=__codelineno-52-33 name=__codelineno-52-33 href=#__codelineno-52-33></a><span class=k>done</span>
<a id=__codelineno-52-34 name=__codelineno-52-34 href=#__codelineno-52-34></a><span class=nb>wait</span>
<a id=__codelineno-52-35 name=__codelineno-52-35 href=#__codelineno-52-35></a>rm<span class=w> </span>-rf<span class=w> </span><span class=nv>$pipfile</span>
</code></pre></div> <h2 id=28一些常用的函数>28.一些常用的函数<a class=headerlink href=#28一些常用的函数 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-53-1 name=__codelineno-53-1 href=#__codelineno-53-1></a><span class=c1>#判断是否是false</span>
<a id=__codelineno-53-2 name=__codelineno-53-2 href=#__codelineno-53-2></a>is_false<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-53-3 name=__codelineno-53-3 href=#__codelineno-53-3></a><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=k>in</span>
<a id=__codelineno-53-4 name=__codelineno-53-4 href=#__codelineno-53-4></a><span class=w>    </span><span class=o>[</span>fF<span class=o>]</span><span class=w> </span><span class=p>|</span><span class=w> </span><span class=o>[</span>nN<span class=o>]</span><span class=w> </span><span class=p>|</span><span class=w> </span><span class=o>[</span>nN<span class=o>][</span>oO<span class=o>]</span><span class=w> </span><span class=p>|</span><span class=w> </span><span class=o>[</span>fF<span class=o>][</span>aA<span class=o>][</span>lL<span class=o>][</span>sS<span class=o>][</span>eE<span class=o>]</span><span class=w> </span><span class=p>|</span><span class=w> </span><span class=m>0</span><span class=o>)</span>
<a id=__codelineno-53-5 name=__codelineno-53-5 href=#__codelineno-53-5></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-53-6 name=__codelineno-53-6 href=#__codelineno-53-6></a><span class=w>        </span><span class=p>;;</span>
<a id=__codelineno-53-7 name=__codelineno-53-7 href=#__codelineno-53-7></a><span class=w>    </span><span class=k>esac</span>
<a id=__codelineno-53-8 name=__codelineno-53-8 href=#__codelineno-53-8></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-53-9 name=__codelineno-53-9 href=#__codelineno-53-9></a><span class=o>}</span>
<a id=__codelineno-53-10 name=__codelineno-53-10 href=#__codelineno-53-10></a>
<a id=__codelineno-53-11 name=__codelineno-53-11 href=#__codelineno-53-11></a><span class=c1>#判断进程是否运行</span>
<a id=__codelineno-53-12 name=__codelineno-53-12 href=#__codelineno-53-12></a>is_running<span class=o>()</span>
<a id=__codelineno-53-13 name=__codelineno-53-13 href=#__codelineno-53-13></a><span class=o>{</span>
<a id=__codelineno-53-14 name=__codelineno-53-14 href=#__codelineno-53-14></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-f<span class=w> </span><span class=nv>$1</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-53-15 name=__codelineno-53-15 href=#__codelineno-53-15></a><span class=w>        </span><span class=nb>read</span><span class=w> </span>pid<span class=w> </span>&lt;<span class=w> </span><span class=nv>$1</span>
<a id=__codelineno-53-16 name=__codelineno-53-16 href=#__codelineno-53-16></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-d<span class=w> </span><span class=s2>&quot;/proc/</span><span class=nv>$pid</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-53-17 name=__codelineno-53-17 href=#__codelineno-53-17></a><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-53-18 name=__codelineno-53-18 href=#__codelineno-53-18></a><span class=w>        </span><span class=k>fi</span>
<a id=__codelineno-53-19 name=__codelineno-53-19 href=#__codelineno-53-19></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-53-20 name=__codelineno-53-20 href=#__codelineno-53-20></a><span class=w>    </span><span class=k>return</span><span class=w> </span>-1
<a id=__codelineno-53-21 name=__codelineno-53-21 href=#__codelineno-53-21></a><span class=o>}</span>
<a id=__codelineno-53-22 name=__codelineno-53-22 href=#__codelineno-53-22></a>
<a id=__codelineno-53-23 name=__codelineno-53-23 href=#__codelineno-53-23></a><span class=c1>#安装epel源</span>
<a id=__codelineno-53-24 name=__codelineno-53-24 href=#__codelineno-53-24></a><span class=k>function</span><span class=w> </span>_install_epel<span class=w> </span><span class=o>{</span>
<a id=__codelineno-53-25 name=__codelineno-53-25 href=#__codelineno-53-25></a><span class=w>    </span><span class=c1># NOTE: We always remove and install latest -- some environments</span>
<a id=__codelineno-53-26 name=__codelineno-53-26 href=#__codelineno-53-26></a><span class=w>    </span><span class=c1># use snapshot images, and if EPEL version updates they break</span>
<a id=__codelineno-53-27 name=__codelineno-53-27 href=#__codelineno-53-27></a><span class=w>    </span><span class=c1># unless we update them to latest version.</span>
<a id=__codelineno-53-28 name=__codelineno-53-28 href=#__codelineno-53-28></a><span class=w>    </span><span class=k>if</span><span class=w> </span>sudo<span class=w> </span>yum<span class=w> </span>repolist<span class=w> </span>enabled<span class=w> </span>epel<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>-q<span class=w> </span><span class=s1>&#39;epel&#39;</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-53-29 name=__codelineno-53-29 href=#__codelineno-53-29></a><span class=w>        </span>uninstall_package<span class=w> </span>epel-release<span class=w> </span><span class=o>||</span><span class=w> </span><span class=nb>true</span>
<a id=__codelineno-53-30 name=__codelineno-53-30 href=#__codelineno-53-30></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-53-31 name=__codelineno-53-31 href=#__codelineno-53-31></a>
<a id=__codelineno-53-32 name=__codelineno-53-32 href=#__codelineno-53-32></a><span class=w>    </span><span class=c1># This trick installs the latest epel-release from a bootstrap</span>
<a id=__codelineno-53-33 name=__codelineno-53-33 href=#__codelineno-53-33></a><span class=w>    </span><span class=c1># repo, then removes itself (as epel-release installed the</span>
<a id=__codelineno-53-34 name=__codelineno-53-34 href=#__codelineno-53-34></a><span class=w>    </span><span class=c1># &quot;real&quot; repo).</span>
<a id=__codelineno-53-35 name=__codelineno-53-35 href=#__codelineno-53-35></a><span class=w>    </span><span class=c1>#</span>
<a id=__codelineno-53-36 name=__codelineno-53-36 href=#__codelineno-53-36></a><span class=w>    </span><span class=c1># You would think that rather than this, you could use</span>
<a id=__codelineno-53-37 name=__codelineno-53-37 href=#__codelineno-53-37></a><span class=w>    </span><span class=c1># $releasever directly in .repo file we create below.  However</span>
<a id=__codelineno-53-38 name=__codelineno-53-38 href=#__codelineno-53-38></a><span class=w>    </span><span class=c1># RHEL gives a $releasever of &quot;6Server&quot; which breaks the path;</span>
<a id=__codelineno-53-39 name=__codelineno-53-39 href=#__codelineno-53-39></a><span class=w>    </span><span class=c1># see https://bugzilla.redhat.com/show_bug.cgi?id=1150759</span>
<a id=__codelineno-53-40 name=__codelineno-53-40 href=#__codelineno-53-40></a><span class=w>    </span>cat<span class=w> </span><span class=s>&lt;&lt;EOF | sudo tee /etc/yum.repos.d/epel-bootstrap.repo</span>
<a id=__codelineno-53-41 name=__codelineno-53-41 href=#__codelineno-53-41></a><span class=s>[epel-bootstrap]</span>
<a id=__codelineno-53-42 name=__codelineno-53-42 href=#__codelineno-53-42></a><span class=s>name=Bootstrap EPEL</span>
<a id=__codelineno-53-43 name=__codelineno-53-43 href=#__codelineno-53-43></a><span class=s>mirrorlist=http://mirrors.fedoraproject.org/mirrorlist?repo=epel-7&amp;arch=\$basearch</span>
<a id=__codelineno-53-44 name=__codelineno-53-44 href=#__codelineno-53-44></a><span class=s>failovermethod=priority</span>
<a id=__codelineno-53-45 name=__codelineno-53-45 href=#__codelineno-53-45></a><span class=s>enabled=0</span>
<a id=__codelineno-53-46 name=__codelineno-53-46 href=#__codelineno-53-46></a><span class=s>gpgcheck=0</span>
<a id=__codelineno-53-47 name=__codelineno-53-47 href=#__codelineno-53-47></a><span class=s>EOF</span>
<a id=__codelineno-53-48 name=__codelineno-53-48 href=#__codelineno-53-48></a><span class=w>    </span><span class=c1># Enable a bootstrap repo.  It is removed after finishing</span>
<a id=__codelineno-53-49 name=__codelineno-53-49 href=#__codelineno-53-49></a><span class=w>    </span><span class=c1># the epel-release installation.</span>
<a id=__codelineno-53-50 name=__codelineno-53-50 href=#__codelineno-53-50></a><span class=w>    </span>is_package_installed<span class=w> </span>yum-utils<span class=w> </span><span class=o>||</span><span class=w> </span>install_package<span class=w> </span>yum-utils
<a id=__codelineno-53-51 name=__codelineno-53-51 href=#__codelineno-53-51></a><span class=w>    </span>sudo<span class=w> </span>yum-config-manager<span class=w> </span>--enable<span class=w> </span>epel-bootstrap
<a id=__codelineno-53-52 name=__codelineno-53-52 href=#__codelineno-53-52></a><span class=w>    </span>yum_install<span class=w> </span>epel-release<span class=w> </span><span class=o>||</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-53-53 name=__codelineno-53-53 href=#__codelineno-53-53></a><span class=w>        </span>die<span class=w> </span><span class=nv>$LINENO</span><span class=w> </span><span class=s2>&quot;Error installing EPEL repo, cannot continue&quot;</span>
<a id=__codelineno-53-54 name=__codelineno-53-54 href=#__codelineno-53-54></a><span class=w>    </span>sudo<span class=w> </span>rm<span class=w> </span>-f<span class=w> </span>/etc/yum.repos.d/epel-bootstrap.repo
<a id=__codelineno-53-55 name=__codelineno-53-55 href=#__codelineno-53-55></a><span class=o>}</span>
<a id=__codelineno-53-56 name=__codelineno-53-56 href=#__codelineno-53-56></a>
<a id=__codelineno-53-57 name=__codelineno-53-57 href=#__codelineno-53-57></a><span class=c1>#记录日志的function</span>
<a id=__codelineno-53-58 name=__codelineno-53-58 href=#__codelineno-53-58></a><span class=k>function</span><span class=w> </span>fnLogInfo<span class=o>()</span>
<a id=__codelineno-53-59 name=__codelineno-53-59 href=#__codelineno-53-59></a><span class=o>{</span>
<a id=__codelineno-53-60 name=__codelineno-53-60 href=#__codelineno-53-60></a><span class=w>        </span><span class=nb>local</span><span class=w> </span><span class=nv>infomsg</span><span class=o>=</span><span class=nv>$1</span>
<a id=__codelineno-53-61 name=__codelineno-53-61 href=#__codelineno-53-61></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=si>${</span><span class=nv>infomsg</span><span class=si>}</span>
<a id=__codelineno-53-62 name=__codelineno-53-62 href=#__codelineno-53-62></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=sb>`</span>date<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>data_format</span><span class=si>}</span><span class=s2>&quot;</span><span class=sb>`</span><span class=w> </span><span class=s2>&quot;Info:</span><span class=si>${</span><span class=nv>infomsg</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span><span class=si>${</span><span class=nv>log_file</span><span class=si>}</span>
<a id=__codelineno-53-63 name=__codelineno-53-63 href=#__codelineno-53-63></a><span class=o>}</span>
<a id=__codelineno-53-64 name=__codelineno-53-64 href=#__codelineno-53-64></a>
<a id=__codelineno-53-65 name=__codelineno-53-65 href=#__codelineno-53-65></a>
<a id=__codelineno-53-66 name=__codelineno-53-66 href=#__codelineno-53-66></a><span class=c1>#备份文件的function</span>
<a id=__codelineno-53-67 name=__codelineno-53-67 href=#__codelineno-53-67></a>fnBackupBeforeModify<span class=o>()</span>
<a id=__codelineno-53-68 name=__codelineno-53-68 href=#__codelineno-53-68></a><span class=o>{</span>
<a id=__codelineno-53-69 name=__codelineno-53-69 href=#__codelineno-53-69></a><span class=w>        </span><span class=nb>local</span><span class=w> </span><span class=nv>file</span><span class=o>=</span><span class=nv>$1</span>
<a id=__codelineno-53-70 name=__codelineno-53-70 href=#__codelineno-53-70></a><span class=w>        </span><span class=nb>local</span><span class=w> </span><span class=nv>backupFile</span><span class=o>=</span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>file</span><span class=si>}</span><span class=s2>.bak&quot;</span>
<a id=__codelineno-53-71 name=__codelineno-53-71 href=#__codelineno-53-71></a>
<a id=__codelineno-53-72 name=__codelineno-53-72 href=#__codelineno-53-72></a><span class=w>        </span>fnLogInfo<span class=w> </span><span class=s2>&quot;Start to backup file </span><span class=nv>$file</span><span class=s2>&quot;</span>
<a id=__codelineno-53-73 name=__codelineno-53-73 href=#__codelineno-53-73></a>
<a id=__codelineno-53-74 name=__codelineno-53-74 href=#__codelineno-53-74></a><span class=w>        </span>cp<span class=w> </span><span class=si>${</span><span class=nv>file</span><span class=si>}</span><span class=w> </span>-p<span class=w> </span><span class=si>${</span><span class=nv>backupFile</span><span class=si>}</span>
<a id=__codelineno-53-75 name=__codelineno-53-75 href=#__codelineno-53-75></a>
<a id=__codelineno-53-76 name=__codelineno-53-76 href=#__codelineno-53-76></a><span class=w>        </span>fnLogInfo<span class=w> </span><span class=s2>&quot;End to backup file </span><span class=nv>$file</span><span class=s2>&quot;</span>
<a id=__codelineno-53-77 name=__codelineno-53-77 href=#__codelineno-53-77></a><span class=o>}</span>
<a id=__codelineno-53-78 name=__codelineno-53-78 href=#__codelineno-53-78></a>
<a id=__codelineno-53-79 name=__codelineno-53-79 href=#__codelineno-53-79></a><span class=c1># 1. change the network config as DHCP</span>
<a id=__codelineno-53-80 name=__codelineno-53-80 href=#__codelineno-53-80></a><span class=c1># 2. delete the 70-persistent-net.rules file</span>
<a id=__codelineno-53-81 name=__codelineno-53-81 href=#__codelineno-53-81></a>fnModifyNetworkConfig<span class=o>()</span>
<a id=__codelineno-53-82 name=__codelineno-53-82 href=#__codelineno-53-82></a><span class=o>{</span>
<a id=__codelineno-53-83 name=__codelineno-53-83 href=#__codelineno-53-83></a><span class=w>        </span>fnLogInfo<span class=w> </span><span class=s2>&quot;----------------------------------------&quot;</span>
<a id=__codelineno-53-84 name=__codelineno-53-84 href=#__codelineno-53-84></a><span class=w>        </span>fnLogInfo<span class=w> </span><span class=s2>&quot;Start to modify the network configuration&quot;</span>
<a id=__codelineno-53-85 name=__codelineno-53-85 href=#__codelineno-53-85></a>
<a id=__codelineno-53-86 name=__codelineno-53-86 href=#__codelineno-53-86></a><span class=w>        </span><span class=nb>local</span><span class=w> </span><span class=nv>files</span><span class=o>=</span><span class=s1>&#39;&#39;</span>
<a id=__codelineno-53-87 name=__codelineno-53-87 href=#__codelineno-53-87></a>
<a id=__codelineno-53-88 name=__codelineno-53-88 href=#__codelineno-53-88></a><span class=w>        </span><span class=c1>#1. change the network config as DHCP</span>
<a id=__codelineno-53-89 name=__codelineno-53-89 href=#__codelineno-53-89></a><span class=w>        </span><span class=k>case</span><span class=w> </span><span class=nv>$os_type</span><span class=w> </span><span class=k>in</span>
<a id=__codelineno-53-90 name=__codelineno-53-90 href=#__codelineno-53-90></a>
<a id=__codelineno-53-91 name=__codelineno-53-91 href=#__codelineno-53-91></a><span class=w>        </span><span class=c1>#/etc/sysconfig/network-scripts</span>
<a id=__codelineno-53-92 name=__codelineno-53-92 href=#__codelineno-53-92></a><span class=w>        </span><span class=s2>&quot;redhat&quot;</span><span class=o>)</span>
<a id=__codelineno-53-93 name=__codelineno-53-93 href=#__codelineno-53-93></a><span class=w>        </span><span class=nv>files</span><span class=o>=</span><span class=s2>&quot;`ls /etc/sysconfig/network-scripts/ifcfg-eth* |grep -v .bak`&quot;</span>
<a id=__codelineno-53-94 name=__codelineno-53-94 href=#__codelineno-53-94></a><span class=w>        </span><span class=nv>files</span><span class=o>=</span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>files</span><span class=si>}</span><span class=s2> `ls /etc/sysconfig/network-scripts/ifcfg-ens* |grep -v .bak`&quot;</span>
<a id=__codelineno-53-95 name=__codelineno-53-95 href=#__codelineno-53-95></a><span class=w>        </span><span class=k>for</span><span class=w> </span>file<span class=w> </span><span class=k>in</span><span class=w> </span><span class=nv>$files</span>
<a id=__codelineno-53-96 name=__codelineno-53-96 href=#__codelineno-53-96></a><span class=w>        </span><span class=k>do</span>
<a id=__codelineno-53-97 name=__codelineno-53-97 href=#__codelineno-53-97></a><span class=w>            </span>fnLogInfo<span class=w> </span><span class=s2>&quot;Start to modify the network configuration: </span><span class=nv>$file</span><span class=s2>&quot;</span>
<a id=__codelineno-53-98 name=__codelineno-53-98 href=#__codelineno-53-98></a><span class=w>            </span><span class=c1>#backup  the file</span>
<a id=__codelineno-53-99 name=__codelineno-53-99 href=#__codelineno-53-99></a><span class=w>            </span>fnBackupBeforeModify<span class=w> </span><span class=nv>$file</span>
<a id=__codelineno-53-100 name=__codelineno-53-100 href=#__codelineno-53-100></a><span class=w>            </span><span class=c1>#modify the file</span>
<a id=__codelineno-53-101 name=__codelineno-53-101 href=#__codelineno-53-101></a><span class=w>            </span>sed<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;/PERSISTENT_DHCLIENT/d&#39;</span><span class=w> </span><span class=nv>$file</span>
<a id=__codelineno-53-102 name=__codelineno-53-102 href=#__codelineno-53-102></a><span class=w>            </span>sed<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;$a\PERSISTENT_DHCLIENT=yes&#39;</span><span class=w> </span><span class=nv>$file</span>
<a id=__codelineno-53-103 name=__codelineno-53-103 href=#__codelineno-53-103></a><span class=w>            </span>fnLogInfo<span class=w> </span><span class=s2>&quot;End to modify the network configuration: </span><span class=nv>$file</span><span class=s2>&quot;</span>
<a id=__codelineno-53-104 name=__codelineno-53-104 href=#__codelineno-53-104></a><span class=w>        </span><span class=k>done</span>
<a id=__codelineno-53-105 name=__codelineno-53-105 href=#__codelineno-53-105></a><span class=w>        </span><span class=p>;;</span>
<a id=__codelineno-53-106 name=__codelineno-53-106 href=#__codelineno-53-106></a>
<a id=__codelineno-53-107 name=__codelineno-53-107 href=#__codelineno-53-107></a><span class=w>        </span><span class=c1>#/etc/sysconfig/network/dhcp</span>
<a id=__codelineno-53-108 name=__codelineno-53-108 href=#__codelineno-53-108></a><span class=w>        </span><span class=s2>&quot;suse&quot;</span><span class=o>)</span>
<a id=__codelineno-53-109 name=__codelineno-53-109 href=#__codelineno-53-109></a><span class=w>        </span><span class=nv>file</span><span class=o>=</span><span class=s1>&#39;/etc/sysconfig/network/dhcp&#39;</span>
<a id=__codelineno-53-110 name=__codelineno-53-110 href=#__codelineno-53-110></a>
<a id=__codelineno-53-111 name=__codelineno-53-111 href=#__codelineno-53-111></a><span class=w>        </span><span class=c1>#first backup file</span>
<a id=__codelineno-53-112 name=__codelineno-53-112 href=#__codelineno-53-112></a><span class=w>        </span>fnBackupBeforeModify<span class=w> </span><span class=nv>$file</span>
<a id=__codelineno-53-113 name=__codelineno-53-113 href=#__codelineno-53-113></a>
<a id=__codelineno-53-114 name=__codelineno-53-114 href=#__codelineno-53-114></a><span class=w>        </span>sed<span class=w> </span>-i<span class=w> </span><span class=s2>&quot;s/DHCLIENT_USE_LAST_LEASE=yes\|DHCLIENT_USE_LAST_LEASE=&#39;yes&#39;\|DHCLIENT_USE_LAST_LEASE=\&quot;yes\&quot;/DHCLIENT_USE_LAST_LEASE=\&quot;no\&quot;/g&quot;</span><span class=w> </span><span class=nv>$file</span>
<a id=__codelineno-53-115 name=__codelineno-53-115 href=#__codelineno-53-115></a><span class=w>        </span><span class=p>;;</span>
<a id=__codelineno-53-116 name=__codelineno-53-116 href=#__codelineno-53-116></a>
<a id=__codelineno-53-117 name=__codelineno-53-117 href=#__codelineno-53-117></a><span class=w>        </span><span class=c1>#/etc/network/interfaces</span>
<a id=__codelineno-53-118 name=__codelineno-53-118 href=#__codelineno-53-118></a><span class=w>        </span><span class=s2>&quot;debian&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span><span class=s2>&quot;ubuntu&quot;</span><span class=o>)</span>
<a id=__codelineno-53-119 name=__codelineno-53-119 href=#__codelineno-53-119></a><span class=w>        </span><span class=nv>file</span><span class=o>=</span><span class=s1>&#39;/etc/network/interfaces&#39;</span>
<a id=__codelineno-53-120 name=__codelineno-53-120 href=#__codelineno-53-120></a>
<a id=__codelineno-53-121 name=__codelineno-53-121 href=#__codelineno-53-121></a><span class=w>        </span><span class=c1>#backup the file</span>
<a id=__codelineno-53-122 name=__codelineno-53-122 href=#__codelineno-53-122></a><span class=w>        </span>fnBackupBeforeModify<span class=w> </span><span class=nv>$file</span>
<a id=__codelineno-53-123 name=__codelineno-53-123 href=#__codelineno-53-123></a>
<a id=__codelineno-53-124 name=__codelineno-53-124 href=#__codelineno-53-124></a><span class=w>        </span>sed<span class=w> </span>-i<span class=w> </span><span class=s2>&quot;s/static\| manual/ dhcp/g&quot;</span><span class=w> </span><span class=nv>$file</span>
<a id=__codelineno-53-125 name=__codelineno-53-125 href=#__codelineno-53-125></a><span class=w>        </span>sed<span class=w> </span>-i<span class=w> </span><span class=s2>&quot;s/address /#address /g&quot;</span><span class=w> </span><span class=nv>$file</span>
<a id=__codelineno-53-126 name=__codelineno-53-126 href=#__codelineno-53-126></a><span class=w>        </span>sed<span class=w> </span>-i<span class=w> </span><span class=s2>&quot;s/netmask /#netmask /g&quot;</span><span class=w> </span><span class=nv>$file</span>
<a id=__codelineno-53-127 name=__codelineno-53-127 href=#__codelineno-53-127></a><span class=w>        </span>sed<span class=w> </span>-i<span class=w> </span><span class=s2>&quot;s/gateway /#gateway /g&quot;</span><span class=w> </span><span class=nv>$file</span>
<a id=__codelineno-53-128 name=__codelineno-53-128 href=#__codelineno-53-128></a>
<a id=__codelineno-53-129 name=__codelineno-53-129 href=#__codelineno-53-129></a><span class=w>        </span><span class=p>;;</span>
<a id=__codelineno-53-130 name=__codelineno-53-130 href=#__codelineno-53-130></a>
<a id=__codelineno-53-131 name=__codelineno-53-131 href=#__codelineno-53-131></a><span class=w>        </span>*<span class=o>)</span>
<a id=__codelineno-53-132 name=__codelineno-53-132 href=#__codelineno-53-132></a><span class=w>        </span>fnLogInfo<span class=w> </span><span class=s2>&quot;Other Linux, network configuration cannot be modified.&quot;</span>
<a id=__codelineno-53-133 name=__codelineno-53-133 href=#__codelineno-53-133></a><span class=w>        </span><span class=p>;;</span>
<a id=__codelineno-53-134 name=__codelineno-53-134 href=#__codelineno-53-134></a><span class=w>        </span><span class=k>esac</span>
<a id=__codelineno-53-135 name=__codelineno-53-135 href=#__codelineno-53-135></a>
<a id=__codelineno-53-136 name=__codelineno-53-136 href=#__codelineno-53-136></a><span class=w>        </span><span class=c1>#2. delete the 70-persistent-net.rules file</span>
<a id=__codelineno-53-137 name=__codelineno-53-137 href=#__codelineno-53-137></a><span class=w>        </span>rm<span class=w> </span>-rf<span class=w> </span>/etc/udev/rules.d/70-persistent-net.rules
<a id=__codelineno-53-138 name=__codelineno-53-138 href=#__codelineno-53-138></a>
<a id=__codelineno-53-139 name=__codelineno-53-139 href=#__codelineno-53-139></a><span class=w>        </span>fnLogInfo<span class=w> </span><span class=s2>&quot;Delete 70-persistent-net.rules file, resut: </span><span class=nv>$?</span><span class=s2>&quot;</span>
<a id=__codelineno-53-140 name=__codelineno-53-140 href=#__codelineno-53-140></a>
<a id=__codelineno-53-141 name=__codelineno-53-141 href=#__codelineno-53-141></a><span class=w>        </span>fnLogInfo<span class=w> </span><span class=s2>&quot;End to modify the network configuration&quot;</span>
<a id=__codelineno-53-142 name=__codelineno-53-142 href=#__codelineno-53-142></a><span class=o>}</span>
<a id=__codelineno-53-143 name=__codelineno-53-143 href=#__codelineno-53-143></a><span class=c1>#check OS的function</span>
<a id=__codelineno-53-144 name=__codelineno-53-144 href=#__codelineno-53-144></a>fnGetOSType<span class=o>()</span>
<a id=__codelineno-53-145 name=__codelineno-53-145 href=#__codelineno-53-145></a><span class=o>{</span>
<a id=__codelineno-53-146 name=__codelineno-53-146 href=#__codelineno-53-146></a><span class=w>        </span>fnLogInfo<span class=w> </span><span class=s2>&quot;---------------------------&quot;</span>
<a id=__codelineno-53-147 name=__codelineno-53-147 href=#__codelineno-53-147></a><span class=w>        </span>fnLogInfo<span class=w> </span><span class=s2>&quot;Start to get the os type&quot;</span>
<a id=__codelineno-53-148 name=__codelineno-53-148 href=#__codelineno-53-148></a>
<a id=__codelineno-53-149 name=__codelineno-53-149 href=#__codelineno-53-149></a><span class=w>        </span><span class=nb>local</span><span class=w> </span><span class=nv>version</span><span class=o>=</span><span class=s2>&quot;/proc/version&quot;</span>
<a id=__codelineno-53-150 name=__codelineno-53-150 href=#__codelineno-53-150></a><span class=w>        </span><span class=k>if</span><span class=w> </span>!<span class=w> </span><span class=o>[</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>version</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=k>then</span>
<a id=__codelineno-53-151 name=__codelineno-53-151 href=#__codelineno-53-151></a><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-53-152 name=__codelineno-53-152 href=#__codelineno-53-152></a><span class=w>        </span><span class=k>elif</span><span class=w> </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=k>$(</span>grep<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;suse&#39;</span><span class=w> </span><span class=si>${</span><span class=nv>version</span><span class=si>}</span><span class=k>)</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=k>then</span>
<a id=__codelineno-53-153 name=__codelineno-53-153 href=#__codelineno-53-153></a><span class=w>            </span><span class=nv>os_type</span><span class=o>=</span><span class=s1>&#39;suse&#39;</span>
<a id=__codelineno-53-154 name=__codelineno-53-154 href=#__codelineno-53-154></a><span class=w>        </span><span class=k>elif</span><span class=w> </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=k>$(</span>grep<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;ubuntu&#39;</span><span class=w> </span><span class=si>${</span><span class=nv>version</span><span class=si>}</span><span class=k>)</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=k>then</span>
<a id=__codelineno-53-155 name=__codelineno-53-155 href=#__codelineno-53-155></a><span class=w>            </span><span class=nv>os_type</span><span class=o>=</span><span class=s1>&#39;ubuntu&#39;</span>
<a id=__codelineno-53-156 name=__codelineno-53-156 href=#__codelineno-53-156></a><span class=w>        </span><span class=k>elif</span><span class=w> </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=k>$(</span>grep<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;Red Hat&#39;</span><span class=w> </span><span class=si>${</span><span class=nv>version</span><span class=si>}</span><span class=k>)</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=k>then</span>
<a id=__codelineno-53-157 name=__codelineno-53-157 href=#__codelineno-53-157></a><span class=w>            </span><span class=nv>os_type</span><span class=o>=</span><span class=s1>&#39;redhat&#39;</span>
<a id=__codelineno-53-158 name=__codelineno-53-158 href=#__codelineno-53-158></a><span class=w>                </span><span class=k>elif</span><span class=w> </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=k>$(</span>grep<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;debian&#39;</span><span class=w> </span><span class=si>${</span><span class=nv>version</span><span class=si>}</span><span class=k>)</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=k>then</span>
<a id=__codelineno-53-159 name=__codelineno-53-159 href=#__codelineno-53-159></a><span class=w>            </span><span class=nv>os_type</span><span class=o>=</span><span class=s1>&#39;debian&#39;</span>
<a id=__codelineno-53-160 name=__codelineno-53-160 href=#__codelineno-53-160></a><span class=w>        </span><span class=k>fi</span>
<a id=__codelineno-53-161 name=__codelineno-53-161 href=#__codelineno-53-161></a>
<a id=__codelineno-53-162 name=__codelineno-53-162 href=#__codelineno-53-162></a>
<a id=__codelineno-53-163 name=__codelineno-53-163 href=#__codelineno-53-163></a><span class=w>        </span>fnLogInfo<span class=w> </span><span class=s2>&quot;End to get the os type: </span><span class=nv>$os_type</span><span class=s2>&quot;</span>
<a id=__codelineno-53-164 name=__codelineno-53-164 href=#__codelineno-53-164></a><span class=o>}</span>
<a id=__codelineno-53-165 name=__codelineno-53-165 href=#__codelineno-53-165></a>
<a id=__codelineno-53-166 name=__codelineno-53-166 href=#__codelineno-53-166></a><span class=c1>#输入选择Yes和No函数</span>
<a id=__codelineno-53-167 name=__codelineno-53-167 href=#__codelineno-53-167></a>YES_NO_choice<span class=o>(){</span>
<a id=__codelineno-53-168 name=__codelineno-53-168 href=#__codelineno-53-168></a><span class=nb>read</span><span class=w> </span>-t<span class=w> </span><span class=m>10</span><span class=w> </span>-p<span class=w> </span><span class=s2>&quot;Please input you commit ,wait 5.....to exit: &quot;</span><span class=w> </span>input
<a id=__codelineno-53-169 name=__codelineno-53-169 href=#__codelineno-53-169></a>
<a id=__codelineno-53-170 name=__codelineno-53-170 href=#__codelineno-53-170></a><span class=k>case</span><span class=w> </span><span class=nv>$input</span><span class=w> </span><span class=k>in</span>
<a id=__codelineno-53-171 name=__codelineno-53-171 href=#__codelineno-53-171></a><span class=w>    </span><span class=o>[</span>yY<span class=o>]</span><span class=p>|</span><span class=o>[</span>yY<span class=o>][</span>eE<span class=o>][</span>sS<span class=o>]</span><span class=w> </span><span class=o>)</span>
<a id=__codelineno-53-172 name=__codelineno-53-172 href=#__codelineno-53-172></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;YES!!!!!&quot;</span>
<a id=__codelineno-53-173 name=__codelineno-53-173 href=#__codelineno-53-173></a><span class=w>        </span><span class=p>;;</span>
<a id=__codelineno-53-174 name=__codelineno-53-174 href=#__codelineno-53-174></a><span class=w>    </span><span class=o>[</span>nN<span class=o>]</span><span class=p>|</span><span class=o>[</span>nN<span class=o>][</span>oO<span class=o>]</span><span class=w> </span><span class=o>)</span>
<a id=__codelineno-53-175 name=__codelineno-53-175 href=#__codelineno-53-175></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;NO  Error!!!!!&quot;</span>
<a id=__codelineno-53-176 name=__codelineno-53-176 href=#__codelineno-53-176></a><span class=w>        </span><span class=p>;;</span>
<a id=__codelineno-53-177 name=__codelineno-53-177 href=#__codelineno-53-177></a><span class=w>        </span>*<span class=o>)</span>
<a id=__codelineno-53-178 name=__codelineno-53-178 href=#__codelineno-53-178></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;============================&quot;</span>
<a id=__codelineno-53-179 name=__codelineno-53-179 href=#__codelineno-53-179></a><span class=w>        </span><span class=p>;;</span>
<a id=__codelineno-53-180 name=__codelineno-53-180 href=#__codelineno-53-180></a>
<a id=__codelineno-53-181 name=__codelineno-53-181 href=#__codelineno-53-181></a><span class=k>esac</span>
<a id=__codelineno-53-182 name=__codelineno-53-182 href=#__codelineno-53-182></a>
<a id=__codelineno-53-183 name=__codelineno-53-183 href=#__codelineno-53-183></a><span class=c1>#错误提示函数</span>
<a id=__codelineno-53-184 name=__codelineno-53-184 href=#__codelineno-53-184></a>die<span class=w> </span><span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-53-185 name=__codelineno-53-185 href=#__codelineno-53-185></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;ERROR: </span><span class=nv>$1</span><span class=s2>. Aborting!&quot;</span>
<a id=__codelineno-53-186 name=__codelineno-53-186 href=#__codelineno-53-186></a><span class=w>    </span><span class=nb>exit</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-53-187 name=__codelineno-53-187 href=#__codelineno-53-187></a><span class=o>}</span>
<a id=__codelineno-53-188 name=__codelineno-53-188 href=#__codelineno-53-188></a>
<a id=__codelineno-53-189 name=__codelineno-53-189 href=#__codelineno-53-189></a><span class=c1>#判断用户输入如果没有输入，选择默认值 redis为例</span>
<a id=__codelineno-53-190 name=__codelineno-53-190 href=#__codelineno-53-190></a><span class=nv>_REDIS_PORT</span><span class=o>=</span><span class=m>6379</span>
<a id=__codelineno-53-191 name=__codelineno-53-191 href=#__codelineno-53-191></a><span class=nv>_MANUAL_EXECUTION</span><span class=o>=</span><span class=nb>false</span><span class=w>     </span><span class=c1>#标志信息</span>
<a id=__codelineno-53-192 name=__codelineno-53-192 href=#__codelineno-53-192></a>check_input_redis_port<span class=o>(){</span>
<a id=__codelineno-53-193 name=__codelineno-53-193 href=#__codelineno-53-193></a><span class=k>if</span><span class=w> </span>!<span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=nv>$REDIS_PORT</span><span class=w> </span><span class=p>|</span><span class=w> </span>egrep<span class=w> </span>-q<span class=w> </span><span class=s1>&#39;^[0-9]+$&#39;</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-53-194 name=__codelineno-53-194 href=#__codelineno-53-194></a><span class=w>    </span><span class=nv>_MANUAL_EXECUTION</span><span class=o>=</span><span class=nb>true</span><span class=w>      </span><span class=c1>#重置标志信息</span>
<a id=__codelineno-53-195 name=__codelineno-53-195 href=#__codelineno-53-195></a><span class=w>    </span><span class=c1>#Read the redis port</span>
<a id=__codelineno-53-196 name=__codelineno-53-196 href=#__codelineno-53-196></a><span class=w>    </span><span class=nb>read</span><span class=w>  </span>-p<span class=w> </span><span class=s2>&quot;Please select the redis port for this instance: [</span><span class=nv>$_REDIS_PORT</span><span class=s2>] &quot;</span><span class=w> </span>REDIS_PORT
<a id=__codelineno-53-197 name=__codelineno-53-197 href=#__codelineno-53-197></a><span class=w>    </span><span class=k>if</span><span class=w> </span>!<span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=nv>$REDIS_PORT</span><span class=w> </span><span class=p>|</span><span class=w> </span>egrep<span class=w> </span>-q<span class=w> </span><span class=s1>&#39;^[0-9]+$&#39;</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-53-198 name=__codelineno-53-198 href=#__codelineno-53-198></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Selecting default: </span><span class=nv>$_REDIS_PORT</span><span class=s2>&quot;</span>
<a id=__codelineno-53-199 name=__codelineno-53-199 href=#__codelineno-53-199></a><span class=w>        </span><span class=nv>REDIS_PORT</span><span class=o>=</span><span class=nv>$_REDIS_PORT</span>
<a id=__codelineno-53-200 name=__codelineno-53-200 href=#__codelineno-53-200></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-53-201 name=__codelineno-53-201 href=#__codelineno-53-201></a><span class=k>fi</span>
<a id=__codelineno-53-202 name=__codelineno-53-202 href=#__codelineno-53-202></a><span class=o>}</span>
<a id=__codelineno-53-203 name=__codelineno-53-203 href=#__codelineno-53-203></a>
<a id=__codelineno-53-204 name=__codelineno-53-204 href=#__codelineno-53-204></a>
<a id=__codelineno-53-205 name=__codelineno-53-205 href=#__codelineno-53-205></a>Get_OS_Bit<span class=o>()</span>
<a id=__codelineno-53-206 name=__codelineno-53-206 href=#__codelineno-53-206></a><span class=o>{</span>
<a id=__codelineno-53-207 name=__codelineno-53-207 href=#__codelineno-53-207></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[[</span><span class=w> </span><span class=sb>`</span>getconf<span class=w> </span>WORD_BIT<span class=sb>`</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;32&#39;</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=sb>`</span>getconf<span class=w> </span>LONG_BIT<span class=sb>`</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;64&#39;</span><span class=w> </span><span class=o>]]</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-53-208 name=__codelineno-53-208 href=#__codelineno-53-208></a><span class=w>        </span><span class=nv>Is_64bit</span><span class=o>=</span><span class=s1>&#39;y&#39;</span>
<a id=__codelineno-53-209 name=__codelineno-53-209 href=#__codelineno-53-209></a><span class=w>    </span><span class=k>else</span>
<a id=__codelineno-53-210 name=__codelineno-53-210 href=#__codelineno-53-210></a><span class=w>        </span><span class=nv>Is_64bit</span><span class=o>=</span><span class=s1>&#39;n&#39;</span>
<a id=__codelineno-53-211 name=__codelineno-53-211 href=#__codelineno-53-211></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-53-212 name=__codelineno-53-212 href=#__codelineno-53-212></a><span class=o>}</span>
<a id=__codelineno-53-213 name=__codelineno-53-213 href=#__codelineno-53-213></a>
<a id=__codelineno-53-214 name=__codelineno-53-214 href=#__codelineno-53-214></a>
<a id=__codelineno-53-215 name=__codelineno-53-215 href=#__codelineno-53-215></a>Download_Files<span class=o>()</span>
<a id=__codelineno-53-216 name=__codelineno-53-216 href=#__codelineno-53-216></a><span class=o>{</span>
<a id=__codelineno-53-217 name=__codelineno-53-217 href=#__codelineno-53-217></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>URL</span><span class=o>=</span><span class=nv>$1</span>
<a id=__codelineno-53-218 name=__codelineno-53-218 href=#__codelineno-53-218></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>FileName</span><span class=o>=</span><span class=nv>$2</span>
<a id=__codelineno-53-219 name=__codelineno-53-219 href=#__codelineno-53-219></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-s<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>FileName</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-53-220 name=__codelineno-53-220 href=#__codelineno-53-220></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>FileName</span><span class=si>}</span><span class=s2> [found]&quot;</span>
<a id=__codelineno-53-221 name=__codelineno-53-221 href=#__codelineno-53-221></a><span class=w>    </span><span class=k>else</span>
<a id=__codelineno-53-222 name=__codelineno-53-222 href=#__codelineno-53-222></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Notice: </span><span class=si>${</span><span class=nv>FileName</span><span class=si>}</span><span class=s2> not found!!!download now...&quot;</span>
<a id=__codelineno-53-223 name=__codelineno-53-223 href=#__codelineno-53-223></a><span class=w>        </span>wget<span class=w> </span>-c<span class=w> </span>--progress<span class=o>=</span>bar:force<span class=w> </span>--prefer-family<span class=o>=</span>IPv4<span class=w> </span>--no-check-certificate<span class=w> </span><span class=si>${</span><span class=nv>URL</span><span class=si>}</span>
<a id=__codelineno-53-224 name=__codelineno-53-224 href=#__codelineno-53-224></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-53-225 name=__codelineno-53-225 href=#__codelineno-53-225></a><span class=o>}</span>
<a id=__codelineno-53-226 name=__codelineno-53-226 href=#__codelineno-53-226></a>
<a id=__codelineno-53-227 name=__codelineno-53-227 href=#__codelineno-53-227></a><span class=c1>#批量安装基础包</span>
<a id=__codelineno-53-228 name=__codelineno-53-228 href=#__codelineno-53-228></a>CentOS_Dependent<span class=o>()</span>
<a id=__codelineno-53-229 name=__codelineno-53-229 href=#__codelineno-53-229></a><span class=o>{</span>
<a id=__codelineno-53-230 name=__codelineno-53-230 href=#__codelineno-53-230></a><span class=w>    </span><span class=se>\c</span>p<span class=w> </span>/etc/yum.conf<span class=w> </span>/etc/yum.conf.lnmp
<a id=__codelineno-53-231 name=__codelineno-53-231 href=#__codelineno-53-231></a><span class=w>    </span>sed<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;s:exclude=.*:exclude=:g&#39;</span><span class=w> </span>/etc/yum.conf
<a id=__codelineno-53-232 name=__codelineno-53-232 href=#__codelineno-53-232></a>
<a id=__codelineno-53-233 name=__codelineno-53-233 href=#__codelineno-53-233></a><span class=w>    </span>Echo_Blue<span class=w> </span><span class=s2>&quot;[+] Yum installing dependent packages...&quot;</span>
<a id=__codelineno-53-234 name=__codelineno-53-234 href=#__codelineno-53-234></a><span class=w>    </span><span class=k>for</span><span class=w> </span>packages<span class=w> </span><span class=k>in</span><span class=w> </span>make<span class=w> </span>cmake<span class=w> </span>gcc<span class=w> </span>gcc-c++<span class=w> </span>gcc-g77<span class=w> </span>flex<span class=w> </span>bison<span class=w> </span>file<span class=w> </span>libtool<span class=w> </span>libtool-libs<span class=w> </span>autoconf<span class=w> </span>kernel-devel<span class=w> </span>patch<span class=w> </span>wget<span class=w> </span>crontabs<span class=w> </span>libjpeg<span class=w> </span>libjpeg-devel<span class=w> </span>libpng<span class=w> </span>libpng-devel<span class=w> </span>libpng10<span class=w> </span>libpng10-devel<span class=w> </span>gd<span class=w> </span>gd-devel<span class=w> </span>libxml2<span class=w> </span>libxml2-devel<span class=w> </span>zlib<span class=w> </span>zlib-devel<span class=w> </span>glib2<span class=w> </span>glib2-devel<span class=w> </span>unzip<span class=w> </span>tar<span class=w> </span>bzip2<span class=w> </span>bzip2-devel<span class=w> </span>libevent<span class=w> </span>libevent-devel<span class=w> </span>ncurses<span class=w> </span>ncurses-devel<span class=w> </span>curl<span class=w> </span>curl-devel<span class=w> </span>libcurl<span class=w> </span>libcurl-devel<span class=w> </span>e2fsprogs<span class=w> </span>e2fsprogs-devel<span class=w> </span>krb5<span class=w> </span>krb5-devel<span class=w> </span>libidn<span class=w> </span>libidn-devel<span class=w> </span>openssl<span class=w> </span>openssl-devel<span class=w> </span>vim-minimal<span class=w> </span>gettext<span class=w> </span>gettext-devel<span class=w> </span>ncurses-devel<span class=w> </span>gmp-devel<span class=w> </span>pspell-devel<span class=w> </span>unzip<span class=w> </span>libcap<span class=w> </span>diffutils<span class=w> </span>ca-certificates<span class=w> </span>net-tools<span class=w> </span>libc-client-devel<span class=w> </span>psmisc<span class=w> </span>libXpm-devel<span class=w> </span>git-core<span class=w> </span>c-ares-devel<span class=w> </span>libicu-devel<span class=w> </span>libxslt<span class=w> </span>libxslt-devel<span class=w> </span>xz<span class=p>;</span>
<a id=__codelineno-53-235 name=__codelineno-53-235 href=#__codelineno-53-235></a><span class=w>    </span><span class=k>do</span><span class=w> </span>yum<span class=w> </span>-y<span class=w> </span>install<span class=w> </span><span class=nv>$packages</span><span class=p>;</span><span class=w> </span><span class=k>done</span>
<a id=__codelineno-53-236 name=__codelineno-53-236 href=#__codelineno-53-236></a>
<a id=__codelineno-53-237 name=__codelineno-53-237 href=#__codelineno-53-237></a><span class=w>    </span>mv<span class=w> </span>-f<span class=w> </span>/etc/yum.conf.lnmp<span class=w> </span>/etc/yum.conf
<a id=__codelineno-53-238 name=__codelineno-53-238 href=#__codelineno-53-238></a><span class=o>}</span>
<a id=__codelineno-53-239 name=__codelineno-53-239 href=#__codelineno-53-239></a>
<a id=__codelineno-53-240 name=__codelineno-53-240 href=#__codelineno-53-240></a>
<a id=__codelineno-53-241 name=__codelineno-53-241 href=#__codelineno-53-241></a><span class=c1>#设置cron计划任务</span>
<a id=__codelineno-53-242 name=__codelineno-53-242 href=#__codelineno-53-242></a>Crontab_func<span class=o>(){</span>
<a id=__codelineno-53-243 name=__codelineno-53-243 href=#__codelineno-53-243></a><span class=c1>#!/bin/bash</span>
<a id=__codelineno-53-244 name=__codelineno-53-244 href=#__codelineno-53-244></a>cat<span class=w>  </span><span class=s>&lt;&lt;EOF &gt; /var/spool/cron/root</span>
<a id=__codelineno-53-245 name=__codelineno-53-245 href=#__codelineno-53-245></a><span class=s>*/30 * * * * sh /home/cheungssh/mysite/mysite/cheungssh/cheungssh_demo.sh 2&gt;&gt;/home/cheungssh/logs/demo.log  &gt;&gt; /home/cheungssh/logs/demo.log</span>
<a id=__codelineno-53-246 name=__codelineno-53-246 href=#__codelineno-53-246></a><span class=s>EOF</span>
<a id=__codelineno-53-247 name=__codelineno-53-247 href=#__codelineno-53-247></a><span class=o>}</span>
<a id=__codelineno-53-248 name=__codelineno-53-248 href=#__codelineno-53-248></a>
<a id=__codelineno-53-249 name=__codelineno-53-249 href=#__codelineno-53-249></a>
<a id=__codelineno-53-250 name=__codelineno-53-250 href=#__codelineno-53-250></a>
<a id=__codelineno-53-251 name=__codelineno-53-251 href=#__codelineno-53-251></a><span class=c1>#判断进程信息，杀掉进程</span>
<a id=__codelineno-53-252 name=__codelineno-53-252 href=#__codelineno-53-252></a>kill_Process<span class=o>(){</span>
<a id=__codelineno-53-253 name=__codelineno-53-253 href=#__codelineno-53-253></a>ps<span class=w> </span>-fel<span class=p>|</span>grep<span class=w> </span>websocket_server_cheung.py<span class=p>|</span>grep<span class=w>  </span>-v<span class=w> </span><span class=s2>&quot;</span><span class=nv>$$</span><span class=s2>&quot;</span><span class=p>|</span>awk<span class=w>  </span><span class=s1>&#39;{print  $4}&#39;</span><span class=p>|</span>xargs<span class=w> </span>-i<span class=w> </span><span class=nb>kill</span><span class=w>  </span>-9<span class=w> </span><span class=o>{}</span>
<a id=__codelineno-53-254 name=__codelineno-53-254 href=#__codelineno-53-254></a><span class=o>}</span>
<a id=__codelineno-53-255 name=__codelineno-53-255 href=#__codelineno-53-255></a>
<a id=__codelineno-53-256 name=__codelineno-53-256 href=#__codelineno-53-256></a><span class=c1>#获取MD5值</span>
<a id=__codelineno-53-257 name=__codelineno-53-257 href=#__codelineno-53-257></a>MD5_value<span class=o>(){</span>
<a id=__codelineno-53-258 name=__codelineno-53-258 href=#__codelineno-53-258></a>md5sum<span class=w> </span>/etc/hosts<span class=w> </span><span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;{print $1}&#39;</span>
<a id=__codelineno-53-259 name=__codelineno-53-259 href=#__codelineno-53-259></a>
<a id=__codelineno-53-260 name=__codelineno-53-260 href=#__codelineno-53-260></a><span class=o>}</span>
<a id=__codelineno-53-261 name=__codelineno-53-261 href=#__codelineno-53-261></a>
<a id=__codelineno-53-262 name=__codelineno-53-262 href=#__codelineno-53-262></a><span class=nv>data_format</span><span class=o>=</span><span class=s2>&quot;+%Y-%m-%d %H:%M:%S&quot;</span>
<a id=__codelineno-53-263 name=__codelineno-53-263 href=#__codelineno-53-263></a>
<a id=__codelineno-53-264 name=__codelineno-53-264 href=#__codelineno-53-264></a><span class=c1>#记录日志的function</span>
<a id=__codelineno-53-265 name=__codelineno-53-265 href=#__codelineno-53-265></a><span class=k>function</span><span class=w> </span>fnLogInfo<span class=o>()</span>
<a id=__codelineno-53-266 name=__codelineno-53-266 href=#__codelineno-53-266></a><span class=o>{</span>
<a id=__codelineno-53-267 name=__codelineno-53-267 href=#__codelineno-53-267></a><span class=w>        </span><span class=nb>local</span><span class=w> </span><span class=nv>infomsg</span><span class=o>=</span><span class=nv>$1</span>
<a id=__codelineno-53-268 name=__codelineno-53-268 href=#__codelineno-53-268></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=si>${</span><span class=nv>infomsg</span><span class=si>}</span>
<a id=__codelineno-53-269 name=__codelineno-53-269 href=#__codelineno-53-269></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=sb>`</span>date<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>data_format</span><span class=si>}</span><span class=s2>&quot;</span><span class=sb>`</span><span class=w> </span><span class=s2>&quot;Info:</span><span class=si>${</span><span class=nv>infomsg</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span><span class=si>${</span><span class=nv>log_file</span><span class=si>}</span>
<a id=__codelineno-53-270 name=__codelineno-53-270 href=#__codelineno-53-270></a><span class=o>}</span>
<a id=__codelineno-53-271 name=__codelineno-53-271 href=#__codelineno-53-271></a>
<a id=__codelineno-53-272 name=__codelineno-53-272 href=#__codelineno-53-272></a>
<a id=__codelineno-53-273 name=__codelineno-53-273 href=#__codelineno-53-273></a><span class=c1>#scritps path</span>
<a id=__codelineno-53-274 name=__codelineno-53-274 href=#__codelineno-53-274></a>dir_path<span class=o>(){</span>
<a id=__codelineno-53-275 name=__codelineno-53-275 href=#__codelineno-53-275></a><span class=nv>pwd</span><span class=o>=</span><span class=sb>`</span>dirname<span class=w> </span><span class=nv>$0</span><span class=sb>`</span>
<a id=__codelineno-53-276 name=__codelineno-53-276 href=#__codelineno-53-276></a><span class=o>}</span>
</code></pre></div> <h2 id=30猜随机数>30.猜随机数<a class=headerlink href=#30猜随机数 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-54-1 name=__codelineno-54-1 href=#__codelineno-54-1></a><span class=ch>#!/usr/bin/env bash</span>
<a id=__codelineno-54-2 name=__codelineno-54-2 href=#__codelineno-54-2></a><span class=c1>#usage:xxx</span>
<a id=__codelineno-54-3 name=__codelineno-54-3 href=#__codelineno-54-3></a><span class=c1>#scripts_name:xxx.sh</span>
<a id=__codelineno-54-4 name=__codelineno-54-4 href=#__codelineno-54-4></a><span class=c1>#取余的算法将随机数变为1-100之间</span>
<a id=__codelineno-54-5 name=__codelineno-54-5 href=#__codelineno-54-5></a><span class=nv>num</span><span class=o>=</span>$<span class=o>[</span>RANDOM%100+1<span class=o>]</span>
<a id=__codelineno-54-6 name=__codelineno-54-6 href=#__codelineno-54-6></a>
<a id=__codelineno-54-7 name=__codelineno-54-7 href=#__codelineno-54-7></a><span class=c1>#使用read捕获输入</span>
<a id=__codelineno-54-8 name=__codelineno-54-8 href=#__codelineno-54-8></a><span class=c1>#使用if判断</span>
<a id=__codelineno-54-9 name=__codelineno-54-9 href=#__codelineno-54-9></a><span class=k>while</span><span class=w> </span>True<span class=p>;</span><span class=w> </span><span class=k>do</span>
<a id=__codelineno-54-10 name=__codelineno-54-10 href=#__codelineno-54-10></a><span class=w>    </span><span class=nb>read</span><span class=w> </span>-p<span class=w> </span><span class=s2>&quot;计算生成的一个1-100的随机数：&quot;</span><span class=w> </span>cai
<a id=__codelineno-54-11 name=__codelineno-54-11 href=#__codelineno-54-11></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=nv>$cai</span><span class=w> </span>-eq<span class=w> </span><span class=nv>$num</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-54-12 name=__codelineno-54-12 href=#__codelineno-54-12></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;恭喜，猜对了&quot;</span>
<a id=__codelineno-54-13 name=__codelineno-54-13 href=#__codelineno-54-13></a><span class=w>    </span><span class=k>elif</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=nv>$cai</span><span class=w> </span>-gt<span class=w> </span><span class=nv>$num</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-54-14 name=__codelineno-54-14 href=#__codelineno-54-14></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;oops，猜大了&quot;</span>
<a id=__codelineno-54-15 name=__codelineno-54-15 href=#__codelineno-54-15></a><span class=w>    </span><span class=k>else</span>
<a id=__codelineno-54-16 name=__codelineno-54-16 href=#__codelineno-54-16></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;oops，猜小了&quot;</span>
<a id=__codelineno-54-17 name=__codelineno-54-17 href=#__codelineno-54-17></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-54-18 name=__codelineno-54-18 href=#__codelineno-54-18></a><span class=k>done</span>
</code></pre></div> <h2 id=31test-多种写法>31.test 多种写法<a class=headerlink href=#31test-多种写法 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-55-1 name=__codelineno-55-1 href=#__codelineno-55-1></a><span class=ch>#!/usr/bin/env bash</span>
<a id=__codelineno-55-2 name=__codelineno-55-2 href=#__codelineno-55-2></a><span class=nv>FreeMem</span><span class=o>=</span><span class=sb>`</span>free<span class=w> </span>-m<span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;NR==3 {print $NF}&#39;</span><span class=sb>`</span>
<a id=__codelineno-55-3 name=__codelineno-55-3 href=#__codelineno-55-3></a><span class=k>if</span><span class=w> </span><span class=o>((</span><span class=w> </span><span class=nv>$FreeMem</span><span class=w> </span>&lt;<span class=w> </span><span class=m>1000</span><span class=w> </span><span class=o>))</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-55-4 name=__codelineno-55-4 href=#__codelineno-55-4></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;xxxxxxxxxx&quot;</span>
<a id=__codelineno-55-5 name=__codelineno-55-5 href=#__codelineno-55-5></a><span class=k>fi</span>
<a id=__codelineno-55-6 name=__codelineno-55-6 href=#__codelineno-55-6></a>
<a id=__codelineno-55-7 name=__codelineno-55-7 href=#__codelineno-55-7></a><span class=k>if</span><span class=w> </span><span class=o>[[</span><span class=w> </span><span class=nv>$FreeMem</span><span class=w> </span>-lt<span class=w> </span><span class=m>1000</span><span class=w> </span><span class=o>]]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-55-8 name=__codelineno-55-8 href=#__codelineno-55-8></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;xxxxxxxx&quot;</span>
<a id=__codelineno-55-9 name=__codelineno-55-9 href=#__codelineno-55-9></a><span class=k>fi</span>
<a id=__codelineno-55-10 name=__codelineno-55-10 href=#__codelineno-55-10></a>
<a id=__codelineno-55-11 name=__codelineno-55-11 href=#__codelineno-55-11></a><span class=k>if</span><span class=w> </span><span class=nb>test</span><span class=w> </span><span class=nv>$FreeMem</span><span class=w> </span>-lt<span class=w> </span><span class=m>1000</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-55-12 name=__codelineno-55-12 href=#__codelineno-55-12></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;xxxxxxxxxxxx&quot;</span>
<a id=__codelineno-55-13 name=__codelineno-55-13 href=#__codelineno-55-13></a><span class=k>fi</span>
<a id=__codelineno-55-14 name=__codelineno-55-14 href=#__codelineno-55-14></a>
<a id=__codelineno-55-15 name=__codelineno-55-15 href=#__codelineno-55-15></a><span class=k>if</span><span class=w> </span>grep<span class=w>  </span>/etc/passwd<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-55-16 name=__codelineno-55-16 href=#__codelineno-55-16></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;xxxxxxxxxx&quot;</span>
<a id=__codelineno-55-17 name=__codelineno-55-17 href=#__codelineno-55-17></a><span class=k>fi</span>
</code></pre></div> <h2 id=32换算秒为分钟小时>32.换算秒为分钟、小时<a class=headerlink href=#32换算秒为分钟小时 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-56-1 name=__codelineno-56-1 href=#__codelineno-56-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-56-2 name=__codelineno-56-2 href=#__codelineno-56-2></a>
<a id=__codelineno-56-3 name=__codelineno-56-3 href=#__codelineno-56-3></a><span class=nv>a</span><span class=o>=</span><span class=m>60100</span>
<a id=__codelineno-56-4 name=__codelineno-56-4 href=#__codelineno-56-4></a>swap_seconds<span class=w> </span><span class=o>()</span>
<a id=__codelineno-56-5 name=__codelineno-56-5 href=#__codelineno-56-5></a><span class=o>{</span>
<a id=__codelineno-56-6 name=__codelineno-56-6 href=#__codelineno-56-6></a><span class=w>    </span><span class=nv>SEC</span><span class=o>=</span><span class=nv>$1</span>
<a id=__codelineno-56-7 name=__codelineno-56-7 href=#__codelineno-56-7></a><span class=w>    </span><span class=o>((</span><span class=w> </span>SEC<span class=w> </span>&lt;<span class=w> </span><span class=m>60</span><span class=w> </span><span class=o>))</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;持续时间: </span><span class=nv>$SEC秒</span><span class=s2>\c&quot;</span>
<a id=__codelineno-56-8 name=__codelineno-56-8 href=#__codelineno-56-8></a><span class=w>    </span><span class=o>((</span><span class=w> </span>SEC<span class=w> </span>&gt;<span class=o>=</span><span class=w> </span><span class=m>60</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>SEC<span class=w> </span>&lt;<span class=w> </span><span class=m>3600</span><span class=w> </span><span class=o>))</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;持续时间: </span><span class=k>$((</span><span class=w> </span><span class=nv>SEC</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=m>60</span><span class=w> </span><span class=k>))</span><span class=s2>分钟</span><span class=k>$((</span><span class=w> </span><span class=nv>SEC</span><span class=w> </span><span class=o>%</span><span class=w> </span><span class=m>60</span><span class=w> </span><span class=k>))</span><span class=s2>秒\c&quot;</span>
<a id=__codelineno-56-9 name=__codelineno-56-9 href=#__codelineno-56-9></a><span class=w>    </span><span class=o>((</span><span class=w> </span>SEC<span class=w> </span>&gt;<span class=w> </span><span class=m>3600</span><span class=w> </span><span class=o>))</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;持续时间: </span><span class=k>$((</span><span class=w> </span><span class=nv>SEC</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=m>3600</span><span class=w> </span><span class=k>))</span><span class=s2>小时</span><span class=k>$((</span><span class=w> </span><span class=o>(</span><span class=nv>SEC</span><span class=w> </span><span class=o>%</span><span class=w> </span><span class=m>3600</span><span class=o>)</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=m>60</span><span class=w> </span><span class=k>))</span><span class=s2>分钟</span><span class=k>$((</span><span class=w> </span><span class=o>(</span><span class=nv>SEC</span><span class=w> </span><span class=o>%</span><span class=w> </span><span class=m>3600</span><span class=o>)</span><span class=w> </span><span class=o>%</span><span class=w> </span><span class=m>60</span><span class=w> </span><span class=k>))</span><span class=s2>秒\c&quot;</span>
<a id=__codelineno-56-10 name=__codelineno-56-10 href=#__codelineno-56-10></a><span class=o>}</span>
<a id=__codelineno-56-11 name=__codelineno-56-11 href=#__codelineno-56-11></a>
<a id=__codelineno-56-12 name=__codelineno-56-12 href=#__codelineno-56-12></a><span class=nv>b</span><span class=o>=</span><span class=sb>`</span>swap_seconds<span class=w> </span><span class=nv>$a</span><span class=sb>`</span>
<a id=__codelineno-56-13 name=__codelineno-56-13 href=#__codelineno-56-13></a><span class=nb>echo</span><span class=w> </span><span class=nv>$b</span>
</code></pre></div> <p>输出</p> <div class=highlight><pre><span></span><code><a id=__codelineno-57-1 name=__codelineno-57-1 href=#__codelineno-57-1></a>持续时间: 16小时41分钟40秒
</code></pre></div> <h2 id=33脚本命令行参数的传递与判断>33.脚本命令行参数的传递与判断<a class=headerlink href=#33脚本命令行参数的传递与判断 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-58-1 name=__codelineno-58-1 href=#__codelineno-58-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-58-2 name=__codelineno-58-2 href=#__codelineno-58-2></a>
<a id=__codelineno-58-3 name=__codelineno-58-3 href=#__codelineno-58-3></a>main<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-58-4 name=__codelineno-58-4 href=#__codelineno-58-4></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[[</span><span class=w> </span><span class=nv>$#</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=m>1</span><span class=w> </span><span class=o>]]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-58-5 name=__codelineno-58-5 href=#__codelineno-58-5></a><span class=w>        </span><span class=k>case</span><span class=w> </span><span class=nv>$1</span><span class=w> </span><span class=k>in</span>
<a id=__codelineno-58-6 name=__codelineno-58-6 href=#__codelineno-58-6></a><span class=w>        </span><span class=s2>&quot;-h&quot;</span><span class=o>)</span>
<a id=__codelineno-58-7 name=__codelineno-58-7 href=#__codelineno-58-7></a><span class=w>            </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;脚本使用方法: &quot;</span>
<a id=__codelineno-58-8 name=__codelineno-58-8 href=#__codelineno-58-8></a><span class=w>            </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;  ./gitlab-pipeline.sh git仓库名1 git仓库名2 ... tag名(tag命名规则为: *-v加数字)&quot;</span>
<a id=__codelineno-58-9 name=__codelineno-58-9 href=#__codelineno-58-9></a><span class=w>            </span><span class=nb>exit</span>
<a id=__codelineno-58-10 name=__codelineno-58-10 href=#__codelineno-58-10></a><span class=w>            </span><span class=p>;;</span>
<a id=__codelineno-58-11 name=__codelineno-58-11 href=#__codelineno-58-11></a><span class=w>        </span><span class=s2>&quot;--help&quot;</span><span class=o>)</span>
<a id=__codelineno-58-12 name=__codelineno-58-12 href=#__codelineno-58-12></a><span class=w>            </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;脚本使用方法: &quot;</span>
<a id=__codelineno-58-13 name=__codelineno-58-13 href=#__codelineno-58-13></a><span class=w>            </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;  ./gitlab-pipeline.sh git仓库名1 git仓库名2 ... tag名(tag命名规则为: *-v加数字)&quot;</span>
<a id=__codelineno-58-14 name=__codelineno-58-14 href=#__codelineno-58-14></a><span class=w>            </span><span class=nb>exit</span>
<a id=__codelineno-58-15 name=__codelineno-58-15 href=#__codelineno-58-15></a><span class=w>            </span><span class=p>;;</span>
<a id=__codelineno-58-16 name=__codelineno-58-16 href=#__codelineno-58-16></a><span class=w>        </span>*<span class=o>)</span>
<a id=__codelineno-58-17 name=__codelineno-58-17 href=#__codelineno-58-17></a><span class=w>            </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;参数错误！&quot;</span>
<a id=__codelineno-58-18 name=__codelineno-58-18 href=#__codelineno-58-18></a><span class=w>            </span><span class=nb>exit</span>
<a id=__codelineno-58-19 name=__codelineno-58-19 href=#__codelineno-58-19></a><span class=w>            </span><span class=p>;;</span>
<a id=__codelineno-58-20 name=__codelineno-58-20 href=#__codelineno-58-20></a><span class=w>        </span><span class=k>esac</span>
<a id=__codelineno-58-21 name=__codelineno-58-21 href=#__codelineno-58-21></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-58-22 name=__codelineno-58-22 href=#__codelineno-58-22></a><span class=o>}</span>
<a id=__codelineno-58-23 name=__codelineno-58-23 href=#__codelineno-58-23></a>
<a id=__codelineno-58-24 name=__codelineno-58-24 href=#__codelineno-58-24></a>main<span class=w> </span><span class=nv>$*</span>
</code></pre></div> <h2 id=34检测-docker-容器的启动状态>34.检测 docker 容器的启动状态<a class=headerlink href=#34检测-docker-容器的启动状态 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-59-1 name=__codelineno-59-1 href=#__codelineno-59-1></a><span class=c1># 第一步：判断镜像是否存在</span>
<a id=__codelineno-59-2 name=__codelineno-59-2 href=#__codelineno-59-2></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=sb>`</span>docker<span class=w> </span>images<span class=w> </span>--format<span class=w> </span><span class=o>{{</span>.Repository<span class=o>}}</span>:<span class=o>{{</span>.Tag<span class=o>}}</span><span class=w> </span><span class=p>|</span>grep<span class=w> </span>-Fx<span class=w> </span><span class=m>192</span>.168.1.7:32772/applications/<span class=nv>$CI_PROJECT_NAME</span>:<span class=si>${</span><span class=nv>CI_COMMIT_SHORT_SHA</span><span class=si>}</span><span class=p>;</span><span class=nb>echo</span><span class=w> </span><span class=nv>$?</span><span class=sb>`</span><span class=w> </span>-eq<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=k>then</span>
<a id=__codelineno-59-3 name=__codelineno-59-3 href=#__codelineno-59-3></a><span class=w>   </span>docker<span class=w> </span>pull<span class=w> </span><span class=m>192</span>.168.1.7:32772/applications/<span class=nv>$CI_PROJECT_NAME</span>:<span class=nv>$CI_COMMIT_SHORT_SHA</span><span class=w> </span><span class=p>;</span>
<a id=__codelineno-59-4 name=__codelineno-59-4 href=#__codelineno-59-4></a><span class=k>fi</span><span class=p>;</span>
<a id=__codelineno-59-5 name=__codelineno-59-5 href=#__codelineno-59-5></a><span class=c1># 第二步：判断是否已经有重名的容器在运行或者处在其他状态。重名的，先删掉，在启动；不重名的直接启动</span>
<a id=__codelineno-59-6 name=__codelineno-59-6 href=#__codelineno-59-6></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=sb>`</span>docker<span class=w> </span>ps<span class=w> </span>-a<span class=w> </span>--format<span class=w> </span><span class=o>{{</span>.Names<span class=o>}}</span><span class=w> </span><span class=p>|</span>grep<span class=w> </span>-Fx<span class=w> </span><span class=nv>$CI_PROJECT_NAME</span><span class=w> </span>&gt;<span class=w> </span>/dev/null<span class=w> </span><span class=p>;</span><span class=nb>echo</span><span class=w> </span><span class=nv>$?</span><span class=sb>`</span><span class=w> </span>-eq<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=p>;</span><span class=k>then</span>
<a id=__codelineno-59-7 name=__codelineno-59-7 href=#__codelineno-59-7></a><span class=w>   </span>docker<span class=w> </span>rm<span class=w> </span>-f<span class=w> </span><span class=nv>$CI_PROJECT_NAME</span><span class=w> </span><span class=p>;</span>
<a id=__codelineno-59-8 name=__codelineno-59-8 href=#__codelineno-59-8></a><span class=w>   </span>docker<span class=w> </span>run<span class=w> </span>-d<span class=w> </span>--name<span class=w> </span><span class=nv>$CI_PROJECT_NAME</span><span class=w> </span>-p<span class=w> </span><span class=m>30088</span>:8080<span class=w> </span><span class=m>192</span>.168.1.7:32772/applications/<span class=nv>$CI_PROJECT_NAME</span>:<span class=nv>$CI_COMMIT_SHORT_SHA</span><span class=w> </span><span class=p>;</span>
<a id=__codelineno-59-9 name=__codelineno-59-9 href=#__codelineno-59-9></a><span class=k>else</span>
<a id=__codelineno-59-10 name=__codelineno-59-10 href=#__codelineno-59-10></a><span class=w>   </span>docker<span class=w> </span>run<span class=w> </span>-d<span class=w> </span>--name<span class=w> </span><span class=nv>$CI_PROJECT_NAME</span><span class=w> </span>-p<span class=w> </span><span class=m>30088</span>:8080<span class=w> </span><span class=m>192</span>.168.1.7:32772/applications/<span class=nv>$CI_PROJECT_NAME</span>:<span class=nv>$CI_COMMIT_SHORT_SHA</span><span class=w> </span><span class=p>;</span>
<a id=__codelineno-59-11 name=__codelineno-59-11 href=#__codelineno-59-11></a><span class=k>fi</span><span class=p>;</span>
<a id=__codelineno-59-12 name=__codelineno-59-12 href=#__codelineno-59-12></a><span class=c1># 第三步：循环五次判断容器的监控检测是否处于什么状态。健康状态就直接退出循环，不健康显示健康检查日志，正在启动的直接显示。处于其他状态的直接显示状态</span>
<a id=__codelineno-59-13 name=__codelineno-59-13 href=#__codelineno-59-13></a><span class=nv>n</span><span class=o>=</span><span class=m>0</span><span class=p>;</span>
<a id=__codelineno-59-14 name=__codelineno-59-14 href=#__codelineno-59-14></a><span class=k>while</span><span class=w> </span><span class=nb>true</span><span class=w> </span><span class=p>;</span><span class=k>do</span>
<a id=__codelineno-59-15 name=__codelineno-59-15 href=#__codelineno-59-15></a><span class=w>  </span><span class=nv>container_state</span><span class=o>=</span><span class=sb>`</span>docker<span class=w> </span>inspect<span class=w> </span>--format<span class=o>=</span><span class=s1>&#39;{{json .State.Health.Status}}&#39;</span><span class=w> </span><span class=nv>$CI_PROJECT_NAME</span><span class=sb>`</span><span class=p>;</span>
<a id=__codelineno-59-16 name=__codelineno-59-16 href=#__codelineno-59-16></a><span class=w>  </span><span class=k>case</span><span class=w> </span><span class=nv>$container_state</span><span class=w> </span><span class=k>in</span>
<a id=__codelineno-59-17 name=__codelineno-59-17 href=#__codelineno-59-17></a><span class=w>    </span><span class=s1>&#39;&quot;starting&quot;&#39;</span><span class=w> </span><span class=o>)</span>
<a id=__codelineno-59-18 name=__codelineno-59-18 href=#__codelineno-59-18></a><span class=w>      </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;应用容器正在启动！&quot;</span><span class=p>;</span>
<a id=__codelineno-59-19 name=__codelineno-59-19 href=#__codelineno-59-19></a><span class=w>    </span><span class=p>;;</span>
<a id=__codelineno-59-20 name=__codelineno-59-20 href=#__codelineno-59-20></a><span class=w>    </span><span class=s1>&#39;&quot;healthy&quot;&#39;</span><span class=w> </span><span class=o>)</span>
<a id=__codelineno-59-21 name=__codelineno-59-21 href=#__codelineno-59-21></a><span class=w>      </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;应用容器已启动，状态健康！&quot;</span><span class=p>;</span>
<a id=__codelineno-59-22 name=__codelineno-59-22 href=#__codelineno-59-22></a><span class=w>    </span><span class=k>break</span><span class=p>;</span>
<a id=__codelineno-59-23 name=__codelineno-59-23 href=#__codelineno-59-23></a><span class=w>    </span><span class=p>;;</span>
<a id=__codelineno-59-24 name=__codelineno-59-24 href=#__codelineno-59-24></a><span class=w>    </span><span class=s1>&#39;&quot;unhealthy&quot;&#39;</span><span class=w> </span><span class=o>)</span>
<a id=__codelineno-59-25 name=__codelineno-59-25 href=#__codelineno-59-25></a><span class=w>      </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;应用容器健康检测失败！&quot;</span><span class=p>;</span>
<a id=__codelineno-59-26 name=__codelineno-59-26 href=#__codelineno-59-26></a><span class=w>      </span>docker<span class=w> </span>inspect<span class=w> </span>--format<span class=o>=</span><span class=s1>&#39;{{json .State.Health.Log}}&#39;</span><span class=w> </span><span class=nv>$CI_PROJECT_NAME</span><span class=p>;</span>
<a id=__codelineno-59-27 name=__codelineno-59-27 href=#__codelineno-59-27></a><span class=w>    </span><span class=p>;;</span>
<a id=__codelineno-59-28 name=__codelineno-59-28 href=#__codelineno-59-28></a><span class=w>    </span>*<span class=w> </span><span class=o>)</span>
<a id=__codelineno-59-29 name=__codelineno-59-29 href=#__codelineno-59-29></a><span class=w>      </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;未知的状态:</span><span class=nv>$container_state</span><span class=s2>&quot;</span><span class=p>;</span>
<a id=__codelineno-59-30 name=__codelineno-59-30 href=#__codelineno-59-30></a><span class=w>    </span><span class=p>;;</span>
<a id=__codelineno-59-31 name=__codelineno-59-31 href=#__codelineno-59-31></a><span class=w>  </span><span class=k>esac</span><span class=p>;</span>
<a id=__codelineno-59-32 name=__codelineno-59-32 href=#__codelineno-59-32></a><span class=w>  </span>sleep<span class=w> </span>1s<span class=p>;</span>
<a id=__codelineno-59-33 name=__codelineno-59-33 href=#__codelineno-59-33></a><span class=w>  </span><span class=nv>n</span><span class=o>=</span><span class=k>$((</span><span class=nv>$n</span><span class=o>+</span><span class=m>1</span><span class=k>))</span><span class=p>;</span>
<a id=__codelineno-59-34 name=__codelineno-59-34 href=#__codelineno-59-34></a><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=nv>$n</span><span class=w> </span>-eq<span class=w> </span><span class=m>5</span><span class=w> </span><span class=o>]</span><span class=p>;</span>
<a id=__codelineno-59-35 name=__codelineno-59-35 href=#__codelineno-59-35></a><span class=w>     </span><span class=k>then</span><span class=w> </span><span class=k>break</span><span class=w> </span><span class=p>;</span>
<a id=__codelineno-59-36 name=__codelineno-59-36 href=#__codelineno-59-36></a><span class=w>  </span><span class=k>fi</span><span class=w> </span><span class=p>;</span>
<a id=__codelineno-59-37 name=__codelineno-59-37 href=#__codelineno-59-37></a><span class=k>done</span>
</code></pre></div> <h2 id=35检查常见系统命令是否安装>35.检查常见系统命令是否安装<a class=headerlink href=#35检查常见系统命令是否安装 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-60-1 name=__codelineno-60-1 href=#__codelineno-60-1></a>check_command<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-60-2 name=__codelineno-60-2 href=#__codelineno-60-2></a><span class=w>    </span><span class=k>if</span><span class=w> </span>!<span class=w> </span><span class=nb>command</span><span class=w> </span>-v<span class=w> </span>ifconfig<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-60-3 name=__codelineno-60-3 href=#__codelineno-60-3></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;\033[31mifconfig命令不存在，正在下载安装！\033[0m&quot;</span>
<a id=__codelineno-60-4 name=__codelineno-60-4 href=#__codelineno-60-4></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=nv>os</span><span class=o>=</span><span class=s2>&quot;ubuntu&quot;</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-60-5 name=__codelineno-60-5 href=#__codelineno-60-5></a><span class=w>            </span>apt<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>net-tools<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-60-6 name=__codelineno-60-6 href=#__codelineno-60-6></a><span class=w>        </span><span class=k>elif</span><span class=w> </span><span class=nv>os</span><span class=o>=</span><span class=s2>&quot;centos&quot;</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-60-7 name=__codelineno-60-7 href=#__codelineno-60-7></a><span class=w>            </span>yum<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>net-tools<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-60-8 name=__codelineno-60-8 href=#__codelineno-60-8></a><span class=w>        </span><span class=k>elif</span><span class=w> </span><span class=nv>os</span><span class=o>=</span><span class=s2>&quot;fedora&quot;</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-60-9 name=__codelineno-60-9 href=#__codelineno-60-9></a><span class=w>            </span>dnf<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>net-tools<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-60-10 name=__codelineno-60-10 href=#__codelineno-60-10></a><span class=w>        </span><span class=k>fi</span>
<a id=__codelineno-60-11 name=__codelineno-60-11 href=#__codelineno-60-11></a><span class=w>    </span><span class=k>elif</span><span class=w> </span>!<span class=w> </span><span class=nb>command</span><span class=w> </span>-v<span class=w> </span>ip<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-60-12 name=__codelineno-60-12 href=#__codelineno-60-12></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;\033[31mip命令不存在，正在下载安装！\033[0m&quot;</span>
<a id=__codelineno-60-13 name=__codelineno-60-13 href=#__codelineno-60-13></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=nv>os</span><span class=o>=</span><span class=s2>&quot;ubuntu&quot;</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-60-14 name=__codelineno-60-14 href=#__codelineno-60-14></a><span class=w>            </span>apt<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>iproute2<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-60-15 name=__codelineno-60-15 href=#__codelineno-60-15></a><span class=w>        </span><span class=k>elif</span><span class=w> </span><span class=nv>os</span><span class=o>=</span><span class=s2>&quot;centos&quot;</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-60-16 name=__codelineno-60-16 href=#__codelineno-60-16></a><span class=w>            </span>yum<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>iproute2<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-60-17 name=__codelineno-60-17 href=#__codelineno-60-17></a><span class=w>        </span><span class=k>elif</span><span class=w> </span><span class=nv>os</span><span class=o>=</span><span class=s2>&quot;fedora&quot;</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-60-18 name=__codelineno-60-18 href=#__codelineno-60-18></a><span class=w>            </span>dnf<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>iproute2<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-60-19 name=__codelineno-60-19 href=#__codelineno-60-19></a><span class=w>        </span><span class=k>fi</span>
<a id=__codelineno-60-20 name=__codelineno-60-20 href=#__codelineno-60-20></a><span class=w>    </span><span class=k>elif</span><span class=w> </span>!<span class=w> </span><span class=nb>command</span><span class=w> </span>-v<span class=w> </span>curl<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-60-21 name=__codelineno-60-21 href=#__codelineno-60-21></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;\033[31mcurl命令不存在，正在下载安装！\033[0m&quot;</span>
<a id=__codelineno-60-22 name=__codelineno-60-22 href=#__codelineno-60-22></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=nv>os</span><span class=o>=</span><span class=s2>&quot;ubuntu&quot;</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-60-23 name=__codelineno-60-23 href=#__codelineno-60-23></a><span class=w>            </span>apt<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>curl<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-60-24 name=__codelineno-60-24 href=#__codelineno-60-24></a><span class=w>        </span><span class=k>elif</span><span class=w> </span><span class=nv>os</span><span class=o>=</span><span class=s2>&quot;centos&quot;</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-60-25 name=__codelineno-60-25 href=#__codelineno-60-25></a><span class=w>            </span>yum<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>curl<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-60-26 name=__codelineno-60-26 href=#__codelineno-60-26></a><span class=w>        </span><span class=k>elif</span><span class=w> </span><span class=nv>os</span><span class=o>=</span><span class=s2>&quot;fedora&quot;</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-60-27 name=__codelineno-60-27 href=#__codelineno-60-27></a><span class=w>            </span>dnf<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>curl<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-60-28 name=__codelineno-60-28 href=#__codelineno-60-28></a><span class=w>        </span><span class=k>fi</span>
<a id=__codelineno-60-29 name=__codelineno-60-29 href=#__codelineno-60-29></a><span class=w>    </span><span class=k>elif</span><span class=w> </span>!<span class=w> </span><span class=nb>command</span><span class=w> </span>-v<span class=w> </span>wget<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-60-30 name=__codelineno-60-30 href=#__codelineno-60-30></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;\033[31mawk命令不存在，正在下载安装！\033[0m&quot;</span>
<a id=__codelineno-60-31 name=__codelineno-60-31 href=#__codelineno-60-31></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=nv>os</span><span class=o>=</span><span class=s2>&quot;ubuntu&quot;</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-60-32 name=__codelineno-60-32 href=#__codelineno-60-32></a><span class=w>            </span>apt<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>wget<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-60-33 name=__codelineno-60-33 href=#__codelineno-60-33></a><span class=w>        </span><span class=k>elif</span><span class=w> </span><span class=nv>os</span><span class=o>=</span><span class=s2>&quot;centos&quot;</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-60-34 name=__codelineno-60-34 href=#__codelineno-60-34></a><span class=w>            </span>yum<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>wget<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-60-35 name=__codelineno-60-35 href=#__codelineno-60-35></a><span class=w>        </span><span class=k>elif</span><span class=w> </span><span class=nv>os</span><span class=o>=</span><span class=s2>&quot;fedora&quot;</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-60-36 name=__codelineno-60-36 href=#__codelineno-60-36></a><span class=w>            </span>dnf<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>wget<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-60-37 name=__codelineno-60-37 href=#__codelineno-60-37></a><span class=w>        </span><span class=k>fi</span>
<a id=__codelineno-60-38 name=__codelineno-60-38 href=#__codelineno-60-38></a><span class=w>    </span><span class=k>elif</span><span class=w> </span>!<span class=w> </span><span class=nb>command</span><span class=w> </span>-v<span class=w> </span>tail<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-60-39 name=__codelineno-60-39 href=#__codelineno-60-39></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;\033[31mcoreutils命令不存在，正在下载安装！\033[0m&quot;</span>
<a id=__codelineno-60-40 name=__codelineno-60-40 href=#__codelineno-60-40></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=nv>os</span><span class=o>=</span><span class=s2>&quot;ubuntu&quot;</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-60-41 name=__codelineno-60-41 href=#__codelineno-60-41></a><span class=w>            </span>apt<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>coreutils<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-60-42 name=__codelineno-60-42 href=#__codelineno-60-42></a><span class=w>        </span><span class=k>elif</span><span class=w> </span><span class=nv>os</span><span class=o>=</span><span class=s2>&quot;centos&quot;</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-60-43 name=__codelineno-60-43 href=#__codelineno-60-43></a><span class=w>            </span>yum<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>coreutils<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-60-44 name=__codelineno-60-44 href=#__codelineno-60-44></a><span class=w>        </span><span class=k>elif</span><span class=w> </span><span class=nv>os</span><span class=o>=</span><span class=s2>&quot;fedora&quot;</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-60-45 name=__codelineno-60-45 href=#__codelineno-60-45></a><span class=w>            </span>dnf<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>coreutils<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-60-46 name=__codelineno-60-46 href=#__codelineno-60-46></a><span class=w>        </span><span class=k>fi</span>
<a id=__codelineno-60-47 name=__codelineno-60-47 href=#__codelineno-60-47></a><span class=w>    </span><span class=k>elif</span><span class=w> </span>!<span class=w> </span><span class=nb>command</span><span class=w> </span>-v<span class=w> </span>sed<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-60-48 name=__codelineno-60-48 href=#__codelineno-60-48></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;\033[31msed命令不存在，正在下载安装！\033[0m&quot;</span>
<a id=__codelineno-60-49 name=__codelineno-60-49 href=#__codelineno-60-49></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=nv>os</span><span class=o>=</span><span class=s2>&quot;ubuntu&quot;</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-60-50 name=__codelineno-60-50 href=#__codelineno-60-50></a><span class=w>            </span>apt<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>sed<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-60-51 name=__codelineno-60-51 href=#__codelineno-60-51></a><span class=w>        </span><span class=k>elif</span><span class=w> </span><span class=nv>os</span><span class=o>=</span><span class=s2>&quot;centos&quot;</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-60-52 name=__codelineno-60-52 href=#__codelineno-60-52></a><span class=w>            </span>yum<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>sed<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-60-53 name=__codelineno-60-53 href=#__codelineno-60-53></a><span class=w>        </span><span class=k>elif</span><span class=w> </span><span class=nv>os</span><span class=o>=</span><span class=s2>&quot;fedora&quot;</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-60-54 name=__codelineno-60-54 href=#__codelineno-60-54></a><span class=w>            </span>dnf<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>sed<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-60-55 name=__codelineno-60-55 href=#__codelineno-60-55></a><span class=w>        </span><span class=k>fi</span>
<a id=__codelineno-60-56 name=__codelineno-60-56 href=#__codelineno-60-56></a><span class=w>    </span><span class=k>elif</span><span class=w> </span>!<span class=w> </span><span class=nb>command</span><span class=w> </span>-v<span class=w> </span>grep<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-60-57 name=__codelineno-60-57 href=#__codelineno-60-57></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;\033[31mgrep命令不存在，正在下载安装！\033[0m&quot;</span>
<a id=__codelineno-60-58 name=__codelineno-60-58 href=#__codelineno-60-58></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=nv>os</span><span class=o>=</span><span class=s2>&quot;ubuntu&quot;</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-60-59 name=__codelineno-60-59 href=#__codelineno-60-59></a><span class=w>            </span>apt<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>grep<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-60-60 name=__codelineno-60-60 href=#__codelineno-60-60></a><span class=w>        </span><span class=k>elif</span><span class=w> </span><span class=nv>os</span><span class=o>=</span><span class=s2>&quot;centos&quot;</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-60-61 name=__codelineno-60-61 href=#__codelineno-60-61></a><span class=w>            </span>yum<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>grep<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-60-62 name=__codelineno-60-62 href=#__codelineno-60-62></a><span class=w>        </span><span class=k>elif</span><span class=w> </span><span class=nv>os</span><span class=o>=</span><span class=s2>&quot;fedora&quot;</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-60-63 name=__codelineno-60-63 href=#__codelineno-60-63></a><span class=w>            </span>dnf<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>grep<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-60-64 name=__codelineno-60-64 href=#__codelineno-60-64></a><span class=w>        </span><span class=k>fi</span>
<a id=__codelineno-60-65 name=__codelineno-60-65 href=#__codelineno-60-65></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-60-66 name=__codelineno-60-66 href=#__codelineno-60-66></a><span class=o>}</span>
</code></pre></div> <h2 id=36发送钉钉通知>36.发送钉钉通知<a class=headerlink href=#36发送钉钉通知 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-61-1 name=__codelineno-61-1 href=#__codelineno-61-1></a><span class=k>function</span><span class=w> </span>sendDingDing<span class=o>(){</span>
<a id=__codelineno-61-2 name=__codelineno-61-2 href=#__codelineno-61-2></a><span class=w>  </span><span class=nv>Ding_Webhook_Token</span><span class=o>=</span><span class=s1>&#39;钉钉机器人的WebHook Token&#39;</span>
<a id=__codelineno-61-3 name=__codelineno-61-3 href=#__codelineno-61-3></a><span class=w>  </span><span class=nv>Ding_Webhook_keyword</span><span class=o>=</span><span class=s2>&quot;可用作消息标题&quot;</span>
<a id=__codelineno-61-4 name=__codelineno-61-4 href=#__codelineno-61-4></a><span class=w>  </span><span class=nv>send_result</span><span class=o>=</span><span class=k>$(</span>curl<span class=w> </span>-sS<span class=w> </span><span class=se>\</span>
<a id=__codelineno-61-5 name=__codelineno-61-5 href=#__codelineno-61-5></a><span class=w>    </span>-XPOST<span class=w> </span>https://oapi.dingtalk.com/robot/send?access_token<span class=o>=</span><span class=s2>&quot;</span><span class=nv>$Ding_Webhook_Token</span><span class=s2>&quot;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-61-6 name=__codelineno-61-6 href=#__codelineno-61-6></a><span class=w>    </span>-H<span class=w> </span><span class=s1>&#39;Content-Type: application/json&#39;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-61-7 name=__codelineno-61-7 href=#__codelineno-61-7></a><span class=w>    </span>-d<span class=w> </span><span class=s1>&#39;{&quot;msgtype&quot;: &quot;markdown&quot;,&quot;markdown&quot;: {&quot;title&quot;: &quot;&#39;</span><span class=nv>$Ding_Webhook_Keyword</span><span class=s1>&#39;&quot;,&quot;text&quot;: &quot;&#39;</span><span class=s2>&quot;</span><span class=nv>$*</span><span class=s2>&quot;</span><span class=s1>&#39;&quot;},&quot;at&quot;: {&quot;isAtAll&quot;: true}}&#39;</span><span class=k>)</span>
<a id=__codelineno-61-8 name=__codelineno-61-8 href=#__codelineno-61-8></a><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=k>$(</span><span class=nb>echo</span><span class=w> </span><span class=nv>$send_result</span><span class=w> </span><span class=p>|</span><span class=w> </span>jq<span class=w> </span>-r<span class=w> </span><span class=s1>&#39;.errcode&#39;</span><span class=k>)</span><span class=w> </span>-eq<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-61-9 name=__codelineno-61-9 href=#__codelineno-61-9></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;发送成功:  \n&quot;</span><span class=w> </span><span class=nv>$*</span><span class=s2>&quot; &quot;</span>
<a id=__codelineno-61-10 name=__codelineno-61-10 href=#__codelineno-61-10></a><span class=w>  </span><span class=k>else</span>
<a id=__codelineno-61-11 name=__codelineno-61-11 href=#__codelineno-61-11></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;发送失败:  \n&quot;</span><span class=w> </span><span class=nv>$*</span><span class=s2>&quot;\n&quot;</span>
<a id=__codelineno-61-12 name=__codelineno-61-12 href=#__codelineno-61-12></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=nv>$send_result</span>
<a id=__codelineno-61-13 name=__codelineno-61-13 href=#__codelineno-61-13></a><span class=w>  </span><span class=k>fi</span>
<a id=__codelineno-61-14 name=__codelineno-61-14 href=#__codelineno-61-14></a><span class=o>}</span>
<a id=__codelineno-61-15 name=__codelineno-61-15 href=#__codelineno-61-15></a>
<a id=__codelineno-61-16 name=__codelineno-61-16 href=#__codelineno-61-16></a>sendDingDing<span class=w>  </span><span class=s2>&quot;</span><span class=k>$(</span>date<span class=w> </span>+<span class=s2>&quot;%F %H:%M:%S&quot;</span><span class=k>)</span><span class=s2> 需要告警的消息&quot;</span>
</code></pre></div> <h2 id=37function-函数库>37.function 函数库<a class=headerlink href=#37function-函数库 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-62-1 name=__codelineno-62-1 href=#__codelineno-62-1></a><span class=ch>#!/usr/bin/env bash</span>
<a id=__codelineno-62-2 name=__codelineno-62-2 href=#__codelineno-62-2></a><span class=c1># -*-Shell-script-*-</span>
<a id=__codelineno-62-3 name=__codelineno-62-3 href=#__codelineno-62-3></a><span class=c1>#</span>
<a id=__codelineno-62-4 name=__codelineno-62-4 href=#__codelineno-62-4></a><span class=c1># functions This file contains functions to be used by most or all</span>
<a id=__codelineno-62-5 name=__codelineno-62-5 href=#__codelineno-62-5></a><span class=c1>#       shell scripts in the /etc/init.d directory.</span>
<a id=__codelineno-62-6 name=__codelineno-62-6 href=#__codelineno-62-6></a><span class=c1>#</span>
<a id=__codelineno-62-7 name=__codelineno-62-7 href=#__codelineno-62-7></a>
<a id=__codelineno-62-8 name=__codelineno-62-8 href=#__codelineno-62-8></a>:<span class=s>&lt;&lt;EOF</span>
<a id=__codelineno-62-9 name=__codelineno-62-9 href=#__codelineno-62-9></a>
<a id=__codelineno-62-10 name=__codelineno-62-10 href=#__codelineno-62-10></a><span class=s>checkpid():检查是否已存在pid，如果有一个存在，返回0（通过查看/proc目录）</span>
<a id=__codelineno-62-11 name=__codelineno-62-11 href=#__codelineno-62-11></a>
<a id=__codelineno-62-12 name=__codelineno-62-12 href=#__codelineno-62-12></a><span class=s>daemon():启动某个服务。/etc/init.d目录部分脚本的start使用到这个</span>
<a id=__codelineno-62-13 name=__codelineno-62-13 href=#__codelineno-62-13></a>
<a id=__codelineno-62-14 name=__codelineno-62-14 href=#__codelineno-62-14></a><span class=s>killproc():杀死某个进程。/etc/init.d目录部分脚本的stop使用到这个</span>
<a id=__codelineno-62-15 name=__codelineno-62-15 href=#__codelineno-62-15></a>
<a id=__codelineno-62-16 name=__codelineno-62-16 href=#__codelineno-62-16></a><span class=s>pidfileofproc():寻找某个进程的pid</span>
<a id=__codelineno-62-17 name=__codelineno-62-17 href=#__codelineno-62-17></a>
<a id=__codelineno-62-18 name=__codelineno-62-18 href=#__codelineno-62-18></a><span class=s>pidofproc():类似上面的，只是还查找了pidof命令</span>
<a id=__codelineno-62-19 name=__codelineno-62-19 href=#__codelineno-62-19></a>
<a id=__codelineno-62-20 name=__codelineno-62-20 href=#__codelineno-62-20></a><span class=s>status():返回一个服务的状态</span>
<a id=__codelineno-62-21 name=__codelineno-62-21 href=#__codelineno-62-21></a>
<a id=__codelineno-62-22 name=__codelineno-62-22 href=#__codelineno-62-22></a><span class=s>echo_success():打印OK</span>
<a id=__codelineno-62-23 name=__codelineno-62-23 href=#__codelineno-62-23></a>
<a id=__codelineno-62-24 name=__codelineno-62-24 href=#__codelineno-62-24></a><span class=s>echo_failure():打印FAILED</span>
<a id=__codelineno-62-25 name=__codelineno-62-25 href=#__codelineno-62-25></a>
<a id=__codelineno-62-26 name=__codelineno-62-26 href=#__codelineno-62-26></a><span class=s>echo_passed():打印PASSED</span>
<a id=__codelineno-62-27 name=__codelineno-62-27 href=#__codelineno-62-27></a>
<a id=__codelineno-62-28 name=__codelineno-62-28 href=#__codelineno-62-28></a><span class=s>echo_warning():打印WARNING</span>
<a id=__codelineno-62-29 name=__codelineno-62-29 href=#__codelineno-62-29></a>
<a id=__codelineno-62-30 name=__codelineno-62-30 href=#__codelineno-62-30></a><span class=s>success():打印OK并记录日志</span>
<a id=__codelineno-62-31 name=__codelineno-62-31 href=#__codelineno-62-31></a>
<a id=__codelineno-62-32 name=__codelineno-62-32 href=#__codelineno-62-32></a><span class=s>failure():打印FAILED并记录日志</span>
<a id=__codelineno-62-33 name=__codelineno-62-33 href=#__codelineno-62-33></a>
<a id=__codelineno-62-34 name=__codelineno-62-34 href=#__codelineno-62-34></a><span class=s>passed():打印PASSED并记录日志</span>
<a id=__codelineno-62-35 name=__codelineno-62-35 href=#__codelineno-62-35></a>
<a id=__codelineno-62-36 name=__codelineno-62-36 href=#__codelineno-62-36></a><span class=s>action():打印某个信息并执行给定的命令，它会根据命令执行的结果来调用 success,failure方法</span>
<a id=__codelineno-62-37 name=__codelineno-62-37 href=#__codelineno-62-37></a>
<a id=__codelineno-62-38 name=__codelineno-62-38 href=#__codelineno-62-38></a><span class=s>strstr():判断$1是否含有$2</span>
<a id=__codelineno-62-39 name=__codelineno-62-39 href=#__codelineno-62-39></a>
<a id=__codelineno-62-40 name=__codelineno-62-40 href=#__codelineno-62-40></a><span class=s>confirm():提示是否启动某个服务</span>
<a id=__codelineno-62-41 name=__codelineno-62-41 href=#__codelineno-62-41></a>
<a id=__codelineno-62-42 name=__codelineno-62-42 href=#__codelineno-62-42></a><span class=s>is_ignored_file():检查$1文件是否是*.bak、*.orig、*.rpmnew....等文件</span>
<a id=__codelineno-62-43 name=__codelineno-62-43 href=#__codelineno-62-43></a>
<a id=__codelineno-62-44 name=__codelineno-62-44 href=#__codelineno-62-44></a><span class=s>is_true()/is_false():交互式yes|no的选项</span>
<a id=__codelineno-62-45 name=__codelineno-62-45 href=#__codelineno-62-45></a>
<a id=__codelineno-62-46 name=__codelineno-62-46 href=#__codelineno-62-46></a><span class=s>apply_sysctl()应用sysctl设置，包括/etc/sysctl.d中的文件</span>
<a id=__codelineno-62-47 name=__codelineno-62-47 href=#__codelineno-62-47></a>
<a id=__codelineno-62-48 name=__codelineno-62-48 href=#__codelineno-62-48></a><span class=s>EOF</span>
<a id=__codelineno-62-49 name=__codelineno-62-49 href=#__codelineno-62-49></a>
<a id=__codelineno-62-50 name=__codelineno-62-50 href=#__codelineno-62-50></a>
<a id=__codelineno-62-51 name=__codelineno-62-51 href=#__codelineno-62-51></a><span class=nv>TEXTDOMAIN</span><span class=o>=</span>initscripts
<a id=__codelineno-62-52 name=__codelineno-62-52 href=#__codelineno-62-52></a>
<a id=__codelineno-62-53 name=__codelineno-62-53 href=#__codelineno-62-53></a><span class=c1># Make sure umask is sane</span>
<a id=__codelineno-62-54 name=__codelineno-62-54 href=#__codelineno-62-54></a><span class=nb>umask</span><span class=w> </span><span class=m>022</span>
<a id=__codelineno-62-55 name=__codelineno-62-55 href=#__codelineno-62-55></a>
<a id=__codelineno-62-56 name=__codelineno-62-56 href=#__codelineno-62-56></a><span class=c1># Set up a default search path.</span>
<a id=__codelineno-62-57 name=__codelineno-62-57 href=#__codelineno-62-57></a><span class=nv>PATH</span><span class=o>=</span><span class=s2>&quot;/sbin:/usr/sbin:/bin:/usr/bin&quot;</span>
<a id=__codelineno-62-58 name=__codelineno-62-58 href=#__codelineno-62-58></a>
<a id=__codelineno-62-59 name=__codelineno-62-59 href=#__codelineno-62-59></a><span class=c1>#导出环境变量</span>
<a id=__codelineno-62-60 name=__codelineno-62-60 href=#__codelineno-62-60></a><span class=nb>export</span><span class=w> </span>PATH
<a id=__codelineno-62-61 name=__codelineno-62-61 href=#__codelineno-62-61></a>
<a id=__codelineno-62-62 name=__codelineno-62-62 href=#__codelineno-62-62></a>
<a id=__codelineno-62-63 name=__codelineno-62-63 href=#__codelineno-62-63></a><span class=c1>#判断PPID和字符串否为空</span>
<a id=__codelineno-62-64 name=__codelineno-62-64 href=#__codelineno-62-64></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=nv>$PPID</span><span class=w> </span>-ne<span class=w> </span><span class=m>1</span><span class=w> </span>-a<span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=nv>$SYSTEMCTL_SKIP_REDIRECT</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-62-65 name=__codelineno-62-65 href=#__codelineno-62-65></a><span class=w>        </span><span class=o>[</span><span class=w> </span>-d<span class=w> </span>/run/systemd/system<span class=w> </span><span class=o>]</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-62-66 name=__codelineno-62-66 href=#__codelineno-62-66></a><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$0</span><span class=s2>&quot;</span><span class=w> </span><span class=k>in</span>
<a id=__codelineno-62-67 name=__codelineno-62-67 href=#__codelineno-62-67></a><span class=w>    </span>/etc/init.d/*<span class=p>|</span>/etc/rc.d/init.d/*<span class=o>)</span>
<a id=__codelineno-62-68 name=__codelineno-62-68 href=#__codelineno-62-68></a><span class=w>        </span><span class=nv>_use_systemctl</span><span class=o>=</span><span class=m>1</span>
<a id=__codelineno-62-69 name=__codelineno-62-69 href=#__codelineno-62-69></a><span class=w>        </span><span class=p>;;</span>
<a id=__codelineno-62-70 name=__codelineno-62-70 href=#__codelineno-62-70></a><span class=w>    </span><span class=k>esac</span>
<a id=__codelineno-62-71 name=__codelineno-62-71 href=#__codelineno-62-71></a><span class=k>fi</span>
<a id=__codelineno-62-72 name=__codelineno-62-72 href=#__codelineno-62-72></a>
<a id=__codelineno-62-73 name=__codelineno-62-73 href=#__codelineno-62-73></a>systemctl_redirect<span class=w> </span><span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-62-74 name=__codelineno-62-74 href=#__codelineno-62-74></a><span class=w>    </span><span class=nb>local</span><span class=w> </span>s
<a id=__codelineno-62-75 name=__codelineno-62-75 href=#__codelineno-62-75></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>prog</span><span class=o>=</span><span class=si>${</span><span class=nv>1</span><span class=p>##*/</span><span class=si>}</span>
<a id=__codelineno-62-76 name=__codelineno-62-76 href=#__codelineno-62-76></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>command</span><span class=o>=</span><span class=nv>$2</span>
<a id=__codelineno-62-77 name=__codelineno-62-77 href=#__codelineno-62-77></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>options</span><span class=o>=</span><span class=s2>&quot;&quot;</span>
<a id=__codelineno-62-78 name=__codelineno-62-78 href=#__codelineno-62-78></a>
<a id=__codelineno-62-79 name=__codelineno-62-79 href=#__codelineno-62-79></a><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$command</span><span class=s2>&quot;</span><span class=w> </span><span class=k>in</span>
<a id=__codelineno-62-80 name=__codelineno-62-80 href=#__codelineno-62-80></a><span class=w>    </span>start<span class=o>)</span>
<a id=__codelineno-62-81 name=__codelineno-62-81 href=#__codelineno-62-81></a><span class=w>        </span><span class=nv>s</span><span class=o>=</span>$<span class=s2>&quot;Starting </span><span class=nv>$prog</span><span class=s2> (via systemctl): &quot;</span>
<a id=__codelineno-62-82 name=__codelineno-62-82 href=#__codelineno-62-82></a><span class=w>        </span><span class=p>;;</span>
<a id=__codelineno-62-83 name=__codelineno-62-83 href=#__codelineno-62-83></a><span class=w>    </span>stop<span class=o>)</span>
<a id=__codelineno-62-84 name=__codelineno-62-84 href=#__codelineno-62-84></a><span class=w>        </span><span class=nv>s</span><span class=o>=</span>$<span class=s2>&quot;Stopping </span><span class=nv>$prog</span><span class=s2> (via systemctl): &quot;</span>
<a id=__codelineno-62-85 name=__codelineno-62-85 href=#__codelineno-62-85></a><span class=w>        </span><span class=p>;;</span>
<a id=__codelineno-62-86 name=__codelineno-62-86 href=#__codelineno-62-86></a><span class=w>    </span>reload<span class=p>|</span>try-reload<span class=o>)</span>
<a id=__codelineno-62-87 name=__codelineno-62-87 href=#__codelineno-62-87></a><span class=w>        </span><span class=nv>s</span><span class=o>=</span>$<span class=s2>&quot;Reloading </span><span class=nv>$prog</span><span class=s2> configuration (via systemctl): &quot;</span>
<a id=__codelineno-62-88 name=__codelineno-62-88 href=#__codelineno-62-88></a><span class=w>        </span><span class=p>;;</span>
<a id=__codelineno-62-89 name=__codelineno-62-89 href=#__codelineno-62-89></a><span class=w>    </span>restart<span class=p>|</span>try-restart<span class=p>|</span>condrestart<span class=o>)</span>
<a id=__codelineno-62-90 name=__codelineno-62-90 href=#__codelineno-62-90></a><span class=w>        </span><span class=nv>s</span><span class=o>=</span>$<span class=s2>&quot;Restarting </span><span class=nv>$prog</span><span class=s2> (via systemctl): &quot;</span>
<a id=__codelineno-62-91 name=__codelineno-62-91 href=#__codelineno-62-91></a><span class=w>        </span><span class=p>;;</span>
<a id=__codelineno-62-92 name=__codelineno-62-92 href=#__codelineno-62-92></a><span class=w>    </span><span class=k>esac</span>
<a id=__codelineno-62-93 name=__codelineno-62-93 href=#__codelineno-62-93></a>
<a id=__codelineno-62-94 name=__codelineno-62-94 href=#__codelineno-62-94></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=nv>$SYSTEMCTL_IGNORE_DEPENDENCIES</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-62-95 name=__codelineno-62-95 href=#__codelineno-62-95></a><span class=w>        </span><span class=nv>options</span><span class=o>=</span><span class=s2>&quot;--ignore-dependencies&quot;</span>
<a id=__codelineno-62-96 name=__codelineno-62-96 href=#__codelineno-62-96></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-62-97 name=__codelineno-62-97 href=#__codelineno-62-97></a>
<a id=__codelineno-62-98 name=__codelineno-62-98 href=#__codelineno-62-98></a><span class=w>    </span><span class=k>if</span><span class=w> </span>!<span class=w> </span>systemctl<span class=w> </span>show<span class=w> </span><span class=s2>&quot;</span><span class=nv>$prog</span><span class=s2>.service&quot;</span><span class=w> </span>&gt;<span class=w> </span>/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-62-99 name=__codelineno-62-99 href=#__codelineno-62-99></a><span class=w>            </span>systemctl<span class=w> </span>show<span class=w> </span>-p<span class=w> </span>LoadState<span class=w> </span><span class=s2>&quot;</span><span class=nv>$prog</span><span class=s2>.service&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>-q<span class=w> </span><span class=s1>&#39;not-found&#39;</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-62-100 name=__codelineno-62-100 href=#__codelineno-62-100></a><span class=w>        </span>action<span class=w> </span><span class=s2>$&quot;Reloading systemd: &quot;</span><span class=w> </span>/bin/systemctl<span class=w> </span>daemon-reload
<a id=__codelineno-62-101 name=__codelineno-62-101 href=#__codelineno-62-101></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-62-102 name=__codelineno-62-102 href=#__codelineno-62-102></a>
<a id=__codelineno-62-103 name=__codelineno-62-103 href=#__codelineno-62-103></a><span class=w>    </span>action<span class=w> </span><span class=s2>&quot;</span><span class=nv>$s</span><span class=s2>&quot;</span><span class=w> </span>/bin/systemctl<span class=w> </span><span class=nv>$options</span><span class=w> </span><span class=nv>$command</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$prog</span><span class=s2>.service&quot;</span>
<a id=__codelineno-62-104 name=__codelineno-62-104 href=#__codelineno-62-104></a><span class=o>}</span>
<a id=__codelineno-62-105 name=__codelineno-62-105 href=#__codelineno-62-105></a>
<a id=__codelineno-62-106 name=__codelineno-62-106 href=#__codelineno-62-106></a><span class=c1># Get a sane screen width</span>
<a id=__codelineno-62-107 name=__codelineno-62-107 href=#__codelineno-62-107></a><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>COLUMNS</span><span class=k>:-</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nv>COLUMNS</span><span class=o>=</span><span class=m>80</span>
<a id=__codelineno-62-108 name=__codelineno-62-108 href=#__codelineno-62-108></a>
<a id=__codelineno-62-109 name=__codelineno-62-109 href=#__codelineno-62-109></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>CONSOLETYPE</span><span class=k>:-</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-62-110 name=__codelineno-62-110 href=#__codelineno-62-110></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-c<span class=w> </span><span class=s2>&quot;/dev/stderr&quot;</span><span class=w> </span>-a<span class=w> </span>-r<span class=w> </span><span class=s2>&quot;/dev/stderr&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-62-111 name=__codelineno-62-111 href=#__codelineno-62-111></a><span class=w>        </span><span class=nv>CONSOLETYPE</span><span class=o>=</span><span class=s2>&quot;</span><span class=k>$(</span>/sbin/consoletype<span class=w> </span>&lt;<span class=w> </span>/dev/stderr<span class=w> </span><span class=m>2</span>&gt;/dev/null<span class=k>)</span><span class=s2>&quot;</span>
<a id=__codelineno-62-112 name=__codelineno-62-112 href=#__codelineno-62-112></a><span class=w>    </span><span class=k>else</span>
<a id=__codelineno-62-113 name=__codelineno-62-113 href=#__codelineno-62-113></a><span class=w>        </span><span class=nv>CONSOLETYPE</span><span class=o>=</span><span class=s2>&quot;serial&quot;</span>
<a id=__codelineno-62-114 name=__codelineno-62-114 href=#__codelineno-62-114></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-62-115 name=__codelineno-62-115 href=#__codelineno-62-115></a><span class=k>fi</span>
<a id=__codelineno-62-116 name=__codelineno-62-116 href=#__codelineno-62-116></a>
<a id=__codelineno-62-117 name=__codelineno-62-117 href=#__codelineno-62-117></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>NOLOCALE</span><span class=k>:-</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>LANGSH_SOURCED</span><span class=k>:-</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-62-118 name=__codelineno-62-118 href=#__codelineno-62-118></a><span class=w>        </span><span class=o>[</span><span class=w> </span>-f<span class=w> </span>/etc/sysconfig/i18n<span class=w> </span>-o<span class=w> </span>-f<span class=w> </span>/etc/locale.conf<span class=w> </span><span class=o>]</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-62-119 name=__codelineno-62-119 href=#__codelineno-62-119></a><span class=w>    </span>.<span class=w> </span>/etc/profile.d/lang.sh<span class=w> </span><span class=m>2</span>&gt;/dev/null
<a id=__codelineno-62-120 name=__codelineno-62-120 href=#__codelineno-62-120></a><span class=w>    </span><span class=c1># avoid propagating LANGSH_SOURCED any further</span>
<a id=__codelineno-62-121 name=__codelineno-62-121 href=#__codelineno-62-121></a><span class=w>    </span><span class=nb>unset</span><span class=w> </span>LANGSH_SOURCED
<a id=__codelineno-62-122 name=__codelineno-62-122 href=#__codelineno-62-122></a><span class=k>fi</span>
<a id=__codelineno-62-123 name=__codelineno-62-123 href=#__codelineno-62-123></a>
<a id=__codelineno-62-124 name=__codelineno-62-124 href=#__codelineno-62-124></a><span class=c1># Read in our configuration</span>
<a id=__codelineno-62-125 name=__codelineno-62-125 href=#__codelineno-62-125></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>BOOTUP</span><span class=k>:-</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-62-126 name=__codelineno-62-126 href=#__codelineno-62-126></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-f<span class=w> </span>/etc/sysconfig/init<span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-62-127 name=__codelineno-62-127 href=#__codelineno-62-127></a><span class=w>        </span>.<span class=w> </span>/etc/sysconfig/init
<a id=__codelineno-62-128 name=__codelineno-62-128 href=#__codelineno-62-128></a><span class=w>    </span><span class=k>else</span>
<a id=__codelineno-62-129 name=__codelineno-62-129 href=#__codelineno-62-129></a><span class=w>        </span><span class=c1># This all seem confusing? Look in /etc/sysconfig/init,</span>
<a id=__codelineno-62-130 name=__codelineno-62-130 href=#__codelineno-62-130></a><span class=w>        </span><span class=c1># or in /usr/share/doc/initscripts-*/sysconfig.txt</span>
<a id=__codelineno-62-131 name=__codelineno-62-131 href=#__codelineno-62-131></a><span class=w>        </span><span class=nv>BOOTUP</span><span class=o>=</span>color
<a id=__codelineno-62-132 name=__codelineno-62-132 href=#__codelineno-62-132></a><span class=w>        </span><span class=nv>RES_COL</span><span class=o>=</span><span class=m>60</span>
<a id=__codelineno-62-133 name=__codelineno-62-133 href=#__codelineno-62-133></a><span class=w>        </span><span class=nv>MOVE_TO_COL</span><span class=o>=</span><span class=s2>&quot;echo -en \\033[</span><span class=si>${</span><span class=nv>RES_COL</span><span class=si>}</span><span class=s2>G&quot;</span>
<a id=__codelineno-62-134 name=__codelineno-62-134 href=#__codelineno-62-134></a><span class=w>        </span><span class=nv>SETCOLOR_SUCCESS</span><span class=o>=</span><span class=s2>&quot;echo -en \\033[1;32m&quot;</span>
<a id=__codelineno-62-135 name=__codelineno-62-135 href=#__codelineno-62-135></a><span class=w>        </span><span class=nv>SETCOLOR_FAILURE</span><span class=o>=</span><span class=s2>&quot;echo -en \\033[1;31m&quot;</span>
<a id=__codelineno-62-136 name=__codelineno-62-136 href=#__codelineno-62-136></a><span class=w>        </span><span class=nv>SETCOLOR_WARNING</span><span class=o>=</span><span class=s2>&quot;echo -en \\033[1;33m&quot;</span>
<a id=__codelineno-62-137 name=__codelineno-62-137 href=#__codelineno-62-137></a><span class=w>        </span><span class=nv>SETCOLOR_NORMAL</span><span class=o>=</span><span class=s2>&quot;echo -en \\033[0;39m&quot;</span>
<a id=__codelineno-62-138 name=__codelineno-62-138 href=#__codelineno-62-138></a><span class=w>        </span><span class=nv>LOGLEVEL</span><span class=o>=</span><span class=m>1</span>
<a id=__codelineno-62-139 name=__codelineno-62-139 href=#__codelineno-62-139></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-62-140 name=__codelineno-62-140 href=#__codelineno-62-140></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$CONSOLETYPE</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;serial&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-62-141 name=__codelineno-62-141 href=#__codelineno-62-141></a><span class=w>        </span><span class=nv>BOOTUP</span><span class=o>=</span>serial
<a id=__codelineno-62-142 name=__codelineno-62-142 href=#__codelineno-62-142></a><span class=w>        </span><span class=nv>MOVE_TO_COL</span><span class=o>=</span>
<a id=__codelineno-62-143 name=__codelineno-62-143 href=#__codelineno-62-143></a><span class=w>        </span><span class=nv>SETCOLOR_SUCCESS</span><span class=o>=</span>
<a id=__codelineno-62-144 name=__codelineno-62-144 href=#__codelineno-62-144></a><span class=w>        </span><span class=nv>SETCOLOR_FAILURE</span><span class=o>=</span>
<a id=__codelineno-62-145 name=__codelineno-62-145 href=#__codelineno-62-145></a><span class=w>        </span><span class=nv>SETCOLOR_WARNING</span><span class=o>=</span>
<a id=__codelineno-62-146 name=__codelineno-62-146 href=#__codelineno-62-146></a><span class=w>        </span><span class=nv>SETCOLOR_NORMAL</span><span class=o>=</span>
<a id=__codelineno-62-147 name=__codelineno-62-147 href=#__codelineno-62-147></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-62-148 name=__codelineno-62-148 href=#__codelineno-62-148></a><span class=k>fi</span>
<a id=__codelineno-62-149 name=__codelineno-62-149 href=#__codelineno-62-149></a>
<a id=__codelineno-62-150 name=__codelineno-62-150 href=#__codelineno-62-150></a><span class=c1># Check if any of $pid (could be plural) are running</span>
<a id=__codelineno-62-151 name=__codelineno-62-151 href=#__codelineno-62-151></a>checkpid<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-62-152 name=__codelineno-62-152 href=#__codelineno-62-152></a><span class=w>    </span><span class=nb>local</span><span class=w> </span>i
<a id=__codelineno-62-153 name=__codelineno-62-153 href=#__codelineno-62-153></a>
<a id=__codelineno-62-154 name=__codelineno-62-154 href=#__codelineno-62-154></a><span class=w>    </span><span class=k>for</span><span class=w> </span>i<span class=w> </span><span class=k>in</span><span class=w> </span><span class=nv>$*</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>do</span>
<a id=__codelineno-62-155 name=__codelineno-62-155 href=#__codelineno-62-155></a><span class=w>        </span><span class=o>[</span><span class=w> </span>-d<span class=w> </span><span class=s2>&quot;/proc/</span><span class=nv>$i</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-62-156 name=__codelineno-62-156 href=#__codelineno-62-156></a><span class=w>    </span><span class=k>done</span>
<a id=__codelineno-62-157 name=__codelineno-62-157 href=#__codelineno-62-157></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-62-158 name=__codelineno-62-158 href=#__codelineno-62-158></a><span class=o>}</span>
<a id=__codelineno-62-159 name=__codelineno-62-159 href=#__codelineno-62-159></a>
<a id=__codelineno-62-160 name=__codelineno-62-160 href=#__codelineno-62-160></a>__kill_pids_term_kill_checkpids<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-62-161 name=__codelineno-62-161 href=#__codelineno-62-161></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>base_stime</span><span class=o>=</span><span class=nv>$1</span>
<a id=__codelineno-62-162 name=__codelineno-62-162 href=#__codelineno-62-162></a><span class=w>    </span><span class=nb>shift</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-62-163 name=__codelineno-62-163 href=#__codelineno-62-163></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>pid</span><span class=o>=</span>
<a id=__codelineno-62-164 name=__codelineno-62-164 href=#__codelineno-62-164></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>pids</span><span class=o>=</span><span class=nv>$*</span>
<a id=__codelineno-62-165 name=__codelineno-62-165 href=#__codelineno-62-165></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>remaining</span><span class=o>=</span>
<a id=__codelineno-62-166 name=__codelineno-62-166 href=#__codelineno-62-166></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>stat</span><span class=o>=</span>
<a id=__codelineno-62-167 name=__codelineno-62-167 href=#__codelineno-62-167></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>stime</span><span class=o>=</span>
<a id=__codelineno-62-168 name=__codelineno-62-168 href=#__codelineno-62-168></a>
<a id=__codelineno-62-169 name=__codelineno-62-169 href=#__codelineno-62-169></a><span class=w>    </span><span class=k>for</span><span class=w> </span>pid<span class=w> </span><span class=k>in</span><span class=w> </span><span class=nv>$pids</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>do</span>
<a id=__codelineno-62-170 name=__codelineno-62-170 href=#__codelineno-62-170></a><span class=w>        </span><span class=o>[</span><span class=w> </span>!<span class=w> </span>-e<span class=w>  </span><span class=s2>&quot;/proc/</span><span class=nv>$pid</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>continue</span>
<a id=__codelineno-62-171 name=__codelineno-62-171 href=#__codelineno-62-171></a><span class=w>        </span><span class=nb>read</span><span class=w> </span>-r<span class=w> </span>line<span class=w> </span>&lt;<span class=w> </span><span class=s2>&quot;/proc/</span><span class=nv>$pid</span><span class=s2>/stat&quot;</span><span class=w> </span><span class=m>2</span>&gt;<span class=w> </span>/dev/null
<a id=__codelineno-62-172 name=__codelineno-62-172 href=#__codelineno-62-172></a>
<a id=__codelineno-62-173 name=__codelineno-62-173 href=#__codelineno-62-173></a><span class=w>        </span><span class=nv>stat</span><span class=o>=(</span><span class=nv>$line</span><span class=o>)</span>
<a id=__codelineno-62-174 name=__codelineno-62-174 href=#__codelineno-62-174></a><span class=w>        </span><span class=nv>stime</span><span class=o>=</span><span class=si>${</span><span class=nv>stat</span><span class=p>[21]</span><span class=si>}</span>
<a id=__codelineno-62-175 name=__codelineno-62-175 href=#__codelineno-62-175></a>
<a id=__codelineno-62-176 name=__codelineno-62-176 href=#__codelineno-62-176></a><span class=w>        </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=nv>$stime</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$base_stime</span><span class=s2>&quot;</span><span class=w> </span>-lt<span class=w> </span><span class=s2>&quot;</span><span class=nv>$stime</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>continue</span>
<a id=__codelineno-62-177 name=__codelineno-62-177 href=#__codelineno-62-177></a><span class=w>        </span><span class=nv>remaining</span><span class=o>+=</span><span class=s2>&quot;</span><span class=nv>$pid</span><span class=s2> &quot;</span>
<a id=__codelineno-62-178 name=__codelineno-62-178 href=#__codelineno-62-178></a><span class=w>    </span><span class=k>done</span>
<a id=__codelineno-62-179 name=__codelineno-62-179 href=#__codelineno-62-179></a>
<a id=__codelineno-62-180 name=__codelineno-62-180 href=#__codelineno-62-180></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$remaining</span><span class=s2>&quot;</span>
<a id=__codelineno-62-181 name=__codelineno-62-181 href=#__codelineno-62-181></a><span class=w>    </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=nv>$remaining</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-62-182 name=__codelineno-62-182 href=#__codelineno-62-182></a>
<a id=__codelineno-62-183 name=__codelineno-62-183 href=#__codelineno-62-183></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-62-184 name=__codelineno-62-184 href=#__codelineno-62-184></a><span class=o>}</span>
<a id=__codelineno-62-185 name=__codelineno-62-185 href=#__codelineno-62-185></a>
<a id=__codelineno-62-186 name=__codelineno-62-186 href=#__codelineno-62-186></a>__kill_pids_term_kill<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-62-187 name=__codelineno-62-187 href=#__codelineno-62-187></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>try</span><span class=o>=</span><span class=m>0</span>
<a id=__codelineno-62-188 name=__codelineno-62-188 href=#__codelineno-62-188></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>delay</span><span class=o>=</span><span class=m>3</span><span class=p>;</span>
<a id=__codelineno-62-189 name=__codelineno-62-189 href=#__codelineno-62-189></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>pid</span><span class=o>=</span>
<a id=__codelineno-62-190 name=__codelineno-62-190 href=#__codelineno-62-190></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>stat</span><span class=o>=(</span><span class=k>$(</span>&lt;<span class=w> </span>/proc/self/stat<span class=k>)</span><span class=o>)</span>
<a id=__codelineno-62-191 name=__codelineno-62-191 href=#__codelineno-62-191></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>base_stime</span><span class=o>=</span><span class=si>${</span><span class=nv>stat</span><span class=p>[21]</span><span class=si>}</span>
<a id=__codelineno-62-192 name=__codelineno-62-192 href=#__codelineno-62-192></a>
<a id=__codelineno-62-193 name=__codelineno-62-193 href=#__codelineno-62-193></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;-d&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-62-194 name=__codelineno-62-194 href=#__codelineno-62-194></a><span class=w>        </span><span class=nv>delay</span><span class=o>=</span><span class=nv>$2</span>
<a id=__codelineno-62-195 name=__codelineno-62-195 href=#__codelineno-62-195></a><span class=w>        </span><span class=nb>shift</span><span class=w> </span><span class=m>2</span>
<a id=__codelineno-62-196 name=__codelineno-62-196 href=#__codelineno-62-196></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-62-197 name=__codelineno-62-197 href=#__codelineno-62-197></a>
<a id=__codelineno-62-198 name=__codelineno-62-198 href=#__codelineno-62-198></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>kill_list</span><span class=o>=</span><span class=nv>$*</span>
<a id=__codelineno-62-199 name=__codelineno-62-199 href=#__codelineno-62-199></a>
<a id=__codelineno-62-200 name=__codelineno-62-200 href=#__codelineno-62-200></a><span class=w>    </span><span class=nv>kill_list</span><span class=o>=</span><span class=k>$(</span>__kill_pids_term_kill_checkpids<span class=w> </span><span class=nv>$base_stime</span><span class=w> </span><span class=nv>$kill_list</span><span class=k>)</span>
<a id=__codelineno-62-201 name=__codelineno-62-201 href=#__codelineno-62-201></a>
<a id=__codelineno-62-202 name=__codelineno-62-202 href=#__codelineno-62-202></a><span class=w>    </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=nv>$kill_list</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-62-203 name=__codelineno-62-203 href=#__codelineno-62-203></a>
<a id=__codelineno-62-204 name=__codelineno-62-204 href=#__codelineno-62-204></a><span class=w>    </span><span class=nb>kill</span><span class=w> </span>-TERM<span class=w> </span><span class=nv>$kill_list</span><span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-62-205 name=__codelineno-62-205 href=#__codelineno-62-205></a><span class=w>    </span>usleep<span class=w> </span><span class=m>100000</span>
<a id=__codelineno-62-206 name=__codelineno-62-206 href=#__codelineno-62-206></a>
<a id=__codelineno-62-207 name=__codelineno-62-207 href=#__codelineno-62-207></a><span class=w>    </span><span class=nv>kill_list</span><span class=o>=</span><span class=k>$(</span>__kill_pids_term_kill_checkpids<span class=w> </span><span class=nv>$base_stime</span><span class=w> </span><span class=nv>$kill_list</span><span class=k>)</span>
<a id=__codelineno-62-208 name=__codelineno-62-208 href=#__codelineno-62-208></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=nv>$kill_list</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-62-209 name=__codelineno-62-209 href=#__codelineno-62-209></a><span class=w>        </span><span class=k>while</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=nv>$try</span><span class=w> </span>-lt<span class=w> </span><span class=nv>$delay</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>do</span>
<a id=__codelineno-62-210 name=__codelineno-62-210 href=#__codelineno-62-210></a><span class=w>            </span>sleep<span class=w> </span><span class=m>1</span>
<a id=__codelineno-62-211 name=__codelineno-62-211 href=#__codelineno-62-211></a><span class=w>            </span><span class=nv>kill_list</span><span class=o>=</span><span class=k>$(</span>__kill_pids_term_kill_checkpids<span class=w> </span><span class=nv>$base_stime</span><span class=w> </span><span class=nv>$kill_list</span><span class=k>)</span>
<a id=__codelineno-62-212 name=__codelineno-62-212 href=#__codelineno-62-212></a><span class=w>            </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=nv>$kill_list</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>break</span>
<a id=__codelineno-62-213 name=__codelineno-62-213 href=#__codelineno-62-213></a><span class=w>            </span><span class=nb>let</span><span class=w> </span><span class=nv>try</span><span class=o>+=</span><span class=m>1</span>
<a id=__codelineno-62-214 name=__codelineno-62-214 href=#__codelineno-62-214></a><span class=w>        </span><span class=k>done</span>
<a id=__codelineno-62-215 name=__codelineno-62-215 href=#__codelineno-62-215></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=nv>$kill_list</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-62-216 name=__codelineno-62-216 href=#__codelineno-62-216></a><span class=w>            </span><span class=nb>kill</span><span class=w> </span>-KILL<span class=w> </span><span class=nv>$kill_list</span><span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-62-217 name=__codelineno-62-217 href=#__codelineno-62-217></a><span class=w>            </span>usleep<span class=w> </span><span class=m>100000</span>
<a id=__codelineno-62-218 name=__codelineno-62-218 href=#__codelineno-62-218></a><span class=w>            </span><span class=nv>kill_list</span><span class=o>=</span><span class=k>$(</span>__kill_pids_term_kill_checkpids<span class=w> </span><span class=nv>$base_stime</span><span class=w> </span><span class=nv>$kill_list</span><span class=k>)</span>
<a id=__codelineno-62-219 name=__codelineno-62-219 href=#__codelineno-62-219></a><span class=w>        </span><span class=k>fi</span>
<a id=__codelineno-62-220 name=__codelineno-62-220 href=#__codelineno-62-220></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-62-221 name=__codelineno-62-221 href=#__codelineno-62-221></a>
<a id=__codelineno-62-222 name=__codelineno-62-222 href=#__codelineno-62-222></a><span class=w>    </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=nv>$kill_list</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-62-223 name=__codelineno-62-223 href=#__codelineno-62-223></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-62-224 name=__codelineno-62-224 href=#__codelineno-62-224></a><span class=o>}</span>
<a id=__codelineno-62-225 name=__codelineno-62-225 href=#__codelineno-62-225></a>
<a id=__codelineno-62-226 name=__codelineno-62-226 href=#__codelineno-62-226></a><span class=c1># __proc_pids {program} [pidfile]</span>
<a id=__codelineno-62-227 name=__codelineno-62-227 href=#__codelineno-62-227></a><span class=c1># Set $pid to pids from /var/run* for {program}.  $pid should be declared</span>
<a id=__codelineno-62-228 name=__codelineno-62-228 href=#__codelineno-62-228></a><span class=c1># local in the caller.</span>
<a id=__codelineno-62-229 name=__codelineno-62-229 href=#__codelineno-62-229></a><span class=c1># Returns LSB exit code for the &#39;status&#39; action.</span>
<a id=__codelineno-62-230 name=__codelineno-62-230 href=#__codelineno-62-230></a>__pids_var_run<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-62-231 name=__codelineno-62-231 href=#__codelineno-62-231></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>base</span><span class=o>=</span><span class=si>${</span><span class=nv>1</span><span class=p>##*/</span><span class=si>}</span>
<a id=__codelineno-62-232 name=__codelineno-62-232 href=#__codelineno-62-232></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>pid_file</span><span class=o>=</span><span class=si>${</span><span class=nv>2</span><span class=k>:-</span><span class=p>/var/run/</span><span class=nv>$base</span><span class=p>.pid</span><span class=si>}</span>
<a id=__codelineno-62-233 name=__codelineno-62-233 href=#__codelineno-62-233></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>pid_dir</span><span class=o>=</span><span class=k>$(</span>/usr/bin/dirname<span class=w> </span><span class=nv>$pid_file</span><span class=w> </span>&gt;<span class=w> </span>/dev/null<span class=k>)</span>
<a id=__codelineno-62-234 name=__codelineno-62-234 href=#__codelineno-62-234></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>binary</span><span class=o>=</span><span class=nv>$3</span>
<a id=__codelineno-62-235 name=__codelineno-62-235 href=#__codelineno-62-235></a>
<a id=__codelineno-62-236 name=__codelineno-62-236 href=#__codelineno-62-236></a><span class=w>    </span><span class=o>[</span><span class=w> </span>-d<span class=w> </span><span class=s2>&quot;</span><span class=nv>$pid_dir</span><span class=s2>&quot;</span><span class=w> </span>-a<span class=w> </span>!<span class=w> </span>-r<span class=w> </span><span class=s2>&quot;</span><span class=nv>$pid_dir</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=m>4</span>
<a id=__codelineno-62-237 name=__codelineno-62-237 href=#__codelineno-62-237></a>
<a id=__codelineno-62-238 name=__codelineno-62-238 href=#__codelineno-62-238></a><span class=w>    </span><span class=nv>pid</span><span class=o>=</span>
<a id=__codelineno-62-239 name=__codelineno-62-239 href=#__codelineno-62-239></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-f<span class=w> </span><span class=s2>&quot;</span><span class=nv>$pid_file</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-62-240 name=__codelineno-62-240 href=#__codelineno-62-240></a><span class=w>            </span><span class=nb>local</span><span class=w> </span>line<span class=w> </span>p
<a id=__codelineno-62-241 name=__codelineno-62-241 href=#__codelineno-62-241></a>
<a id=__codelineno-62-242 name=__codelineno-62-242 href=#__codelineno-62-242></a><span class=w>        </span><span class=o>[</span><span class=w> </span>!<span class=w> </span>-r<span class=w> </span><span class=s2>&quot;</span><span class=nv>$pid_file</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=m>4</span><span class=w> </span><span class=c1># &quot;user had insufficient privilege&quot;</span>
<a id=__codelineno-62-243 name=__codelineno-62-243 href=#__codelineno-62-243></a><span class=w>        </span><span class=k>while</span><span class=w> </span>:<span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>do</span>
<a id=__codelineno-62-244 name=__codelineno-62-244 href=#__codelineno-62-244></a><span class=w>            </span><span class=nb>read</span><span class=w> </span>line
<a id=__codelineno-62-245 name=__codelineno-62-245 href=#__codelineno-62-245></a><span class=w>            </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=nv>$line</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>break</span>
<a id=__codelineno-62-246 name=__codelineno-62-246 href=#__codelineno-62-246></a><span class=w>            </span><span class=k>for</span><span class=w> </span>p<span class=w> </span><span class=k>in</span><span class=w> </span><span class=nv>$line</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>do</span>
<a id=__codelineno-62-247 name=__codelineno-62-247 href=#__codelineno-62-247></a><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>p</span><span class=p>//[0-9]/</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=o>[</span><span class=w> </span>-d<span class=w> </span><span class=s2>&quot;/proc/</span><span class=nv>$p</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-62-248 name=__codelineno-62-248 href=#__codelineno-62-248></a><span class=w>                    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=nv>$binary</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-62-249 name=__codelineno-62-249 href=#__codelineno-62-249></a><span class=w>                        </span><span class=nb>local</span><span class=w> </span><span class=nv>b</span><span class=o>=</span><span class=k>$(</span>readlink<span class=w> </span>/proc/<span class=nv>$p</span>/exe<span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span>-e<span class=w> </span><span class=s1>&#39;s/\s*(deleted)$//&#39;</span><span class=k>)</span>
<a id=__codelineno-62-250 name=__codelineno-62-250 href=#__codelineno-62-250></a><span class=w>                        </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$b</span><span class=s2>&quot;</span><span class=w> </span>!<span class=o>=</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$binary</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>continue</span>
<a id=__codelineno-62-251 name=__codelineno-62-251 href=#__codelineno-62-251></a><span class=w>                    </span><span class=k>fi</span>
<a id=__codelineno-62-252 name=__codelineno-62-252 href=#__codelineno-62-252></a><span class=w>                    </span><span class=nv>pid</span><span class=o>=</span><span class=s2>&quot;</span><span class=nv>$pid</span><span class=s2> </span><span class=nv>$p</span><span class=s2>&quot;</span>
<a id=__codelineno-62-253 name=__codelineno-62-253 href=#__codelineno-62-253></a><span class=w>                </span><span class=k>fi</span>
<a id=__codelineno-62-254 name=__codelineno-62-254 href=#__codelineno-62-254></a><span class=w>            </span><span class=k>done</span>
<a id=__codelineno-62-255 name=__codelineno-62-255 href=#__codelineno-62-255></a><span class=w>        </span><span class=k>done</span><span class=w> </span>&lt;<span class=w> </span><span class=s2>&quot;</span><span class=nv>$pid_file</span><span class=s2>&quot;</span>
<a id=__codelineno-62-256 name=__codelineno-62-256 href=#__codelineno-62-256></a>
<a id=__codelineno-62-257 name=__codelineno-62-257 href=#__codelineno-62-257></a><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=nv>$pid</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-62-258 name=__codelineno-62-258 href=#__codelineno-62-258></a><span class=w>                    </span><span class=k>return</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-62-259 name=__codelineno-62-259 href=#__codelineno-62-259></a><span class=w>            </span><span class=k>fi</span>
<a id=__codelineno-62-260 name=__codelineno-62-260 href=#__codelineno-62-260></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=m>1</span><span class=w> </span><span class=c1># &quot;Program is dead and /var/run pid file exists&quot;</span>
<a id=__codelineno-62-261 name=__codelineno-62-261 href=#__codelineno-62-261></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-62-262 name=__codelineno-62-262 href=#__codelineno-62-262></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=m>3</span><span class=w> </span><span class=c1># &quot;Program is not running&quot;</span>
<a id=__codelineno-62-263 name=__codelineno-62-263 href=#__codelineno-62-263></a><span class=o>}</span>
<a id=__codelineno-62-264 name=__codelineno-62-264 href=#__codelineno-62-264></a>
<a id=__codelineno-62-265 name=__codelineno-62-265 href=#__codelineno-62-265></a><span class=c1># Output PIDs of matching processes, found using pidof</span>
<a id=__codelineno-62-266 name=__codelineno-62-266 href=#__codelineno-62-266></a>__pids_pidof<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-62-267 name=__codelineno-62-267 href=#__codelineno-62-267></a><span class=w>    </span>pidof<span class=w> </span>-c<span class=w> </span>-m<span class=w> </span>-o<span class=w> </span><span class=nv>$$</span><span class=w> </span>-o<span class=w> </span><span class=nv>$PPID</span><span class=w> </span>-o<span class=w> </span>%PPID<span class=w> </span>-x<span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-62-268 name=__codelineno-62-268 href=#__codelineno-62-268></a><span class=w>        </span>pidof<span class=w> </span>-c<span class=w> </span>-m<span class=w> </span>-o<span class=w> </span><span class=nv>$$</span><span class=w> </span>-o<span class=w> </span><span class=nv>$PPID</span><span class=w> </span>-o<span class=w> </span>%PPID<span class=w> </span>-x<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>1</span><span class=p>##*/</span><span class=si>}</span><span class=s2>&quot;</span>
<a id=__codelineno-62-269 name=__codelineno-62-269 href=#__codelineno-62-269></a><span class=o>}</span>
<a id=__codelineno-62-270 name=__codelineno-62-270 href=#__codelineno-62-270></a>
<a id=__codelineno-62-271 name=__codelineno-62-271 href=#__codelineno-62-271></a>
<a id=__codelineno-62-272 name=__codelineno-62-272 href=#__codelineno-62-272></a><span class=c1># A function to start a program.</span>
<a id=__codelineno-62-273 name=__codelineno-62-273 href=#__codelineno-62-273></a>daemon<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-62-274 name=__codelineno-62-274 href=#__codelineno-62-274></a><span class=w>    </span><span class=c1># Test syntax.</span>
<a id=__codelineno-62-275 name=__codelineno-62-275 href=#__codelineno-62-275></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>gotbase</span><span class=o>=</span><span class=w> </span><span class=nv>force</span><span class=o>=</span><span class=w> </span>nicelevel<span class=w> </span>corelimit
<a id=__codelineno-62-276 name=__codelineno-62-276 href=#__codelineno-62-276></a><span class=w>    </span><span class=nb>local</span><span class=w> </span>pid<span class=w> </span><span class=nv>base</span><span class=o>=</span><span class=w> </span><span class=nv>user</span><span class=o>=</span><span class=w> </span><span class=nv>nice</span><span class=o>=</span><span class=w> </span><span class=nv>bg</span><span class=o>=</span><span class=w> </span><span class=nv>pid_file</span><span class=o>=</span>
<a id=__codelineno-62-277 name=__codelineno-62-277 href=#__codelineno-62-277></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>cgroup</span><span class=o>=</span>
<a id=__codelineno-62-278 name=__codelineno-62-278 href=#__codelineno-62-278></a><span class=w>    </span><span class=nv>nicelevel</span><span class=o>=</span><span class=m>0</span>
<a id=__codelineno-62-279 name=__codelineno-62-279 href=#__codelineno-62-279></a><span class=w>    </span><span class=k>while</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span>!<span class=o>=</span><span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>1</span><span class=p>##[-+]</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>do</span>
<a id=__codelineno-62-280 name=__codelineno-62-280 href=#__codelineno-62-280></a><span class=w>        </span><span class=k>case</span><span class=w> </span><span class=nv>$1</span><span class=w> </span><span class=k>in</span>
<a id=__codelineno-62-281 name=__codelineno-62-281 href=#__codelineno-62-281></a><span class=w>        </span><span class=s1>&#39;&#39;</span><span class=o>)</span>
<a id=__codelineno-62-282 name=__codelineno-62-282 href=#__codelineno-62-282></a><span class=w>            </span><span class=nb>echo</span><span class=w> </span>$<span class=s2>&quot;</span><span class=nv>$0</span><span class=s2>: Usage: daemon [+/-nicelevel] {program}&quot;</span><span class=w> </span><span class=s2>&quot;[arg1]...&quot;</span>
<a id=__codelineno-62-283 name=__codelineno-62-283 href=#__codelineno-62-283></a><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-62-284 name=__codelineno-62-284 href=#__codelineno-62-284></a><span class=w>            </span><span class=p>;;</span>
<a id=__codelineno-62-285 name=__codelineno-62-285 href=#__codelineno-62-285></a><span class=w>        </span>--check<span class=o>)</span>
<a id=__codelineno-62-286 name=__codelineno-62-286 href=#__codelineno-62-286></a><span class=w>            </span><span class=nv>base</span><span class=o>=</span><span class=nv>$2</span>
<a id=__codelineno-62-287 name=__codelineno-62-287 href=#__codelineno-62-287></a><span class=w>            </span><span class=nv>gotbase</span><span class=o>=</span><span class=s2>&quot;yes&quot;</span>
<a id=__codelineno-62-288 name=__codelineno-62-288 href=#__codelineno-62-288></a><span class=w>            </span><span class=nb>shift</span><span class=w> </span><span class=m>2</span>
<a id=__codelineno-62-289 name=__codelineno-62-289 href=#__codelineno-62-289></a><span class=w>            </span><span class=p>;;</span>
<a id=__codelineno-62-290 name=__codelineno-62-290 href=#__codelineno-62-290></a><span class=w>        </span>--check<span class=o>=</span>?*<span class=o>)</span>
<a id=__codelineno-62-291 name=__codelineno-62-291 href=#__codelineno-62-291></a><span class=w>            </span><span class=nv>base</span><span class=o>=</span><span class=si>${</span><span class=nv>1</span><span class=p>#--check=</span><span class=si>}</span>
<a id=__codelineno-62-292 name=__codelineno-62-292 href=#__codelineno-62-292></a><span class=w>            </span><span class=nv>gotbase</span><span class=o>=</span><span class=s2>&quot;yes&quot;</span>
<a id=__codelineno-62-293 name=__codelineno-62-293 href=#__codelineno-62-293></a><span class=w>            </span><span class=nb>shift</span>
<a id=__codelineno-62-294 name=__codelineno-62-294 href=#__codelineno-62-294></a><span class=w>            </span><span class=p>;;</span>
<a id=__codelineno-62-295 name=__codelineno-62-295 href=#__codelineno-62-295></a><span class=w>        </span>--user<span class=o>)</span>
<a id=__codelineno-62-296 name=__codelineno-62-296 href=#__codelineno-62-296></a><span class=w>            </span><span class=nv>user</span><span class=o>=</span><span class=nv>$2</span>
<a id=__codelineno-62-297 name=__codelineno-62-297 href=#__codelineno-62-297></a><span class=w>            </span><span class=nb>shift</span><span class=w> </span><span class=m>2</span>
<a id=__codelineno-62-298 name=__codelineno-62-298 href=#__codelineno-62-298></a><span class=w>            </span><span class=p>;;</span>
<a id=__codelineno-62-299 name=__codelineno-62-299 href=#__codelineno-62-299></a><span class=w>        </span>--user<span class=o>=</span>?*<span class=o>)</span>
<a id=__codelineno-62-300 name=__codelineno-62-300 href=#__codelineno-62-300></a><span class=w>            </span><span class=nv>user</span><span class=o>=</span><span class=si>${</span><span class=nv>1</span><span class=p>#--user=</span><span class=si>}</span>
<a id=__codelineno-62-301 name=__codelineno-62-301 href=#__codelineno-62-301></a><span class=w>            </span><span class=nb>shift</span>
<a id=__codelineno-62-302 name=__codelineno-62-302 href=#__codelineno-62-302></a><span class=w>            </span><span class=p>;;</span>
<a id=__codelineno-62-303 name=__codelineno-62-303 href=#__codelineno-62-303></a><span class=w>        </span>--pidfile<span class=o>)</span>
<a id=__codelineno-62-304 name=__codelineno-62-304 href=#__codelineno-62-304></a><span class=w>            </span><span class=nv>pid_file</span><span class=o>=</span><span class=nv>$2</span>
<a id=__codelineno-62-305 name=__codelineno-62-305 href=#__codelineno-62-305></a><span class=w>            </span><span class=nb>shift</span><span class=w> </span><span class=m>2</span>
<a id=__codelineno-62-306 name=__codelineno-62-306 href=#__codelineno-62-306></a><span class=w>            </span><span class=p>;;</span>
<a id=__codelineno-62-307 name=__codelineno-62-307 href=#__codelineno-62-307></a><span class=w>        </span>--pidfile<span class=o>=</span>?*<span class=o>)</span>
<a id=__codelineno-62-308 name=__codelineno-62-308 href=#__codelineno-62-308></a><span class=w>            </span><span class=nv>pid_file</span><span class=o>=</span><span class=si>${</span><span class=nv>1</span><span class=p>#--pidfile=</span><span class=si>}</span>
<a id=__codelineno-62-309 name=__codelineno-62-309 href=#__codelineno-62-309></a><span class=w>            </span><span class=nb>shift</span>
<a id=__codelineno-62-310 name=__codelineno-62-310 href=#__codelineno-62-310></a><span class=w>            </span><span class=p>;;</span>
<a id=__codelineno-62-311 name=__codelineno-62-311 href=#__codelineno-62-311></a><span class=w>        </span>--force<span class=o>)</span>
<a id=__codelineno-62-312 name=__codelineno-62-312 href=#__codelineno-62-312></a><span class=w>            </span><span class=nv>force</span><span class=o>=</span><span class=s2>&quot;force&quot;</span>
<a id=__codelineno-62-313 name=__codelineno-62-313 href=#__codelineno-62-313></a><span class=w>            </span><span class=nb>shift</span>
<a id=__codelineno-62-314 name=__codelineno-62-314 href=#__codelineno-62-314></a><span class=w>            </span><span class=p>;;</span>
<a id=__codelineno-62-315 name=__codelineno-62-315 href=#__codelineno-62-315></a><span class=w>        </span><span class=o>[</span>-+<span class=o>][</span><span class=m>0</span>-9<span class=o>]</span>*<span class=o>)</span>
<a id=__codelineno-62-316 name=__codelineno-62-316 href=#__codelineno-62-316></a><span class=w>            </span><span class=nv>nice</span><span class=o>=</span><span class=s2>&quot;nice -n </span><span class=nv>$1</span><span class=s2>&quot;</span>
<a id=__codelineno-62-317 name=__codelineno-62-317 href=#__codelineno-62-317></a><span class=w>            </span><span class=nb>shift</span>
<a id=__codelineno-62-318 name=__codelineno-62-318 href=#__codelineno-62-318></a><span class=w>            </span><span class=p>;;</span>
<a id=__codelineno-62-319 name=__codelineno-62-319 href=#__codelineno-62-319></a><span class=w>        </span>*<span class=o>)</span>
<a id=__codelineno-62-320 name=__codelineno-62-320 href=#__codelineno-62-320></a><span class=w>            </span><span class=nb>echo</span><span class=w> </span>$<span class=s2>&quot;</span><span class=nv>$0</span><span class=s2>: Usage: daemon [+/-nicelevel] {program}&quot;</span><span class=w> </span><span class=s2>&quot;[arg1]...&quot;</span>
<a id=__codelineno-62-321 name=__codelineno-62-321 href=#__codelineno-62-321></a><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-62-322 name=__codelineno-62-322 href=#__codelineno-62-322></a><span class=w>            </span><span class=p>;;</span>
<a id=__codelineno-62-323 name=__codelineno-62-323 href=#__codelineno-62-323></a><span class=w>      </span><span class=k>esac</span>
<a id=__codelineno-62-324 name=__codelineno-62-324 href=#__codelineno-62-324></a><span class=w>    </span><span class=k>done</span>
<a id=__codelineno-62-325 name=__codelineno-62-325 href=#__codelineno-62-325></a>
<a id=__codelineno-62-326 name=__codelineno-62-326 href=#__codelineno-62-326></a><span class=w>    </span><span class=c1># Save basename.</span>
<a id=__codelineno-62-327 name=__codelineno-62-327 href=#__codelineno-62-327></a><span class=w>    </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=nv>$gotbase</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nv>base</span><span class=o>=</span><span class=si>${</span><span class=nv>1</span><span class=p>##*/</span><span class=si>}</span>
<a id=__codelineno-62-328 name=__codelineno-62-328 href=#__codelineno-62-328></a>
<a id=__codelineno-62-329 name=__codelineno-62-329 href=#__codelineno-62-329></a><span class=w>    </span><span class=c1># See if it&#39;s already running. Look *only* at the pid file.</span>
<a id=__codelineno-62-330 name=__codelineno-62-330 href=#__codelineno-62-330></a><span class=w>    </span>__pids_var_run<span class=w> </span><span class=s2>&quot;</span><span class=nv>$base</span><span class=s2>&quot;</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$pid_file</span><span class=s2>&quot;</span>
<a id=__codelineno-62-331 name=__codelineno-62-331 href=#__codelineno-62-331></a>
<a id=__codelineno-62-332 name=__codelineno-62-332 href=#__codelineno-62-332></a><span class=w>    </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=nv>$pid</span><span class=s2>&quot;</span><span class=w> </span>-a<span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=nv>$force</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>return</span>
<a id=__codelineno-62-333 name=__codelineno-62-333 href=#__codelineno-62-333></a>
<a id=__codelineno-62-334 name=__codelineno-62-334 href=#__codelineno-62-334></a><span class=w>    </span><span class=c1># make sure it doesn&#39;t core dump anywhere unless requested</span>
<a id=__codelineno-62-335 name=__codelineno-62-335 href=#__codelineno-62-335></a><span class=w>    </span><span class=nv>corelimit</span><span class=o>=</span><span class=s2>&quot;ulimit -S -c </span><span class=si>${</span><span class=nv>DAEMON_COREFILE_LIMIT</span><span class=k>:-</span><span class=nv>0</span><span class=si>}</span><span class=s2>&quot;</span>
<a id=__codelineno-62-336 name=__codelineno-62-336 href=#__codelineno-62-336></a>
<a id=__codelineno-62-337 name=__codelineno-62-337 href=#__codelineno-62-337></a><span class=w>    </span><span class=c1># if they set NICELEVEL in /etc/sysconfig/foo, honor it</span>
<a id=__codelineno-62-338 name=__codelineno-62-338 href=#__codelineno-62-338></a><span class=w>    </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>NICELEVEL</span><span class=k>:-</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nv>nice</span><span class=o>=</span><span class=s2>&quot;nice -n </span><span class=nv>$NICELEVEL</span><span class=s2>&quot;</span>
<a id=__codelineno-62-339 name=__codelineno-62-339 href=#__codelineno-62-339></a>
<a id=__codelineno-62-340 name=__codelineno-62-340 href=#__codelineno-62-340></a><span class=w>    </span><span class=c1># if they set CGROUP_DAEMON in /etc/sysconfig/foo, honor it</span>
<a id=__codelineno-62-341 name=__codelineno-62-341 href=#__codelineno-62-341></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>CGROUP_DAEMON</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-62-342 name=__codelineno-62-342 href=#__codelineno-62-342></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>!<span class=w> </span>-x<span class=w> </span>/bin/cgexec<span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-62-343 name=__codelineno-62-343 href=#__codelineno-62-343></a><span class=w>            </span><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;Cgroups not installed&quot;</span><span class=p>;</span><span class=w> </span>warning
<a id=__codelineno-62-344 name=__codelineno-62-344 href=#__codelineno-62-344></a><span class=w>            </span><span class=nb>echo</span>
<a id=__codelineno-62-345 name=__codelineno-62-345 href=#__codelineno-62-345></a><span class=w>        </span><span class=k>else</span>
<a id=__codelineno-62-346 name=__codelineno-62-346 href=#__codelineno-62-346></a><span class=w>            </span><span class=nv>cgroup</span><span class=o>=</span><span class=s2>&quot;/bin/cgexec&quot;</span><span class=p>;</span>
<a id=__codelineno-62-347 name=__codelineno-62-347 href=#__codelineno-62-347></a><span class=w>            </span><span class=k>for</span><span class=w> </span>i<span class=w> </span><span class=k>in</span><span class=w> </span><span class=nv>$CGROUP_DAEMON</span><span class=p>;</span><span class=w> </span><span class=k>do</span>
<a id=__codelineno-62-348 name=__codelineno-62-348 href=#__codelineno-62-348></a><span class=w>                </span><span class=nv>cgroup</span><span class=o>=</span><span class=s2>&quot;</span><span class=nv>$cgroup</span><span class=s2> -g </span><span class=nv>$i</span><span class=s2>&quot;</span><span class=p>;</span>
<a id=__codelineno-62-349 name=__codelineno-62-349 href=#__codelineno-62-349></a><span class=w>            </span><span class=k>done</span>
<a id=__codelineno-62-350 name=__codelineno-62-350 href=#__codelineno-62-350></a><span class=w>        </span><span class=k>fi</span>
<a id=__codelineno-62-351 name=__codelineno-62-351 href=#__codelineno-62-351></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-62-352 name=__codelineno-62-352 href=#__codelineno-62-352></a>
<a id=__codelineno-62-353 name=__codelineno-62-353 href=#__codelineno-62-353></a><span class=w>    </span><span class=c1># Echo daemon</span>
<a id=__codelineno-62-354 name=__codelineno-62-354 href=#__codelineno-62-354></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>BOOTUP</span><span class=k>:-</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;verbose&quot;</span><span class=w> </span>-a<span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>LSB</span><span class=k>:-</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot; </span><span class=nv>$base</span><span class=s2>&quot;</span>
<a id=__codelineno-62-355 name=__codelineno-62-355 href=#__codelineno-62-355></a>
<a id=__codelineno-62-356 name=__codelineno-62-356 href=#__codelineno-62-356></a><span class=w>    </span><span class=c1># And start it up.</span>
<a id=__codelineno-62-357 name=__codelineno-62-357 href=#__codelineno-62-357></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=nv>$user</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-62-358 name=__codelineno-62-358 href=#__codelineno-62-358></a><span class=w>       </span><span class=nv>$cgroup</span><span class=w> </span><span class=nv>$nice</span><span class=w> </span>/bin/bash<span class=w> </span>-c<span class=w> </span><span class=s2>&quot;</span><span class=nv>$corelimit</span><span class=s2> &gt;/dev/null 2&gt;&amp;1 ; </span><span class=nv>$*</span><span class=s2>&quot;</span>
<a id=__codelineno-62-359 name=__codelineno-62-359 href=#__codelineno-62-359></a><span class=w>    </span><span class=k>else</span>
<a id=__codelineno-62-360 name=__codelineno-62-360 href=#__codelineno-62-360></a><span class=w>       </span><span class=nv>$cgroup</span><span class=w> </span><span class=nv>$nice</span><span class=w> </span>runuser<span class=w> </span>-s<span class=w> </span>/bin/bash<span class=w> </span><span class=nv>$user</span><span class=w> </span>-c<span class=w> </span><span class=s2>&quot;</span><span class=nv>$corelimit</span><span class=s2> &gt;/dev/null 2&gt;&amp;1 ; </span><span class=nv>$*</span><span class=s2>&quot;</span>
<a id=__codelineno-62-361 name=__codelineno-62-361 href=#__codelineno-62-361></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-62-362 name=__codelineno-62-362 href=#__codelineno-62-362></a>
<a id=__codelineno-62-363 name=__codelineno-62-363 href=#__codelineno-62-363></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$?</span><span class=s2>&quot;</span><span class=w> </span>-eq<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>success<span class=w> </span>$<span class=s2>&quot;</span><span class=nv>$base</span><span class=s2> startup&quot;</span><span class=w> </span><span class=o>||</span><span class=w> </span>failure<span class=w> </span>$<span class=s2>&quot;</span><span class=nv>$base</span><span class=s2> startup&quot;</span>
<a id=__codelineno-62-364 name=__codelineno-62-364 href=#__codelineno-62-364></a><span class=o>}</span>
<a id=__codelineno-62-365 name=__codelineno-62-365 href=#__codelineno-62-365></a>
<a id=__codelineno-62-366 name=__codelineno-62-366 href=#__codelineno-62-366></a><span class=c1># A function to stop a program.</span>
<a id=__codelineno-62-367 name=__codelineno-62-367 href=#__codelineno-62-367></a>killproc<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-62-368 name=__codelineno-62-368 href=#__codelineno-62-368></a><span class=w>    </span><span class=nb>local</span><span class=w> </span>RC<span class=w> </span><span class=nv>killlevel</span><span class=o>=</span><span class=w> </span>base<span class=w> </span>pid<span class=w> </span><span class=nv>pid_file</span><span class=o>=</span><span class=w> </span>delay<span class=w> </span>try<span class=w> </span><span class=nv>binary</span><span class=o>=</span>
<a id=__codelineno-62-369 name=__codelineno-62-369 href=#__codelineno-62-369></a>
<a id=__codelineno-62-370 name=__codelineno-62-370 href=#__codelineno-62-370></a><span class=w>    </span><span class=nv>RC</span><span class=o>=</span><span class=m>0</span><span class=p>;</span><span class=w> </span><span class=nv>delay</span><span class=o>=</span><span class=m>3</span><span class=p>;</span><span class=w> </span><span class=nv>try</span><span class=o>=</span><span class=m>0</span>
<a id=__codelineno-62-371 name=__codelineno-62-371 href=#__codelineno-62-371></a><span class=w>    </span><span class=c1># Test syntax.</span>
<a id=__codelineno-62-372 name=__codelineno-62-372 href=#__codelineno-62-372></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$#</span><span class=s2>&quot;</span><span class=w> </span>-eq<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-62-373 name=__codelineno-62-373 href=#__codelineno-62-373></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>$&quot;Usage: killproc [-p pidfile] [ -d delay] {program} [-signal]&quot;</span>
<a id=__codelineno-62-374 name=__codelineno-62-374 href=#__codelineno-62-374></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-62-375 name=__codelineno-62-375 href=#__codelineno-62-375></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-62-376 name=__codelineno-62-376 href=#__codelineno-62-376></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;-p&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-62-377 name=__codelineno-62-377 href=#__codelineno-62-377></a><span class=w>        </span><span class=nv>pid_file</span><span class=o>=</span><span class=nv>$2</span>
<a id=__codelineno-62-378 name=__codelineno-62-378 href=#__codelineno-62-378></a><span class=w>        </span><span class=nb>shift</span><span class=w> </span><span class=m>2</span>
<a id=__codelineno-62-379 name=__codelineno-62-379 href=#__codelineno-62-379></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-62-380 name=__codelineno-62-380 href=#__codelineno-62-380></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;-b&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-62-381 name=__codelineno-62-381 href=#__codelineno-62-381></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=nv>$pid_file</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-62-382 name=__codelineno-62-382 href=#__codelineno-62-382></a><span class=w>            </span><span class=nb>echo</span><span class=w> </span><span class=s2>$&quot;-b option can be used only with -p&quot;</span>
<a id=__codelineno-62-383 name=__codelineno-62-383 href=#__codelineno-62-383></a><span class=w>            </span><span class=nb>echo</span><span class=w> </span><span class=s2>$&quot;Usage: killproc -p pidfile -b binary program&quot;</span>
<a id=__codelineno-62-384 name=__codelineno-62-384 href=#__codelineno-62-384></a><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-62-385 name=__codelineno-62-385 href=#__codelineno-62-385></a><span class=w>        </span><span class=k>fi</span>
<a id=__codelineno-62-386 name=__codelineno-62-386 href=#__codelineno-62-386></a><span class=w>        </span><span class=nv>binary</span><span class=o>=</span><span class=nv>$2</span>
<a id=__codelineno-62-387 name=__codelineno-62-387 href=#__codelineno-62-387></a><span class=w>        </span><span class=nb>shift</span><span class=w> </span><span class=m>2</span>
<a id=__codelineno-62-388 name=__codelineno-62-388 href=#__codelineno-62-388></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-62-389 name=__codelineno-62-389 href=#__codelineno-62-389></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;-d&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-62-390 name=__codelineno-62-390 href=#__codelineno-62-390></a><span class=w>        </span><span class=nv>delay</span><span class=o>=</span><span class=k>$(</span><span class=nb>echo</span><span class=w> </span><span class=nv>$2</span><span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span>-v<span class=w> </span><span class=nv>RS</span><span class=o>=</span><span class=s1>&#39; &#39;</span><span class=w> </span>-v<span class=w> </span><span class=nv>IGNORECASE</span><span class=o>=</span><span class=m>1</span><span class=w> </span><span class=s1>&#39;{if($1!~/^[0-9.]+[smhd]?$/) exit 1;d=$1~/s$|^[0-9.]*$/?1:$1~/m$/?60:$1~/h$/?60*60:$1~/d$/?24*60*60:-1;if(d==-1) exit 1;delay+=d*$1} END {printf(&quot;%d&quot;,delay+0.5)}&#39;</span><span class=k>)</span>
<a id=__codelineno-62-391 name=__codelineno-62-391 href=#__codelineno-62-391></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$?</span><span class=s2>&quot;</span><span class=w> </span>-eq<span class=w> </span><span class=m>1</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-62-392 name=__codelineno-62-392 href=#__codelineno-62-392></a><span class=w>            </span><span class=nb>echo</span><span class=w> </span><span class=s2>$&quot;Usage: killproc [-p pidfile] [ -d delay] {program} [-signal]&quot;</span>
<a id=__codelineno-62-393 name=__codelineno-62-393 href=#__codelineno-62-393></a><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-62-394 name=__codelineno-62-394 href=#__codelineno-62-394></a><span class=w>        </span><span class=k>fi</span>
<a id=__codelineno-62-395 name=__codelineno-62-395 href=#__codelineno-62-395></a><span class=w>        </span><span class=nb>shift</span><span class=w> </span><span class=m>2</span>
<a id=__codelineno-62-396 name=__codelineno-62-396 href=#__codelineno-62-396></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-62-397 name=__codelineno-62-397 href=#__codelineno-62-397></a>
<a id=__codelineno-62-398 name=__codelineno-62-398 href=#__codelineno-62-398></a>
<a id=__codelineno-62-399 name=__codelineno-62-399 href=#__codelineno-62-399></a><span class=w>    </span><span class=c1># check for second arg to be kill level</span>
<a id=__codelineno-62-400 name=__codelineno-62-400 href=#__codelineno-62-400></a><span class=w>    </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>2</span><span class=k>:-</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nv>killlevel</span><span class=o>=</span><span class=nv>$2</span>
<a id=__codelineno-62-401 name=__codelineno-62-401 href=#__codelineno-62-401></a>
<a id=__codelineno-62-402 name=__codelineno-62-402 href=#__codelineno-62-402></a><span class=w>    </span><span class=c1># Save basename.</span>
<a id=__codelineno-62-403 name=__codelineno-62-403 href=#__codelineno-62-403></a><span class=w>    </span><span class=nv>base</span><span class=o>=</span><span class=si>${</span><span class=nv>1</span><span class=p>##*/</span><span class=si>}</span>
<a id=__codelineno-62-404 name=__codelineno-62-404 href=#__codelineno-62-404></a>
<a id=__codelineno-62-405 name=__codelineno-62-405 href=#__codelineno-62-405></a><span class=w>    </span><span class=c1># Find pid.</span>
<a id=__codelineno-62-406 name=__codelineno-62-406 href=#__codelineno-62-406></a><span class=w>    </span>__pids_var_run<span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$pid_file</span><span class=s2>&quot;</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$binary</span><span class=s2>&quot;</span>
<a id=__codelineno-62-407 name=__codelineno-62-407 href=#__codelineno-62-407></a><span class=w>    </span><span class=nv>RC</span><span class=o>=</span><span class=nv>$?</span>
<a id=__codelineno-62-408 name=__codelineno-62-408 href=#__codelineno-62-408></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=nv>$pid</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-62-409 name=__codelineno-62-409 href=#__codelineno-62-409></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=nv>$pid_file</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-62-410 name=__codelineno-62-410 href=#__codelineno-62-410></a><span class=w>            </span><span class=nv>pid</span><span class=o>=</span><span class=s2>&quot;</span><span class=k>$(</span>__pids_pidof<span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=k>)</span><span class=s2>&quot;</span>
<a id=__codelineno-62-411 name=__codelineno-62-411 href=#__codelineno-62-411></a><span class=w>        </span><span class=k>else</span>
<a id=__codelineno-62-412 name=__codelineno-62-412 href=#__codelineno-62-412></a><span class=w>            </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$RC</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;4&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=o>{</span><span class=w> </span>failure<span class=w> </span>$<span class=s2>&quot;</span><span class=nv>$base</span><span class=s2> shutdown&quot;</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=nv>$RC</span><span class=w> </span><span class=p>;</span><span class=o>}</span>
<a id=__codelineno-62-413 name=__codelineno-62-413 href=#__codelineno-62-413></a><span class=w>        </span><span class=k>fi</span>
<a id=__codelineno-62-414 name=__codelineno-62-414 href=#__codelineno-62-414></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-62-415 name=__codelineno-62-415 href=#__codelineno-62-415></a>
<a id=__codelineno-62-416 name=__codelineno-62-416 href=#__codelineno-62-416></a><span class=w>    </span><span class=c1># Kill it.</span>
<a id=__codelineno-62-417 name=__codelineno-62-417 href=#__codelineno-62-417></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=nv>$pid</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-62-418 name=__codelineno-62-418 href=#__codelineno-62-418></a><span class=w>        </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$BOOTUP</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;verbose&quot;</span><span class=w> </span>-a<span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>LSB</span><span class=k>:-</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=nv>$base</span><span class=s2> &quot;</span>
<a id=__codelineno-62-419 name=__codelineno-62-419 href=#__codelineno-62-419></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=nv>$killlevel</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-62-420 name=__codelineno-62-420 href=#__codelineno-62-420></a><span class=w>            </span>__kill_pids_term_kill<span class=w> </span>-d<span class=w> </span><span class=nv>$delay</span><span class=w> </span><span class=nv>$pid</span>
<a id=__codelineno-62-421 name=__codelineno-62-421 href=#__codelineno-62-421></a><span class=w>            </span><span class=nv>RC</span><span class=o>=</span><span class=nv>$?</span>
<a id=__codelineno-62-422 name=__codelineno-62-422 href=#__codelineno-62-422></a><span class=w>            </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$RC</span><span class=s2>&quot;</span><span class=w> </span>-eq<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>success<span class=w> </span>$<span class=s2>&quot;</span><span class=nv>$base</span><span class=s2> shutdown&quot;</span><span class=w> </span><span class=o>||</span><span class=w> </span>failure<span class=w> </span>$<span class=s2>&quot;</span><span class=nv>$base</span><span class=s2> shutdown&quot;</span>
<a id=__codelineno-62-423 name=__codelineno-62-423 href=#__codelineno-62-423></a><span class=w>        </span><span class=c1># use specified level only</span>
<a id=__codelineno-62-424 name=__codelineno-62-424 href=#__codelineno-62-424></a><span class=w>        </span><span class=k>else</span>
<a id=__codelineno-62-425 name=__codelineno-62-425 href=#__codelineno-62-425></a><span class=w>            </span><span class=k>if</span><span class=w> </span>checkpid<span class=w> </span><span class=nv>$pid</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-62-426 name=__codelineno-62-426 href=#__codelineno-62-426></a><span class=w>                </span><span class=nb>kill</span><span class=w> </span><span class=nv>$killlevel</span><span class=w> </span><span class=nv>$pid</span><span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-62-427 name=__codelineno-62-427 href=#__codelineno-62-427></a><span class=w>                </span><span class=nv>RC</span><span class=o>=</span><span class=nv>$?</span>
<a id=__codelineno-62-428 name=__codelineno-62-428 href=#__codelineno-62-428></a><span class=w>                </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$RC</span><span class=s2>&quot;</span><span class=w> </span>-eq<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>success<span class=w> </span>$<span class=s2>&quot;</span><span class=nv>$base</span><span class=s2> </span><span class=nv>$killlevel</span><span class=s2>&quot;</span><span class=w> </span><span class=o>||</span><span class=w> </span>failure<span class=w> </span>$<span class=s2>&quot;</span><span class=nv>$base</span><span class=s2> </span><span class=nv>$killlevel</span><span class=s2>&quot;</span>
<a id=__codelineno-62-429 name=__codelineno-62-429 href=#__codelineno-62-429></a><span class=w>            </span><span class=k>elif</span><span class=w> </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>LSB</span><span class=k>:-</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-62-430 name=__codelineno-62-430 href=#__codelineno-62-430></a><span class=w>                </span><span class=nv>RC</span><span class=o>=</span><span class=m>7</span><span class=w> </span><span class=c1># Program is not running</span>
<a id=__codelineno-62-431 name=__codelineno-62-431 href=#__codelineno-62-431></a><span class=w>            </span><span class=k>fi</span>
<a id=__codelineno-62-432 name=__codelineno-62-432 href=#__codelineno-62-432></a><span class=w>        </span><span class=k>fi</span>
<a id=__codelineno-62-433 name=__codelineno-62-433 href=#__codelineno-62-433></a><span class=w>    </span><span class=k>else</span>
<a id=__codelineno-62-434 name=__codelineno-62-434 href=#__codelineno-62-434></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>LSB</span><span class=k>:-</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span>-a<span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=nv>$killlevel</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-62-435 name=__codelineno-62-435 href=#__codelineno-62-435></a><span class=w>            </span><span class=nv>RC</span><span class=o>=</span><span class=m>7</span><span class=w> </span><span class=c1># Program is not running</span>
<a id=__codelineno-62-436 name=__codelineno-62-436 href=#__codelineno-62-436></a><span class=w>        </span><span class=k>else</span>
<a id=__codelineno-62-437 name=__codelineno-62-437 href=#__codelineno-62-437></a><span class=w>            </span>failure<span class=w> </span>$<span class=s2>&quot;</span><span class=nv>$base</span><span class=s2> shutdown&quot;</span>
<a id=__codelineno-62-438 name=__codelineno-62-438 href=#__codelineno-62-438></a><span class=w>            </span><span class=nv>RC</span><span class=o>=</span><span class=m>0</span>
<a id=__codelineno-62-439 name=__codelineno-62-439 href=#__codelineno-62-439></a><span class=w>        </span><span class=k>fi</span>
<a id=__codelineno-62-440 name=__codelineno-62-440 href=#__codelineno-62-440></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-62-441 name=__codelineno-62-441 href=#__codelineno-62-441></a>
<a id=__codelineno-62-442 name=__codelineno-62-442 href=#__codelineno-62-442></a><span class=w>    </span><span class=c1># Remove pid file if any.</span>
<a id=__codelineno-62-443 name=__codelineno-62-443 href=#__codelineno-62-443></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=nv>$killlevel</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-62-444 name=__codelineno-62-444 href=#__codelineno-62-444></a><span class=w>        </span>rm<span class=w> </span>-f<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>pid_file</span><span class=k>:-</span><span class=p>/var/run/</span><span class=nv>$base</span><span class=p>.pid</span><span class=si>}</span><span class=s2>&quot;</span>
<a id=__codelineno-62-445 name=__codelineno-62-445 href=#__codelineno-62-445></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-62-446 name=__codelineno-62-446 href=#__codelineno-62-446></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nv>$RC</span>
<a id=__codelineno-62-447 name=__codelineno-62-447 href=#__codelineno-62-447></a><span class=o>}</span>
<a id=__codelineno-62-448 name=__codelineno-62-448 href=#__codelineno-62-448></a>
<a id=__codelineno-62-449 name=__codelineno-62-449 href=#__codelineno-62-449></a><span class=c1># A function to find the pid of a program. Looks *only* at the pidfile</span>
<a id=__codelineno-62-450 name=__codelineno-62-450 href=#__codelineno-62-450></a>pidfileofproc<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-62-451 name=__codelineno-62-451 href=#__codelineno-62-451></a><span class=w>    </span><span class=nb>local</span><span class=w> </span>pid
<a id=__codelineno-62-452 name=__codelineno-62-452 href=#__codelineno-62-452></a>
<a id=__codelineno-62-453 name=__codelineno-62-453 href=#__codelineno-62-453></a><span class=w>    </span><span class=c1># Test syntax.</span>
<a id=__codelineno-62-454 name=__codelineno-62-454 href=#__codelineno-62-454></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$#</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-62-455 name=__codelineno-62-455 href=#__codelineno-62-455></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>$&quot;Usage: pidfileofproc {program}&quot;</span>
<a id=__codelineno-62-456 name=__codelineno-62-456 href=#__codelineno-62-456></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-62-457 name=__codelineno-62-457 href=#__codelineno-62-457></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-62-458 name=__codelineno-62-458 href=#__codelineno-62-458></a>
<a id=__codelineno-62-459 name=__codelineno-62-459 href=#__codelineno-62-459></a><span class=w>    </span>__pids_var_run<span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span>
<a id=__codelineno-62-460 name=__codelineno-62-460 href=#__codelineno-62-460></a><span class=w>    </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=nv>$pid</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=nv>$pid</span>
<a id=__codelineno-62-461 name=__codelineno-62-461 href=#__codelineno-62-461></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-62-462 name=__codelineno-62-462 href=#__codelineno-62-462></a><span class=o>}</span>
<a id=__codelineno-62-463 name=__codelineno-62-463 href=#__codelineno-62-463></a>
<a id=__codelineno-62-464 name=__codelineno-62-464 href=#__codelineno-62-464></a><span class=c1># A function to find the pid of a program.</span>
<a id=__codelineno-62-465 name=__codelineno-62-465 href=#__codelineno-62-465></a>pidofproc<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-62-466 name=__codelineno-62-466 href=#__codelineno-62-466></a><span class=w>    </span><span class=nb>local</span><span class=w> </span>RC<span class=w> </span>pid<span class=w> </span><span class=nv>pid_file</span><span class=o>=</span>
<a id=__codelineno-62-467 name=__codelineno-62-467 href=#__codelineno-62-467></a>
<a id=__codelineno-62-468 name=__codelineno-62-468 href=#__codelineno-62-468></a><span class=w>    </span><span class=c1># Test syntax.</span>
<a id=__codelineno-62-469 name=__codelineno-62-469 href=#__codelineno-62-469></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$#</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-62-470 name=__codelineno-62-470 href=#__codelineno-62-470></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>$&quot;Usage: pidofproc [-p pidfile] {program}&quot;</span>
<a id=__codelineno-62-471 name=__codelineno-62-471 href=#__codelineno-62-471></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-62-472 name=__codelineno-62-472 href=#__codelineno-62-472></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-62-473 name=__codelineno-62-473 href=#__codelineno-62-473></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;-p&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-62-474 name=__codelineno-62-474 href=#__codelineno-62-474></a><span class=w>        </span><span class=nv>pid_file</span><span class=o>=</span><span class=nv>$2</span>
<a id=__codelineno-62-475 name=__codelineno-62-475 href=#__codelineno-62-475></a><span class=w>        </span><span class=nb>shift</span><span class=w> </span><span class=m>2</span>
<a id=__codelineno-62-476 name=__codelineno-62-476 href=#__codelineno-62-476></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-62-477 name=__codelineno-62-477 href=#__codelineno-62-477></a><span class=w>    </span><span class=nv>fail_code</span><span class=o>=</span><span class=m>3</span><span class=w> </span><span class=c1># &quot;Program is not running&quot;</span>
<a id=__codelineno-62-478 name=__codelineno-62-478 href=#__codelineno-62-478></a>
<a id=__codelineno-62-479 name=__codelineno-62-479 href=#__codelineno-62-479></a><span class=w>    </span><span class=c1># First try &quot;/var/run/*.pid&quot; files</span>
<a id=__codelineno-62-480 name=__codelineno-62-480 href=#__codelineno-62-480></a><span class=w>    </span>__pids_var_run<span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$pid_file</span><span class=s2>&quot;</span>
<a id=__codelineno-62-481 name=__codelineno-62-481 href=#__codelineno-62-481></a><span class=w>    </span><span class=nv>RC</span><span class=o>=</span><span class=nv>$?</span>
<a id=__codelineno-62-482 name=__codelineno-62-482 href=#__codelineno-62-482></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=nv>$pid</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-62-483 name=__codelineno-62-483 href=#__codelineno-62-483></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=nv>$pid</span>
<a id=__codelineno-62-484 name=__codelineno-62-484 href=#__codelineno-62-484></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-62-485 name=__codelineno-62-485 href=#__codelineno-62-485></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-62-486 name=__codelineno-62-486 href=#__codelineno-62-486></a>
<a id=__codelineno-62-487 name=__codelineno-62-487 href=#__codelineno-62-487></a><span class=w>    </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=nv>$pid_file</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=nv>$RC</span>
<a id=__codelineno-62-488 name=__codelineno-62-488 href=#__codelineno-62-488></a><span class=w>    </span>__pids_pidof<span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=nv>$RC</span>
<a id=__codelineno-62-489 name=__codelineno-62-489 href=#__codelineno-62-489></a><span class=o>}</span>
<a id=__codelineno-62-490 name=__codelineno-62-490 href=#__codelineno-62-490></a>
<a id=__codelineno-62-491 name=__codelineno-62-491 href=#__codelineno-62-491></a>status<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-62-492 name=__codelineno-62-492 href=#__codelineno-62-492></a><span class=w>    </span><span class=nb>local</span><span class=w> </span>base<span class=w> </span>pid<span class=w> </span><span class=nv>lock_file</span><span class=o>=</span><span class=w> </span><span class=nv>pid_file</span><span class=o>=</span><span class=w> </span><span class=nv>binary</span><span class=o>=</span>
<a id=__codelineno-62-493 name=__codelineno-62-493 href=#__codelineno-62-493></a>
<a id=__codelineno-62-494 name=__codelineno-62-494 href=#__codelineno-62-494></a><span class=w>    </span><span class=c1># Test syntax.</span>
<a id=__codelineno-62-495 name=__codelineno-62-495 href=#__codelineno-62-495></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$#</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-62-496 name=__codelineno-62-496 href=#__codelineno-62-496></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>$&quot;Usage: status [-p pidfile] {program}&quot;</span>
<a id=__codelineno-62-497 name=__codelineno-62-497 href=#__codelineno-62-497></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-62-498 name=__codelineno-62-498 href=#__codelineno-62-498></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-62-499 name=__codelineno-62-499 href=#__codelineno-62-499></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;-p&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-62-500 name=__codelineno-62-500 href=#__codelineno-62-500></a><span class=w>        </span><span class=nv>pid_file</span><span class=o>=</span><span class=nv>$2</span>
<a id=__codelineno-62-501 name=__codelineno-62-501 href=#__codelineno-62-501></a><span class=w>        </span><span class=nb>shift</span><span class=w> </span><span class=m>2</span>
<a id=__codelineno-62-502 name=__codelineno-62-502 href=#__codelineno-62-502></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-62-503 name=__codelineno-62-503 href=#__codelineno-62-503></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;-l&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-62-504 name=__codelineno-62-504 href=#__codelineno-62-504></a><span class=w>        </span><span class=nv>lock_file</span><span class=o>=</span><span class=nv>$2</span>
<a id=__codelineno-62-505 name=__codelineno-62-505 href=#__codelineno-62-505></a><span class=w>        </span><span class=nb>shift</span><span class=w> </span><span class=m>2</span>
<a id=__codelineno-62-506 name=__codelineno-62-506 href=#__codelineno-62-506></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-62-507 name=__codelineno-62-507 href=#__codelineno-62-507></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;-b&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-62-508 name=__codelineno-62-508 href=#__codelineno-62-508></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=nv>$pid_file</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-62-509 name=__codelineno-62-509 href=#__codelineno-62-509></a><span class=w>            </span><span class=nb>echo</span><span class=w> </span><span class=s2>$&quot;-b option can be used only with -p&quot;</span>
<a id=__codelineno-62-510 name=__codelineno-62-510 href=#__codelineno-62-510></a><span class=w>            </span><span class=nb>echo</span><span class=w> </span><span class=s2>$&quot;Usage: status -p pidfile -b binary program&quot;</span>
<a id=__codelineno-62-511 name=__codelineno-62-511 href=#__codelineno-62-511></a><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-62-512 name=__codelineno-62-512 href=#__codelineno-62-512></a><span class=w>        </span><span class=k>fi</span>
<a id=__codelineno-62-513 name=__codelineno-62-513 href=#__codelineno-62-513></a><span class=w>        </span><span class=nv>binary</span><span class=o>=</span><span class=nv>$2</span>
<a id=__codelineno-62-514 name=__codelineno-62-514 href=#__codelineno-62-514></a><span class=w>        </span><span class=nb>shift</span><span class=w> </span><span class=m>2</span>
<a id=__codelineno-62-515 name=__codelineno-62-515 href=#__codelineno-62-515></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-62-516 name=__codelineno-62-516 href=#__codelineno-62-516></a><span class=w>    </span><span class=nv>base</span><span class=o>=</span><span class=si>${</span><span class=nv>1</span><span class=p>##*/</span><span class=si>}</span>
<a id=__codelineno-62-517 name=__codelineno-62-517 href=#__codelineno-62-517></a>
<a id=__codelineno-62-518 name=__codelineno-62-518 href=#__codelineno-62-518></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$_use_systemctl</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;1&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-62-519 name=__codelineno-62-519 href=#__codelineno-62-519></a><span class=w>        </span>systemctl<span class=w> </span>status<span class=w> </span><span class=si>${</span><span class=nv>0</span><span class=p>##*/</span><span class=si>}</span>.service
<a id=__codelineno-62-520 name=__codelineno-62-520 href=#__codelineno-62-520></a><span class=w>        </span><span class=nv>ret</span><span class=o>=</span><span class=nv>$?</span>
<a id=__codelineno-62-521 name=__codelineno-62-521 href=#__codelineno-62-521></a><span class=w>        </span><span class=c1># LSB daemons that dies abnormally in systemd looks alive in systemd&#39;s eyes due to RemainAfterExit=yes</span>
<a id=__codelineno-62-522 name=__codelineno-62-522 href=#__codelineno-62-522></a><span class=w>        </span><span class=c1># lets adjust the reality a little bit</span>
<a id=__codelineno-62-523 name=__codelineno-62-523 href=#__codelineno-62-523></a><span class=w>        </span><span class=k>if</span><span class=w> </span>systemctl<span class=w> </span>show<span class=w> </span>-p<span class=w> </span>ActiveState<span class=w> </span><span class=si>${</span><span class=nv>0</span><span class=p>##*/</span><span class=si>}</span>.service<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>-q<span class=w> </span><span class=s1>&#39;=active$&#39;</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-62-524 name=__codelineno-62-524 href=#__codelineno-62-524></a><span class=w>        </span>systemctl<span class=w> </span>show<span class=w> </span>-p<span class=w> </span>SubState<span class=w> </span><span class=si>${</span><span class=nv>0</span><span class=p>##*/</span><span class=si>}</span>.service<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>-q<span class=w> </span><span class=s1>&#39;=exited$&#39;</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-62-525 name=__codelineno-62-525 href=#__codelineno-62-525></a><span class=w>            </span><span class=nv>ret</span><span class=o>=</span><span class=m>3</span>
<a id=__codelineno-62-526 name=__codelineno-62-526 href=#__codelineno-62-526></a><span class=w>        </span><span class=k>fi</span>
<a id=__codelineno-62-527 name=__codelineno-62-527 href=#__codelineno-62-527></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nv>$ret</span>
<a id=__codelineno-62-528 name=__codelineno-62-528 href=#__codelineno-62-528></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-62-529 name=__codelineno-62-529 href=#__codelineno-62-529></a>
<a id=__codelineno-62-530 name=__codelineno-62-530 href=#__codelineno-62-530></a><span class=w>    </span><span class=c1># First try &quot;pidof&quot;</span>
<a id=__codelineno-62-531 name=__codelineno-62-531 href=#__codelineno-62-531></a><span class=w>    </span>__pids_var_run<span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$pid_file</span><span class=s2>&quot;</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$binary</span><span class=s2>&quot;</span>
<a id=__codelineno-62-532 name=__codelineno-62-532 href=#__codelineno-62-532></a><span class=w>    </span><span class=nv>RC</span><span class=o>=</span><span class=nv>$?</span>
<a id=__codelineno-62-533 name=__codelineno-62-533 href=#__codelineno-62-533></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=nv>$pid_file</span><span class=s2>&quot;</span><span class=w> </span>-a<span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=nv>$pid</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-62-534 name=__codelineno-62-534 href=#__codelineno-62-534></a><span class=w>        </span><span class=nv>pid</span><span class=o>=</span><span class=s2>&quot;</span><span class=k>$(</span>__pids_pidof<span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=k>)</span><span class=s2>&quot;</span>
<a id=__codelineno-62-535 name=__codelineno-62-535 href=#__codelineno-62-535></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-62-536 name=__codelineno-62-536 href=#__codelineno-62-536></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=nv>$pid</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-62-537 name=__codelineno-62-537 href=#__codelineno-62-537></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span>$<span class=s2>&quot;</span><span class=si>${</span><span class=nv>base</span><span class=si>}</span><span class=s2> (pid </span><span class=nv>$pid</span><span class=s2>) is running...&quot;</span>
<a id=__codelineno-62-538 name=__codelineno-62-538 href=#__codelineno-62-538></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-62-539 name=__codelineno-62-539 href=#__codelineno-62-539></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-62-540 name=__codelineno-62-540 href=#__codelineno-62-540></a>
<a id=__codelineno-62-541 name=__codelineno-62-541 href=#__codelineno-62-541></a><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$RC</span><span class=s2>&quot;</span><span class=w> </span><span class=k>in</span>
<a id=__codelineno-62-542 name=__codelineno-62-542 href=#__codelineno-62-542></a><span class=w>    </span><span class=m>0</span><span class=o>)</span>
<a id=__codelineno-62-543 name=__codelineno-62-543 href=#__codelineno-62-543></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span>$<span class=s2>&quot;</span><span class=si>${</span><span class=nv>base</span><span class=si>}</span><span class=s2> (pid </span><span class=nv>$pid</span><span class=s2>) is running...&quot;</span>
<a id=__codelineno-62-544 name=__codelineno-62-544 href=#__codelineno-62-544></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-62-545 name=__codelineno-62-545 href=#__codelineno-62-545></a><span class=w>        </span><span class=p>;;</span>
<a id=__codelineno-62-546 name=__codelineno-62-546 href=#__codelineno-62-546></a><span class=w>    </span><span class=m>1</span><span class=o>)</span>
<a id=__codelineno-62-547 name=__codelineno-62-547 href=#__codelineno-62-547></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span>$<span class=s2>&quot;</span><span class=si>${</span><span class=nv>base</span><span class=si>}</span><span class=s2> dead but pid file exists&quot;</span>
<a id=__codelineno-62-548 name=__codelineno-62-548 href=#__codelineno-62-548></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-62-549 name=__codelineno-62-549 href=#__codelineno-62-549></a><span class=w>        </span><span class=p>;;</span>
<a id=__codelineno-62-550 name=__codelineno-62-550 href=#__codelineno-62-550></a><span class=w>    </span><span class=m>4</span><span class=o>)</span>
<a id=__codelineno-62-551 name=__codelineno-62-551 href=#__codelineno-62-551></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span>$<span class=s2>&quot;</span><span class=si>${</span><span class=nv>base</span><span class=si>}</span><span class=s2> status unknown due to insufficient privileges.&quot;</span>
<a id=__codelineno-62-552 name=__codelineno-62-552 href=#__codelineno-62-552></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=m>4</span>
<a id=__codelineno-62-553 name=__codelineno-62-553 href=#__codelineno-62-553></a><span class=w>        </span><span class=p>;;</span>
<a id=__codelineno-62-554 name=__codelineno-62-554 href=#__codelineno-62-554></a><span class=w>    </span><span class=k>esac</span>
<a id=__codelineno-62-555 name=__codelineno-62-555 href=#__codelineno-62-555></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>lock_file</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-62-556 name=__codelineno-62-556 href=#__codelineno-62-556></a><span class=w>        </span><span class=nv>lock_file</span><span class=o>=</span><span class=si>${</span><span class=nv>base</span><span class=si>}</span>
<a id=__codelineno-62-557 name=__codelineno-62-557 href=#__codelineno-62-557></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-62-558 name=__codelineno-62-558 href=#__codelineno-62-558></a><span class=w>    </span><span class=c1># See if /var/lock/subsys/${lock_file} exists</span>
<a id=__codelineno-62-559 name=__codelineno-62-559 href=#__codelineno-62-559></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-f<span class=w> </span>/var/lock/subsys/<span class=si>${</span><span class=nv>lock_file</span><span class=si>}</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-62-560 name=__codelineno-62-560 href=#__codelineno-62-560></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span>$<span class=s2>&quot;</span><span class=si>${</span><span class=nv>base</span><span class=si>}</span><span class=s2> dead but subsys locked&quot;</span>
<a id=__codelineno-62-561 name=__codelineno-62-561 href=#__codelineno-62-561></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=m>2</span>
<a id=__codelineno-62-562 name=__codelineno-62-562 href=#__codelineno-62-562></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-62-563 name=__codelineno-62-563 href=#__codelineno-62-563></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>$<span class=s2>&quot;</span><span class=si>${</span><span class=nv>base</span><span class=si>}</span><span class=s2> is stopped&quot;</span>
<a id=__codelineno-62-564 name=__codelineno-62-564 href=#__codelineno-62-564></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=m>3</span>
<a id=__codelineno-62-565 name=__codelineno-62-565 href=#__codelineno-62-565></a><span class=o>}</span>
<a id=__codelineno-62-566 name=__codelineno-62-566 href=#__codelineno-62-566></a>
<a id=__codelineno-62-567 name=__codelineno-62-567 href=#__codelineno-62-567></a>echo_success<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-62-568 name=__codelineno-62-568 href=#__codelineno-62-568></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$BOOTUP</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;color&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nv>$MOVE_TO_COL</span>
<a id=__codelineno-62-569 name=__codelineno-62-569 href=#__codelineno-62-569></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;[&quot;</span>
<a id=__codelineno-62-570 name=__codelineno-62-570 href=#__codelineno-62-570></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$BOOTUP</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;color&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nv>$SETCOLOR_SUCCESS</span>
<a id=__codelineno-62-571 name=__codelineno-62-571 href=#__codelineno-62-571></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s2>$&quot;  OK  &quot;</span>
<a id=__codelineno-62-572 name=__codelineno-62-572 href=#__codelineno-62-572></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$BOOTUP</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;color&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nv>$SETCOLOR_NORMAL</span>
<a id=__codelineno-62-573 name=__codelineno-62-573 href=#__codelineno-62-573></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;]&quot;</span>
<a id=__codelineno-62-574 name=__codelineno-62-574 href=#__codelineno-62-574></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-ne<span class=w> </span><span class=s2>&quot;\r&quot;</span>
<a id=__codelineno-62-575 name=__codelineno-62-575 href=#__codelineno-62-575></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-62-576 name=__codelineno-62-576 href=#__codelineno-62-576></a><span class=o>}</span>
<a id=__codelineno-62-577 name=__codelineno-62-577 href=#__codelineno-62-577></a>
<a id=__codelineno-62-578 name=__codelineno-62-578 href=#__codelineno-62-578></a>echo_failure<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-62-579 name=__codelineno-62-579 href=#__codelineno-62-579></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$BOOTUP</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;color&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nv>$MOVE_TO_COL</span>
<a id=__codelineno-62-580 name=__codelineno-62-580 href=#__codelineno-62-580></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;[&quot;</span>
<a id=__codelineno-62-581 name=__codelineno-62-581 href=#__codelineno-62-581></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$BOOTUP</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;color&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nv>$SETCOLOR_FAILURE</span>
<a id=__codelineno-62-582 name=__codelineno-62-582 href=#__codelineno-62-582></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s2>$&quot;FAILED&quot;</span>
<a id=__codelineno-62-583 name=__codelineno-62-583 href=#__codelineno-62-583></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$BOOTUP</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;color&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nv>$SETCOLOR_NORMAL</span>
<a id=__codelineno-62-584 name=__codelineno-62-584 href=#__codelineno-62-584></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;]&quot;</span>
<a id=__codelineno-62-585 name=__codelineno-62-585 href=#__codelineno-62-585></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-ne<span class=w> </span><span class=s2>&quot;\r&quot;</span>
<a id=__codelineno-62-586 name=__codelineno-62-586 href=#__codelineno-62-586></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-62-587 name=__codelineno-62-587 href=#__codelineno-62-587></a><span class=o>}</span>
<a id=__codelineno-62-588 name=__codelineno-62-588 href=#__codelineno-62-588></a>
<a id=__codelineno-62-589 name=__codelineno-62-589 href=#__codelineno-62-589></a>echo_passed<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-62-590 name=__codelineno-62-590 href=#__codelineno-62-590></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$BOOTUP</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;color&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nv>$MOVE_TO_COL</span>
<a id=__codelineno-62-591 name=__codelineno-62-591 href=#__codelineno-62-591></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;[&quot;</span>
<a id=__codelineno-62-592 name=__codelineno-62-592 href=#__codelineno-62-592></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$BOOTUP</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;color&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nv>$SETCOLOR_WARNING</span>
<a id=__codelineno-62-593 name=__codelineno-62-593 href=#__codelineno-62-593></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s2>$&quot;PASSED&quot;</span>
<a id=__codelineno-62-594 name=__codelineno-62-594 href=#__codelineno-62-594></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$BOOTUP</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;color&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nv>$SETCOLOR_NORMAL</span>
<a id=__codelineno-62-595 name=__codelineno-62-595 href=#__codelineno-62-595></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;]&quot;</span>
<a id=__codelineno-62-596 name=__codelineno-62-596 href=#__codelineno-62-596></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-ne<span class=w> </span><span class=s2>&quot;\r&quot;</span>
<a id=__codelineno-62-597 name=__codelineno-62-597 href=#__codelineno-62-597></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-62-598 name=__codelineno-62-598 href=#__codelineno-62-598></a><span class=o>}</span>
<a id=__codelineno-62-599 name=__codelineno-62-599 href=#__codelineno-62-599></a>
<a id=__codelineno-62-600 name=__codelineno-62-600 href=#__codelineno-62-600></a>echo_warning<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-62-601 name=__codelineno-62-601 href=#__codelineno-62-601></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$BOOTUP</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;color&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nv>$MOVE_TO_COL</span>
<a id=__codelineno-62-602 name=__codelineno-62-602 href=#__codelineno-62-602></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;[&quot;</span>
<a id=__codelineno-62-603 name=__codelineno-62-603 href=#__codelineno-62-603></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$BOOTUP</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;color&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nv>$SETCOLOR_WARNING</span>
<a id=__codelineno-62-604 name=__codelineno-62-604 href=#__codelineno-62-604></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s2>$&quot;WARNING&quot;</span>
<a id=__codelineno-62-605 name=__codelineno-62-605 href=#__codelineno-62-605></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$BOOTUP</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;color&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nv>$SETCOLOR_NORMAL</span>
<a id=__codelineno-62-606 name=__codelineno-62-606 href=#__codelineno-62-606></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;]&quot;</span>
<a id=__codelineno-62-607 name=__codelineno-62-607 href=#__codelineno-62-607></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-ne<span class=w> </span><span class=s2>&quot;\r&quot;</span>
<a id=__codelineno-62-608 name=__codelineno-62-608 href=#__codelineno-62-608></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-62-609 name=__codelineno-62-609 href=#__codelineno-62-609></a><span class=o>}</span>
<a id=__codelineno-62-610 name=__codelineno-62-610 href=#__codelineno-62-610></a>
<a id=__codelineno-62-611 name=__codelineno-62-611 href=#__codelineno-62-611></a><span class=c1># Inform the graphical boot of our current state</span>
<a id=__codelineno-62-612 name=__codelineno-62-612 href=#__codelineno-62-612></a>update_boot_stage<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-62-613 name=__codelineno-62-613 href=#__codelineno-62-613></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-x<span class=w> </span>/bin/plymouth<span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-62-614 name=__codelineno-62-614 href=#__codelineno-62-614></a><span class=w>        </span>/bin/plymouth<span class=w> </span>--update<span class=o>=</span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span>
<a id=__codelineno-62-615 name=__codelineno-62-615 href=#__codelineno-62-615></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-62-616 name=__codelineno-62-616 href=#__codelineno-62-616></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-62-617 name=__codelineno-62-617 href=#__codelineno-62-617></a><span class=o>}</span>
<a id=__codelineno-62-618 name=__codelineno-62-618 href=#__codelineno-62-618></a>
<a id=__codelineno-62-619 name=__codelineno-62-619 href=#__codelineno-62-619></a><span class=c1># Log that something succeeded</span>
<a id=__codelineno-62-620 name=__codelineno-62-620 href=#__codelineno-62-620></a>success<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-62-621 name=__codelineno-62-621 href=#__codelineno-62-621></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$BOOTUP</span><span class=s2>&quot;</span><span class=w> </span>!<span class=o>=</span><span class=w> </span><span class=s2>&quot;verbose&quot;</span><span class=w> </span>-a<span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>LSB</span><span class=k>:-</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>echo_success
<a id=__codelineno-62-622 name=__codelineno-62-622 href=#__codelineno-62-622></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-62-623 name=__codelineno-62-623 href=#__codelineno-62-623></a><span class=o>}</span>
<a id=__codelineno-62-624 name=__codelineno-62-624 href=#__codelineno-62-624></a>
<a id=__codelineno-62-625 name=__codelineno-62-625 href=#__codelineno-62-625></a><span class=c1># Log that something failed</span>
<a id=__codelineno-62-626 name=__codelineno-62-626 href=#__codelineno-62-626></a>failure<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-62-627 name=__codelineno-62-627 href=#__codelineno-62-627></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>rc</span><span class=o>=</span><span class=nv>$?</span>
<a id=__codelineno-62-628 name=__codelineno-62-628 href=#__codelineno-62-628></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$BOOTUP</span><span class=s2>&quot;</span><span class=w> </span>!<span class=o>=</span><span class=w> </span><span class=s2>&quot;verbose&quot;</span><span class=w> </span>-a<span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>LSB</span><span class=k>:-</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>echo_failure
<a id=__codelineno-62-629 name=__codelineno-62-629 href=#__codelineno-62-629></a><span class=w>    </span><span class=o>[</span><span class=w> </span>-x<span class=w> </span>/bin/plymouth<span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>/bin/plymouth<span class=w> </span>--details
<a id=__codelineno-62-630 name=__codelineno-62-630 href=#__codelineno-62-630></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nv>$rc</span>
<a id=__codelineno-62-631 name=__codelineno-62-631 href=#__codelineno-62-631></a><span class=o>}</span>
<a id=__codelineno-62-632 name=__codelineno-62-632 href=#__codelineno-62-632></a>
<a id=__codelineno-62-633 name=__codelineno-62-633 href=#__codelineno-62-633></a><span class=c1># Log that something passed, but may have had errors. Useful for fsck</span>
<a id=__codelineno-62-634 name=__codelineno-62-634 href=#__codelineno-62-634></a>passed<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-62-635 name=__codelineno-62-635 href=#__codelineno-62-635></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>rc</span><span class=o>=</span><span class=nv>$?</span>
<a id=__codelineno-62-636 name=__codelineno-62-636 href=#__codelineno-62-636></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$BOOTUP</span><span class=s2>&quot;</span><span class=w> </span>!<span class=o>=</span><span class=w> </span><span class=s2>&quot;verbose&quot;</span><span class=w> </span>-a<span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>LSB</span><span class=k>:-</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>echo_passed
<a id=__codelineno-62-637 name=__codelineno-62-637 href=#__codelineno-62-637></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nv>$rc</span>
<a id=__codelineno-62-638 name=__codelineno-62-638 href=#__codelineno-62-638></a><span class=o>}</span>
<a id=__codelineno-62-639 name=__codelineno-62-639 href=#__codelineno-62-639></a>
<a id=__codelineno-62-640 name=__codelineno-62-640 href=#__codelineno-62-640></a><span class=c1># Log a warning</span>
<a id=__codelineno-62-641 name=__codelineno-62-641 href=#__codelineno-62-641></a>warning<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-62-642 name=__codelineno-62-642 href=#__codelineno-62-642></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>rc</span><span class=o>=</span><span class=nv>$?</span>
<a id=__codelineno-62-643 name=__codelineno-62-643 href=#__codelineno-62-643></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$BOOTUP</span><span class=s2>&quot;</span><span class=w> </span>!<span class=o>=</span><span class=w> </span><span class=s2>&quot;verbose&quot;</span><span class=w> </span>-a<span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>LSB</span><span class=k>:-</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>echo_warning
<a id=__codelineno-62-644 name=__codelineno-62-644 href=#__codelineno-62-644></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nv>$rc</span>
<a id=__codelineno-62-645 name=__codelineno-62-645 href=#__codelineno-62-645></a><span class=o>}</span>
<a id=__codelineno-62-646 name=__codelineno-62-646 href=#__codelineno-62-646></a>
<a id=__codelineno-62-647 name=__codelineno-62-647 href=#__codelineno-62-647></a><span class=c1># Run some action. Log its output.</span>
<a id=__codelineno-62-648 name=__codelineno-62-648 href=#__codelineno-62-648></a>action<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-62-649 name=__codelineno-62-649 href=#__codelineno-62-649></a><span class=w>    </span><span class=nb>local</span><span class=w> </span>STRING<span class=w> </span>rc
<a id=__codelineno-62-650 name=__codelineno-62-650 href=#__codelineno-62-650></a>
<a id=__codelineno-62-651 name=__codelineno-62-651 href=#__codelineno-62-651></a><span class=w>    </span><span class=nv>STRING</span><span class=o>=</span><span class=nv>$1</span>
<a id=__codelineno-62-652 name=__codelineno-62-652 href=#__codelineno-62-652></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=nv>$STRING</span><span class=s2> &quot;</span>
<a id=__codelineno-62-653 name=__codelineno-62-653 href=#__codelineno-62-653></a><span class=w>    </span><span class=nb>shift</span>
<a id=__codelineno-62-654 name=__codelineno-62-654 href=#__codelineno-62-654></a><span class=w>    </span><span class=s2>&quot;</span><span class=nv>$@</span><span class=s2>&quot;</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>success<span class=w> </span>$<span class=s2>&quot;</span><span class=nv>$STRING</span><span class=s2>&quot;</span><span class=w> </span><span class=o>||</span><span class=w> </span>failure<span class=w> </span>$<span class=s2>&quot;</span><span class=nv>$STRING</span><span class=s2>&quot;</span>
<a id=__codelineno-62-655 name=__codelineno-62-655 href=#__codelineno-62-655></a><span class=w>    </span><span class=nv>rc</span><span class=o>=</span><span class=nv>$?</span>
<a id=__codelineno-62-656 name=__codelineno-62-656 href=#__codelineno-62-656></a><span class=w>    </span><span class=nb>echo</span>
<a id=__codelineno-62-657 name=__codelineno-62-657 href=#__codelineno-62-657></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nv>$rc</span>
<a id=__codelineno-62-658 name=__codelineno-62-658 href=#__codelineno-62-658></a><span class=o>}</span>
<a id=__codelineno-62-659 name=__codelineno-62-659 href=#__codelineno-62-659></a>
<a id=__codelineno-62-660 name=__codelineno-62-660 href=#__codelineno-62-660></a><span class=c1># returns OK if $1 contains $2</span>
<a id=__codelineno-62-661 name=__codelineno-62-661 href=#__codelineno-62-661></a>strstr<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-62-662 name=__codelineno-62-662 href=#__codelineno-62-662></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>1</span><span class=p>#*</span><span class=nv>$2</span><span class=p>*</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-62-663 name=__codelineno-62-663 href=#__codelineno-62-663></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-62-664 name=__codelineno-62-664 href=#__codelineno-62-664></a><span class=o>}</span>
<a id=__codelineno-62-665 name=__codelineno-62-665 href=#__codelineno-62-665></a>
<a id=__codelineno-62-666 name=__codelineno-62-666 href=#__codelineno-62-666></a><span class=c1># Check whether file $1 is a backup or rpm-generated file and should be ignored</span>
<a id=__codelineno-62-667 name=__codelineno-62-667 href=#__codelineno-62-667></a>is_ignored_file<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-62-668 name=__codelineno-62-668 href=#__codelineno-62-668></a><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=k>in</span>
<a id=__codelineno-62-669 name=__codelineno-62-669 href=#__codelineno-62-669></a><span class=w>    </span>*~<span class=w> </span><span class=p>|</span><span class=w> </span>*.bak<span class=w> </span><span class=p>|</span><span class=w> </span>*.orig<span class=w> </span><span class=p>|</span><span class=w> </span>*.rpmnew<span class=w> </span><span class=p>|</span><span class=w> </span>*.rpmorig<span class=w> </span><span class=p>|</span><span class=w> </span>*.rpmsave<span class=o>)</span>
<a id=__codelineno-62-670 name=__codelineno-62-670 href=#__codelineno-62-670></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-62-671 name=__codelineno-62-671 href=#__codelineno-62-671></a><span class=w>        </span><span class=p>;;</span>
<a id=__codelineno-62-672 name=__codelineno-62-672 href=#__codelineno-62-672></a><span class=w>    </span><span class=k>esac</span>
<a id=__codelineno-62-673 name=__codelineno-62-673 href=#__codelineno-62-673></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-62-674 name=__codelineno-62-674 href=#__codelineno-62-674></a><span class=o>}</span>
<a id=__codelineno-62-675 name=__codelineno-62-675 href=#__codelineno-62-675></a>
<a id=__codelineno-62-676 name=__codelineno-62-676 href=#__codelineno-62-676></a><span class=c1># Evaluate shvar-style booleans</span>
<a id=__codelineno-62-677 name=__codelineno-62-677 href=#__codelineno-62-677></a>is_true<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-62-678 name=__codelineno-62-678 href=#__codelineno-62-678></a><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=k>in</span>
<a id=__codelineno-62-679 name=__codelineno-62-679 href=#__codelineno-62-679></a><span class=w>    </span><span class=o>[</span>tT<span class=o>]</span><span class=w> </span><span class=p>|</span><span class=w> </span><span class=o>[</span>yY<span class=o>]</span><span class=w> </span><span class=p>|</span><span class=w> </span><span class=o>[</span>yY<span class=o>][</span>eE<span class=o>][</span>sS<span class=o>]</span><span class=w> </span><span class=p>|</span><span class=w> </span><span class=o>[</span>tT<span class=o>][</span>rR<span class=o>][</span>uU<span class=o>][</span>eE<span class=o>]</span><span class=w> </span><span class=p>|</span><span class=w> </span><span class=m>1</span><span class=o>)</span>
<a id=__codelineno-62-680 name=__codelineno-62-680 href=#__codelineno-62-680></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-62-681 name=__codelineno-62-681 href=#__codelineno-62-681></a><span class=w>        </span><span class=p>;;</span>
<a id=__codelineno-62-682 name=__codelineno-62-682 href=#__codelineno-62-682></a><span class=w>    </span><span class=k>esac</span>
<a id=__codelineno-62-683 name=__codelineno-62-683 href=#__codelineno-62-683></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-62-684 name=__codelineno-62-684 href=#__codelineno-62-684></a><span class=o>}</span>
<a id=__codelineno-62-685 name=__codelineno-62-685 href=#__codelineno-62-685></a>
<a id=__codelineno-62-686 name=__codelineno-62-686 href=#__codelineno-62-686></a><span class=c1># Evaluate shvar-style booleans</span>
<a id=__codelineno-62-687 name=__codelineno-62-687 href=#__codelineno-62-687></a>is_false<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-62-688 name=__codelineno-62-688 href=#__codelineno-62-688></a><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=k>in</span>
<a id=__codelineno-62-689 name=__codelineno-62-689 href=#__codelineno-62-689></a><span class=w>    </span><span class=o>[</span>fF<span class=o>]</span><span class=w> </span><span class=p>|</span><span class=w> </span><span class=o>[</span>nN<span class=o>]</span><span class=w> </span><span class=p>|</span><span class=w> </span><span class=o>[</span>nN<span class=o>][</span>oO<span class=o>]</span><span class=w> </span><span class=p>|</span><span class=w> </span><span class=o>[</span>fF<span class=o>][</span>aA<span class=o>][</span>lL<span class=o>][</span>sS<span class=o>][</span>eE<span class=o>]</span><span class=w> </span><span class=p>|</span><span class=w> </span><span class=m>0</span><span class=o>)</span>
<a id=__codelineno-62-690 name=__codelineno-62-690 href=#__codelineno-62-690></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-62-691 name=__codelineno-62-691 href=#__codelineno-62-691></a><span class=w>        </span><span class=p>;;</span>
<a id=__codelineno-62-692 name=__codelineno-62-692 href=#__codelineno-62-692></a><span class=w>    </span><span class=k>esac</span>
<a id=__codelineno-62-693 name=__codelineno-62-693 href=#__codelineno-62-693></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-62-694 name=__codelineno-62-694 href=#__codelineno-62-694></a><span class=o>}</span>
<a id=__codelineno-62-695 name=__codelineno-62-695 href=#__codelineno-62-695></a>
<a id=__codelineno-62-696 name=__codelineno-62-696 href=#__codelineno-62-696></a><span class=c1># Apply sysctl settings, including files in /etc/sysctl.d</span>
<a id=__codelineno-62-697 name=__codelineno-62-697 href=#__codelineno-62-697></a>apply_sysctl<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-62-698 name=__codelineno-62-698 href=#__codelineno-62-698></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-x<span class=w> </span>/lib/systemd/systemd-sysctl<span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-62-699 name=__codelineno-62-699 href=#__codelineno-62-699></a><span class=w>    </span>/lib/systemd/systemd-sysctl
<a id=__codelineno-62-700 name=__codelineno-62-700 href=#__codelineno-62-700></a><span class=w>    </span><span class=k>else</span>
<a id=__codelineno-62-701 name=__codelineno-62-701 href=#__codelineno-62-701></a><span class=w>        </span><span class=k>for</span><span class=w> </span>file<span class=w> </span><span class=k>in</span><span class=w> </span>/usr/lib/sysctl.d/*.conf<span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>do</span>
<a id=__codelineno-62-702 name=__codelineno-62-702 href=#__codelineno-62-702></a><span class=w>            </span>is_ignored_file<span class=w> </span><span class=s2>&quot;</span><span class=nv>$file</span><span class=s2>&quot;</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>continue</span>
<a id=__codelineno-62-703 name=__codelineno-62-703 href=#__codelineno-62-703></a><span class=w>            </span><span class=o>[</span><span class=w> </span>-f<span class=w> </span>/run/sysctl.d/<span class=si>${</span><span class=nv>file</span><span class=p>##*/</span><span class=si>}</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>continue</span>
<a id=__codelineno-62-704 name=__codelineno-62-704 href=#__codelineno-62-704></a><span class=w>            </span><span class=o>[</span><span class=w> </span>-f<span class=w> </span>/etc/sysctl.d/<span class=si>${</span><span class=nv>file</span><span class=p>##*/</span><span class=si>}</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>continue</span>
<a id=__codelineno-62-705 name=__codelineno-62-705 href=#__codelineno-62-705></a><span class=w>            </span><span class=nb>test</span><span class=w> </span>-f<span class=w> </span><span class=s2>&quot;</span><span class=nv>$file</span><span class=s2>&quot;</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>sysctl<span class=w> </span>-e<span class=w> </span>-p<span class=w> </span><span class=s2>&quot;</span><span class=nv>$file</span><span class=s2>&quot;</span><span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-62-706 name=__codelineno-62-706 href=#__codelineno-62-706></a><span class=w>        </span><span class=k>done</span>
<a id=__codelineno-62-707 name=__codelineno-62-707 href=#__codelineno-62-707></a><span class=w>        </span><span class=k>for</span><span class=w> </span>file<span class=w> </span><span class=k>in</span><span class=w> </span>/run/sysctl.d/*.conf<span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>do</span>
<a id=__codelineno-62-708 name=__codelineno-62-708 href=#__codelineno-62-708></a><span class=w>            </span>is_ignored_file<span class=w> </span><span class=s2>&quot;</span><span class=nv>$file</span><span class=s2>&quot;</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>continue</span>
<a id=__codelineno-62-709 name=__codelineno-62-709 href=#__codelineno-62-709></a><span class=w>            </span><span class=o>[</span><span class=w> </span>-f<span class=w> </span>/etc/sysctl.d/<span class=si>${</span><span class=nv>file</span><span class=p>##*/</span><span class=si>}</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>continue</span>
<a id=__codelineno-62-710 name=__codelineno-62-710 href=#__codelineno-62-710></a><span class=w>            </span><span class=nb>test</span><span class=w> </span>-f<span class=w> </span><span class=s2>&quot;</span><span class=nv>$file</span><span class=s2>&quot;</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>sysctl<span class=w> </span>-e<span class=w> </span>-p<span class=w> </span><span class=s2>&quot;</span><span class=nv>$file</span><span class=s2>&quot;</span><span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-62-711 name=__codelineno-62-711 href=#__codelineno-62-711></a><span class=w>        </span><span class=k>done</span>
<a id=__codelineno-62-712 name=__codelineno-62-712 href=#__codelineno-62-712></a><span class=w>        </span><span class=k>for</span><span class=w> </span>file<span class=w> </span><span class=k>in</span><span class=w> </span>/etc/sysctl.d/*.conf<span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>do</span>
<a id=__codelineno-62-713 name=__codelineno-62-713 href=#__codelineno-62-713></a><span class=w>            </span>is_ignored_file<span class=w> </span><span class=s2>&quot;</span><span class=nv>$file</span><span class=s2>&quot;</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>continue</span>
<a id=__codelineno-62-714 name=__codelineno-62-714 href=#__codelineno-62-714></a><span class=w>            </span><span class=nb>test</span><span class=w> </span>-f<span class=w> </span><span class=s2>&quot;</span><span class=nv>$file</span><span class=s2>&quot;</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>sysctl<span class=w> </span>-e<span class=w> </span>-p<span class=w> </span><span class=s2>&quot;</span><span class=nv>$file</span><span class=s2>&quot;</span><span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-62-715 name=__codelineno-62-715 href=#__codelineno-62-715></a><span class=w>        </span><span class=k>done</span>
<a id=__codelineno-62-716 name=__codelineno-62-716 href=#__codelineno-62-716></a><span class=w>        </span>sysctl<span class=w> </span>-e<span class=w> </span>-p<span class=w> </span>/etc/sysctl.conf<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-62-717 name=__codelineno-62-717 href=#__codelineno-62-717></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-62-718 name=__codelineno-62-718 href=#__codelineno-62-718></a><span class=o>}</span>
<a id=__codelineno-62-719 name=__codelineno-62-719 href=#__codelineno-62-719></a>
<a id=__codelineno-62-720 name=__codelineno-62-720 href=#__codelineno-62-720></a><span class=c1># A sed expression to filter out the files that is_ignored_file recognizes</span>
<a id=__codelineno-62-721 name=__codelineno-62-721 href=#__codelineno-62-721></a><span class=nv>__sed_discard_ignored_files</span><span class=o>=</span><span class=s1>&#39;/\(~\|\.bak\|\.orig\|\.rpmnew\|\.rpmorig\|\.rpmsave\)$/d&#39;</span>
<a id=__codelineno-62-722 name=__codelineno-62-722 href=#__codelineno-62-722></a>
<a id=__codelineno-62-723 name=__codelineno-62-723 href=#__codelineno-62-723></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$_use_systemctl</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;1&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-62-724 name=__codelineno-62-724 href=#__codelineno-62-724></a><span class=w>        </span><span class=k>if</span><span class=w>  </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;x</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span>xstart<span class=w> </span>-o<span class=w> </span><span class=se>\</span>
<a id=__codelineno-62-725 name=__codelineno-62-725 href=#__codelineno-62-725></a><span class=w>              </span><span class=s2>&quot;x</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span>xstop<span class=w> </span>-o<span class=w> </span><span class=se>\</span>
<a id=__codelineno-62-726 name=__codelineno-62-726 href=#__codelineno-62-726></a><span class=w>              </span><span class=s2>&quot;x</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span>xrestart<span class=w> </span>-o<span class=w> </span><span class=se>\</span>
<a id=__codelineno-62-727 name=__codelineno-62-727 href=#__codelineno-62-727></a><span class=w>              </span><span class=s2>&quot;x</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span>xreload<span class=w> </span>-o<span class=w> </span><span class=se>\</span>
<a id=__codelineno-62-728 name=__codelineno-62-728 href=#__codelineno-62-728></a><span class=w>              </span><span class=s2>&quot;x</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span>xtry-restart<span class=w> </span>-o<span class=w> </span><span class=se>\</span>
<a id=__codelineno-62-729 name=__codelineno-62-729 href=#__codelineno-62-729></a><span class=w>              </span><span class=s2>&quot;x</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span>xforce-reload<span class=w> </span>-o<span class=w> </span><span class=se>\</span>
<a id=__codelineno-62-730 name=__codelineno-62-730 href=#__codelineno-62-730></a><span class=w>              </span><span class=s2>&quot;x</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span>xcondrestart<span class=w> </span><span class=o>]</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-62-731 name=__codelineno-62-731 href=#__codelineno-62-731></a>
<a id=__codelineno-62-732 name=__codelineno-62-732 href=#__codelineno-62-732></a><span class=w>        </span>systemctl_redirect<span class=w> </span><span class=nv>$0</span><span class=w> </span><span class=nv>$1</span>
<a id=__codelineno-62-733 name=__codelineno-62-733 href=#__codelineno-62-733></a><span class=w>        </span><span class=nb>exit</span><span class=w> </span><span class=nv>$?</span>
<a id=__codelineno-62-734 name=__codelineno-62-734 href=#__codelineno-62-734></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-62-735 name=__codelineno-62-735 href=#__codelineno-62-735></a><span class=k>fi</span>
<a id=__codelineno-62-736 name=__codelineno-62-736 href=#__codelineno-62-736></a>
<a id=__codelineno-62-737 name=__codelineno-62-737 href=#__codelineno-62-737></a>strstr<span class=w> </span><span class=s2>&quot;</span><span class=k>$(</span>cat<span class=w> </span>/proc/cmdline<span class=k>)</span><span class=s2>&quot;</span><span class=w> </span><span class=s2>&quot;rc.debug&quot;</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nb>set</span><span class=w> </span>-x
<a id=__codelineno-62-738 name=__codelineno-62-738 href=#__codelineno-62-738></a><span class=k>return</span><span class=w> </span><span class=m>0</span>
</code></pre></div> <h2 id=38bash-公共库>38.Bash 公共库<a class=headerlink href=#38bash-公共库 title="Permanent link">&para;</a></h2> <h3 id=1bash-shell-function-library>1.Bash Shell Function Library<a class=headerlink href=#1bash-shell-function-library title="Permanent link">&para;</a></h3> <p>项目地址：<a href=https://github.com/SkypLabs/bsfl>https://github.com/SkypLabs/bsfl</a></p> <p>Bash Shell Function Library 是一个短小精炼的 Bash 公共库，他提供了诸如</p> <ul> <li>数组操作</li> <li>命令执行</li> <li>文件管理</li> <li>日志记录</li> <li>信息提醒</li> <li>网络检测</li> <li>字符操作</li> <li>时间操作</li> <li>变量操作</li> </ul> <p>等等功能，帮助运维工程师快速完成自己的脚本编写工作。</p> <p>此外，Bash Shell Function Library 还提供了一个完整的<a href=https://skyplabs.github.io/bsfl/modules.html>在线文档</a>，帮助你了解函数库中提供的重要函数。</p> <p><strong>使用方法</strong></p> <p>从 <a href=https://github.com/SkypLabs/bsfl>https://github.com/SkypLabs/bsfl</a> 上下载仓库，并获取其中的 bsfl.sh 即可在自己的代码中引用。</p> <p>示例代码</p> <div class=highlight><pre><span></span><code><a id=__codelineno-63-1 name=__codelineno-63-1 href=#__codelineno-63-1></a><span class=ch>#!/usr/bin/env bash</span>
<a id=__codelineno-63-2 name=__codelineno-63-2 href=#__codelineno-63-2></a><span class=c1># -*- tab-width: 4; encoding: utf-8 -*-</span>
<a id=__codelineno-63-3 name=__codelineno-63-3 href=#__codelineno-63-3></a>
<a id=__codelineno-63-4 name=__codelineno-63-4 href=#__codelineno-63-4></a><span class=c1># 定义只读变量</span>
<a id=__codelineno-63-5 name=__codelineno-63-5 href=#__codelineno-63-5></a><span class=nb>declare</span><span class=w> </span>-r<span class=w> </span><span class=nv>DIR</span><span class=o>=</span><span class=k>$(</span><span class=nb>cd</span><span class=w> </span><span class=s2>&quot;</span><span class=k>$(</span>dirname<span class=w> </span><span class=s2>&quot;</span><span class=nv>$0</span><span class=s2>&quot;</span><span class=k>)</span><span class=s2>&quot;</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nb>pwd</span><span class=k>)</span>
<a id=__codelineno-63-6 name=__codelineno-63-6 href=#__codelineno-63-6></a><span class=nb>source</span><span class=w> </span><span class=nv>$DIR</span>/../lib/bsfl.sh
<a id=__codelineno-63-7 name=__codelineno-63-7 href=#__codelineno-63-7></a>
<a id=__codelineno-63-8 name=__codelineno-63-8 href=#__codelineno-63-8></a><span class=c1># --------------------</span>
<a id=__codelineno-63-9 name=__codelineno-63-9 href=#__codelineno-63-9></a>msg<span class=w> </span><span class=s2>&quot;This is a classic displayed message using the &#39;msg&#39; function.&quot;</span>
<a id=__codelineno-63-10 name=__codelineno-63-10 href=#__codelineno-63-10></a><span class=nb>echo</span>
</code></pre></div> <h3 id=2bash-lib>2.Bash Lib<a class=headerlink href=#2bash-lib title="Permanent link">&para;</a></h3> <p>项目地址：<a href=http://aks.github.io/bash-lib>http://aks.github.io/bash-lib</a></p> <p>Bash Lib 是一个原子化的公共库，你可以根据自己的实际需要，引入所需的公共库分组， 使用相应的内容，降低整个项目的大小。</p> <p>Bash Lib 提供了诸多原子库，你选择需要使用的引入即可：</p> <ul> <li>参数处理：arg-utils</li> <li>日历处理： calendar-utils</li> <li>日期处理：date-utils</li> <li>Hash 处理：hash-utils</li> <li>帮助处理：help-util</li> <li>列表处理：list-utils</li> <li>交互处理：prompt-colors</li> <li>文字处理：text-utils</li> <li>测试处理：test-utils</li> <li>时间处理：time-utils</li> <li>...</li> </ul> <p><strong>使用方法</strong></p> <p>从 <a href=https://github.com/aks/bash-lib>https://github.com/aks/bash-lib</a> 下载仓库，并选择你需要引入的脚本，复制到项目目录下，并进行引用即可。</p> <p>示例代码</p> <div class=highlight><pre><span></span><code><a id=__codelineno-64-1 name=__codelineno-64-1 href=#__codelineno-64-1></a><span class=ch>#!/usr/bin/env bash</span>
<a id=__codelineno-64-2 name=__codelineno-64-2 href=#__codelineno-64-2></a><span class=nb>source</span><span class=w> </span>text-utils.sh
<a id=__codelineno-64-3 name=__codelineno-64-3 href=#__codelineno-64-3></a>lowercase<span class=w> </span><span class=s2>&quot;HELLOWORLD&quot;</span>
</code></pre></div> <h3 id=3shellbash库函数>3.Shell(Bash)库函数<a class=headerlink href=#3shellbash库函数 title="Permanent link">&para;</a></h3> <p>some useful lib function for bash(一些有用的 shell 函数库)</p> <p><a href=https://github.com/malongshuai/shell_libs>https://github.com/malongshuai/shell_libs</a></p> <h3 id=4bash-libs>4.bash-libs<a class=headerlink href=#4bash-libs title="Permanent link">&para;</a></h3> <p>bash 脚本封装的一些函数库, 日志(彩色, 分级打印), 字符串处理, 时间日期格式化, 以及多线程等, 以实现类似高级语言的功能</p> <p><a href=https://github.com/generals-space/bash-libs>https://github.com/generals-space/bash-libs</a></p> <h2 id=39数据库备份-shell-脚本>39.数据库备份 Shell 脚本<a class=headerlink href=#39数据库备份-shell-脚本 title="Permanent link">&para;</a></h2> <h3 id=mysql>MySQL<a class=headerlink href=#mysql title="Permanent link">&para;</a></h3> <p>需要注意的是：远程备份需要做免密，在 MySQL 数据库所在服务器与需要远程备份的服务器做免密，并进行 ssh 验证登录是否正常。</p> <div class=highlight><pre><span></span><code><a id=__codelineno-65-1 name=__codelineno-65-1 href=#__codelineno-65-1></a>ssh-keygen
<a id=__codelineno-65-2 name=__codelineno-65-2 href=#__codelineno-65-2></a><span class=nb>cd</span><span class=w> </span>~/.ssh/
<a id=__codelineno-65-3 name=__codelineno-65-3 href=#__codelineno-65-3></a>scp<span class=w> </span>id_rsa.pub<span class=w> </span>目标主机IP：~/.ssh/authorized_keys
</code></pre></div> <div class=highlight><pre><span></span><code><a id=__codelineno-66-1 name=__codelineno-66-1 href=#__codelineno-66-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-66-2 name=__codelineno-66-2 href=#__codelineno-66-2></a><span class=c1># Database info</span>
<a id=__codelineno-66-3 name=__codelineno-66-3 href=#__codelineno-66-3></a><span class=nv>DB_USER</span><span class=o>=</span><span class=s2>&quot;root&quot;</span><span class=w>                          </span><span class=c1># 数据库备份用户</span>
<a id=__codelineno-66-4 name=__codelineno-66-4 href=#__codelineno-66-4></a><span class=nv>DB_PASS</span><span class=o>=</span><span class=s2>&quot;1Q!2W@3E#&quot;</span><span class=w>                     </span><span class=c1># 备份用户密码</span>
<a id=__codelineno-66-5 name=__codelineno-66-5 href=#__codelineno-66-5></a><span class=nv>DB_HOST</span><span class=o>=</span><span class=s2>&quot;192.168.1.100&quot;</span><span class=w>                 </span><span class=c1># 数据库 IP</span>
<a id=__codelineno-66-6 name=__codelineno-66-6 href=#__codelineno-66-6></a><span class=nv>DBBACK_IP</span><span class=o>=</span><span class=s2>&quot;192.168.1.200&quot;</span><span class=w>               </span><span class=c1># 远程备份服务器 IP</span>
<a id=__codelineno-66-7 name=__codelineno-66-7 href=#__codelineno-66-7></a><span class=nv>BCK_DIR</span><span class=o>=</span><span class=s2>&quot;/bigdata/mysql&quot;</span><span class=w>                </span><span class=c1># 本地备份路径</span>
<a id=__codelineno-66-8 name=__codelineno-66-8 href=#__codelineno-66-8></a><span class=nv>DBBACK_PATH</span><span class=o>=</span>/bigdata/mysqlbackup<span class=w>        </span><span class=c1># 远程备份路径</span>
<a id=__codelineno-66-9 name=__codelineno-66-9 href=#__codelineno-66-9></a><span class=nv>DATE</span><span class=o>=</span><span class=sb>`</span>date<span class=w> </span>+%F<span class=sb>`</span><span class=w>                         </span><span class=c1># 获取当前时间</span>
<a id=__codelineno-66-10 name=__codelineno-66-10 href=#__codelineno-66-10></a><span class=nv>yestoday</span><span class=o>=</span><span class=k>$(</span>date<span class=w> </span>-d<span class=w> </span><span class=s1>&#39;-7 day&#39;</span><span class=w> </span>+%Y-%m-%d<span class=k>)</span><span class=w>  </span><span class=c1># 取 7 天前的时间，格式为：2023-12-30，用于删除备份文件取文件时间，该参数可自行调整</span>
<a id=__codelineno-66-11 name=__codelineno-66-11 href=#__codelineno-66-11></a>
<a id=__codelineno-66-12 name=__codelineno-66-12 href=#__codelineno-66-12></a><span class=c1>#BACK_NAME=&quot;db_$var.sql&quot;</span>
<a id=__codelineno-66-13 name=__codelineno-66-13 href=#__codelineno-66-13></a><span class=c1>#TB_NAME=(&quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot;)               # 需要备份的表名</span>
<a id=__codelineno-66-14 name=__codelineno-66-14 href=#__codelineno-66-14></a>
<a id=__codelineno-66-15 name=__codelineno-66-15 href=#__codelineno-66-15></a><span class=c1>#create file</span>
<a id=__codelineno-66-16 name=__codelineno-66-16 href=#__codelineno-66-16></a>
<a id=__codelineno-66-17 name=__codelineno-66-17 href=#__codelineno-66-17></a>mkdir<span class=w> </span>-p<span class=w> </span><span class=nv>$BCK_DIR</span>/<span class=nv>$DATE</span><span class=w>                 </span><span class=c1># 创建本地备份日期目录</span>
<a id=__codelineno-66-18 name=__codelineno-66-18 href=#__codelineno-66-18></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;开始本地备份中...&quot;</span>
<a id=__codelineno-66-19 name=__codelineno-66-19 href=#__codelineno-66-19></a>
<a id=__codelineno-66-20 name=__codelineno-66-20 href=#__codelineno-66-20></a>/usr/local/mysql/bin/mysqldump<span class=w> </span>-u<span class=nv>$DB_USER</span><span class=w> </span>-p<span class=nv>$DB_PASS</span><span class=w> </span>-h<span class=nv>$DB_HOST</span><span class=w> </span>--all-databases<span class=w> </span>&gt;<span class=w> </span><span class=nv>$BCK_DIR</span>/<span class=nv>$DATE</span>/mysql_backup_<span class=nv>$DATE</span>.sql
<a id=__codelineno-66-21 name=__codelineno-66-21 href=#__codelineno-66-21></a><span class=nb>cd</span><span class=w> </span><span class=nv>$BCK_DIR</span>/<span class=nv>$DATE</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>tar<span class=w> </span>-zcvf<span class=w> </span>mysql_backup_<span class=nv>$DATE</span>.sql.tar.gz<span class=w> </span>mysql_backup_<span class=nv>$DATE</span>.sql<span class=w> </span>&gt;&gt;/<span class=nv>$BCK_DIR</span>/<span class=nv>$DATE</span>/<span class=nv>$DATE</span>.log<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>rm<span class=w> </span>-fr<span class=w> </span>mysql_backup_<span class=nv>$DATE</span>.sql
<a id=__codelineno-66-22 name=__codelineno-66-22 href=#__codelineno-66-22></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$DATE</span><span class=s2> db bakcup success！&quot;</span><span class=w> </span>&gt;&gt;/<span class=nv>$BCK_DIR</span>/<span class=nv>$DATE</span>/<span class=nv>$DATE</span>.log
<a id=__codelineno-66-23 name=__codelineno-66-23 href=#__codelineno-66-23></a>
<a id=__codelineno-66-24 name=__codelineno-66-24 href=#__codelineno-66-24></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;开始删除 7 天前的数据库备份文件...&quot;</span>
<a id=__codelineno-66-25 name=__codelineno-66-25 href=#__codelineno-66-25></a>rm<span class=w> </span>-rf<span class=w> </span><span class=nv>$BCK_DIR</span>/<span class=nv>$yestoday</span>
<a id=__codelineno-66-26 name=__codelineno-66-26 href=#__codelineno-66-26></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;7 天前的数据库备份文件删除完毕！&quot;</span>
<a id=__codelineno-66-27 name=__codelineno-66-27 href=#__codelineno-66-27></a>
<a id=__codelineno-66-28 name=__codelineno-66-28 href=#__codelineno-66-28></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;开始远程备份中...&quot;</span>
<a id=__codelineno-66-29 name=__codelineno-66-29 href=#__codelineno-66-29></a>scp<span class=w> </span>-r<span class=w> </span><span class=nv>$BCK_DIR</span>/<span class=nv>$DATE</span>/mysql_backup_<span class=nv>$DATE</span>.sql.tar.gz<span class=w> </span>root@<span class=nv>$DBBACK_IP</span>:<span class=nv>$DBBACK_PATH</span>
<a id=__codelineno-66-30 name=__codelineno-66-30 href=#__codelineno-66-30></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;远程备份完毕！&quot;</span>
</code></pre></div> <p>给 mysql_backup.sh 脚本增加可执行权限，并创建 crontab 定时任务。</p> <div class=highlight><pre><span></span><code><a id=__codelineno-67-1 name=__codelineno-67-1 href=#__codelineno-67-1></a>chmod<span class=w> </span>+x<span class=w> </span>mysql_backup.sh
<a id=__codelineno-67-2 name=__codelineno-67-2 href=#__codelineno-67-2></a>
<a id=__codelineno-67-3 name=__codelineno-67-3 href=#__codelineno-67-3></a>crontab<span class=w> </span>-e
<a id=__codelineno-67-4 name=__codelineno-67-4 href=#__codelineno-67-4></a><span class=c1># MySQL 数据库备份</span>
<a id=__codelineno-67-5 name=__codelineno-67-5 href=#__codelineno-67-5></a><span class=m>0</span><span class=w> </span><span class=m>3</span><span class=w> </span>*<span class=w> </span>*<span class=w> </span><span class=m>6</span><span class=w> </span>root<span class=w> </span>sh<span class=w> </span>/bigdata/mysql_backup.sh<span class=w> </span>&gt;&gt;<span class=w> </span>/bigdata/mysql_backup.log<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span><span class=w> </span><span class=p>&amp;</span>
</code></pre></div> <h3 id=oracle>Oracle<a class=headerlink href=#oracle title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-68-1 name=__codelineno-68-1 href=#__codelineno-68-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-68-2 name=__codelineno-68-2 href=#__codelineno-68-2></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;开始执行 Oracle 数据库备份...&quot;</span>
<a id=__codelineno-68-3 name=__codelineno-68-3 href=#__codelineno-68-3></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;backup ing -------------------&quot;</span>
<a id=__codelineno-68-4 name=__codelineno-68-4 href=#__codelineno-68-4></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;时间：&quot;</span><span class=w> </span>nowtime
<a id=__codelineno-68-5 name=__codelineno-68-5 href=#__codelineno-68-5></a><span class=nv>oraclelog</span><span class=o>=</span>/opt/originbackup/oraclebackup.log<span class=w>                   </span><span class=c1># Oracle 日志查看位置</span>
<a id=__codelineno-68-6 name=__codelineno-68-6 href=#__codelineno-68-6></a><span class=nv>current_date</span><span class=o>=</span><span class=sb>`</span>date<span class=w> </span>+%Y-%m-%d<span class=sb>`</span><span class=w>                                  </span><span class=c1># 当前执行日期时间</span>
<a id=__codelineno-68-7 name=__codelineno-68-7 href=#__codelineno-68-7></a><span class=nv>nowtime</span><span class=o>=</span><span class=k>$(</span>date<span class=w> </span>+%F+%T<span class=k>)</span><span class=w>                                         </span><span class=c1># 显示当前时间，用于记录脚本运行开始时间</span>
<a id=__codelineno-68-8 name=__codelineno-68-8 href=#__codelineno-68-8></a><span class=nv>seven_day_date</span><span class=o>=</span><span class=sb>`</span>date<span class=w> </span>-d<span class=w> </span>-7day<span class=w> </span><span class=s1>&#39;+%Y-%m-%d&#39;</span><span class=sb>`</span><span class=w>                     </span><span class=c1># 保留一星期前 dmp 文件时间</span>
<a id=__codelineno-68-9 name=__codelineno-68-9 href=#__codelineno-68-9></a><span class=nv>fourteen_day_date</span><span class=o>=</span><span class=sb>`</span>date<span class=w> </span>-d<span class=w> </span>-14day<span class=w> </span><span class=s1>&#39;+%Y-%m-%d&#39;</span><span class=sb>`</span><span class=w>                 </span><span class=c1># 保留两星期前 dmp 文件时间</span>
<a id=__codelineno-68-10 name=__codelineno-68-10 href=#__codelineno-68-10></a>
<a id=__codelineno-68-11 name=__codelineno-68-11 href=#__codelineno-68-11></a><span class=c1>### 需修改参数部分 ###</span>
<a id=__codelineno-68-12 name=__codelineno-68-12 href=#__codelineno-68-12></a><span class=nv>dmpDir</span><span class=o>=</span>/data/originbackup<span class=w>                                      </span><span class=c1># 本地备份路径</span>
<a id=__codelineno-68-13 name=__codelineno-68-13 href=#__codelineno-68-13></a><span class=nv>destination</span><span class=o>=</span>/opt/backup/<span class=w>                                       </span><span class=c1># 远端备份路径</span>
<a id=__codelineno-68-14 name=__codelineno-68-14 href=#__codelineno-68-14></a><span class=nv>localhost_ip</span><span class=o>=</span><span class=m>192</span>.168.1.111<span class=w>                                     </span><span class=c1># Oracle 本机 IP</span>
<a id=__codelineno-68-15 name=__codelineno-68-15 href=#__codelineno-68-15></a><span class=nv>backup_ip</span><span class=o>=</span><span class=m>192</span>.168.1.110<span class=w>                                        </span><span class=c1># 远端备份服务器 IP</span>
<a id=__codelineno-68-16 name=__codelineno-68-16 href=#__codelineno-68-16></a><span class=nv>oracle_user</span><span class=o>=</span>oracle_db<span class=w>                                                   </span><span class=c1># Oracle 用户名</span>
<a id=__codelineno-68-17 name=__codelineno-68-17 href=#__codelineno-68-17></a><span class=nv>oracle_password</span><span class=o>=</span>4r<span class=nv>$5</span>t%6y^<span class=w>                                               </span><span class=c1># Oracle 密码</span>
<a id=__codelineno-68-18 name=__codelineno-68-18 href=#__codelineno-68-18></a><span class=nv>mail</span><span class=o>=</span>xxx@163.com,xxx@126.com<span class=w>                                   </span><span class=c1># 告警邮箱</span>
<a id=__codelineno-68-19 name=__codelineno-68-19 href=#__codelineno-68-19></a>
<a id=__codelineno-68-20 name=__codelineno-68-20 href=#__codelineno-68-20></a><span class=nb>source</span><span class=w> </span>/home/oracle/.bash_profile
<a id=__codelineno-68-21 name=__codelineno-68-21 href=#__codelineno-68-21></a>
<a id=__codelineno-68-22 name=__codelineno-68-22 href=#__codelineno-68-22></a><span class=c1>### 判断是否有目录，没有则创建目录 ###</span>
<a id=__codelineno-68-23 name=__codelineno-68-23 href=#__codelineno-68-23></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;---</span><span class=si>${</span><span class=nv>current_date</span><span class=si>}</span><span class=s2>--start dmp all-----&quot;</span>
<a id=__codelineno-68-24 name=__codelineno-68-24 href=#__codelineno-68-24></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>!<span class=w> </span>-d<span class=w> </span><span class=si>${</span><span class=nv>dmpDir</span><span class=si>}</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=k>then</span>
<a id=__codelineno-68-25 name=__codelineno-68-25 href=#__codelineno-68-25></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>dmpDir</span><span class=si>}</span><span class=s2> is not exists,try to create&quot;</span>
<a id=__codelineno-68-26 name=__codelineno-68-26 href=#__codelineno-68-26></a><span class=w>    </span>mkdir<span class=w> </span>-p<span class=w> </span><span class=si>${</span><span class=nv>dmpDir</span><span class=si>}</span>
<a id=__codelineno-68-27 name=__codelineno-68-27 href=#__codelineno-68-27></a><span class=k>fi</span>
<a id=__codelineno-68-28 name=__codelineno-68-28 href=#__codelineno-68-28></a>
<a id=__codelineno-68-29 name=__codelineno-68-29 href=#__codelineno-68-29></a><span class=c1>### 开始本地备份（exp 为 oracle 备份工具） ###</span>
<a id=__codelineno-68-30 name=__codelineno-68-30 href=#__codelineno-68-30></a>exp<span class=w> </span><span class=nv>$oracle_user</span>/<span class=nv>$oracle_password</span>@<span class=nv>$localhost_ip</span>:1521/orcl<span class=w> </span><span class=nv>file</span><span class=o>=</span><span class=nv>$dmpDir</span>/<span class=nv>$current_date</span>.dmp<span class=w> </span><span class=nv>full</span><span class=o>=</span>y<span class=w> </span>&gt;<span class=w> </span>/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-68-31 name=__codelineno-68-31 href=#__codelineno-68-31></a>
<a id=__codelineno-68-32 name=__codelineno-68-32 href=#__codelineno-68-32></a><span class=c1>#touch $dmpDir/$current_date.dmp &gt; /dev/null 2&gt;&amp;1</span>
<a id=__codelineno-68-33 name=__codelineno-68-33 href=#__codelineno-68-33></a>
<a id=__codelineno-68-34 name=__codelineno-68-34 href=#__codelineno-68-34></a><span class=c1>### 连接远端备份 IP 判断是否有目录 ###</span>
<a id=__codelineno-68-35 name=__codelineno-68-35 href=#__codelineno-68-35></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=nv>$?</span><span class=w> </span>-eq<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span>
<a id=__codelineno-68-36 name=__codelineno-68-36 href=#__codelineno-68-36></a><span class=k>then</span>
<a id=__codelineno-68-37 name=__codelineno-68-37 href=#__codelineno-68-37></a><span class=w>    </span>ssh<span class=w> </span><span class=nv>$backup_ip</span><span class=w> </span>ls<span class=w> </span><span class=nv>$destination</span><span class=w> </span>&gt;<span class=w> </span>/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-68-38 name=__codelineno-68-38 href=#__codelineno-68-38></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=nv>$?</span><span class=w> </span>-eq<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span>
<a id=__codelineno-68-39 name=__codelineno-68-39 href=#__codelineno-68-39></a><span class=w>        </span><span class=k>then</span>
<a id=__codelineno-68-40 name=__codelineno-68-40 href=#__codelineno-68-40></a><span class=w>            </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$destination</span><span class=s2> exist mkdir&quot;</span>
<a id=__codelineno-68-41 name=__codelineno-68-41 href=#__codelineno-68-41></a><span class=w>        </span><span class=k>else</span>
<a id=__codelineno-68-42 name=__codelineno-68-42 href=#__codelineno-68-42></a><span class=w>            </span>ssh<span class=w> </span><span class=nv>$backup_ip</span><span class=w> </span>mkdir<span class=w> </span>-p<span class=w> </span><span class=nv>$destination</span>
<a id=__codelineno-68-43 name=__codelineno-68-43 href=#__codelineno-68-43></a><span class=w>            </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$destination</span><span class=s2> mkdir success&quot;</span>
<a id=__codelineno-68-44 name=__codelineno-68-44 href=#__codelineno-68-44></a><span class=w>        </span><span class=k>fi</span>
<a id=__codelineno-68-45 name=__codelineno-68-45 href=#__codelineno-68-45></a><span class=c1>### 本地删除备份文件，保留两个星期前的 ###</span>
<a id=__codelineno-68-46 name=__codelineno-68-46 href=#__codelineno-68-46></a><span class=w>    </span>ssh<span class=w> </span><span class=nv>$backup_ip</span><span class=w> </span>ls<span class=w> </span><span class=nv>$destination</span><span class=w> </span>&gt;&gt;<span class=w> </span>/tmp/linshi
<a id=__codelineno-68-47 name=__codelineno-68-47 href=#__codelineno-68-47></a><span class=w>    </span><span class=k>while</span><span class=w> </span><span class=nb>read</span><span class=w> </span>myline
<a id=__codelineno-68-48 name=__codelineno-68-48 href=#__codelineno-68-48></a><span class=w>    </span><span class=k>do</span>
<a id=__codelineno-68-49 name=__codelineno-68-49 href=#__codelineno-68-49></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=si>${</span><span class=nv>myline</span><span class=si>}</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=si>${</span><span class=nv>seven_day_date</span><span class=si>}</span>.dmp.gz<span class=w> </span>-o<span class=w> </span><span class=si>${</span><span class=nv>myline</span><span class=si>}</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=si>${</span><span class=nv>fourteen_day_date</span><span class=si>}</span>.dmp.gz<span class=w> </span><span class=o>]</span><span class=p>;</span><span class=k>then</span>
<a id=__codelineno-68-50 name=__codelineno-68-50 href=#__codelineno-68-50></a><span class=w>            </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$myline</span><span class=s2>.dmp persist success&quot;</span>
<a id=__codelineno-68-51 name=__codelineno-68-51 href=#__codelineno-68-51></a><span class=w>        </span><span class=k>else</span>
<a id=__codelineno-68-52 name=__codelineno-68-52 href=#__codelineno-68-52></a><span class=w>            </span>rm<span class=w> </span>-rf<span class=w> </span><span class=sb>`</span>ls<span class=w> </span><span class=si>${</span><span class=nv>dmpDir</span><span class=si>}</span>/*<span class=p>|</span>grep<span class=w> </span>-v<span class=w> </span><span class=si>${</span><span class=nv>current_date</span><span class=si>}</span><span class=p>|</span>grep<span class=w> </span>-v<span class=w> </span><span class=si>${</span><span class=nv>seven_day_date</span><span class=si>}</span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>-v<span class=w> </span><span class=si>${</span><span class=nv>fourteen_day_date</span><span class=si>}</span><span class=sb>`</span>
<a id=__codelineno-68-53 name=__codelineno-68-53 href=#__codelineno-68-53></a><span class=w>            </span>ssh<span class=w> </span><span class=nv>$backup_ip</span><span class=w> </span>rm<span class=w> </span>-rf<span class=w> </span><span class=sb>`</span>ls<span class=w> </span><span class=si>${</span><span class=nv>destination</span><span class=si>}</span>/*<span class=p>|</span><span class=w> </span>grep<span class=w> </span>-v<span class=w> </span><span class=si>${</span><span class=nv>seven_day_date</span><span class=si>}</span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>-v<span class=w> </span><span class=si>${</span><span class=nv>fourteen_day_date</span><span class=si>}</span><span class=sb>`</span><span class=w> </span>&gt;<span class=w> </span>/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-68-54 name=__codelineno-68-54 href=#__codelineno-68-54></a><span class=c1>#            ssh $backup_ip rm -rf `ls $destination/*| egrep -v &#39;(${a}|${b})&#39;`</span>
<a id=__codelineno-68-55 name=__codelineno-68-55 href=#__codelineno-68-55></a><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=nv>$?</span><span class=w> </span>-eq<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span>
<a id=__codelineno-68-56 name=__codelineno-68-56 href=#__codelineno-68-56></a><span class=w>                </span><span class=k>then</span>
<a id=__codelineno-68-57 name=__codelineno-68-57 href=#__codelineno-68-57></a><span class=w>                    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Two weeks ago file delete success&quot;</span>
<a id=__codelineno-68-58 name=__codelineno-68-58 href=#__codelineno-68-58></a><span class=w>                </span><span class=k>else</span>
<a id=__codelineno-68-59 name=__codelineno-68-59 href=#__codelineno-68-59></a><span class=w>                    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Two weeks ago file delete fail&quot;</span>
<a id=__codelineno-68-60 name=__codelineno-68-60 href=#__codelineno-68-60></a><span class=w>                    </span><span class=nb>echo</span><span class=w> </span><span class=nv>$current_date</span><span class=w> </span><span class=p>|</span><span class=w> </span>mail<span class=w> </span>-s<span class=w> </span><span class=s2>&quot;</span><span class=nv>$current_date</span><span class=s2> oracle.dmp file delete faile&quot;</span><span class=w> </span><span class=nv>$mail</span><span class=w>  </span><span class=c1># 保留两星期前数据，其他 dmp 文件删除失败</span>
<a id=__codelineno-68-61 name=__codelineno-68-61 href=#__codelineno-68-61></a><span class=w>            </span><span class=k>fi</span>
<a id=__codelineno-68-62 name=__codelineno-68-62 href=#__codelineno-68-62></a><span class=w>        </span><span class=k>fi</span>
<a id=__codelineno-68-63 name=__codelineno-68-63 href=#__codelineno-68-63></a><span class=w>    </span><span class=k>done</span><span class=w> </span>&lt;<span class=w> </span>/tmp/linshi
<a id=__codelineno-68-64 name=__codelineno-68-64 href=#__codelineno-68-64></a><span class=w>    </span>rm<span class=w> </span>-rf<span class=w> </span>/tmp/linshi
<a id=__codelineno-68-65 name=__codelineno-68-65 href=#__codelineno-68-65></a><span class=k>else</span>
<a id=__codelineno-68-66 name=__codelineno-68-66 href=#__codelineno-68-66></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$current_date</span><span class=s2>  文件备份失败&quot;</span>
<a id=__codelineno-68-67 name=__codelineno-68-67 href=#__codelineno-68-67></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=nv>$current_date</span><span class=w> </span><span class=p>|</span><span class=w> </span>mail<span class=w> </span>-s<span class=w> </span><span class=s2>&quot;</span><span class=nv>$current_date</span><span class=s2>  file backup fail </span><span class=nv>$localhost_ip</span><span class=s2>&quot;</span><span class=w> </span><span class=nv>$mail</span><span class=w>    </span><span class=c1># 文件备份失败</span>
<a id=__codelineno-68-68 name=__codelineno-68-68 href=#__codelineno-68-68></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;-----end dmp all-----------------\n&quot;</span>
<a id=__codelineno-68-69 name=__codelineno-68-69 href=#__codelineno-68-69></a><span class=w>    </span><span class=nb>exit</span><span class=w> </span>-1<span class=w>      </span><span class=c1># 终止后面的所有脚本执行</span>
<a id=__codelineno-68-70 name=__codelineno-68-70 href=#__codelineno-68-70></a><span class=k>fi</span>
<a id=__codelineno-68-71 name=__codelineno-68-71 href=#__codelineno-68-71></a><span class=c1>### 本地压缩，将压缩文件传到远端 IP ###</span>
<a id=__codelineno-68-72 name=__codelineno-68-72 href=#__codelineno-68-72></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-f<span class=w> </span><span class=nv>$dmpDir</span>/<span class=nv>$current_date</span>.dmp<span class=w> </span><span class=o>]</span>
<a id=__codelineno-68-73 name=__codelineno-68-73 href=#__codelineno-68-73></a><span class=k>then</span>
<a id=__codelineno-68-74 name=__codelineno-68-74 href=#__codelineno-68-74></a><span class=w>    </span>gzip<span class=w> </span>-q<span class=w> </span>-r<span class=w> </span><span class=nv>$dmpDir</span>/<span class=nv>$current_date</span>.dmp<span class=w> </span><span class=nv>$dmpDir</span>
<a id=__codelineno-68-75 name=__codelineno-68-75 href=#__codelineno-68-75></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;compress success&quot;</span>
<a id=__codelineno-68-76 name=__codelineno-68-76 href=#__codelineno-68-76></a><span class=w>    </span>scp<span class=w> </span>-r<span class=w> </span><span class=nv>$dmpDir</span>/<span class=nv>$current_date</span>.dmp.gz<span class=w> </span>root@<span class=nv>$backup_ip</span>:<span class=nv>$destination</span><span class=w> </span>&gt;<span class=w> </span>/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-68-77 name=__codelineno-68-77 href=#__codelineno-68-77></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=nv>$?</span><span class=w> </span>-eq<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span>
<a id=__codelineno-68-78 name=__codelineno-68-78 href=#__codelineno-68-78></a><span class=w>                </span><span class=k>then</span>
<a id=__codelineno-68-79 name=__codelineno-68-79 href=#__codelineno-68-79></a><span class=w>                    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;backup_file transfer success&quot;</span>
<a id=__codelineno-68-80 name=__codelineno-68-80 href=#__codelineno-68-80></a><span class=w>                </span><span class=k>else</span>
<a id=__codelineno-68-81 name=__codelineno-68-81 href=#__codelineno-68-81></a><span class=w>                    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;backup_file transfer fail&quot;</span>
<a id=__codelineno-68-82 name=__codelineno-68-82 href=#__codelineno-68-82></a><span class=w>                        </span><span class=nb>echo</span><span class=w> </span><span class=nv>$current_date</span><span class=w> </span><span class=p>|</span><span class=w> </span>mail<span class=w> </span>-s<span class=w> </span><span class=s2>&quot;</span><span class=nv>$current_date</span><span class=s2> oracle_dmp_file transfer fail </span><span class=nv>$localhost_ip</span><span class=s2>&quot;</span><span class=w> </span><span class=nv>$mail</span><span class=w>  </span><span class=c1># dmp 文件传递失败</span>
<a id=__codelineno-68-83 name=__codelineno-68-83 href=#__codelineno-68-83></a><span class=w>                </span><span class=k>fi</span>
<a id=__codelineno-68-84 name=__codelineno-68-84 href=#__codelineno-68-84></a><span class=k>else</span>
<a id=__codelineno-68-85 name=__codelineno-68-85 href=#__codelineno-68-85></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;backup_file not found&quot;</span>
<a id=__codelineno-68-86 name=__codelineno-68-86 href=#__codelineno-68-86></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=nv>$?</span><span class=w> </span>-eq<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span>
<a id=__codelineno-68-87 name=__codelineno-68-87 href=#__codelineno-68-87></a><span class=w>                </span><span class=k>then</span>
<a id=__codelineno-68-88 name=__codelineno-68-88 href=#__codelineno-68-88></a><span class=w>                        </span><span class=c1>#echo &quot;backup_file found fail&quot;</span>
<a id=__codelineno-68-89 name=__codelineno-68-89 href=#__codelineno-68-89></a><span class=w>                        </span><span class=nb>echo</span><span class=w> </span><span class=nv>$current_date</span><span class=w> </span><span class=p>|</span><span class=w> </span>mail<span class=w> </span>-s<span class=w> </span><span class=s2>&quot;</span><span class=nv>$current_date</span><span class=s2> oracle_dmp_file not found </span><span class=nv>$localhost_ip</span><span class=s2>&quot;</span><span class=w> </span><span class=nv>$mail</span><span class=w>  </span><span class=c1># dmp 文件未发现</span>
<a id=__codelineno-68-90 name=__codelineno-68-90 href=#__codelineno-68-90></a><span class=w>                </span><span class=k>fi</span>
<a id=__codelineno-68-91 name=__codelineno-68-91 href=#__codelineno-68-91></a><span class=k>fi</span>
<a id=__codelineno-68-92 name=__codelineno-68-92 href=#__codelineno-68-92></a>
<a id=__codelineno-68-93 name=__codelineno-68-93 href=#__codelineno-68-93></a><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;-----end dmp all-----------------\n&quot;</span>
</code></pre></div> <p>给 oracle_backup.sh 脚本增加可执行权限，并在 Linux 的/etc/crontab 文件中创建定时任务。</p> <div class=highlight><pre><span></span><code><a id=__codelineno-69-1 name=__codelineno-69-1 href=#__codelineno-69-1></a>chmod<span class=w> </span>+x<span class=w> </span>oracle_backup.sh
<a id=__codelineno-69-2 name=__codelineno-69-2 href=#__codelineno-69-2></a>
<a id=__codelineno-69-3 name=__codelineno-69-3 href=#__codelineno-69-3></a>crontab<span class=w> </span>-e
<a id=__codelineno-69-4 name=__codelineno-69-4 href=#__codelineno-69-4></a><span class=c1># Oracle 数据库备份</span>
<a id=__codelineno-69-5 name=__codelineno-69-5 href=#__codelineno-69-5></a><span class=m>0</span><span class=w> </span><span class=m>3</span><span class=w> </span>*<span class=w> </span>*<span class=w> </span><span class=m>6</span><span class=w> </span>root<span class=w> </span>sh<span class=w> </span>/opt/oracle_backup.sh<span class=w> </span>&gt;&gt;<span class=w> </span>/opt/oraclebackup.log
</code></pre></div> <h3 id=postgresql>PostgreSQL<a class=headerlink href=#postgresql title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-70-1 name=__codelineno-70-1 href=#__codelineno-70-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-70-2 name=__codelineno-70-2 href=#__codelineno-70-2></a><span class=c1>#Description：备份 PostgreSQL 数据库必能压缩成 gz 文件，最后删除 3 天前的备份文件。</span>
<a id=__codelineno-70-3 name=__codelineno-70-3 href=#__codelineno-70-3></a>
<a id=__codelineno-70-4 name=__codelineno-70-4 href=#__codelineno-70-4></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;开始执行 PostgreSQL 数据库的备份...&quot;</span>
<a id=__codelineno-70-5 name=__codelineno-70-5 href=#__codelineno-70-5></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;backup ing...&quot;</span>
<a id=__codelineno-70-6 name=__codelineno-70-6 href=#__codelineno-70-6></a><span class=nv>today</span><span class=o>=</span><span class=k>$(</span>date<span class=w> </span>+%Y-%m-%d<span class=k>)</span><span class=w>                       </span><span class=c1># 今天的日期</span>
<a id=__codelineno-70-7 name=__codelineno-70-7 href=#__codelineno-70-7></a><span class=nv>nowtime</span><span class=o>=</span><span class=k>$(</span>date<span class=w> </span>+%F+%T<span class=k>)</span><span class=w>                        </span><span class=c1># 当前时间点</span>
<a id=__codelineno-70-8 name=__codelineno-70-8 href=#__codelineno-70-8></a><span class=nv>yestoday</span><span class=o>=</span><span class=k>$(</span>date<span class=w> </span>-d<span class=w> </span><span class=s1>&#39;-7 day&#39;</span><span class=w> </span>+%Y-%m-%d<span class=k>)</span><span class=w>        </span><span class=c1># 7天前的日期</span>
<a id=__codelineno-70-9 name=__codelineno-70-9 href=#__codelineno-70-9></a><span class=nv>host_ip</span><span class=o>=</span><span class=m>127</span>.0.0.1<span class=w>                             </span><span class=c1># 本机 IP 地址</span>
<a id=__codelineno-70-10 name=__codelineno-70-10 href=#__codelineno-70-10></a><span class=nv>backup_ip</span><span class=o>=</span><span class=m>192</span>.168.1.111<span class=w>                       </span><span class=c1># 远端备份服务器 IP</span>
<a id=__codelineno-70-11 name=__codelineno-70-11 href=#__codelineno-70-11></a><span class=nv>port_id</span><span class=o>=</span><span class=m>5432</span><span class=w>                                  </span><span class=c1># 端口号，PostgreSQL默认的端口号是5432</span>
<a id=__codelineno-70-12 name=__codelineno-70-12 href=#__codelineno-70-12></a><span class=nv>username</span><span class=o>=</span>postgres<span class=w>                             </span><span class=c1># 数据库用户</span>
<a id=__codelineno-70-13 name=__codelineno-70-13 href=#__codelineno-70-13></a><span class=nb>export</span><span class=w> </span><span class=nv>PGPASSWORD</span><span class=o>=</span>7u<span class=p>&amp;</span>8i*9o<span class=o>(</span><span class=w>                   </span><span class=c1># 数据库密码</span>
<a id=__codelineno-70-14 name=__codelineno-70-14 href=#__codelineno-70-14></a><span class=nv>dmpDir</span><span class=o>=</span>/opt/pgbak<span class=w>                             </span><span class=c1># 本地备份目录</span>
<a id=__codelineno-70-15 name=__codelineno-70-15 href=#__codelineno-70-15></a><span class=nv>destination</span><span class=o>=</span>/bigdata/pg_backup<span class=w>                </span><span class=c1># 远端备份目录</span>
<a id=__codelineno-70-16 name=__codelineno-70-16 href=#__codelineno-70-16></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;时间：&quot;</span><span class=w> </span><span class=nv>$nowtime</span>
<a id=__codelineno-70-17 name=__codelineno-70-17 href=#__codelineno-70-17></a><span class=nb>set</span><span class=w> </span>timeout<span class=w> </span><span class=m>600</span>
<a id=__codelineno-70-18 name=__codelineno-70-18 href=#__codelineno-70-18></a>
<a id=__codelineno-70-19 name=__codelineno-70-19 href=#__codelineno-70-19></a><span class=c1>#/monchickey/bin/ 为 pg_dump 备份工具安装路径，根据实际情况更新此路径。</span>
<a id=__codelineno-70-20 name=__codelineno-70-20 href=#__codelineno-70-20></a>/monchickey/bin/pg_dumpall<span class=w> </span>--file<span class=w> </span><span class=s2>&quot;&quot;</span><span class=nv>$dmpDir</span><span class=s2>&quot;/pg_backup_&quot;</span><span class=nv>$today</span><span class=s2>&quot;.sql&quot;</span><span class=w> </span>--host<span class=w> </span><span class=s2>&quot;</span><span class=nv>$host_ip</span><span class=s2>&quot;</span><span class=w> </span>--port<span class=w> </span><span class=s2>&quot;</span><span class=nv>$port_id</span><span class=s2>&quot;</span><span class=w> </span>--username<span class=w> </span><span class=s2>&quot;</span><span class=nv>$username</span><span class=s2>&quot;</span>
<a id=__codelineno-70-21 name=__codelineno-70-21 href=#__codelineno-70-21></a><span class=c1>#--verbose --role &quot;postgres&quot; --format=c --blobs --encoding &quot;UTF8&quot; 备份转换扩展配置</span>
<a id=__codelineno-70-22 name=__codelineno-70-22 href=#__codelineno-70-22></a>
<a id=__codelineno-70-23 name=__codelineno-70-23 href=#__codelineno-70-23></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;PostgreSQL 数据库备份完成！&quot;</span>
<a id=__codelineno-70-24 name=__codelineno-70-24 href=#__codelineno-70-24></a>
<a id=__codelineno-70-25 name=__codelineno-70-25 href=#__codelineno-70-25></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;当天备份文件压缩中...&quot;</span>
<a id=__codelineno-70-26 name=__codelineno-70-26 href=#__codelineno-70-26></a>gzip<span class=w> </span><span class=s2>&quot;</span><span class=nv>$dmpDir</span><span class=s2>&quot;</span>/pg_backup_<span class=s2>&quot;</span><span class=nv>$today</span><span class=s2>&quot;</span>.sql.gz<span class=w> </span><span class=p>;</span>
<a id=__codelineno-70-27 name=__codelineno-70-27 href=#__codelineno-70-27></a>find<span class=w> </span>/home/postgresql_backup/<span class=w> </span>-name<span class=w> </span><span class=s2>&quot;*sql&quot;</span><span class=w> </span>-mtime<span class=w> </span>+7<span class=w> </span>-exec<span class=w> </span>rm<span class=w> </span>-rf<span class=w> </span><span class=o>{}</span><span class=w> </span><span class=se>\;</span>
<a id=__codelineno-70-28 name=__codelineno-70-28 href=#__codelineno-70-28></a><span class=nb>set</span><span class=w> </span>timeout<span class=w> </span><span class=m>1000</span>
<a id=__codelineno-70-29 name=__codelineno-70-29 href=#__codelineno-70-29></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;7 天前的 PostgreSQL 数据库备份文件已删除！&quot;</span>
<a id=__codelineno-70-30 name=__codelineno-70-30 href=#__codelineno-70-30></a>
<a id=__codelineno-70-31 name=__codelineno-70-31 href=#__codelineno-70-31></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;开始远端备份...&quot;</span>
<a id=__codelineno-70-32 name=__codelineno-70-32 href=#__codelineno-70-32></a>scp<span class=w> </span>-r<span class=w> </span><span class=nv>$dmpDir</span><span class=s2>&quot;/pg_backup_&quot;</span><span class=nv>$today</span><span class=s2>&quot;.sql.gz root@backup_ip:destination</span>
<a id=__codelineno-70-33 name=__codelineno-70-33 href=#__codelineno-70-33></a>
<a id=__codelineno-70-34 name=__codelineno-70-34 href=#__codelineno-70-34></a><span class=s2>echo &quot;</span>远端备份完毕，感谢您使用此脚本！<span class=s2>&quot;</span>
<a id=__codelineno-70-35 name=__codelineno-70-35 href=#__codelineno-70-35></a><span class=s2>exit;</span>
</code></pre></div> <p>给 pg_dump_backup.sh 脚本增加可执行权限，并在 Linux 的/etc/crontab 文件中创建定时任务。</p> <div class=highlight><pre><span></span><code><a id=__codelineno-71-1 name=__codelineno-71-1 href=#__codelineno-71-1></a>chmod<span class=w> </span>+x<span class=w> </span>pg_dump_backup.sh
<a id=__codelineno-71-2 name=__codelineno-71-2 href=#__codelineno-71-2></a>
<a id=__codelineno-71-3 name=__codelineno-71-3 href=#__codelineno-71-3></a>crontab<span class=w> </span>-e
<a id=__codelineno-71-4 name=__codelineno-71-4 href=#__codelineno-71-4></a><span class=c1># PostgreSQL 数据库备份</span>
<a id=__codelineno-71-5 name=__codelineno-71-5 href=#__codelineno-71-5></a><span class=m>0</span><span class=w> </span><span class=m>3</span><span class=w> </span>*<span class=w> </span>*<span class=w> </span><span class=m>6</span><span class=w> </span>root<span class=w> </span>sh<span class=w> </span>/home/postgres/pg_dump_backup.sh<span class=w> </span>&gt;&gt;<span class=w> </span>/home/postgres/postgres_backup.log<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span><span class=w> </span><span class=p>&amp;</span>
</code></pre></div> <h2 id=40-deploy-highly-mysql-mha-clusters>40. deploy highly MySQL MHA clusters<a class=headerlink href=#40-deploy-highly-mysql-mha-clusters title="Permanent link">&para;</a></h2> <p><a href=https://gitee.com/HuaweiCloudDeveloper/huaweicloud-solution-deploy-a-highly-available-mha-mysql-cluster.git>https://gitee.com/HuaweiCloudDeveloper/huaweicloud-solution-deploy-a-highly-available-mha-mysql-cluster.git</a></p> <p><a href=https://gitee.com/HuaweiCloudDeveloper/huaweicloud-solution-deploy-a-highly-available-mha-mysql-cluster-en.git>https://gitee.com/HuaweiCloudDeveloper/huaweicloud-solution-deploy-a-highly-available-mha-mysql-cluster-en.git</a></p> <h2 id=41-deploy-a-highly-available-mongodb-en>41. deploy-a-highly-available-mongodb-en<a class=headerlink href=#41-deploy-a-highly-available-mongodb-en title="Permanent link">&para;</a></h2> <p><a href=https://gitee.com/HuaweiCloudDeveloper/huaweicloud-solution-deploy-a-highly-available-mongod-b.git>https://gitee.com/HuaweiCloudDeveloper/huaweicloud-solution-deploy-a-highly-available-mongod-b.git</a></p> <p><a href=https://gitee.com/HuaweiCloudDeveloper/huaweicloud-solution-deploy-a-highly-available-mongodb-en.git>https://gitee.com/HuaweiCloudDeveloper/huaweicloud-solution-deploy-a-highly-available-mongodb-en.git</a></p> <h2 id=42-deploy-开源运维监控系统-prometheus>42. deploy 开源运维监控系统 Prometheus<a class=headerlink href=#42-deploy-开源运维监控系统-prometheus title="Permanent link">&para;</a></h2> <p><a href=https://gitee.com/HuaweiCloudDeveloper/huaweicloud-solution-database-solution-for-om-platform.git>https://gitee.com/HuaweiCloudDeveloper/huaweicloud-solution-database-solution-for-om-platform.git</a></p> <h2 id=43-deploy-高可用-rabbitmq-集群>43. deploy 高可用 RabbitMQ 集群<a class=headerlink href=#43-deploy-高可用-rabbitmq-集群 title="Permanent link">&para;</a></h2> <p><a href=https://gitee.com/HuaweiCloudDeveloper/huaweicloud-solution-build-a-highly-available-rabbitmq-cluster.git>https://gitee.com/HuaweiCloudDeveloper/huaweicloud-solution-build-a-highly-available-rabbitmq-cluster.git</a></p> <h2 id=44-deploy-redis-集群>44. deploy Redis 集群<a class=headerlink href=#44-deploy-redis-集群 title="Permanent link">&para;</a></h2> <p><a href=https://gitee.com/HuaweiCloudDeveloper/huaweicloud-solution-rapid-deployment-of-high-available-redis-clusters.git>https://gitee.com/HuaweiCloudDeveloper/huaweicloud-solution-rapid-deployment-of-high-available-redis-clusters.git</a></p> <h2 id=45-docker-swarm-集群>45. Docker Swarm 集群<a class=headerlink href=#45-docker-swarm-集群 title="Permanent link">&para;</a></h2> <p><a href=https://gitee.com/HuaweiCloudDeveloper/huaweicloud-solution-rapid-deployment-of-high-availability-docker-swarm-cluster.git>https://gitee.com/HuaweiCloudDeveloper/huaweicloud-solution-rapid-deployment-of-high-availability-docker-swarm-cluster.git</a></p> <h2 id=46-deploy-nginxkeepalived>46. deploy Nginx+Keepalived<a class=headerlink href=#46-deploy-nginxkeepalived title="Permanent link">&para;</a></h2> <p><a href=https://gitee.com/HuaweiCloudDeveloper/huaweicloud-solution-build-a-highly-available-seven-layer-load-balancer.git>https://gitee.com/HuaweiCloudDeveloper/huaweicloud-solution-build-a-highly-available-seven-layer-load-balancer.git</a></p> <h2 id=47-deploy-openvpn>47. deploy OpenVPN<a class=headerlink href=#47-deploy-openvpn title="Permanent link">&para;</a></h2> <p><a href=https://gitee.com/HuaweiCloudDeveloper/huaweicloud-solution-rapid-deployment-of-openvpn.git>https://gitee.com/HuaweiCloudDeveloper/huaweicloud-solution-rapid-deployment-of-openvpn.git</a></p> <h2 id=48-deploy-zpan>48. deploy Zpan<a class=headerlink href=#48-deploy-zpan title="Permanent link">&para;</a></h2> <p><a href=https://gitee.com/HuaweiCloudDeveloper/huaweicloud-solution-zpan-based-private-network-disks.git>https://gitee.com/HuaweiCloudDeveloper/huaweicloud-solution-zpan-based-private-network-disks.git</a></p> <h2 id=49-deploy-vsftpd-软件>49. deploy VSFTPD 软件<a class=headerlink href=#49-deploy-vsftpd-软件 title="Permanent link">&para;</a></h2> <p><a href=https://gitee.com/HuaweiCloudDeveloper/huaweicloud-solution-build-an-ftp-server.git>https://gitee.com/HuaweiCloudDeveloper/huaweicloud-solution-build-an-ftp-server.git</a></p> <h2 id=50-deploy-lvskeepalived>50. deploy LVS+Keepalived<a class=headerlink href=#50-deploy-lvskeepalived title="Permanent link">&para;</a></h2> <p><a href=https://gitee.com/HuaweiCloudDeveloper/huaweicloud-solution-build-high-availability-four-layer-load-balancing.git>https://gitee.com/HuaweiCloudDeveloper/huaweicloud-solution-build-high-availability-four-layer-load-balancing.git</a></p> <h2 id=51-deploy-流复制的高可用-postgresql-集群>51. deploy 流复制的高可用 PostgreSQL 集群<a class=headerlink href=#51-deploy-流复制的高可用-postgresql-集群 title="Permanent link">&para;</a></h2> <p><a href=https://gitee.com/HuaweiCloudDeveloper/huaweicloud-solution-rapid-deployment-of-ha-postgresql.git>https://gitee.com/HuaweiCloudDeveloper/huaweicloud-solution-rapid-deployment-of-ha-postgresql.git</a></p> <h2 id=52-deploy-lnmp>52. deploy lnmp<a class=headerlink href=#52-deploy-lnmp title="Permanent link">&para;</a></h2> <p>该解决方案可以帮助您在华为云弹性云服务器上基于迅响一键部署快速构建响应式网站。迅响响应式建站软件向客户提供专业的一站式网站维护，静态缓存响应快，不同分辨率屏幕自动适应，适用于各种在云上搭建网站场景。</p> <p><a href=https://gitee.com/HuaweiCloudDeveloper/huaweicloud-solution-build-a-responsive-website-based-on-xunxiang.git>https://gitee.com/HuaweiCloudDeveloper/huaweicloud-solution-build-a-responsive-website-based-on-xunxiang.git</a></p> <p><a href=https://gitee.com/HuaweiCloudDeveloper/huaweicloud-solution-rapid-deployment-of-lnmp-environment.git>https://gitee.com/HuaweiCloudDeveloper/huaweicloud-solution-rapid-deployment-of-lnmp-environment.git</a></p> <h2 id=53自动分区格式化挂载脚本>53.自动分区、格式化、挂载脚本<a class=headerlink href=#53自动分区格式化挂载脚本 title="Permanent link">&para;</a></h2> <p><a href=https://linuxeye.com/433.html>https://linuxeye.com/433.html</a></p> <p><a href=https://mirrors.linuxeye.com/scripts/auto_fdisk.sh>https://mirrors.linuxeye.com/scripts/auto_fdisk.sh</a></p> <h2 id=54站长常用-shell-脚本整理分享>54.站长常用 Shell 脚本整理分享<a class=headerlink href=#54站长常用-shell-脚本整理分享 title="Permanent link">&para;</a></h2> <p><a href=https://www.kancloud.cn/microcloud/btcn/1505273>https://www.kancloud.cn/microcloud/btcn/1505273</a></p> <h2 id=55整理一些常用的脚本持续更新>55.整理一些常用的脚本(持续更新)<a class=headerlink href=#55整理一些常用的脚本持续更新 title="Permanent link">&para;</a></h2> <p><a href=https://7boe.top/archives/104>https://7boe.top/archives/104</a></p> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title=最后更新> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime">2024年9月6日 21:46:25</span> </span> <span class=md-source-file__fact> <span class=md-icon title=创建日期> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime">2023年4月18日 18:29:24</span> </span> </aside> <form class=md-feedback name=feedback hidden> <fieldset> <legend class=md-feedback__title> Was this page helpful? </legend> <div class=md-feedback__inner> <div class=md-feedback__list> <button class="md-feedback__icon md-icon" type=submit title="This page was helpful" data-md-value=1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m7 0c0 .8-.7 1.5-1.5 1.5S14 10.3 14 9.5 14.7 8 15.5 8s1.5.7 1.5 1.5m-5 7.73c-1.75 0-3.29-.73-4.19-1.81L9.23 14c.45.72 1.52 1.23 2.77 1.23s2.32-.51 2.77-1.23l1.42 1.42c-.9 1.08-2.44 1.81-4.19 1.81"/></svg> </button> <button class="md-feedback__icon md-icon" type=submit title="This page could be improved" data-md-value=0> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10m-6.5-4c.8 0 1.5.7 1.5 1.5s-.7 1.5-1.5 1.5-1.5-.7-1.5-1.5.7-1.5 1.5-1.5M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m2 4.5c1.75 0 3.29.72 4.19 1.81l-1.42 1.42C14.32 16.5 13.25 16 12 16s-2.32.5-2.77 1.23l-1.42-1.42C8.71 14.72 10.25 14 12 14"/></svg> </button> </div> <div class=md-feedback__note> <div data-md-value=1 hidden> Thanks for your feedback! </div> <div data-md-value=0 hidden> Thanks for your feedback! Help us improve this page by using our <a href="https://github.com/hujianli94/hujianli94.github.io/issues/new/?title=[Feedback]+17.Shell%20%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B+-+/Shell/17.Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/" target=_blank>feedback form</a>. </div> </div> </div> </fieldset> </form> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> 回到页面顶部 </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=页脚> <a href=../16.Shell%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/ class="md-footer__link md-footer__link--prev" aria-label="上一页: 16.Shell实战项目"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> 上一页 </span> <div class=md-ellipsis> 16.Shell实战项目 </div> </div> </a> <a href=../18.Shell%E8%84%9A%E6%9C%AC%E7%9A%84%E5%8F%82%E6%95%B0%E8%A7%A3%E6%9E%90%E5%B7%A5%E5%85%B7/ class="md-footer__link md-footer__link--next" aria-label="下一页: 18.Shell 脚本的参数解析工具"> <div class=md-footer__title> <span class=md-footer__direction> 下一页 </span> <div class=md-ellipsis> 18.Shell 脚本的参数解析工具 </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2023 - 2024 hujainli94 </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/hujianli94 target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> <a href=https://kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com/blog_img/20220125122524.png target=_blank rel=noopener title=kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 576 512"><!-- Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M385.2 167.6c6.4 0 12.6.3 18.8 1.1C387.4 90.3 303.3 32 207.7 32 100.5 32 13 104.8 13 197.4c0 53.4 29.3 97.5 77.9 131.6l-19.3 58.6 68-34.1c24.4 4.8 43.8 9.7 68.2 9.7 6.2 0 12.1-.3 18.3-.8-4-12.9-6.2-26.6-6.2-40.8-.1-84.9 72.9-154 165.3-154m-104.5-52.9c14.5 0 24.2 9.7 24.2 24.4 0 14.5-9.7 24.2-24.2 24.2-14.8 0-29.3-9.7-29.3-24.2.1-14.7 14.6-24.4 29.3-24.4m-136.4 48.6c-14.5 0-29.3-9.7-29.3-24.2 0-14.8 14.8-24.4 29.3-24.4 14.8 0 24.4 9.7 24.4 24.4 0 14.6-9.6 24.2-24.4 24.2M563 319.4c0-77.9-77.9-141.3-165.4-141.3-92.7 0-165.4 63.4-165.4 141.3S305 460.7 397.6 460.7c19.3 0 38.9-5.1 58.6-9.9l53.4 29.3-14.8-48.6C534 402.1 563 363.2 563 319.4m-219.1-24.5c-9.7 0-19.3-9.7-19.3-19.6 0-9.7 9.7-19.3 19.3-19.3 14.8 0 24.4 9.7 24.4 19.3 0 10-9.7 19.6-24.4 19.6m107.1 0c-9.7 0-19.3-9.7-19.3-19.6 0-9.7 9.7-19.3 19.3-19.3 14.5 0 24.4 9.7 24.4 19.3.1 10-9.9 19.6-24.4 19.6"/></svg> </a> <a href="mailto:<1879324764@qq.com>" target=_blank rel=noopener title=发送邮件 class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M498.1 5.6c10.1 7 15.4 19.1 13.5 31.2l-64 416c-1.5 9.7-7.4 18.2-16 23s-18.9 5.4-28 1.6L284 427.7l-68.5 74.1c-8.9 9.7-22.9 12.9-35.2 8.1S160 493.2 160 480v-83.6c0-4 1.5-7.8 4.2-10.8l167.6-182.8c5.8-6.3 5.6-16-.4-22s-15.7-6.4-22-.7L106 360.8l-88.3-44.2C7.1 311.3.3 300.7 0 288.9s5.9-22.8 16.1-28.7l448-256c10.7-6.1 23.9-5.5 34 1.4"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-consent data-md-component=consent id=__consent hidden> <div class=md-consent__overlay></div> <aside class=md-consent__inner> <form class="md-consent__form md-grid md-typeset" name=consent> <h4>Cookie consent</h4> <p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p> <input class=md-toggle type=checkbox id=__settings> <div class=md-consent__settings> <ul class=task-list> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=analytics checked> <span class=task-list-indicator></span> Google Analytics </label> </li> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=github checked> <span class=task-list-indicator></span> GitHub </label> </li> </ul> </div> <div class=md-consent__controls> <button class="md-button md-button--primary">同意</button> <label class=md-button for=__settings>管理设定</label> </div> </form> </aside> </div> <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout((function(){document.querySelector("[data-md-component=consent]").hidden=!1}),250);var form=document.forms.consent;for(var action of["submit","reset"])form.addEventListener(action,(function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map((function(e){return[e,!0]})))),location.hash="",location.reload()}))</script> <script id=__config type=application/json>{"base": "../..", "features": ["content.action.edit", "content.action.view", "content.code.copy", "content.code.annotate", "navigation.indexes", "navigation.footer", "navigation.indexes", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest"], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script> <script src=../../assets/javascripts/bundle.83f73b43.min.js></script> <script src=../../javascripts/extra.js></script> <script src=https://file.cdn.shafish.cn/blog/js/video.min.js></script> </body> </html>