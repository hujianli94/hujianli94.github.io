<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="stay hungry,stay foolish"><meta name=author content=hujainli94><link href=https://hujianli94.github.io/Linux/Ansible/0.Ansible%E5%85%A5%E9%97%A8/ rel=canonical><link href=../../serveices/2.ubuntu-desktop-vmware/ rel=prev><link href=../../shell/Shell%E7%AE%80%E4%BB%8B/ rel=next><link rel=icon href=../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.4.2, mkdocs-material-9.1.5"><title>Ansible入门 - DevOps运维开发手记</title><link rel=stylesheet href=../../../assets/stylesheets/main.7a7fce14.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.a0c5b2b5.min.css><style>:root{--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M1 7.775V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 0 1 0 2.474l-5.026 5.026a1.75 1.75 0 0 1-2.474 0l-6.25-6.25A1.752 1.752 0 0 1 1 7.775Zm1.5 0c0 .066.026.13.073.177l6.25 6.25a.25.25 0 0 0 .354 0l5.025-5.025a.25.25 0 0 0 0-.354l-6.25-6.25a.25.25 0 0 0-.177-.073H2.75a.25.25 0 0 0-.25.25ZM6 5a1 1 0 1 1 0 2 1 1 0 0 1 0-2Z"/></svg>');--md-admonition-icon--abstract:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M2.5 1.75v11.5c0 .138.112.25.25.25h3.17a.75.75 0 0 1 0 1.5H2.75A1.75 1.75 0 0 1 1 13.25V1.75C1 .784 1.784 0 2.75 0h8.5C12.216 0 13 .784 13 1.75v7.736a.75.75 0 0 1-1.5 0V1.75a.25.25 0 0 0-.25-.25h-8.5a.25.25 0 0 0-.25.25Zm13.274 9.537v-.001l-4.557 4.45a.75.75 0 0 1-1.055-.008l-1.943-1.95a.75.75 0 0 1 1.062-1.058l1.419 1.425 4.026-3.932a.75.75 0 1 1 1.048 1.074ZM4.75 4h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM4 7.75A.75.75 0 0 1 4.75 7h2a.75.75 0 0 1 0 1.5h-2A.75.75 0 0 1 4 7.75Z"/></svg>');--md-admonition-icon--info:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"/></svg>');--md-admonition-icon--tip:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M3.499.75a.75.75 0 0 1 1.5 0v.996C5.9 2.903 6.793 3.65 7.662 4.376l.24.202c-.036-.694.055-1.422.426-2.163C9.1.873 10.794-.045 12.622.26 14.408.558 16 1.94 16 4.25c0 1.278-.954 2.575-2.44 2.734l.146.508.065.22c.203.701.412 1.455.476 2.226.142 1.707-.4 3.03-1.487 3.898C11.714 14.671 10.27 15 8.75 15h-6a.75.75 0 0 1 0-1.5h1.376a4.484 4.484 0 0 1-.563-1.191 3.835 3.835 0 0 1-.05-2.063 4.647 4.647 0 0 1-2.025-.293.75.75 0 0 1 .525-1.406c1.357.507 2.376-.006 2.698-.318l.009-.01a.747.747 0 0 1 1.06 0 .748.748 0 0 1-.012 1.074c-.912.92-.992 1.835-.768 2.586.221.74.745 1.337 1.196 1.621H8.75c1.343 0 2.398-.296 3.074-.836.635-.507 1.036-1.31.928-2.602-.05-.603-.216-1.224-.422-1.93l-.064-.221c-.12-.407-.246-.84-.353-1.29a2.425 2.425 0 0 1-.507-.441 3.075 3.075 0 0 1-.633-1.248.75.75 0 0 1 1.455-.364c.046.185.144.436.31.627.146.168.353.305.712.305.738 0 1.25-.615 1.25-1.25 0-1.47-.95-2.315-2.123-2.51-1.172-.196-2.227.387-2.706 1.345-.46.92-.27 1.774.019 3.062l.042.19a.884.884 0 0 1 .01.05c.348.443.666.949.94 1.553a.75.75 0 1 1-1.365.62c-.553-1.217-1.32-1.94-2.3-2.768L6.7 5.527c-.814-.68-1.75-1.462-2.692-2.619a3.737 3.737 0 0 0-1.023.88c-.406.495-.663 1.036-.722 1.508.116.122.306.21.591.239.388.038.797-.06 1.032-.19a.75.75 0 0 1 .728 1.31c-.515.287-1.23.439-1.906.373-.682-.067-1.473-.38-1.879-1.193L.75 5.677V5.5c0-.984.48-1.94 1.077-2.664.46-.559 1.05-1.055 1.673-1.353V.75Z"/></svg>');--md-admonition-icon--success:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"/></svg>');--md-admonition-icon--question:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.92 6.085h.001a.749.749 0 1 1-1.342-.67c.169-.339.436-.701.849-.977C6.845 4.16 7.369 4 8 4a2.756 2.756 0 0 1 1.637.525c.503.377.863.965.863 1.725 0 .448-.115.83-.329 1.15-.205.307-.47.513-.692.662-.109.072-.22.138-.313.195l-.006.004a6.24 6.24 0 0 0-.26.16.952.952 0 0 0-.276.245.75.75 0 0 1-1.248-.832c.184-.264.42-.489.692-.661.103-.067.207-.132.313-.195l.007-.004c.1-.061.182-.11.258-.161a.969.969 0 0 0 .277-.245C8.96 6.514 9 6.427 9 6.25a.612.612 0 0 0-.262-.525A1.27 1.27 0 0 0 8 5.5c-.369 0-.595.09-.74.187a1.01 1.01 0 0 0-.34.398ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"/></svg>');--md-admonition-icon--warning:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"/></svg>');--md-admonition-icon--failure:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M2.344 2.343h-.001a8 8 0 0 1 11.314 11.314A8.002 8.002 0 0 1 .234 10.089a8 8 0 0 1 2.11-7.746Zm1.06 10.253a6.5 6.5 0 1 0 9.108-9.275 6.5 6.5 0 0 0-9.108 9.275ZM6.03 4.97 8 6.94l1.97-1.97a.749.749 0 0 1 1.275.326.749.749 0 0 1-.215.734L9.06 8l1.97 1.97a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215L8 9.06l-1.97 1.97a.749.749 0 0 1-1.275-.326.749.749 0 0 1 .215-.734L6.94 8 4.97 6.03a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018Z"/></svg>');--md-admonition-icon--danger:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M9.504.43a1.516 1.516 0 0 1 2.437 1.713L10.415 5.5h2.123c1.57 0 2.346 1.909 1.22 3.004l-7.34 7.142a1.249 1.249 0 0 1-.871.354h-.302a1.25 1.25 0 0 1-1.157-1.723L5.633 10.5H3.462c-1.57 0-2.346-1.909-1.22-3.004L9.503.429Zm1.047 1.074L3.286 8.571A.25.25 0 0 0 3.462 9H6.75a.75.75 0 0 1 .694 1.034l-1.713 4.188 6.982-6.793A.25.25 0 0 0 12.538 7H9.25a.75.75 0 0 1-.683-1.06l2.008-4.418.003-.006a.036.036 0 0 0-.004-.009l-.006-.006-.008-.001c-.003 0-.006.002-.009.004Z"/></svg>');--md-admonition-icon--bug:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M4.72.22a.75.75 0 0 1 1.06 0l1 .999a3.488 3.488 0 0 1 2.441 0l.999-1a.748.748 0 0 1 1.265.332.75.75 0 0 1-.205.729l-.775.776c.616.63.995 1.493.995 2.444v.327c0 .1-.009.197-.025.292.408.14.764.392 1.029.722l1.968-.787a.75.75 0 0 1 .556 1.392L13 7.258V9h2.25a.75.75 0 0 1 0 1.5H13v.5c0 .409-.049.806-.141 1.186l2.17.868a.75.75 0 0 1-.557 1.392l-2.184-.873A4.997 4.997 0 0 1 8 16a4.997 4.997 0 0 1-4.288-2.427l-2.183.873a.75.75 0 0 1-.558-1.392l2.17-.868A5.036 5.036 0 0 1 3 11v-.5H.75a.75.75 0 0 1 0-1.5H3V7.258L.971 6.446a.75.75 0 0 1 .558-1.392l1.967.787c.265-.33.62-.583 1.03-.722a1.677 1.677 0 0 1-.026-.292V4.5c0-.951.38-1.814.995-2.444L4.72 1.28a.75.75 0 0 1 0-1.06Zm.53 6.28a.75.75 0 0 0-.75.75V11a3.5 3.5 0 1 0 7 0V7.25a.75.75 0 0 0-.75-.75ZM6.173 5h3.654A.172.172 0 0 0 10 4.827V4.5a2 2 0 1 0-4 0v.327c0 .096.077.173.173.173Z"/></svg>');--md-admonition-icon--example:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M5 5.782V2.5h-.25a.75.75 0 0 1 0-1.5h6.5a.75.75 0 0 1 0 1.5H11v3.282l3.666 5.76C15.619 13.04 14.543 15 12.767 15H3.233c-1.776 0-2.852-1.96-1.899-3.458Zm-2.4 6.565a.75.75 0 0 0 .633 1.153h9.534a.75.75 0 0 0 .633-1.153L12.225 10.5h-8.45ZM9.5 2.5h-3V6c0 .143-.04.283-.117.403L4.73 9h6.54L9.617 6.403A.746.746 0 0 1 9.5 6Z"/></svg>');--md-admonition-icon--quote:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M1.75 2.5h10.5a.75.75 0 0 1 0 1.5H1.75a.75.75 0 0 1 0-1.5Zm4 5h8.5a.75.75 0 0 1 0 1.5h-8.5a.75.75 0 0 1 0-1.5Zm0 5h8.5a.75.75 0 0 1 0 1.5h-8.5a.75.75 0 0 1 0-1.5ZM2.5 7.75v6a.75.75 0 0 1-1.5 0v-6a.75.75 0 0 1 1.5 0Z"/></svg>');}</style><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../stylesheets/extra.css><link rel=stylesheet href=https://file.cdn.shafish.cn/blog/css/vssue.css><link rel=stylesheet href=https://file.cdn.shafish.cn/blog/css/video-js.min.css><link rel=stylesheet href=https://file.cdn.shafish.cn/blog/css/video.css><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script>var consent;"undefined"==typeof __md_analytics||(consent=__md_get("__consent"))&&consent.analytics&&__md_analytics()</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#ansible入门 class=md-skip> 跳转至 </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=页眉> <a href=../../.. title=DevOps运维开发手记 class="md-header__button md-logo" aria-label=DevOps运维开发手记 data-md-component=logo> <img src=../../../assets/images/logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> DevOps运维开发手记 </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Ansible入门 </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label=切换至深色模式 type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title=切换至深色模式 for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=blue data-md-color-accent=blue aria-label=切换至浅色模式 type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title=切换至浅色模式 for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=查找> <a href=javascript:void(0) class="md-search__icon md-icon" title=分享 aria-label=分享 data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=清空当前内容 aria-label=清空当前内容 tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> 正在初始化搜索引擎 </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/hujianli94/hujianli94.github.io title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> hujianli94.github.io </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=标签 data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> 首页 </a> </li> <li class=md-tabs__item> <a href=../../../Kubernetes/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Kubernetes/ class=md-tabs__link> Kubernetes </a> </li> <li class=md-tabs__item> <a href=../../../Docker/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Docker/ class=md-tabs__link> Docker </a> </li> <li class=md-tabs__item> <a href=../../../Python/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Pythjon-auto-ops/ class=md-tabs__link> Python </a> </li> <li class=md-tabs__item> <a href=../../../Python-vs-Go/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Python-vs-Go/ class=md-tabs__link> Python-vs-Go </a> </li> <li class=md-tabs__item> <a href=../../system/Linux%E5%86%85%E6%A0%B8%E5%BC%95%E5%AF%BC%E8%AF%A6%E8%A7%A3/ class="md-tabs__link md-tabs__link--active"> Linux </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=导航栏 data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title=DevOps运维开发手记 class="md-nav__button md-logo" aria-label=DevOps运维开发手记 data-md-component=logo> <img src=../../../assets/images/logo.png alt=logo> </a> DevOps运维开发手记 </label> <div class=md-nav__source> <a href=https://github.com/hujianli94/hujianli94.github.io title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> hujianli94.github.io </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> 首页 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> Kubernetes <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_1> <label class=md-nav__link for=__nav_2_1 id=__nav_2_1_label tabindex=0> 0.学习线路 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_1_label aria-expanded=false> <label class=md-nav__title for=__nav_2_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Kubernetes/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Kubernetes/ class=md-nav__link> Kubernetes </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2> <label class=md-nav__link for=__nav_2_2 id=__nav_2_2_label tabindex=0> 1.安装篇 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2> <span class="md-nav__icon md-icon"></span> 1.安装篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/1.Kubeadm%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/ class=md-nav__link> Kubeadm安装高可用集群 </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/2.%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/ class=md-nav__link> 二进制安装高可用K8s集群 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_3> <label class=md-nav__link for=__nav_2_3 id=__nav_2_3_label tabindex=0> 2.基础篇 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_3_label aria-expanded=false> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> 2.基础篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/3.Docker%E5%9F%BA%E7%A1%80/ class=md-nav__link> Docker基础 </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Kubernetes%E7%9A%84%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/ class=md-nav__link> Kubernetes的基础概念 </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Kubernetes%E8%B0%83%E5%BA%A6%E5%9F%BA%E7%A1%80/ class=md-nav__link> Kubernetes调度基础 </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/6.Kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83%E5%9F%BA%E7%A1%80/ class=md-nav__link> Kubernetes服务发布基础 </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/7.Kubernetes%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/ class=md-nav__link> Kubernetes配置管理 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_4> <label class=md-nav__link for=__nav_2_4 id=__nav_2_4_label tabindex=0> 3.进阶篇 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_4_label aria-expanded=false> <label class=md-nav__title for=__nav_2_4> <span class="md-nav__icon md-icon"></span> 3.进阶篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Kubernetes/3.%E8%BF%9B%E9%98%B6%E7%AF%87/8.Kubernetes%E5%AD%98%E5%82%A8%E5%85%A5%E9%97%A8/ class=md-nav__link> Kubernetes存储入门 </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/3.%E8%BF%9B%E9%98%B6%E7%AF%87/9.Kubernetes%E9%AB%98%E7%BA%A7%E8%B0%83%E5%BA%A6/ class=md-nav__link> Kubernetes高级调度 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_5> <label class=md-nav__link for=__nav_2_5 id=__nav_2_5_label tabindex=0> 4.高级篇 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_5_label aria-expanded=false> <label class=md-nav__title for=__nav_2_5> <span class="md-nav__icon md-icon"></span> 4.高级篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Kubernetes/4.%E9%AB%98%E7%BA%A7%E7%AF%87/12.%E4%BA%91%E5%8E%9F%E7%94%9F%E5%AD%98%E5%82%A8Rook/ class=md-nav__link> 云原生存储Rook </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/4.%E9%AB%98%E7%BA%A7%E7%AF%87/13.%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%AE%B9%E5%99%A8%E5%8C%96/ class=md-nav__link> 中间件容器化 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_6> <label class=md-nav__link for=__nav_2_6 id=__nav_2_6_label tabindex=0> 5.运维篇 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_6_label aria-expanded=false> <label class=md-nav__title for=__nav_2_6> <span class="md-nav__icon md-icon"></span> 5.运维篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/14.Kubernetes%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/ class=md-nav__link> Kubernetes日志收集 </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/15.Kubernetes%E7%9B%91%E6%8E%A7%E5%91%8A%E8%AD%A6/ class=md-nav__link> Kubernetes监控告警 </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/16.%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83Ingress%E8%BF%9B%E9%98%B6/ class=md-nav__link> 服务发布Ingress进阶 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_7> <label class=md-nav__link for=__nav_2_7 id=__nav_2_7_label tabindex=0> 6.DevOps篇 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_7_label aria-expanded=false> <label class=md-nav__title for=__nav_2_7> <span class="md-nav__icon md-icon"></span> 6.DevOps篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/ class=md-nav__link> DevOps实践 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> Docker <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Docker </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1> <label class=md-nav__link for=__nav_3_1 id=__nav_3_1_label tabindex=0> 0.学习线路 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_1_label aria-expanded=false> <label class=md-nav__title for=__nav_3_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Docker/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Docker/ class=md-nav__link> Docker工具集 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2> <label class=md-nav__link for=__nav_3_2 id=__nav_3_2_label tabindex=0> 1.Docker基础 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> 1.Docker基础 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Docker/1.Docker%E5%9F%BA%E7%A1%80/1.%E5%AE%89%E8%A3%85/ class=md-nav__link> 安装 </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.Docker%E5%9F%BA%E7%A1%80/2.Docker%E7%9B%B8%E5%85%B3%E8%84%9A%E6%9C%AC/ class=md-nav__link> Docker相关脚本 </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.Docker%E5%9F%BA%E7%A1%80/3.docker-compose%E7%A4%BA%E4%BE%8B/ class=md-nav__link> docker-compose示例 </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.Docker%E5%9F%BA%E7%A1%80/4.Dockerfile%E7%BC%96%E5%86%99%E4%BC%98%E5%8C%96/ class=md-nav__link> Dockerfile编写优化 </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.Docker%E5%9F%BA%E7%A1%80/5.Python%E6%93%8D%E4%BD%9CDocker/ class=md-nav__link> Python操作Docker </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_3> <label class=md-nav__link for=__nav_3_3 id=__nav_3_3_label tabindex=0> 2.Devops <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> 2.Devops </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Docker/2.Devops/1.ConfCenter/ class=md-nav__link> ConfCenter </a> </li> <li class=md-nav__item> <a href=../../../Docker/2.Devops/2.CoreDNS/ class=md-nav__link> Coredns </a> </li> <li class=md-nav__item> <a href=../../../Docker/2.Devops/3.Harbor/ class=md-nav__link> Harbor </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> Python <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Python </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_1> <label class=md-nav__link for=__nav_4_1 id=__nav_4_1_label tabindex=0> 0.学习线路 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_1_label aria-expanded=false> <label class=md-nav__title for=__nav_4_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Pythjon-auto-ops/ class=md-nav__link> Pythjon自动化运维 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_2> <label class=md-nav__link for=__nav_4_2 id=__nav_4_2_label tabindex=0> 1.基础篇 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_2_label aria-expanded=false> <label class=md-nav__title for=__nav_4_2> <span class="md-nav__icon md-icon"></span> 1.基础篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/1.Python%E5%86%85%E7%BD%AE%E5%B0%8F%E5%B7%A5%E5%85%B7/ class=md-nav__link> Python内置小工具 </a> </li> <li class=md-nav__item> <a href=../../../Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/2.Python%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E5%AE%89%E8%A3%85/ class=md-nav__link> Python第三方库安装 </a> </li> <li class=md-nav__item> <a href=../../../Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/3.Python%E5%B7%A5%E4%BD%9C%E7%8E%AF%E5%A2%83%E7%AE%A1%E7%90%86/ class=md-nav__link> Python工作环境管理 </a> </li> <li class=md-nav__item> <a href=../../../Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/4.VSCode%E4%B8%ADPython%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/ class=md-nav__link> VSCode中Python环境配置 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_3> <label class=md-nav__link for=__nav_4_3 id=__nav_4_3_label tabindex=0> 2.高级篇 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_3_label aria-expanded=false> <label class=md-nav__title for=__nav_4_3> <span class="md-nav__icon md-icon"></span> 2.高级篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/1.%E6%89%93%E9%80%A0%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/ class=md-nav__link> 打造命令行工具 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> Python-vs-Go <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Python-vs-Go </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_1> <label class=md-nav__link for=__nav_5_1 id=__nav_5_1_label tabindex=0> 0.学习线路 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_1_label aria-expanded=false> <label class=md-nav__title for=__nav_5_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python-vs-Go/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Python-vs-Go/ class=md-nav__link> Python-vs-Go </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_2> <label class=md-nav__link for=__nav_5_2 id=__nav_5_2_label tabindex=0> 1.对比学习 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_2_label aria-expanded=false> <label class=md-nav__title for=__nav_5_2> <span class="md-nav__icon md-icon"></span> 1.对比学习 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/1.Hello-World/ class=md-nav__link> Hello-World </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/2.Print/ class=md-nav__link> Print </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/3.%E6%B3%A8%E9%87%8A/ class=md-nav__link> 注释 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/4.%E5%A4%9A%E8%A1%8C%E5%AD%97%E7%AC%A6%E4%B8%B2/ class=md-nav__link> 多行字符串 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/5.Lists/ class=md-nav__link> Lists </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/6.Map/ class=md-nav__link> Map </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/7.Booleans/ class=md-nav__link> Booleans </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/8.Forloop/ class=md-nav__link> Forloop </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/9.Range/ class=md-nav__link> Range </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/10.Switch/ class=md-nav__link> Switch </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/11.%E5%8F%AF%E5%8F%98%E5%8F%82%E6%95%B0%E5%87%BD%E6%95%B0/ class=md-nav__link> 可变参数函数 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/12.%E6%97%B6%E9%97%B4%E8%AE%A1%E7%AE%97/ class=md-nav__link> 时间计算 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/13.%E5%87%BD%E6%95%B0%E7%9A%84%E9%97%AD%E5%8C%85/ class=md-nav__link> 函数的闭包 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/14.%E9%80%80%E5%87%BA%E5%A4%84%E7%90%86/ class=md-nav__link> 退出处理 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/15.%E5%BC%82%E5%B8%B8%E6%8D%95%E8%8E%B7/ class=md-nav__link> 异常捕获 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/16.%E5%8F%AF%E5%8F%98%E9%A1%B9/ class=md-nav__link> 可变项 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/17.%E7%B1%BB/ class=md-nav__link> 类 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/18.%E6%96%B9%E6%B3%95/ class=md-nav__link> 方法 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/19.%E5%B9%B6%E5%8F%91/ class=md-nav__link> 并发 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/20.Args/ class=md-nav__link> Args </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/21.%E5%AF%BC%E5%85%A5%E6%A8%A1%E5%9D%97%E5%88%AB%E5%90%8D/ class=md-nav__link> 导入模块别名 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/22.%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%A0%BC%E5%BC%8F%E5%8C%96/ class=md-nav__link> 字符串格式化 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/23.%E5%8E%BB%E9%87%8D/ class=md-nav__link> 去重 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/24.%E5%B8%A6%E9%A2%9C%E8%89%B2%E6%89%93%E5%8D%B0/ class=md-nav__link> 带颜色打印 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_3> <label class=md-nav__link for=__nav_5_3 id=__nav_5_3_label tabindex=0> 2.进阶 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_3_label aria-expanded=false> <label class=md-nav__title for=__nav_5_3> <span class="md-nav__icon md-icon"></span> 2.进阶 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python-vs-Go/2.%E8%BF%9B%E9%98%B6/1.%E4%BD%BF%E7%94%A8RPC/ class=md-nav__link> 使用RPC </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/2.%E8%BF%9B%E9%98%B6/2.%E4%BD%BF%E7%94%A8MySQL/ class=md-nav__link> 使用MySQL </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/2.%E8%BF%9B%E9%98%B6/3.%E4%BD%BF%E7%94%A8Redis/ class=md-nav__link> 使用Redis </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/2.%E8%BF%9B%E9%98%B6/4.%E4%BD%BF%E7%94%A8MongoDB/ class=md-nav__link> 使用MongoDB </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6 checked> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> Linux <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=true> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Linux </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_1> <label class=md-nav__link for=__nav_6_1 id=__nav_6_1_label tabindex=0> system <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_1_label aria-expanded=false> <label class=md-nav__title for=__nav_6_1> <span class="md-nav__icon md-icon"></span> system </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../system/Linux%E5%86%85%E6%A0%B8%E5%BC%95%E5%AF%BC%E8%AF%A6%E8%A7%A3/ class=md-nav__link> Linux内核引导详解 </a> </li> <li class=md-nav__item> <a href=../../system/Linux%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/ class=md-nav__link> Linux 系统安全加固最佳实践 </a> </li> <li class=md-nav__item> <a href=../../system/virtio%E8%AF%A6%E8%A7%A3/ class=md-nav__link> Virtio 详解 </a> </li> <li class=md-nav__item> <a href=../../system/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8E%8B%E6%B5%8B/ class=md-nav__link> 数据库压测 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_2> <label class=md-nav__link for=__nav_6_2 id=__nav_6_2_label tabindex=0> serveices <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_2_label aria-expanded=false> <label class=md-nav__title for=__nav_6_2> <span class="md-nav__icon md-icon"></span> serveices </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../serveices/1.Linux%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E4%B8%8B%E8%BD%BD/ class=md-nav__link> Linux操作系统镜像下载 </a> </li> <li class=md-nav__item> <a href=../../serveices/2.ubuntu-desktop-vmware/ class=md-nav__link> ubuntu-desktop-vmware </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_3 checked> <label class=md-nav__link for=__nav_6_3 id=__nav_6_3_label tabindex=0> Ansible <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_3_label aria-expanded=true> <label class=md-nav__title for=__nav_6_3> <span class="md-nav__icon md-icon"></span> Ansible </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Ansible入门 <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Ansible入门 </a> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#1ansible介绍 class=md-nav__link> 1.Ansible介绍 </a> <nav class=md-nav aria-label=1.Ansible介绍> <ul class=md-nav__list> <li class=md-nav__item> <a href=#ansible-的目标 class=md-nav__link> Ansible 的目标 </a> </li> <li class=md-nav__item> <a href=#ansible的使用范围 class=md-nav__link> Ansible的使用范围 </a> </li> <li class=md-nav__item> <a href=#ansible是怎么工作的 class=md-nav__link> Ansible是怎么工作的 </a> </li> <li class=md-nav__item> <a href=#对管理主机的要求 class=md-nav__link> 对管理主机的要求 </a> </li> <li class=md-nav__item> <a href=#对节点主机的要求 class=md-nav__link> 对节点主机的要求 </a> </li> <li class=md-nav__item> <a href=#ansible-概念 class=md-nav__link> Ansible 概念 </a> <nav class=md-nav aria-label="Ansible 概念"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#控制节点control-node class=md-nav__link> 控制节点(Control node) </a> </li> <li class=md-nav__item> <a href=#管理节点managed-nodes class=md-nav__link> 管理节点(Managed nodes) </a> </li> <li class=md-nav__item> <a href=#主机清单inventory class=md-nav__link> 主机清单(Inventory) </a> </li> <li class=md-nav__item> <a href=#模块modules class=md-nav__link> 模块(Modules) </a> </li> <li class=md-nav__item> <a href=#任务tasks class=md-nav__link> 任务(Tasks) </a> </li> <li class=md-nav__item> <a href=#剧本playbooks class=md-nav__link> 剧本(Playbooks) </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#社区活跃 class=md-nav__link> 社区活跃 </a> </li> <li class=md-nav__item> <a href=#ansible项目 class=md-nav__link> ansible项目 </a> </li> <li class=md-nav__item> <a href=#ansible-证书 class=md-nav__link> Ansible 证书 </a> </li> <li class=md-nav__item> <a href=#ansible-与其它配置管理的对比 class=md-nav__link> Ansible 与其它配置管理的对比 </a> </li> <li class=md-nav__item> <a href=#资源 class=md-nav__link> 资源 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2安装ansible class=md-nav__link> 2.安装Ansible </a> <nav class=md-nav aria-label=2.安装Ansible> <ul class=md-nav__list> <li class=md-nav__item> <a href=#在管理节点上安装ansible class=md-nav__link> 在管理节点上安装ansible </a> </li> <li class=md-nav__item> <a href=#bash命令行自动补全 class=md-nav__link> bash命令行自动补全 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#3快速开始 class=md-nav__link> 3.快速开始 </a> <nav class=md-nav aria-label=3.快速开始> <ul class=md-nav__list> <li class=md-nav__item> <a href=#环境信息 class=md-nav__link> 环境信息 </a> </li> <li class=md-nav__item> <a href=#任务 class=md-nav__link> 任务 </a> </li> <li class=md-nav__item> <a href=#步骤 class=md-nav__link> 步骤 </a> <nav class=md-nav aria-label=步骤> <ul class=md-nav__list> <li class=md-nav__item> <a href=#0-安装ansible class=md-nav__link> 0. 安装ansible </a> </li> <li class=md-nav__item> <a href=#1-定义主机清单 class=md-nav__link> 1. 定义主机清单 </a> </li> <li class=md-nav__item> <a href=#2-执行ansible命令 class=md-nav__link> 2. 执行ansible命令 </a> </li> <li class=md-nav__item> <a href=#3-验证 class=md-nav__link> 3. 验证 </a> </li> <li class=md-nav__item> <a href=#4-执行ansible-playbook class=md-nav__link> 4. 执行ansible playbook </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#4认识主机清单 class=md-nav__link> 4.认识主机清单 </a> <nav class=md-nav aria-label=4.认识主机清单> <ul class=md-nav__list> <li class=md-nav__item> <a href=#主机清单示例 class=md-nav__link> 主机清单示例 </a> </li> <li class=md-nav__item> <a href=#默认组 class=md-nav__link> 默认组 </a> </li> <li class=md-nav__item> <a href=#主机变量和组变量 class=md-nav__link> 主机变量和组变量 </a> </li> <li class=md-nav__item> <a href=#变量合并 class=md-nav__link> 变量合并 </a> </li> <li class=md-nav__item> <a href=#使用多个主机清单 class=md-nav__link> 使用多个主机清单 </a> </li> <li class=md-nav__item> <a href=#主机内置变量列表 class=md-nav__link> 主机内置变量列表 </a> </li> <li class=md-nav__item> <a href=#在运行的时候增加主机 class=md-nav__link> 在运行的时候增加主机 </a> </li> <li class=md-nav__item> <a href=#限定主机清单的运行主机 class=md-nav__link> 限定主机清单的运行主机 </a> </li> <li class=md-nav__item> <a href=#示例 class=md-nav__link> 示例 </a> <nav class=md-nav aria-label=示例> <ul class=md-nav__list> <li class=md-nav__item> <a href=#连接本地主机 class=md-nav__link> 连接本地主机 </a> </li> <li class=md-nav__item> <a href=#使用别名连接主机 class=md-nav__link> 使用别名连接主机 </a> </li> <li class=md-nav__item> <a href=#使用-ssh-秘钥连接主机 class=md-nav__link> 使用 ssh 秘钥连接主机 </a> </li> <li class=md-nav__item> <a href=#使用-跳板机-连接主机 class=md-nav__link> 使用 跳板机 连接主机 </a> </li> <li class=md-nav__item> <a href=#命令行指定主机清单 class=md-nav__link> 命令行指定主机清单 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#动态主机清单 class=md-nav__link> 动态主机清单 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#5patterns-匹配 class=md-nav__link> 5.Patterns 匹配 </a> <nav class=md-nav aria-label="5.Patterns 匹配"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#常用匹配 class=md-nav__link> 常用匹配 </a> </li> <li class=md-nav__item> <a href=#局限性 class=md-nav__link> 局限性 </a> </li> <li class=md-nav__item> <a href=#高级特性 class=md-nav__link> 高级特性 </a> <nav class=md-nav aria-label=高级特性> <ul class=md-nav__list> <li class=md-nav__item> <a href=#使用变量 class=md-nav__link> 使用变量 </a> </li> <li class=md-nav__item> <a href=#使用切片 class=md-nav__link> 使用切片 </a> </li> <li class=md-nav__item> <a href=#正则表达式 class=md-nav__link> 正则表达式 </a> </li> <li class=md-nav__item> <a href=#限定主机 class=md-nav__link> 限定主机 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#6使用ad-hoc命令 class=md-nav__link> 6.使用ad-hoc命令 </a> <nav class=md-nav aria-label=6.使用ad-hoc命令> <ul class=md-nav__list> <li class=md-nav__item> <a href=#ad-hoc-命令 class=md-nav__link> ad-hoc 命令 </a> </li> <li class=md-nav__item> <a href=#ad-hoc-示例 class=md-nav__link> ad-hoc 示例 </a> <nav class=md-nav aria-label="ad-hoc 示例"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#执行shell命令 class=md-nav__link> 执行shell命令 </a> <nav class=md-nav aria-label=执行shell命令> <ul class=md-nav__list> <li class=md-nav__item> <a href=#command class=md-nav__link> command </a> </li> <li class=md-nav__item> <a href=#shell class=md-nav__link> shell </a> </li> <li class=md-nav__item> <a href=#raw class=md-nav__link> raw </a> </li> <li class=md-nav__item> <a href=#script class=md-nav__link> script </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#文件管理 class=md-nav__link> 文件管理 </a> <nav class=md-nav aria-label=文件管理> <ul class=md-nav__list> <li class=md-nav__item> <a href=#copy class=md-nav__link> copy </a> </li> <li class=md-nav__item> <a href=#fetch class=md-nav__link> fetch </a> </li> <li class=md-nav__item> <a href=#file class=md-nav__link> file </a> </li> <li class=md-nav__item> <a href=#unarchive class=md-nav__link> unarchive </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#管理软件包 class=md-nav__link> 管理软件包 </a> <nav class=md-nav aria-label=管理软件包> <ul class=md-nav__list> <li class=md-nav__item> <a href=#apt class=md-nav__link> apt </a> </li> <li class=md-nav__item> <a href=#yum class=md-nav__link> yum </a> </li> <li class=md-nav__item> <a href=#package class=md-nav__link> package </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#用户和用户组 class=md-nav__link> 用户和用户组 </a> <nav class=md-nav aria-label=用户和用户组> <ul class=md-nav__list> <li class=md-nav__item> <a href=#user class=md-nav__link> user </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#版本控制 class=md-nav__link> 版本控制 </a> <nav class=md-nav aria-label=版本控制> <ul class=md-nav__list> <li class=md-nav__item> <a href=#git class=md-nav__link> git </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#服务管理 class=md-nav__link> 服务管理 </a> <nav class=md-nav aria-label=服务管理> <ul class=md-nav__list> <li class=md-nav__item> <a href=#service class=md-nav__link> service </a> </li> <li class=md-nav__item> <a href=#systemd class=md-nav__link> systemd </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#防火墙管理 class=md-nav__link> 防火墙管理 </a> <nav class=md-nav aria-label=防火墙管理> <ul class=md-nav__list> <li class=md-nav__item> <a href=#iptables class=md-nav__link> iptables </a> </li> <li class=md-nav__item> <a href=#firewalld class=md-nav__link> firewalld </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#文件内容操作 class=md-nav__link> 文件内容操作 </a> <nav class=md-nav aria-label=文件内容操作> <ul class=md-nav__list> <li class=md-nav__item> <a href=#lineinfile class=md-nav__link> lineinfile </a> </li> <li class=md-nav__item> <a href=#replace class=md-nav__link> replace </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#定时任务 class=md-nav__link> 定时任务 </a> </li> <li class=md-nav__item> <a href=#搜集系统信息 class=md-nav__link> 搜集系统信息 </a> </li> <li class=md-nav__item> <a href=#指定连接方式 class=md-nav__link> 指定连接方式 </a> </li> <li class=md-nav__item> <a href=#后台运行 class=md-nav__link> 后台运行 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#练习 class=md-nav__link> 练习 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#7熟悉ansible命令 class=md-nav__link> 7.熟悉ansible命令 </a> <nav class=md-nav aria-label=7.熟悉ansible命令> <ul class=md-nav__list> <li class=md-nav__item> <a href=#ansible class=md-nav__link> ansible </a> </li> <li class=md-nav__item> <a href=#ansible-console class=md-nav__link> ansible-console </a> </li> <li class=md-nav__item> <a href=#ansible-doc class=md-nav__link> ansible-doc </a> </li> <li class=md-nav__item> <a href=#ansible-galaxy class=md-nav__link> ansible-galaxy </a> </li> <li class=md-nav__item> <a href=#ansible-playbook class=md-nav__link> ansible-playbook </a> </li> <li class=md-nav__item> <a href=#ansible-pull class=md-nav__link> ansible-pull </a> </li> <li class=md-nav__item> <a href=#ansible-config class=md-nav__link> ansible-config </a> </li> <li class=md-nav__item> <a href=#ansible-inventory class=md-nav__link> ansible-inventory </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#8使用-playbook class=md-nav__link> 8.使用 Playbook </a> <nav class=md-nav aria-label="8.使用 Playbook"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#playbook-示例 class=md-nav__link> Playbook 示例 </a> </li> <li class=md-nav__item> <a href=#主机和用户 class=md-nav__link> 主机和用户 </a> <nav class=md-nav aria-label=主机和用户> <ul class=md-nav__list> <li class=md-nav__item> <a href=#主机的执行顺序 class=md-nav__link> 主机的执行顺序 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#任务列表 class=md-nav__link> 任务列表 </a> </li> <li class=md-nav__item> <a href=#事件处理handlers class=md-nav__link> 事件处理Handlers </a> </li> <li class=md-nav__item> <a href=#执行-playbook class=md-nav__link> 执行 Playbook </a> <nav class=md-nav aria-label="执行 Playbook"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#playbook执行顺序 class=md-nav__link> playbook执行顺序 </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_4> <label class=md-nav__link for=__nav_6_4 id=__nav_6_4_label tabindex=0> Shell <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_4_label aria-expanded=false> <label class=md-nav__title for=__nav_6_4> <span class="md-nav__icon md-icon"></span> Shell </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../shell/Shell%E7%AE%80%E4%BB%8B/ class=md-nav__link> Shell 教程概述 </a> </li> <li class=md-nav__item> <a href=../../shell/1.%E7%AC%AC%E4%B8%80%E4%B8%AAshell%E7%A8%8B%E5%BA%8F/ class=md-nav__link> 1.第一个 Shell 程序 </a> </li> <li class=md-nav__item> <a href=../../shell/2.Shell%E5%8F%98%E9%87%8F/ class=md-nav__link> 2.Shell 变量 </a> </li> <li class=md-nav__item> <a href=../../shell/3.Shell%E5%8F%82%E6%95%B0/ class=md-nav__link> 3.Shell 参数 </a> </li> <li class=md-nav__item> <a href=../../shell/4.Shell%E6%95%B0%E7%BB%84/ class=md-nav__link> 4.Shell数组 </a> </li> <li class=md-nav__item> <a href=../../shell/5.Shell%E8%BF%90%E7%AE%97%E7%AC%A6/ class=md-nav__link> 5.Shell 运算符 </a> </li> <li class=md-nav__item> <a href=../../shell/6.Shell%20echo_printf%E5%91%BD%E4%BB%A4/ class=md-nav__link> 6.Shell echo/printf 命令 </a> </li> <li class=md-nav__item> <a href=../../shell/7.Shell%20test%E5%91%BD%E4%BB%A4/ class=md-nav__link> 7.Shell test 命令 </a> </li> <li class=md-nav__item> <a href=../../shell/8.Shell%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/ class=md-nav__link> 8.Shell 流程控制 </a> </li> <li class=md-nav__item> <a href=../../shell/9.Shell%E5%87%BD%E6%95%B0/ class=md-nav__link> 8.Shell 函数 </a> </li> <li class=md-nav__item> <a href=../../shell/10.Shell%E8%BE%93%E5%85%A5_%E8%BE%93%E5%87%BA%E9%87%8D%E5%AE%9A%E5%90%91/ class=md-nav__link> 10.Shell输入/输出重定向 </a> </li> <li class=md-nav__item> <a href=../../shell/11.Shell%20%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/ class=md-nav__link> 11.Shell 正则表达式 </a> </li> <li class=md-nav__item> <a href=../../shell/12.Shell%20%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bgrep/ class=md-nav__link> 12.Shell 三剑客之grep </a> </li> <li class=md-nav__item> <a href=../../shell/13.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/ class=md-nav__link> 13.Shell三剑客之sed </a> </li> <li class=md-nav__item> <a href=../../shell/14.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bawk/ class=md-nav__link> 14.Shell三剑客之awk </a> </li> <li class=md-nav__item> <a href=../../shell/15.Shell%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/ class=md-nav__link> 15.Shell常用工具 </a> </li> <li class=md-nav__item> <a href=../../shell/16.Shell%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/ class=md-nav__link> 16.Shell实战项目 </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#1ansible介绍 class=md-nav__link> 1.Ansible介绍 </a> <nav class=md-nav aria-label=1.Ansible介绍> <ul class=md-nav__list> <li class=md-nav__item> <a href=#ansible-的目标 class=md-nav__link> Ansible 的目标 </a> </li> <li class=md-nav__item> <a href=#ansible的使用范围 class=md-nav__link> Ansible的使用范围 </a> </li> <li class=md-nav__item> <a href=#ansible是怎么工作的 class=md-nav__link> Ansible是怎么工作的 </a> </li> <li class=md-nav__item> <a href=#对管理主机的要求 class=md-nav__link> 对管理主机的要求 </a> </li> <li class=md-nav__item> <a href=#对节点主机的要求 class=md-nav__link> 对节点主机的要求 </a> </li> <li class=md-nav__item> <a href=#ansible-概念 class=md-nav__link> Ansible 概念 </a> <nav class=md-nav aria-label="Ansible 概念"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#控制节点control-node class=md-nav__link> 控制节点(Control node) </a> </li> <li class=md-nav__item> <a href=#管理节点managed-nodes class=md-nav__link> 管理节点(Managed nodes) </a> </li> <li class=md-nav__item> <a href=#主机清单inventory class=md-nav__link> 主机清单(Inventory) </a> </li> <li class=md-nav__item> <a href=#模块modules class=md-nav__link> 模块(Modules) </a> </li> <li class=md-nav__item> <a href=#任务tasks class=md-nav__link> 任务(Tasks) </a> </li> <li class=md-nav__item> <a href=#剧本playbooks class=md-nav__link> 剧本(Playbooks) </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#社区活跃 class=md-nav__link> 社区活跃 </a> </li> <li class=md-nav__item> <a href=#ansible项目 class=md-nav__link> ansible项目 </a> </li> <li class=md-nav__item> <a href=#ansible-证书 class=md-nav__link> Ansible 证书 </a> </li> <li class=md-nav__item> <a href=#ansible-与其它配置管理的对比 class=md-nav__link> Ansible 与其它配置管理的对比 </a> </li> <li class=md-nav__item> <a href=#资源 class=md-nav__link> 资源 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2安装ansible class=md-nav__link> 2.安装Ansible </a> <nav class=md-nav aria-label=2.安装Ansible> <ul class=md-nav__list> <li class=md-nav__item> <a href=#在管理节点上安装ansible class=md-nav__link> 在管理节点上安装ansible </a> </li> <li class=md-nav__item> <a href=#bash命令行自动补全 class=md-nav__link> bash命令行自动补全 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#3快速开始 class=md-nav__link> 3.快速开始 </a> <nav class=md-nav aria-label=3.快速开始> <ul class=md-nav__list> <li class=md-nav__item> <a href=#环境信息 class=md-nav__link> 环境信息 </a> </li> <li class=md-nav__item> <a href=#任务 class=md-nav__link> 任务 </a> </li> <li class=md-nav__item> <a href=#步骤 class=md-nav__link> 步骤 </a> <nav class=md-nav aria-label=步骤> <ul class=md-nav__list> <li class=md-nav__item> <a href=#0-安装ansible class=md-nav__link> 0. 安装ansible </a> </li> <li class=md-nav__item> <a href=#1-定义主机清单 class=md-nav__link> 1. 定义主机清单 </a> </li> <li class=md-nav__item> <a href=#2-执行ansible命令 class=md-nav__link> 2. 执行ansible命令 </a> </li> <li class=md-nav__item> <a href=#3-验证 class=md-nav__link> 3. 验证 </a> </li> <li class=md-nav__item> <a href=#4-执行ansible-playbook class=md-nav__link> 4. 执行ansible playbook </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#4认识主机清单 class=md-nav__link> 4.认识主机清单 </a> <nav class=md-nav aria-label=4.认识主机清单> <ul class=md-nav__list> <li class=md-nav__item> <a href=#主机清单示例 class=md-nav__link> 主机清单示例 </a> </li> <li class=md-nav__item> <a href=#默认组 class=md-nav__link> 默认组 </a> </li> <li class=md-nav__item> <a href=#主机变量和组变量 class=md-nav__link> 主机变量和组变量 </a> </li> <li class=md-nav__item> <a href=#变量合并 class=md-nav__link> 变量合并 </a> </li> <li class=md-nav__item> <a href=#使用多个主机清单 class=md-nav__link> 使用多个主机清单 </a> </li> <li class=md-nav__item> <a href=#主机内置变量列表 class=md-nav__link> 主机内置变量列表 </a> </li> <li class=md-nav__item> <a href=#在运行的时候增加主机 class=md-nav__link> 在运行的时候增加主机 </a> </li> <li class=md-nav__item> <a href=#限定主机清单的运行主机 class=md-nav__link> 限定主机清单的运行主机 </a> </li> <li class=md-nav__item> <a href=#示例 class=md-nav__link> 示例 </a> <nav class=md-nav aria-label=示例> <ul class=md-nav__list> <li class=md-nav__item> <a href=#连接本地主机 class=md-nav__link> 连接本地主机 </a> </li> <li class=md-nav__item> <a href=#使用别名连接主机 class=md-nav__link> 使用别名连接主机 </a> </li> <li class=md-nav__item> <a href=#使用-ssh-秘钥连接主机 class=md-nav__link> 使用 ssh 秘钥连接主机 </a> </li> <li class=md-nav__item> <a href=#使用-跳板机-连接主机 class=md-nav__link> 使用 跳板机 连接主机 </a> </li> <li class=md-nav__item> <a href=#命令行指定主机清单 class=md-nav__link> 命令行指定主机清单 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#动态主机清单 class=md-nav__link> 动态主机清单 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#5patterns-匹配 class=md-nav__link> 5.Patterns 匹配 </a> <nav class=md-nav aria-label="5.Patterns 匹配"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#常用匹配 class=md-nav__link> 常用匹配 </a> </li> <li class=md-nav__item> <a href=#局限性 class=md-nav__link> 局限性 </a> </li> <li class=md-nav__item> <a href=#高级特性 class=md-nav__link> 高级特性 </a> <nav class=md-nav aria-label=高级特性> <ul class=md-nav__list> <li class=md-nav__item> <a href=#使用变量 class=md-nav__link> 使用变量 </a> </li> <li class=md-nav__item> <a href=#使用切片 class=md-nav__link> 使用切片 </a> </li> <li class=md-nav__item> <a href=#正则表达式 class=md-nav__link> 正则表达式 </a> </li> <li class=md-nav__item> <a href=#限定主机 class=md-nav__link> 限定主机 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#6使用ad-hoc命令 class=md-nav__link> 6.使用ad-hoc命令 </a> <nav class=md-nav aria-label=6.使用ad-hoc命令> <ul class=md-nav__list> <li class=md-nav__item> <a href=#ad-hoc-命令 class=md-nav__link> ad-hoc 命令 </a> </li> <li class=md-nav__item> <a href=#ad-hoc-示例 class=md-nav__link> ad-hoc 示例 </a> <nav class=md-nav aria-label="ad-hoc 示例"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#执行shell命令 class=md-nav__link> 执行shell命令 </a> <nav class=md-nav aria-label=执行shell命令> <ul class=md-nav__list> <li class=md-nav__item> <a href=#command class=md-nav__link> command </a> </li> <li class=md-nav__item> <a href=#shell class=md-nav__link> shell </a> </li> <li class=md-nav__item> <a href=#raw class=md-nav__link> raw </a> </li> <li class=md-nav__item> <a href=#script class=md-nav__link> script </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#文件管理 class=md-nav__link> 文件管理 </a> <nav class=md-nav aria-label=文件管理> <ul class=md-nav__list> <li class=md-nav__item> <a href=#copy class=md-nav__link> copy </a> </li> <li class=md-nav__item> <a href=#fetch class=md-nav__link> fetch </a> </li> <li class=md-nav__item> <a href=#file class=md-nav__link> file </a> </li> <li class=md-nav__item> <a href=#unarchive class=md-nav__link> unarchive </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#管理软件包 class=md-nav__link> 管理软件包 </a> <nav class=md-nav aria-label=管理软件包> <ul class=md-nav__list> <li class=md-nav__item> <a href=#apt class=md-nav__link> apt </a> </li> <li class=md-nav__item> <a href=#yum class=md-nav__link> yum </a> </li> <li class=md-nav__item> <a href=#package class=md-nav__link> package </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#用户和用户组 class=md-nav__link> 用户和用户组 </a> <nav class=md-nav aria-label=用户和用户组> <ul class=md-nav__list> <li class=md-nav__item> <a href=#user class=md-nav__link> user </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#版本控制 class=md-nav__link> 版本控制 </a> <nav class=md-nav aria-label=版本控制> <ul class=md-nav__list> <li class=md-nav__item> <a href=#git class=md-nav__link> git </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#服务管理 class=md-nav__link> 服务管理 </a> <nav class=md-nav aria-label=服务管理> <ul class=md-nav__list> <li class=md-nav__item> <a href=#service class=md-nav__link> service </a> </li> <li class=md-nav__item> <a href=#systemd class=md-nav__link> systemd </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#防火墙管理 class=md-nav__link> 防火墙管理 </a> <nav class=md-nav aria-label=防火墙管理> <ul class=md-nav__list> <li class=md-nav__item> <a href=#iptables class=md-nav__link> iptables </a> </li> <li class=md-nav__item> <a href=#firewalld class=md-nav__link> firewalld </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#文件内容操作 class=md-nav__link> 文件内容操作 </a> <nav class=md-nav aria-label=文件内容操作> <ul class=md-nav__list> <li class=md-nav__item> <a href=#lineinfile class=md-nav__link> lineinfile </a> </li> <li class=md-nav__item> <a href=#replace class=md-nav__link> replace </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#定时任务 class=md-nav__link> 定时任务 </a> </li> <li class=md-nav__item> <a href=#搜集系统信息 class=md-nav__link> 搜集系统信息 </a> </li> <li class=md-nav__item> <a href=#指定连接方式 class=md-nav__link> 指定连接方式 </a> </li> <li class=md-nav__item> <a href=#后台运行 class=md-nav__link> 后台运行 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#练习 class=md-nav__link> 练习 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#7熟悉ansible命令 class=md-nav__link> 7.熟悉ansible命令 </a> <nav class=md-nav aria-label=7.熟悉ansible命令> <ul class=md-nav__list> <li class=md-nav__item> <a href=#ansible class=md-nav__link> ansible </a> </li> <li class=md-nav__item> <a href=#ansible-console class=md-nav__link> ansible-console </a> </li> <li class=md-nav__item> <a href=#ansible-doc class=md-nav__link> ansible-doc </a> </li> <li class=md-nav__item> <a href=#ansible-galaxy class=md-nav__link> ansible-galaxy </a> </li> <li class=md-nav__item> <a href=#ansible-playbook class=md-nav__link> ansible-playbook </a> </li> <li class=md-nav__item> <a href=#ansible-pull class=md-nav__link> ansible-pull </a> </li> <li class=md-nav__item> <a href=#ansible-config class=md-nav__link> ansible-config </a> </li> <li class=md-nav__item> <a href=#ansible-inventory class=md-nav__link> ansible-inventory </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#8使用-playbook class=md-nav__link> 8.使用 Playbook </a> <nav class=md-nav aria-label="8.使用 Playbook"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#playbook-示例 class=md-nav__link> Playbook 示例 </a> </li> <li class=md-nav__item> <a href=#主机和用户 class=md-nav__link> 主机和用户 </a> <nav class=md-nav aria-label=主机和用户> <ul class=md-nav__list> <li class=md-nav__item> <a href=#主机的执行顺序 class=md-nav__link> 主机的执行顺序 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#任务列表 class=md-nav__link> 任务列表 </a> </li> <li class=md-nav__item> <a href=#事件处理handlers class=md-nav__link> 事件处理Handlers </a> </li> <li class=md-nav__item> <a href=#执行-playbook class=md-nav__link> 执行 Playbook </a> <nav class=md-nav aria-label="执行 Playbook"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#playbook执行顺序 class=md-nav__link> playbook执行顺序 </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=ansible入门>Ansible入门<a class=headerlink href=#ansible入门 title="Permanent link">&para;</a></h1> <h2 id=1ansible介绍>1.Ansible介绍<a class=headerlink href=#1ansible介绍 title="Permanent link">&para;</a></h2> <p>Ansible 是2012年推出的一种通用自动化工具，可用于配置管理或工作流程自动化。配置管理是一种" 基础架构代码 "实践，它将事物编码，例如应该在系统上安装什么包和版本，或者应该运行什么守护进程。工作流自动化可能是从配置基础架构到部署软件的任何事情。Ansible 在2015年时被Redhat公司收购。</p> <p>Ansible是用Python编写的，它使用SSH在不同的机器上执行命令。Ansible是无代理的，这使得入手更容易。您只需要在相关机器上安装SSH和Python。</p> <p>Ansible使用声明式YAML语言"playbook"将一组主机（"hosts"）映射到定义明确的角色。</p> <p>声明性用于指示Ansible如何设置或更改事物，Ansible才进行必要的更改。</p> <h3 id=ansible-的目标>Ansible 的目标<a class=headerlink href=#ansible-的目标 title="Permanent link">&para;</a></h3> <p>一切自动化</p> <h3 id=ansible的使用范围>Ansible的使用范围<a class=headerlink href=#ansible的使用范围 title="Permanent link">&para;</a></h3> <ul> <li>自动化部署应用 </li> <li>自动化管理配置 </li> <li>自动化的持续交付 </li> <li>自动化的云服务管理 </li> <li>自动化网络设备管理</li> </ul> <p>更多信息请参考：</p> <ul> <li> <p>Ansible官方地址：<a href=https://docs.ansible.com/ >https://docs.ansible.com/</a></p> </li> <li> <p>GitHub地址：<a href=https://github.com/ansible/ansible/blob/devel/docsite/rst/index.rst>https://github.com/ansible/ansible/blob/devel/docsite/rst/index.rst</a></p> </li> <li> <p>Ansible中文权威地址：<a href=http://www.ansible.com.cn/ >http://www.ansible.com.cn/</a></p> </li> </ul> <h3 id=ansible是怎么工作的>Ansible是怎么工作的<a class=headerlink href=#ansible是怎么工作的 title="Permanent link">&para;</a></h3> <p><img alt src=https://ansible.leops.cn/images/basic/ansible-arch.png></p> <p>从上图可以看出，运行ansible的先决条件是，安装ansible到管理节点，定义主机清单，并有一些playbooks定义。</p> <p>简要的步骤</p> <ul> <li>在控制节点上安装ansible </li> <li>配置主机清单: 将被控节点的连接信息配置到主机清单中。 </li> <li>定义playbook: 指定运行主机和执行任务</li> </ul> <p>让我们来看看我们如何使用Ansible将我们的Ubuntu虚拟机转换为Web服务器。 </p> <p>您在管理节点上运行Ansible Playbook，它查看您在playbook中定义的命令参数，并通知我们定位到网络组中的节点。 </p> <p>Ansible然后读取主机清单以查找分配给Web组的节点。</p> <p>在这一点上，Ansible已经准备好开始工作，所以它将通过ssh远程连接到定义的机器，通常你会想要通过预共享密钥建立一些类型的ssh信任，这样你就不必在进行ssh登陆的时候输入密码。然后Ansible将开始逐步执行playbook中的任务，一次一个任务，从顶部到底部的顺序遍历它们，就像你手动登录执行任务一样。所以，它安装软件包，更新配置文件，使用git部署我们的网站代码，最后启动我们的Web服务。当Ansible很愉快的把一切都按预期的完成，你会得到一个执行成功的状态报告。</p> <p>可以用动图说明下此次过程。</p> <p><img alt src=https://ansible.leops.cn/images/basic/ansible-arch.gif></p> <h3 id=对管理主机的要求>对管理主机的要求<a class=headerlink href=#对管理主机的要求 title="Permanent link">&para;</a></h3> <p>目前,只要机器上安装了 Python 2（版本2.6或2.7）或Python 3（版本3.5及更高版本）都可以运行Ansible (windows系统不可以做管理主机) 管理主机的系统可以是 Red Hat, Debian, CentOS, OS X, BSD的各种版本.</p> <h3 id=对节点主机的要求>对节点主机的要求<a class=headerlink href=#对节点主机的要求 title="Permanent link">&para;</a></h3> <p>通常我们使用 ssh 与节点通信，默认使用 sftp. 如果 sftp 不可用，可在 ansible.cfg 配置文件中配置成 scp 的方式. </p> <p>在节点上也需要安装Python 2（2.6或更高版本）或Python 3（3.5或更高版本）</p> <h3 id=ansible-概念>Ansible 概念<a class=headerlink href=#ansible-概念 title="Permanent link">&para;</a></h3> <h4 id=控制节点control-node>控制节点(Control node)<a class=headerlink href=#控制节点control-node title="Permanent link">&para;</a></h4> <p>任何装有Ansible的机器可称为**控制节点**。 您可以从任何控制节点运行命令和剧本，并调用<code>/usr/bin/ansible</code>或<code>/usr/bin/ansible-playbook</code>。 </p> <p>您可以将任何安装了Python的计算机用作控制节点,笔记本电脑,共享桌面和服务器都可以运行Ansible。 但是，不能将Windows计算机用作控制节点。您也可以有多个控制节点。</p> <h4 id=管理节点managed-nodes>管理节点(Managed nodes)<a class=headerlink href=#管理节点managed-nodes title="Permanent link">&para;</a></h4> <p>使用Ansible管理的网络设备或服务器可称为**管理节点**。 受管节点有时也称为**主机**。 受管节点上是不需要安装Ansible的。</p> <h4 id=主机清单inventory>主机清单(Inventory)<a class=headerlink href=#主机清单inventory title="Permanent link">&para;</a></h4> <p>托管节点的列表。库存文件有时也称为主机文件。您的目录可以为每个托管节点指定诸如IP地址之类的信息。库存还可以组织托管节点，创建和嵌套组，以便于扩展。要了解更多关于库存的信息，请参见使用主机清单一节。</p> <h4 id=模块modules>模块(Modules)<a class=headerlink href=#模块modules title="Permanent link">&para;</a></h4> <p>Ansible执行的具体代码。每个模块都有特定的用途，从管理特定类型数据库的用户到管理特定类型网络设备上的VLAN接口。您可以使用任务调用单个模块，也可以调用剧本中的几个不同模块。要了解Ansible包含多少个模块，请查看所有模块的列表。</p> <h4 id=任务tasks>任务(Tasks)<a class=headerlink href=#任务tasks title="Permanent link">&para;</a></h4> <p>Ansible的行动单位。tasks包含一组由module组成的任务列表, 您可以使用特别的命令一次性执行单个任务。</p> <h4 id=剧本playbooks>剧本(Playbooks)<a class=headerlink href=#剧本playbooks title="Permanent link">&para;</a></h4> <p>保存了已排序的任务列表，因此可以按此顺序重复运行这些任务。 剧本可以包括变量和任务。剧本是用 YAML 编写的，易于阅读、编写、共享和理解。 要了解更多关于剧本的信息，请查看剧本。</p> <h3 id=社区活跃>社区活跃<a class=headerlink href=#社区活跃 title="Permanent link">&para;</a></h3> <blockquote> <p>统计时间: 2020年04月06日</p> </blockquote> <ul> <li>Ansible releases 304 </li> <li>Ansible modules 3387 </li> <li>Galaxy Roles 24,251 </li> <li>Github Starts 42,547 </li> <li>Github Fork 18,764 </li> <li>Github Contributors 4,955</li> </ul> <h3 id=ansible项目>ansible项目<a class=headerlink href=#ansible项目 title="Permanent link">&para;</a></h3> <p>Ansible Galaxy是一个用于查找，共享，使用Ansible role的在线社区。 <a href=https://galaxy.ansible.com/ >https://galaxy.ansible.com/</a></p> <p>Ansible Container是一个开源项目，旨在实现整个容器构建，部署和管理过程的自动化。 <a href=https://github.com/ansible/ansible-container>https://github.com/ansible/ansible-container</a></p> <p>Ansible tower 商业项目，使用可视化仪表板，基于角色的访问控制，作业调度，集成通知和图形库存管理来集中和控制IT基础架构。 <a href=https://www.ansible.com/products/tower>https://www.ansible.com/products/tower</a></p> <h3 id=ansible-证书>Ansible 证书<a class=headerlink href=#ansible-证书 title="Permanent link">&para;</a></h3> <ul> <li>AUTOMATION WITH ANSIBLE I (DO407) 了解如何安装和配置Ansible，创建和运行剧本以配置系统，并学习管理主机。</li> <li>AUTOMATION WITH ANSIBLE II: RED HAT ANSIBLE TOWER (DO409) 了解使用 Ansible Tower。</li> <li>RED HAT CERTIFICATE OF EXPERTISE IN ANSIBLE AUTOMATION (EX407) 测试您使用Ansible自动配置系统和应用程序的技能，知识和能力。 通过此考试，您将获得Ansible Automation的红帽认证证书。</li> </ul> <h3 id=ansible-与其它配置管理的对比>Ansible 与其它配置管理的对比<a class=headerlink href=#ansible-与其它配置管理的对比 title="Permanent link">&para;</a></h3> <p>笔者选择了目前几款主流的与 Ansible 功能类似的配置管理软件chef、 Puppet、Saltstack，这里所做的对比不针对各个软件的性能作比较，只是对各个软件的特性做个对比。</p> <table> <thead> <tr> <th></th> <th><strong>Ansible</strong></th> <th><strong>Chef</strong></th> <th><strong>Puppet</strong></th> <th><strong>SaltStack</strong></th> </tr> </thead> <tbody> <tr> <td><strong>程序语言</strong></td> <td>Python</td> <td>Ruby，Erlang</td> <td>C++, Clojure</td> <td>Python2</td> </tr> <tr> <td><strong>配置文件语言</strong></td> <td>YAML，JSON</td> <td>Ruby</td> <td>Propfietary</td> <td>YAML</td> </tr> <tr> <td><strong>数据库</strong></td> <td>否</td> <td>PostgreSQL</td> <td>PuppetDB</td> <td>无</td> </tr> <tr> <td><strong>传输方式</strong></td> <td>Ssh</td> <td>RabbitMQ</td> <td>Mcollective</td> <td>ZeroMQ</td> </tr> <tr> <td><strong>发布方式</strong></td> <td>Push</td> <td>Pull</td> <td>Pull</td> <td>Push</td> </tr> <tr> <td><strong>管理节点</strong></td> <td>A，B，L，O，S</td> <td>Linux</td> <td>Linux</td> <td>L，B</td> </tr> <tr> <td><strong>客户端</strong></td> <td>否</td> <td>A，B，L，O，S，W</td> <td>A，B，L，O，S，W</td> <td>A，B，L，O，S，W</td> </tr> <tr> <td><strong>无代理</strong></td> <td>是</td> <td>否</td> <td>否</td> <td>否</td> </tr> <tr> <td><strong>公有云版本</strong></td> <td>AM</td> <td>AM/AZ/PR</td> <td>否</td> <td>否</td> </tr> <tr> <td><strong>公有云管理</strong></td> <td>AM/AZ/OS/GCP</td> <td>Fog driver</td> <td>AM/AZ/VM/GCP</td> <td>salt Cloud</td> </tr> <tr> <td><strong>架构</strong></td> <td>Server</td> <td>server/client</td> <td>server/client</td> <td>server/client</td> </tr> <tr> <td><strong>逐步部署</strong></td> <td>是</td> <td>是</td> <td>否</td> <td>否</td> </tr> <tr> <td><strong>企业版UI</strong></td> <td>Ansible Tower</td> <td>opscode Manage</td> <td>Puppet Enterprise</td> <td>SaltStack Enterprise</td> </tr> <tr> <td><strong>开源版UI</strong></td> <td>Semaphore</td> <td>Chef Manage</td> <td>Foreman</td> <td>Slatpad，Saltshaker</td> </tr> <tr> <td><strong>企业版本</strong></td> <td>是</td> <td>是</td> <td>是</td> <td>是</td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td><strong>创建时间</strong></td> <td>2012年3月6日</td> <td>2009年1月16日</td> <td>2010年9月15日</td> <td>2011年2月21日</td> </tr> <tr> <td><strong>Github Starts</strong></td> <td>42,547</td> <td>6,198</td> <td>5,710</td> <td>10,747</td> </tr> <tr> <td><strong>Github Forks</strong></td> <td>18,764</td> <td>2,417</td> <td>2,138</td> <td>4,815</td> </tr> <tr> <td><strong>Contributors</strong></td> <td>4,955</td> <td>586</td> <td>536</td> <td>2,078</td> </tr> <tr> <td><strong>Commits</strong></td> <td>49,775</td> <td>26,017</td> <td>31,751</td> <td>106,129</td> </tr> </tbody> </table> <blockquote> <p>统计时间: 2020年04月06日</p> </blockquote> <h3 id=资源>资源<a class=headerlink href=#资源 title="Permanent link">&para;</a></h3> <ul> <li>源码：<a href=https://github.com/ansible/ansible>https://github.com/ansible/ansible</a></li> <li>官方文档： <a href=http://docs.ansible.com/ >http://docs.ansible.com/</a></li> <li>Jinja2 中文文档： <a href=http://docs.jinkan.org/docs/jinja2/ >http://docs.jinkan.org/docs/jinja2/</a></li> <li>yaml语法： <a href=http://www.yaml.org/ >http://www.yaml.org/</a></li> <li>ansible 电子书: <a href=https://www.ansible.com/resources/ebooks>https://www.ansible.com/resources/ebooks</a></li> <li>白皮书: <a href=https://www.ansible.com/resources/whitepapers>https://www.ansible.com/resources/whitepapers</a></li> <li>用户案例: <a href=https://www.ansible.com/resources/case-studies>https://www.ansible.com/resources/case-studies</a></li> </ul> <h2 id=2安装ansible>2.安装Ansible<a class=headerlink href=#2安装ansible title="Permanent link">&para;</a></h2> <p>学会一个软件的第一件事，就是要在各种环境上安装这个软件，安装好，我们才能进入下一步，跟着我一起来安装 <code>ansible</code> 吧</p> <div class="admonition note"> <p class=admonition-title>对管理主机的要求</p> <p>目前,只要机器上安装了 Python 2（版本2.6或2.7）或Python 3（版本3.5及更高版本）都可以运行Ansible (windows系统不可以做管理主机) 管理主机的系统可以是 Red Hat, Debian, CentOS, macOS, BSD的各种版本.</p> </div> <div class="admonition note"> <p class=admonition-title>对节点主机的要求</p> <p>通常我们使用 ssh 与节点通信，默认使用 sftp. 如果 sftp 不可用，可在 ansible.cfg 配置文件中配置成 scp 的方式. 在节点上也需要安装Python 2（2.6或更高版本）或Python 3（3.5或更高版本）</p> <p>如果节点启用了<code>selinux</code>, 在使用<code>copy</code>/<code>file</code>/<code>template</code>时需要安装 <code>libselinux-python</code> 包。</p> <p>如果想通过ansible给节点主机安装python模块，可以使用<code>raw</code>模块，命令如: </p> <p><div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a>ansible<span class=w> </span>myhost<span class=w> </span>--become<span class=w> </span>-m<span class=w> </span>raw<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;yum install -y python2&quot;</span>
</code></pre></div> <code>raw</code> 模块 可以原生执行shell命令</p> </div> <h3 id=在管理节点上安装ansible>在管理节点上安装ansible<a class=headerlink href=#在管理节点上安装ansible title="Permanent link">&para;</a></h3> <blockquote> <p>大家选择下面的一种方式进行安装 <code>ansible</code></p> </blockquote> <div class="tabbed-set tabbed-alternate" data-tabs=1:10><input checked=checked id=__tabbed_1_1 name=__tabbed_1 type=radio><input id=__tabbed_1_2 name=__tabbed_1 type=radio><input id=__tabbed_1_3 name=__tabbed_1 type=radio><input id=__tabbed_1_4 name=__tabbed_1 type=radio><input id=__tabbed_1_5 name=__tabbed_1 type=radio><input id=__tabbed_1_6 name=__tabbed_1 type=radio><input id=__tabbed_1_7 name=__tabbed_1 type=radio><input id=__tabbed_1_8 name=__tabbed_1 type=radio><input id=__tabbed_1_9 name=__tabbed_1 type=radio><input id=__tabbed_1_10 name=__tabbed_1 type=radio><div class=tabbed-labels><label for=__tabbed_1_1>CentOS/RHEL</label><label for=__tabbed_1_2>Ubuntu</label><label for=__tabbed_1_3>Debian</label><label for=__tabbed_1_4>FreeBSD</label><label for=__tabbed_1_5>dnf</label><label for=__tabbed_1_6>mac</label><label for=__tabbed_1_7>pip</label><label for=__tabbed_1_8>Python3</label><label for=__tabbed_1_9>源码</label><label for=__tabbed_1_10>离线安装</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a>sed<span class=w> </span>-e<span class=w> </span><span class=s1>&#39;s!^#baseurl=!baseurl=!g&#39;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=w>       </span>-e<span class=w>  </span><span class=s1>&#39;s!^mirrorlist=!#mirrorlist=!g&#39;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=w>       </span>-e<span class=w> </span><span class=s1>&#39;s!mirror.centos.org!mirrors.aliyun.com!g&#39;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a><span class=w>       </span>-i<span class=w>  </span>/etc/yum.repos.d/CentOS-Base.repo
<a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a>
<a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a>yum<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>epel-release
<a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a>
<a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a>sed<span class=w> </span>-e<span class=w> </span><span class=s1>&#39;s!^mirrorlist=!#mirrorlist=!g&#39;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a><span class=w>    </span>-e<span class=w> </span><span class=s1>&#39;s!^metalink=!#metalink=!g&#39;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-1-10 name=__codelineno-1-10 href=#__codelineno-1-10></a><span class=w>    </span>-e<span class=w> </span><span class=s1>&#39;s!^#baseurl=!baseurl=!g&#39;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-1-11 name=__codelineno-1-11 href=#__codelineno-1-11></a><span class=w>    </span>-e<span class=w> </span><span class=s1>&#39;s!//download\.fedoraproject\.org/pub!//mirrors.aliyun.com!g&#39;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-1-12 name=__codelineno-1-12 href=#__codelineno-1-12></a><span class=w>    </span>-e<span class=w> </span><span class=s1>&#39;s!http://mirrors\.aliyun!https://mirrors.aliyun!g&#39;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-1-13 name=__codelineno-1-13 href=#__codelineno-1-13></a><span class=w>    </span>-i<span class=w> </span>/etc/yum.repos.d/epel.repo<span class=w> </span>/etc/yum.repos.d/epel-testing.repo
<a id=__codelineno-1-14 name=__codelineno-1-14 href=#__codelineno-1-14></a>
<a id=__codelineno-1-15 name=__codelineno-1-15 href=#__codelineno-1-15></a>yum<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>ansible
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a>$<span class=w> </span>sudo<span class=w> </span>apt<span class=w> </span>update
<a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a>$<span class=w> </span>sudo<span class=w> </span>apt<span class=w> </span>install<span class=w> </span>software-properties-common
<a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a>$<span class=w> </span>sudo<span class=w> </span>apt-add-repository<span class=w> </span>--yes<span class=w> </span>--update<span class=w> </span>ppa:ansible/ansible
<a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a>$<span class=w> </span>sudo<span class=w> </span>apt<span class=w> </span>install<span class=w> </span>ansible
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a>deb<span class=w> </span>http://ppa.launchpad.net/ansible/ansible/ubuntu<span class=w> </span>trusty<span class=w> </span>main
<a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a>$<span class=w> </span>sudo<span class=w> </span>apt-key<span class=w> </span>adv<span class=w> </span>--keyserver<span class=w> </span>keyserver.ubuntu.com<span class=w> </span>--recv-keys<span class=w> </span>93C4A3FD7BB9C367
<a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a>$<span class=w> </span>sudo<span class=w> </span>apt<span class=w> </span>update
<a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a>$<span class=w> </span>sudo<span class=w> </span>apt<span class=w> </span>install<span class=w> </span>ansible
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a>$<span class=w> </span>sudo<span class=w> </span>pkg<span class=w> </span>install<span class=w> </span>py27-ansible
<a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=c1># or</span>
<a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a>$<span class=w> </span>sudo<span class=w> </span>pkg<span class=w> </span>install<span class=w> </span>py36-ansible
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a>$<span class=w> </span>sudo<span class=w> </span>dnf<span class=w> </span>install<span class=w> </span>ansible
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a>curl<span class=w> </span>https://bootstrap.pypa.io/get-pip.py<span class=w> </span>-o<span class=w> </span>get-pip.py
<a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a>python<span class=w> </span>get-pip.py
<a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a>sudo<span class=w> </span><span class=nv>CFLAGS</span><span class=o>=</span>-Qunused-arguments<span class=w> </span><span class=nv>CPPFLAGS</span><span class=o>=</span>-Qunused-arguments<span class=w> </span>pip<span class=w> </span>install<span class=w> </span>ansible<span class=w> </span>-i<span class=w> </span>https://mirrors.ustc.edu.cn/pypi/web/simple
<a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a><span class=c1># 通过此方式安装的没有生成/etc/ansible文件，可以手动生成，配置文件示例到https://github.com/ansible/ansible/tree/devel/examples</span>
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a>curl<span class=w> </span>https://bootstrap.pypa.io/get-pip.py<span class=w> </span>-o<span class=w> </span>get-pip.py
<a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a>python<span class=w> </span>get-pip.py
<a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a>pip<span class=w> </span>install<span class=w> </span>ansible<span class=w> </span>-i<span class=w> </span>https://mirrors.ustc.edu.cn/pypi/web/simple
<a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a>
<a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a><span class=c1># 通过此方式安装的没有生成/etc/ansible文件，可以手动生成，配置文件示例到https://github.com/ansible/ansible/tree/devel/examples</span>
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a>yum<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>python36<span class=w> </span>python36-tools
<a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a>curl<span class=w> </span>https://bootstrap.pypa.io/get-pip.py<span class=w> </span>-o<span class=w> </span>get-pip.py
<a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a>python3.6<span class=w> </span>get-pip.py<span class=w> </span>
<a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a>pip3.6<span class=w> </span>install<span class=w> </span>ansible<span class=w> </span>-i<span class=w> </span>https://mirrors.ustc.edu.cn/pypi/web/simple
<a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a><span class=c1># 通过此方式安装的没有生成/etc/ansible文件，可以手动生成，配置文件示例到https://github.com/ansible/ansible/tree/devel/examples</span>
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a>yum<span class=w> </span>install<span class=w> </span>-y<span class=w>  </span>python-setuptools
<a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a>easy_install<span class=w> </span>pip
<a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a>wget<span class=w> </span>https://github.com/ansible/ansible/archive/v2.9.6.tar.gz
<a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a>tar<span class=w> </span>zxf<span class=w> </span>v2.9.6.tar.gz
<a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a><span class=nb>cd</span><span class=w> </span>./ansible-2.9.6
<a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a>pip<span class=w> </span>install<span class=w> </span>-r<span class=w> </span>./requirements.txt
<a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a>python<span class=w> </span>setup.py<span class=w> </span>install
<a id=__codelineno-9-8 name=__codelineno-9-8 href=#__codelineno-9-8></a>mkdir<span class=w> </span>/etc/ansible/
<a id=__codelineno-9-9 name=__codelineno-9-9 href=#__codelineno-9-9></a>cp<span class=w> </span>examples/<span class=o>{</span>ansible.cfg,hosts<span class=o>}</span><span class=w> </span>/etc/ansible/
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=c1># 以目标主机centos7为测试</span>
<a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a><span class=c1># 1. 下载ansible及依赖系统包</span>
<a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a>curl<span class=w> </span>-sSL<span class=w> </span>https://cdn.jsdelivr.net/gh/lework/script/shell/get_packages.sh<span class=w> </span><span class=p>|</span><span class=w> </span>bash<span class=w> </span>-s<span class=w> </span>-<span class=w> </span>centos7<span class=w> </span>ansible
<a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a><span class=c1># 2. 下载好的离线包在当前目录的package_centos7_ansible</span>
<a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a>ls<span class=w> </span>package_centos7_ansible
<a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a><span class=c1># 3. 将目录拷贝到目标主机,在当前目录安装</span>
<a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a>yum<span class=w> </span>localinstall<span class=w> </span>*.rpm
</code></pre></div> </div> </div> </div> <h3 id=bash命令行自动补全>bash命令行自动补全<a class=headerlink href=#bash命令行自动补全 title="Permanent link">&para;</a></h3> <blockquote> <p>在Ansible 2.9之后，就支持了命令行参数补齐功能</p> </blockquote> <div class="tabbed-set tabbed-alternate" data-tabs=2:3><input checked=checked id=__tabbed_2_1 name=__tabbed_2 type=radio><input id=__tabbed_2_2 name=__tabbed_2 type=radio><input id=__tabbed_2_3 name=__tabbed_2 type=radio><div class=tabbed-labels><label for=__tabbed_2_1>CentOS/RHEL</label><label for=__tabbed_2_2>apt</label><label for=__tabbed_2_3>pip</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a>yum<span class=w> </span>install<span class=w> </span>epel-release
<a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a>yum<span class=w> </span>install<span class=w> </span>python-argcomplete
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a>$<span class=w> </span>sudo<span class=w> </span>apt<span class=w> </span>install<span class=w> </span>python-argcomplete
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a>pip<span class=w> </span>install<span class=w> </span>argcomplete
</code></pre></div> </div> </div> </div> <p><strong>将补全加入环境变量</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a>activate-global-python-argcomplete
<a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a><span class=nb>source</span><span class=w> </span>/etc/profile
</code></pre></div> <p>在bash 小于4.2 时，使用下列命令注册</p> <div class=highlight><pre><span></span><code><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a>$<span class=w> </span><span class=nb>eval</span><span class=w> </span><span class=k>$(</span>register-python-argcomplete<span class=w> </span>ansible<span class=k>)</span>
<a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a>$<span class=w> </span><span class=nb>eval</span><span class=w> </span><span class=k>$(</span>register-python-argcomplete<span class=w> </span>ansible-config<span class=k>)</span>
<a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a>$<span class=w> </span><span class=nb>eval</span><span class=w> </span><span class=k>$(</span>register-python-argcomplete<span class=w> </span>ansible-console<span class=k>)</span>
<a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a>$<span class=w> </span><span class=nb>eval</span><span class=w> </span><span class=k>$(</span>register-python-argcomplete<span class=w> </span>ansible-doc<span class=k>)</span>
<a id=__codelineno-15-5 name=__codelineno-15-5 href=#__codelineno-15-5></a>$<span class=w> </span><span class=nb>eval</span><span class=w> </span><span class=k>$(</span>register-python-argcomplete<span class=w> </span>ansible-galaxy<span class=k>)</span>
<a id=__codelineno-15-6 name=__codelineno-15-6 href=#__codelineno-15-6></a>$<span class=w> </span><span class=nb>eval</span><span class=w> </span><span class=k>$(</span>register-python-argcomplete<span class=w> </span>ansible-inventory<span class=k>)</span>
<a id=__codelineno-15-7 name=__codelineno-15-7 href=#__codelineno-15-7></a>$<span class=w> </span><span class=nb>eval</span><span class=w> </span><span class=k>$(</span>register-python-argcomplete<span class=w> </span>ansible-playbook<span class=k>)</span>
<a id=__codelineno-15-8 name=__codelineno-15-8 href=#__codelineno-15-8></a>$<span class=w> </span><span class=nb>eval</span><span class=w> </span><span class=k>$(</span>register-python-argcomplete<span class=w> </span>ansible-pull<span class=k>)</span>
<a id=__codelineno-15-9 name=__codelineno-15-9 href=#__codelineno-15-9></a>$<span class=w> </span><span class=nb>eval</span><span class=w> </span><span class=k>$(</span>register-python-argcomplete<span class=w> </span>ansible-vault<span class=k>)</span>
<a id=__codelineno-15-10 name=__codelineno-15-10 href=#__codelineno-15-10></a><span class=nb>source</span><span class=w> </span>/etc/profile
</code></pre></div> <h2 id=3快速开始>3.快速开始<a class=headerlink href=#3快速开始 title="Permanent link">&para;</a></h2> <p>跟着我，一步一步的开始 ansible 神奇之旅吧！</p> <h3 id=环境信息>环境信息<a class=headerlink href=#环境信息 title="Permanent link">&para;</a></h3> <p>control os: <code>centos 7.7</code></p> <p>ansible version: <code>2.9.6</code></p> <h3 id=任务>任务<a class=headerlink href=#任务 title="Permanent link">&para;</a></h3> <p>我们将要在目标主机上安装部署<code>nginx</code>服务</p> <h3 id=步骤>步骤<a class=headerlink href=#步骤 title="Permanent link">&para;</a></h3> <h4 id=0-安装ansible>0. 安装ansible<a class=headerlink href=#0-安装ansible title="Permanent link">&para;</a></h4> <blockquote> <p>本次使用的是 <code>Centos 7.7 x64</code> 系统</p> </blockquote> <div class=highlight><pre><span></span><code><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a>yum<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>epel-release
<a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a>
<a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a>sed<span class=w> </span>-e<span class=w> </span><span class=s1>&#39;s!^metalink=!#metalink=!g&#39;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a><span class=w>    </span>-e<span class=w> </span><span class=s1>&#39;s!^#baseurl=!baseurl=!g&#39;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-16-5 name=__codelineno-16-5 href=#__codelineno-16-5></a><span class=w>    </span>-e<span class=w> </span><span class=s1>&#39;s!http://download\.fedoraproject\.org/pub/epel!https://mirrors.tuna.tsinghua.edu.cn/epel!g&#39;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-16-6 name=__codelineno-16-6 href=#__codelineno-16-6></a><span class=w>    </span>-e<span class=w> </span><span class=s1>&#39;s!http://download\.example/pub/epel!https://mirrors.tuna.tsinghua.edu.cn/epel!g&#39;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-16-7 name=__codelineno-16-7 href=#__codelineno-16-7></a><span class=w>    </span>-i<span class=w> </span>/etc/yum.repos.d/epel*.repo
<a id=__codelineno-16-8 name=__codelineno-16-8 href=#__codelineno-16-8></a>
<a id=__codelineno-16-9 name=__codelineno-16-9 href=#__codelineno-16-9></a>yum<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>ansible
<a id=__codelineno-16-10 name=__codelineno-16-10 href=#__codelineno-16-10></a>yum<span class=w> </span>update<span class=w> </span>python-jinja2
</code></pre></div> <h4 id=1-定义主机清单>1. 定义主机清单<a class=headerlink href=#1-定义主机清单 title="Permanent link">&para;</a></h4> <blockquote> <p>定义一个简单的通过ssh认证的主机清单，更多配置见</p> </blockquote> <div class=highlight><pre><span></span><code><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a>cat /etc/ansible/hosts
<a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a>
<a id=__codelineno-17-3 name=__codelineno-17-3 href=#__codelineno-17-3></a>192.168.77.131 ansible_ssh_user=root ansible_ssh_pass=xxxx
</code></pre></div> <p>主机清单中的配置含义</p> <ul> <li><code>192.168.77.131</code> 定义远程主机ip地址</li> <li><code>ansible_ssh_user</code> 连接远程主机的用户</li> <li><code>ansible_ssh_pass</code> 连接远程主机的用户密码</li> </ul> <h4 id=2-执行ansible命令>2. 执行ansible命令<a class=headerlink href=#2-执行ansible命令 title="Permanent link">&para;</a></h4> <p><strong>测试连接状态</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a>ansible<span class=w> </span><span class=m>192</span>.168.77.131<span class=w> </span>-m<span class=w> </span>ping
</code></pre></div> <p>命令中的含义 - <code>192.168.77.131</code> 用于匹配主机清单中的主机名称 - <code>-m ping</code> 指定 <code>ping</code> 模块，用于测试与远程主机的连接状态</p> <p><strong>安装Nginx</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a><span class=c1># 安装</span>
<a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a>ansible<span class=w> </span><span class=m>192</span>.168.77.131<span class=w> </span>-m<span class=w> </span>yum<span class=w> </span>-a<span class=w> </span><span class=s1>&#39;name=nginx&#39;</span>
<a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a><span class=c1>#卸载</span>
<a id=__codelineno-19-4 name=__codelineno-19-4 href=#__codelineno-19-4></a>ansible<span class=w> </span><span class=m>192</span>.168.77.131<span class=w> </span>-m<span class=w> </span>yum<span class=w> </span>-a<span class=w> </span><span class=s1>&#39;name=nginx state=absent&#39;</span>
</code></pre></div> <p>命令中的含义 - <code>192.168.77.131</code> 用于匹配主机清单中的主机名称 - <code>-m yum</code> 指定 <code>yum</code> 模块，用于安装软件 - <code>-a 'name=nginx'</code> 指定模块的参数，<code>name</code>是软件的名称，默认操作是安装。</p> <p><strong>启动Nginx</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a><span class=c1># 启动</span>
<a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a>ansible<span class=w> </span><span class=m>192</span>.168.77.131<span class=w> </span>-m<span class=w> </span>systemd<span class=w> </span>-a<span class=w> </span><span class=s1>&#39;name=nginx state=started enabled=yes&#39;</span>
<a id=__codelineno-20-3 name=__codelineno-20-3 href=#__codelineno-20-3></a>
<a id=__codelineno-20-4 name=__codelineno-20-4 href=#__codelineno-20-4></a>
<a id=__codelineno-20-5 name=__codelineno-20-5 href=#__codelineno-20-5></a><span class=c1># 关闭</span>
<a id=__codelineno-20-6 name=__codelineno-20-6 href=#__codelineno-20-6></a>ansible<span class=w> </span><span class=m>192</span>.168.1.131<span class=w> </span>-m<span class=w> </span>systemd<span class=w> </span>-a<span class=w> </span><span class=s1>&#39;name=nginx state=stopped enabled=yes&#39;</span>
</code></pre></div> <p>命令中的含义 - <code>192.168.77.131</code> 用于匹配主机清单中的主机名称 - <code>-m systemd</code> 指定 <code>systemd</code> 模块，用于管理系统服务 - <code>-a 'name=nginx state=started enabled=yes'</code> 指定模块的参数，<code>name</code>是软件的名称，<code>state</code> 指定管理状态，<code>enabled</code> 是否开启自启动。</p> <h4 id=3-验证>3. 验证<a class=headerlink href=#3-验证 title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a>curl<span class=w> </span>http://192.168.77.131:80
</code></pre></div> <h4 id=4-执行ansible-playbook>4. 执行ansible playbook<a class=headerlink href=#4-执行ansible-playbook title="Permanent link">&para;</a></h4> <p><strong>定义 playbook</strong></p> <blockquote> <p>也就是任务编排，将上面3个步骤合并在一起。</p> </blockquote> <div class=highlight><pre><span></span><code><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a><span class=c1># File: install_nginx.yml</span>
<a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a>
<a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a>---
<a id=__codelineno-22-4 name=__codelineno-22-4 href=#__codelineno-22-4></a>-<span class=w> </span>hosts:<span class=w> </span><span class=m>192</span>.168.77.135
<a id=__codelineno-22-5 name=__codelineno-22-5 href=#__codelineno-22-5></a><span class=w>  </span>tasks:
<a id=__codelineno-22-6 name=__codelineno-22-6 href=#__codelineno-22-6></a><span class=w>    </span>-<span class=w> </span>name:<span class=w> </span>安装<span class=w> </span>nginx.
<a id=__codelineno-22-7 name=__codelineno-22-7 href=#__codelineno-22-7></a><span class=w>      </span>yum:<span class=w> </span><span class=nv>name</span><span class=o>=</span>nginx
<a id=__codelineno-22-8 name=__codelineno-22-8 href=#__codelineno-22-8></a><span class=w>    </span>-<span class=w> </span>name:<span class=w> </span>启动<span class=w> </span>nginx.
<a id=__codelineno-22-9 name=__codelineno-22-9 href=#__codelineno-22-9></a><span class=w>      </span>systemd:<span class=w> </span><span class=nv>name</span><span class=o>=</span>nginx<span class=w> </span><span class=nv>state</span><span class=o>=</span>started<span class=w> </span><span class=nv>enabled</span><span class=o>=</span>yes
<a id=__codelineno-22-10 name=__codelineno-22-10 href=#__codelineno-22-10></a><span class=w>    </span>-<span class=w> </span>name:<span class=w> </span>检查<span class=w> </span>nginx.
<a id=__codelineno-22-11 name=__codelineno-22-11 href=#__codelineno-22-11></a><span class=w>      </span>uri:<span class=w> </span><span class=nv>url</span><span class=o>=</span>http://127.0.0.1
<a id=__codelineno-22-12 name=__codelineno-22-12 href=#__codelineno-22-12></a><span class=w>      </span>register:<span class=w> </span>curl_result
<a id=__codelineno-22-13 name=__codelineno-22-13 href=#__codelineno-22-13></a><span class=w>      </span><span class=k>until</span>:<span class=w> </span>curl_result.status<span class=w> </span><span class=o>==</span><span class=w> </span><span class=m>200</span>
<a id=__codelineno-22-14 name=__codelineno-22-14 href=#__codelineno-22-14></a><span class=w>      </span>retries:<span class=w> </span><span class=m>5</span>
<a id=__codelineno-22-15 name=__codelineno-22-15 href=#__codelineno-22-15></a><span class=w>      </span>delay:<span class=w> </span><span class=m>3</span>
<a id=__codelineno-22-16 name=__codelineno-22-16 href=#__codelineno-22-16></a><span class=w>      </span>changed_when:<span class=w> </span><span class=nb>false</span>
<a id=__codelineno-22-17 name=__codelineno-22-17 href=#__codelineno-22-17></a><span class=w>      </span>check_mode:<span class=w> </span>no
</code></pre></div> <p><strong>执行 playbook</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a>ansible-playbook<span class=w> </span>install_nginx.yml
</code></pre></div> <p>卸载nginx： <div class=highlight><pre><span></span><code><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a><span class=c1># File: remove_nginx.yml</span>
<a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a>---
<a id=__codelineno-24-3 name=__codelineno-24-3 href=#__codelineno-24-3></a>-<span class=w> </span>hosts:<span class=w> </span><span class=m>192</span>.168.77.135
<a id=__codelineno-24-4 name=__codelineno-24-4 href=#__codelineno-24-4></a>
<a id=__codelineno-24-5 name=__codelineno-24-5 href=#__codelineno-24-5></a><span class=w>  </span>tasks:
<a id=__codelineno-24-6 name=__codelineno-24-6 href=#__codelineno-24-6></a><span class=w>    </span>-<span class=w> </span>name:<span class=w> </span>stop<span class=w> </span>nginx
<a id=__codelineno-24-7 name=__codelineno-24-7 href=#__codelineno-24-7></a><span class=w>      </span>service:<span class=w> </span><span class=nv>name</span><span class=o>=</span>nginx<span class=w> </span><span class=nv>state</span><span class=o>=</span>stopped<span class=w> </span><span class=nv>enabled</span><span class=o>=</span>no
<a id=__codelineno-24-8 name=__codelineno-24-8 href=#__codelineno-24-8></a><span class=w>    </span>-<span class=w> </span>name:<span class=w> </span>remove<span class=w> </span>nginx
<a id=__codelineno-24-9 name=__codelineno-24-9 href=#__codelineno-24-9></a><span class=w>      </span>yum:<span class=w> </span><span class=nv>name</span><span class=o>=</span>nginx<span class=w> </span><span class=nv>state</span><span class=o>=</span>absent
<a id=__codelineno-24-10 name=__codelineno-24-10 href=#__codelineno-24-10></a><span class=w>    </span>-<span class=w> </span>name:<span class=w> </span>remove<span class=w> </span>user<span class=w> </span>nginx
<a id=__codelineno-24-11 name=__codelineno-24-11 href=#__codelineno-24-11></a><span class=w>      </span>user:<span class=w> </span><span class=nv>name</span><span class=o>=</span>nginx<span class=w> </span><span class=nv>state</span><span class=o>=</span>absent
<a id=__codelineno-24-12 name=__codelineno-24-12 href=#__codelineno-24-12></a><span class=w>    </span>-<span class=w> </span>name:<span class=w> </span>remove<span class=w> </span>group<span class=w> </span>nginx
<a id=__codelineno-24-13 name=__codelineno-24-13 href=#__codelineno-24-13></a><span class=w>      </span>group:<span class=w> </span><span class=nv>name</span><span class=o>=</span>nginx<span class=w> </span><span class=nv>state</span><span class=o>=</span>absent
<a id=__codelineno-24-14 name=__codelineno-24-14 href=#__codelineno-24-14></a><span class=w>    </span>-<span class=w> </span>name:<span class=w> </span>web<span class=w> </span>page
<a id=__codelineno-24-15 name=__codelineno-24-15 href=#__codelineno-24-15></a><span class=w>      </span>file:<span class=w> </span>
<a id=__codelineno-24-16 name=__codelineno-24-16 href=#__codelineno-24-16></a><span class=w>        </span>path:<span class=w> </span>/usr/share/nginx/html/index.html<span class=w> </span>
<a id=__codelineno-24-17 name=__codelineno-24-17 href=#__codelineno-24-17></a><span class=w>        </span>state:<span class=w> </span>absent
</code></pre></div></p> <p>恭喜你，你已经学会怎么使用ansible了。下面的课程会使你更加深入的了解 ansible 。</p> <h2 id=4认识主机清单>4.认识主机清单<a class=headerlink href=#4认识主机清单 title="Permanent link">&para;</a></h2> <p>Ansible 可同时操作属于一个组的多台主机, 组和主机之间的关系通过 <code>inventory</code> 文件配置. 默认的文件路径为 <code>/etc/ansible/hosts</code>, 执行命令的时候使用 <code>-i</code> 参数即可指定主机清单。</p> <h3 id=主机清单示例>主机清单示例<a class=headerlink href=#主机清单示例 title="Permanent link">&para;</a></h3> <p>主机清单文件主要有 <code>ini</code> 和 <code>yaml</code> 格式两种语法格式</p> <div class=highlight><pre><span></span><code><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a><span class=na>mail.example.com       # 定义主机fqdn地址, 且已经与控制节点ssh互信</span>
<a id=__codelineno-25-2 name=__codelineno-25-2 href=#__codelineno-25-2></a>
<a id=__codelineno-25-3 name=__codelineno-25-3 href=#__codelineno-25-3></a><span class=na>[webservers]  # 方括号[]中是组名</span>
<a id=__codelineno-25-4 name=__codelineno-25-4 href=#__codelineno-25-4></a><span class=na>host1  # 定义主机名称, 且已经与控制节点ssh互信</span>
<a id=__codelineno-25-5 name=__codelineno-25-5 href=#__codelineno-25-5></a><span class=na>host2</span><span class=o>:</span><span class=s>5522</span><span class=w>  </span><span class=c1># 指定连接主机和端口号</span>
<a id=__codelineno-25-6 name=__codelineno-25-6 href=#__codelineno-25-6></a><span class=na>localhost ansible_connection</span><span class=o>=</span><span class=s>local</span><span class=w>  </span><span class=c1># ansible_connection可以定义连接类型, local是在本地执行</span>
<a id=__codelineno-25-7 name=__codelineno-25-7 href=#__codelineno-25-7></a><span class=na>host3 http_port</span><span class=o>=</span><span class=s>80 maxRequestsPerChild=808</span><span class=w>  </span><span class=c1># 定义主机变量, 除了ansible定义的特殊名称外，其他的都是主机变量</span>
<a id=__codelineno-25-8 name=__codelineno-25-8 href=#__codelineno-25-8></a><span class=na>host4 ansible_host</span><span class=o>=</span><span class=s>192.168.1.50 ansible_port=2222 ansible_user=root ansible_password=12345</span><span class=w> </span><span class=c1># 指定别名，定义主机ssh连接信息</span>
<a id=__codelineno-25-9 name=__codelineno-25-9 href=#__codelineno-25-9></a><span class=na>www[1</span><span class=o>:</span><span class=s>50].example.com</span><span class=w> </span><span class=c1># 定义 1-50范围内的主机</span>
<a id=__codelineno-25-10 name=__codelineno-25-10 href=#__codelineno-25-10></a><span class=na>www-[a</span><span class=o>:</span><span class=s>f].example.com</span><span class=w> </span><span class=c1># 定义 a-f 范围内内的主机</span>
<a id=__codelineno-25-11 name=__codelineno-25-11 href=#__codelineno-25-11></a>
<a id=__codelineno-25-12 name=__codelineno-25-12 href=#__codelineno-25-12></a><span class=k>[dbservers]</span>
<a id=__codelineno-25-13 name=__codelineno-25-13 href=#__codelineno-25-13></a><span class=na>three.example.com  ansible_python_interpreter</span><span class=o>=</span><span class=s>/usr/local/bin/python3</span><span class=w>  </span><span class=c1># 定义python执行ansible，这个是指定被控节点的。</span>
<a id=__codelineno-25-14 name=__codelineno-25-14 href=#__codelineno-25-14></a><span class=na>192.168.77.123  ansible_ruby_interpreter</span><span class=o>=</span><span class=s>/usr/bin/ruby.1.9.3</span><span class=w>  </span><span class=c1># 定义ruby执行文件</span>
<a id=__codelineno-25-15 name=__codelineno-25-15 href=#__codelineno-25-15></a>
<a id=__codelineno-25-16 name=__codelineno-25-16 href=#__codelineno-25-16></a>
<a id=__codelineno-25-17 name=__codelineno-25-17 href=#__codelineno-25-17></a><span class=na>[webservers</span><span class=o>:</span><span class=s>vars]</span><span class=w> </span><span class=c1># 定义webservers组的变量</span>
<a id=__codelineno-25-18 name=__codelineno-25-18 href=#__codelineno-25-18></a><span class=na>ntp_server</span><span class=o>=</span><span class=s>ntp.example.com</span>
<a id=__codelineno-25-19 name=__codelineno-25-19 href=#__codelineno-25-19></a><span class=na>proxy</span><span class=o>=</span><span class=s>proxy.example.com</span>
<a id=__codelineno-25-20 name=__codelineno-25-20 href=#__codelineno-25-20></a>
<a id=__codelineno-25-21 name=__codelineno-25-21 href=#__codelineno-25-21></a><span class=na>[server</span><span class=o>:</span><span class=s>children]</span><span class=w> </span><span class=c1># 定义server组的子成员</span>
<a id=__codelineno-25-22 name=__codelineno-25-22 href=#__codelineno-25-22></a><span class=na>webservers</span>
<a id=__codelineno-25-23 name=__codelineno-25-23 href=#__codelineno-25-23></a><span class=na>dbservers</span>
<a id=__codelineno-25-24 name=__codelineno-25-24 href=#__codelineno-25-24></a>
<a id=__codelineno-25-25 name=__codelineno-25-25 href=#__codelineno-25-25></a><span class=na>[server</span><span class=o>:</span><span class=s>vars]</span><span class=w> </span><span class=c1># 定义server组的变量</span>
<a id=__codelineno-25-26 name=__codelineno-25-26 href=#__codelineno-25-26></a><span class=na>zabbix_server</span><span class=o>:</span><span class=s>192.168.77.121</span>
</code></pre></div> <div class="admonition note"> <p class=admonition-title>Note</p> <p>注意！组名称中不要带<code>-</code></p> </div> <p>上列配置的一些解释：</p> <ul> <li>主机可以在多个组中配置。</li> <li><code>ansible_connection</code> 是执行主机的连接类型，默认是smart</li> <li><code>ansible_host</code> 主机ssh连接地址</li> <li><code>ansible_port</code> 主机ssh连接端口</li> <li><code>ansible_user</code> 主机ssh连接用户</li> <li><code>ansible_password</code> 主机ssh连接用户密码</li> <li><code>ansible_python_interpreter</code> 指定python的执行路径</li> <li><code>[webservers:vars]</code> 定义webservers组的变量</li> <li><code>[server:children]</code> 定义server组的子成员</li> </ul> <p>也可使使用yaml格式来表示</p> <div class=highlight><pre><span></span><code><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a><span class=nt>all</span><span class=p>:</span>
<a id=__codelineno-26-2 name=__codelineno-26-2 href=#__codelineno-26-2></a><span class=w>  </span><span class=nt>children</span><span class=p>:</span>
<a id=__codelineno-26-3 name=__codelineno-26-3 href=#__codelineno-26-3></a><span class=w>    </span><span class=nt>usa</span><span class=p>:</span>
<a id=__codelineno-26-4 name=__codelineno-26-4 href=#__codelineno-26-4></a><span class=w>      </span><span class=nt>children</span><span class=p>:</span>
<a id=__codelineno-26-5 name=__codelineno-26-5 href=#__codelineno-26-5></a><span class=w>        </span><span class=nt>southeast</span><span class=p>:</span>
<a id=__codelineno-26-6 name=__codelineno-26-6 href=#__codelineno-26-6></a><span class=w>          </span><span class=nt>children</span><span class=p>:</span>
<a id=__codelineno-26-7 name=__codelineno-26-7 href=#__codelineno-26-7></a><span class=w>            </span><span class=nt>atlanta</span><span class=p>:</span>
<a id=__codelineno-26-8 name=__codelineno-26-8 href=#__codelineno-26-8></a><span class=w>              </span><span class=nt>hosts</span><span class=p>:</span>
<a id=__codelineno-26-9 name=__codelineno-26-9 href=#__codelineno-26-9></a><span class=w>                </span><span class=nt>host1</span><span class=p>:</span>
<a id=__codelineno-26-10 name=__codelineno-26-10 href=#__codelineno-26-10></a><span class=w>                </span><span class=nt>host2</span><span class=p>:</span>
<a id=__codelineno-26-11 name=__codelineno-26-11 href=#__codelineno-26-11></a><span class=w>            </span><span class=nt>raleigh</span><span class=p>:</span>
<a id=__codelineno-26-12 name=__codelineno-26-12 href=#__codelineno-26-12></a><span class=w>              </span><span class=nt>hosts</span><span class=p>:</span>
<a id=__codelineno-26-13 name=__codelineno-26-13 href=#__codelineno-26-13></a><span class=w>                </span><span class=nt>host2</span><span class=p>:</span>
<a id=__codelineno-26-14 name=__codelineno-26-14 href=#__codelineno-26-14></a><span class=w>                </span><span class=nt>host3</span><span class=p>:</span>
<a id=__codelineno-26-15 name=__codelineno-26-15 href=#__codelineno-26-15></a><span class=w>          </span><span class=nt>vars</span><span class=p>:</span>
<a id=__codelineno-26-16 name=__codelineno-26-16 href=#__codelineno-26-16></a><span class=w>            </span><span class=nt>some_server</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">foo.southeast.example.com</span>
<a id=__codelineno-26-17 name=__codelineno-26-17 href=#__codelineno-26-17></a><span class=w>            </span><span class=nt>halon_system_timeout</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">30</span>
<a id=__codelineno-26-18 name=__codelineno-26-18 href=#__codelineno-26-18></a><span class=w>            </span><span class=nt>self_destruct_countdown</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">60</span>
<a id=__codelineno-26-19 name=__codelineno-26-19 href=#__codelineno-26-19></a><span class=w>            </span><span class=nt>escape_pods</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<a id=__codelineno-26-20 name=__codelineno-26-20 href=#__codelineno-26-20></a><span class=w>        </span><span class=nt>northeast</span><span class=p>:</span>
<a id=__codelineno-26-21 name=__codelineno-26-21 href=#__codelineno-26-21></a><span class=w>        </span><span class=nt>northwest</span><span class=p>:</span>
<a id=__codelineno-26-22 name=__codelineno-26-22 href=#__codelineno-26-22></a><span class=w>        </span><span class=nt>southwest</span><span class=p>:</span>
</code></pre></div> <blockquote> <p>yaml格式配置的还是挺复杂的，可读性也差，建议使用<code>ini</code>方式来设置主机清单。 </p> </blockquote> <h3 id=默认组>默认组<a class=headerlink href=#默认组 title="Permanent link">&para;</a></h3> <p>在主机清单中，ansible会自动的生成两个组。</p> <ul> <li><code>all</code> 所有的主机。</li> <li><code>ungrouped</code> 包含没有组的主机。</li> </ul> <p>尽管这两个组是永远存在的，但也有可能是隐藏的，不会出现group_names之类的组列表中。</p> <h3 id=主机变量和组变量>主机变量和组变量<a class=headerlink href=#主机变量和组变量 title="Permanent link">&para;</a></h3> <p>如果你不想在主机清单中定义主机的变量或者组的变量，ansible还支持在特定的目录中定义变量。</p> <p>变量文件必须以yaml语法定义。</p> <p>如默认在<code>/etc/ansible/host_vars/</code> 目录中定义主机变量，文件名称以主机名称命名，结束可以用'.yml', '.yaml', '.json'三种格式。</p> <div class=highlight><pre><span></span><code><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a>cat<span class=w> </span>/etc/ansible/host_vars/host1
<a id=__codelineno-27-2 name=__codelineno-27-2 href=#__codelineno-27-2></a>---
<a id=__codelineno-27-3 name=__codelineno-27-3 href=#__codelineno-27-3></a>ntp_server:<span class=w> </span>acme.example.org
<a id=__codelineno-27-4 name=__codelineno-27-4 href=#__codelineno-27-4></a>database_server:<span class=w> </span>storage.example.org
</code></pre></div> <p>如默认在<code>/etc/ansible/group_vars/</code> 目录中定义组变量，文件名称以组名称命名，结束可以用'.yml', '.yaml', '.json'三种格式。</p> <div class=highlight><pre><span></span><code><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a>cat<span class=w> </span>/etc/ansible/group_vars/webservers
<a id=__codelineno-28-2 name=__codelineno-28-2 href=#__codelineno-28-2></a>---
<a id=__codelineno-28-3 name=__codelineno-28-3 href=#__codelineno-28-3></a>ntp_server:<span class=w> </span>acme.example.org
<a id=__codelineno-28-4 name=__codelineno-28-4 href=#__codelineno-28-4></a>database_server:<span class=w> </span>storage.example.org
</code></pre></div> <h3 id=变量合并>变量合并<a class=headerlink href=#变量合并 title="Permanent link">&para;</a></h3> <p>我们可以通过多种方式给主机定义变量，如果在各个环节都设置了变量，到底哪个变量生效呢？这就要看ansible的变量优先级，优先级高的会覆盖优先级低的变量。</p> <p>优先顺序，all最低，host最高</p> <ul> <li>all group</li> <li>parent group</li> <li>child group</li> <li>host</li> </ul> <p>相同组时，默认情况下，按字母顺序后面组的定义会覆盖前面的。也可以使用ansible_group_priority调整优先级，数值越大优先级越高，默认为1，相同优先级时，后者优先。</p> <div class=highlight><pre><span></span><code><a id=__codelineno-29-1 name=__codelineno-29-1 href=#__codelineno-29-1></a><span class=k>[a_group:vars]</span>
<a id=__codelineno-29-2 name=__codelineno-29-2 href=#__codelineno-29-2></a><span class=na>testvar</span><span class=o>=</span><span class=s>a</span>
<a id=__codelineno-29-3 name=__codelineno-29-3 href=#__codelineno-29-3></a><span class=na>ansible_group_priority</span><span class=o>=</span><span class=s>10</span>
<a id=__codelineno-29-4 name=__codelineno-29-4 href=#__codelineno-29-4></a><span class=k>[b_group]</span>
<a id=__codelineno-29-5 name=__codelineno-29-5 href=#__codelineno-29-5></a><span class=na>testvar</span><span class=o>=</span><span class=s>b</span>
</code></pre></div> <h3 id=使用多个主机清单>使用多个主机清单<a class=headerlink href=#使用多个主机清单 title="Permanent link">&para;</a></h3> <p>在命令参数中，使用多个 <code>-i</code> 就可以指定多个主机清单 </p> <div class=highlight><pre><span></span><code><a id=__codelineno-30-1 name=__codelineno-30-1 href=#__codelineno-30-1></a>ansible<span class=w> </span>all<span class=w> </span>-i<span class=w> </span>staging<span class=w> </span>-i<span class=w> </span>production<span class=w> </span>-m<span class=w> </span>ping
<a id=__codelineno-30-2 name=__codelineno-30-2 href=#__codelineno-30-2></a>ansible<span class=w> </span>all<span class=w> </span>-i<span class=w> </span>/tmp/staging<span class=w> </span>-i<span class=w> </span>/tmp/production<span class=w> </span>-m<span class=w> </span>ping
</code></pre></div> <p>也可以指定一个目录</p> <div class=highlight><pre><span></span><code><a id=__codelineno-31-1 name=__codelineno-31-1 href=#__codelineno-31-1></a>inventory/
<a id=__codelineno-31-2 name=__codelineno-31-2 href=#__codelineno-31-2></a>  01-openstack.yml          # configure inventory plugin to get hosts from Openstack cloud
<a id=__codelineno-31-3 name=__codelineno-31-3 href=#__codelineno-31-3></a>  02-dynamic-inventory.py   # add additional hosts with dynamic inventory script
<a id=__codelineno-31-4 name=__codelineno-31-4 href=#__codelineno-31-4></a>  03-static-inventory       # add static hosts
<a id=__codelineno-31-5 name=__codelineno-31-5 href=#__codelineno-31-5></a>  group_vars/
<a id=__codelineno-31-6 name=__codelineno-31-6 href=#__codelineno-31-6></a>    all.yml                 # assign variables to all hosts
</code></pre></div> <div class=highlight><pre><span></span><code><a id=__codelineno-32-1 name=__codelineno-32-1 href=#__codelineno-32-1></a>ansible<span class=w> </span>all<span class=w> </span>-i<span class=w> </span>inventory<span class=w> </span>-m<span class=w> </span>ping
</code></pre></div> <h3 id=主机内置变量列表>主机内置变量列表<a class=headerlink href=#主机内置变量列表 title="Permanent link">&para;</a></h3> <p><strong>用于主机连接</strong></p> <table> <thead> <tr> <th>参数</th> <th>描述</th> </tr> </thead> <tbody> <tr> <td>ansible_connection</td> <td>与主机的连接类型.比如:local, ssh 或者 paramiko. Ansible 1.2 以前默认使用 paramiko.1.2 以后默认使用 'smart','smart' 方式会根据是否支持 ControlPersist, 来判断'ssh' 方式是否可行.</td> </tr> </tbody> </table> <p><strong>用于所有连接</strong></p> <table> <thead> <tr> <th>参数</th> <th>描述</th> </tr> </thead> <tbody> <tr> <td>ansible_host</td> <td>将要连接的远程主机名.与你想要设定的主机的别名不同的话,可通过此变量设置.</td> </tr> <tr> <td>ansible_port</td> <td>连接端口号，如果是ssh的话，默认是22</td> </tr> <tr> <td>ansible_user</td> <td>用于连接认证的用户名</td> </tr> <tr> <td>ansible_password</td> <td>用于连接认证的用户名密码</td> </tr> </tbody> </table> <p><strong>ssh连接参数</strong></p> <table> <thead> <tr> <th>参数</th> <th>描述</th> </tr> </thead> <tbody> <tr> <td>ansible_ssh_private_key_file</td> <td>ssh 使用的私钥文件.适用于有多个密钥,而你不想使用 SSH 代理的情况.</td> </tr> <tr> <td>ansible_ssh_common_args</td> <td>此设置附加到sftp，scp和ssh的缺省命令行</td> </tr> <tr> <td>ansible_sftp_extra_args</td> <td>此设置附加到默认sftp命令行。</td> </tr> <tr> <td>ansible_scp_extra_args</td> <td>此设置附加到默认scp命令行。</td> </tr> <tr> <td>ansible_ssh_extra_args</td> <td>此设置附加到默认ssh命令行。</td> </tr> <tr> <td>ansible_ssh_pipelining</td> <td>确定是否使用SSH管道。这可以覆盖ansible.cfg中得设置。</td> </tr> <tr> <td>ansible_ssh_executable</td> <td>ssh可执行文件</td> </tr> </tbody> </table> <p><strong>权限提升参数</strong></p> <table> <thead> <tr> <th>参数</th> <th>描述</th> </tr> </thead> <tbody> <tr> <td>ansible_become</td> <td>开启提权，等同于<code>ansible_sudo</code>，<code>ansible_su</code></td> </tr> <tr> <td>ansible_become_method</td> <td>提权方式</td> </tr> <tr> <td>ansible_become_user</td> <td>提权用户，等同于<code>ansible_sudo_user</code>，<code>ansible_su_user</code></td> </tr> <tr> <td>ansible_become_password</td> <td>提权密码,等同于<code>ansible_sudo_password</code>，<code>ansible_su_password</code></td> </tr> <tr> <td>ansible_become_exe</td> <td>提权所用的可执行文件，等同于<code>ansible_sudo_exe</code>,<code>ansible_su_exe</code></td> </tr> <tr> <td>ansible_become_flags</td> <td>提权命令的参数，等同于<code>ansible_sudo_flags</code>,<code>ansible_su_flags</code></td> </tr> </tbody> </table> <p><strong>远程主机环境参数</strong></p> <table> <thead> <tr> <th>参数</th> <th>描述</th> </tr> </thead> <tbody> <tr> <td>ansible_shell_type</td> <td>目标系统的shell类型.默认情况下,命令的执行使用 'sh' 语法,可设置为 'csh' 或 'fish'.</td> </tr> <tr> <td>ansible_python_interpreter</td> <td>目标主机的 python 路径.适用于的情况: 系统中有多个 Python, 或者命令路径不是"/usr/bin/python",比如 *BSD, 或者 /usr/bin/python</td> </tr> <tr> <td>ansible_*_interpreter</td> <td>这里的"*"可以是 ruby 或 perl 或其他语言的解释器，作用和ansible_python_interpreter 类似</td> </tr> <tr> <td>ansible_shell_executable</td> <td>这将设置ansible控制器将在目标机器上使用的shell，覆盖ansible.cfg中的配置，默认为/bin/sh。</td> </tr> </tbody> </table> <p><strong>非SSH连接类型参数</strong></p> <p>ansible默认是使用 <code>ssh</code> 连接主机，但也不限制于这种方式，可以通过使用主机特定参数 <code>ansible_connection = &lt;connector&gt;</code>，来更改连接类型。以下是支持的连接类型。</p> <table> <thead> <tr> <th>参数</th> <th>描述</th> </tr> </thead> <tbody> <tr> <td>local</td> <td>在控制端本地执行</td> </tr> <tr> <td>docker</td> <td>使用本地Docker客户端</td> </tr> <tr> <td>ansible_host</td> <td>容器连接的主机</td> </tr> <tr> <td>ansible_port</td> <td>容器连接的端口</td> </tr> <tr> <td>ansible_become</td> <td>如果设置为true，则会使用begin_user在容器内进行操作。</td> </tr> <tr> <td>ansible_docker_extra_args</td> <td>Docker 的额外参数</td> </tr> </tbody> </table> <p>一个创建容器的小例子</p> <div class=highlight><pre><span></span><code><a id=__codelineno-33-1 name=__codelineno-33-1 href=#__codelineno-33-1></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">create jenkins container</span>
<a id=__codelineno-33-2 name=__codelineno-33-2 href=#__codelineno-33-2></a><span class=w>  </span><span class=nt>docker_container</span><span class=p>:</span>
<a id=__codelineno-33-3 name=__codelineno-33-3 href=#__codelineno-33-3></a><span class=w>    </span><span class=nt>docker_host</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">myserver.net:4243</span>
<a id=__codelineno-33-4 name=__codelineno-33-4 href=#__codelineno-33-4></a><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">my_jenkins</span>
<a id=__codelineno-33-5 name=__codelineno-33-5 href=#__codelineno-33-5></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">jenkins</span>
<a id=__codelineno-33-6 name=__codelineno-33-6 href=#__codelineno-33-6></a>
<a id=__codelineno-33-7 name=__codelineno-33-7 href=#__codelineno-33-7></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">add container to inventory</span>
<a id=__codelineno-33-8 name=__codelineno-33-8 href=#__codelineno-33-8></a><span class=w>  </span><span class=nt>add_host</span><span class=p>:</span>
<a id=__codelineno-33-9 name=__codelineno-33-9 href=#__codelineno-33-9></a><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">my_jenkins</span>
<a id=__codelineno-33-10 name=__codelineno-33-10 href=#__codelineno-33-10></a><span class=w>    </span><span class=nt>ansible_connection</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">docker</span>
<a id=__codelineno-33-11 name=__codelineno-33-11 href=#__codelineno-33-11></a><span class=w>    </span><span class=nt>ansible_docker_extra_args</span><span class=p>:</span><span class=w> </span><span class=s>&quot;--tlsverify</span><span class=nv> </span><span class=s>--tlscacert=/path/to/ca.pem</span><span class=nv> </span><span class=s>--tlscert=/path/to/client-cert.pem</span><span class=nv> </span><span class=s>--tlskey=/path/to/client-key.pem</span><span class=nv> </span><span class=s>-H=tcp://myserver.net:4243&quot;</span>
<a id=__codelineno-33-12 name=__codelineno-33-12 href=#__codelineno-33-12></a><span class=w>    </span><span class=nt>ansible_user</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">jenkins</span>
<a id=__codelineno-33-13 name=__codelineno-33-13 href=#__codelineno-33-13></a><span class=w>  </span><span class=nt>changed_when</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<a id=__codelineno-33-14 name=__codelineno-33-14 href=#__codelineno-33-14></a>
<a id=__codelineno-33-15 name=__codelineno-33-15 href=#__codelineno-33-15></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">create directory for ssh keys</span>
<a id=__codelineno-33-16 name=__codelineno-33-16 href=#__codelineno-33-16></a><span class=w>  </span><span class=nt>delegate_to</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">my_jenkins</span>
<a id=__codelineno-33-17 name=__codelineno-33-17 href=#__codelineno-33-17></a><span class=w>  </span><span class=nt>file</span><span class=p>:</span>
<a id=__codelineno-33-18 name=__codelineno-33-18 href=#__codelineno-33-18></a><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/var/jenkins_home/.ssh/jupiter&quot;</span>
<a id=__codelineno-33-19 name=__codelineno-33-19 href=#__codelineno-33-19></a><span class=w>    </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">directory</span>
</code></pre></div> <h3 id=在运行的时候增加主机>在运行的时候增加主机<a class=headerlink href=#在运行的时候增加主机 title="Permanent link">&para;</a></h3> <p>使用 <code>add_host</code> 模块动态添加运行主机，此类主机只有在运行时才会向内存中添加，运行结束后，也不会添加到静态主机清单文件中。</p> <div class=highlight><pre><span></span><code><a id=__codelineno-34-1 name=__codelineno-34-1 href=#__codelineno-34-1></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">add new node into runtime inventory</span>
<a id=__codelineno-34-2 name=__codelineno-34-2 href=#__codelineno-34-2></a><span class=w>  </span><span class=nt>add_host</span><span class=p>:</span>
<a id=__codelineno-34-3 name=__codelineno-34-3 href=#__codelineno-34-3></a><span class=w>    </span><span class=nt>hostname</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">webserver</span>
<a id=__codelineno-34-4 name=__codelineno-34-4 href=#__codelineno-34-4></a><span class=w>    </span><span class=nt>groups</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">web</span>
<a id=__codelineno-34-5 name=__codelineno-34-5 href=#__codelineno-34-5></a><span class=nt>​    ansible_host</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">192.168.77.129</span>
<a id=__codelineno-34-6 name=__codelineno-34-6 href=#__codelineno-34-6></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">ansible_port</span><span class="p p-Indicator">:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">22</span>
</code></pre></div> <h3 id=限定主机清单的运行主机>限定主机清单的运行主机<a class=headerlink href=#限定主机清单的运行主机 title="Permanent link">&para;</a></h3> <p>使用<code>--limit hostname</code>可以在运行任务的时候，只允许在此主机上运行。</p> <div class=highlight><pre><span></span><code><a id=__codelineno-35-1 name=__codelineno-35-1 href=#__codelineno-35-1></a><span class="p p-Indicator">[</span><span class=nv>root@master ansible</span><span class="p p-Indicator">]</span><span class=c1># ansible-playbook test.yml --list-hosts</span>
<a id=__codelineno-35-2 name=__codelineno-35-2 href=#__codelineno-35-2></a><span class=w> </span><span class=nt>playbook</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">test.yml</span>
<a id=__codelineno-35-3 name=__codelineno-35-3 href=#__codelineno-35-3></a><span class=w>  </span><span class="l l-Scalar l-Scalar-Plain">play</span><span class=w> </span><span class=c1>#1 (test2): test2        TAGS: []</span>
<a id=__codelineno-35-4 name=__codelineno-35-4 href=#__codelineno-35-4></a><span class=w>    </span><span class=nt>pattern</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=nv>u&#39;test2&#39;</span><span class="p p-Indicator">]</span>
<a id=__codelineno-35-5 name=__codelineno-35-5 href=#__codelineno-35-5></a><span class=w>    </span><span class=nt>hosts (3)</span><span class=p>:</span>
<a id=__codelineno-35-6 name=__codelineno-35-6 href=#__codelineno-35-6></a><span class=w>      </span><span class="l l-Scalar l-Scalar-Plain">node1</span>
<a id=__codelineno-35-7 name=__codelineno-35-7 href=#__codelineno-35-7></a><span class=w>      </span><span class="l l-Scalar l-Scalar-Plain">node3</span>
<a id=__codelineno-35-8 name=__codelineno-35-8 href=#__codelineno-35-8></a><span class=w>      </span><span class="l l-Scalar l-Scalar-Plain">node2</span>
<a id=__codelineno-35-9 name=__codelineno-35-9 href=#__codelineno-35-9></a><span class="p p-Indicator">[</span><span class=nv>root@master ansible</span><span class="p p-Indicator">]</span><span class=c1># ansible-playbook test.yml --list-hosts --limit node3,node2</span>
<a id=__codelineno-35-10 name=__codelineno-35-10 href=#__codelineno-35-10></a><span class=nt>playbook</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">test.yml</span>
<a id=__codelineno-35-11 name=__codelineno-35-11 href=#__codelineno-35-11></a><span class=w>  </span><span class="l l-Scalar l-Scalar-Plain">play</span><span class=w> </span><span class=c1>#1 (test2): test2        TAGS: []</span>
<a id=__codelineno-35-12 name=__codelineno-35-12 href=#__codelineno-35-12></a><span class=w>    </span><span class=nt>pattern</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=nv>u&#39;test2&#39;</span><span class="p p-Indicator">]</span>
<a id=__codelineno-35-13 name=__codelineno-35-13 href=#__codelineno-35-13></a><span class=w>    </span><span class=nt>hosts (2)</span><span class=p>:</span>
<a id=__codelineno-35-14 name=__codelineno-35-14 href=#__codelineno-35-14></a><span class=w>      </span><span class="l l-Scalar l-Scalar-Plain">node3</span>
<a id=__codelineno-35-15 name=__codelineno-35-15 href=#__codelineno-35-15></a><span class=w>      </span><span class="l l-Scalar l-Scalar-Plain">node2</span>
</code></pre></div> <h3 id=示例>示例<a class=headerlink href=#示例 title="Permanent link">&para;</a></h3> <h4 id=连接本地主机>连接本地主机<a class=headerlink href=#连接本地主机 title="Permanent link">&para;</a></h4> <p>不需要在主机清单里定义，直接使用 <code>localhost</code> 或 <code>127.0.0.1</code> 就可以连接本地了</p> <div class=highlight><pre><span></span><code><a id=__codelineno-36-1 name=__codelineno-36-1 href=#__codelineno-36-1></a><span class=c1># ansible localhost -m ping</span>
<a id=__codelineno-36-2 name=__codelineno-36-2 href=#__codelineno-36-2></a>localhost<span class=w> </span><span class=p>|</span><span class=w> </span><span class=nv>SUCCESS</span><span class=w> </span><span class=o>=</span>&gt;<span class=w> </span><span class=o>{</span>
<a id=__codelineno-36-3 name=__codelineno-36-3 href=#__codelineno-36-3></a><span class=w>    </span><span class=s2>&quot;changed&quot;</span>:<span class=w> </span>false,<span class=w> </span>
<a id=__codelineno-36-4 name=__codelineno-36-4 href=#__codelineno-36-4></a><span class=w>    </span><span class=s2>&quot;ping&quot;</span>:<span class=w> </span><span class=s2>&quot;pong&quot;</span>
<a id=__codelineno-36-5 name=__codelineno-36-5 href=#__codelineno-36-5></a><span class=o>}</span>
<a id=__codelineno-36-6 name=__codelineno-36-6 href=#__codelineno-36-6></a>
<a id=__codelineno-36-7 name=__codelineno-36-7 href=#__codelineno-36-7></a><span class=c1># ansible 127.0.0.1 -m ping</span>
<a id=__codelineno-36-8 name=__codelineno-36-8 href=#__codelineno-36-8></a><span class=m>127</span>.0.0.1<span class=w> </span><span class=p>|</span><span class=w> </span><span class=nv>SUCCESS</span><span class=w> </span><span class=o>=</span>&gt;<span class=w> </span><span class=o>{</span>
<a id=__codelineno-36-9 name=__codelineno-36-9 href=#__codelineno-36-9></a><span class=w>    </span><span class=s2>&quot;changed&quot;</span>:<span class=w> </span>false,<span class=w> </span>
<a id=__codelineno-36-10 name=__codelineno-36-10 href=#__codelineno-36-10></a><span class=w>    </span><span class=s2>&quot;ping&quot;</span>:<span class=w> </span><span class=s2>&quot;pong&quot;</span>
<a id=__codelineno-36-11 name=__codelineno-36-11 href=#__codelineno-36-11></a><span class=o>}</span>
</code></pre></div> <h4 id=使用别名连接主机>使用别名连接主机<a class=headerlink href=#使用别名连接主机 title="Permanent link">&para;</a></h4> <p><strong>定义主机清单</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-37-1 name=__codelineno-37-1 href=#__codelineno-37-1></a><span class=c1># cat /etc/ansible/hosts</span>
<a id=__codelineno-37-2 name=__codelineno-37-2 href=#__codelineno-37-2></a>
<a id=__codelineno-37-3 name=__codelineno-37-3 href=#__codelineno-37-3></a>alias_host<span class=w> </span><span class=nv>ansible_host</span><span class=o>=</span><span class=m>192</span>.168.77.131<span class=w> </span><span class=nv>ansible_port</span><span class=o>=</span><span class=m>22</span><span class=w> </span><span class=nv>ansible_user</span><span class=o>=</span>root<span class=w> </span><span class=nv>ansible_password</span><span class=o>=</span><span class=m>123456</span><span class=w> </span><span class=c1># 指定别名，定义主机ssh连接信息</span>
</code></pre></div> <strong>测试连通性</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-38-1 name=__codelineno-38-1 href=#__codelineno-38-1></a><span class=c1># ansible alias_host -m ping</span>
<a id=__codelineno-38-2 name=__codelineno-38-2 href=#__codelineno-38-2></a>alias_host<span class=w> </span><span class=p>|</span><span class=w> </span><span class=nv>SUCCESS</span><span class=w> </span><span class=o>=</span>&gt;<span class=w> </span><span class=o>{</span>
<a id=__codelineno-38-3 name=__codelineno-38-3 href=#__codelineno-38-3></a><span class=w>    </span><span class=s2>&quot;ansible_facts&quot;</span>:<span class=w> </span><span class=o>{</span>
<a id=__codelineno-38-4 name=__codelineno-38-4 href=#__codelineno-38-4></a><span class=w>        </span><span class=s2>&quot;discovered_interpreter_python&quot;</span>:<span class=w> </span><span class=s2>&quot;/usr/bin/python&quot;</span>
<a id=__codelineno-38-5 name=__codelineno-38-5 href=#__codelineno-38-5></a><span class=w>    </span><span class=o>}</span>,<span class=w> </span>
<a id=__codelineno-38-6 name=__codelineno-38-6 href=#__codelineno-38-6></a><span class=w>    </span><span class=s2>&quot;changed&quot;</span>:<span class=w> </span>false,<span class=w> </span>
<a id=__codelineno-38-7 name=__codelineno-38-7 href=#__codelineno-38-7></a><span class=w>    </span><span class=s2>&quot;ping&quot;</span>:<span class=w> </span><span class=s2>&quot;pong&quot;</span>
<a id=__codelineno-38-8 name=__codelineno-38-8 href=#__codelineno-38-8></a><span class=o>}</span>
</code></pre></div></p> <h4 id=使用-ssh-秘钥连接主机>使用 ssh 秘钥连接主机<a class=headerlink href=#使用-ssh-秘钥连接主机 title="Permanent link">&para;</a></h4> <p><strong>开启远程主机秘钥认证</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-39-1 name=__codelineno-39-1 href=#__codelineno-39-1></a><span class=c1># echo &#39;PubkeyAuthentication yes&#39; &gt;&gt; /etc/ssh/sshd_config</span>
<a id=__codelineno-39-2 name=__codelineno-39-2 href=#__codelineno-39-2></a><span class=c1># systemctl restart sshd</span>
</code></pre></div></p> <p><strong>配置远程主机秘钥</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-40-1 name=__codelineno-40-1 href=#__codelineno-40-1></a><span class=c1># ssh-keygen -t rsa -P &#39;&#39; -b 4096 -f ~/.ssh/id_rsa</span>
<a id=__codelineno-40-2 name=__codelineno-40-2 href=#__codelineno-40-2></a><span class=c1># cat ~/.ssh/id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys</span>
<a id=__codelineno-40-3 name=__codelineno-40-3 href=#__codelineno-40-3></a><span class=c1># chmod 600 ~/.ssh/authorized_keys</span>
</code></pre></div></p> <p><strong>将刚刚生成的私钥 <code>~/.ssh/id_rsa</code> 拷贝到 ansible 节点</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-41-1 name=__codelineno-41-1 href=#__codelineno-41-1></a><span class=c1># mv id_rsa /opt/131.key</span>
<a id=__codelineno-41-2 name=__codelineno-41-2 href=#__codelineno-41-2></a><span class=c1># chmod 600 /opt/131.key</span>
</code></pre></div></p> <p><strong>定义主机清单</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-42-1 name=__codelineno-42-1 href=#__codelineno-42-1></a><span class=c1># cat /etc/ansible/hosts</span>
<a id=__codelineno-42-2 name=__codelineno-42-2 href=#__codelineno-42-2></a><span class=m>192</span>.168.77.131<span class=w> </span><span class=nv>ansible_ssh_private_key_file</span><span class=o>=</span>/opt/131.key
</code></pre></div></p> <blockquote> <p>不指定 <code>ansible_user</code> 则使用运行ansible命令的用户</p> </blockquote> <div class="admonition note"> <p class=admonition-title>Note</p> <p>如果 <code>private_key</code> 使用了 <strong>passphrase</strong> ，可使用下列命令，将密码保存在 ssh-agent 中。 <div class=highlight><pre><span></span><code><a id=__codelineno-43-1 name=__codelineno-43-1 href=#__codelineno-43-1></a>ssh-agent<span class=w> </span>bash
<a id=__codelineno-43-2 name=__codelineno-43-2 href=#__codelineno-43-2></a>ssh-add<span class=w> </span>/opt/131.key
</code></pre></div></p> </div> <p><strong>测试连通性</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-44-1 name=__codelineno-44-1 href=#__codelineno-44-1></a><span class=c1># ansible 192.168.77.131 -m ping</span>
<a id=__codelineno-44-2 name=__codelineno-44-2 href=#__codelineno-44-2></a><span class=m>192</span>.168.77.131<span class=w> </span><span class=p>|</span><span class=w> </span><span class=nv>SUCCESS</span><span class=w> </span><span class=o>=</span>&gt;<span class=w> </span><span class=o>{</span>
<a id=__codelineno-44-3 name=__codelineno-44-3 href=#__codelineno-44-3></a><span class=w>    </span><span class=s2>&quot;ansible_facts&quot;</span>:<span class=w> </span><span class=o>{</span>
<a id=__codelineno-44-4 name=__codelineno-44-4 href=#__codelineno-44-4></a><span class=w>        </span><span class=s2>&quot;discovered_interpreter_python&quot;</span>:<span class=w> </span><span class=s2>&quot;/usr/bin/python&quot;</span>
<a id=__codelineno-44-5 name=__codelineno-44-5 href=#__codelineno-44-5></a><span class=w>    </span><span class=o>}</span>,<span class=w> </span>
<a id=__codelineno-44-6 name=__codelineno-44-6 href=#__codelineno-44-6></a><span class=w>    </span><span class=s2>&quot;changed&quot;</span>:<span class=w> </span>false,<span class=w> </span>
<a id=__codelineno-44-7 name=__codelineno-44-7 href=#__codelineno-44-7></a><span class=w>    </span><span class=s2>&quot;ping&quot;</span>:<span class=w> </span><span class=s2>&quot;pong&quot;</span>
<a id=__codelineno-44-8 name=__codelineno-44-8 href=#__codelineno-44-8></a><span class=o>}</span>
</code></pre></div></p> <h4 id=使用-跳板机-连接主机>使用 跳板机 连接主机<a class=headerlink href=#使用-跳板机-连接主机 title="Permanent link">&para;</a></h4> <blockquote> <p>通过 192.168.77.132 连接192.168.77.131， 192.168.77.132 需安装<code>nc</code></p> </blockquote> <p><strong>添加132节点到kown_hosts</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-45-1 name=__codelineno-45-1 href=#__codelineno-45-1></a><span class=c1># ssh 192.168.77.132</span>
<a id=__codelineno-45-2 name=__codelineno-45-2 href=#__codelineno-45-2></a>The<span class=w> </span>authenticity<span class=w> </span>of<span class=w> </span>host<span class=w> </span><span class=s1>&#39;192.168.77.132 (192.168.77.132)&#39;</span><span class=w> </span>can<span class=s1>&#39;t be established.</span>
<a id=__codelineno-45-3 name=__codelineno-45-3 href=#__codelineno-45-3></a><span class=s1>ECDSA key fingerprint is SHA256:2lWSIJMF9r8hnfLwlKONY07eQCeZaDVZ/xWZizr9wqs.</span>
<a id=__codelineno-45-4 name=__codelineno-45-4 href=#__codelineno-45-4></a><span class=s1>ECDSA key fingerprint is MD5:be:82:d9:23:45:18:f2:e3:fa:32:56:65:c9:b1:4b:07.</span>
<a id=__codelineno-45-5 name=__codelineno-45-5 href=#__codelineno-45-5></a><span class=s1>Are you sure you want to continue connecting (yes/no)? yes</span>
<a id=__codelineno-45-6 name=__codelineno-45-6 href=#__codelineno-45-6></a><span class=s1>Warning: Permanently added &#39;</span><span class=m>192</span>.168.77.132<span class=err>&#39;</span><span class=w> </span><span class=o>(</span>ECDSA<span class=o>)</span><span class=w> </span>to<span class=w> </span>the<span class=w> </span>list<span class=w> </span>of<span class=w> </span>known<span class=w> </span>hosts.
</code></pre></div></p> <ol> <li>使用ssh代理参数配置</li> </ol> <p><strong>定义主机清单</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-46-1 name=__codelineno-46-1 href=#__codelineno-46-1></a><span class=c1># cat /etc/ansible/hosts</span>
<a id=__codelineno-46-2 name=__codelineno-46-2 href=#__codelineno-46-2></a><span class=m>192</span>.168.77.131<span class=w> </span><span class=nv>ansible_ssh_private_key_file</span><span class=o>=</span>/root/131.key<span class=w> </span><span class=nv>ansible_ssh_common_args</span><span class=o>=</span><span class=s2>&quot;-o ProxyCommand=\&quot;sshpass -p &#39;123456&#39; ssh -qay -p 22 root@192.168.77.132 &#39;nc %h %p&#39;\&quot;&quot;</span>
</code></pre></div></p> <blockquote> <p>ansible_ssh_common_args 配置ssh连接的参数</p> </blockquote> <p><strong>测试连通性</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-47-1 name=__codelineno-47-1 href=#__codelineno-47-1></a><span class=c1># ansible 192.168.77.131 -m ping</span>
<a id=__codelineno-47-2 name=__codelineno-47-2 href=#__codelineno-47-2></a><span class=m>192</span>.168.77.131<span class=w> </span><span class=p>|</span><span class=w> </span><span class=nv>SUCCESS</span><span class=w> </span><span class=o>=</span>&gt;<span class=w> </span><span class=o>{</span>
<a id=__codelineno-47-3 name=__codelineno-47-3 href=#__codelineno-47-3></a><span class=w>    </span><span class=s2>&quot;ansible_facts&quot;</span>:<span class=w> </span><span class=o>{</span>
<a id=__codelineno-47-4 name=__codelineno-47-4 href=#__codelineno-47-4></a><span class=w>        </span><span class=s2>&quot;discovered_interpreter_python&quot;</span>:<span class=w> </span><span class=s2>&quot;/usr/bin/python&quot;</span>
<a id=__codelineno-47-5 name=__codelineno-47-5 href=#__codelineno-47-5></a><span class=w>    </span><span class=o>}</span>,<span class=w> </span>
<a id=__codelineno-47-6 name=__codelineno-47-6 href=#__codelineno-47-6></a><span class=w>    </span><span class=s2>&quot;changed&quot;</span>:<span class=w> </span>false,<span class=w> </span>
<a id=__codelineno-47-7 name=__codelineno-47-7 href=#__codelineno-47-7></a><span class=w>    </span><span class=s2>&quot;ping&quot;</span>:<span class=w> </span><span class=s2>&quot;pong&quot;</span>
<a id=__codelineno-47-8 name=__codelineno-47-8 href=#__codelineno-47-8></a><span class=o>}</span>
</code></pre></div> <ol> <li>使用本地ssh配置主机代理</li> </ol> <p><strong>配置ssh</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-48-1 name=__codelineno-48-1 href=#__codelineno-48-1></a><span class=c1># cat ~/.ssh/config </span>
<a id=__codelineno-48-2 name=__codelineno-48-2 href=#__codelineno-48-2></a>Host<span class=w> </span><span class=m>192</span>.168.77.131
<a id=__codelineno-48-3 name=__codelineno-48-3 href=#__codelineno-48-3></a><span class=w>        </span>User<span class=w> </span>root
<a id=__codelineno-48-4 name=__codelineno-48-4 href=#__codelineno-48-4></a><span class=w>        </span>Port<span class=w> </span><span class=m>22</span>
<a id=__codelineno-48-5 name=__codelineno-48-5 href=#__codelineno-48-5></a><span class=w>        </span>TCPKeepAlive<span class=w> </span>yes
<a id=__codelineno-48-6 name=__codelineno-48-6 href=#__codelineno-48-6></a><span class=w>        </span>ForwardAgent<span class=w> </span>yes
<a id=__codelineno-48-7 name=__codelineno-48-7 href=#__codelineno-48-7></a><span class=w>        </span>ProxyCommand<span class=w> </span>sshpass<span class=w> </span>-p<span class=w> </span><span class=s1>&#39;123456&#39;</span><span class=w> </span>ssh<span class=w> </span>-qaY<span class=w> </span>-p<span class=w> </span><span class=m>22</span><span class=w> </span>root@192.168.77.132<span class=w> </span><span class=s1>&#39;nc %h %p&#39;</span>
</code></pre></div> <p><strong>定义主机清单</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-49-1 name=__codelineno-49-1 href=#__codelineno-49-1></a><span class=c1># cat /etc/ansible/hosts</span>
<a id=__codelineno-49-2 name=__codelineno-49-2 href=#__codelineno-49-2></a><span class=m>192</span>.168.77.131<span class=w> </span><span class=nv>ansible_ssh_private_key_file</span><span class=o>=</span>/opt/131.key
</code></pre></div></p> <p><strong>测试连通性</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-50-1 name=__codelineno-50-1 href=#__codelineno-50-1></a><span class=c1># ansible 192.168.77.131 -m ping</span>
<a id=__codelineno-50-2 name=__codelineno-50-2 href=#__codelineno-50-2></a><span class=m>192</span>.168.77.131<span class=w> </span><span class=p>|</span><span class=w> </span><span class=nv>SUCCESS</span><span class=w> </span><span class=o>=</span>&gt;<span class=w> </span><span class=o>{</span>
<a id=__codelineno-50-3 name=__codelineno-50-3 href=#__codelineno-50-3></a><span class=w>    </span><span class=s2>&quot;ansible_facts&quot;</span>:<span class=w> </span><span class=o>{</span>
<a id=__codelineno-50-4 name=__codelineno-50-4 href=#__codelineno-50-4></a><span class=w>        </span><span class=s2>&quot;discovered_interpreter_python&quot;</span>:<span class=w> </span><span class=s2>&quot;/usr/bin/python&quot;</span>
<a id=__codelineno-50-5 name=__codelineno-50-5 href=#__codelineno-50-5></a><span class=w>    </span><span class=o>}</span>,<span class=w> </span>
<a id=__codelineno-50-6 name=__codelineno-50-6 href=#__codelineno-50-6></a><span class=w>    </span><span class=s2>&quot;changed&quot;</span>:<span class=w> </span>false,<span class=w> </span>
<a id=__codelineno-50-7 name=__codelineno-50-7 href=#__codelineno-50-7></a><span class=w>    </span><span class=s2>&quot;ping&quot;</span>:<span class=w> </span><span class=s2>&quot;pong&quot;</span>
<a id=__codelineno-50-8 name=__codelineno-50-8 href=#__codelineno-50-8></a><span class=o>}</span>
</code></pre></div> <ol> <li>使用ssh代理</li> </ol> <blockquote> <p>不需要在192.168.77.132上安装nc软件了</p> </blockquote> <p><strong>定义主机清单</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-51-1 name=__codelineno-51-1 href=#__codelineno-51-1></a><span class=c1># cat /etc/ansible/hosts</span>
<a id=__codelineno-51-2 name=__codelineno-51-2 href=#__codelineno-51-2></a><span class=m>192</span>.168.77.131<span class=w> </span><span class=nv>ansible_ssh_private_key_file</span><span class=o>=</span>/root/131.key<span class=w> </span><span class=nv>ansible_ssh_common_args</span><span class=o>=</span><span class=s2>&quot;-o ProxyCommand=\&quot;sshpass -p &#39;123456&#39; ssh -W %h:%p -q -p 22 root@192.168.77.132\&quot;&quot;</span>
</code></pre></div></p> <blockquote> <p>ansible_ssh_common_args 配置ssh连接的参数</p> </blockquote> <p><strong>测试连通性</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-52-1 name=__codelineno-52-1 href=#__codelineno-52-1></a><span class=c1># ansible 192.168.77.131 -m ping</span>
<a id=__codelineno-52-2 name=__codelineno-52-2 href=#__codelineno-52-2></a><span class=m>192</span>.168.77.131<span class=w> </span><span class=p>|</span><span class=w> </span><span class=nv>SUCCESS</span><span class=w> </span><span class=o>=</span>&gt;<span class=w> </span><span class=o>{</span>
<a id=__codelineno-52-3 name=__codelineno-52-3 href=#__codelineno-52-3></a><span class=w>    </span><span class=s2>&quot;ansible_facts&quot;</span>:<span class=w> </span><span class=o>{</span>
<a id=__codelineno-52-4 name=__codelineno-52-4 href=#__codelineno-52-4></a><span class=w>        </span><span class=s2>&quot;discovered_interpreter_python&quot;</span>:<span class=w> </span><span class=s2>&quot;/usr/bin/python&quot;</span>
<a id=__codelineno-52-5 name=__codelineno-52-5 href=#__codelineno-52-5></a><span class=w>    </span><span class=o>}</span>,<span class=w> </span>
<a id=__codelineno-52-6 name=__codelineno-52-6 href=#__codelineno-52-6></a><span class=w>    </span><span class=s2>&quot;changed&quot;</span>:<span class=w> </span>false,<span class=w> </span>
<a id=__codelineno-52-7 name=__codelineno-52-7 href=#__codelineno-52-7></a><span class=w>    </span><span class=s2>&quot;ping&quot;</span>:<span class=w> </span><span class=s2>&quot;pong&quot;</span>
<a id=__codelineno-52-8 name=__codelineno-52-8 href=#__codelineno-52-8></a><span class=o>}</span>
</code></pre></div> <h4 id=命令行指定主机清单>命令行指定主机清单<a class=headerlink href=#命令行指定主机清单 title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><a id=__codelineno-53-1 name=__codelineno-53-1 href=#__codelineno-53-1></a><span class=c1># ansible -i &#39;192.168.77.131,192.168.77.132&#39; 192.168.77.* -m ping -k</span>
<a id=__codelineno-53-2 name=__codelineno-53-2 href=#__codelineno-53-2></a>SSH<span class=w> </span>password:<span class=w> </span>
<a id=__codelineno-53-3 name=__codelineno-53-3 href=#__codelineno-53-3></a><span class=m>192</span>.168.77.131<span class=w> </span><span class=p>|</span><span class=w> </span><span class=nv>SUCCESS</span><span class=w> </span><span class=o>=</span>&gt;<span class=w> </span><span class=o>{</span>
<a id=__codelineno-53-4 name=__codelineno-53-4 href=#__codelineno-53-4></a><span class=w>    </span><span class=s2>&quot;ansible_facts&quot;</span>:<span class=w> </span><span class=o>{</span>
<a id=__codelineno-53-5 name=__codelineno-53-5 href=#__codelineno-53-5></a><span class=w>        </span><span class=s2>&quot;discovered_interpreter_python&quot;</span>:<span class=w> </span><span class=s2>&quot;/usr/bin/python&quot;</span>
<a id=__codelineno-53-6 name=__codelineno-53-6 href=#__codelineno-53-6></a><span class=w>    </span><span class=o>}</span>,<span class=w> </span>
<a id=__codelineno-53-7 name=__codelineno-53-7 href=#__codelineno-53-7></a><span class=w>    </span><span class=s2>&quot;changed&quot;</span>:<span class=w> </span>false,<span class=w> </span>
<a id=__codelineno-53-8 name=__codelineno-53-8 href=#__codelineno-53-8></a><span class=w>    </span><span class=s2>&quot;ping&quot;</span>:<span class=w> </span><span class=s2>&quot;pong&quot;</span>
<a id=__codelineno-53-9 name=__codelineno-53-9 href=#__codelineno-53-9></a><span class=o>}</span>
<a id=__codelineno-53-10 name=__codelineno-53-10 href=#__codelineno-53-10></a><span class=m>192</span>.168.77.132<span class=w> </span><span class=p>|</span><span class=w> </span><span class=nv>SUCCESS</span><span class=w> </span><span class=o>=</span>&gt;<span class=w> </span><span class=o>{</span>
<a id=__codelineno-53-11 name=__codelineno-53-11 href=#__codelineno-53-11></a><span class=w>    </span><span class=s2>&quot;ansible_facts&quot;</span>:<span class=w> </span><span class=o>{</span>
<a id=__codelineno-53-12 name=__codelineno-53-12 href=#__codelineno-53-12></a><span class=w>        </span><span class=s2>&quot;discovered_interpreter_python&quot;</span>:<span class=w> </span><span class=s2>&quot;/usr/bin/python&quot;</span>
<a id=__codelineno-53-13 name=__codelineno-53-13 href=#__codelineno-53-13></a><span class=w>    </span><span class=o>}</span>,<span class=w> </span>
<a id=__codelineno-53-14 name=__codelineno-53-14 href=#__codelineno-53-14></a><span class=w>    </span><span class=s2>&quot;changed&quot;</span>:<span class=w> </span>false,<span class=w> </span>
<a id=__codelineno-53-15 name=__codelineno-53-15 href=#__codelineno-53-15></a><span class=w>    </span><span class=s2>&quot;ping&quot;</span>:<span class=w> </span><span class=s2>&quot;pong&quot;</span>
<a id=__codelineno-53-16 name=__codelineno-53-16 href=#__codelineno-53-16></a><span class=o>}</span>
</code></pre></div> <p>通过 <code>-i</code> 参数， 指定用逗号分隔的主机列表即可。 </p> <p>不过不能指定<code>ansible_*</code> 开头的变量，即不能定义连接密码。</p> <h3 id=动态主机清单>动态主机清单<a class=headerlink href=#动态主机清单 title="Permanent link">&para;</a></h3> <p>ansible 不仅可以使用<code>yaml</code>,<code>ini</code>等格式的静态文件配置主机清单，还可以使用动态的源作为主机清单，详细内容请见使用动态主机</p> <h2 id=5patterns-匹配>5.Patterns 匹配<a class=headerlink href=#5patterns-匹配 title="Permanent link">&para;</a></h2> <p><strong>Patterns</strong> 是定义Ansible要执行的主机。Ansible Patterns 可以引用一个主机，一个IP地址，一个清单组，一个集合组或清单中的所有主机。 Patterns 具有高度的灵活性，您可以排除或要求主机的子集，使用 <strong>通配符</strong> 或 <strong>正则表达式</strong> 来定义 Patterns 。</p> <p><strong>命令格式</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-54-1 name=__codelineno-54-1 href=#__codelineno-54-1></a>ansible &lt;pattern&gt; -m &lt;module_name&gt; -a &quot;&lt;module options&gt;&quot;
<a id=__codelineno-54-2 name=__codelineno-54-2 href=#__codelineno-54-2></a>
<a id=__codelineno-54-3 name=__codelineno-54-3 href=#__codelineno-54-3></a>ansible-playbook -l &lt;pattern&gt;  [options] playbook.yml
</code></pre></div> <p><strong>使用示例</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-55-1 name=__codelineno-55-1 href=#__codelineno-55-1></a>ansible * -m service -a &quot;name=httpd state=restarted&quot;
<a id=__codelineno-55-2 name=__codelineno-55-2 href=#__codelineno-55-2></a>
<a id=__codelineno-55-3 name=__codelineno-55-3 href=#__codelineno-55-3></a>ansible-playbook  -l all playbook.yml
</code></pre></div> <p>在 <strong>playbook</strong> 的剧本中，需要在每个 <strong>play</strong> 中<code>hosts:</code>行中定义</p> <div class=highlight><pre><span></span><code><a id=__codelineno-56-1 name=__codelineno-56-1 href=#__codelineno-56-1></a>- name: &lt;play_name&gt;
<a id=__codelineno-56-2 name=__codelineno-56-2 href=#__codelineno-56-2></a>  hosts: &lt;pattern&gt;
</code></pre></div> <p><strong>使用示例</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-57-1 name=__codelineno-57-1 href=#__codelineno-57-1></a>- name: restart webservers
<a id=__codelineno-57-2 name=__codelineno-57-2 href=#__codelineno-57-2></a>  hosts: webservers
</code></pre></div> <h3 id=常用匹配>常用匹配<a class=headerlink href=#常用匹配 title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>描述</th> <th>Pattern(s)</th> <th>Targets</th> </tr> </thead> <tbody> <tr> <td>所有主机</td> <td><code>all</code> 或者 <code>*</code></td> <td>主机清单中的所有主机</td> </tr> <tr> <td>一个主机(精确匹配)</td> <td><code>host1</code> 或者 <code>192.168.77.131</code></td> <td><code>host1</code> 或者 <code>192.168.77.131</code></td> </tr> <tr> <td>多个主机</td> <td><code>host1:host2</code> 或者<code>host1,host2</code></td> <td><code>host1:host2</code> 或者<code>host1,host2</code></td> </tr> <tr> <td>一个组</td> <td><code>webservers</code></td> <td><code>webservers</code>组中的主机</td> </tr> <tr> <td>多个组(或匹配)</td> <td><code>webservers:dbservers</code></td> <td><code>webservers</code>和<code>dbservers</code>所有的主机</td> </tr> <tr> <td>排除组(非模式匹配)</td> <td>webservers:!atlanta</td> <td><code>webservers</code>组中除<code>atlanta</code>之外的所有主机</td> </tr> <tr> <td>交集组(交集匹配)</td> <td>webservers:&amp;dbservers</td> <td><code>webservers</code>和<code>dbservers</code>都存在的主机</td> </tr> </tbody> </table> <p><strong>通配符匹配</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-58-1 name=__codelineno-58-1 href=#__codelineno-58-1></a>*.com
<a id=__codelineno-58-2 name=__codelineno-58-2 href=#__codelineno-58-2></a>web*.com:dbserver
</code></pre></div> <p><code>*</code>表示所有字符</p> <p><strong>组合匹配</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-59-1 name=__codelineno-59-1 href=#__codelineno-59-1></a>webservers:dbservers:&amp;staging:!phoenix
</code></pre></div> <p>在webservers 或者dbservers 组中，必须还存在于staging 组中，但是不在phoenix 组中</p> <h3 id=局限性>局限性<a class=headerlink href=#局限性 title="Permanent link">&para;</a></h3> <p><strong>Patterns</strong> 依赖于 <strong>主机清单</strong> (inventory)，如果说匹配不到主机清单里的数据，则会返回如下警告</p> <div class=highlight><pre><span></span><code><a id=__codelineno-60-1 name=__codelineno-60-1 href=#__codelineno-60-1></a><span class=c1># ansible none -m ping </span>
<a id=__codelineno-60-2 name=__codelineno-60-2 href=#__codelineno-60-2></a><span class=o>[</span>WARNING<span class=o>]</span>:<span class=w> </span>Could<span class=w> </span>not<span class=w> </span>match<span class=w> </span>supplied<span class=w> </span>host<span class=w> </span>pattern,<span class=w> </span>ignoring:<span class=w> </span>none
<a id=__codelineno-60-3 name=__codelineno-60-3 href=#__codelineno-60-3></a><span class=o>[</span>WARNING<span class=o>]</span>:<span class=w> </span>No<span class=w> </span>hosts<span class=w> </span>matched,<span class=w> </span>nothing<span class=w> </span>to<span class=w> </span><span class=k>do</span>
</code></pre></div> <h3 id=高级特性>高级特性<a class=headerlink href=#高级特性 title="Permanent link">&para;</a></h3> <h4 id=使用变量>使用变量<a class=headerlink href=#使用变量 title="Permanent link">&para;</a></h4> <p>在ansible-palybook 命令中，你也可以使用变量来组成这样的表达式，但是你必须使用<code>-e</code>的选项来指定这个表达式</p> <p><strong>playbook</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-61-1 name=__codelineno-61-1 href=#__codelineno-61-1></a><span class=c1># cat  playbook.yml</span>
<a id=__codelineno-61-2 name=__codelineno-61-2 href=#__codelineno-61-2></a>---
<a id=__codelineno-61-3 name=__codelineno-61-3 href=#__codelineno-61-3></a>-<span class=w> </span>name:<span class=w> </span>Using<span class=w> </span>variables<span class=w> </span><span class=k>in</span><span class=w> </span>patterns
<a id=__codelineno-61-4 name=__codelineno-61-4 href=#__codelineno-61-4></a><span class=w>  </span>hosts:<span class=w> </span><span class=s2>&quot;{{ hosts }}&quot;</span>
<a id=__codelineno-61-5 name=__codelineno-61-5 href=#__codelineno-61-5></a><span class=w>  </span>tasks:
<a id=__codelineno-61-6 name=__codelineno-61-6 href=#__codelineno-61-6></a><span class=w>    </span>-<span class=w> </span>name:<span class=w> </span>ping
<a id=__codelineno-61-7 name=__codelineno-61-7 href=#__codelineno-61-7></a><span class=w>      </span>ping:
</code></pre></div> <p><strong>执行playbook</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-62-1 name=__codelineno-62-1 href=#__codelineno-62-1></a>ansible-playbook<span class=w> </span>playbook.yml<span class=w> </span>-e<span class=w> </span><span class=s2>&quot;hosts=192.168.77.131&quot;</span>
<a id=__codelineno-62-2 name=__codelineno-62-2 href=#__codelineno-62-2></a>ansible-playbook<span class=w> </span>playbook.yml<span class=w> </span>-e<span class=w> </span><span class=s2>&quot;hosts=192.168.77.132&quot;</span>
</code></pre></div> <h4 id=使用切片>使用切片<a class=headerlink href=#使用切片 title="Permanent link">&para;</a></h4> <p>可以使用下标来选择组中的各个主机或范围，类似python中的切片</p> <div class=highlight><pre><span></span><code><a id=__codelineno-63-1 name=__codelineno-63-1 href=#__codelineno-63-1></a>webservers[0]
<a id=__codelineno-63-2 name=__codelineno-63-2 href=#__codelineno-63-2></a>webservers[1:]
<a id=__codelineno-63-3 name=__codelineno-63-3 href=#__codelineno-63-3></a>webservers[0:25]
</code></pre></div> <ul> <li> <p><code>[0]</code>表示组第一个成员</p> </li> <li> <p><code>[1:]</code> 表示组内第2个含第2个之后的所有成员</p> </li> <li><code>[0:25]</code>表示组第1个到第24个成员</li> </ul> <h4 id=正则表达式>正则表达式<a class=headerlink href=#正则表达式 title="Permanent link">&para;</a></h4> <p>在开头的地方使用“~”，表示这是一个正则表达式</p> <div class=highlight><pre><span></span><code><a id=__codelineno-64-1 name=__codelineno-64-1 href=#__codelineno-64-1></a>~(web|db).*\.example\.com
</code></pre></div> <h4 id=限定主机>限定主机<a class=headerlink href=#限定主机 title="Permanent link">&para;</a></h4> <p>可以使用命令行选项更改playbook中定义的Patterns 的行为</p> <div class=highlight><pre><span></span><code><a id=__codelineno-65-1 name=__codelineno-65-1 href=#__codelineno-65-1></a>ansible-playbook site.yml -l 192.168.77.129
<a id=__codelineno-65-2 name=__codelineno-65-2 href=#__codelineno-65-2></a>
<a id=__codelineno-65-3 name=__codelineno-65-3 href=#__codelineno-65-3></a>ansible-playbook site.yml -l @retry_hosts.txt
</code></pre></div> <p>只执行<code>-l</code>后的主机, <code>@</code>开头指定文件</p> <h2 id=6使用ad-hoc命令>6.使用ad-hoc命令<a class=headerlink href=#6使用ad-hoc命令 title="Permanent link">&para;</a></h2> <p>Ansible ad-hoc 命令使用 <code>/usr/bin/ansible</code>命令行工具来自动化一个或多个受管节点上的单个任务。 临时命令既快速又简单，但不可重用。</p> <h3 id=ad-hoc-命令>ad-hoc 命令<a class=headerlink href=#ad-hoc-命令 title="Permanent link">&para;</a></h3> <p><div class=highlight><pre><span></span><code><a id=__codelineno-66-1 name=__codelineno-66-1 href=#__codelineno-66-1></a>ansible<span class=w> </span><span class=o>[</span>pattern<span class=o>]</span><span class=w> </span>-m<span class=w> </span><span class=o>[</span>module<span class=o>]</span><span class=w> </span>-a<span class=w> </span><span class=s2>&quot;[module options]&quot;</span>
</code></pre></div> 执行结果说明</p> <p>rc: 命令返回码（0表示成功）</p> <h3 id=ad-hoc-示例>ad-hoc 示例<a class=headerlink href=#ad-hoc-示例 title="Permanent link">&para;</a></h3> <h4 id=执行shell命令>执行shell命令<a class=headerlink href=#执行shell命令 title="Permanent link">&para;</a></h4> <h5 id=command>command<a class=headerlink href=#command title="Permanent link">&para;</a></h5> <p>重启服务器</p> <div class=highlight><pre><span></span><code><a id=__codelineno-67-1 name=__codelineno-67-1 href=#__codelineno-67-1></a>ansible<span class=w> </span>servers<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;reboot&quot;</span>
</code></pre></div> <p>不指定<code>-m</code> 模块时，将使用ansible的默认模块command，它不会通过shell进行处理，所以像<code>$HOME</code>和像<code>“&lt;”</code>，<code>“&gt;”</code>，<code>“|”</code>，<code>“;”</code>和<code>“＆”</code>将不工作</p> <p>默认情况下，Ansible使用5个并发进程。 如果你要扩大并发，使用<code>-f 10</code> 参数指定数量即可。</p> <div class=highlight><pre><span></span><code><a id=__codelineno-68-1 name=__codelineno-68-1 href=#__codelineno-68-1></a>ansible<span class=w> </span>servers<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;reboot&quot;</span><span class=w> </span>-f<span class=w> </span><span class=m>10</span>
</code></pre></div> <p>默认情况下，Ansible连接远端用户是当前用户，使用<code>-u</code> 参数可以修改</p> <div class=highlight><pre><span></span><code><a id=__codelineno-69-1 name=__codelineno-69-1 href=#__codelineno-69-1></a>ansible<span class=w> </span>servers<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;reboot&quot;</span><span class=w> </span>-f<span class=w> </span><span class=m>10</span><span class=w> </span>-u<span class=w> </span>root
</code></pre></div> <p>如果运行用户没有权限执行，使用<code>--become</code> 可以提升权限,默认是<code>sudo</code>方式</p> <div class=highlight><pre><span></span><code><a id=__codelineno-70-1 name=__codelineno-70-1 href=#__codelineno-70-1></a>ansible<span class=w> </span>servers<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;reboot&quot;</span><span class=w> </span>-f<span class=w> </span><span class=m>10</span><span class=w> </span>-u<span class=w> </span>root<span class=w> </span>--become
<a id=__codelineno-70-2 name=__codelineno-70-2 href=#__codelineno-70-2></a>ansible<span class=w> </span>servers<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;reboot&quot;</span><span class=w> </span>-f<span class=w> </span><span class=m>10</span><span class=w> </span>-u<span class=w> </span><span class=nb>test</span><span class=w> </span>--become<span class=w> </span>--become-method<span class=w> </span>sudo<span class=w> </span>--become-user<span class=w> </span>root<span class=w> </span>--ask-become-pass
</code></pre></div> <p><code>--become-method</code> 指定提升方式，<code>--become-user</code> 指定提升用户 <code>--ask-become-pass</code> 告知提升密码</p> <h5 id=shell>shell<a class=headerlink href=#shell title="Permanent link">&para;</a></h5> <p>获取web组里得eth0接口信息</p> <div class=highlight><pre><span></span><code><a id=__codelineno-71-1 name=__codelineno-71-1 href=#__codelineno-71-1></a>ansible<span class=w> </span>web<span class=w> </span>-m<span class=w> </span>shell<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;ifconfig eth0|grep addr&quot;</span>
</code></pre></div> <h5 id=raw>raw<a class=headerlink href=#raw title="Permanent link">&para;</a></h5> <p>如果说远程主机没有<code>python</code> 模块时，可以使用<code>raw</code> 模块执行命令</p> <div class=highlight><pre><span></span><code><a id=__codelineno-72-1 name=__codelineno-72-1 href=#__codelineno-72-1></a>ansible<span class=w> </span>web<span class=w> </span>-m<span class=w> </span>raw<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;ifconfig eth0|grep addr&quot;</span>
</code></pre></div> <h5 id=script>script<a class=headerlink href=#script title="Permanent link">&para;</a></h5> <p>执行脚本</p> <div class=highlight><pre><span></span><code><a id=__codelineno-73-1 name=__codelineno-73-1 href=#__codelineno-73-1></a>ansible web -m script -a ip.sh
</code></pre></div> <blockquote> <p>将本地脚本传送到远程节点上运行</p> </blockquote> <h4 id=文件管理>文件管理<a class=headerlink href=#文件管理 title="Permanent link">&para;</a></h4> <h5 id=copy>copy<a class=headerlink href=#copy title="Permanent link">&para;</a></h5> <p>拷贝本地的/etc/hosts 文件到web组所有主机的/tmp/hosts（空目录除外）</p> <div class=highlight><pre><span></span><code><a id=__codelineno-74-1 name=__codelineno-74-1 href=#__codelineno-74-1></a>ansible<span class=w> </span>web<span class=w> </span>-m<span class=w> </span>copy<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;src=/etc/hosts dest=/tmp/hosts&quot;</span>
</code></pre></div> <p>拷贝本地的ntp文件到目的地址，设置其用户及权限，如果目标地址存在相同的文件，则备份源文件。</p> <div class=highlight><pre><span></span><code><a id=__codelineno-75-1 name=__codelineno-75-1 href=#__codelineno-75-1></a>ansible<span class=w> </span>web<span class=w> </span>-m<span class=w> </span>copy<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;src=/mine/ntp.conf dest=/etc/ntp.conf owner=root group=root mode=644 backup=yes force=yes&quot;</span>
</code></pre></div> <h5 id=fetch>fetch<a class=headerlink href=#fetch title="Permanent link">&para;</a></h5> <p>从远端服务器拷贝到本机</p> <div class=highlight><pre><span></span><code><a id=__codelineno-76-1 name=__codelineno-76-1 href=#__codelineno-76-1></a>ansible<span class=w> </span>web<span class=w> </span>-m<span class=w> </span>fetch<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;src=/etc/hosts dest=/tmp/temp_hosts flat=yes&quot;</span>
</code></pre></div> <h5 id=file>file<a class=headerlink href=#file title="Permanent link">&para;</a></h5> <p>更改文件的用户及权限</p> <div class=highlight><pre><span></span><code><a id=__codelineno-77-1 name=__codelineno-77-1 href=#__codelineno-77-1></a>ansible<span class=w> </span>web<span class=w> </span>-m<span class=w> </span>file<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;dest=/tmp/a.txt mode=600 owner=user group=user&quot;</span>
</code></pre></div> <p>创建目录，类似mkdir -p</p> <div class=highlight><pre><span></span><code><a id=__codelineno-78-1 name=__codelineno-78-1 href=#__codelineno-78-1></a>ansible<span class=w> </span>web<span class=w> </span>-m<span class=w> </span>file<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;dest=/tmp/test mode=755 owner=user group=user state=directory&quot;</span>
</code></pre></div> <p>删除文件或者目录</p> <div class=highlight><pre><span></span><code><a id=__codelineno-79-1 name=__codelineno-79-1 href=#__codelineno-79-1></a>ansible<span class=w> </span>web<span class=w> </span>-m<span class=w> </span>file<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;dest=/tmp/test state=absent&quot;</span>
</code></pre></div> <p>创建软连接，并设置所属用户和用户组</p> <div class=highlight><pre><span></span><code><a id=__codelineno-80-1 name=__codelineno-80-1 href=#__codelineno-80-1></a>ansible<span class=w> </span>web<span class=w> </span>-m<span class=w> </span>file<span class=w> </span>-a<span class=w>  </span><span class=s2>&quot;src=/file/to/link/to dest=/path/to/symlink owner=user group=user state=link&quot;</span>
</code></pre></div> <p>touch 一个文件并添加用户读写权限，用户组去除写执行权限，其他组减去读写执行权限</p> <div class=highlight><pre><span></span><code><a id=__codelineno-81-1 name=__codelineno-81-1 href=#__codelineno-81-1></a>ansible<span class=w> </span>web<span class=w> </span>-m<span class=w> </span>file<span class=w> </span>-a<span class=w>  </span><span class=s2>&quot;path=/etc/foo.conf state=touch mode=&#39;u+rw,g-wx,o-rwx&#39;&quot;</span>
</code></pre></div> <h5 id=unarchive>unarchive<a class=headerlink href=#unarchive title="Permanent link">&para;</a></h5> <p>将本地的压缩文件解压到目标主机</p> <div class=highlight><pre><span></span><code><a id=__codelineno-82-1 name=__codelineno-82-1 href=#__codelineno-82-1></a>ansible<span class=w> </span>web<span class=w> </span>-m<span class=w> </span>unarchive<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;src=foo.tgz dest=/opt/foo“</span>
</code></pre></div> <h4 id=管理软件包>管理软件包<a class=headerlink href=#管理软件包 title="Permanent link">&para;</a></h4> <p>apt、yum 模块分表用于管理Ubuntu 系列和RedHat 系列系统软件包</p> <h5 id=apt>apt<a class=headerlink href=#apt title="Permanent link">&para;</a></h5> <p>更新仓库缓存，并安装"foo"</p> <div class=highlight><pre><span></span><code><a id=__codelineno-83-1 name=__codelineno-83-1 href=#__codelineno-83-1></a>ansible<span class=w> </span>web<span class=w> </span>-m<span class=w> </span>apt<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;name=foo update_cache=yes&quot;</span>
</code></pre></div> <p>删除 "foo" <div class=highlight><pre><span></span><code><a id=__codelineno-84-1 name=__codelineno-84-1 href=#__codelineno-84-1></a>ansible<span class=w> </span>web<span class=w> </span>-m<span class=w> </span>apt<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;name=foo state=absent&quot;</span>
</code></pre></div></p> <p>安装 "foo" <div class=highlight><pre><span></span><code><a id=__codelineno-85-1 name=__codelineno-85-1 href=#__codelineno-85-1></a>ansible<span class=w> </span>web<span class=w> </span>-m<span class=w> </span>apt<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;name=foo state=present&quot;</span>
</code></pre></div></p> <p>安装 1.0版本的 "foo" <div class=highlight><pre><span></span><code><a id=__codelineno-86-1 name=__codelineno-86-1 href=#__codelineno-86-1></a>ansible<span class=w> </span>web<span class=w> </span>-m<span class=w> </span>apt<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;name=foo=1.00 state=present&quot;</span>
</code></pre></div></p> <p>安装最新得"foo" <div class=highlight><pre><span></span><code><a id=__codelineno-87-1 name=__codelineno-87-1 href=#__codelineno-87-1></a>ansible<span class=w> </span>web<span class=w> </span>-m<span class=w> </span>apt<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;name=foo state=latest&quot;</span>
</code></pre></div></p> <p>注释：Ansible 支持很多操作系统的软件包管理，使用时-m 指定相应的软件包管理工具模块，如果没有这样的模块，可以自己定义类似的模块或者使用command 模块来安装软件包</p> <h5 id=yum>yum<a class=headerlink href=#yum title="Permanent link">&para;</a></h5> <p>安装 最新的 Apache <div class=highlight><pre><span></span><code><a id=__codelineno-88-1 name=__codelineno-88-1 href=#__codelineno-88-1></a>ansible<span class=w> </span>web<span class=w> </span>-m<span class=w> </span>yum<span class=w> </span>-a<span class=w>  </span><span class=s2>&quot;name=httpd state=latest&quot;</span>
</code></pre></div></p> <p>删除apache <div class=highlight><pre><span></span><code><a id=__codelineno-89-1 name=__codelineno-89-1 href=#__codelineno-89-1></a>ansible<span class=w> </span>web<span class=w> </span>-m<span class=w> </span>yum<span class=w> </span>-a<span class=w>  </span><span class=s2>&quot;name=httpd state=absent&quot;</span>
</code></pre></div></p> <p>从testing 仓库中安装最后一个版本得apache <div class=highlight><pre><span></span><code><a id=__codelineno-90-1 name=__codelineno-90-1 href=#__codelineno-90-1></a>ansible<span class=w> </span>web<span class=w> </span>-m<span class=w> </span>yum<span class=w> </span>-a<span class=w>  </span><span class=s2>&quot;name=httpd enablerepo=testing state=present&quot;</span>
</code></pre></div></p> <p>更新所有的包 <div class=highlight><pre><span></span><code><a id=__codelineno-91-1 name=__codelineno-91-1 href=#__codelineno-91-1></a>ansible<span class=w> </span>web<span class=w> </span>-m<span class=w> </span>yum<span class=w> </span>-a<span class=w>  </span><span class=s2>&quot;name=* state=latest&quot;</span>
</code></pre></div></p> <p>安装远程的rpm包 <div class=highlight><pre><span></span><code><a id=__codelineno-92-1 name=__codelineno-92-1 href=#__codelineno-92-1></a>ansible<span class=w> </span>web<span class=w> </span>-m<span class=w> </span>yum<span class=w> </span>-a<span class=w>  </span><span class=s2>&quot;name=http://nginx.org/packages/centos/6/noarch/RPMS/nginx-release-centos-6-0.el6.ngx.noarch.rpm state=present&quot;</span>
</code></pre></div></p> <p>安装 'Development tools' 包组 <div class=highlight><pre><span></span><code><a id=__codelineno-93-1 name=__codelineno-93-1 href=#__codelineno-93-1></a>ansible<span class=w> </span>web<span class=w> </span>-m<span class=w> </span>yum<span class=w> </span>-a<span class=w>  </span><span class=s2>&quot;name=&#39;@Development tools&#39; state=present&quot;</span>
</code></pre></div></p> <h5 id=package>package<a class=headerlink href=#package title="Permanent link">&para;</a></h5> <p>使用远程主机的包管理器进行安装，卸载，更新软件。相对于<code>apt</code>,<code>yum</code>而言，兼容性更好。</p> <p>安装ntpdate</p> <div class=highlight><pre><span></span><code><a id=__codelineno-94-1 name=__codelineno-94-1 href=#__codelineno-94-1></a>ansible<span class=w> </span>web<span class=w> </span>-m<span class=w> </span>package<span class=w> </span>-a<span class=w>  </span><span class=s2>&quot;name=ntpdate stat=present&quot;</span>
</code></pre></div> <h4 id=用户和用户组>用户和用户组<a class=headerlink href=#用户和用户组 title="Permanent link">&para;</a></h4> <h5 id=user>user<a class=headerlink href=#user title="Permanent link">&para;</a></h5> <p>添加用户 'user'并设置其 uid 和主要的组'admin' <div class=highlight><pre><span></span><code><a id=__codelineno-95-1 name=__codelineno-95-1 href=#__codelineno-95-1></a>ansible<span class=w> </span>web<span class=w> </span>-m<span class=w> </span>user<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;name=user comment=&#39;I am user&#39; uid=1040 group=admin&quot;</span>
</code></pre></div></p> <p>添加用户 'user'并设置其登陆shell，并将其假如admins和developers组 <div class=highlight><pre><span></span><code><a id=__codelineno-96-1 name=__codelineno-96-1 href=#__codelineno-96-1></a>ansible<span class=w> </span>web<span class=w> </span>-m<span class=w> </span>user<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;name=user shell=/bin/bash groups=admins,developers append=yes&quot;</span>
</code></pre></div></p> <p>删除用户 'user' <div class=highlight><pre><span></span><code><a id=__codelineno-97-1 name=__codelineno-97-1 href=#__codelineno-97-1></a>ansible<span class=w> </span>web<span class=w> </span>-m<span class=w> </span>user<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;name=user state=absent remove=yes&quot;</span>
</code></pre></div></p> <p>创建 user 用户得 2048-bit SSH key，并存放在 ~user/.ssh/id_rsa <div class=highlight><pre><span></span><code><a id=__codelineno-98-1 name=__codelineno-98-1 href=#__codelineno-98-1></a>ansible<span class=w> </span>web<span class=w> </span>-m<span class=w> </span>user<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;name=user generate_ssh_key=yes ssh_key_bits=2048 ssh_key_file=.ssh/id_rsa&quot;</span>
</code></pre></div></p> <p>设置用户过期日期 <div class=highlight><pre><span></span><code><a id=__codelineno-99-1 name=__codelineno-99-1 href=#__codelineno-99-1></a>ansible<span class=w> </span>web<span class=w> </span>-m<span class=w> </span>user<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;name=user shell=/bin/zsh groups=nobdy expires=1422403387&quot;</span>
</code></pre></div></p> <p>创建 test 组，并设置 gid 为1000 <div class=highlight><pre><span></span><code><a id=__codelineno-100-1 name=__codelineno-100-1 href=#__codelineno-100-1></a>ansible<span class=w> </span>web<span class=w> </span>-m<span class=w> </span>group<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;name=test gid=1000 state=present&quot;</span>
</code></pre></div></p> <p>删除 test 组 <div class=highlight><pre><span></span><code><a id=__codelineno-101-1 name=__codelineno-101-1 href=#__codelineno-101-1></a>ansible<span class=w> </span>web<span class=w> </span>-m<span class=w> </span>group<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;name=test state=absent&quot;</span>
</code></pre></div></p> <h4 id=版本控制>版本控制<a class=headerlink href=#版本控制 title="Permanent link">&para;</a></h4> <h5 id=git>git<a class=headerlink href=#git title="Permanent link">&para;</a></h5> <p>Ansible 模块能够通知变更，当代码更新时，可以告诉 Ansible 做一些特定的任务，比如从git 部署代码然后重启 apache 服务等 <div class=highlight><pre><span></span><code><a id=__codelineno-102-1 name=__codelineno-102-1 href=#__codelineno-102-1></a>ansible<span class=w> </span>web<span class=w> </span>-m<span class=w> </span>git<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;repo=https://github.com/Icinga/icinga2.git dest=/tmp/myapp   version=HEAD&quot;</span>
</code></pre></div></p> <h4 id=服务管理>服务管理<a class=headerlink href=#服务管理 title="Permanent link">&para;</a></h4> <h5 id=service>service<a class=headerlink href=#service title="Permanent link">&para;</a></h5> <p>确保 web 组所有主机的 httpd 是启动的 <div class=highlight><pre><span></span><code><a id=__codelineno-103-1 name=__codelineno-103-1 href=#__codelineno-103-1></a>ansible<span class=w> </span>web<span class=w> </span>-m<span class=w> </span>service<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;name=httpd state=started&quot;</span>
</code></pre></div></p> <p>重启 web 组所有主机的httpd 服务 <div class=highlight><pre><span></span><code><a id=__codelineno-104-1 name=__codelineno-104-1 href=#__codelineno-104-1></a>ansible<span class=w> </span>web<span class=w> </span>-m<span class=w> </span>service<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;name=httpd state=restarted&quot;</span>
</code></pre></div></p> <p>确保web组所有主机的httpd 是关闭的 <div class=highlight><pre><span></span><code><a id=__codelineno-105-1 name=__codelineno-105-1 href=#__codelineno-105-1></a>ansible<span class=w> </span>web<span class=w> </span>-m<span class=w> </span>service<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;name=httpd state=stopped&quot;</span>
</code></pre></div></p> <h5 id=systemd>systemd<a class=headerlink href=#systemd title="Permanent link">&para;</a></h5> <p>启动服务</p> <div class=highlight><pre><span></span><code><a id=__codelineno-106-1 name=__codelineno-106-1 href=#__codelineno-106-1></a>ansible<span class=w> </span>web<span class=w> </span>-m<span class=w> </span>systemd<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;state=started name=httpd&quot;</span>
</code></pre></div> <p>重载配置</p> <div class=highlight><pre><span></span><code><a id=__codelineno-107-1 name=__codelineno-107-1 href=#__codelineno-107-1></a>ansible<span class=w> </span>web<span class=w> </span>-m<span class=w> </span>systemd<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;daemon_reload=yes&quot;</span>
</code></pre></div> <h4 id=防火墙管理>防火墙管理<a class=headerlink href=#防火墙管理 title="Permanent link">&para;</a></h4> <h5 id=iptables>iptables<a class=headerlink href=#iptables title="Permanent link">&para;</a></h5> <p>允许tcp 22端口通过 <div class=highlight><pre><span></span><code><a id=__codelineno-108-1 name=__codelineno-108-1 href=#__codelineno-108-1></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span>iptables<span class=w>  </span>-a<span class=w> </span><span class=s2>&quot;chain=INPUT destination_port=22 protocol=tcp jump=ACCEPT&quot;</span>
</code></pre></div></p> <h5 id=firewalld>firewalld<a class=headerlink href=#firewalld title="Permanent link">&para;</a></h5> <p>运行https端口通过</p> <div class=highlight><pre><span></span><code><a id=__codelineno-109-1 name=__codelineno-109-1 href=#__codelineno-109-1></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span>firewalld<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;service=https permanent=yes state=enabled&quot;</span>
</code></pre></div> <h4 id=文件内容操作>文件内容操作<a class=headerlink href=#文件内容操作 title="Permanent link">&para;</a></h4> <h5 id=lineinfile>lineinfile<a class=headerlink href=#lineinfile title="Permanent link">&para;</a></h5> <p>开启selinux， 替换以SELINUX=开头的行，如果没有匹配到，则新增一条数据。 <div class=highlight><pre><span></span><code><a id=__codelineno-110-1 name=__codelineno-110-1 href=#__codelineno-110-1></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span>lineinfile<span class=w>  </span>-a<span class=w> </span><span class=s2>&quot;dest=/etc/selinux/config regexp=^SELINUX= line=SELINUX=enforcing&quot;</span>
</code></pre></div></p> <p>删除以SELINUX=开头的行 <div class=highlight><pre><span></span><code><a id=__codelineno-111-1 name=__codelineno-111-1 href=#__codelineno-111-1></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span>lineinfile<span class=w>  </span>-a<span class=w> </span><span class=s2>&quot;dest=/tmp/config regexp=^SELINUX= state=absent&quot;</span>
</code></pre></div></p> <p>如果文件中, line值不存在，则向文件中添加line的内容 <div class=highlight><pre><span></span><code><a id=__codelineno-112-1 name=__codelineno-112-1 href=#__codelineno-112-1></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span>lineinfile<span class=w>  </span>-a<span class=w> </span><span class=s2>&quot;dest=/tmp/config  line=&#39;test&#39;&quot;</span>
</code></pre></div></p> <h5 id=replace>replace<a class=headerlink href=#replace title="Permanent link">&para;</a></h5> <p>替换文件内容</p> <div class=highlight><pre><span></span><code><a id=__codelineno-113-1 name=__codelineno-113-1 href=#__codelineno-113-1></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w>  </span>replace<span class=w>  </span>-a<span class=w> </span><span class=s2>&quot;dest=/etc/selinux/config regexp=^SELINUX=disabled replace=SELINUX=enforcing&quot;</span>
</code></pre></div> <h4 id=定时任务>定时任务<a class=headerlink href=#定时任务 title="Permanent link">&para;</a></h4> <p>每天5点，2点得时候执行 ls -alh &gt; /dev/null</p> <div class=highlight><pre><span></span><code><a id=__codelineno-114-1 name=__codelineno-114-1 href=#__codelineno-114-1></a>ansible<span class=w> </span><span class=nb>test</span><span class=w> </span>-m<span class=w> </span>cron<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;name=&#39;check dirs&#39; minute=&#39;0&#39; hour=&#39;5,2&#39; job=&#39;ls -alh &gt; /dev/null&#39;&quot;</span>
</code></pre></div> <h4 id=搜集系统信息>搜集系统信息<a class=headerlink href=#搜集系统信息 title="Permanent link">&para;</a></h4> <p>搜集主机的所有系统信息</p> <div class=highlight><pre><span></span><code><a id=__codelineno-115-1 name=__codelineno-115-1 href=#__codelineno-115-1></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span>setup
</code></pre></div> <p>搜集系统信息并以主机名为文件名分别保存在/tmp/facts 目录</p> <div class=highlight><pre><span></span><code><a id=__codelineno-116-1 name=__codelineno-116-1 href=#__codelineno-116-1></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span>setup<span class=w> </span>--tree<span class=w> </span>/tmp/facts
</code></pre></div> <p>搜集和内存相关的信息</p> <div class=highlight><pre><span></span><code><a id=__codelineno-117-1 name=__codelineno-117-1 href=#__codelineno-117-1></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span>setup<span class=w> </span>-a<span class=w> </span><span class=s1>&#39;filter=ansible_*_mb&#39;</span>
</code></pre></div> <p>搜集网卡信息</p> <div class=highlight><pre><span></span><code><a id=__codelineno-118-1 name=__codelineno-118-1 href=#__codelineno-118-1></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span>setup<span class=w> </span>-a<span class=w> </span><span class=s1>&#39;filter=ansible_eth[0-2]&#39;</span>
</code></pre></div> <h4 id=指定连接方式>指定连接方式<a class=headerlink href=#指定连接方式 title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><a id=__codelineno-119-1 name=__codelineno-119-1 href=#__codelineno-119-1></a>ansible<span class=w> </span>all<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;centos,&#39;</span><span class=w> </span>-c<span class=w> </span>docker<span class=w> </span>-m<span class=w> </span>shell<span class=w> </span>-a<span class=w> </span><span class=s1>&#39;ps aux&#39;</span>
<a id=__codelineno-119-2 name=__codelineno-119-2 href=#__codelineno-119-2></a>ansible<span class=w> </span>all<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;centos,&#39;</span><span class=w> </span>-c<span class=w> </span><span class=nb>local</span><span class=w> </span>-m<span class=w> </span>shell<span class=w> </span>-a<span class=w> </span><span class=s1>&#39;ifconfig&#39;</span>
</code></pre></div> <h4 id=后台运行>后台运行<a class=headerlink href=#后台运行 title="Permanent link">&para;</a></h4> <p>长时间运行的操作可以放到后台执行，ansible 会检查任务的状态；在主机上执行的同一个任</p> <p>务会分配同一个job ID</p> <p>后台执行命令3600s，-B 表示后台执行的时间</p> <div class=highlight><pre><span></span><code><a id=__codelineno-120-1 name=__codelineno-120-1 href=#__codelineno-120-1></a>ansible<span class=w> </span>all<span class=w> </span>-B<span class=w> </span><span class=m>3600</span><span class=w> </span>-a<span class=w> </span><span class=s2>&quot;/usr/bin/long_running_operation --do-stuff&quot;</span>
</code></pre></div> <p><strong>检查任务的状态</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-121-1 name=__codelineno-121-1 href=#__codelineno-121-1></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span>async_status<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;jid=123456789&quot;</span>
</code></pre></div> <p>后台执行命令最大时间是1800s 即30 分钟，-P 每60s 检查下状态默认15s</p> <div class=highlight><pre><span></span><code><a id=__codelineno-122-1 name=__codelineno-122-1 href=#__codelineno-122-1></a>ansible<span class=w> </span>all<span class=w> </span>-B<span class=w> </span><span class=m>1800</span><span class=w> </span>-P<span class=w> </span><span class=m>60</span><span class=w> </span>-a<span class=w> </span><span class=s2>&quot;/usr/bin/long_running_operation --do-stuff&quot;</span>
</code></pre></div> <h3 id=练习>练习<a class=headerlink href=#练习 title="Permanent link">&para;</a></h3> <p>大家通过下列命令来查看帮助，练习下表格中常用模块的使用。</p> <div class=highlight><pre><span></span><code><a id=__codelineno-123-1 name=__codelineno-123-1 href=#__codelineno-123-1></a>ansible-doc<span class=w> </span>file
</code></pre></div> <table> <thead> <tr> <th>类型</th> <th>模块</th> </tr> </thead> <tbody> <tr> <td>文件操作</td> <td>stat find file lineinfile blockinfile template replace</td> </tr> <tr> <td>包管理</td> <td>apt gem npm pip yum package easy_install rpm_key</td> </tr> <tr> <td>传输</td> <td>fetch copy unarchive get_url</td> </tr> <tr> <td>用户组</td> <td>user group</td> </tr> <tr> <td>文件包含</td> <td>import_tasks include_tasks include_vars</td> </tr> <tr> <td>mysql数据库</td> <td>mysql_db mysql_replication mysql_user</td> </tr> <tr> <td>服务</td> <td>service systemd supervisorctl</td> </tr> <tr> <td>检查</td> <td>uri wait_for</td> </tr> <tr> <td>其他</td> <td>debug fail selinux set_fact sysctl authorized_key</td> </tr> </tbody> </table> <h2 id=7熟悉ansible命令>7.熟悉ansible命令<a class=headerlink href=#7熟悉ansible命令 title="Permanent link">&para;</a></h2> <p>本文以 <strong>Ansible</strong> 版本 <code>2.9.6</code>为准</p> <h3 id=ansible>ansible<a class=headerlink href=#ansible title="Permanent link">&para;</a></h3> <p><code>ansible</code>命令是 <strong>Ansible</strong> 的核心部分，其主要用于执行ad-hoc命令，即单条命令。默认后面需要跟主机和选项部分，默认不指定模块时，使用的是command模块。</p> <div class=highlight><pre><span></span><code><a id=__codelineno-124-1 name=__codelineno-124-1 href=#__codelineno-124-1></a><span class=c1># ansible --help</span>
<a id=__codelineno-124-2 name=__codelineno-124-2 href=#__codelineno-124-2></a>usage:<span class=w> </span>ansible<span class=w> </span><span class=o>[</span>-h<span class=o>]</span><span class=w> </span><span class=o>[</span>--version<span class=o>]</span><span class=w> </span><span class=o>[</span>-v<span class=o>]</span><span class=w> </span><span class=o>[</span>-b<span class=o>]</span><span class=w> </span><span class=o>[</span>--become-method<span class=w> </span>BECOME_METHOD<span class=o>]</span>
<a id=__codelineno-124-3 name=__codelineno-124-3 href=#__codelineno-124-3></a><span class=w>               </span><span class=o>[</span>--become-user<span class=w> </span>BECOME_USER<span class=o>]</span><span class=w> </span><span class=o>[</span>-K<span class=o>]</span><span class=w> </span><span class=o>[</span>-i<span class=w> </span>INVENTORY<span class=o>]</span><span class=w> </span><span class=o>[</span>--list-hosts<span class=o>]</span>
<a id=__codelineno-124-4 name=__codelineno-124-4 href=#__codelineno-124-4></a><span class=w>               </span><span class=o>[</span>-l<span class=w> </span>SUBSET<span class=o>]</span><span class=w> </span><span class=o>[</span>-P<span class=w> </span>POLL_INTERVAL<span class=o>]</span><span class=w> </span><span class=o>[</span>-B<span class=w> </span>SECONDS<span class=o>]</span><span class=w> </span><span class=o>[</span>-o<span class=o>]</span><span class=w> </span><span class=o>[</span>-t<span class=w> </span>TREE<span class=o>]</span><span class=w> </span><span class=o>[</span>-k<span class=o>]</span>
<a id=__codelineno-124-5 name=__codelineno-124-5 href=#__codelineno-124-5></a><span class=w>               </span><span class=o>[</span>--private-key<span class=w> </span>PRIVATE_KEY_FILE<span class=o>]</span><span class=w> </span><span class=o>[</span>-u<span class=w> </span>REMOTE_USER<span class=o>]</span>
<a id=__codelineno-124-6 name=__codelineno-124-6 href=#__codelineno-124-6></a><span class=w>               </span><span class=o>[</span>-c<span class=w> </span>CONNECTION<span class=o>]</span><span class=w> </span><span class=o>[</span>-T<span class=w> </span>TIMEOUT<span class=o>]</span>
<a id=__codelineno-124-7 name=__codelineno-124-7 href=#__codelineno-124-7></a><span class=w>               </span><span class=o>[</span>--ssh-common-args<span class=w> </span>SSH_COMMON_ARGS<span class=o>]</span>
<a id=__codelineno-124-8 name=__codelineno-124-8 href=#__codelineno-124-8></a><span class=w>               </span><span class=o>[</span>--sftp-extra-args<span class=w> </span>SFTP_EXTRA_ARGS<span class=o>]</span>
<a id=__codelineno-124-9 name=__codelineno-124-9 href=#__codelineno-124-9></a><span class=w>               </span><span class=o>[</span>--scp-extra-args<span class=w> </span>SCP_EXTRA_ARGS<span class=o>]</span>
<a id=__codelineno-124-10 name=__codelineno-124-10 href=#__codelineno-124-10></a><span class=w>               </span><span class=o>[</span>--ssh-extra-args<span class=w> </span>SSH_EXTRA_ARGS<span class=o>]</span><span class=w> </span><span class=o>[</span>-C<span class=o>]</span><span class=w> </span><span class=o>[</span>--syntax-check<span class=o>]</span><span class=w> </span><span class=o>[</span>-D<span class=o>]</span>
<a id=__codelineno-124-11 name=__codelineno-124-11 href=#__codelineno-124-11></a><span class=w>               </span><span class=o>[</span>-e<span class=w> </span>EXTRA_VARS<span class=o>]</span><span class=w> </span><span class=o>[</span>--vault-id<span class=w> </span>VAULT_IDS<span class=o>]</span>
<a id=__codelineno-124-12 name=__codelineno-124-12 href=#__codelineno-124-12></a><span class=w>               </span><span class=o>[</span>--ask-vault-pass<span class=w> </span><span class=p>|</span><span class=w> </span>--vault-password-file<span class=w> </span>VAULT_PASSWORD_FILES<span class=o>]</span>
<a id=__codelineno-124-13 name=__codelineno-124-13 href=#__codelineno-124-13></a><span class=w>               </span><span class=o>[</span>-f<span class=w> </span>FORKS<span class=o>]</span><span class=w> </span><span class=o>[</span>-M<span class=w> </span>MODULE_PATH<span class=o>]</span><span class=w> </span><span class=o>[</span>--playbook-dir<span class=w> </span>BASEDIR<span class=o>]</span>
<a id=__codelineno-124-14 name=__codelineno-124-14 href=#__codelineno-124-14></a><span class=w>               </span><span class=o>[</span>-a<span class=w> </span>MODULE_ARGS<span class=o>]</span><span class=w> </span><span class=o>[</span>-m<span class=w> </span>MODULE_NAME<span class=o>]</span>
<a id=__codelineno-124-15 name=__codelineno-124-15 href=#__codelineno-124-15></a><span class=w>               </span>pattern
</code></pre></div> <p><strong>位置参数</strong></p> <table> <thead> <tr> <th>参数</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>pattern</td> <td>主机匹配</td> </tr> </tbody> </table> <p><strong>选项参数</strong></p> <table> <thead> <tr> <th>参数</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>--ask-vault-pass</td> <td>提示输入vault 密码。</td> </tr> <tr> <td>--list-hosts</td> <td>输出匹配主机的列表。</td> </tr> <tr> <td>--playbook-dir BASEDIR</td> <td>指定playbook目录，为<code>role</code>,<code>group_vars/etc</code>指定相对路径</td> </tr> <tr> <td>--syntax-check</td> <td>对playbook进行语法检查，且不执行playbook。</td> </tr> <tr> <td>--vault-id=VAULT_IDS</td> <td>标识使用的vault id</td> </tr> <tr> <td>--vault-password-file=VAULT_PASSWORD_FILE</td> <td>指定vault密码文件</td> </tr> <tr> <td>--version</td> <td>显示程序版本信息</td> </tr> <tr> <td>-B SECONDS, --background SECONDS</td> <td>异步运行时，多长时间超时。</td> </tr> <tr> <td>-C, --check</td> <td>只是测试一下会改变什么内容，不会真正去执行;相反,试图预测一些可能发生的变化。</td> </tr> <tr> <td>-D, --diff</td> <td>当更改文件和模板时，显示这些文件得差异，比--check效果好。</td> </tr> <tr> <td>-M MODULE_PATH, --module-path MODULE_PATH</td> <td>要执行的模块的路径，默认路径<code>~/.ansible/plugins/modules:/usr/share/ansible/plu&lt;br/&gt; gins/modules)</code></td> </tr> <tr> <td>-P POLL_INTERVAL, --poll POLL_INTERVAL</td> <td>设置轮询间隔，默认15秒</td> </tr> <tr> <td>-a MODULE_ARGS, --args MODULE_ARGS</td> <td>指定模块参数</td> </tr> <tr> <td>-e EXTRA_VARS, --extra-vars EXTRA_VARS</td> <td>添加附加变量，比如key=value，yaml，json格式。使用<code>@</code>指定文件</td> </tr> <tr> <td>-f FORKS, --forks FORKS</td> <td>指定定要使用的并行进程数，默认为5个。</td> </tr> <tr> <td>-h, --help</td> <td>显示此帮助信息。</td> </tr> <tr> <td>-i INVENTORY, --inventory INVENTORY, --inventory-file INVENTORY</td> <td>指定主机清单文件或逗号分隔的主机，默认为/etc/ansible/hosts。</td> </tr> <tr> <td>-l SUBSET, --limit SUBSET</td> <td>进一步限制所选主机/组模式，只执行<code>-l</code>后的主机和组。</td> </tr> <tr> <td>-m MODULE_NAME, --module-name MODULE_NAME</td> <td>要执行的模块，默认为command。</td> </tr> <tr> <td>-o, --one-line</td> <td>压缩输出，尝试将所有内容都在一行上输出。</td> </tr> <tr> <td>-t TREE, --tree</td> <td>指定tree的输出目录</td> </tr> <tr> <td>-v, --verbose</td> <td>输出执行的详细信息，使用-vvv获得更多，-vvvv 启用连接调试</td> </tr> </tbody> </table> <p><strong>特权升级选项</strong></p> <table> <thead> <tr> <th>参数</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>--become-method=BECOME_METHOD</td> <td>权限升级方法使用 ，默认为sudo，有效选择：[sudo | su | pbrun | pfexec | runas | doas | dzdo]</td> </tr> <tr> <td>--become-user=BECOME_USER</td> <td>使用哪个用户运行，默认为root</td> </tr> <tr> <td>-K, --ask-become-pass</td> <td>提供权限提升密码</td> </tr> <tr> <td>-b, --become</td> <td>运行权限提升</td> </tr> </tbody> </table> <p><strong>连接选项</strong></p> <table> <thead> <tr> <th>参数</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>--private-key=PRIVATE_KEY_FILE, --key-file=PRIVATE_KEY_FILE</td> <td>私钥路径，使用这个文件来验证连接</td> </tr> <tr> <td>--scp-extra-args SCP_EXTRA_ARGS</td> <td>指定额外的参数传递给<code>scp</code> ，例如<code>-l</code></td> </tr> <tr> <td>--sftp-extra-args SFTP_EXTRA_ARGS</td> <td>指定额外的参数传递给<code>sftp</code> ，例如<code>-f</code></td> </tr> <tr> <td>--ssh-common-args SSH_COMMON_ARGS</td> <td>指定要传递给sftp / scp / ssh的通用参数（例如 ProxyCommand）</td> </tr> <tr> <td>--ssh-extra-args SSH_EXTRA_ARGS</td> <td>指定额外的参数传递给<code>ssh</code> ，例如<code>-R</code></td> </tr> <tr> <td>-T TIMEOUT, --timeout=TIMEOUT</td> <td>指定默认超时时间，默认是10S</td> </tr> <tr> <td>-c CONNECTION, --connection=CONNECTION</td> <td>指定连接类型，默认smart</td> </tr> <tr> <td>-k, --ask-pass</td> <td>要求用户输入请求连接密码</td> </tr> <tr> <td>-u REMOTE_USER, --user=REMOTE_USER</td> <td>指定连接用户</td> </tr> </tbody> </table> <p><strong>示例</strong>：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-125-1 name=__codelineno-125-1 href=#__codelineno-125-1></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span>ping
<a id=__codelineno-125-2 name=__codelineno-125-2 href=#__codelineno-125-2></a>
<a id=__codelineno-125-3 name=__codelineno-125-3 href=#__codelineno-125-3></a>ansible<span class=w> </span><span class=m>192</span>.168.77.*<span class=w> </span>-m<span class=w> </span>ping
<a id=__codelineno-125-4 name=__codelineno-125-4 href=#__codelineno-125-4></a>
<a id=__codelineno-125-5 name=__codelineno-125-5 href=#__codelineno-125-5></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span><span class=nb>command</span><span class=w> </span>-a<span class=w> </span>ifconfig
<a id=__codelineno-125-6 name=__codelineno-125-6 href=#__codelineno-125-6></a>
<a id=__codelineno-125-7 name=__codelineno-125-7 href=#__codelineno-125-7></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span>shell<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;ifconfig eth0 |grep &#39;inet addr&#39; &quot;</span>
<a id=__codelineno-125-8 name=__codelineno-125-8 href=#__codelineno-125-8></a>
<a id=__codelineno-125-9 name=__codelineno-125-9 href=#__codelineno-125-9></a>ansible<span class=w> </span>-i<span class=w> </span><span class=s2>&quot;192.168.77.129,192.168.77.130&quot;</span><span class=w> </span><span class=m>192</span>.168.77.129<span class=w>  </span>-m<span class=w> </span>ping
<a id=__codelineno-125-10 name=__codelineno-125-10 href=#__codelineno-125-10></a>
<a id=__codelineno-125-11 name=__codelineno-125-11 href=#__codelineno-125-11></a>ansible<span class=w> </span>-i<span class=w> </span>hosts<span class=w>  </span>all<span class=w> </span>--list-host
<a id=__codelineno-125-12 name=__codelineno-125-12 href=#__codelineno-125-12></a>
<a id=__codelineno-125-13 name=__codelineno-125-13 href=#__codelineno-125-13></a>ansible<span class=w> </span>-i<span class=w> </span>hosts<span class=w> </span>-l<span class=w> </span><span class=m>192</span>.168.77.130<span class=w> </span>all<span class=w> </span>-m<span class=w> </span>ping<span class=w> </span>-t<span class=w> </span>/tmp<span class=w> </span>-vvvv
<a id=__codelineno-125-14 name=__codelineno-125-14 href=#__codelineno-125-14></a>
<a id=__codelineno-125-15 name=__codelineno-125-15 href=#__codelineno-125-15></a>ansible<span class=w> </span>web<span class=w> </span>-l<span class=w> </span>@retry_hosts.txt<span class=w> </span>--list-hosts
<a id=__codelineno-125-16 name=__codelineno-125-16 href=#__codelineno-125-16></a>
<a id=__codelineno-125-17 name=__codelineno-125-17 href=#__codelineno-125-17></a>ansible<span class=w> </span>all<span class=w> </span>-i<span class=w> </span><span class=m>192</span>.168.77.133,<span class=w> </span>-m<span class=w> </span>ping<span class=w> </span>-k
</code></pre></div> <h3 id=ansible-console>ansible-console<a class=headerlink href=#ansible-console title="Permanent link">&para;</a></h3> <p>交互式命令执行界面</p> <div class=highlight><pre><span></span><code><a id=__codelineno-126-1 name=__codelineno-126-1 href=#__codelineno-126-1></a><span class=c1># ansible-console --help</span>
<a id=__codelineno-126-2 name=__codelineno-126-2 href=#__codelineno-126-2></a>usage:<span class=w> </span>ansible-console<span class=w> </span><span class=o>[</span>-h<span class=o>]</span><span class=w> </span><span class=o>[</span>--version<span class=o>]</span><span class=w> </span><span class=o>[</span>-v<span class=o>]</span><span class=w> </span><span class=o>[</span>-b<span class=o>]</span>
<a id=__codelineno-126-3 name=__codelineno-126-3 href=#__codelineno-126-3></a><span class=w>                       </span><span class=o>[</span>--become-method<span class=w> </span>BECOME_METHOD<span class=o>]</span>
<a id=__codelineno-126-4 name=__codelineno-126-4 href=#__codelineno-126-4></a><span class=w>                       </span><span class=o>[</span>--become-user<span class=w> </span>BECOME_USER<span class=o>]</span><span class=w> </span><span class=o>[</span>-K<span class=o>]</span><span class=w> </span><span class=o>[</span>-i<span class=w> </span>INVENTORY<span class=o>]</span>
<a id=__codelineno-126-5 name=__codelineno-126-5 href=#__codelineno-126-5></a><span class=w>                       </span><span class=o>[</span>--list-hosts<span class=o>]</span><span class=w> </span><span class=o>[</span>-l<span class=w> </span>SUBSET<span class=o>]</span><span class=w> </span><span class=o>[</span>-k<span class=o>]</span>
<a id=__codelineno-126-6 name=__codelineno-126-6 href=#__codelineno-126-6></a><span class=w>                       </span><span class=o>[</span>--private-key<span class=w> </span>PRIVATE_KEY_FILE<span class=o>]</span><span class=w> </span><span class=o>[</span>-u<span class=w> </span>REMOTE_USER<span class=o>]</span>
<a id=__codelineno-126-7 name=__codelineno-126-7 href=#__codelineno-126-7></a><span class=w>                       </span><span class=o>[</span>-c<span class=w> </span>CONNECTION<span class=o>]</span><span class=w> </span><span class=o>[</span>-T<span class=w> </span>TIMEOUT<span class=o>]</span>
<a id=__codelineno-126-8 name=__codelineno-126-8 href=#__codelineno-126-8></a><span class=w>                       </span><span class=o>[</span>--ssh-common-args<span class=w> </span>SSH_COMMON_ARGS<span class=o>]</span>
<a id=__codelineno-126-9 name=__codelineno-126-9 href=#__codelineno-126-9></a><span class=w>                       </span><span class=o>[</span>--sftp-extra-args<span class=w> </span>SFTP_EXTRA_ARGS<span class=o>]</span>
<a id=__codelineno-126-10 name=__codelineno-126-10 href=#__codelineno-126-10></a><span class=w>                       </span><span class=o>[</span>--scp-extra-args<span class=w> </span>SCP_EXTRA_ARGS<span class=o>]</span>
<a id=__codelineno-126-11 name=__codelineno-126-11 href=#__codelineno-126-11></a><span class=w>                       </span><span class=o>[</span>--ssh-extra-args<span class=w> </span>SSH_EXTRA_ARGS<span class=o>]</span><span class=w> </span><span class=o>[</span>-C<span class=o>]</span><span class=w> </span><span class=o>[</span>--syntax-check<span class=o>]</span>
<a id=__codelineno-126-12 name=__codelineno-126-12 href=#__codelineno-126-12></a><span class=w>                       </span><span class=o>[</span>-D<span class=o>]</span><span class=w> </span><span class=o>[</span>--vault-id<span class=w> </span>VAULT_IDS<span class=o>]</span>
<a id=__codelineno-126-13 name=__codelineno-126-13 href=#__codelineno-126-13></a><span class=w>                       </span><span class=o>[</span>--ask-vault-pass<span class=w> </span><span class=p>|</span><span class=w> </span>--vault-password-file<span class=w> </span>VAULT_PASSWORD_FILES<span class=o>]</span>
<a id=__codelineno-126-14 name=__codelineno-126-14 href=#__codelineno-126-14></a><span class=w>                       </span><span class=o>[</span>-f<span class=w> </span>FORKS<span class=o>]</span><span class=w> </span><span class=o>[</span>-M<span class=w> </span>MODULE_PATH<span class=o>]</span><span class=w> </span><span class=o>[</span>--playbook-dir<span class=w> </span>BASEDIR<span class=o>]</span>
<a id=__codelineno-126-15 name=__codelineno-126-15 href=#__codelineno-126-15></a><span class=w>                       </span><span class=o>[</span>--step<span class=o>]</span>
<a id=__codelineno-126-16 name=__codelineno-126-16 href=#__codelineno-126-16></a><span class=w>                       </span><span class=o>[</span>pattern<span class=o>]</span>
</code></pre></div> <p><strong>位置参数</strong></p> <table> <thead> <tr> <th>参数</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>pattern</td> <td>主机匹配</td> </tr> </tbody> </table> <p><strong>选项参数</strong></p> <table> <thead> <tr> <th>参数</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>--ask-vault-pass</td> <td>提示输入vault 密码。</td> </tr> <tr> <td>--list-hosts</td> <td>输出匹配主机的列表。</td> </tr> <tr> <td>--playbook-dir BASEDIR</td> <td>指定playbook目录，为<code>role</code>,<code>group_vars/etc</code>指定相对路径</td> </tr> <tr> <td>--step</td> <td>一步一步的运行，每个任务都会循环是否执行</td> </tr> <tr> <td>--syntax-check</td> <td>对playbook进行语法检查，且不执行playbook。</td> </tr> <tr> <td>--vault-id=VAULT_IDS</td> <td>标识使用的vault id</td> </tr> <tr> <td>--vault-password-file=VAULT_PASSWORD_FILE</td> <td>指定vault密码文件</td> </tr> <tr> <td>--version</td> <td>显示程序版本信息</td> </tr> <tr> <td>-C, --check</td> <td>只是测试一下会改变什么内容，不会真正去执行;相反,试图预测一些可能发生的变化。</td> </tr> <tr> <td>-D, --diff</td> <td>当更改文件和模板时，显示这些文件得差异，比--check效果好。</td> </tr> <tr> <td>-M MODULE_PATH, --module-path MODULE_PATH</td> <td>要执行的模块的路径，默认路径<code>~/.ansible/plugins/modules:/usr/share/ansible/plu&lt;br/&gt; gins/modules)</code></td> </tr> <tr> <td>-f FORKS, --forks FORKS</td> <td>指定定要使用的并行进程数，默认为5个。</td> </tr> <tr> <td>-h, --help</td> <td>显示此帮助信息。</td> </tr> <tr> <td>-i INVENTORY, --inventory INVENTORY, --inventory-file INVENTORY</td> <td>指定主机清单文件或逗号分隔的主机，默认为/etc/ansible/hosts。</td> </tr> <tr> <td>-l SUBSET, --limit SUBSET</td> <td>进一步限制所选主机/组模式，只执行<code>-l</code>后的主机和组。</td> </tr> <tr> <td>-v, --verbose</td> <td>输出执行的详细信息，使用-vvv获得更多，-vvvv 启用连接调试</td> </tr> </tbody> </table> <p><strong>特权升级选项</strong></p> <table> <thead> <tr> <th>参数</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>--become-method=BECOME_METHOD</td> <td>权限升级方法使用 ，默认为sudo，有效选择：[sudo | su | pbrun | pfexec | runas | doas | dzdo]</td> </tr> <tr> <td>--become-user=BECOME_USER</td> <td>使用哪个用户运行，默认为root</td> </tr> <tr> <td>-K, --ask-become-pass</td> <td>提供权限提升密码</td> </tr> <tr> <td>-b, --become</td> <td>运行权限提升</td> </tr> </tbody> </table> <p><strong>连接选项</strong></p> <table> <thead> <tr> <th>参数</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>--private-key=PRIVATE_KEY_FILE, --key-file=PRIVATE_KEY_FILE</td> <td>私钥路径，使用这个文件来验证连接</td> </tr> <tr> <td>--scp-extra-args SCP_EXTRA_ARGS</td> <td>指定额外的参数传递给<code>scp</code> ，例如<code>-l</code></td> </tr> <tr> <td>--sftp-extra-args SFTP_EXTRA_ARGS</td> <td>指定额外的参数传递给<code>sftp</code> ，例如<code>-f</code></td> </tr> <tr> <td>--ssh-common-args SSH_COMMON_ARGS</td> <td>指定要传递给sftp / scp / ssh的通用参数（例如 ProxyCommand）</td> </tr> <tr> <td>--ssh-extra-args SSH_EXTRA_ARGS</td> <td>指定额外的参数传递给<code>ssh</code> ，例如<code>-R</code></td> </tr> <tr> <td>-T TIMEOUT, --timeout=TIMEOUT</td> <td>指定默认超时时间，默认是10S</td> </tr> <tr> <td>-c CONNECTION, --connection=CONNECTION</td> <td>指定连接类型，默认smart</td> </tr> <tr> <td>-k, --ask-pass</td> <td>要求用户输入请求连接密码</td> </tr> <tr> <td>-u REMOTE_USER, --user=REMOTE_USER</td> <td>指定连接用户</td> </tr> </tbody> </table> <p><strong>示例：</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-127-1 name=__codelineno-127-1 href=#__codelineno-127-1></a>ansible-console<span class=w> </span>all<span class=w> </span>-i<span class=w> </span><span class=m>192</span>.168.77.133,<span class=w> </span>-m<span class=w> </span>ping<span class=w> </span>-k
<a id=__codelineno-127-2 name=__codelineno-127-2 href=#__codelineno-127-2></a>
<a id=__codelineno-127-3 name=__codelineno-127-3 href=#__codelineno-127-3></a>root@all<span class=w> </span><span class=o>(</span><span class=m>1</span><span class=o>)[</span>f:5<span class=o>]</span>$<span class=w> </span>ping
<a id=__codelineno-127-4 name=__codelineno-127-4 href=#__codelineno-127-4></a>
<a id=__codelineno-127-5 name=__codelineno-127-5 href=#__codelineno-127-5></a><span class=m>192</span>.168.77.133<span class=w> </span><span class=p>|</span><span class=w> </span><span class=nv>SUCCESS</span><span class=w> </span><span class=o>=</span>&gt;<span class=w> </span><span class=o>{</span>
<a id=__codelineno-127-6 name=__codelineno-127-6 href=#__codelineno-127-6></a><span class=w>    </span><span class=s2>&quot;changed&quot;</span>:<span class=w> </span>false,<span class=w> </span>
<a id=__codelineno-127-7 name=__codelineno-127-7 href=#__codelineno-127-7></a><span class=w>    </span><span class=s2>&quot;ping&quot;</span>:<span class=w> </span><span class=s2>&quot;pong&quot;</span>
<a id=__codelineno-127-8 name=__codelineno-127-8 href=#__codelineno-127-8></a>
<a id=__codelineno-127-9 name=__codelineno-127-9 href=#__codelineno-127-9></a><span class=o>}</span>
</code></pre></div> <h3 id=ansible-doc>ansible-doc<a class=headerlink href=#ansible-doc title="Permanent link">&para;</a></h3> <p>该指令用于查看模块信息，常用参数有两个-l 和 -s </p> <div class=highlight><pre><span></span><code><a id=__codelineno-128-1 name=__codelineno-128-1 href=#__codelineno-128-1></a><span class=c1># ansible-doc --help</span>
<a id=__codelineno-128-2 name=__codelineno-128-2 href=#__codelineno-128-2></a>usage:<span class=w> </span>ansible-doc<span class=w> </span><span class=o>[</span>-h<span class=o>]</span><span class=w> </span><span class=o>[</span>--version<span class=o>]</span><span class=w> </span><span class=o>[</span>-v<span class=o>]</span><span class=w> </span><span class=o>[</span>-M<span class=w> </span>MODULE_PATH<span class=o>]</span>
<a id=__codelineno-128-3 name=__codelineno-128-3 href=#__codelineno-128-3></a><span class=w>                   </span><span class=o>[</span>--playbook-dir<span class=w> </span>BASEDIR<span class=o>]</span>
<a id=__codelineno-128-4 name=__codelineno-128-4 href=#__codelineno-128-4></a><span class=w>                   </span><span class=o>[</span>-t<span class=w> </span><span class=o>{</span>become,cache,callback,cliconf,connection,httpapi,inventory,lookup,netconf,shell,module,strategy,vars<span class=o>}]</span>
<a id=__codelineno-128-5 name=__codelineno-128-5 href=#__codelineno-128-5></a><span class=w>                   </span><span class=o>[</span>-j<span class=o>]</span><span class=w> </span><span class=o>[</span>-F<span class=w> </span><span class=p>|</span><span class=w> </span>-l<span class=w> </span><span class=p>|</span><span class=w> </span>-s<span class=w> </span><span class=p>|</span><span class=w> </span>--metadata-dump<span class=o>]</span>
<a id=__codelineno-128-6 name=__codelineno-128-6 href=#__codelineno-128-6></a><span class=w>                   </span><span class=o>[</span>plugin<span class=w> </span><span class=o>[</span>plugin<span class=w> </span>...<span class=o>]]</span>
</code></pre></div> <p><strong>位置参数</strong></p> <table> <thead> <tr> <th>参数</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>plugin</td> <td>插件</td> </tr> </tbody> </table> <p><strong>选项参数</strong></p> <table> <thead> <tr> <th>参数</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>--metadata-dump</td> <td>获取所有插件的metadata json数据</td> </tr> <tr> <td>--playbook-dir BASEDIR</td> <td>指定playbook目录，为<code>role</code>,<code>group_vars/etc</code>指定相对路径</td> </tr> <tr> <td>--version</td> <td>显示程序版本信息</td> </tr> <tr> <td>-F, --list_files</td> <td>显示插件名称及其源文件，不显示摘要</td> </tr> <tr> <td>-h, --help</td> <td>显示帮助文件</td> </tr> <tr> <td>-j, --json</td> <td>使用json格式输出</td> </tr> <tr> <td>-l, --list</td> <td>列出可用的插件</td> </tr> <tr> <td>-s, --snippet</td> <td>显示指定插件的<code>playbook</code>摘要</td> </tr> <tr> <td become_cache_callback_wzxhzdk:292_cliconf_connection_httpapi_wzxhzdk:293_inventory_lookup_netconf_wzxhzdk:294_shell_module_strategy_vars="become,cache,callback,<br />cliconf,connection,httpapi,<br />inventory,lookup,netconf,<br />shell,module,strategy,vars">-t {become,cache,callback,<br>cliconf,connection,httpapi,<br>inventory,lookup,netconf,<br>shell,module,strategy,vars},<br> --type</td> <td>指定插件类型，默认<code>module</code></td> </tr> </tbody> </table> <p><strong>示例：</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-129-1 name=__codelineno-129-1 href=#__codelineno-129-1></a>ansible-doc<span class=w> </span>-l
<a id=__codelineno-129-2 name=__codelineno-129-2 href=#__codelineno-129-2></a>ansible-doc<span class=w> </span>yum
<a id=__codelineno-129-3 name=__codelineno-129-3 href=#__codelineno-129-3></a>ansible-doc<span class=w> </span>yum<span class=w> </span>-s
<a id=__codelineno-129-4 name=__codelineno-129-4 href=#__codelineno-129-4></a>ansible-doc<span class=w> </span>-t<span class=w> </span>cache<span class=w> </span>-l
<a id=__codelineno-129-5 name=__codelineno-129-5 href=#__codelineno-129-5></a>ansible-doc<span class=w> </span>-t<span class=w> </span>become<span class=w> </span>-l
</code></pre></div> <h3 id=ansible-galaxy>ansible-galaxy<a class=headerlink href=#ansible-galaxy title="Permanent link">&para;</a></h3> <p>ansible-galaxy 指令用于方便的从https://galaxy.ansible.com/ 站点下载第三方扩展模块，我们可以形象的理解其类似于centos下的yum、python下的pip或easy_install</p> <div class=highlight><pre><span></span><code><a id=__codelineno-130-1 name=__codelineno-130-1 href=#__codelineno-130-1></a><span class=c1># ansible-galaxy --help</span>
<a id=__codelineno-130-2 name=__codelineno-130-2 href=#__codelineno-130-2></a>usage:<span class=w> </span>ansible-galaxy<span class=w> </span><span class=o>[</span>-h<span class=o>]</span><span class=w> </span><span class=o>[</span>--version<span class=o>]</span><span class=w> </span><span class=o>[</span>-v<span class=o>]</span><span class=w> </span>TYPE<span class=w> </span>...
</code></pre></div> <p><strong>位置参数</strong></p> <table> <thead> <tr> <th>参数</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>collection</td> <td>管理Ansible Galaxy。</td> </tr> <tr> <td>role</td> <td>管理Ansible Galaxy role。</td> </tr> </tbody> </table> <p><strong>选项参数</strong></p> <table> <thead> <tr> <th>参数</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>--version</td> <td>显示程序版本号</td> </tr> <tr> <td>-h, --help</td> <td>显示此帮助信息</td> </tr> <tr> <td>-v, --verbose</td> <td>详细模式（-vvv表示更多，-vvvv表示启用连接调试）</td> </tr> </tbody> </table> <p><strong>示例：</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-131-1 name=__codelineno-131-1 href=#__codelineno-131-1></a>ansible-galaxy<span class=w> </span>search<span class=w> </span>tomcat<span class=w>  </span><span class=c1># 搜索角色</span>
<a id=__codelineno-131-2 name=__codelineno-131-2 href=#__codelineno-131-2></a>ansible-galaxy<span class=w> </span>install<span class=w> </span>aeriscloud.docker<span class=w> </span><span class=c1>#下载角色</span>
<a id=__codelineno-131-3 name=__codelineno-131-3 href=#__codelineno-131-3></a>
<a id=__codelineno-131-4 name=__codelineno-131-4 href=#__codelineno-131-4></a>ansible-galaxy<span class=w> </span>list<span class=w> </span>ragingbal.tomcat<span class=w>  </span>
<a id=__codelineno-131-5 name=__codelineno-131-5 href=#__codelineno-131-5></a>
<a id=__codelineno-131-6 name=__codelineno-131-6 href=#__codelineno-131-6></a>ansible-galaxy<span class=w> </span>info<span class=w> </span>ragingbal.tomcat
<a id=__codelineno-131-7 name=__codelineno-131-7 href=#__codelineno-131-7></a>
<a id=__codelineno-131-8 name=__codelineno-131-8 href=#__codelineno-131-8></a>ansible-galaxy<span class=w> </span>init<span class=w> </span>abc<span class=w>  </span><span class=c1># 创建角色模板</span>
<a id=__codelineno-131-9 name=__codelineno-131-9 href=#__codelineno-131-9></a><span class=c1># 安装的role在 /root/.ansible/roles/</span>
</code></pre></div> <h3 id=ansible-playbook>ansible-playbook<a class=headerlink href=#ansible-playbook title="Permanent link">&para;</a></h3> <p>对于需反复执行的、较为复杂的任务，我们可以通过定义 Playbook 来搞定。Playbook 是 Ansible 真正强大的地方，它允许使用变量、条件、循环、以及模板，也能通过角色 及包含指令来重用既有内容。</p> <div class=highlight><pre><span></span><code><a id=__codelineno-132-1 name=__codelineno-132-1 href=#__codelineno-132-1></a><span class=c1># ansible-playbook --help</span>
<a id=__codelineno-132-2 name=__codelineno-132-2 href=#__codelineno-132-2></a>usage:<span class=w> </span>ansible-playbook<span class=w> </span><span class=o>[</span>-h<span class=o>]</span><span class=w> </span><span class=o>[</span>--version<span class=o>]</span><span class=w> </span><span class=o>[</span>-v<span class=o>]</span><span class=w> </span><span class=o>[</span>-k<span class=o>]</span>
<a id=__codelineno-132-3 name=__codelineno-132-3 href=#__codelineno-132-3></a><span class=w>                        </span><span class=o>[</span>--private-key<span class=w> </span>PRIVATE_KEY_FILE<span class=o>]</span><span class=w> </span><span class=o>[</span>-u<span class=w> </span>REMOTE_USER<span class=o>]</span>
<a id=__codelineno-132-4 name=__codelineno-132-4 href=#__codelineno-132-4></a><span class=w>                        </span><span class=o>[</span>-c<span class=w> </span>CONNECTION<span class=o>]</span><span class=w> </span><span class=o>[</span>-T<span class=w> </span>TIMEOUT<span class=o>]</span>
<a id=__codelineno-132-5 name=__codelineno-132-5 href=#__codelineno-132-5></a><span class=w>                        </span><span class=o>[</span>--ssh-common-args<span class=w> </span>SSH_COMMON_ARGS<span class=o>]</span>
<a id=__codelineno-132-6 name=__codelineno-132-6 href=#__codelineno-132-6></a><span class=w>                        </span><span class=o>[</span>--sftp-extra-args<span class=w> </span>SFTP_EXTRA_ARGS<span class=o>]</span>
<a id=__codelineno-132-7 name=__codelineno-132-7 href=#__codelineno-132-7></a><span class=w>                        </span><span class=o>[</span>--scp-extra-args<span class=w> </span>SCP_EXTRA_ARGS<span class=o>]</span>
<a id=__codelineno-132-8 name=__codelineno-132-8 href=#__codelineno-132-8></a><span class=w>                        </span><span class=o>[</span>--ssh-extra-args<span class=w> </span>SSH_EXTRA_ARGS<span class=o>]</span><span class=w> </span><span class=o>[</span>--force-handlers<span class=o>]</span>
<a id=__codelineno-132-9 name=__codelineno-132-9 href=#__codelineno-132-9></a><span class=w>                        </span><span class=o>[</span>--flush-cache<span class=o>]</span><span class=w> </span><span class=o>[</span>-b<span class=o>]</span><span class=w> </span><span class=o>[</span>--become-method<span class=w> </span>BECOME_METHOD<span class=o>]</span>
<a id=__codelineno-132-10 name=__codelineno-132-10 href=#__codelineno-132-10></a><span class=w>                        </span><span class=o>[</span>--become-user<span class=w> </span>BECOME_USER<span class=o>]</span><span class=w> </span><span class=o>[</span>-K<span class=o>]</span><span class=w> </span><span class=o>[</span>-t<span class=w> </span>TAGS<span class=o>]</span>
<a id=__codelineno-132-11 name=__codelineno-132-11 href=#__codelineno-132-11></a><span class=w>                        </span><span class=o>[</span>--skip-tags<span class=w> </span>SKIP_TAGS<span class=o>]</span><span class=w> </span><span class=o>[</span>-C<span class=o>]</span><span class=w> </span><span class=o>[</span>--syntax-check<span class=o>]</span><span class=w> </span><span class=o>[</span>-D<span class=o>]</span>
<a id=__codelineno-132-12 name=__codelineno-132-12 href=#__codelineno-132-12></a><span class=w>                        </span><span class=o>[</span>-i<span class=w> </span>INVENTORY<span class=o>]</span><span class=w> </span><span class=o>[</span>--list-hosts<span class=o>]</span><span class=w> </span><span class=o>[</span>-l<span class=w> </span>SUBSET<span class=o>]</span>
<a id=__codelineno-132-13 name=__codelineno-132-13 href=#__codelineno-132-13></a><span class=w>                        </span><span class=o>[</span>-e<span class=w> </span>EXTRA_VARS<span class=o>]</span><span class=w> </span><span class=o>[</span>--vault-id<span class=w> </span>VAULT_IDS<span class=o>]</span>
<a id=__codelineno-132-14 name=__codelineno-132-14 href=#__codelineno-132-14></a><span class=w>                        </span><span class=o>[</span>--ask-vault-pass<span class=w> </span><span class=p>|</span><span class=w> </span>--vault-password-file<span class=w> </span>VAULT_PASSWORD_FILES<span class=o>]</span>
<a id=__codelineno-132-15 name=__codelineno-132-15 href=#__codelineno-132-15></a><span class=w>                        </span><span class=o>[</span>-f<span class=w> </span>FORKS<span class=o>]</span><span class=w> </span><span class=o>[</span>-M<span class=w> </span>MODULE_PATH<span class=o>]</span><span class=w> </span><span class=o>[</span>--list-tasks<span class=o>]</span>
<a id=__codelineno-132-16 name=__codelineno-132-16 href=#__codelineno-132-16></a><span class=w>                        </span><span class=o>[</span>--list-tags<span class=o>]</span><span class=w> </span><span class=o>[</span>--step<span class=o>]</span><span class=w> </span><span class=o>[</span>--start-at-task<span class=w> </span>START_AT_TASK<span class=o>]</span>
<a id=__codelineno-132-17 name=__codelineno-132-17 href=#__codelineno-132-17></a><span class=w>                        </span>playbook<span class=w> </span><span class=o>[</span>playbook<span class=w> </span>...<span class=o>]</span>
</code></pre></div> <p><strong>位置参数</strong></p> <table> <thead> <tr> <th>参数</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>playbook</td> <td>playbook文件</td> </tr> </tbody> </table> <p><strong>选项参数</strong></p> <table> <thead> <tr> <th>参数</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>--ask-vault-pass</td> <td>提示输入vault 密码。</td> </tr> <tr> <td>--flush-cache</td> <td>清除fact缓存</td> </tr> <tr> <td>--force-handlers</td> <td>如果任务失败，也要运行handlers</td> </tr> <tr> <td>--list-hosts</td> <td>输出匹配主机的列表。</td> </tr> <tr> <td>--list-tags</td> <td>列出所有可用的标签</td> </tr> <tr> <td>--list-tasks</td> <td>列出将要执行的所有任务</td> </tr> <tr> <td>--skip-tags=SKIP_TAGS</td> <td>跳过运行标记此标签的任务</td> </tr> <tr> <td>-start-at-task=START_AT_TASK</td> <td>在此任务处开始运行</td> </tr> <tr> <td>--step</td> <td>一步一步的执行：在运行之前确认每个任务</td> </tr> <tr> <td>--syntax-check</td> <td>对playbook进行语法检查，且不执行playbook。</td> </tr> <tr> <td>--vault-id=VAULT_IDS</td> <td>标识使用的vault id</td> </tr> <tr> <td>--vault-password-file=VAULT_PASSWORD_FILE</td> <td>指定vault密码文件</td> </tr> <tr> <td>--version</td> <td>显示程序版本信息</td> </tr> <tr> <td>-C, --check</td> <td>只是测试一下会改变什么内容，不会真正去执行;相反,试图预测一些可能发生的变化。</td> </tr> <tr> <td>-D, --diff</td> <td>当更改文件和模板时，显示这些文件得差异，比--check效果好。</td> </tr> <tr> <td>-M MODULE_PATH, --module-path MODULE_PATH</td> <td>要执行的模块的路径，默认路径<code>~/.ansible/plugins/modules:/usr/share/ansible/plu&lt;br/&gt; gins/modules)</code></td> </tr> <tr> <td>-e EXTRA_VARS, --extra-vars EXTRA_VARS</td> <td>添加附加变量，比如key=value，yaml，json格式。使用<code>@</code>指定文件</td> </tr> <tr> <td>-f FORKS, --forks FORKS</td> <td>指定定要使用的并行进程数，默认为5个。</td> </tr> <tr> <td>-h, --help</td> <td>显示此帮助信息。</td> </tr> <tr> <td>-i INVENTORY, --inventory INVENTORY, --inventory-file INVENTORY</td> <td>指定主机清单文件或逗号分隔的主机，默认为/etc/ansible/hosts。</td> </tr> <tr> <td>-l SUBSET, --limit SUBSET</td> <td>进一步限制所选主机/组模式，只执行<code>-l</code>后的主机和组。</td> </tr> <tr> <td>-t TAGS, --tags TAGS</td> <td>运行指定的带有tags任务</td> </tr> <tr> <td>-v, --verbose</td> <td>输出执行的详细信息，使用-vvv获得更多，-vvvv 启用连接调试</td> </tr> </tbody> </table> <p><strong>特权升级选项</strong></p> <table> <thead> <tr> <th>参数</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>--become-method=BECOME_METHOD</td> <td>权限升级方法使用 ，默认为sudo，有效选择：[sudo | su | pbrun | pfexec | runas | doas | dzdo]</td> </tr> <tr> <td>--become-user=BECOME_USER</td> <td>使用哪个用户运行，默认为root</td> </tr> <tr> <td>-K, --ask-become-pass</td> <td>提供权限提升密码</td> </tr> <tr> <td>-b, --become</td> <td>运行权限提升</td> </tr> </tbody> </table> <p><strong>连接选项</strong></p> <table> <thead> <tr> <th>参数</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>--private-key=PRIVATE_KEY_FILE, --key-file=PRIVATE_KEY_FILE</td> <td>私钥路径，使用这个文件来验证连接</td> </tr> <tr> <td>--scp-extra-args SCP_EXTRA_ARGS</td> <td>指定额外的参数传递给<code>scp</code> ，例如<code>-l</code></td> </tr> <tr> <td>--sftp-extra-args SFTP_EXTRA_ARGS</td> <td>指定额外的参数传递给<code>sftp</code> ，例如<code>-f</code></td> </tr> <tr> <td>--ssh-common-args SSH_COMMON_ARGS</td> <td>指定要传递给sftp / scp / ssh的通用参数（例如 ProxyCommand）</td> </tr> <tr> <td>--ssh-extra-args SSH_EXTRA_ARGS</td> <td>指定额外的参数传递给<code>ssh</code> ，例如<code>-R</code></td> </tr> <tr> <td>-T TIMEOUT, --timeout=TIMEOUT</td> <td>指定默认超时时间，默认是10S</td> </tr> <tr> <td>-c CONNECTION, --connection=CONNECTION</td> <td>指定连接类型，默认smart</td> </tr> <tr> <td>-k, --ask-pass</td> <td>要求用户输入请求连接密码</td> </tr> <tr> <td>-u REMOTE_USER, --user=REMOTE_USER</td> <td>指定连接用户</td> </tr> </tbody> </table> <p><strong>示例：</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-133-1 name=__codelineno-133-1 href=#__codelineno-133-1></a>ansible-playbook<span class=w> </span>-i<span class=w> </span>hosts<span class=w> </span>ssh-addkey.yml<span class=w>   </span><span class=c1># 指定主机清单文件</span>
<a id=__codelineno-133-2 name=__codelineno-133-2 href=#__codelineno-133-2></a>
<a id=__codelineno-133-3 name=__codelineno-133-3 href=#__codelineno-133-3></a>ansible-playbook<span class=w> </span>-i<span class=w> </span>hosts<span class=w> </span>ssh-addkey.yml<span class=w>  </span>--list-tags<span class=w>   </span><span class=c1># 列出tags</span>
<a id=__codelineno-133-4 name=__codelineno-133-4 href=#__codelineno-133-4></a>
<a id=__codelineno-133-5 name=__codelineno-133-5 href=#__codelineno-133-5></a>ansible-playbook<span class=w> </span>-i<span class=w> </span>hosts<span class=w> </span>ssh-addkey.yml<span class=w>  </span>-t<span class=w> </span>install<span class=w>  </span><span class=c1># 执行install标签的任务</span>
<a id=__codelineno-133-6 name=__codelineno-133-6 href=#__codelineno-133-6></a>
<a id=__codelineno-133-7 name=__codelineno-133-7 href=#__codelineno-133-7></a>ansible-playbook<span class=w> </span>-i<span class=w> </span>hosts<span class=w> </span>ssh-addkey.yml<span class=w>  </span>-t<span class=w> </span>install<span class=w> </span>-e<span class=w> </span><span class=nv>a</span><span class=o>=</span><span class=m>1</span><span class=w>  </span><span class=c1># 指定变量</span>
</code></pre></div> <h3 id=ansible-pull>ansible-pull<a class=headerlink href=#ansible-pull title="Permanent link">&para;</a></h3> <p>pull模式在被配置的机器上运行，速度很快。在这种模式下，你需要提供一个git仓库来供Ansible下载来配置你的机器。</p> <div class=highlight><pre><span></span><code><a id=__codelineno-134-1 name=__codelineno-134-1 href=#__codelineno-134-1></a><span class=c1># ansible-pull --help</span>
<a id=__codelineno-134-2 name=__codelineno-134-2 href=#__codelineno-134-2></a>usage:<span class=w> </span>ansible-pull<span class=w> </span><span class=o>[</span>-h<span class=o>]</span><span class=w> </span><span class=o>[</span>--version<span class=o>]</span><span class=w> </span><span class=o>[</span>-v<span class=o>]</span><span class=w> </span><span class=o>[</span>-k<span class=o>]</span>
<a id=__codelineno-134-3 name=__codelineno-134-3 href=#__codelineno-134-3></a><span class=w>                    </span><span class=o>[</span>--private-key<span class=w> </span>PRIVATE_KEY_FILE<span class=o>]</span><span class=w> </span><span class=o>[</span>-u<span class=w> </span>REMOTE_USER<span class=o>]</span>
<a id=__codelineno-134-4 name=__codelineno-134-4 href=#__codelineno-134-4></a><span class=w>                    </span><span class=o>[</span>-c<span class=w> </span>CONNECTION<span class=o>]</span><span class=w> </span><span class=o>[</span>-T<span class=w> </span>TIMEOUT<span class=o>]</span>
<a id=__codelineno-134-5 name=__codelineno-134-5 href=#__codelineno-134-5></a><span class=w>                    </span><span class=o>[</span>--ssh-common-args<span class=w> </span>SSH_COMMON_ARGS<span class=o>]</span>
<a id=__codelineno-134-6 name=__codelineno-134-6 href=#__codelineno-134-6></a><span class=w>                    </span><span class=o>[</span>--sftp-extra-args<span class=w> </span>SFTP_EXTRA_ARGS<span class=o>]</span>
<a id=__codelineno-134-7 name=__codelineno-134-7 href=#__codelineno-134-7></a><span class=w>                    </span><span class=o>[</span>--scp-extra-args<span class=w> </span>SCP_EXTRA_ARGS<span class=o>]</span>
<a id=__codelineno-134-8 name=__codelineno-134-8 href=#__codelineno-134-8></a><span class=w>                    </span><span class=o>[</span>--ssh-extra-args<span class=w> </span>SSH_EXTRA_ARGS<span class=o>]</span><span class=w> </span><span class=o>[</span>--vault-id<span class=w> </span>VAULT_IDS<span class=o>]</span>
<a id=__codelineno-134-9 name=__codelineno-134-9 href=#__codelineno-134-9></a><span class=w>                    </span><span class=o>[</span>--ask-vault-pass<span class=w> </span><span class=p>|</span><span class=w> </span>--vault-password-file<span class=w> </span>VAULT_PASSWORD_FILES<span class=o>]</span>
<a id=__codelineno-134-10 name=__codelineno-134-10 href=#__codelineno-134-10></a><span class=w>                    </span><span class=o>[</span>-e<span class=w> </span>EXTRA_VARS<span class=o>]</span><span class=w> </span><span class=o>[</span>-t<span class=w> </span>TAGS<span class=o>]</span><span class=w> </span><span class=o>[</span>--skip-tags<span class=w> </span>SKIP_TAGS<span class=o>]</span>
<a id=__codelineno-134-11 name=__codelineno-134-11 href=#__codelineno-134-11></a><span class=w>                    </span><span class=o>[</span>-i<span class=w> </span>INVENTORY<span class=o>]</span><span class=w> </span><span class=o>[</span>--list-hosts<span class=o>]</span><span class=w> </span><span class=o>[</span>-l<span class=w> </span>SUBSET<span class=o>]</span><span class=w> </span><span class=o>[</span>-M<span class=w> </span>MODULE_PATH<span class=o>]</span>
<a id=__codelineno-134-12 name=__codelineno-134-12 href=#__codelineno-134-12></a><span class=w>                    </span><span class=o>[</span>-K<span class=o>]</span><span class=w> </span><span class=o>[</span>--purge<span class=o>]</span><span class=w> </span><span class=o>[</span>-o<span class=o>]</span><span class=w> </span><span class=o>[</span>-s<span class=w> </span>SLEEP<span class=o>]</span><span class=w> </span><span class=o>[</span>-f<span class=o>]</span><span class=w> </span><span class=o>[</span>-d<span class=w> </span>DEST<span class=o>]</span><span class=w> </span><span class=o>[</span>-U<span class=w> </span>URL<span class=o>]</span>
<a id=__codelineno-134-13 name=__codelineno-134-13 href=#__codelineno-134-13></a><span class=w>                    </span><span class=o>[</span>--full<span class=o>]</span><span class=w> </span><span class=o>[</span>-C<span class=w> </span>CHECKOUT<span class=o>]</span><span class=w> </span><span class=o>[</span>--accept-host-key<span class=o>]</span>
<a id=__codelineno-134-14 name=__codelineno-134-14 href=#__codelineno-134-14></a><span class=w>                    </span><span class=o>[</span>-m<span class=w> </span>MODULE_NAME<span class=o>]</span><span class=w> </span><span class=o>[</span>--verify-commit<span class=o>]</span><span class=w> </span><span class=o>[</span>--clean<span class=o>]</span>
<a id=__codelineno-134-15 name=__codelineno-134-15 href=#__codelineno-134-15></a><span class=w>                    </span><span class=o>[</span>--track-subs<span class=o>]</span><span class=w> </span><span class=o>[</span>--check<span class=o>]</span><span class=w> </span><span class=o>[</span>--diff<span class=o>]</span>
<a id=__codelineno-134-16 name=__codelineno-134-16 href=#__codelineno-134-16></a><span class=w>                    </span><span class=o>[</span>playbook.yml<span class=w> </span><span class=o>[</span>playbook.yml<span class=w> </span>...<span class=o>]]</span>
</code></pre></div> <p><strong>位置参数</strong></p> <table> <thead> <tr> <th>参数</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>playbook</td> <td>playbook文件</td> </tr> </tbody> </table> <p><strong>选项参数</strong></p> <table> <thead> <tr> <th>参数</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>--accept-host-key</td> <td>指定仓库的主机秘钥</td> </tr> <tr> <td>--ask-vault-pass</td> <td>提示输入vault 密码。</td> </tr> <tr> <td>--check</td> <td>只做检查，不做更改</td> </tr> <tr> <td>--clean</td> <td>工作存储库中的已修改文件将被删除</td> </tr> <tr> <td>--diff</td> <td>更改（小的）文件和模板时，显示这些文件中的差异</td> </tr> <tr> <td>--full</td> <td>完整克隆</td> </tr> <tr> <td>--list-hosts</td> <td>输出匹配主机列表</td> </tr> <tr> <td>--purge</td> <td>运行后清除</td> </tr> <tr> <td>--skip-tags SKIP_TAGS</td> <td>跳过运行标记此标签的任务</td> </tr> <tr> <td>--track-subs</td> <td>模块将跟踪最新的变化。 这相当于指定--remote标志来git子模块更新</td> </tr> <tr> <td>--vault-id=VAULT_IDS</td> <td>标识使用的vault id</td> </tr> <tr> <td>--vault-password-file=VAULT_PASSWORD_FILE</td> <td>指定vault密码文件</td> </tr> <tr> <td>--verify-commit</td> <td>验证已检出提交的GPG签名，如果失败则中止运行剧本。</td> </tr> <tr> <td>--version</td> <td>显示程序版本信息</td> </tr> <tr> <td>-C CHECKOUT, --checkout=CHECKOUT</td> <td>指定克隆的分支</td> </tr> <tr> <td>-M MODULE_PATH, --module-path MODULE_PATH</td> <td>要执行的模块的路径，默认路径<code>~/.ansible/plugins/modules:/usr/share/ansible/plu&lt;br/&gt; gins/modules)</code></td> </tr> <tr> <td>-U URL, --url URL</td> <td>playbook仓库的地址</td> </tr> <tr> <td>-d DEST, --directory DEST</td> <td>指定检出目录</td> </tr> <tr> <td>-e EXTRA_VARS, --extra-vars EXTRA_VARS</td> <td>添加附加变量，比如key=value，yaml，json格式。使用<code>@</code>指定文件</td> </tr> <tr> <td>-f FORKS, --forks FORKS</td> <td>指定定要使用的并行进程数，默认为5个。</td> </tr> <tr> <td>-h, --help</td> <td>显示此帮助信息。</td> </tr> <tr> <td>-i INVENTORY, --inventory INVENTORY, --inventory-file INVENTORY</td> <td>指定主机清单文件或逗号分隔的主机，默认为/etc/ansible/hosts。</td> </tr> <tr> <td>-l SUBSET, --limit SUBSET</td> <td>进一步限制所选主机/组模式，只执行<code>-l</code>后的主机和组。</td> </tr> <tr> <td>-m MODULE_NAME, --module-name MODULE_NAME</td> <td>仓库模块名称，可选值('git', 'subversion', 'hg', 'bzr')默认为git。</td> </tr> <tr> <td>-o, --only-if-changed</td> <td>当存储库已更新时才运行剧本</td> </tr> <tr> <td>-s SLEEP, --sleep SLEEP</td> <td>指定睡眠时间</td> </tr> <tr> <td>-t TAGS, --tags TAGS</td> <td>运行指定的带有tags任务</td> </tr> <tr> <td>-v, --verbose</td> <td>输出执行的详细信息，使用-vvv获得更多，-vvvv 启用连接调试</td> </tr> </tbody> </table> <p><strong>特权升级选项</strong></p> <table> <thead> <tr> <th>参数</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>-K, --ask-become-pass</td> <td>提供权限提升密码</td> </tr> </tbody> </table> <p><strong>连接选项</strong></p> <table> <thead> <tr> <th>参数</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>--private-key=PRIVATE_KEY_FILE, --key-file=PRIVATE_KEY_FILE</td> <td>私钥路径，使用这个文件来验证连接</td> </tr> <tr> <td>--scp-extra-args SCP_EXTRA_ARGS</td> <td>指定额外的参数传递给<code>scp</code> ，例如<code>-l</code></td> </tr> <tr> <td>--sftp-extra-args SFTP_EXTRA_ARGS</td> <td>指定额外的参数传递给<code>sftp</code> ，例如<code>-f</code></td> </tr> <tr> <td>--ssh-common-args SSH_COMMON_ARGS</td> <td>指定要传递给sftp / scp / ssh的通用参数（例如 ProxyCommand）</td> </tr> <tr> <td>--ssh-extra-args SSH_EXTRA_ARGS</td> <td>指定额外的参数传递给<code>ssh</code> ，例如<code>-R</code></td> </tr> <tr> <td>-T TIMEOUT, --timeout=TIMEOUT</td> <td>指定默认超时时间，默认是10S</td> </tr> <tr> <td>-c CONNECTION, --connection=CONNECTION</td> <td>指定连接类型，默认smart</td> </tr> <tr> <td>-K, --ask-become-pass</td> <td>要求用户输入请求连接密码</td> </tr> <tr> <td>-u REMOTE_USER, --user=REMOTE_USER</td> <td>指定连接用户</td> </tr> </tbody> </table> <p><strong>示例：</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-135-1 name=__codelineno-135-1 href=#__codelineno-135-1></a>ansible-pull<span class=w> </span>-o<span class=w> </span>-C<span class=w> </span>master<span class=w> </span>-d<span class=w> </span>/tmp/pull<span class=w> </span>-i<span class=w> </span>/tmp/pull/hosts<span class=w> </span>-U<span class=w> </span>https://github.com/lework/Ansible-Pull-Example.git
</code></pre></div> <h3 id=ansible-config>ansible-config<a class=headerlink href=#ansible-config title="Permanent link">&para;</a></h3> <p>编辑管理ansible配置</p> <div class=highlight><pre><span></span><code><a id=__codelineno-136-1 name=__codelineno-136-1 href=#__codelineno-136-1></a><span class=c1># ansible-config --help</span>
<a id=__codelineno-136-2 name=__codelineno-136-2 href=#__codelineno-136-2></a>usage:<span class=w> </span>ansible-config<span class=w> </span><span class=o>[</span>-h<span class=o>]</span><span class=w> </span><span class=o>[</span>--version<span class=o>]</span><span class=w> </span><span class=o>[</span>-v<span class=o>]</span><span class=w> </span><span class=o>{</span>list,dump,view<span class=o>}</span><span class=w> </span>...
</code></pre></div> <p><strong>位置参数</strong></p> <table> <thead> <tr> <th>参数</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>list</td> <td>显示所有的参数配置</td> </tr> <tr> <td>dump</td> <td>dump配置</td> </tr> <tr> <td>view</td> <td>查看配置文件</td> </tr> </tbody> </table> <p><strong>选项参数</strong></p> <table> <thead> <tr> <th>参数</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>--version</td> <td>显示程序版本号</td> </tr> <tr> <td>-h, --help</td> <td>显示此帮助信息</td> </tr> <tr> <td>-v, --verbose</td> <td>详细模式（-vvv表示更多，-vvvv表示启用连接调试）</td> </tr> </tbody> </table> <p><strong>示例：</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-137-1 name=__codelineno-137-1 href=#__codelineno-137-1></a>ansible-config<span class=w> </span>view
<a id=__codelineno-137-2 name=__codelineno-137-2 href=#__codelineno-137-2></a>
<a id=__codelineno-137-3 name=__codelineno-137-3 href=#__codelineno-137-3></a>ansible-config<span class=w>  </span>list
<a id=__codelineno-137-4 name=__codelineno-137-4 href=#__codelineno-137-4></a>
<a id=__codelineno-137-5 name=__codelineno-137-5 href=#__codelineno-137-5></a>ansible-config<span class=w>  </span>dump
</code></pre></div> <h3 id=ansible-inventory>ansible-inventory<a class=headerlink href=#ansible-inventory title="Permanent link">&para;</a></h3> <p>查看主机清单信息</p> <div class=highlight><pre><span></span><code><a id=__codelineno-138-1 name=__codelineno-138-1 href=#__codelineno-138-1></a><span class=c1># ansible-inventory --help </span>
<a id=__codelineno-138-2 name=__codelineno-138-2 href=#__codelineno-138-2></a>usage:<span class=w> </span>ansible-inventory<span class=w> </span><span class=o>[</span>-h<span class=o>]</span><span class=w> </span><span class=o>[</span>--version<span class=o>]</span><span class=w> </span><span class=o>[</span>-v<span class=o>]</span><span class=w> </span><span class=o>[</span>-i<span class=w> </span>INVENTORY<span class=o>]</span>
<a id=__codelineno-138-3 name=__codelineno-138-3 href=#__codelineno-138-3></a><span class=w>                         </span><span class=o>[</span>--vault-id<span class=w> </span>VAULT_IDS<span class=o>]</span>
<a id=__codelineno-138-4 name=__codelineno-138-4 href=#__codelineno-138-4></a><span class=w>                         </span><span class=o>[</span>--ask-vault-pass<span class=w> </span><span class=p>|</span><span class=w> </span>--vault-password-file<span class=w> </span>VAULT_PASSWORD_FILES<span class=o>]</span>
<a id=__codelineno-138-5 name=__codelineno-138-5 href=#__codelineno-138-5></a><span class=w>                         </span><span class=o>[</span>--playbook-dir<span class=w> </span>BASEDIR<span class=o>]</span><span class=w> </span><span class=o>[</span>--list<span class=o>]</span><span class=w> </span><span class=o>[</span>--host<span class=w> </span>HOST<span class=o>]</span>
<a id=__codelineno-138-6 name=__codelineno-138-6 href=#__codelineno-138-6></a><span class=w>                         </span><span class=o>[</span>--graph<span class=o>]</span><span class=w> </span><span class=o>[</span>-y<span class=o>]</span><span class=w> </span><span class=o>[</span>--toml<span class=o>]</span><span class=w> </span><span class=o>[</span>--vars<span class=o>]</span><span class=w> </span><span class=o>[</span>--export<span class=o>]</span>
<a id=__codelineno-138-7 name=__codelineno-138-7 href=#__codelineno-138-7></a><span class=w>                         </span><span class=o>[</span>--output<span class=w> </span>OUTPUT_FILE<span class=o>]</span>
<a id=__codelineno-138-8 name=__codelineno-138-8 href=#__codelineno-138-8></a><span class=w>                         </span><span class=o>[</span>host<span class=p>|</span>group<span class=o>]</span>
</code></pre></div> <p><strong>位置参数</strong></p> <table> <thead> <tr> <th>参数</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>host/group</td> <td>主机/主机组</td> </tr> </tbody> </table> <p><strong>选项参数</strong></p> <table> <thead> <tr> <th>参数</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>--accept-host-key</td> <td>指定仓库的主机秘钥</td> </tr> <tr> <td>--export</td> <td>导出信息，与--list或--graph一起使用</td> </tr> <tr> <td>--output OUTPUT_FILE</td> <td>导出信息到文件，与--list或--graph一起使用</td> </tr> <tr> <td>--playbook-dir BASEDIR</td> <td>指定playbook目录，为<code>role</code>,<code>group_vars/etc</code>指定相对路径</td> </tr> <tr> <td>--toml</td> <td>使用toml格式输出,默认是json格式</td> </tr> <tr> <td>--vars</td> <td>输出变量信息，与--list或--graph一起使用</td> </tr> <tr> <td>--vault-id=VAULT_IDS</td> <td>标识使用的vault id</td> </tr> <tr> <td>--vault-password-file=VAULT_PASSWORD_FILE</td> <td>指定vault密码文件</td> </tr> <tr> <td>--version</td> <td>显示程序版本信息</td> </tr> <tr> <td>-h, --help</td> <td>显示此帮助信息。</td> </tr> <tr> <td>-i INVENTORY, --inventory INVENTORY, --inventory-file INVENTORY</td> <td>指定主机清单文件或逗号分隔的主机，默认为/etc/ansible/hosts。</td> </tr> <tr> <td>-v, --verbose</td> <td>输出执行的详细信息，使用-vvv获得更多，-vvvv 启用连接调试</td> </tr> <tr> <td>-y, --yaml</td> <td>使用yaml格式输出,默认是json格式</td> </tr> </tbody> </table> <p><strong>动作选项</strong></p> <table> <thead> <tr> <th>参数</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>--graph</td> <td>创建主机清单图</td> </tr> <tr> <td>--host HOST</td> <td>输出主机清单信息</td> </tr> <tr> <td>--list</td> <td>以json的格式输出所有主机清单信息</td> </tr> </tbody> </table> <p><strong>示例：</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-139-1 name=__codelineno-139-1 href=#__codelineno-139-1></a>ansible-inventory<span class=w> </span>--export<span class=w> </span>--graph
<a id=__codelineno-139-2 name=__codelineno-139-2 href=#__codelineno-139-2></a>
<a id=__codelineno-139-3 name=__codelineno-139-3 href=#__codelineno-139-3></a>ansible-inventory<span class=w> </span>-i<span class=w> </span>/etc/ansible/hosts<span class=w> </span>--export<span class=w> </span>--list
<a id=__codelineno-139-4 name=__codelineno-139-4 href=#__codelineno-139-4></a>
<a id=__codelineno-139-5 name=__codelineno-139-5 href=#__codelineno-139-5></a>ansible-inventory<span class=w> </span>--host<span class=o>=</span><span class=m>192</span>.168.1.100
<a id=__codelineno-139-6 name=__codelineno-139-6 href=#__codelineno-139-6></a>
<a id=__codelineno-139-7 name=__codelineno-139-7 href=#__codelineno-139-7></a>ansible-inventory<span class=w> </span>--vars<span class=w> </span>--list
<a id=__codelineno-139-8 name=__codelineno-139-8 href=#__codelineno-139-8></a><span class=w> </span><span class=sb>```</span>
<a id=__codelineno-139-9 name=__codelineno-139-9 href=#__codelineno-139-9></a>
<a id=__codelineno-139-10 name=__codelineno-139-10 href=#__codelineno-139-10></a>
<a id=__codelineno-139-11 name=__codelineno-139-11 href=#__codelineno-139-11></a>
<a id=__codelineno-139-12 name=__codelineno-139-12 href=#__codelineno-139-12></a><span class=c1>### ansible-vault</span>
<a id=__codelineno-139-13 name=__codelineno-139-13 href=#__codelineno-139-13></a>
<a id=__codelineno-139-14 name=__codelineno-139-14 href=#__codelineno-139-14></a>ansible-vault主要应用于配置文件中含有敏感信息，又不希望他能被人看到，vault可以帮你加密/解密这个配置文件。这种playbook文件在执行时，需要加上<span class=w> </span><span class=sb>`</span>--ask-vault-pass<span class=sb>`</span>参数，同样需要输入密码后才能正常执行。
<a id=__codelineno-139-15 name=__codelineno-139-15 href=#__codelineno-139-15></a>
<a id=__codelineno-139-16 name=__codelineno-139-16 href=#__codelineno-139-16></a><span class=sb>```</span>bash
<a id=__codelineno-139-17 name=__codelineno-139-17 href=#__codelineno-139-17></a><span class=c1># ansible-vault --help</span>
<a id=__codelineno-139-18 name=__codelineno-139-18 href=#__codelineno-139-18></a>usage:<span class=w> </span>ansible-vault<span class=w> </span><span class=o>[</span>-h<span class=o>]</span><span class=w> </span><span class=o>[</span>--version<span class=o>]</span><span class=w> </span><span class=o>[</span>-v<span class=o>]</span>
<a id=__codelineno-139-19 name=__codelineno-139-19 href=#__codelineno-139-19></a><span class=w>                     </span><span class=o>{</span>create,decrypt,edit,view,encrypt,encrypt_string,rekey<span class=o>}</span>
<a id=__codelineno-139-20 name=__codelineno-139-20 href=#__codelineno-139-20></a><span class=w>                     </span>...
</code></pre></div> <p><strong>位置参数</strong></p> <table> <thead> <tr> <th>参数</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>create</td> <td>创建加密文件</td> </tr> <tr> <td>decrypt</td> <td>解密文件</td> </tr> <tr> <td>edit</td> <td>编辑加密文件</td> </tr> <tr> <td>view</td> <td>查看加密文件</td> </tr> <tr> <td>encrypt</td> <td>加密文件</td> </tr> <tr> <td>encrypt_string</td> <td>输出加密字符串</td> </tr> <tr> <td>rekey</td> <td>重新加密文件</td> </tr> </tbody> </table> <p><strong>选项参数</strong></p> <table> <thead> <tr> <th>参数</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>--version</td> <td>显示程序版本号</td> </tr> <tr> <td>-h, --help</td> <td>显示此帮助信息</td> </tr> <tr> <td>-v, --verbose</td> <td>详细模式（-vvv表示更多，-vvvv表示启用连接调试）</td> </tr> </tbody> </table> <p><strong>示例：</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-140-1 name=__codelineno-140-1 href=#__codelineno-140-1></a>ansible-vault<span class=w> </span>create<span class=w> </span><span class=c1># /tmp/123 创建加密文件</span>
<a id=__codelineno-140-2 name=__codelineno-140-2 href=#__codelineno-140-2></a>
<a id=__codelineno-140-3 name=__codelineno-140-3 href=#__codelineno-140-3></a>ansible-vault<span class=w> </span>view<span class=w>  </span><span class=c1># /tmp/123 查看加密文件</span>
<a id=__codelineno-140-4 name=__codelineno-140-4 href=#__codelineno-140-4></a>
<a id=__codelineno-140-5 name=__codelineno-140-5 href=#__codelineno-140-5></a>ansible-vault<span class=w> </span>encrypt<span class=w>  </span><span class=c1># /tmp/abc 加密文件</span>
<a id=__codelineno-140-6 name=__codelineno-140-6 href=#__codelineno-140-6></a>
<a id=__codelineno-140-7 name=__codelineno-140-7 href=#__codelineno-140-7></a>ansible-vault<span class=w> </span>decrypt<span class=w>  </span><span class=c1># /tmp/abc 解密文件</span>
<a id=__codelineno-140-8 name=__codelineno-140-8 href=#__codelineno-140-8></a>
<a id=__codelineno-140-9 name=__codelineno-140-9 href=#__codelineno-140-9></a>ansible-vault<span class=w> </span>edit<span class=w>  </span><span class=c1># /tmp/abc 编辑加密文件</span>
<a id=__codelineno-140-10 name=__codelineno-140-10 href=#__codelineno-140-10></a>
<a id=__codelineno-140-11 name=__codelineno-140-11 href=#__codelineno-140-11></a>ansible-vault<span class=w> </span>encrypt_string<span class=w> </span><span class=s1>&#39;123&#39;</span><span class=w>  </span><span class=c1># 输出加密字符串</span>
</code></pre></div> <h2 id=8使用-playbook>8.使用 Playbook<a class=headerlink href=#8使用-playbook title="Permanent link">&para;</a></h2> <p><strong>Playbook</strong>（剧本） 是 <strong>Ansible</strong> 指令的集合，其利用 YAML 语言编写，自上而下按顺序一次执行。</p> <p>如果Ansible模块是你的车间的工具，那playbook则是你的指导手册，你的主机清单(inventory)是你的原材料。</p> <p>play的主要功能在于将事先归并为一组的主机装扮成事先通过ansible中的task定义好的角色。从根本上来讲所谓task无非是调用ansible的一个module。将多个play组织在一个playbook中即可以让它们联同起来按事先编排的机制同唱一台大戏。其主要有以下四部分构成:</p> <ul> <li> <p>Target section： 定义将要执行 playbook 的远程主机组</p> </li> <li> <p>Variable section： 定义 playbook 运行时需要使用的变量</p> </li> <li> <p>Task section： 定义将要在远程主机上执行的任务列表</p> </li> <li> <p>Handler section： 定义 task 执行完成以后需要调用的任务</p> </li> </ul> <h3 id=playbook-示例>Playbook 示例<a class=headerlink href=#playbook-示例 title="Permanent link">&para;</a></h3> <blockquote> <p>centos7 环境</p> </blockquote> <p>开始书写我们第一个playbook</p> <p><strong>第一步：</strong> 定义我们得主机清单</p> <div class=highlight><pre><span></span><code><a id=__codelineno-141-1 name=__codelineno-141-1 href=#__codelineno-141-1></a><span class=k>[web]</span>
<a id=__codelineno-141-2 name=__codelineno-141-2 href=#__codelineno-141-2></a><span class=na>192.168.77.129 ansible_ssh_pass</span><span class=o>=</span><span class=s>123456</span>
<a id=__codelineno-141-3 name=__codelineno-141-3 href=#__codelineno-141-3></a><span class=na>192.168.77.130 ansible_ssh_pass</span><span class=o>=</span><span class=s>123456</span>
</code></pre></div> <blockquote> <p>注：这里如果做了ssh免密码登陆，可以去掉ansible_ssh_pass</p> </blockquote> <p><strong>第二步：</strong> 明确playbook做哪些任务</p> <p>web组的主机完成下列任务</p> <ol> <li>远程执行用户为root</li> <li>安装httpd</li> <li>apache配置文件实现自定义http端口和客户端连接数</li> <li>在配置文件变更的时候，重启httpd</li> <li>启动httpd，并设置其开机自启动</li> </ol> <p><strong>第三步：</strong> 书写playbook</p> <blockquote> <p>playbook 使用 YAML 标记语言 (see <a href=https://docs.ansible.com/ansible/latest/reference_appendices/YAMLSyntax.html#yaml-syntax>YAML Syntax</a>) 来描述任务的编排</p> </blockquote> <div class=highlight><pre><span></span><code><a id=__codelineno-142-1 name=__codelineno-142-1 href=#__codelineno-142-1></a><span class=nn>---</span>
<a id=__codelineno-142-2 name=__codelineno-142-2 href=#__codelineno-142-2></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>hosts</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">web</span><span class=w>                 </span><span class=c1># Target section</span>
<a id=__codelineno-142-3 name=__codelineno-142-3 href=#__codelineno-142-3></a><span class=w>  </span><span class=nt>remote_user</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">root</span>
<a id=__codelineno-142-4 name=__codelineno-142-4 href=#__codelineno-142-4></a><span class=w>  </span><span class=nt>vars</span><span class=p>:</span><span class=w>                      </span><span class=c1># Variable section</span>
<a id=__codelineno-142-5 name=__codelineno-142-5 href=#__codelineno-142-5></a><span class=w>    </span><span class=nt>http_port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<a id=__codelineno-142-6 name=__codelineno-142-6 href=#__codelineno-142-6></a><span class=w>    </span><span class=nt>max_clients</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">200</span>
<a id=__codelineno-142-7 name=__codelineno-142-7 href=#__codelineno-142-7></a><span class=w>  </span><span class=nt>tasks</span><span class=p>:</span><span class=w>                     </span><span class=c1># Task section</span>
<a id=__codelineno-142-8 name=__codelineno-142-8 href=#__codelineno-142-8></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ensure apache is at the latest version</span>
<a id=__codelineno-142-9 name=__codelineno-142-9 href=#__codelineno-142-9></a><span class=w>    </span><span class=nt>yum</span><span class=p>:</span>
<a id=__codelineno-142-10 name=__codelineno-142-10 href=#__codelineno-142-10></a><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">httpd</span>
<a id=__codelineno-142-11 name=__codelineno-142-11 href=#__codelineno-142-11></a><span class=w>      </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">latest</span>
<a id=__codelineno-142-12 name=__codelineno-142-12 href=#__codelineno-142-12></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">write the apache config file</span>
<a id=__codelineno-142-13 name=__codelineno-142-13 href=#__codelineno-142-13></a><span class=w>    </span><span class=nt>template</span><span class=p>:</span>
<a id=__codelineno-142-14 name=__codelineno-142-14 href=#__codelineno-142-14></a><span class=w>      </span><span class=nt>src</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">httpd.j2</span>
<a id=__codelineno-142-15 name=__codelineno-142-15 href=#__codelineno-142-15></a><span class=w>      </span><span class=nt>dest</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/etc/httpd/conf/httpd.conf</span>
<a id=__codelineno-142-16 name=__codelineno-142-16 href=#__codelineno-142-16></a><span class=w>    </span><span class=nt>notify</span><span class=p>:</span>
<a id=__codelineno-142-17 name=__codelineno-142-17 href=#__codelineno-142-17></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">restart apache</span>
<a id=__codelineno-142-18 name=__codelineno-142-18 href=#__codelineno-142-18></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ensure apache is running</span>
<a id=__codelineno-142-19 name=__codelineno-142-19 href=#__codelineno-142-19></a><span class=w>    </span><span class=nt>service</span><span class=p>:</span>
<a id=__codelineno-142-20 name=__codelineno-142-20 href=#__codelineno-142-20></a><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">httpd</span>
<a id=__codelineno-142-21 name=__codelineno-142-21 href=#__codelineno-142-21></a><span class=w>      </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">started</span>
<a id=__codelineno-142-22 name=__codelineno-142-22 href=#__codelineno-142-22></a><span class=w>  </span><span class=nt>handlers</span><span class=p>:</span><span class=w>                 </span><span class=c1># Handler section</span>
<a id=__codelineno-142-23 name=__codelineno-142-23 href=#__codelineno-142-23></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">restart apache</span>
<a id=__codelineno-142-24 name=__codelineno-142-24 href=#__codelineno-142-24></a><span class=w>      </span><span class=nt>service</span><span class=p>:</span>
<a id=__codelineno-142-25 name=__codelineno-142-25 href=#__codelineno-142-25></a><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">httpd</span>
<a id=__codelineno-142-26 name=__codelineno-142-26 href=#__codelineno-142-26></a><span class=w>        </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">restarted</span>
</code></pre></div> <blockquote> <p><code>remote_user</code> <code>vars</code> 等等这些都是ansible的playbook对象的关键字, 全部可用的关键字列表见 <a href=/basic/Reference/Keywords/ >Ansible 关键字</a></p> </blockquote> <p>当前目录下的 <code>httpd.j2</code> 文件内容</p> <div class=highlight><pre><span></span><code><a id=__codelineno-143-1 name=__codelineno-143-1 href=#__codelineno-143-1></a>ServerRoot &quot;/etc/httpd&quot;
<a id=__codelineno-143-2 name=__codelineno-143-2 href=#__codelineno-143-2></a>Listen {{ http_port }}
<a id=__codelineno-143-3 name=__codelineno-143-3 href=#__codelineno-143-3></a>
<a id=__codelineno-143-4 name=__codelineno-143-4 href=#__codelineno-143-4></a>Include conf.modules.d/*.conf
<a id=__codelineno-143-5 name=__codelineno-143-5 href=#__codelineno-143-5></a>
<a id=__codelineno-143-6 name=__codelineno-143-6 href=#__codelineno-143-6></a>User apache
<a id=__codelineno-143-7 name=__codelineno-143-7 href=#__codelineno-143-7></a>Group apache
<a id=__codelineno-143-8 name=__codelineno-143-8 href=#__codelineno-143-8></a>
<a id=__codelineno-143-9 name=__codelineno-143-9 href=#__codelineno-143-9></a>ServerAdmin root@localhost
<a id=__codelineno-143-10 name=__codelineno-143-10 href=#__codelineno-143-10></a>
<a id=__codelineno-143-11 name=__codelineno-143-11 href=#__codelineno-143-11></a>&lt;Directory /&gt;
<a id=__codelineno-143-12 name=__codelineno-143-12 href=#__codelineno-143-12></a>    AllowOverride none
<a id=__codelineno-143-13 name=__codelineno-143-13 href=#__codelineno-143-13></a>    Require all denied
<a id=__codelineno-143-14 name=__codelineno-143-14 href=#__codelineno-143-14></a>&lt;/Directory&gt;
<a id=__codelineno-143-15 name=__codelineno-143-15 href=#__codelineno-143-15></a>
<a id=__codelineno-143-16 name=__codelineno-143-16 href=#__codelineno-143-16></a>DocumentRoot &quot;/var/www/html&quot;
<a id=__codelineno-143-17 name=__codelineno-143-17 href=#__codelineno-143-17></a>
<a id=__codelineno-143-18 name=__codelineno-143-18 href=#__codelineno-143-18></a>&lt;Directory &quot;/var/www&quot;&gt;
<a id=__codelineno-143-19 name=__codelineno-143-19 href=#__codelineno-143-19></a>    AllowOverride None
<a id=__codelineno-143-20 name=__codelineno-143-20 href=#__codelineno-143-20></a>    Require all granted
<a id=__codelineno-143-21 name=__codelineno-143-21 href=#__codelineno-143-21></a>&lt;/Directory&gt;
<a id=__codelineno-143-22 name=__codelineno-143-22 href=#__codelineno-143-22></a>
<a id=__codelineno-143-23 name=__codelineno-143-23 href=#__codelineno-143-23></a>&lt;Directory &quot;/var/www/html&quot;&gt;
<a id=__codelineno-143-24 name=__codelineno-143-24 href=#__codelineno-143-24></a>    Options Indexes FollowSymLinks
<a id=__codelineno-143-25 name=__codelineno-143-25 href=#__codelineno-143-25></a>    AllowOverride None
<a id=__codelineno-143-26 name=__codelineno-143-26 href=#__codelineno-143-26></a>    Require all granted
<a id=__codelineno-143-27 name=__codelineno-143-27 href=#__codelineno-143-27></a>&lt;/Directory&gt;
<a id=__codelineno-143-28 name=__codelineno-143-28 href=#__codelineno-143-28></a>
<a id=__codelineno-143-29 name=__codelineno-143-29 href=#__codelineno-143-29></a>&lt;IfModule dir_module&gt;
<a id=__codelineno-143-30 name=__codelineno-143-30 href=#__codelineno-143-30></a>    DirectoryIndex index.html
<a id=__codelineno-143-31 name=__codelineno-143-31 href=#__codelineno-143-31></a>&lt;/IfModule&gt;
<a id=__codelineno-143-32 name=__codelineno-143-32 href=#__codelineno-143-32></a>
<a id=__codelineno-143-33 name=__codelineno-143-33 href=#__codelineno-143-33></a>&lt;Files &quot;.ht*&quot;&gt;
<a id=__codelineno-143-34 name=__codelineno-143-34 href=#__codelineno-143-34></a>    Require all denied
<a id=__codelineno-143-35 name=__codelineno-143-35 href=#__codelineno-143-35></a>&lt;/Files&gt;
<a id=__codelineno-143-36 name=__codelineno-143-36 href=#__codelineno-143-36></a>
<a id=__codelineno-143-37 name=__codelineno-143-37 href=#__codelineno-143-37></a>ErrorLog &quot;logs/error_log&quot;
<a id=__codelineno-143-38 name=__codelineno-143-38 href=#__codelineno-143-38></a>LogLevel warn
<a id=__codelineno-143-39 name=__codelineno-143-39 href=#__codelineno-143-39></a>
<a id=__codelineno-143-40 name=__codelineno-143-40 href=#__codelineno-143-40></a>&lt;IfModule log_config_module&gt;
<a id=__codelineno-143-41 name=__codelineno-143-41 href=#__codelineno-143-41></a>    LogFormat &quot;%h %l %u %t \&quot;%r\&quot; %&gt;s %b \&quot;%{Referer}i\&quot; \&quot;%{User-Agent}i\&quot;&quot; combined
<a id=__codelineno-143-42 name=__codelineno-143-42 href=#__codelineno-143-42></a>    LogFormat &quot;%h %l %u %t \&quot;%r\&quot; %&gt;s %b&quot; common
<a id=__codelineno-143-43 name=__codelineno-143-43 href=#__codelineno-143-43></a>    &lt;IfModule logio_module&gt;
<a id=__codelineno-143-44 name=__codelineno-143-44 href=#__codelineno-143-44></a>      LogFormat &quot;%h %l %u %t \&quot;%r\&quot; %&gt;s %b \&quot;%{Referer}i\&quot; \&quot;%{User-Agent}i\&quot; %I %O&quot; combinedio
<a id=__codelineno-143-45 name=__codelineno-143-45 href=#__codelineno-143-45></a>    &lt;/IfModule&gt;
<a id=__codelineno-143-46 name=__codelineno-143-46 href=#__codelineno-143-46></a>    CustomLog &quot;logs/access_log&quot; combined
<a id=__codelineno-143-47 name=__codelineno-143-47 href=#__codelineno-143-47></a>&lt;/IfModule&gt;
<a id=__codelineno-143-48 name=__codelineno-143-48 href=#__codelineno-143-48></a>
<a id=__codelineno-143-49 name=__codelineno-143-49 href=#__codelineno-143-49></a>&lt;IfModule alias_module&gt;
<a id=__codelineno-143-50 name=__codelineno-143-50 href=#__codelineno-143-50></a>    ScriptAlias /cgi-bin/ &quot;/var/www/cgi-bin/&quot;
<a id=__codelineno-143-51 name=__codelineno-143-51 href=#__codelineno-143-51></a>&lt;/IfModule&gt;
<a id=__codelineno-143-52 name=__codelineno-143-52 href=#__codelineno-143-52></a>
<a id=__codelineno-143-53 name=__codelineno-143-53 href=#__codelineno-143-53></a>&lt;Directory &quot;/var/www/cgi-bin&quot;&gt;
<a id=__codelineno-143-54 name=__codelineno-143-54 href=#__codelineno-143-54></a>    AllowOverride None
<a id=__codelineno-143-55 name=__codelineno-143-55 href=#__codelineno-143-55></a>    Options None
<a id=__codelineno-143-56 name=__codelineno-143-56 href=#__codelineno-143-56></a>    Require all granted
<a id=__codelineno-143-57 name=__codelineno-143-57 href=#__codelineno-143-57></a>&lt;/Directory&gt;
<a id=__codelineno-143-58 name=__codelineno-143-58 href=#__codelineno-143-58></a>
<a id=__codelineno-143-59 name=__codelineno-143-59 href=#__codelineno-143-59></a>&lt;IfModule mime_module&gt;
<a id=__codelineno-143-60 name=__codelineno-143-60 href=#__codelineno-143-60></a>    TypesConfig /etc/mime.types
<a id=__codelineno-143-61 name=__codelineno-143-61 href=#__codelineno-143-61></a>    AddType application/x-compress .Z
<a id=__codelineno-143-62 name=__codelineno-143-62 href=#__codelineno-143-62></a>    AddType application/x-gzip .gz .tgz
<a id=__codelineno-143-63 name=__codelineno-143-63 href=#__codelineno-143-63></a>    AddType text/html .shtml
<a id=__codelineno-143-64 name=__codelineno-143-64 href=#__codelineno-143-64></a>    AddOutputFilter INCLUDES .shtml
<a id=__codelineno-143-65 name=__codelineno-143-65 href=#__codelineno-143-65></a>&lt;/IfModule&gt;
<a id=__codelineno-143-66 name=__codelineno-143-66 href=#__codelineno-143-66></a>
<a id=__codelineno-143-67 name=__codelineno-143-67 href=#__codelineno-143-67></a>AddDefaultCharset UTF-8
<a id=__codelineno-143-68 name=__codelineno-143-68 href=#__codelineno-143-68></a>&lt;IfModule mime_magic_module&gt;
<a id=__codelineno-143-69 name=__codelineno-143-69 href=#__codelineno-143-69></a>    MIMEMagicFile conf/magic
<a id=__codelineno-143-70 name=__codelineno-143-70 href=#__codelineno-143-70></a>&lt;/IfModule&gt;
<a id=__codelineno-143-71 name=__codelineno-143-71 href=#__codelineno-143-71></a>
<a id=__codelineno-143-72 name=__codelineno-143-72 href=#__codelineno-143-72></a>&lt;IfModule mpm_prefork_module&gt;
<a id=__codelineno-143-73 name=__codelineno-143-73 href=#__codelineno-143-73></a>    ServerLimit        256
<a id=__codelineno-143-74 name=__codelineno-143-74 href=#__codelineno-143-74></a>    StartServers         5
<a id=__codelineno-143-75 name=__codelineno-143-75 href=#__codelineno-143-75></a>    MinSpareServers      5
<a id=__codelineno-143-76 name=__codelineno-143-76 href=#__codelineno-143-76></a>    MaxSpareServers     10
<a id=__codelineno-143-77 name=__codelineno-143-77 href=#__codelineno-143-77></a>    MaxClients          {{ max_clients }}
<a id=__codelineno-143-78 name=__codelineno-143-78 href=#__codelineno-143-78></a>    MaxRequestsPerChild  0
<a id=__codelineno-143-79 name=__codelineno-143-79 href=#__codelineno-143-79></a>&lt;/IfModule&gt;
<a id=__codelineno-143-80 name=__codelineno-143-80 href=#__codelineno-143-80></a>
<a id=__codelineno-143-81 name=__codelineno-143-81 href=#__codelineno-143-81></a>EnableSendfile on
<a id=__codelineno-143-82 name=__codelineno-143-82 href=#__codelineno-143-82></a>IncludeOptional conf.d/*.conf
</code></pre></div> <p>题外：一个playbook文件可以拥有多个play, 比如我们在加一个<code>databases</code>组的数据库安装操作</p> <div class=highlight><pre><span></span><code><a id=__codelineno-144-1 name=__codelineno-144-1 href=#__codelineno-144-1></a><span class=nn>---</span>
<a id=__codelineno-144-2 name=__codelineno-144-2 href=#__codelineno-144-2></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>hosts</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">webservers</span>
<a id=__codelineno-144-3 name=__codelineno-144-3 href=#__codelineno-144-3></a><span class=w>  </span><span class=nt>remote_user</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">root</span>
<a id=__codelineno-144-4 name=__codelineno-144-4 href=#__codelineno-144-4></a>
<a id=__codelineno-144-5 name=__codelineno-144-5 href=#__codelineno-144-5></a><span class=w>  </span><span class=nt>tasks</span><span class=p>:</span>
<a id=__codelineno-144-6 name=__codelineno-144-6 href=#__codelineno-144-6></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ensure apache is at the latest version</span>
<a id=__codelineno-144-7 name=__codelineno-144-7 href=#__codelineno-144-7></a><span class=w>    </span><span class=nt>yum</span><span class=p>:</span>
<a id=__codelineno-144-8 name=__codelineno-144-8 href=#__codelineno-144-8></a><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">httpd</span>
<a id=__codelineno-144-9 name=__codelineno-144-9 href=#__codelineno-144-9></a><span class=w>      </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">latest</span>
<a id=__codelineno-144-10 name=__codelineno-144-10 href=#__codelineno-144-10></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">write the apache config file</span>
<a id=__codelineno-144-11 name=__codelineno-144-11 href=#__codelineno-144-11></a><span class=w>    </span><span class=nt>template</span><span class=p>:</span>
<a id=__codelineno-144-12 name=__codelineno-144-12 href=#__codelineno-144-12></a><span class=w>      </span><span class=nt>src</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">httpd.j2</span>
<a id=__codelineno-144-13 name=__codelineno-144-13 href=#__codelineno-144-13></a><span class=w>      </span><span class=nt>dest</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/etc/httpd/conf/httpd.conf</span>
<a id=__codelineno-144-14 name=__codelineno-144-14 href=#__codelineno-144-14></a>
<a id=__codelineno-144-15 name=__codelineno-144-15 href=#__codelineno-144-15></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>hosts</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">databases</span>
<a id=__codelineno-144-16 name=__codelineno-144-16 href=#__codelineno-144-16></a><span class=w>  </span><span class=nt>remote_user</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">root</span>
<a id=__codelineno-144-17 name=__codelineno-144-17 href=#__codelineno-144-17></a>
<a id=__codelineno-144-18 name=__codelineno-144-18 href=#__codelineno-144-18></a><span class=w>  </span><span class=nt>tasks</span><span class=p>:</span>
<a id=__codelineno-144-19 name=__codelineno-144-19 href=#__codelineno-144-19></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ensure postgresql is at the latest version</span>
<a id=__codelineno-144-20 name=__codelineno-144-20 href=#__codelineno-144-20></a><span class=w>    </span><span class=nt>yum</span><span class=p>:</span>
<a id=__codelineno-144-21 name=__codelineno-144-21 href=#__codelineno-144-21></a><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">postgresql</span>
<a id=__codelineno-144-22 name=__codelineno-144-22 href=#__codelineno-144-22></a><span class=w>      </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">latest</span>
<a id=__codelineno-144-23 name=__codelineno-144-23 href=#__codelineno-144-23></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ensure that postgresql is started</span>
<a id=__codelineno-144-24 name=__codelineno-144-24 href=#__codelineno-144-24></a><span class=w>    </span><span class=nt>service</span><span class=p>:</span>
<a id=__codelineno-144-25 name=__codelineno-144-25 href=#__codelineno-144-25></a><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">postgresql</span>
<a id=__codelineno-144-26 name=__codelineno-144-26 href=#__codelineno-144-26></a><span class=w>      </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">started</span>
</code></pre></div> <p><strong>第四步：</strong> 运行playbok</p> <div class=highlight><pre><span></span><code><a id=__codelineno-145-1 name=__codelineno-145-1 href=#__codelineno-145-1></a>ansible-playbook<span class=w> </span>-i<span class=w> </span>hosts<span class=w> </span>test.yml
</code></pre></div> <div class="admonition note"> <p class=admonition-title>注：还有一种运行方式</p> <p>在yml文件头部加入</p> <div class=highlight><pre><span></span><code><a id=__codelineno-146-1 name=__codelineno-146-1 href=#__codelineno-146-1></a>#!/bin/env ansible-playbook
</code></pre></div> <p>在给yml文件执行权限</p> <div class=highlight><pre><span></span><code><a id=__codelineno-147-1 name=__codelineno-147-1 href=#__codelineno-147-1></a>chmod<span class=w> </span>+x<span class=w> </span>t.yml
</code></pre></div> <p>运行playbook</p> <div class=highlight><pre><span></span><code><a id=__codelineno-148-1 name=__codelineno-148-1 href=#__codelineno-148-1></a>./t.yml
</code></pre></div> </div> <h3 id=主机和用户>主机和用户<a class=headerlink href=#主机和用户 title="Permanent link">&para;</a></h3> <p>对于每个playbok的play,都会有一个主机和远程用户来确定哪些主机为目标</p> <div class=highlight><pre><span></span><code><a id=__codelineno-149-1 name=__codelineno-149-1 href=#__codelineno-149-1></a><span class=nn>---</span>
<a id=__codelineno-149-2 name=__codelineno-149-2 href=#__codelineno-149-2></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>hosts</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">webservers</span>
<a id=__codelineno-149-3 name=__codelineno-149-3 href=#__codelineno-149-3></a><span class=w>  </span><span class=nt>remote_user</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">root</span>
</code></pre></div> <p><code>hosts</code> 定义了主机清单的<code>patterns</code> 来确定哪些主机为执行目标。<code>remote_user</code>指定执行目标主机的执行用户。</p> <p><code>remote_user</code> 也可以为每个<code>task</code>设置</p> <div class=highlight><pre><span></span><code><a id=__codelineno-150-1 name=__codelineno-150-1 href=#__codelineno-150-1></a><span class=nn>---</span>
<a id=__codelineno-150-2 name=__codelineno-150-2 href=#__codelineno-150-2></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>hosts</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">webservers</span>
<a id=__codelineno-150-3 name=__codelineno-150-3 href=#__codelineno-150-3></a><span class=w>  </span><span class=nt>remote_user</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">root</span>
<a id=__codelineno-150-4 name=__codelineno-150-4 href=#__codelineno-150-4></a><span class=w>  </span><span class=nt>tasks</span><span class=p>:</span>
<a id=__codelineno-150-5 name=__codelineno-150-5 href=#__codelineno-150-5></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">test connection</span>
<a id=__codelineno-150-6 name=__codelineno-150-6 href=#__codelineno-150-6></a><span class=w>      </span><span class=nt>ping</span><span class=p>:</span>
<a id=__codelineno-150-7 name=__codelineno-150-7 href=#__codelineno-150-7></a><span class=w>      </span><span class=nt>remote_user</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">yourname</span>
</code></pre></div> <p>如果你想要为执行提升权限，可以设置<code>become</code>提权参数</p> <div class=highlight><pre><span></span><code><a id=__codelineno-151-1 name=__codelineno-151-1 href=#__codelineno-151-1></a><span class=nn>---</span>
<a id=__codelineno-151-2 name=__codelineno-151-2 href=#__codelineno-151-2></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>hosts</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">webservers</span>
<a id=__codelineno-151-3 name=__codelineno-151-3 href=#__codelineno-151-3></a><span class=w>  </span><span class=nt>remote_user</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">yourname</span>
<a id=__codelineno-151-4 name=__codelineno-151-4 href=#__codelineno-151-4></a><span class=w>  </span><span class=nt>become</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
</code></pre></div> <p>当然，你也可以为每个<code>task</code>设置</p> <div class=highlight><pre><span></span><code><a id=__codelineno-152-1 name=__codelineno-152-1 href=#__codelineno-152-1></a><span class=nn>---</span>
<a id=__codelineno-152-2 name=__codelineno-152-2 href=#__codelineno-152-2></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>hosts</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">webservers</span>
<a id=__codelineno-152-3 name=__codelineno-152-3 href=#__codelineno-152-3></a><span class=w>  </span><span class=nt>remote_user</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">yourname</span>
<a id=__codelineno-152-4 name=__codelineno-152-4 href=#__codelineno-152-4></a><span class=w>  </span><span class=nt>tasks</span><span class=p>:</span>
<a id=__codelineno-152-5 name=__codelineno-152-5 href=#__codelineno-152-5></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>service</span><span class=p>:</span>
<a id=__codelineno-152-6 name=__codelineno-152-6 href=#__codelineno-152-6></a><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<a id=__codelineno-152-7 name=__codelineno-152-7 href=#__codelineno-152-7></a><span class=w>        </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">started</span>
<a id=__codelineno-152-8 name=__codelineno-152-8 href=#__codelineno-152-8></a><span class=w>      </span><span class=nt>become</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<a id=__codelineno-152-9 name=__codelineno-152-9 href=#__codelineno-152-9></a><span class=w>      </span><span class=nt>become_user</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">root</span>
<a id=__codelineno-152-10 name=__codelineno-152-10 href=#__codelineno-152-10></a><span class=w>      </span><span class=nt>become_method</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">sudo</span>
</code></pre></div> <p>become 相关参数</p> <ul> <li> <p><code>become</code>是否开启提权 </p> </li> <li> <p><code>become_method</code> 指定提升方式</p> </li> <li> <p><code>become_user</code> 指定提升用户</p> </li> <li><code>become_flags</code> 提权命令的参数</li> </ul> <h4 id=主机的执行顺序>主机的执行顺序<a class=headerlink href=#主机的执行顺序 title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><a id=__codelineno-153-1 name=__codelineno-153-1 href=#__codelineno-153-1></a><span class=nn>---</span>
<a id=__codelineno-153-2 name=__codelineno-153-2 href=#__codelineno-153-2></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">exec order</span>
<a id=__codelineno-153-3 name=__codelineno-153-3 href=#__codelineno-153-3></a><span class=w>  </span><span class=nt>hosts</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
<a id=__codelineno-153-4 name=__codelineno-153-4 href=#__codelineno-153-4></a><span class=w>  </span><span class=nt>order</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">sorted</span>
<a id=__codelineno-153-5 name=__codelineno-153-5 href=#__codelineno-153-5></a><span class=w>  </span><span class=nt>gather_facts</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
<a id=__codelineno-153-6 name=__codelineno-153-6 href=#__codelineno-153-6></a><span class=w>  </span><span class=nt>tasks</span><span class=p>:</span>
<a id=__codelineno-153-7 name=__codelineno-153-7 href=#__codelineno-153-7></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>debug</span><span class=p>:</span>
<a id=__codelineno-153-8 name=__codelineno-153-8 href=#__codelineno-153-8></a><span class=w>        </span><span class=nt>var</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">inventory_hostname</span>
</code></pre></div> <blockquote> <p><code>play</code> 也可以加上<code>name</code>来标识名称, <code>gather_facts</code> 定义不获取主机fact数据</p> </blockquote> <p><code>order</code> 参数可以控制主机的 <strong>运行顺序</strong>， 默认是<code>inventory</code> 按主机清单的从上到下顺序依次执行，其他的可选值如下表：</p> <table> <thead> <tr> <th>可选值</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>inventory</td> <td>默认值，按主机清单的从上到下顺序依次执行</td> </tr> <tr> <td>reverse_inventory</td> <td>按主机清单的从下到上顺序依次执行</td> </tr> <tr> <td>sorted</td> <td>以主机名称按字母顺序排序</td> </tr> <tr> <td>reverse_sorted</td> <td>以主机名称按字母顺序反序排序</td> </tr> <tr> <td>shuffle</td> <td>随机排序</td> </tr> </tbody> </table> <h3 id=任务列表>任务列表<a class=headerlink href=#任务列表 title="Permanent link">&para;</a></h3> <p>每个play包含一组任务列表， 任务之间是按照从上往下顺序执行的，执行完上一个任务再去执行下一个任务。</p> <p>运行从上到下运行的剧本时，任务失败的主机将从整个剧本的轮换中删除。 如果失败，只需更正剧本文件并重新运行即可。</p> <p>每个任务(task)的目标是执行带有特定参数的模块。 变量可以在模块的参数中使用。</p> <p>模块应该是幂等的，也就是说，在一个序列中多次运行一个模块应该与只运行它一次具有相同的效果。实现幂等性的一种方法是让一个模块检查它所期望的最终状态是否已经实现，如果已经实现，则退出而不执行任何操作。如果playbook使用的所有模块都是幂等的，那么playbook本身可能也是幂等的，所以重新运行playbook应该是安全的。</p> <p>每个任务都应该有一个名称(names)，它包含在运行剧本的输出中。这是人类可读的输出，因此提供每个任务步骤的良好描述非常有用。但是，如果没有提供名称，那么将使用提供给 ‘action’ 的字符串作为输出。</p> <p>任务示例</p> <div class=highlight><pre><span></span><code><a id=__codelineno-154-1 name=__codelineno-154-1 href=#__codelineno-154-1></a><span class=nt>tasks</span><span class=p>:</span>
<a id=__codelineno-154-2 name=__codelineno-154-2 href=#__codelineno-154-2></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">make sure apache is running</span>
<a id=__codelineno-154-3 name=__codelineno-154-3 href=#__codelineno-154-3></a><span class=w>    </span><span class=nt>service</span><span class=p>:</span>
<a id=__codelineno-154-4 name=__codelineno-154-4 href=#__codelineno-154-4></a><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">httpd</span>
<a id=__codelineno-154-5 name=__codelineno-154-5 href=#__codelineno-154-5></a><span class=w>      </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">started</span>
</code></pre></div> <p>也可以使用<code>key=value</code>的形式表示模块参数</p> <div class=highlight><pre><span></span><code><a id=__codelineno-155-1 name=__codelineno-155-1 href=#__codelineno-155-1></a><span class=nt>tasks</span><span class=p>:</span>
<a id=__codelineno-155-2 name=__codelineno-155-2 href=#__codelineno-155-2></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">make sure apache is running</span>
<a id=__codelineno-155-3 name=__codelineno-155-3 href=#__codelineno-155-3></a><span class=w>    </span><span class=nt>service</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">name=httpd state=started</span>
</code></pre></div> <p><code>command</code>和<code>shell</code>模块只有一组参数，可以直接写在模块后面</p> <div class=highlight><pre><span></span><code><a id=__codelineno-156-1 name=__codelineno-156-1 href=#__codelineno-156-1></a><span class=nt>tasks</span><span class=p>:</span>
<a id=__codelineno-156-2 name=__codelineno-156-2 href=#__codelineno-156-2></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">enable selinux</span>
<a id=__codelineno-156-3 name=__codelineno-156-3 href=#__codelineno-156-3></a><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/sbin/setenforce 1</span>
<a id=__codelineno-156-4 name=__codelineno-156-4 href=#__codelineno-156-4></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">run this command and ignore the result</span>
<a id=__codelineno-156-5 name=__codelineno-156-5 href=#__codelineno-156-5></a><span class=w>    </span><span class=nt>shell</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/usr/bin/somecommand || /bin/true</span>
</code></pre></div> <p>如果想忽略模块的执行错误，可以为模块添加<code>ignore_errors</code></p> <div class=highlight><pre><span></span><code><a id=__codelineno-157-1 name=__codelineno-157-1 href=#__codelineno-157-1></a><span class=nt>tasks</span><span class=p>:</span>
<a id=__codelineno-157-2 name=__codelineno-157-2 href=#__codelineno-157-2></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">run this command and ignore the result</span>
<a id=__codelineno-157-3 name=__codelineno-157-3 href=#__codelineno-157-3></a><span class=w>    </span><span class=nt>shell</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/usr/bin/somecommand</span>
<a id=__codelineno-157-4 name=__codelineno-157-4 href=#__codelineno-157-4></a><span class=w>    </span><span class=nt>ignore_errors</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
</code></pre></div> <p>如果行太长了，可以换行缩进表示</p> <div class=highlight><pre><span></span><code><a id=__codelineno-158-1 name=__codelineno-158-1 href=#__codelineno-158-1></a><span class=nt>tasks</span><span class=p>:</span>
<a id=__codelineno-158-2 name=__codelineno-158-2 href=#__codelineno-158-2></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Copy ansible inventory file to client</span>
<a id=__codelineno-158-3 name=__codelineno-158-3 href=#__codelineno-158-3></a><span class=w>    </span><span class=nt>copy</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">src=/etc/ansible/hosts dest=/etc/ansible/hosts</span>
<a id=__codelineno-158-4 name=__codelineno-158-4 href=#__codelineno-158-4></a><span class=w>            </span><span class="l l-Scalar l-Scalar-Plain">owner=root group=root mode=0644</span>
</code></pre></div> <p>也可以使用变量<code>vhost</code></p> <div class=highlight><pre><span></span><code><a id=__codelineno-159-1 name=__codelineno-159-1 href=#__codelineno-159-1></a><span class=nt>tasks</span><span class=p>:</span>
<a id=__codelineno-159-2 name=__codelineno-159-2 href=#__codelineno-159-2></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">create a virtual host file for {{ vhost }}</span>
<a id=__codelineno-159-3 name=__codelineno-159-3 href=#__codelineno-159-3></a><span class=w>    </span><span class=nt>template</span><span class=p>:</span>
<a id=__codelineno-159-4 name=__codelineno-159-4 href=#__codelineno-159-4></a><span class=w>      </span><span class=nt>src</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">somefile.j2</span>
<a id=__codelineno-159-5 name=__codelineno-159-5 href=#__codelineno-159-5></a><span class=w>      </span><span class=nt>dest</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/etc/httpd/conf.d/{{ vhost }}</span>
</code></pre></div> <p>task还有一种古老的标记方法，不建议使用这类形式来标记任务。</p> <div class=highlight><pre><span></span><code><a id=__codelineno-160-1 name=__codelineno-160-1 href=#__codelineno-160-1></a><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">template src=templates/foo.j2 dest=/etc/foo.conf</span>
</code></pre></div> <h3 id=事件处理handlers>事件处理Handlers<a class=headerlink href=#事件处理handlers title="Permanent link">&para;</a></h3> <p>这些<code>notify</code>动作在play中每个任务块结束时触发，并且即使由多个不同的任务通知，也只会触发一次。</p> <div class=highlight><pre><span></span><code><a id=__codelineno-161-1 name=__codelineno-161-1 href=#__codelineno-161-1></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">template configuration file</span>
<a id=__codelineno-161-2 name=__codelineno-161-2 href=#__codelineno-161-2></a><span class=w>  </span><span class=nt>template</span><span class=p>:</span>
<a id=__codelineno-161-3 name=__codelineno-161-3 href=#__codelineno-161-3></a><span class=w>    </span><span class=nt>src</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">template.j2</span>
<a id=__codelineno-161-4 name=__codelineno-161-4 href=#__codelineno-161-4></a><span class=w>    </span><span class=nt>dest</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/etc/foo.conf</span>
<a id=__codelineno-161-5 name=__codelineno-161-5 href=#__codelineno-161-5></a><span class=w>  </span><span class=nt>notify</span><span class=p>:</span>
<a id=__codelineno-161-6 name=__codelineno-161-6 href=#__codelineno-161-6></a><span class=w>     </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">restart memcached</span>
<a id=__codelineno-161-7 name=__codelineno-161-7 href=#__codelineno-161-7></a><span class=w>     </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">restart apache</span>
</code></pre></div> <blockquote> <p><code>notify</code> 定义的时handlers里的任务名称列表</p> </blockquote> <p>Handlers 也是任务列表，与常规任务没有什么不同，它们由全局惟一的名称引用，并由<code>notify</code>动作通知。如果没有通知处理程序，它将不会运行。不管有多少任务通知一个处理程序，它都将只运行一次，即在一个特定<code>play</code>中的所有任务完成之后。</p> <div class=highlight><pre><span></span><code><a id=__codelineno-162-1 name=__codelineno-162-1 href=#__codelineno-162-1></a><span class=nt>handlers</span><span class=p>:</span>
<a id=__codelineno-162-2 name=__codelineno-162-2 href=#__codelineno-162-2></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">restart memcached</span>
<a id=__codelineno-162-3 name=__codelineno-162-3 href=#__codelineno-162-3></a><span class=w>    </span><span class=nt>service</span><span class=p>:</span>
<a id=__codelineno-162-4 name=__codelineno-162-4 href=#__codelineno-162-4></a><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">memcached</span>
<a id=__codelineno-162-5 name=__codelineno-162-5 href=#__codelineno-162-5></a><span class=w>      </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">restarted</span>
<a id=__codelineno-162-6 name=__codelineno-162-6 href=#__codelineno-162-6></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">restart apache</span>
<a id=__codelineno-162-7 name=__codelineno-162-7 href=#__codelineno-162-7></a><span class=w>    </span><span class=nt>service</span><span class=p>:</span>
<a id=__codelineno-162-8 name=__codelineno-162-8 href=#__codelineno-162-8></a><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">apache</span>
<a id=__codelineno-162-9 name=__codelineno-162-9 href=#__codelineno-162-9></a><span class=w>      </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">restarted</span>
</code></pre></div> <p>Handlers 里的任务名称 <strong>不能使用</strong> 变量</p> <p>在 ansible 2.2之后，handlers 支持<code>listen</code> 来实现监听一个通知程序来实现执行多个通知任务。</p> <div class=highlight><pre><span></span><code><a id=__codelineno-163-1 name=__codelineno-163-1 href=#__codelineno-163-1></a><span class=nt>handlers</span><span class=p>:</span>
<a id=__codelineno-163-2 name=__codelineno-163-2 href=#__codelineno-163-2></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">restart memcached</span>
<a id=__codelineno-163-3 name=__codelineno-163-3 href=#__codelineno-163-3></a><span class=w>      </span><span class=nt>service</span><span class=p>:</span>
<a id=__codelineno-163-4 name=__codelineno-163-4 href=#__codelineno-163-4></a><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">memcached</span>
<a id=__codelineno-163-5 name=__codelineno-163-5 href=#__codelineno-163-5></a><span class=w>        </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">restarted</span>
<a id=__codelineno-163-6 name=__codelineno-163-6 href=#__codelineno-163-6></a><span class=w>      </span><span class=nt>listen</span><span class=p>:</span><span class=w> </span><span class=s>&quot;restart</span><span class=nv> </span><span class=s>web</span><span class=nv> </span><span class=s>services&quot;</span>
<a id=__codelineno-163-7 name=__codelineno-163-7 href=#__codelineno-163-7></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">restart apache</span>
<a id=__codelineno-163-8 name=__codelineno-163-8 href=#__codelineno-163-8></a><span class=w>      </span><span class=nt>service</span><span class=p>:</span>
<a id=__codelineno-163-9 name=__codelineno-163-9 href=#__codelineno-163-9></a><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">apache</span>
<a id=__codelineno-163-10 name=__codelineno-163-10 href=#__codelineno-163-10></a><span class=w>        </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">restarted</span>
<a id=__codelineno-163-11 name=__codelineno-163-11 href=#__codelineno-163-11></a><span class=w>      </span><span class=nt>listen</span><span class=p>:</span><span class=w> </span><span class=s>&quot;restart</span><span class=nv> </span><span class=s>web</span><span class=nv> </span><span class=s>services&quot;</span>
<a id=__codelineno-163-12 name=__codelineno-163-12 href=#__codelineno-163-12></a>
<a id=__codelineno-163-13 name=__codelineno-163-13 href=#__codelineno-163-13></a><span class=nt>tasks</span><span class=p>:</span>
<a id=__codelineno-163-14 name=__codelineno-163-14 href=#__codelineno-163-14></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">restart everything</span>
<a id=__codelineno-163-15 name=__codelineno-163-15 href=#__codelineno-163-15></a><span class=w>      </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">echo &quot;this task will restart the web services&quot;</span>
<a id=__codelineno-163-16 name=__codelineno-163-16 href=#__codelineno-163-16></a><span class=w>      </span><span class=nt>notify</span><span class=p>:</span><span class=w> </span><span class=s>&quot;restart</span><span class=nv> </span><span class=s>web</span><span class=nv> </span><span class=s>services&quot;</span>
</code></pre></div> <h3 id=执行-playbook>执行 Playbook<a class=headerlink href=#执行-playbook title="Permanent link">&para;</a></h3> <p>使用<code>ansible-playbook</code>命令执行<code>playbook</code></p> <div class=highlight><pre><span></span><code><a id=__codelineno-164-1 name=__codelineno-164-1 href=#__codelineno-164-1></a>ansible-playbook<span class=w> </span>playbook.yml<span class=w> </span>-f<span class=w> </span><span class=m>10</span>
</code></pre></div> <p>在执行playbook前，可以做些检查</p> <ol> <li>检查palybook语法</li> </ol> <div class=highlight><pre><span></span><code><a id=__codelineno-165-1 name=__codelineno-165-1 href=#__codelineno-165-1></a>ansible-playbook<span class=w> </span>-i<span class=w> </span>hosts<span class=w> </span>httpd.yml<span class=w> </span>--syntax-check
</code></pre></div> <ol> <li>列出要执行的主机</li> </ol> <div class=highlight><pre><span></span><code><a id=__codelineno-166-1 name=__codelineno-166-1 href=#__codelineno-166-1></a>ansible-playbook<span class=w> </span>-i<span class=w> </span>hosts<span class=w> </span>httpd.yml<span class=w> </span>--list-hosts
</code></pre></div> <ol> <li>列出要执行得任务</li> </ol> <div class=highlight><pre><span></span><code><a id=__codelineno-167-1 name=__codelineno-167-1 href=#__codelineno-167-1></a>ansible-playbook<span class=w> </span>-i<span class=w> </span>hosts<span class=w> </span>httpd.yml<span class=w> </span>--list-tasks
</code></pre></div> <p>也可以使用<code>ansible-lint</code> 命令进行详细检查playbook文件</p> <div class=highlight><pre><span></span><code><a id=__codelineno-168-1 name=__codelineno-168-1 href=#__codelineno-168-1></a>ansible-lint<span class=w> </span>httpd.yml
</code></pre></div> <p><a href=https://docs.ansible.com/ansible-lint/rules/default_rules.html>ansible-lint 默认规则</a> 页面描述了每一个错误信息。</p> <h4 id=playbook执行顺序>playbook执行顺序<a class=headerlink href=#playbook执行顺序 title="Permanent link">&para;</a></h4> <p>一个playbook的内容，是按照下列表依次执行的</p> <ol> <li> <p>Variable loading 变量加载</p> </li> <li> <p>Fact gatherin 是否获取fact数据</p> </li> <li> <p>The pre_tasks execution 执行pre_tasks任务</p> </li> <li> <p>Handlers notified from the pre_tasks execution 执行pre_tasks任务里的事件通知</p> </li> <li> <p>Roles execution 执行roles角色</p> </li> <li> <p>Tasks execution 执行tasks任务</p> </li> <li> <p>Handlers notified from roles or tasks execution 执行tasks任务里的事件通知</p> </li> <li> <p>The post_tasks execution 执行post_tasks任务</p> </li> <li> <p>Handlers notified from post_tasks execution 执行post_tasks任务里的事件通知</p> </li> </ol> <hr> <div class=md-source-file> <small> 最后更新: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime">April 7, 2023 16:55:02</span> <br> 创建日期: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime">April 7, 2023 16:55:02</span> </small> </div> <form class=md-feedback name=feedback hidden> <fieldset> <legend class=md-feedback__title> Was this page helpful? </legend> <div class=md-feedback__inner> <div class=md-feedback__list> <button class="md-feedback__icon md-icon" type=submit title="This page was helpful" data-md-value=1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m7 0c0 .8-.7 1.5-1.5 1.5S14 10.3 14 9.5 14.7 8 15.5 8s1.5.7 1.5 1.5m-5 7.73c-1.75 0-3.29-.73-4.19-1.81L9.23 14c.45.72 1.52 1.23 2.77 1.23s2.32-.51 2.77-1.23l1.42 1.42c-.9 1.08-2.44 1.81-4.19 1.81Z"/></svg> </button> <button class="md-feedback__icon md-icon" type=submit title="This page could be improved" data-md-value=0> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10m-6.5-4c.8 0 1.5.7 1.5 1.5s-.7 1.5-1.5 1.5-1.5-.7-1.5-1.5.7-1.5 1.5-1.5M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m2 4.5c1.75 0 3.29.72 4.19 1.81l-1.42 1.42C14.32 16.5 13.25 16 12 16s-2.32.5-2.77 1.23l-1.42-1.42C8.71 14.72 10.25 14 12 14Z"/></svg> </button> </div> <div class=md-feedback__note> <div data-md-value=1 hidden> Thanks for your feedback! </div> <div data-md-value=0 hidden> Thanks for your feedback! Help us improve this page by using our <a href="https://github.com/hujianli94/hujianli94.github.io/issues/new/?title=[Feedback]+Ansible%E5%85%A5%E9%97%A8+-+/Linux/Ansible/0.Ansible%E5%85%A5%E9%97%A8/" target=_blank>feedback form</a>. </div> </div> </div> </fieldset> </form> </article> </div> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> 回到页面顶部 </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=页脚> <a href=../../serveices/2.ubuntu-desktop-vmware/ class="md-footer__link md-footer__link--prev" aria-label="上一页: ubuntu-desktop-vmware" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> 上一页 </span> <div class=md-ellipsis> ubuntu-desktop-vmware </div> </div> </a> <a href=../../shell/Shell%E7%AE%80%E4%BB%8B/ class="md-footer__link md-footer__link--next" aria-label="下一页: Shell 教程概述" rel=next> <div class=md-footer__title> <span class=md-footer__direction> 下一页 </span> <div class=md-ellipsis> Shell 教程概述 </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2023 - 2024 hujainli94 </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/hujianli94 target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> <a href=https://kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com/blog_img/20220125122524.png target=_blank rel=noopener title=kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 576 512"><!-- Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M385.2 167.6c6.4 0 12.6.3 18.8 1.1C387.4 90.3 303.3 32 207.7 32 100.5 32 13 104.8 13 197.4c0 53.4 29.3 97.5 77.9 131.6l-19.3 58.6 68-34.1c24.4 4.8 43.8 9.7 68.2 9.7 6.2 0 12.1-.3 18.3-.8-4-12.9-6.2-26.6-6.2-40.8-.1-84.9 72.9-154 165.3-154zm-104.5-52.9c14.5 0 24.2 9.7 24.2 24.4 0 14.5-9.7 24.2-24.2 24.2-14.8 0-29.3-9.7-29.3-24.2.1-14.7 14.6-24.4 29.3-24.4zm-136.4 48.6c-14.5 0-29.3-9.7-29.3-24.2 0-14.8 14.8-24.4 29.3-24.4 14.8 0 24.4 9.7 24.4 24.4 0 14.6-9.6 24.2-24.4 24.2zM563 319.4c0-77.9-77.9-141.3-165.4-141.3-92.7 0-165.4 63.4-165.4 141.3S305 460.7 397.6 460.7c19.3 0 38.9-5.1 58.6-9.9l53.4 29.3-14.8-48.6C534 402.1 563 363.2 563 319.4zm-219.1-24.5c-9.7 0-19.3-9.7-19.3-19.6 0-9.7 9.7-19.3 19.3-19.3 14.8 0 24.4 9.7 24.4 19.3 0 10-9.7 19.6-24.4 19.6zm107.1 0c-9.7 0-19.3-9.7-19.3-19.6 0-9.7 9.7-19.3 19.3-19.3 14.5 0 24.4 9.7 24.4 19.3.1 10-9.9 19.6-24.4 19.6z"/></svg> </a> <a href="mailto:<1879324764@qq.com>" target=_blank rel=noopener title=发送邮件 class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M498.1 5.6c10.1 7 15.4 19.1 13.5 31.2l-64 416c-1.5 9.7-7.4 18.2-16 23s-18.9 5.4-28 1.6L284 427.7l-68.5 74.1c-8.9 9.7-22.9 12.9-35.2 8.1S160 493.2 160 480v-83.6c0-4 1.5-7.8 4.2-10.7l167.6-182.9c5.8-6.3 5.6-16-.4-22s-15.7-6.4-22-.7L106 360.8l-88.3-44.2C7.1 311.3.3 300.7 0 288.9s5.9-22.8 16.1-28.7l448-256c10.7-6.1 23.9-5.5 34 1.4z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-consent data-md-component=consent id=__consent hidden> <div class=md-consent__overlay></div> <aside class=md-consent__inner> <form class="md-consent__form md-grid md-typeset" name=consent> <h4>Cookie consent</h4> <p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p> <input class=md-toggle type=checkbox id=__settings> <div class=md-consent__settings> <ul class=task-list> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=analytics checked> <span class=task-list-indicator></span> Google Analytics </label> </li> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=github checked> <span class=task-list-indicator></span> GitHub </label> </li> </ul> </div> <div class=md-consent__controls> <button class="md-button md-button--primary">同意</button> <label class=md-button for=__settings>管理设定</label> </div> </form> </aside> </div> <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout(function(){document.querySelector("[data-md-component=consent]").hidden=!1},250);var action,form=document.forms.consent;for(action of["submit","reset"])form.addEventListener(action,function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map(function(e){return[e,!0]}))),location.hash="",location.reload()})</script> <script id=__config type=application/json>{"base": "../../..", "features": ["content.action.edit", "content.action.view", "content.code.copy", "content.code.annotate", "navigation.indexes", "navigation.footer", "navigation.indexes", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest"], "search": "../../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script> <script src=../../../assets/javascripts/bundle.407015b8.min.js></script> <script src=../../../javascripts/extra.js></script> <script src=https://file.cdn.shafish.cn/blog/js/video.min.js></script> </body> </html>