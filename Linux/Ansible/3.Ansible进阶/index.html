<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="stay hungry,stay foolish"><meta name=author content=hujainli94><link href=https://hujianli94.github.io/Linux/Ansible/3.Ansible%E8%BF%9B%E9%98%B6/ rel=canonical><link href=../2.%E7%AE%A1%E7%90%86windows%E4%B8%BB%E6%9C%BA/ rel=prev><link href=../../shell/Shell%E7%AE%80%E4%BB%8B/ rel=next><link rel=icon href=../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.4.2, mkdocs-material-9.1.6"><title>Ansible进阶 - DevOps运维开发</title><link rel=stylesheet href=../../../assets/stylesheets/main.ded33207.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.a0c5b2b5.min.css><style>:root{--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M1 7.775V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 0 1 0 2.474l-5.026 5.026a1.75 1.75 0 0 1-2.474 0l-6.25-6.25A1.752 1.752 0 0 1 1 7.775Zm1.5 0c0 .066.026.13.073.177l6.25 6.25a.25.25 0 0 0 .354 0l5.025-5.025a.25.25 0 0 0 0-.354l-6.25-6.25a.25.25 0 0 0-.177-.073H2.75a.25.25 0 0 0-.25.25ZM6 5a1 1 0 1 1 0 2 1 1 0 0 1 0-2Z"/></svg>');--md-admonition-icon--abstract:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M2.5 1.75v11.5c0 .138.112.25.25.25h3.17a.75.75 0 0 1 0 1.5H2.75A1.75 1.75 0 0 1 1 13.25V1.75C1 .784 1.784 0 2.75 0h8.5C12.216 0 13 .784 13 1.75v7.736a.75.75 0 0 1-1.5 0V1.75a.25.25 0 0 0-.25-.25h-8.5a.25.25 0 0 0-.25.25Zm13.274 9.537v-.001l-4.557 4.45a.75.75 0 0 1-1.055-.008l-1.943-1.95a.75.75 0 0 1 1.062-1.058l1.419 1.425 4.026-3.932a.75.75 0 1 1 1.048 1.074ZM4.75 4h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM4 7.75A.75.75 0 0 1 4.75 7h2a.75.75 0 0 1 0 1.5h-2A.75.75 0 0 1 4 7.75Z"/></svg>');--md-admonition-icon--info:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"/></svg>');--md-admonition-icon--tip:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M3.499.75a.75.75 0 0 1 1.5 0v.996C5.9 2.903 6.793 3.65 7.662 4.376l.24.202c-.036-.694.055-1.422.426-2.163C9.1.873 10.794-.045 12.622.26 14.408.558 16 1.94 16 4.25c0 1.278-.954 2.575-2.44 2.734l.146.508.065.22c.203.701.412 1.455.476 2.226.142 1.707-.4 3.03-1.487 3.898C11.714 14.671 10.27 15 8.75 15h-6a.75.75 0 0 1 0-1.5h1.376a4.484 4.484 0 0 1-.563-1.191 3.835 3.835 0 0 1-.05-2.063 4.647 4.647 0 0 1-2.025-.293.75.75 0 0 1 .525-1.406c1.357.507 2.376-.006 2.698-.318l.009-.01a.747.747 0 0 1 1.06 0 .748.748 0 0 1-.012 1.074c-.912.92-.992 1.835-.768 2.586.221.74.745 1.337 1.196 1.621H8.75c1.343 0 2.398-.296 3.074-.836.635-.507 1.036-1.31.928-2.602-.05-.603-.216-1.224-.422-1.93l-.064-.221c-.12-.407-.246-.84-.353-1.29a2.425 2.425 0 0 1-.507-.441 3.075 3.075 0 0 1-.633-1.248.75.75 0 0 1 1.455-.364c.046.185.144.436.31.627.146.168.353.305.712.305.738 0 1.25-.615 1.25-1.25 0-1.47-.95-2.315-2.123-2.51-1.172-.196-2.227.387-2.706 1.345-.46.92-.27 1.774.019 3.062l.042.19a.884.884 0 0 1 .01.05c.348.443.666.949.94 1.553a.75.75 0 1 1-1.365.62c-.553-1.217-1.32-1.94-2.3-2.768L6.7 5.527c-.814-.68-1.75-1.462-2.692-2.619a3.737 3.737 0 0 0-1.023.88c-.406.495-.663 1.036-.722 1.508.116.122.306.21.591.239.388.038.797-.06 1.032-.19a.75.75 0 0 1 .728 1.31c-.515.287-1.23.439-1.906.373-.682-.067-1.473-.38-1.879-1.193L.75 5.677V5.5c0-.984.48-1.94 1.077-2.664.46-.559 1.05-1.055 1.673-1.353V.75Z"/></svg>');--md-admonition-icon--success:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"/></svg>');--md-admonition-icon--question:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.92 6.085h.001a.749.749 0 1 1-1.342-.67c.169-.339.436-.701.849-.977C6.845 4.16 7.369 4 8 4a2.756 2.756 0 0 1 1.637.525c.503.377.863.965.863 1.725 0 .448-.115.83-.329 1.15-.205.307-.47.513-.692.662-.109.072-.22.138-.313.195l-.006.004a6.24 6.24 0 0 0-.26.16.952.952 0 0 0-.276.245.75.75 0 0 1-1.248-.832c.184-.264.42-.489.692-.661.103-.067.207-.132.313-.195l.007-.004c.1-.061.182-.11.258-.161a.969.969 0 0 0 .277-.245C8.96 6.514 9 6.427 9 6.25a.612.612 0 0 0-.262-.525A1.27 1.27 0 0 0 8 5.5c-.369 0-.595.09-.74.187a1.01 1.01 0 0 0-.34.398ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"/></svg>');--md-admonition-icon--warning:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"/></svg>');--md-admonition-icon--failure:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M2.344 2.343h-.001a8 8 0 0 1 11.314 11.314A8.002 8.002 0 0 1 .234 10.089a8 8 0 0 1 2.11-7.746Zm1.06 10.253a6.5 6.5 0 1 0 9.108-9.275 6.5 6.5 0 0 0-9.108 9.275ZM6.03 4.97 8 6.94l1.97-1.97a.749.749 0 0 1 1.275.326.749.749 0 0 1-.215.734L9.06 8l1.97 1.97a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215L8 9.06l-1.97 1.97a.749.749 0 0 1-1.275-.326.749.749 0 0 1 .215-.734L6.94 8 4.97 6.03a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018Z"/></svg>');--md-admonition-icon--danger:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M9.504.43a1.516 1.516 0 0 1 2.437 1.713L10.415 5.5h2.123c1.57 0 2.346 1.909 1.22 3.004l-7.34 7.142a1.249 1.249 0 0 1-.871.354h-.302a1.25 1.25 0 0 1-1.157-1.723L5.633 10.5H3.462c-1.57 0-2.346-1.909-1.22-3.004L9.503.429Zm1.047 1.074L3.286 8.571A.25.25 0 0 0 3.462 9H6.75a.75.75 0 0 1 .694 1.034l-1.713 4.188 6.982-6.793A.25.25 0 0 0 12.538 7H9.25a.75.75 0 0 1-.683-1.06l2.008-4.418.003-.006a.036.036 0 0 0-.004-.009l-.006-.006-.008-.001c-.003 0-.006.002-.009.004Z"/></svg>');--md-admonition-icon--bug:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M4.72.22a.75.75 0 0 1 1.06 0l1 .999a3.488 3.488 0 0 1 2.441 0l.999-1a.748.748 0 0 1 1.265.332.75.75 0 0 1-.205.729l-.775.776c.616.63.995 1.493.995 2.444v.327c0 .1-.009.197-.025.292.408.14.764.392 1.029.722l1.968-.787a.75.75 0 0 1 .556 1.392L13 7.258V9h2.25a.75.75 0 0 1 0 1.5H13v.5c0 .409-.049.806-.141 1.186l2.17.868a.75.75 0 0 1-.557 1.392l-2.184-.873A4.997 4.997 0 0 1 8 16a4.997 4.997 0 0 1-4.288-2.427l-2.183.873a.75.75 0 0 1-.558-1.392l2.17-.868A5.036 5.036 0 0 1 3 11v-.5H.75a.75.75 0 0 1 0-1.5H3V7.258L.971 6.446a.75.75 0 0 1 .558-1.392l1.967.787c.265-.33.62-.583 1.03-.722a1.677 1.677 0 0 1-.026-.292V4.5c0-.951.38-1.814.995-2.444L4.72 1.28a.75.75 0 0 1 0-1.06Zm.53 6.28a.75.75 0 0 0-.75.75V11a3.5 3.5 0 1 0 7 0V7.25a.75.75 0 0 0-.75-.75ZM6.173 5h3.654A.172.172 0 0 0 10 4.827V4.5a2 2 0 1 0-4 0v.327c0 .096.077.173.173.173Z"/></svg>');--md-admonition-icon--example:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M5 5.782V2.5h-.25a.75.75 0 0 1 0-1.5h6.5a.75.75 0 0 1 0 1.5H11v3.282l3.666 5.76C15.619 13.04 14.543 15 12.767 15H3.233c-1.776 0-2.852-1.96-1.899-3.458Zm-2.4 6.565a.75.75 0 0 0 .633 1.153h9.534a.75.75 0 0 0 .633-1.153L12.225 10.5h-8.45ZM9.5 2.5h-3V6c0 .143-.04.283-.117.403L4.73 9h6.54L9.617 6.403A.746.746 0 0 1 9.5 6Z"/></svg>');--md-admonition-icon--quote:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M1.75 2.5h10.5a.75.75 0 0 1 0 1.5H1.75a.75.75 0 0 1 0-1.5Zm4 5h8.5a.75.75 0 0 1 0 1.5h-8.5a.75.75 0 0 1 0-1.5Zm0 5h8.5a.75.75 0 0 1 0 1.5h-8.5a.75.75 0 0 1 0-1.5ZM2.5 7.75v6a.75.75 0 0 1-1.5 0v-6a.75.75 0 0 1 1.5 0Z"/></svg>');}</style><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../stylesheets/extra.css><link rel=stylesheet href=https://file.cdn.shafish.cn/blog/css/vssue.css><link rel=stylesheet href=https://file.cdn.shafish.cn/blog/css/video-js.min.css><link rel=stylesheet href=https://file.cdn.shafish.cn/blog/css/video.css><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script>var consent;"undefined"==typeof __md_analytics||(consent=__md_get("__consent"))&&consent.analytics&&__md_analytics()</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#ansible进阶 class=md-skip> 跳转至 </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=页眉> <a href=../../.. title=DevOps运维开发 class="md-header__button md-logo" aria-label=DevOps运维开发 data-md-component=logo> <img src=../../../assets/images/logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> DevOps运维开发 </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Ansible进阶 </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label=切换至深色模式 type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title=切换至深色模式 for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=blue data-md-color-accent=blue aria-label=切换至浅色模式 type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title=切换至浅色模式 for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=查找> <a href=javascript:void(0) class="md-search__icon md-icon" title=分享 aria-label=分享 data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=清空当前内容 aria-label=清空当前内容 tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> 正在初始化搜索引擎 </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/hujianli94/hujianli94.github.io title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> hujianli94.github.io </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=标签 data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> 首页 </a> </li> <li class=md-tabs__item> <a href=../../../Kubernetes/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Kubernetes/ class=md-tabs__link> Kubernetes </a> </li> <li class=md-tabs__item> <a href=../../../Docker/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Docker/ class=md-tabs__link> Docker </a> </li> <li class=md-tabs__item> <a href=../../../Golang/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Go%20Web%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98/ class=md-tabs__link> Golang </a> </li> <li class=md-tabs__item> <a href=../../../Python/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Pythjon-auto-ops/ class=md-tabs__link> Python </a> </li> <li class=md-tabs__item> <a href=../../../Python-vs-Go/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Python-vs-Go/ class=md-tabs__link> Python-vs-Go </a> </li> <li class=md-tabs__item> <a href=../../system/0.Linux%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E4%B8%8B%E8%BD%BD/ class="md-tabs__link md-tabs__link--active"> Linux </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=导航栏 data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title=DevOps运维开发 class="md-nav__button md-logo" aria-label=DevOps运维开发 data-md-component=logo> <img src=../../../assets/images/logo.png alt=logo> </a> DevOps运维开发 </label> <div class=md-nav__source> <a href=https://github.com/hujianli94/hujianli94.github.io title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> hujianli94.github.io </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> 首页 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> Kubernetes <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_1> <label class=md-nav__link for=__nav_2_1 id=__nav_2_1_label tabindex=0> 0.学习线路 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_1_label aria-expanded=false> <label class=md-nav__title for=__nav_2_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Kubernetes/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Kubernetes/ class=md-nav__link> Kubernetes </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2> <label class=md-nav__link for=__nav_2_2 id=__nav_2_2_label tabindex=0> 1.安装篇 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2> <span class="md-nav__icon md-icon"></span> 1.安装篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/1.Kubeadm%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/ class=md-nav__link> Kubeadm安装高可用集群 </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/2.%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/ class=md-nav__link> 二进制安装高可用K8s集群 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_3> <label class=md-nav__link for=__nav_2_3 id=__nav_2_3_label tabindex=0> 2.基础篇 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_3_label aria-expanded=false> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> 2.基础篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/3.Docker%E5%9F%BA%E7%A1%80/ class=md-nav__link> Docker基础 </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Kubernetes%E7%9A%84%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/ class=md-nav__link> Kubernetes的基础概念 </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Kubernetes%E8%B0%83%E5%BA%A6%E5%9F%BA%E7%A1%80/ class=md-nav__link> Kubernetes调度基础 </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/6.Kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83%E5%9F%BA%E7%A1%80/ class=md-nav__link> Kubernetes服务发布基础 </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/7.Kubernetes%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/ class=md-nav__link> Kubernetes配置管理 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_4> <label class=md-nav__link for=__nav_2_4 id=__nav_2_4_label tabindex=0> 3.进阶篇 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_4_label aria-expanded=false> <label class=md-nav__title for=__nav_2_4> <span class="md-nav__icon md-icon"></span> 3.进阶篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Kubernetes/3.%E8%BF%9B%E9%98%B6%E7%AF%87/8.Kubernetes%E5%AD%98%E5%82%A8%E5%85%A5%E9%97%A8/ class=md-nav__link> Kubernetes存储入门 </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/3.%E8%BF%9B%E9%98%B6%E7%AF%87/9.Kubernetes%E9%AB%98%E7%BA%A7%E8%B0%83%E5%BA%A6/ class=md-nav__link> Kubernetes高级调度 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_5> <label class=md-nav__link for=__nav_2_5 id=__nav_2_5_label tabindex=0> 4.高级篇 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_5_label aria-expanded=false> <label class=md-nav__title for=__nav_2_5> <span class="md-nav__icon md-icon"></span> 4.高级篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Kubernetes/4.%E9%AB%98%E7%BA%A7%E7%AF%87/12.%E4%BA%91%E5%8E%9F%E7%94%9F%E5%AD%98%E5%82%A8Rook/ class=md-nav__link> 云原生存储Rook </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/4.%E9%AB%98%E7%BA%A7%E7%AF%87/13.%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%AE%B9%E5%99%A8%E5%8C%96/ class=md-nav__link> 中间件容器化 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_6> <label class=md-nav__link for=__nav_2_6 id=__nav_2_6_label tabindex=0> 5.运维篇 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_6_label aria-expanded=false> <label class=md-nav__title for=__nav_2_6> <span class="md-nav__icon md-icon"></span> 5.运维篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/14.Kubernetes%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/ class=md-nav__link> Kubernetes日志收集 </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/15.Kubernetes%E7%9B%91%E6%8E%A7%E5%91%8A%E8%AD%A6/ class=md-nav__link> Kubernetes监控告警 </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/16.%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83Ingress%E8%BF%9B%E9%98%B6/ class=md-nav__link> 服务发布Ingress进阶 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_7> <label class=md-nav__link for=__nav_2_7 id=__nav_2_7_label tabindex=0> 6.DevOps篇 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_7_label aria-expanded=false> <label class=md-nav__title for=__nav_2_7> <span class="md-nav__icon md-icon"></span> 6.DevOps篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/ class=md-nav__link> DevOps实践 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> Docker <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Docker </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1> <label class=md-nav__link for=__nav_3_1 id=__nav_3_1_label tabindex=0> 0.学习线路 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_1_label aria-expanded=false> <label class=md-nav__title for=__nav_3_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Docker/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Docker/ class=md-nav__link> Docker </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2> <label class=md-nav__link for=__nav_3_2 id=__nav_3_2_label tabindex=0> 1.Docker基础 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> 1.Docker基础 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Docker/1.Docker%E5%9F%BA%E7%A1%80/1.%E5%AE%89%E8%A3%85Docker/ class=md-nav__link> 安装Docker </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.Docker%E5%9F%BA%E7%A1%80/2.%E4%BD%BF%E7%94%A8Docker%E9%95%9C%E5%83%8F/ class=md-nav__link> 使用Docker镜像 </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.Docker%E5%9F%BA%E7%A1%80/3.%E6%93%8D%E4%BD%9CDocker%E5%AE%B9%E5%99%A8/ class=md-nav__link> 操作Docker容器 </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.Docker%E5%9F%BA%E7%A1%80/4.%E6%90%AD%E5%BB%BA%E6%9C%AC%E5%9C%B0%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93/ class=md-nav__link> 搭建本地私有仓库 </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.Docker%E5%9F%BA%E7%A1%80/5.Docker%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86/ class=md-nav__link> Docker数据管理 </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.Docker%E5%9F%BA%E7%A1%80/6.Docker%E4%BD%BF%E7%94%A8%E7%BD%91%E7%BB%9C/ class=md-nav__link> Docker使用网络 </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.Docker%E5%9F%BA%E7%A1%80/7.Dockerfile/ class=md-nav__link> Dockerfile </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.Docker%E5%9F%BA%E7%A1%80/8.docker-compose/ class=md-nav__link> docker-compose </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.Docker%E5%9F%BA%E7%A1%80/9.Docker%E7%9B%B8%E5%85%B3%E8%84%9A%E6%9C%AC/ class=md-nav__link> Docker相关脚本 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_3> <label class=md-nav__link for=__nav_3_3 id=__nav_3_3_label tabindex=0> 2.实战案例 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> 2.实战案例 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/1.%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/ class=md-nav__link> 操作系统 </a> </li> <li class=md-nav__item> <a href=../../../Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/2.Web%E6%9C%8D%E5%8A%A1%E4%B8%8E%E5%BA%94%E7%94%A8/ class=md-nav__link> Web服务与应用 </a> </li> <li class=md-nav__item> <a href=../../../Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/3.%E6%8C%81%E7%BB%AD%E5%BC%80%E5%8F%91%E4%B8%8E%E7%AE%A1%E7%90%86/ class=md-nav__link> 持续开发与管理 </a> </li> <li class=md-nav__item> <a href=../../../Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/4.%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BA%94%E7%94%A8/ class=md-nav__link> 数据库应用 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_4> <label class=md-nav__link for=__nav_3_4 id=__nav_3_4_label tabindex=0> 3.Devops <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_4_label aria-expanded=false> <label class=md-nav__title for=__nav_3_4> <span class="md-nav__icon md-icon"></span> 3.Devops </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Docker/3.Devops/1.ConfCenter/ class=md-nav__link> ConfCenter </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/2.CoreDNS/ class=md-nav__link> Coredns </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/3.Harbor/ class=md-nav__link> Harbor </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/4.Python%E6%93%8D%E4%BD%9CDocker/ class=md-nav__link> Python操作Docker </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/5.Haproxy/ class=md-nav__link> Haproxy </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> Golang <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Golang </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_1> <label class=md-nav__link for=__nav_4_1 id=__nav_4_1_label tabindex=0> 0.学习线路 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_1_label aria-expanded=false> <label class=md-nav__title for=__nav_4_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Go%20Web%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98/ class=md-nav__link> Go Web开发实战 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_2> <label class=md-nav__link for=__nav_4_2 id=__nav_4_2_label tabindex=0> 1.Go基础入门 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_2_label aria-expanded=false> <label class=md-nav__title for=__nav_4_2> <span class="md-nav__icon md-icon"></span> 1.Go基础入门 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/1.Go%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/1.%E5%AE%89%E8%A3%85Go/ class=md-nav__link> 安装Go </a> </li> <li class=md-nav__item> <a href=../../../Golang/1.Go%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/2.%E5%BC%80%E5%90%AFGo%E7%9A%84%E7%AC%AC%E4%B8%80%E4%B8%AA%E7%A8%8B%E5%BA%8F/ class=md-nav__link> 开启Go的第一个程序 </a> </li> <li class=md-nav__item> <a href=../../../Golang/1.Go%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95%E4%B8%8E%E4%BD%BF%E7%94%A8/ class=md-nav__link> Go基础语法与使用 </a> </li> <li class=md-nav__item> <a href=../../../Golang/1.Go%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/4.Go%20Module%E6%95%99%E7%A8%8B/ class=md-nav__link> Go Module教程 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_3> <label class=md-nav__link for=__nav_4_3 id=__nav_4_3_label tabindex=0> 2.Go-Web开发基础 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_3_label aria-expanded=false> <label class=md-nav__title for=__nav_4_3> <span class="md-nav__icon md-icon"></span> 2.Go-Web开发基础 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/2.Go-Web%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80/5.hello%20World%20Web/ class=md-nav__link> hello World Web </a> </li> <li class=md-nav__item> <a href=../../../Golang/2.Go-Web%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80/6.Web%E7%A8%8B%E5%BA%8F%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86%E7%AE%80%E4%BB%8B/ class=md-nav__link> Web程序运行原理简介 </a> </li> <li class=md-nav__item> <a href=../../../Golang/2.Go-Web%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80/7.net-http%E5%8C%85/ class=md-nav__link> net/http包 </a> </li> <li class=md-nav__item> <a href=../../../Golang/2.Go-Web%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80/8.html-template%E5%8C%85/ class=md-nav__link> html/template包 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_4> <label class=md-nav__link for=__nav_4_4 id=__nav_4_4_label tabindex=0> 3.接收和处理Go Web请求 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4_4> <span class="md-nav__icon md-icon"></span> 3.接收和处理Go Web请求 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/3.%E6%8E%A5%E6%94%B6%E5%92%8C%E5%A4%84%E7%90%86Go%20Web%E8%AF%B7%E6%B1%82/9.%E7%AE%80%E5%8D%95Go%20Web%E6%9C%8D%E5%8A%A1%E5%99%A8/ class=md-nav__link> 简单Go Web服务器 </a> </li> <li class=md-nav__item> <a href=../../../Golang/3.%E6%8E%A5%E6%94%B6%E5%92%8C%E5%A4%84%E7%90%86Go%20Web%E8%AF%B7%E6%B1%82/10.%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82/ class=md-nav__link> 处理请求 </a> </li> <li class=md-nav__item> <a href=../../../Golang/3.%E6%8E%A5%E6%94%B6%E5%92%8C%E5%A4%84%E7%90%86Go%20Web%E8%AF%B7%E6%B1%82/11.%E4%BA%86%E8%A7%A3session%E5%92%8Ccookie/ class=md-nav__link> 了解session和cookie </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_5> <label class=md-nav__link for=__nav_4_5 id=__nav_4_5_label tabindex=0> 4.使用Go访问数据库 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_5_label aria-expanded=false> <label class=md-nav__title for=__nav_4_5> <span class="md-nav__icon md-icon"></span> 4.使用Go访问数据库 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/4.%E4%BD%BF%E7%94%A8Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/12.MySQL%E7%9A%84%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8/ class=md-nav__link> MySQL的安装与使用 </a> </li> <li class=md-nav__item> <a href=../../../Golang/4.%E4%BD%BF%E7%94%A8Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/13.Redis%E7%9A%84%E5%AE%89%E8%A3%85%E5%8F%8A%E4%BD%BF%E7%94%A8/ class=md-nav__link> Redis的安装及使用 </a> </li> <li class=md-nav__item> <a href=../../../Golang/4.%E4%BD%BF%E7%94%A8Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/14.MongoDB%E7%9A%84%E5%AE%89%E8%A3%85%E5%8F%8A%E4%BD%BF%E7%94%A8/ class=md-nav__link> MongoDB的安装及使用 </a> </li> <li class=md-nav__item> <a href=../../../Golang/4.%E4%BD%BF%E7%94%A8Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/15.Go%E7%9A%84%E5%B8%B8%E8%A7%81ORM%E5%BA%93/ class=md-nav__link> Go的常见ORM库 </a> </li> <li class=md-nav__item> <a href=../../../Golang/4.%E4%BD%BF%E7%94%A8Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/16.SQLite%E7%9A%84%E5%AE%89%E8%A3%85%E5%8F%8A%E4%BD%BF%E7%94%A8/ class=md-nav__link> SQLite的安装及使用 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_6> <label class=md-nav__link for=__nav_4_6 id=__nav_4_6_label tabindex=0> 5.Go高级网络编程 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_6_label aria-expanded=false> <label class=md-nav__title for=__nav_4_6> <span class="md-nav__icon md-icon"></span> 5.Go高级网络编程 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/5.Go%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/17.Go%20Socket%E7%BC%96%E7%A8%8B/ class=md-nav__link> Go Socket编程 </a> </li> <li class=md-nav__item> <a href=../../../Golang/5.Go%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/18.Go%20RPC%E7%BC%96%E7%A8%8B/ class=md-nav__link> Go RPC编程 </a> </li> <li class=md-nav__item> <a href=../../../Golang/5.Go%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/19.%E5%BE%AE%E6%9C%8D%E5%8A%A1/ class=md-nav__link> 微服务 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_7> <label class=md-nav__link for=__nav_4_7 id=__nav_4_7_label tabindex=0> 6.Go文件处理 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_7_label aria-expanded=false> <label class=md-nav__title for=__nav_4_7> <span class="md-nav__icon md-icon"></span> 6.Go文件处理 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/20.%E5%A4%84%E7%90%86%E7%9B%AE%E5%BD%95%E4%B8%8E%E6%96%87%E4%BB%B6/ class=md-nav__link> 处理目录与文件 </a> </li> <li class=md-nav__item> <a href=../../../Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/21.%E5%A4%84%E7%90%86XML%E6%96%87%E4%BB%B6/ class=md-nav__link> 处理XML文件 </a> </li> <li class=md-nav__item> <a href=../../../Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/22.%E5%A4%84%E7%90%86JSON%E6%96%87%E4%BB%B6/ class=md-nav__link> 处理JSON文件 </a> </li> <li class=md-nav__item> <a href=../../../Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/23.%E5%A4%84%E7%90%86CSV%E6%96%87%E4%BB%B6/ class=md-nav__link> 处理CSV文件 </a> </li> <li class=md-nav__item> <a href=../../../Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/24.%E5%A4%84%E7%90%86%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95/ class=md-nav__link> 处理日志记录 </a> </li> <li class=md-nav__item> <a href=../../../Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/25.%E5%A4%84%E7%90%86%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/ class=md-nav__link> 处理正则表达式 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_8> <label class=md-nav__link for=__nav_4_8 id=__nav_4_8_label tabindex=0> 7.Go并发编程 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_8_label aria-expanded=false> <label class=md-nav__title for=__nav_4_8> <span class="md-nav__icon md-icon"></span> 7.Go并发编程 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/26.%E5%B9%B6%E5%8F%91%E4%B8%8E%E5%B9%B6%E8%A1%8C/ class=md-nav__link> 并发与并行 </a> </li> <li class=md-nav__item> <a href=../../../Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/27.%E8%BF%9B%E7%A8%8B%20%E7%BA%BF%E7%A8%8B%E5%92%8C%E5%8D%8F%E7%A8%8B/ class=md-nav__link> 进程 线程和协程 </a> </li> <li class=md-nav__item> <a href=../../../Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/28.Go%E5%B9%B6%E5%8F%91%E6%A8%A1%E5%9E%8B%E7%AE%80%E4%BB%8B/ class=md-nav__link> Go并发模型简介 </a> </li> <li class=md-nav__item> <a href=../../../Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/29.gogoroutine%E5%92%8Cchannel%E5%AE%9E%E7%8E%B0%E5%B9%B6%E5%8F%91/ class=md-nav__link> gogoroutine和channel实现并发 </a> </li> <li class=md-nav__item> <a href=../../../Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/30.sync%E5%AE%9E%E7%8E%B0%E5%B9%B6%E5%8F%91/ class=md-nav__link> sync实现并发 </a> </li> <li class=md-nav__item> <a href=../../../Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/31.Go%E5%B9%B6%E5%8F%91%E7%9A%84Web%E5%BA%94%E7%94%A8/ class=md-nav__link> Go并发的Web应用 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> Python <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Python </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_1> <label class=md-nav__link for=__nav_5_1 id=__nav_5_1_label tabindex=0> 0.学习线路 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_1_label aria-expanded=false> <label class=md-nav__title for=__nav_5_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Pythjon-auto-ops/ class=md-nav__link> Pythjon自动化运维 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_2> <label class=md-nav__link for=__nav_5_2 id=__nav_5_2_label tabindex=0> 1.基础篇 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_2_label aria-expanded=false> <label class=md-nav__title for=__nav_5_2> <span class="md-nav__icon md-icon"></span> 1.基础篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/1.Python%E5%86%85%E7%BD%AE%E5%B0%8F%E5%B7%A5%E5%85%B7/ class=md-nav__link> Python内置小工具 </a> </li> <li class=md-nav__item> <a href=../../../Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/2.Python%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E5%AE%89%E8%A3%85/ class=md-nav__link> Python第三方库安装 </a> </li> <li class=md-nav__item> <a href=../../../Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/3.Python%E5%B7%A5%E4%BD%9C%E7%8E%AF%E5%A2%83%E7%AE%A1%E7%90%86/ class=md-nav__link> Python工作环境管理 </a> </li> <li class=md-nav__item> <a href=../../../Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/4.VSCode%E4%B8%ADPython%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/ class=md-nav__link> VSCode中Python环境配置 </a> </li> <li class=md-nav__item> <a href=../../../Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/5.%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/ class=md-nav__link> 开发工具 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_3> <label class=md-nav__link for=__nav_5_3 id=__nav_5_3_label tabindex=0> 2.高级篇 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_3_label aria-expanded=false> <label class=md-nav__title for=__nav_5_3> <span class="md-nav__icon md-icon"></span> 2.高级篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/1.%E6%89%93%E9%80%A0%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/ class=md-nav__link> 打造命令行工具 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> Python-vs-Go <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Python-vs-Go </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_1> <label class=md-nav__link for=__nav_6_1 id=__nav_6_1_label tabindex=0> 0.学习线路 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_1_label aria-expanded=false> <label class=md-nav__title for=__nav_6_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python-vs-Go/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Python-vs-Go/ class=md-nav__link> Python-vs-Go </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_2> <label class=md-nav__link for=__nav_6_2 id=__nav_6_2_label tabindex=0> 1.对比学习 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_2_label aria-expanded=false> <label class=md-nav__title for=__nav_6_2> <span class="md-nav__icon md-icon"></span> 1.对比学习 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/1.Hello-World/ class=md-nav__link> Hello-World </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/2.Print/ class=md-nav__link> Print </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/3.%E6%B3%A8%E9%87%8A/ class=md-nav__link> 注释 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/4.%E5%A4%9A%E8%A1%8C%E5%AD%97%E7%AC%A6%E4%B8%B2/ class=md-nav__link> 多行字符串 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/5.Lists/ class=md-nav__link> Lists </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/6.Map/ class=md-nav__link> Map </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/7.Booleans/ class=md-nav__link> Booleans </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/8.Forloop/ class=md-nav__link> Forloop </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/9.Range/ class=md-nav__link> Range </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/10.Switch/ class=md-nav__link> Switch </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/11.%E5%8F%AF%E5%8F%98%E5%8F%82%E6%95%B0%E5%87%BD%E6%95%B0/ class=md-nav__link> 可变参数函数 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/12.%E6%97%B6%E9%97%B4%E8%AE%A1%E7%AE%97/ class=md-nav__link> 时间计算 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/13.%E5%87%BD%E6%95%B0%E7%9A%84%E9%97%AD%E5%8C%85/ class=md-nav__link> 函数的闭包 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/14.%E9%80%80%E5%87%BA%E5%A4%84%E7%90%86/ class=md-nav__link> 退出处理 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/15.%E5%BC%82%E5%B8%B8%E6%8D%95%E8%8E%B7/ class=md-nav__link> 异常捕获 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/16.%E5%8F%AF%E5%8F%98%E9%A1%B9/ class=md-nav__link> 可变项 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/17.%E7%B1%BB/ class=md-nav__link> 类 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/18.%E6%96%B9%E6%B3%95/ class=md-nav__link> 方法 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/19.%E5%B9%B6%E5%8F%91/ class=md-nav__link> 并发 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/20.Args/ class=md-nav__link> Args </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/21.%E5%AF%BC%E5%85%A5%E6%A8%A1%E5%9D%97%E5%88%AB%E5%90%8D/ class=md-nav__link> 导入模块别名 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/22.%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%A0%BC%E5%BC%8F%E5%8C%96/ class=md-nav__link> 字符串格式化 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/23.%E5%8E%BB%E9%87%8D/ class=md-nav__link> 去重 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/24.%E5%B8%A6%E9%A2%9C%E8%89%B2%E6%89%93%E5%8D%B0/ class=md-nav__link> 带颜色打印 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_3> <label class=md-nav__link for=__nav_6_3 id=__nav_6_3_label tabindex=0> 2.进阶 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_3_label aria-expanded=false> <label class=md-nav__title for=__nav_6_3> <span class="md-nav__icon md-icon"></span> 2.进阶 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python-vs-Go/2.%E8%BF%9B%E9%98%B6/1.%E4%BD%BF%E7%94%A8RPC/ class=md-nav__link> 使用RPC </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/2.%E8%BF%9B%E9%98%B6/2.%E4%BD%BF%E7%94%A8MySQL/ class=md-nav__link> 使用MySQL </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/2.%E8%BF%9B%E9%98%B6/3.%E4%BD%BF%E7%94%A8Redis/ class=md-nav__link> 使用Redis </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/2.%E8%BF%9B%E9%98%B6/4.%E4%BD%BF%E7%94%A8MongoDB/ class=md-nav__link> 使用MongoDB </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7 checked> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex=0> Linux <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=true> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Linux </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_1> <label class=md-nav__link for=__nav_7_1 id=__nav_7_1_label tabindex=0> system <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_1_label aria-expanded=false> <label class=md-nav__title for=__nav_7_1> <span class="md-nav__icon md-icon"></span> system </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../system/0.Linux%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E4%B8%8B%E8%BD%BD/ class=md-nav__link> Linux操作系统镜像下载 </a> </li> <li class=md-nav__item> <a href=../../system/1.Linux%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/ class=md-nav__link> Linux 系统安全加固最佳实践 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_2> <label class=md-nav__link for=__nav_7_2 id=__nav_7_2_label tabindex=0> serveices <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_2_label aria-expanded=false> <label class=md-nav__title for=__nav_7_2> <span class="md-nav__icon md-icon"></span> serveices </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../serveices/0.ubuntu-desktop-vmware/ class=md-nav__link> ubuntu-desktop-vmware </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_3 checked> <label class=md-nav__link for=__nav_7_3 id=__nav_7_3_label tabindex=0> Ansible <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_3_label aria-expanded=true> <label class=md-nav__title for=__nav_7_3> <span class="md-nav__icon md-icon"></span> Ansible </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../0.Ansible%E5%85%A5%E9%97%A8/ class=md-nav__link> Ansible入门 </a> </li> <li class=md-nav__item> <a href=../1.Ansible%E6%89%A9%E5%B1%95%E9%98%85%E8%AF%BB/ class=md-nav__link> Ansible扩展阅读 </a> </li> <li class=md-nav__item> <a href=../2.%E7%AE%A1%E7%90%86windows%E4%B8%BB%E6%9C%BA/ class=md-nav__link> 管理windows主机 </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Ansible进阶 <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Ansible进阶 </a> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#1-ansible-优化 class=md-nav__link> 1. Ansible 优化 </a> <nav class=md-nav aria-label="1. Ansible 优化"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#profile_tasks class=md-nav__link> Profile_tasks </a> </li> <li class=md-nav__item> <a href=#fork class=md-nav__link> Fork </a> </li> <li class=md-nav__item> <a href=#poll_interval class=md-nav__link> Poll_interval </a> </li> <li class=md-nav__item> <a href=#fact-cache class=md-nav__link> Fact cache </a> </li> <li class=md-nav__item> <a href=#gather_subset class=md-nav__link> Gather_subset </a> </li> <li class=md-nav__item> <a href=#ssh-连接参数 class=md-nav__link> SSH 连接参数 </a> </li> <li class=md-nav__item> <a href=#control_path class=md-nav__link> Control_path </a> </li> <li class=md-nav__item> <a href=#pipelinling class=md-nav__link> Pipelinling </a> </li> <li class=md-nav__item> <a href=#serial class=md-nav__link> Serial </a> </li> <li class=md-nav__item> <a href=#strategy class=md-nav__link> Strategy </a> </li> <li class=md-nav__item> <a href=#mitogen-strategy-插件 class=md-nav__link> mitogen strategy 插件 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2ansible-的常用设置 class=md-nav__link> 2.Ansible 的常用设置 </a> <nav class=md-nav aria-label="2.Ansible 的常用设置"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#ansiblecfg class=md-nav__link> ansible.cfg </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#3ansible-最佳实践 class=md-nav__link> 3.Ansible 最佳实践 </a> <nav class=md-nav aria-label="3.Ansible 最佳实践"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#如何写作 class=md-nav__link> 如何写作 </a> <nav class=md-nav aria-label=如何写作> <ul class=md-nav__list> <li class=md-nav__item> <a href=#像对待代码一样对待你的ansible class=md-nav__link> 像对待代码一样对待你的ansible </a> </li> <li class=md-nav__item> <a href=#不要使用个性化的书写方式 class=md-nav__link> 不要使用个性化的书写方式 </a> </li> <li class=md-nav__item> <a href=#使用git class=md-nav__link> 使用git </a> </li> <li class=md-nav__item> <a href=#inventory class=md-nav__link> inventory </a> </li> <li class=md-nav__item> <a href=#变量 class=md-nav__link> 变量 </a> </li> <li class=md-nav__item> <a href=#playbook class=md-nav__link> playbook </a> </li> <li class=md-nav__item> <a href=#使用block class=md-nav__link> 使用block </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#如何执行 class=md-nav__link> 如何执行 </a> <nav class=md-nav aria-label=如何执行> <ul class=md-nav__list> <li class=md-nav__item> <a href=#调试执行 class=md-nav__link> 调试执行 </a> </li> <li class=md-nav__item> <a href=#分析运行的内容 class=md-nav__link> 分析运行的内容 </a> </li> <li class=md-nav__item> <a href=#无主机清单的快速启动 class=md-nav__link> 无主机清单的快速启动 </a> </li> <li class=md-nav__item> <a href=#使用正确的工具 class=md-nav__link> 使用正确的工具 </a> </li> <li class=md-nav__item> <a href=#使用-roles-和-galaxy class=md-nav__link> 使用 Roles 和 Galaxy </a> </li> <li class=md-nav__item> <a href=#正确访问目标 class=md-nav__link> 正确访问目标 </a> </li> <li class=md-nav__item> <a href=#调试问题 class=md-nav__link> 调试问题 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#如何在生产中使用 class=md-nav__link> 如何在生产中使用 </a> <nav class=md-nav aria-label=如何在生产中使用> <ul class=md-nav__list> <li class=md-nav__item> <a href=#使用tower class=md-nav__link> 使用Tower </a> </li> <li class=md-nav__item> <a href=#使用ansible class=md-nav__link> 使用Ansible </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#4使用-ansible-lint class=md-nav__link> 4.使用 ansible-lint </a> <nav class=md-nav aria-label="4.使用 ansible-lint"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#安装 class=md-nav__link> 安装 </a> </li> <li class=md-nav__item> <a href=#使用 class=md-nav__link> 使用 </a> <nav class=md-nav aria-label=使用> <ul class=md-nav__list> <li class=md-nav__item> <a href=#检查roles class=md-nav__link> 检查roles </a> </li> <li class=md-nav__item> <a href=#检查playbook class=md-nav__link> 检查playbook </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#配置文件 class=md-nav__link> 配置文件 </a> </li> <li class=md-nav__item> <a href=#规则 class=md-nav__link> 规则 </a> <nav class=md-nav aria-label=规则> <ul class=md-nav__list> <li class=md-nav__item> <a href=#列出规则 class=md-nav__link> 列出规则 </a> </li> <li class=md-nav__item> <a href=#规则标记 class=md-nav__link> 规则标记 </a> </li> <li class=md-nav__item> <a href=#跳过规则 class=md-nav__link> 跳过规则 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#5使用动态主机 class=md-nav__link> 5.使用动态主机 </a> <nav class=md-nav aria-label=5.使用动态主机> <ul class=md-nav__list> <li class=md-nav__item> <a href=#脚本约定 class=md-nav__link> 脚本约定 </a> </li> <li class=md-nav__item> <a href=#简单例子 class=md-nav__link> 简单例子 </a> </li> <li class=md-nav__item> <a href=#脚本使用 class=md-nav__link> 脚本使用 </a> <nav class=md-nav aria-label=脚本使用> <ul class=md-nav__list> <li class=md-nav__item> <a href=#执行-ad-hoc-命令 class=md-nav__link> 执行 ad-hoc 命令 </a> </li> <li class=md-nav__item> <a href=#执行-playbook class=md-nav__link> 执行 playbook </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#插件使用 class=md-nav__link> 插件使用 </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_4> <label class=md-nav__link for=__nav_7_4 id=__nav_7_4_label tabindex=0> Shell <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_4_label aria-expanded=false> <label class=md-nav__title for=__nav_7_4> <span class="md-nav__icon md-icon"></span> Shell </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../shell/Shell%E7%AE%80%E4%BB%8B/ class=md-nav__link> Shell 教程概述 </a> </li> <li class=md-nav__item> <a href=../../shell/1.%E7%AC%AC%E4%B8%80%E4%B8%AAshell%E7%A8%8B%E5%BA%8F/ class=md-nav__link> 1.第一个 Shell 程序 </a> </li> <li class=md-nav__item> <a href=../../shell/2.Shell%E5%8F%98%E9%87%8F/ class=md-nav__link> 2.Shell 变量 </a> </li> <li class=md-nav__item> <a href=../../shell/3.Shell%E5%8F%82%E6%95%B0/ class=md-nav__link> 3.Shell 参数 </a> </li> <li class=md-nav__item> <a href=../../shell/4.Shell%E6%95%B0%E7%BB%84/ class=md-nav__link> 4.Shell数组 </a> </li> <li class=md-nav__item> <a href=../../shell/5.Shell%E8%BF%90%E7%AE%97%E7%AC%A6/ class=md-nav__link> 5.Shell 运算符 </a> </li> <li class=md-nav__item> <a href=../../shell/6.Shell%20echo_printf%E5%91%BD%E4%BB%A4/ class=md-nav__link> 6.Shell echo/printf 命令 </a> </li> <li class=md-nav__item> <a href=../../shell/7.Shell%20test%E5%91%BD%E4%BB%A4/ class=md-nav__link> 7.Shell test 命令 </a> </li> <li class=md-nav__item> <a href=../../shell/8.Shell%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/ class=md-nav__link> 8.Shell 流程控制 </a> </li> <li class=md-nav__item> <a href=../../shell/9.Shell%E5%87%BD%E6%95%B0/ class=md-nav__link> 8.Shell 函数 </a> </li> <li class=md-nav__item> <a href=../../shell/10.Shell%E8%BE%93%E5%85%A5_%E8%BE%93%E5%87%BA%E9%87%8D%E5%AE%9A%E5%90%91/ class=md-nav__link> 10.Shell输入/输出重定向 </a> </li> <li class=md-nav__item> <a href=../../shell/11.Shell%20%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/ class=md-nav__link> 11.Shell 正则表达式 </a> </li> <li class=md-nav__item> <a href=../../shell/12.Shell%20%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bgrep/ class=md-nav__link> 12.Shell 三剑客之grep </a> </li> <li class=md-nav__item> <a href=../../shell/13.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/ class=md-nav__link> 13.Shell三剑客之sed </a> </li> <li class=md-nav__item> <a href=../../shell/14.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bawk/ class=md-nav__link> 14.Shell三剑客之awk </a> </li> <li class=md-nav__item> <a href=../../shell/15.Shell%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/ class=md-nav__link> 15.Shell常用工具 </a> </li> <li class=md-nav__item> <a href=../../shell/16.Shell%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/ class=md-nav__link> 16.Shell实战项目 </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#1-ansible-优化 class=md-nav__link> 1. Ansible 优化 </a> <nav class=md-nav aria-label="1. Ansible 优化"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#profile_tasks class=md-nav__link> Profile_tasks </a> </li> <li class=md-nav__item> <a href=#fork class=md-nav__link> Fork </a> </li> <li class=md-nav__item> <a href=#poll_interval class=md-nav__link> Poll_interval </a> </li> <li class=md-nav__item> <a href=#fact-cache class=md-nav__link> Fact cache </a> </li> <li class=md-nav__item> <a href=#gather_subset class=md-nav__link> Gather_subset </a> </li> <li class=md-nav__item> <a href=#ssh-连接参数 class=md-nav__link> SSH 连接参数 </a> </li> <li class=md-nav__item> <a href=#control_path class=md-nav__link> Control_path </a> </li> <li class=md-nav__item> <a href=#pipelinling class=md-nav__link> Pipelinling </a> </li> <li class=md-nav__item> <a href=#serial class=md-nav__link> Serial </a> </li> <li class=md-nav__item> <a href=#strategy class=md-nav__link> Strategy </a> </li> <li class=md-nav__item> <a href=#mitogen-strategy-插件 class=md-nav__link> mitogen strategy 插件 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2ansible-的常用设置 class=md-nav__link> 2.Ansible 的常用设置 </a> <nav class=md-nav aria-label="2.Ansible 的常用设置"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#ansiblecfg class=md-nav__link> ansible.cfg </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#3ansible-最佳实践 class=md-nav__link> 3.Ansible 最佳实践 </a> <nav class=md-nav aria-label="3.Ansible 最佳实践"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#如何写作 class=md-nav__link> 如何写作 </a> <nav class=md-nav aria-label=如何写作> <ul class=md-nav__list> <li class=md-nav__item> <a href=#像对待代码一样对待你的ansible class=md-nav__link> 像对待代码一样对待你的ansible </a> </li> <li class=md-nav__item> <a href=#不要使用个性化的书写方式 class=md-nav__link> 不要使用个性化的书写方式 </a> </li> <li class=md-nav__item> <a href=#使用git class=md-nav__link> 使用git </a> </li> <li class=md-nav__item> <a href=#inventory class=md-nav__link> inventory </a> </li> <li class=md-nav__item> <a href=#变量 class=md-nav__link> 变量 </a> </li> <li class=md-nav__item> <a href=#playbook class=md-nav__link> playbook </a> </li> <li class=md-nav__item> <a href=#使用block class=md-nav__link> 使用block </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#如何执行 class=md-nav__link> 如何执行 </a> <nav class=md-nav aria-label=如何执行> <ul class=md-nav__list> <li class=md-nav__item> <a href=#调试执行 class=md-nav__link> 调试执行 </a> </li> <li class=md-nav__item> <a href=#分析运行的内容 class=md-nav__link> 分析运行的内容 </a> </li> <li class=md-nav__item> <a href=#无主机清单的快速启动 class=md-nav__link> 无主机清单的快速启动 </a> </li> <li class=md-nav__item> <a href=#使用正确的工具 class=md-nav__link> 使用正确的工具 </a> </li> <li class=md-nav__item> <a href=#使用-roles-和-galaxy class=md-nav__link> 使用 Roles 和 Galaxy </a> </li> <li class=md-nav__item> <a href=#正确访问目标 class=md-nav__link> 正确访问目标 </a> </li> <li class=md-nav__item> <a href=#调试问题 class=md-nav__link> 调试问题 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#如何在生产中使用 class=md-nav__link> 如何在生产中使用 </a> <nav class=md-nav aria-label=如何在生产中使用> <ul class=md-nav__list> <li class=md-nav__item> <a href=#使用tower class=md-nav__link> 使用Tower </a> </li> <li class=md-nav__item> <a href=#使用ansible class=md-nav__link> 使用Ansible </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#4使用-ansible-lint class=md-nav__link> 4.使用 ansible-lint </a> <nav class=md-nav aria-label="4.使用 ansible-lint"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#安装 class=md-nav__link> 安装 </a> </li> <li class=md-nav__item> <a href=#使用 class=md-nav__link> 使用 </a> <nav class=md-nav aria-label=使用> <ul class=md-nav__list> <li class=md-nav__item> <a href=#检查roles class=md-nav__link> 检查roles </a> </li> <li class=md-nav__item> <a href=#检查playbook class=md-nav__link> 检查playbook </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#配置文件 class=md-nav__link> 配置文件 </a> </li> <li class=md-nav__item> <a href=#规则 class=md-nav__link> 规则 </a> <nav class=md-nav aria-label=规则> <ul class=md-nav__list> <li class=md-nav__item> <a href=#列出规则 class=md-nav__link> 列出规则 </a> </li> <li class=md-nav__item> <a href=#规则标记 class=md-nav__link> 规则标记 </a> </li> <li class=md-nav__item> <a href=#跳过规则 class=md-nav__link> 跳过规则 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#5使用动态主机 class=md-nav__link> 5.使用动态主机 </a> <nav class=md-nav aria-label=5.使用动态主机> <ul class=md-nav__list> <li class=md-nav__item> <a href=#脚本约定 class=md-nav__link> 脚本约定 </a> </li> <li class=md-nav__item> <a href=#简单例子 class=md-nav__link> 简单例子 </a> </li> <li class=md-nav__item> <a href=#脚本使用 class=md-nav__link> 脚本使用 </a> <nav class=md-nav aria-label=脚本使用> <ul class=md-nav__list> <li class=md-nav__item> <a href=#执行-ad-hoc-命令 class=md-nav__link> 执行 ad-hoc 命令 </a> </li> <li class=md-nav__item> <a href=#执行-playbook class=md-nav__link> 执行 playbook </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#插件使用 class=md-nav__link> 插件使用 </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=ansible进阶>Ansible进阶<a class=headerlink href=#ansible进阶 title="Permanent link">&para;</a></h1> <h2 id=1-ansible-优化>1. Ansible 优化<a class=headerlink href=#1-ansible-优化 title="Permanent link">&para;</a></h2> <p>Ansible 默认情况下，没有做任何的优化。通过下列的几种方式，可以在执行效率，时间上做进一步的优化。</p> <h3 id=profile_tasks>Profile_tasks<a class=headerlink href=#profile_tasks title="Permanent link">&para;</a></h3> <p>开启Ansible任务的执行时间, 可有助于我们了解playbook中的task任务执行时间，以便于后续优化。</p> <p>在 <code>ansible.cfg</code> 中配置</p> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=k>[defaults]</span>
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=na>callback_whitelist</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>timer, profile_tasks</span>
</code></pre></div> <h3 id=fork>Fork<a class=headerlink href=#fork title="Permanent link">&para;</a></h3> <p>Ansible 默认情况下，并行执行的数量是<code>5</code>，对于较多的节点，就需要扩大这个并行数量。</p> <blockquote> <p>Fork 数量越大对控制节点的cpu消耗越高。</p> </blockquote> <p>在 <code>ansible.cfg</code> 中配置</p> <div class=highlight><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=k>[defaults]</span>
<a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=na>forks</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>20</span>
</code></pre></div> <h3 id=poll_interval>Poll_interval<a class=headerlink href=#poll_interval title="Permanent link">&para;</a></h3> <p>降低轮询间隔时间，有助于加快获取任务结果。</p> <p>在 <code>ansible.cfg</code> 中配置</p> <div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=k>[defaults]</span>
<a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=na>poll_interval</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=s>1</span>
<a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a><span class=na>internal_poll_interval</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>0.001</span>
</code></pre></div> <h3 id=fact-cache>Fact cache<a class=headerlink href=#fact-cache title="Permanent link">&para;</a></h3> <p>将 Facts 信息第一次收集后缓存到memory或者redis或者文件中，从而为后续执行减少收集时间。</p> <p>在 <code>ansible.cfg</code> 中配置</p> <div class=highlight><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=k>[defaults]</span>
<a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=na>fact_caching</span><span class=w>            </span><span class=o>=</span><span class=w> </span><span class=s>jsonfile</span>
<a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a><span class=na>fact_caching_connection</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>/tmp/.ansible_fact_cache</span>
</code></pre></div> <h3 id=gather_subset>Gather_subset<a class=headerlink href=#gather_subset title="Permanent link">&para;</a></h3> <p>可选择性的收集network,hardware等信息，而不是全部</p> <p>在 <code>ansible.cfg</code> 中配置</p> <div class=highlight><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=c1># 在配置文件中,排除收集</span>
<a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=k>[defaults]</span>
<a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a><span class=na>gather_subset</span><span class=o>=</span><span class=s>!hardware</span>
</code></pre></div> <p>也可以在在play中定义</p> <div class=highlight><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=c1># 不收集数据</span>
<a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>hosts</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">whatever</span>
<a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=w>  </span><span class=nt>gather_facts</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">no</span>
<a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a>
<a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a><span class=c1># 只收集minimal</span>
<a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>hosts</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
<a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a><span class=w>  </span><span class=nt>gather_facts</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
<a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a><span class=w>  </span><span class=nt>pre_tasks</span><span class=p>:</span>
<a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a><span class=w>   </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>setup</span><span class=p>:</span>
<a id=__codelineno-5-10 name=__codelineno-5-10 href=#__codelineno-5-10></a><span class=w>      </span><span class=nt>gather_subset</span><span class=p>:</span>
<a id=__codelineno-5-11 name=__codelineno-5-11 href=#__codelineno-5-11></a><span class=w>       </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&#39;!all&#39;</span>
</code></pre></div> <h3 id=ssh-连接参数>SSH 连接参数<a class=headerlink href=#ssh-连接参数 title="Permanent link">&para;</a></h3> <p>增加control_path的使用时间</p> <p>在 <code>ansible.cfg</code> 中配置</p> <div class=highlight><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=k>[ssh_connection]</span>
<a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=na>ssh_args</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>-o ControlMaster=auto -o ControlPersist=1800s</span>
</code></pre></div> <p>默认ssh的认证方式会有 <code>-o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey</code>, 如果只有publickey一种方式认证，可以只指定publickey <code>-o PreferredAuthentications=publickey</code></p> <h3 id=control_path>Control_path<a class=headerlink href=#control_path title="Permanent link">&para;</a></h3> <p>开启ssh socket持久化，复用ssh连接。</p> <p>在 <code>ansible.cfg</code> 中配置</p> <div class=highlight><pre><span></span><code><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=k>[ssh_connection]</span>
<a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a><span class=na>control_path</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>%(directory)s/ansible-ssh-%%h-%%p-%%r</span>
</code></pre></div> <h3 id=pipelinling>Pipelinling<a class=headerlink href=#pipelinling title="Permanent link">&para;</a></h3> <p>开启ssh pipelining,客户端从管道中读取执行渲染后的脚本，而不是在客户端创建临时文件。</p> <p>在 <code>ansible.cfg</code> 中配置</p> <div class=highlight><pre><span></span><code><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=k>[ssh_connection]</span>
<a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a><span class=na>pipelining</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>True</span>
</code></pre></div> <h3 id=serial>Serial<a class=headerlink href=#serial title="Permanent link">&para;</a></h3> <p>将play_hosts中主机再分批执行,降低控制机的cpu使用</p> <div class=highlight><pre><span></span><code><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>hosts</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">whatever</span>
<a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a><span class=w>  </span><span class="l l-Scalar l-Scalar-Plain">serial：50%</span>
</code></pre></div> <h3 id=strategy>Strategy<a class=headerlink href=#strategy title="Permanent link">&para;</a></h3> <p>默认linear,每个主机的单个task执行完成会等待其他都完成后再执行下个任务，设置free可不等待其他主机。 <div class=highlight><pre><span></span><code><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>hosts</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">web-servers</span>
<a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a><span class=w>  </span><span class=nt>strategy</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">linear</span>
</code></pre></div></p> <h3 id=mitogen-strategy-插件>mitogen strategy 插件<a class=headerlink href=#mitogen-strategy-插件 title="Permanent link">&para;</a></h3> <p>提高ansible的执行效率，比原生执行速度提高1.25x-7x，CPU减少2倍的使用。</p> <p>下载 <div class=highlight><pre><span></span><code><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a>wget<span class=w> </span>https://networkgenomics.com/try/mitogen-0.2.9.tar.gz
<a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a>tar<span class=w> </span>zxf<span class=w> </span>mitogen-0.2.9.tar.gz<span class=w> </span>/path/to/
</code></pre></div></p> <p>在 <code>ansible.cfg</code> 中配置 <div class=highlight><pre><span></span><code><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=k>[defaults]</span>
<a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a><span class=na>strategy_plugins</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>/path/to/mitogen-0.2.9/ansible_mitogen/plugins/strategy</span>
<a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a><span class=na>strategy</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>mitogen_linear</span>
</code></pre></div></p> <p>也可在play中设置</p> <div class=highlight><pre><span></span><code><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>hosts</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">web-servers</span>
<a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a><span class=w>  </span><span class=nt>strategy</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">mitogen_linear</span>
</code></pre></div> <p>执行</p> <div class=highlight><pre><span></span><code><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=nv>ANSIBLE_STRATEGY_PLUGINS</span><span class=o>=</span>/path/to/mitogen-0.2.9/ansible_mitogen/plugins/strategy<span class=w> </span>ansible-playbook<span class=w> </span>test.yaml
</code></pre></div> <p>更多内容见<a href=https://mitogen.networkgenomics.com/ansible_detailed.html>mitogen介绍</a></p> <h2 id=2ansible-的常用设置>2.Ansible 的常用设置<a class=headerlink href=#2ansible-的常用设置 title="Permanent link">&para;</a></h2> <h3 id=ansiblecfg>ansible.cfg<a class=headerlink href=#ansiblecfg title="Permanent link">&para;</a></h3> <p>下列列出了常用的一些设置，可用作参考。</p> <div class=highlight><pre><span></span><code><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a><span class=c1># /etc/ansible/ansible.cfg</span>
<a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a>
<a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a><span class=k>[defaults]</span>
<a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a><span class=c1># Set the log_path</span>
<a id=__codelineno-15-5 name=__codelineno-15-5 href=#__codelineno-15-5></a><span class=na>log_path</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>~/ansible.log</span>
<a id=__codelineno-15-6 name=__codelineno-15-6 href=#__codelineno-15-6></a>
<a id=__codelineno-15-7 name=__codelineno-15-7 href=#__codelineno-15-7></a><span class=c1># Additional default options for Ansible</span>
<a id=__codelineno-15-8 name=__codelineno-15-8 href=#__codelineno-15-8></a><span class=na>forks</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>20</span>
<a id=__codelineno-15-9 name=__codelineno-15-9 href=#__codelineno-15-9></a><span class=na>host_key_checking</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>False</span>
<a id=__codelineno-15-10 name=__codelineno-15-10 href=#__codelineno-15-10></a><span class=na>retry_files_enabled</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>False</span>
<a id=__codelineno-15-11 name=__codelineno-15-11 href=#__codelineno-15-11></a><span class=na>retry_files_save_path</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>~/ansible-installer-retries</span>
<a id=__codelineno-15-12 name=__codelineno-15-12 href=#__codelineno-15-12></a><span class=na>nocows</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>True</span>
<a id=__codelineno-15-13 name=__codelineno-15-13 href=#__codelineno-15-13></a><span class=na>remote_user</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>root</span>
<a id=__codelineno-15-14 name=__codelineno-15-14 href=#__codelineno-15-14></a><span class=na>roles_path</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>roles/</span>
<a id=__codelineno-15-15 name=__codelineno-15-15 href=#__codelineno-15-15></a><span class=na>gathering</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>smart</span>
<a id=__codelineno-15-16 name=__codelineno-15-16 href=#__codelineno-15-16></a><span class=na>fact_caching</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>jsonfile</span>
<a id=__codelineno-15-17 name=__codelineno-15-17 href=#__codelineno-15-17></a><span class=na>fact_caching_connection</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>$HOME/ansible/facts</span>
<a id=__codelineno-15-18 name=__codelineno-15-18 href=#__codelineno-15-18></a><span class=na>fact_caching_timeout</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>600</span>
<a id=__codelineno-15-19 name=__codelineno-15-19 href=#__codelineno-15-19></a><span class=na>callback_whitelist</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>profile_tasks</span>
<a id=__codelineno-15-20 name=__codelineno-15-20 href=#__codelineno-15-20></a><span class=na>inventory_ignore_extensions</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>secrets.py, .pyc, .cfg, .crt, .ini</span>
<a id=__codelineno-15-21 name=__codelineno-15-21 href=#__codelineno-15-21></a><span class=c1># work around privilege escalation timeouts in ansible:</span>
<a id=__codelineno-15-22 name=__codelineno-15-22 href=#__codelineno-15-22></a><span class=na>timeout</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>30</span>
<a id=__codelineno-15-23 name=__codelineno-15-23 href=#__codelineno-15-23></a><span class=na>host_key_checking</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>False</span>
<a id=__codelineno-15-24 name=__codelineno-15-24 href=#__codelineno-15-24></a>
<a id=__codelineno-15-25 name=__codelineno-15-25 href=#__codelineno-15-25></a><span class=c1># Uncomment to use the provided example inventory</span>
<a id=__codelineno-15-26 name=__codelineno-15-26 href=#__codelineno-15-26></a><span class=c1>#inventory = inventory/hosts.example</span>
<a id=__codelineno-15-27 name=__codelineno-15-27 href=#__codelineno-15-27></a>
<a id=__codelineno-15-28 name=__codelineno-15-28 href=#__codelineno-15-28></a><span class=na>ansible_managed</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>Ansible managed: {file} modified by {uid} on {host}</span>
<a id=__codelineno-15-29 name=__codelineno-15-29 href=#__codelineno-15-29></a>
<a id=__codelineno-15-30 name=__codelineno-15-30 href=#__codelineno-15-30></a><span class=k>[inventory]</span>
<a id=__codelineno-15-31 name=__codelineno-15-31 href=#__codelineno-15-31></a><span class=c1># fail more helpfully when the inventory file does not parse (Ansible 2.4+)</span>
<a id=__codelineno-15-32 name=__codelineno-15-32 href=#__codelineno-15-32></a><span class=na>unparsed_is_failed</span><span class=o>=</span><span class=s>true</span>
<a id=__codelineno-15-33 name=__codelineno-15-33 href=#__codelineno-15-33></a>
<a id=__codelineno-15-34 name=__codelineno-15-34 href=#__codelineno-15-34></a><span class=c1># Additional ssh options for OpenShift Ansible</span>
<a id=__codelineno-15-35 name=__codelineno-15-35 href=#__codelineno-15-35></a><span class=k>[ssh_connection]</span>
<a id=__codelineno-15-36 name=__codelineno-15-36 href=#__codelineno-15-36></a><span class=na>retries</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>15</span>
<a id=__codelineno-15-37 name=__codelineno-15-37 href=#__codelineno-15-37></a><span class=na>pipelining</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>True</span>
<a id=__codelineno-15-38 name=__codelineno-15-38 href=#__codelineno-15-38></a><span class=na>ssh_args</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>-o ControlMaster=auto -o ControlPersist=600s</span>
<a id=__codelineno-15-39 name=__codelineno-15-39 href=#__codelineno-15-39></a><span class=na>timeout</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>10</span>
<a id=__codelineno-15-40 name=__codelineno-15-40 href=#__codelineno-15-40></a><span class=c1># shorten the ControlPath which is often too long; when it is,</span>
<a id=__codelineno-15-41 name=__codelineno-15-41 href=#__codelineno-15-41></a><span class=c1># ssh connection reuse silently fails, making everything slower.</span>
<a id=__codelineno-15-42 name=__codelineno-15-42 href=#__codelineno-15-42></a><span class=na>control_path</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>%(directory)s/%%h-%%r</span>
</code></pre></div> <h2 id=3ansible-最佳实践>3.Ansible 最佳实践<a class=headerlink href=#3ansible-最佳实践 title="Permanent link">&para;</a></h2> <p>介绍下ansible如何写作，如何执行，如何在生产中使用。</p> <h3 id=如何写作>如何写作<a class=headerlink href=#如何写作 title="Permanent link">&para;</a></h3> <h4 id=像对待代码一样对待你的ansible>像对待代码一样对待你的ansible<a class=headerlink href=#像对待代码一样对待你的ansible title="Permanent link">&para;</a></h4> <ul> <li>拥有版本控制</li> <li>拥有可重复性</li> <li>从基本的playbook目录结构和静态的主机清单来构建roles</li> <li>后续可以自己开发模块和插件</li> </ul> <h4 id=不要使用个性化的书写方式>不要使用个性化的书写方式<a class=headerlink href=#不要使用个性化的书写方式 title="Permanent link">&para;</a></h4> <ol> <li> <p>为你的风格创建一个标准</p> </li> <li> <p>使用标签</p> </li> <li>使用一致的空格缩进</li> <li>任务、角色、变量和角色的语义化命名</li> <li> <p>目录结构</p> </li> <li> <p>执行的风格</p> </li> <li> <p>先检查语法</p> </li> <li>列出执行主机</li> <li>列出tasks任务</li> <li> <p>再去执行</p> </li> <li> <p>一个很好的<a href=https://github.com/openshift/openshift-ansible/blob/master/docs/style_guide.adoc>openshift-ansible</a>风格</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p><strong>python</strong></p> <p><strong>Python最大行长度</strong></p> <ul> <li>所有行不应超过80个字符。</li> <li>所有的行必须不超过120个字符。</li> </ul> <p><strong>ansible</strong></p> <p><strong>Ansible Yaml 文件扩展名称</strong></p> <ul> <li>所有Ansible Yaml文件必须是一个<code>.yml</code>扩展名(而不是<code>.YML</code>，<code>.yaml</code>等)。 </li> </ul> <p><strong>Ansible CLI变量</strong></p> <ul> <li>要从ansible CLI传递进来的变量必须有一个<code>cli_</code>前缀</li> </ul> <p><strong>Ansible全局变量</strong></p> <ul> <li>全局变量的前缀必须是<code>g_</code></li> </ul> <p><strong>Ansible角色变量</strong></p> <ul> <li>角色变量必须有至少3个字符的前缀。请参阅下面的特定命名规则。</li> </ul> <p><strong>角色名称中包含3个(或更多)单词</strong></p> <p>以每个单词的第一个字母为例。</p> <p>3字符的示例：</p> <ul> <li>Role name: made_up_role</li> <li>Prefix: mur</li> </ul> <div class=highlight><pre><span></span><code><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a>mur_var1: value_one
</code></pre></div> <p>4字符的示例:</p> <ul> <li>Role name: totally_made_up_role</li> <li>Prefix: tmur</li> </ul> <div class=highlight><pre><span></span><code><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a>tmur_var1: value_one
</code></pre></div> <p><strong>角色名称中有两个(或少于两个)单词</strong></p> <p>编一个有意义的前缀。 1 单词的示例:</p> <ul> <li>Role name: ansible</li> <li>Prefix: ans</li> </ul> <div class=highlight><pre><span></span><code><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a>ans_var1: value_one
</code></pre></div> <p>2 单词的示例:</p> <ul> <li>Role name: ansible_tower</li> <li>Prefix: tow</li> </ul> <div class=highlight><pre><span></span><code><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a>tow_var1: value_one
</code></pre></div> <p><strong>角色名称前缀冲突</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>hosts</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">localhost</span>
<a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a><span class=w>  </span><span class=nt>roles</span><span class=p>:</span>
<a id=__codelineno-20-3 name=__codelineno-20-3 href=#__codelineno-20-3></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="p p-Indicator">{</span><span class=nt> role</span><span class=p>:</span><span class=w> </span><span class=nv>made_up_role</span><span class="p p-Indicator">,</span><span class=nt> mur_var1</span><span class=p>:</span><span class=w> </span><span class=nv>val1</span><span class=w> </span><span class="p p-Indicator">}</span>
<a id=__codelineno-20-4 name=__codelineno-20-4 href=#__codelineno-20-4></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="p p-Indicator">{</span><span class=nt> role</span><span class=p>:</span><span class=w> </span><span class=nv>my_uber_role</span><span class="p p-Indicator">,</span><span class=nt> mur_var1</span><span class=p>:</span><span class=w> </span><span class=nv>val2</span><span class=w> </span><span class="p p-Indicator">}</span>
</code></pre></div> <p>即使两个角色都具有相同的前缀（mur），并且即使两个角色都有一个名为mur_var1的变量，因为 <strong>角色变量被限制在角色本身</strong>，这两个变量也永远不会存在于各自的角色之外。意味着这不是问题。</p> <p>仅当my_uber_role取决于made_up_role时才有问题，反之亦然。 或者，如果这两个角色中的任何一个都包含另一个角色。</p> <p>当然，这是一个极不可能发生的极端情况。 如果是这样，请另当处理。</p> </div> </li> </ol> <h4 id=使用git>使用git<a class=headerlink href=#使用git title="Permanent link">&para;</a></h4> <p>每个分享的playbook都需要有一致的目录结构，并且使用git仓库存储记录每一次提交。</p> <div class=highlight><pre><span></span><code><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a>site.yml                  # 主要的playbook，可以调用其他playbook
<a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a>webservers.yml            # webserver使用的 playbook
<a id=__codelineno-21-3 name=__codelineno-21-3 href=#__codelineno-21-3></a>deployonce.yml            # 适用于一次性部署的 playbook
<a id=__codelineno-21-4 name=__codelineno-21-4 href=#__codelineno-21-4></a>inventories/
<a id=__codelineno-21-5 name=__codelineno-21-5 href=#__codelineno-21-5></a>    production/           # 通过不同环境来区分主机清单      
<a id=__codelineno-21-6 name=__codelineno-21-6 href=#__codelineno-21-6></a>        hosts             # 生产服务器的主机清单文件
<a id=__codelineno-21-7 name=__codelineno-21-7 href=#__codelineno-21-7></a>        group_vars/       
<a id=__codelineno-21-8 name=__codelineno-21-8 href=#__codelineno-21-8></a>        host_vars/   
<a id=__codelineno-21-9 name=__codelineno-21-9 href=#__codelineno-21-9></a>    london/               # 其他的分组主机清单
<a id=__codelineno-21-10 name=__codelineno-21-10 href=#__codelineno-21-10></a>roles/    
<a id=__codelineno-21-11 name=__codelineno-21-11 href=#__codelineno-21-11></a>    requirements.yml      # 依赖的其他角色   
<a id=__codelineno-21-12 name=__codelineno-21-12 href=#__codelineno-21-12></a>    common/               # 基本配置 
<a id=__codelineno-21-13 name=__codelineno-21-13 href=#__codelineno-21-13></a>    webtier/              # 用于特定功能的角色
</code></pre></div> <h4 id=inventory>inventory<a class=headerlink href=#inventory title="Permanent link">&para;</a></h4> <p><strong>使用别名给主机节点起一个有意义的名字</strong></p> <table> <thead> <tr> <th>主机</th> <th>有意义的名称</th> </tr> </thead> <tbody> <tr> <td>10.1.2.75<br>10.1.5.45<br>10.1.4.5<br>10.1.0.40</td> <td>db1 ansible_host=10.1.2.75<br>db2 ansible_host=10.1.5.45<br>db3 ansible_host=10.1.4.5<br>db4 ansible_host=10.1.0.40</td> </tr> <tr> <td>w14301.acme.com<br>w17802.acme.com<br>w19203.acme.com<br>w19304.acme.com</td> <td>web1 ansible_host=w14301.acme.com<br>web2 ansible_host=w17802.acme.com<br>web3 ansible_host=w19203.acme.com<br>web4 ansible_host=w19203.acme.com</td> </tr> </tbody> </table> <p><strong>给主机分配不同用途的组，以便于不同情况下的批量使用</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a><span class=c1># 按服务类型</span>
<a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a><span class=k>[db]</span>
<a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a><span class=na>db[1</span><span class=o>:</span><span class=s>4]</span>
<a id=__codelineno-22-4 name=__codelineno-22-4 href=#__codelineno-22-4></a>
<a id=__codelineno-22-5 name=__codelineno-22-5 href=#__codelineno-22-5></a><span class=k>[web]</span>
<a id=__codelineno-22-6 name=__codelineno-22-6 href=#__codelineno-22-6></a><span class=na>web[1</span><span class=o>:</span><span class=s>4]</span>
<a id=__codelineno-22-7 name=__codelineno-22-7 href=#__codelineno-22-7></a>
<a id=__codelineno-22-8 name=__codelineno-22-8 href=#__codelineno-22-8></a><span class=c1># 按环境</span>
<a id=__codelineno-22-9 name=__codelineno-22-9 href=#__codelineno-22-9></a><span class=k>[dev]</span>
<a id=__codelineno-22-10 name=__codelineno-22-10 href=#__codelineno-22-10></a><span class=na>db1</span>
<a id=__codelineno-22-11 name=__codelineno-22-11 href=#__codelineno-22-11></a><span class=na>web1</span>
<a id=__codelineno-22-12 name=__codelineno-22-12 href=#__codelineno-22-12></a>
<a id=__codelineno-22-13 name=__codelineno-22-13 href=#__codelineno-22-13></a><span class=k>[testing]</span>
<a id=__codelineno-22-14 name=__codelineno-22-14 href=#__codelineno-22-14></a><span class=na>db3</span>
<a id=__codelineno-22-15 name=__codelineno-22-15 href=#__codelineno-22-15></a><span class=na>web3</span>
<a id=__codelineno-22-16 name=__codelineno-22-16 href=#__codelineno-22-16></a>
<a id=__codelineno-22-17 name=__codelineno-22-17 href=#__codelineno-22-17></a><span class=k>[prod]</span>
<a id=__codelineno-22-18 name=__codelineno-22-18 href=#__codelineno-22-18></a><span class=na>db2</span>
<a id=__codelineno-22-19 name=__codelineno-22-19 href=#__codelineno-22-19></a><span class=na>web2</span>
<a id=__codelineno-22-20 name=__codelineno-22-20 href=#__codelineno-22-20></a><span class=na>db4</span>
<a id=__codelineno-22-21 name=__codelineno-22-21 href=#__codelineno-22-21></a><span class=na>web4</span>
<a id=__codelineno-22-22 name=__codelineno-22-22 href=#__codelineno-22-22></a>
<a id=__codelineno-22-23 name=__codelineno-22-23 href=#__codelineno-22-23></a><span class=c1># 按区域</span>
<a id=__codelineno-22-24 name=__codelineno-22-24 href=#__codelineno-22-24></a><span class=k>[east]</span>
<a id=__codelineno-22-25 name=__codelineno-22-25 href=#__codelineno-22-25></a><span class=na>db1</span>
<a id=__codelineno-22-26 name=__codelineno-22-26 href=#__codelineno-22-26></a><span class=na>web1</span>
<a id=__codelineno-22-27 name=__codelineno-22-27 href=#__codelineno-22-27></a><span class=na>db3</span>
<a id=__codelineno-22-28 name=__codelineno-22-28 href=#__codelineno-22-28></a><span class=na>web3</span>
<a id=__codelineno-22-29 name=__codelineno-22-29 href=#__codelineno-22-29></a>
<a id=__codelineno-22-30 name=__codelineno-22-30 href=#__codelineno-22-30></a><span class=k>[west]</span>
<a id=__codelineno-22-31 name=__codelineno-22-31 href=#__codelineno-22-31></a><span class=na>db2</span>
<a id=__codelineno-22-32 name=__codelineno-22-32 href=#__codelineno-22-32></a><span class=na>web2</span>
<a id=__codelineno-22-33 name=__codelineno-22-33 href=#__codelineno-22-33></a><span class=na>db4</span>
<a id=__codelineno-22-34 name=__codelineno-22-34 href=#__codelineno-22-34></a><span class=na>web4</span>
</code></pre></div> <p><strong>尽可能使用动态源。要么作为单一来源，要么让Ansible统一多个来源</strong></p> <ul> <li>自动保持清单同步</li> <li>减少人为的错误</li> <li>变化发生时没有延迟</li> <li>让其他人管理主机清单</li> </ul> <h4 id=变量>变量<a class=headerlink href=#变量 title="Permanent link">&para;</a></h4> <p>合适的变量名可以使playbook更具可读性，并避免变量名冲突。</p> <div class=highlight><pre><span></span><code><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a><span class=c1># 看不懂的变量名称</span>
<a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a><span class=nt>a</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">25</span>
<a id=__codelineno-23-3 name=__codelineno-23-3 href=#__codelineno-23-3></a><span class=nt>data</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ab</span>
<a id=__codelineno-23-4 name=__codelineno-23-4 href=#__codelineno-23-4></a><span class=nt>data2</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">abc</span>
<a id=__codelineno-23-5 name=__codelineno-23-5 href=#__codelineno-23-5></a><span class=nt>id</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">123</span>
<a id=__codelineno-23-6 name=__codelineno-23-6 href=#__codelineno-23-6></a>
<a id=__codelineno-23-7 name=__codelineno-23-7 href=#__codelineno-23-7></a><span class=c1># 一眼就能看懂的变量用途</span>
<a id=__codelineno-23-8 name=__codelineno-23-8 href=#__codelineno-23-8></a><span class=nt>apache_max_keepalive</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">25</span>
<a id=__codelineno-23-9 name=__codelineno-23-9 href=#__codelineno-23-9></a><span class=nt>apache_port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<a id=__codelineno-23-10 name=__codelineno-23-10 href=#__codelineno-23-10></a><span class=nt>tomcat_port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
</code></pre></div> <p>通过将角色名作为前缀添加到变量中来避免冲突和混淆。</p> <div class=highlight><pre><span></span><code><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a><span class=nt>apache_max_keepalive</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">25</span>
<a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a><span class=nt>apache_port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<a id=__codelineno-24-3 name=__codelineno-24-3 href=#__codelineno-24-3></a><span class=nt>tomcat_port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
</code></pre></div> <p>为变量设置在合适的位置</p> <ul> <li> <p>根据变量的设置，修改地点和时间，为变量找到合适的位置</p> </li> <li> <p>将逻辑(任务)与变量分离，减少重复模式</p> </li> <li> <p>不要利用每一种可能性来存储变量- 将其固定到一个已定义的方案中，并尽可能减少存储位置</p> </li> </ul> <h4 id=playbook>playbook<a class=headerlink href=#playbook title="Permanent link">&para;</a></h4> <p><strong>使用YAML语法</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">install telegraf</span>
<a id=__codelineno-25-2 name=__codelineno-25-2 href=#__codelineno-25-2></a><span class=w>  </span><span class=nt>yum</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">name=telegraf-{{ telegraf_version }} state=present update_cache=yes enablerepo=telegraf</span>
<a id=__codelineno-25-3 name=__codelineno-25-3 href=#__codelineno-25-3></a><span class=w>  </span><span class=nt>notify</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">restart telegraf</span>
<a id=__codelineno-25-4 name=__codelineno-25-4 href=#__codelineno-25-4></a>
<a id=__codelineno-25-5 name=__codelineno-25-5 href=#__codelineno-25-5></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">start telegraf</span>
<a id=__codelineno-25-6 name=__codelineno-25-6 href=#__codelineno-25-6></a><span class=w>  </span><span class=nt>service</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">name=telegraf state=started</span>
</code></pre></div> <p>上面的方式是不可取的，需要使用<code>KEY:VALUE</code>的形式</p> <div class=highlight><pre><span></span><code><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">install telegraf</span>
<a id=__codelineno-26-2 name=__codelineno-26-2 href=#__codelineno-26-2></a><span class=w>  </span><span class=nt>yum</span><span class=p>:</span>
<a id=__codelineno-26-3 name=__codelineno-26-3 href=#__codelineno-26-3></a><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;telegraf-{{</span><span class=nv> </span><span class=s>telegraf_version</span><span class=nv> </span><span class=s>}}&quot;</span>
<a id=__codelineno-26-4 name=__codelineno-26-4 href=#__codelineno-26-4></a><span class=w>    </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
<a id=__codelineno-26-5 name=__codelineno-26-5 href=#__codelineno-26-5></a><span class=w>    </span><span class=nt>update_cache</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<a id=__codelineno-26-6 name=__codelineno-26-6 href=#__codelineno-26-6></a><span class=w>    </span><span class=nt>enablerepo</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">telegraf</span>
<a id=__codelineno-26-7 name=__codelineno-26-7 href=#__codelineno-26-7></a><span class=w>    </span><span class=nt>notify</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">restart telegraf</span>
<a id=__codelineno-26-8 name=__codelineno-26-8 href=#__codelineno-26-8></a>
<a id=__codelineno-26-9 name=__codelineno-26-9 href=#__codelineno-26-9></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">start telegraf</span><span class=w>  </span>
<a id=__codelineno-26-10 name=__codelineno-26-10 href=#__codelineno-26-10></a><span class=w>  </span><span class=nt>service</span><span class=p>:</span><span class=w>    </span>
<a id=__codelineno-26-11 name=__codelineno-26-11 href=#__codelineno-26-11></a><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">telegraf</span>
<a id=__codelineno-26-12 name=__codelineno-26-12 href=#__codelineno-26-12></a><span class=w>    </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">started</span>
</code></pre></div> <p><strong>不要忽略任务名</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>hosts</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">web</span>
<a id=__codelineno-27-2 name=__codelineno-27-2 href=#__codelineno-27-2></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">installs and starts apache</span>
<a id=__codelineno-27-3 name=__codelineno-27-3 href=#__codelineno-27-3></a>
<a id=__codelineno-27-4 name=__codelineno-27-4 href=#__codelineno-27-4></a><span class=w>  </span><span class=nt>tasks</span><span class=p>:</span>
<a id=__codelineno-27-5 name=__codelineno-27-5 href=#__codelineno-27-5></a><span class=w>   </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">install apache packages</span>
<a id=__codelineno-27-6 name=__codelineno-27-6 href=#__codelineno-27-6></a><span class=w>     </span><span class=nt>yum</span><span class=p>:</span>
<a id=__codelineno-27-7 name=__codelineno-27-7 href=#__codelineno-27-7></a><span class=w>       </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">httpd</span>
<a id=__codelineno-27-8 name=__codelineno-27-8 href=#__codelineno-27-8></a><span class=w>       </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">latest</span>
<a id=__codelineno-27-9 name=__codelineno-27-9 href=#__codelineno-27-9></a>
<a id=__codelineno-27-10 name=__codelineno-27-10 href=#__codelineno-27-10></a><span class=w>   </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">starts apache service</span>
<a id=__codelineno-27-11 name=__codelineno-27-11 href=#__codelineno-27-11></a><span class=w>     </span><span class=nt>service</span><span class=p>:</span>
<a id=__codelineno-27-12 name=__codelineno-27-12 href=#__codelineno-27-12></a><span class=w>       </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">httpd</span><span class=w>        </span>
<a id=__codelineno-27-13 name=__codelineno-27-13 href=#__codelineno-27-13></a><span class=w>       </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
</code></pre></div> <p>为每个任务指定<code>name</code>,可以友好的输出执行信息</p> <div class=highlight><pre><span></span><code><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a>PLAY<span class=w> </span><span class=o>[</span>install<span class=w> </span>and<span class=w> </span>starts<span class=w> </span>apache<span class=o>]</span><span class=w> </span>********************************
<a id=__codelineno-28-2 name=__codelineno-28-2 href=#__codelineno-28-2></a>TASK<span class=w> </span><span class=o>[</span>setup<span class=o>]</span><span class=w> </span>********************************
<a id=__codelineno-28-3 name=__codelineno-28-3 href=#__codelineno-28-3></a>ok:<span class=w> </span><span class=o>[</span>web1<span class=o>]</span>
<a id=__codelineno-28-4 name=__codelineno-28-4 href=#__codelineno-28-4></a>TASK<span class=w> </span><span class=o>[</span>install<span class=w> </span>apache<span class=w> </span>packages<span class=o>]</span><span class=w> </span>********************************
<a id=__codelineno-28-5 name=__codelineno-28-5 href=#__codelineno-28-5></a>ok:<span class=w> </span><span class=o>[</span>web1<span class=o>]</span>
<a id=__codelineno-28-6 name=__codelineno-28-6 href=#__codelineno-28-6></a>TASK<span class=w> </span><span class=o>[</span>starts<span class=w> </span>apache<span class=w> </span>service<span class=o>]</span><span class=w> </span>********************************
<a id=__codelineno-28-7 name=__codelineno-28-7 href=#__codelineno-28-7></a>ok:<span class=w> </span><span class=o>[</span>web1<span class=o>]</span>
</code></pre></div> <h4 id=使用block>使用block<a class=headerlink href=#使用block title="Permanent link">&para;</a></h4> <p>block可以帮助组织代码，还可以启用回滚或输出数据以进行关键性更改。</p> <div class=highlight><pre><span></span><code><a id=__codelineno-29-1 name=__codelineno-29-1 href=#__codelineno-29-1></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>block</span><span class=p>:</span>
<a id=__codelineno-29-2 name=__codelineno-29-2 href=#__codelineno-29-2></a><span class=w>    </span><span class=nt>copy</span><span class=p>:</span>
<a id=__codelineno-29-3 name=__codelineno-29-3 href=#__codelineno-29-3></a><span class=w>      </span><span class=nt>src</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">critical.conf</span>
<a id=__codelineno-29-4 name=__codelineno-29-4 href=#__codelineno-29-4></a><span class=w>      </span><span class=nt>dest</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/etc/critical/crit.conf</span>
<a id=__codelineno-29-5 name=__codelineno-29-5 href=#__codelineno-29-5></a><span class=w>    </span><span class=nt>service</span><span class=p>:</span>
<a id=__codelineno-29-6 name=__codelineno-29-6 href=#__codelineno-29-6></a><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">critical</span>
<a id=__codelineno-29-7 name=__codelineno-29-7 href=#__codelineno-29-7></a><span class=w>      </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">restarted</span>
<a id=__codelineno-29-8 name=__codelineno-29-8 href=#__codelineno-29-8></a><span class=w>  </span><span class=nt>rescue</span><span class=p>:</span>
<a id=__codelineno-29-9 name=__codelineno-29-9 href=#__codelineno-29-9></a><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">shutdown -h now</span>
</code></pre></div> <h3 id=如何执行>如何执行<a class=headerlink href=#如何执行 title="Permanent link">&para;</a></h3> <h4 id=调试执行>调试执行<a class=headerlink href=#调试执行 title="Permanent link">&para;</a></h4> <p>Ansible为命令行交互和故障排除提供多个选项</p> <ul> <li><code>-vvvv</code> 打印debug信息</li> <li><code>--step</code> 一步一步的执行,每次执行前需要手动确认(ansible-playbook 命令)</li> <li><code>--check</code> 执行检查，并不修改目标</li> <li><code>--diff</code> 对比执行结果</li> <li><code>--start-at-task</code> 从哪一个任务开始执行</li> </ul> <h4 id=分析运行的内容>分析运行的内容<a class=headerlink href=#分析运行的内容 title="Permanent link">&para;</a></h4> <p>Ansible 提供了许多选项来显示你将要运行的内容</p> <ul> <li><code>--list-tasks</code> 列出运行的任务</li> <li><code>--list-tags</code> 列出运行的tag</li> <li><code>--list-hosts</code> 列出运行的主机</li> <li><code>--syntax-check</code> 执行语法检测</li> </ul> <h4 id=无主机清单的快速启动>无主机清单的快速启动<a class=headerlink href=#无主机清单的快速启动 title="Permanent link">&para;</a></h4> <p>如果需要对一些没有在主机清单中定义的主机，可以使用以下命令快速启动</p> <ul> <li> <p>单次任务</p> <div class=highlight><pre><span></span><code><a id=__codelineno-30-1 name=__codelineno-30-1 href=#__codelineno-30-1></a>ansible<span class=w> </span>all<span class=w> </span>-i<span class=w> </span>neon.qxyz.de,<span class=w> </span>-m<span class=w> </span>service<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;name=redhat state=present&quot;</span>
</code></pre></div> </li> <li> <p>执行playbook</p> <div class=highlight><pre><span></span><code><a id=__codelineno-31-1 name=__codelineno-31-1 href=#__codelineno-31-1></a>ansible-playbook<span class=w> </span>-i<span class=w> </span>neon.qxyz.de,neon2.qxyz.de<span class=w> </span>site.yml
</code></pre></div> </li> </ul> <blockquote> <p>注意，单个主机要有<code>,</code>结尾</p> </blockquote> <h4 id=使用正确的工具>使用正确的工具<a class=headerlink href=#使用正确的工具 title="Permanent link">&para;</a></h4> <p><strong>对于服务，不能只启动，还需要测试</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-32-1 name=__codelineno-32-1 href=#__codelineno-32-1></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">start myapp</span>
<a id=__codelineno-32-2 name=__codelineno-32-2 href=#__codelineno-32-2></a><span class=w>  </span><span class=nt>service</span><span class=p>:</span>
<a id=__codelineno-32-3 name=__codelineno-32-3 href=#__codelineno-32-3></a><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
<a id=__codelineno-32-4 name=__codelineno-32-4 href=#__codelineno-32-4></a><span class=w>    </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">started</span>
<a id=__codelineno-32-5 name=__codelineno-32-5 href=#__codelineno-32-5></a>
<a id=__codelineno-32-6 name=__codelineno-32-6 href=#__codelineno-32-6></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">check for proper response</span>
<a id=__codelineno-32-7 name=__codelineno-32-7 href=#__codelineno-32-7></a><span class=w>  </span><span class=nt>uri</span><span class=p>:</span>
<a id=__codelineno-32-8 name=__codelineno-32-8 href=#__codelineno-32-8></a><span class=w>    </span><span class=nt>url</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">http://localhost/myapp</span>
<a id=__codelineno-32-9 name=__codelineno-32-9 href=#__codelineno-32-9></a><span class=w>    </span><span class=nt>return_content</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<a id=__codelineno-32-10 name=__codelineno-32-10 href=#__codelineno-32-10></a><span class=w>    </span><span class=nt>register</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">result</span>
<a id=__codelineno-32-11 name=__codelineno-32-11 href=#__codelineno-32-11></a><span class=w>    </span><span class=nt>until</span><span class=p>:</span><span class=w> </span><span class=s>&#39;&quot;Hello</span><span class=nv> </span><span class=s>World&quot;</span><span class=nv> </span><span class=s>in</span><span class=nv> </span><span class=s>result.content&#39;</span>
<a id=__codelineno-32-12 name=__codelineno-32-12 href=#__codelineno-32-12></a><span class=w>    </span><span class=nt>retries</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<a id=__codelineno-32-13 name=__codelineno-32-13 href=#__codelineno-32-13></a><span class=w>    </span><span class=nt>delay</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
</code></pre></div> <p><strong>尽量避免使用命令模块-始终先查找对应的模块</strong></p> <table> <thead> <tr> <th>系统命令</th> <th>模块</th> </tr> </thead> <tbody> <tr> <td>- name: add user<br> command: useradd appuser</td> <td>- name: add user<br> user: <br> name: appuser<br> state: present</td> </tr> <tr> <td>- name: install apache<br> command: yum install httpd</td> <td>- name: install apache<br> yum: <br> name: httpd<br> state: latest</td> </tr> <tr> <td>- name: start apache<br> shell: |<br> service httpd start &amp;&amp; chkconfig httpd on</td> <td>- name: start apache<br> service:<br> name: httpd<br> state: started<br> enabled: yes</td> </tr> </tbody> </table> <p><strong>标记更改过的文件</strong></p> <p>如果未标记更改过的文件，则可能会意外覆盖它们</p> <ul> <li>将模板输出文件标记为由Ansible生成</li> <li>使用<code>ansible_managed**</code>变量和注释过滤器 <div class=highlight><pre><span></span><code><a id=__codelineno-33-1 name=__codelineno-33-1 href=#__codelineno-33-1></a>{{ ansible_managed | comment }}
</code></pre></div></li> </ul> <h4 id=使用-roles-和-galaxy>使用 Roles 和 Galaxy<a class=headerlink href=#使用-roles-和-galaxy title="Permanent link">&para;</a></h4> <p><strong>尽可能使用角色</strong>， 角色可以让你您能够封装您的操作。</p> <ul> <li>像playbook一样——让角色专注于目标和功能</li> <li>将每个角色存储在专用的Git仓库中</li> <li>通过<code>role/requirements.yml</code>文件包含角色，通过<code>ansible-galaxy</code>工具导入</li> <li>限制角色的依赖性</li> </ul> <p><strong>从<code>galaxy</code>获取角色，但是要小心，并根据自己的需要使用它们</strong></p> <ul> <li>galaxy 提供了数以千计的角色 </li> <li>角色的质量差异很大</li> <li>一定要半信半疑地接受建议 </li> <li>选择可信或知名的作者</li> </ul> <h4 id=正确访问目标>正确访问目标<a class=headerlink href=#正确访问目标 title="Permanent link">&para;</a></h4> <p>在可能的情况下，root访问比sudo - use sudo更难跟踪</p> <ul> <li>Ansible只能以root身份运行</li> <li>但是由于登录和安全的原因，通常要求非root访问</li> <li>使用<code>become</code>提权方法-所以Ansible脚本是通过sudo执行(sudo很容易跟踪)</li> <li>最好的:创建一个Ansible专属用户</li> <li>不要试图将sudo权限限制在某些命令中——那样可能导致Ansible不能工作</li> </ul> <h4 id=调试问题>调试问题<a class=headerlink href=#调试问题 title="Permanent link">&para;</a></h4> <p><strong>检查目标计算机上的日志</strong></p> <p>在<code>/var/log/message</code>中存在下列的日志信息</p> <div class=highlight><pre><span></span><code><a id=__codelineno-34-1 name=__codelineno-34-1 href=#__codelineno-34-1></a>ansible-node sshd[2395]: pam_unix(sshd:session): session  opened for user liquidat by (uid=0)
<a id=__codelineno-34-2 name=__codelineno-34-2 href=#__codelineno-34-2></a>ansible-node ansible-yum[2399]: Invoked with name=[&#39;httpd&#39;]  list=None install_repoquery=True conf_file=None  disable_gpg_check=False state=absent disablerepo=None  update_cache=False enablerepo=None exclude=None
</code></pre></div> <p><strong>保留代码在目标机器上执行</strong></p> <p>使用<code>ANSIBLE_KEEP_REMOTE_FILES</code> 环境变量，可以使ansible不删除在目标节点的代码</p> <div class=highlight><pre><span></span><code><a id=__codelineno-35-1 name=__codelineno-35-1 href=#__codelineno-35-1></a><span class=nv>ANSIBLE_KEEP_REMOTE_FILES</span><span class=o>=</span><span class=m>1</span><span class=w> </span>ansible<span class=w> </span>target-node<span class=w> </span>-m<span class=w> </span>yum<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;name=httpd state=absent&quot;</span>
</code></pre></div> <p>通常代码存在远端执行用户的家目录<code>.ansible/tmp</code>目录下，使用下列命令可以再次执行</p> <div class=highlight><pre><span></span><code><a id=__codelineno-36-1 name=__codelineno-36-1 href=#__codelineno-36-1></a>$ /bin/sh -c &#39;sudo -u $SUDO_USER /bin/sh -c &quot;/usr/bin/python /home/user/.ansible/tmp/...&quot;
</code></pre></div> <p><strong>使用调试模块</strong></p> <p>可以使用<code>debug</code>模块在playbook中输出一些调试信息</p> <div class=highlight><pre><span></span><code><a id=__codelineno-37-1 name=__codelineno-37-1 href=#__codelineno-37-1></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Output debug message</span>
<a id=__codelineno-37-2 name=__codelineno-37-2 href=#__codelineno-37-2></a><span class=w>  </span><span class=nt>debug</span><span class=p>:</span>
<a id=__codelineno-37-3 name=__codelineno-37-3 href=#__codelineno-37-3></a><span class=w>    </span><span class=nt>msg</span><span class=p>:</span><span class=w> </span><span class=s>&quot;This</span><span class=nv> </span><span class=s>always</span><span class=nv> </span><span class=s>displays&quot;</span>
<a id=__codelineno-37-4 name=__codelineno-37-4 href=#__codelineno-37-4></a>
<a id=__codelineno-37-5 name=__codelineno-37-5 href=#__codelineno-37-5></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Output debug message</span>
<a id=__codelineno-37-6 name=__codelineno-37-6 href=#__codelineno-37-6></a><span class=w>  </span><span class=nt>debug</span><span class=p>:</span>
<a id=__codelineno-37-7 name=__codelineno-37-7 href=#__codelineno-37-7></a><span class=w>    </span><span class=nt>msg</span><span class=p>:</span><span class=w> </span><span class=s>&quot;This</span><span class=nv> </span><span class=s>only</span><span class=nv> </span><span class=s>displays</span><span class=nv> </span><span class=s>with</span><span class=nv> </span><span class=s>ansible-playbook</span><span class=nv> </span><span class=s>-vv+&quot;</span>
<a id=__codelineno-37-8 name=__codelineno-37-8 href=#__codelineno-37-8></a><span class=w>    </span><span class=nt>verbosity</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<a id=__codelineno-37-9 name=__codelineno-37-9 href=#__codelineno-37-9></a>
<a id=__codelineno-37-10 name=__codelineno-37-10 href=#__codelineno-37-10></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Output debug hostvars</span>
<a id=__codelineno-37-11 name=__codelineno-37-11 href=#__codelineno-37-11></a><span class=w>  </span><span class=nt>debug</span><span class=p>:</span>
<a id=__codelineno-37-12 name=__codelineno-37-12 href=#__codelineno-37-12></a><span class=w>    </span><span class=nt>var</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">hostvars</span>
</code></pre></div> <h3 id=如何在生产中使用>如何在生产中使用<a class=headerlink href=#如何在生产中使用 title="Permanent link">&para;</a></h3> <h4 id=使用tower>使用Tower<a class=headerlink href=#使用tower title="Permanent link">&para;</a></h4> <ul> <li>Tower是Ansible开发的</li> <li>可以扩展Ansible的限制以满足企业需求，比如可扩展性，API，RBAC，主机等</li> <li>Tower通过**问号提示**提供程序内帮助，包括例子或链接到进一步的文档</li> <li>Tower可以使用不同的分支多次导入存储库</li> <li>在项目更新期间，Tower自动导入角色</li> <li>Tower可以使用动态和智能库存清单，可以合并多个库存清单，并负责同步和缓存</li> <li>Tower给job模板提供了很多选项，比如添加标签，检查模板，执行后通知功能等</li> <li>Tower可以使多个剧本组合成一个工作流程 </li> <li>Tower提供多租户功能，来帮助团队分隔工作环境。</li> <li>Tower提供的凭证只能由Tower使用，保证了安全性。</li> <li>Tower可以在作业成功、失败或总是失败时发送通知—例如邮件、IRC、web hook等等</li> <li>可以将所有的日志从Tower发送到日志处理中心Splunk, Loggly, ELK, REST等</li> <li>Tower可以很容易的建立HA架构，也可以在网络隔离的地方建立单点。 </li> </ul> <h4 id=使用ansible>使用Ansible<a class=headerlink href=#使用ansible title="Permanent link">&para;</a></h4> <ul> <li>保证ansible管理节点的安全性</li> <li>记录ansible的执行日志</li> <li>使用git仓库来管理ansible的playbook，roles，inventory等等</li> <li>使用block块来推送执行成功，失败的通知</li> </ul> <h2 id=4使用-ansible-lint>4.使用 ansible-lint<a class=headerlink href=#4使用-ansible-lint title="Permanent link">&para;</a></h2> <p><a href=https://github.com/ansible/ansible-lint>Ansible Lint</a>是用于检测playbook的命令行工具，它可以提供建议来帮助你修正playbook。</p> <h3 id=安装>安装<a class=headerlink href=#安装 title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-38-1 name=__codelineno-38-1 href=#__codelineno-38-1></a>pip<span class=w> </span>install<span class=w> </span>ansible-lint
</code></pre></div> <h3 id=使用>使用<a class=headerlink href=#使用 title="Permanent link">&para;</a></h3> <p>命令选项</p> <div class=highlight><pre><span></span><code><a id=__codelineno-39-1 name=__codelineno-39-1 href=#__codelineno-39-1></a>ansible-lint<span class=w> </span>--help
<a id=__codelineno-39-2 name=__codelineno-39-2 href=#__codelineno-39-2></a>Usage:<span class=w> </span>ansible-lint<span class=w> </span><span class=o>[</span>options<span class=o>]</span><span class=w> </span><span class=o>[</span>playbook.yml<span class=w> </span><span class=o>[</span>playbook2<span class=w> </span>...<span class=o>]]</span>
<a id=__codelineno-39-3 name=__codelineno-39-3 href=#__codelineno-39-3></a>
<a id=__codelineno-39-4 name=__codelineno-39-4 href=#__codelineno-39-4></a>Options:
<a id=__codelineno-39-5 name=__codelineno-39-5 href=#__codelineno-39-5></a><span class=w>  </span>--version<span class=w>             </span>显示项目版本
<a id=__codelineno-39-6 name=__codelineno-39-6 href=#__codelineno-39-6></a><span class=w>  </span>-h,<span class=w> </span>--help<span class=w>            </span>显示帮助信息
<a id=__codelineno-39-7 name=__codelineno-39-7 href=#__codelineno-39-7></a><span class=w>  </span>-L<span class=w>                    </span>列出所有规则
<a id=__codelineno-39-8 name=__codelineno-39-8 href=#__codelineno-39-8></a><span class=w>  </span>-q<span class=w>                    </span>输出少量信息
<a id=__codelineno-39-9 name=__codelineno-39-9 href=#__codelineno-39-9></a><span class=w>  </span>-p<span class=w>                    </span>以pep8格式解析的输出
<a id=__codelineno-39-10 name=__codelineno-39-10 href=#__codelineno-39-10></a><span class=w>  </span>--parseable-severity<span class=w>  </span>分析输出，包括规则的严重性
<a id=__codelineno-39-11 name=__codelineno-39-11 href=#__codelineno-39-11></a><span class=w>  </span>-r<span class=w> </span>RULESDIR<span class=w>           </span>指定规则目录，使用多个-r指定多个目录会覆盖默认目录<span class=w> </span>/usr/lib/python2.7/site-packages/ansiblelint/rules,<span class=w> </span>使用-R则不覆盖默认规则目录
<a id=__codelineno-39-12 name=__codelineno-39-12 href=#__codelineno-39-12></a><span class=w>  </span>-R<span class=w>                    </span>跟-r一起使用。
<a id=__codelineno-39-13 name=__codelineno-39-13 href=#__codelineno-39-13></a><span class=w>  </span>-t<span class=w> </span>TAGS<span class=w>               </span>仅检查tag标签的任务
<a id=__codelineno-39-14 name=__codelineno-39-14 href=#__codelineno-39-14></a><span class=w>  </span>-T<span class=w>                    </span>列出所有tag
<a id=__codelineno-39-15 name=__codelineno-39-15 href=#__codelineno-39-15></a><span class=w>  </span>-v<span class=w>                    </span>详细输出
<a id=__codelineno-39-16 name=__codelineno-39-16 href=#__codelineno-39-16></a><span class=w>  </span>-x<span class=w> </span>SKIP_LIST<span class=w>          </span>跳过指定的id/tags任务
<a id=__codelineno-39-17 name=__codelineno-39-17 href=#__codelineno-39-17></a><span class=w>  </span>--nocolor<span class=w>             </span>关闭颜色输出
<a id=__codelineno-39-18 name=__codelineno-39-18 href=#__codelineno-39-18></a><span class=w>  </span>--force-color<span class=w>         </span>强制颜色输出
<a id=__codelineno-39-19 name=__codelineno-39-19 href=#__codelineno-39-19></a><span class=w>  </span>--exclude<span class=o>=</span>EXCLUDE_PATHS
<a id=__codelineno-39-20 name=__codelineno-39-20 href=#__codelineno-39-20></a><span class=w>                        </span>要排除的目录或文件的路径。可多次指定。
<a id=__codelineno-39-21 name=__codelineno-39-21 href=#__codelineno-39-21></a><span class=w>  </span>-c<span class=w> </span>C<span class=w>                  </span>指定配置文件，默认<span class=s2>&quot;.ansible-lint&quot;</span>
</code></pre></div> <h4 id=检查roles>检查roles<a class=headerlink href=#检查roles title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><a id=__codelineno-40-1 name=__codelineno-40-1 href=#__codelineno-40-1></a><span class=c1># ansible-lint roles/os-check   </span>
<a id=__codelineno-40-2 name=__codelineno-40-2 href=#__codelineno-40-2></a><span class=o>[</span><span class=m>602</span><span class=o>]</span><span class=w> </span>Don<span class=s1>&#39;t compare to empty string</span>
<a id=__codelineno-40-3 name=__codelineno-40-3 href=#__codelineno-40-3></a><span class=s1>roles/os-check/tasks/main.yaml:32</span>
<a id=__codelineno-40-4 name=__codelineno-40-4 href=#__codelineno-40-4></a><span class=s1>    - check_mail_host != &quot;&quot;</span>
<a id=__codelineno-40-5 name=__codelineno-40-5 href=#__codelineno-40-5></a>
<a id=__codelineno-40-6 name=__codelineno-40-6 href=#__codelineno-40-6></a><span class=s1>[602] Don&#39;</span>t<span class=w> </span>compare<span class=w> </span>to<span class=w> </span>empty<span class=w> </span>string
<a id=__codelineno-40-7 name=__codelineno-40-7 href=#__codelineno-40-7></a>roles/os-check/tasks/main.yaml:33
<a id=__codelineno-40-8 name=__codelineno-40-8 href=#__codelineno-40-8></a><span class=w>    </span>-<span class=w> </span>check_mail_port<span class=w> </span>!<span class=o>=</span><span class=w> </span><span class=s2>&quot;&quot;</span>
<a id=__codelineno-40-9 name=__codelineno-40-9 href=#__codelineno-40-9></a>
<a id=__codelineno-40-10 name=__codelineno-40-10 href=#__codelineno-40-10></a><span class=o>[</span><span class=m>602</span><span class=o>]</span><span class=w> </span>Don<span class=s1>&#39;t compare to empty string</span>
<a id=__codelineno-40-11 name=__codelineno-40-11 href=#__codelineno-40-11></a><span class=s1>roles/os-check/tasks/main.yaml:34</span>
<a id=__codelineno-40-12 name=__codelineno-40-12 href=#__codelineno-40-12></a><span class=s1>    - check_mail_username != &quot;&quot;</span>
<a id=__codelineno-40-13 name=__codelineno-40-13 href=#__codelineno-40-13></a>
<a id=__codelineno-40-14 name=__codelineno-40-14 href=#__codelineno-40-14></a><span class=s1>[602] Don&#39;</span>t<span class=w> </span>compare<span class=w> </span>to<span class=w> </span>empty<span class=w> </span>string
<a id=__codelineno-40-15 name=__codelineno-40-15 href=#__codelineno-40-15></a>roles/os-check/tasks/main.yaml:35
<a id=__codelineno-40-16 name=__codelineno-40-16 href=#__codelineno-40-16></a><span class=w>    </span>-<span class=w> </span>check_mail_password<span class=w> </span>!<span class=o>=</span><span class=w> </span><span class=s2>&quot;&quot;</span>
</code></pre></div> <h4 id=检查playbook>检查playbook<a class=headerlink href=#检查playbook title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><a id=__codelineno-41-1 name=__codelineno-41-1 href=#__codelineno-41-1></a><span class=c1># cat playbook.yaml </span>
<a id=__codelineno-41-2 name=__codelineno-41-2 href=#__codelineno-41-2></a>---
<a id=__codelineno-41-3 name=__codelineno-41-3 href=#__codelineno-41-3></a>-<span class=w> </span>hosts:<span class=w> </span>all
<a id=__codelineno-41-4 name=__codelineno-41-4 href=#__codelineno-41-4></a><span class=w>  </span>tasks:
<a id=__codelineno-41-5 name=__codelineno-41-5 href=#__codelineno-41-5></a><span class=w>    </span>-<span class=w> </span>debug:<span class=w> </span><span class=nv>msg</span><span class=o>=</span>hello
<a id=__codelineno-41-6 name=__codelineno-41-6 href=#__codelineno-41-6></a><span class=w>  </span>roles:
<a id=__codelineno-41-7 name=__codelineno-41-7 href=#__codelineno-41-7></a><span class=w>    </span>-<span class=w> </span>os-check
<a id=__codelineno-41-8 name=__codelineno-41-8 href=#__codelineno-41-8></a>
<a id=__codelineno-41-9 name=__codelineno-41-9 href=#__codelineno-41-9></a><span class=c1># ansible-lint playbook.yaml        </span>
<a id=__codelineno-41-10 name=__codelineno-41-10 href=#__codelineno-41-10></a><span class=o>[</span><span class=m>602</span><span class=o>]</span><span class=w> </span>Don<span class=s1>&#39;t compare to empty string</span>
<a id=__codelineno-41-11 name=__codelineno-41-11 href=#__codelineno-41-11></a><span class=s1>roles/os-check/tasks/main.yaml:32</span>
<a id=__codelineno-41-12 name=__codelineno-41-12 href=#__codelineno-41-12></a><span class=s1>    - check_mail_host != &quot;&quot;</span>
<a id=__codelineno-41-13 name=__codelineno-41-13 href=#__codelineno-41-13></a>
<a id=__codelineno-41-14 name=__codelineno-41-14 href=#__codelineno-41-14></a><span class=s1>[602] Don&#39;</span>t<span class=w> </span>compare<span class=w> </span>to<span class=w> </span>empty<span class=w> </span>string
<a id=__codelineno-41-15 name=__codelineno-41-15 href=#__codelineno-41-15></a>roles/os-check/tasks/main.yaml:33
<a id=__codelineno-41-16 name=__codelineno-41-16 href=#__codelineno-41-16></a><span class=w>    </span>-<span class=w> </span>check_mail_port<span class=w> </span>!<span class=o>=</span><span class=w> </span><span class=s2>&quot;&quot;</span>
<a id=__codelineno-41-17 name=__codelineno-41-17 href=#__codelineno-41-17></a>
<a id=__codelineno-41-18 name=__codelineno-41-18 href=#__codelineno-41-18></a><span class=o>[</span><span class=m>602</span><span class=o>]</span><span class=w> </span>Don<span class=s1>&#39;t compare to empty string</span>
<a id=__codelineno-41-19 name=__codelineno-41-19 href=#__codelineno-41-19></a><span class=s1>roles/os-check/tasks/main.yaml:34</span>
<a id=__codelineno-41-20 name=__codelineno-41-20 href=#__codelineno-41-20></a><span class=s1>    - check_mail_username != &quot;&quot;</span>
<a id=__codelineno-41-21 name=__codelineno-41-21 href=#__codelineno-41-21></a>
<a id=__codelineno-41-22 name=__codelineno-41-22 href=#__codelineno-41-22></a><span class=s1>[602] Don&#39;</span>t<span class=w> </span>compare<span class=w> </span>to<span class=w> </span>empty<span class=w> </span>string
<a id=__codelineno-41-23 name=__codelineno-41-23 href=#__codelineno-41-23></a>roles/os-check/tasks/main.yaml:35
<a id=__codelineno-41-24 name=__codelineno-41-24 href=#__codelineno-41-24></a><span class=w>    </span>-<span class=w> </span>check_mail_password<span class=w> </span>!<span class=o>=</span><span class=w> </span><span class=s2>&quot;&quot;</span>
</code></pre></div> <p>根据规则提示，来修正你的playbook</p> <h3 id=配置文件>配置文件<a class=headerlink href=#配置文件 title="Permanent link">&para;</a></h3> <p>Ansible-lint 默认寻找当前目录的<code>.ansible-lint</code>作为配置文件，也可指定<code>-c file</code> 指定一个配置文件。</p> <p>配置文件支持以下值，并且其功能与对应的CLI相同</p> <div class=highlight><pre><span></span><code><a id=__codelineno-42-1 name=__codelineno-42-1 href=#__codelineno-42-1></a><span class=nt>exclude_paths</span><span class=p>:</span>
<a id=__codelineno-42-2 name=__codelineno-42-2 href=#__codelineno-42-2></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./my/excluded/directory/</span>
<a id=__codelineno-42-3 name=__codelineno-42-3 href=#__codelineno-42-3></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./my/other/excluded/directory/</span>
<a id=__codelineno-42-4 name=__codelineno-42-4 href=#__codelineno-42-4></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./last/excluded/directory/</span>
<a id=__codelineno-42-5 name=__codelineno-42-5 href=#__codelineno-42-5></a><span class=nt>parseable</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id=__codelineno-42-6 name=__codelineno-42-6 href=#__codelineno-42-6></a><span class=nt>quiet</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id=__codelineno-42-7 name=__codelineno-42-7 href=#__codelineno-42-7></a><span class=nt>rulesdir</span><span class=p>:</span>
<a id=__codelineno-42-8 name=__codelineno-42-8 href=#__codelineno-42-8></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./rule/directory/</span>
<a id=__codelineno-42-9 name=__codelineno-42-9 href=#__codelineno-42-9></a><span class=nt>skip_list</span><span class=p>:</span>
<a id=__codelineno-42-10 name=__codelineno-42-10 href=#__codelineno-42-10></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">skip_this_tag</span>
<a id=__codelineno-42-11 name=__codelineno-42-11 href=#__codelineno-42-11></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">and_this_one_too</span>
<a id=__codelineno-42-12 name=__codelineno-42-12 href=#__codelineno-42-12></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">skip_this_id</span>
<a id=__codelineno-42-13 name=__codelineno-42-13 href=#__codelineno-42-13></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&#39;401&#39;</span>
<a id=__codelineno-42-14 name=__codelineno-42-14 href=#__codelineno-42-14></a><span class=nt>tags</span><span class=p>:</span>
<a id=__codelineno-42-15 name=__codelineno-42-15 href=#__codelineno-42-15></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">run_this_tag</span>
<a id=__codelineno-42-16 name=__codelineno-42-16 href=#__codelineno-42-16></a><span class=nt>use_default_rules</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id=__codelineno-42-17 name=__codelineno-42-17 href=#__codelineno-42-17></a><span class=nt>verbosity</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
</code></pre></div> <h3 id=规则>规则<a class=headerlink href=#规则 title="Permanent link">&para;</a></h3> <p>默认规则存在<code>/usr/lib/python2.7/site-packages/ansiblelint/rules</code> 目录中，可以使用<code>-r</code>选项指定规则目录，和<code>-R</code>一起使用时保留默认规则目录，反之替换。</p> <h4 id=列出规则>列出规则<a class=headerlink href=#列出规则 title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><a id=__codelineno-43-1 name=__codelineno-43-1 href=#__codelineno-43-1></a><span class=c1># ansible-lint -L </span>
<a id=__codelineno-43-2 name=__codelineno-43-2 href=#__codelineno-43-2></a><span class=m>101</span>:<span class=w> </span>Deprecated<span class=w> </span>always_run
<a id=__codelineno-43-3 name=__codelineno-43-3 href=#__codelineno-43-3></a><span class=w>  </span>Instead<span class=w> </span>of<span class=w> </span><span class=sb>``</span>always_run<span class=sb>``</span>,<span class=w> </span>use<span class=w> </span><span class=sb>``</span>check_mode<span class=sb>``</span>
<a id=__codelineno-43-4 name=__codelineno-43-4 href=#__codelineno-43-4></a><span class=m>102</span>:<span class=w> </span>No<span class=w> </span>Jinja2<span class=w> </span><span class=k>in</span><span class=w> </span>when
<a id=__codelineno-43-5 name=__codelineno-43-5 href=#__codelineno-43-5></a><span class=w>  </span><span class=sb>``</span>when<span class=sb>``</span><span class=w> </span>lines<span class=w> </span>should<span class=w> </span>not<span class=w> </span>include<span class=w> </span>Jinja2<span class=w> </span>variables
<a id=__codelineno-43-6 name=__codelineno-43-6 href=#__codelineno-43-6></a><span class=m>103</span>:<span class=w> </span>Deprecated<span class=w> </span>sudo
<a id=__codelineno-43-7 name=__codelineno-43-7 href=#__codelineno-43-7></a><span class=w>  </span>Instead<span class=w> </span>of<span class=w> </span><span class=sb>``</span>sudo<span class=sb>``</span>/<span class=sb>``</span>sudo_user<span class=sb>``</span>,<span class=w> </span>use<span class=w> </span><span class=sb>``</span>become<span class=sb>``</span>/<span class=sb>``</span>become_user<span class=sb>``</span>.
<a id=__codelineno-43-8 name=__codelineno-43-8 href=#__codelineno-43-8></a><span class=m>104</span>:<span class=w> </span>Using<span class=w> </span>bare<span class=w> </span>variables<span class=w> </span>is<span class=w> </span>deprecated
<a id=__codelineno-43-9 name=__codelineno-43-9 href=#__codelineno-43-9></a><span class=w>  </span>Using<span class=w> </span>bare<span class=w> </span>variables<span class=w> </span>is<span class=w> </span>deprecated.<span class=w> </span>Update<span class=w> </span>your<span class=w> </span>playbooks<span class=w> </span>so<span class=w> </span>that<span class=w> </span>the<span class=w> </span>environment<span class=w> </span>value<span class=w> </span>uses<span class=w> </span>the<span class=w> </span>full<span class=w> </span>variable<span class=w> </span>syntax<span class=w> </span><span class=sb>``</span><span class=o>{{</span><span class=w> </span>your_variable<span class=w> </span><span class=o>}}</span><span class=sb>``</span>
<a id=__codelineno-43-10 name=__codelineno-43-10 href=#__codelineno-43-10></a><span class=m>105</span>:<span class=w> </span>Deprecated<span class=w> </span>module
<a id=__codelineno-43-11 name=__codelineno-43-11 href=#__codelineno-43-11></a><span class=w>  </span>These<span class=w> </span>are<span class=w> </span>deprecated<span class=w> </span>modules,<span class=w> </span>some<span class=w> </span>modules<span class=w> </span>are<span class=w> </span>kept<span class=w> </span>temporarily<span class=w> </span><span class=k>for</span><span class=w> </span>backwards<span class=w> </span>compatibility<span class=w> </span>but<span class=w> </span>usage<span class=w> </span>is<span class=w> </span>discouraged.<span class=w> </span>For<span class=w> </span>more<span class=w> </span>details<span class=w> </span>see:<span class=w> </span>https://docs.ansible.com/ansible/latest/modules/list_of_all_modules.html
<a id=__codelineno-43-12 name=__codelineno-43-12 href=#__codelineno-43-12></a><span class=m>201</span>:<span class=w> </span>Trailing<span class=w> </span>whitespace
<a id=__codelineno-43-13 name=__codelineno-43-13 href=#__codelineno-43-13></a><span class=w>  </span>There<span class=w> </span>should<span class=w> </span>not<span class=w> </span>be<span class=w> </span>any<span class=w> </span>trailing<span class=w> </span>whitespace
<a id=__codelineno-43-14 name=__codelineno-43-14 href=#__codelineno-43-14></a><span class=m>202</span>:<span class=w> </span>Octal<span class=w> </span>file<span class=w> </span>permissions<span class=w> </span>must<span class=w> </span>contain<span class=w> </span>leading<span class=w> </span>zero<span class=w> </span>or<span class=w> </span>be<span class=w> </span>a<span class=w> </span>string
<a id=__codelineno-43-15 name=__codelineno-43-15 href=#__codelineno-43-15></a><span class=w>  </span>Numeric<span class=w> </span>file<span class=w> </span>permissions<span class=w> </span>without<span class=w> </span>leading<span class=w> </span>zero<span class=w> </span>can<span class=w> </span>behave<span class=w> </span><span class=k>in</span><span class=w> </span>unexpected<span class=w> </span>ways.<span class=w> </span>See<span class=w> </span>http://docs.ansible.com/ansible/file_module.html
<a id=__codelineno-43-16 name=__codelineno-43-16 href=#__codelineno-43-16></a><span class=m>203</span>:<span class=w> </span>Most<span class=w> </span>files<span class=w> </span>should<span class=w> </span>not<span class=w> </span>contain<span class=w> </span>tabs
<a id=__codelineno-43-17 name=__codelineno-43-17 href=#__codelineno-43-17></a><span class=w>  </span>Tabs<span class=w> </span>can<span class=w> </span>cause<span class=w> </span>unexpected<span class=w> </span>display<span class=w> </span>issues,<span class=w> </span>use<span class=w> </span>spaces
<a id=__codelineno-43-18 name=__codelineno-43-18 href=#__codelineno-43-18></a><span class=m>204</span>:<span class=w> </span>Lines<span class=w> </span>should<span class=w> </span>be<span class=w> </span>no<span class=w> </span>longer<span class=w> </span>than<span class=w> </span><span class=m>160</span><span class=w> </span>chars
<a id=__codelineno-43-19 name=__codelineno-43-19 href=#__codelineno-43-19></a><span class=w>  </span>Long<span class=w> </span>lines<span class=w> </span>make<span class=w> </span>code<span class=w> </span>harder<span class=w> </span>to<span class=w> </span><span class=nb>read</span><span class=w> </span>and<span class=w> </span>code<span class=w> </span>review<span class=w> </span>more<span class=w> </span>difficult
<a id=__codelineno-43-20 name=__codelineno-43-20 href=#__codelineno-43-20></a><span class=m>205</span>:<span class=w> </span>Use<span class=w> </span><span class=s2>&quot;.yml&quot;</span><span class=w> </span>or<span class=w> </span><span class=s2>&quot;.yaml&quot;</span><span class=w> </span>playbook<span class=w> </span>extension
<a id=__codelineno-43-21 name=__codelineno-43-21 href=#__codelineno-43-21></a><span class=w>  </span>Playbooks<span class=w> </span>should<span class=w> </span>have<span class=w> </span>the<span class=w> </span><span class=s2>&quot;.yml&quot;</span><span class=w> </span>or<span class=w> </span><span class=s2>&quot;.yaml&quot;</span><span class=w> </span>extension
<a id=__codelineno-43-22 name=__codelineno-43-22 href=#__codelineno-43-22></a><span class=m>206</span>:<span class=w> </span>Variables<span class=w> </span>should<span class=w> </span>have<span class=w> </span>spaces<span class=w> </span>before<span class=w> </span>and<span class=w> </span>after:<span class=w> </span><span class=o>{{</span><span class=w> </span>var_name<span class=w> </span><span class=o>}}</span>
<a id=__codelineno-43-23 name=__codelineno-43-23 href=#__codelineno-43-23></a><span class=w>  </span>Variables<span class=w> </span>should<span class=w> </span>have<span class=w> </span>spaces<span class=w> </span>before<span class=w> </span>and<span class=w> </span>after:<span class=w> </span><span class=sb>``</span><span class=o>{{</span><span class=w> </span>var_name<span class=w> </span><span class=o>}}</span><span class=sb>``</span>
<a id=__codelineno-43-24 name=__codelineno-43-24 href=#__codelineno-43-24></a><span class=m>301</span>:<span class=w> </span>Commands<span class=w> </span>should<span class=w> </span>not<span class=w> </span>change<span class=w> </span>things<span class=w> </span><span class=k>if</span><span class=w> </span>nothing<span class=w> </span>needs<span class=w> </span>doing
<a id=__codelineno-43-25 name=__codelineno-43-25 href=#__codelineno-43-25></a><span class=w>  </span>Commands<span class=w> </span>should<span class=w> </span>either<span class=w> </span><span class=nb>read</span><span class=w> </span>information<span class=w> </span><span class=o>(</span>and<span class=w> </span>thus<span class=w> </span><span class=nb>set</span><span class=w> </span><span class=sb>``</span>changed_when<span class=sb>``</span><span class=o>)</span><span class=w> </span>or<span class=w> </span>not<span class=w> </span><span class=k>do</span><span class=w> </span>something<span class=w> </span><span class=k>if</span><span class=w> </span>it<span class=w> </span>has<span class=w> </span>already<span class=w> </span>been<span class=w> </span><span class=k>done</span><span class=w> </span><span class=o>(</span>using<span class=w> </span>creates/removes<span class=o>)</span><span class=w> </span>or<span class=w> </span>only<span class=w> </span><span class=k>do</span><span class=w> </span>it<span class=w> </span><span class=k>if</span><span class=w> </span>another<span class=w> </span>check<span class=w> </span>has<span class=w> </span>a<span class=w> </span>particular<span class=w> </span>result<span class=w> </span><span class=o>(</span><span class=sb>``</span>when<span class=sb>``</span><span class=o>)</span>
<a id=__codelineno-43-26 name=__codelineno-43-26 href=#__codelineno-43-26></a><span class=m>302</span>:<span class=w> </span>Using<span class=w> </span><span class=nb>command</span><span class=w> </span>rather<span class=w> </span>than<span class=w> </span>an<span class=w> </span>argument<span class=w> </span>to<span class=w> </span>e.g.<span class=w> </span>file
<a id=__codelineno-43-27 name=__codelineno-43-27 href=#__codelineno-43-27></a><span class=w>  </span>Executing<span class=w> </span>a<span class=w> </span><span class=nb>command</span><span class=w> </span>when<span class=w> </span>there<span class=w> </span>are<span class=w> </span>arguments<span class=w> </span>to<span class=w> </span>modules<span class=w> </span>is<span class=w> </span>generally<span class=w> </span>a<span class=w> </span>bad<span class=w> </span>idea
<a id=__codelineno-43-28 name=__codelineno-43-28 href=#__codelineno-43-28></a><span class=m>303</span>:<span class=w> </span>Using<span class=w> </span><span class=nb>command</span><span class=w> </span>rather<span class=w> </span>than<span class=w> </span>module
<a id=__codelineno-43-29 name=__codelineno-43-29 href=#__codelineno-43-29></a><span class=w>  </span>Executing<span class=w> </span>a<span class=w> </span><span class=nb>command</span><span class=w> </span>when<span class=w> </span>there<span class=w> </span>is<span class=w> </span>an<span class=w> </span>Ansible<span class=w> </span>module<span class=w> </span>is<span class=w> </span>generally<span class=w> </span>a<span class=w> </span>bad<span class=w> </span>idea
<a id=__codelineno-43-30 name=__codelineno-43-30 href=#__codelineno-43-30></a><span class=m>304</span>:<span class=w> </span>Environment<span class=w> </span>variables<span class=w> </span>don<span class=s1>&#39;t work as part of command</span>
<a id=__codelineno-43-31 name=__codelineno-43-31 href=#__codelineno-43-31></a><span class=s1>  Environment variables should be passed to ``shell`` or ``command`` through environment argument</span>
<a id=__codelineno-43-32 name=__codelineno-43-32 href=#__codelineno-43-32></a><span class=s1>305: Use shell only when shell functionality is required</span>
<a id=__codelineno-43-33 name=__codelineno-43-33 href=#__codelineno-43-33></a><span class=s1>  Shell should only be used when piping, redirecting or chaining commands (and Ansible would be preferred for some of those!)</span>
<a id=__codelineno-43-34 name=__codelineno-43-34 href=#__codelineno-43-34></a><span class=s1>306: Shells that use pipes should set the pipefail option</span>
<a id=__codelineno-43-35 name=__codelineno-43-35 href=#__codelineno-43-35></a><span class=s1>  Without the pipefail option set, a shell command that implements a pipeline can fail and still return 0. If any part of the pipeline other than the terminal command fails, the whole pipeline will still return 0, which may be considered a success by Ansible. Pipefail is available in the bash shell.</span>
<a id=__codelineno-43-36 name=__codelineno-43-36 href=#__codelineno-43-36></a><span class=s1>401: Git checkouts must contain explicit version</span>
<a id=__codelineno-43-37 name=__codelineno-43-37 href=#__codelineno-43-37></a><span class=s1>  All version control checkouts must point to an explicit commit or tag, not just ``latest``</span>
<a id=__codelineno-43-38 name=__codelineno-43-38 href=#__codelineno-43-38></a><span class=s1>402: Mercurial checkouts must contain explicit revision</span>
<a id=__codelineno-43-39 name=__codelineno-43-39 href=#__codelineno-43-39></a><span class=s1>  All version control checkouts must point to an explicit commit or tag, not just ``latest``</span>
<a id=__codelineno-43-40 name=__codelineno-43-40 href=#__codelineno-43-40></a><span class=s1>403: Package installs should not use latest</span>
<a id=__codelineno-43-41 name=__codelineno-43-41 href=#__codelineno-43-41></a><span class=s1>  Package installs should use ``state=present`` with or without a version</span>
<a id=__codelineno-43-42 name=__codelineno-43-42 href=#__codelineno-43-42></a><span class=s1>404: Doesn&#39;</span>t<span class=w> </span>need<span class=w> </span>a<span class=w> </span>relative<span class=w> </span>path<span class=w> </span><span class=k>in</span><span class=w> </span>role
<a id=__codelineno-43-43 name=__codelineno-43-43 href=#__codelineno-43-43></a><span class=w>  </span><span class=sb>``</span>copy<span class=sb>``</span><span class=w> </span>and<span class=w> </span><span class=sb>``</span>template<span class=sb>``</span><span class=w> </span><span class=k>do</span><span class=w> </span>not<span class=w> </span>need<span class=w> </span>to<span class=w> </span>use<span class=w> </span>relative<span class=w> </span>path<span class=w> </span><span class=k>for</span><span class=w> </span><span class=sb>``</span>src<span class=sb>``</span>
<a id=__codelineno-43-44 name=__codelineno-43-44 href=#__codelineno-43-44></a><span class=m>501</span>:<span class=w> </span>become_user<span class=w> </span>requires<span class=w> </span>become<span class=w> </span>to<span class=w> </span>work<span class=w> </span>as<span class=w> </span>expected
<a id=__codelineno-43-45 name=__codelineno-43-45 href=#__codelineno-43-45></a><span class=w>  </span><span class=sb>``</span>become_user<span class=sb>``</span><span class=w> </span>without<span class=w> </span><span class=sb>``</span>become<span class=sb>``</span><span class=w> </span>will<span class=w> </span>not<span class=w> </span>actually<span class=w> </span>change<span class=w> </span>user
<a id=__codelineno-43-46 name=__codelineno-43-46 href=#__codelineno-43-46></a><span class=m>502</span>:<span class=w> </span>All<span class=w> </span>tasks<span class=w> </span>should<span class=w> </span>be<span class=w> </span>named
<a id=__codelineno-43-47 name=__codelineno-43-47 href=#__codelineno-43-47></a><span class=w>  </span>All<span class=w> </span>tasks<span class=w> </span>should<span class=w> </span>have<span class=w> </span>a<span class=w> </span>distinct<span class=w> </span>name<span class=w> </span><span class=k>for</span><span class=w> </span>readability<span class=w> </span>and<span class=w> </span><span class=k>for</span><span class=w> </span><span class=sb>``</span>--start-at-task<span class=sb>``</span><span class=w> </span>to<span class=w> </span>work
<a id=__codelineno-43-48 name=__codelineno-43-48 href=#__codelineno-43-48></a><span class=m>503</span>:<span class=w> </span>Tasks<span class=w> </span>that<span class=w> </span>run<span class=w> </span>when<span class=w> </span>changed<span class=w> </span>should<span class=w> </span>likely<span class=w> </span>be<span class=w> </span>handlers
<a id=__codelineno-43-49 name=__codelineno-43-49 href=#__codelineno-43-49></a><span class=w>  </span>If<span class=w> </span>a<span class=w> </span>task<span class=w> </span>has<span class=w> </span>a<span class=w> </span><span class=sb>``</span>when:<span class=w> </span>result.changed<span class=sb>``</span><span class=w> </span>setting,<span class=w> </span>it<span class=w> </span>is<span class=w> </span>effectively<span class=w> </span>acting<span class=w> </span>as<span class=w> </span>a<span class=w> </span>handler
<a id=__codelineno-43-50 name=__codelineno-43-50 href=#__codelineno-43-50></a><span class=m>504</span>:<span class=w> </span>Do<span class=w> </span>not<span class=w> </span>use<span class=w> </span><span class=s1>&#39;local_action&#39;</span>,<span class=w> </span>use<span class=w> </span><span class=s1>&#39;delegate_to: localhost&#39;</span>
<a id=__codelineno-43-51 name=__codelineno-43-51 href=#__codelineno-43-51></a><span class=w>  </span>Do<span class=w> </span>not<span class=w> </span>use<span class=w> </span><span class=sb>``</span>local_action<span class=sb>``</span>,<span class=w> </span>use<span class=w> </span><span class=sb>``</span>delegate_to:<span class=w> </span>localhost<span class=sb>``</span>
<a id=__codelineno-43-52 name=__codelineno-43-52 href=#__codelineno-43-52></a><span class=m>601</span>:<span class=w> </span>Don<span class=s1>&#39;t compare to literal True/False</span>
<a id=__codelineno-43-53 name=__codelineno-43-53 href=#__codelineno-43-53></a><span class=s1>  Use ``when: var`` rather than ``when: var == True`` (or conversely ``when: not var``)</span>
<a id=__codelineno-43-54 name=__codelineno-43-54 href=#__codelineno-43-54></a><span class=s1>602: Don&#39;</span>t<span class=w> </span>compare<span class=w> </span>to<span class=w> </span>empty<span class=w> </span>string
<a id=__codelineno-43-55 name=__codelineno-43-55 href=#__codelineno-43-55></a><span class=w>  </span>Use<span class=w> </span><span class=sb>``</span>when:<span class=w> </span>var<span class=sb>``</span><span class=w> </span>rather<span class=w> </span>than<span class=w> </span><span class=sb>``</span>when:<span class=w> </span>var<span class=w> </span>!<span class=o>=</span><span class=w> </span><span class=s2>&quot;&quot;</span><span class=sb>``</span><span class=w> </span><span class=o>(</span>or<span class=w> </span>conversely<span class=w> </span><span class=sb>``</span>when:<span class=w> </span>not<span class=w> </span>var<span class=sb>``</span><span class=w> </span>rather<span class=w> </span>than<span class=w> </span><span class=sb>``</span>when:<span class=w> </span><span class=nv>var</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s2>&quot;&quot;</span><span class=sb>``</span><span class=o>)</span>
<a id=__codelineno-43-56 name=__codelineno-43-56 href=#__codelineno-43-56></a><span class=m>701</span>:<span class=w> </span>meta/main.yml<span class=w> </span>should<span class=w> </span>contain<span class=w> </span>relevant<span class=w> </span>info
<a id=__codelineno-43-57 name=__codelineno-43-57 href=#__codelineno-43-57></a><span class=w>  </span>meta/main.yml<span class=w> </span>should<span class=w> </span>contain:<span class=w> </span><span class=sb>``</span>author,<span class=w> </span>description,<span class=w> </span>license,<span class=w> </span>min_ansible_version,<span class=w> </span>platforms<span class=sb>``</span>
<a id=__codelineno-43-58 name=__codelineno-43-58 href=#__codelineno-43-58></a><span class=m>702</span>:<span class=w> </span>Tags<span class=w> </span>must<span class=w> </span>contain<span class=w> </span>lowercase<span class=w> </span>letters<span class=w> </span>and<span class=w> </span>digits<span class=w> </span>only
<a id=__codelineno-43-59 name=__codelineno-43-59 href=#__codelineno-43-59></a><span class=w>  </span>Tags<span class=w> </span>must<span class=w> </span>contain<span class=w> </span>lowercase<span class=w> </span>letters<span class=w> </span>and<span class=w> </span>digits<span class=w> </span>only,<span class=w> </span>and<span class=w> </span><span class=sb>``</span>galaxy_tags<span class=sb>``</span><span class=w> </span>is<span class=w> </span>expected<span class=w> </span>to<span class=w> </span>be<span class=w> </span>a<span class=w> </span>list
<a id=__codelineno-43-60 name=__codelineno-43-60 href=#__codelineno-43-60></a><span class=m>703</span>:<span class=w> </span>meta/main.yml<span class=w> </span>default<span class=w> </span>values<span class=w> </span>should<span class=w> </span>be<span class=w> </span>changed
<a id=__codelineno-43-61 name=__codelineno-43-61 href=#__codelineno-43-61></a><span class=w>  </span>meta/main.yml<span class=w> </span>default<span class=w> </span>values<span class=w> </span>should<span class=w> </span>be<span class=w> </span>changed<span class=w> </span><span class=k>for</span>:<span class=w> </span><span class=sb>``</span>author,<span class=w> </span>description,<span class=w> </span>company,<span class=w> </span>license,<span class=w> </span>license<span class=sb>``</span>
<a id=__codelineno-43-62 name=__codelineno-43-62 href=#__codelineno-43-62></a><span class=m>704</span>:<span class=w> </span>meta/main.yml<span class=w> </span>video_links<span class=w> </span>should<span class=w> </span>be<span class=w> </span>formatted<span class=w> </span>correctly
<a id=__codelineno-43-63 name=__codelineno-43-63 href=#__codelineno-43-63></a><span class=w>  </span>Items<span class=w> </span><span class=k>in</span><span class=w> </span><span class=sb>``</span>video_links<span class=sb>``</span><span class=w> </span><span class=k>in</span><span class=w> </span>meta/main.yml<span class=w> </span>should<span class=w> </span>be<span class=w> </span>dictionaries,<span class=w> </span>and<span class=w> </span>contain<span class=w> </span>only<span class=w> </span>keys<span class=w> </span><span class=sb>``</span>url<span class=sb>``</span><span class=w> </span>and<span class=w> </span><span class=sb>``</span>title<span class=sb>``</span>,<span class=w> </span>and<span class=w> </span>have<span class=w> </span>a<span class=w> </span>shared<span class=w> </span>link<span class=w> </span>from<span class=w> </span>a<span class=w> </span>supported<span class=w> </span>provider
</code></pre></div> <h4 id=规则标记>规则标记<a class=headerlink href=#规则标记 title="Permanent link">&para;</a></h4> <p>使用下列的命令可以查看规则有那些标记</p> <div class=highlight><pre><span></span><code><a id=__codelineno-44-1 name=__codelineno-44-1 href=#__codelineno-44-1></a><span class=c1># ansible-lint -v -T</span>
<a id=__codelineno-44-2 name=__codelineno-44-2 href=#__codelineno-44-2></a>ANSIBLE0002<span class=w> </span><span class=o>[</span><span class=s1>&#39;[201]&#39;</span><span class=o>]</span>
<a id=__codelineno-44-3 name=__codelineno-44-3 href=#__codelineno-44-3></a>ANSIBLE0004<span class=w> </span><span class=o>[</span><span class=s1>&#39;[401]&#39;</span><span class=o>]</span>
<a id=__codelineno-44-4 name=__codelineno-44-4 href=#__codelineno-44-4></a>ANSIBLE0005<span class=w> </span><span class=o>[</span><span class=s1>&#39;[402]&#39;</span><span class=o>]</span>
<a id=__codelineno-44-5 name=__codelineno-44-5 href=#__codelineno-44-5></a>ANSIBLE0006<span class=w> </span><span class=o>[</span><span class=s1>&#39;[303]&#39;</span><span class=o>]</span>
<a id=__codelineno-44-6 name=__codelineno-44-6 href=#__codelineno-44-6></a>ANSIBLE0007<span class=w> </span><span class=o>[</span><span class=s1>&#39;[302]&#39;</span><span class=o>]</span>
<a id=__codelineno-44-7 name=__codelineno-44-7 href=#__codelineno-44-7></a>ANSIBLE0008<span class=w> </span><span class=o>[</span><span class=s1>&#39;[103]&#39;</span><span class=o>]</span>
<a id=__codelineno-44-8 name=__codelineno-44-8 href=#__codelineno-44-8></a>ANSIBLE0009<span class=w> </span><span class=o>[</span><span class=s1>&#39;[202]&#39;</span><span class=o>]</span>
<a id=__codelineno-44-9 name=__codelineno-44-9 href=#__codelineno-44-9></a>ANSIBLE0010<span class=w> </span><span class=o>[</span><span class=s1>&#39;[403]&#39;</span><span class=o>]</span>
<a id=__codelineno-44-10 name=__codelineno-44-10 href=#__codelineno-44-10></a>ANSIBLE0011<span class=w> </span><span class=o>[</span><span class=s1>&#39;[502]&#39;</span><span class=o>]</span>
<a id=__codelineno-44-11 name=__codelineno-44-11 href=#__codelineno-44-11></a>ANSIBLE0012<span class=w> </span><span class=o>[</span><span class=s1>&#39;[301]&#39;</span><span class=o>]</span>
<a id=__codelineno-44-12 name=__codelineno-44-12 href=#__codelineno-44-12></a>ANSIBLE0013<span class=w> </span><span class=o>[</span><span class=s1>&#39;[305]&#39;</span><span class=o>]</span>
<a id=__codelineno-44-13 name=__codelineno-44-13 href=#__codelineno-44-13></a>ANSIBLE0014<span class=w> </span><span class=o>[</span><span class=s1>&#39;[304]&#39;</span><span class=o>]</span>
<a id=__codelineno-44-14 name=__codelineno-44-14 href=#__codelineno-44-14></a>ANSIBLE0015<span class=w> </span><span class=o>[</span><span class=s1>&#39;[104]&#39;</span><span class=o>]</span>
<a id=__codelineno-44-15 name=__codelineno-44-15 href=#__codelineno-44-15></a>ANSIBLE0016<span class=w> </span><span class=o>[</span><span class=s1>&#39;[503]&#39;</span><span class=o>]</span>
<a id=__codelineno-44-16 name=__codelineno-44-16 href=#__codelineno-44-16></a>ANSIBLE0017<span class=w> </span><span class=o>[</span><span class=s1>&#39;[501]&#39;</span><span class=o>]</span>
<a id=__codelineno-44-17 name=__codelineno-44-17 href=#__codelineno-44-17></a>ANSIBLE0018<span class=w> </span><span class=o>[</span><span class=s1>&#39;[101]&#39;</span><span class=o>]</span>
<a id=__codelineno-44-18 name=__codelineno-44-18 href=#__codelineno-44-18></a>ANSIBLE0019<span class=w> </span><span class=o>[</span><span class=s1>&#39;[102]&#39;</span><span class=o>]</span>
<a id=__codelineno-44-19 name=__codelineno-44-19 href=#__codelineno-44-19></a>behaviour<span class=w> </span><span class=o>[</span><span class=s1>&#39;[503]&#39;</span><span class=o>]</span>
<a id=__codelineno-44-20 name=__codelineno-44-20 href=#__codelineno-44-20></a>bug<span class=w> </span><span class=o>[</span><span class=s1>&#39;[304]&#39;</span><span class=o>]</span>
<a id=__codelineno-44-21 name=__codelineno-44-21 href=#__codelineno-44-21></a>command-shell<span class=w> </span><span class=o>[</span><span class=s1>&#39;[301]&#39;</span>,<span class=w> </span><span class=s1>&#39;[302]&#39;</span>,<span class=w> </span><span class=s1>&#39;[303]&#39;</span>,<span class=w> </span><span class=s1>&#39;[304]&#39;</span>,<span class=w> </span><span class=s1>&#39;[306]&#39;</span>,<span class=w> </span><span class=s1>&#39;[305]&#39;</span><span class=o>]</span>
<a id=__codelineno-44-22 name=__codelineno-44-22 href=#__codelineno-44-22></a>deprecated<span class=w> </span><span class=o>[</span><span class=s1>&#39;[101]&#39;</span>,<span class=w> </span><span class=s1>&#39;[105]&#39;</span>,<span class=w> </span><span class=s1>&#39;[102]&#39;</span>,<span class=w> </span><span class=s1>&#39;[103]&#39;</span>,<span class=w> </span><span class=s1>&#39;[104]&#39;</span><span class=o>]</span>
<a id=__codelineno-44-23 name=__codelineno-44-23 href=#__codelineno-44-23></a>formatting<span class=w> </span><span class=o>[</span><span class=s1>&#39;[204]&#39;</span>,<span class=w> </span><span class=s1>&#39;[203]&#39;</span>,<span class=w> </span><span class=s1>&#39;[202]&#39;</span>,<span class=w> </span><span class=s1>&#39;[205]&#39;</span>,<span class=w> </span><span class=s1>&#39;[201]&#39;</span>,<span class=w> </span><span class=s1>&#39;[104]&#39;</span>,<span class=w> </span><span class=s1>&#39;[206]&#39;</span><span class=o>]</span>
<a id=__codelineno-44-24 name=__codelineno-44-24 href=#__codelineno-44-24></a>idempotency<span class=w> </span><span class=o>[</span><span class=s1>&#39;[301]&#39;</span><span class=o>]</span>
<a id=__codelineno-44-25 name=__codelineno-44-25 href=#__codelineno-44-25></a>idiom<span class=w> </span><span class=o>[</span><span class=s1>&#39;[602]&#39;</span>,<span class=w> </span><span class=s1>&#39;[601]&#39;</span><span class=o>]</span>
<a id=__codelineno-44-26 name=__codelineno-44-26 href=#__codelineno-44-26></a>metadata<span class=w> </span><span class=o>[</span><span class=s1>&#39;[703]&#39;</span>,<span class=w> </span><span class=s1>&#39;[701]&#39;</span>,<span class=w> </span><span class=s1>&#39;[702]&#39;</span>,<span class=w> </span><span class=s1>&#39;[704]&#39;</span><span class=o>]</span>
<a id=__codelineno-44-27 name=__codelineno-44-27 href=#__codelineno-44-27></a>module<span class=w> </span><span class=o>[</span><span class=s1>&#39;[401]&#39;</span>,<span class=w> </span><span class=s1>&#39;[402]&#39;</span>,<span class=w> </span><span class=s1>&#39;[403]&#39;</span>,<span class=w> </span><span class=s1>&#39;[404]&#39;</span><span class=o>]</span>
<a id=__codelineno-44-28 name=__codelineno-44-28 href=#__codelineno-44-28></a>oddity<span class=w> </span><span class=o>[</span><span class=s1>&#39;[501]&#39;</span><span class=o>]</span>
<a id=__codelineno-44-29 name=__codelineno-44-29 href=#__codelineno-44-29></a>readability<span class=w> </span><span class=o>[</span><span class=s1>&#39;[502]&#39;</span><span class=o>]</span>
<a id=__codelineno-44-30 name=__codelineno-44-30 href=#__codelineno-44-30></a>repeatability<span class=w> </span><span class=o>[</span><span class=s1>&#39;[401]&#39;</span>,<span class=w> </span><span class=s1>&#39;[402]&#39;</span>,<span class=w> </span><span class=s1>&#39;[403]&#39;</span><span class=o>]</span>
<a id=__codelineno-44-31 name=__codelineno-44-31 href=#__codelineno-44-31></a>resources<span class=w> </span><span class=o>[</span><span class=s1>&#39;[302]&#39;</span>,<span class=w> </span><span class=s1>&#39;[303]&#39;</span><span class=o>]</span>
<a id=__codelineno-44-32 name=__codelineno-44-32 href=#__codelineno-44-32></a>safety<span class=w> </span><span class=o>[</span><span class=s1>&#39;[305]&#39;</span><span class=o>]</span>
<a id=__codelineno-44-33 name=__codelineno-44-33 href=#__codelineno-44-33></a>task<span class=w> </span><span class=o>[</span><span class=s1>&#39;[501]&#39;</span>,<span class=w> </span><span class=s1>&#39;[502]&#39;</span>,<span class=w> </span><span class=s1>&#39;[504]&#39;</span>,<span class=w> </span><span class=s1>&#39;[503]&#39;</span><span class=o>]</span>
</code></pre></div> <p>只检测一个标记规则</p> <div class=highlight><pre><span></span><code><a id=__codelineno-45-1 name=__codelineno-45-1 href=#__codelineno-45-1></a>ansible-lint<span class=w> </span>-t<span class=w> </span>idempotency<span class=w> </span>playbook.yml
</code></pre></div> <p>排除规则</p> <div class=highlight><pre><span></span><code><a id=__codelineno-46-1 name=__codelineno-46-1 href=#__codelineno-46-1></a>ansible-lint<span class=w> </span>-x<span class=w> </span>readability,safety<span class=w> </span>playbook.yml
</code></pre></div> <p>也可以指定规则id</p> <div class=highlight><pre><span></span><code><a id=__codelineno-47-1 name=__codelineno-47-1 href=#__codelineno-47-1></a>ansible-lint<span class=w> </span>-x<span class=w> </span>ANSIBLE0011<span class=w> </span>playbook.yml
</code></pre></div> <h4 id=跳过规则>跳过规则<a class=headerlink href=#跳过规则 title="Permanent link">&para;</a></h4> <p>如果想在任务上跳过检查规则，可在行内末尾加上<code># noqa [rule_id]</code> 即可跳过对应的规则。</p> <div class=highlight><pre><span></span><code><a id=__codelineno-48-1 name=__codelineno-48-1 href=#__codelineno-48-1></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">this would typically fire GitHasVersionRule 401 and BecomeUserWithoutBecomeRule 501</span>
<a id=__codelineno-48-2 name=__codelineno-48-2 href=#__codelineno-48-2></a><span class=w>  </span><span class=nt>become_user</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">alice</span><span class=w>  </span><span class=c1># noqa 401 501</span>
<a id=__codelineno-48-3 name=__codelineno-48-3 href=#__codelineno-48-3></a><span class=w>  </span><span class=nt>git</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">src=/path/to/git/repo dest=checkout</span>
<a id=__codelineno-48-4 name=__codelineno-48-4 href=#__codelineno-48-4></a>
<a id=__codelineno-48-5 name=__codelineno-48-5 href=#__codelineno-48-5></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">this would typically fire LineTooLongRule 204 and VariableHasSpacesRule 206</span>
<a id=__codelineno-48-6 name=__codelineno-48-6 href=#__codelineno-48-6></a><span class=w>  </span><span class=nt>get_url</span><span class=p>:</span>
<a id=__codelineno-48-7 name=__codelineno-48-7 href=#__codelineno-48-7></a><span class=w>    </span><span class=nt>url</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">http://example.com/really_long_path/really_long_path/really_long_path/really_long_path/really_long_path/really_long_path/file.conf</span><span class=w>  </span><span class=c1># noqa 204</span>
<a id=__codelineno-48-8 name=__codelineno-48-8 href=#__codelineno-48-8></a><span class=w>    </span><span class=nt>dest</span><span class=p>:</span><span class=w> </span><span class=s>&quot;{{dest_proj_path}}/foo.conf&quot;</span><span class=w>  </span><span class=c1># noqa 206</span>
</code></pre></div> <p>使用命令行选项跳过</p> <div class=highlight><pre><span></span><code><a id=__codelineno-49-1 name=__codelineno-49-1 href=#__codelineno-49-1></a>ansible-lint<span class=w> </span>-x<span class=w> </span>readability,safety<span class=w> </span>playbook.yml
</code></pre></div> <p>在配置文件中跳过</p> <div class=highlight><pre><span></span><code><a id=__codelineno-50-1 name=__codelineno-50-1 href=#__codelineno-50-1></a><span class=nt>skip_list</span><span class=p>:</span>
<a id=__codelineno-50-2 name=__codelineno-50-2 href=#__codelineno-50-2></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">skip_this_tag</span>
<a id=__codelineno-50-3 name=__codelineno-50-3 href=#__codelineno-50-3></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">and_this_one_too</span>
<a id=__codelineno-50-4 name=__codelineno-50-4 href=#__codelineno-50-4></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">skip_this_id</span>
<a id=__codelineno-50-5 name=__codelineno-50-5 href=#__codelineno-50-5></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&#39;401&#39;</span>
</code></pre></div> <h2 id=5使用动态主机>5.使用动态主机<a class=headerlink href=#5使用动态主机 title="Permanent link">&para;</a></h2> <p>ansible 不仅可以从静态文件中获取主机信息，还可以从动态源（包括云主机资源）中获取主机清单。</p> <p>使用动态主机的时候，我们只需要创建一个脚本或程序，可以在正确的参数输入时已正确的格式打印<code>json</code>字符串，就能自定义一个插件。当然，你可以用任何语言实现这个脚本。</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>目前官方已不推荐使用 <strong>脚本方式</strong> 来动态获取主机信息，推荐使用 <strong>插件方式</strong> 使用动态主机。</p> </div> <h3 id=脚本约定>脚本约定<a class=headerlink href=#脚本约定 title="Permanent link">&para;</a></h3> <p>当我们向脚本输入<code>--list</code>参数时，脚本必须将要管理的所有组以json编码的形式输出到标准输出stdout。每个组的值应该是包含每个主机/ip的列表以及定义的变量。下面给出一个简单示例 <div class=highlight><pre><span></span><code><a id=__codelineno-51-1 name=__codelineno-51-1 href=#__codelineno-51-1></a><span class=p>{</span>
<a id=__codelineno-51-2 name=__codelineno-51-2 href=#__codelineno-51-2></a><span class=w>    </span><span class=nt>&quot;databases&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-51-3 name=__codelineno-51-3 href=#__codelineno-51-3></a><span class=w>        </span><span class=nt>&quot;hosts&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;host1.example.com&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;host2.example.com&quot;</span><span class=p>],</span>
<a id=__codelineno-51-4 name=__codelineno-51-4 href=#__codelineno-51-4></a><span class=w>        </span><span class=nt>&quot;vars&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-51-5 name=__codelineno-51-5 href=#__codelineno-51-5></a><span class=w>            </span><span class=nt>&quot;a&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>true</span>
<a id=__codelineno-51-6 name=__codelineno-51-6 href=#__codelineno-51-6></a><span class=w>        </span><span class=p>}</span>
<a id=__codelineno-51-7 name=__codelineno-51-7 href=#__codelineno-51-7></a><span class=w>    </span><span class=p>},</span>
<a id=__codelineno-51-8 name=__codelineno-51-8 href=#__codelineno-51-8></a><span class=w>    </span><span class=nt>&quot;webservers&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;host2.example.com&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;host3.example.com&quot;</span><span class=p>],</span>
<a id=__codelineno-51-9 name=__codelineno-51-9 href=#__codelineno-51-9></a><span class=w>    </span><span class=nt>&quot;atlanta&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-51-10 name=__codelineno-51-10 href=#__codelineno-51-10></a><span class=w>        </span><span class=nt>&quot;hosts&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;host1.example.com&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;host4.example.com&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;host5.example.com&quot;</span><span class=p>],</span>
<a id=__codelineno-51-11 name=__codelineno-51-11 href=#__codelineno-51-11></a><span class=w>        </span><span class=nt>&quot;vars&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-51-12 name=__codelineno-51-12 href=#__codelineno-51-12></a><span class=w>            </span><span class=nt>&quot;b&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>false</span>
<a id=__codelineno-51-13 name=__codelineno-51-13 href=#__codelineno-51-13></a><span class=w>        </span><span class=p>},</span>
<a id=__codelineno-51-14 name=__codelineno-51-14 href=#__codelineno-51-14></a><span class=w>        </span><span class=nt>&quot;children&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;marietta&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;5points&quot;</span><span class=p>]</span>
<a id=__codelineno-51-15 name=__codelineno-51-15 href=#__codelineno-51-15></a><span class=w>    </span><span class=p>},</span>
<a id=__codelineno-51-16 name=__codelineno-51-16 href=#__codelineno-51-16></a><span class=w>    </span><span class=nt>&quot;marietta&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;host6.example.com&quot;</span><span class=p>],</span>
<a id=__codelineno-51-17 name=__codelineno-51-17 href=#__codelineno-51-17></a><span class=w>    </span><span class=nt>&quot;5points&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;host7.example.com&quot;</span><span class=p>]</span>
<a id=__codelineno-51-18 name=__codelineno-51-18 href=#__codelineno-51-18></a><span class=p>}</span>
</code></pre></div></p> <ul> <li><code>databases</code> 是主机组名称</li> <li><code>hosts</code> 是主机组的主机列表</li> <li><code>vars</code> 是主机组的变量</li> <li><code>children</code> 是主机组的子组</li> </ul> <p>当我们向脚本输入 <code>--host &lt;hostname&gt;</code>参数时，脚本必须输出一个空的json字符串或一个变量的列表/字典，以便temlates和playbook可以使用。输出变量是可选的，如果脚本不希望输出，那输出一个空的列表/字典也是可以的。下面一个简单的示例 <div class=highlight><pre><span></span><code><a id=__codelineno-52-1 name=__codelineno-52-1 href=#__codelineno-52-1></a><span class=p>{</span>
<a id=__codelineno-52-2 name=__codelineno-52-2 href=#__codelineno-52-2></a><span class=w>    </span><span class=nt>&quot;favcolor&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;red&quot;</span><span class=p>,</span>
<a id=__codelineno-52-3 name=__codelineno-52-3 href=#__codelineno-52-3></a><span class=w>    </span><span class=nt>&quot;ntpserver&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;wolf.example.com&quot;</span><span class=p>,</span>
<a id=__codelineno-52-4 name=__codelineno-52-4 href=#__codelineno-52-4></a><span class=w>    </span><span class=nt>&quot;monitoring&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;pack.example.com&quot;</span>
<a id=__codelineno-52-5 name=__codelineno-52-5 href=#__codelineno-52-5></a><span class=p>}</span>
</code></pre></div></p> <p>定义hostvars的主机变量，下面一个简单的示例 <div class=highlight><pre><span></span><code><a id=__codelineno-53-1 name=__codelineno-53-1 href=#__codelineno-53-1></a>{
<a id=__codelineno-53-2 name=__codelineno-53-2 href=#__codelineno-53-2></a>
<a id=__codelineno-53-3 name=__codelineno-53-3 href=#__codelineno-53-3></a>    # results of inventory script as above go here
<a id=__codelineno-53-4 name=__codelineno-53-4 href=#__codelineno-53-4></a>    # ...
<a id=__codelineno-53-5 name=__codelineno-53-5 href=#__codelineno-53-5></a>
<a id=__codelineno-53-6 name=__codelineno-53-6 href=#__codelineno-53-6></a>    &quot;_meta&quot;: {
<a id=__codelineno-53-7 name=__codelineno-53-7 href=#__codelineno-53-7></a>        &quot;hostvars&quot;: {
<a id=__codelineno-53-8 name=__codelineno-53-8 href=#__codelineno-53-8></a>            &quot;moocow.example.com&quot;: {
<a id=__codelineno-53-9 name=__codelineno-53-9 href=#__codelineno-53-9></a>                &quot;asdf&quot;: 1234
<a id=__codelineno-53-10 name=__codelineno-53-10 href=#__codelineno-53-10></a>            },
<a id=__codelineno-53-11 name=__codelineno-53-11 href=#__codelineno-53-11></a>            &quot;llama.example.com&quot;: {
<a id=__codelineno-53-12 name=__codelineno-53-12 href=#__codelineno-53-12></a>                &quot;asdf&quot;: 5678
<a id=__codelineno-53-13 name=__codelineno-53-13 href=#__codelineno-53-13></a>            }
<a id=__codelineno-53-14 name=__codelineno-53-14 href=#__codelineno-53-14></a>        }
<a id=__codelineno-53-15 name=__codelineno-53-15 href=#__codelineno-53-15></a>    }
<a id=__codelineno-53-16 name=__codelineno-53-16 href=#__codelineno-53-16></a>}
</code></pre></div></p> <ul> <li><code>hostvars</code> 指的是主机变量</li> <li><code>moocow.example.com</code> 主机名称，与主机组内的名称对应</li> <li><code>"asdf": 1234</code> 主机变量</li> </ul> <p>总体而言，一个简单的<code>inventory</code>数据结构如下</p> <div class=highlight><pre><span></span><code><a id=__codelineno-54-1 name=__codelineno-54-1 href=#__codelineno-54-1></a><span class=p>{</span>
<a id=__codelineno-54-2 name=__codelineno-54-2 href=#__codelineno-54-2></a><span class=w>    </span><span class=nt>&quot;all&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-54-3 name=__codelineno-54-3 href=#__codelineno-54-3></a><span class=w>        </span><span class=nt>&quot;hosts&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;address&quot;</span><span class=p>],</span>
<a id=__codelineno-54-4 name=__codelineno-54-4 href=#__codelineno-54-4></a><span class=w>        </span><span class=nt>&quot;vars&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{},</span>
<a id=__codelineno-54-5 name=__codelineno-54-5 href=#__codelineno-54-5></a><span class=w>    </span><span class=p>},</span>
<a id=__codelineno-54-6 name=__codelineno-54-6 href=#__codelineno-54-6></a><span class=w>    </span><span class=nt>&quot;_meta&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-54-7 name=__codelineno-54-7 href=#__codelineno-54-7></a><span class=w>        </span><span class=nt>&quot;hostvars&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-54-8 name=__codelineno-54-8 href=#__codelineno-54-8></a><span class=w>            </span><span class=nt>&quot;address&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-54-9 name=__codelineno-54-9 href=#__codelineno-54-9></a><span class=w>                </span><span class=nt>&quot;variable_name&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;value&quot;</span><span class=p>,</span>
<a id=__codelineno-54-10 name=__codelineno-54-10 href=#__codelineno-54-10></a><span class=w>            </span><span class=p>}</span>
<a id=__codelineno-54-11 name=__codelineno-54-11 href=#__codelineno-54-11></a><span class=w>        </span><span class=p>},</span>
<a id=__codelineno-54-12 name=__codelineno-54-12 href=#__codelineno-54-12></a><span class=w>    </span><span class=p>},</span>
<a id=__codelineno-54-13 name=__codelineno-54-13 href=#__codelineno-54-13></a><span class=w>    </span><span class=nt>&quot;group_name&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;address&quot;</span><span class=p>]</span>
<a id=__codelineno-54-14 name=__codelineno-54-14 href=#__codelineno-54-14></a><span class=p>}</span>
</code></pre></div> <h3 id=简单例子>简单例子<a class=headerlink href=#简单例子 title="Permanent link">&para;</a></h3> <p>获取自定义的主机信息</p> <div class=highlight><pre><span></span><code><a id=__codelineno-55-1 name=__codelineno-55-1 href=#__codelineno-55-1></a><span class=ch>#!/usr/bin/env python</span>
<a id=__codelineno-55-2 name=__codelineno-55-2 href=#__codelineno-55-2></a>
<a id=__codelineno-55-3 name=__codelineno-55-3 href=#__codelineno-55-3></a><span class=sd>&#39;&#39;&#39;</span>
<a id=__codelineno-55-4 name=__codelineno-55-4 href=#__codelineno-55-4></a><span class=sd>Example custom dynamic inventory script for Ansible, in Python.</span>
<a id=__codelineno-55-5 name=__codelineno-55-5 href=#__codelineno-55-5></a><span class=sd>&#39;&#39;&#39;</span>
<a id=__codelineno-55-6 name=__codelineno-55-6 href=#__codelineno-55-6></a>
<a id=__codelineno-55-7 name=__codelineno-55-7 href=#__codelineno-55-7></a><span class=kn>import</span> <span class=nn>os</span>
<a id=__codelineno-55-8 name=__codelineno-55-8 href=#__codelineno-55-8></a><span class=kn>import</span> <span class=nn>sys</span>
<a id=__codelineno-55-9 name=__codelineno-55-9 href=#__codelineno-55-9></a><span class=kn>import</span> <span class=nn>argparse</span>
<a id=__codelineno-55-10 name=__codelineno-55-10 href=#__codelineno-55-10></a>
<a id=__codelineno-55-11 name=__codelineno-55-11 href=#__codelineno-55-11></a><span class=k>try</span><span class=p>:</span>
<a id=__codelineno-55-12 name=__codelineno-55-12 href=#__codelineno-55-12></a>    <span class=kn>import</span> <span class=nn>json</span>
<a id=__codelineno-55-13 name=__codelineno-55-13 href=#__codelineno-55-13></a><span class=k>except</span> <span class=ne>ImportError</span><span class=p>:</span>
<a id=__codelineno-55-14 name=__codelineno-55-14 href=#__codelineno-55-14></a>    <span class=kn>import</span> <span class=nn>simplejson</span> <span class=k>as</span> <span class=nn>json</span>
<a id=__codelineno-55-15 name=__codelineno-55-15 href=#__codelineno-55-15></a>
<a id=__codelineno-55-16 name=__codelineno-55-16 href=#__codelineno-55-16></a><span class=k>class</span> <span class=nc>ExampleInventory</span><span class=p>(</span><span class=nb>object</span><span class=p>):</span>
<a id=__codelineno-55-17 name=__codelineno-55-17 href=#__codelineno-55-17></a>
<a id=__codelineno-55-18 name=__codelineno-55-18 href=#__codelineno-55-18></a>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a id=__codelineno-55-19 name=__codelineno-55-19 href=#__codelineno-55-19></a>        <span class=bp>self</span><span class=o>.</span><span class=n>inventory</span> <span class=o>=</span> <span class=p>{}</span>
<a id=__codelineno-55-20 name=__codelineno-55-20 href=#__codelineno-55-20></a>        <span class=bp>self</span><span class=o>.</span><span class=n>read_cli_args</span><span class=p>()</span>
<a id=__codelineno-55-21 name=__codelineno-55-21 href=#__codelineno-55-21></a>
<a id=__codelineno-55-22 name=__codelineno-55-22 href=#__codelineno-55-22></a>        <span class=c1># Called with `--list`.</span>
<a id=__codelineno-55-23 name=__codelineno-55-23 href=#__codelineno-55-23></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>args</span><span class=o>.</span><span class=n>list</span><span class=p>:</span>
<a id=__codelineno-55-24 name=__codelineno-55-24 href=#__codelineno-55-24></a>            <span class=bp>self</span><span class=o>.</span><span class=n>inventory</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>example_inventory</span><span class=p>()</span>
<a id=__codelineno-55-25 name=__codelineno-55-25 href=#__codelineno-55-25></a>        <span class=c1># Called with `--host [hostname]`.</span>
<a id=__codelineno-55-26 name=__codelineno-55-26 href=#__codelineno-55-26></a>        <span class=k>elif</span> <span class=bp>self</span><span class=o>.</span><span class=n>args</span><span class=o>.</span><span class=n>host</span><span class=p>:</span>
<a id=__codelineno-55-27 name=__codelineno-55-27 href=#__codelineno-55-27></a>            <span class=c1># Not implemented, since we return _meta info `--list`.</span>
<a id=__codelineno-55-28 name=__codelineno-55-28 href=#__codelineno-55-28></a>            <span class=bp>self</span><span class=o>.</span><span class=n>inventory</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>empty_inventory</span><span class=p>()</span>
<a id=__codelineno-55-29 name=__codelineno-55-29 href=#__codelineno-55-29></a>        <span class=c1># If no groups or vars are present, return empty inventory.</span>
<a id=__codelineno-55-30 name=__codelineno-55-30 href=#__codelineno-55-30></a>        <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-55-31 name=__codelineno-55-31 href=#__codelineno-55-31></a>            <span class=bp>self</span><span class=o>.</span><span class=n>inventory</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>empty_inventory</span><span class=p>()</span>
<a id=__codelineno-55-32 name=__codelineno-55-32 href=#__codelineno-55-32></a>
<a id=__codelineno-55-33 name=__codelineno-55-33 href=#__codelineno-55-33></a>        <span class=nb>print</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>inventory</span><span class=p>);</span>
<a id=__codelineno-55-34 name=__codelineno-55-34 href=#__codelineno-55-34></a>
<a id=__codelineno-55-35 name=__codelineno-55-35 href=#__codelineno-55-35></a>    <span class=c1># Example inventory for testing.</span>
<a id=__codelineno-55-36 name=__codelineno-55-36 href=#__codelineno-55-36></a>    <span class=k>def</span> <span class=nf>example_inventory</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a id=__codelineno-55-37 name=__codelineno-55-37 href=#__codelineno-55-37></a>        <span class=k>return</span> <span class=p>{</span>
<a id=__codelineno-55-38 name=__codelineno-55-38 href=#__codelineno-55-38></a>            <span class=s1>&#39;group&#39;</span><span class=p>:</span> <span class=p>{</span>
<a id=__codelineno-55-39 name=__codelineno-55-39 href=#__codelineno-55-39></a>                <span class=s1>&#39;hosts&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;192.168.77.129&#39;</span><span class=p>,</span> <span class=s1>&#39;192.168.77.130&#39;</span><span class=p>],</span>
<a id=__codelineno-55-40 name=__codelineno-55-40 href=#__codelineno-55-40></a>                <span class=s1>&#39;vars&#39;</span><span class=p>:</span> <span class=p>{</span>
<a id=__codelineno-55-41 name=__codelineno-55-41 href=#__codelineno-55-41></a>                    <span class=s1>&#39;ansible_ssh_user&#39;</span><span class=p>:</span> <span class=s1>&#39;root&#39;</span><span class=p>,</span>
<a id=__codelineno-55-42 name=__codelineno-55-42 href=#__codelineno-55-42></a>                    <span class=s1>&#39;ansible_ssh_pass&#39;</span><span class=p>:</span> <span class=s1>&#39;123456&#39;</span><span class=p>,</span>
<a id=__codelineno-55-43 name=__codelineno-55-43 href=#__codelineno-55-43></a>                    <span class=s1>&#39;example_variable&#39;</span><span class=p>:</span> <span class=s1>&#39;value&#39;</span>
<a id=__codelineno-55-44 name=__codelineno-55-44 href=#__codelineno-55-44></a>                <span class=p>}</span>
<a id=__codelineno-55-45 name=__codelineno-55-45 href=#__codelineno-55-45></a>            <span class=p>},</span>
<a id=__codelineno-55-46 name=__codelineno-55-46 href=#__codelineno-55-46></a>            <span class=s1>&#39;_meta&#39;</span><span class=p>:</span> <span class=p>{</span>
<a id=__codelineno-55-47 name=__codelineno-55-47 href=#__codelineno-55-47></a>                <span class=s1>&#39;hostvars&#39;</span><span class=p>:</span> <span class=p>{</span>
<a id=__codelineno-55-48 name=__codelineno-55-48 href=#__codelineno-55-48></a>                    <span class=s1>&#39;192.168.77.129&#39;</span><span class=p>:</span> <span class=p>{</span>
<a id=__codelineno-55-49 name=__codelineno-55-49 href=#__codelineno-55-49></a>                        <span class=s1>&#39;host_specific_var&#39;</span><span class=p>:</span> <span class=s1>&#39;foo&#39;</span>
<a id=__codelineno-55-50 name=__codelineno-55-50 href=#__codelineno-55-50></a>                    <span class=p>},</span>
<a id=__codelineno-55-51 name=__codelineno-55-51 href=#__codelineno-55-51></a>                    <span class=s1>&#39;192.168.77.130&#39;</span><span class=p>:</span> <span class=p>{</span>
<a id=__codelineno-55-52 name=__codelineno-55-52 href=#__codelineno-55-52></a>                        <span class=s1>&#39;host_specific_var&#39;</span><span class=p>:</span> <span class=s1>&#39;bar&#39;</span>
<a id=__codelineno-55-53 name=__codelineno-55-53 href=#__codelineno-55-53></a>                    <span class=p>}</span>
<a id=__codelineno-55-54 name=__codelineno-55-54 href=#__codelineno-55-54></a>                <span class=p>}</span>
<a id=__codelineno-55-55 name=__codelineno-55-55 href=#__codelineno-55-55></a>            <span class=p>}</span>
<a id=__codelineno-55-56 name=__codelineno-55-56 href=#__codelineno-55-56></a>        <span class=p>}</span>
<a id=__codelineno-55-57 name=__codelineno-55-57 href=#__codelineno-55-57></a>
<a id=__codelineno-55-58 name=__codelineno-55-58 href=#__codelineno-55-58></a>    <span class=c1># Empty inventory for testing.</span>
<a id=__codelineno-55-59 name=__codelineno-55-59 href=#__codelineno-55-59></a>    <span class=k>def</span> <span class=nf>empty_inventory</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a id=__codelineno-55-60 name=__codelineno-55-60 href=#__codelineno-55-60></a>        <span class=k>return</span> <span class=p>{</span><span class=s1>&#39;_meta&#39;</span><span class=p>:</span> <span class=p>{</span><span class=s1>&#39;hostvars&#39;</span><span class=p>:</span> <span class=p>{}}}</span>
<a id=__codelineno-55-61 name=__codelineno-55-61 href=#__codelineno-55-61></a>
<a id=__codelineno-55-62 name=__codelineno-55-62 href=#__codelineno-55-62></a>    <span class=c1># Read the command line args passed to the script.</span>
<a id=__codelineno-55-63 name=__codelineno-55-63 href=#__codelineno-55-63></a>    <span class=k>def</span> <span class=nf>read_cli_args</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a id=__codelineno-55-64 name=__codelineno-55-64 href=#__codelineno-55-64></a>        <span class=n>parser</span> <span class=o>=</span> <span class=n>argparse</span><span class=o>.</span><span class=n>ArgumentParser</span><span class=p>()</span>
<a id=__codelineno-55-65 name=__codelineno-55-65 href=#__codelineno-55-65></a>        <span class=n>parser</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span><span class=s1>&#39;--list&#39;</span><span class=p>,</span> <span class=n>action</span> <span class=o>=</span> <span class=s1>&#39;store_true&#39;</span><span class=p>)</span>
<a id=__codelineno-55-66 name=__codelineno-55-66 href=#__codelineno-55-66></a>        <span class=n>parser</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span><span class=s1>&#39;--host&#39;</span><span class=p>,</span> <span class=n>action</span> <span class=o>=</span> <span class=s1>&#39;store&#39;</span><span class=p>)</span>
<a id=__codelineno-55-67 name=__codelineno-55-67 href=#__codelineno-55-67></a>        <span class=bp>self</span><span class=o>.</span><span class=n>args</span> <span class=o>=</span> <span class=n>parser</span><span class=o>.</span><span class=n>parse_args</span><span class=p>()</span>
<a id=__codelineno-55-68 name=__codelineno-55-68 href=#__codelineno-55-68></a>
<a id=__codelineno-55-69 name=__codelineno-55-69 href=#__codelineno-55-69></a><span class=c1># Get the inventory.</span>
<a id=__codelineno-55-70 name=__codelineno-55-70 href=#__codelineno-55-70></a><span class=n>ExampleInventory</span><span class=p>()</span>
</code></pre></div> <p>本脚本中<code>example_inventory</code>中直接返回了一个json结构，大家可以解析各种源数据来构建json结构返回即可。</p> <h3 id=脚本使用>脚本使用<a class=headerlink href=#脚本使用 title="Permanent link">&para;</a></h3> <p>赋予插件可执行权限 <div class=highlight><pre><span></span><code><a id=__codelineno-56-1 name=__codelineno-56-1 href=#__codelineno-56-1></a>chmod<span class=w> </span>+x<span class=w> </span>test_inventory.py
</code></pre></div></p> <p><code>--list</code> 数据 <div class=highlight><pre><span></span><code><a id=__codelineno-57-1 name=__codelineno-57-1 href=#__codelineno-57-1></a>./test_inventory.py<span class=w> </span>--list
<a id=__codelineno-57-2 name=__codelineno-57-2 href=#__codelineno-57-2></a><span class=o>{</span>
<a id=__codelineno-57-3 name=__codelineno-57-3 href=#__codelineno-57-3></a><span class=w>  </span><span class=s2>&quot;_meta&quot;</span>:<span class=w> </span><span class=o>{</span>
<a id=__codelineno-57-4 name=__codelineno-57-4 href=#__codelineno-57-4></a><span class=w>    </span><span class=s2>&quot;hostvars&quot;</span>:<span class=w> </span><span class=o>{</span>
<a id=__codelineno-57-5 name=__codelineno-57-5 href=#__codelineno-57-5></a><span class=w>      </span><span class=s2>&quot;192.168.77.130&quot;</span>:<span class=w> </span><span class=o>{</span>
<a id=__codelineno-57-6 name=__codelineno-57-6 href=#__codelineno-57-6></a><span class=w>        </span><span class=s2>&quot;host_specific_var&quot;</span>:<span class=w> </span><span class=s2>&quot;foo&quot;</span>
<a id=__codelineno-57-7 name=__codelineno-57-7 href=#__codelineno-57-7></a><span class=w>      </span><span class=o>}</span>,<span class=w> </span>
<a id=__codelineno-57-8 name=__codelineno-57-8 href=#__codelineno-57-8></a><span class=w>      </span><span class=s2>&quot;192.168.77.131&quot;</span>:<span class=w> </span><span class=o>{</span>
<a id=__codelineno-57-9 name=__codelineno-57-9 href=#__codelineno-57-9></a><span class=w>        </span><span class=s2>&quot;host_specific_var&quot;</span>:<span class=w> </span><span class=s2>&quot;bar&quot;</span>
<a id=__codelineno-57-10 name=__codelineno-57-10 href=#__codelineno-57-10></a><span class=w>      </span><span class=o>}</span>
<a id=__codelineno-57-11 name=__codelineno-57-11 href=#__codelineno-57-11></a><span class=w>    </span><span class=o>}</span>
<a id=__codelineno-57-12 name=__codelineno-57-12 href=#__codelineno-57-12></a><span class=w>  </span><span class=o>}</span>,<span class=w> </span>
<a id=__codelineno-57-13 name=__codelineno-57-13 href=#__codelineno-57-13></a><span class=w>  </span><span class=s2>&quot;group&quot;</span>:<span class=w> </span><span class=o>{</span>
<a id=__codelineno-57-14 name=__codelineno-57-14 href=#__codelineno-57-14></a><span class=w>    </span><span class=s2>&quot;hosts&quot;</span>:<span class=w> </span><span class=o>[</span>
<a id=__codelineno-57-15 name=__codelineno-57-15 href=#__codelineno-57-15></a><span class=w>      </span><span class=s2>&quot;192.168.77.130&quot;</span>,<span class=w> </span>
<a id=__codelineno-57-16 name=__codelineno-57-16 href=#__codelineno-57-16></a><span class=w>      </span><span class=s2>&quot;192.168.77.131&quot;</span>
<a id=__codelineno-57-17 name=__codelineno-57-17 href=#__codelineno-57-17></a><span class=w>    </span><span class=o>]</span>,<span class=w> </span>
<a id=__codelineno-57-18 name=__codelineno-57-18 href=#__codelineno-57-18></a><span class=w>    </span><span class=s2>&quot;vars&quot;</span>:<span class=w> </span><span class=o>{</span>
<a id=__codelineno-57-19 name=__codelineno-57-19 href=#__codelineno-57-19></a><span class=w>      </span><span class=s2>&quot;ansible_ssh_pass&quot;</span>:<span class=w> </span><span class=s2>&quot;123456&quot;</span>,<span class=w> </span>
<a id=__codelineno-57-20 name=__codelineno-57-20 href=#__codelineno-57-20></a><span class=w>      </span><span class=s2>&quot;ansible_ssh_user&quot;</span>:<span class=w> </span><span class=s2>&quot;root&quot;</span>,<span class=w> </span>
<a id=__codelineno-57-21 name=__codelineno-57-21 href=#__codelineno-57-21></a><span class=w>      </span><span class=s2>&quot;example_variable&quot;</span>:<span class=w> </span><span class=s2>&quot;value&quot;</span>
<a id=__codelineno-57-22 name=__codelineno-57-22 href=#__codelineno-57-22></a><span class=w>    </span><span class=o>}</span>
<a id=__codelineno-57-23 name=__codelineno-57-23 href=#__codelineno-57-23></a><span class=w>  </span><span class=o>}</span>
<a id=__codelineno-57-24 name=__codelineno-57-24 href=#__codelineno-57-24></a><span class=o>}</span>
</code></pre></div> <code>--host</code> 数据 <div class=highlight><pre><span></span><code><a id=__codelineno-58-1 name=__codelineno-58-1 href=#__codelineno-58-1></a><span class=o>[</span>root@node130<span class=w> </span>~<span class=o>]</span><span class=c1># ./test_inventory.py --host 192.168.77.130</span>
<a id=__codelineno-58-2 name=__codelineno-58-2 href=#__codelineno-58-2></a><span class=o>{</span>
<a id=__codelineno-58-3 name=__codelineno-58-3 href=#__codelineno-58-3></a><span class=w>  </span><span class=s2>&quot;host_specific_var&quot;</span>:<span class=w> </span><span class=s2>&quot;foo&quot;</span>
<a id=__codelineno-58-4 name=__codelineno-58-4 href=#__codelineno-58-4></a><span class=o>}</span>
<a id=__codelineno-58-5 name=__codelineno-58-5 href=#__codelineno-58-5></a><span class=o>[</span>root@node130<span class=w> </span>~<span class=o>]</span><span class=c1># ./test_inventory.py --host 192.168.77.131</span>
<a id=__codelineno-58-6 name=__codelineno-58-6 href=#__codelineno-58-6></a><span class=o>{</span>
<a id=__codelineno-58-7 name=__codelineno-58-7 href=#__codelineno-58-7></a><span class=w>  </span><span class=s2>&quot;host_specific_var&quot;</span>:<span class=w> </span><span class=s2>&quot;bar&quot;</span>
<a id=__codelineno-58-8 name=__codelineno-58-8 href=#__codelineno-58-8></a><span class=o>}</span>
</code></pre></div></p> <h4 id=执行-ad-hoc-命令>执行 ad-hoc 命令<a class=headerlink href=#执行-ad-hoc-命令 title="Permanent link">&para;</a></h4> <p>在命令中使用 <code>-i</code> 选项指定脚本路径即可获取动态主机信息</p> <div class=highlight><pre><span></span><code><a id=__codelineno-59-1 name=__codelineno-59-1 href=#__codelineno-59-1></a>ansible<span class=w> </span>all<span class=w> </span>-i<span class=w> </span>test_inventory.py<span class=w> </span>-m<span class=w> </span>ping
<a id=__codelineno-59-2 name=__codelineno-59-2 href=#__codelineno-59-2></a><span class=m>192</span>.168.77.130<span class=w> </span><span class=p>|</span><span class=w> </span><span class=nv>SUCCESS</span><span class=w> </span><span class=o>=</span>&gt;<span class=w> </span><span class=o>{</span>
<a id=__codelineno-59-3 name=__codelineno-59-3 href=#__codelineno-59-3></a><span class=w>    </span><span class=s2>&quot;ansible_facts&quot;</span>:<span class=w> </span><span class=o>{</span>
<a id=__codelineno-59-4 name=__codelineno-59-4 href=#__codelineno-59-4></a><span class=w>        </span><span class=s2>&quot;discovered_interpreter_python&quot;</span>:<span class=w> </span><span class=s2>&quot;/usr/bin/python&quot;</span>
<a id=__codelineno-59-5 name=__codelineno-59-5 href=#__codelineno-59-5></a><span class=w>    </span><span class=o>}</span>,<span class=w> </span>
<a id=__codelineno-59-6 name=__codelineno-59-6 href=#__codelineno-59-6></a><span class=w>    </span><span class=s2>&quot;changed&quot;</span>:<span class=w> </span>false,<span class=w> </span>
<a id=__codelineno-59-7 name=__codelineno-59-7 href=#__codelineno-59-7></a><span class=w>    </span><span class=s2>&quot;ping&quot;</span>:<span class=w> </span><span class=s2>&quot;pong&quot;</span>
<a id=__codelineno-59-8 name=__codelineno-59-8 href=#__codelineno-59-8></a><span class=o>}</span>
<a id=__codelineno-59-9 name=__codelineno-59-9 href=#__codelineno-59-9></a><span class=m>192</span>.168.77.131<span class=w> </span><span class=p>|</span><span class=w> </span><span class=nv>SUCCESS</span><span class=w> </span><span class=o>=</span>&gt;<span class=w> </span><span class=o>{</span>
<a id=__codelineno-59-10 name=__codelineno-59-10 href=#__codelineno-59-10></a><span class=w>    </span><span class=s2>&quot;ansible_facts&quot;</span>:<span class=w> </span><span class=o>{</span>
<a id=__codelineno-59-11 name=__codelineno-59-11 href=#__codelineno-59-11></a><span class=w>        </span><span class=s2>&quot;discovered_interpreter_python&quot;</span>:<span class=w> </span><span class=s2>&quot;/usr/bin/python&quot;</span>
<a id=__codelineno-59-12 name=__codelineno-59-12 href=#__codelineno-59-12></a><span class=w>    </span><span class=o>}</span>,<span class=w> </span>
<a id=__codelineno-59-13 name=__codelineno-59-13 href=#__codelineno-59-13></a><span class=w>    </span><span class=s2>&quot;changed&quot;</span>:<span class=w> </span>false,<span class=w> </span>
<a id=__codelineno-59-14 name=__codelineno-59-14 href=#__codelineno-59-14></a><span class=w>    </span><span class=s2>&quot;ping&quot;</span>:<span class=w> </span><span class=s2>&quot;pong&quot;</span>
<a id=__codelineno-59-15 name=__codelineno-59-15 href=#__codelineno-59-15></a><span class=o>}</span>
<a id=__codelineno-59-16 name=__codelineno-59-16 href=#__codelineno-59-16></a><span class=c1># ansible-playbook -i test_inventory.py test.yml </span>
<a id=__codelineno-59-17 name=__codelineno-59-17 href=#__codelineno-59-17></a>
<a id=__codelineno-59-18 name=__codelineno-59-18 href=#__codelineno-59-18></a>PLAY<span class=w> </span><span class=o>[</span>all<span class=o>]</span><span class=w> </span>*****************************************************************************************
<a id=__codelineno-59-19 name=__codelineno-59-19 href=#__codelineno-59-19></a>
<a id=__codelineno-59-20 name=__codelineno-59-20 href=#__codelineno-59-20></a>TASK<span class=w> </span><span class=o>[</span>ping<span class=o>]</span><span class=w> </span>*****************************************************************************************
<a id=__codelineno-59-21 name=__codelineno-59-21 href=#__codelineno-59-21></a>ok:<span class=w> </span><span class=o>[</span><span class=m>192</span>.168.77.131<span class=o>]</span>
<a id=__codelineno-59-22 name=__codelineno-59-22 href=#__codelineno-59-22></a>ok:<span class=w> </span><span class=o>[</span><span class=m>192</span>.168.77.130<span class=o>]</span>
<a id=__codelineno-59-23 name=__codelineno-59-23 href=#__codelineno-59-23></a>
<a id=__codelineno-59-24 name=__codelineno-59-24 href=#__codelineno-59-24></a>PLAY<span class=w> </span>RECAP<span class=w> </span>*****************************************************************************************
<a id=__codelineno-59-25 name=__codelineno-59-25 href=#__codelineno-59-25></a><span class=m>192</span>.168.77.130<span class=w>             </span>:<span class=w> </span><span class=nv>ok</span><span class=o>=</span><span class=m>1</span><span class=w>    </span><span class=nv>changed</span><span class=o>=</span><span class=m>0</span><span class=w>    </span><span class=nv>unreachable</span><span class=o>=</span><span class=m>0</span><span class=w>    </span><span class=nv>failed</span><span class=o>=</span><span class=m>0</span><span class=w>    </span><span class=nv>skipped</span><span class=o>=</span><span class=m>0</span><span class=w>    </span><span class=nv>rescued</span><span class=o>=</span><span class=m>0</span><span class=w>    </span><span class=nv>ignored</span><span class=o>=</span><span class=m>0</span><span class=w>   </span>
<a id=__codelineno-59-26 name=__codelineno-59-26 href=#__codelineno-59-26></a><span class=m>192</span>.168.77.131<span class=w>             </span>:<span class=w> </span><span class=nv>ok</span><span class=o>=</span><span class=m>1</span><span class=w>    </span><span class=nv>changed</span><span class=o>=</span><span class=m>0</span><span class=w>    </span><span class=nv>unreachable</span><span class=o>=</span><span class=m>0</span><span class=w>    </span><span class=nv>failed</span><span class=o>=</span><span class=m>0</span><span class=w>    </span><span class=nv>skipped</span><span class=o>=</span><span class=m>0</span><span class=w>    </span><span class=nv>rescued</span><span class=o>=</span><span class=m>0</span><span class=w>    </span><span class=nv>ignored</span><span class=o>=</span><span class=m>0</span><span class=w>   </span>
</code></pre></div> <p>查看定义的主机变量 <div class=highlight><pre><span></span><code><a id=__codelineno-60-1 name=__codelineno-60-1 href=#__codelineno-60-1></a><span class=c1># ansible all -i test_inventory.py -m debug -a &quot;var=host_specific_var&quot;</span>
<a id=__codelineno-60-2 name=__codelineno-60-2 href=#__codelineno-60-2></a><span class=m>192</span>.168.77.130<span class=w> </span><span class=p>|</span><span class=w> </span><span class=nv>SUCCESS</span><span class=w> </span><span class=o>=</span>&gt;<span class=w> </span><span class=o>{</span>
<a id=__codelineno-60-3 name=__codelineno-60-3 href=#__codelineno-60-3></a><span class=w>    </span><span class=s2>&quot;host_specific_var&quot;</span>:<span class=w> </span><span class=s2>&quot;foo&quot;</span>
<a id=__codelineno-60-4 name=__codelineno-60-4 href=#__codelineno-60-4></a><span class=o>}</span>
<a id=__codelineno-60-5 name=__codelineno-60-5 href=#__codelineno-60-5></a><span class=m>192</span>.168.77.131<span class=w> </span><span class=p>|</span><span class=w> </span><span class=nv>SUCCESS</span><span class=w> </span><span class=o>=</span>&gt;<span class=w> </span><span class=o>{</span>
<a id=__codelineno-60-6 name=__codelineno-60-6 href=#__codelineno-60-6></a><span class=w>    </span><span class=s2>&quot;host_specific_var&quot;</span>:<span class=w> </span><span class=s2>&quot;bar&quot;</span>
<a id=__codelineno-60-7 name=__codelineno-60-7 href=#__codelineno-60-7></a><span class=o>}</span>
<a id=__codelineno-60-8 name=__codelineno-60-8 href=#__codelineno-60-8></a>
<a id=__codelineno-60-9 name=__codelineno-60-9 href=#__codelineno-60-9></a><span class=c1># ansible all -i test_inventory.py -m debug -a &quot;var=example_variable&quot;</span>
<a id=__codelineno-60-10 name=__codelineno-60-10 href=#__codelineno-60-10></a><span class=m>192</span>.168.77.130<span class=w> </span><span class=p>|</span><span class=w> </span><span class=nv>SUCCESS</span><span class=w> </span><span class=o>=</span>&gt;<span class=w> </span><span class=o>{</span>
<a id=__codelineno-60-11 name=__codelineno-60-11 href=#__codelineno-60-11></a><span class=w>    </span><span class=s2>&quot;example_variable&quot;</span>:<span class=w> </span><span class=s2>&quot;value&quot;</span>
<a id=__codelineno-60-12 name=__codelineno-60-12 href=#__codelineno-60-12></a><span class=o>}</span>
<a id=__codelineno-60-13 name=__codelineno-60-13 href=#__codelineno-60-13></a><span class=m>192</span>.168.77.131<span class=w> </span><span class=p>|</span><span class=w> </span><span class=nv>SUCCESS</span><span class=w> </span><span class=o>=</span>&gt;<span class=w> </span><span class=o>{</span>
<a id=__codelineno-60-14 name=__codelineno-60-14 href=#__codelineno-60-14></a><span class=w>    </span><span class=s2>&quot;example_variable&quot;</span>:<span class=w> </span><span class=s2>&quot;value&quot;</span>
<a id=__codelineno-60-15 name=__codelineno-60-15 href=#__codelineno-60-15></a><span class=o>}</span>
</code></pre></div></p> <h4 id=执行-playbook>执行 playbook<a class=headerlink href=#执行-playbook title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><a id=__codelineno-61-1 name=__codelineno-61-1 href=#__codelineno-61-1></a><span class=c1># cat test_inventory_script.yml </span>
<a id=__codelineno-61-2 name=__codelineno-61-2 href=#__codelineno-61-2></a>---
<a id=__codelineno-61-3 name=__codelineno-61-3 href=#__codelineno-61-3></a>-<span class=w> </span>hosts:<span class=w> </span>all
<a id=__codelineno-61-4 name=__codelineno-61-4 href=#__codelineno-61-4></a><span class=w>  </span>gather_facts:<span class=w> </span>no
<a id=__codelineno-61-5 name=__codelineno-61-5 href=#__codelineno-61-5></a><span class=w>  </span>tasks:
<a id=__codelineno-61-6 name=__codelineno-61-6 href=#__codelineno-61-6></a><span class=w>    </span>-<span class=w> </span>debug:<span class=w> </span><span class=nv>var</span><span class=o>=</span>host_specific_var
<a id=__codelineno-61-7 name=__codelineno-61-7 href=#__codelineno-61-7></a><span class=w>    </span>-<span class=w> </span>debug:<span class=w> </span><span class=nv>var</span><span class=o>=</span>example_variable
<a id=__codelineno-61-8 name=__codelineno-61-8 href=#__codelineno-61-8></a>
<a id=__codelineno-61-9 name=__codelineno-61-9 href=#__codelineno-61-9></a><span class=c1># ansible-playbook -i test_inventory.py test_inventory_script.yml </span>
<a id=__codelineno-61-10 name=__codelineno-61-10 href=#__codelineno-61-10></a>
<a id=__codelineno-61-11 name=__codelineno-61-11 href=#__codelineno-61-11></a>PLAY<span class=w> </span><span class=o>[</span>all<span class=o>]</span><span class=w> </span>*****************************************************************************************
<a id=__codelineno-61-12 name=__codelineno-61-12 href=#__codelineno-61-12></a>
<a id=__codelineno-61-13 name=__codelineno-61-13 href=#__codelineno-61-13></a>TASK<span class=w> </span><span class=o>[</span>debug<span class=o>]</span><span class=w> </span>*****************************************************************************************
<a id=__codelineno-61-14 name=__codelineno-61-14 href=#__codelineno-61-14></a>ok:<span class=w> </span><span class=o>[</span><span class=m>192</span>.168.77.130<span class=o>]</span><span class=w> </span><span class=o>=</span>&gt;<span class=w> </span><span class=o>{</span>
<a id=__codelineno-61-15 name=__codelineno-61-15 href=#__codelineno-61-15></a><span class=w>    </span><span class=s2>&quot;host_specific_var&quot;</span>:<span class=w> </span><span class=s2>&quot;foo&quot;</span>
<a id=__codelineno-61-16 name=__codelineno-61-16 href=#__codelineno-61-16></a><span class=o>}</span>
<a id=__codelineno-61-17 name=__codelineno-61-17 href=#__codelineno-61-17></a>ok:<span class=w> </span><span class=o>[</span><span class=m>192</span>.168.77.131<span class=o>]</span><span class=w> </span><span class=o>=</span>&gt;<span class=w> </span><span class=o>{</span>
<a id=__codelineno-61-18 name=__codelineno-61-18 href=#__codelineno-61-18></a><span class=w>    </span><span class=s2>&quot;host_specific_var&quot;</span>:<span class=w> </span><span class=s2>&quot;bar&quot;</span>
<a id=__codelineno-61-19 name=__codelineno-61-19 href=#__codelineno-61-19></a><span class=o>}</span>
<a id=__codelineno-61-20 name=__codelineno-61-20 href=#__codelineno-61-20></a>
<a id=__codelineno-61-21 name=__codelineno-61-21 href=#__codelineno-61-21></a>TASK<span class=w> </span><span class=o>[</span>debug<span class=o>]</span><span class=w> </span>*****************************************************************************************
<a id=__codelineno-61-22 name=__codelineno-61-22 href=#__codelineno-61-22></a>ok:<span class=w> </span><span class=o>[</span><span class=m>192</span>.168.77.130<span class=o>]</span><span class=w> </span><span class=o>=</span>&gt;<span class=w> </span><span class=o>{</span>
<a id=__codelineno-61-23 name=__codelineno-61-23 href=#__codelineno-61-23></a><span class=w>    </span><span class=s2>&quot;example_variable&quot;</span>:<span class=w> </span><span class=s2>&quot;value&quot;</span>
<a id=__codelineno-61-24 name=__codelineno-61-24 href=#__codelineno-61-24></a><span class=o>}</span>
<a id=__codelineno-61-25 name=__codelineno-61-25 href=#__codelineno-61-25></a>ok:<span class=w> </span><span class=o>[</span><span class=m>192</span>.168.77.131<span class=o>]</span><span class=w> </span><span class=o>=</span>&gt;<span class=w> </span><span class=o>{</span>
<a id=__codelineno-61-26 name=__codelineno-61-26 href=#__codelineno-61-26></a><span class=w>    </span><span class=s2>&quot;example_variable&quot;</span>:<span class=w> </span><span class=s2>&quot;value&quot;</span>
<a id=__codelineno-61-27 name=__codelineno-61-27 href=#__codelineno-61-27></a><span class=o>}</span>
<a id=__codelineno-61-28 name=__codelineno-61-28 href=#__codelineno-61-28></a>
<a id=__codelineno-61-29 name=__codelineno-61-29 href=#__codelineno-61-29></a>PLAY<span class=w> </span>RECAP<span class=w> </span>*****************************************************************************************
<a id=__codelineno-61-30 name=__codelineno-61-30 href=#__codelineno-61-30></a><span class=m>192</span>.168.77.130<span class=w>             </span>:<span class=w> </span><span class=nv>ok</span><span class=o>=</span><span class=m>2</span><span class=w>    </span><span class=nv>changed</span><span class=o>=</span><span class=m>0</span><span class=w>    </span><span class=nv>unreachable</span><span class=o>=</span><span class=m>0</span><span class=w>    </span><span class=nv>failed</span><span class=o>=</span><span class=m>0</span><span class=w>    </span><span class=nv>skipped</span><span class=o>=</span><span class=m>0</span><span class=w>    </span><span class=nv>rescued</span><span class=o>=</span><span class=m>0</span><span class=w>    </span><span class=nv>ignored</span><span class=o>=</span><span class=m>0</span><span class=w>   </span>
<a id=__codelineno-61-31 name=__codelineno-61-31 href=#__codelineno-61-31></a><span class=m>192</span>.168.77.131<span class=w>             </span>:<span class=w> </span><span class=nv>ok</span><span class=o>=</span><span class=m>2</span><span class=w>    </span><span class=nv>changed</span><span class=o>=</span><span class=m>0</span><span class=w>    </span><span class=nv>unreachable</span><span class=o>=</span><span class=m>0</span><span class=w>    </span><span class=nv>failed</span><span class=o>=</span><span class=m>0</span><span class=w>    </span><span class=nv>skipped</span><span class=o>=</span><span class=m>0</span><span class=w>    </span><span class=nv>rescued</span><span class=o>=</span><span class=m>0</span><span class=w>    </span><span class=nv>ignored</span><span class=o>=</span><span class=m>0</span><span class=w>   </span>
</code></pre></div> <h3 id=插件使用>插件使用<a class=headerlink href=#插件使用 title="Permanent link">&para;</a></h3> <p>你可以使用 inventory plugin 来获取云主机信息，使用方式见 <a href=/advanced/dynamic-inventory/ > 使用动态主机管理云服务</a></p> <p>你也可以自己开发 inventory plugin 来从源获取主机方式，详细信息见 <a href=/dev/plugins/Inventory-csv>从csv源获取主机信息</a></p> <hr> <div class=md-source-file> <small> 最后更新: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime">April 10, 2023 15:08:25</span> <br> 创建日期: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime">April 10, 2023 15:08:25</span> </small> </div> <form class=md-feedback name=feedback hidden> <fieldset> <legend class=md-feedback__title> Was this page helpful? </legend> <div class=md-feedback__inner> <div class=md-feedback__list> <button class="md-feedback__icon md-icon" type=submit title="This page was helpful" data-md-value=1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m7 0c0 .8-.7 1.5-1.5 1.5S14 10.3 14 9.5 14.7 8 15.5 8s1.5.7 1.5 1.5m-5 7.73c-1.75 0-3.29-.73-4.19-1.81L9.23 14c.45.72 1.52 1.23 2.77 1.23s2.32-.51 2.77-1.23l1.42 1.42c-.9 1.08-2.44 1.81-4.19 1.81Z"/></svg> </button> <button class="md-feedback__icon md-icon" type=submit title="This page could be improved" data-md-value=0> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10m-6.5-4c.8 0 1.5.7 1.5 1.5s-.7 1.5-1.5 1.5-1.5-.7-1.5-1.5.7-1.5 1.5-1.5M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m2 4.5c1.75 0 3.29.72 4.19 1.81l-1.42 1.42C14.32 16.5 13.25 16 12 16s-2.32.5-2.77 1.23l-1.42-1.42C8.71 14.72 10.25 14 12 14Z"/></svg> </button> </div> <div class=md-feedback__note> <div data-md-value=1 hidden> Thanks for your feedback! </div> <div data-md-value=0 hidden> Thanks for your feedback! Help us improve this page by using our <a href="https://github.com/hujianli94/hujianli94.github.io/issues/new/?title=[Feedback]+Ansible%E8%BF%9B%E9%98%B6+-+/Linux/Ansible/3.Ansible%E8%BF%9B%E9%98%B6/" target=_blank>feedback form</a>. </div> </div> </div> </fieldset> </form> </article> </div> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> 回到页面顶部 </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=页脚> <a href=../2.%E7%AE%A1%E7%90%86windows%E4%B8%BB%E6%9C%BA/ class="md-footer__link md-footer__link--prev" aria-label="上一页: 管理windows主机" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> 上一页 </span> <div class=md-ellipsis> 管理windows主机 </div> </div> </a> <a href=../../shell/Shell%E7%AE%80%E4%BB%8B/ class="md-footer__link md-footer__link--next" aria-label="下一页: Shell 教程概述" rel=next> <div class=md-footer__title> <span class=md-footer__direction> 下一页 </span> <div class=md-ellipsis> Shell 教程概述 </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2023 - 2024 hujainli94 </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/hujianli94 target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> <a href=https://kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com/blog_img/20220125122524.png target=_blank rel=noopener title=kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 576 512"><!-- Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M385.2 167.6c6.4 0 12.6.3 18.8 1.1C387.4 90.3 303.3 32 207.7 32 100.5 32 13 104.8 13 197.4c0 53.4 29.3 97.5 77.9 131.6l-19.3 58.6 68-34.1c24.4 4.8 43.8 9.7 68.2 9.7 6.2 0 12.1-.3 18.3-.8-4-12.9-6.2-26.6-6.2-40.8-.1-84.9 72.9-154 165.3-154zm-104.5-52.9c14.5 0 24.2 9.7 24.2 24.4 0 14.5-9.7 24.2-24.2 24.2-14.8 0-29.3-9.7-29.3-24.2.1-14.7 14.6-24.4 29.3-24.4zm-136.4 48.6c-14.5 0-29.3-9.7-29.3-24.2 0-14.8 14.8-24.4 29.3-24.4 14.8 0 24.4 9.7 24.4 24.4 0 14.6-9.6 24.2-24.4 24.2zM563 319.4c0-77.9-77.9-141.3-165.4-141.3-92.7 0-165.4 63.4-165.4 141.3S305 460.7 397.6 460.7c19.3 0 38.9-5.1 58.6-9.9l53.4 29.3-14.8-48.6C534 402.1 563 363.2 563 319.4zm-219.1-24.5c-9.7 0-19.3-9.7-19.3-19.6 0-9.7 9.7-19.3 19.3-19.3 14.8 0 24.4 9.7 24.4 19.3 0 10-9.7 19.6-24.4 19.6zm107.1 0c-9.7 0-19.3-9.7-19.3-19.6 0-9.7 9.7-19.3 19.3-19.3 14.5 0 24.4 9.7 24.4 19.3.1 10-9.9 19.6-24.4 19.6z"/></svg> </a> <a href="mailto:<1879324764@qq.com>" target=_blank rel=noopener title=发送邮件 class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M498.1 5.6c10.1 7 15.4 19.1 13.5 31.2l-64 416c-1.5 9.7-7.4 18.2-16 23s-18.9 5.4-28 1.6L284 427.7l-68.5 74.1c-8.9 9.7-22.9 12.9-35.2 8.1S160 493.2 160 480v-83.6c0-4 1.5-7.8 4.2-10.7l167.6-182.9c5.8-6.3 5.6-16-.4-22s-15.7-6.4-22-.7L106 360.8l-88.3-44.2C7.1 311.3.3 300.7 0 288.9s5.9-22.8 16.1-28.7l448-256c10.7-6.1 23.9-5.5 34 1.4z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-consent data-md-component=consent id=__consent hidden> <div class=md-consent__overlay></div> <aside class=md-consent__inner> <form class="md-consent__form md-grid md-typeset" name=consent> <h4>Cookie consent</h4> <p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p> <input class=md-toggle type=checkbox id=__settings> <div class=md-consent__settings> <ul class=task-list> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=analytics checked> <span class=task-list-indicator></span> Google Analytics </label> </li> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=github checked> <span class=task-list-indicator></span> GitHub </label> </li> </ul> </div> <div class=md-consent__controls> <button class="md-button md-button--primary">同意</button> <label class=md-button for=__settings>管理设定</label> </div> </form> </aside> </div> <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout(function(){document.querySelector("[data-md-component=consent]").hidden=!1},250);var action,form=document.forms.consent;for(action of["submit","reset"])form.addEventListener(action,function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map(function(e){return[e,!0]}))),location.hash="",location.reload()})</script> <script id=__config type=application/json>{"base": "../../..", "features": ["content.action.edit", "content.action.view", "content.code.copy", "content.code.annotate", "navigation.indexes", "navigation.footer", "navigation.indexes", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest"], "search": "../../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script> <script src=../../../assets/javascripts/bundle.51198bba.min.js></script> <script src=../../../javascripts/extra.js></script> <script src=https://file.cdn.shafish.cn/blog/js/video.min.js></script> </body> </html>