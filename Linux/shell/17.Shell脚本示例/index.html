<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="stay hungry,stay foolish"><meta name=author content=hujainli94><link href=https://hujianli94.github.io/Linux/shell/17.Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/ rel=canonical><link href=../16.Shell%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/ rel=prev><link rel=icon href=../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.4.2, mkdocs-material-9.1.6"><title>17.Shell脚本示例 - DevOps运维开发</title><link rel=stylesheet href=../../../assets/stylesheets/main.ded33207.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.a0c5b2b5.min.css><style>:root{--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M1 7.775V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 0 1 0 2.474l-5.026 5.026a1.75 1.75 0 0 1-2.474 0l-6.25-6.25A1.752 1.752 0 0 1 1 7.775Zm1.5 0c0 .066.026.13.073.177l6.25 6.25a.25.25 0 0 0 .354 0l5.025-5.025a.25.25 0 0 0 0-.354l-6.25-6.25a.25.25 0 0 0-.177-.073H2.75a.25.25 0 0 0-.25.25ZM6 5a1 1 0 1 1 0 2 1 1 0 0 1 0-2Z"/></svg>');--md-admonition-icon--abstract:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M2.5 1.75v11.5c0 .138.112.25.25.25h3.17a.75.75 0 0 1 0 1.5H2.75A1.75 1.75 0 0 1 1 13.25V1.75C1 .784 1.784 0 2.75 0h8.5C12.216 0 13 .784 13 1.75v7.736a.75.75 0 0 1-1.5 0V1.75a.25.25 0 0 0-.25-.25h-8.5a.25.25 0 0 0-.25.25Zm13.274 9.537v-.001l-4.557 4.45a.75.75 0 0 1-1.055-.008l-1.943-1.95a.75.75 0 0 1 1.062-1.058l1.419 1.425 4.026-3.932a.75.75 0 1 1 1.048 1.074ZM4.75 4h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM4 7.75A.75.75 0 0 1 4.75 7h2a.75.75 0 0 1 0 1.5h-2A.75.75 0 0 1 4 7.75Z"/></svg>');--md-admonition-icon--info:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"/></svg>');--md-admonition-icon--tip:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M3.499.75a.75.75 0 0 1 1.5 0v.996C5.9 2.903 6.793 3.65 7.662 4.376l.24.202c-.036-.694.055-1.422.426-2.163C9.1.873 10.794-.045 12.622.26 14.408.558 16 1.94 16 4.25c0 1.278-.954 2.575-2.44 2.734l.146.508.065.22c.203.701.412 1.455.476 2.226.142 1.707-.4 3.03-1.487 3.898C11.714 14.671 10.27 15 8.75 15h-6a.75.75 0 0 1 0-1.5h1.376a4.484 4.484 0 0 1-.563-1.191 3.835 3.835 0 0 1-.05-2.063 4.647 4.647 0 0 1-2.025-.293.75.75 0 0 1 .525-1.406c1.357.507 2.376-.006 2.698-.318l.009-.01a.747.747 0 0 1 1.06 0 .748.748 0 0 1-.012 1.074c-.912.92-.992 1.835-.768 2.586.221.74.745 1.337 1.196 1.621H8.75c1.343 0 2.398-.296 3.074-.836.635-.507 1.036-1.31.928-2.602-.05-.603-.216-1.224-.422-1.93l-.064-.221c-.12-.407-.246-.84-.353-1.29a2.425 2.425 0 0 1-.507-.441 3.075 3.075 0 0 1-.633-1.248.75.75 0 0 1 1.455-.364c.046.185.144.436.31.627.146.168.353.305.712.305.738 0 1.25-.615 1.25-1.25 0-1.47-.95-2.315-2.123-2.51-1.172-.196-2.227.387-2.706 1.345-.46.92-.27 1.774.019 3.062l.042.19a.884.884 0 0 1 .01.05c.348.443.666.949.94 1.553a.75.75 0 1 1-1.365.62c-.553-1.217-1.32-1.94-2.3-2.768L6.7 5.527c-.814-.68-1.75-1.462-2.692-2.619a3.737 3.737 0 0 0-1.023.88c-.406.495-.663 1.036-.722 1.508.116.122.306.21.591.239.388.038.797-.06 1.032-.19a.75.75 0 0 1 .728 1.31c-.515.287-1.23.439-1.906.373-.682-.067-1.473-.38-1.879-1.193L.75 5.677V5.5c0-.984.48-1.94 1.077-2.664.46-.559 1.05-1.055 1.673-1.353V.75Z"/></svg>');--md-admonition-icon--success:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"/></svg>');--md-admonition-icon--question:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.92 6.085h.001a.749.749 0 1 1-1.342-.67c.169-.339.436-.701.849-.977C6.845 4.16 7.369 4 8 4a2.756 2.756 0 0 1 1.637.525c.503.377.863.965.863 1.725 0 .448-.115.83-.329 1.15-.205.307-.47.513-.692.662-.109.072-.22.138-.313.195l-.006.004a6.24 6.24 0 0 0-.26.16.952.952 0 0 0-.276.245.75.75 0 0 1-1.248-.832c.184-.264.42-.489.692-.661.103-.067.207-.132.313-.195l.007-.004c.1-.061.182-.11.258-.161a.969.969 0 0 0 .277-.245C8.96 6.514 9 6.427 9 6.25a.612.612 0 0 0-.262-.525A1.27 1.27 0 0 0 8 5.5c-.369 0-.595.09-.74.187a1.01 1.01 0 0 0-.34.398ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"/></svg>');--md-admonition-icon--warning:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"/></svg>');--md-admonition-icon--failure:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M2.344 2.343h-.001a8 8 0 0 1 11.314 11.314A8.002 8.002 0 0 1 .234 10.089a8 8 0 0 1 2.11-7.746Zm1.06 10.253a6.5 6.5 0 1 0 9.108-9.275 6.5 6.5 0 0 0-9.108 9.275ZM6.03 4.97 8 6.94l1.97-1.97a.749.749 0 0 1 1.275.326.749.749 0 0 1-.215.734L9.06 8l1.97 1.97a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215L8 9.06l-1.97 1.97a.749.749 0 0 1-1.275-.326.749.749 0 0 1 .215-.734L6.94 8 4.97 6.03a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018Z"/></svg>');--md-admonition-icon--danger:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M9.504.43a1.516 1.516 0 0 1 2.437 1.713L10.415 5.5h2.123c1.57 0 2.346 1.909 1.22 3.004l-7.34 7.142a1.249 1.249 0 0 1-.871.354h-.302a1.25 1.25 0 0 1-1.157-1.723L5.633 10.5H3.462c-1.57 0-2.346-1.909-1.22-3.004L9.503.429Zm1.047 1.074L3.286 8.571A.25.25 0 0 0 3.462 9H6.75a.75.75 0 0 1 .694 1.034l-1.713 4.188 6.982-6.793A.25.25 0 0 0 12.538 7H9.25a.75.75 0 0 1-.683-1.06l2.008-4.418.003-.006a.036.036 0 0 0-.004-.009l-.006-.006-.008-.001c-.003 0-.006.002-.009.004Z"/></svg>');--md-admonition-icon--bug:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M4.72.22a.75.75 0 0 1 1.06 0l1 .999a3.488 3.488 0 0 1 2.441 0l.999-1a.748.748 0 0 1 1.265.332.75.75 0 0 1-.205.729l-.775.776c.616.63.995 1.493.995 2.444v.327c0 .1-.009.197-.025.292.408.14.764.392 1.029.722l1.968-.787a.75.75 0 0 1 .556 1.392L13 7.258V9h2.25a.75.75 0 0 1 0 1.5H13v.5c0 .409-.049.806-.141 1.186l2.17.868a.75.75 0 0 1-.557 1.392l-2.184-.873A4.997 4.997 0 0 1 8 16a4.997 4.997 0 0 1-4.288-2.427l-2.183.873a.75.75 0 0 1-.558-1.392l2.17-.868A5.036 5.036 0 0 1 3 11v-.5H.75a.75.75 0 0 1 0-1.5H3V7.258L.971 6.446a.75.75 0 0 1 .558-1.392l1.967.787c.265-.33.62-.583 1.03-.722a1.677 1.677 0 0 1-.026-.292V4.5c0-.951.38-1.814.995-2.444L4.72 1.28a.75.75 0 0 1 0-1.06Zm.53 6.28a.75.75 0 0 0-.75.75V11a3.5 3.5 0 1 0 7 0V7.25a.75.75 0 0 0-.75-.75ZM6.173 5h3.654A.172.172 0 0 0 10 4.827V4.5a2 2 0 1 0-4 0v.327c0 .096.077.173.173.173Z"/></svg>');--md-admonition-icon--example:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M5 5.782V2.5h-.25a.75.75 0 0 1 0-1.5h6.5a.75.75 0 0 1 0 1.5H11v3.282l3.666 5.76C15.619 13.04 14.543 15 12.767 15H3.233c-1.776 0-2.852-1.96-1.899-3.458Zm-2.4 6.565a.75.75 0 0 0 .633 1.153h9.534a.75.75 0 0 0 .633-1.153L12.225 10.5h-8.45ZM9.5 2.5h-3V6c0 .143-.04.283-.117.403L4.73 9h6.54L9.617 6.403A.746.746 0 0 1 9.5 6Z"/></svg>');--md-admonition-icon--quote:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M1.75 2.5h10.5a.75.75 0 0 1 0 1.5H1.75a.75.75 0 0 1 0-1.5Zm4 5h8.5a.75.75 0 0 1 0 1.5h-8.5a.75.75 0 0 1 0-1.5Zm0 5h8.5a.75.75 0 0 1 0 1.5h-8.5a.75.75 0 0 1 0-1.5ZM2.5 7.75v6a.75.75 0 0 1-1.5 0v-6a.75.75 0 0 1 1.5 0Z"/></svg>');}</style><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../stylesheets/extra.css><link rel=stylesheet href=https://file.cdn.shafish.cn/blog/css/vssue.css><link rel=stylesheet href=https://file.cdn.shafish.cn/blog/css/video-js.min.css><link rel=stylesheet href=https://file.cdn.shafish.cn/blog/css/video.css><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script>var consent;"undefined"==typeof __md_analytics||(consent=__md_get("__consent"))&&consent.analytics&&__md_analytics()</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#17shell脚本示例 class=md-skip> 跳转至 </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=页眉> <a href=../../.. title=DevOps运维开发 class="md-header__button md-logo" aria-label=DevOps运维开发 data-md-component=logo> <img src=../../../assets/images/logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> DevOps运维开发 </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> 17.Shell脚本示例 </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label=切换至深色模式 type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title=切换至深色模式 for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=blue data-md-color-accent=blue aria-label=切换至浅色模式 type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title=切换至浅色模式 for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=查找> <a href=javascript:void(0) class="md-search__icon md-icon" title=分享 aria-label=分享 data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=清空当前内容 aria-label=清空当前内容 tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> 正在初始化搜索引擎 </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/hujianli94/hujianli94.github.io title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> hujianli94.github.io </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=标签 data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> 首页 </a> </li> <li class=md-tabs__item> <a href=../../../Kubernetes/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Kubernetes/ class=md-tabs__link> Kubernetes </a> </li> <li class=md-tabs__item> <a href=../../../Docker/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Docker/ class=md-tabs__link> Docker </a> </li> <li class=md-tabs__item> <a href=../../../Golang/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Go%20Web%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98/ class=md-tabs__link> Golang </a> </li> <li class=md-tabs__item> <a href=../../../Python/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Pythjon-auto-ops/ class=md-tabs__link> Python </a> </li> <li class=md-tabs__item> <a href=../../../Python-vs-Go/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Python-vs-Go/ class=md-tabs__link> Python-vs-Go </a> </li> <li class=md-tabs__item> <a href=../../system/0.Linux%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E4%B8%8B%E8%BD%BD/ class="md-tabs__link md-tabs__link--active"> Linux </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=导航栏 data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title=DevOps运维开发 class="md-nav__button md-logo" aria-label=DevOps运维开发 data-md-component=logo> <img src=../../../assets/images/logo.png alt=logo> </a> DevOps运维开发 </label> <div class=md-nav__source> <a href=https://github.com/hujianli94/hujianli94.github.io title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> hujianli94.github.io </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> 首页 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> Kubernetes <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_1> <label class=md-nav__link for=__nav_2_1 id=__nav_2_1_label tabindex=0> 0.学习线路 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_1_label aria-expanded=false> <label class=md-nav__title for=__nav_2_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Kubernetes/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Kubernetes/ class=md-nav__link> Kubernetes </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2> <label class=md-nav__link for=__nav_2_2 id=__nav_2_2_label tabindex=0> 1.安装篇 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2> <span class="md-nav__icon md-icon"></span> 1.安装篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/1.Kubeadm%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/ class=md-nav__link> Kubeadm安装高可用集群 </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/2.%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/ class=md-nav__link> 二进制安装高可用K8s集群 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_3> <label class=md-nav__link for=__nav_2_3 id=__nav_2_3_label tabindex=0> 2.基础篇 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_3_label aria-expanded=false> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> 2.基础篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/3.Docker%E5%9F%BA%E7%A1%80/ class=md-nav__link> Docker基础 </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Kubernetes%E7%9A%84%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/ class=md-nav__link> Kubernetes的基础概念 </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Kubernetes%E8%B0%83%E5%BA%A6%E5%9F%BA%E7%A1%80/ class=md-nav__link> Kubernetes调度基础 </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/6.Kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83%E5%9F%BA%E7%A1%80/ class=md-nav__link> Kubernetes服务发布基础 </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/7.Kubernetes%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/ class=md-nav__link> Kubernetes配置管理 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_4> <label class=md-nav__link for=__nav_2_4 id=__nav_2_4_label tabindex=0> 3.进阶篇 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_4_label aria-expanded=false> <label class=md-nav__title for=__nav_2_4> <span class="md-nav__icon md-icon"></span> 3.进阶篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Kubernetes/3.%E8%BF%9B%E9%98%B6%E7%AF%87/8.Kubernetes%E5%AD%98%E5%82%A8%E5%85%A5%E9%97%A8/ class=md-nav__link> Kubernetes存储入门 </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/3.%E8%BF%9B%E9%98%B6%E7%AF%87/9.Kubernetes%E9%AB%98%E7%BA%A7%E8%B0%83%E5%BA%A6/ class=md-nav__link> Kubernetes高级调度 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_5> <label class=md-nav__link for=__nav_2_5 id=__nav_2_5_label tabindex=0> 4.高级篇 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_5_label aria-expanded=false> <label class=md-nav__title for=__nav_2_5> <span class="md-nav__icon md-icon"></span> 4.高级篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Kubernetes/4.%E9%AB%98%E7%BA%A7%E7%AF%87/12.%E4%BA%91%E5%8E%9F%E7%94%9F%E5%AD%98%E5%82%A8Rook/ class=md-nav__link> 云原生存储Rook </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/4.%E9%AB%98%E7%BA%A7%E7%AF%87/13.%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%AE%B9%E5%99%A8%E5%8C%96/ class=md-nav__link> 中间件容器化 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_6> <label class=md-nav__link for=__nav_2_6 id=__nav_2_6_label tabindex=0> 5.运维篇 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_6_label aria-expanded=false> <label class=md-nav__title for=__nav_2_6> <span class="md-nav__icon md-icon"></span> 5.运维篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/14.Kubernetes%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/ class=md-nav__link> Kubernetes日志收集 </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/15.Kubernetes%E7%9B%91%E6%8E%A7%E5%91%8A%E8%AD%A6/ class=md-nav__link> Kubernetes监控告警 </a> </li> <li class=md-nav__item> <a href=../../../Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/16.%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83Ingress%E8%BF%9B%E9%98%B6/ class=md-nav__link> 服务发布Ingress进阶 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_7> <label class=md-nav__link for=__nav_2_7 id=__nav_2_7_label tabindex=0> 6.DevOps篇 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_7_label aria-expanded=false> <label class=md-nav__title for=__nav_2_7> <span class="md-nav__icon md-icon"></span> 6.DevOps篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/ class=md-nav__link> DevOps实践 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> Docker <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Docker </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1> <label class=md-nav__link for=__nav_3_1 id=__nav_3_1_label tabindex=0> 0.学习线路 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_1_label aria-expanded=false> <label class=md-nav__title for=__nav_3_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Docker/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Docker/ class=md-nav__link> Docker </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2> <label class=md-nav__link for=__nav_3_2 id=__nav_3_2_label tabindex=0> 1.Docker基础 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> 1.Docker基础 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Docker/1.Docker%E5%9F%BA%E7%A1%80/1.%E5%AE%89%E8%A3%85Docker/ class=md-nav__link> 安装Docker </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.Docker%E5%9F%BA%E7%A1%80/2.%E4%BD%BF%E7%94%A8Docker%E9%95%9C%E5%83%8F/ class=md-nav__link> 使用Docker镜像 </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.Docker%E5%9F%BA%E7%A1%80/3.%E6%93%8D%E4%BD%9CDocker%E5%AE%B9%E5%99%A8/ class=md-nav__link> 操作Docker容器 </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.Docker%E5%9F%BA%E7%A1%80/4.%E6%90%AD%E5%BB%BA%E6%9C%AC%E5%9C%B0%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93/ class=md-nav__link> 搭建本地私有仓库 </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.Docker%E5%9F%BA%E7%A1%80/5.Docker%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86/ class=md-nav__link> Docker数据管理 </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.Docker%E5%9F%BA%E7%A1%80/6.Docker%E4%BD%BF%E7%94%A8%E7%BD%91%E7%BB%9C/ class=md-nav__link> Docker使用网络 </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.Docker%E5%9F%BA%E7%A1%80/7.Dockerfile/ class=md-nav__link> Dockerfile </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.Docker%E5%9F%BA%E7%A1%80/8.docker-compose/ class=md-nav__link> docker-compose </a> </li> <li class=md-nav__item> <a href=../../../Docker/1.Docker%E5%9F%BA%E7%A1%80/9.Docker%E7%9B%B8%E5%85%B3%E8%84%9A%E6%9C%AC/ class=md-nav__link> Docker相关脚本 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_3> <label class=md-nav__link for=__nav_3_3 id=__nav_3_3_label tabindex=0> 2.实战案例 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> 2.实战案例 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/1.%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/ class=md-nav__link> 操作系统 </a> </li> <li class=md-nav__item> <a href=../../../Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/2.Web%E6%9C%8D%E5%8A%A1%E4%B8%8E%E5%BA%94%E7%94%A8/ class=md-nav__link> Web服务与应用 </a> </li> <li class=md-nav__item> <a href=../../../Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/3.%E6%8C%81%E7%BB%AD%E5%BC%80%E5%8F%91%E4%B8%8E%E7%AE%A1%E7%90%86/ class=md-nav__link> 持续开发与管理 </a> </li> <li class=md-nav__item> <a href=../../../Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/4.%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BA%94%E7%94%A8/ class=md-nav__link> 数据库应用 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_4> <label class=md-nav__link for=__nav_3_4 id=__nav_3_4_label tabindex=0> 3.Devops <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_4_label aria-expanded=false> <label class=md-nav__title for=__nav_3_4> <span class="md-nav__icon md-icon"></span> 3.Devops </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Docker/3.Devops/1.ConfCenter/ class=md-nav__link> ConfCenter </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/2.CoreDNS/ class=md-nav__link> Coredns </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/3.Harbor/ class=md-nav__link> Harbor </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/4.Python%E6%93%8D%E4%BD%9CDocker/ class=md-nav__link> Python操作Docker </a> </li> <li class=md-nav__item> <a href=../../../Docker/3.Devops/5.Haproxy/ class=md-nav__link> Haproxy </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> Golang <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Golang </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_1> <label class=md-nav__link for=__nav_4_1 id=__nav_4_1_label tabindex=0> 0.学习线路 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_1_label aria-expanded=false> <label class=md-nav__title for=__nav_4_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Go%20Web%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98/ class=md-nav__link> Go Web开发实战 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_2> <label class=md-nav__link for=__nav_4_2 id=__nav_4_2_label tabindex=0> 1.Go基础入门 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_2_label aria-expanded=false> <label class=md-nav__title for=__nav_4_2> <span class="md-nav__icon md-icon"></span> 1.Go基础入门 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/1.Go%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/1.%E5%AE%89%E8%A3%85Go/ class=md-nav__link> 安装Go </a> </li> <li class=md-nav__item> <a href=../../../Golang/1.Go%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/2.%E5%BC%80%E5%90%AFGo%E7%9A%84%E7%AC%AC%E4%B8%80%E4%B8%AA%E7%A8%8B%E5%BA%8F/ class=md-nav__link> 开启Go的第一个程序 </a> </li> <li class=md-nav__item> <a href=../../../Golang/1.Go%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95%E4%B8%8E%E4%BD%BF%E7%94%A8/ class=md-nav__link> Go基础语法与使用 </a> </li> <li class=md-nav__item> <a href=../../../Golang/1.Go%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/4.Go%20Module%E6%95%99%E7%A8%8B/ class=md-nav__link> Go Module教程 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_3> <label class=md-nav__link for=__nav_4_3 id=__nav_4_3_label tabindex=0> 2.Go-Web开发基础 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_3_label aria-expanded=false> <label class=md-nav__title for=__nav_4_3> <span class="md-nav__icon md-icon"></span> 2.Go-Web开发基础 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/2.Go-Web%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80/5.hello%20World%20Web/ class=md-nav__link> hello World Web </a> </li> <li class=md-nav__item> <a href=../../../Golang/2.Go-Web%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80/6.Web%E7%A8%8B%E5%BA%8F%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86%E7%AE%80%E4%BB%8B/ class=md-nav__link> Web程序运行原理简介 </a> </li> <li class=md-nav__item> <a href=../../../Golang/2.Go-Web%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80/7.net-http%E5%8C%85/ class=md-nav__link> net/http包 </a> </li> <li class=md-nav__item> <a href=../../../Golang/2.Go-Web%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80/8.html-template%E5%8C%85/ class=md-nav__link> html/template包 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_4> <label class=md-nav__link for=__nav_4_4 id=__nav_4_4_label tabindex=0> 3.接收和处理Go Web请求 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4_4> <span class="md-nav__icon md-icon"></span> 3.接收和处理Go Web请求 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/3.%E6%8E%A5%E6%94%B6%E5%92%8C%E5%A4%84%E7%90%86Go%20Web%E8%AF%B7%E6%B1%82/9.%E7%AE%80%E5%8D%95Go%20Web%E6%9C%8D%E5%8A%A1%E5%99%A8/ class=md-nav__link> 简单Go Web服务器 </a> </li> <li class=md-nav__item> <a href=../../../Golang/3.%E6%8E%A5%E6%94%B6%E5%92%8C%E5%A4%84%E7%90%86Go%20Web%E8%AF%B7%E6%B1%82/10.%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82/ class=md-nav__link> 处理请求 </a> </li> <li class=md-nav__item> <a href=../../../Golang/3.%E6%8E%A5%E6%94%B6%E5%92%8C%E5%A4%84%E7%90%86Go%20Web%E8%AF%B7%E6%B1%82/11.%E4%BA%86%E8%A7%A3session%E5%92%8Ccookie/ class=md-nav__link> 了解session和cookie </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_5> <label class=md-nav__link for=__nav_4_5 id=__nav_4_5_label tabindex=0> 4.使用Go访问数据库 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_5_label aria-expanded=false> <label class=md-nav__title for=__nav_4_5> <span class="md-nav__icon md-icon"></span> 4.使用Go访问数据库 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/4.%E4%BD%BF%E7%94%A8Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/12.MySQL%E7%9A%84%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8/ class=md-nav__link> MySQL的安装与使用 </a> </li> <li class=md-nav__item> <a href=../../../Golang/4.%E4%BD%BF%E7%94%A8Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/13.Redis%E7%9A%84%E5%AE%89%E8%A3%85%E5%8F%8A%E4%BD%BF%E7%94%A8/ class=md-nav__link> Redis的安装及使用 </a> </li> <li class=md-nav__item> <a href=../../../Golang/4.%E4%BD%BF%E7%94%A8Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/14.MongoDB%E7%9A%84%E5%AE%89%E8%A3%85%E5%8F%8A%E4%BD%BF%E7%94%A8/ class=md-nav__link> MongoDB的安装及使用 </a> </li> <li class=md-nav__item> <a href=../../../Golang/4.%E4%BD%BF%E7%94%A8Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/15.Go%E7%9A%84%E5%B8%B8%E8%A7%81ORM%E5%BA%93/ class=md-nav__link> Go的常见ORM库 </a> </li> <li class=md-nav__item> <a href=../../../Golang/4.%E4%BD%BF%E7%94%A8Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/16.SQLite%E7%9A%84%E5%AE%89%E8%A3%85%E5%8F%8A%E4%BD%BF%E7%94%A8/ class=md-nav__link> SQLite的安装及使用 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_6> <label class=md-nav__link for=__nav_4_6 id=__nav_4_6_label tabindex=0> 5.Go高级网络编程 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_6_label aria-expanded=false> <label class=md-nav__title for=__nav_4_6> <span class="md-nav__icon md-icon"></span> 5.Go高级网络编程 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/5.Go%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/17.Go%20Socket%E7%BC%96%E7%A8%8B/ class=md-nav__link> Go Socket编程 </a> </li> <li class=md-nav__item> <a href=../../../Golang/5.Go%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/18.Go%20RPC%E7%BC%96%E7%A8%8B/ class=md-nav__link> Go RPC编程 </a> </li> <li class=md-nav__item> <a href=../../../Golang/5.Go%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/19.%E5%BE%AE%E6%9C%8D%E5%8A%A1/ class=md-nav__link> 微服务 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_7> <label class=md-nav__link for=__nav_4_7 id=__nav_4_7_label tabindex=0> 6.Go文件处理 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_7_label aria-expanded=false> <label class=md-nav__title for=__nav_4_7> <span class="md-nav__icon md-icon"></span> 6.Go文件处理 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/20.%E5%A4%84%E7%90%86%E7%9B%AE%E5%BD%95%E4%B8%8E%E6%96%87%E4%BB%B6/ class=md-nav__link> 处理目录与文件 </a> </li> <li class=md-nav__item> <a href=../../../Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/21.%E5%A4%84%E7%90%86XML%E6%96%87%E4%BB%B6/ class=md-nav__link> 处理XML文件 </a> </li> <li class=md-nav__item> <a href=../../../Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/22.%E5%A4%84%E7%90%86JSON%E6%96%87%E4%BB%B6/ class=md-nav__link> 处理JSON文件 </a> </li> <li class=md-nav__item> <a href=../../../Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/23.%E5%A4%84%E7%90%86CSV%E6%96%87%E4%BB%B6/ class=md-nav__link> 处理CSV文件 </a> </li> <li class=md-nav__item> <a href=../../../Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/24.%E5%A4%84%E7%90%86%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95/ class=md-nav__link> 处理日志记录 </a> </li> <li class=md-nav__item> <a href=../../../Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/25.%E5%A4%84%E7%90%86%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/ class=md-nav__link> 处理正则表达式 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_8> <label class=md-nav__link for=__nav_4_8 id=__nav_4_8_label tabindex=0> 7.Go并发编程 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_8_label aria-expanded=false> <label class=md-nav__title for=__nav_4_8> <span class="md-nav__icon md-icon"></span> 7.Go并发编程 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/26.%E5%B9%B6%E5%8F%91%E4%B8%8E%E5%B9%B6%E8%A1%8C/ class=md-nav__link> 并发与并行 </a> </li> <li class=md-nav__item> <a href=../../../Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/27.%E8%BF%9B%E7%A8%8B%20%E7%BA%BF%E7%A8%8B%E5%92%8C%E5%8D%8F%E7%A8%8B/ class=md-nav__link> 进程 线程和协程 </a> </li> <li class=md-nav__item> <a href=../../../Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/28.Go%E5%B9%B6%E5%8F%91%E6%A8%A1%E5%9E%8B%E7%AE%80%E4%BB%8B/ class=md-nav__link> Go并发模型简介 </a> </li> <li class=md-nav__item> <a href=../../../Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/29.gogoroutine%E5%92%8Cchannel%E5%AE%9E%E7%8E%B0%E5%B9%B6%E5%8F%91/ class=md-nav__link> gogoroutine和channel实现并发 </a> </li> <li class=md-nav__item> <a href=../../../Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/30.sync%E5%AE%9E%E7%8E%B0%E5%B9%B6%E5%8F%91/ class=md-nav__link> sync实现并发 </a> </li> <li class=md-nav__item> <a href=../../../Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/31.Go%E5%B9%B6%E5%8F%91%E7%9A%84Web%E5%BA%94%E7%94%A8/ class=md-nav__link> Go并发的Web应用 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> Python <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Python </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_1> <label class=md-nav__link for=__nav_5_1 id=__nav_5_1_label tabindex=0> 0.学习线路 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_1_label aria-expanded=false> <label class=md-nav__title for=__nav_5_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Pythjon-auto-ops/ class=md-nav__link> Pythjon自动化运维 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_2> <label class=md-nav__link for=__nav_5_2 id=__nav_5_2_label tabindex=0> 1.基础篇 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_2_label aria-expanded=false> <label class=md-nav__title for=__nav_5_2> <span class="md-nav__icon md-icon"></span> 1.基础篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/1.Python%E5%86%85%E7%BD%AE%E5%B0%8F%E5%B7%A5%E5%85%B7/ class=md-nav__link> Python内置小工具 </a> </li> <li class=md-nav__item> <a href=../../../Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/2.Python%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E5%AE%89%E8%A3%85/ class=md-nav__link> Python第三方库安装 </a> </li> <li class=md-nav__item> <a href=../../../Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/3.Python%E5%B7%A5%E4%BD%9C%E7%8E%AF%E5%A2%83%E7%AE%A1%E7%90%86/ class=md-nav__link> Python工作环境管理 </a> </li> <li class=md-nav__item> <a href=../../../Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/4.VSCode%E4%B8%ADPython%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/ class=md-nav__link> VSCode中Python环境配置 </a> </li> <li class=md-nav__item> <a href=../../../Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/5.%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/ class=md-nav__link> 开发工具 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_3> <label class=md-nav__link for=__nav_5_3 id=__nav_5_3_label tabindex=0> 2.高级篇 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_3_label aria-expanded=false> <label class=md-nav__title for=__nav_5_3> <span class="md-nav__icon md-icon"></span> 2.高级篇 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/1.%E6%89%93%E9%80%A0%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/ class=md-nav__link> 打造命令行工具 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> Python-vs-Go <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Python-vs-Go </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_1> <label class=md-nav__link for=__nav_6_1 id=__nav_6_1_label tabindex=0> 0.学习线路 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_1_label aria-expanded=false> <label class=md-nav__title for=__nav_6_1> <span class="md-nav__icon md-icon"></span> 0.学习线路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python-vs-Go/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Python-vs-Go/ class=md-nav__link> Python-vs-Go </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_2> <label class=md-nav__link for=__nav_6_2 id=__nav_6_2_label tabindex=0> 1.对比学习 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_2_label aria-expanded=false> <label class=md-nav__title for=__nav_6_2> <span class="md-nav__icon md-icon"></span> 1.对比学习 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/1.Hello-World/ class=md-nav__link> Hello-World </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/2.Print/ class=md-nav__link> Print </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/3.%E6%B3%A8%E9%87%8A/ class=md-nav__link> 注释 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/4.%E5%A4%9A%E8%A1%8C%E5%AD%97%E7%AC%A6%E4%B8%B2/ class=md-nav__link> 多行字符串 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/5.Lists/ class=md-nav__link> Lists </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/6.Map/ class=md-nav__link> Map </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/7.Booleans/ class=md-nav__link> Booleans </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/8.Forloop/ class=md-nav__link> Forloop </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/9.Range/ class=md-nav__link> Range </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/10.Switch/ class=md-nav__link> Switch </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/11.%E5%8F%AF%E5%8F%98%E5%8F%82%E6%95%B0%E5%87%BD%E6%95%B0/ class=md-nav__link> 可变参数函数 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/12.%E6%97%B6%E9%97%B4%E8%AE%A1%E7%AE%97/ class=md-nav__link> 时间计算 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/13.%E5%87%BD%E6%95%B0%E7%9A%84%E9%97%AD%E5%8C%85/ class=md-nav__link> 函数的闭包 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/14.%E9%80%80%E5%87%BA%E5%A4%84%E7%90%86/ class=md-nav__link> 退出处理 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/15.%E5%BC%82%E5%B8%B8%E6%8D%95%E8%8E%B7/ class=md-nav__link> 异常捕获 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/16.%E5%8F%AF%E5%8F%98%E9%A1%B9/ class=md-nav__link> 可变项 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/17.%E7%B1%BB/ class=md-nav__link> 类 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/18.%E6%96%B9%E6%B3%95/ class=md-nav__link> 方法 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/19.%E5%B9%B6%E5%8F%91/ class=md-nav__link> 并发 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/20.Args/ class=md-nav__link> Args </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/21.%E5%AF%BC%E5%85%A5%E6%A8%A1%E5%9D%97%E5%88%AB%E5%90%8D/ class=md-nav__link> 导入模块别名 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/22.%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%A0%BC%E5%BC%8F%E5%8C%96/ class=md-nav__link> 字符串格式化 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/23.%E5%8E%BB%E9%87%8D/ class=md-nav__link> 去重 </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/24.%E5%B8%A6%E9%A2%9C%E8%89%B2%E6%89%93%E5%8D%B0/ class=md-nav__link> 带颜色打印 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_3> <label class=md-nav__link for=__nav_6_3 id=__nav_6_3_label tabindex=0> 2.进阶 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_3_label aria-expanded=false> <label class=md-nav__title for=__nav_6_3> <span class="md-nav__icon md-icon"></span> 2.进阶 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Python-vs-Go/2.%E8%BF%9B%E9%98%B6/1.%E4%BD%BF%E7%94%A8RPC/ class=md-nav__link> 使用RPC </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/2.%E8%BF%9B%E9%98%B6/2.%E4%BD%BF%E7%94%A8MySQL/ class=md-nav__link> 使用MySQL </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/2.%E8%BF%9B%E9%98%B6/3.%E4%BD%BF%E7%94%A8Redis/ class=md-nav__link> 使用Redis </a> </li> <li class=md-nav__item> <a href=../../../Python-vs-Go/2.%E8%BF%9B%E9%98%B6/4.%E4%BD%BF%E7%94%A8MongoDB/ class=md-nav__link> 使用MongoDB </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7 checked> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex=0> Linux <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=true> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Linux </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_1> <label class=md-nav__link for=__nav_7_1 id=__nav_7_1_label tabindex=0> system <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_1_label aria-expanded=false> <label class=md-nav__title for=__nav_7_1> <span class="md-nav__icon md-icon"></span> system </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../system/0.Linux%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E4%B8%8B%E8%BD%BD/ class=md-nav__link> Linux操作系统镜像下载 </a> </li> <li class=md-nav__item> <a href=../../system/1.Linux%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/ class=md-nav__link> Linux 系统安全加固最佳实践 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_2> <label class=md-nav__link for=__nav_7_2 id=__nav_7_2_label tabindex=0> serveices <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_2_label aria-expanded=false> <label class=md-nav__title for=__nav_7_2> <span class="md-nav__icon md-icon"></span> serveices </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../serveices/0.ubuntu-desktop-vmware/ class=md-nav__link> ubuntu-desktop-vmware </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_3> <label class=md-nav__link for=__nav_7_3 id=__nav_7_3_label tabindex=0> Ansible <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_3_label aria-expanded=false> <label class=md-nav__title for=__nav_7_3> <span class="md-nav__icon md-icon"></span> Ansible </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Ansible/0.Ansible%E5%85%A5%E9%97%A8/ class=md-nav__link> Ansible入门 </a> </li> <li class=md-nav__item> <a href=../../Ansible/1.Ansible%E6%89%A9%E5%B1%95%E9%98%85%E8%AF%BB/ class=md-nav__link> Ansible扩展阅读 </a> </li> <li class=md-nav__item> <a href=../../Ansible/2.%E7%AE%A1%E7%90%86windows%E4%B8%BB%E6%9C%BA/ class=md-nav__link> 管理windows主机 </a> </li> <li class=md-nav__item> <a href=../../Ansible/3.Ansible%E8%BF%9B%E9%98%B6/ class=md-nav__link> Ansible进阶 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_4 checked> <label class=md-nav__link for=__nav_7_4 id=__nav_7_4_label tabindex=0> Shell <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_4_label aria-expanded=true> <label class=md-nav__title for=__nav_7_4> <span class="md-nav__icon md-icon"></span> Shell </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Shell%E7%AE%80%E4%BB%8B/ class=md-nav__link> Shell 教程概述 </a> </li> <li class=md-nav__item> <a href=../1.%E7%AC%AC%E4%B8%80%E4%B8%AAshell%E7%A8%8B%E5%BA%8F/ class=md-nav__link> 1.第一个 Shell 程序 </a> </li> <li class=md-nav__item> <a href=../2.Shell%E5%8F%98%E9%87%8F/ class=md-nav__link> 2.Shell 变量 </a> </li> <li class=md-nav__item> <a href=../3.Shell%E5%8F%82%E6%95%B0/ class=md-nav__link> 3.Shell 参数 </a> </li> <li class=md-nav__item> <a href=../4.Shell%E6%95%B0%E7%BB%84/ class=md-nav__link> 4.Shell数组 </a> </li> <li class=md-nav__item> <a href=../5.Shell%E8%BF%90%E7%AE%97%E7%AC%A6/ class=md-nav__link> 5.Shell 运算符 </a> </li> <li class=md-nav__item> <a href=../6.Shell%20echo_printf%E5%91%BD%E4%BB%A4/ class=md-nav__link> 6.Shell echo/printf 命令 </a> </li> <li class=md-nav__item> <a href=../7.Shell%20test%E5%91%BD%E4%BB%A4/ class=md-nav__link> 7.Shell test 命令 </a> </li> <li class=md-nav__item> <a href=../8.Shell%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/ class=md-nav__link> 8.Shell 流程控制 </a> </li> <li class=md-nav__item> <a href=../9.Shell%E5%87%BD%E6%95%B0/ class=md-nav__link> 8.Shell 函数 </a> </li> <li class=md-nav__item> <a href=../10.Shell%E8%BE%93%E5%85%A5_%E8%BE%93%E5%87%BA%E9%87%8D%E5%AE%9A%E5%90%91/ class=md-nav__link> 10.Shell输入/输出重定向 </a> </li> <li class=md-nav__item> <a href=../11.Shell%20%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/ class=md-nav__link> 11.Shell 正则表达式 </a> </li> <li class=md-nav__item> <a href=../12.Shell%20%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bgrep/ class=md-nav__link> 12.Shell 三剑客之grep </a> </li> <li class=md-nav__item> <a href=../13.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/ class=md-nav__link> 13.Shell三剑客之sed </a> </li> <li class=md-nav__item> <a href=../14.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bawk/ class=md-nav__link> 14.Shell三剑客之awk </a> </li> <li class=md-nav__item> <a href=../15.Shell%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/ class=md-nav__link> 15.Shell常用工具 </a> </li> <li class=md-nav__item> <a href=../16.Shell%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/ class=md-nav__link> 16.Shell实战项目 </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> 17.Shell脚本示例 <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> 17.Shell脚本示例 </a> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#1判断curl返回状态码 class=md-nav__link> 1.判断curl返回状态码 </a> </li> <li class=md-nav__item> <a href=#2读取文件中的配置到变量中 class=md-nav__link> 2.读取文件中的配置到变量中 </a> </li> <li class=md-nav__item> <a href=#3根据console输入条件执行 class=md-nav__link> 3.根据console输入条件执行 </a> </li> <li class=md-nav__item> <a href=#4将指定输出内容写入文件 class=md-nav__link> 4.将指定输出内容写入文件 </a> </li> <li class=md-nav__item> <a href=#5判断变量是否存在或为空 class=md-nav__link> 5.判断变量是否存在或为空 </a> <nav class=md-nav aria-label=5.判断变量是否存在或为空> <ul class=md-nav__list> <li class=md-nav__item> <a href=#51-字符串判断中x的作用 class=md-nav__link> 5.1 字符串判断中x的作用 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#6文件扫描校验 class=md-nav__link> 6.文件扫描校验 </a> </li> <li class=md-nav__item> <a href=#7linux系统检测 class=md-nav__link> 7.Linux系统检测 </a> </li> <li class=md-nav__item> <a href=#8启动脚本示例 class=md-nav__link> 8.启动脚本示例 </a> </li> <li class=md-nav__item> <a href=#9备份24小时被修改的文件 class=md-nav__link> 9.备份24小时被修改的文件 </a> </li> <li class=md-nav__item> <a href=#10卸载相关的rpm包 class=md-nav__link> 10.卸载相关的rpm包 </a> </li> <li class=md-nav__item> <a href=#11检查rpm包的方法 class=md-nav__link> 11.检查rpm包的方法 </a> </li> <li class=md-nav__item> <a href=#12检查软件状态 class=md-nav__link> 12.检查软件状态 </a> </li> <li class=md-nav__item> <a href=#13color输出 class=md-nav__link> 13.color输出 </a> </li> <li class=md-nav__item> <a href=#14nginx日志切割 class=md-nav__link> 14.Nginx日志切割 </a> </li> <li class=md-nav__item> <a href=#15一键安装docker class=md-nav__link> 15.一键安装docker </a> </li> <li class=md-nav__item> <a href=#16-备份mongodb class=md-nav__link> 16. 备份MongoDB </a> </li> <li class=md-nav__item> <a href=#17linux下以秒为单位执行脚本 class=md-nav__link> 17.Linux下以秒为单位执行脚本 </a> <nav class=md-nav aria-label=17.Linux下以秒为单位执行脚本> <ul class=md-nav__list> <li class=md-nav__item> <a href=#example1 class=md-nav__link> example1 </a> </li> <li class=md-nav__item> <a href=#example2 class=md-nav__link> example2 </a> </li> <li class=md-nav__item> <a href=#example3 class=md-nav__link> example3 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#18备份文件 class=md-nav__link> 18.备份文件 </a> </li> <li class=md-nav__item> <a href=#19修改ip_主机名_网卡信息 class=md-nav__link> 19.修改IP_主机名_网卡信息 </a> </li> <li class=md-nav__item> <a href=#20检查恶意ip登录拒绝ssh class=md-nav__link> 20.检查恶意IP登录，拒绝SSH </a> </li> <li class=md-nav__item> <a href=#21数据库备份 class=md-nav__link> 21.数据库备份 </a> <nav class=md-nav aria-label=21.数据库备份> <ul class=md-nav__list> <li class=md-nav__item> <a href=#备份数据库 class=md-nav__link> 备份数据库 </a> </li> <li class=md-nav__item> <a href=#mysql定时备份脚本 class=md-nav__link> MySQL定时备份脚本 </a> </li> <li class=md-nav__item> <a href=#mysql数据库分库备份 class=md-nav__link> MySQL数据库分库备份 </a> </li> <li class=md-nav__item> <a href=#mysql数据库分库分表备份 class=md-nav__link> MySQL数据库分库分表备份 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#22开机性能优化 class=md-nav__link> 22.开机性能优化 </a> </li> <li class=md-nav__item> <a href=#23函数输出帮助信息 class=md-nav__link> 23.函数输出帮助信息 </a> </li> <li class=md-nav__item> <a href=#24设置锁文件防止脚本重复执行 class=md-nav__link> 24.设置锁文件防止脚本重复执行 </a> </li> <li class=md-nav__item> <a href=#25对一组url测试能否访问成功 class=md-nav__link> 25.对一组url测试能否访问成功 </a> </li> <li class=md-nav__item> <a href=#26mysql单表数据同步脚本 class=md-nav__link> 26.MySQL单表数据同步脚本 </a> </li> <li class=md-nav__item> <a href=#27shell实现多并发控制 class=md-nav__link> 27.shell实现多并发控制 </a> <nav class=md-nav aria-label=27.shell实现多并发控制> <ul class=md-nav__list> <li class=md-nav__item> <a href=#不并发 class=md-nav__link> 不并发 </a> </li> <li class=md-nav__item> <a href=#控制并发 class=md-nav__link> 控制并发 </a> <nav class=md-nav aria-label=控制并发> <ul class=md-nav__list> <li class=md-nav__item> <a href=#示例1 class=md-nav__link> 示例1 </a> </li> <li class=md-nav__item> <a href=#示例2 class=md-nav__link> 示例2 </a> </li> <li class=md-nav__item> <a href=#示例3 class=md-nav__link> 示例3 </a> </li> <li class=md-nav__item> <a href=#示例4 class=md-nav__link> 示例4 </a> </li> <li class=md-nav__item> <a href=#示例5 class=md-nav__link> 示例5 </a> </li> <li class=md-nav__item> <a href=#示例6 class=md-nav__link> 示例6 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#28一些常用的函数 class=md-nav__link> 28.一些常用的函数 </a> </li> <li class=md-nav__item> <a href=#30猜随机数 class=md-nav__link> 30.猜随机数 </a> </li> <li class=md-nav__item> <a href=#31test多种写法 class=md-nav__link> 31.test多种写法 </a> </li> <li class=md-nav__item> <a href=#32换算秒为分钟小时 class=md-nav__link> 32.换算秒为分钟、小时 </a> </li> <li class=md-nav__item> <a href=#33脚本命令行参数的传递与判断 class=md-nav__link> 33.脚本命令行参数的传递与判断 </a> </li> <li class=md-nav__item> <a href=#34检测docker-容器的启动状态 class=md-nav__link> 34.检测docker 容器的启动状态 </a> </li> <li class=md-nav__item> <a href=#35检查常见系统命令是否安装 class=md-nav__link> 35.检查常见系统命令是否安装 </a> </li> <li class=md-nav__item> <a href=#36发送钉钉通知 class=md-nav__link> 36.发送钉钉通知 </a> </li> <li class=md-nav__item> <a href=#37function函数库 class=md-nav__link> 37.function函数库 </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#1判断curl返回状态码 class=md-nav__link> 1.判断curl返回状态码 </a> </li> <li class=md-nav__item> <a href=#2读取文件中的配置到变量中 class=md-nav__link> 2.读取文件中的配置到变量中 </a> </li> <li class=md-nav__item> <a href=#3根据console输入条件执行 class=md-nav__link> 3.根据console输入条件执行 </a> </li> <li class=md-nav__item> <a href=#4将指定输出内容写入文件 class=md-nav__link> 4.将指定输出内容写入文件 </a> </li> <li class=md-nav__item> <a href=#5判断变量是否存在或为空 class=md-nav__link> 5.判断变量是否存在或为空 </a> <nav class=md-nav aria-label=5.判断变量是否存在或为空> <ul class=md-nav__list> <li class=md-nav__item> <a href=#51-字符串判断中x的作用 class=md-nav__link> 5.1 字符串判断中x的作用 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#6文件扫描校验 class=md-nav__link> 6.文件扫描校验 </a> </li> <li class=md-nav__item> <a href=#7linux系统检测 class=md-nav__link> 7.Linux系统检测 </a> </li> <li class=md-nav__item> <a href=#8启动脚本示例 class=md-nav__link> 8.启动脚本示例 </a> </li> <li class=md-nav__item> <a href=#9备份24小时被修改的文件 class=md-nav__link> 9.备份24小时被修改的文件 </a> </li> <li class=md-nav__item> <a href=#10卸载相关的rpm包 class=md-nav__link> 10.卸载相关的rpm包 </a> </li> <li class=md-nav__item> <a href=#11检查rpm包的方法 class=md-nav__link> 11.检查rpm包的方法 </a> </li> <li class=md-nav__item> <a href=#12检查软件状态 class=md-nav__link> 12.检查软件状态 </a> </li> <li class=md-nav__item> <a href=#13color输出 class=md-nav__link> 13.color输出 </a> </li> <li class=md-nav__item> <a href=#14nginx日志切割 class=md-nav__link> 14.Nginx日志切割 </a> </li> <li class=md-nav__item> <a href=#15一键安装docker class=md-nav__link> 15.一键安装docker </a> </li> <li class=md-nav__item> <a href=#16-备份mongodb class=md-nav__link> 16. 备份MongoDB </a> </li> <li class=md-nav__item> <a href=#17linux下以秒为单位执行脚本 class=md-nav__link> 17.Linux下以秒为单位执行脚本 </a> <nav class=md-nav aria-label=17.Linux下以秒为单位执行脚本> <ul class=md-nav__list> <li class=md-nav__item> <a href=#example1 class=md-nav__link> example1 </a> </li> <li class=md-nav__item> <a href=#example2 class=md-nav__link> example2 </a> </li> <li class=md-nav__item> <a href=#example3 class=md-nav__link> example3 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#18备份文件 class=md-nav__link> 18.备份文件 </a> </li> <li class=md-nav__item> <a href=#19修改ip_主机名_网卡信息 class=md-nav__link> 19.修改IP_主机名_网卡信息 </a> </li> <li class=md-nav__item> <a href=#20检查恶意ip登录拒绝ssh class=md-nav__link> 20.检查恶意IP登录，拒绝SSH </a> </li> <li class=md-nav__item> <a href=#21数据库备份 class=md-nav__link> 21.数据库备份 </a> <nav class=md-nav aria-label=21.数据库备份> <ul class=md-nav__list> <li class=md-nav__item> <a href=#备份数据库 class=md-nav__link> 备份数据库 </a> </li> <li class=md-nav__item> <a href=#mysql定时备份脚本 class=md-nav__link> MySQL定时备份脚本 </a> </li> <li class=md-nav__item> <a href=#mysql数据库分库备份 class=md-nav__link> MySQL数据库分库备份 </a> </li> <li class=md-nav__item> <a href=#mysql数据库分库分表备份 class=md-nav__link> MySQL数据库分库分表备份 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#22开机性能优化 class=md-nav__link> 22.开机性能优化 </a> </li> <li class=md-nav__item> <a href=#23函数输出帮助信息 class=md-nav__link> 23.函数输出帮助信息 </a> </li> <li class=md-nav__item> <a href=#24设置锁文件防止脚本重复执行 class=md-nav__link> 24.设置锁文件防止脚本重复执行 </a> </li> <li class=md-nav__item> <a href=#25对一组url测试能否访问成功 class=md-nav__link> 25.对一组url测试能否访问成功 </a> </li> <li class=md-nav__item> <a href=#26mysql单表数据同步脚本 class=md-nav__link> 26.MySQL单表数据同步脚本 </a> </li> <li class=md-nav__item> <a href=#27shell实现多并发控制 class=md-nav__link> 27.shell实现多并发控制 </a> <nav class=md-nav aria-label=27.shell实现多并发控制> <ul class=md-nav__list> <li class=md-nav__item> <a href=#不并发 class=md-nav__link> 不并发 </a> </li> <li class=md-nav__item> <a href=#控制并发 class=md-nav__link> 控制并发 </a> <nav class=md-nav aria-label=控制并发> <ul class=md-nav__list> <li class=md-nav__item> <a href=#示例1 class=md-nav__link> 示例1 </a> </li> <li class=md-nav__item> <a href=#示例2 class=md-nav__link> 示例2 </a> </li> <li class=md-nav__item> <a href=#示例3 class=md-nav__link> 示例3 </a> </li> <li class=md-nav__item> <a href=#示例4 class=md-nav__link> 示例4 </a> </li> <li class=md-nav__item> <a href=#示例5 class=md-nav__link> 示例5 </a> </li> <li class=md-nav__item> <a href=#示例6 class=md-nav__link> 示例6 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#28一些常用的函数 class=md-nav__link> 28.一些常用的函数 </a> </li> <li class=md-nav__item> <a href=#30猜随机数 class=md-nav__link> 30.猜随机数 </a> </li> <li class=md-nav__item> <a href=#31test多种写法 class=md-nav__link> 31.test多种写法 </a> </li> <li class=md-nav__item> <a href=#32换算秒为分钟小时 class=md-nav__link> 32.换算秒为分钟、小时 </a> </li> <li class=md-nav__item> <a href=#33脚本命令行参数的传递与判断 class=md-nav__link> 33.脚本命令行参数的传递与判断 </a> </li> <li class=md-nav__item> <a href=#34检测docker-容器的启动状态 class=md-nav__link> 34.检测docker 容器的启动状态 </a> </li> <li class=md-nav__item> <a href=#35检查常见系统命令是否安装 class=md-nav__link> 35.检查常见系统命令是否安装 </a> </li> <li class=md-nav__item> <a href=#36发送钉钉通知 class=md-nav__link> 36.发送钉钉通知 </a> </li> <li class=md-nav__item> <a href=#37function函数库 class=md-nav__link> 37.function函数库 </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=17shell脚本示例>17.Shell脚本示例<a class=headerlink href=#17shell脚本示例 title="Permanent link">&para;</a></h1> <p>脚本编写注意事项</p> <ol> <li>开头加解释器：#!/bin/bash </li> <li>语法缩进，使用四个空格；多加注释说明。 </li> <li>命名建议规则：变量名大写、局部变量小写，函数名小写，名字体现出实际作用。</li> <li>默认变量是全局的，在函数中变量 local 指定为局部变量，避免污染其他作用域。 </li> <li>有两个命令能帮助我调试脚本：set -e 遇到执行非 0 时退出脚本，set -x 和 set +x 打印执行过程。set-x 和set+x常用于调试函数。 </li> <li>写脚本一定先测试再到生产上。</li> </ol> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nb>set</span><span class=w> </span>-x
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=k>function</span><span class=o>(){</span>
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=o>}</span>
<a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=nb>set</span><span class=w> </span>+x
</code></pre></div> <div class=highlight><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=c1># set 的一些用法：</span>
<a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=w>    </span><span class=nb>shopt</span><span class=w> </span>-s<span class=w> </span>-o<span class=w> </span>nounset<span class=w>         </span><span class=c1>#强调变量必须先声明才能使用</span>
<a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a>
<a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a><span class=w>    </span><span class=nb>set</span><span class=w> </span>x<span class=w> </span>y<span class=w> </span>z<span class=w>               </span><span class=c1># 将x,y,z的值赋予位置参数1,2,3</span>
<a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a>
<a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a><span class=w>    </span><span class=c1>#把 set -u 或 set -o nounset 插入到脚本中, 并运行它, 就会在每个试图使用未声明变量的地方给出一个unbound variable错误信息.</span>
<a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a><span class=w>    </span><span class=c1>#set -e     # 遇到执行非 0 时退出脚本，set -x 打印执行过程</span>
<a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a>
<a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a><span class=w>    </span><span class=nb>set</span><span class=w> </span>-o<span class=w> </span>pipefail<span class=w> </span><span class=c1>#在这个设置执行后，其后面的代码，包括管道命令的返回值，为最后一个非零的命令的返回值，或者当管道内的所有命令都执行成功后返回零。</span>
<a id=__codelineno-1-10 name=__codelineno-1-10 href=#__codelineno-1-10></a>
<a id=__codelineno-1-11 name=__codelineno-1-11 href=#__codelineno-1-11></a><span class=w>    </span><span class=nb>set</span><span class=w> </span>-o<span class=w> </span>nounset<span class=w>      </span><span class=c1>#未声明变量就报错，强制退出</span>
<a id=__codelineno-1-12 name=__codelineno-1-12 href=#__codelineno-1-12></a><span class=w>    </span><span class=nb>set</span><span class=w> </span>+o<span class=w> </span>nounset<span class=w>      </span><span class=c1># set -/+u,简写</span>
<a id=__codelineno-1-13 name=__codelineno-1-13 href=#__codelineno-1-13></a>
<a id=__codelineno-1-14 name=__codelineno-1-14 href=#__codelineno-1-14></a><span class=w>    </span><span class=nb>set</span><span class=w> </span>-o<span class=w> </span>errexit<span class=w>      </span><span class=c1># 脚本只要发生错误，执行出现非0的结果,当脚本发生第一个错误时退出脚本</span>
<a id=__codelineno-1-15 name=__codelineno-1-15 href=#__codelineno-1-15></a><span class=w>    </span><span class=nb>set</span><span class=w> </span>+o<span class=w> </span>errexit<span class=w>      </span><span class=c1># set -/+e,简写</span>
<a id=__codelineno-1-16 name=__codelineno-1-16 href=#__codelineno-1-16></a>
<a id=__codelineno-1-17 name=__codelineno-1-17 href=#__codelineno-1-17></a><span class=w>    </span><span class=nb>set</span><span class=w> </span>-o<span class=w> </span>xtrace<span class=w>       </span><span class=c1># 表示跟踪脚本的执行过程，有利于调试,运行结果之前，先输出执行的那一行命令,比set -v更加完整详细</span>
<a id=__codelineno-1-18 name=__codelineno-1-18 href=#__codelineno-1-18></a><span class=w>    </span><span class=nb>set</span><span class=w> </span>+o<span class=w> </span>xtrace<span class=w>       </span><span class=c1># set -/+x,简写</span>
<a id=__codelineno-1-19 name=__codelineno-1-19 href=#__codelineno-1-19></a>
<a id=__codelineno-1-20 name=__codelineno-1-20 href=#__codelineno-1-20></a><span class=w>    </span><span class=nb>set</span><span class=w> </span>-o<span class=w> </span>noclobber<span class=w>    </span><span class=c1># 防止文件覆盖，文件存在就报错，不存在就正常创建</span>
<a id=__codelineno-1-21 name=__codelineno-1-21 href=#__codelineno-1-21></a><span class=w>    </span><span class=nb>set</span><span class=w> </span>+o<span class=w> </span>noclobber<span class=w>    </span><span class=c1># set -/+C,简写</span>
<a id=__codelineno-1-22 name=__codelineno-1-22 href=#__codelineno-1-22></a>
<a id=__codelineno-1-23 name=__codelineno-1-23 href=#__codelineno-1-23></a><span class=w>    </span><span class=nb>set</span><span class=w> </span>-o<span class=w> </span>allexport<span class=w>    </span><span class=c1># export 所有已定于的变量</span>
<a id=__codelineno-1-24 name=__codelineno-1-24 href=#__codelineno-1-24></a><span class=w>    </span><span class=nb>set</span><span class=w> </span>+o<span class=w> </span>allexport<span class=w>    </span><span class=c1># set -/+a,简写</span>
<a id=__codelineno-1-25 name=__codelineno-1-25 href=#__codelineno-1-25></a>
<a id=__codelineno-1-26 name=__codelineno-1-26 href=#__codelineno-1-26></a><span class=w>    </span><span class=nb>set</span><span class=w> </span>-o<span class=w> </span>noexec<span class=w>       </span><span class=c1># 读取脚本命令，不执行，进行语法检查</span>
<a id=__codelineno-1-27 name=__codelineno-1-27 href=#__codelineno-1-27></a><span class=w>    </span><span class=nb>set</span><span class=w> </span>+o<span class=w> </span>noexec<span class=w>       </span><span class=c1># set -/+n,简写</span>
<a id=__codelineno-1-28 name=__codelineno-1-28 href=#__codelineno-1-28></a>
<a id=__codelineno-1-29 name=__codelineno-1-29 href=#__codelineno-1-29></a><span class=w>    </span><span class=nb>set</span><span class=w> </span>-o<span class=w> </span>verbose<span class=w>      </span><span class=c1># 执行一个命令前打印出这个命令</span>
<a id=__codelineno-1-30 name=__codelineno-1-30 href=#__codelineno-1-30></a><span class=w>    </span><span class=nb>set</span><span class=w> </span>+o<span class=w> </span>verbose<span class=w>      </span><span class=c1># set -/+v,简写</span>
<a id=__codelineno-1-31 name=__codelineno-1-31 href=#__codelineno-1-31></a>
<a id=__codelineno-1-32 name=__codelineno-1-32 href=#__codelineno-1-32></a>
<a id=__codelineno-1-33 name=__codelineno-1-33 href=#__codelineno-1-33></a>
<a id=__codelineno-1-34 name=__codelineno-1-34 href=#__codelineno-1-34></a><span class=w>    </span><span class=nb>set</span><span class=w> </span>-x
<a id=__codelineno-1-35 name=__codelineno-1-35 href=#__codelineno-1-35></a><span class=w>    </span>uname<span class=w> </span>-a
<a id=__codelineno-1-36 name=__codelineno-1-36 href=#__codelineno-1-36></a><span class=w>    </span>......
<a id=__codelineno-1-37 name=__codelineno-1-37 href=#__codelineno-1-37></a><span class=w>    </span><span class=nb>set</span><span class=w> </span>+x<span class=w>              </span><span class=c1>#调试某一个区域  打印执行过程,用于调试函数居多</span>
</code></pre></div> <p>脚本开头执行时，执行如下命令， 在执行过程中若遇到使用了未定义的变量或命令返回值为非零，将直接报错退出：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=nb>set</span><span class=w> </span>-eu
<a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=nb>set</span><span class=w> </span>-euo<span class=w> </span>pipefail
</code></pre></div> <h2 id=1判断curl返回状态码>1.判断curl返回状态码<a class=headerlink href=#1判断curl返回状态码 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=nv>response</span><span class=o>=</span><span class=k>$(</span>curl<span class=w> </span>-sL<span class=w> </span>-o<span class=w> </span>/dev/null<span class=w> </span>-w<span class=w> </span>%<span class=o>{</span>http_code<span class=o>}</span><span class=w> </span>https://baidu.com<span class=k>)</span>
<a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a><span class=k>if</span><span class=w> </span><span class=o>[[</span><span class=w> </span><span class=nv>$response</span><span class=w> </span>-ge<span class=w> </span><span class=m>200</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nv>$response</span><span class=w> </span>-le<span class=w> </span><span class=m>299</span><span class=w> </span><span class=o>]]</span><span class=w> </span><span class=p>;</span><span class=k>then</span><span class=w> </span>
<a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s1>&#39;check point success&#39;</span>
<a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a><span class=k>else</span><span class=w> </span>
<a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s1>&#39;check point fail&#39;</span>
<a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a><span class=k>fi</span>
</code></pre></div> <h2 id=2读取文件中的配置到变量中>2.读取文件中的配置到变量中<a class=headerlink href=#2读取文件中的配置到变量中 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=c1># 配置文件中的配置项格式为key1=value1，一行一个配置项</span>
<a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a><span class=k>while</span><span class=w> </span><span class=nb>read</span><span class=w> </span>line<span class=p>;</span><span class=k>do</span>
<a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a><span class=w>    </span><span class=nb>eval</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$line</span><span class=s2>&quot;</span>
<a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a><span class=k>done</span><span class=w> </span>&lt;<span class=w> </span>/etc/openvpn/server/smtp.conf
<a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a><span class=nb>echo</span><span class=w> </span><span class=nv>$key1</span>
</code></pre></div> <h2 id=3根据console输入条件执行>3.根据console输入条件执行<a class=headerlink href=#3根据console输入条件执行 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;选择以下功能:&quot;</span>
<a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;   0) 功能0&quot;</span>
<a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;   1) 功能1&quot;</span>
<a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;   2) 功能2&quot;</span>
<a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;   3) 功能3&quot;</span>
<a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;   4) 功能4&quot;</span>
<a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a><span class=nb>read</span><span class=w> </span>-p<span class=w> </span><span class=s2>&quot;功能选项[4]: &quot;</span><span class=w> </span>option
<a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a><span class=k>until</span><span class=w> </span><span class=o>[[</span><span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=nv>$option</span><span class=s2>&quot;</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$option</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span>~<span class=w> </span>^<span class=o>[</span><span class=m>0</span>-4<span class=o>]</span>$<span class=w> </span><span class=o>]]</span><span class=p>;</span><span class=w> </span><span class=k>do</span>
<a id=__codelineno-5-10 name=__codelineno-5-10 href=#__codelineno-5-10></a><span class=w>    </span><span class=nb>read</span><span class=w> </span>-p<span class=w> </span><span class=s2>&quot;</span><span class=nv>$option为无效的选项</span><span class=s2>，请重新输入功能选项: &quot;</span><span class=w> </span>option
<a id=__codelineno-5-11 name=__codelineno-5-11 href=#__codelineno-5-11></a><span class=k>done</span>
<a id=__codelineno-5-12 name=__codelineno-5-12 href=#__codelineno-5-12></a><span class=k>case</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$option</span><span class=s2>&quot;</span><span class=w> </span><span class=k>in</span>
<a id=__codelineno-5-13 name=__codelineno-5-13 href=#__codelineno-5-13></a><span class=w>    </span><span class=m>0</span><span class=o>)</span><span class=w> </span>
<a id=__codelineno-5-14 name=__codelineno-5-14 href=#__codelineno-5-14></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;功能0已执行!&quot;</span><span class=w> </span>
<a id=__codelineno-5-15 name=__codelineno-5-15 href=#__codelineno-5-15></a><span class=w>    </span><span class=p>;;</span>
<a id=__codelineno-5-16 name=__codelineno-5-16 href=#__codelineno-5-16></a><span class=w>        </span><span class=m>1</span><span class=o>)</span>
<a id=__codelineno-5-17 name=__codelineno-5-17 href=#__codelineno-5-17></a><span class=w>            </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;功能1已执行!&quot;</span><span class=w> </span>
<a id=__codelineno-5-18 name=__codelineno-5-18 href=#__codelineno-5-18></a><span class=w>      </span><span class=nb>exit</span>
<a id=__codelineno-5-19 name=__codelineno-5-19 href=#__codelineno-5-19></a><span class=w>    </span><span class=p>;;</span>
<a id=__codelineno-5-20 name=__codelineno-5-20 href=#__codelineno-5-20></a><span class=w>        </span><span class=m>2</span><span class=o>)</span>
<a id=__codelineno-5-21 name=__codelineno-5-21 href=#__codelineno-5-21></a><span class=w>            </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;功能2已执行!&quot;</span><span class=w> </span>
<a id=__codelineno-5-22 name=__codelineno-5-22 href=#__codelineno-5-22></a><span class=w>            </span><span class=nb>exit</span>
<a id=__codelineno-5-23 name=__codelineno-5-23 href=#__codelineno-5-23></a><span class=w>        </span><span class=p>;;</span>
<a id=__codelineno-5-24 name=__codelineno-5-24 href=#__codelineno-5-24></a><span class=w>        </span><span class=m>3</span><span class=o>)</span>
<a id=__codelineno-5-25 name=__codelineno-5-25 href=#__codelineno-5-25></a><span class=w>            </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;功能3已执行!&quot;</span><span class=w>  </span>
<a id=__codelineno-5-26 name=__codelineno-5-26 href=#__codelineno-5-26></a><span class=w>            </span><span class=nb>exit</span>
<a id=__codelineno-5-27 name=__codelineno-5-27 href=#__codelineno-5-27></a><span class=w>        </span><span class=p>;;</span>
<a id=__codelineno-5-28 name=__codelineno-5-28 href=#__codelineno-5-28></a><span class=w>        </span><span class=c1># 默认选项</span>
<a id=__codelineno-5-29 name=__codelineno-5-29 href=#__codelineno-5-29></a><span class=w>        </span><span class=m>4</span><span class=p>|</span><span class=s2>&quot;&quot;</span><span class=o>)</span>
<a id=__codelineno-5-30 name=__codelineno-5-30 href=#__codelineno-5-30></a><span class=w>            </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;功能4已执行!&quot;</span><span class=w> </span>
<a id=__codelineno-5-31 name=__codelineno-5-31 href=#__codelineno-5-31></a><span class=w>            </span><span class=nb>exit</span>
<a id=__codelineno-5-32 name=__codelineno-5-32 href=#__codelineno-5-32></a><span class=w>        </span><span class=p>;;</span>
<a id=__codelineno-5-33 name=__codelineno-5-33 href=#__codelineno-5-33></a><span class=k>esac</span>
</code></pre></div> <h2 id=4将指定输出内容写入文件>4.将指定输出内容写入文件<a class=headerlink href=#4将指定输出内容写入文件 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=o>{</span>
<a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;hahh&quot;</span>
<a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;lalal&quot;</span>
<a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a><span class=o>}</span><span class=w> </span>&gt;<span class=w> </span>/tmp/test
</code></pre></div> <h2 id=5判断变量是否存在或为空>5.判断变量是否存在或为空<a class=headerlink href=#5判断变量是否存在或为空 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=si>${</span><span class=nv>var</span><span class=p>+x</span><span class=si>}</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span><span class=w> </span>
<a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;var is unset&quot;</span><span class=p>;</span><span class=w> </span>
<a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a><span class=k>else</span><span class=w> </span>
<a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;var is set to &#39;</span><span class=nv>$var</span><span class=s2>&#39;&quot;</span><span class=p>;</span><span class=w> </span>
<a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a><span class=k>fi</span>
</code></pre></div> <p>参考：<a href=https://stackoverflow.com/questions/3601515/how-to-check-if-a-variable-is-set-in-bash>https://stackoverflow.com/questions/3601515/how-to-check-if-a-variable-is-set-in-bash</a></p> <div class=highlight><pre><span></span><code><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a>
<a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a><span class=c1># -z 选项用于检查变量是否为空字符串，如果是，则返回true</span>
<a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>VAR</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;VAR is empty&quot;</span>
<a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a><span class=k>fi</span>
<a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a>
<a id=__codelineno-8-8 name=__codelineno-8-8 href=#__codelineno-8-8></a><span class=c1># -n 选项用于检查变量是否为非空字符串，如果是，则返回true。</span>
<a id=__codelineno-8-9 name=__codelineno-8-9 href=#__codelineno-8-9></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>VAR</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-8-10 name=__codelineno-8-10 href=#__codelineno-8-10></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;VAR is not empty&quot;</span>
<a id=__codelineno-8-11 name=__codelineno-8-11 href=#__codelineno-8-11></a><span class=k>fi</span>
</code></pre></div> <p>在测试变量是否为空时，最好使用双引号将变量括起来，以避免在变量为空时出现语法错误。</p> <h3 id=51-字符串判断中x的作用>5.1 字符串判断中x的作用<a class=headerlink href=#51-字符串判断中x的作用 title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a>范例
<a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;x</span><span class=si>${</span><span class=nv>var</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s2>&quot;x&quot;</span><span class=w> </span><span class=o>]</span>
<a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>x<span class=s2>&quot;</span><span class=nv>$DPVS_TYPE</span><span class=s2>&quot;</span><span class=w> </span><span class=o>==</span><span class=w> </span>x<span class=s2>&quot;SNAT&quot;</span><span class=w> </span><span class=o>]</span>
<a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a>
<a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a>目的
<a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a>防止出现语法错误。
<a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a>
<a id=__codelineno-9-8 name=__codelineno-9-8 href=#__codelineno-9-8></a><span class=o>[</span><span class=w> </span>x<span class=nv>$1</span><span class=w> </span><span class=o>=</span><span class=w> </span>x<span class=w> </span><span class=o>]</span><span class=w> </span>is<span class=w> </span><span class=nb>true</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=nv>$1</span><span class=w> </span>is<span class=w> </span>unset/null/empty<span class=w> </span>or<span class=w> </span>not.
<a id=__codelineno-9-9 name=__codelineno-9-9 href=#__codelineno-9-9></a>
<a id=__codelineno-9-10 name=__codelineno-9-10 href=#__codelineno-9-10></a>Try<span class=w> </span>yourself<span class=w> </span>with:
<a id=__codelineno-9-11 name=__codelineno-9-11 href=#__codelineno-9-11></a><span class=nv>TEST</span><span class=o>=</span><span class=w> </span><span class=p>;</span><span class=o>[</span><span class=w> </span>x<span class=nv>$TEST</span><span class=w> </span><span class=o>=</span><span class=w> </span>x<span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;TEST is unset&quot;</span>
<a id=__codelineno-9-12 name=__codelineno-9-12 href=#__codelineno-9-12></a>and
<a id=__codelineno-9-13 name=__codelineno-9-13 href=#__codelineno-9-13></a><span class=nv>TEST</span><span class=o>=</span>lolz<span class=w> </span><span class=p>;</span><span class=o>[</span><span class=w> </span>x<span class=nv>$TEST</span><span class=w> </span><span class=o>=</span><span class=w> </span>x<span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;TEST is unset&quot;</span>
<a id=__codelineno-9-14 name=__codelineno-9-14 href=#__codelineno-9-14></a>
<a id=__codelineno-9-15 name=__codelineno-9-15 href=#__codelineno-9-15></a>类似于<span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>1</span><span class=p>:+x</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span>操作，当<span class=nv>$1</span>为空时，赋值给x，避免判断直接报错。
</code></pre></div> <h2 id=6文件扫描校验>6.文件扫描校验<a class=headerlink href=#6文件扫描校验 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a><span class=c1>#func:scan file</span>
<a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a><span class=c1>#md5sum -c $SCAN_FILE</span>
<a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a>
<a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a>
<a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a><span class=nv>SCAN_DIR</span><span class=o>=</span><span class=sb>`</span><span class=nb>echo</span><span class=w> </span><span class=nv>$PATH</span><span class=w> </span><span class=p>|</span>sed<span class=w> </span><span class=s1>&#39;s/:/ /g&#39;</span><span class=sb>`</span>
<a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a><span class=nv>SCAN_CMD</span><span class=o>=</span><span class=sb>`</span>which<span class=w> </span>md5sum<span class=sb>`</span>
<a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a><span class=nv>SCAN_FILE_FALL</span><span class=o>=</span><span class=s2>&quot;/tmp/scan_</span><span class=k>$(</span>date<span class=w> </span>+%F%H%m<span class=k>)</span><span class=s2>_fall.txt&quot;</span>
<a id=__codelineno-10-9 name=__codelineno-10-9 href=#__codelineno-10-9></a><span class=nv>SCAN_FILE_BIN</span><span class=o>=</span><span class=s2>&quot;/tmp/scan_</span><span class=k>$(</span>date<span class=w> </span>+%F%H%m<span class=k>)</span><span class=s2>_bin.txt&quot;</span>
<a id=__codelineno-10-10 name=__codelineno-10-10 href=#__codelineno-10-10></a>
<a id=__codelineno-10-11 name=__codelineno-10-11 href=#__codelineno-10-11></a>scan_fall_disk<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-10-12 name=__codelineno-10-12 href=#__codelineno-10-12></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;正在全盘扫描，请稍等！文件路径:</span><span class=nv>$SCAN_FILE_FALL</span><span class=s2>&quot;</span>
<a id=__codelineno-10-13 name=__codelineno-10-13 href=#__codelineno-10-13></a><span class=w>        </span>find<span class=w> </span>/<span class=w> </span>-type<span class=w> </span>f<span class=w> </span>-exec<span class=w> </span><span class=nv>$SCAN_CMD</span><span class=w> </span><span class=se>\{\}</span><span class=w> </span><span class=se>\;</span>&gt;&gt;<span class=w> </span><span class=nv>$SCAN_FILE_FALL</span><span class=w> </span><span class=m>2</span>&gt;/dev/null
<a id=__codelineno-10-14 name=__codelineno-10-14 href=#__codelineno-10-14></a><span class=o>}</span>
<a id=__codelineno-10-15 name=__codelineno-10-15 href=#__codelineno-10-15></a>
<a id=__codelineno-10-16 name=__codelineno-10-16 href=#__codelineno-10-16></a>scan_bin<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-10-17 name=__codelineno-10-17 href=#__codelineno-10-17></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;正在扫描PATH可执行文件，请稍等，文件路径：</span><span class=nv>$SCAN_FILE_BIN</span><span class=s2>&quot;</span>
<a id=__codelineno-10-18 name=__codelineno-10-18 href=#__codelineno-10-18></a><span class=w>    </span><span class=k>for</span><span class=w> </span>file<span class=w> </span><span class=k>in</span><span class=w> </span><span class=nv>$SCAN_DIR</span>
<a id=__codelineno-10-19 name=__codelineno-10-19 href=#__codelineno-10-19></a><span class=w>    </span><span class=k>do</span>
<a id=__codelineno-10-20 name=__codelineno-10-20 href=#__codelineno-10-20></a><span class=w>        </span>find<span class=w> </span><span class=nv>$filae</span><span class=w> </span>-type<span class=w> </span>f<span class=w> </span>-exec<span class=w> </span><span class=nv>$SCAN_CMD</span><span class=w> </span><span class=se>\{\}</span><span class=w> </span><span class=se>\;</span>&gt;&gt;<span class=w> </span><span class=nv>$SCAN_FILE_BIN</span><span class=w> </span><span class=m>2</span>&gt;/dev/null
<a id=__codelineno-10-21 name=__codelineno-10-21 href=#__codelineno-10-21></a><span class=w>    </span><span class=k>done</span>
<a id=__codelineno-10-22 name=__codelineno-10-22 href=#__codelineno-10-22></a><span class=o>}</span>
<a id=__codelineno-10-23 name=__codelineno-10-23 href=#__codelineno-10-23></a>
<a id=__codelineno-10-24 name=__codelineno-10-24 href=#__codelineno-10-24></a>main<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-10-25 name=__codelineno-10-25 href=#__codelineno-10-25></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=nv>$#</span><span class=w> </span>-lt<span class=w> </span><span class=m>1</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;请使用参数，1表示全盘扫描，2表示二进制可执行文件扫描&quot;</span>
<a id=__codelineno-10-26 name=__codelineno-10-26 href=#__codelineno-10-26></a><span class=w>    </span><span class=nb>read</span><span class=w> </span>number
<a id=__codelineno-10-27 name=__codelineno-10-27 href=#__codelineno-10-27></a><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=nv>$number</span><span class=w> </span><span class=k>in</span>
<a id=__codelineno-10-28 name=__codelineno-10-28 href=#__codelineno-10-28></a><span class=w>    </span><span class=m>1</span><span class=o>)</span>
<a id=__codelineno-10-29 name=__codelineno-10-29 href=#__codelineno-10-29></a><span class=w>        </span>scan_fall_disk<span class=p>;;</span>
<a id=__codelineno-10-30 name=__codelineno-10-30 href=#__codelineno-10-30></a><span class=w>    </span><span class=m>2</span><span class=o>)</span>
<a id=__codelineno-10-31 name=__codelineno-10-31 href=#__codelineno-10-31></a><span class=w>        </span>scan_bin<span class=p>;;</span>
<a id=__codelineno-10-32 name=__codelineno-10-32 href=#__codelineno-10-32></a><span class=w>    </span>*<span class=o>)</span>
<a id=__codelineno-10-33 name=__codelineno-10-33 href=#__codelineno-10-33></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;参数错误，1，表示全盘扫描，2表示二进制文件扫描&quot;</span>
<a id=__codelineno-10-34 name=__codelineno-10-34 href=#__codelineno-10-34></a><span class=w>    </span><span class=k>esac</span>
<a id=__codelineno-10-35 name=__codelineno-10-35 href=#__codelineno-10-35></a><span class=o>}</span>
<a id=__codelineno-10-36 name=__codelineno-10-36 href=#__codelineno-10-36></a>
<a id=__codelineno-10-37 name=__codelineno-10-37 href=#__codelineno-10-37></a>
<a id=__codelineno-10-38 name=__codelineno-10-38 href=#__codelineno-10-38></a>main
</code></pre></div> <h2 id=7linux系统检测>7.Linux系统检测<a class=headerlink href=#7linux系统检测 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a><span class=c1># auth:kaliarch</span>
<a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a><span class=c1># func:sys info check</span>
<a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a><span class=c1># version:v1.0</span>
<a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a><span class=c1># sys:centos6.x/7.x</span>
<a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a>
<a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a><span class=o>[</span><span class=w> </span><span class=k>$(</span>id<span class=w> </span>-u<span class=k>)</span><span class=w> </span>-gt<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;请用root用户执行此脚本！&quot;</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nb>exit</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a><span class=nv>sysversion</span><span class=o>=</span><span class=k>$(</span>rpm<span class=w> </span>-q<span class=w> </span>centos-release<span class=p>|</span>cut<span class=w> </span>-d-<span class=w> </span>-f3<span class=k>)</span>
<a id=__codelineno-11-9 name=__codelineno-11-9 href=#__codelineno-11-9></a><span class=nv>line</span><span class=o>=</span><span class=s2>&quot;-------------------------------------------------&quot;</span>
<a id=__codelineno-11-10 name=__codelineno-11-10 href=#__codelineno-11-10></a>
<a id=__codelineno-11-11 name=__codelineno-11-11 href=#__codelineno-11-11></a>
<a id=__codelineno-11-12 name=__codelineno-11-12 href=#__codelineno-11-12></a><span class=o>[</span><span class=w> </span>-d<span class=w> </span>logs<span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>||</span><span class=w> </span>mkdir<span class=w> </span>logs
<a id=__codelineno-11-13 name=__codelineno-11-13 href=#__codelineno-11-13></a>
<a id=__codelineno-11-14 name=__codelineno-11-14 href=#__codelineno-11-14></a><span class=nv>sys_check_file</span><span class=o>=</span><span class=s2>&quot;logs/</span><span class=k>$(</span>ip<span class=w> </span>a<span class=w> </span>show<span class=w> </span>dev<span class=w> </span>eth0<span class=p>|</span>grep<span class=w> </span>-w<span class=w> </span>inet<span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;{print $2}&#39;</span><span class=p>|</span>awk<span class=w> </span>-F<span class=w> </span><span class=s1>&#39;/&#39;</span><span class=w> </span><span class=s1>&#39;{print $1}&#39;</span><span class=k>)</span><span class=s2>-`date +%Y%m%d`.txt&quot;</span>
<a id=__codelineno-11-15 name=__codelineno-11-15 href=#__codelineno-11-15></a>
<a id=__codelineno-11-16 name=__codelineno-11-16 href=#__codelineno-11-16></a><span class=c1># 获取系统cpu信息</span>
<a id=__codelineno-11-17 name=__codelineno-11-17 href=#__codelineno-11-17></a><span class=k>function</span><span class=w> </span>get_cpu_info<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-11-18 name=__codelineno-11-18 href=#__codelineno-11-18></a><span class=w>    </span><span class=nv>Physical_CPUs</span><span class=o>=</span><span class=k>$(</span>grep<span class=w> </span><span class=s2>&quot;physical id&quot;</span><span class=w> </span>/proc/cpuinfo<span class=p>|</span><span class=w> </span>sort<span class=w> </span><span class=p>|</span><span class=w> </span>uniq<span class=w> </span><span class=p>|</span><span class=w> </span>wc<span class=w> </span>-l<span class=k>)</span>
<a id=__codelineno-11-19 name=__codelineno-11-19 href=#__codelineno-11-19></a><span class=w>    </span><span class=nv>Virt_CPUs</span><span class=o>=</span><span class=k>$(</span>grep<span class=w> </span><span class=s2>&quot;processor&quot;</span><span class=w> </span>/proc/cpuinfo<span class=w> </span><span class=p>|</span><span class=w> </span>wc<span class=w> </span>-l<span class=k>)</span>
<a id=__codelineno-11-20 name=__codelineno-11-20 href=#__codelineno-11-20></a><span class=w>    </span><span class=nv>CPU_Kernels</span><span class=o>=</span><span class=k>$(</span>grep<span class=w> </span><span class=s2>&quot;cores&quot;</span><span class=w> </span>/proc/cpuinfo<span class=p>|</span>uniq<span class=p>|</span><span class=w> </span>awk<span class=w> </span>-F<span class=w> </span><span class=s1>&#39;: &#39;</span><span class=w> </span><span class=s1>&#39;{print $2}&#39;</span><span class=k>)</span>
<a id=__codelineno-11-21 name=__codelineno-11-21 href=#__codelineno-11-21></a><span class=w>    </span><span class=nv>CPU_Type</span><span class=o>=</span><span class=k>$(</span>grep<span class=w> </span><span class=s2>&quot;model name&quot;</span><span class=w> </span>/proc/cpuinfo<span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span>-F<span class=w> </span><span class=s1>&#39;: &#39;</span><span class=w> </span><span class=s1>&#39;{print $2}&#39;</span><span class=w> </span><span class=p>|</span><span class=w> </span>sort<span class=w> </span><span class=p>|</span><span class=w> </span>uniq<span class=k>)</span>
<a id=__codelineno-11-22 name=__codelineno-11-22 href=#__codelineno-11-22></a><span class=w>    </span><span class=nv>CPU_Arch</span><span class=o>=</span><span class=k>$(</span>uname<span class=w> </span>-m<span class=k>)</span>
<a id=__codelineno-11-23 name=__codelineno-11-23 href=#__codelineno-11-23></a>cat<span class=w> </span><span class=s>&lt;&lt;EOF | column -t</span>
<a id=__codelineno-11-24 name=__codelineno-11-24 href=#__codelineno-11-24></a><span class=s>CPU信息:</span>
<a id=__codelineno-11-25 name=__codelineno-11-25 href=#__codelineno-11-25></a>
<a id=__codelineno-11-26 name=__codelineno-11-26 href=#__codelineno-11-26></a><span class=s>物理CPU个数: $Physical_CPUs</span>
<a id=__codelineno-11-27 name=__codelineno-11-27 href=#__codelineno-11-27></a><span class=s>逻辑CPU个数: $Virt_CPUs</span>
<a id=__codelineno-11-28 name=__codelineno-11-28 href=#__codelineno-11-28></a><span class=s>每CPU核心数: $CPU_Kernels</span>
<a id=__codelineno-11-29 name=__codelineno-11-29 href=#__codelineno-11-29></a><span class=s>CPU型号: $CPU_Type</span>
<a id=__codelineno-11-30 name=__codelineno-11-30 href=#__codelineno-11-30></a><span class=s>CPU架构: $CPU_Arch</span>
<a id=__codelineno-11-31 name=__codelineno-11-31 href=#__codelineno-11-31></a><span class=s>EOF</span>
<a id=__codelineno-11-32 name=__codelineno-11-32 href=#__codelineno-11-32></a><span class=o>}</span>
<a id=__codelineno-11-33 name=__codelineno-11-33 href=#__codelineno-11-33></a>
<a id=__codelineno-11-34 name=__codelineno-11-34 href=#__codelineno-11-34></a><span class=c1># 获取系统内存信息</span>
<a id=__codelineno-11-35 name=__codelineno-11-35 href=#__codelineno-11-35></a><span class=k>function</span><span class=w> </span>get_mem_info<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-11-36 name=__codelineno-11-36 href=#__codelineno-11-36></a><span class=w>    </span><span class=nv>check_mem</span><span class=o>=</span><span class=k>$(</span>free<span class=w> </span>-m<span class=k>)</span>
<a id=__codelineno-11-37 name=__codelineno-11-37 href=#__codelineno-11-37></a><span class=w>    </span><span class=nv>MemTotal</span><span class=o>=</span><span class=k>$(</span>grep<span class=w> </span>MemTotal<span class=w> </span>/proc/meminfo<span class=p>|</span><span class=w> </span>awk<span class=w> </span><span class=s1>&#39;{print $2}&#39;</span><span class=k>)</span><span class=w>  </span><span class=c1>#KB</span>
<a id=__codelineno-11-38 name=__codelineno-11-38 href=#__codelineno-11-38></a><span class=w>    </span><span class=nv>MemFree</span><span class=o>=</span><span class=k>$(</span>grep<span class=w> </span>MemFree<span class=w> </span>/proc/meminfo<span class=p>|</span><span class=w> </span>awk<span class=w> </span><span class=s1>&#39;{print $2}&#39;</span><span class=k>)</span><span class=w>    </span><span class=c1>#KB</span>
<a id=__codelineno-11-39 name=__codelineno-11-39 href=#__codelineno-11-39></a><span class=w>    </span><span class=nb>let</span><span class=w> </span><span class=nv>MemUsed</span><span class=o>=</span>MemTotal-MemFree
<a id=__codelineno-11-40 name=__codelineno-11-40 href=#__codelineno-11-40></a><span class=w>    </span><span class=nv>MemPercent</span><span class=o>=</span><span class=k>$(</span>awk<span class=w> </span><span class=s2>&quot;BEGIN {if(</span><span class=nv>$MemTotal</span><span class=s2>==0){printf 100}else{printf \&quot;%.2f\&quot;,</span><span class=nv>$MemUsed</span><span class=s2>*100/</span><span class=nv>$MemTotal</span><span class=s2>}}&quot;</span><span class=k>)</span>
<a id=__codelineno-11-41 name=__codelineno-11-41 href=#__codelineno-11-41></a><span class=w>    </span><span class=nv>report_MemTotal</span><span class=o>=</span><span class=s2>&quot;</span><span class=k>$((</span><span class=nv>MemTotal</span><span class=o>/</span><span class=m>1024</span><span class=k>))</span><span class=s2>&quot;&quot;MB&quot;</span><span class=w>        </span><span class=c1>#内存总容量(MB)</span>
<a id=__codelineno-11-42 name=__codelineno-11-42 href=#__codelineno-11-42></a><span class=w>    </span><span class=nv>report_MemFree</span><span class=o>=</span><span class=s2>&quot;</span><span class=k>$((</span><span class=nv>MemFree</span><span class=o>/</span><span class=m>1024</span><span class=k>))</span><span class=s2>&quot;&quot;MB&quot;</span><span class=w>          </span><span class=c1>#内存剩余(MB)</span>
<a id=__codelineno-11-43 name=__codelineno-11-43 href=#__codelineno-11-43></a><span class=w>    </span><span class=nv>report_MemUsedPercent</span><span class=o>=</span><span class=s2>&quot;</span><span class=k>$(</span>awk<span class=w> </span><span class=s2>&quot;BEGIN {if(</span><span class=nv>$MemTotal</span><span class=s2>==0){printf 100}else{printf \&quot;%.2f\&quot;,</span><span class=nv>$MemUsed</span><span class=s2>*100/</span><span class=nv>$MemTotal</span><span class=s2>}}&quot;</span><span class=k>)</span><span class=s2>&quot;&quot;%&quot;</span><span class=w>   </span><span class=c1>#内存使用率%</span>
<a id=__codelineno-11-44 name=__codelineno-11-44 href=#__codelineno-11-44></a>
<a id=__codelineno-11-45 name=__codelineno-11-45 href=#__codelineno-11-45></a>cat<span class=w> </span><span class=s>&lt;&lt;EOF</span>
<a id=__codelineno-11-46 name=__codelineno-11-46 href=#__codelineno-11-46></a><span class=s>内存信息：</span>
<a id=__codelineno-11-47 name=__codelineno-11-47 href=#__codelineno-11-47></a>
<a id=__codelineno-11-48 name=__codelineno-11-48 href=#__codelineno-11-48></a><span class=s>${check_mem}</span>
<a id=__codelineno-11-49 name=__codelineno-11-49 href=#__codelineno-11-49></a><span class=s>EOF</span>
<a id=__codelineno-11-50 name=__codelineno-11-50 href=#__codelineno-11-50></a><span class=o>}</span>
<a id=__codelineno-11-51 name=__codelineno-11-51 href=#__codelineno-11-51></a>
<a id=__codelineno-11-52 name=__codelineno-11-52 href=#__codelineno-11-52></a><span class=c1># 获取系统网络信息</span>
<a id=__codelineno-11-53 name=__codelineno-11-53 href=#__codelineno-11-53></a><span class=k>function</span><span class=w> </span>get_net_info<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-11-54 name=__codelineno-11-54 href=#__codelineno-11-54></a><span class=w>    </span><span class=nv>pri_ipadd</span><span class=o>=</span><span class=k>$(</span>ip<span class=w> </span>a<span class=w> </span>show<span class=w> </span>dev<span class=w> </span>eth0<span class=p>|</span>grep<span class=w> </span>-w<span class=w> </span>inet<span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;{print $2}&#39;</span><span class=p>|</span>awk<span class=w> </span>-F<span class=w> </span><span class=s1>&#39;/&#39;</span><span class=w> </span><span class=s1>&#39;{print $1}&#39;</span><span class=k>)</span>
<a id=__codelineno-11-55 name=__codelineno-11-55 href=#__codelineno-11-55></a><span class=w>    </span><span class=nv>pub_ipadd</span><span class=o>=</span><span class=k>$(</span>curl<span class=w> </span>ifconfig.me<span class=w> </span>-s<span class=k>)</span>
<a id=__codelineno-11-56 name=__codelineno-11-56 href=#__codelineno-11-56></a><span class=w>    </span><span class=nv>gateway</span><span class=o>=</span><span class=k>$(</span>ip<span class=w> </span>route<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>default<span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span><span class=s1>&#39;{print $3}&#39;</span><span class=k>)</span>
<a id=__codelineno-11-57 name=__codelineno-11-57 href=#__codelineno-11-57></a><span class=w>    </span><span class=nv>mac_info</span><span class=o>=</span><span class=k>$(</span>ip<span class=w> </span>link<span class=p>|</span><span class=w> </span>egrep<span class=w> </span>-v<span class=w> </span><span class=s2>&quot;lo&quot;</span><span class=p>|</span>grep<span class=w> </span>link<span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;{print $2}&#39;</span><span class=k>)</span>
<a id=__codelineno-11-58 name=__codelineno-11-58 href=#__codelineno-11-58></a><span class=w>    </span><span class=nv>dns_config</span><span class=o>=</span><span class=k>$(</span>egrep<span class=w> </span>-v<span class=w> </span><span class=s2>&quot;^</span>$<span class=s2>|^#&quot;</span><span class=w> </span>/etc/resolv.conf<span class=k>)</span>
<a id=__codelineno-11-59 name=__codelineno-11-59 href=#__codelineno-11-59></a><span class=w>    </span><span class=nv>route_info</span><span class=o>=</span><span class=k>$(</span>route<span class=w> </span>-n<span class=k>)</span>
<a id=__codelineno-11-60 name=__codelineno-11-60 href=#__codelineno-11-60></a>cat<span class=w> </span><span class=s>&lt;&lt;EOF | column -t</span>
<a id=__codelineno-11-61 name=__codelineno-11-61 href=#__codelineno-11-61></a><span class=s>IP信息:</span>
<a id=__codelineno-11-62 name=__codelineno-11-62 href=#__codelineno-11-62></a>
<a id=__codelineno-11-63 name=__codelineno-11-63 href=#__codelineno-11-63></a><span class=s>系统公网地址: ${pub_ipadd}</span>
<a id=__codelineno-11-64 name=__codelineno-11-64 href=#__codelineno-11-64></a><span class=s>系统私网地址: ${pri_ipadd}</span>
<a id=__codelineno-11-65 name=__codelineno-11-65 href=#__codelineno-11-65></a><span class=s>网关地址: ${gateway}</span>
<a id=__codelineno-11-66 name=__codelineno-11-66 href=#__codelineno-11-66></a><span class=s>MAC地址: ${mac_info}</span>
<a id=__codelineno-11-67 name=__codelineno-11-67 href=#__codelineno-11-67></a>
<a id=__codelineno-11-68 name=__codelineno-11-68 href=#__codelineno-11-68></a><span class=s>路由信息:</span>
<a id=__codelineno-11-69 name=__codelineno-11-69 href=#__codelineno-11-69></a><span class=s>${route_info}</span>
<a id=__codelineno-11-70 name=__codelineno-11-70 href=#__codelineno-11-70></a>
<a id=__codelineno-11-71 name=__codelineno-11-71 href=#__codelineno-11-71></a><span class=s>DNS 信息:</span>
<a id=__codelineno-11-72 name=__codelineno-11-72 href=#__codelineno-11-72></a><span class=s>${dns_config}</span>
<a id=__codelineno-11-73 name=__codelineno-11-73 href=#__codelineno-11-73></a><span class=s>EOF</span>
<a id=__codelineno-11-74 name=__codelineno-11-74 href=#__codelineno-11-74></a><span class=o>}</span>
<a id=__codelineno-11-75 name=__codelineno-11-75 href=#__codelineno-11-75></a>
<a id=__codelineno-11-76 name=__codelineno-11-76 href=#__codelineno-11-76></a><span class=c1># 获取系统磁盘信息</span>
<a id=__codelineno-11-77 name=__codelineno-11-77 href=#__codelineno-11-77></a><span class=k>function</span><span class=w> </span>get_disk_info<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-11-78 name=__codelineno-11-78 href=#__codelineno-11-78></a><span class=w>    </span><span class=nv>disk_info</span><span class=o>=</span><span class=k>$(</span>fdisk<span class=w> </span>-l<span class=p>|</span>grep<span class=w> </span><span class=s2>&quot;Disk /dev&quot;</span><span class=p>|</span>cut<span class=w> </span>-d,<span class=w> </span>-f1<span class=k>)</span>
<a id=__codelineno-11-79 name=__codelineno-11-79 href=#__codelineno-11-79></a><span class=w>    </span><span class=nv>disk_use</span><span class=o>=</span><span class=k>$(</span>df<span class=w> </span>-hTP<span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;$2!=&quot;tmpfs&quot;{print}&#39;</span><span class=k>)</span>
<a id=__codelineno-11-80 name=__codelineno-11-80 href=#__codelineno-11-80></a><span class=w>    </span><span class=nv>disk_inode</span><span class=o>=</span><span class=k>$(</span>df<span class=w> </span>-hiP<span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;$1!=&quot;tmpfs&quot;{print}&#39;</span><span class=k>)</span>
<a id=__codelineno-11-81 name=__codelineno-11-81 href=#__codelineno-11-81></a>
<a id=__codelineno-11-82 name=__codelineno-11-82 href=#__codelineno-11-82></a>cat<span class=w> </span><span class=s>&lt;&lt;EOF</span>
<a id=__codelineno-11-83 name=__codelineno-11-83 href=#__codelineno-11-83></a><span class=s>磁盘信息:</span>
<a id=__codelineno-11-84 name=__codelineno-11-84 href=#__codelineno-11-84></a>
<a id=__codelineno-11-85 name=__codelineno-11-85 href=#__codelineno-11-85></a><span class=s>${disk_info}</span>
<a id=__codelineno-11-86 name=__codelineno-11-86 href=#__codelineno-11-86></a><span class=s>磁盘使用:</span>
<a id=__codelineno-11-87 name=__codelineno-11-87 href=#__codelineno-11-87></a>
<a id=__codelineno-11-88 name=__codelineno-11-88 href=#__codelineno-11-88></a><span class=s>${disk_use}</span>
<a id=__codelineno-11-89 name=__codelineno-11-89 href=#__codelineno-11-89></a><span class=s>inode信息:</span>
<a id=__codelineno-11-90 name=__codelineno-11-90 href=#__codelineno-11-90></a>
<a id=__codelineno-11-91 name=__codelineno-11-91 href=#__codelineno-11-91></a><span class=s>${disk_inode}</span>
<a id=__codelineno-11-92 name=__codelineno-11-92 href=#__codelineno-11-92></a><span class=s>EOF</span>
<a id=__codelineno-11-93 name=__codelineno-11-93 href=#__codelineno-11-93></a>
<a id=__codelineno-11-94 name=__codelineno-11-94 href=#__codelineno-11-94></a>
<a id=__codelineno-11-95 name=__codelineno-11-95 href=#__codelineno-11-95></a><span class=o>}</span>
<a id=__codelineno-11-96 name=__codelineno-11-96 href=#__codelineno-11-96></a>
<a id=__codelineno-11-97 name=__codelineno-11-97 href=#__codelineno-11-97></a><span class=c1># 获取系统信息</span>
<a id=__codelineno-11-98 name=__codelineno-11-98 href=#__codelineno-11-98></a><span class=k>function</span><span class=w> </span>get_systatus_info<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-11-99 name=__codelineno-11-99 href=#__codelineno-11-99></a><span class=w>    </span><span class=nv>sys_os</span><span class=o>=</span><span class=k>$(</span>uname<span class=w> </span>-o<span class=k>)</span>
<a id=__codelineno-11-100 name=__codelineno-11-100 href=#__codelineno-11-100></a><span class=w>    </span><span class=nv>sys_release</span><span class=o>=</span><span class=k>$(</span>cat<span class=w> </span>/etc/redhat-release<span class=k>)</span>
<a id=__codelineno-11-101 name=__codelineno-11-101 href=#__codelineno-11-101></a><span class=w>    </span><span class=nv>sys_kernel</span><span class=o>=</span><span class=k>$(</span>uname<span class=w> </span>-r<span class=k>)</span>
<a id=__codelineno-11-102 name=__codelineno-11-102 href=#__codelineno-11-102></a><span class=w>    </span><span class=nv>sys_hostname</span><span class=o>=</span><span class=k>$(</span>hostname<span class=k>)</span>
<a id=__codelineno-11-103 name=__codelineno-11-103 href=#__codelineno-11-103></a><span class=w>    </span><span class=nv>sys_selinux</span><span class=o>=</span><span class=k>$(</span>getenforce<span class=k>)</span>
<a id=__codelineno-11-104 name=__codelineno-11-104 href=#__codelineno-11-104></a><span class=w>    </span><span class=nv>sys_lang</span><span class=o>=</span><span class=k>$(</span><span class=nb>echo</span><span class=w> </span><span class=nv>$LANG</span><span class=k>)</span>
<a id=__codelineno-11-105 name=__codelineno-11-105 href=#__codelineno-11-105></a><span class=w>    </span><span class=nv>sys_lastreboot</span><span class=o>=</span><span class=k>$(</span>who<span class=w> </span>-b<span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span><span class=s1>&#39;{print $3,$4}&#39;</span><span class=k>)</span>
<a id=__codelineno-11-106 name=__codelineno-11-106 href=#__codelineno-11-106></a><span class=w>    </span><span class=nv>sys_runtime</span><span class=o>=</span><span class=k>$(</span>uptime<span class=w> </span><span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;{print  $3,$4}&#39;</span><span class=p>|</span>cut<span class=w> </span>-d,<span class=w> </span>-f1<span class=k>)</span>
<a id=__codelineno-11-107 name=__codelineno-11-107 href=#__codelineno-11-107></a><span class=w>    </span><span class=nv>sys_time</span><span class=o>=</span><span class=k>$(</span>date<span class=k>)</span>
<a id=__codelineno-11-108 name=__codelineno-11-108 href=#__codelineno-11-108></a><span class=w>    </span><span class=nv>sys_load</span><span class=o>=</span><span class=k>$(</span>uptime<span class=w> </span><span class=p>|</span>cut<span class=w> </span>-d:<span class=w> </span>-f5<span class=k>)</span>
<a id=__codelineno-11-109 name=__codelineno-11-109 href=#__codelineno-11-109></a>
<a id=__codelineno-11-110 name=__codelineno-11-110 href=#__codelineno-11-110></a>cat<span class=w> </span><span class=s>&lt;&lt;EOF | column -t</span>
<a id=__codelineno-11-111 name=__codelineno-11-111 href=#__codelineno-11-111></a><span class=s>系统信息:</span>
<a id=__codelineno-11-112 name=__codelineno-11-112 href=#__codelineno-11-112></a>
<a id=__codelineno-11-113 name=__codelineno-11-113 href=#__codelineno-11-113></a><span class=s>系统: ${sys_os}</span>
<a id=__codelineno-11-114 name=__codelineno-11-114 href=#__codelineno-11-114></a><span class=s>发行版本:   ${sys_release}</span>
<a id=__codelineno-11-115 name=__codelineno-11-115 href=#__codelineno-11-115></a><span class=s>系统内核:   ${sys_kernel}</span>
<a id=__codelineno-11-116 name=__codelineno-11-116 href=#__codelineno-11-116></a><span class=s>主机名:    ${sys_hostname}</span>
<a id=__codelineno-11-117 name=__codelineno-11-117 href=#__codelineno-11-117></a><span class=s>selinux状态:  ${sys_selinux}</span>
<a id=__codelineno-11-118 name=__codelineno-11-118 href=#__codelineno-11-118></a><span class=s>系统语言:   ${sys_lang}</span>
<a id=__codelineno-11-119 name=__codelineno-11-119 href=#__codelineno-11-119></a><span class=s>系统当前时间: ${sys_time}</span>
<a id=__codelineno-11-120 name=__codelineno-11-120 href=#__codelineno-11-120></a><span class=s>系统最后重启时间:   ${sys_lastreboot}</span>
<a id=__codelineno-11-121 name=__codelineno-11-121 href=#__codelineno-11-121></a><span class=s>系统运行时间: ${sys_runtime}</span>
<a id=__codelineno-11-122 name=__codelineno-11-122 href=#__codelineno-11-122></a><span class=s>系统负载:   ${sys_load}</span>
<a id=__codelineno-11-123 name=__codelineno-11-123 href=#__codelineno-11-123></a><span class=s>EOF</span>
<a id=__codelineno-11-124 name=__codelineno-11-124 href=#__codelineno-11-124></a><span class=o>}</span>
<a id=__codelineno-11-125 name=__codelineno-11-125 href=#__codelineno-11-125></a>
<a id=__codelineno-11-126 name=__codelineno-11-126 href=#__codelineno-11-126></a><span class=c1># 获取服务信息</span>
<a id=__codelineno-11-127 name=__codelineno-11-127 href=#__codelineno-11-127></a><span class=k>function</span><span class=w> </span>get_service_info<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-11-128 name=__codelineno-11-128 href=#__codelineno-11-128></a><span class=w>    </span><span class=nv>port_listen</span><span class=o>=</span><span class=k>$(</span>netstat<span class=w> </span>-lntup<span class=p>|</span>grep<span class=w> </span>-v<span class=w> </span><span class=s2>&quot;Active Internet&quot;</span><span class=k>)</span>
<a id=__codelineno-11-129 name=__codelineno-11-129 href=#__codelineno-11-129></a><span class=w>    </span><span class=nv>kernel_config</span><span class=o>=</span><span class=k>$(</span>sysctl<span class=w> </span>-p<span class=w> </span><span class=m>2</span>&gt;/dev/null<span class=k>)</span>
<a id=__codelineno-11-130 name=__codelineno-11-130 href=#__codelineno-11-130></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=si>${</span><span class=nv>sysversion</span><span class=si>}</span><span class=w> </span>-gt<span class=w> </span><span class=m>6</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=k>then</span>
<a id=__codelineno-11-131 name=__codelineno-11-131 href=#__codelineno-11-131></a><span class=w>        </span><span class=nv>service_config</span><span class=o>=</span><span class=k>$(</span>systemctl<span class=w> </span>list-unit-files<span class=w> </span>--type<span class=o>=</span>service<span class=w> </span>--state<span class=o>=</span>enabled<span class=p>|</span>grep<span class=w> </span><span class=s2>&quot;enabled&quot;</span><span class=k>)</span>
<a id=__codelineno-11-132 name=__codelineno-11-132 href=#__codelineno-11-132></a><span class=w>        </span><span class=nv>run_service</span><span class=o>=</span><span class=k>$(</span>systemctl<span class=w> </span>list-units<span class=w> </span>--type<span class=o>=</span>service<span class=w> </span>--state<span class=o>=</span>running<span class=w> </span><span class=p>|</span>grep<span class=w> </span><span class=s2>&quot;.service&quot;</span><span class=k>)</span>
<a id=__codelineno-11-133 name=__codelineno-11-133 href=#__codelineno-11-133></a><span class=w>    </span><span class=k>else</span>
<a id=__codelineno-11-134 name=__codelineno-11-134 href=#__codelineno-11-134></a><span class=w>        </span><span class=nv>service_config</span><span class=o>=</span><span class=k>$(</span>/sbin/chkconfig<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>-E<span class=w> </span><span class=s2>&quot;:on|:启用&quot;</span><span class=w> </span><span class=p>|</span>column<span class=w> </span>-t<span class=k>)</span>
<a id=__codelineno-11-135 name=__codelineno-11-135 href=#__codelineno-11-135></a><span class=w>        </span><span class=nv>run_service</span><span class=o>=</span><span class=k>$(</span>/sbin/service<span class=w> </span>--status-all<span class=p>|</span>grep<span class=w> </span>-E<span class=w> </span><span class=s2>&quot;running&quot;</span><span class=k>)</span>
<a id=__codelineno-11-136 name=__codelineno-11-136 href=#__codelineno-11-136></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-11-137 name=__codelineno-11-137 href=#__codelineno-11-137></a>cat<span class=w> </span><span class=s>&lt;&lt;EOF</span>
<a id=__codelineno-11-138 name=__codelineno-11-138 href=#__codelineno-11-138></a><span class=s>服务启动配置:</span>
<a id=__codelineno-11-139 name=__codelineno-11-139 href=#__codelineno-11-139></a>
<a id=__codelineno-11-140 name=__codelineno-11-140 href=#__codelineno-11-140></a><span class=s>${service_config}</span>
<a id=__codelineno-11-141 name=__codelineno-11-141 href=#__codelineno-11-141></a><span class=s>${line}</span>
<a id=__codelineno-11-142 name=__codelineno-11-142 href=#__codelineno-11-142></a><span class=s>运行的服务:</span>
<a id=__codelineno-11-143 name=__codelineno-11-143 href=#__codelineno-11-143></a>
<a id=__codelineno-11-144 name=__codelineno-11-144 href=#__codelineno-11-144></a><span class=s>${run_service}</span>
<a id=__codelineno-11-145 name=__codelineno-11-145 href=#__codelineno-11-145></a><span class=s>${line}</span>
<a id=__codelineno-11-146 name=__codelineno-11-146 href=#__codelineno-11-146></a><span class=s>监听端口:</span>
<a id=__codelineno-11-147 name=__codelineno-11-147 href=#__codelineno-11-147></a>
<a id=__codelineno-11-148 name=__codelineno-11-148 href=#__codelineno-11-148></a><span class=s>${port_listen}</span>
<a id=__codelineno-11-149 name=__codelineno-11-149 href=#__codelineno-11-149></a><span class=s>${line}</span>
<a id=__codelineno-11-150 name=__codelineno-11-150 href=#__codelineno-11-150></a><span class=s>内核参考配置:</span>
<a id=__codelineno-11-151 name=__codelineno-11-151 href=#__codelineno-11-151></a>
<a id=__codelineno-11-152 name=__codelineno-11-152 href=#__codelineno-11-152></a><span class=s>${kernel_config}</span>
<a id=__codelineno-11-153 name=__codelineno-11-153 href=#__codelineno-11-153></a><span class=s>EOF</span>
<a id=__codelineno-11-154 name=__codelineno-11-154 href=#__codelineno-11-154></a><span class=o>}</span>
<a id=__codelineno-11-155 name=__codelineno-11-155 href=#__codelineno-11-155></a>
<a id=__codelineno-11-156 name=__codelineno-11-156 href=#__codelineno-11-156></a>
<a id=__codelineno-11-157 name=__codelineno-11-157 href=#__codelineno-11-157></a><span class=k>function</span><span class=w> </span>get_sys_user<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-11-158 name=__codelineno-11-158 href=#__codelineno-11-158></a><span class=w>    </span><span class=nv>login_user</span><span class=o>=</span><span class=k>$(</span>awk<span class=w> </span>-F:<span class=w> </span><span class=s1>&#39;{if ($NF==&quot;/bin/bash&quot;) print $0}&#39;</span><span class=w> </span>/etc/passwd<span class=k>)</span>
<a id=__codelineno-11-159 name=__codelineno-11-159 href=#__codelineno-11-159></a><span class=w>    </span><span class=nv>ssh_config</span><span class=o>=</span><span class=k>$(</span>egrep<span class=w> </span>-v<span class=w> </span><span class=s2>&quot;^#|^</span>$<span class=s2>&quot;</span><span class=w> </span>/etc/ssh/sshd_config<span class=k>)</span>
<a id=__codelineno-11-160 name=__codelineno-11-160 href=#__codelineno-11-160></a><span class=w>    </span><span class=nv>sudo_config</span><span class=o>=</span><span class=k>$(</span>egrep<span class=w> </span>-v<span class=w> </span><span class=s2>&quot;^#|^</span>$<span class=s2>&quot;</span><span class=w> </span>/etc/sudoers<span class=w> </span><span class=p>|</span>grep<span class=w> </span>-v<span class=w> </span><span class=s2>&quot;^Defaults&quot;</span><span class=k>)</span>
<a id=__codelineno-11-161 name=__codelineno-11-161 href=#__codelineno-11-161></a><span class=w>    </span><span class=nv>host_config</span><span class=o>=</span><span class=k>$(</span>egrep<span class=w> </span>-v<span class=w> </span><span class=s2>&quot;^#|^</span>$<span class=s2>&quot;</span><span class=w> </span>/etc/hosts<span class=k>)</span>
<a id=__codelineno-11-162 name=__codelineno-11-162 href=#__codelineno-11-162></a><span class=w>    </span><span class=nv>crond_config</span><span class=o>=</span><span class=k>$(for</span><span class=w> </span>cronuser<span class=w> </span><span class=k>in</span><span class=w> </span>/var/spool/cron/*<span class=w> </span><span class=p>;</span><span class=k>do</span><span class=w> </span>ls<span class=w> </span><span class=si>${</span><span class=nv>cronuser</span><span class=si>}</span><span class=w> </span><span class=m>2</span>&gt;/dev/null<span class=p>|</span>cut<span class=w> </span>-d/<span class=w> </span>-f5<span class=p>;</span>egrep<span class=w> </span>-v<span class=w> </span><span class=s2>&quot;^</span>$<span class=s2>|^#&quot;</span><span class=w> </span><span class=si>${</span><span class=nv>cronuser</span><span class=si>}</span><span class=w> </span><span class=m>2</span>&gt;/dev/null<span class=p>;</span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;&quot;</span><span class=p>;</span><span class=k>done)</span>
<a id=__codelineno-11-163 name=__codelineno-11-163 href=#__codelineno-11-163></a>cat<span class=w> </span><span class=s>&lt;&lt;EOF</span>
<a id=__codelineno-11-164 name=__codelineno-11-164 href=#__codelineno-11-164></a><span class=s>系统登录用户:</span>
<a id=__codelineno-11-165 name=__codelineno-11-165 href=#__codelineno-11-165></a>
<a id=__codelineno-11-166 name=__codelineno-11-166 href=#__codelineno-11-166></a><span class=s>${login_user}</span>
<a id=__codelineno-11-167 name=__codelineno-11-167 href=#__codelineno-11-167></a><span class=s>${line}</span>
<a id=__codelineno-11-168 name=__codelineno-11-168 href=#__codelineno-11-168></a><span class=s>ssh 配置信息:</span>
<a id=__codelineno-11-169 name=__codelineno-11-169 href=#__codelineno-11-169></a>
<a id=__codelineno-11-170 name=__codelineno-11-170 href=#__codelineno-11-170></a><span class=s>${ssh_config}</span>
<a id=__codelineno-11-171 name=__codelineno-11-171 href=#__codelineno-11-171></a><span class=s>${line}</span>
<a id=__codelineno-11-172 name=__codelineno-11-172 href=#__codelineno-11-172></a><span class=s>sudo 配置用户:</span>
<a id=__codelineno-11-173 name=__codelineno-11-173 href=#__codelineno-11-173></a>
<a id=__codelineno-11-174 name=__codelineno-11-174 href=#__codelineno-11-174></a><span class=s>${sudo_config}</span>
<a id=__codelineno-11-175 name=__codelineno-11-175 href=#__codelineno-11-175></a><span class=s>${line}</span>
<a id=__codelineno-11-176 name=__codelineno-11-176 href=#__codelineno-11-176></a><span class=s>定时任务配置:</span>
<a id=__codelineno-11-177 name=__codelineno-11-177 href=#__codelineno-11-177></a>
<a id=__codelineno-11-178 name=__codelineno-11-178 href=#__codelineno-11-178></a><span class=s>${crond_config}</span>
<a id=__codelineno-11-179 name=__codelineno-11-179 href=#__codelineno-11-179></a><span class=s>${line}</span>
<a id=__codelineno-11-180 name=__codelineno-11-180 href=#__codelineno-11-180></a><span class=s>hosts 信息:</span>
<a id=__codelineno-11-181 name=__codelineno-11-181 href=#__codelineno-11-181></a>
<a id=__codelineno-11-182 name=__codelineno-11-182 href=#__codelineno-11-182></a><span class=s>${host_config}</span>
<a id=__codelineno-11-183 name=__codelineno-11-183 href=#__codelineno-11-183></a><span class=s>EOF</span>
<a id=__codelineno-11-184 name=__codelineno-11-184 href=#__codelineno-11-184></a><span class=o>}</span>
<a id=__codelineno-11-185 name=__codelineno-11-185 href=#__codelineno-11-185></a>
<a id=__codelineno-11-186 name=__codelineno-11-186 href=#__codelineno-11-186></a>
<a id=__codelineno-11-187 name=__codelineno-11-187 href=#__codelineno-11-187></a><span class=k>function</span><span class=w> </span>process_top_info<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-11-188 name=__codelineno-11-188 href=#__codelineno-11-188></a>
<a id=__codelineno-11-189 name=__codelineno-11-189 href=#__codelineno-11-189></a><span class=w>    </span><span class=nv>top_title</span><span class=o>=</span><span class=k>$(</span>top<span class=w> </span>-b<span class=w> </span>n1<span class=p>|</span>head<span class=w> </span>-7<span class=p>|</span>tail<span class=w> </span>-1<span class=k>)</span>
<a id=__codelineno-11-190 name=__codelineno-11-190 href=#__codelineno-11-190></a><span class=w>    </span><span class=nv>cpu_top10</span><span class=o>=</span><span class=k>$(</span>top<span class=w> </span>b<span class=w> </span>-n1<span class=w> </span><span class=p>|</span><span class=w> </span>head<span class=w> </span>-17<span class=w> </span><span class=p>|</span><span class=w> </span>tail<span class=w> </span>-10<span class=k>)</span>
<a id=__codelineno-11-191 name=__codelineno-11-191 href=#__codelineno-11-191></a><span class=w>    </span><span class=nv>mem_top10</span><span class=o>=</span><span class=k>$(</span>top<span class=w> </span>-b<span class=w> </span>n1<span class=p>|</span>head<span class=w> </span>-17<span class=p>|</span>tail<span class=w> </span>-10<span class=p>|</span>sort<span class=w> </span>-k10<span class=w> </span>-r<span class=k>)</span>
<a id=__codelineno-11-192 name=__codelineno-11-192 href=#__codelineno-11-192></a>
<a id=__codelineno-11-193 name=__codelineno-11-193 href=#__codelineno-11-193></a>cat<span class=w> </span><span class=s>&lt;&lt;EOF</span>
<a id=__codelineno-11-194 name=__codelineno-11-194 href=#__codelineno-11-194></a><span class=s>CPU占用top10:</span>
<a id=__codelineno-11-195 name=__codelineno-11-195 href=#__codelineno-11-195></a>
<a id=__codelineno-11-196 name=__codelineno-11-196 href=#__codelineno-11-196></a><span class=s>${top_title}</span>
<a id=__codelineno-11-197 name=__codelineno-11-197 href=#__codelineno-11-197></a><span class=s>${cpu_top10}</span>
<a id=__codelineno-11-198 name=__codelineno-11-198 href=#__codelineno-11-198></a>
<a id=__codelineno-11-199 name=__codelineno-11-199 href=#__codelineno-11-199></a><span class=s>内存占用top10:</span>
<a id=__codelineno-11-200 name=__codelineno-11-200 href=#__codelineno-11-200></a>
<a id=__codelineno-11-201 name=__codelineno-11-201 href=#__codelineno-11-201></a><span class=s>${top_title}</span>
<a id=__codelineno-11-202 name=__codelineno-11-202 href=#__codelineno-11-202></a><span class=s>${mem_top10}</span>
<a id=__codelineno-11-203 name=__codelineno-11-203 href=#__codelineno-11-203></a><span class=s>EOF</span>
<a id=__codelineno-11-204 name=__codelineno-11-204 href=#__codelineno-11-204></a><span class=o>}</span>
<a id=__codelineno-11-205 name=__codelineno-11-205 href=#__codelineno-11-205></a>
<a id=__codelineno-11-206 name=__codelineno-11-206 href=#__codelineno-11-206></a>
<a id=__codelineno-11-207 name=__codelineno-11-207 href=#__codelineno-11-207></a><span class=k>function</span><span class=w> </span>sys_check<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-11-208 name=__codelineno-11-208 href=#__codelineno-11-208></a><span class=w>    </span>get_cpu_info
<a id=__codelineno-11-209 name=__codelineno-11-209 href=#__codelineno-11-209></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=si>${</span><span class=nv>line</span><span class=si>}</span>
<a id=__codelineno-11-210 name=__codelineno-11-210 href=#__codelineno-11-210></a><span class=w>    </span>get_mem_info
<a id=__codelineno-11-211 name=__codelineno-11-211 href=#__codelineno-11-211></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=si>${</span><span class=nv>line</span><span class=si>}</span>
<a id=__codelineno-11-212 name=__codelineno-11-212 href=#__codelineno-11-212></a><span class=w>    </span>get_net_info
<a id=__codelineno-11-213 name=__codelineno-11-213 href=#__codelineno-11-213></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=si>${</span><span class=nv>line</span><span class=si>}</span>
<a id=__codelineno-11-214 name=__codelineno-11-214 href=#__codelineno-11-214></a><span class=w>    </span>get_disk_info
<a id=__codelineno-11-215 name=__codelineno-11-215 href=#__codelineno-11-215></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=si>${</span><span class=nv>line</span><span class=si>}</span>
<a id=__codelineno-11-216 name=__codelineno-11-216 href=#__codelineno-11-216></a><span class=w>    </span>get_systatus_info
<a id=__codelineno-11-217 name=__codelineno-11-217 href=#__codelineno-11-217></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=si>${</span><span class=nv>line</span><span class=si>}</span>
<a id=__codelineno-11-218 name=__codelineno-11-218 href=#__codelineno-11-218></a><span class=w>    </span>get_service_info
<a id=__codelineno-11-219 name=__codelineno-11-219 href=#__codelineno-11-219></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=si>${</span><span class=nv>line</span><span class=si>}</span>
<a id=__codelineno-11-220 name=__codelineno-11-220 href=#__codelineno-11-220></a><span class=w>    </span>get_sys_user
<a id=__codelineno-11-221 name=__codelineno-11-221 href=#__codelineno-11-221></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=si>${</span><span class=nv>line</span><span class=si>}</span>
<a id=__codelineno-11-222 name=__codelineno-11-222 href=#__codelineno-11-222></a><span class=w>    </span>process_top_info
<a id=__codelineno-11-223 name=__codelineno-11-223 href=#__codelineno-11-223></a><span class=o>}</span>
<a id=__codelineno-11-224 name=__codelineno-11-224 href=#__codelineno-11-224></a>
<a id=__codelineno-11-225 name=__codelineno-11-225 href=#__codelineno-11-225></a>
<a id=__codelineno-11-226 name=__codelineno-11-226 href=#__codelineno-11-226></a>sys_check<span class=w> </span>&gt;<span class=w> </span><span class=si>${</span><span class=nv>sys_check_file</span><span class=si>}</span>
</code></pre></div> <h2 id=8启动脚本示例>8.启动脚本示例<a class=headerlink href=#8启动脚本示例 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=ch>#!/usr/bin/env bash</span>
<a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a><span class=c1>#?$Id:?gmond.init?180?2003-03-07?20:38:36Z?sacerdoti $</span>
<a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a><span class=c1># chkconfig:?2345?70?40</span>
<a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a><span class=c1># description:?gmond?startup?script</span>
<a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a>
<a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a><span class=c1>#定义变量GMOND，指定gmond守护进程路径</span>
<a id=__codelineno-12-7 name=__codelineno-12-7 href=#__codelineno-12-7></a><span class=nv>GMOND</span><span class=o>=</span>/usr/sbin/gmond
<a id=__codelineno-12-8 name=__codelineno-12-8 href=#__codelineno-12-8></a>
<a id=__codelineno-12-9 name=__codelineno-12-9 href=#__codelineno-12-9></a><span class=c1>#读取并执行文件 /etc/rc.d/init.d/functions的内容</span>
<a id=__codelineno-12-10 name=__codelineno-12-10 href=#__codelineno-12-10></a>.<span class=w> </span>/etc/rc.d/init.d/functions
<a id=__codelineno-12-11 name=__codelineno-12-11 href=#__codelineno-12-11></a>
<a id=__codelineno-12-12 name=__codelineno-12-12 href=#__codelineno-12-12></a><span class=c1>#定义变量RETVAL</span>
<a id=__codelineno-12-13 name=__codelineno-12-13 href=#__codelineno-12-13></a><span class=nv>RETVAL</span><span class=o>=</span><span class=m>0</span>
<a id=__codelineno-12-14 name=__codelineno-12-14 href=#__codelineno-12-14></a>
<a id=__codelineno-12-15 name=__codelineno-12-15 href=#__codelineno-12-15></a><span class=c1>#使用case语句来根据指定的不同参数，执行不同的行为</span>
<a id=__codelineno-12-16 name=__codelineno-12-16 href=#__codelineno-12-16></a><span class=k>case</span><span class=w> </span><span class=nv>$1</span><span class=w> </span><span class=k>in</span>
<a id=__codelineno-12-17 name=__codelineno-12-17 href=#__codelineno-12-17></a><span class=w>    </span>start<span class=o>)</span>
<a id=__codelineno-12-18 name=__codelineno-12-18 href=#__codelineno-12-18></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;Starting GANGLIA gmond: &quot;</span>
<a id=__codelineno-12-19 name=__codelineno-12-19 href=#__codelineno-12-19></a><span class=w>    </span><span class=c1>#如果gmond守护进程不存在，则退出脚本的执行，退出状态码为1</span>
<a id=__codelineno-12-20 name=__codelineno-12-20 href=#__codelineno-12-20></a><span class=w>    </span><span class=o>[</span><span class=w> </span>-f<span class=w> </span><span class=nv>$GMOND</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=nb>exit</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-12-21 name=__codelineno-12-21 href=#__codelineno-12-21></a><span class=w>    </span><span class=c1>#将gmond守护进程放在后台运行，daemon是function中的函数</span>
<a id=__codelineno-12-22 name=__codelineno-12-22 href=#__codelineno-12-22></a><span class=w>    </span>daemon<span class=w> </span><span class=nv>$GMOND</span>
<a id=__codelineno-12-23 name=__codelineno-12-23 href=#__codelineno-12-23></a><span class=w>    </span><span class=c1>#将上一命令的退出状态码赋值给变量RETVAL</span>
<a id=__codelineno-12-24 name=__codelineno-12-24 href=#__codelineno-12-24></a><span class=w>    </span><span class=nv>RETVAL</span><span class=o>=</span><span class=nv>$?</span>
<a id=__codelineno-12-25 name=__codelineno-12-25 href=#__codelineno-12-25></a><span class=w>    </span><span class=nb>echo</span>
<a id=__codelineno-12-26 name=__codelineno-12-26 href=#__codelineno-12-26></a><span class=w>    </span><span class=c1>##若gmond守护进程成功运行，则创建一个lock文件/var/lock/subsys/gmond</span>
<a id=__codelineno-12-27 name=__codelineno-12-27 href=#__codelineno-12-27></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=nv>$RETVAL</span><span class=w> </span>-eq<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>touch<span class=w> </span>/var/lock/subsys/gmond
<a id=__codelineno-12-28 name=__codelineno-12-28 href=#__codelineno-12-28></a><span class=w>   </span><span class=p>;;</span>
<a id=__codelineno-12-29 name=__codelineno-12-29 href=#__codelineno-12-29></a><span class=w>    </span>stop<span class=o>)</span>
<a id=__codelineno-12-30 name=__codelineno-12-30 href=#__codelineno-12-30></a><span class=w>        </span><span class=c1>#显示停止ganglia gmond的信息</span>
<a id=__codelineno-12-31 name=__codelineno-12-31 href=#__codelineno-12-31></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;Shutting down GANGLIA gmond: &quot;</span>
<a id=__codelineno-12-32 name=__codelineno-12-32 href=#__codelineno-12-32></a><span class=w>        </span><span class=c1>#停止gmond守护进程，killproc是functions中定义的函数</span>
<a id=__codelineno-12-33 name=__codelineno-12-33 href=#__codelineno-12-33></a><span class=w>        </span>killproc<span class=w> </span>gmond
<a id=__codelineno-12-34 name=__codelineno-12-34 href=#__codelineno-12-34></a><span class=w>        </span><span class=c1>#将上一命令的退出状态码赋值给变量RETVAL</span>
<a id=__codelineno-12-35 name=__codelineno-12-35 href=#__codelineno-12-35></a><span class=w>        </span><span class=nv>RETVAL</span><span class=o>=</span><span class=nv>$?</span>
<a id=__codelineno-12-36 name=__codelineno-12-36 href=#__codelineno-12-36></a><span class=w>        </span><span class=nb>echo</span>
<a id=__codelineno-12-37 name=__codelineno-12-37 href=#__codelineno-12-37></a><span class=w>        </span><span class=c1>#若gmond守护进程成功停止，则删除lock文件 /var/lock/subsys/gmond</span>
<a id=__codelineno-12-38 name=__codelineno-12-38 href=#__codelineno-12-38></a><span class=w>        </span><span class=o>[</span><span class=w> </span><span class=nv>$RETVAL</span><span class=w> </span>-eq<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>rm<span class=w> </span>-rf<span class=w> </span>/var/lock/subsys/gmond
<a id=__codelineno-12-39 name=__codelineno-12-39 href=#__codelineno-12-39></a><span class=w>   </span><span class=p>;;</span>
<a id=__codelineno-12-40 name=__codelineno-12-40 href=#__codelineno-12-40></a><span class=w>    </span>restart<span class=p>|</span>reload<span class=o>)</span>
<a id=__codelineno-12-41 name=__codelineno-12-41 href=#__codelineno-12-41></a><span class=w>        </span><span class=c1>#重新调用此脚本，命令行参数为stop</span>
<a id=__codelineno-12-42 name=__codelineno-12-42 href=#__codelineno-12-42></a><span class=w>        </span><span class=nv>$0</span><span class=w> </span>stop
<a id=__codelineno-12-43 name=__codelineno-12-43 href=#__codelineno-12-43></a><span class=w>        </span><span class=c1>#重新调用此脚本，命令行参数为start</span>
<a id=__codelineno-12-44 name=__codelineno-12-44 href=#__codelineno-12-44></a><span class=w>        </span><span class=nv>$0</span><span class=w> </span>start
<a id=__codelineno-12-45 name=__codelineno-12-45 href=#__codelineno-12-45></a><span class=w>        </span><span class=nv>RETVAL</span><span class=o>=</span><span class=nv>$?</span>
<a id=__codelineno-12-46 name=__codelineno-12-46 href=#__codelineno-12-46></a><span class=w>   </span><span class=p>;;</span>
<a id=__codelineno-12-47 name=__codelineno-12-47 href=#__codelineno-12-47></a><span class=w>    </span>status<span class=o>)</span>
<a id=__codelineno-12-48 name=__codelineno-12-48 href=#__codelineno-12-48></a><span class=w>        </span><span class=c1>#显示gmond守护进程的运行状态，其中status是functions 定义的函数</span>
<a id=__codelineno-12-49 name=__codelineno-12-49 href=#__codelineno-12-49></a><span class=w>        </span>status<span class=w> </span>gmond
<a id=__codelineno-12-50 name=__codelineno-12-50 href=#__codelineno-12-50></a><span class=w>        </span><span class=nv>RETVAL</span><span class=o>=</span><span class=nv>$?</span>
<a id=__codelineno-12-51 name=__codelineno-12-51 href=#__codelineno-12-51></a><span class=w>   </span><span class=p>;;</span>
<a id=__codelineno-12-52 name=__codelineno-12-52 href=#__codelineno-12-52></a><span class=w>    </span>*<span class=o>)</span>
<a id=__codelineno-12-53 name=__codelineno-12-53 href=#__codelineno-12-53></a><span class=w>        </span><span class=c1>#显示脚本的使用方法信息到标准输出</span>
<a id=__codelineno-12-54 name=__codelineno-12-54 href=#__codelineno-12-54></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Usage: </span><span class=nv>$0</span><span class=s2> {start|stop|restart|status}&quot;</span>
<a id=__codelineno-12-55 name=__codelineno-12-55 href=#__codelineno-12-55></a><span class=w>        </span><span class=c1>#退出脚本的运行，退出状态码为1</span>
<a id=__codelineno-12-56 name=__codelineno-12-56 href=#__codelineno-12-56></a><span class=w>        </span><span class=nb>exit</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-12-57 name=__codelineno-12-57 href=#__codelineno-12-57></a><span class=w>   </span><span class=p>;;</span>
<a id=__codelineno-12-58 name=__codelineno-12-58 href=#__codelineno-12-58></a><span class=k>esac</span>
<a id=__codelineno-12-59 name=__codelineno-12-59 href=#__codelineno-12-59></a>
<a id=__codelineno-12-60 name=__codelineno-12-60 href=#__codelineno-12-60></a><span class=c1>#退出脚本的运行，退出状态码为变量RETVAL的值</span>
<a id=__codelineno-12-61 name=__codelineno-12-61 href=#__codelineno-12-61></a><span class=nb>exit</span><span class=w> </span><span class=nv>$RETVAL</span>
</code></pre></div> <h2 id=9备份24小时被修改的文件>9.备份24小时被修改的文件<a class=headerlink href=#9备份24小时被修改的文件 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=ch>#!/usr/bin/env bash</span>
<a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a>
<a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a><span class=c1>#备份当前目录下所有前24小时被修改的文件为一个归档压缩包</span>
<a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a><span class=nv>BACKUPFILE</span><span class=o>=</span>back-<span class=k>$(</span>date<span class=w> </span>+%m-%d-%Y<span class=k>)</span><span class=w>   </span><span class=c1>#备份文件中嵌入日期</span>
<a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a><span class=nv>archive</span><span class=o>=</span><span class=si>${</span><span class=nv>1</span><span class=k>:-</span><span class=nv>$BACKUPFILE</span><span class=si>}</span><span class=w>   </span><span class=c1>#如果没有在命令行上指定备份的归档文件名，默认以&quot;back-xxxx作为默认的文件名&quot;</span>
<a id=__codelineno-13-6 name=__codelineno-13-6 href=#__codelineno-13-6></a>
<a id=__codelineno-13-7 name=__codelineno-13-7 href=#__codelineno-13-7></a>tar<span class=w> </span>cvf<span class=w> </span>-<span class=w> </span><span class=k>$(</span>find<span class=w> </span>.<span class=w> </span>-mtime<span class=w> </span>-1<span class=w> </span>-type<span class=w> </span>f<span class=w> </span>-print<span class=k>)</span><span class=w> </span>&gt;<span class=si>${</span><span class=nv>archive</span><span class=si>}</span>.tar
<a id=__codelineno-13-8 name=__codelineno-13-8 href=#__codelineno-13-8></a>gzip<span class=w> </span><span class=si>${</span><span class=nv>archive</span><span class=si>}</span>.tar
<a id=__codelineno-13-9 name=__codelineno-13-9 href=#__codelineno-13-9></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Directory </span><span class=nv>$PWD</span><span class=s2> backed up in archive file \&quot;</span><span class=nv>$archive</span><span class=s2>.tar.gz\&quot;.&quot;</span>
<a id=__codelineno-13-10 name=__codelineno-13-10 href=#__codelineno-13-10></a>
<a id=__codelineno-13-11 name=__codelineno-13-11 href=#__codelineno-13-11></a><span class=c1>#建议使用xagrs或者-exec</span>
<a id=__codelineno-13-12 name=__codelineno-13-12 href=#__codelineno-13-12></a>find<span class=w> </span>.<span class=w> </span>-mtime<span class=w> </span>-1<span class=w> </span>-type<span class=w> </span>f<span class=w> </span>-print0<span class=w> </span><span class=p>|</span><span class=w> </span>xargs<span class=w> </span>-0<span class=w> </span>tar<span class=w> </span>rvf<span class=w> </span><span class=s2>&quot;</span><span class=nv>$archive</span><span class=s2>.tar&quot;</span>
<a id=__codelineno-13-13 name=__codelineno-13-13 href=#__codelineno-13-13></a>find<span class=w> </span>.<span class=w> </span>-mitime<span class=w> </span>-1<span class=w> </span>-type<span class=w> </span>f<span class=w> </span>-exec<span class=w> </span>tar<span class=w> </span>rvf<span class=w> </span><span class=s2>&quot;</span><span class=nv>$archive</span><span class=s2>.tar&quot;</span><span class=w> </span><span class=s1>&#39;{}&#39;</span><span class=w> </span><span class=se>\ </span><span class=p>;</span>
</code></pre></div> <h2 id=10卸载相关的rpm包>10.卸载相关的rpm包<a class=headerlink href=#10卸载相关的rpm包 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=ch>#!/usr/bin/env bash</span>
<a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a><span class=nv>File_1</span><span class=o>=</span>unstall.txt
<a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a>rpm<span class=w> </span>-qa<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>ssh<span class=w> </span>&gt;<span class=w> </span><span class=nv>$File_1</span>
<a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a>
<a id=__codelineno-14-5 name=__codelineno-14-5 href=#__codelineno-14-5></a><span class=k>while</span><span class=w> </span><span class=nb>read</span><span class=w> </span>-r<span class=w> </span>line
<a id=__codelineno-14-6 name=__codelineno-14-6 href=#__codelineno-14-6></a><span class=k>do</span>
<a id=__codelineno-14-7 name=__codelineno-14-7 href=#__codelineno-14-7></a><span class=w>    </span>rpm<span class=w> </span>-e<span class=w> </span><span class=nv>$line</span>
<a id=__codelineno-14-8 name=__codelineno-14-8 href=#__codelineno-14-8></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=nv>$?</span><span class=w> </span>-eq<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;unstall is successful!!&quot;</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=nb>exit</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-14-9 name=__codelineno-14-9 href=#__codelineno-14-9></a><span class=k>done</span><span class=w> </span>&lt;<span class=w> </span><span class=nv>$File_1</span>
</code></pre></div> <h2 id=11检查rpm包的方法>11.检查rpm包的方法<a class=headerlink href=#11检查rpm包的方法 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a><span class=ch>#!/usr/bin/env bash</span>
<a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a><span class=k>if</span><span class=w> </span>rpm<span class=w> </span>-qa<span class=w> </span>sysstat<span class=w> </span><span class=p>&amp;</span>&gt;<span class=w> </span>/dev/null<span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;sysstat is already  install&quot;</span>
<a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a><span class=k>else</span>
<a id=__codelineno-15-5 name=__codelineno-15-5 href=#__codelineno-15-5></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;sysstat is not  install&quot;</span>
<a id=__codelineno-15-6 name=__codelineno-15-6 href=#__codelineno-15-6></a><span class=k>fi</span>
</code></pre></div> <h2 id=12检查软件状态>12.检查软件状态<a class=headerlink href=#12检查软件状态 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a><span class=ch>#!/usr/bin/env bash</span>
<a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a><span class=nv>PORT_C</span><span class=o>=</span><span class=k>$(</span>ss<span class=w> </span>-anu<span class=p>|</span><span class=w> </span>grep<span class=w> </span>-c<span class=w> </span><span class=m>123</span><span class=k>)</span>
<a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a><span class=nv>PS_C</span><span class=o>=</span><span class=k>$(</span>ps<span class=w> </span>-aux<span class=p>|</span><span class=w> </span>grep<span class=w> </span>ntp<span class=p>|</span><span class=w> </span>grep<span class=w> </span>-vc<span class=w> </span>grep<span class=k>)</span>
<a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=nv>$PORT_C</span><span class=w> </span>-eq<span class=w> </span><span class=m>0</span><span class=w> </span>-o<span class=w> </span><span class=nv>$PS_C</span><span class=w> </span>-eq<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-16-5 name=__codelineno-16-5 href=#__codelineno-16-5></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Server is fail,restart !!&quot;</span>
<a id=__codelineno-16-6 name=__codelineno-16-6 href=#__codelineno-16-6></a><span class=w>    </span>:
<a id=__codelineno-16-7 name=__codelineno-16-7 href=#__codelineno-16-7></a><span class=k>fi</span>
</code></pre></div> <h2 id=13color输出>13.color输出<a class=headerlink href=#13color输出 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a>!/usr/bin/env<span class=w> </span>bash
<a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a><span class=c1>#方法1</span>
<a id=__codelineno-17-3 name=__codelineno-17-3 href=#__codelineno-17-3></a>color_printf1<span class=o>(){</span>
<a id=__codelineno-17-4 name=__codelineno-17-4 href=#__codelineno-17-4></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[[</span><span class=w> </span><span class=nv>$1</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s2>&quot;red&quot;</span><span class=w> </span><span class=o>]]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-17-5 name=__codelineno-17-5 href=#__codelineno-17-5></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;\033[32;40m</span><span class=nv>$2</span><span class=s2>\033[0m&quot;</span>
<a id=__codelineno-17-6 name=__codelineno-17-6 href=#__codelineno-17-6></a><span class=w>    </span><span class=k>elif</span><span class=w> </span><span class=o>[[</span><span class=w> </span><span class=nv>$1</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s2>&quot;green&quot;</span><span class=w> </span><span class=o>]]</span><span class=p>;</span><span class=k>then</span>
<a id=__codelineno-17-7 name=__codelineno-17-7 href=#__codelineno-17-7></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;\033[31;40m</span><span class=nv>$2</span><span class=s2>\033[0m&quot;</span>
<a id=__codelineno-17-8 name=__codelineno-17-8 href=#__codelineno-17-8></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-17-9 name=__codelineno-17-9 href=#__codelineno-17-9></a><span class=o>}</span>
<a id=__codelineno-17-10 name=__codelineno-17-10 href=#__codelineno-17-10></a>
<a id=__codelineno-17-11 name=__codelineno-17-11 href=#__codelineno-17-11></a><span class=c1>#方法2</span>
<a id=__codelineno-17-12 name=__codelineno-17-12 href=#__codelineno-17-12></a>color_printf2<span class=o>(){</span>
<a id=__codelineno-17-13 name=__codelineno-17-13 href=#__codelineno-17-13></a><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=k>in</span>
<a id=__codelineno-17-14 name=__codelineno-17-14 href=#__codelineno-17-14></a><span class=w>    </span><span class=s2>&quot;red&quot;</span><span class=o>)</span>
<a id=__codelineno-17-15 name=__codelineno-17-15 href=#__codelineno-17-15></a><span class=w>       </span><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;\033[32;40m</span><span class=nv>$2</span><span class=s2>\033[0m&quot;</span>
<a id=__codelineno-17-16 name=__codelineno-17-16 href=#__codelineno-17-16></a><span class=w>       </span><span class=p>;;</span>
<a id=__codelineno-17-17 name=__codelineno-17-17 href=#__codelineno-17-17></a><span class=w>    </span><span class=s2>&quot;green&quot;</span><span class=o>)</span>
<a id=__codelineno-17-18 name=__codelineno-17-18 href=#__codelineno-17-18></a><span class=w>       </span><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;\033[31;40m</span><span class=nv>$2</span><span class=s2>\033[0m&quot;</span>
<a id=__codelineno-17-19 name=__codelineno-17-19 href=#__codelineno-17-19></a><span class=w>       </span><span class=p>;;</span>
<a id=__codelineno-17-20 name=__codelineno-17-20 href=#__codelineno-17-20></a><span class=w>    </span>*<span class=o>)</span>
<a id=__codelineno-17-21 name=__codelineno-17-21 href=#__codelineno-17-21></a><span class=w>       </span><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;Example: color_printf2 red xxxxxx&quot;</span>
<a id=__codelineno-17-22 name=__codelineno-17-22 href=#__codelineno-17-22></a><span class=w>       </span><span class=p>;;</span>
<a id=__codelineno-17-23 name=__codelineno-17-23 href=#__codelineno-17-23></a><span class=w>    </span><span class=k>esac</span>
<a id=__codelineno-17-24 name=__codelineno-17-24 href=#__codelineno-17-24></a>
<a id=__codelineno-17-25 name=__codelineno-17-25 href=#__codelineno-17-25></a><span class=o>}</span>
<a id=__codelineno-17-26 name=__codelineno-17-26 href=#__codelineno-17-26></a>
<a id=__codelineno-17-27 name=__codelineno-17-27 href=#__codelineno-17-27></a><span class=k>function</span><span class=w> </span>echo_r<span class=w> </span><span class=o>(){</span>
<a id=__codelineno-17-28 name=__codelineno-17-28 href=#__codelineno-17-28></a><span class=w>    </span><span class=c1># Color red: Error, Failed</span>
<a id=__codelineno-17-29 name=__codelineno-17-29 href=#__codelineno-17-29></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=nv>$#</span><span class=w> </span>-ne<span class=w> </span><span class=m>1</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-17-30 name=__codelineno-17-30 href=#__codelineno-17-30></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;\033[31m</span><span class=nv>$1</span><span class=s2>\033[0m&quot;</span>
<a id=__codelineno-17-31 name=__codelineno-17-31 href=#__codelineno-17-31></a><span class=o>}</span>
<a id=__codelineno-17-32 name=__codelineno-17-32 href=#__codelineno-17-32></a>
<a id=__codelineno-17-33 name=__codelineno-17-33 href=#__codelineno-17-33></a><span class=k>function</span><span class=w> </span>echo_g<span class=w> </span><span class=o>(){</span>
<a id=__codelineno-17-34 name=__codelineno-17-34 href=#__codelineno-17-34></a><span class=w>    </span><span class=c1># Color green: Success</span>
<a id=__codelineno-17-35 name=__codelineno-17-35 href=#__codelineno-17-35></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=nv>$#</span><span class=w> </span>-ne<span class=w> </span><span class=m>1</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-17-36 name=__codelineno-17-36 href=#__codelineno-17-36></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;\033[32m</span><span class=nv>$1</span><span class=s2>\033[0m&quot;</span>
<a id=__codelineno-17-37 name=__codelineno-17-37 href=#__codelineno-17-37></a><span class=o>}</span>
</code></pre></div> <h2 id=14nginx日志切割>14.Nginx日志切割<a class=headerlink href=#14nginx日志切割 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a><span class=ch>#!/usr/bin/env bash</span>
<a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a><span class=c1>#usage:xxx</span>
<a id=__codelineno-18-3 name=__codelineno-18-3 href=#__codelineno-18-3></a><span class=c1>#scripts_name:xxx.sh</span>
<a id=__codelineno-18-4 name=__codelineno-18-4 href=#__codelineno-18-4></a><span class=c1># author：xiaojian</span>
<a id=__codelineno-18-5 name=__codelineno-18-5 href=#__codelineno-18-5></a>
<a id=__codelineno-18-6 name=__codelineno-18-6 href=#__codelineno-18-6></a><span class=nv>S_LOG</span><span class=o>=</span>/usr/local/nginx/logs/access.log
<a id=__codelineno-18-7 name=__codelineno-18-7 href=#__codelineno-18-7></a><span class=nv>D_LOG</span><span class=o>=</span>/data/backup/<span class=sb>`</span>date<span class=w> </span>+%Y-%m-%d<span class=sb>`</span>
<a id=__codelineno-18-8 name=__codelineno-18-8 href=#__codelineno-18-8></a><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;\033[32mPlease wait start cut shell scripts ....\033[0m&quot;</span>
<a id=__codelineno-18-9 name=__codelineno-18-9 href=#__codelineno-18-9></a>sleep<span class=w> </span><span class=m>2</span>
<a id=__codelineno-18-10 name=__codelineno-18-10 href=#__codelineno-18-10></a>
<a id=__codelineno-18-11 name=__codelineno-18-11 href=#__codelineno-18-11></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>!<span class=w> </span>-d<span class=w> </span><span class=nv>$D_LOG</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-18-12 name=__codelineno-18-12 href=#__codelineno-18-12></a><span class=w>    </span>mkdir<span class=w> </span>-p<span class=w> </span><span class=nv>$D_LOG</span>
<a id=__codelineno-18-13 name=__codelineno-18-13 href=#__codelineno-18-13></a><span class=k>fi</span>
<a id=__codelineno-18-14 name=__codelineno-18-14 href=#__codelineno-18-14></a>
<a id=__codelineno-18-15 name=__codelineno-18-15 href=#__codelineno-18-15></a>mv<span class=w> </span><span class=nv>$S_LOG</span><span class=w> </span><span class=nv>$D_LOG</span>
<a id=__codelineno-18-16 name=__codelineno-18-16 href=#__codelineno-18-16></a><span class=nb>kill</span><span class=w> </span>-USR1<span class=w> </span><span class=sb>`</span>cat<span class=w> </span>/usr/local/nginx/logs/nginx.pid<span class=sb>`</span>
<a id=__codelineno-18-17 name=__codelineno-18-17 href=#__codelineno-18-17></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;---------------------------------------------&quot;</span>
<a id=__codelineno-18-18 name=__codelineno-18-18 href=#__codelineno-18-18></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;The Nginx log Cutting Successfully! &quot;</span>
<a id=__codelineno-18-19 name=__codelineno-18-19 href=#__codelineno-18-19></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;You can access backup nginx log </span><span class=si>${</span><span class=nv>D_LOG</span><span class=si>}</span><span class=s2>/access.log files.&quot;</span>
</code></pre></div> <div class=highlight><pre><span></span><code><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a><span class=ch>#!/bin/sh</span>
<a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a><span class=c1>#nginx日志切割</span>
<a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a>
<a id=__codelineno-19-4 name=__codelineno-19-4 href=#__codelineno-19-4></a><span class=c1>#设置</span>
<a id=__codelineno-19-5 name=__codelineno-19-5 href=#__codelineno-19-5></a><span class=nv>Log_path</span><span class=o>=</span>/www/server/nginx/logs
<a id=__codelineno-19-6 name=__codelineno-19-6 href=#__codelineno-19-6></a><span class=nv>Yesterday</span><span class=o>=</span><span class=k>$(</span>date<span class=w> </span>-d<span class=w> </span><span class=s2>&quot;yesterday&quot;</span><span class=w> </span>+%Y-%m-%d_%S<span class=k>)</span>
<a id=__codelineno-19-7 name=__codelineno-19-7 href=#__codelineno-19-7></a><span class=nv>Nginxbin</span><span class=o>=</span>/www/server/nginx/sbin/nginx
<a id=__codelineno-19-8 name=__codelineno-19-8 href=#__codelineno-19-8></a>
<a id=__codelineno-19-9 name=__codelineno-19-9 href=#__codelineno-19-9></a><span class=c1>#日志改名</span>
<a id=__codelineno-19-10 name=__codelineno-19-10 href=#__codelineno-19-10></a>/bin/mv<span class=w> </span><span class=nv>$Log_path</span>/access.log<span class=w> </span><span class=nv>$Log_path</span>/access.<span class=nv>$Yesterday</span>.log
<a id=__codelineno-19-11 name=__codelineno-19-11 href=#__codelineno-19-11></a>/bin/mv<span class=w> </span><span class=nv>$Log_path</span>/error.log<span class=w>  </span><span class=nv>$Log_path</span>/error.<span class=nv>$Yesterday</span>.log
<a id=__codelineno-19-12 name=__codelineno-19-12 href=#__codelineno-19-12></a>
<a id=__codelineno-19-13 name=__codelineno-19-13 href=#__codelineno-19-13></a><span class=c1>#重新生成日志</span>
<a id=__codelineno-19-14 name=__codelineno-19-14 href=#__codelineno-19-14></a><span class=nv>$Nginxbin</span><span class=w> </span>-s<span class=w> </span>reopen
<a id=__codelineno-19-15 name=__codelineno-19-15 href=#__codelineno-19-15></a>
<a id=__codelineno-19-16 name=__codelineno-19-16 href=#__codelineno-19-16></a><span class=c1># #定时任务</span>
<a id=__codelineno-19-17 name=__codelineno-19-17 href=#__codelineno-19-17></a><span class=c1># #nginx日志切割</span>
<a id=__codelineno-19-18 name=__codelineno-19-18 href=#__codelineno-19-18></a><span class=c1># 00 00 * * *  /root/sh/cut_log.sh</span>
<a id=__codelineno-19-19 name=__codelineno-19-19 href=#__codelineno-19-19></a><span class=c1># #</span>
</code></pre></div> <h2 id=15一键安装docker>15.一键安装docker<a class=headerlink href=#15一键安装docker title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a><span class=c1>#Author:</span>
<a id=__codelineno-20-3 name=__codelineno-20-3 href=#__codelineno-20-3></a><span class=c1>#Date: 2019-06-06</span>
<a id=__codelineno-20-4 name=__codelineno-20-4 href=#__codelineno-20-4></a><span class=c1>#install docker in ubuntu and centos</span>
<a id=__codelineno-20-5 name=__codelineno-20-5 href=#__codelineno-20-5></a>
<a id=__codelineno-20-6 name=__codelineno-20-6 href=#__codelineno-20-6></a>
<a id=__codelineno-20-7 name=__codelineno-20-7 href=#__codelineno-20-7></a><span class=k>function</span><span class=w> </span>install_docker_in_ubuntu
<a id=__codelineno-20-8 name=__codelineno-20-8 href=#__codelineno-20-8></a><span class=o>{</span>
<a id=__codelineno-20-9 name=__codelineno-20-9 href=#__codelineno-20-9></a><span class=w>    </span>sudo<span class=w>  </span>apt-get<span class=w> </span>update<span class=w> </span>-y
<a id=__codelineno-20-10 name=__codelineno-20-10 href=#__codelineno-20-10></a><span class=w>    </span><span class=c1># install some tools</span>
<a id=__codelineno-20-11 name=__codelineno-20-11 href=#__codelineno-20-11></a><span class=w>    </span>sudo<span class=w> </span>apt-get<span class=w> </span>install<span class=w> </span><span class=se>\</span>
<a id=__codelineno-20-12 name=__codelineno-20-12 href=#__codelineno-20-12></a><span class=w>        </span>apt-transport-https<span class=w> </span><span class=se>\</span>
<a id=__codelineno-20-13 name=__codelineno-20-13 href=#__codelineno-20-13></a><span class=w>        </span>ca-certificates<span class=w> </span><span class=se>\</span>
<a id=__codelineno-20-14 name=__codelineno-20-14 href=#__codelineno-20-14></a><span class=w>        </span>curl<span class=w> </span><span class=se>\</span>
<a id=__codelineno-20-15 name=__codelineno-20-15 href=#__codelineno-20-15></a><span class=w>        </span>gnupg-agent<span class=w> </span><span class=se>\</span>
<a id=__codelineno-20-16 name=__codelineno-20-16 href=#__codelineno-20-16></a><span class=w>        </span>software-properties-common<span class=w> </span><span class=se>\</span>
<a id=__codelineno-20-17 name=__codelineno-20-17 href=#__codelineno-20-17></a><span class=w>        </span>net-tools<span class=w> </span><span class=se>\</span>
<a id=__codelineno-20-18 name=__codelineno-20-18 href=#__codelineno-20-18></a><span class=w>        </span>wget<span class=w> </span>-y
<a id=__codelineno-20-19 name=__codelineno-20-19 href=#__codelineno-20-19></a>
<a id=__codelineno-20-20 name=__codelineno-20-20 href=#__codelineno-20-20></a><span class=w>    </span><span class=c1># install docker</span>
<a id=__codelineno-20-21 name=__codelineno-20-21 href=#__codelineno-20-21></a><span class=w>    </span>curl<span class=w> </span>-fsSL<span class=w> </span>get.docker.com<span class=w> </span>-o<span class=w> </span>get-docker.sh
<a id=__codelineno-20-22 name=__codelineno-20-22 href=#__codelineno-20-22></a><span class=w>    </span>sh<span class=w> </span>get-docker.sh
<a id=__codelineno-20-23 name=__codelineno-20-23 href=#__codelineno-20-23></a>
<a id=__codelineno-20-24 name=__codelineno-20-24 href=#__codelineno-20-24></a><span class=w>    </span><span class=c1># start docker service</span>
<a id=__codelineno-20-25 name=__codelineno-20-25 href=#__codelineno-20-25></a><span class=w>    </span>sudo<span class=w> </span>groupadd<span class=w> </span>docker<span class=w> </span><span class=p>&amp;</span>&gt;<span class=w> </span>/dev/null
<a id=__codelineno-20-26 name=__codelineno-20-26 href=#__codelineno-20-26></a><span class=w>    </span>sudo<span class=w> </span>gpasswd<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>USER</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span>docker
<a id=__codelineno-20-27 name=__codelineno-20-27 href=#__codelineno-20-27></a><span class=w>    </span>sudo<span class=w> </span>systemctl<span class=w> </span>start<span class=w> </span>docker
<a id=__codelineno-20-28 name=__codelineno-20-28 href=#__codelineno-20-28></a>
<a id=__codelineno-20-29 name=__codelineno-20-29 href=#__codelineno-20-29></a><span class=w>    </span>rm<span class=w> </span>-rf<span class=w> </span>get-docker.sh
<a id=__codelineno-20-30 name=__codelineno-20-30 href=#__codelineno-20-30></a><span class=o>}</span>
<a id=__codelineno-20-31 name=__codelineno-20-31 href=#__codelineno-20-31></a>
<a id=__codelineno-20-32 name=__codelineno-20-32 href=#__codelineno-20-32></a>
<a id=__codelineno-20-33 name=__codelineno-20-33 href=#__codelineno-20-33></a><span class=k>function</span><span class=w> </span>install_docker_in_centos
<a id=__codelineno-20-34 name=__codelineno-20-34 href=#__codelineno-20-34></a><span class=o>{</span>
<a id=__codelineno-20-35 name=__codelineno-20-35 href=#__codelineno-20-35></a><span class=w>    </span><span class=c1># install some tools</span>
<a id=__codelineno-20-36 name=__codelineno-20-36 href=#__codelineno-20-36></a><span class=w>    </span>sudo<span class=w> </span>yum<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>git<span class=w> </span>vim<span class=w> </span>gcc<span class=w> </span>glibc-static<span class=w> </span>telnet<span class=w> </span>bridge-utils
<a id=__codelineno-20-37 name=__codelineno-20-37 href=#__codelineno-20-37></a>
<a id=__codelineno-20-38 name=__codelineno-20-38 href=#__codelineno-20-38></a><span class=w>    </span><span class=c1># install docker</span>
<a id=__codelineno-20-39 name=__codelineno-20-39 href=#__codelineno-20-39></a><span class=w>    </span>curl<span class=w> </span>-fsSL<span class=w> </span>get.docker.com<span class=w> </span>-o<span class=w> </span>get-docker.sh
<a id=__codelineno-20-40 name=__codelineno-20-40 href=#__codelineno-20-40></a><span class=w>    </span>sh<span class=w> </span>get-docker.sh
<a id=__codelineno-20-41 name=__codelineno-20-41 href=#__codelineno-20-41></a>
<a id=__codelineno-20-42 name=__codelineno-20-42 href=#__codelineno-20-42></a><span class=w>    </span><span class=c1># start docker service</span>
<a id=__codelineno-20-43 name=__codelineno-20-43 href=#__codelineno-20-43></a><span class=w>    </span>sudo<span class=w> </span>groupadd<span class=w> </span>docker<span class=w> </span><span class=p>&amp;</span>&gt;<span class=w> </span>/dev/null
<a id=__codelineno-20-44 name=__codelineno-20-44 href=#__codelineno-20-44></a><span class=w>    </span>sudo<span class=w> </span>gpasswd<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>USER</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span>docker
<a id=__codelineno-20-45 name=__codelineno-20-45 href=#__codelineno-20-45></a><span class=w>    </span>sudo<span class=w> </span>systemctl<span class=w> </span>start<span class=w> </span>docker
<a id=__codelineno-20-46 name=__codelineno-20-46 href=#__codelineno-20-46></a>
<a id=__codelineno-20-47 name=__codelineno-20-47 href=#__codelineno-20-47></a><span class=w>    </span>rm<span class=w> </span>-rf<span class=w> </span>get-docker.sh
<a id=__codelineno-20-48 name=__codelineno-20-48 href=#__codelineno-20-48></a>
<a id=__codelineno-20-49 name=__codelineno-20-49 href=#__codelineno-20-49></a><span class=o>}</span>
<a id=__codelineno-20-50 name=__codelineno-20-50 href=#__codelineno-20-50></a>
<a id=__codelineno-20-51 name=__codelineno-20-51 href=#__codelineno-20-51></a>
<a id=__codelineno-20-52 name=__codelineno-20-52 href=#__codelineno-20-52></a><span class=nv>SYSTEM_NAME</span><span class=o>=</span><span class=s2>&quot;</span><span class=k>$(</span>awk<span class=w> </span>-F<span class=o>=</span><span class=w> </span><span class=s1>&#39;/^NAME/{print $2}&#39;</span><span class=w> </span>/etc/os-release<span class=k>)</span><span class=s2>&quot;</span>
<a id=__codelineno-20-53 name=__codelineno-20-53 href=#__codelineno-20-53></a><span class=k>if</span><span class=w> </span><span class=o>[[</span><span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>SYSTEM_NAME</span><span class=p>,,</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span>~<span class=w> </span><span class=s2>&quot;ubuntu&quot;</span><span class=w>  </span><span class=o>]]</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-20-54 name=__codelineno-20-54 href=#__codelineno-20-54></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Your system is ubuntu.&quot;</span>
<a id=__codelineno-20-55 name=__codelineno-20-55 href=#__codelineno-20-55></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Installing Docker in ubuntu...&quot;</span>
<a id=__codelineno-20-56 name=__codelineno-20-56 href=#__codelineno-20-56></a><span class=w>    </span>install_docker_in_ubuntu
<a id=__codelineno-20-57 name=__codelineno-20-57 href=#__codelineno-20-57></a><span class=k>elif</span><span class=w> </span><span class=o>[[</span><span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>SYSTEM_NAME</span><span class=p>,,</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span>~<span class=w> </span><span class=s2>&quot;centos&quot;</span><span class=w> </span><span class=o>]]</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-20-58 name=__codelineno-20-58 href=#__codelineno-20-58></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Your system is centos.&quot;</span>
<a id=__codelineno-20-59 name=__codelineno-20-59 href=#__codelineno-20-59></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Installing Docker in centos...&quot;</span>
<a id=__codelineno-20-60 name=__codelineno-20-60 href=#__codelineno-20-60></a><span class=w>    </span>install_docker_in_centos
<a id=__codelineno-20-61 name=__codelineno-20-61 href=#__codelineno-20-61></a><span class=k>else</span>
<a id=__codelineno-20-62 name=__codelineno-20-62 href=#__codelineno-20-62></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;This script can only run in ubuntu and centos system.&quot;</span>
<a id=__codelineno-20-63 name=__codelineno-20-63 href=#__codelineno-20-63></a><span class=w>    </span><span class=nb>exit</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-20-64 name=__codelineno-20-64 href=#__codelineno-20-64></a><span class=k>fi</span>
</code></pre></div> <h2 id=16-备份mongodb>16. 备份MongoDB<a class=headerlink href=#16-备份mongodb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a><span class=c1>#backup mongodb</span>
<a id=__codelineno-21-3 name=__codelineno-21-3 href=#__codelineno-21-3></a>
<a id=__codelineno-21-4 name=__codelineno-21-4 href=#__codelineno-21-4></a>.<span class=w> </span>/etc/profile
<a id=__codelineno-21-5 name=__codelineno-21-5 href=#__codelineno-21-5></a><span class=nv>CMD</span><span class=o>=</span><span class=sb>`</span>which<span class=w> </span>mongodump<span class=sb>`</span>
<a id=__codelineno-21-6 name=__codelineno-21-6 href=#__codelineno-21-6></a><span class=nv>DATE</span><span class=o>=</span><span class=sb>`</span>date<span class=w> </span>+%F<span class=sb>`</span>
<a id=__codelineno-21-7 name=__codelineno-21-7 href=#__codelineno-21-7></a><span class=nv>DB</span><span class=o>=</span><span class=s2>&quot;test&quot;</span>
<a id=__codelineno-21-8 name=__codelineno-21-8 href=#__codelineno-21-8></a><span class=nv>DB_HOST</span><span class=o>=</span><span class=s2>&quot;localhost&quot;</span>
<a id=__codelineno-21-9 name=__codelineno-21-9 href=#__codelineno-21-9></a><span class=nv>DB_PORT</span><span class=o>=</span><span class=s2>&quot;27017&quot;</span>
<a id=__codelineno-21-10 name=__codelineno-21-10 href=#__codelineno-21-10></a><span class=nv>DB_USER</span><span class=o>=</span><span class=s2>&quot;testuser&quot;</span>
<a id=__codelineno-21-11 name=__codelineno-21-11 href=#__codelineno-21-11></a><span class=nv>DB_PWD</span><span class=o>=</span><span class=s2>&quot;testpass&quot;</span>
<a id=__codelineno-21-12 name=__codelineno-21-12 href=#__codelineno-21-12></a><span class=nv>BACKUP_DIR</span><span class=o>=</span><span class=s2>&quot;/data/mongodb/&quot;</span>
<a id=__codelineno-21-13 name=__codelineno-21-13 href=#__codelineno-21-13></a><span class=nv>TAR_DIR</span><span class=o>=</span><span class=s2>&quot;/data/tardir/&quot;</span>
<a id=__codelineno-21-14 name=__codelineno-21-14 href=#__codelineno-21-14></a><span class=nv>TAR_DIR_DATE</span><span class=o>=</span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>TAR_DIR</span><span class=si>}${</span><span class=nv>DATE</span><span class=si>}</span><span class=s2>&quot;</span>
<a id=__codelineno-21-15 name=__codelineno-21-15 href=#__codelineno-21-15></a><span class=nv>TAR_BAK</span><span class=o>=</span><span class=s2>&quot;mongodb_bak_</span><span class=nv>$DATE</span><span class=s2>.tar.gz&quot;</span>
<a id=__codelineno-21-16 name=__codelineno-21-16 href=#__codelineno-21-16></a>
<a id=__codelineno-21-17 name=__codelineno-21-17 href=#__codelineno-21-17></a>check_dir<span class=o>(){</span>
<a id=__codelineno-21-18 name=__codelineno-21-18 href=#__codelineno-21-18></a><span class=w>    </span><span class=k>for</span><span class=w> </span>DIR<span class=w> </span><span class=k>in</span><span class=w> </span><span class=si>${</span><span class=nv>BACKUP_DIR</span><span class=si>}</span><span class=w> </span><span class=si>${</span><span class=nv>TAR_DIR_DATE</span><span class=si>}</span>
<a id=__codelineno-21-19 name=__codelineno-21-19 href=#__codelineno-21-19></a><span class=w>    </span><span class=k>do</span>
<a id=__codelineno-21-20 name=__codelineno-21-20 href=#__codelineno-21-20></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>!<span class=w> </span>-d<span class=w> </span><span class=nv>$DIR</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=k>then</span>
<a id=__codelineno-21-21 name=__codelineno-21-21 href=#__codelineno-21-21></a><span class=w>            </span>mkdir<span class=w> </span>-p<span class=w> </span><span class=nv>$DIR</span>
<a id=__codelineno-21-22 name=__codelineno-21-22 href=#__codelineno-21-22></a><span class=w>        </span><span class=k>fi</span>
<a id=__codelineno-21-23 name=__codelineno-21-23 href=#__codelineno-21-23></a><span class=w>    </span><span class=k>done</span>
<a id=__codelineno-21-24 name=__codelineno-21-24 href=#__codelineno-21-24></a><span class=o>}</span>
<a id=__codelineno-21-25 name=__codelineno-21-25 href=#__codelineno-21-25></a>backup_mongodb<span class=o>(){</span>
<a id=__codelineno-21-26 name=__codelineno-21-26 href=#__codelineno-21-26></a><span class=w>    </span><span class=nv>$CMD</span><span class=w> </span>-h<span class=w> </span><span class=si>${</span><span class=nv>DB_HOST</span><span class=si>}</span>:<span class=si>${</span><span class=nv>DB_PORT</span><span class=si>}</span><span class=w> </span>-u<span class=w> </span><span class=nv>$DB_USER</span><span class=w> </span>-p<span class=w> </span><span class=nv>$DB_PWD</span><span class=w> </span>-d<span class=w> </span><span class=si>${</span><span class=nv>DB</span><span class=si>}</span><span class=w> </span>-o<span class=w> </span><span class=si>${</span><span class=nv>BACKUP_DIR</span><span class=si>}${</span><span class=nv>DATE</span><span class=si>}</span><span class=w> </span>&gt;/dev/null
<a id=__codelineno-21-27 name=__codelineno-21-27 href=#__codelineno-21-27></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=nv>$?</span><span class=w> </span>-eq<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=k>then</span>
<a id=__codelineno-21-28 name=__codelineno-21-28 href=#__codelineno-21-28></a><span class=w>        </span>tar<span class=w> </span>-zcf<span class=w> </span><span class=si>${</span><span class=nv>TAR_DIR_DATE</span><span class=si>}</span>/<span class=si>${</span><span class=nv>TAR_BAK</span><span class=si>}</span><span class=w> </span><span class=si>${</span><span class=nv>BACKUP_DIR</span><span class=si>}${</span><span class=nv>DATE</span><span class=si>}</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-21-29 name=__codelineno-21-29 href=#__codelineno-21-29></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-21-30 name=__codelineno-21-30 href=#__codelineno-21-30></a><span class=o>}</span>
<a id=__codelineno-21-31 name=__codelineno-21-31 href=#__codelineno-21-31></a>clean_tar<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-21-32 name=__codelineno-21-32 href=#__codelineno-21-32></a><span class=w>    </span>find<span class=w> </span><span class=si>${</span><span class=nv>TAR_DIR</span><span class=si>}</span><span class=w> </span>-mtime<span class=w> </span>+7<span class=w> </span>-exec<span class=w> </span>rm<span class=w> </span>-rf<span class=w> </span><span class=o>{}</span><span class=w> </span><span class=se>\;</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-21-33 name=__codelineno-21-33 href=#__codelineno-21-33></a><span class=o>}</span>
<a id=__codelineno-21-34 name=__codelineno-21-34 href=#__codelineno-21-34></a>
<a id=__codelineno-21-35 name=__codelineno-21-35 href=#__codelineno-21-35></a>main<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-21-36 name=__codelineno-21-36 href=#__codelineno-21-36></a><span class=w>    </span>check_dir
<a id=__codelineno-21-37 name=__codelineno-21-37 href=#__codelineno-21-37></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=nv>$?</span><span class=w> </span>-eq<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>backup_mongodb
<a id=__codelineno-21-38 name=__codelineno-21-38 href=#__codelineno-21-38></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=nv>$?</span><span class=w> </span>-eq<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>clean_tar
<a id=__codelineno-21-39 name=__codelineno-21-39 href=#__codelineno-21-39></a><span class=o>}</span>
<a id=__codelineno-21-40 name=__codelineno-21-40 href=#__codelineno-21-40></a>
<a id=__codelineno-21-41 name=__codelineno-21-41 href=#__codelineno-21-41></a>main
</code></pre></div> <h2 id=17linux下以秒为单位执行脚本>17.Linux下以秒为单位执行脚本<a class=headerlink href=#17linux下以秒为单位执行脚本 title="Permanent link">&para;</a></h2> <h3 id=example1>example1<a class=headerlink href=#example1 title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a>写一个触发的脚本，在触发脚本中使用死循环来解决此问题
<a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a><span class=o>[</span>root@test<span class=w> </span>~<span class=o>]</span><span class=c1># cat kevin.sh</span>
<a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a><span class=c1>#!/bin/bash</span>
<a id=__codelineno-22-4 name=__codelineno-22-4 href=#__codelineno-22-4></a><span class=k>while</span><span class=w> </span>:<span class=w> </span><span class=p>;</span><span class=k>do</span>
<a id=__codelineno-22-5 name=__codelineno-22-5 href=#__codelineno-22-5></a>
<a id=__codelineno-22-6 name=__codelineno-22-6 href=#__codelineno-22-6></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;beijing is so good!&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span>/root/test.log
<a id=__codelineno-22-7 name=__codelineno-22-7 href=#__codelineno-22-7></a>sleep<span class=w> </span><span class=m>2</span>
<a id=__codelineno-22-8 name=__codelineno-22-8 href=#__codelineno-22-8></a>
<a id=__codelineno-22-9 name=__codelineno-22-9 href=#__codelineno-22-9></a><span class=k>done</span>
<a id=__codelineno-22-10 name=__codelineno-22-10 href=#__codelineno-22-10></a>
<a id=__codelineno-22-11 name=__codelineno-22-11 href=#__codelineno-22-11></a><span class=o>[</span>root@test<span class=w> </span>~<span class=o>]</span><span class=c1># chmod 755 kevin.sh</span>
<a id=__codelineno-22-12 name=__codelineno-22-12 href=#__codelineno-22-12></a>
<a id=__codelineno-22-13 name=__codelineno-22-13 href=#__codelineno-22-13></a>可以把它放到计划任务使其运行
<a id=__codelineno-22-14 name=__codelineno-22-14 href=#__codelineno-22-14></a><span class=o>[</span>root@test<span class=w> </span>~<span class=o>]</span><span class=c1># crontab -e</span>
<a id=__codelineno-22-15 name=__codelineno-22-15 href=#__codelineno-22-15></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-22-16 name=__codelineno-22-16 href=#__codelineno-22-16></a>
<a id=__codelineno-22-17 name=__codelineno-22-17 href=#__codelineno-22-17></a>等待这个计划任务执行后，就将计划任务中的此条目删除或注释！防止该计划条目无限制地执行下去（只需执行一次就可以，因为kevin.sh脚本里本身就有死循环）
<a id=__codelineno-22-18 name=__codelineno-22-18 href=#__codelineno-22-18></a><span class=o>[</span>root@test<span class=w> </span>~<span class=o>]</span><span class=c1># ps -ef|grep kevin.sh</span>
<a id=__codelineno-22-19 name=__codelineno-22-19 href=#__codelineno-22-19></a>root<span class=w>     </span><span class=m>29839</span><span class=w> </span><span class=m>29835</span><span class=w>  </span><span class=m>0</span><span class=w> </span><span class=m>16</span>:05<span class=w> </span>?<span class=w>        </span><span class=m>00</span>:00:00<span class=w> </span>/bin/sh<span class=w> </span>-c<span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-22-20 name=__codelineno-22-20 href=#__codelineno-22-20></a>root<span class=w>     </span><span class=m>29842</span><span class=w> </span><span class=m>29839</span><span class=w>  </span><span class=m>0</span><span class=w> </span><span class=m>16</span>:05<span class=w> </span>?<span class=w>        </span><span class=m>00</span>:00:00<span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh
<a id=__codelineno-22-21 name=__codelineno-22-21 href=#__codelineno-22-21></a>root<span class=w>     </span><span class=m>29852</span><span class=w> </span><span class=m>16356</span><span class=w>  </span><span class=m>0</span><span class=w> </span><span class=m>16</span>:05<span class=w> </span>pts/0<span class=w>    </span><span class=m>00</span>:00:00<span class=w> </span>grep<span class=w> </span>kevin.sh
<a id=__codelineno-22-22 name=__codelineno-22-22 href=#__codelineno-22-22></a>
<a id=__codelineno-22-23 name=__codelineno-22-23 href=#__codelineno-22-23></a><span class=o>[</span>root@test<span class=w> </span>~<span class=o>]</span><span class=c1># crontab -e</span>
<a id=__codelineno-22-24 name=__codelineno-22-24 href=#__codelineno-22-24></a><span class=c1>#* * * * * /bin/bash -x /root/kevin.sh &gt;/dev/null 2&gt;&amp;1</span>
<a id=__codelineno-22-25 name=__codelineno-22-25 href=#__codelineno-22-25></a>
<a id=__codelineno-22-26 name=__codelineno-22-26 href=#__codelineno-22-26></a>最后把这个脚本放到<span class=w> </span>/etc/rc.local<span class=w> </span>让它每次开机都可以被运行
<a id=__codelineno-22-27 name=__codelineno-22-27 href=#__codelineno-22-27></a><span class=o>[</span>root@test<span class=w> </span>~<span class=o>]</span><span class=c1># vim /etc/rc.local</span>
<a id=__codelineno-22-28 name=__codelineno-22-28 href=#__codelineno-22-28></a>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-22-29 name=__codelineno-22-29 href=#__codelineno-22-29></a>
<a id=__codelineno-22-30 name=__codelineno-22-30 href=#__codelineno-22-30></a>验证（查看是不是每隔2秒在/root/test.log文件中写入了）
<a id=__codelineno-22-31 name=__codelineno-22-31 href=#__codelineno-22-31></a><span class=o>[</span>root@test<span class=w> </span>~<span class=o>]</span><span class=c1># tail -f /root/test.log</span>
<a id=__codelineno-22-32 name=__codelineno-22-32 href=#__codelineno-22-32></a>beijing<span class=w> </span>is<span class=w> </span>so<span class=w> </span>good!
<a id=__codelineno-22-33 name=__codelineno-22-33 href=#__codelineno-22-33></a>beijing<span class=w> </span>is<span class=w> </span>so<span class=w> </span>good!
<a id=__codelineno-22-34 name=__codelineno-22-34 href=#__codelineno-22-34></a>beijing<span class=w> </span>is<span class=w> </span>so<span class=w> </span>good!
<a id=__codelineno-22-35 name=__codelineno-22-35 href=#__codelineno-22-35></a>beijing<span class=w> </span>is<span class=w> </span>so<span class=w> </span>good!
<a id=__codelineno-22-36 name=__codelineno-22-36 href=#__codelineno-22-36></a>beijing<span class=w> </span>is<span class=w> </span>so<span class=w> </span>good!
<a id=__codelineno-22-37 name=__codelineno-22-37 href=#__codelineno-22-37></a>beijing<span class=w> </span>is<span class=w> </span>so<span class=w> </span>good!
<a id=__codelineno-22-38 name=__codelineno-22-38 href=#__codelineno-22-38></a>beijing<span class=w> </span>is<span class=w> </span>so<span class=w> </span>good!
</code></pre></div> <h3 id=example2>example2<a class=headerlink href=#example2 title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a><span class=o>[</span>root@test<span class=w> </span>~<span class=o>]</span><span class=c1># vim kevin.sh</span>
<a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a><span class=c1>#!/bin/bash</span>
<a id=__codelineno-23-3 name=__codelineno-23-3 href=#__codelineno-23-3></a>
<a id=__codelineno-23-4 name=__codelineno-23-4 href=#__codelineno-23-4></a><span class=k>for</span><span class=o>((</span><span class=nv>i</span><span class=o>=</span><span class=m>1</span><span class=p>;</span>i&lt;<span class=o>=</span><span class=m>20</span><span class=p>;</span>i++<span class=o>))</span><span class=p>;</span><span class=k>do</span>
<a id=__codelineno-23-5 name=__codelineno-23-5 href=#__codelineno-23-5></a>
<a id=__codelineno-23-6 name=__codelineno-23-6 href=#__codelineno-23-6></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;beijing is so good!&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span>/root/test.log
<a id=__codelineno-23-7 name=__codelineno-23-7 href=#__codelineno-23-7></a>sleep<span class=w> </span><span class=m>2</span>
<a id=__codelineno-23-8 name=__codelineno-23-8 href=#__codelineno-23-8></a>
<a id=__codelineno-23-9 name=__codelineno-23-9 href=#__codelineno-23-9></a><span class=k>done</span>
<a id=__codelineno-23-10 name=__codelineno-23-10 href=#__codelineno-23-10></a>
<a id=__codelineno-23-11 name=__codelineno-23-11 href=#__codelineno-23-11></a>然后添加脚本执行权限，<span class=w> </span>写入的crontab里每分钟执行一次
<a id=__codelineno-23-12 name=__codelineno-23-12 href=#__codelineno-23-12></a><span class=o>[</span>root@test<span class=w> </span>~<span class=o>]</span><span class=c1># chmod 755 kevin.sh</span>
<a id=__codelineno-23-13 name=__codelineno-23-13 href=#__codelineno-23-13></a><span class=o>[</span>root@test<span class=w> </span>~<span class=o>]</span><span class=c1># crontab -e</span>
<a id=__codelineno-23-14 name=__codelineno-23-14 href=#__codelineno-23-14></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-23-15 name=__codelineno-23-15 href=#__codelineno-23-15></a>
<a id=__codelineno-23-16 name=__codelineno-23-16 href=#__codelineno-23-16></a><span class=o>[</span>root@test<span class=w> </span>~<span class=o>]</span><span class=c1># ps -ef|grep kevin.sh</span>
<a id=__codelineno-23-17 name=__codelineno-23-17 href=#__codelineno-23-17></a>root<span class=w>     </span><span class=m>30515</span><span class=w> </span><span class=m>30514</span><span class=w>  </span><span class=m>0</span><span class=w> </span><span class=m>16</span>:27<span class=w> </span>?<span class=w>        </span><span class=m>00</span>:00:00<span class=w> </span>/bin/sh<span class=w> </span>-c<span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-23-18 name=__codelineno-23-18 href=#__codelineno-23-18></a>root<span class=w>     </span><span class=m>30516</span><span class=w> </span><span class=m>30515</span><span class=w>  </span><span class=m>0</span><span class=w> </span><span class=m>16</span>:27<span class=w> </span>?<span class=w>        </span><span class=m>00</span>:00:00<span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh
<a id=__codelineno-23-19 name=__codelineno-23-19 href=#__codelineno-23-19></a>root<span class=w>     </span><span class=m>30527</span><span class=w> </span><span class=m>16356</span><span class=w>  </span><span class=m>0</span><span class=w> </span><span class=m>16</span>:27<span class=w> </span>pts/0<span class=w>    </span><span class=m>00</span>:00:00<span class=w> </span>grep<span class=w> </span>kevin.sh
<a id=__codelineno-23-20 name=__codelineno-23-20 href=#__codelineno-23-20></a>
<a id=__codelineno-23-21 name=__codelineno-23-21 href=#__codelineno-23-21></a><span class=o>[</span>root@test<span class=w> </span>~<span class=o>]</span><span class=c1># tail -f /root/test.log</span>
<a id=__codelineno-23-22 name=__codelineno-23-22 href=#__codelineno-23-22></a>beijing<span class=w> </span>is<span class=w> </span>so<span class=w> </span>good!
<a id=__codelineno-23-23 name=__codelineno-23-23 href=#__codelineno-23-23></a>beijing<span class=w> </span>is<span class=w> </span>so<span class=w> </span>good!
<a id=__codelineno-23-24 name=__codelineno-23-24 href=#__codelineno-23-24></a>beijing<span class=w> </span>is<span class=w> </span>so<span class=w> </span>good!
<a id=__codelineno-23-25 name=__codelineno-23-25 href=#__codelineno-23-25></a>beijing<span class=w> </span>is<span class=w> </span>so<span class=w> </span>good!
<a id=__codelineno-23-26 name=__codelineno-23-26 href=#__codelineno-23-26></a>beijing<span class=w> </span>is<span class=w> </span>so<span class=w> </span>good!
<a id=__codelineno-23-27 name=__codelineno-23-27 href=#__codelineno-23-27></a>beijing<span class=w> </span>is<span class=w> </span>so<span class=w> </span>good!
<a id=__codelineno-23-28 name=__codelineno-23-28 href=#__codelineno-23-28></a>.......
</code></pre></div> <h3 id=example3>example3<a class=headerlink href=#example3 title="Permanent link">&para;</a></h3> <ul> <li>使用crontab计划任务来直接实现！经验证，这种方式是最靠谱，最稳妥的！</li> </ul> <div class=highlight><pre><span></span><code><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a><span class=o>[</span>root@test<span class=w> </span>~<span class=o>]</span><span class=c1># cat /root/kevin.sh</span>
<a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a><span class=c1>#!/bin/bash</span>
<a id=__codelineno-24-3 name=__codelineno-24-3 href=#__codelineno-24-3></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;beijing is so good!&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span>/root/test.log
<a id=__codelineno-24-4 name=__codelineno-24-4 href=#__codelineno-24-4></a>
<a id=__codelineno-24-5 name=__codelineno-24-5 href=#__codelineno-24-5></a>添加脚本执行权限，并配置到crontab计划任务里（使用<span class=o>&amp;&amp;</span><span class=w> </span>或者<span class=w> </span>；都是一样的效果）。思路：先过一分钟执行第一次，接着就是每隔2秒钟执行一次。
<a id=__codelineno-24-6 name=__codelineno-24-6 href=#__codelineno-24-6></a><span class=o>[</span>root@test<span class=w> </span>~<span class=o>]</span><span class=c1># chmod 755 /root/kevin.sh</span>
<a id=__codelineno-24-7 name=__codelineno-24-7 href=#__codelineno-24-7></a><span class=o>[</span>root@test<span class=w> </span>~<span class=o>]</span><span class=c1># crontab -e</span>
<a id=__codelineno-24-8 name=__codelineno-24-8 href=#__codelineno-24-8></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-24-9 name=__codelineno-24-9 href=#__codelineno-24-9></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>sleep<span class=w> </span><span class=m>2</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w>  </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-24-10 name=__codelineno-24-10 href=#__codelineno-24-10></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>sleep<span class=w> </span><span class=m>4</span><span class=p>;</span><span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-24-11 name=__codelineno-24-11 href=#__codelineno-24-11></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>sleep<span class=w> </span><span class=m>6</span><span class=p>;</span><span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-24-12 name=__codelineno-24-12 href=#__codelineno-24-12></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>sleep<span class=w> </span><span class=m>8</span><span class=p>;</span><span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-24-13 name=__codelineno-24-13 href=#__codelineno-24-13></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>sleep<span class=w> </span><span class=m>10</span><span class=p>;</span><span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-24-14 name=__codelineno-24-14 href=#__codelineno-24-14></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>sleep<span class=w> </span><span class=m>12</span><span class=p>;</span><span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-24-15 name=__codelineno-24-15 href=#__codelineno-24-15></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>sleep<span class=w> </span><span class=m>14</span><span class=p>;</span><span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-24-16 name=__codelineno-24-16 href=#__codelineno-24-16></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>sleep<span class=w> </span><span class=m>16</span><span class=p>;</span><span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-24-17 name=__codelineno-24-17 href=#__codelineno-24-17></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>sleep<span class=w> </span><span class=m>18</span><span class=p>;</span><span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-24-18 name=__codelineno-24-18 href=#__codelineno-24-18></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>sleep<span class=w> </span><span class=m>20</span><span class=p>;</span><span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-24-19 name=__codelineno-24-19 href=#__codelineno-24-19></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>sleep<span class=w> </span><span class=m>22</span><span class=p>;</span><span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-24-20 name=__codelineno-24-20 href=#__codelineno-24-20></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>sleep<span class=w> </span><span class=m>24</span><span class=p>;</span><span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-24-21 name=__codelineno-24-21 href=#__codelineno-24-21></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>sleep<span class=w> </span><span class=m>26</span><span class=p>;</span><span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-24-22 name=__codelineno-24-22 href=#__codelineno-24-22></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>sleep<span class=w> </span><span class=m>28</span><span class=p>;</span><span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-24-23 name=__codelineno-24-23 href=#__codelineno-24-23></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>sleep<span class=w> </span><span class=m>30</span><span class=p>;</span><span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-24-24 name=__codelineno-24-24 href=#__codelineno-24-24></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>sleep<span class=w> </span><span class=m>32</span><span class=p>;</span><span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-24-25 name=__codelineno-24-25 href=#__codelineno-24-25></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>sleep<span class=w> </span><span class=m>34</span><span class=p>;</span><span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-24-26 name=__codelineno-24-26 href=#__codelineno-24-26></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>sleep<span class=w> </span><span class=m>36</span><span class=p>;</span><span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-24-27 name=__codelineno-24-27 href=#__codelineno-24-27></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>sleep<span class=w> </span><span class=m>38</span><span class=p>;</span><span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-24-28 name=__codelineno-24-28 href=#__codelineno-24-28></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>sleep<span class=w> </span><span class=m>40</span><span class=p>;</span><span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-24-29 name=__codelineno-24-29 href=#__codelineno-24-29></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>sleep<span class=w> </span><span class=m>42</span><span class=p>;</span><span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-24-30 name=__codelineno-24-30 href=#__codelineno-24-30></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>sleep<span class=w> </span><span class=m>44</span><span class=p>;</span><span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-24-31 name=__codelineno-24-31 href=#__codelineno-24-31></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>sleep<span class=w> </span><span class=m>46</span><span class=p>;</span><span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-24-32 name=__codelineno-24-32 href=#__codelineno-24-32></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>sleep<span class=w> </span><span class=m>48</span><span class=p>;</span><span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-24-33 name=__codelineno-24-33 href=#__codelineno-24-33></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>sleep<span class=w> </span><span class=m>50</span><span class=p>;</span><span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-24-34 name=__codelineno-24-34 href=#__codelineno-24-34></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>sleep<span class=w> </span><span class=m>52</span><span class=p>;</span><span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-24-35 name=__codelineno-24-35 href=#__codelineno-24-35></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>sleep<span class=w> </span><span class=m>54</span><span class=p>;</span><span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-24-36 name=__codelineno-24-36 href=#__codelineno-24-36></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>sleep<span class=w> </span><span class=m>56</span><span class=p>;</span><span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-24-37 name=__codelineno-24-37 href=#__codelineno-24-37></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>sleep<span class=w> </span><span class=m>58</span><span class=p>;</span><span class=w> </span>/bin/bash<span class=w> </span>-x<span class=w> </span>/root/kevin.sh<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-24-38 name=__codelineno-24-38 href=#__codelineno-24-38></a>
<a id=__codelineno-24-39 name=__codelineno-24-39 href=#__codelineno-24-39></a><span class=o>[</span>root@test<span class=w> </span>~<span class=o>]</span><span class=c1># tail -f /root/test.log</span>
<a id=__codelineno-24-40 name=__codelineno-24-40 href=#__codelineno-24-40></a>beijing<span class=w> </span>is<span class=w> </span>so<span class=w> </span>good!
<a id=__codelineno-24-41 name=__codelineno-24-41 href=#__codelineno-24-41></a>beijing<span class=w> </span>is<span class=w> </span>so<span class=w> </span>good!
<a id=__codelineno-24-42 name=__codelineno-24-42 href=#__codelineno-24-42></a>beijing<span class=w> </span>is<span class=w> </span>so<span class=w> </span>good!
<a id=__codelineno-24-43 name=__codelineno-24-43 href=#__codelineno-24-43></a>beijing<span class=w> </span>is<span class=w> </span>so<span class=w> </span>good!
<a id=__codelineno-24-44 name=__codelineno-24-44 href=#__codelineno-24-44></a>beijing<span class=w> </span>is<span class=w> </span>so<span class=w> </span>good!
<a id=__codelineno-24-45 name=__codelineno-24-45 href=#__codelineno-24-45></a>beijing<span class=w> </span>is<span class=w> </span>so<span class=w> </span>good!
<a id=__codelineno-24-46 name=__codelineno-24-46 href=#__codelineno-24-46></a>beijing<span class=w> </span>is<span class=w> </span>so<span class=w> </span>good!
<a id=__codelineno-24-47 name=__codelineno-24-47 href=#__codelineno-24-47></a>beijing<span class=w> </span>is<span class=w> </span>so<span class=w> </span>good!
<a id=__codelineno-24-48 name=__codelineno-24-48 href=#__codelineno-24-48></a>beijing<span class=w> </span>is<span class=w> </span>so<span class=w> </span>good!
</code></pre></div> <p>一个取巧的方法如下。</p> <p>行秒级的定时任务</p> <div class=highlight><pre><span></span><code><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>cmd
<a id=__codelineno-25-2 name=__codelineno-25-2 href=#__codelineno-25-2></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>sleep<span class=w> </span><span class=m>20</span><span class=p>;</span><span class=w> </span>cmd
<a id=__codelineno-25-3 name=__codelineno-25-3 href=#__codelineno-25-3></a>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>sleep<span class=w> </span><span class=m>40</span><span class=p>;</span><span class=w> </span>cmd
</code></pre></div> <h2 id=18备份文件>18.备份文件<a class=headerlink href=#18备份文件 title="Permanent link">&para;</a></h2> <ul> <li>Auto_Backup_Linux_System_Files.sh</li> </ul> <div class=highlight><pre><span></span><code><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a><span class=ch>#!/usr/bin/env bash</span>
<a id=__codelineno-26-2 name=__codelineno-26-2 href=#__codelineno-26-2></a>
<a id=__codelineno-26-3 name=__codelineno-26-3 href=#__codelineno-26-3></a><span class=nv>SOURCE_DIR</span><span class=o>=(</span>
<a id=__codelineno-26-4 name=__codelineno-26-4 href=#__codelineno-26-4></a><span class=w>    </span><span class=nv>$*</span>
<a id=__codelineno-26-5 name=__codelineno-26-5 href=#__codelineno-26-5></a><span class=o>)</span>
<a id=__codelineno-26-6 name=__codelineno-26-6 href=#__codelineno-26-6></a><span class=nv>TARGET_DIR</span><span class=o>=</span>/data/backup/
<a id=__codelineno-26-7 name=__codelineno-26-7 href=#__codelineno-26-7></a><span class=nv>YEAR</span><span class=o>=</span><span class=sb>`</span>date<span class=w> </span>+%Y<span class=sb>`</span>
<a id=__codelineno-26-8 name=__codelineno-26-8 href=#__codelineno-26-8></a><span class=nv>MONTH</span><span class=o>=</span><span class=sb>`</span>date<span class=w> </span>+%m<span class=sb>`</span>
<a id=__codelineno-26-9 name=__codelineno-26-9 href=#__codelineno-26-9></a><span class=nv>DAY</span><span class=o>=</span><span class=sb>`</span>date<span class=w> </span>+%d<span class=sb>`</span>
<a id=__codelineno-26-10 name=__codelineno-26-10 href=#__codelineno-26-10></a><span class=nv>WEEK</span><span class=o>=</span><span class=sb>`</span>date<span class=w> </span>+%u<span class=sb>`</span>
<a id=__codelineno-26-11 name=__codelineno-26-11 href=#__codelineno-26-11></a><span class=nv>FILES</span><span class=o>=</span>system_backup.tgz
<a id=__codelineno-26-12 name=__codelineno-26-12 href=#__codelineno-26-12></a><span class=nv>CODE</span><span class=o>=</span><span class=nv>$?</span>
<a id=__codelineno-26-13 name=__codelineno-26-13 href=#__codelineno-26-13></a>
<a id=__codelineno-26-14 name=__codelineno-26-14 href=#__codelineno-26-14></a>
<a id=__codelineno-26-15 name=__codelineno-26-15 href=#__codelineno-26-15></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=nv>$*</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-26-16 name=__codelineno-26-16 href=#__codelineno-26-16></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;\033[32mUsage:\nPlease Ebter Your Backup Files or Directories\n--------------------------------------------\n</span>
<a id=__codelineno-26-17 name=__codelineno-26-17 href=#__codelineno-26-17></a><span class=s2>    \nUsage:{ </span><span class=nv>$0</span><span class=s2> /boot/etc}\033[0m&quot;</span>
<a id=__codelineno-26-18 name=__codelineno-26-18 href=#__codelineno-26-18></a><span class=w>    </span><span class=nb>exit</span>
<a id=__codelineno-26-19 name=__codelineno-26-19 href=#__codelineno-26-19></a><span class=k>fi</span>
<a id=__codelineno-26-20 name=__codelineno-26-20 href=#__codelineno-26-20></a>
<a id=__codelineno-26-21 name=__codelineno-26-21 href=#__codelineno-26-21></a><span class=c1># Deternube Wgether the Target Directory Exists</span>
<a id=__codelineno-26-22 name=__codelineno-26-22 href=#__codelineno-26-22></a>
<a id=__codelineno-26-23 name=__codelineno-26-23 href=#__codelineno-26-23></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>!<span class=w> </span>-d<span class=w> </span><span class=nv>$TARGET_DIR</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-26-24 name=__codelineno-26-24 href=#__codelineno-26-24></a><span class=w>    </span>mkdir<span class=w> </span>-p<span class=w> </span><span class=nv>$TARGET_DIR</span>/<span class=nv>$YEAR</span>/<span class=nv>$MONTH</span>/<span class=nv>$DAY</span>
<a id=__codelineno-26-25 name=__codelineno-26-25 href=#__codelineno-26-25></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;\033[32mThe </span><span class=nv>$TARGET_DIR</span><span class=s2> Create Successfully ! \033[0m&quot;</span>
<a id=__codelineno-26-26 name=__codelineno-26-26 href=#__codelineno-26-26></a><span class=k>fi</span>
<a id=__codelineno-26-27 name=__codelineno-26-27 href=#__codelineno-26-27></a>
<a id=__codelineno-26-28 name=__codelineno-26-28 href=#__codelineno-26-28></a><span class=c1>#EXEC Full_Backup Function Command</span>
<a id=__codelineno-26-29 name=__codelineno-26-29 href=#__codelineno-26-29></a><span class=c1>#EXEC Full_Backup Function Command</span>
<a id=__codelineno-26-30 name=__codelineno-26-30 href=#__codelineno-26-30></a>Full_Backup<span class=o>()</span>
<a id=__codelineno-26-31 name=__codelineno-26-31 href=#__codelineno-26-31></a><span class=o>{</span>
<a id=__codelineno-26-32 name=__codelineno-26-32 href=#__codelineno-26-32></a><span class=k>if</span>
<a id=__codelineno-26-33 name=__codelineno-26-33 href=#__codelineno-26-33></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$WEEK</span><span class=s2>&quot;</span><span class=w> </span>-eq<span class=w> </span><span class=s2>&quot;7&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=k>then</span>
<a id=__codelineno-26-34 name=__codelineno-26-34 href=#__codelineno-26-34></a><span class=w>    </span>rm<span class=w> </span>-rf<span class=w> </span><span class=nv>$TARGET_DIR</span>/snapshot
<a id=__codelineno-26-35 name=__codelineno-26-35 href=#__codelineno-26-35></a><span class=w>    </span><span class=nb>cd</span><span class=w> </span><span class=nv>$TARGET_DIR</span>/<span class=nv>$YEAR</span>/<span class=nv>$MONTH</span>/<span class=nv>$DAY</span><span class=w> </span><span class=p>;</span>tar<span class=w> </span>-g<span class=w> </span><span class=nv>$TARGET_DIR</span>/snapshot<span class=w> </span>-czvf<span class=w> </span><span class=nv>$FILES</span><span class=w> </span><span class=sb>`</span><span class=nb>echo</span><span class=w> </span><span class=si>${</span><span class=nv>SOURCE_DIR</span><span class=p>[@]</span><span class=si>}</span><span class=sb>`</span>
<a id=__codelineno-26-36 name=__codelineno-26-36 href=#__codelineno-26-36></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$CODE</span><span class=s2>&quot;</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s2>&quot;0&quot;</span><span class=w> </span><span class=o>]&amp;&amp;</span><span class=nb>echo</span><span class=w> </span>-e<span class=w>  </span><span class=s2>&quot;--------------------------------------------\nFull_Backup System Files Backup Successfully !&quot;</span>
<a id=__codelineno-26-37 name=__codelineno-26-37 href=#__codelineno-26-37></a><span class=k>fi</span>
<a id=__codelineno-26-38 name=__codelineno-26-38 href=#__codelineno-26-38></a><span class=o>}</span>
<a id=__codelineno-26-39 name=__codelineno-26-39 href=#__codelineno-26-39></a><span class=c1>#Perform incremental BACKUP Function Command</span>
<a id=__codelineno-26-40 name=__codelineno-26-40 href=#__codelineno-26-40></a>Add_Backup<span class=o>()</span>
<a id=__codelineno-26-41 name=__codelineno-26-41 href=#__codelineno-26-41></a><span class=o>{</span>
<a id=__codelineno-26-42 name=__codelineno-26-42 href=#__codelineno-26-42></a><span class=w>   </span><span class=nb>cd</span><span class=w> </span><span class=nv>$TARGET_DIR</span>/<span class=nv>$YEAR</span>/<span class=nv>$MONTH</span>/<span class=nv>$DAY</span><span class=w> </span><span class=p>;</span>
<a id=__codelineno-26-43 name=__codelineno-26-43 href=#__codelineno-26-43></a><span class=k>if</span>
<a id=__codelineno-26-44 name=__codelineno-26-44 href=#__codelineno-26-44></a><span class=w>    </span><span class=o>[</span><span class=w> </span>-f<span class=w> </span><span class=nv>$TARGET_DIR</span>/<span class=nv>$YEAR</span>/<span class=nv>$MONTH</span>/<span class=nv>$DAY</span>/<span class=nv>$FILES</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=k>then</span>
<a id=__codelineno-26-45 name=__codelineno-26-45 href=#__codelineno-26-45></a><span class=w>    </span><span class=nb>read</span><span class=w> </span>-p<span class=w> </span><span class=s2>&quot;</span><span class=nv>$FILES</span><span class=s2> Already Exists, overwrite confirmation yes or no ? : &quot;</span><span class=w> </span>SURE
<a id=__codelineno-26-46 name=__codelineno-26-46 href=#__codelineno-26-46></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=nv>$SURE</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s2>&quot;no&quot;</span><span class=w> </span>-o<span class=w> </span><span class=nv>$SURE</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s2>&quot;n&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=k>then</span>
<a id=__codelineno-26-47 name=__codelineno-26-47 href=#__codelineno-26-47></a><span class=w>    </span>sleep<span class=w> </span><span class=m>1</span><span class=p>;</span><span class=nb>exit</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-26-48 name=__codelineno-26-48 href=#__codelineno-26-48></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-26-49 name=__codelineno-26-49 href=#__codelineno-26-49></a><span class=c1>#Add_Backup Files System</span>
<a id=__codelineno-26-50 name=__codelineno-26-50 href=#__codelineno-26-50></a><span class=w>    </span><span class=k>if</span>
<a id=__codelineno-26-51 name=__codelineno-26-51 href=#__codelineno-26-51></a><span class=w>        </span><span class=o>[</span><span class=w> </span><span class=nv>$WEEK</span><span class=w> </span>-ne<span class=w> </span><span class=s2>&quot;7&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=k>then</span>
<a id=__codelineno-26-52 name=__codelineno-26-52 href=#__codelineno-26-52></a><span class=w>        </span><span class=nb>cd</span><span class=w> </span><span class=nv>$TARGET_DIR</span>/<span class=nv>$YEAR</span>/<span class=nv>$MONTH</span>/<span class=nv>$DAY</span><span class=p>;</span>tar<span class=w> </span>-g<span class=w> </span><span class=nv>$TARGET_DIR</span>/snapshot<span class=w> </span>-czvf<span class=w> </span><span class=nv>$$</span>_<span class=nv>$FILES</span><span class=w> </span><span class=sb>`</span><span class=nb>echo</span><span class=w> </span><span class=si>${</span><span class=nv>SOURCE_DIR</span><span class=p>[@]</span><span class=si>}</span><span class=sb>`</span>
<a id=__codelineno-26-53 name=__codelineno-26-53 href=#__codelineno-26-53></a><span class=w>        </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$CODE</span><span class=s2>&quot;</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s2>&quot;0&quot;</span><span class=w> </span><span class=o>]&amp;&amp;</span><span class=nb>echo</span><span class=w> </span>-e<span class=w>  </span><span class=s2>&quot;-----------------------------------------\n\033[32mAdd_Backup System Files Backup Successfully !\033[0m&quot;</span>
<a id=__codelineno-26-54 name=__codelineno-26-54 href=#__codelineno-26-54></a><span class=w>   </span><span class=k>fi</span>
<a id=__codelineno-26-55 name=__codelineno-26-55 href=#__codelineno-26-55></a><span class=k>else</span>
<a id=__codelineno-26-56 name=__codelineno-26-56 href=#__codelineno-26-56></a><span class=w>   </span><span class=k>if</span>
<a id=__codelineno-26-57 name=__codelineno-26-57 href=#__codelineno-26-57></a><span class=w>      </span><span class=o>[</span><span class=w> </span><span class=nv>$WEEK</span><span class=w> </span>-ne<span class=w> </span><span class=s2>&quot;7&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=k>then</span>
<a id=__codelineno-26-58 name=__codelineno-26-58 href=#__codelineno-26-58></a><span class=w>      </span><span class=nb>cd</span><span class=w> </span><span class=nv>$TARGET_DIR</span>/<span class=nv>$YEAR</span>/<span class=nv>$MONTH</span>/<span class=nv>$DAY</span><span class=w> </span><span class=p>;</span>tar<span class=w> </span>-g<span class=w> </span><span class=nv>$TARGET_DIR</span>/snapshot<span class=w> </span>-czvf<span class=w> </span><span class=nv>$FILES</span><span class=w> </span><span class=sb>`</span><span class=nb>echo</span><span class=w> </span><span class=si>${</span><span class=nv>SOURCE_DIR</span><span class=p>[@]</span><span class=si>}</span><span class=sb>`</span>
<a id=__codelineno-26-59 name=__codelineno-26-59 href=#__codelineno-26-59></a><span class=w>      </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$CODE</span><span class=s2>&quot;</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s2>&quot;0&quot;</span><span class=w> </span><span class=o>]&amp;&amp;</span><span class=nb>echo</span><span class=w> </span>-e<span class=w>  </span><span class=s2>&quot;-------------------------------------------\n\033[32mAdd_Backup System Files Backup Successfully !\033[0m&quot;</span>
<a id=__codelineno-26-60 name=__codelineno-26-60 href=#__codelineno-26-60></a><span class=w>   </span><span class=k>fi</span>
<a id=__codelineno-26-61 name=__codelineno-26-61 href=#__codelineno-26-61></a><span class=k>fi</span>
<a id=__codelineno-26-62 name=__codelineno-26-62 href=#__codelineno-26-62></a><span class=o>}</span>
<a id=__codelineno-26-63 name=__codelineno-26-63 href=#__codelineno-26-63></a>Full_Backup
<a id=__codelineno-26-64 name=__codelineno-26-64 href=#__codelineno-26-64></a>Add_Backup
<a id=__codelineno-26-65 name=__codelineno-26-65 href=#__codelineno-26-65></a>
<a id=__codelineno-26-66 name=__codelineno-26-66 href=#__codelineno-26-66></a>
<a id=__codelineno-26-67 name=__codelineno-26-67 href=#__codelineno-26-67></a><span class=c1># crontab计划任务中加入如下语句，每天凌晨1点整执行备份脚本。</span>
<a id=__codelineno-26-68 name=__codelineno-26-68 href=#__codelineno-26-68></a><span class=c1># 0 1 *  *  * /bin/sh /data/sh/Auto_Backup_Linux_System_Files.sh /boot /etc/ &gt;&gt; /tmp/back.log 2&gt;&amp;1</span>
</code></pre></div> <h2 id=19修改ip_主机名_网卡信息>19.修改IP_主机名_网卡信息<a class=headerlink href=#19修改ip_主机名_网卡信息 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a><span class=ch>#!/usr/bin/env bash</span>
<a id=__codelineno-27-2 name=__codelineno-27-2 href=#__codelineno-27-2></a>
<a id=__codelineno-27-3 name=__codelineno-27-3 href=#__codelineno-27-3></a><span class=c1>#静态IP修改</span>
<a id=__codelineno-27-4 name=__codelineno-27-4 href=#__codelineno-27-4></a><span class=c1>#动态IP修改</span>
<a id=__codelineno-27-5 name=__codelineno-27-5 href=#__codelineno-27-5></a><span class=c1>#根据IP生产主机名并配置</span>
<a id=__codelineno-27-6 name=__codelineno-27-6 href=#__codelineno-27-6></a><span class=c1>#修改DNS域名解析</span>
<a id=__codelineno-27-7 name=__codelineno-27-7 href=#__codelineno-27-7></a><span class=nv>ETHCONF</span><span class=o>=</span>/etc/sysconfig/network-scripts/ifcfg-ens32
<a id=__codelineno-27-8 name=__codelineno-27-8 href=#__codelineno-27-8></a><span class=nv>HOSTS</span><span class=o>=</span>/etc/hosts
<a id=__codelineno-27-9 name=__codelineno-27-9 href=#__codelineno-27-9></a><span class=nv>NETWORK</span><span class=o>=</span>/etc/sysconfig/network
<a id=__codelineno-27-10 name=__codelineno-27-10 href=#__codelineno-27-10></a><span class=nv>DIR</span><span class=o>=</span>/data/backup/<span class=sb>`</span>date<span class=w> </span>+%Y%m%d<span class=sb>`</span>
<a id=__codelineno-27-11 name=__codelineno-27-11 href=#__codelineno-27-11></a><span class=nv>NETMASK</span><span class=o>=</span><span class=m>255</span>.255.255.0
<a id=__codelineno-27-12 name=__codelineno-27-12 href=#__codelineno-27-12></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;------------------------------------------------------------------&quot;</span>
<a id=__codelineno-27-13 name=__codelineno-27-13 href=#__codelineno-27-13></a>judeg_ip<span class=o>(){</span>
<a id=__codelineno-27-14 name=__codelineno-27-14 href=#__codelineno-27-14></a><span class=w>    </span><span class=nb>read</span><span class=w> </span>-p<span class=w> </span><span class=s2>&quot;Please enter ip Address,example 192.168.0.11 ip&quot;</span>:IPADDR
<a id=__codelineno-27-15 name=__codelineno-27-15 href=#__codelineno-27-15></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=nv>$IPADDR</span><span class=p>|</span>grep<span class=w> </span>-v<span class=w> </span><span class=s2>&quot;[Az-Zz]&quot;</span><span class=p>|</span>grep<span class=w> </span>--color<span class=w> </span>-E<span class=w> </span><span class=s2>&quot;([0-9]{1,3}\.){3}[0-9]{1,3}&quot;</span>
<a id=__codelineno-27-16 name=__codelineno-27-16 href=#__codelineno-27-16></a><span class=o>}</span>
<a id=__codelineno-27-17 name=__codelineno-27-17 href=#__codelineno-27-17></a>
<a id=__codelineno-27-18 name=__codelineno-27-18 href=#__codelineno-27-18></a>count_ip<span class=o>(){</span>
<a id=__codelineno-27-19 name=__codelineno-27-19 href=#__codelineno-27-19></a><span class=w>    </span><span class=nv>count</span><span class=o>=(</span><span class=sb>`</span><span class=nb>echo</span><span class=w> </span><span class=si>${</span><span class=nv>IPADDR</span><span class=si>}</span><span class=p>|</span>awk<span class=w> </span>-F.<span class=w> </span><span class=s1>&#39;{print $1,$2,$3,$4}&#39;</span><span class=sb>`</span><span class=o>)</span>
<a id=__codelineno-27-20 name=__codelineno-27-20 href=#__codelineno-27-20></a><span class=w>    </span><span class=nv>IP1</span><span class=o>=</span><span class=si>${</span><span class=nv>count</span><span class=p>[0]</span><span class=si>}</span>
<a id=__codelineno-27-21 name=__codelineno-27-21 href=#__codelineno-27-21></a><span class=w>    </span><span class=nv>IP2</span><span class=o>=</span><span class=si>${</span><span class=nv>count</span><span class=p>[1]</span><span class=si>}</span>
<a id=__codelineno-27-22 name=__codelineno-27-22 href=#__codelineno-27-22></a><span class=w>    </span><span class=nv>IP3</span><span class=o>=</span><span class=si>${</span><span class=nv>count</span><span class=p>[2]</span><span class=si>}</span>
<a id=__codelineno-27-23 name=__codelineno-27-23 href=#__codelineno-27-23></a><span class=w>    </span><span class=nv>IP4</span><span class=o>=</span><span class=si>${</span><span class=nv>count</span><span class=p>[3]</span><span class=si>}</span>
<a id=__codelineno-27-24 name=__codelineno-27-24 href=#__codelineno-27-24></a><span class=o>}</span>
<a id=__codelineno-27-25 name=__codelineno-27-25 href=#__codelineno-27-25></a>
<a id=__codelineno-27-26 name=__codelineno-27-26 href=#__codelineno-27-26></a>
<a id=__codelineno-27-27 name=__codelineno-27-27 href=#__codelineno-27-27></a>ip_check<span class=o>(){</span>
<a id=__codelineno-27-28 name=__codelineno-27-28 href=#__codelineno-27-28></a>judeg_ip
<a id=__codelineno-27-29 name=__codelineno-27-29 href=#__codelineno-27-29></a>
<a id=__codelineno-27-30 name=__codelineno-27-30 href=#__codelineno-27-30></a><span class=k>while</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$?</span><span class=s2>&quot;</span><span class=w> </span>-ne<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>do</span>
<a id=__codelineno-27-31 name=__codelineno-27-31 href=#__codelineno-27-31></a><span class=w>    </span>judeg_ip
<a id=__codelineno-27-32 name=__codelineno-27-32 href=#__codelineno-27-32></a><span class=k>done</span>
<a id=__codelineno-27-33 name=__codelineno-27-33 href=#__codelineno-27-33></a>
<a id=__codelineno-27-34 name=__codelineno-27-34 href=#__codelineno-27-34></a>count_ip
<a id=__codelineno-27-35 name=__codelineno-27-35 href=#__codelineno-27-35></a><span class=k>while</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$IP1</span><span class=s2>&quot;</span><span class=w> </span>-lt<span class=w> </span><span class=m>0</span><span class=w> </span>-o<span class=w> </span><span class=s2>&quot;</span><span class=nv>$IP1</span><span class=s2>&quot;</span><span class=w> </span>-ge<span class=w> </span><span class=m>255</span><span class=w> </span>-o<span class=w> </span><span class=s2>&quot;</span><span class=nv>$IP2</span><span class=s2>&quot;</span><span class=w> </span>-ge<span class=w> </span><span class=m>255</span><span class=w> </span>-o<span class=w> </span><span class=s2>&quot;</span><span class=nv>$IP3</span><span class=s2>&quot;</span><span class=w> </span>-ge<span class=w> </span><span class=m>255</span><span class=w> </span>-o<span class=w> </span><span class=s2>&quot;</span><span class=nv>$IP4</span><span class=s2>&quot;</span><span class=w> </span>-ge<span class=w> </span><span class=m>255</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>do</span>
<a id=__codelineno-27-36 name=__codelineno-27-36 href=#__codelineno-27-36></a><span class=w>    </span>judeg_ip
<a id=__codelineno-27-37 name=__codelineno-27-37 href=#__codelineno-27-37></a><span class=w>    </span><span class=k>while</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$?</span><span class=s2>&quot;</span><span class=w> </span>-ne<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>do</span>
<a id=__codelineno-27-38 name=__codelineno-27-38 href=#__codelineno-27-38></a><span class=w>        </span>judeg_ip
<a id=__codelineno-27-39 name=__codelineno-27-39 href=#__codelineno-27-39></a><span class=w>    </span><span class=k>done</span>
<a id=__codelineno-27-40 name=__codelineno-27-40 href=#__codelineno-27-40></a><span class=w>    </span>count_ip
<a id=__codelineno-27-41 name=__codelineno-27-41 href=#__codelineno-27-41></a><span class=k>done</span>
<a id=__codelineno-27-42 name=__codelineno-27-42 href=#__codelineno-27-42></a><span class=o>}</span>
<a id=__codelineno-27-43 name=__codelineno-27-43 href=#__codelineno-27-43></a>
<a id=__codelineno-27-44 name=__codelineno-27-44 href=#__codelineno-27-44></a>
<a id=__codelineno-27-45 name=__codelineno-27-45 href=#__codelineno-27-45></a>change_ip<span class=o>(){</span>
<a id=__codelineno-27-46 name=__codelineno-27-46 href=#__codelineno-27-46></a>
<a id=__codelineno-27-47 name=__codelineno-27-47 href=#__codelineno-27-47></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>!<span class=w> </span>-d<span class=w> </span><span class=nv>$DIR</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-27-48 name=__codelineno-27-48 href=#__codelineno-27-48></a><span class=w>    </span>mkdir<span class=w> </span>-p<span class=w> </span><span class=nv>$DIR</span>
<a id=__codelineno-27-49 name=__codelineno-27-49 href=#__codelineno-27-49></a><span class=k>fi</span>
<a id=__codelineno-27-50 name=__codelineno-27-50 href=#__codelineno-27-50></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;The Change ip address to Backup Interface eth0&quot;</span>
<a id=__codelineno-27-51 name=__codelineno-27-51 href=#__codelineno-27-51></a>cp<span class=w> </span><span class=nv>$ETHCONF</span><span class=w> </span><span class=nv>$DIR</span>
<a id=__codelineno-27-52 name=__codelineno-27-52 href=#__codelineno-27-52></a>grep<span class=w> </span><span class=s2>&quot;dhcp&quot;</span><span class=w> </span><span class=nv>$ETHCONF</span>
<a id=__codelineno-27-53 name=__codelineno-27-53 href=#__codelineno-27-53></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$?</span><span class=s2>&quot;</span><span class=w> </span>-eq<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-27-54 name=__codelineno-27-54 href=#__codelineno-27-54></a><span class=w>    </span><span class=nb>read</span><span class=w> </span>-p<span class=w> </span><span class=s2>&quot;Please enter ip Address:&quot;</span><span class=w> </span>IPADDR
<a id=__codelineno-27-55 name=__codelineno-27-55 href=#__codelineno-27-55></a><span class=w>    </span>sed<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;s/dhcp/static/g&#39;</span><span class=w> </span><span class=nv>$ETHCONF</span>
<a id=__codelineno-27-56 name=__codelineno-27-56 href=#__codelineno-27-56></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;IPADDR=</span><span class=nv>$IPADDR</span><span class=s2>\nNERMASK=</span><span class=nv>$NETMASK</span><span class=s2>\nGATEWAY=`echo </span><span class=nv>$IPADDR</span><span class=s2>|awk -F. &#39;{print </span><span class=nv>$1</span><span class=s2>&quot;</span>.<span class=s2>&quot;</span><span class=nv>$2</span><span class=s2>&quot;</span>.<span class=s2>&quot;</span><span class=nv>$3</span><span class=s2>}&#39;`.2&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span><span class=nv>$ETHCONF</span>
<a id=__codelineno-27-57 name=__codelineno-27-57 href=#__codelineno-27-57></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;The IP configuration success. !&quot;</span>
<a id=__codelineno-27-58 name=__codelineno-27-58 href=#__codelineno-27-58></a><span class=k>else</span>
<a id=__codelineno-27-59 name=__codelineno-27-59 href=#__codelineno-27-59></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;Static IP has been configured,please confirm whether to modify,yes or No&quot;</span><span class=p>;</span>
<a id=__codelineno-27-60 name=__codelineno-27-60 href=#__codelineno-27-60></a><span class=w>    </span><span class=nb>read</span><span class=w> </span>i
<a id=__codelineno-27-61 name=__codelineno-27-61 href=#__codelineno-27-61></a><span class=k>fi</span>
<a id=__codelineno-27-62 name=__codelineno-27-62 href=#__codelineno-27-62></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$i</span><span class=s2>&quot;</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s2>&quot;y&quot;</span><span class=w> </span>-o<span class=w> </span><span class=s2>&quot;</span><span class=nv>$i</span><span class=s2>&quot;</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s2>&quot;yes&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-27-63 name=__codelineno-27-63 href=#__codelineno-27-63></a><span class=w>    </span>ip_check
<a id=__codelineno-27-64 name=__codelineno-27-64 href=#__codelineno-27-64></a><span class=w>    </span>sed<span class=w> </span>-i<span class=w> </span>-e<span class=w> </span><span class=s1>&#39;/IPADDR/d&#39;</span><span class=w> </span>-e<span class=w> </span><span class=s1>&#39;/NETMASK/d&#39;</span><span class=w> </span>-e<span class=w> </span><span class=s1>&#39;/GATEWAY/d&#39;</span><span class=w> </span><span class=nv>$ETHCONF</span>
<a id=__codelineno-27-65 name=__codelineno-27-65 href=#__codelineno-27-65></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;IPADDR=</span><span class=nv>$IPADDR</span><span class=s2>\nNETMASK=</span><span class=nv>$NETMASK</span><span class=s2>\nGATEWAY=`echo  </span><span class=nv>$IPADDR</span><span class=s2>|awk -F. &#39;{print </span><span class=nv>$1</span><span class=s2>&quot;</span>.<span class=s2>&quot;</span><span class=nv>$2</span><span class=s2>&quot;</span>.<span class=s2>&quot;</span><span class=nv>$3</span><span class=s2>}&#39;`.2&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span><span class=nv>$ETHCONF</span>
<a id=__codelineno-27-66 name=__codelineno-27-66 href=#__codelineno-27-66></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;The IP configuration success. !&quot;</span>
<a id=__codelineno-27-67 name=__codelineno-27-67 href=#__codelineno-27-67></a><span class=w>    </span><span class=nb>echo</span>
<a id=__codelineno-27-68 name=__codelineno-27-68 href=#__codelineno-27-68></a><span class=k>else</span>
<a id=__codelineno-27-69 name=__codelineno-27-69 href=#__codelineno-27-69></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Static IP already exists,please exit.&quot;</span>
<a id=__codelineno-27-70 name=__codelineno-27-70 href=#__codelineno-27-70></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=nv>$?</span>
<a id=__codelineno-27-71 name=__codelineno-27-71 href=#__codelineno-27-71></a><span class=k>fi</span>
<a id=__codelineno-27-72 name=__codelineno-27-72 href=#__codelineno-27-72></a><span class=o>}</span>
<a id=__codelineno-27-73 name=__codelineno-27-73 href=#__codelineno-27-73></a>
<a id=__codelineno-27-74 name=__codelineno-27-74 href=#__codelineno-27-74></a>change_hosts<span class=o>(){</span>
<a id=__codelineno-27-75 name=__codelineno-27-75 href=#__codelineno-27-75></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>!<span class=w> </span>-d<span class=w> </span><span class=nv>$DIR</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-27-76 name=__codelineno-27-76 href=#__codelineno-27-76></a><span class=w>        </span>mkdir<span class=w> </span>-p<span class=w> </span><span class=nv>$DIR</span>
<a id=__codelineno-27-77 name=__codelineno-27-77 href=#__codelineno-27-77></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-27-78 name=__codelineno-27-78 href=#__codelineno-27-78></a><span class=w>    </span>cp<span class=w> </span><span class=nv>$HOSTS</span><span class=w> </span><span class=nv>$DIR</span>
<a id=__codelineno-27-79 name=__codelineno-27-79 href=#__codelineno-27-79></a><span class=w>    </span>ip_check
<a id=__codelineno-27-80 name=__codelineno-27-80 href=#__codelineno-27-80></a><span class=w>    </span><span class=nv>host</span><span class=o>=</span><span class=sb>`</span><span class=nb>echo</span><span class=w> </span><span class=nv>$IPADDR</span><span class=p>|</span>sed<span class=w> </span><span class=s1>&#39;s/\./-/g&#39;</span><span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;{print &quot;BJ-IDC-&quot; $0 &quot;-Hujianli.net&quot;}&#39;</span><span class=sb>`</span>
<a id=__codelineno-27-81 name=__codelineno-27-81 href=#__codelineno-27-81></a><span class=w>    </span>cat<span class=w> </span><span class=nv>$HOSTS</span><span class=p>|</span>grep<span class=w> </span><span class=s2>&quot;</span><span class=nv>$host</span><span class=s2>&quot;</span>
<a id=__codelineno-27-82 name=__codelineno-27-82 href=#__codelineno-27-82></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$?</span><span class=s2>&quot;</span><span class=w> </span>-ne<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-27-83 name=__codelineno-27-83 href=#__codelineno-27-83></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$IPADDR</span><span class=s2>    </span><span class=nv>$host</span><span class=s2>&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span><span class=nv>$HOSTS</span>
<a id=__codelineno-27-84 name=__codelineno-27-84 href=#__codelineno-27-84></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;The hosts modify success&quot;</span>
<a id=__codelineno-27-85 name=__codelineno-27-85 href=#__codelineno-27-85></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-27-86 name=__codelineno-27-86 href=#__codelineno-27-86></a><span class=w>    </span>grep<span class=w> </span><span class=s2>&quot;</span><span class=nv>$host</span><span class=s2>&quot;</span><span class=w> </span><span class=nv>$NETWORK</span>
<a id=__codelineno-27-87 name=__codelineno-27-87 href=#__codelineno-27-87></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$?</span><span class=s2>&quot;</span><span class=w> </span>-ne<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-27-88 name=__codelineno-27-88 href=#__codelineno-27-88></a><span class=w>        </span>sed<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;s/^HOSTNAME/#HOSTNAME/g&#39;</span><span class=w> </span><span class=nv>$NETWORK</span>
<a id=__codelineno-27-89 name=__codelineno-27-89 href=#__codelineno-27-89></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;NETWORK=</span><span class=nv>$host</span><span class=s2>&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span><span class=nv>$NETWORK</span>
<a id=__codelineno-27-90 name=__codelineno-27-90 href=#__codelineno-27-90></a><span class=w>        </span>hostname<span class=w> </span><span class=nv>$host</span><span class=p>;</span>su
<a id=__codelineno-27-91 name=__codelineno-27-91 href=#__codelineno-27-91></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-27-92 name=__codelineno-27-92 href=#__codelineno-27-92></a><span class=o>}</span>
<a id=__codelineno-27-93 name=__codelineno-27-93 href=#__codelineno-27-93></a>
<a id=__codelineno-27-94 name=__codelineno-27-94 href=#__codelineno-27-94></a>
<a id=__codelineno-27-95 name=__codelineno-27-95 href=#__codelineno-27-95></a><span class=nv>PS3</span><span class=o>=</span><span class=s2>&quot;Please Select configuration ip or configuration host:&quot;</span>
<a id=__codelineno-27-96 name=__codelineno-27-96 href=#__codelineno-27-96></a><span class=k>select</span><span class=w> </span>i<span class=w> </span><span class=k>in</span><span class=w> </span><span class=s2>&quot;modify_ip&quot;</span><span class=w> </span><span class=s2>&quot;modify_hosts&quot;</span><span class=w> </span><span class=s2>&quot;exit&quot;</span>
<a id=__codelineno-27-97 name=__codelineno-27-97 href=#__codelineno-27-97></a><span class=k>do</span>
<a id=__codelineno-27-98 name=__codelineno-27-98 href=#__codelineno-27-98></a><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$i</span><span class=s2>&quot;</span><span class=w> </span><span class=k>in</span>
<a id=__codelineno-27-99 name=__codelineno-27-99 href=#__codelineno-27-99></a><span class=w>    </span>modify_ip<span class=o>)</span>
<a id=__codelineno-27-100 name=__codelineno-27-100 href=#__codelineno-27-100></a><span class=w>        </span>change_ip
<a id=__codelineno-27-101 name=__codelineno-27-101 href=#__codelineno-27-101></a><span class=w>       </span><span class=p>;;</span>
<a id=__codelineno-27-102 name=__codelineno-27-102 href=#__codelineno-27-102></a><span class=w>    </span>modify_hosts<span class=o>)</span>
<a id=__codelineno-27-103 name=__codelineno-27-103 href=#__codelineno-27-103></a><span class=w>        </span>change_hosts
<a id=__codelineno-27-104 name=__codelineno-27-104 href=#__codelineno-27-104></a><span class=w>       </span><span class=p>;;</span>
<a id=__codelineno-27-105 name=__codelineno-27-105 href=#__codelineno-27-105></a><span class=w>    </span><span class=nb>exit</span><span class=o>)</span>
<a id=__codelineno-27-106 name=__codelineno-27-106 href=#__codelineno-27-106></a><span class=w>        </span><span class=nb>exit</span>
<a id=__codelineno-27-107 name=__codelineno-27-107 href=#__codelineno-27-107></a><span class=w>       </span><span class=p>;;</span>
<a id=__codelineno-27-108 name=__codelineno-27-108 href=#__codelineno-27-108></a><span class=w>    </span>*<span class=o>)</span>
<a id=__codelineno-27-109 name=__codelineno-27-109 href=#__codelineno-27-109></a><span class=w>       </span><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;1)modify_ip\n2)modify_host\n3)exit&quot;</span>
<a id=__codelineno-27-110 name=__codelineno-27-110 href=#__codelineno-27-110></a><span class=w>    </span><span class=k>esac</span>
<a id=__codelineno-27-111 name=__codelineno-27-111 href=#__codelineno-27-111></a><span class=k>done</span>
</code></pre></div> <h2 id=20检查恶意ip登录拒绝ssh>20.检查恶意IP登录，拒绝SSH<a class=headerlink href=#20检查恶意ip登录拒绝ssh title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a><span class=ch>#!/usr/bin/env bash</span>
<a id=__codelineno-28-2 name=__codelineno-28-2 href=#__codelineno-28-2></a><span class=c1>#usage:xxx</span>
<a id=__codelineno-28-3 name=__codelineno-28-3 href=#__codelineno-28-3></a><span class=c1>#scripts_name:xxx.sh</span>
<a id=__codelineno-28-4 name=__codelineno-28-4 href=#__codelineno-28-4></a><span class=nv>SEC_FILE</span><span class=o>=</span>/var/log/secure
<a id=__codelineno-28-5 name=__codelineno-28-5 href=#__codelineno-28-5></a><span class=nv>IP_ADDR</span><span class=o>=</span><span class=sb>`</span>awk<span class=w> </span><span class=s1>&#39;{print $0}&#39;</span><span class=w> </span>/var/log/secure<span class=w> </span><span class=p>|</span>grep<span class=w> </span>-i<span class=w> </span><span class=s2>&quot;fail&quot;</span><span class=p>|</span>egrep<span class=w> </span>-o<span class=w> </span><span class=s2>&quot;([0-9]{1,3}\.){3}[0-9]{1,3}&quot;</span><span class=p>|</span>sort<span class=w> </span>-nr<span class=p>|</span>uniq<span class=w> </span>-c<span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;$1&gt;=15 {prin</span>
<a id=__codelineno-28-6 name=__codelineno-28-6 href=#__codelineno-28-6></a><span class=s1>t $2}&#39;</span><span class=sb>`</span>
<a id=__codelineno-28-7 name=__codelineno-28-7 href=#__codelineno-28-7></a><span class=nv>IPTABLE_CONF</span><span class=o>=</span>/etc/sysconfig/iptables
<a id=__codelineno-28-8 name=__codelineno-28-8 href=#__codelineno-28-8></a><span class=nb>echo</span>
<a id=__codelineno-28-9 name=__codelineno-28-9 href=#__codelineno-28-9></a>
<a id=__codelineno-28-10 name=__codelineno-28-10 href=#__codelineno-28-10></a>cat<span class=w> </span><span class=s>&lt;&lt;EOF</span>
<a id=__codelineno-28-11 name=__codelineno-28-11 href=#__codelineno-28-11></a><span class=s>+++++++++++++++++++++++++++++++++++++= Welcome to yse ssh login drop failed ip ++++++++++++++++++++++++++++++</span>
<a id=__codelineno-28-12 name=__codelineno-28-12 href=#__codelineno-28-12></a><span class=s>++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>
<a id=__codelineno-28-13 name=__codelineno-28-13 href=#__codelineno-28-13></a><span class=s>+++++++++++++++++++++++++++++++++++-----------------------------------------------=++++++++++++++++++++++++++</span>
<a id=__codelineno-28-14 name=__codelineno-28-14 href=#__codelineno-28-14></a><span class=s>EOF</span>
<a id=__codelineno-28-15 name=__codelineno-28-15 href=#__codelineno-28-15></a><span class=nb>echo</span>
<a id=__codelineno-28-16 name=__codelineno-28-16 href=#__codelineno-28-16></a><span class=k>for</span><span class=w> </span><span class=o>((</span><span class=w> </span><span class=nv>VAR</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>0</span><span class=p>;</span><span class=w> </span>VAR<span class=w> </span>&lt;<span class=o>=</span><span class=m>6</span><span class=w> </span><span class=p>;</span><span class=w> </span>++VAR<span class=w> </span><span class=o>))</span><span class=p>;</span><span class=w> </span><span class=k>do</span><span class=w> </span><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;-&quot;</span><span class=p>;</span>sleep<span class=w> </span><span class=m>1</span><span class=p>;</span><span class=k>done</span>
<a id=__codelineno-28-17 name=__codelineno-28-17 href=#__codelineno-28-17></a><span class=nb>echo</span>
<a id=__codelineno-28-18 name=__codelineno-28-18 href=#__codelineno-28-18></a><span class=k>for</span><span class=w> </span>i<span class=w> </span><span class=k>in</span><span class=w> </span><span class=sb>`</span>cat<span class=w> </span><span class=nv>$IP_ADDR</span><span class=sb>`</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>do</span>
<a id=__codelineno-28-19 name=__codelineno-28-19 href=#__codelineno-28-19></a><span class=w>    </span>cat<span class=w> </span><span class=nv>$IPTABLE_CONF</span><span class=p>|</span>grep<span class=w> </span><span class=nv>$i</span><span class=w> </span>&gt;<span class=w> </span>/dev/null
<a id=__codelineno-28-20 name=__codelineno-28-20 href=#__codelineno-28-20></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$?</span><span class=s2>&quot;</span><span class=w> </span>-ne<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-28-21 name=__codelineno-28-21 href=#__codelineno-28-21></a><span class=w>        </span>sed<span class=w> </span>-i<span class=w> </span><span class=s2>&quot;/lo/a -A INPUT -s </span><span class=nv>$i</span><span class=s2> -m state --state NEW -m tcp -p tcp --dport 22 -j DROP&quot;</span><span class=w> </span><span class=nv>$IPTABLE_CONF</span>
<a id=__codelineno-28-22 name=__codelineno-28-22 href=#__codelineno-28-22></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-28-23 name=__codelineno-28-23 href=#__codelineno-28-23></a><span class=k>done</span>
<a id=__codelineno-28-24 name=__codelineno-28-24 href=#__codelineno-28-24></a><span class=nv>NUM</span><span class=o>=</span><span class=sb>`</span>find<span class=w> </span>/etc/sysconfig/<span class=w> </span>-<span class=w> </span>name<span class=w> </span>-a<span class=w> </span>-mmin<span class=w> </span>-1<span class=p>|</span>wc<span class=w> </span>-l<span class=w> </span><span class=sb>`</span>
<a id=__codelineno-28-25 name=__codelineno-28-25 href=#__codelineno-28-25></a>
<a id=__codelineno-28-26 name=__codelineno-28-26 href=#__codelineno-28-26></a><span class=k>if</span><span class=w> </span><span class=nb>test</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$NUM</span><span class=s2>&quot;</span><span class=w> </span>-eq<span class=w> </span><span class=m>1</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-28-27 name=__codelineno-28-27 href=#__codelineno-28-27></a><span class=w>     </span>/etc/init.d/iptables<span class=w> </span>restart
<a id=__codelineno-28-28 name=__codelineno-28-28 href=#__codelineno-28-28></a><span class=k>fi</span>
</code></pre></div> <h2 id=21数据库备份>21.数据库备份<a class=headerlink href=#21数据库备份 title="Permanent link">&para;</a></h2> <h3 id=备份数据库>备份数据库<a class=headerlink href=#备份数据库 title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-29-1 name=__codelineno-29-1 href=#__codelineno-29-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-29-2 name=__codelineno-29-2 href=#__codelineno-29-2></a><span class=c1>#</span>
<a id=__codelineno-29-3 name=__codelineno-29-3 href=#__codelineno-29-3></a><span class=c1># Filename:</span>
<a id=__codelineno-29-4 name=__codelineno-29-4 href=#__codelineno-29-4></a><span class=c1># backupdatabase.sh</span>
<a id=__codelineno-29-5 name=__codelineno-29-5 href=#__codelineno-29-5></a><span class=c1># Description:</span>
<a id=__codelineno-29-6 name=__codelineno-29-6 href=#__codelineno-29-6></a><span class=c1># backup cms database and remove backup data before 7 days</span>
<a id=__codelineno-29-7 name=__codelineno-29-7 href=#__codelineno-29-7></a><span class=c1># crontab</span>
<a id=__codelineno-29-8 name=__codelineno-29-8 href=#__codelineno-29-8></a><span class=c1># 55 23 * * * /bin/sh /yundisk/cms/crontab/backupdatabase.sh &gt;&gt; /yundisk/cms/crontab/backupdatabase.log 2&gt;&amp;1</span>
<a id=__codelineno-29-9 name=__codelineno-29-9 href=#__codelineno-29-9></a>
<a id=__codelineno-29-10 name=__codelineno-29-10 href=#__codelineno-29-10></a><span class=nv>DATE</span><span class=o>=</span><span class=sb>`</span>date<span class=w> </span>+%Y-%m-%d<span class=sb>`</span>
<a id=__codelineno-29-11 name=__codelineno-29-11 href=#__codelineno-29-11></a><span class=nv>OLDDATE</span><span class=o>=</span><span class=sb>`</span>date<span class=w> </span>+%Y-%m-%d<span class=w> </span>-d<span class=w> </span><span class=s1>&#39;-7 days&#39;</span><span class=sb>`</span>
<a id=__codelineno-29-12 name=__codelineno-29-12 href=#__codelineno-29-12></a>
<a id=__codelineno-29-13 name=__codelineno-29-13 href=#__codelineno-29-13></a><span class=c1>#MYSQL=/usr/local/mysql/bin/mysql</span>
<a id=__codelineno-29-14 name=__codelineno-29-14 href=#__codelineno-29-14></a><span class=c1>#MYSQLDUMP=/usr/local/mysql/bin/mysqldump</span>
<a id=__codelineno-29-15 name=__codelineno-29-15 href=#__codelineno-29-15></a><span class=c1>#MYSQLADMIN=/usr/local/mysql/bin/mysqladmin</span>
<a id=__codelineno-29-16 name=__codelineno-29-16 href=#__codelineno-29-16></a>
<a id=__codelineno-29-17 name=__codelineno-29-17 href=#__codelineno-29-17></a><span class=nv>BACKDIR</span><span class=o>=</span>/yundisk/cms/database
<a id=__codelineno-29-18 name=__codelineno-29-18 href=#__codelineno-29-18></a><span class=o>[</span><span class=w> </span>-d<span class=w> </span><span class=si>${</span><span class=nv>BACKDIR</span><span class=si>}</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>||</span><span class=w> </span>mkdir<span class=w> </span>-p<span class=w> </span><span class=si>${</span><span class=nv>BACKDIR</span><span class=si>}</span>
<a id=__codelineno-29-19 name=__codelineno-29-19 href=#__codelineno-29-19></a><span class=o>[</span><span class=w> </span>-d<span class=w> </span><span class=si>${</span><span class=nv>BACKDIR</span><span class=si>}</span>/<span class=si>${</span><span class=nv>DATE</span><span class=si>}</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>||</span><span class=w> </span>mkdir<span class=w> </span><span class=si>${</span><span class=nv>BACKDIR</span><span class=si>}</span>/<span class=si>${</span><span class=nv>DATE</span><span class=si>}</span>
<a id=__codelineno-29-20 name=__codelineno-29-20 href=#__codelineno-29-20></a><span class=o>[</span><span class=w> </span>!<span class=w> </span>-d<span class=w> </span><span class=si>${</span><span class=nv>BACKDIR</span><span class=si>}</span>/<span class=si>${</span><span class=nv>OLDDATE</span><span class=si>}</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>||</span><span class=w> </span>rm<span class=w> </span>-rf<span class=w> </span><span class=si>${</span><span class=nv>BACKDIR</span><span class=si>}</span>/<span class=si>${</span><span class=nv>OLDDATE</span><span class=si>}</span>
<a id=__codelineno-29-21 name=__codelineno-29-21 href=#__codelineno-29-21></a>
<a id=__codelineno-29-22 name=__codelineno-29-22 href=#__codelineno-29-22></a>mysqldump<span class=w> </span>--default-character-set<span class=o>=</span>utf8<span class=w> </span>--no-autocommit<span class=w> </span>--quick<span class=w> </span>--hex-blob<span class=w> </span>--single-transaction<span class=w> </span>-uroot<span class=w>  </span>cms_production<span class=w>  </span><span class=p>|</span><span class=w> </span>gzip<span class=w> </span>&gt;<span class=w> </span><span class=si>${</span><span class=nv>BACKDIR</span><span class=si>}</span>/<span class=si>${</span><span class=nv>DATE</span><span class=si>}</span>/cms-backup-<span class=si>${</span><span class=nv>DATE</span><span class=si>}</span>.sql.gz
<a id=__codelineno-29-23 name=__codelineno-29-23 href=#__codelineno-29-23></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Database cms_production and bbs has been backup successful&quot;</span>
<a id=__codelineno-29-24 name=__codelineno-29-24 href=#__codelineno-29-24></a>/bin/sleep<span class=w> </span><span class=m>5</span>
<a id=__codelineno-29-25 name=__codelineno-29-25 href=#__codelineno-29-25></a>
<a id=__codelineno-29-26 name=__codelineno-29-26 href=#__codelineno-29-26></a>aws<span class=w> </span>s3<span class=w> </span>cp<span class=w> </span><span class=si>${</span><span class=nv>BACKDIR</span><span class=si>}</span>/<span class=si>${</span><span class=nv>DATE</span><span class=si>}</span>/*<span class=w> </span>s3://example-share/cms/databackup/
</code></pre></div> <div class="admonition example"> <p class=admonition-title>参考文献</p> <p><a href=http://www.04007.cn/article/1050.html>使用mysqldump进行mysql数据库备份的完整shell</a> <a href=https://www.naraku.cn/posts/92.html>Linux定时备份数据库到COS</a></p> </div> <h3 id=mysql定时备份脚本>MySQL定时备份脚本<a class=headerlink href=#mysql定时备份脚本 title="Permanent link">&para;</a></h3> <p><div class=highlight><pre><span></span><code><a id=__codelineno-30-1 name=__codelineno-30-1 href=#__codelineno-30-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-30-2 name=__codelineno-30-2 href=#__codelineno-30-2></a><span class=c1># 初始化时，创建相应目录</span>
<a id=__codelineno-30-3 name=__codelineno-30-3 href=#__codelineno-30-3></a><span class=c1># mkdir /home/node/bakmysql/sql/</span>
<a id=__codelineno-30-4 name=__codelineno-30-4 href=#__codelineno-30-4></a>
<a id=__codelineno-30-5 name=__codelineno-30-5 href=#__codelineno-30-5></a><span class=c1># 定时任务</span>
<a id=__codelineno-30-6 name=__codelineno-30-6 href=#__codelineno-30-6></a><span class=c1># 每天凌晨1:00执行备份脚本</span>
<a id=__codelineno-30-7 name=__codelineno-30-7 href=#__codelineno-30-7></a><span class=c1>#0 1 * * * /bin/bash -x /home/node/bakmysql/backup.sh &gt;/dev/null 2&gt;&amp;1</span>
<a id=__codelineno-30-8 name=__codelineno-30-8 href=#__codelineno-30-8></a><span class=c1>#2分钟运行一次-测试用</span>
<a id=__codelineno-30-9 name=__codelineno-30-9 href=#__codelineno-30-9></a><span class=c1>#*/2 * * * * /bin/bash -x /home/node/bakmysql/backup.sh &gt;/dev/null 2&gt;&amp;1</span>
<a id=__codelineno-30-10 name=__codelineno-30-10 href=#__codelineno-30-10></a>
<a id=__codelineno-30-11 name=__codelineno-30-11 href=#__codelineno-30-11></a><span class=nv>BakDir</span><span class=o>=</span>/home/node/bakmysql/sql
<a id=__codelineno-30-12 name=__codelineno-30-12 href=#__codelineno-30-12></a><span class=nv>LogFile</span><span class=o>=</span>/home/node/bakmysql/sql/bak.log
<a id=__codelineno-30-13 name=__codelineno-30-13 href=#__codelineno-30-13></a><span class=nv>Date</span><span class=o>=</span><span class=sb>`</span>date<span class=w> </span>+%Y%m%d<span class=sb>`</span>
<a id=__codelineno-30-14 name=__codelineno-30-14 href=#__codelineno-30-14></a><span class=nv>Begin</span><span class=o>=</span><span class=sb>`</span>date<span class=w> </span>+<span class=s2>&quot;%Y年%m月%d日 %H:%M:%S&quot;</span><span class=sb>`</span>
<a id=__codelineno-30-15 name=__codelineno-30-15 href=#__codelineno-30-15></a><span class=nb>cd</span><span class=w> </span><span class=nv>$BakDir</span>
<a id=__codelineno-30-16 name=__codelineno-30-16 href=#__codelineno-30-16></a><span class=nv>DumpFile</span><span class=o>=</span><span class=nv>$Date</span>.sql
<a id=__codelineno-30-17 name=__codelineno-30-17 href=#__codelineno-30-17></a>
<a id=__codelineno-30-18 name=__codelineno-30-18 href=#__codelineno-30-18></a>
<a id=__codelineno-30-19 name=__codelineno-30-19 href=#__codelineno-30-19></a><span class=c1># 导出到本地</span>
<a id=__codelineno-30-20 name=__codelineno-30-20 href=#__codelineno-30-20></a>mysqldump<span class=w> </span>-uroot<span class=w> </span>-p123456<span class=w> </span><span class=nb>test</span><span class=w> </span>--quick<span class=w> </span>--single-transaction<span class=w> </span><span class=p>|</span><span class=w> </span>gzip<span class=w> </span>&gt;<span class=w> </span><span class=nv>$DumpFile</span>.gz
<a id=__codelineno-30-21 name=__codelineno-30-21 href=#__codelineno-30-21></a><span class=nv>Last</span><span class=o>=</span><span class=sb>`</span>date<span class=w> </span>+<span class=s2>&quot;%Y年%m月%d日 %H:%M:%S&quot;</span><span class=sb>`</span>
<a id=__codelineno-30-22 name=__codelineno-30-22 href=#__codelineno-30-22></a><span class=nb>echo</span><span class=w> </span><span class=o>[</span>FullBack<span class=o>]</span><span class=w> </span>开始:<span class=nv>$Begin</span><span class=w> </span>结束:<span class=nv>$Last</span><span class=w> </span><span class=nv>$DumpFile</span>.gz<span class=w> </span>successful<span class=w> </span>&gt;&gt;<span class=w> </span><span class=nv>$LogFile</span>
<a id=__codelineno-30-23 name=__codelineno-30-23 href=#__codelineno-30-23></a>
<a id=__codelineno-30-24 name=__codelineno-30-24 href=#__codelineno-30-24></a>
<a id=__codelineno-30-25 name=__codelineno-30-25 href=#__codelineno-30-25></a><span class=c1># 删除7天前的备份文件</span>
<a id=__codelineno-30-26 name=__codelineno-30-26 href=#__codelineno-30-26></a>find<span class=w> </span><span class=nv>$BakDir</span><span class=w> </span>-mtime<span class=w> </span>+7<span class=w> </span>-type<span class=w> </span>f<span class=w> </span>-name<span class=w> </span><span class=s2>&quot;*.sql.gz&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>xargs<span class=w> </span>rm<span class=w> </span>-f
</code></pre></div> 你需要做的就是修改数据库配置，然后就是配置一下定时任务即可</p> <h3 id=mysql数据库分库备份>MySQL数据库分库备份<a class=headerlink href=#mysql数据库分库备份 title="Permanent link">&para;</a></h3> <p>数据库密码保存在/etc/my.cnf文件中，所以在执行与mysql相关的命令不需要输入密码</p> <p>分库备份思路： <div class=highlight><pre><span></span><code><a id=__codelineno-31-1 name=__codelineno-31-1 href=#__codelineno-31-1></a>mysqldump<span class=w>  </span>db1<span class=w> </span>&gt;db1.sql.gz
<a id=__codelineno-31-2 name=__codelineno-31-2 href=#__codelineno-31-2></a>mysqldump<span class=w>  </span>db2<span class=w> </span>&gt;db2.sql.gz
</code></pre></div></p> <p>拿到库名 <div class=highlight><pre><span></span><code><a id=__codelineno-32-1 name=__codelineno-32-1 href=#__codelineno-32-1></a>mysql<span class=w>  </span>-e<span class=w> </span><span class=s1>&#39;show databases&#39;</span><span class=w> </span><span class=p>|</span>sed<span class=w> </span><span class=s1>&#39;1d&#39;</span><span class=w> </span><span class=p>|</span>grep<span class=w> </span>-v<span class=w> </span><span class=s2>&quot;_schema&quot;</span>
</code></pre></div></p> <p>注意看注释信息</p> <div class=highlight><pre><span></span><code><a id=__codelineno-33-1 name=__codelineno-33-1 href=#__codelineno-33-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-33-2 name=__codelineno-33-2 href=#__codelineno-33-2></a><span class=c1># author: xiongminghao</span>
<a id=__codelineno-33-3 name=__codelineno-33-3 href=#__codelineno-33-3></a><span class=c1># mail: jasonminghao@163.com</span>
<a id=__codelineno-33-4 name=__codelineno-33-4 href=#__codelineno-33-4></a><span class=c1># describe：Mysql database backup</span>
<a id=__codelineno-33-5 name=__codelineno-33-5 href=#__codelineno-33-5></a><span class=c1># 定义变量</span>
<a id=__codelineno-33-6 name=__codelineno-33-6 href=#__codelineno-33-6></a><span class=nv>IP</span><span class=o>=</span><span class=k>$(</span>ifconfig<span class=w> </span>eth1<span class=w> </span><span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;NR==2{print $2}&#39;</span><span class=k>)</span>
<a id=__codelineno-33-7 name=__codelineno-33-7 href=#__codelineno-33-7></a><span class=nv>Path</span><span class=o>=</span>/backup/database<span class=w>  </span><span class=c1># 备份目录路径</span>
<a id=__codelineno-33-8 name=__codelineno-33-8 href=#__codelineno-33-8></a><span class=nv>Time</span><span class=o>=</span><span class=k>$(</span>date<span class=w> </span>+%F<span class=k>)</span>
<a id=__codelineno-33-9 name=__codelineno-33-9 href=#__codelineno-33-9></a><span class=nv>Ba_Path</span><span class=o>=</span><span class=nv>$Path</span>/<span class=nv>$Time</span>
<a id=__codelineno-33-10 name=__codelineno-33-10 href=#__codelineno-33-10></a><span class=nv>Ba_Logs</span><span class=o>=</span>/var/log/db_database_<span class=nv>$Time</span><span class=w> </span><span class=c1># 定义一个存放日志的文件</span>
<a id=__codelineno-33-11 name=__codelineno-33-11 href=#__codelineno-33-11></a><span class=nv>Md5_Path</span><span class=o>=</span><span class=nv>$Path</span>/<span class=nv>$Time</span>/md5<span class=w> </span><span class=c1># 定义一个存放md5校验的目录</span>
<a id=__codelineno-33-12 name=__codelineno-33-12 href=#__codelineno-33-12></a>
<a id=__codelineno-33-13 name=__codelineno-33-13 href=#__codelineno-33-13></a>
<a id=__codelineno-33-14 name=__codelineno-33-14 href=#__codelineno-33-14></a><span class=c1># 创建两个目录以当天时间为命名</span>
<a id=__codelineno-33-15 name=__codelineno-33-15 href=#__codelineno-33-15></a><span class=o>[</span><span class=w> </span>!<span class=w> </span>-d<span class=w> </span><span class=nv>$Ba_Path</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>mkdir<span class=w> </span><span class=nv>$Ba_Path</span>
<a id=__codelineno-33-16 name=__codelineno-33-16 href=#__codelineno-33-16></a><span class=o>[</span><span class=w> </span>!<span class=w> </span>-d<span class=w> </span><span class=nv>$Md5_Path</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>mkdir<span class=w> </span><span class=nv>$Md5_Path</span>
<a id=__codelineno-33-17 name=__codelineno-33-17 href=#__codelineno-33-17></a>
<a id=__codelineno-33-18 name=__codelineno-33-18 href=#__codelineno-33-18></a><span class=c1># 循环获取数据库名进行备份和生成MD5校验文件</span>
<a id=__codelineno-33-19 name=__codelineno-33-19 href=#__codelineno-33-19></a><span class=k>for</span><span class=w> </span>dbname<span class=w> </span><span class=k>in</span><span class=w> </span><span class=sb>`</span>mysql<span class=w>  </span>-e<span class=w> </span><span class=s1>&#39;show databases&#39;</span><span class=w> </span><span class=p>|</span>sed<span class=w> </span><span class=s1>&#39;1d&#39;</span><span class=w> </span><span class=p>|</span>grep<span class=w> </span>-v<span class=w> </span><span class=s2>&quot;_schema&quot;</span><span class=sb>`</span>
<a id=__codelineno-33-20 name=__codelineno-33-20 href=#__codelineno-33-20></a><span class=k>do</span>
<a id=__codelineno-33-21 name=__codelineno-33-21 href=#__codelineno-33-21></a><span class=c1># 判断是否有数据库已经备份了,如果备份了则continue 调出当次循环，否则进行备份</span>
<a id=__codelineno-33-22 name=__codelineno-33-22 href=#__codelineno-33-22></a>
<a id=__codelineno-33-23 name=__codelineno-33-23 href=#__codelineno-33-23></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>!<span class=w> </span>-f<span class=w> </span><span class=nv>$Ba_Path</span>/<span class=si>${</span><span class=nv>dbname</span><span class=si>}</span>.sql.gz<span class=w> </span><span class=o>]</span><span class=p>;</span><span class=k>then</span>
<a id=__codelineno-33-24 name=__codelineno-33-24 href=#__codelineno-33-24></a>
<a id=__codelineno-33-25 name=__codelineno-33-25 href=#__codelineno-33-25></a><span class=w>   </span><span class=c1># 备份参数</span>
<a id=__codelineno-33-26 name=__codelineno-33-26 href=#__codelineno-33-26></a><span class=w>   </span><span class=c1># -B 增加use[name]语句, -R 备份存储过程和函数数据</span>
<a id=__codelineno-33-27 name=__codelineno-33-27 href=#__codelineno-33-27></a><span class=w>   </span><span class=c1># --master=data2 记录备份时刻的binlog位置点，2表示将其位置点注释</span>
<a id=__codelineno-33-28 name=__codelineno-33-28 href=#__codelineno-33-28></a><span class=w>   </span><span class=c1># --single-ransaction 对innodb引擎进行热备（对数据进行快照）</span>
<a id=__codelineno-33-29 name=__codelineno-33-29 href=#__codelineno-33-29></a><span class=w>   </span><span class=c1># gzip 对备份的数据进行gzip压缩</span>
<a id=__codelineno-33-30 name=__codelineno-33-30 href=#__codelineno-33-30></a><span class=w>   </span>mysqldump<span class=w>  </span>-B<span class=w> </span>-R<span class=w> </span>--master-data<span class=o>=</span><span class=m>2</span><span class=w> </span>--single-transaction<span class=w>  </span><span class=p>|</span>gzip<span class=w> </span>&gt;<span class=nv>$Ba_Path</span>/<span class=si>${</span><span class=nv>dbname</span><span class=si>}</span>.sql.gz
<a id=__codelineno-33-31 name=__codelineno-33-31 href=#__codelineno-33-31></a><span class=w>   </span><span class=nv>RETVAL</span><span class=o>=</span><span class=nv>$?</span>
<a id=__codelineno-33-32 name=__codelineno-33-32 href=#__codelineno-33-32></a>
<a id=__codelineno-33-33 name=__codelineno-33-33 href=#__codelineno-33-33></a><span class=w>   </span><span class=c1># 通过返回值判断备份是否执行成功,把执行的成功与否纪录到日志中</span>
<a id=__codelineno-33-34 name=__codelineno-33-34 href=#__codelineno-33-34></a><span class=w>   </span><span class=o>[</span><span class=w> </span><span class=nv>$?</span><span class=w> </span>-eq<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>dbname</span><span class=si>}</span><span class=s2> successful&quot;</span><span class=w> </span>&gt;&gt;<span class=nv>$Ba_Logs</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>dbname</span><span class=si>}</span><span class=s2> failed&quot;</span><span class=w> </span>&gt;&gt;<span class=nv>$Ba_Logs</span>
<a id=__codelineno-33-35 name=__codelineno-33-35 href=#__codelineno-33-35></a>
<a id=__codelineno-33-36 name=__codelineno-33-36 href=#__codelineno-33-36></a><span class=w>   </span><span class=c1># 对数据库的数据完整性做MD5校验</span>
<a id=__codelineno-33-37 name=__codelineno-33-37 href=#__codelineno-33-37></a><span class=w>   </span>md5sum<span class=w> </span><span class=nv>$Ba_Path</span>/<span class=si>${</span><span class=nv>dbname</span><span class=si>}</span>.sql.gz<span class=w>  </span>&gt;<span class=nv>$Md5_Path</span>/<span class=si>${</span><span class=nv>dbname</span><span class=si>}</span>_md5.log
<a id=__codelineno-33-38 name=__codelineno-33-38 href=#__codelineno-33-38></a>
<a id=__codelineno-33-39 name=__codelineno-33-39 href=#__codelineno-33-39></a><span class=w> </span><span class=k>else</span>
<a id=__codelineno-33-40 name=__codelineno-33-40 href=#__codelineno-33-40></a><span class=w>    </span><span class=c1># 如果备份已存在则跳出当次循环,进行下次循环</span>
<a id=__codelineno-33-41 name=__codelineno-33-41 href=#__codelineno-33-41></a><span class=w>    </span><span class=k>continue</span>
<a id=__codelineno-33-42 name=__codelineno-33-42 href=#__codelineno-33-42></a>
<a id=__codelineno-33-43 name=__codelineno-33-43 href=#__codelineno-33-43></a><span class=w>  </span><span class=k>fi</span>
<a id=__codelineno-33-44 name=__codelineno-33-44 href=#__codelineno-33-44></a><span class=k>done</span>
<a id=__codelineno-33-45 name=__codelineno-33-45 href=#__codelineno-33-45></a>
<a id=__codelineno-33-46 name=__codelineno-33-46 href=#__codelineno-33-46></a><span class=c1># 将备份日志结果邮件方式发送给管理员</span>
<a id=__codelineno-33-47 name=__codelineno-33-47 href=#__codelineno-33-47></a><span class=w> </span>mail<span class=w> </span>-s<span class=w> </span><span class=s2>&quot;</span><span class=nv>$HOSTNAME</span><span class=s2> </span><span class=nv>$IP</span><span class=s2>&quot;</span><span class=w> </span>jasonminghao@163.com<span class=w> </span>&lt;<span class=w> </span><span class=nv>$Ba_Logs</span>
</code></pre></div> <h3 id=mysql数据库分库分表备份>MySQL数据库分库分表备份<a class=headerlink href=#mysql数据库分库分表备份 title="Permanent link">&para;</a></h3> <p>数据库密码保存在/etc/my.cnf文件中，所以在执行与mysql相关的命令不需要输入密码</p> <p>分库分表备份思路：</p> <p>库名db1，两张表 <div class=highlight><pre><span></span><code><a id=__codelineno-34-1 name=__codelineno-34-1 href=#__codelineno-34-1></a>mysqldump<span class=w>  </span>db1<span class=w> </span>table01<span class=w> </span>&gt;db1_table01.sql.gz
<a id=__codelineno-34-2 name=__codelineno-34-2 href=#__codelineno-34-2></a>mysqldump<span class=w>  </span>db1<span class=w> </span>table02<span class=w> </span>&gt;db1_table01.sql.gz
</code></pre></div></p> <p>库名db2，两张表 <div class=highlight><pre><span></span><code><a id=__codelineno-35-1 name=__codelineno-35-1 href=#__codelineno-35-1></a>mysqldump<span class=w>  </span>db2<span class=w> </span>table01<span class=w> </span>&gt;db2_table01.sql.gz
<a id=__codelineno-35-2 name=__codelineno-35-2 href=#__codelineno-35-2></a>mysqldump<span class=w>  </span>db2<span class=w> </span>table02<span class=w> </span>&gt;db2_table02.sql.gz
</code></pre></div></p> <p>拿到表名列表 <div class=highlight><pre><span></span><code><a id=__codelineno-36-1 name=__codelineno-36-1 href=#__codelineno-36-1></a>mysql<span class=w>  </span>-e<span class=w> </span><span class=s2>&quot;show tables from db1;&quot;</span><span class=w> </span><span class=p>|</span>sed<span class=w> </span>1d
</code></pre></div></p> <p>注意看注释信息</p> <div class=highlight><pre><span></span><code><a id=__codelineno-37-1 name=__codelineno-37-1 href=#__codelineno-37-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-37-2 name=__codelineno-37-2 href=#__codelineno-37-2></a><span class=c1># author: xiongminghao</span>
<a id=__codelineno-37-3 name=__codelineno-37-3 href=#__codelineno-37-3></a><span class=c1># mail: jasonminghao@163.com</span>
<a id=__codelineno-37-4 name=__codelineno-37-4 href=#__codelineno-37-4></a><span class=c1># describe：Mysql database table backup</span>
<a id=__codelineno-37-5 name=__codelineno-37-5 href=#__codelineno-37-5></a><span class=c1># 定义变量</span>
<a id=__codelineno-37-6 name=__codelineno-37-6 href=#__codelineno-37-6></a><span class=nv>IP</span><span class=o>=</span><span class=k>$(</span>ifconfig<span class=w> </span>eth1<span class=w> </span><span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;NR==2{print $2}&#39;</span><span class=k>)</span>
<a id=__codelineno-37-7 name=__codelineno-37-7 href=#__codelineno-37-7></a><span class=nv>Path</span><span class=o>=</span>/backup/table<span class=w> </span><span class=c1># 备份目录</span>
<a id=__codelineno-37-8 name=__codelineno-37-8 href=#__codelineno-37-8></a><span class=nv>Time</span><span class=o>=</span><span class=k>$(</span>date<span class=w> </span>+%F<span class=k>)</span>
<a id=__codelineno-37-9 name=__codelineno-37-9 href=#__codelineno-37-9></a><span class=nv>Ba_Path</span><span class=o>=</span><span class=nv>$Path</span>/<span class=nv>$Time</span>
<a id=__codelineno-37-10 name=__codelineno-37-10 href=#__codelineno-37-10></a><span class=nv>Ba_Logs</span><span class=o>=</span>/var/log/db_table_<span class=nv>$Time</span><span class=w>  </span><span class=c1># 定义一个存放日志的文件</span>
<a id=__codelineno-37-11 name=__codelineno-37-11 href=#__codelineno-37-11></a><span class=nv>Md5_Path</span><span class=o>=</span><span class=nv>$Path</span>/<span class=nv>$Time</span>/md5<span class=w> </span><span class=c1># 定义一个存放md5校验的目录</span>
<a id=__codelineno-37-12 name=__codelineno-37-12 href=#__codelineno-37-12></a>
<a id=__codelineno-37-13 name=__codelineno-37-13 href=#__codelineno-37-13></a><span class=c1># 创建两个目录以当天时间为命名</span>
<a id=__codelineno-37-14 name=__codelineno-37-14 href=#__codelineno-37-14></a><span class=o>[</span><span class=w> </span>!<span class=w> </span>-d<span class=w> </span><span class=nv>$Ba_Path</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>mkdir<span class=w> </span><span class=nv>$Ba_Path</span>
<a id=__codelineno-37-15 name=__codelineno-37-15 href=#__codelineno-37-15></a><span class=o>[</span><span class=w> </span>!<span class=w> </span>-d<span class=w> </span><span class=nv>$Md5_Path</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>mkdir<span class=w> </span><span class=nv>$Md5_Path</span>
<a id=__codelineno-37-16 name=__codelineno-37-16 href=#__codelineno-37-16></a>
<a id=__codelineno-37-17 name=__codelineno-37-17 href=#__codelineno-37-17></a><span class=c1># 循环获取数据库名</span>
<a id=__codelineno-37-18 name=__codelineno-37-18 href=#__codelineno-37-18></a><span class=k>for</span><span class=w> </span>dbname<span class=w> </span><span class=k>in</span><span class=w> </span><span class=sb>`</span>mysql<span class=w>  </span>-e<span class=w> </span><span class=s1>&#39;show databases&#39;</span><span class=w> </span><span class=p>|</span>sed<span class=w> </span><span class=s1>&#39;1d&#39;</span><span class=w> </span><span class=p>|</span>grep<span class=w> </span>-v<span class=w> </span><span class=s2>&quot;_schema&quot;</span><span class=sb>`</span>
<a id=__codelineno-37-19 name=__codelineno-37-19 href=#__codelineno-37-19></a><span class=k>do</span>
<a id=__codelineno-37-20 name=__codelineno-37-20 href=#__codelineno-37-20></a>
<a id=__codelineno-37-21 name=__codelineno-37-21 href=#__codelineno-37-21></a><span class=w>  </span><span class=c1># 循环获取到数据库名后再次循环获取到该库名下的表，进行备份和MD5校验</span>
<a id=__codelineno-37-22 name=__codelineno-37-22 href=#__codelineno-37-22></a><span class=w>  </span><span class=k>for</span><span class=w> </span>tablename<span class=w> </span><span class=k>in</span><span class=w> </span><span class=sb>`</span>mysql<span class=w> </span>-e<span class=w> </span><span class=s2>&quot;show tables from </span><span class=nv>$dbname</span><span class=s2>&quot;</span><span class=w> </span><span class=p>|</span>sed<span class=w> </span><span class=s1>&#39;1d&#39;</span><span class=sb>`</span>
<a id=__codelineno-37-23 name=__codelineno-37-23 href=#__codelineno-37-23></a><span class=w>  </span><span class=k>do</span>
<a id=__codelineno-37-24 name=__codelineno-37-24 href=#__codelineno-37-24></a>
<a id=__codelineno-37-25 name=__codelineno-37-25 href=#__codelineno-37-25></a><span class=w>  </span><span class=c1># 判断是否有表已经备份了,如果备份了则continue 调出当次循环，否则进行备份</span>
<a id=__codelineno-37-26 name=__codelineno-37-26 href=#__codelineno-37-26></a><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>!<span class=w> </span>-f<span class=w> </span><span class=nv>$Ba_Path</span>/<span class=si>${</span><span class=nv>dbname</span><span class=si>}</span>_<span class=si>${</span><span class=nv>tablename</span><span class=si>}</span>.sql.gz<span class=w> </span><span class=o>]</span><span class=p>;</span><span class=k>then</span>
<a id=__codelineno-37-27 name=__codelineno-37-27 href=#__codelineno-37-27></a>
<a id=__codelineno-37-28 name=__codelineno-37-28 href=#__codelineno-37-28></a><span class=w>   </span>mysqldump<span class=w> </span>-R<span class=w> </span>--master-data<span class=o>=</span><span class=m>2</span><span class=w> </span>--single-transaction<span class=w>  </span><span class=si>${</span><span class=nv>dbname</span><span class=si>}</span><span class=w> </span><span class=si>${</span><span class=nv>tablename</span><span class=si>}</span><span class=w> </span><span class=p>|</span>gzip<span class=w> </span>&gt;<span class=nv>$Ba_Path</span>/<span class=si>${</span><span class=nv>dbname</span><span class=si>}</span>_<span class=si>${</span><span class=nv>tablename</span><span class=si>}</span>.sql.gz
<a id=__codelineno-37-29 name=__codelineno-37-29 href=#__codelineno-37-29></a><span class=w>   </span><span class=nv>RETVAL</span><span class=o>=</span><span class=nv>$?</span>
<a id=__codelineno-37-30 name=__codelineno-37-30 href=#__codelineno-37-30></a>
<a id=__codelineno-37-31 name=__codelineno-37-31 href=#__codelineno-37-31></a><span class=w>   </span><span class=c1># 通过返回值判断备份是否执行成功,把执行的成功与否纪录到日志中</span>
<a id=__codelineno-37-32 name=__codelineno-37-32 href=#__codelineno-37-32></a><span class=w>   </span><span class=o>[</span><span class=w> </span><span class=nv>$?</span><span class=w> </span>-eq<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>dbname</span><span class=si>}</span><span class=s2>_</span><span class=si>${</span><span class=nv>tablename</span><span class=si>}</span><span class=s2> successful&quot;</span><span class=w> </span>&gt;&gt;<span class=nv>$Ba_Logs</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>dbname</span><span class=si>}</span><span class=s2>_</span><span class=si>${</span><span class=nv>tablename</span><span class=si>}</span><span class=s2> failed&quot;</span><span class=w> </span>&gt;&gt;<span class=nv>$Ba_Logs</span>
<a id=__codelineno-37-33 name=__codelineno-37-33 href=#__codelineno-37-33></a><span class=w>   </span><span class=c1># 对表的数据完整性做MD5校验</span>
<a id=__codelineno-37-34 name=__codelineno-37-34 href=#__codelineno-37-34></a><span class=w>   </span>md5sum<span class=w> </span><span class=nv>$Ba_Path</span>/<span class=si>${</span><span class=nv>dbname</span><span class=si>}</span>_<span class=si>${</span><span class=nv>tablename</span><span class=si>}</span>.sql.gz<span class=w>  </span>&gt;<span class=nv>$Md5_Path</span>/<span class=si>${</span><span class=nv>dbname</span><span class=si>}</span>_<span class=si>${</span><span class=nv>tablename</span><span class=si>}</span>_md5.log
<a id=__codelineno-37-35 name=__codelineno-37-35 href=#__codelineno-37-35></a>
<a id=__codelineno-37-36 name=__codelineno-37-36 href=#__codelineno-37-36></a><span class=w> </span><span class=k>else</span>
<a id=__codelineno-37-37 name=__codelineno-37-37 href=#__codelineno-37-37></a><span class=w>    </span><span class=k>continue</span>
<a id=__codelineno-37-38 name=__codelineno-37-38 href=#__codelineno-37-38></a>
<a id=__codelineno-37-39 name=__codelineno-37-39 href=#__codelineno-37-39></a><span class=w>  </span><span class=k>fi</span>
<a id=__codelineno-37-40 name=__codelineno-37-40 href=#__codelineno-37-40></a><span class=w> </span><span class=k>done</span>
<a id=__codelineno-37-41 name=__codelineno-37-41 href=#__codelineno-37-41></a><span class=k>done</span>
<a id=__codelineno-37-42 name=__codelineno-37-42 href=#__codelineno-37-42></a><span class=c1># 将备份日志结果邮件方式发送给管理员</span>
<a id=__codelineno-37-43 name=__codelineno-37-43 href=#__codelineno-37-43></a>mail<span class=w> </span>-s<span class=w> </span><span class=s2>&quot;</span><span class=nv>$HOSTNAME</span><span class=s2> </span><span class=nv>$IP</span><span class=s2>&quot;</span><span class=w> </span>jasonminghao@163.com<span class=w> </span>&lt;<span class=w> </span><span class=nv>$Ba_Logs</span>
</code></pre></div> <h2 id=22开机性能优化>22.开机性能优化<a class=headerlink href=#22开机性能优化 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-38-1 name=__codelineno-38-1 href=#__codelineno-38-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-38-2 name=__codelineno-38-2 href=#__codelineno-38-2></a><span class=c1>#添加epel外部yum扩展源</span>
<a id=__codelineno-38-3 name=__codelineno-38-3 href=#__codelineno-38-3></a><span class=nb>cd</span><span class=w> </span>/usr/local/src
<a id=__codelineno-38-4 name=__codelineno-38-4 href=#__codelineno-38-4></a>wget<span class=w> </span>http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm
<a id=__codelineno-38-5 name=__codelineno-38-5 href=#__codelineno-38-5></a>rpm<span class=w> </span>-ivh<span class=w> </span>epel-release-6-8.noarch.rpm
<a id=__codelineno-38-6 name=__codelineno-38-6 href=#__codelineno-38-6></a><span class=c1>#安装gcc基础库文件以及sysstat工具</span>
<a id=__codelineno-38-7 name=__codelineno-38-7 href=#__codelineno-38-7></a>yum<span class=w> </span>-y<span class=w> </span>install<span class=w> </span>gcc<span class=w> </span>gcc-c++<span class=w> </span>vim-enhanced<span class=w> </span>unzip<span class=w> </span>unrar<span class=w> </span>sysstat
<a id=__codelineno-38-8 name=__codelineno-38-8 href=#__codelineno-38-8></a><span class=c1>#配置ntpdate自动对时</span>
<a id=__codelineno-38-9 name=__codelineno-38-9 href=#__codelineno-38-9></a>yum<span class=w> </span>-y<span class=w> </span>install<span class=w> </span>ntp
<a id=__codelineno-38-10 name=__codelineno-38-10 href=#__codelineno-38-10></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;01 01 * * * /usr/sbin/ntpdate ntp.api.bz    &gt;&gt; /dev/null 2&gt;&amp;1&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span>/etc/crontab
<a id=__codelineno-38-11 name=__codelineno-38-11 href=#__codelineno-38-11></a>ntpdate<span class=w> </span>ntp.api.bz
<a id=__codelineno-38-12 name=__codelineno-38-12 href=#__codelineno-38-12></a>service<span class=w> </span>crond<span class=w> </span>restart
<a id=__codelineno-38-13 name=__codelineno-38-13 href=#__codelineno-38-13></a><span class=c1>#配置文件的ulimit值</span>
<a id=__codelineno-38-14 name=__codelineno-38-14 href=#__codelineno-38-14></a><span class=nb>ulimit</span><span class=w> </span>-SHn<span class=w> </span><span class=m>65535</span>
<a id=__codelineno-38-15 name=__codelineno-38-15 href=#__codelineno-38-15></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;ulimit -SHn 65535&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span>/etc/rc.local
<a id=__codelineno-38-16 name=__codelineno-38-16 href=#__codelineno-38-16></a>cat&gt;&gt;<span class=w> </span>/etc/security/limits.conf<span class=w> </span><span class=s>&lt;&lt; EOF</span>
<a id=__codelineno-38-17 name=__codelineno-38-17 href=#__codelineno-38-17></a><span class=s>*                     soft     nofile             65535</span>
<a id=__codelineno-38-18 name=__codelineno-38-18 href=#__codelineno-38-18></a><span class=s>*                     hard     nofile             65535</span>
<a id=__codelineno-38-19 name=__codelineno-38-19 href=#__codelineno-38-19></a><span class=s>EOF</span>
<a id=__codelineno-38-20 name=__codelineno-38-20 href=#__codelineno-38-20></a>
<a id=__codelineno-38-21 name=__codelineno-38-21 href=#__codelineno-38-21></a><span class=c1>#基础系统内核优化</span>
<a id=__codelineno-38-22 name=__codelineno-38-22 href=#__codelineno-38-22></a>cat&gt;&gt;<span class=w> </span>/etc/sysctl.conf<span class=w> </span><span class=s>&lt;&lt; EOF</span>
<a id=__codelineno-38-23 name=__codelineno-38-23 href=#__codelineno-38-23></a><span class=s>fs.file-max=419430</span>
<a id=__codelineno-38-24 name=__codelineno-38-24 href=#__codelineno-38-24></a><span class=s>net.ipv4.tcp_syncookies = 1</span>
<a id=__codelineno-38-25 name=__codelineno-38-25 href=#__codelineno-38-25></a><span class=s>net.ipv4.tcp_syn_retries = 1</span>
<a id=__codelineno-38-26 name=__codelineno-38-26 href=#__codelineno-38-26></a><span class=s>net.ipv4.tcp_tw_recycle = 1</span>
<a id=__codelineno-38-27 name=__codelineno-38-27 href=#__codelineno-38-27></a><span class=s>net.ipv4.tcp_tw_reuse = 1</span>
<a id=__codelineno-38-28 name=__codelineno-38-28 href=#__codelineno-38-28></a><span class=s>net.ipv4.tcp_fin_timeout = 1</span>
<a id=__codelineno-38-29 name=__codelineno-38-29 href=#__codelineno-38-29></a><span class=s>net.ipv4.tcp_keepalive_time = 1200</span>
<a id=__codelineno-38-30 name=__codelineno-38-30 href=#__codelineno-38-30></a><span class=s>net.ipv4.ip_local_port_range = 1024 65535</span>
<a id=__codelineno-38-31 name=__codelineno-38-31 href=#__codelineno-38-31></a><span class=s>net.ipv4.tcp_max_syn_backlog = 16384</span>
<a id=__codelineno-38-32 name=__codelineno-38-32 href=#__codelineno-38-32></a><span class=s>net.ipv4.tcp_max_tw_buckets = 36000</span>
<a id=__codelineno-38-33 name=__codelineno-38-33 href=#__codelineno-38-33></a><span class=s>net.ipv4.route.gc_timeout = 100</span>
<a id=__codelineno-38-34 name=__codelineno-38-34 href=#__codelineno-38-34></a><span class=s>net.ipv4.tcp_syn_retries = 1</span>
<a id=__codelineno-38-35 name=__codelineno-38-35 href=#__codelineno-38-35></a><span class=s>net.ipv4.tcp_synack_retries = 1</span>
<a id=__codelineno-38-36 name=__codelineno-38-36 href=#__codelineno-38-36></a><span class=s>net.core.somaxconn = 16384</span>
<a id=__codelineno-38-37 name=__codelineno-38-37 href=#__codelineno-38-37></a><span class=s>net.core.netdev_max_backlog = 16384</span>
<a id=__codelineno-38-38 name=__codelineno-38-38 href=#__codelineno-38-38></a><span class=s>net.ipv4.tcp_max_orphans = 16384</span>
<a id=__codelineno-38-39 name=__codelineno-38-39 href=#__codelineno-38-39></a><span class=s>EOF</span>
<a id=__codelineno-38-40 name=__codelineno-38-40 href=#__codelineno-38-40></a>/sbin/sysctl<span class=w> </span>-p
<a id=__codelineno-38-41 name=__codelineno-38-41 href=#__codelineno-38-41></a>
<a id=__codelineno-38-42 name=__codelineno-38-42 href=#__codelineno-38-42></a><span class=c1>#禁用control-alt-delete组合键以防止误操作</span>
<a id=__codelineno-38-43 name=__codelineno-38-43 href=#__codelineno-38-43></a>sed<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;s@ca::ctrlaltdel:/sbin/shutdown -t3 -r now@#ca::ctrlaltdel:/sbin/shutdown -t3 -r now@&#39;</span><span class=w> </span>/etc/inittab
<a id=__codelineno-38-44 name=__codelineno-38-44 href=#__codelineno-38-44></a><span class=c1>#关闭SElinux</span>
<a id=__codelineno-38-45 name=__codelineno-38-45 href=#__codelineno-38-45></a>sed<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;s@SELINUX=enforcing@SELINUX=disabled@&#39;</span><span class=w> </span>/etc/selinux/config
<a id=__codelineno-38-46 name=__codelineno-38-46 href=#__codelineno-38-46></a><span class=c1>#关闭iptables</span>
<a id=__codelineno-38-47 name=__codelineno-38-47 href=#__codelineno-38-47></a>service<span class=w> </span>iptables<span class=w> </span>stop
<a id=__codelineno-38-48 name=__codelineno-38-48 href=#__codelineno-38-48></a>chkconfig<span class=w> </span>iptables<span class=w> </span>off
<a id=__codelineno-38-49 name=__codelineno-38-49 href=#__codelineno-38-49></a><span class=c1>#ssh服务配置优化,请至少保持机器中至少有一个具有sudo权限的用户，下面的配置会禁止root远程登录</span>
<a id=__codelineno-38-50 name=__codelineno-38-50 href=#__codelineno-38-50></a>sed<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;s@#PermitRootLogin yes@PermitRootLogin no@&#39;</span><span class=w> </span>/etc/ssh/sshd_config<span class=w> </span><span class=c1>#禁止root远程登录</span>
<a id=__codelineno-38-51 name=__codelineno-38-51 href=#__codelineno-38-51></a>sed<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;s@#PermitEmptyPasswords no@PermitEmptyPasswords no@&#39;</span><span class=w> </span>/etc/ssh/sshd_config<span class=w> </span><span class=c1>#禁止空密码登录</span>
<a id=__codelineno-38-52 name=__codelineno-38-52 href=#__codelineno-38-52></a>sed<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;s@#UseDNS yes@UseDNS no@&#39;</span><span class=w> </span>/etc/ssh/sshd_config<span class=w> </span>/etc/ssh/sshd_config
<a id=__codelineno-38-53 name=__codelineno-38-53 href=#__codelineno-38-53></a>service<span class=w> </span>sshd<span class=w> </span>restart
<a id=__codelineno-38-54 name=__codelineno-38-54 href=#__codelineno-38-54></a><span class=c1>#禁用ipv6地址</span>
<a id=__codelineno-38-55 name=__codelineno-38-55 href=#__codelineno-38-55></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;alias net-pf-10 off&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span>/etc/modprobe.d/dist.conf
<a id=__codelineno-38-56 name=__codelineno-38-56 href=#__codelineno-38-56></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;alias ipv6 off&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span>/etc/modprobe.d/dist.conf
<a id=__codelineno-38-57 name=__codelineno-38-57 href=#__codelineno-38-57></a>chkconfig<span class=w> </span>ip6tables<span class=w> </span>off
<a id=__codelineno-38-58 name=__codelineno-38-58 href=#__codelineno-38-58></a><span class=c1>#vim基础语法优化</span>
<a id=__codelineno-38-59 name=__codelineno-38-59 href=#__codelineno-38-59></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;syntax on&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span>/root/.vimrc
<a id=__codelineno-38-60 name=__codelineno-38-60 href=#__codelineno-38-60></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;set nohlsearch&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span>/root/.vimrc
<a id=__codelineno-38-61 name=__codelineno-38-61 href=#__codelineno-38-61></a><span class=c1>#精简开机自启动服务，安装最小化服务的机器初始可以只保留crond，network，rsyslog，sshd这四个服务。</span>
<a id=__codelineno-38-62 name=__codelineno-38-62 href=#__codelineno-38-62></a><span class=k>for</span><span class=w> </span>i<span class=w> </span><span class=k>in</span><span class=w> </span><span class=sb>`</span>chkconfig<span class=w> </span>--list<span class=p>|</span>grep<span class=w> </span><span class=m>3</span>:on<span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;{print $1}&#39;</span><span class=sb>`</span><span class=p>;</span><span class=k>do</span><span class=w> </span>chkconfig<span class=w> </span>--level<span class=w> </span><span class=m>3</span><span class=w> </span><span class=nv>$i</span><span class=w> </span>off<span class=p>;</span><span class=k>done</span>
<a id=__codelineno-38-63 name=__codelineno-38-63 href=#__codelineno-38-63></a><span class=k>for</span><span class=w> </span>CURSRV<span class=w>  </span><span class=k>in</span><span class=w> </span>crond<span class=w> </span>rsyslog<span class=w> </span>sshd<span class=w> </span>network<span class=p>;</span><span class=k>do</span><span class=w> </span>chkconfig<span class=w> </span>--level<span class=w> </span><span class=m>3</span><span class=w> </span><span class=nv>$CURSRV</span><span class=w> </span>on<span class=p>;</span><span class=k>done</span>
<a id=__codelineno-38-64 name=__codelineno-38-64 href=#__codelineno-38-64></a><span class=c1>#重启服务器</span>
<a id=__codelineno-38-65 name=__codelineno-38-65 href=#__codelineno-38-65></a>reboot
</code></pre></div> <h2 id=23函数输出帮助信息>23.函数输出帮助信息<a class=headerlink href=#23函数输出帮助信息 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-39-1 name=__codelineno-39-1 href=#__codelineno-39-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-39-2 name=__codelineno-39-2 href=#__codelineno-39-2></a><span class=c1>#功能描述(Description):使用函数输出帮助信息.</span>
<a id=__codelineno-39-3 name=__codelineno-39-3 href=#__codelineno-39-3></a>
<a id=__codelineno-39-4 name=__codelineno-39-4 href=#__codelineno-39-4></a><span class=k>function</span><span class=w> </span>print_usage<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-39-5 name=__codelineno-39-5 href=#__codelineno-39-5></a><span class=w>    </span>cat<span class=w> </span><span class=s>&lt;&lt; EOF</span>
<a id=__codelineno-39-6 name=__codelineno-39-6 href=#__codelineno-39-6></a><span class=s>Usage: --help | -h</span>
<a id=__codelineno-39-7 name=__codelineno-39-7 href=#__codelineno-39-7></a><span class=s>  Print help information for script.</span>
<a id=__codelineno-39-8 name=__codelineno-39-8 href=#__codelineno-39-8></a><span class=s>Usage: --memory | -m</span>
<a id=__codelineno-39-9 name=__codelineno-39-9 href=#__codelineno-39-9></a><span class=s>  Monitor memory information.</span>
<a id=__codelineno-39-10 name=__codelineno-39-10 href=#__codelineno-39-10></a><span class=s>Usage: --network | -n</span>
<a id=__codelineno-39-11 name=__codelineno-39-11 href=#__codelineno-39-11></a><span class=s>  Monitor network interface information.</span>
<a id=__codelineno-39-12 name=__codelineno-39-12 href=#__codelineno-39-12></a><span class=s>EOF</span>
<a id=__codelineno-39-13 name=__codelineno-39-13 href=#__codelineno-39-13></a><span class=o>}</span>
<a id=__codelineno-39-14 name=__codelineno-39-14 href=#__codelineno-39-14></a>
<a id=__codelineno-39-15 name=__codelineno-39-15 href=#__codelineno-39-15></a><span class=k>case</span><span class=w> </span><span class=nv>$1</span><span class=w> </span><span class=k>in</span>
<a id=__codelineno-39-16 name=__codelineno-39-16 href=#__codelineno-39-16></a>--memory<span class=p>|</span>-m<span class=o>)</span>
<a id=__codelineno-39-17 name=__codelineno-39-17 href=#__codelineno-39-17></a><span class=w>    </span>free<span class=p>;;</span>
<a id=__codelineno-39-18 name=__codelineno-39-18 href=#__codelineno-39-18></a>--network<span class=p>|</span>-n<span class=o>)</span>
<a id=__codelineno-39-19 name=__codelineno-39-19 href=#__codelineno-39-19></a><span class=w>    </span>ip<span class=w> </span>-s<span class=w> </span>link<span class=p>;;</span>
<a id=__codelineno-39-20 name=__codelineno-39-20 href=#__codelineno-39-20></a>--help<span class=p>|</span>-h<span class=o>)</span>
<a id=__codelineno-39-21 name=__codelineno-39-21 href=#__codelineno-39-21></a><span class=w>    </span>print_usage<span class=p>;;</span>
<a id=__codelineno-39-22 name=__codelineno-39-22 href=#__codelineno-39-22></a>*<span class=o>)</span>
<a id=__codelineno-39-23 name=__codelineno-39-23 href=#__codelineno-39-23></a><span class=w>    </span>print_usage<span class=p>;;</span>
<a id=__codelineno-39-24 name=__codelineno-39-24 href=#__codelineno-39-24></a><span class=k>esac</span>
</code></pre></div> <h2 id=24设置锁文件防止脚本重复执行>24.设置锁文件防止脚本重复执行<a class=headerlink href=#24设置锁文件防止脚本重复执行 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-40-1 name=__codelineno-40-1 href=#__codelineno-40-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-40-2 name=__codelineno-40-2 href=#__codelineno-40-2></a><span class=c1>#功能描述(Description):通过设置锁文件防止脚本重复执行.</span>
<a id=__codelineno-40-3 name=__codelineno-40-3 href=#__codelineno-40-3></a>
<a id=__codelineno-40-4 name=__codelineno-40-4 href=#__codelineno-40-4></a><span class=c1>#使用Ctrl+C中断脚本时,删除锁文件.</span>
<a id=__codelineno-40-5 name=__codelineno-40-5 href=#__codelineno-40-5></a><span class=nb>trap</span><span class=w> </span><span class=s1>&#39;rm -rf /tmp/lockfile;exit&#39;</span><span class=w> </span>HUP<span class=w> </span>INT
<a id=__codelineno-40-6 name=__codelineno-40-6 href=#__codelineno-40-6></a>
<a id=__codelineno-40-7 name=__codelineno-40-7 href=#__codelineno-40-7></a><span class=c1>#检查是否存在锁文件,没有锁文件就执行backup备份函数,如果有锁文件脚本则脚本直接退出.</span>
<a id=__codelineno-40-8 name=__codelineno-40-8 href=#__codelineno-40-8></a>lock_check<span class=o>(){</span>
<a id=__codelineno-40-9 name=__codelineno-40-9 href=#__codelineno-40-9></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>(</span><span class=nb>set</span><span class=w> </span>-C<span class=p>;</span><span class=w> </span>:&gt;<span class=w> </span>/tmp/lockfile<span class=o>)</span><span class=w> </span><span class=m>2</span>&gt;/dev/null<span class=w> </span><span class=p>;</span><span class=k>then</span>
<a id=__codelineno-40-10 name=__codelineno-40-10 href=#__codelineno-40-10></a><span class=w>        </span>backup
<a id=__codelineno-40-11 name=__codelineno-40-11 href=#__codelineno-40-11></a><span class=w>    </span><span class=k>else</span>
<a id=__codelineno-40-12 name=__codelineno-40-12 href=#__codelineno-40-12></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;\033[91mWarning:其他用户在执行该脚本.\033[0m&quot;</span>
<a id=__codelineno-40-13 name=__codelineno-40-13 href=#__codelineno-40-13></a><span class=w>        </span><span class=nb>exit</span><span class=w> </span><span class=m>66</span>
<a id=__codelineno-40-14 name=__codelineno-40-14 href=#__codelineno-40-14></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-40-15 name=__codelineno-40-15 href=#__codelineno-40-15></a><span class=o>}</span>
<a id=__codelineno-40-16 name=__codelineno-40-16 href=#__codelineno-40-16></a>
<a id=__codelineno-40-17 name=__codelineno-40-17 href=#__codelineno-40-17></a><span class=c1>#执行备份前创建所文件,然后执行备份数据库的操作,备份完成后删除锁文件.</span>
<a id=__codelineno-40-18 name=__codelineno-40-18 href=#__codelineno-40-18></a><span class=c1>#sleep 10实验测试时使用,为了防止小数据库备份太快,无法验证重复执行脚本的效果.</span>
<a id=__codelineno-40-19 name=__codelineno-40-19 href=#__codelineno-40-19></a>backup<span class=o>(){</span>
<a id=__codelineno-40-20 name=__codelineno-40-20 href=#__codelineno-40-20></a><span class=w>    </span>touch<span class=w> </span>/tmp/lockfile
<a id=__codelineno-40-21 name=__codelineno-40-21 href=#__codelineno-40-21></a><span class=w>    </span>mysqldump<span class=w> </span>--all-database<span class=w> </span>&gt;<span class=w> </span>/var/log/mysql-<span class=k>$(</span>date<span class=w> </span>+%Y%m%d<span class=k>)</span>.bak
<a id=__codelineno-40-22 name=__codelineno-40-22 href=#__codelineno-40-22></a><span class=w>    </span>sleep<span class=w> </span><span class=m>10</span>
<a id=__codelineno-40-23 name=__codelineno-40-23 href=#__codelineno-40-23></a><span class=w>    </span>rm<span class=w> </span>-rf<span class=w> </span>/tmp/lockfile
<a id=__codelineno-40-24 name=__codelineno-40-24 href=#__codelineno-40-24></a><span class=o>}</span>
<a id=__codelineno-40-25 name=__codelineno-40-25 href=#__codelineno-40-25></a>
<a id=__codelineno-40-26 name=__codelineno-40-26 href=#__codelineno-40-26></a>lock_check
<a id=__codelineno-40-27 name=__codelineno-40-27 href=#__codelineno-40-27></a>backup
</code></pre></div> <h2 id=25对一组url测试能否访问成功>25.对一组url测试能否访问成功<a class=headerlink href=#25对一组url测试能否访问成功 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-41-1 name=__codelineno-41-1 href=#__codelineno-41-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-41-2 name=__codelineno-41-2 href=#__codelineno-41-2></a>
<a id=__codelineno-41-3 name=__codelineno-41-3 href=#__codelineno-41-3></a><span class=nv>url_list</span><span class=o>=(</span><span class=w>  </span><span class=c1>#定义一个包含三个网址的数组 url_list</span>
<a id=__codelineno-41-4 name=__codelineno-41-4 href=#__codelineno-41-4></a>http://www.baidu.com
<a id=__codelineno-41-5 name=__codelineno-41-5 href=#__codelineno-41-5></a>https://www.shiyanlou.com
<a id=__codelineno-41-6 name=__codelineno-41-6 href=#__codelineno-41-6></a>http://www.google.com
<a id=__codelineno-41-7 name=__codelineno-41-7 href=#__codelineno-41-7></a><span class=o>)</span>
<a id=__codelineno-41-8 name=__codelineno-41-8 href=#__codelineno-41-8></a>
<a id=__codelineno-41-9 name=__codelineno-41-9 href=#__codelineno-41-9></a>wait<span class=o>(){</span><span class=w>   </span><span class=c1>#定义倒计时函数 wait</span>
<a id=__codelineno-41-10 name=__codelineno-41-10 href=#__codelineno-41-10></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s1>&#39;wait 3 second...&#39;</span>
<a id=__codelineno-41-11 name=__codelineno-41-11 href=#__codelineno-41-11></a><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=o>((</span><span class=nv>i</span><span class=o>=</span><span class=m>0</span><span class=p>;</span>i&lt;<span class=m>3</span><span class=p>;</span>i++<span class=o>))</span>
<a id=__codelineno-41-12 name=__codelineno-41-12 href=#__codelineno-41-12></a><span class=w>    </span><span class=k>do</span>
<a id=__codelineno-41-13 name=__codelineno-41-13 href=#__codelineno-41-13></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;.&quot;</span><span class=p>;</span>sleep<span class=w> </span><span class=m>1</span><span class=w>  </span><span class=c1>#每隔1秒打印一个点</span>
<a id=__codelineno-41-14 name=__codelineno-41-14 href=#__codelineno-41-14></a><span class=w>    </span><span class=k>done</span>
<a id=__codelineno-41-15 name=__codelineno-41-15 href=#__codelineno-41-15></a><span class=w>    </span><span class=nb>echo</span>
<a id=__codelineno-41-16 name=__codelineno-41-16 href=#__codelineno-41-16></a><span class=o>}</span>
<a id=__codelineno-41-17 name=__codelineno-41-17 href=#__codelineno-41-17></a>
<a id=__codelineno-41-18 name=__codelineno-41-18 href=#__codelineno-41-18></a>check_url<span class=o>(){</span>
<a id=__codelineno-41-19 name=__codelineno-41-19 href=#__codelineno-41-19></a><span class=w>    </span><span class=nb>wait</span><span class=w>   </span><span class=c1># 调用已经定义的 wait 函数</span>
<a id=__codelineno-41-20 name=__codelineno-41-20 href=#__codelineno-41-20></a>
<a id=__codelineno-41-21 name=__codelineno-41-21 href=#__codelineno-41-21></a><span class=w>    </span><span class=c1>#循环遍历 url_list 中的地址</span>
<a id=__codelineno-41-22 name=__codelineno-41-22 href=#__codelineno-41-22></a><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=o>((</span><span class=nv>i</span><span class=o>=</span><span class=m>0</span><span class=p>;</span>i&lt;<span class=sb>`</span><span class=nb>echo</span><span class=w> </span><span class=si>${#</span><span class=nv>url_list</span><span class=p>[*]</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>i++<span class=o>))</span>
<a id=__codelineno-41-23 name=__codelineno-41-23 href=#__codelineno-41-23></a><span class=w>    </span><span class=k>do</span>
<a id=__codelineno-41-24 name=__codelineno-41-24 href=#__codelineno-41-24></a>
<a id=__codelineno-41-25 name=__codelineno-41-25 href=#__codelineno-41-25></a><span class=w>        </span><span class=c1>#检测是否可以访问数组元素中的地址</span>
<a id=__codelineno-41-26 name=__codelineno-41-26 href=#__codelineno-41-26></a><span class=w>        </span>wget<span class=w> </span>-o<span class=w> </span>/dev/null<span class=w> </span>-T<span class=w> </span><span class=m>3</span><span class=w> </span>--tries<span class=o>=</span><span class=m>1</span><span class=w> </span>--spider<span class=w> </span><span class=si>${</span><span class=nv>url_list</span><span class=p>[</span><span class=nv>$i</span><span class=p>]</span><span class=si>}</span><span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span><span class=w>  </span><span class=c1>#--tries是设置尝试次数，--spider检查网址，后面的&gt;/dev/null 2&gt;&amp;1是不保留任何输出</span>
<a id=__codelineno-41-27 name=__codelineno-41-27 href=#__codelineno-41-27></a>
<a id=__codelineno-41-28 name=__codelineno-41-28 href=#__codelineno-41-28></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=nv>$?</span><span class=w> </span>-eq<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=k>then</span><span class=w>   </span><span class=c1>#如果返回值为0则表示访问成功</span>
<a id=__codelineno-41-29 name=__codelineno-41-29 href=#__codelineno-41-29></a><span class=w>            </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>url_list</span><span class=p>[</span><span class=nv>$i</span><span class=p>]</span><span class=si>}</span><span class=s2> success&quot;</span>
<a id=__codelineno-41-30 name=__codelineno-41-30 href=#__codelineno-41-30></a><span class=w>        </span><span class=k>else</span>
<a id=__codelineno-41-31 name=__codelineno-41-31 href=#__codelineno-41-31></a><span class=w>            </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>url_list</span><span class=p>[</span><span class=nv>$i</span><span class=p>]</span><span class=si>}</span><span class=s2> false&quot;</span>
<a id=__codelineno-41-32 name=__codelineno-41-32 href=#__codelineno-41-32></a><span class=w>        </span><span class=k>fi</span>
<a id=__codelineno-41-33 name=__codelineno-41-33 href=#__codelineno-41-33></a><span class=w>    </span><span class=k>done</span>
<a id=__codelineno-41-34 name=__codelineno-41-34 href=#__codelineno-41-34></a><span class=o>}</span>
<a id=__codelineno-41-35 name=__codelineno-41-35 href=#__codelineno-41-35></a>
<a id=__codelineno-41-36 name=__codelineno-41-36 href=#__codelineno-41-36></a>main<span class=o>(){</span><span class=w>  </span><span class=c1>#定义主函数，即入口函数，应用程序运行时首先执行的代码</span>
<a id=__codelineno-41-37 name=__codelineno-41-37 href=#__codelineno-41-37></a><span class=w>        </span>check_url<span class=w>   </span><span class=c1>#调用定义的 check_url 函数</span>
<a id=__codelineno-41-38 name=__codelineno-41-38 href=#__codelineno-41-38></a><span class=o>}</span>
<a id=__codelineno-41-39 name=__codelineno-41-39 href=#__codelineno-41-39></a>
<a id=__codelineno-41-40 name=__codelineno-41-40 href=#__codelineno-41-40></a>
<a id=__codelineno-41-41 name=__codelineno-41-41 href=#__codelineno-41-41></a>main<span class=w>    </span><span class=c1>#调用主函数</span>
</code></pre></div> <h2 id=26mysql单表数据同步脚本>26.MySQL单表数据同步脚本<a class=headerlink href=#26mysql单表数据同步脚本 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-42-1 name=__codelineno-42-1 href=#__codelineno-42-1></a><span class=ch>#!/usr/bin/env bash</span>
<a id=__codelineno-42-2 name=__codelineno-42-2 href=#__codelineno-42-2></a><span class=c1># Auth: liuli</span>
<a id=__codelineno-42-3 name=__codelineno-42-3 href=#__codelineno-42-3></a><span class=c1># Version: v1.0, 2020/6/17</span>
<a id=__codelineno-42-4 name=__codelineno-42-4 href=#__codelineno-42-4></a><span class=c1># Sys: CentOS 7.6</span>
<a id=__codelineno-42-5 name=__codelineno-42-5 href=#__codelineno-42-5></a><span class=c1># Features: 用于同步研发数据库中的某些表至生产数据库</span>
<a id=__codelineno-42-6 name=__codelineno-42-6 href=#__codelineno-42-6></a>
<a id=__codelineno-42-7 name=__codelineno-42-7 href=#__codelineno-42-7></a><span class=c1># set -xeuo pipefail</span>
<a id=__codelineno-42-8 name=__codelineno-42-8 href=#__codelineno-42-8></a>
<a id=__codelineno-42-9 name=__codelineno-42-9 href=#__codelineno-42-9></a><span class=nv>time</span><span class=o>=</span><span class=sb>`</span>date<span class=w> </span><span class=s1>&#39;+%Y-%m-%d-%H:%M&#39;</span><span class=sb>`</span>
<a id=__codelineno-42-10 name=__codelineno-42-10 href=#__codelineno-42-10></a>mkdir<span class=w> </span>-p<span class=w> </span>./sql/<span class=si>${</span><span class=nv>time</span><span class=si>}</span>
<a id=__codelineno-42-11 name=__codelineno-42-11 href=#__codelineno-42-11></a>
<a id=__codelineno-42-12 name=__codelineno-42-12 href=#__codelineno-42-12></a><span class=nv>db_Name</span><span class=o>=</span><span class=s2>&quot;temp-tenant&quot;</span>
<a id=__codelineno-42-13 name=__codelineno-42-13 href=#__codelineno-42-13></a><span class=nv>table_Name</span><span class=o>=(</span>
<a id=__codelineno-42-14 name=__codelineno-42-14 href=#__codelineno-42-14></a>interface_authority
<a id=__codelineno-42-15 name=__codelineno-42-15 href=#__codelineno-42-15></a>interface_permissions
<a id=__codelineno-42-16 name=__codelineno-42-16 href=#__codelineno-42-16></a>t_user_function_authority
<a id=__codelineno-42-17 name=__codelineno-42-17 href=#__codelineno-42-17></a>t_user_function_permission
<a id=__codelineno-42-18 name=__codelineno-42-18 href=#__codelineno-42-18></a>t_menu
<a id=__codelineno-42-19 name=__codelineno-42-19 href=#__codelineno-42-19></a><span class=o>)</span>
<a id=__codelineno-42-20 name=__codelineno-42-20 href=#__codelineno-42-20></a><span class=c1># 研发环境</span>
<a id=__codelineno-42-21 name=__codelineno-42-21 href=#__codelineno-42-21></a><span class=nv>dev_IP</span><span class=o>=</span><span class=s2>&quot;192.168.1.15&quot;</span>
<a id=__codelineno-42-22 name=__codelineno-42-22 href=#__codelineno-42-22></a><span class=nv>dev_Port</span><span class=o>=</span><span class=s2>&quot;3306&quot;</span>
<a id=__codelineno-42-23 name=__codelineno-42-23 href=#__codelineno-42-23></a><span class=nv>dev_Pass</span><span class=o>=</span><span class=s2>&quot;123456Aa.&quot;</span>
<a id=__codelineno-42-24 name=__codelineno-42-24 href=#__codelineno-42-24></a><span class=c1># 生产环境</span>
<a id=__codelineno-42-25 name=__codelineno-42-25 href=#__codelineno-42-25></a><span class=nv>prod_IP</span><span class=o>=</span><span class=s2>&quot;192.168.1.16&quot;</span>
<a id=__codelineno-42-26 name=__codelineno-42-26 href=#__codelineno-42-26></a><span class=nv>prod_Port</span><span class=o>=</span><span class=s2>&quot;23306&quot;</span>
<a id=__codelineno-42-27 name=__codelineno-42-27 href=#__codelineno-42-27></a><span class=nv>prod_Pass</span><span class=o>=</span><span class=s2>&quot;123456Aa.&quot;</span>
<a id=__codelineno-42-28 name=__codelineno-42-28 href=#__codelineno-42-28></a>
<a id=__codelineno-42-29 name=__codelineno-42-29 href=#__codelineno-42-29></a><span class=c1># 导出研发环境的表</span>
<a id=__codelineno-42-30 name=__codelineno-42-30 href=#__codelineno-42-30></a><span class=k>for</span><span class=w> </span>i<span class=w> </span><span class=k>in</span><span class=w> </span><span class=si>${</span><span class=nv>table_Name</span><span class=p>[*]</span><span class=si>}</span>
<a id=__codelineno-42-31 name=__codelineno-42-31 href=#__codelineno-42-31></a><span class=k>do</span>
<a id=__codelineno-42-32 name=__codelineno-42-32 href=#__codelineno-42-32></a><span class=w>        </span>mysqldump<span class=w> </span>-h<span class=si>${</span><span class=nv>dev_IP</span><span class=si>}</span><span class=w> </span>-uroot<span class=w> </span>-P<span class=si>${</span><span class=nv>dev_Port</span><span class=si>}</span><span class=w> </span>-p<span class=si>${</span><span class=nv>dev_Pass</span><span class=si>}</span><span class=w> </span><span class=si>${</span><span class=nv>db_Name</span><span class=si>}</span><span class=w> </span><span class=si>${</span><span class=nv>i</span><span class=si>}</span><span class=w> </span>&gt;<span class=w> </span>./sql/<span class=si>${</span><span class=nv>time</span><span class=si>}</span>/dev.sql
<a id=__codelineno-42-33 name=__codelineno-42-33 href=#__codelineno-42-33></a><span class=k>done</span>
<a id=__codelineno-42-34 name=__codelineno-42-34 href=#__codelineno-42-34></a>
<a id=__codelineno-42-35 name=__codelineno-42-35 href=#__codelineno-42-35></a><span class=c1># 导出生产环境的整个库</span>
<a id=__codelineno-42-36 name=__codelineno-42-36 href=#__codelineno-42-36></a>mysqldump<span class=w> </span>-h<span class=si>${</span><span class=nv>prod_IP</span><span class=si>}</span><span class=w> </span>-uroot<span class=w> </span>-P<span class=si>${</span><span class=nv>prod_Port</span><span class=si>}</span><span class=w> </span>-p<span class=si>${</span><span class=nv>prod_Pass</span><span class=si>}</span><span class=w> </span><span class=si>${</span><span class=nv>db_Name</span><span class=si>}</span><span class=w> </span>&gt;<span class=w> </span>./sql/<span class=si>${</span><span class=nv>time</span><span class=si>}</span>/<span class=si>${</span><span class=nv>db_Name</span><span class=si>}</span>.sql
<a id=__codelineno-42-37 name=__codelineno-42-37 href=#__codelineno-42-37></a>
<a id=__codelineno-42-38 name=__codelineno-42-38 href=#__codelineno-42-38></a><span class=c1># 删除生产环境的表</span>
<a id=__codelineno-42-39 name=__codelineno-42-39 href=#__codelineno-42-39></a><span class=k>for</span><span class=w> </span>i<span class=w> </span><span class=k>in</span><span class=w> </span><span class=si>${</span><span class=nv>table_Name</span><span class=p>[*]</span><span class=si>}</span>
<a id=__codelineno-42-40 name=__codelineno-42-40 href=#__codelineno-42-40></a><span class=k>do</span>
<a id=__codelineno-42-41 name=__codelineno-42-41 href=#__codelineno-42-41></a><span class=w>        </span>mysql<span class=w> </span>-h<span class=si>${</span><span class=nv>prod_IP</span><span class=si>}</span><span class=w> </span>-uroot<span class=w> </span>-P<span class=si>${</span><span class=nv>prod_Port</span><span class=si>}</span><span class=w> </span>-p<span class=si>${</span><span class=nv>prod_Pass</span><span class=si>}</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;USE </span><span class=si>${</span><span class=nv>db_Name</span><span class=si>}</span><span class=s2>;DROP TABLE </span><span class=si>${</span><span class=nv>i</span><span class=si>}</span><span class=s2>&quot;</span>
<a id=__codelineno-42-42 name=__codelineno-42-42 href=#__codelineno-42-42></a><span class=k>done</span>
<a id=__codelineno-42-43 name=__codelineno-42-43 href=#__codelineno-42-43></a>
<a id=__codelineno-42-44 name=__codelineno-42-44 href=#__codelineno-42-44></a><span class=c1># 导入研发环境的表</span>
<a id=__codelineno-42-45 name=__codelineno-42-45 href=#__codelineno-42-45></a>mysql<span class=w> </span>-h<span class=si>${</span><span class=nv>prod_IP</span><span class=si>}</span><span class=w> </span>-uroot<span class=w> </span>-P<span class=si>${</span><span class=nv>prod_Port</span><span class=si>}</span><span class=w> </span>-p<span class=si>${</span><span class=nv>prod_Pass</span><span class=si>}</span><span class=w> </span><span class=si>${</span><span class=nv>db_Name</span><span class=si>}</span><span class=w> </span>&lt;<span class=w> </span>./sql/<span class=si>${</span><span class=nv>time</span><span class=si>}</span>/dev.sql
</code></pre></div> <h2 id=27shell实现多并发控制>27.shell实现多并发控制<a class=headerlink href=#27shell实现多并发控制 title="Permanent link">&para;</a></h2> <h3 id=不并发>不并发<a class=headerlink href=#不并发 title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-43-1 name=__codelineno-43-1 href=#__codelineno-43-1></a><span class=ch>#!/usr/bin/env bash</span>
<a id=__codelineno-43-2 name=__codelineno-43-2 href=#__codelineno-43-2></a><span class=c1>#usage:xxx</span>
<a id=__codelineno-43-3 name=__codelineno-43-3 href=#__codelineno-43-3></a><span class=c1>#scripts_name:xxx.sh</span>
<a id=__codelineno-43-4 name=__codelineno-43-4 href=#__codelineno-43-4></a><span class=nv>shutdown_instance_array</span><span class=o>=(</span><span class=k>$(</span>nova<span class=w> </span>list<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>SHUTOFF<span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span>-F<span class=w> </span><span class=s2>&quot;|&quot;</span><span class=w> </span><span class=s1>&#39;{print $2}&#39;</span><span class=k>)</span><span class=o>)</span>
<a id=__codelineno-43-5 name=__codelineno-43-5 href=#__codelineno-43-5></a><span class=nv>shutdown_instance_Name</span><span class=o>=(</span><span class=k>$(</span>nova<span class=w> </span>list<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>SHUTOFF<span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span>-F<span class=w> </span><span class=s2>&quot;|&quot;</span><span class=w> </span><span class=s1>&#39;{print $3}&#39;</span><span class=k>)</span><span class=o>)</span>
<a id=__codelineno-43-6 name=__codelineno-43-6 href=#__codelineno-43-6></a><span class=nb>declare</span><span class=w> </span>-A<span class=w> </span>array_instance
<a id=__codelineno-43-7 name=__codelineno-43-7 href=#__codelineno-43-7></a>
<a id=__codelineno-43-8 name=__codelineno-43-8 href=#__codelineno-43-8></a><span class=c1># 设置关联数组</span>
<a id=__codelineno-43-9 name=__codelineno-43-9 href=#__codelineno-43-9></a><span class=k>for</span><span class=w> </span>i<span class=w> </span><span class=k>in</span><span class=w> </span><span class=si>${</span><span class=p>!shutdown_instance_array[@]</span><span class=si>}</span><span class=p>;</span><span class=w> </span><span class=k>do</span><span class=w> </span>array_instance<span class=o>[</span><span class=si>${</span><span class=nv>shutdown_instance_Name</span><span class=p>[</span><span class=nv>$i</span><span class=p>]</span><span class=si>}</span><span class=o>]=</span><span class=si>${</span><span class=nv>shutdown_instance_array</span><span class=p>[</span><span class=nv>$i</span><span class=p>]</span><span class=si>}</span><span class=p>;</span><span class=w> </span><span class=k>done</span>
<a id=__codelineno-43-10 name=__codelineno-43-10 href=#__codelineno-43-10></a>
<a id=__codelineno-43-11 name=__codelineno-43-11 href=#__codelineno-43-11></a><span class=nv>name_arry</span><span class=o>=(</span><span class=si>${</span><span class=p>!array_instance[@]</span><span class=si>}</span><span class=o>)</span><span class=w> </span><span class=c1>#key -name</span>
<a id=__codelineno-43-12 name=__codelineno-43-12 href=#__codelineno-43-12></a><span class=nv>id_arry</span><span class=o>=(</span><span class=si>${</span><span class=nv>array_instance</span><span class=p>[@]</span><span class=si>}</span><span class=o>)</span><span class=w>    </span><span class=c1>#value -id</span>
<a id=__codelineno-43-13 name=__codelineno-43-13 href=#__codelineno-43-13></a>
<a id=__codelineno-43-14 name=__codelineno-43-14 href=#__codelineno-43-14></a><span class=k>for</span><span class=w> </span><span class=o>((</span><span class=nv>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>0</span><span class=p>;</span><span class=w> </span>i<span class=w> </span>&lt;<span class=w> </span><span class=si>${#</span><span class=nv>shutdown_instance_array</span><span class=p>[@]</span><span class=si>}</span><span class=p>;</span><span class=w> </span>i++<span class=o>))</span><span class=p>;</span><span class=w> </span><span class=k>do</span>
<a id=__codelineno-43-15 name=__codelineno-43-15 href=#__codelineno-43-15></a><span class=o>{</span>
<a id=__codelineno-43-16 name=__codelineno-43-16 href=#__codelineno-43-16></a><span class=c1>#     echo ${name_arry[$i]}</span>
<a id=__codelineno-43-17 name=__codelineno-43-17 href=#__codelineno-43-17></a><span class=w>    </span><span class=nv>map_dev</span><span class=o>=</span><span class=k>$(</span>rbd<span class=w> </span>map<span class=w> </span><span class=si>${</span><span class=nv>id_arry</span><span class=p>[</span><span class=nv>$i</span><span class=p>]</span><span class=si>}</span>_disk<span class=w> </span>-p<span class=w> </span>vms<span class=k>)</span>
<a id=__codelineno-43-18 name=__codelineno-43-18 href=#__codelineno-43-18></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;xfs_repair -L </span><span class=nv>$map_dev</span><span class=s2> &gt; </span><span class=si>${</span><span class=nv>name_arry</span><span class=p>[</span><span class=nv>$i</span><span class=p>]</span><span class=si>}</span><span class=s2>.log 2&gt;&amp;1 &amp;&quot;</span>
<a id=__codelineno-43-19 name=__codelineno-43-19 href=#__codelineno-43-19></a><span class=w>  </span><span class=o>}</span><span class=w> </span><span class=p>&amp;</span>
<a id=__codelineno-43-20 name=__codelineno-43-20 href=#__codelineno-43-20></a><span class=w>    </span>sleep<span class=w> </span><span class=m>1</span>
<a id=__codelineno-43-21 name=__codelineno-43-21 href=#__codelineno-43-21></a><span class=k>done</span>
<a id=__codelineno-43-22 name=__codelineno-43-22 href=#__codelineno-43-22></a><span class=nb>wait</span>
<a id=__codelineno-43-23 name=__codelineno-43-23 href=#__codelineno-43-23></a>
<a id=__codelineno-43-24 name=__codelineno-43-24 href=#__codelineno-43-24></a><span class=nv>stop_time</span><span class=o>=</span><span class=k>$(</span>date<span class=w> </span>+%s<span class=k>)</span><span class=w> </span><span class=c1>#定义脚本运行的结束时间</span>
<a id=__codelineno-43-25 name=__codelineno-43-25 href=#__codelineno-43-25></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;TIME:`expr </span><span class=nv>$stop_time</span><span class=s2> - </span><span class=nv>$start_time</span><span class=s2>`&quot;</span>
</code></pre></div> <h3 id=控制并发>控制并发<a class=headerlink href=#控制并发 title="Permanent link">&para;</a></h3> <h4 id=示例1>示例1<a class=headerlink href=#示例1 title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><a id=__codelineno-44-1 name=__codelineno-44-1 href=#__codelineno-44-1></a><span class=ch>#!/usr/bin/env bash</span>
<a id=__codelineno-44-2 name=__codelineno-44-2 href=#__codelineno-44-2></a><span class=c1>#usage: To repair the virtual machine hard disk, the virtual machine must be off</span>
<a id=__codelineno-44-3 name=__codelineno-44-3 href=#__codelineno-44-3></a><span class=nb>source</span><span class=w> </span>/etc/kolla/admin-openrc.sh
<a id=__codelineno-44-4 name=__codelineno-44-4 href=#__codelineno-44-4></a><span class=nv>start_time</span><span class=o>=</span><span class=k>$(</span>date<span class=w> </span>+%s<span class=k>)</span>
<a id=__codelineno-44-5 name=__codelineno-44-5 href=#__codelineno-44-5></a>
<a id=__codelineno-44-6 name=__codelineno-44-6 href=#__codelineno-44-6></a><span class=nv>Nproc</span><span class=o>=</span><span class=m>5</span>
<a id=__codelineno-44-7 name=__codelineno-44-7 href=#__codelineno-44-7></a>
<a id=__codelineno-44-8 name=__codelineno-44-8 href=#__codelineno-44-8></a><span class=nv>shutdown_instance_array</span><span class=o>=(</span><span class=k>$(</span>nova<span class=w> </span>list<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>SHUTOFF<span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span>-F<span class=w> </span><span class=s2>&quot;|&quot;</span><span class=w> </span><span class=s1>&#39;{print $2}&#39;</span><span class=k>)</span><span class=o>)</span>
<a id=__codelineno-44-9 name=__codelineno-44-9 href=#__codelineno-44-9></a><span class=nv>shutdown_instance_Name</span><span class=o>=(</span><span class=k>$(</span>nova<span class=w> </span>list<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>SHUTOFF<span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span>-F<span class=w> </span><span class=s2>&quot;|&quot;</span><span class=w> </span><span class=s1>&#39;{print $3}&#39;</span><span class=k>)</span><span class=o>)</span>
<a id=__codelineno-44-10 name=__codelineno-44-10 href=#__codelineno-44-10></a><span class=nb>declare</span><span class=w> </span>-A<span class=w> </span>array_instance
<a id=__codelineno-44-11 name=__codelineno-44-11 href=#__codelineno-44-11></a>
<a id=__codelineno-44-12 name=__codelineno-44-12 href=#__codelineno-44-12></a><span class=c1># 设置关联数组</span>
<a id=__codelineno-44-13 name=__codelineno-44-13 href=#__codelineno-44-13></a><span class=k>for</span><span class=w> </span>i<span class=w> </span><span class=k>in</span><span class=w> </span><span class=si>${</span><span class=p>!shutdown_instance_array[@]</span><span class=si>}</span><span class=p>;</span><span class=w> </span><span class=k>do</span><span class=w> </span>array_instance<span class=o>[</span><span class=si>${</span><span class=nv>shutdown_instance_Name</span><span class=p>[</span><span class=nv>$i</span><span class=p>]</span><span class=si>}</span><span class=o>]=</span><span class=si>${</span><span class=nv>shutdown_instance_array</span><span class=p>[</span><span class=nv>$i</span><span class=p>]</span><span class=si>}</span><span class=p>;</span><span class=w> </span><span class=k>done</span>
<a id=__codelineno-44-14 name=__codelineno-44-14 href=#__codelineno-44-14></a><span class=nv>name_arry</span><span class=o>=(</span><span class=si>${</span><span class=p>!array_instance[@]</span><span class=si>}</span><span class=o>)</span><span class=w> </span><span class=c1>#key -name</span>
<a id=__codelineno-44-15 name=__codelineno-44-15 href=#__codelineno-44-15></a><span class=nv>id_arry</span><span class=o>=(</span><span class=si>${</span><span class=nv>array_instance</span><span class=p>[@]</span><span class=si>}</span><span class=o>)</span><span class=w>    </span><span class=c1>#value -id</span>
<a id=__codelineno-44-16 name=__codelineno-44-16 href=#__codelineno-44-16></a>
<a id=__codelineno-44-17 name=__codelineno-44-17 href=#__codelineno-44-17></a>
<a id=__codelineno-44-18 name=__codelineno-44-18 href=#__codelineno-44-18></a><span class=o>[</span><span class=w> </span>-e<span class=w> </span>/tmp/fifo.<span class=nv>$$</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>||</span><span class=w> </span>mkfifo<span class=w> </span>/tmp/fifo.<span class=nv>$$</span>
<a id=__codelineno-44-19 name=__codelineno-44-19 href=#__codelineno-44-19></a><span class=nb>exec</span><span class=w> </span><span class=m>3</span>&lt;&gt;/tmp/fifo.<span class=nv>$$</span>
<a id=__codelineno-44-20 name=__codelineno-44-20 href=#__codelineno-44-20></a>rm<span class=w> </span>-f<span class=w> </span>/tmp/fifo.<span class=nv>$$</span>
<a id=__codelineno-44-21 name=__codelineno-44-21 href=#__codelineno-44-21></a>
<a id=__codelineno-44-22 name=__codelineno-44-22 href=#__codelineno-44-22></a><span class=k>for</span><span class=w> </span><span class=o>((</span><span class=nv>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>0</span><span class=p>;</span><span class=w> </span>i<span class=w> </span>&lt;<span class=w> </span><span class=nv>$Nproc</span><span class=p>;</span><span class=w> </span>i++<span class=o>))</span><span class=p>;</span><span class=w> </span><span class=k>do</span>
<a id=__codelineno-44-23 name=__codelineno-44-23 href=#__codelineno-44-23></a><span class=w>  </span><span class=nb>echo</span><span class=w> </span>&gt;<span class=p>&amp;</span><span class=m>3</span>
<a id=__codelineno-44-24 name=__codelineno-44-24 href=#__codelineno-44-24></a><span class=k>done</span>
<a id=__codelineno-44-25 name=__codelineno-44-25 href=#__codelineno-44-25></a>
<a id=__codelineno-44-26 name=__codelineno-44-26 href=#__codelineno-44-26></a><span class=k>for</span><span class=w> </span><span class=o>((</span><span class=nv>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>0</span><span class=p>;</span><span class=w> </span>i<span class=w> </span>&lt;<span class=w> </span><span class=si>${#</span><span class=nv>shutdown_instance_array</span><span class=p>[@]</span><span class=si>}</span><span class=p>;</span><span class=w> </span>i++<span class=o>))</span><span class=p>;</span><span class=w> </span><span class=k>do</span>
<a id=__codelineno-44-27 name=__codelineno-44-27 href=#__codelineno-44-27></a><span class=w>  </span><span class=o>{</span>
<a id=__codelineno-44-28 name=__codelineno-44-28 href=#__codelineno-44-28></a><span class=w>    </span><span class=nb>read</span><span class=w> </span>-u3
<a id=__codelineno-44-29 name=__codelineno-44-29 href=#__codelineno-44-29></a><span class=w>    </span>sleep<span class=w> </span><span class=m>1</span>
<a id=__codelineno-44-30 name=__codelineno-44-30 href=#__codelineno-44-30></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;xfs_repair instamceName: </span><span class=si>${</span><span class=nv>name_arry</span><span class=p>[</span><span class=nv>$i</span><span class=p>]</span><span class=si>}</span><span class=s2> instamceID: </span><span class=si>${</span><span class=nv>id_arry</span><span class=p>[</span><span class=nv>$i</span><span class=p>]</span><span class=si>}</span><span class=s2> &quot;</span>
<a id=__codelineno-44-31 name=__codelineno-44-31 href=#__codelineno-44-31></a><span class=w>    </span><span class=nv>device_name</span><span class=o>=</span><span class=k>$(</span>rbd<span class=w> </span>map<span class=w> </span><span class=si>${</span><span class=nv>id_arry</span><span class=p>[</span><span class=nv>$i</span><span class=p>]</span><span class=si>}</span>_disk<span class=w> </span>-p<span class=w> </span>vms<span class=k>)</span>
<a id=__codelineno-44-32 name=__codelineno-44-32 href=#__codelineno-44-32></a><span class=w>    </span>xfs_repair<span class=w> </span>-L<span class=w> </span><span class=si>${</span><span class=nv>device_name</span><span class=si>}</span><span class=w> </span>&gt;<span class=w> </span><span class=si>${</span><span class=nv>name_arry</span><span class=p>[</span><span class=nv>$i</span><span class=p>]</span><span class=si>}</span>_<span class=nv>$$</span>.log<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-44-33 name=__codelineno-44-33 href=#__codelineno-44-33></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;instamceName: </span><span class=si>${</span><span class=nv>name_arry</span><span class=p>[</span><span class=nv>$i</span><span class=p>]</span><span class=si>}</span><span class=s2> instamceID: </span><span class=si>${</span><span class=nv>id_arry</span><span class=p>[</span><span class=nv>$i</span><span class=p>]</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span>repairInformationSummary.log
<a id=__codelineno-44-34 name=__codelineno-44-34 href=#__codelineno-44-34></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>&gt;<span class=p>&amp;</span><span class=m>3</span><span class=w> </span><span class=c1>#执行到最后，把令牌放回管道</span>
<a id=__codelineno-44-35 name=__codelineno-44-35 href=#__codelineno-44-35></a>
<a id=__codelineno-44-36 name=__codelineno-44-36 href=#__codelineno-44-36></a><span class=w>  </span><span class=o>}</span><span class=p>&amp;</span>
<a id=__codelineno-44-37 name=__codelineno-44-37 href=#__codelineno-44-37></a><span class=k>done</span>
<a id=__codelineno-44-38 name=__codelineno-44-38 href=#__codelineno-44-38></a><span class=nb>wait</span>
<a id=__codelineno-44-39 name=__codelineno-44-39 href=#__codelineno-44-39></a>
<a id=__codelineno-44-40 name=__codelineno-44-40 href=#__codelineno-44-40></a><span class=nv>stop_time</span><span class=o>=</span><span class=k>$(</span>date<span class=w> </span>+%s<span class=k>)</span>
<a id=__codelineno-44-41 name=__codelineno-44-41 href=#__codelineno-44-41></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;TIME:</span><span class=k>$(</span>expr<span class=w> </span><span class=nv>$stop_time</span><span class=w> </span>-<span class=w> </span><span class=nv>$start_time</span><span class=k>)</span><span class=s2>&quot;</span>
<a id=__codelineno-44-42 name=__codelineno-44-42 href=#__codelineno-44-42></a>
<a id=__codelineno-44-43 name=__codelineno-44-43 href=#__codelineno-44-43></a><span class=nb>exec</span><span class=w> </span><span class=m>3</span>&lt;<span class=p>&amp;</span>-
</code></pre></div> <h4 id=示例2>示例2<a class=headerlink href=#示例2 title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><a id=__codelineno-45-1 name=__codelineno-45-1 href=#__codelineno-45-1></a><span class=ch>#!/usr/bin/env bash</span>
<a id=__codelineno-45-2 name=__codelineno-45-2 href=#__codelineno-45-2></a><span class=c1>#usage:xxx</span>
<a id=__codelineno-45-3 name=__codelineno-45-3 href=#__codelineno-45-3></a><span class=c1>#scripts_name:xxx.sh</span>
<a id=__codelineno-45-4 name=__codelineno-45-4 href=#__codelineno-45-4></a>
<a id=__codelineno-45-5 name=__codelineno-45-5 href=#__codelineno-45-5></a><span class=nv>thread</span><span class=o>=</span><span class=m>5</span>
<a id=__codelineno-45-6 name=__codelineno-45-6 href=#__codelineno-45-6></a><span class=nv>tmp_fifofile</span><span class=o>=</span>/tmp/<span class=nv>$$</span>.fifo
<a id=__codelineno-45-7 name=__codelineno-45-7 href=#__codelineno-45-7></a>
<a id=__codelineno-45-8 name=__codelineno-45-8 href=#__codelineno-45-8></a>mkfifo<span class=w> </span><span class=nv>$tmp_fifofile</span>
<a id=__codelineno-45-9 name=__codelineno-45-9 href=#__codelineno-45-9></a><span class=nb>exec</span><span class=w> </span><span class=m>8</span>&lt;&gt;<span class=w> </span><span class=nv>$tmp_fifofile</span>
<a id=__codelineno-45-10 name=__codelineno-45-10 href=#__codelineno-45-10></a>rm<span class=w> </span><span class=nv>$tmp_fifofile</span>
<a id=__codelineno-45-11 name=__codelineno-45-11 href=#__codelineno-45-11></a>
<a id=__codelineno-45-12 name=__codelineno-45-12 href=#__codelineno-45-12></a><span class=k>for</span><span class=w> </span>i<span class=w> </span><span class=k>in</span><span class=w> </span><span class=sb>`</span>seq<span class=w> </span><span class=nv>$thread</span><span class=sb>`</span>
<a id=__codelineno-45-13 name=__codelineno-45-13 href=#__codelineno-45-13></a><span class=k>do</span>
<a id=__codelineno-45-14 name=__codelineno-45-14 href=#__codelineno-45-14></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=nv>$i</span><span class=w> </span><span class=p>&amp;</span>&gt;<span class=w> </span><span class=m>8</span>
<a id=__codelineno-45-15 name=__codelineno-45-15 href=#__codelineno-45-15></a><span class=k>done</span>
<a id=__codelineno-45-16 name=__codelineno-45-16 href=#__codelineno-45-16></a>
<a id=__codelineno-45-17 name=__codelineno-45-17 href=#__codelineno-45-17></a><span class=k>for</span><span class=w> </span>i<span class=w> </span><span class=k>in</span><span class=w> </span><span class=o>{</span><span class=m>1</span>..245<span class=o>}</span>
<a id=__codelineno-45-18 name=__codelineno-45-18 href=#__codelineno-45-18></a><span class=k>do</span>
<a id=__codelineno-45-19 name=__codelineno-45-19 href=#__codelineno-45-19></a><span class=w>    </span><span class=nb>read</span><span class=w> </span>-u8
<a id=__codelineno-45-20 name=__codelineno-45-20 href=#__codelineno-45-20></a><span class=w>    </span><span class=o>{</span>
<a id=__codelineno-45-21 name=__codelineno-45-21 href=#__codelineno-45-21></a><span class=w>        </span><span class=nv>ip</span><span class=o>=</span><span class=m>192</span>.168.122.<span class=nv>$i</span>
<a id=__codelineno-45-22 name=__codelineno-45-22 href=#__codelineno-45-22></a><span class=w>        </span>ping<span class=w> </span>-c1<span class=w> </span>-W1<span class=w> </span><span class=nv>$ip</span><span class=w> </span><span class=p>&amp;</span>&gt;/dev/null
<a id=__codelineno-45-23 name=__codelineno-45-23 href=#__codelineno-45-23></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=nv>$?</span><span class=w> </span>-eq<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=k>then</span>
<a id=__codelineno-45-24 name=__codelineno-45-24 href=#__codelineno-45-24></a><span class=w>            </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$ip</span><span class=s2> is down!&quot;</span>
<a id=__codelineno-45-25 name=__codelineno-45-25 href=#__codelineno-45-25></a><span class=w>        </span><span class=k>else</span>
<a id=__codelineno-45-26 name=__codelineno-45-26 href=#__codelineno-45-26></a><span class=w>            </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$ip</span><span class=s2> is up&quot;</span>
<a id=__codelineno-45-27 name=__codelineno-45-27 href=#__codelineno-45-27></a><span class=w>        </span><span class=k>fi</span>
<a id=__codelineno-45-28 name=__codelineno-45-28 href=#__codelineno-45-28></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=nv>$i</span><span class=w> </span>&gt;<span class=p>&amp;</span><span class=w> </span><span class=m>8</span>
<a id=__codelineno-45-29 name=__codelineno-45-29 href=#__codelineno-45-29></a><span class=w>    </span><span class=o>}</span><span class=p>&amp;</span>
<a id=__codelineno-45-30 name=__codelineno-45-30 href=#__codelineno-45-30></a><span class=k>done</span>
<a id=__codelineno-45-31 name=__codelineno-45-31 href=#__codelineno-45-31></a><span class=nb>wait</span>
<a id=__codelineno-45-32 name=__codelineno-45-32 href=#__codelineno-45-32></a><span class=nb>exec</span><span class=w> </span><span class=m>8</span><span class=w> </span>&lt;<span class=p>&amp;</span>-
<a id=__codelineno-45-33 name=__codelineno-45-33 href=#__codelineno-45-33></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;all finished......&quot;</span>
</code></pre></div> <h4 id=示例3>示例3<a class=headerlink href=#示例3 title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><a id=__codelineno-46-1 name=__codelineno-46-1 href=#__codelineno-46-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-46-2 name=__codelineno-46-2 href=#__codelineno-46-2></a>date
<a id=__codelineno-46-3 name=__codelineno-46-3 href=#__codelineno-46-3></a>
<a id=__codelineno-46-4 name=__codelineno-46-4 href=#__codelineno-46-4></a><span class=nv>DIR</span><span class=o>=</span>/test/log/
<a id=__codelineno-46-5 name=__codelineno-46-5 href=#__codelineno-46-5></a>
<a id=__codelineno-46-6 name=__codelineno-46-6 href=#__codelineno-46-6></a><span class=nv>FILE_NAME</span><span class=o>=</span>65535_<span class=sb>`</span>date<span class=w> </span>+<span class=s2>&quot;%Y%m%d&quot;</span><span class=sb>`</span><span class=p>;</span>
<a id=__codelineno-46-7 name=__codelineno-46-7 href=#__codelineno-46-7></a><span class=nv>FILE_NAME_LAST_DAY</span><span class=o>=</span><span class=sb>`</span>date<span class=w> </span>-d<span class=w> </span><span class=s2>&quot;yesterday&quot;</span><span class=w> </span>+<span class=s2>&quot;%Y%m%d&quot;</span><span class=sb>`</span><span class=p>;</span>
<a id=__codelineno-46-8 name=__codelineno-46-8 href=#__codelineno-46-8></a>
<a id=__codelineno-46-9 name=__codelineno-46-9 href=#__codelineno-46-9></a><span class=nv>time_of_system</span><span class=o>=</span><span class=sb>`</span>date<span class=w> </span>+<span class=s2>&quot;%Y-%m-%d&quot;</span><span class=sb>`</span>
<a id=__codelineno-46-10 name=__codelineno-46-10 href=#__codelineno-46-10></a>
<a id=__codelineno-46-11 name=__codelineno-46-11 href=#__codelineno-46-11></a><span class=k>function</span><span class=w> </span>multi_processor<span class=o>(){</span>
<a id=__codelineno-46-12 name=__codelineno-46-12 href=#__codelineno-46-12></a><span class=w>    </span><span class=o>[</span><span class=w> </span>-e<span class=w> </span>/tmp/fd1<span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>||</span><span class=w> </span>mkfifo<span class=w> </span>/tmp/fd1
<a id=__codelineno-46-13 name=__codelineno-46-13 href=#__codelineno-46-13></a><span class=w>    </span><span class=nb>exec</span><span class=w> </span><span class=m>3</span>&lt;&gt;/tmp/fd1
<a id=__codelineno-46-14 name=__codelineno-46-14 href=#__codelineno-46-14></a><span class=w>    </span>rm<span class=w> </span>-rf<span class=w> </span>/tmp/fd1
<a id=__codelineno-46-15 name=__codelineno-46-15 href=#__codelineno-46-15></a><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=o>((</span><span class=nv>i</span><span class=o>=</span><span class=m>1</span><span class=p>;</span>i&lt;<span class=o>=</span><span class=m>30</span><span class=p>;</span>i++<span class=o>))</span>
<a id=__codelineno-46-16 name=__codelineno-46-16 href=#__codelineno-46-16></a><span class=w>    </span><span class=k>do</span>
<a id=__codelineno-46-17 name=__codelineno-46-17 href=#__codelineno-46-17></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span>&gt;<span class=p>&amp;</span><span class=m>3</span>
<a id=__codelineno-46-18 name=__codelineno-46-18 href=#__codelineno-46-18></a><span class=w>    </span><span class=k>done</span>
<a id=__codelineno-46-19 name=__codelineno-46-19 href=#__codelineno-46-19></a>
<a id=__codelineno-46-20 name=__codelineno-46-20 href=#__codelineno-46-20></a><span class=w>    </span><span class=k>for</span><span class=w> </span>file<span class=w> </span><span class=k>in</span><span class=w> </span><span class=nv>$1</span>
<a id=__codelineno-46-21 name=__codelineno-46-21 href=#__codelineno-46-21></a><span class=w>    </span><span class=k>do</span>
<a id=__codelineno-46-22 name=__codelineno-46-22 href=#__codelineno-46-22></a><span class=w>    </span><span class=nb>read</span><span class=w> </span>-u3
<a id=__codelineno-46-23 name=__codelineno-46-23 href=#__codelineno-46-23></a><span class=w>    </span><span class=o>{</span>
<a id=__codelineno-46-24 name=__codelineno-46-24 href=#__codelineno-46-24></a><span class=w>        </span>grep<span class=w> </span><span class=nv>$3</span><span class=w> </span><span class=nv>$file</span><span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span>-F<span class=s2>&quot;|&quot;</span><span class=w> </span><span class=s1>&#39;{print $7}&#39;</span><span class=w> </span><span class=p>|</span><span class=w> </span>sort<span class=w> </span><span class=p>|</span><span class=w> </span>uniq<span class=w> </span>&gt;&gt;<span class=w> </span><span class=nv>$2</span><span class=p>;</span>
<a id=__codelineno-46-25 name=__codelineno-46-25 href=#__codelineno-46-25></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span>&gt;<span class=p>&amp;</span><span class=m>3</span>
<a id=__codelineno-46-26 name=__codelineno-46-26 href=#__codelineno-46-26></a><span class=w>    </span><span class=o>}</span><span class=p>&amp;</span>
<a id=__codelineno-46-27 name=__codelineno-46-27 href=#__codelineno-46-27></a><span class=w>    </span><span class=k>done</span>
<a id=__codelineno-46-28 name=__codelineno-46-28 href=#__codelineno-46-28></a><span class=w>    </span><span class=nb>wait</span>
<a id=__codelineno-46-29 name=__codelineno-46-29 href=#__codelineno-46-29></a>
<a id=__codelineno-46-30 name=__codelineno-46-30 href=#__codelineno-46-30></a><span class=w>    </span><span class=nb>exec</span><span class=w> </span><span class=m>3</span>&lt;<span class=p>&amp;</span>-
<a id=__codelineno-46-31 name=__codelineno-46-31 href=#__codelineno-46-31></a><span class=w>    </span><span class=nb>exec</span><span class=w> </span><span class=m>3</span>&gt;<span class=p>&amp;</span>-
<a id=__codelineno-46-32 name=__codelineno-46-32 href=#__codelineno-46-32></a><span class=o>}</span>
<a id=__codelineno-46-33 name=__codelineno-46-33 href=#__codelineno-46-33></a>
<a id=__codelineno-46-34 name=__codelineno-46-34 href=#__codelineno-46-34></a><span class=c1>#register 1 day ago</span>
<a id=__codelineno-46-35 name=__codelineno-46-35 href=#__codelineno-46-35></a><span class=nv>register_file</span><span class=o>=</span>register_file_1_day_ago_<span class=nv>$HOSTNAME</span>.txt
<a id=__codelineno-46-36 name=__codelineno-46-36 href=#__codelineno-46-36></a><span class=nv>file_modify_time</span><span class=o>=</span><span class=sb>`</span>stat<span class=w> </span><span class=nv>$register_file</span><span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>Modify<span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span><span class=s1>&#39;{print $2}&#39;</span><span class=sb>`</span>
<a id=__codelineno-46-37 name=__codelineno-46-37 href=#__codelineno-46-37></a><span class=nv>files_last_day</span><span class=o>=</span><span class=sb>`</span>find<span class=w> </span><span class=nv>$DIR</span><span class=w> </span>-type<span class=w> </span>f<span class=w> </span>-name<span class=w> </span><span class=s2>&quot;</span><span class=nv>$FILE_NAME_LAST_DAY</span><span class=s2>*&quot;</span><span class=sb>`</span>
<a id=__codelineno-46-38 name=__codelineno-46-38 href=#__codelineno-46-38></a><span class=k>if</span><span class=w> </span><span class=o>[[</span><span class=w> </span><span class=nv>$file_modify_time</span><span class=w> </span>!<span class=o>=</span><span class=w> </span><span class=nv>$time_of_system</span><span class=w> </span><span class=o>]]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-46-39 name=__codelineno-46-39 href=#__codelineno-46-39></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$register_file</span><span class=s2> file_modify_time(</span><span class=si>${</span><span class=nv>file_modify_time</span><span class=si>}</span><span class=s2>) time_of_system(</span><span class=si>${</span><span class=nv>time_of_system</span><span class=si>}</span><span class=s2>)&quot;</span>
<a id=__codelineno-46-40 name=__codelineno-46-40 href=#__codelineno-46-40></a><span class=w>    </span>rm<span class=w> </span><span class=nv>$register_file</span>
<a id=__codelineno-46-41 name=__codelineno-46-41 href=#__codelineno-46-41></a><span class=w>    </span>multi_processor<span class=w> </span><span class=s2>&quot;</span><span class=nv>$files_last_day</span><span class=s2>&quot;</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$register_file</span><span class=s2>&quot;</span><span class=w> </span><span class=s2>&quot;REGISTER&quot;</span>
<a id=__codelineno-46-42 name=__codelineno-46-42 href=#__codelineno-46-42></a><span class=k>fi</span>
</code></pre></div> <h4 id=示例4>示例4<a class=headerlink href=#示例4 title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><a id=__codelineno-47-1 name=__codelineno-47-1 href=#__codelineno-47-1></a><span class=ch>#!/usr/bin/env bash</span>
<a id=__codelineno-47-2 name=__codelineno-47-2 href=#__codelineno-47-2></a><span class=c1>#usage:xxx</span>
<a id=__codelineno-47-3 name=__codelineno-47-3 href=#__codelineno-47-3></a><span class=c1>#scripts_name:xxx.sh</span>
<a id=__codelineno-47-4 name=__codelineno-47-4 href=#__codelineno-47-4></a><span class=c1># author：xiaojian</span>
<a id=__codelineno-47-5 name=__codelineno-47-5 href=#__codelineno-47-5></a>
<a id=__codelineno-47-6 name=__codelineno-47-6 href=#__codelineno-47-6></a><span class=nv>Njob</span><span class=o>=</span><span class=m>15</span><span class=w> </span><span class=c1>#任务总数</span>
<a id=__codelineno-47-7 name=__codelineno-47-7 href=#__codelineno-47-7></a>
<a id=__codelineno-47-8 name=__codelineno-47-8 href=#__codelineno-47-8></a><span class=nv>Nproc</span><span class=o>=</span><span class=m>5</span><span class=w> </span><span class=c1>#最大并发进程数</span>
<a id=__codelineno-47-9 name=__codelineno-47-9 href=#__codelineno-47-9></a>
<a id=__codelineno-47-10 name=__codelineno-47-10 href=#__codelineno-47-10></a>mkfifo<span class=w> </span>./fifo.<span class=nv>$$</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nb>exec</span><span class=w> </span><span class=m>777</span>&lt;&gt;<span class=w> </span>./fifo.<span class=nv>$$</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>rm<span class=w> </span>-f<span class=w> </span>./fifo.<span class=nv>$$</span><span class=w> </span><span class=c1>#通过文件描述符777访问fifo文件</span>
<a id=__codelineno-47-11 name=__codelineno-47-11 href=#__codelineno-47-11></a>
<a id=__codelineno-47-12 name=__codelineno-47-12 href=#__codelineno-47-12></a><span class=k>for</span><span class=w> </span><span class=o>((</span><span class=nv>i</span><span class=o>=</span><span class=m>0</span><span class=p>;</span><span class=w> </span>i&lt;<span class=nv>$Nproc</span><span class=p>;</span><span class=w> </span>i++<span class=o>))</span><span class=p>;</span><span class=w> </span><span class=k>do</span><span class=w> </span><span class=c1>#向fifo文件先填充等于Nproc值的行数</span>
<a id=__codelineno-47-13 name=__codelineno-47-13 href=#__codelineno-47-13></a>
<a id=__codelineno-47-14 name=__codelineno-47-14 href=#__codelineno-47-14></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;init time add </span><span class=nv>$i</span><span class=s2>&quot;</span><span class=w> </span>&gt;<span class=p>&amp;</span><span class=m>777</span>
<a id=__codelineno-47-15 name=__codelineno-47-15 href=#__codelineno-47-15></a>
<a id=__codelineno-47-16 name=__codelineno-47-16 href=#__codelineno-47-16></a><span class=k>done</span>
<a id=__codelineno-47-17 name=__codelineno-47-17 href=#__codelineno-47-17></a>
<a id=__codelineno-47-18 name=__codelineno-47-18 href=#__codelineno-47-18></a><span class=k>for</span><span class=w> </span><span class=o>((</span><span class=nv>i</span><span class=o>=</span><span class=m>0</span><span class=p>;</span><span class=w> </span>i&lt;<span class=nv>$Njob</span><span class=p>;</span><span class=w> </span>i++<span class=o>))</span><span class=p>;</span><span class=w> </span><span class=k>do</span>
<a id=__codelineno-47-19 name=__codelineno-47-19 href=#__codelineno-47-19></a>
<a id=__codelineno-47-20 name=__codelineno-47-20 href=#__codelineno-47-20></a><span class=w>        </span><span class=o>{</span>
<a id=__codelineno-47-21 name=__codelineno-47-21 href=#__codelineno-47-21></a>
<a id=__codelineno-47-22 name=__codelineno-47-22 href=#__codelineno-47-22></a><span class=w>        </span><span class=nb>read</span><span class=w> </span>-u<span class=w> </span><span class=m>777</span><span class=w> </span><span class=c1>#从fifo文件读一行</span>
<a id=__codelineno-47-23 name=__codelineno-47-23 href=#__codelineno-47-23></a>
<a id=__codelineno-47-24 name=__codelineno-47-24 href=#__codelineno-47-24></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;progress </span><span class=nv>$i</span><span class=s2> is sleeping for 3 seconds zzz…&quot;</span>
<a id=__codelineno-47-25 name=__codelineno-47-25 href=#__codelineno-47-25></a>
<a id=__codelineno-47-26 name=__codelineno-47-26 href=#__codelineno-47-26></a><span class=w>        </span>sleep<span class=w> </span><span class=m>3</span>
<a id=__codelineno-47-27 name=__codelineno-47-27 href=#__codelineno-47-27></a>
<a id=__codelineno-47-28 name=__codelineno-47-28 href=#__codelineno-47-28></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;real time add </span><span class=k>$((</span><span class=nv>$i</span><span class=o>+</span><span class=nv>$Nproc</span><span class=k>))</span><span class=s2>&quot;</span><span class=w> </span>&gt;<span class=p>&amp;</span><span class=m>777</span><span class=w> </span><span class=c1>#sleep完成后，向fifo文件重新写入一行</span>
<a id=__codelineno-47-29 name=__codelineno-47-29 href=#__codelineno-47-29></a>
<a id=__codelineno-47-30 name=__codelineno-47-30 href=#__codelineno-47-30></a><span class=w>        </span><span class=o>}</span><span class=w> </span><span class=p>&amp;</span>
<a id=__codelineno-47-31 name=__codelineno-47-31 href=#__codelineno-47-31></a>
<a id=__codelineno-47-32 name=__codelineno-47-32 href=#__codelineno-47-32></a><span class=k>done</span>
<a id=__codelineno-47-33 name=__codelineno-47-33 href=#__codelineno-47-33></a>
<a id=__codelineno-47-34 name=__codelineno-47-34 href=#__codelineno-47-34></a><span class=nb>wait</span>
<a id=__codelineno-47-35 name=__codelineno-47-35 href=#__codelineno-47-35></a>
<a id=__codelineno-47-36 name=__codelineno-47-36 href=#__codelineno-47-36></a><span class=nb>exec</span><span class=w> </span><span class=m>777</span><span class=w> </span>&gt;<span class=p>&amp;</span>-
<a id=__codelineno-47-37 name=__codelineno-47-37 href=#__codelineno-47-37></a><span class=nb>exec</span><span class=w> </span><span class=m>777</span><span class=w> </span>&lt;<span class=p>&amp;</span>-
<a id=__codelineno-47-38 name=__codelineno-47-38 href=#__codelineno-47-38></a><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;time-consuming: </span><span class=nv>$SECONDS</span><span class=s2> seconds&quot;</span>
</code></pre></div> <h4 id=示例5>示例5<a class=headerlink href=#示例5 title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><a id=__codelineno-48-1 name=__codelineno-48-1 href=#__codelineno-48-1></a><span class=ch>#!/usr/bin/env bash</span>
<a id=__codelineno-48-2 name=__codelineno-48-2 href=#__codelineno-48-2></a><span class=c1>#usage:xxx</span>
<a id=__codelineno-48-3 name=__codelineno-48-3 href=#__codelineno-48-3></a><span class=c1>#scripts_name:${NAME}.sh</span>
<a id=__codelineno-48-4 name=__codelineno-48-4 href=#__codelineno-48-4></a><span class=c1># author：xiaojian</span>
<a id=__codelineno-48-5 name=__codelineno-48-5 href=#__codelineno-48-5></a>
<a id=__codelineno-48-6 name=__codelineno-48-6 href=#__codelineno-48-6></a><span class=nv>CE_HOME</span><span class=o>=</span><span class=s2>&quot;/data/ContentEnginne&quot;</span>
<a id=__codelineno-48-7 name=__codelineno-48-7 href=#__codelineno-48-7></a><span class=nv>LOG_PATH</span><span class=o>=</span><span class=s2>&quot;/data/logs&quot;</span>
<a id=__codelineno-48-8 name=__codelineno-48-8 href=#__codelineno-48-8></a>
<a id=__codelineno-48-9 name=__codelineno-48-9 href=#__codelineno-48-9></a><span class=c1># 控制爬虫数量为8</span>
<a id=__codelineno-48-10 name=__codelineno-48-10 href=#__codelineno-48-10></a><span class=nv>MAX_SPIDER_COUNT</span><span class=o>=</span><span class=m>8</span>
<a id=__codelineno-48-11 name=__codelineno-48-11 href=#__codelineno-48-11></a>
<a id=__codelineno-48-12 name=__codelineno-48-12 href=#__codelineno-48-12></a><span class=nv>count</span><span class=o>=</span><span class=sb>`</span>ps<span class=w> </span>-ef<span class=p>|</span>grep<span class=w> </span>-v<span class=w> </span>grep<span class=p>|</span>grep<span class=w> </span>run.py<span class=p>|</span>wc<span class=w> </span>-l<span class=sb>`</span>
<a id=__codelineno-48-13 name=__codelineno-48-13 href=#__codelineno-48-13></a><span class=nv>try_time</span><span class=o>=</span><span class=m>0</span>
<a id=__codelineno-48-14 name=__codelineno-48-14 href=#__codelineno-48-14></a><span class=nb>cd</span><span class=w> </span><span class=nv>$CE_HOME</span>
<a id=__codelineno-48-15 name=__codelineno-48-15 href=#__codelineno-48-15></a><span class=k>while</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=nv>$count</span><span class=w> </span>-lt<span class=w> </span><span class=nv>$MAX_SPIDER_COUNT</span><span class=w> </span>-a<span class=w> </span><span class=nv>$try_time</span><span class=w> </span>-lt<span class=w> </span><span class=nv>$MAX_SPIDER_COUNT</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>do</span>
<a id=__codelineno-48-16 name=__codelineno-48-16 href=#__codelineno-48-16></a><span class=w>    </span><span class=nb>let</span><span class=w> </span><span class=nv>try_time</span><span class=w> </span><span class=o>+=</span><span class=m>1</span>
<a id=__codelineno-48-17 name=__codelineno-48-17 href=#__codelineno-48-17></a><span class=w>    </span>python<span class=w> </span>run.py<span class=w> </span>&gt;&gt;<span class=w> </span><span class=si>${</span><span class=nv>LOG_PATH</span><span class=si>}</span>/spider.log<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span><span class=w> </span><span class=p>&amp;</span>
<a id=__codelineno-48-18 name=__codelineno-48-18 href=#__codelineno-48-18></a><span class=w>    </span><span class=nv>count</span><span class=o>=</span><span class=sb>`</span>ps<span class=w> </span>-ef<span class=p>|</span>grep<span class=w> </span>-v<span class=w> </span>grep<span class=p>|</span>grep<span class=w> </span>run.py<span class=p>|</span>wc<span class=w> </span>-l<span class=sb>`</span>
<a id=__codelineno-48-19 name=__codelineno-48-19 href=#__codelineno-48-19></a><span class=k>done</span>
</code></pre></div> <h4 id=示例6>示例6<a class=headerlink href=#示例6 title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><a id=__codelineno-49-1 name=__codelineno-49-1 href=#__codelineno-49-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-49-2 name=__codelineno-49-2 href=#__codelineno-49-2></a><span class=c1>#Version:3.0</span>
<a id=__codelineno-49-3 name=__codelineno-49-3 href=#__codelineno-49-3></a><span class=c1>#功能描述(Description):控制进程数量的ping测试脚本.</span>
<a id=__codelineno-49-4 name=__codelineno-49-4 href=#__codelineno-49-4></a><span class=c1>#使用wait命令等待所有子进程结束后再退出脚本.</span>
<a id=__codelineno-49-5 name=__codelineno-49-5 href=#__codelineno-49-5></a>
<a id=__codelineno-49-6 name=__codelineno-49-6 href=#__codelineno-49-6></a><span class=nv>num</span><span class=o>=</span><span class=m>10</span><span class=w>             </span><span class=c1>#控制进程数量.</span>
<a id=__codelineno-49-7 name=__codelineno-49-7 href=#__codelineno-49-7></a><span class=nv>net</span><span class=o>=</span><span class=s2>&quot;192.168.4&quot;</span>
<a id=__codelineno-49-8 name=__codelineno-49-8 href=#__codelineno-49-8></a><span class=nv>pipefile</span><span class=o>=</span><span class=s2>&quot;/tmp/multiping_</span><span class=nv>$$</span><span class=s2>.tmp&quot;</span>
<a id=__codelineno-49-9 name=__codelineno-49-9 href=#__codelineno-49-9></a>
<a id=__codelineno-49-10 name=__codelineno-49-10 href=#__codelineno-49-10></a>multi_ping<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-49-11 name=__codelineno-49-11 href=#__codelineno-49-11></a><span class=w>    </span>ping<span class=w> </span>-c2<span class=w> </span>-i0.2<span class=w> </span>-W1<span class=w> </span><span class=nv>$1</span><span class=w> </span><span class=p>&amp;</span>&gt;/dev/null<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2> is up.&quot;</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2> is down.&quot;</span>
<a id=__codelineno-49-12 name=__codelineno-49-12 href=#__codelineno-49-12></a><span class=o>}</span>
<a id=__codelineno-49-13 name=__codelineno-49-13 href=#__codelineno-49-13></a>
<a id=__codelineno-49-14 name=__codelineno-49-14 href=#__codelineno-49-14></a><span class=c1>#创建命名管道文件,创建其文件描述符,通过重定向导入数据到管道文件中.</span>
<a id=__codelineno-49-15 name=__codelineno-49-15 href=#__codelineno-49-15></a>mkfifo<span class=w> </span><span class=nv>$pipefile</span>
<a id=__codelineno-49-16 name=__codelineno-49-16 href=#__codelineno-49-16></a><span class=nb>exec</span><span class=w> </span><span class=m>12</span>&lt;&gt;<span class=nv>$pipefile</span>
<a id=__codelineno-49-17 name=__codelineno-49-17 href=#__codelineno-49-17></a><span class=k>for</span><span class=w> </span>i<span class=w> </span><span class=k>in</span><span class=w> </span><span class=k>$(</span>seq<span class=w> </span><span class=nv>$num</span><span class=k>)</span>
<a id=__codelineno-49-18 name=__codelineno-49-18 href=#__codelineno-49-18></a><span class=k>do</span>
<a id=__codelineno-49-19 name=__codelineno-49-19 href=#__codelineno-49-19></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;&quot;</span><span class=w> </span>&gt;<span class=p>&amp;</span><span class=m>12</span><span class=w> </span><span class=p>&amp;</span>
<a id=__codelineno-49-20 name=__codelineno-49-20 href=#__codelineno-49-20></a><span class=k>done</span>
<a id=__codelineno-49-21 name=__codelineno-49-21 href=#__codelineno-49-21></a>
<a id=__codelineno-49-22 name=__codelineno-49-22 href=#__codelineno-49-22></a><span class=c1>#通过循环反复调用函数并将其放入后台并行执行.</span>
<a id=__codelineno-49-23 name=__codelineno-49-23 href=#__codelineno-49-23></a><span class=c1>#成功读取命名管道中的数据后开启新的进程.</span>
<a id=__codelineno-49-24 name=__codelineno-49-24 href=#__codelineno-49-24></a><span class=c1>#所有内容读取完后read被阻塞,无法再启动新进程.</span>
<a id=__codelineno-49-25 name=__codelineno-49-25 href=#__codelineno-49-25></a><span class=c1>#等待前面启动的进程结束后,继续往管道文件中写入数据,释放阻塞,再次开启新的进程.</span>
<a id=__codelineno-49-26 name=__codelineno-49-26 href=#__codelineno-49-26></a><span class=k>for</span><span class=w> </span>j<span class=w> </span><span class=k>in</span><span class=w> </span><span class=o>{</span><span class=m>1</span>..254<span class=o>}</span>
<a id=__codelineno-49-27 name=__codelineno-49-27 href=#__codelineno-49-27></a><span class=k>do</span>
<a id=__codelineno-49-28 name=__codelineno-49-28 href=#__codelineno-49-28></a><span class=w>    </span><span class=nb>read</span><span class=w> </span>-u12
<a id=__codelineno-49-29 name=__codelineno-49-29 href=#__codelineno-49-29></a><span class=w>    </span><span class=o>{</span>
<a id=__codelineno-49-30 name=__codelineno-49-30 href=#__codelineno-49-30></a><span class=w>        </span>multi_ping<span class=w> </span><span class=nv>$net</span>.<span class=nv>$j</span>
<a id=__codelineno-49-31 name=__codelineno-49-31 href=#__codelineno-49-31></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;&quot;</span><span class=w> </span>&gt;<span class=p>&amp;</span><span class=m>12</span>
<a id=__codelineno-49-32 name=__codelineno-49-32 href=#__codelineno-49-32></a><span class=w>    </span><span class=o>}</span><span class=w> </span><span class=p>&amp;</span>
<a id=__codelineno-49-33 name=__codelineno-49-33 href=#__codelineno-49-33></a><span class=k>done</span>
<a id=__codelineno-49-34 name=__codelineno-49-34 href=#__codelineno-49-34></a><span class=nb>wait</span>
<a id=__codelineno-49-35 name=__codelineno-49-35 href=#__codelineno-49-35></a>rm<span class=w> </span>-rf<span class=w> </span><span class=nv>$pipfile</span>
</code></pre></div> <h2 id=28一些常用的函数>28.一些常用的函数<a class=headerlink href=#28一些常用的函数 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-50-1 name=__codelineno-50-1 href=#__codelineno-50-1></a><span class=c1>#判断是否是false</span>
<a id=__codelineno-50-2 name=__codelineno-50-2 href=#__codelineno-50-2></a>is_false<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-50-3 name=__codelineno-50-3 href=#__codelineno-50-3></a><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=k>in</span>
<a id=__codelineno-50-4 name=__codelineno-50-4 href=#__codelineno-50-4></a><span class=w>    </span><span class=o>[</span>fF<span class=o>]</span><span class=w> </span><span class=p>|</span><span class=w> </span><span class=o>[</span>nN<span class=o>]</span><span class=w> </span><span class=p>|</span><span class=w> </span><span class=o>[</span>nN<span class=o>][</span>oO<span class=o>]</span><span class=w> </span><span class=p>|</span><span class=w> </span><span class=o>[</span>fF<span class=o>][</span>aA<span class=o>][</span>lL<span class=o>][</span>sS<span class=o>][</span>eE<span class=o>]</span><span class=w> </span><span class=p>|</span><span class=w> </span><span class=m>0</span><span class=o>)</span>
<a id=__codelineno-50-5 name=__codelineno-50-5 href=#__codelineno-50-5></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-50-6 name=__codelineno-50-6 href=#__codelineno-50-6></a><span class=w>        </span><span class=p>;;</span>
<a id=__codelineno-50-7 name=__codelineno-50-7 href=#__codelineno-50-7></a><span class=w>    </span><span class=k>esac</span>
<a id=__codelineno-50-8 name=__codelineno-50-8 href=#__codelineno-50-8></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-50-9 name=__codelineno-50-9 href=#__codelineno-50-9></a><span class=o>}</span>
<a id=__codelineno-50-10 name=__codelineno-50-10 href=#__codelineno-50-10></a>
<a id=__codelineno-50-11 name=__codelineno-50-11 href=#__codelineno-50-11></a><span class=c1>#判断进程是否运行</span>
<a id=__codelineno-50-12 name=__codelineno-50-12 href=#__codelineno-50-12></a>is_running<span class=o>()</span>
<a id=__codelineno-50-13 name=__codelineno-50-13 href=#__codelineno-50-13></a><span class=o>{</span>
<a id=__codelineno-50-14 name=__codelineno-50-14 href=#__codelineno-50-14></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-f<span class=w> </span><span class=nv>$1</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-50-15 name=__codelineno-50-15 href=#__codelineno-50-15></a><span class=w>        </span><span class=nb>read</span><span class=w> </span>pid<span class=w> </span>&lt;<span class=w> </span><span class=nv>$1</span>
<a id=__codelineno-50-16 name=__codelineno-50-16 href=#__codelineno-50-16></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-d<span class=w> </span><span class=s2>&quot;/proc/</span><span class=nv>$pid</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-50-17 name=__codelineno-50-17 href=#__codelineno-50-17></a><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-50-18 name=__codelineno-50-18 href=#__codelineno-50-18></a><span class=w>        </span><span class=k>fi</span>
<a id=__codelineno-50-19 name=__codelineno-50-19 href=#__codelineno-50-19></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-50-20 name=__codelineno-50-20 href=#__codelineno-50-20></a><span class=w>    </span><span class=k>return</span><span class=w> </span>-1
<a id=__codelineno-50-21 name=__codelineno-50-21 href=#__codelineno-50-21></a><span class=o>}</span>
<a id=__codelineno-50-22 name=__codelineno-50-22 href=#__codelineno-50-22></a>
<a id=__codelineno-50-23 name=__codelineno-50-23 href=#__codelineno-50-23></a><span class=c1>#安装epel源</span>
<a id=__codelineno-50-24 name=__codelineno-50-24 href=#__codelineno-50-24></a><span class=k>function</span><span class=w> </span>_install_epel<span class=w> </span><span class=o>{</span>
<a id=__codelineno-50-25 name=__codelineno-50-25 href=#__codelineno-50-25></a><span class=w>    </span><span class=c1># NOTE: We always remove and install latest -- some environments</span>
<a id=__codelineno-50-26 name=__codelineno-50-26 href=#__codelineno-50-26></a><span class=w>    </span><span class=c1># use snapshot images, and if EPEL version updates they break</span>
<a id=__codelineno-50-27 name=__codelineno-50-27 href=#__codelineno-50-27></a><span class=w>    </span><span class=c1># unless we update them to latest version.</span>
<a id=__codelineno-50-28 name=__codelineno-50-28 href=#__codelineno-50-28></a><span class=w>    </span><span class=k>if</span><span class=w> </span>sudo<span class=w> </span>yum<span class=w> </span>repolist<span class=w> </span>enabled<span class=w> </span>epel<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>-q<span class=w> </span><span class=s1>&#39;epel&#39;</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-50-29 name=__codelineno-50-29 href=#__codelineno-50-29></a><span class=w>        </span>uninstall_package<span class=w> </span>epel-release<span class=w> </span><span class=o>||</span><span class=w> </span><span class=nb>true</span>
<a id=__codelineno-50-30 name=__codelineno-50-30 href=#__codelineno-50-30></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-50-31 name=__codelineno-50-31 href=#__codelineno-50-31></a>
<a id=__codelineno-50-32 name=__codelineno-50-32 href=#__codelineno-50-32></a><span class=w>    </span><span class=c1># This trick installs the latest epel-release from a bootstrap</span>
<a id=__codelineno-50-33 name=__codelineno-50-33 href=#__codelineno-50-33></a><span class=w>    </span><span class=c1># repo, then removes itself (as epel-release installed the</span>
<a id=__codelineno-50-34 name=__codelineno-50-34 href=#__codelineno-50-34></a><span class=w>    </span><span class=c1># &quot;real&quot; repo).</span>
<a id=__codelineno-50-35 name=__codelineno-50-35 href=#__codelineno-50-35></a><span class=w>    </span><span class=c1>#</span>
<a id=__codelineno-50-36 name=__codelineno-50-36 href=#__codelineno-50-36></a><span class=w>    </span><span class=c1># You would think that rather than this, you could use</span>
<a id=__codelineno-50-37 name=__codelineno-50-37 href=#__codelineno-50-37></a><span class=w>    </span><span class=c1># $releasever directly in .repo file we create below.  However</span>
<a id=__codelineno-50-38 name=__codelineno-50-38 href=#__codelineno-50-38></a><span class=w>    </span><span class=c1># RHEL gives a $releasever of &quot;6Server&quot; which breaks the path;</span>
<a id=__codelineno-50-39 name=__codelineno-50-39 href=#__codelineno-50-39></a><span class=w>    </span><span class=c1># see https://bugzilla.redhat.com/show_bug.cgi?id=1150759</span>
<a id=__codelineno-50-40 name=__codelineno-50-40 href=#__codelineno-50-40></a><span class=w>    </span>cat<span class=w> </span><span class=s>&lt;&lt;EOF | sudo tee /etc/yum.repos.d/epel-bootstrap.repo</span>
<a id=__codelineno-50-41 name=__codelineno-50-41 href=#__codelineno-50-41></a><span class=s>[epel-bootstrap]</span>
<a id=__codelineno-50-42 name=__codelineno-50-42 href=#__codelineno-50-42></a><span class=s>name=Bootstrap EPEL</span>
<a id=__codelineno-50-43 name=__codelineno-50-43 href=#__codelineno-50-43></a><span class=s>mirrorlist=http://mirrors.fedoraproject.org/mirrorlist?repo=epel-7&amp;arch=\$basearch</span>
<a id=__codelineno-50-44 name=__codelineno-50-44 href=#__codelineno-50-44></a><span class=s>failovermethod=priority</span>
<a id=__codelineno-50-45 name=__codelineno-50-45 href=#__codelineno-50-45></a><span class=s>enabled=0</span>
<a id=__codelineno-50-46 name=__codelineno-50-46 href=#__codelineno-50-46></a><span class=s>gpgcheck=0</span>
<a id=__codelineno-50-47 name=__codelineno-50-47 href=#__codelineno-50-47></a><span class=s>EOF</span>
<a id=__codelineno-50-48 name=__codelineno-50-48 href=#__codelineno-50-48></a><span class=w>    </span><span class=c1># Enable a bootstrap repo.  It is removed after finishing</span>
<a id=__codelineno-50-49 name=__codelineno-50-49 href=#__codelineno-50-49></a><span class=w>    </span><span class=c1># the epel-release installation.</span>
<a id=__codelineno-50-50 name=__codelineno-50-50 href=#__codelineno-50-50></a><span class=w>    </span>is_package_installed<span class=w> </span>yum-utils<span class=w> </span><span class=o>||</span><span class=w> </span>install_package<span class=w> </span>yum-utils
<a id=__codelineno-50-51 name=__codelineno-50-51 href=#__codelineno-50-51></a><span class=w>    </span>sudo<span class=w> </span>yum-config-manager<span class=w> </span>--enable<span class=w> </span>epel-bootstrap
<a id=__codelineno-50-52 name=__codelineno-50-52 href=#__codelineno-50-52></a><span class=w>    </span>yum_install<span class=w> </span>epel-release<span class=w> </span><span class=o>||</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-50-53 name=__codelineno-50-53 href=#__codelineno-50-53></a><span class=w>        </span>die<span class=w> </span><span class=nv>$LINENO</span><span class=w> </span><span class=s2>&quot;Error installing EPEL repo, cannot continue&quot;</span>
<a id=__codelineno-50-54 name=__codelineno-50-54 href=#__codelineno-50-54></a><span class=w>    </span>sudo<span class=w> </span>rm<span class=w> </span>-f<span class=w> </span>/etc/yum.repos.d/epel-bootstrap.repo
<a id=__codelineno-50-55 name=__codelineno-50-55 href=#__codelineno-50-55></a><span class=o>}</span>
<a id=__codelineno-50-56 name=__codelineno-50-56 href=#__codelineno-50-56></a>
<a id=__codelineno-50-57 name=__codelineno-50-57 href=#__codelineno-50-57></a><span class=c1>#记录日志的function</span>
<a id=__codelineno-50-58 name=__codelineno-50-58 href=#__codelineno-50-58></a><span class=k>function</span><span class=w> </span>fnLogInfo<span class=o>()</span>
<a id=__codelineno-50-59 name=__codelineno-50-59 href=#__codelineno-50-59></a><span class=o>{</span>
<a id=__codelineno-50-60 name=__codelineno-50-60 href=#__codelineno-50-60></a><span class=w>        </span><span class=nb>local</span><span class=w> </span><span class=nv>infomsg</span><span class=o>=</span><span class=nv>$1</span>
<a id=__codelineno-50-61 name=__codelineno-50-61 href=#__codelineno-50-61></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=si>${</span><span class=nv>infomsg</span><span class=si>}</span>
<a id=__codelineno-50-62 name=__codelineno-50-62 href=#__codelineno-50-62></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=sb>`</span>date<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>data_format</span><span class=si>}</span><span class=s2>&quot;</span><span class=sb>`</span><span class=w> </span><span class=s2>&quot;Info:</span><span class=si>${</span><span class=nv>infomsg</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span><span class=si>${</span><span class=nv>log_file</span><span class=si>}</span>
<a id=__codelineno-50-63 name=__codelineno-50-63 href=#__codelineno-50-63></a><span class=o>}</span>
<a id=__codelineno-50-64 name=__codelineno-50-64 href=#__codelineno-50-64></a>
<a id=__codelineno-50-65 name=__codelineno-50-65 href=#__codelineno-50-65></a>
<a id=__codelineno-50-66 name=__codelineno-50-66 href=#__codelineno-50-66></a><span class=c1>#备份文件的function</span>
<a id=__codelineno-50-67 name=__codelineno-50-67 href=#__codelineno-50-67></a>fnBackupBeforeModify<span class=o>()</span>
<a id=__codelineno-50-68 name=__codelineno-50-68 href=#__codelineno-50-68></a><span class=o>{</span>
<a id=__codelineno-50-69 name=__codelineno-50-69 href=#__codelineno-50-69></a><span class=w>        </span><span class=nb>local</span><span class=w> </span><span class=nv>file</span><span class=o>=</span><span class=nv>$1</span>
<a id=__codelineno-50-70 name=__codelineno-50-70 href=#__codelineno-50-70></a><span class=w>        </span><span class=nb>local</span><span class=w> </span><span class=nv>backupFile</span><span class=o>=</span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>file</span><span class=si>}</span><span class=s2>.bak&quot;</span>
<a id=__codelineno-50-71 name=__codelineno-50-71 href=#__codelineno-50-71></a>
<a id=__codelineno-50-72 name=__codelineno-50-72 href=#__codelineno-50-72></a><span class=w>        </span>fnLogInfo<span class=w> </span><span class=s2>&quot;Start to backup file </span><span class=nv>$file</span><span class=s2>&quot;</span>
<a id=__codelineno-50-73 name=__codelineno-50-73 href=#__codelineno-50-73></a>
<a id=__codelineno-50-74 name=__codelineno-50-74 href=#__codelineno-50-74></a><span class=w>        </span>cp<span class=w> </span><span class=si>${</span><span class=nv>file</span><span class=si>}</span><span class=w> </span>-p<span class=w> </span><span class=si>${</span><span class=nv>backupFile</span><span class=si>}</span>
<a id=__codelineno-50-75 name=__codelineno-50-75 href=#__codelineno-50-75></a>
<a id=__codelineno-50-76 name=__codelineno-50-76 href=#__codelineno-50-76></a><span class=w>        </span>fnLogInfo<span class=w> </span><span class=s2>&quot;End to backup file </span><span class=nv>$file</span><span class=s2>&quot;</span>
<a id=__codelineno-50-77 name=__codelineno-50-77 href=#__codelineno-50-77></a><span class=o>}</span>
<a id=__codelineno-50-78 name=__codelineno-50-78 href=#__codelineno-50-78></a>
<a id=__codelineno-50-79 name=__codelineno-50-79 href=#__codelineno-50-79></a><span class=c1># 1. change the network config as DHCP</span>
<a id=__codelineno-50-80 name=__codelineno-50-80 href=#__codelineno-50-80></a><span class=c1># 2. delete the 70-persistent-net.rules file</span>
<a id=__codelineno-50-81 name=__codelineno-50-81 href=#__codelineno-50-81></a>fnModifyNetworkConfig<span class=o>()</span>
<a id=__codelineno-50-82 name=__codelineno-50-82 href=#__codelineno-50-82></a><span class=o>{</span>
<a id=__codelineno-50-83 name=__codelineno-50-83 href=#__codelineno-50-83></a><span class=w>        </span>fnLogInfo<span class=w> </span><span class=s2>&quot;----------------------------------------&quot;</span>
<a id=__codelineno-50-84 name=__codelineno-50-84 href=#__codelineno-50-84></a><span class=w>        </span>fnLogInfo<span class=w> </span><span class=s2>&quot;Start to modify the network configuration&quot;</span>
<a id=__codelineno-50-85 name=__codelineno-50-85 href=#__codelineno-50-85></a>
<a id=__codelineno-50-86 name=__codelineno-50-86 href=#__codelineno-50-86></a><span class=w>        </span><span class=nb>local</span><span class=w> </span><span class=nv>files</span><span class=o>=</span><span class=s1>&#39;&#39;</span>
<a id=__codelineno-50-87 name=__codelineno-50-87 href=#__codelineno-50-87></a>
<a id=__codelineno-50-88 name=__codelineno-50-88 href=#__codelineno-50-88></a><span class=w>        </span><span class=c1>#1. change the network config as DHCP</span>
<a id=__codelineno-50-89 name=__codelineno-50-89 href=#__codelineno-50-89></a><span class=w>        </span><span class=k>case</span><span class=w> </span><span class=nv>$os_type</span><span class=w> </span><span class=k>in</span>
<a id=__codelineno-50-90 name=__codelineno-50-90 href=#__codelineno-50-90></a>
<a id=__codelineno-50-91 name=__codelineno-50-91 href=#__codelineno-50-91></a><span class=w>        </span><span class=c1>#/etc/sysconfig/network-scripts</span>
<a id=__codelineno-50-92 name=__codelineno-50-92 href=#__codelineno-50-92></a><span class=w>        </span><span class=s2>&quot;redhat&quot;</span><span class=o>)</span>
<a id=__codelineno-50-93 name=__codelineno-50-93 href=#__codelineno-50-93></a><span class=w>        </span><span class=nv>files</span><span class=o>=</span><span class=s2>&quot;`ls /etc/sysconfig/network-scripts/ifcfg-eth* |grep -v .bak`&quot;</span>
<a id=__codelineno-50-94 name=__codelineno-50-94 href=#__codelineno-50-94></a><span class=w>        </span><span class=nv>files</span><span class=o>=</span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>files</span><span class=si>}</span><span class=s2> `ls /etc/sysconfig/network-scripts/ifcfg-ens* |grep -v .bak`&quot;</span>
<a id=__codelineno-50-95 name=__codelineno-50-95 href=#__codelineno-50-95></a><span class=w>        </span><span class=k>for</span><span class=w> </span>file<span class=w> </span><span class=k>in</span><span class=w> </span><span class=nv>$files</span>
<a id=__codelineno-50-96 name=__codelineno-50-96 href=#__codelineno-50-96></a><span class=w>        </span><span class=k>do</span>
<a id=__codelineno-50-97 name=__codelineno-50-97 href=#__codelineno-50-97></a><span class=w>            </span>fnLogInfo<span class=w> </span><span class=s2>&quot;Start to modify the network configuration: </span><span class=nv>$file</span><span class=s2>&quot;</span>
<a id=__codelineno-50-98 name=__codelineno-50-98 href=#__codelineno-50-98></a><span class=w>            </span><span class=c1>#backup  the file</span>
<a id=__codelineno-50-99 name=__codelineno-50-99 href=#__codelineno-50-99></a><span class=w>            </span>fnBackupBeforeModify<span class=w> </span><span class=nv>$file</span>
<a id=__codelineno-50-100 name=__codelineno-50-100 href=#__codelineno-50-100></a><span class=w>            </span><span class=c1>#modify the file</span>
<a id=__codelineno-50-101 name=__codelineno-50-101 href=#__codelineno-50-101></a><span class=w>            </span>sed<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;/PERSISTENT_DHCLIENT/d&#39;</span><span class=w> </span><span class=nv>$file</span>
<a id=__codelineno-50-102 name=__codelineno-50-102 href=#__codelineno-50-102></a><span class=w>            </span>sed<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;$a\PERSISTENT_DHCLIENT=yes&#39;</span><span class=w> </span><span class=nv>$file</span>
<a id=__codelineno-50-103 name=__codelineno-50-103 href=#__codelineno-50-103></a><span class=w>            </span>fnLogInfo<span class=w> </span><span class=s2>&quot;End to modify the network configuration: </span><span class=nv>$file</span><span class=s2>&quot;</span>
<a id=__codelineno-50-104 name=__codelineno-50-104 href=#__codelineno-50-104></a><span class=w>        </span><span class=k>done</span>
<a id=__codelineno-50-105 name=__codelineno-50-105 href=#__codelineno-50-105></a><span class=w>        </span><span class=p>;;</span>
<a id=__codelineno-50-106 name=__codelineno-50-106 href=#__codelineno-50-106></a>
<a id=__codelineno-50-107 name=__codelineno-50-107 href=#__codelineno-50-107></a><span class=w>        </span><span class=c1>#/etc/sysconfig/network/dhcp</span>
<a id=__codelineno-50-108 name=__codelineno-50-108 href=#__codelineno-50-108></a><span class=w>        </span><span class=s2>&quot;suse&quot;</span><span class=o>)</span>
<a id=__codelineno-50-109 name=__codelineno-50-109 href=#__codelineno-50-109></a><span class=w>        </span><span class=nv>file</span><span class=o>=</span><span class=s1>&#39;/etc/sysconfig/network/dhcp&#39;</span>
<a id=__codelineno-50-110 name=__codelineno-50-110 href=#__codelineno-50-110></a>
<a id=__codelineno-50-111 name=__codelineno-50-111 href=#__codelineno-50-111></a><span class=w>        </span><span class=c1>#first backup file</span>
<a id=__codelineno-50-112 name=__codelineno-50-112 href=#__codelineno-50-112></a><span class=w>        </span>fnBackupBeforeModify<span class=w> </span><span class=nv>$file</span>
<a id=__codelineno-50-113 name=__codelineno-50-113 href=#__codelineno-50-113></a>
<a id=__codelineno-50-114 name=__codelineno-50-114 href=#__codelineno-50-114></a><span class=w>        </span>sed<span class=w> </span>-i<span class=w> </span><span class=s2>&quot;s/DHCLIENT_USE_LAST_LEASE=yes\|DHCLIENT_USE_LAST_LEASE=&#39;yes&#39;\|DHCLIENT_USE_LAST_LEASE=\&quot;yes\&quot;/DHCLIENT_USE_LAST_LEASE=\&quot;no\&quot;/g&quot;</span><span class=w> </span><span class=nv>$file</span>
<a id=__codelineno-50-115 name=__codelineno-50-115 href=#__codelineno-50-115></a><span class=w>        </span><span class=p>;;</span>
<a id=__codelineno-50-116 name=__codelineno-50-116 href=#__codelineno-50-116></a>
<a id=__codelineno-50-117 name=__codelineno-50-117 href=#__codelineno-50-117></a><span class=w>        </span><span class=c1>#/etc/network/interfaces</span>
<a id=__codelineno-50-118 name=__codelineno-50-118 href=#__codelineno-50-118></a><span class=w>        </span><span class=s2>&quot;debian&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span><span class=s2>&quot;ubuntu&quot;</span><span class=o>)</span>
<a id=__codelineno-50-119 name=__codelineno-50-119 href=#__codelineno-50-119></a><span class=w>        </span><span class=nv>file</span><span class=o>=</span><span class=s1>&#39;/etc/network/interfaces&#39;</span>
<a id=__codelineno-50-120 name=__codelineno-50-120 href=#__codelineno-50-120></a>
<a id=__codelineno-50-121 name=__codelineno-50-121 href=#__codelineno-50-121></a><span class=w>        </span><span class=c1>#backup the file</span>
<a id=__codelineno-50-122 name=__codelineno-50-122 href=#__codelineno-50-122></a><span class=w>        </span>fnBackupBeforeModify<span class=w> </span><span class=nv>$file</span>
<a id=__codelineno-50-123 name=__codelineno-50-123 href=#__codelineno-50-123></a>
<a id=__codelineno-50-124 name=__codelineno-50-124 href=#__codelineno-50-124></a><span class=w>        </span>sed<span class=w> </span>-i<span class=w> </span><span class=s2>&quot;s/static\| manual/ dhcp/g&quot;</span><span class=w> </span><span class=nv>$file</span>
<a id=__codelineno-50-125 name=__codelineno-50-125 href=#__codelineno-50-125></a><span class=w>        </span>sed<span class=w> </span>-i<span class=w> </span><span class=s2>&quot;s/address /#address /g&quot;</span><span class=w> </span><span class=nv>$file</span>
<a id=__codelineno-50-126 name=__codelineno-50-126 href=#__codelineno-50-126></a><span class=w>        </span>sed<span class=w> </span>-i<span class=w> </span><span class=s2>&quot;s/netmask /#netmask /g&quot;</span><span class=w> </span><span class=nv>$file</span>
<a id=__codelineno-50-127 name=__codelineno-50-127 href=#__codelineno-50-127></a><span class=w>        </span>sed<span class=w> </span>-i<span class=w> </span><span class=s2>&quot;s/gateway /#gateway /g&quot;</span><span class=w> </span><span class=nv>$file</span>
<a id=__codelineno-50-128 name=__codelineno-50-128 href=#__codelineno-50-128></a>
<a id=__codelineno-50-129 name=__codelineno-50-129 href=#__codelineno-50-129></a><span class=w>        </span><span class=p>;;</span>
<a id=__codelineno-50-130 name=__codelineno-50-130 href=#__codelineno-50-130></a>
<a id=__codelineno-50-131 name=__codelineno-50-131 href=#__codelineno-50-131></a><span class=w>        </span>*<span class=o>)</span>
<a id=__codelineno-50-132 name=__codelineno-50-132 href=#__codelineno-50-132></a><span class=w>        </span>fnLogInfo<span class=w> </span><span class=s2>&quot;Other Linux, network configuration cannot be modified.&quot;</span>
<a id=__codelineno-50-133 name=__codelineno-50-133 href=#__codelineno-50-133></a><span class=w>        </span><span class=p>;;</span>
<a id=__codelineno-50-134 name=__codelineno-50-134 href=#__codelineno-50-134></a><span class=w>        </span><span class=k>esac</span>
<a id=__codelineno-50-135 name=__codelineno-50-135 href=#__codelineno-50-135></a>
<a id=__codelineno-50-136 name=__codelineno-50-136 href=#__codelineno-50-136></a><span class=w>        </span><span class=c1>#2. delete the 70-persistent-net.rules file</span>
<a id=__codelineno-50-137 name=__codelineno-50-137 href=#__codelineno-50-137></a><span class=w>        </span>rm<span class=w> </span>-rf<span class=w> </span>/etc/udev/rules.d/70-persistent-net.rules
<a id=__codelineno-50-138 name=__codelineno-50-138 href=#__codelineno-50-138></a>
<a id=__codelineno-50-139 name=__codelineno-50-139 href=#__codelineno-50-139></a><span class=w>        </span>fnLogInfo<span class=w> </span><span class=s2>&quot;Delete 70-persistent-net.rules file, resut: </span><span class=nv>$?</span><span class=s2>&quot;</span>
<a id=__codelineno-50-140 name=__codelineno-50-140 href=#__codelineno-50-140></a>
<a id=__codelineno-50-141 name=__codelineno-50-141 href=#__codelineno-50-141></a><span class=w>        </span>fnLogInfo<span class=w> </span><span class=s2>&quot;End to modify the network configuration&quot;</span>
<a id=__codelineno-50-142 name=__codelineno-50-142 href=#__codelineno-50-142></a><span class=o>}</span>
<a id=__codelineno-50-143 name=__codelineno-50-143 href=#__codelineno-50-143></a><span class=c1>#check OS的function</span>
<a id=__codelineno-50-144 name=__codelineno-50-144 href=#__codelineno-50-144></a>fnGetOSType<span class=o>()</span>
<a id=__codelineno-50-145 name=__codelineno-50-145 href=#__codelineno-50-145></a><span class=o>{</span>
<a id=__codelineno-50-146 name=__codelineno-50-146 href=#__codelineno-50-146></a><span class=w>        </span>fnLogInfo<span class=w> </span><span class=s2>&quot;---------------------------&quot;</span>
<a id=__codelineno-50-147 name=__codelineno-50-147 href=#__codelineno-50-147></a><span class=w>        </span>fnLogInfo<span class=w> </span><span class=s2>&quot;Start to get the os type&quot;</span>
<a id=__codelineno-50-148 name=__codelineno-50-148 href=#__codelineno-50-148></a>
<a id=__codelineno-50-149 name=__codelineno-50-149 href=#__codelineno-50-149></a><span class=w>        </span><span class=nb>local</span><span class=w> </span><span class=nv>version</span><span class=o>=</span><span class=s2>&quot;/proc/version&quot;</span>
<a id=__codelineno-50-150 name=__codelineno-50-150 href=#__codelineno-50-150></a><span class=w>        </span><span class=k>if</span><span class=w> </span>!<span class=w> </span><span class=o>[</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>version</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=k>then</span>
<a id=__codelineno-50-151 name=__codelineno-50-151 href=#__codelineno-50-151></a><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-50-152 name=__codelineno-50-152 href=#__codelineno-50-152></a><span class=w>        </span><span class=k>elif</span><span class=w> </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=k>$(</span>grep<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;suse&#39;</span><span class=w> </span><span class=si>${</span><span class=nv>version</span><span class=si>}</span><span class=k>)</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=k>then</span>
<a id=__codelineno-50-153 name=__codelineno-50-153 href=#__codelineno-50-153></a><span class=w>            </span><span class=nv>os_type</span><span class=o>=</span><span class=s1>&#39;suse&#39;</span>
<a id=__codelineno-50-154 name=__codelineno-50-154 href=#__codelineno-50-154></a><span class=w>        </span><span class=k>elif</span><span class=w> </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=k>$(</span>grep<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;ubuntu&#39;</span><span class=w> </span><span class=si>${</span><span class=nv>version</span><span class=si>}</span><span class=k>)</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=k>then</span>
<a id=__codelineno-50-155 name=__codelineno-50-155 href=#__codelineno-50-155></a><span class=w>            </span><span class=nv>os_type</span><span class=o>=</span><span class=s1>&#39;ubuntu&#39;</span>
<a id=__codelineno-50-156 name=__codelineno-50-156 href=#__codelineno-50-156></a><span class=w>        </span><span class=k>elif</span><span class=w> </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=k>$(</span>grep<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;Red Hat&#39;</span><span class=w> </span><span class=si>${</span><span class=nv>version</span><span class=si>}</span><span class=k>)</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=k>then</span>
<a id=__codelineno-50-157 name=__codelineno-50-157 href=#__codelineno-50-157></a><span class=w>            </span><span class=nv>os_type</span><span class=o>=</span><span class=s1>&#39;redhat&#39;</span>
<a id=__codelineno-50-158 name=__codelineno-50-158 href=#__codelineno-50-158></a><span class=w>                </span><span class=k>elif</span><span class=w> </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=k>$(</span>grep<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;debian&#39;</span><span class=w> </span><span class=si>${</span><span class=nv>version</span><span class=si>}</span><span class=k>)</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=k>then</span>
<a id=__codelineno-50-159 name=__codelineno-50-159 href=#__codelineno-50-159></a><span class=w>            </span><span class=nv>os_type</span><span class=o>=</span><span class=s1>&#39;debian&#39;</span>
<a id=__codelineno-50-160 name=__codelineno-50-160 href=#__codelineno-50-160></a><span class=w>        </span><span class=k>fi</span>
<a id=__codelineno-50-161 name=__codelineno-50-161 href=#__codelineno-50-161></a>
<a id=__codelineno-50-162 name=__codelineno-50-162 href=#__codelineno-50-162></a>
<a id=__codelineno-50-163 name=__codelineno-50-163 href=#__codelineno-50-163></a><span class=w>        </span>fnLogInfo<span class=w> </span><span class=s2>&quot;End to get the os type: </span><span class=nv>$os_type</span><span class=s2>&quot;</span>
<a id=__codelineno-50-164 name=__codelineno-50-164 href=#__codelineno-50-164></a><span class=o>}</span>
<a id=__codelineno-50-165 name=__codelineno-50-165 href=#__codelineno-50-165></a>
<a id=__codelineno-50-166 name=__codelineno-50-166 href=#__codelineno-50-166></a><span class=c1>#输入选择Yes和No函数</span>
<a id=__codelineno-50-167 name=__codelineno-50-167 href=#__codelineno-50-167></a>YES_NO_choice<span class=o>(){</span>
<a id=__codelineno-50-168 name=__codelineno-50-168 href=#__codelineno-50-168></a><span class=nb>read</span><span class=w> </span>-t<span class=w> </span><span class=m>10</span><span class=w> </span>-p<span class=w> </span><span class=s2>&quot;Please input you commit ,wait 5.....to exit: &quot;</span><span class=w> </span>input
<a id=__codelineno-50-169 name=__codelineno-50-169 href=#__codelineno-50-169></a>
<a id=__codelineno-50-170 name=__codelineno-50-170 href=#__codelineno-50-170></a><span class=k>case</span><span class=w> </span><span class=nv>$input</span><span class=w> </span><span class=k>in</span>
<a id=__codelineno-50-171 name=__codelineno-50-171 href=#__codelineno-50-171></a><span class=w>    </span><span class=o>[</span>yY<span class=o>]</span><span class=p>|</span><span class=o>[</span>yY<span class=o>][</span>eE<span class=o>][</span>sS<span class=o>]</span><span class=w> </span><span class=o>)</span>
<a id=__codelineno-50-172 name=__codelineno-50-172 href=#__codelineno-50-172></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;YES!!!!!&quot;</span>
<a id=__codelineno-50-173 name=__codelineno-50-173 href=#__codelineno-50-173></a><span class=w>        </span><span class=p>;;</span>
<a id=__codelineno-50-174 name=__codelineno-50-174 href=#__codelineno-50-174></a><span class=w>    </span><span class=o>[</span>nN<span class=o>]</span><span class=p>|</span><span class=o>[</span>nN<span class=o>][</span>oO<span class=o>]</span><span class=w> </span><span class=o>)</span>
<a id=__codelineno-50-175 name=__codelineno-50-175 href=#__codelineno-50-175></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;NO  Error!!!!!&quot;</span>
<a id=__codelineno-50-176 name=__codelineno-50-176 href=#__codelineno-50-176></a><span class=w>        </span><span class=p>;;</span>
<a id=__codelineno-50-177 name=__codelineno-50-177 href=#__codelineno-50-177></a><span class=w>        </span>*<span class=o>)</span>
<a id=__codelineno-50-178 name=__codelineno-50-178 href=#__codelineno-50-178></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;============================&quot;</span>
<a id=__codelineno-50-179 name=__codelineno-50-179 href=#__codelineno-50-179></a><span class=w>        </span><span class=p>;;</span>
<a id=__codelineno-50-180 name=__codelineno-50-180 href=#__codelineno-50-180></a>
<a id=__codelineno-50-181 name=__codelineno-50-181 href=#__codelineno-50-181></a><span class=k>esac</span>
<a id=__codelineno-50-182 name=__codelineno-50-182 href=#__codelineno-50-182></a>
<a id=__codelineno-50-183 name=__codelineno-50-183 href=#__codelineno-50-183></a><span class=c1>#错误提示函数</span>
<a id=__codelineno-50-184 name=__codelineno-50-184 href=#__codelineno-50-184></a>die<span class=w> </span><span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-50-185 name=__codelineno-50-185 href=#__codelineno-50-185></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;ERROR: </span><span class=nv>$1</span><span class=s2>. Aborting!&quot;</span>
<a id=__codelineno-50-186 name=__codelineno-50-186 href=#__codelineno-50-186></a><span class=w>    </span><span class=nb>exit</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-50-187 name=__codelineno-50-187 href=#__codelineno-50-187></a><span class=o>}</span>
<a id=__codelineno-50-188 name=__codelineno-50-188 href=#__codelineno-50-188></a>
<a id=__codelineno-50-189 name=__codelineno-50-189 href=#__codelineno-50-189></a><span class=c1>#判断用户输入如果没有输入，选择默认值 redis为例</span>
<a id=__codelineno-50-190 name=__codelineno-50-190 href=#__codelineno-50-190></a><span class=nv>_REDIS_PORT</span><span class=o>=</span><span class=m>6379</span>
<a id=__codelineno-50-191 name=__codelineno-50-191 href=#__codelineno-50-191></a><span class=nv>_MANUAL_EXECUTION</span><span class=o>=</span><span class=nb>false</span><span class=w>     </span><span class=c1>#标志信息</span>
<a id=__codelineno-50-192 name=__codelineno-50-192 href=#__codelineno-50-192></a>check_input_redis_port<span class=o>(){</span>
<a id=__codelineno-50-193 name=__codelineno-50-193 href=#__codelineno-50-193></a><span class=k>if</span><span class=w> </span>!<span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=nv>$REDIS_PORT</span><span class=w> </span><span class=p>|</span><span class=w> </span>egrep<span class=w> </span>-q<span class=w> </span><span class=s1>&#39;^[0-9]+$&#39;</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-50-194 name=__codelineno-50-194 href=#__codelineno-50-194></a><span class=w>    </span><span class=nv>_MANUAL_EXECUTION</span><span class=o>=</span><span class=nb>true</span><span class=w>      </span><span class=c1>#重置标志信息</span>
<a id=__codelineno-50-195 name=__codelineno-50-195 href=#__codelineno-50-195></a><span class=w>    </span><span class=c1>#Read the redis port</span>
<a id=__codelineno-50-196 name=__codelineno-50-196 href=#__codelineno-50-196></a><span class=w>    </span><span class=nb>read</span><span class=w>  </span>-p<span class=w> </span><span class=s2>&quot;Please select the redis port for this instance: [</span><span class=nv>$_REDIS_PORT</span><span class=s2>] &quot;</span><span class=w> </span>REDIS_PORT
<a id=__codelineno-50-197 name=__codelineno-50-197 href=#__codelineno-50-197></a><span class=w>    </span><span class=k>if</span><span class=w> </span>!<span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=nv>$REDIS_PORT</span><span class=w> </span><span class=p>|</span><span class=w> </span>egrep<span class=w> </span>-q<span class=w> </span><span class=s1>&#39;^[0-9]+$&#39;</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-50-198 name=__codelineno-50-198 href=#__codelineno-50-198></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Selecting default: </span><span class=nv>$_REDIS_PORT</span><span class=s2>&quot;</span>
<a id=__codelineno-50-199 name=__codelineno-50-199 href=#__codelineno-50-199></a><span class=w>        </span><span class=nv>REDIS_PORT</span><span class=o>=</span><span class=nv>$_REDIS_PORT</span>
<a id=__codelineno-50-200 name=__codelineno-50-200 href=#__codelineno-50-200></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-50-201 name=__codelineno-50-201 href=#__codelineno-50-201></a><span class=k>fi</span>
<a id=__codelineno-50-202 name=__codelineno-50-202 href=#__codelineno-50-202></a><span class=o>}</span>
<a id=__codelineno-50-203 name=__codelineno-50-203 href=#__codelineno-50-203></a>
<a id=__codelineno-50-204 name=__codelineno-50-204 href=#__codelineno-50-204></a>
<a id=__codelineno-50-205 name=__codelineno-50-205 href=#__codelineno-50-205></a>Get_OS_Bit<span class=o>()</span>
<a id=__codelineno-50-206 name=__codelineno-50-206 href=#__codelineno-50-206></a><span class=o>{</span>
<a id=__codelineno-50-207 name=__codelineno-50-207 href=#__codelineno-50-207></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[[</span><span class=w> </span><span class=sb>`</span>getconf<span class=w> </span>WORD_BIT<span class=sb>`</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;32&#39;</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=sb>`</span>getconf<span class=w> </span>LONG_BIT<span class=sb>`</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;64&#39;</span><span class=w> </span><span class=o>]]</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-50-208 name=__codelineno-50-208 href=#__codelineno-50-208></a><span class=w>        </span><span class=nv>Is_64bit</span><span class=o>=</span><span class=s1>&#39;y&#39;</span>
<a id=__codelineno-50-209 name=__codelineno-50-209 href=#__codelineno-50-209></a><span class=w>    </span><span class=k>else</span>
<a id=__codelineno-50-210 name=__codelineno-50-210 href=#__codelineno-50-210></a><span class=w>        </span><span class=nv>Is_64bit</span><span class=o>=</span><span class=s1>&#39;n&#39;</span>
<a id=__codelineno-50-211 name=__codelineno-50-211 href=#__codelineno-50-211></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-50-212 name=__codelineno-50-212 href=#__codelineno-50-212></a><span class=o>}</span>
<a id=__codelineno-50-213 name=__codelineno-50-213 href=#__codelineno-50-213></a>
<a id=__codelineno-50-214 name=__codelineno-50-214 href=#__codelineno-50-214></a>
<a id=__codelineno-50-215 name=__codelineno-50-215 href=#__codelineno-50-215></a>Download_Files<span class=o>()</span>
<a id=__codelineno-50-216 name=__codelineno-50-216 href=#__codelineno-50-216></a><span class=o>{</span>
<a id=__codelineno-50-217 name=__codelineno-50-217 href=#__codelineno-50-217></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>URL</span><span class=o>=</span><span class=nv>$1</span>
<a id=__codelineno-50-218 name=__codelineno-50-218 href=#__codelineno-50-218></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>FileName</span><span class=o>=</span><span class=nv>$2</span>
<a id=__codelineno-50-219 name=__codelineno-50-219 href=#__codelineno-50-219></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-s<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>FileName</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-50-220 name=__codelineno-50-220 href=#__codelineno-50-220></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>FileName</span><span class=si>}</span><span class=s2> [found]&quot;</span>
<a id=__codelineno-50-221 name=__codelineno-50-221 href=#__codelineno-50-221></a><span class=w>    </span><span class=k>else</span>
<a id=__codelineno-50-222 name=__codelineno-50-222 href=#__codelineno-50-222></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Notice: </span><span class=si>${</span><span class=nv>FileName</span><span class=si>}</span><span class=s2> not found!!!download now...&quot;</span>
<a id=__codelineno-50-223 name=__codelineno-50-223 href=#__codelineno-50-223></a><span class=w>        </span>wget<span class=w> </span>-c<span class=w> </span>--progress<span class=o>=</span>bar:force<span class=w> </span>--prefer-family<span class=o>=</span>IPv4<span class=w> </span>--no-check-certificate<span class=w> </span><span class=si>${</span><span class=nv>URL</span><span class=si>}</span>
<a id=__codelineno-50-224 name=__codelineno-50-224 href=#__codelineno-50-224></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-50-225 name=__codelineno-50-225 href=#__codelineno-50-225></a><span class=o>}</span>
<a id=__codelineno-50-226 name=__codelineno-50-226 href=#__codelineno-50-226></a>
<a id=__codelineno-50-227 name=__codelineno-50-227 href=#__codelineno-50-227></a><span class=c1>#批量安装基础包</span>
<a id=__codelineno-50-228 name=__codelineno-50-228 href=#__codelineno-50-228></a>CentOS_Dependent<span class=o>()</span>
<a id=__codelineno-50-229 name=__codelineno-50-229 href=#__codelineno-50-229></a><span class=o>{</span>
<a id=__codelineno-50-230 name=__codelineno-50-230 href=#__codelineno-50-230></a><span class=w>    </span><span class=se>\c</span>p<span class=w> </span>/etc/yum.conf<span class=w> </span>/etc/yum.conf.lnmp
<a id=__codelineno-50-231 name=__codelineno-50-231 href=#__codelineno-50-231></a><span class=w>    </span>sed<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;s:exclude=.*:exclude=:g&#39;</span><span class=w> </span>/etc/yum.conf
<a id=__codelineno-50-232 name=__codelineno-50-232 href=#__codelineno-50-232></a>
<a id=__codelineno-50-233 name=__codelineno-50-233 href=#__codelineno-50-233></a><span class=w>    </span>Echo_Blue<span class=w> </span><span class=s2>&quot;[+] Yum installing dependent packages...&quot;</span>
<a id=__codelineno-50-234 name=__codelineno-50-234 href=#__codelineno-50-234></a><span class=w>    </span><span class=k>for</span><span class=w> </span>packages<span class=w> </span><span class=k>in</span><span class=w> </span>make<span class=w> </span>cmake<span class=w> </span>gcc<span class=w> </span>gcc-c++<span class=w> </span>gcc-g77<span class=w> </span>flex<span class=w> </span>bison<span class=w> </span>file<span class=w> </span>libtool<span class=w> </span>libtool-libs<span class=w> </span>autoconf<span class=w> </span>kernel-devel<span class=w> </span>patch<span class=w> </span>wget<span class=w> </span>crontabs<span class=w> </span>libjpeg<span class=w> </span>libjpeg-devel<span class=w> </span>libpng<span class=w> </span>libpng-devel<span class=w> </span>libpng10<span class=w> </span>libpng10-devel<span class=w> </span>gd<span class=w> </span>gd-devel<span class=w> </span>libxml2<span class=w> </span>libxml2-devel<span class=w> </span>zlib<span class=w> </span>zlib-devel<span class=w> </span>glib2<span class=w> </span>glib2-devel<span class=w> </span>unzip<span class=w> </span>tar<span class=w> </span>bzip2<span class=w> </span>bzip2-devel<span class=w> </span>libevent<span class=w> </span>libevent-devel<span class=w> </span>ncurses<span class=w> </span>ncurses-devel<span class=w> </span>curl<span class=w> </span>curl-devel<span class=w> </span>libcurl<span class=w> </span>libcurl-devel<span class=w> </span>e2fsprogs<span class=w> </span>e2fsprogs-devel<span class=w> </span>krb5<span class=w> </span>krb5-devel<span class=w> </span>libidn<span class=w> </span>libidn-devel<span class=w> </span>openssl<span class=w> </span>openssl-devel<span class=w> </span>vim-minimal<span class=w> </span>gettext<span class=w> </span>gettext-devel<span class=w> </span>ncurses-devel<span class=w> </span>gmp-devel<span class=w> </span>pspell-devel<span class=w> </span>unzip<span class=w> </span>libcap<span class=w> </span>diffutils<span class=w> </span>ca-certificates<span class=w> </span>net-tools<span class=w> </span>libc-client-devel<span class=w> </span>psmisc<span class=w> </span>libXpm-devel<span class=w> </span>git-core<span class=w> </span>c-ares-devel<span class=w> </span>libicu-devel<span class=w> </span>libxslt<span class=w> </span>libxslt-devel<span class=w> </span>xz<span class=p>;</span>
<a id=__codelineno-50-235 name=__codelineno-50-235 href=#__codelineno-50-235></a><span class=w>    </span><span class=k>do</span><span class=w> </span>yum<span class=w> </span>-y<span class=w> </span>install<span class=w> </span><span class=nv>$packages</span><span class=p>;</span><span class=w> </span><span class=k>done</span>
<a id=__codelineno-50-236 name=__codelineno-50-236 href=#__codelineno-50-236></a>
<a id=__codelineno-50-237 name=__codelineno-50-237 href=#__codelineno-50-237></a><span class=w>    </span>mv<span class=w> </span>-f<span class=w> </span>/etc/yum.conf.lnmp<span class=w> </span>/etc/yum.conf
<a id=__codelineno-50-238 name=__codelineno-50-238 href=#__codelineno-50-238></a><span class=o>}</span>
<a id=__codelineno-50-239 name=__codelineno-50-239 href=#__codelineno-50-239></a>
<a id=__codelineno-50-240 name=__codelineno-50-240 href=#__codelineno-50-240></a>
<a id=__codelineno-50-241 name=__codelineno-50-241 href=#__codelineno-50-241></a><span class=c1>#设置cron计划任务</span>
<a id=__codelineno-50-242 name=__codelineno-50-242 href=#__codelineno-50-242></a>Crontab_func<span class=o>(){</span>
<a id=__codelineno-50-243 name=__codelineno-50-243 href=#__codelineno-50-243></a><span class=c1>#!/bin/bash</span>
<a id=__codelineno-50-244 name=__codelineno-50-244 href=#__codelineno-50-244></a>cat<span class=w>  </span><span class=s>&lt;&lt;EOF &gt; /var/spool/cron/root</span>
<a id=__codelineno-50-245 name=__codelineno-50-245 href=#__codelineno-50-245></a><span class=s>*/30 * * * * sh /home/cheungssh/mysite/mysite/cheungssh/cheungssh_demo.sh 2&gt;&gt;/home/cheungssh/logs/demo.log  &gt;&gt; /home/cheungssh/logs/demo.log</span>
<a id=__codelineno-50-246 name=__codelineno-50-246 href=#__codelineno-50-246></a><span class=s>EOF</span>
<a id=__codelineno-50-247 name=__codelineno-50-247 href=#__codelineno-50-247></a><span class=o>}</span>
<a id=__codelineno-50-248 name=__codelineno-50-248 href=#__codelineno-50-248></a>
<a id=__codelineno-50-249 name=__codelineno-50-249 href=#__codelineno-50-249></a>
<a id=__codelineno-50-250 name=__codelineno-50-250 href=#__codelineno-50-250></a>
<a id=__codelineno-50-251 name=__codelineno-50-251 href=#__codelineno-50-251></a><span class=c1>#判断进程信息，杀掉进程</span>
<a id=__codelineno-50-252 name=__codelineno-50-252 href=#__codelineno-50-252></a>kill_Process<span class=o>(){</span>
<a id=__codelineno-50-253 name=__codelineno-50-253 href=#__codelineno-50-253></a>ps<span class=w> </span>-fel<span class=p>|</span>grep<span class=w> </span>websocket_server_cheung.py<span class=p>|</span>grep<span class=w>  </span>-v<span class=w> </span><span class=s2>&quot;</span><span class=nv>$$</span><span class=s2>&quot;</span><span class=p>|</span>awk<span class=w>  </span><span class=s1>&#39;{print  $4}&#39;</span><span class=p>|</span>xargs<span class=w> </span>-i<span class=w> </span><span class=nb>kill</span><span class=w>  </span>-9<span class=w> </span><span class=o>{}</span>
<a id=__codelineno-50-254 name=__codelineno-50-254 href=#__codelineno-50-254></a><span class=o>}</span>
<a id=__codelineno-50-255 name=__codelineno-50-255 href=#__codelineno-50-255></a>
<a id=__codelineno-50-256 name=__codelineno-50-256 href=#__codelineno-50-256></a><span class=c1>#获取MD5值</span>
<a id=__codelineno-50-257 name=__codelineno-50-257 href=#__codelineno-50-257></a>MD5_value<span class=o>(){</span>
<a id=__codelineno-50-258 name=__codelineno-50-258 href=#__codelineno-50-258></a>md5sum<span class=w> </span>/etc/hosts<span class=w> </span><span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;{print $1}&#39;</span>
<a id=__codelineno-50-259 name=__codelineno-50-259 href=#__codelineno-50-259></a>
<a id=__codelineno-50-260 name=__codelineno-50-260 href=#__codelineno-50-260></a><span class=o>}</span>
<a id=__codelineno-50-261 name=__codelineno-50-261 href=#__codelineno-50-261></a>
<a id=__codelineno-50-262 name=__codelineno-50-262 href=#__codelineno-50-262></a><span class=nv>data_format</span><span class=o>=</span><span class=s2>&quot;+%Y-%m-%d %H:%M:%S&quot;</span>
<a id=__codelineno-50-263 name=__codelineno-50-263 href=#__codelineno-50-263></a>
<a id=__codelineno-50-264 name=__codelineno-50-264 href=#__codelineno-50-264></a><span class=c1>#记录日志的function</span>
<a id=__codelineno-50-265 name=__codelineno-50-265 href=#__codelineno-50-265></a><span class=k>function</span><span class=w> </span>fnLogInfo<span class=o>()</span>
<a id=__codelineno-50-266 name=__codelineno-50-266 href=#__codelineno-50-266></a><span class=o>{</span>
<a id=__codelineno-50-267 name=__codelineno-50-267 href=#__codelineno-50-267></a><span class=w>        </span><span class=nb>local</span><span class=w> </span><span class=nv>infomsg</span><span class=o>=</span><span class=nv>$1</span>
<a id=__codelineno-50-268 name=__codelineno-50-268 href=#__codelineno-50-268></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=si>${</span><span class=nv>infomsg</span><span class=si>}</span>
<a id=__codelineno-50-269 name=__codelineno-50-269 href=#__codelineno-50-269></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=sb>`</span>date<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>data_format</span><span class=si>}</span><span class=s2>&quot;</span><span class=sb>`</span><span class=w> </span><span class=s2>&quot;Info:</span><span class=si>${</span><span class=nv>infomsg</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span><span class=si>${</span><span class=nv>log_file</span><span class=si>}</span>
<a id=__codelineno-50-270 name=__codelineno-50-270 href=#__codelineno-50-270></a><span class=o>}</span>
<a id=__codelineno-50-271 name=__codelineno-50-271 href=#__codelineno-50-271></a>
<a id=__codelineno-50-272 name=__codelineno-50-272 href=#__codelineno-50-272></a>
<a id=__codelineno-50-273 name=__codelineno-50-273 href=#__codelineno-50-273></a><span class=c1>#scritps path</span>
<a id=__codelineno-50-274 name=__codelineno-50-274 href=#__codelineno-50-274></a>dir_path<span class=o>(){</span>
<a id=__codelineno-50-275 name=__codelineno-50-275 href=#__codelineno-50-275></a><span class=nv>pwd</span><span class=o>=</span><span class=sb>`</span>dirname<span class=w> </span><span class=nv>$0</span><span class=sb>`</span>
<a id=__codelineno-50-276 name=__codelineno-50-276 href=#__codelineno-50-276></a><span class=o>}</span>
</code></pre></div> <h2 id=30猜随机数>30.猜随机数<a class=headerlink href=#30猜随机数 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-51-1 name=__codelineno-51-1 href=#__codelineno-51-1></a><span class=ch>#!/usr/bin/env bash</span>
<a id=__codelineno-51-2 name=__codelineno-51-2 href=#__codelineno-51-2></a><span class=c1>#usage:xxx</span>
<a id=__codelineno-51-3 name=__codelineno-51-3 href=#__codelineno-51-3></a><span class=c1>#scripts_name:xxx.sh</span>
<a id=__codelineno-51-4 name=__codelineno-51-4 href=#__codelineno-51-4></a><span class=c1>#取余的算法将随机数变为1-100之间</span>
<a id=__codelineno-51-5 name=__codelineno-51-5 href=#__codelineno-51-5></a><span class=nv>num</span><span class=o>=</span>$<span class=o>[</span>RANDOM%100+1<span class=o>]</span>
<a id=__codelineno-51-6 name=__codelineno-51-6 href=#__codelineno-51-6></a>
<a id=__codelineno-51-7 name=__codelineno-51-7 href=#__codelineno-51-7></a><span class=c1>#使用read捕获输入</span>
<a id=__codelineno-51-8 name=__codelineno-51-8 href=#__codelineno-51-8></a><span class=c1>#使用if判断</span>
<a id=__codelineno-51-9 name=__codelineno-51-9 href=#__codelineno-51-9></a><span class=k>while</span><span class=w> </span>True<span class=p>;</span><span class=w> </span><span class=k>do</span>
<a id=__codelineno-51-10 name=__codelineno-51-10 href=#__codelineno-51-10></a><span class=w>    </span><span class=nb>read</span><span class=w> </span>-p<span class=w> </span><span class=s2>&quot;计算生成的一个1-100的随机数：&quot;</span><span class=w> </span>cai
<a id=__codelineno-51-11 name=__codelineno-51-11 href=#__codelineno-51-11></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=nv>$cai</span><span class=w> </span>-eq<span class=w> </span><span class=nv>$num</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-51-12 name=__codelineno-51-12 href=#__codelineno-51-12></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;恭喜，猜对了&quot;</span>
<a id=__codelineno-51-13 name=__codelineno-51-13 href=#__codelineno-51-13></a><span class=w>    </span><span class=k>elif</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=nv>$cai</span><span class=w> </span>-gt<span class=w> </span><span class=nv>$num</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-51-14 name=__codelineno-51-14 href=#__codelineno-51-14></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;oops，猜大了&quot;</span>
<a id=__codelineno-51-15 name=__codelineno-51-15 href=#__codelineno-51-15></a><span class=w>    </span><span class=k>else</span>
<a id=__codelineno-51-16 name=__codelineno-51-16 href=#__codelineno-51-16></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;oops，猜小了&quot;</span>
<a id=__codelineno-51-17 name=__codelineno-51-17 href=#__codelineno-51-17></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-51-18 name=__codelineno-51-18 href=#__codelineno-51-18></a><span class=k>done</span>
</code></pre></div> <h2 id=31test多种写法>31.test多种写法<a class=headerlink href=#31test多种写法 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-52-1 name=__codelineno-52-1 href=#__codelineno-52-1></a><span class=ch>#!/usr/bin/env bash</span>
<a id=__codelineno-52-2 name=__codelineno-52-2 href=#__codelineno-52-2></a><span class=nv>FreeMem</span><span class=o>=</span><span class=sb>`</span>free<span class=w> </span>-m<span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;NR==3 {print $NF}&#39;</span><span class=sb>`</span>
<a id=__codelineno-52-3 name=__codelineno-52-3 href=#__codelineno-52-3></a><span class=k>if</span><span class=w> </span><span class=o>((</span><span class=w> </span><span class=nv>$FreeMem</span><span class=w> </span>&lt;<span class=w> </span><span class=m>1000</span><span class=w> </span><span class=o>))</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-52-4 name=__codelineno-52-4 href=#__codelineno-52-4></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;xxxxxxxxxx&quot;</span>
<a id=__codelineno-52-5 name=__codelineno-52-5 href=#__codelineno-52-5></a><span class=k>fi</span>
<a id=__codelineno-52-6 name=__codelineno-52-6 href=#__codelineno-52-6></a>
<a id=__codelineno-52-7 name=__codelineno-52-7 href=#__codelineno-52-7></a><span class=k>if</span><span class=w> </span><span class=o>[[</span><span class=w> </span><span class=nv>$FreeMem</span><span class=w> </span>-lt<span class=w> </span><span class=m>1000</span><span class=w> </span><span class=o>]]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-52-8 name=__codelineno-52-8 href=#__codelineno-52-8></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;xxxxxxxx&quot;</span>
<a id=__codelineno-52-9 name=__codelineno-52-9 href=#__codelineno-52-9></a><span class=k>fi</span>
<a id=__codelineno-52-10 name=__codelineno-52-10 href=#__codelineno-52-10></a>
<a id=__codelineno-52-11 name=__codelineno-52-11 href=#__codelineno-52-11></a><span class=k>if</span><span class=w> </span><span class=nb>test</span><span class=w> </span><span class=nv>$FreeMem</span><span class=w> </span>-lt<span class=w> </span><span class=m>1000</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-52-12 name=__codelineno-52-12 href=#__codelineno-52-12></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;xxxxxxxxxxxx&quot;</span>
<a id=__codelineno-52-13 name=__codelineno-52-13 href=#__codelineno-52-13></a><span class=k>fi</span>
<a id=__codelineno-52-14 name=__codelineno-52-14 href=#__codelineno-52-14></a>
<a id=__codelineno-52-15 name=__codelineno-52-15 href=#__codelineno-52-15></a><span class=k>if</span><span class=w> </span>grep<span class=w>  </span>/etc/passwd<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-52-16 name=__codelineno-52-16 href=#__codelineno-52-16></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;xxxxxxxxxx&quot;</span>
<a id=__codelineno-52-17 name=__codelineno-52-17 href=#__codelineno-52-17></a><span class=k>fi</span>
</code></pre></div> <h2 id=32换算秒为分钟小时>32.换算秒为分钟、小时<a class=headerlink href=#32换算秒为分钟小时 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-53-1 name=__codelineno-53-1 href=#__codelineno-53-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-53-2 name=__codelineno-53-2 href=#__codelineno-53-2></a>
<a id=__codelineno-53-3 name=__codelineno-53-3 href=#__codelineno-53-3></a><span class=nv>a</span><span class=o>=</span><span class=m>60100</span>
<a id=__codelineno-53-4 name=__codelineno-53-4 href=#__codelineno-53-4></a>swap_seconds<span class=w> </span><span class=o>()</span>
<a id=__codelineno-53-5 name=__codelineno-53-5 href=#__codelineno-53-5></a><span class=o>{</span>
<a id=__codelineno-53-6 name=__codelineno-53-6 href=#__codelineno-53-6></a><span class=w>    </span><span class=nv>SEC</span><span class=o>=</span><span class=nv>$1</span>
<a id=__codelineno-53-7 name=__codelineno-53-7 href=#__codelineno-53-7></a><span class=w>    </span><span class=o>((</span><span class=w> </span>SEC<span class=w> </span>&lt;<span class=w> </span><span class=m>60</span><span class=w> </span><span class=o>))</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;持续时间: </span><span class=nv>$SEC秒</span><span class=s2>\c&quot;</span>
<a id=__codelineno-53-8 name=__codelineno-53-8 href=#__codelineno-53-8></a><span class=w>    </span><span class=o>((</span><span class=w> </span>SEC<span class=w> </span>&gt;<span class=o>=</span><span class=w> </span><span class=m>60</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>SEC<span class=w> </span>&lt;<span class=w> </span><span class=m>3600</span><span class=w> </span><span class=o>))</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;持续时间: </span><span class=k>$((</span><span class=w> </span><span class=nv>SEC</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=m>60</span><span class=w> </span><span class=k>))</span><span class=s2>分钟</span><span class=k>$((</span><span class=w> </span><span class=nv>SEC</span><span class=w> </span><span class=o>%</span><span class=w> </span><span class=m>60</span><span class=w> </span><span class=k>))</span><span class=s2>秒\c&quot;</span>
<a id=__codelineno-53-9 name=__codelineno-53-9 href=#__codelineno-53-9></a><span class=w>    </span><span class=o>((</span><span class=w> </span>SEC<span class=w> </span>&gt;<span class=w> </span><span class=m>3600</span><span class=w> </span><span class=o>))</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;持续时间: </span><span class=k>$((</span><span class=w> </span><span class=nv>SEC</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=m>3600</span><span class=w> </span><span class=k>))</span><span class=s2>小时</span><span class=k>$((</span><span class=w> </span><span class=o>(</span><span class=nv>SEC</span><span class=w> </span><span class=o>%</span><span class=w> </span><span class=m>3600</span><span class=o>)</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=m>60</span><span class=w> </span><span class=k>))</span><span class=s2>分钟</span><span class=k>$((</span><span class=w> </span><span class=o>(</span><span class=nv>SEC</span><span class=w> </span><span class=o>%</span><span class=w> </span><span class=m>3600</span><span class=o>)</span><span class=w> </span><span class=o>%</span><span class=w> </span><span class=m>60</span><span class=w> </span><span class=k>))</span><span class=s2>秒\c&quot;</span>
<a id=__codelineno-53-10 name=__codelineno-53-10 href=#__codelineno-53-10></a><span class=o>}</span>
<a id=__codelineno-53-11 name=__codelineno-53-11 href=#__codelineno-53-11></a>
<a id=__codelineno-53-12 name=__codelineno-53-12 href=#__codelineno-53-12></a><span class=nv>b</span><span class=o>=</span><span class=sb>`</span>swap_seconds<span class=w> </span><span class=nv>$a</span><span class=sb>`</span>
<a id=__codelineno-53-13 name=__codelineno-53-13 href=#__codelineno-53-13></a><span class=nb>echo</span><span class=w> </span><span class=nv>$b</span>
</code></pre></div> <p>输出</p> <div class=highlight><pre><span></span><code><a id=__codelineno-54-1 name=__codelineno-54-1 href=#__codelineno-54-1></a>持续时间: 16小时41分钟40秒
</code></pre></div> <h2 id=33脚本命令行参数的传递与判断>33.脚本命令行参数的传递与判断<a class=headerlink href=#33脚本命令行参数的传递与判断 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-55-1 name=__codelineno-55-1 href=#__codelineno-55-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-55-2 name=__codelineno-55-2 href=#__codelineno-55-2></a>
<a id=__codelineno-55-3 name=__codelineno-55-3 href=#__codelineno-55-3></a>main<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-55-4 name=__codelineno-55-4 href=#__codelineno-55-4></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[[</span><span class=w> </span><span class=nv>$#</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=m>1</span><span class=w> </span><span class=o>]]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-55-5 name=__codelineno-55-5 href=#__codelineno-55-5></a><span class=w>        </span><span class=k>case</span><span class=w> </span><span class=nv>$1</span><span class=w> </span><span class=k>in</span>
<a id=__codelineno-55-6 name=__codelineno-55-6 href=#__codelineno-55-6></a><span class=w>        </span><span class=s2>&quot;-h&quot;</span><span class=o>)</span>
<a id=__codelineno-55-7 name=__codelineno-55-7 href=#__codelineno-55-7></a><span class=w>            </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;脚本使用方法: &quot;</span>
<a id=__codelineno-55-8 name=__codelineno-55-8 href=#__codelineno-55-8></a><span class=w>            </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;  ./gitlab-pipeline.sh git仓库名1 git仓库名2 ... tag名(tag命名规则为: *-v加数字)&quot;</span>
<a id=__codelineno-55-9 name=__codelineno-55-9 href=#__codelineno-55-9></a><span class=w>            </span><span class=nb>exit</span>
<a id=__codelineno-55-10 name=__codelineno-55-10 href=#__codelineno-55-10></a><span class=w>            </span><span class=p>;;</span>
<a id=__codelineno-55-11 name=__codelineno-55-11 href=#__codelineno-55-11></a><span class=w>        </span><span class=s2>&quot;--help&quot;</span><span class=o>)</span>
<a id=__codelineno-55-12 name=__codelineno-55-12 href=#__codelineno-55-12></a><span class=w>            </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;脚本使用方法: &quot;</span>
<a id=__codelineno-55-13 name=__codelineno-55-13 href=#__codelineno-55-13></a><span class=w>            </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;  ./gitlab-pipeline.sh git仓库名1 git仓库名2 ... tag名(tag命名规则为: *-v加数字)&quot;</span>
<a id=__codelineno-55-14 name=__codelineno-55-14 href=#__codelineno-55-14></a><span class=w>            </span><span class=nb>exit</span>
<a id=__codelineno-55-15 name=__codelineno-55-15 href=#__codelineno-55-15></a><span class=w>            </span><span class=p>;;</span>
<a id=__codelineno-55-16 name=__codelineno-55-16 href=#__codelineno-55-16></a><span class=w>        </span>*<span class=o>)</span>
<a id=__codelineno-55-17 name=__codelineno-55-17 href=#__codelineno-55-17></a><span class=w>            </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;参数错误！&quot;</span>
<a id=__codelineno-55-18 name=__codelineno-55-18 href=#__codelineno-55-18></a><span class=w>            </span><span class=nb>exit</span>
<a id=__codelineno-55-19 name=__codelineno-55-19 href=#__codelineno-55-19></a><span class=w>            </span><span class=p>;;</span>
<a id=__codelineno-55-20 name=__codelineno-55-20 href=#__codelineno-55-20></a><span class=w>        </span><span class=k>esac</span>
<a id=__codelineno-55-21 name=__codelineno-55-21 href=#__codelineno-55-21></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-55-22 name=__codelineno-55-22 href=#__codelineno-55-22></a><span class=o>}</span>
<a id=__codelineno-55-23 name=__codelineno-55-23 href=#__codelineno-55-23></a>
<a id=__codelineno-55-24 name=__codelineno-55-24 href=#__codelineno-55-24></a>main<span class=w> </span><span class=nv>$*</span>
</code></pre></div> <h2 id=34检测docker-容器的启动状态>34.检测docker 容器的启动状态<a class=headerlink href=#34检测docker-容器的启动状态 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-56-1 name=__codelineno-56-1 href=#__codelineno-56-1></a><span class=c1># 第一步：判断镜像是否存在</span>
<a id=__codelineno-56-2 name=__codelineno-56-2 href=#__codelineno-56-2></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=sb>`</span>docker<span class=w> </span>images<span class=w> </span>--format<span class=w> </span><span class=o>{{</span>.Repository<span class=o>}}</span>:<span class=o>{{</span>.Tag<span class=o>}}</span><span class=w> </span><span class=p>|</span>grep<span class=w> </span>-Fx<span class=w> </span><span class=m>192</span>.168.1.7:32772/applications/<span class=nv>$CI_PROJECT_NAME</span>:<span class=si>${</span><span class=nv>CI_COMMIT_SHORT_SHA</span><span class=si>}</span><span class=p>;</span><span class=nb>echo</span><span class=w> </span><span class=nv>$?</span><span class=sb>`</span><span class=w> </span>-eq<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=k>then</span>
<a id=__codelineno-56-3 name=__codelineno-56-3 href=#__codelineno-56-3></a><span class=w>   </span>docker<span class=w> </span>pull<span class=w> </span><span class=m>192</span>.168.1.7:32772/applications/<span class=nv>$CI_PROJECT_NAME</span>:<span class=nv>$CI_COMMIT_SHORT_SHA</span><span class=w> </span><span class=p>;</span>
<a id=__codelineno-56-4 name=__codelineno-56-4 href=#__codelineno-56-4></a><span class=k>fi</span><span class=p>;</span>
<a id=__codelineno-56-5 name=__codelineno-56-5 href=#__codelineno-56-5></a><span class=c1># 第二步：判断是否已经有重名的容器在运行或者处在其他状态。重名的，先删掉，在启动；不重名的直接启动</span>
<a id=__codelineno-56-6 name=__codelineno-56-6 href=#__codelineno-56-6></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=sb>`</span>docker<span class=w> </span>ps<span class=w> </span>-a<span class=w> </span>--format<span class=w> </span><span class=o>{{</span>.Names<span class=o>}}</span><span class=w> </span><span class=p>|</span>grep<span class=w> </span>-Fx<span class=w> </span><span class=nv>$CI_PROJECT_NAME</span><span class=w> </span>&gt;<span class=w> </span>/dev/null<span class=w> </span><span class=p>;</span><span class=nb>echo</span><span class=w> </span><span class=nv>$?</span><span class=sb>`</span><span class=w> </span>-eq<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=p>;</span><span class=k>then</span>
<a id=__codelineno-56-7 name=__codelineno-56-7 href=#__codelineno-56-7></a><span class=w>   </span>docker<span class=w> </span>rm<span class=w> </span>-f<span class=w> </span><span class=nv>$CI_PROJECT_NAME</span><span class=w> </span><span class=p>;</span>
<a id=__codelineno-56-8 name=__codelineno-56-8 href=#__codelineno-56-8></a><span class=w>   </span>docker<span class=w> </span>run<span class=w> </span>-d<span class=w> </span>--name<span class=w> </span><span class=nv>$CI_PROJECT_NAME</span><span class=w> </span>-p<span class=w> </span><span class=m>30088</span>:8080<span class=w> </span><span class=m>192</span>.168.1.7:32772/applications/<span class=nv>$CI_PROJECT_NAME</span>:<span class=nv>$CI_COMMIT_SHORT_SHA</span><span class=w> </span><span class=p>;</span>
<a id=__codelineno-56-9 name=__codelineno-56-9 href=#__codelineno-56-9></a><span class=k>else</span>
<a id=__codelineno-56-10 name=__codelineno-56-10 href=#__codelineno-56-10></a><span class=w>   </span>docker<span class=w> </span>run<span class=w> </span>-d<span class=w> </span>--name<span class=w> </span><span class=nv>$CI_PROJECT_NAME</span><span class=w> </span>-p<span class=w> </span><span class=m>30088</span>:8080<span class=w> </span><span class=m>192</span>.168.1.7:32772/applications/<span class=nv>$CI_PROJECT_NAME</span>:<span class=nv>$CI_COMMIT_SHORT_SHA</span><span class=w> </span><span class=p>;</span>
<a id=__codelineno-56-11 name=__codelineno-56-11 href=#__codelineno-56-11></a><span class=k>fi</span><span class=p>;</span>
<a id=__codelineno-56-12 name=__codelineno-56-12 href=#__codelineno-56-12></a><span class=c1># 第三步：循环五次判断容器的监控检测是否处于什么状态。健康状态就直接退出循环，不健康显示健康检查日志，正在启动的直接显示。处于其他状态的直接显示状态</span>
<a id=__codelineno-56-13 name=__codelineno-56-13 href=#__codelineno-56-13></a><span class=nv>n</span><span class=o>=</span><span class=m>0</span><span class=p>;</span>
<a id=__codelineno-56-14 name=__codelineno-56-14 href=#__codelineno-56-14></a><span class=k>while</span><span class=w> </span><span class=nb>true</span><span class=w> </span><span class=p>;</span><span class=k>do</span>
<a id=__codelineno-56-15 name=__codelineno-56-15 href=#__codelineno-56-15></a><span class=w>  </span><span class=nv>container_state</span><span class=o>=</span><span class=sb>`</span>docker<span class=w> </span>inspect<span class=w> </span>--format<span class=o>=</span><span class=s1>&#39;{{json .State.Health.Status}}&#39;</span><span class=w> </span><span class=nv>$CI_PROJECT_NAME</span><span class=sb>`</span><span class=p>;</span>
<a id=__codelineno-56-16 name=__codelineno-56-16 href=#__codelineno-56-16></a><span class=w>  </span><span class=k>case</span><span class=w> </span><span class=nv>$container_state</span><span class=w> </span><span class=k>in</span>
<a id=__codelineno-56-17 name=__codelineno-56-17 href=#__codelineno-56-17></a><span class=w>    </span><span class=s1>&#39;&quot;starting&quot;&#39;</span><span class=w> </span><span class=o>)</span>
<a id=__codelineno-56-18 name=__codelineno-56-18 href=#__codelineno-56-18></a><span class=w>      </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;应用容器正在启动！&quot;</span><span class=p>;</span>
<a id=__codelineno-56-19 name=__codelineno-56-19 href=#__codelineno-56-19></a><span class=w>    </span><span class=p>;;</span>
<a id=__codelineno-56-20 name=__codelineno-56-20 href=#__codelineno-56-20></a><span class=w>    </span><span class=s1>&#39;&quot;healthy&quot;&#39;</span><span class=w> </span><span class=o>)</span>
<a id=__codelineno-56-21 name=__codelineno-56-21 href=#__codelineno-56-21></a><span class=w>      </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;应用容器已启动，状态健康！&quot;</span><span class=p>;</span>
<a id=__codelineno-56-22 name=__codelineno-56-22 href=#__codelineno-56-22></a><span class=w>    </span><span class=k>break</span><span class=p>;</span>
<a id=__codelineno-56-23 name=__codelineno-56-23 href=#__codelineno-56-23></a><span class=w>    </span><span class=p>;;</span>
<a id=__codelineno-56-24 name=__codelineno-56-24 href=#__codelineno-56-24></a><span class=w>    </span><span class=s1>&#39;&quot;unhealthy&quot;&#39;</span><span class=w> </span><span class=o>)</span>
<a id=__codelineno-56-25 name=__codelineno-56-25 href=#__codelineno-56-25></a><span class=w>      </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;应用容器健康检测失败！&quot;</span><span class=p>;</span>
<a id=__codelineno-56-26 name=__codelineno-56-26 href=#__codelineno-56-26></a><span class=w>      </span>docker<span class=w> </span>inspect<span class=w> </span>--format<span class=o>=</span><span class=s1>&#39;{{json .State.Health.Log}}&#39;</span><span class=w> </span><span class=nv>$CI_PROJECT_NAME</span><span class=p>;</span>
<a id=__codelineno-56-27 name=__codelineno-56-27 href=#__codelineno-56-27></a><span class=w>    </span><span class=p>;;</span>
<a id=__codelineno-56-28 name=__codelineno-56-28 href=#__codelineno-56-28></a><span class=w>    </span>*<span class=w> </span><span class=o>)</span>
<a id=__codelineno-56-29 name=__codelineno-56-29 href=#__codelineno-56-29></a><span class=w>      </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;未知的状态:</span><span class=nv>$container_state</span><span class=s2>&quot;</span><span class=p>;</span>
<a id=__codelineno-56-30 name=__codelineno-56-30 href=#__codelineno-56-30></a><span class=w>    </span><span class=p>;;</span>
<a id=__codelineno-56-31 name=__codelineno-56-31 href=#__codelineno-56-31></a><span class=w>  </span><span class=k>esac</span><span class=p>;</span>
<a id=__codelineno-56-32 name=__codelineno-56-32 href=#__codelineno-56-32></a><span class=w>  </span>sleep<span class=w> </span>1s<span class=p>;</span>
<a id=__codelineno-56-33 name=__codelineno-56-33 href=#__codelineno-56-33></a><span class=w>  </span><span class=nv>n</span><span class=o>=</span><span class=k>$((</span><span class=nv>$n</span><span class=o>+</span><span class=m>1</span><span class=k>))</span><span class=p>;</span>
<a id=__codelineno-56-34 name=__codelineno-56-34 href=#__codelineno-56-34></a><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=nv>$n</span><span class=w> </span>-eq<span class=w> </span><span class=m>5</span><span class=w> </span><span class=o>]</span><span class=p>;</span>
<a id=__codelineno-56-35 name=__codelineno-56-35 href=#__codelineno-56-35></a><span class=w>     </span><span class=k>then</span><span class=w> </span><span class=k>break</span><span class=w> </span><span class=p>;</span>
<a id=__codelineno-56-36 name=__codelineno-56-36 href=#__codelineno-56-36></a><span class=w>  </span><span class=k>fi</span><span class=w> </span><span class=p>;</span>
<a id=__codelineno-56-37 name=__codelineno-56-37 href=#__codelineno-56-37></a><span class=k>done</span>
</code></pre></div> <h2 id=35检查常见系统命令是否安装>35.检查常见系统命令是否安装<a class=headerlink href=#35检查常见系统命令是否安装 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-57-1 name=__codelineno-57-1 href=#__codelineno-57-1></a>check_command<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-57-2 name=__codelineno-57-2 href=#__codelineno-57-2></a><span class=w>    </span><span class=k>if</span><span class=w> </span>!<span class=w> </span><span class=nb>command</span><span class=w> </span>-v<span class=w> </span>ifconfig<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-57-3 name=__codelineno-57-3 href=#__codelineno-57-3></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;\033[31mifconfig命令不存在，正在下载安装！\033[0m&quot;</span>
<a id=__codelineno-57-4 name=__codelineno-57-4 href=#__codelineno-57-4></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=nv>os</span><span class=o>=</span><span class=s2>&quot;ubuntu&quot;</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-57-5 name=__codelineno-57-5 href=#__codelineno-57-5></a><span class=w>            </span>apt<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>net-tools<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-57-6 name=__codelineno-57-6 href=#__codelineno-57-6></a><span class=w>        </span><span class=k>elif</span><span class=w> </span><span class=nv>os</span><span class=o>=</span><span class=s2>&quot;centos&quot;</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-57-7 name=__codelineno-57-7 href=#__codelineno-57-7></a><span class=w>            </span>yum<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>net-tools<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-57-8 name=__codelineno-57-8 href=#__codelineno-57-8></a><span class=w>        </span><span class=k>elif</span><span class=w> </span><span class=nv>os</span><span class=o>=</span><span class=s2>&quot;fedora&quot;</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-57-9 name=__codelineno-57-9 href=#__codelineno-57-9></a><span class=w>            </span>dnf<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>net-tools<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-57-10 name=__codelineno-57-10 href=#__codelineno-57-10></a><span class=w>        </span><span class=k>fi</span>
<a id=__codelineno-57-11 name=__codelineno-57-11 href=#__codelineno-57-11></a><span class=w>    </span><span class=k>elif</span><span class=w> </span>!<span class=w> </span><span class=nb>command</span><span class=w> </span>-v<span class=w> </span>ip<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-57-12 name=__codelineno-57-12 href=#__codelineno-57-12></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;\033[31mip命令不存在，正在下载安装！\033[0m&quot;</span>
<a id=__codelineno-57-13 name=__codelineno-57-13 href=#__codelineno-57-13></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=nv>os</span><span class=o>=</span><span class=s2>&quot;ubuntu&quot;</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-57-14 name=__codelineno-57-14 href=#__codelineno-57-14></a><span class=w>            </span>apt<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>iproute2<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-57-15 name=__codelineno-57-15 href=#__codelineno-57-15></a><span class=w>        </span><span class=k>elif</span><span class=w> </span><span class=nv>os</span><span class=o>=</span><span class=s2>&quot;centos&quot;</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-57-16 name=__codelineno-57-16 href=#__codelineno-57-16></a><span class=w>            </span>yum<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>iproute2<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-57-17 name=__codelineno-57-17 href=#__codelineno-57-17></a><span class=w>        </span><span class=k>elif</span><span class=w> </span><span class=nv>os</span><span class=o>=</span><span class=s2>&quot;fedora&quot;</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-57-18 name=__codelineno-57-18 href=#__codelineno-57-18></a><span class=w>            </span>dnf<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>iproute2<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-57-19 name=__codelineno-57-19 href=#__codelineno-57-19></a><span class=w>        </span><span class=k>fi</span>
<a id=__codelineno-57-20 name=__codelineno-57-20 href=#__codelineno-57-20></a><span class=w>    </span><span class=k>elif</span><span class=w> </span>!<span class=w> </span><span class=nb>command</span><span class=w> </span>-v<span class=w> </span>curl<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-57-21 name=__codelineno-57-21 href=#__codelineno-57-21></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;\033[31mcurl命令不存在，正在下载安装！\033[0m&quot;</span>
<a id=__codelineno-57-22 name=__codelineno-57-22 href=#__codelineno-57-22></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=nv>os</span><span class=o>=</span><span class=s2>&quot;ubuntu&quot;</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-57-23 name=__codelineno-57-23 href=#__codelineno-57-23></a><span class=w>            </span>apt<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>curl<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-57-24 name=__codelineno-57-24 href=#__codelineno-57-24></a><span class=w>        </span><span class=k>elif</span><span class=w> </span><span class=nv>os</span><span class=o>=</span><span class=s2>&quot;centos&quot;</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-57-25 name=__codelineno-57-25 href=#__codelineno-57-25></a><span class=w>            </span>yum<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>curl<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-57-26 name=__codelineno-57-26 href=#__codelineno-57-26></a><span class=w>        </span><span class=k>elif</span><span class=w> </span><span class=nv>os</span><span class=o>=</span><span class=s2>&quot;fedora&quot;</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-57-27 name=__codelineno-57-27 href=#__codelineno-57-27></a><span class=w>            </span>dnf<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>curl<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-57-28 name=__codelineno-57-28 href=#__codelineno-57-28></a><span class=w>        </span><span class=k>fi</span>
<a id=__codelineno-57-29 name=__codelineno-57-29 href=#__codelineno-57-29></a><span class=w>    </span><span class=k>elif</span><span class=w> </span>!<span class=w> </span><span class=nb>command</span><span class=w> </span>-v<span class=w> </span>wget<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-57-30 name=__codelineno-57-30 href=#__codelineno-57-30></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;\033[31mawk命令不存在，正在下载安装！\033[0m&quot;</span>
<a id=__codelineno-57-31 name=__codelineno-57-31 href=#__codelineno-57-31></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=nv>os</span><span class=o>=</span><span class=s2>&quot;ubuntu&quot;</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-57-32 name=__codelineno-57-32 href=#__codelineno-57-32></a><span class=w>            </span>apt<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>wget<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-57-33 name=__codelineno-57-33 href=#__codelineno-57-33></a><span class=w>        </span><span class=k>elif</span><span class=w> </span><span class=nv>os</span><span class=o>=</span><span class=s2>&quot;centos&quot;</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-57-34 name=__codelineno-57-34 href=#__codelineno-57-34></a><span class=w>            </span>yum<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>wget<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-57-35 name=__codelineno-57-35 href=#__codelineno-57-35></a><span class=w>        </span><span class=k>elif</span><span class=w> </span><span class=nv>os</span><span class=o>=</span><span class=s2>&quot;fedora&quot;</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-57-36 name=__codelineno-57-36 href=#__codelineno-57-36></a><span class=w>            </span>dnf<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>wget<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-57-37 name=__codelineno-57-37 href=#__codelineno-57-37></a><span class=w>        </span><span class=k>fi</span>
<a id=__codelineno-57-38 name=__codelineno-57-38 href=#__codelineno-57-38></a><span class=w>    </span><span class=k>elif</span><span class=w> </span>!<span class=w> </span><span class=nb>command</span><span class=w> </span>-v<span class=w> </span>tail<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-57-39 name=__codelineno-57-39 href=#__codelineno-57-39></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;\033[31mcoreutils命令不存在，正在下载安装！\033[0m&quot;</span>
<a id=__codelineno-57-40 name=__codelineno-57-40 href=#__codelineno-57-40></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=nv>os</span><span class=o>=</span><span class=s2>&quot;ubuntu&quot;</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-57-41 name=__codelineno-57-41 href=#__codelineno-57-41></a><span class=w>            </span>apt<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>coreutils<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-57-42 name=__codelineno-57-42 href=#__codelineno-57-42></a><span class=w>        </span><span class=k>elif</span><span class=w> </span><span class=nv>os</span><span class=o>=</span><span class=s2>&quot;centos&quot;</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-57-43 name=__codelineno-57-43 href=#__codelineno-57-43></a><span class=w>            </span>yum<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>coreutils<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-57-44 name=__codelineno-57-44 href=#__codelineno-57-44></a><span class=w>        </span><span class=k>elif</span><span class=w> </span><span class=nv>os</span><span class=o>=</span><span class=s2>&quot;fedora&quot;</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-57-45 name=__codelineno-57-45 href=#__codelineno-57-45></a><span class=w>            </span>dnf<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>coreutils<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-57-46 name=__codelineno-57-46 href=#__codelineno-57-46></a><span class=w>        </span><span class=k>fi</span>
<a id=__codelineno-57-47 name=__codelineno-57-47 href=#__codelineno-57-47></a><span class=w>    </span><span class=k>elif</span><span class=w> </span>!<span class=w> </span><span class=nb>command</span><span class=w> </span>-v<span class=w> </span>sed<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-57-48 name=__codelineno-57-48 href=#__codelineno-57-48></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;\033[31msed命令不存在，正在下载安装！\033[0m&quot;</span>
<a id=__codelineno-57-49 name=__codelineno-57-49 href=#__codelineno-57-49></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=nv>os</span><span class=o>=</span><span class=s2>&quot;ubuntu&quot;</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-57-50 name=__codelineno-57-50 href=#__codelineno-57-50></a><span class=w>            </span>apt<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>sed<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-57-51 name=__codelineno-57-51 href=#__codelineno-57-51></a><span class=w>        </span><span class=k>elif</span><span class=w> </span><span class=nv>os</span><span class=o>=</span><span class=s2>&quot;centos&quot;</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-57-52 name=__codelineno-57-52 href=#__codelineno-57-52></a><span class=w>            </span>yum<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>sed<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-57-53 name=__codelineno-57-53 href=#__codelineno-57-53></a><span class=w>        </span><span class=k>elif</span><span class=w> </span><span class=nv>os</span><span class=o>=</span><span class=s2>&quot;fedora&quot;</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-57-54 name=__codelineno-57-54 href=#__codelineno-57-54></a><span class=w>            </span>dnf<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>sed<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-57-55 name=__codelineno-57-55 href=#__codelineno-57-55></a><span class=w>        </span><span class=k>fi</span>
<a id=__codelineno-57-56 name=__codelineno-57-56 href=#__codelineno-57-56></a><span class=w>    </span><span class=k>elif</span><span class=w> </span>!<span class=w> </span><span class=nb>command</span><span class=w> </span>-v<span class=w> </span>grep<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-57-57 name=__codelineno-57-57 href=#__codelineno-57-57></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;\033[31mgrep命令不存在，正在下载安装！\033[0m&quot;</span>
<a id=__codelineno-57-58 name=__codelineno-57-58 href=#__codelineno-57-58></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=nv>os</span><span class=o>=</span><span class=s2>&quot;ubuntu&quot;</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-57-59 name=__codelineno-57-59 href=#__codelineno-57-59></a><span class=w>            </span>apt<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>grep<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-57-60 name=__codelineno-57-60 href=#__codelineno-57-60></a><span class=w>        </span><span class=k>elif</span><span class=w> </span><span class=nv>os</span><span class=o>=</span><span class=s2>&quot;centos&quot;</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-57-61 name=__codelineno-57-61 href=#__codelineno-57-61></a><span class=w>            </span>yum<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>grep<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-57-62 name=__codelineno-57-62 href=#__codelineno-57-62></a><span class=w>        </span><span class=k>elif</span><span class=w> </span><span class=nv>os</span><span class=o>=</span><span class=s2>&quot;fedora&quot;</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-57-63 name=__codelineno-57-63 href=#__codelineno-57-63></a><span class=w>            </span>dnf<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>grep<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-57-64 name=__codelineno-57-64 href=#__codelineno-57-64></a><span class=w>        </span><span class=k>fi</span>
<a id=__codelineno-57-65 name=__codelineno-57-65 href=#__codelineno-57-65></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-57-66 name=__codelineno-57-66 href=#__codelineno-57-66></a><span class=o>}</span>
</code></pre></div> <h2 id=36发送钉钉通知>36.发送钉钉通知<a class=headerlink href=#36发送钉钉通知 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-58-1 name=__codelineno-58-1 href=#__codelineno-58-1></a><span class=k>function</span><span class=w> </span>sendDingDing<span class=o>(){</span>
<a id=__codelineno-58-2 name=__codelineno-58-2 href=#__codelineno-58-2></a><span class=w>  </span><span class=nv>Ding_Webhook_Token</span><span class=o>=</span><span class=s1>&#39;钉钉机器人的WebHook Token&#39;</span>
<a id=__codelineno-58-3 name=__codelineno-58-3 href=#__codelineno-58-3></a><span class=w>  </span><span class=nv>Ding_Webhook_keyword</span><span class=o>=</span><span class=s2>&quot;可用作消息标题&quot;</span>
<a id=__codelineno-58-4 name=__codelineno-58-4 href=#__codelineno-58-4></a><span class=w>  </span><span class=nv>send_result</span><span class=o>=</span><span class=k>$(</span>curl<span class=w> </span>-sS<span class=w> </span><span class=se>\</span>
<a id=__codelineno-58-5 name=__codelineno-58-5 href=#__codelineno-58-5></a><span class=w>    </span>-XPOST<span class=w> </span>https://oapi.dingtalk.com/robot/send?access_token<span class=o>=</span><span class=s2>&quot;</span><span class=nv>$Ding_Webhook_Token</span><span class=s2>&quot;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-58-6 name=__codelineno-58-6 href=#__codelineno-58-6></a><span class=w>    </span>-H<span class=w> </span><span class=s1>&#39;Content-Type: application/json&#39;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-58-7 name=__codelineno-58-7 href=#__codelineno-58-7></a><span class=w>    </span>-d<span class=w> </span><span class=s1>&#39;{&quot;msgtype&quot;: &quot;markdown&quot;,&quot;markdown&quot;: {&quot;title&quot;: &quot;&#39;</span><span class=nv>$Ding_Webhook_Keyword</span><span class=s1>&#39;&quot;,&quot;text&quot;: &quot;&#39;</span><span class=s2>&quot;</span><span class=nv>$*</span><span class=s2>&quot;</span><span class=s1>&#39;&quot;},&quot;at&quot;: {&quot;isAtAll&quot;: true}}&#39;</span><span class=k>)</span>
<a id=__codelineno-58-8 name=__codelineno-58-8 href=#__codelineno-58-8></a><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=k>$(</span><span class=nb>echo</span><span class=w> </span><span class=nv>$send_result</span><span class=w> </span><span class=p>|</span><span class=w> </span>jq<span class=w> </span>-r<span class=w> </span><span class=s1>&#39;.errcode&#39;</span><span class=k>)</span><span class=w> </span>-eq<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-58-9 name=__codelineno-58-9 href=#__codelineno-58-9></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;发送成功:  \n&quot;</span><span class=w> </span><span class=nv>$*</span><span class=s2>&quot; &quot;</span>
<a id=__codelineno-58-10 name=__codelineno-58-10 href=#__codelineno-58-10></a><span class=w>  </span><span class=k>else</span>
<a id=__codelineno-58-11 name=__codelineno-58-11 href=#__codelineno-58-11></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;发送失败:  \n&quot;</span><span class=w> </span><span class=nv>$*</span><span class=s2>&quot;\n&quot;</span>
<a id=__codelineno-58-12 name=__codelineno-58-12 href=#__codelineno-58-12></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=nv>$send_result</span>
<a id=__codelineno-58-13 name=__codelineno-58-13 href=#__codelineno-58-13></a><span class=w>  </span><span class=k>fi</span>
<a id=__codelineno-58-14 name=__codelineno-58-14 href=#__codelineno-58-14></a><span class=o>}</span>
<a id=__codelineno-58-15 name=__codelineno-58-15 href=#__codelineno-58-15></a>
<a id=__codelineno-58-16 name=__codelineno-58-16 href=#__codelineno-58-16></a>sendDingDing<span class=w>  </span><span class=s2>&quot;</span><span class=k>$(</span>date<span class=w> </span>+<span class=s2>&quot;%F %H:%M:%S&quot;</span><span class=k>)</span><span class=s2> 需要告警的消息&quot;</span>
</code></pre></div> <h2 id=37function函数库>37.function函数库<a class=headerlink href=#37function函数库 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-59-1 name=__codelineno-59-1 href=#__codelineno-59-1></a><span class=ch>#!/usr/bin/env bash</span>
<a id=__codelineno-59-2 name=__codelineno-59-2 href=#__codelineno-59-2></a><span class=c1># -*-Shell-script-*-</span>
<a id=__codelineno-59-3 name=__codelineno-59-3 href=#__codelineno-59-3></a><span class=c1>#</span>
<a id=__codelineno-59-4 name=__codelineno-59-4 href=#__codelineno-59-4></a><span class=c1># functions This file contains functions to be used by most or all</span>
<a id=__codelineno-59-5 name=__codelineno-59-5 href=#__codelineno-59-5></a><span class=c1>#       shell scripts in the /etc/init.d directory.</span>
<a id=__codelineno-59-6 name=__codelineno-59-6 href=#__codelineno-59-6></a><span class=c1>#</span>
<a id=__codelineno-59-7 name=__codelineno-59-7 href=#__codelineno-59-7></a>
<a id=__codelineno-59-8 name=__codelineno-59-8 href=#__codelineno-59-8></a>:<span class=s>&lt;&lt;EOF</span>
<a id=__codelineno-59-9 name=__codelineno-59-9 href=#__codelineno-59-9></a>
<a id=__codelineno-59-10 name=__codelineno-59-10 href=#__codelineno-59-10></a><span class=s>checkpid():检查是否已存在pid，如果有一个存在，返回0（通过查看/proc目录）</span>
<a id=__codelineno-59-11 name=__codelineno-59-11 href=#__codelineno-59-11></a>
<a id=__codelineno-59-12 name=__codelineno-59-12 href=#__codelineno-59-12></a><span class=s>daemon():启动某个服务。/etc/init.d目录部分脚本的start使用到这个</span>
<a id=__codelineno-59-13 name=__codelineno-59-13 href=#__codelineno-59-13></a>
<a id=__codelineno-59-14 name=__codelineno-59-14 href=#__codelineno-59-14></a><span class=s>killproc():杀死某个进程。/etc/init.d目录部分脚本的stop使用到这个</span>
<a id=__codelineno-59-15 name=__codelineno-59-15 href=#__codelineno-59-15></a>
<a id=__codelineno-59-16 name=__codelineno-59-16 href=#__codelineno-59-16></a><span class=s>pidfileofproc():寻找某个进程的pid</span>
<a id=__codelineno-59-17 name=__codelineno-59-17 href=#__codelineno-59-17></a>
<a id=__codelineno-59-18 name=__codelineno-59-18 href=#__codelineno-59-18></a><span class=s>pidofproc():类似上面的，只是还查找了pidof命令</span>
<a id=__codelineno-59-19 name=__codelineno-59-19 href=#__codelineno-59-19></a>
<a id=__codelineno-59-20 name=__codelineno-59-20 href=#__codelineno-59-20></a><span class=s>status():返回一个服务的状态</span>
<a id=__codelineno-59-21 name=__codelineno-59-21 href=#__codelineno-59-21></a>
<a id=__codelineno-59-22 name=__codelineno-59-22 href=#__codelineno-59-22></a><span class=s>echo_success():打印OK</span>
<a id=__codelineno-59-23 name=__codelineno-59-23 href=#__codelineno-59-23></a>
<a id=__codelineno-59-24 name=__codelineno-59-24 href=#__codelineno-59-24></a><span class=s>echo_failure():打印FAILED</span>
<a id=__codelineno-59-25 name=__codelineno-59-25 href=#__codelineno-59-25></a>
<a id=__codelineno-59-26 name=__codelineno-59-26 href=#__codelineno-59-26></a><span class=s>echo_passed():打印PASSED</span>
<a id=__codelineno-59-27 name=__codelineno-59-27 href=#__codelineno-59-27></a>
<a id=__codelineno-59-28 name=__codelineno-59-28 href=#__codelineno-59-28></a><span class=s>echo_warning():打印WARNING</span>
<a id=__codelineno-59-29 name=__codelineno-59-29 href=#__codelineno-59-29></a>
<a id=__codelineno-59-30 name=__codelineno-59-30 href=#__codelineno-59-30></a><span class=s>success():打印OK并记录日志</span>
<a id=__codelineno-59-31 name=__codelineno-59-31 href=#__codelineno-59-31></a>
<a id=__codelineno-59-32 name=__codelineno-59-32 href=#__codelineno-59-32></a><span class=s>failure():打印FAILED并记录日志</span>
<a id=__codelineno-59-33 name=__codelineno-59-33 href=#__codelineno-59-33></a>
<a id=__codelineno-59-34 name=__codelineno-59-34 href=#__codelineno-59-34></a><span class=s>passed():打印PASSED并记录日志</span>
<a id=__codelineno-59-35 name=__codelineno-59-35 href=#__codelineno-59-35></a>
<a id=__codelineno-59-36 name=__codelineno-59-36 href=#__codelineno-59-36></a><span class=s>action():打印某个信息并执行给定的命令，它会根据命令执行的结果来调用 success,failure方法</span>
<a id=__codelineno-59-37 name=__codelineno-59-37 href=#__codelineno-59-37></a>
<a id=__codelineno-59-38 name=__codelineno-59-38 href=#__codelineno-59-38></a><span class=s>strstr():判断$1是否含有$2</span>
<a id=__codelineno-59-39 name=__codelineno-59-39 href=#__codelineno-59-39></a>
<a id=__codelineno-59-40 name=__codelineno-59-40 href=#__codelineno-59-40></a><span class=s>confirm():提示是否启动某个服务</span>
<a id=__codelineno-59-41 name=__codelineno-59-41 href=#__codelineno-59-41></a>
<a id=__codelineno-59-42 name=__codelineno-59-42 href=#__codelineno-59-42></a><span class=s>is_ignored_file():检查$1文件是否是*.bak、*.orig、*.rpmnew....等文件</span>
<a id=__codelineno-59-43 name=__codelineno-59-43 href=#__codelineno-59-43></a>
<a id=__codelineno-59-44 name=__codelineno-59-44 href=#__codelineno-59-44></a><span class=s>is_true()/is_false():交互式yes|no的选项</span>
<a id=__codelineno-59-45 name=__codelineno-59-45 href=#__codelineno-59-45></a>
<a id=__codelineno-59-46 name=__codelineno-59-46 href=#__codelineno-59-46></a><span class=s>apply_sysctl()应用sysctl设置，包括/etc/sysctl.d中的文件</span>
<a id=__codelineno-59-47 name=__codelineno-59-47 href=#__codelineno-59-47></a>
<a id=__codelineno-59-48 name=__codelineno-59-48 href=#__codelineno-59-48></a><span class=s>EOF</span>
<a id=__codelineno-59-49 name=__codelineno-59-49 href=#__codelineno-59-49></a>
<a id=__codelineno-59-50 name=__codelineno-59-50 href=#__codelineno-59-50></a>
<a id=__codelineno-59-51 name=__codelineno-59-51 href=#__codelineno-59-51></a><span class=nv>TEXTDOMAIN</span><span class=o>=</span>initscripts
<a id=__codelineno-59-52 name=__codelineno-59-52 href=#__codelineno-59-52></a>
<a id=__codelineno-59-53 name=__codelineno-59-53 href=#__codelineno-59-53></a><span class=c1># Make sure umask is sane</span>
<a id=__codelineno-59-54 name=__codelineno-59-54 href=#__codelineno-59-54></a><span class=nb>umask</span><span class=w> </span><span class=m>022</span>
<a id=__codelineno-59-55 name=__codelineno-59-55 href=#__codelineno-59-55></a>
<a id=__codelineno-59-56 name=__codelineno-59-56 href=#__codelineno-59-56></a><span class=c1># Set up a default search path.</span>
<a id=__codelineno-59-57 name=__codelineno-59-57 href=#__codelineno-59-57></a><span class=nv>PATH</span><span class=o>=</span><span class=s2>&quot;/sbin:/usr/sbin:/bin:/usr/bin&quot;</span>
<a id=__codelineno-59-58 name=__codelineno-59-58 href=#__codelineno-59-58></a>
<a id=__codelineno-59-59 name=__codelineno-59-59 href=#__codelineno-59-59></a><span class=c1>#导出环境变量</span>
<a id=__codelineno-59-60 name=__codelineno-59-60 href=#__codelineno-59-60></a><span class=nb>export</span><span class=w> </span>PATH
<a id=__codelineno-59-61 name=__codelineno-59-61 href=#__codelineno-59-61></a>
<a id=__codelineno-59-62 name=__codelineno-59-62 href=#__codelineno-59-62></a>
<a id=__codelineno-59-63 name=__codelineno-59-63 href=#__codelineno-59-63></a><span class=c1>#判断PPID和字符串否为空</span>
<a id=__codelineno-59-64 name=__codelineno-59-64 href=#__codelineno-59-64></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=nv>$PPID</span><span class=w> </span>-ne<span class=w> </span><span class=m>1</span><span class=w> </span>-a<span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=nv>$SYSTEMCTL_SKIP_REDIRECT</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-59-65 name=__codelineno-59-65 href=#__codelineno-59-65></a><span class=w>        </span><span class=o>[</span><span class=w> </span>-d<span class=w> </span>/run/systemd/system<span class=w> </span><span class=o>]</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-59-66 name=__codelineno-59-66 href=#__codelineno-59-66></a><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$0</span><span class=s2>&quot;</span><span class=w> </span><span class=k>in</span>
<a id=__codelineno-59-67 name=__codelineno-59-67 href=#__codelineno-59-67></a><span class=w>    </span>/etc/init.d/*<span class=p>|</span>/etc/rc.d/init.d/*<span class=o>)</span>
<a id=__codelineno-59-68 name=__codelineno-59-68 href=#__codelineno-59-68></a><span class=w>        </span><span class=nv>_use_systemctl</span><span class=o>=</span><span class=m>1</span>
<a id=__codelineno-59-69 name=__codelineno-59-69 href=#__codelineno-59-69></a><span class=w>        </span><span class=p>;;</span>
<a id=__codelineno-59-70 name=__codelineno-59-70 href=#__codelineno-59-70></a><span class=w>    </span><span class=k>esac</span>
<a id=__codelineno-59-71 name=__codelineno-59-71 href=#__codelineno-59-71></a><span class=k>fi</span>
<a id=__codelineno-59-72 name=__codelineno-59-72 href=#__codelineno-59-72></a>
<a id=__codelineno-59-73 name=__codelineno-59-73 href=#__codelineno-59-73></a>systemctl_redirect<span class=w> </span><span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-59-74 name=__codelineno-59-74 href=#__codelineno-59-74></a><span class=w>    </span><span class=nb>local</span><span class=w> </span>s
<a id=__codelineno-59-75 name=__codelineno-59-75 href=#__codelineno-59-75></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>prog</span><span class=o>=</span><span class=si>${</span><span class=nv>1</span><span class=p>##*/</span><span class=si>}</span>
<a id=__codelineno-59-76 name=__codelineno-59-76 href=#__codelineno-59-76></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>command</span><span class=o>=</span><span class=nv>$2</span>
<a id=__codelineno-59-77 name=__codelineno-59-77 href=#__codelineno-59-77></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>options</span><span class=o>=</span><span class=s2>&quot;&quot;</span>
<a id=__codelineno-59-78 name=__codelineno-59-78 href=#__codelineno-59-78></a>
<a id=__codelineno-59-79 name=__codelineno-59-79 href=#__codelineno-59-79></a><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$command</span><span class=s2>&quot;</span><span class=w> </span><span class=k>in</span>
<a id=__codelineno-59-80 name=__codelineno-59-80 href=#__codelineno-59-80></a><span class=w>    </span>start<span class=o>)</span>
<a id=__codelineno-59-81 name=__codelineno-59-81 href=#__codelineno-59-81></a><span class=w>        </span><span class=nv>s</span><span class=o>=</span>$<span class=s2>&quot;Starting </span><span class=nv>$prog</span><span class=s2> (via systemctl): &quot;</span>
<a id=__codelineno-59-82 name=__codelineno-59-82 href=#__codelineno-59-82></a><span class=w>        </span><span class=p>;;</span>
<a id=__codelineno-59-83 name=__codelineno-59-83 href=#__codelineno-59-83></a><span class=w>    </span>stop<span class=o>)</span>
<a id=__codelineno-59-84 name=__codelineno-59-84 href=#__codelineno-59-84></a><span class=w>        </span><span class=nv>s</span><span class=o>=</span>$<span class=s2>&quot;Stopping </span><span class=nv>$prog</span><span class=s2> (via systemctl): &quot;</span>
<a id=__codelineno-59-85 name=__codelineno-59-85 href=#__codelineno-59-85></a><span class=w>        </span><span class=p>;;</span>
<a id=__codelineno-59-86 name=__codelineno-59-86 href=#__codelineno-59-86></a><span class=w>    </span>reload<span class=p>|</span>try-reload<span class=o>)</span>
<a id=__codelineno-59-87 name=__codelineno-59-87 href=#__codelineno-59-87></a><span class=w>        </span><span class=nv>s</span><span class=o>=</span>$<span class=s2>&quot;Reloading </span><span class=nv>$prog</span><span class=s2> configuration (via systemctl): &quot;</span>
<a id=__codelineno-59-88 name=__codelineno-59-88 href=#__codelineno-59-88></a><span class=w>        </span><span class=p>;;</span>
<a id=__codelineno-59-89 name=__codelineno-59-89 href=#__codelineno-59-89></a><span class=w>    </span>restart<span class=p>|</span>try-restart<span class=p>|</span>condrestart<span class=o>)</span>
<a id=__codelineno-59-90 name=__codelineno-59-90 href=#__codelineno-59-90></a><span class=w>        </span><span class=nv>s</span><span class=o>=</span>$<span class=s2>&quot;Restarting </span><span class=nv>$prog</span><span class=s2> (via systemctl): &quot;</span>
<a id=__codelineno-59-91 name=__codelineno-59-91 href=#__codelineno-59-91></a><span class=w>        </span><span class=p>;;</span>
<a id=__codelineno-59-92 name=__codelineno-59-92 href=#__codelineno-59-92></a><span class=w>    </span><span class=k>esac</span>
<a id=__codelineno-59-93 name=__codelineno-59-93 href=#__codelineno-59-93></a>
<a id=__codelineno-59-94 name=__codelineno-59-94 href=#__codelineno-59-94></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=nv>$SYSTEMCTL_IGNORE_DEPENDENCIES</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-59-95 name=__codelineno-59-95 href=#__codelineno-59-95></a><span class=w>        </span><span class=nv>options</span><span class=o>=</span><span class=s2>&quot;--ignore-dependencies&quot;</span>
<a id=__codelineno-59-96 name=__codelineno-59-96 href=#__codelineno-59-96></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-59-97 name=__codelineno-59-97 href=#__codelineno-59-97></a>
<a id=__codelineno-59-98 name=__codelineno-59-98 href=#__codelineno-59-98></a><span class=w>    </span><span class=k>if</span><span class=w> </span>!<span class=w> </span>systemctl<span class=w> </span>show<span class=w> </span><span class=s2>&quot;</span><span class=nv>$prog</span><span class=s2>.service&quot;</span><span class=w> </span>&gt;<span class=w> </span>/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-59-99 name=__codelineno-59-99 href=#__codelineno-59-99></a><span class=w>            </span>systemctl<span class=w> </span>show<span class=w> </span>-p<span class=w> </span>LoadState<span class=w> </span><span class=s2>&quot;</span><span class=nv>$prog</span><span class=s2>.service&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>-q<span class=w> </span><span class=s1>&#39;not-found&#39;</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-59-100 name=__codelineno-59-100 href=#__codelineno-59-100></a><span class=w>        </span>action<span class=w> </span><span class=s2>$&quot;Reloading systemd: &quot;</span><span class=w> </span>/bin/systemctl<span class=w> </span>daemon-reload
<a id=__codelineno-59-101 name=__codelineno-59-101 href=#__codelineno-59-101></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-59-102 name=__codelineno-59-102 href=#__codelineno-59-102></a>
<a id=__codelineno-59-103 name=__codelineno-59-103 href=#__codelineno-59-103></a><span class=w>    </span>action<span class=w> </span><span class=s2>&quot;</span><span class=nv>$s</span><span class=s2>&quot;</span><span class=w> </span>/bin/systemctl<span class=w> </span><span class=nv>$options</span><span class=w> </span><span class=nv>$command</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$prog</span><span class=s2>.service&quot;</span>
<a id=__codelineno-59-104 name=__codelineno-59-104 href=#__codelineno-59-104></a><span class=o>}</span>
<a id=__codelineno-59-105 name=__codelineno-59-105 href=#__codelineno-59-105></a>
<a id=__codelineno-59-106 name=__codelineno-59-106 href=#__codelineno-59-106></a><span class=c1># Get a sane screen width</span>
<a id=__codelineno-59-107 name=__codelineno-59-107 href=#__codelineno-59-107></a><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>COLUMNS</span><span class=k>:-</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nv>COLUMNS</span><span class=o>=</span><span class=m>80</span>
<a id=__codelineno-59-108 name=__codelineno-59-108 href=#__codelineno-59-108></a>
<a id=__codelineno-59-109 name=__codelineno-59-109 href=#__codelineno-59-109></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>CONSOLETYPE</span><span class=k>:-</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-59-110 name=__codelineno-59-110 href=#__codelineno-59-110></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-c<span class=w> </span><span class=s2>&quot;/dev/stderr&quot;</span><span class=w> </span>-a<span class=w> </span>-r<span class=w> </span><span class=s2>&quot;/dev/stderr&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-59-111 name=__codelineno-59-111 href=#__codelineno-59-111></a><span class=w>        </span><span class=nv>CONSOLETYPE</span><span class=o>=</span><span class=s2>&quot;</span><span class=k>$(</span>/sbin/consoletype<span class=w> </span>&lt;<span class=w> </span>/dev/stderr<span class=w> </span><span class=m>2</span>&gt;/dev/null<span class=k>)</span><span class=s2>&quot;</span>
<a id=__codelineno-59-112 name=__codelineno-59-112 href=#__codelineno-59-112></a><span class=w>    </span><span class=k>else</span>
<a id=__codelineno-59-113 name=__codelineno-59-113 href=#__codelineno-59-113></a><span class=w>        </span><span class=nv>CONSOLETYPE</span><span class=o>=</span><span class=s2>&quot;serial&quot;</span>
<a id=__codelineno-59-114 name=__codelineno-59-114 href=#__codelineno-59-114></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-59-115 name=__codelineno-59-115 href=#__codelineno-59-115></a><span class=k>fi</span>
<a id=__codelineno-59-116 name=__codelineno-59-116 href=#__codelineno-59-116></a>
<a id=__codelineno-59-117 name=__codelineno-59-117 href=#__codelineno-59-117></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>NOLOCALE</span><span class=k>:-</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>LANGSH_SOURCED</span><span class=k>:-</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-59-118 name=__codelineno-59-118 href=#__codelineno-59-118></a><span class=w>        </span><span class=o>[</span><span class=w> </span>-f<span class=w> </span>/etc/sysconfig/i18n<span class=w> </span>-o<span class=w> </span>-f<span class=w> </span>/etc/locale.conf<span class=w> </span><span class=o>]</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-59-119 name=__codelineno-59-119 href=#__codelineno-59-119></a><span class=w>    </span>.<span class=w> </span>/etc/profile.d/lang.sh<span class=w> </span><span class=m>2</span>&gt;/dev/null
<a id=__codelineno-59-120 name=__codelineno-59-120 href=#__codelineno-59-120></a><span class=w>    </span><span class=c1># avoid propagating LANGSH_SOURCED any further</span>
<a id=__codelineno-59-121 name=__codelineno-59-121 href=#__codelineno-59-121></a><span class=w>    </span><span class=nb>unset</span><span class=w> </span>LANGSH_SOURCED
<a id=__codelineno-59-122 name=__codelineno-59-122 href=#__codelineno-59-122></a><span class=k>fi</span>
<a id=__codelineno-59-123 name=__codelineno-59-123 href=#__codelineno-59-123></a>
<a id=__codelineno-59-124 name=__codelineno-59-124 href=#__codelineno-59-124></a><span class=c1># Read in our configuration</span>
<a id=__codelineno-59-125 name=__codelineno-59-125 href=#__codelineno-59-125></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>BOOTUP</span><span class=k>:-</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-59-126 name=__codelineno-59-126 href=#__codelineno-59-126></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-f<span class=w> </span>/etc/sysconfig/init<span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-59-127 name=__codelineno-59-127 href=#__codelineno-59-127></a><span class=w>        </span>.<span class=w> </span>/etc/sysconfig/init
<a id=__codelineno-59-128 name=__codelineno-59-128 href=#__codelineno-59-128></a><span class=w>    </span><span class=k>else</span>
<a id=__codelineno-59-129 name=__codelineno-59-129 href=#__codelineno-59-129></a><span class=w>        </span><span class=c1># This all seem confusing? Look in /etc/sysconfig/init,</span>
<a id=__codelineno-59-130 name=__codelineno-59-130 href=#__codelineno-59-130></a><span class=w>        </span><span class=c1># or in /usr/share/doc/initscripts-*/sysconfig.txt</span>
<a id=__codelineno-59-131 name=__codelineno-59-131 href=#__codelineno-59-131></a><span class=w>        </span><span class=nv>BOOTUP</span><span class=o>=</span>color
<a id=__codelineno-59-132 name=__codelineno-59-132 href=#__codelineno-59-132></a><span class=w>        </span><span class=nv>RES_COL</span><span class=o>=</span><span class=m>60</span>
<a id=__codelineno-59-133 name=__codelineno-59-133 href=#__codelineno-59-133></a><span class=w>        </span><span class=nv>MOVE_TO_COL</span><span class=o>=</span><span class=s2>&quot;echo -en \\033[</span><span class=si>${</span><span class=nv>RES_COL</span><span class=si>}</span><span class=s2>G&quot;</span>
<a id=__codelineno-59-134 name=__codelineno-59-134 href=#__codelineno-59-134></a><span class=w>        </span><span class=nv>SETCOLOR_SUCCESS</span><span class=o>=</span><span class=s2>&quot;echo -en \\033[1;32m&quot;</span>
<a id=__codelineno-59-135 name=__codelineno-59-135 href=#__codelineno-59-135></a><span class=w>        </span><span class=nv>SETCOLOR_FAILURE</span><span class=o>=</span><span class=s2>&quot;echo -en \\033[1;31m&quot;</span>
<a id=__codelineno-59-136 name=__codelineno-59-136 href=#__codelineno-59-136></a><span class=w>        </span><span class=nv>SETCOLOR_WARNING</span><span class=o>=</span><span class=s2>&quot;echo -en \\033[1;33m&quot;</span>
<a id=__codelineno-59-137 name=__codelineno-59-137 href=#__codelineno-59-137></a><span class=w>        </span><span class=nv>SETCOLOR_NORMAL</span><span class=o>=</span><span class=s2>&quot;echo -en \\033[0;39m&quot;</span>
<a id=__codelineno-59-138 name=__codelineno-59-138 href=#__codelineno-59-138></a><span class=w>        </span><span class=nv>LOGLEVEL</span><span class=o>=</span><span class=m>1</span>
<a id=__codelineno-59-139 name=__codelineno-59-139 href=#__codelineno-59-139></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-59-140 name=__codelineno-59-140 href=#__codelineno-59-140></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$CONSOLETYPE</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;serial&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-59-141 name=__codelineno-59-141 href=#__codelineno-59-141></a><span class=w>        </span><span class=nv>BOOTUP</span><span class=o>=</span>serial
<a id=__codelineno-59-142 name=__codelineno-59-142 href=#__codelineno-59-142></a><span class=w>        </span><span class=nv>MOVE_TO_COL</span><span class=o>=</span>
<a id=__codelineno-59-143 name=__codelineno-59-143 href=#__codelineno-59-143></a><span class=w>        </span><span class=nv>SETCOLOR_SUCCESS</span><span class=o>=</span>
<a id=__codelineno-59-144 name=__codelineno-59-144 href=#__codelineno-59-144></a><span class=w>        </span><span class=nv>SETCOLOR_FAILURE</span><span class=o>=</span>
<a id=__codelineno-59-145 name=__codelineno-59-145 href=#__codelineno-59-145></a><span class=w>        </span><span class=nv>SETCOLOR_WARNING</span><span class=o>=</span>
<a id=__codelineno-59-146 name=__codelineno-59-146 href=#__codelineno-59-146></a><span class=w>        </span><span class=nv>SETCOLOR_NORMAL</span><span class=o>=</span>
<a id=__codelineno-59-147 name=__codelineno-59-147 href=#__codelineno-59-147></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-59-148 name=__codelineno-59-148 href=#__codelineno-59-148></a><span class=k>fi</span>
<a id=__codelineno-59-149 name=__codelineno-59-149 href=#__codelineno-59-149></a>
<a id=__codelineno-59-150 name=__codelineno-59-150 href=#__codelineno-59-150></a><span class=c1># Check if any of $pid (could be plural) are running</span>
<a id=__codelineno-59-151 name=__codelineno-59-151 href=#__codelineno-59-151></a>checkpid<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-59-152 name=__codelineno-59-152 href=#__codelineno-59-152></a><span class=w>    </span><span class=nb>local</span><span class=w> </span>i
<a id=__codelineno-59-153 name=__codelineno-59-153 href=#__codelineno-59-153></a>
<a id=__codelineno-59-154 name=__codelineno-59-154 href=#__codelineno-59-154></a><span class=w>    </span><span class=k>for</span><span class=w> </span>i<span class=w> </span><span class=k>in</span><span class=w> </span><span class=nv>$*</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>do</span>
<a id=__codelineno-59-155 name=__codelineno-59-155 href=#__codelineno-59-155></a><span class=w>        </span><span class=o>[</span><span class=w> </span>-d<span class=w> </span><span class=s2>&quot;/proc/</span><span class=nv>$i</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-59-156 name=__codelineno-59-156 href=#__codelineno-59-156></a><span class=w>    </span><span class=k>done</span>
<a id=__codelineno-59-157 name=__codelineno-59-157 href=#__codelineno-59-157></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-59-158 name=__codelineno-59-158 href=#__codelineno-59-158></a><span class=o>}</span>
<a id=__codelineno-59-159 name=__codelineno-59-159 href=#__codelineno-59-159></a>
<a id=__codelineno-59-160 name=__codelineno-59-160 href=#__codelineno-59-160></a>__kill_pids_term_kill_checkpids<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-59-161 name=__codelineno-59-161 href=#__codelineno-59-161></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>base_stime</span><span class=o>=</span><span class=nv>$1</span>
<a id=__codelineno-59-162 name=__codelineno-59-162 href=#__codelineno-59-162></a><span class=w>    </span><span class=nb>shift</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-59-163 name=__codelineno-59-163 href=#__codelineno-59-163></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>pid</span><span class=o>=</span>
<a id=__codelineno-59-164 name=__codelineno-59-164 href=#__codelineno-59-164></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>pids</span><span class=o>=</span><span class=nv>$*</span>
<a id=__codelineno-59-165 name=__codelineno-59-165 href=#__codelineno-59-165></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>remaining</span><span class=o>=</span>
<a id=__codelineno-59-166 name=__codelineno-59-166 href=#__codelineno-59-166></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>stat</span><span class=o>=</span>
<a id=__codelineno-59-167 name=__codelineno-59-167 href=#__codelineno-59-167></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>stime</span><span class=o>=</span>
<a id=__codelineno-59-168 name=__codelineno-59-168 href=#__codelineno-59-168></a>
<a id=__codelineno-59-169 name=__codelineno-59-169 href=#__codelineno-59-169></a><span class=w>    </span><span class=k>for</span><span class=w> </span>pid<span class=w> </span><span class=k>in</span><span class=w> </span><span class=nv>$pids</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>do</span>
<a id=__codelineno-59-170 name=__codelineno-59-170 href=#__codelineno-59-170></a><span class=w>        </span><span class=o>[</span><span class=w> </span>!<span class=w> </span>-e<span class=w>  </span><span class=s2>&quot;/proc/</span><span class=nv>$pid</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>continue</span>
<a id=__codelineno-59-171 name=__codelineno-59-171 href=#__codelineno-59-171></a><span class=w>        </span><span class=nb>read</span><span class=w> </span>-r<span class=w> </span>line<span class=w> </span>&lt;<span class=w> </span><span class=s2>&quot;/proc/</span><span class=nv>$pid</span><span class=s2>/stat&quot;</span><span class=w> </span><span class=m>2</span>&gt;<span class=w> </span>/dev/null
<a id=__codelineno-59-172 name=__codelineno-59-172 href=#__codelineno-59-172></a>
<a id=__codelineno-59-173 name=__codelineno-59-173 href=#__codelineno-59-173></a><span class=w>        </span><span class=nv>stat</span><span class=o>=(</span><span class=nv>$line</span><span class=o>)</span>
<a id=__codelineno-59-174 name=__codelineno-59-174 href=#__codelineno-59-174></a><span class=w>        </span><span class=nv>stime</span><span class=o>=</span><span class=si>${</span><span class=nv>stat</span><span class=p>[21]</span><span class=si>}</span>
<a id=__codelineno-59-175 name=__codelineno-59-175 href=#__codelineno-59-175></a>
<a id=__codelineno-59-176 name=__codelineno-59-176 href=#__codelineno-59-176></a><span class=w>        </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=nv>$stime</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$base_stime</span><span class=s2>&quot;</span><span class=w> </span>-lt<span class=w> </span><span class=s2>&quot;</span><span class=nv>$stime</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>continue</span>
<a id=__codelineno-59-177 name=__codelineno-59-177 href=#__codelineno-59-177></a><span class=w>        </span><span class=nv>remaining</span><span class=o>+=</span><span class=s2>&quot;</span><span class=nv>$pid</span><span class=s2> &quot;</span>
<a id=__codelineno-59-178 name=__codelineno-59-178 href=#__codelineno-59-178></a><span class=w>    </span><span class=k>done</span>
<a id=__codelineno-59-179 name=__codelineno-59-179 href=#__codelineno-59-179></a>
<a id=__codelineno-59-180 name=__codelineno-59-180 href=#__codelineno-59-180></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$remaining</span><span class=s2>&quot;</span>
<a id=__codelineno-59-181 name=__codelineno-59-181 href=#__codelineno-59-181></a><span class=w>    </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=nv>$remaining</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-59-182 name=__codelineno-59-182 href=#__codelineno-59-182></a>
<a id=__codelineno-59-183 name=__codelineno-59-183 href=#__codelineno-59-183></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-59-184 name=__codelineno-59-184 href=#__codelineno-59-184></a><span class=o>}</span>
<a id=__codelineno-59-185 name=__codelineno-59-185 href=#__codelineno-59-185></a>
<a id=__codelineno-59-186 name=__codelineno-59-186 href=#__codelineno-59-186></a>__kill_pids_term_kill<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-59-187 name=__codelineno-59-187 href=#__codelineno-59-187></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>try</span><span class=o>=</span><span class=m>0</span>
<a id=__codelineno-59-188 name=__codelineno-59-188 href=#__codelineno-59-188></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>delay</span><span class=o>=</span><span class=m>3</span><span class=p>;</span>
<a id=__codelineno-59-189 name=__codelineno-59-189 href=#__codelineno-59-189></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>pid</span><span class=o>=</span>
<a id=__codelineno-59-190 name=__codelineno-59-190 href=#__codelineno-59-190></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>stat</span><span class=o>=(</span><span class=k>$(</span>&lt;<span class=w> </span>/proc/self/stat<span class=k>)</span><span class=o>)</span>
<a id=__codelineno-59-191 name=__codelineno-59-191 href=#__codelineno-59-191></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>base_stime</span><span class=o>=</span><span class=si>${</span><span class=nv>stat</span><span class=p>[21]</span><span class=si>}</span>
<a id=__codelineno-59-192 name=__codelineno-59-192 href=#__codelineno-59-192></a>
<a id=__codelineno-59-193 name=__codelineno-59-193 href=#__codelineno-59-193></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;-d&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-59-194 name=__codelineno-59-194 href=#__codelineno-59-194></a><span class=w>        </span><span class=nv>delay</span><span class=o>=</span><span class=nv>$2</span>
<a id=__codelineno-59-195 name=__codelineno-59-195 href=#__codelineno-59-195></a><span class=w>        </span><span class=nb>shift</span><span class=w> </span><span class=m>2</span>
<a id=__codelineno-59-196 name=__codelineno-59-196 href=#__codelineno-59-196></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-59-197 name=__codelineno-59-197 href=#__codelineno-59-197></a>
<a id=__codelineno-59-198 name=__codelineno-59-198 href=#__codelineno-59-198></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>kill_list</span><span class=o>=</span><span class=nv>$*</span>
<a id=__codelineno-59-199 name=__codelineno-59-199 href=#__codelineno-59-199></a>
<a id=__codelineno-59-200 name=__codelineno-59-200 href=#__codelineno-59-200></a><span class=w>    </span><span class=nv>kill_list</span><span class=o>=</span><span class=k>$(</span>__kill_pids_term_kill_checkpids<span class=w> </span><span class=nv>$base_stime</span><span class=w> </span><span class=nv>$kill_list</span><span class=k>)</span>
<a id=__codelineno-59-201 name=__codelineno-59-201 href=#__codelineno-59-201></a>
<a id=__codelineno-59-202 name=__codelineno-59-202 href=#__codelineno-59-202></a><span class=w>    </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=nv>$kill_list</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-59-203 name=__codelineno-59-203 href=#__codelineno-59-203></a>
<a id=__codelineno-59-204 name=__codelineno-59-204 href=#__codelineno-59-204></a><span class=w>    </span><span class=nb>kill</span><span class=w> </span>-TERM<span class=w> </span><span class=nv>$kill_list</span><span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-59-205 name=__codelineno-59-205 href=#__codelineno-59-205></a><span class=w>    </span>usleep<span class=w> </span><span class=m>100000</span>
<a id=__codelineno-59-206 name=__codelineno-59-206 href=#__codelineno-59-206></a>
<a id=__codelineno-59-207 name=__codelineno-59-207 href=#__codelineno-59-207></a><span class=w>    </span><span class=nv>kill_list</span><span class=o>=</span><span class=k>$(</span>__kill_pids_term_kill_checkpids<span class=w> </span><span class=nv>$base_stime</span><span class=w> </span><span class=nv>$kill_list</span><span class=k>)</span>
<a id=__codelineno-59-208 name=__codelineno-59-208 href=#__codelineno-59-208></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=nv>$kill_list</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-59-209 name=__codelineno-59-209 href=#__codelineno-59-209></a><span class=w>        </span><span class=k>while</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=nv>$try</span><span class=w> </span>-lt<span class=w> </span><span class=nv>$delay</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>do</span>
<a id=__codelineno-59-210 name=__codelineno-59-210 href=#__codelineno-59-210></a><span class=w>            </span>sleep<span class=w> </span><span class=m>1</span>
<a id=__codelineno-59-211 name=__codelineno-59-211 href=#__codelineno-59-211></a><span class=w>            </span><span class=nv>kill_list</span><span class=o>=</span><span class=k>$(</span>__kill_pids_term_kill_checkpids<span class=w> </span><span class=nv>$base_stime</span><span class=w> </span><span class=nv>$kill_list</span><span class=k>)</span>
<a id=__codelineno-59-212 name=__codelineno-59-212 href=#__codelineno-59-212></a><span class=w>            </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=nv>$kill_list</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>break</span>
<a id=__codelineno-59-213 name=__codelineno-59-213 href=#__codelineno-59-213></a><span class=w>            </span><span class=nb>let</span><span class=w> </span><span class=nv>try</span><span class=o>+=</span><span class=m>1</span>
<a id=__codelineno-59-214 name=__codelineno-59-214 href=#__codelineno-59-214></a><span class=w>        </span><span class=k>done</span>
<a id=__codelineno-59-215 name=__codelineno-59-215 href=#__codelineno-59-215></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=nv>$kill_list</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-59-216 name=__codelineno-59-216 href=#__codelineno-59-216></a><span class=w>            </span><span class=nb>kill</span><span class=w> </span>-KILL<span class=w> </span><span class=nv>$kill_list</span><span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-59-217 name=__codelineno-59-217 href=#__codelineno-59-217></a><span class=w>            </span>usleep<span class=w> </span><span class=m>100000</span>
<a id=__codelineno-59-218 name=__codelineno-59-218 href=#__codelineno-59-218></a><span class=w>            </span><span class=nv>kill_list</span><span class=o>=</span><span class=k>$(</span>__kill_pids_term_kill_checkpids<span class=w> </span><span class=nv>$base_stime</span><span class=w> </span><span class=nv>$kill_list</span><span class=k>)</span>
<a id=__codelineno-59-219 name=__codelineno-59-219 href=#__codelineno-59-219></a><span class=w>        </span><span class=k>fi</span>
<a id=__codelineno-59-220 name=__codelineno-59-220 href=#__codelineno-59-220></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-59-221 name=__codelineno-59-221 href=#__codelineno-59-221></a>
<a id=__codelineno-59-222 name=__codelineno-59-222 href=#__codelineno-59-222></a><span class=w>    </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=nv>$kill_list</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-59-223 name=__codelineno-59-223 href=#__codelineno-59-223></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-59-224 name=__codelineno-59-224 href=#__codelineno-59-224></a><span class=o>}</span>
<a id=__codelineno-59-225 name=__codelineno-59-225 href=#__codelineno-59-225></a>
<a id=__codelineno-59-226 name=__codelineno-59-226 href=#__codelineno-59-226></a><span class=c1># __proc_pids {program} [pidfile]</span>
<a id=__codelineno-59-227 name=__codelineno-59-227 href=#__codelineno-59-227></a><span class=c1># Set $pid to pids from /var/run* for {program}.  $pid should be declared</span>
<a id=__codelineno-59-228 name=__codelineno-59-228 href=#__codelineno-59-228></a><span class=c1># local in the caller.</span>
<a id=__codelineno-59-229 name=__codelineno-59-229 href=#__codelineno-59-229></a><span class=c1># Returns LSB exit code for the &#39;status&#39; action.</span>
<a id=__codelineno-59-230 name=__codelineno-59-230 href=#__codelineno-59-230></a>__pids_var_run<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-59-231 name=__codelineno-59-231 href=#__codelineno-59-231></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>base</span><span class=o>=</span><span class=si>${</span><span class=nv>1</span><span class=p>##*/</span><span class=si>}</span>
<a id=__codelineno-59-232 name=__codelineno-59-232 href=#__codelineno-59-232></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>pid_file</span><span class=o>=</span><span class=si>${</span><span class=nv>2</span><span class=k>:-</span><span class=p>/var/run/</span><span class=nv>$base</span><span class=p>.pid</span><span class=si>}</span>
<a id=__codelineno-59-233 name=__codelineno-59-233 href=#__codelineno-59-233></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>pid_dir</span><span class=o>=</span><span class=k>$(</span>/usr/bin/dirname<span class=w> </span><span class=nv>$pid_file</span><span class=w> </span>&gt;<span class=w> </span>/dev/null<span class=k>)</span>
<a id=__codelineno-59-234 name=__codelineno-59-234 href=#__codelineno-59-234></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>binary</span><span class=o>=</span><span class=nv>$3</span>
<a id=__codelineno-59-235 name=__codelineno-59-235 href=#__codelineno-59-235></a>
<a id=__codelineno-59-236 name=__codelineno-59-236 href=#__codelineno-59-236></a><span class=w>    </span><span class=o>[</span><span class=w> </span>-d<span class=w> </span><span class=s2>&quot;</span><span class=nv>$pid_dir</span><span class=s2>&quot;</span><span class=w> </span>-a<span class=w> </span>!<span class=w> </span>-r<span class=w> </span><span class=s2>&quot;</span><span class=nv>$pid_dir</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=m>4</span>
<a id=__codelineno-59-237 name=__codelineno-59-237 href=#__codelineno-59-237></a>
<a id=__codelineno-59-238 name=__codelineno-59-238 href=#__codelineno-59-238></a><span class=w>    </span><span class=nv>pid</span><span class=o>=</span>
<a id=__codelineno-59-239 name=__codelineno-59-239 href=#__codelineno-59-239></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-f<span class=w> </span><span class=s2>&quot;</span><span class=nv>$pid_file</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-59-240 name=__codelineno-59-240 href=#__codelineno-59-240></a><span class=w>            </span><span class=nb>local</span><span class=w> </span>line<span class=w> </span>p
<a id=__codelineno-59-241 name=__codelineno-59-241 href=#__codelineno-59-241></a>
<a id=__codelineno-59-242 name=__codelineno-59-242 href=#__codelineno-59-242></a><span class=w>        </span><span class=o>[</span><span class=w> </span>!<span class=w> </span>-r<span class=w> </span><span class=s2>&quot;</span><span class=nv>$pid_file</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=m>4</span><span class=w> </span><span class=c1># &quot;user had insufficient privilege&quot;</span>
<a id=__codelineno-59-243 name=__codelineno-59-243 href=#__codelineno-59-243></a><span class=w>        </span><span class=k>while</span><span class=w> </span>:<span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>do</span>
<a id=__codelineno-59-244 name=__codelineno-59-244 href=#__codelineno-59-244></a><span class=w>            </span><span class=nb>read</span><span class=w> </span>line
<a id=__codelineno-59-245 name=__codelineno-59-245 href=#__codelineno-59-245></a><span class=w>            </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=nv>$line</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>break</span>
<a id=__codelineno-59-246 name=__codelineno-59-246 href=#__codelineno-59-246></a><span class=w>            </span><span class=k>for</span><span class=w> </span>p<span class=w> </span><span class=k>in</span><span class=w> </span><span class=nv>$line</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>do</span>
<a id=__codelineno-59-247 name=__codelineno-59-247 href=#__codelineno-59-247></a><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>p</span><span class=p>//[0-9]/</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=o>[</span><span class=w> </span>-d<span class=w> </span><span class=s2>&quot;/proc/</span><span class=nv>$p</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-59-248 name=__codelineno-59-248 href=#__codelineno-59-248></a><span class=w>                    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=nv>$binary</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-59-249 name=__codelineno-59-249 href=#__codelineno-59-249></a><span class=w>                        </span><span class=nb>local</span><span class=w> </span><span class=nv>b</span><span class=o>=</span><span class=k>$(</span>readlink<span class=w> </span>/proc/<span class=nv>$p</span>/exe<span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span>-e<span class=w> </span><span class=s1>&#39;s/\s*(deleted)$//&#39;</span><span class=k>)</span>
<a id=__codelineno-59-250 name=__codelineno-59-250 href=#__codelineno-59-250></a><span class=w>                        </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$b</span><span class=s2>&quot;</span><span class=w> </span>!<span class=o>=</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$binary</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>continue</span>
<a id=__codelineno-59-251 name=__codelineno-59-251 href=#__codelineno-59-251></a><span class=w>                    </span><span class=k>fi</span>
<a id=__codelineno-59-252 name=__codelineno-59-252 href=#__codelineno-59-252></a><span class=w>                    </span><span class=nv>pid</span><span class=o>=</span><span class=s2>&quot;</span><span class=nv>$pid</span><span class=s2> </span><span class=nv>$p</span><span class=s2>&quot;</span>
<a id=__codelineno-59-253 name=__codelineno-59-253 href=#__codelineno-59-253></a><span class=w>                </span><span class=k>fi</span>
<a id=__codelineno-59-254 name=__codelineno-59-254 href=#__codelineno-59-254></a><span class=w>            </span><span class=k>done</span>
<a id=__codelineno-59-255 name=__codelineno-59-255 href=#__codelineno-59-255></a><span class=w>        </span><span class=k>done</span><span class=w> </span>&lt;<span class=w> </span><span class=s2>&quot;</span><span class=nv>$pid_file</span><span class=s2>&quot;</span>
<a id=__codelineno-59-256 name=__codelineno-59-256 href=#__codelineno-59-256></a>
<a id=__codelineno-59-257 name=__codelineno-59-257 href=#__codelineno-59-257></a><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=nv>$pid</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-59-258 name=__codelineno-59-258 href=#__codelineno-59-258></a><span class=w>                    </span><span class=k>return</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-59-259 name=__codelineno-59-259 href=#__codelineno-59-259></a><span class=w>            </span><span class=k>fi</span>
<a id=__codelineno-59-260 name=__codelineno-59-260 href=#__codelineno-59-260></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=m>1</span><span class=w> </span><span class=c1># &quot;Program is dead and /var/run pid file exists&quot;</span>
<a id=__codelineno-59-261 name=__codelineno-59-261 href=#__codelineno-59-261></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-59-262 name=__codelineno-59-262 href=#__codelineno-59-262></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=m>3</span><span class=w> </span><span class=c1># &quot;Program is not running&quot;</span>
<a id=__codelineno-59-263 name=__codelineno-59-263 href=#__codelineno-59-263></a><span class=o>}</span>
<a id=__codelineno-59-264 name=__codelineno-59-264 href=#__codelineno-59-264></a>
<a id=__codelineno-59-265 name=__codelineno-59-265 href=#__codelineno-59-265></a><span class=c1># Output PIDs of matching processes, found using pidof</span>
<a id=__codelineno-59-266 name=__codelineno-59-266 href=#__codelineno-59-266></a>__pids_pidof<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-59-267 name=__codelineno-59-267 href=#__codelineno-59-267></a><span class=w>    </span>pidof<span class=w> </span>-c<span class=w> </span>-m<span class=w> </span>-o<span class=w> </span><span class=nv>$$</span><span class=w> </span>-o<span class=w> </span><span class=nv>$PPID</span><span class=w> </span>-o<span class=w> </span>%PPID<span class=w> </span>-x<span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-59-268 name=__codelineno-59-268 href=#__codelineno-59-268></a><span class=w>        </span>pidof<span class=w> </span>-c<span class=w> </span>-m<span class=w> </span>-o<span class=w> </span><span class=nv>$$</span><span class=w> </span>-o<span class=w> </span><span class=nv>$PPID</span><span class=w> </span>-o<span class=w> </span>%PPID<span class=w> </span>-x<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>1</span><span class=p>##*/</span><span class=si>}</span><span class=s2>&quot;</span>
<a id=__codelineno-59-269 name=__codelineno-59-269 href=#__codelineno-59-269></a><span class=o>}</span>
<a id=__codelineno-59-270 name=__codelineno-59-270 href=#__codelineno-59-270></a>
<a id=__codelineno-59-271 name=__codelineno-59-271 href=#__codelineno-59-271></a>
<a id=__codelineno-59-272 name=__codelineno-59-272 href=#__codelineno-59-272></a><span class=c1># A function to start a program.</span>
<a id=__codelineno-59-273 name=__codelineno-59-273 href=#__codelineno-59-273></a>daemon<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-59-274 name=__codelineno-59-274 href=#__codelineno-59-274></a><span class=w>    </span><span class=c1># Test syntax.</span>
<a id=__codelineno-59-275 name=__codelineno-59-275 href=#__codelineno-59-275></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>gotbase</span><span class=o>=</span><span class=w> </span><span class=nv>force</span><span class=o>=</span><span class=w> </span>nicelevel<span class=w> </span>corelimit
<a id=__codelineno-59-276 name=__codelineno-59-276 href=#__codelineno-59-276></a><span class=w>    </span><span class=nb>local</span><span class=w> </span>pid<span class=w> </span><span class=nv>base</span><span class=o>=</span><span class=w> </span><span class=nv>user</span><span class=o>=</span><span class=w> </span><span class=nv>nice</span><span class=o>=</span><span class=w> </span><span class=nv>bg</span><span class=o>=</span><span class=w> </span><span class=nv>pid_file</span><span class=o>=</span>
<a id=__codelineno-59-277 name=__codelineno-59-277 href=#__codelineno-59-277></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>cgroup</span><span class=o>=</span>
<a id=__codelineno-59-278 name=__codelineno-59-278 href=#__codelineno-59-278></a><span class=w>    </span><span class=nv>nicelevel</span><span class=o>=</span><span class=m>0</span>
<a id=__codelineno-59-279 name=__codelineno-59-279 href=#__codelineno-59-279></a><span class=w>    </span><span class=k>while</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span>!<span class=o>=</span><span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>1</span><span class=p>##[-+]</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>do</span>
<a id=__codelineno-59-280 name=__codelineno-59-280 href=#__codelineno-59-280></a><span class=w>        </span><span class=k>case</span><span class=w> </span><span class=nv>$1</span><span class=w> </span><span class=k>in</span>
<a id=__codelineno-59-281 name=__codelineno-59-281 href=#__codelineno-59-281></a><span class=w>        </span><span class=s1>&#39;&#39;</span><span class=o>)</span>
<a id=__codelineno-59-282 name=__codelineno-59-282 href=#__codelineno-59-282></a><span class=w>            </span><span class=nb>echo</span><span class=w> </span>$<span class=s2>&quot;</span><span class=nv>$0</span><span class=s2>: Usage: daemon [+/-nicelevel] {program}&quot;</span><span class=w> </span><span class=s2>&quot;[arg1]...&quot;</span>
<a id=__codelineno-59-283 name=__codelineno-59-283 href=#__codelineno-59-283></a><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-59-284 name=__codelineno-59-284 href=#__codelineno-59-284></a><span class=w>            </span><span class=p>;;</span>
<a id=__codelineno-59-285 name=__codelineno-59-285 href=#__codelineno-59-285></a><span class=w>        </span>--check<span class=o>)</span>
<a id=__codelineno-59-286 name=__codelineno-59-286 href=#__codelineno-59-286></a><span class=w>            </span><span class=nv>base</span><span class=o>=</span><span class=nv>$2</span>
<a id=__codelineno-59-287 name=__codelineno-59-287 href=#__codelineno-59-287></a><span class=w>            </span><span class=nv>gotbase</span><span class=o>=</span><span class=s2>&quot;yes&quot;</span>
<a id=__codelineno-59-288 name=__codelineno-59-288 href=#__codelineno-59-288></a><span class=w>            </span><span class=nb>shift</span><span class=w> </span><span class=m>2</span>
<a id=__codelineno-59-289 name=__codelineno-59-289 href=#__codelineno-59-289></a><span class=w>            </span><span class=p>;;</span>
<a id=__codelineno-59-290 name=__codelineno-59-290 href=#__codelineno-59-290></a><span class=w>        </span>--check<span class=o>=</span>?*<span class=o>)</span>
<a id=__codelineno-59-291 name=__codelineno-59-291 href=#__codelineno-59-291></a><span class=w>            </span><span class=nv>base</span><span class=o>=</span><span class=si>${</span><span class=nv>1</span><span class=p>#--check=</span><span class=si>}</span>
<a id=__codelineno-59-292 name=__codelineno-59-292 href=#__codelineno-59-292></a><span class=w>            </span><span class=nv>gotbase</span><span class=o>=</span><span class=s2>&quot;yes&quot;</span>
<a id=__codelineno-59-293 name=__codelineno-59-293 href=#__codelineno-59-293></a><span class=w>            </span><span class=nb>shift</span>
<a id=__codelineno-59-294 name=__codelineno-59-294 href=#__codelineno-59-294></a><span class=w>            </span><span class=p>;;</span>
<a id=__codelineno-59-295 name=__codelineno-59-295 href=#__codelineno-59-295></a><span class=w>        </span>--user<span class=o>)</span>
<a id=__codelineno-59-296 name=__codelineno-59-296 href=#__codelineno-59-296></a><span class=w>            </span><span class=nv>user</span><span class=o>=</span><span class=nv>$2</span>
<a id=__codelineno-59-297 name=__codelineno-59-297 href=#__codelineno-59-297></a><span class=w>            </span><span class=nb>shift</span><span class=w> </span><span class=m>2</span>
<a id=__codelineno-59-298 name=__codelineno-59-298 href=#__codelineno-59-298></a><span class=w>            </span><span class=p>;;</span>
<a id=__codelineno-59-299 name=__codelineno-59-299 href=#__codelineno-59-299></a><span class=w>        </span>--user<span class=o>=</span>?*<span class=o>)</span>
<a id=__codelineno-59-300 name=__codelineno-59-300 href=#__codelineno-59-300></a><span class=w>            </span><span class=nv>user</span><span class=o>=</span><span class=si>${</span><span class=nv>1</span><span class=p>#--user=</span><span class=si>}</span>
<a id=__codelineno-59-301 name=__codelineno-59-301 href=#__codelineno-59-301></a><span class=w>            </span><span class=nb>shift</span>
<a id=__codelineno-59-302 name=__codelineno-59-302 href=#__codelineno-59-302></a><span class=w>            </span><span class=p>;;</span>
<a id=__codelineno-59-303 name=__codelineno-59-303 href=#__codelineno-59-303></a><span class=w>        </span>--pidfile<span class=o>)</span>
<a id=__codelineno-59-304 name=__codelineno-59-304 href=#__codelineno-59-304></a><span class=w>            </span><span class=nv>pid_file</span><span class=o>=</span><span class=nv>$2</span>
<a id=__codelineno-59-305 name=__codelineno-59-305 href=#__codelineno-59-305></a><span class=w>            </span><span class=nb>shift</span><span class=w> </span><span class=m>2</span>
<a id=__codelineno-59-306 name=__codelineno-59-306 href=#__codelineno-59-306></a><span class=w>            </span><span class=p>;;</span>
<a id=__codelineno-59-307 name=__codelineno-59-307 href=#__codelineno-59-307></a><span class=w>        </span>--pidfile<span class=o>=</span>?*<span class=o>)</span>
<a id=__codelineno-59-308 name=__codelineno-59-308 href=#__codelineno-59-308></a><span class=w>            </span><span class=nv>pid_file</span><span class=o>=</span><span class=si>${</span><span class=nv>1</span><span class=p>#--pidfile=</span><span class=si>}</span>
<a id=__codelineno-59-309 name=__codelineno-59-309 href=#__codelineno-59-309></a><span class=w>            </span><span class=nb>shift</span>
<a id=__codelineno-59-310 name=__codelineno-59-310 href=#__codelineno-59-310></a><span class=w>            </span><span class=p>;;</span>
<a id=__codelineno-59-311 name=__codelineno-59-311 href=#__codelineno-59-311></a><span class=w>        </span>--force<span class=o>)</span>
<a id=__codelineno-59-312 name=__codelineno-59-312 href=#__codelineno-59-312></a><span class=w>            </span><span class=nv>force</span><span class=o>=</span><span class=s2>&quot;force&quot;</span>
<a id=__codelineno-59-313 name=__codelineno-59-313 href=#__codelineno-59-313></a><span class=w>            </span><span class=nb>shift</span>
<a id=__codelineno-59-314 name=__codelineno-59-314 href=#__codelineno-59-314></a><span class=w>            </span><span class=p>;;</span>
<a id=__codelineno-59-315 name=__codelineno-59-315 href=#__codelineno-59-315></a><span class=w>        </span><span class=o>[</span>-+<span class=o>][</span><span class=m>0</span>-9<span class=o>]</span>*<span class=o>)</span>
<a id=__codelineno-59-316 name=__codelineno-59-316 href=#__codelineno-59-316></a><span class=w>            </span><span class=nv>nice</span><span class=o>=</span><span class=s2>&quot;nice -n </span><span class=nv>$1</span><span class=s2>&quot;</span>
<a id=__codelineno-59-317 name=__codelineno-59-317 href=#__codelineno-59-317></a><span class=w>            </span><span class=nb>shift</span>
<a id=__codelineno-59-318 name=__codelineno-59-318 href=#__codelineno-59-318></a><span class=w>            </span><span class=p>;;</span>
<a id=__codelineno-59-319 name=__codelineno-59-319 href=#__codelineno-59-319></a><span class=w>        </span>*<span class=o>)</span>
<a id=__codelineno-59-320 name=__codelineno-59-320 href=#__codelineno-59-320></a><span class=w>            </span><span class=nb>echo</span><span class=w> </span>$<span class=s2>&quot;</span><span class=nv>$0</span><span class=s2>: Usage: daemon [+/-nicelevel] {program}&quot;</span><span class=w> </span><span class=s2>&quot;[arg1]...&quot;</span>
<a id=__codelineno-59-321 name=__codelineno-59-321 href=#__codelineno-59-321></a><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-59-322 name=__codelineno-59-322 href=#__codelineno-59-322></a><span class=w>            </span><span class=p>;;</span>
<a id=__codelineno-59-323 name=__codelineno-59-323 href=#__codelineno-59-323></a><span class=w>      </span><span class=k>esac</span>
<a id=__codelineno-59-324 name=__codelineno-59-324 href=#__codelineno-59-324></a><span class=w>    </span><span class=k>done</span>
<a id=__codelineno-59-325 name=__codelineno-59-325 href=#__codelineno-59-325></a>
<a id=__codelineno-59-326 name=__codelineno-59-326 href=#__codelineno-59-326></a><span class=w>    </span><span class=c1># Save basename.</span>
<a id=__codelineno-59-327 name=__codelineno-59-327 href=#__codelineno-59-327></a><span class=w>    </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=nv>$gotbase</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nv>base</span><span class=o>=</span><span class=si>${</span><span class=nv>1</span><span class=p>##*/</span><span class=si>}</span>
<a id=__codelineno-59-328 name=__codelineno-59-328 href=#__codelineno-59-328></a>
<a id=__codelineno-59-329 name=__codelineno-59-329 href=#__codelineno-59-329></a><span class=w>    </span><span class=c1># See if it&#39;s already running. Look *only* at the pid file.</span>
<a id=__codelineno-59-330 name=__codelineno-59-330 href=#__codelineno-59-330></a><span class=w>    </span>__pids_var_run<span class=w> </span><span class=s2>&quot;</span><span class=nv>$base</span><span class=s2>&quot;</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$pid_file</span><span class=s2>&quot;</span>
<a id=__codelineno-59-331 name=__codelineno-59-331 href=#__codelineno-59-331></a>
<a id=__codelineno-59-332 name=__codelineno-59-332 href=#__codelineno-59-332></a><span class=w>    </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=nv>$pid</span><span class=s2>&quot;</span><span class=w> </span>-a<span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=nv>$force</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>return</span>
<a id=__codelineno-59-333 name=__codelineno-59-333 href=#__codelineno-59-333></a>
<a id=__codelineno-59-334 name=__codelineno-59-334 href=#__codelineno-59-334></a><span class=w>    </span><span class=c1># make sure it doesn&#39;t core dump anywhere unless requested</span>
<a id=__codelineno-59-335 name=__codelineno-59-335 href=#__codelineno-59-335></a><span class=w>    </span><span class=nv>corelimit</span><span class=o>=</span><span class=s2>&quot;ulimit -S -c </span><span class=si>${</span><span class=nv>DAEMON_COREFILE_LIMIT</span><span class=k>:-</span><span class=nv>0</span><span class=si>}</span><span class=s2>&quot;</span>
<a id=__codelineno-59-336 name=__codelineno-59-336 href=#__codelineno-59-336></a>
<a id=__codelineno-59-337 name=__codelineno-59-337 href=#__codelineno-59-337></a><span class=w>    </span><span class=c1># if they set NICELEVEL in /etc/sysconfig/foo, honor it</span>
<a id=__codelineno-59-338 name=__codelineno-59-338 href=#__codelineno-59-338></a><span class=w>    </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>NICELEVEL</span><span class=k>:-</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nv>nice</span><span class=o>=</span><span class=s2>&quot;nice -n </span><span class=nv>$NICELEVEL</span><span class=s2>&quot;</span>
<a id=__codelineno-59-339 name=__codelineno-59-339 href=#__codelineno-59-339></a>
<a id=__codelineno-59-340 name=__codelineno-59-340 href=#__codelineno-59-340></a><span class=w>    </span><span class=c1># if they set CGROUP_DAEMON in /etc/sysconfig/foo, honor it</span>
<a id=__codelineno-59-341 name=__codelineno-59-341 href=#__codelineno-59-341></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>CGROUP_DAEMON</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-59-342 name=__codelineno-59-342 href=#__codelineno-59-342></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>!<span class=w> </span>-x<span class=w> </span>/bin/cgexec<span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-59-343 name=__codelineno-59-343 href=#__codelineno-59-343></a><span class=w>            </span><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;Cgroups not installed&quot;</span><span class=p>;</span><span class=w> </span>warning
<a id=__codelineno-59-344 name=__codelineno-59-344 href=#__codelineno-59-344></a><span class=w>            </span><span class=nb>echo</span>
<a id=__codelineno-59-345 name=__codelineno-59-345 href=#__codelineno-59-345></a><span class=w>        </span><span class=k>else</span>
<a id=__codelineno-59-346 name=__codelineno-59-346 href=#__codelineno-59-346></a><span class=w>            </span><span class=nv>cgroup</span><span class=o>=</span><span class=s2>&quot;/bin/cgexec&quot;</span><span class=p>;</span>
<a id=__codelineno-59-347 name=__codelineno-59-347 href=#__codelineno-59-347></a><span class=w>            </span><span class=k>for</span><span class=w> </span>i<span class=w> </span><span class=k>in</span><span class=w> </span><span class=nv>$CGROUP_DAEMON</span><span class=p>;</span><span class=w> </span><span class=k>do</span>
<a id=__codelineno-59-348 name=__codelineno-59-348 href=#__codelineno-59-348></a><span class=w>                </span><span class=nv>cgroup</span><span class=o>=</span><span class=s2>&quot;</span><span class=nv>$cgroup</span><span class=s2> -g </span><span class=nv>$i</span><span class=s2>&quot;</span><span class=p>;</span>
<a id=__codelineno-59-349 name=__codelineno-59-349 href=#__codelineno-59-349></a><span class=w>            </span><span class=k>done</span>
<a id=__codelineno-59-350 name=__codelineno-59-350 href=#__codelineno-59-350></a><span class=w>        </span><span class=k>fi</span>
<a id=__codelineno-59-351 name=__codelineno-59-351 href=#__codelineno-59-351></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-59-352 name=__codelineno-59-352 href=#__codelineno-59-352></a>
<a id=__codelineno-59-353 name=__codelineno-59-353 href=#__codelineno-59-353></a><span class=w>    </span><span class=c1># Echo daemon</span>
<a id=__codelineno-59-354 name=__codelineno-59-354 href=#__codelineno-59-354></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>BOOTUP</span><span class=k>:-</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;verbose&quot;</span><span class=w> </span>-a<span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>LSB</span><span class=k>:-</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot; </span><span class=nv>$base</span><span class=s2>&quot;</span>
<a id=__codelineno-59-355 name=__codelineno-59-355 href=#__codelineno-59-355></a>
<a id=__codelineno-59-356 name=__codelineno-59-356 href=#__codelineno-59-356></a><span class=w>    </span><span class=c1># And start it up.</span>
<a id=__codelineno-59-357 name=__codelineno-59-357 href=#__codelineno-59-357></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=nv>$user</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-59-358 name=__codelineno-59-358 href=#__codelineno-59-358></a><span class=w>       </span><span class=nv>$cgroup</span><span class=w> </span><span class=nv>$nice</span><span class=w> </span>/bin/bash<span class=w> </span>-c<span class=w> </span><span class=s2>&quot;</span><span class=nv>$corelimit</span><span class=s2> &gt;/dev/null 2&gt;&amp;1 ; </span><span class=nv>$*</span><span class=s2>&quot;</span>
<a id=__codelineno-59-359 name=__codelineno-59-359 href=#__codelineno-59-359></a><span class=w>    </span><span class=k>else</span>
<a id=__codelineno-59-360 name=__codelineno-59-360 href=#__codelineno-59-360></a><span class=w>       </span><span class=nv>$cgroup</span><span class=w> </span><span class=nv>$nice</span><span class=w> </span>runuser<span class=w> </span>-s<span class=w> </span>/bin/bash<span class=w> </span><span class=nv>$user</span><span class=w> </span>-c<span class=w> </span><span class=s2>&quot;</span><span class=nv>$corelimit</span><span class=s2> &gt;/dev/null 2&gt;&amp;1 ; </span><span class=nv>$*</span><span class=s2>&quot;</span>
<a id=__codelineno-59-361 name=__codelineno-59-361 href=#__codelineno-59-361></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-59-362 name=__codelineno-59-362 href=#__codelineno-59-362></a>
<a id=__codelineno-59-363 name=__codelineno-59-363 href=#__codelineno-59-363></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$?</span><span class=s2>&quot;</span><span class=w> </span>-eq<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>success<span class=w> </span>$<span class=s2>&quot;</span><span class=nv>$base</span><span class=s2> startup&quot;</span><span class=w> </span><span class=o>||</span><span class=w> </span>failure<span class=w> </span>$<span class=s2>&quot;</span><span class=nv>$base</span><span class=s2> startup&quot;</span>
<a id=__codelineno-59-364 name=__codelineno-59-364 href=#__codelineno-59-364></a><span class=o>}</span>
<a id=__codelineno-59-365 name=__codelineno-59-365 href=#__codelineno-59-365></a>
<a id=__codelineno-59-366 name=__codelineno-59-366 href=#__codelineno-59-366></a><span class=c1># A function to stop a program.</span>
<a id=__codelineno-59-367 name=__codelineno-59-367 href=#__codelineno-59-367></a>killproc<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-59-368 name=__codelineno-59-368 href=#__codelineno-59-368></a><span class=w>    </span><span class=nb>local</span><span class=w> </span>RC<span class=w> </span><span class=nv>killlevel</span><span class=o>=</span><span class=w> </span>base<span class=w> </span>pid<span class=w> </span><span class=nv>pid_file</span><span class=o>=</span><span class=w> </span>delay<span class=w> </span>try<span class=w> </span><span class=nv>binary</span><span class=o>=</span>
<a id=__codelineno-59-369 name=__codelineno-59-369 href=#__codelineno-59-369></a>
<a id=__codelineno-59-370 name=__codelineno-59-370 href=#__codelineno-59-370></a><span class=w>    </span><span class=nv>RC</span><span class=o>=</span><span class=m>0</span><span class=p>;</span><span class=w> </span><span class=nv>delay</span><span class=o>=</span><span class=m>3</span><span class=p>;</span><span class=w> </span><span class=nv>try</span><span class=o>=</span><span class=m>0</span>
<a id=__codelineno-59-371 name=__codelineno-59-371 href=#__codelineno-59-371></a><span class=w>    </span><span class=c1># Test syntax.</span>
<a id=__codelineno-59-372 name=__codelineno-59-372 href=#__codelineno-59-372></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$#</span><span class=s2>&quot;</span><span class=w> </span>-eq<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-59-373 name=__codelineno-59-373 href=#__codelineno-59-373></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>$&quot;Usage: killproc [-p pidfile] [ -d delay] {program} [-signal]&quot;</span>
<a id=__codelineno-59-374 name=__codelineno-59-374 href=#__codelineno-59-374></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-59-375 name=__codelineno-59-375 href=#__codelineno-59-375></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-59-376 name=__codelineno-59-376 href=#__codelineno-59-376></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;-p&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-59-377 name=__codelineno-59-377 href=#__codelineno-59-377></a><span class=w>        </span><span class=nv>pid_file</span><span class=o>=</span><span class=nv>$2</span>
<a id=__codelineno-59-378 name=__codelineno-59-378 href=#__codelineno-59-378></a><span class=w>        </span><span class=nb>shift</span><span class=w> </span><span class=m>2</span>
<a id=__codelineno-59-379 name=__codelineno-59-379 href=#__codelineno-59-379></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-59-380 name=__codelineno-59-380 href=#__codelineno-59-380></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;-b&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-59-381 name=__codelineno-59-381 href=#__codelineno-59-381></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=nv>$pid_file</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-59-382 name=__codelineno-59-382 href=#__codelineno-59-382></a><span class=w>            </span><span class=nb>echo</span><span class=w> </span><span class=s2>$&quot;-b option can be used only with -p&quot;</span>
<a id=__codelineno-59-383 name=__codelineno-59-383 href=#__codelineno-59-383></a><span class=w>            </span><span class=nb>echo</span><span class=w> </span><span class=s2>$&quot;Usage: killproc -p pidfile -b binary program&quot;</span>
<a id=__codelineno-59-384 name=__codelineno-59-384 href=#__codelineno-59-384></a><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-59-385 name=__codelineno-59-385 href=#__codelineno-59-385></a><span class=w>        </span><span class=k>fi</span>
<a id=__codelineno-59-386 name=__codelineno-59-386 href=#__codelineno-59-386></a><span class=w>        </span><span class=nv>binary</span><span class=o>=</span><span class=nv>$2</span>
<a id=__codelineno-59-387 name=__codelineno-59-387 href=#__codelineno-59-387></a><span class=w>        </span><span class=nb>shift</span><span class=w> </span><span class=m>2</span>
<a id=__codelineno-59-388 name=__codelineno-59-388 href=#__codelineno-59-388></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-59-389 name=__codelineno-59-389 href=#__codelineno-59-389></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;-d&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-59-390 name=__codelineno-59-390 href=#__codelineno-59-390></a><span class=w>        </span><span class=nv>delay</span><span class=o>=</span><span class=k>$(</span><span class=nb>echo</span><span class=w> </span><span class=nv>$2</span><span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span>-v<span class=w> </span><span class=nv>RS</span><span class=o>=</span><span class=s1>&#39; &#39;</span><span class=w> </span>-v<span class=w> </span><span class=nv>IGNORECASE</span><span class=o>=</span><span class=m>1</span><span class=w> </span><span class=s1>&#39;{if($1!~/^[0-9.]+[smhd]?$/) exit 1;d=$1~/s$|^[0-9.]*$/?1:$1~/m$/?60:$1~/h$/?60*60:$1~/d$/?24*60*60:-1;if(d==-1) exit 1;delay+=d*$1} END {printf(&quot;%d&quot;,delay+0.5)}&#39;</span><span class=k>)</span>
<a id=__codelineno-59-391 name=__codelineno-59-391 href=#__codelineno-59-391></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$?</span><span class=s2>&quot;</span><span class=w> </span>-eq<span class=w> </span><span class=m>1</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-59-392 name=__codelineno-59-392 href=#__codelineno-59-392></a><span class=w>            </span><span class=nb>echo</span><span class=w> </span><span class=s2>$&quot;Usage: killproc [-p pidfile] [ -d delay] {program} [-signal]&quot;</span>
<a id=__codelineno-59-393 name=__codelineno-59-393 href=#__codelineno-59-393></a><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-59-394 name=__codelineno-59-394 href=#__codelineno-59-394></a><span class=w>        </span><span class=k>fi</span>
<a id=__codelineno-59-395 name=__codelineno-59-395 href=#__codelineno-59-395></a><span class=w>        </span><span class=nb>shift</span><span class=w> </span><span class=m>2</span>
<a id=__codelineno-59-396 name=__codelineno-59-396 href=#__codelineno-59-396></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-59-397 name=__codelineno-59-397 href=#__codelineno-59-397></a>
<a id=__codelineno-59-398 name=__codelineno-59-398 href=#__codelineno-59-398></a>
<a id=__codelineno-59-399 name=__codelineno-59-399 href=#__codelineno-59-399></a><span class=w>    </span><span class=c1># check for second arg to be kill level</span>
<a id=__codelineno-59-400 name=__codelineno-59-400 href=#__codelineno-59-400></a><span class=w>    </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>2</span><span class=k>:-</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nv>killlevel</span><span class=o>=</span><span class=nv>$2</span>
<a id=__codelineno-59-401 name=__codelineno-59-401 href=#__codelineno-59-401></a>
<a id=__codelineno-59-402 name=__codelineno-59-402 href=#__codelineno-59-402></a><span class=w>    </span><span class=c1># Save basename.</span>
<a id=__codelineno-59-403 name=__codelineno-59-403 href=#__codelineno-59-403></a><span class=w>    </span><span class=nv>base</span><span class=o>=</span><span class=si>${</span><span class=nv>1</span><span class=p>##*/</span><span class=si>}</span>
<a id=__codelineno-59-404 name=__codelineno-59-404 href=#__codelineno-59-404></a>
<a id=__codelineno-59-405 name=__codelineno-59-405 href=#__codelineno-59-405></a><span class=w>    </span><span class=c1># Find pid.</span>
<a id=__codelineno-59-406 name=__codelineno-59-406 href=#__codelineno-59-406></a><span class=w>    </span>__pids_var_run<span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$pid_file</span><span class=s2>&quot;</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$binary</span><span class=s2>&quot;</span>
<a id=__codelineno-59-407 name=__codelineno-59-407 href=#__codelineno-59-407></a><span class=w>    </span><span class=nv>RC</span><span class=o>=</span><span class=nv>$?</span>
<a id=__codelineno-59-408 name=__codelineno-59-408 href=#__codelineno-59-408></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=nv>$pid</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-59-409 name=__codelineno-59-409 href=#__codelineno-59-409></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=nv>$pid_file</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-59-410 name=__codelineno-59-410 href=#__codelineno-59-410></a><span class=w>            </span><span class=nv>pid</span><span class=o>=</span><span class=s2>&quot;</span><span class=k>$(</span>__pids_pidof<span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=k>)</span><span class=s2>&quot;</span>
<a id=__codelineno-59-411 name=__codelineno-59-411 href=#__codelineno-59-411></a><span class=w>        </span><span class=k>else</span>
<a id=__codelineno-59-412 name=__codelineno-59-412 href=#__codelineno-59-412></a><span class=w>            </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$RC</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;4&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=o>{</span><span class=w> </span>failure<span class=w> </span>$<span class=s2>&quot;</span><span class=nv>$base</span><span class=s2> shutdown&quot;</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=nv>$RC</span><span class=w> </span><span class=p>;</span><span class=o>}</span>
<a id=__codelineno-59-413 name=__codelineno-59-413 href=#__codelineno-59-413></a><span class=w>        </span><span class=k>fi</span>
<a id=__codelineno-59-414 name=__codelineno-59-414 href=#__codelineno-59-414></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-59-415 name=__codelineno-59-415 href=#__codelineno-59-415></a>
<a id=__codelineno-59-416 name=__codelineno-59-416 href=#__codelineno-59-416></a><span class=w>    </span><span class=c1># Kill it.</span>
<a id=__codelineno-59-417 name=__codelineno-59-417 href=#__codelineno-59-417></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=nv>$pid</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-59-418 name=__codelineno-59-418 href=#__codelineno-59-418></a><span class=w>        </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$BOOTUP</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;verbose&quot;</span><span class=w> </span>-a<span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>LSB</span><span class=k>:-</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=nv>$base</span><span class=s2> &quot;</span>
<a id=__codelineno-59-419 name=__codelineno-59-419 href=#__codelineno-59-419></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=nv>$killlevel</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-59-420 name=__codelineno-59-420 href=#__codelineno-59-420></a><span class=w>            </span>__kill_pids_term_kill<span class=w> </span>-d<span class=w> </span><span class=nv>$delay</span><span class=w> </span><span class=nv>$pid</span>
<a id=__codelineno-59-421 name=__codelineno-59-421 href=#__codelineno-59-421></a><span class=w>            </span><span class=nv>RC</span><span class=o>=</span><span class=nv>$?</span>
<a id=__codelineno-59-422 name=__codelineno-59-422 href=#__codelineno-59-422></a><span class=w>            </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$RC</span><span class=s2>&quot;</span><span class=w> </span>-eq<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>success<span class=w> </span>$<span class=s2>&quot;</span><span class=nv>$base</span><span class=s2> shutdown&quot;</span><span class=w> </span><span class=o>||</span><span class=w> </span>failure<span class=w> </span>$<span class=s2>&quot;</span><span class=nv>$base</span><span class=s2> shutdown&quot;</span>
<a id=__codelineno-59-423 name=__codelineno-59-423 href=#__codelineno-59-423></a><span class=w>        </span><span class=c1># use specified level only</span>
<a id=__codelineno-59-424 name=__codelineno-59-424 href=#__codelineno-59-424></a><span class=w>        </span><span class=k>else</span>
<a id=__codelineno-59-425 name=__codelineno-59-425 href=#__codelineno-59-425></a><span class=w>            </span><span class=k>if</span><span class=w> </span>checkpid<span class=w> </span><span class=nv>$pid</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-59-426 name=__codelineno-59-426 href=#__codelineno-59-426></a><span class=w>                </span><span class=nb>kill</span><span class=w> </span><span class=nv>$killlevel</span><span class=w> </span><span class=nv>$pid</span><span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-59-427 name=__codelineno-59-427 href=#__codelineno-59-427></a><span class=w>                </span><span class=nv>RC</span><span class=o>=</span><span class=nv>$?</span>
<a id=__codelineno-59-428 name=__codelineno-59-428 href=#__codelineno-59-428></a><span class=w>                </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$RC</span><span class=s2>&quot;</span><span class=w> </span>-eq<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>success<span class=w> </span>$<span class=s2>&quot;</span><span class=nv>$base</span><span class=s2> </span><span class=nv>$killlevel</span><span class=s2>&quot;</span><span class=w> </span><span class=o>||</span><span class=w> </span>failure<span class=w> </span>$<span class=s2>&quot;</span><span class=nv>$base</span><span class=s2> </span><span class=nv>$killlevel</span><span class=s2>&quot;</span>
<a id=__codelineno-59-429 name=__codelineno-59-429 href=#__codelineno-59-429></a><span class=w>            </span><span class=k>elif</span><span class=w> </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>LSB</span><span class=k>:-</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-59-430 name=__codelineno-59-430 href=#__codelineno-59-430></a><span class=w>                </span><span class=nv>RC</span><span class=o>=</span><span class=m>7</span><span class=w> </span><span class=c1># Program is not running</span>
<a id=__codelineno-59-431 name=__codelineno-59-431 href=#__codelineno-59-431></a><span class=w>            </span><span class=k>fi</span>
<a id=__codelineno-59-432 name=__codelineno-59-432 href=#__codelineno-59-432></a><span class=w>        </span><span class=k>fi</span>
<a id=__codelineno-59-433 name=__codelineno-59-433 href=#__codelineno-59-433></a><span class=w>    </span><span class=k>else</span>
<a id=__codelineno-59-434 name=__codelineno-59-434 href=#__codelineno-59-434></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>LSB</span><span class=k>:-</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span>-a<span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=nv>$killlevel</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-59-435 name=__codelineno-59-435 href=#__codelineno-59-435></a><span class=w>            </span><span class=nv>RC</span><span class=o>=</span><span class=m>7</span><span class=w> </span><span class=c1># Program is not running</span>
<a id=__codelineno-59-436 name=__codelineno-59-436 href=#__codelineno-59-436></a><span class=w>        </span><span class=k>else</span>
<a id=__codelineno-59-437 name=__codelineno-59-437 href=#__codelineno-59-437></a><span class=w>            </span>failure<span class=w> </span>$<span class=s2>&quot;</span><span class=nv>$base</span><span class=s2> shutdown&quot;</span>
<a id=__codelineno-59-438 name=__codelineno-59-438 href=#__codelineno-59-438></a><span class=w>            </span><span class=nv>RC</span><span class=o>=</span><span class=m>0</span>
<a id=__codelineno-59-439 name=__codelineno-59-439 href=#__codelineno-59-439></a><span class=w>        </span><span class=k>fi</span>
<a id=__codelineno-59-440 name=__codelineno-59-440 href=#__codelineno-59-440></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-59-441 name=__codelineno-59-441 href=#__codelineno-59-441></a>
<a id=__codelineno-59-442 name=__codelineno-59-442 href=#__codelineno-59-442></a><span class=w>    </span><span class=c1># Remove pid file if any.</span>
<a id=__codelineno-59-443 name=__codelineno-59-443 href=#__codelineno-59-443></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=nv>$killlevel</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-59-444 name=__codelineno-59-444 href=#__codelineno-59-444></a><span class=w>        </span>rm<span class=w> </span>-f<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>pid_file</span><span class=k>:-</span><span class=p>/var/run/</span><span class=nv>$base</span><span class=p>.pid</span><span class=si>}</span><span class=s2>&quot;</span>
<a id=__codelineno-59-445 name=__codelineno-59-445 href=#__codelineno-59-445></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-59-446 name=__codelineno-59-446 href=#__codelineno-59-446></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nv>$RC</span>
<a id=__codelineno-59-447 name=__codelineno-59-447 href=#__codelineno-59-447></a><span class=o>}</span>
<a id=__codelineno-59-448 name=__codelineno-59-448 href=#__codelineno-59-448></a>
<a id=__codelineno-59-449 name=__codelineno-59-449 href=#__codelineno-59-449></a><span class=c1># A function to find the pid of a program. Looks *only* at the pidfile</span>
<a id=__codelineno-59-450 name=__codelineno-59-450 href=#__codelineno-59-450></a>pidfileofproc<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-59-451 name=__codelineno-59-451 href=#__codelineno-59-451></a><span class=w>    </span><span class=nb>local</span><span class=w> </span>pid
<a id=__codelineno-59-452 name=__codelineno-59-452 href=#__codelineno-59-452></a>
<a id=__codelineno-59-453 name=__codelineno-59-453 href=#__codelineno-59-453></a><span class=w>    </span><span class=c1># Test syntax.</span>
<a id=__codelineno-59-454 name=__codelineno-59-454 href=#__codelineno-59-454></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$#</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-59-455 name=__codelineno-59-455 href=#__codelineno-59-455></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>$&quot;Usage: pidfileofproc {program}&quot;</span>
<a id=__codelineno-59-456 name=__codelineno-59-456 href=#__codelineno-59-456></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-59-457 name=__codelineno-59-457 href=#__codelineno-59-457></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-59-458 name=__codelineno-59-458 href=#__codelineno-59-458></a>
<a id=__codelineno-59-459 name=__codelineno-59-459 href=#__codelineno-59-459></a><span class=w>    </span>__pids_var_run<span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span>
<a id=__codelineno-59-460 name=__codelineno-59-460 href=#__codelineno-59-460></a><span class=w>    </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=nv>$pid</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=nv>$pid</span>
<a id=__codelineno-59-461 name=__codelineno-59-461 href=#__codelineno-59-461></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-59-462 name=__codelineno-59-462 href=#__codelineno-59-462></a><span class=o>}</span>
<a id=__codelineno-59-463 name=__codelineno-59-463 href=#__codelineno-59-463></a>
<a id=__codelineno-59-464 name=__codelineno-59-464 href=#__codelineno-59-464></a><span class=c1># A function to find the pid of a program.</span>
<a id=__codelineno-59-465 name=__codelineno-59-465 href=#__codelineno-59-465></a>pidofproc<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-59-466 name=__codelineno-59-466 href=#__codelineno-59-466></a><span class=w>    </span><span class=nb>local</span><span class=w> </span>RC<span class=w> </span>pid<span class=w> </span><span class=nv>pid_file</span><span class=o>=</span>
<a id=__codelineno-59-467 name=__codelineno-59-467 href=#__codelineno-59-467></a>
<a id=__codelineno-59-468 name=__codelineno-59-468 href=#__codelineno-59-468></a><span class=w>    </span><span class=c1># Test syntax.</span>
<a id=__codelineno-59-469 name=__codelineno-59-469 href=#__codelineno-59-469></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$#</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-59-470 name=__codelineno-59-470 href=#__codelineno-59-470></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>$&quot;Usage: pidofproc [-p pidfile] {program}&quot;</span>
<a id=__codelineno-59-471 name=__codelineno-59-471 href=#__codelineno-59-471></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-59-472 name=__codelineno-59-472 href=#__codelineno-59-472></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-59-473 name=__codelineno-59-473 href=#__codelineno-59-473></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;-p&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-59-474 name=__codelineno-59-474 href=#__codelineno-59-474></a><span class=w>        </span><span class=nv>pid_file</span><span class=o>=</span><span class=nv>$2</span>
<a id=__codelineno-59-475 name=__codelineno-59-475 href=#__codelineno-59-475></a><span class=w>        </span><span class=nb>shift</span><span class=w> </span><span class=m>2</span>
<a id=__codelineno-59-476 name=__codelineno-59-476 href=#__codelineno-59-476></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-59-477 name=__codelineno-59-477 href=#__codelineno-59-477></a><span class=w>    </span><span class=nv>fail_code</span><span class=o>=</span><span class=m>3</span><span class=w> </span><span class=c1># &quot;Program is not running&quot;</span>
<a id=__codelineno-59-478 name=__codelineno-59-478 href=#__codelineno-59-478></a>
<a id=__codelineno-59-479 name=__codelineno-59-479 href=#__codelineno-59-479></a><span class=w>    </span><span class=c1># First try &quot;/var/run/*.pid&quot; files</span>
<a id=__codelineno-59-480 name=__codelineno-59-480 href=#__codelineno-59-480></a><span class=w>    </span>__pids_var_run<span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$pid_file</span><span class=s2>&quot;</span>
<a id=__codelineno-59-481 name=__codelineno-59-481 href=#__codelineno-59-481></a><span class=w>    </span><span class=nv>RC</span><span class=o>=</span><span class=nv>$?</span>
<a id=__codelineno-59-482 name=__codelineno-59-482 href=#__codelineno-59-482></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=nv>$pid</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-59-483 name=__codelineno-59-483 href=#__codelineno-59-483></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=nv>$pid</span>
<a id=__codelineno-59-484 name=__codelineno-59-484 href=#__codelineno-59-484></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-59-485 name=__codelineno-59-485 href=#__codelineno-59-485></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-59-486 name=__codelineno-59-486 href=#__codelineno-59-486></a>
<a id=__codelineno-59-487 name=__codelineno-59-487 href=#__codelineno-59-487></a><span class=w>    </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=nv>$pid_file</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=nv>$RC</span>
<a id=__codelineno-59-488 name=__codelineno-59-488 href=#__codelineno-59-488></a><span class=w>    </span>__pids_pidof<span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=nv>$RC</span>
<a id=__codelineno-59-489 name=__codelineno-59-489 href=#__codelineno-59-489></a><span class=o>}</span>
<a id=__codelineno-59-490 name=__codelineno-59-490 href=#__codelineno-59-490></a>
<a id=__codelineno-59-491 name=__codelineno-59-491 href=#__codelineno-59-491></a>status<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-59-492 name=__codelineno-59-492 href=#__codelineno-59-492></a><span class=w>    </span><span class=nb>local</span><span class=w> </span>base<span class=w> </span>pid<span class=w> </span><span class=nv>lock_file</span><span class=o>=</span><span class=w> </span><span class=nv>pid_file</span><span class=o>=</span><span class=w> </span><span class=nv>binary</span><span class=o>=</span>
<a id=__codelineno-59-493 name=__codelineno-59-493 href=#__codelineno-59-493></a>
<a id=__codelineno-59-494 name=__codelineno-59-494 href=#__codelineno-59-494></a><span class=w>    </span><span class=c1># Test syntax.</span>
<a id=__codelineno-59-495 name=__codelineno-59-495 href=#__codelineno-59-495></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$#</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-59-496 name=__codelineno-59-496 href=#__codelineno-59-496></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>$&quot;Usage: status [-p pidfile] {program}&quot;</span>
<a id=__codelineno-59-497 name=__codelineno-59-497 href=#__codelineno-59-497></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-59-498 name=__codelineno-59-498 href=#__codelineno-59-498></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-59-499 name=__codelineno-59-499 href=#__codelineno-59-499></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;-p&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-59-500 name=__codelineno-59-500 href=#__codelineno-59-500></a><span class=w>        </span><span class=nv>pid_file</span><span class=o>=</span><span class=nv>$2</span>
<a id=__codelineno-59-501 name=__codelineno-59-501 href=#__codelineno-59-501></a><span class=w>        </span><span class=nb>shift</span><span class=w> </span><span class=m>2</span>
<a id=__codelineno-59-502 name=__codelineno-59-502 href=#__codelineno-59-502></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-59-503 name=__codelineno-59-503 href=#__codelineno-59-503></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;-l&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-59-504 name=__codelineno-59-504 href=#__codelineno-59-504></a><span class=w>        </span><span class=nv>lock_file</span><span class=o>=</span><span class=nv>$2</span>
<a id=__codelineno-59-505 name=__codelineno-59-505 href=#__codelineno-59-505></a><span class=w>        </span><span class=nb>shift</span><span class=w> </span><span class=m>2</span>
<a id=__codelineno-59-506 name=__codelineno-59-506 href=#__codelineno-59-506></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-59-507 name=__codelineno-59-507 href=#__codelineno-59-507></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;-b&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-59-508 name=__codelineno-59-508 href=#__codelineno-59-508></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=nv>$pid_file</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-59-509 name=__codelineno-59-509 href=#__codelineno-59-509></a><span class=w>            </span><span class=nb>echo</span><span class=w> </span><span class=s2>$&quot;-b option can be used only with -p&quot;</span>
<a id=__codelineno-59-510 name=__codelineno-59-510 href=#__codelineno-59-510></a><span class=w>            </span><span class=nb>echo</span><span class=w> </span><span class=s2>$&quot;Usage: status -p pidfile -b binary program&quot;</span>
<a id=__codelineno-59-511 name=__codelineno-59-511 href=#__codelineno-59-511></a><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-59-512 name=__codelineno-59-512 href=#__codelineno-59-512></a><span class=w>        </span><span class=k>fi</span>
<a id=__codelineno-59-513 name=__codelineno-59-513 href=#__codelineno-59-513></a><span class=w>        </span><span class=nv>binary</span><span class=o>=</span><span class=nv>$2</span>
<a id=__codelineno-59-514 name=__codelineno-59-514 href=#__codelineno-59-514></a><span class=w>        </span><span class=nb>shift</span><span class=w> </span><span class=m>2</span>
<a id=__codelineno-59-515 name=__codelineno-59-515 href=#__codelineno-59-515></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-59-516 name=__codelineno-59-516 href=#__codelineno-59-516></a><span class=w>    </span><span class=nv>base</span><span class=o>=</span><span class=si>${</span><span class=nv>1</span><span class=p>##*/</span><span class=si>}</span>
<a id=__codelineno-59-517 name=__codelineno-59-517 href=#__codelineno-59-517></a>
<a id=__codelineno-59-518 name=__codelineno-59-518 href=#__codelineno-59-518></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$_use_systemctl</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;1&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-59-519 name=__codelineno-59-519 href=#__codelineno-59-519></a><span class=w>        </span>systemctl<span class=w> </span>status<span class=w> </span><span class=si>${</span><span class=nv>0</span><span class=p>##*/</span><span class=si>}</span>.service
<a id=__codelineno-59-520 name=__codelineno-59-520 href=#__codelineno-59-520></a><span class=w>        </span><span class=nv>ret</span><span class=o>=</span><span class=nv>$?</span>
<a id=__codelineno-59-521 name=__codelineno-59-521 href=#__codelineno-59-521></a><span class=w>        </span><span class=c1># LSB daemons that dies abnormally in systemd looks alive in systemd&#39;s eyes due to RemainAfterExit=yes</span>
<a id=__codelineno-59-522 name=__codelineno-59-522 href=#__codelineno-59-522></a><span class=w>        </span><span class=c1># lets adjust the reality a little bit</span>
<a id=__codelineno-59-523 name=__codelineno-59-523 href=#__codelineno-59-523></a><span class=w>        </span><span class=k>if</span><span class=w> </span>systemctl<span class=w> </span>show<span class=w> </span>-p<span class=w> </span>ActiveState<span class=w> </span><span class=si>${</span><span class=nv>0</span><span class=p>##*/</span><span class=si>}</span>.service<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>-q<span class=w> </span><span class=s1>&#39;=active$&#39;</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-59-524 name=__codelineno-59-524 href=#__codelineno-59-524></a><span class=w>        </span>systemctl<span class=w> </span>show<span class=w> </span>-p<span class=w> </span>SubState<span class=w> </span><span class=si>${</span><span class=nv>0</span><span class=p>##*/</span><span class=si>}</span>.service<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>-q<span class=w> </span><span class=s1>&#39;=exited$&#39;</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-59-525 name=__codelineno-59-525 href=#__codelineno-59-525></a><span class=w>            </span><span class=nv>ret</span><span class=o>=</span><span class=m>3</span>
<a id=__codelineno-59-526 name=__codelineno-59-526 href=#__codelineno-59-526></a><span class=w>        </span><span class=k>fi</span>
<a id=__codelineno-59-527 name=__codelineno-59-527 href=#__codelineno-59-527></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nv>$ret</span>
<a id=__codelineno-59-528 name=__codelineno-59-528 href=#__codelineno-59-528></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-59-529 name=__codelineno-59-529 href=#__codelineno-59-529></a>
<a id=__codelineno-59-530 name=__codelineno-59-530 href=#__codelineno-59-530></a><span class=w>    </span><span class=c1># First try &quot;pidof&quot;</span>
<a id=__codelineno-59-531 name=__codelineno-59-531 href=#__codelineno-59-531></a><span class=w>    </span>__pids_var_run<span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$pid_file</span><span class=s2>&quot;</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$binary</span><span class=s2>&quot;</span>
<a id=__codelineno-59-532 name=__codelineno-59-532 href=#__codelineno-59-532></a><span class=w>    </span><span class=nv>RC</span><span class=o>=</span><span class=nv>$?</span>
<a id=__codelineno-59-533 name=__codelineno-59-533 href=#__codelineno-59-533></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=nv>$pid_file</span><span class=s2>&quot;</span><span class=w> </span>-a<span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=nv>$pid</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-59-534 name=__codelineno-59-534 href=#__codelineno-59-534></a><span class=w>        </span><span class=nv>pid</span><span class=o>=</span><span class=s2>&quot;</span><span class=k>$(</span>__pids_pidof<span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=k>)</span><span class=s2>&quot;</span>
<a id=__codelineno-59-535 name=__codelineno-59-535 href=#__codelineno-59-535></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-59-536 name=__codelineno-59-536 href=#__codelineno-59-536></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=nv>$pid</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-59-537 name=__codelineno-59-537 href=#__codelineno-59-537></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span>$<span class=s2>&quot;</span><span class=si>${</span><span class=nv>base</span><span class=si>}</span><span class=s2> (pid </span><span class=nv>$pid</span><span class=s2>) is running...&quot;</span>
<a id=__codelineno-59-538 name=__codelineno-59-538 href=#__codelineno-59-538></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-59-539 name=__codelineno-59-539 href=#__codelineno-59-539></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-59-540 name=__codelineno-59-540 href=#__codelineno-59-540></a>
<a id=__codelineno-59-541 name=__codelineno-59-541 href=#__codelineno-59-541></a><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$RC</span><span class=s2>&quot;</span><span class=w> </span><span class=k>in</span>
<a id=__codelineno-59-542 name=__codelineno-59-542 href=#__codelineno-59-542></a><span class=w>    </span><span class=m>0</span><span class=o>)</span>
<a id=__codelineno-59-543 name=__codelineno-59-543 href=#__codelineno-59-543></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span>$<span class=s2>&quot;</span><span class=si>${</span><span class=nv>base</span><span class=si>}</span><span class=s2> (pid </span><span class=nv>$pid</span><span class=s2>) is running...&quot;</span>
<a id=__codelineno-59-544 name=__codelineno-59-544 href=#__codelineno-59-544></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-59-545 name=__codelineno-59-545 href=#__codelineno-59-545></a><span class=w>        </span><span class=p>;;</span>
<a id=__codelineno-59-546 name=__codelineno-59-546 href=#__codelineno-59-546></a><span class=w>    </span><span class=m>1</span><span class=o>)</span>
<a id=__codelineno-59-547 name=__codelineno-59-547 href=#__codelineno-59-547></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span>$<span class=s2>&quot;</span><span class=si>${</span><span class=nv>base</span><span class=si>}</span><span class=s2> dead but pid file exists&quot;</span>
<a id=__codelineno-59-548 name=__codelineno-59-548 href=#__codelineno-59-548></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-59-549 name=__codelineno-59-549 href=#__codelineno-59-549></a><span class=w>        </span><span class=p>;;</span>
<a id=__codelineno-59-550 name=__codelineno-59-550 href=#__codelineno-59-550></a><span class=w>    </span><span class=m>4</span><span class=o>)</span>
<a id=__codelineno-59-551 name=__codelineno-59-551 href=#__codelineno-59-551></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span>$<span class=s2>&quot;</span><span class=si>${</span><span class=nv>base</span><span class=si>}</span><span class=s2> status unknown due to insufficient privileges.&quot;</span>
<a id=__codelineno-59-552 name=__codelineno-59-552 href=#__codelineno-59-552></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=m>4</span>
<a id=__codelineno-59-553 name=__codelineno-59-553 href=#__codelineno-59-553></a><span class=w>        </span><span class=p>;;</span>
<a id=__codelineno-59-554 name=__codelineno-59-554 href=#__codelineno-59-554></a><span class=w>    </span><span class=k>esac</span>
<a id=__codelineno-59-555 name=__codelineno-59-555 href=#__codelineno-59-555></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>lock_file</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-59-556 name=__codelineno-59-556 href=#__codelineno-59-556></a><span class=w>        </span><span class=nv>lock_file</span><span class=o>=</span><span class=si>${</span><span class=nv>base</span><span class=si>}</span>
<a id=__codelineno-59-557 name=__codelineno-59-557 href=#__codelineno-59-557></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-59-558 name=__codelineno-59-558 href=#__codelineno-59-558></a><span class=w>    </span><span class=c1># See if /var/lock/subsys/${lock_file} exists</span>
<a id=__codelineno-59-559 name=__codelineno-59-559 href=#__codelineno-59-559></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-f<span class=w> </span>/var/lock/subsys/<span class=si>${</span><span class=nv>lock_file</span><span class=si>}</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-59-560 name=__codelineno-59-560 href=#__codelineno-59-560></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span>$<span class=s2>&quot;</span><span class=si>${</span><span class=nv>base</span><span class=si>}</span><span class=s2> dead but subsys locked&quot;</span>
<a id=__codelineno-59-561 name=__codelineno-59-561 href=#__codelineno-59-561></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=m>2</span>
<a id=__codelineno-59-562 name=__codelineno-59-562 href=#__codelineno-59-562></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-59-563 name=__codelineno-59-563 href=#__codelineno-59-563></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>$<span class=s2>&quot;</span><span class=si>${</span><span class=nv>base</span><span class=si>}</span><span class=s2> is stopped&quot;</span>
<a id=__codelineno-59-564 name=__codelineno-59-564 href=#__codelineno-59-564></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=m>3</span>
<a id=__codelineno-59-565 name=__codelineno-59-565 href=#__codelineno-59-565></a><span class=o>}</span>
<a id=__codelineno-59-566 name=__codelineno-59-566 href=#__codelineno-59-566></a>
<a id=__codelineno-59-567 name=__codelineno-59-567 href=#__codelineno-59-567></a>echo_success<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-59-568 name=__codelineno-59-568 href=#__codelineno-59-568></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$BOOTUP</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;color&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nv>$MOVE_TO_COL</span>
<a id=__codelineno-59-569 name=__codelineno-59-569 href=#__codelineno-59-569></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;[&quot;</span>
<a id=__codelineno-59-570 name=__codelineno-59-570 href=#__codelineno-59-570></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$BOOTUP</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;color&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nv>$SETCOLOR_SUCCESS</span>
<a id=__codelineno-59-571 name=__codelineno-59-571 href=#__codelineno-59-571></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s2>$&quot;  OK  &quot;</span>
<a id=__codelineno-59-572 name=__codelineno-59-572 href=#__codelineno-59-572></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$BOOTUP</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;color&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nv>$SETCOLOR_NORMAL</span>
<a id=__codelineno-59-573 name=__codelineno-59-573 href=#__codelineno-59-573></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;]&quot;</span>
<a id=__codelineno-59-574 name=__codelineno-59-574 href=#__codelineno-59-574></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-ne<span class=w> </span><span class=s2>&quot;\r&quot;</span>
<a id=__codelineno-59-575 name=__codelineno-59-575 href=#__codelineno-59-575></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-59-576 name=__codelineno-59-576 href=#__codelineno-59-576></a><span class=o>}</span>
<a id=__codelineno-59-577 name=__codelineno-59-577 href=#__codelineno-59-577></a>
<a id=__codelineno-59-578 name=__codelineno-59-578 href=#__codelineno-59-578></a>echo_failure<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-59-579 name=__codelineno-59-579 href=#__codelineno-59-579></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$BOOTUP</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;color&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nv>$MOVE_TO_COL</span>
<a id=__codelineno-59-580 name=__codelineno-59-580 href=#__codelineno-59-580></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;[&quot;</span>
<a id=__codelineno-59-581 name=__codelineno-59-581 href=#__codelineno-59-581></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$BOOTUP</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;color&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nv>$SETCOLOR_FAILURE</span>
<a id=__codelineno-59-582 name=__codelineno-59-582 href=#__codelineno-59-582></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s2>$&quot;FAILED&quot;</span>
<a id=__codelineno-59-583 name=__codelineno-59-583 href=#__codelineno-59-583></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$BOOTUP</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;color&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nv>$SETCOLOR_NORMAL</span>
<a id=__codelineno-59-584 name=__codelineno-59-584 href=#__codelineno-59-584></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;]&quot;</span>
<a id=__codelineno-59-585 name=__codelineno-59-585 href=#__codelineno-59-585></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-ne<span class=w> </span><span class=s2>&quot;\r&quot;</span>
<a id=__codelineno-59-586 name=__codelineno-59-586 href=#__codelineno-59-586></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-59-587 name=__codelineno-59-587 href=#__codelineno-59-587></a><span class=o>}</span>
<a id=__codelineno-59-588 name=__codelineno-59-588 href=#__codelineno-59-588></a>
<a id=__codelineno-59-589 name=__codelineno-59-589 href=#__codelineno-59-589></a>echo_passed<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-59-590 name=__codelineno-59-590 href=#__codelineno-59-590></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$BOOTUP</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;color&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nv>$MOVE_TO_COL</span>
<a id=__codelineno-59-591 name=__codelineno-59-591 href=#__codelineno-59-591></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;[&quot;</span>
<a id=__codelineno-59-592 name=__codelineno-59-592 href=#__codelineno-59-592></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$BOOTUP</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;color&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nv>$SETCOLOR_WARNING</span>
<a id=__codelineno-59-593 name=__codelineno-59-593 href=#__codelineno-59-593></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s2>$&quot;PASSED&quot;</span>
<a id=__codelineno-59-594 name=__codelineno-59-594 href=#__codelineno-59-594></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$BOOTUP</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;color&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nv>$SETCOLOR_NORMAL</span>
<a id=__codelineno-59-595 name=__codelineno-59-595 href=#__codelineno-59-595></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;]&quot;</span>
<a id=__codelineno-59-596 name=__codelineno-59-596 href=#__codelineno-59-596></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-ne<span class=w> </span><span class=s2>&quot;\r&quot;</span>
<a id=__codelineno-59-597 name=__codelineno-59-597 href=#__codelineno-59-597></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-59-598 name=__codelineno-59-598 href=#__codelineno-59-598></a><span class=o>}</span>
<a id=__codelineno-59-599 name=__codelineno-59-599 href=#__codelineno-59-599></a>
<a id=__codelineno-59-600 name=__codelineno-59-600 href=#__codelineno-59-600></a>echo_warning<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-59-601 name=__codelineno-59-601 href=#__codelineno-59-601></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$BOOTUP</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;color&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nv>$MOVE_TO_COL</span>
<a id=__codelineno-59-602 name=__codelineno-59-602 href=#__codelineno-59-602></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;[&quot;</span>
<a id=__codelineno-59-603 name=__codelineno-59-603 href=#__codelineno-59-603></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$BOOTUP</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;color&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nv>$SETCOLOR_WARNING</span>
<a id=__codelineno-59-604 name=__codelineno-59-604 href=#__codelineno-59-604></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s2>$&quot;WARNING&quot;</span>
<a id=__codelineno-59-605 name=__codelineno-59-605 href=#__codelineno-59-605></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$BOOTUP</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;color&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nv>$SETCOLOR_NORMAL</span>
<a id=__codelineno-59-606 name=__codelineno-59-606 href=#__codelineno-59-606></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;]&quot;</span>
<a id=__codelineno-59-607 name=__codelineno-59-607 href=#__codelineno-59-607></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-ne<span class=w> </span><span class=s2>&quot;\r&quot;</span>
<a id=__codelineno-59-608 name=__codelineno-59-608 href=#__codelineno-59-608></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-59-609 name=__codelineno-59-609 href=#__codelineno-59-609></a><span class=o>}</span>
<a id=__codelineno-59-610 name=__codelineno-59-610 href=#__codelineno-59-610></a>
<a id=__codelineno-59-611 name=__codelineno-59-611 href=#__codelineno-59-611></a><span class=c1># Inform the graphical boot of our current state</span>
<a id=__codelineno-59-612 name=__codelineno-59-612 href=#__codelineno-59-612></a>update_boot_stage<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-59-613 name=__codelineno-59-613 href=#__codelineno-59-613></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-x<span class=w> </span>/bin/plymouth<span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-59-614 name=__codelineno-59-614 href=#__codelineno-59-614></a><span class=w>        </span>/bin/plymouth<span class=w> </span>--update<span class=o>=</span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span>
<a id=__codelineno-59-615 name=__codelineno-59-615 href=#__codelineno-59-615></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-59-616 name=__codelineno-59-616 href=#__codelineno-59-616></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-59-617 name=__codelineno-59-617 href=#__codelineno-59-617></a><span class=o>}</span>
<a id=__codelineno-59-618 name=__codelineno-59-618 href=#__codelineno-59-618></a>
<a id=__codelineno-59-619 name=__codelineno-59-619 href=#__codelineno-59-619></a><span class=c1># Log that something succeeded</span>
<a id=__codelineno-59-620 name=__codelineno-59-620 href=#__codelineno-59-620></a>success<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-59-621 name=__codelineno-59-621 href=#__codelineno-59-621></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$BOOTUP</span><span class=s2>&quot;</span><span class=w> </span>!<span class=o>=</span><span class=w> </span><span class=s2>&quot;verbose&quot;</span><span class=w> </span>-a<span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>LSB</span><span class=k>:-</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>echo_success
<a id=__codelineno-59-622 name=__codelineno-59-622 href=#__codelineno-59-622></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-59-623 name=__codelineno-59-623 href=#__codelineno-59-623></a><span class=o>}</span>
<a id=__codelineno-59-624 name=__codelineno-59-624 href=#__codelineno-59-624></a>
<a id=__codelineno-59-625 name=__codelineno-59-625 href=#__codelineno-59-625></a><span class=c1># Log that something failed</span>
<a id=__codelineno-59-626 name=__codelineno-59-626 href=#__codelineno-59-626></a>failure<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-59-627 name=__codelineno-59-627 href=#__codelineno-59-627></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>rc</span><span class=o>=</span><span class=nv>$?</span>
<a id=__codelineno-59-628 name=__codelineno-59-628 href=#__codelineno-59-628></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$BOOTUP</span><span class=s2>&quot;</span><span class=w> </span>!<span class=o>=</span><span class=w> </span><span class=s2>&quot;verbose&quot;</span><span class=w> </span>-a<span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>LSB</span><span class=k>:-</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>echo_failure
<a id=__codelineno-59-629 name=__codelineno-59-629 href=#__codelineno-59-629></a><span class=w>    </span><span class=o>[</span><span class=w> </span>-x<span class=w> </span>/bin/plymouth<span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>/bin/plymouth<span class=w> </span>--details
<a id=__codelineno-59-630 name=__codelineno-59-630 href=#__codelineno-59-630></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nv>$rc</span>
<a id=__codelineno-59-631 name=__codelineno-59-631 href=#__codelineno-59-631></a><span class=o>}</span>
<a id=__codelineno-59-632 name=__codelineno-59-632 href=#__codelineno-59-632></a>
<a id=__codelineno-59-633 name=__codelineno-59-633 href=#__codelineno-59-633></a><span class=c1># Log that something passed, but may have had errors. Useful for fsck</span>
<a id=__codelineno-59-634 name=__codelineno-59-634 href=#__codelineno-59-634></a>passed<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-59-635 name=__codelineno-59-635 href=#__codelineno-59-635></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>rc</span><span class=o>=</span><span class=nv>$?</span>
<a id=__codelineno-59-636 name=__codelineno-59-636 href=#__codelineno-59-636></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$BOOTUP</span><span class=s2>&quot;</span><span class=w> </span>!<span class=o>=</span><span class=w> </span><span class=s2>&quot;verbose&quot;</span><span class=w> </span>-a<span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>LSB</span><span class=k>:-</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>echo_passed
<a id=__codelineno-59-637 name=__codelineno-59-637 href=#__codelineno-59-637></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nv>$rc</span>
<a id=__codelineno-59-638 name=__codelineno-59-638 href=#__codelineno-59-638></a><span class=o>}</span>
<a id=__codelineno-59-639 name=__codelineno-59-639 href=#__codelineno-59-639></a>
<a id=__codelineno-59-640 name=__codelineno-59-640 href=#__codelineno-59-640></a><span class=c1># Log a warning</span>
<a id=__codelineno-59-641 name=__codelineno-59-641 href=#__codelineno-59-641></a>warning<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-59-642 name=__codelineno-59-642 href=#__codelineno-59-642></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>rc</span><span class=o>=</span><span class=nv>$?</span>
<a id=__codelineno-59-643 name=__codelineno-59-643 href=#__codelineno-59-643></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$BOOTUP</span><span class=s2>&quot;</span><span class=w> </span>!<span class=o>=</span><span class=w> </span><span class=s2>&quot;verbose&quot;</span><span class=w> </span>-a<span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>LSB</span><span class=k>:-</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>echo_warning
<a id=__codelineno-59-644 name=__codelineno-59-644 href=#__codelineno-59-644></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nv>$rc</span>
<a id=__codelineno-59-645 name=__codelineno-59-645 href=#__codelineno-59-645></a><span class=o>}</span>
<a id=__codelineno-59-646 name=__codelineno-59-646 href=#__codelineno-59-646></a>
<a id=__codelineno-59-647 name=__codelineno-59-647 href=#__codelineno-59-647></a><span class=c1># Run some action. Log its output.</span>
<a id=__codelineno-59-648 name=__codelineno-59-648 href=#__codelineno-59-648></a>action<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-59-649 name=__codelineno-59-649 href=#__codelineno-59-649></a><span class=w>    </span><span class=nb>local</span><span class=w> </span>STRING<span class=w> </span>rc
<a id=__codelineno-59-650 name=__codelineno-59-650 href=#__codelineno-59-650></a>
<a id=__codelineno-59-651 name=__codelineno-59-651 href=#__codelineno-59-651></a><span class=w>    </span><span class=nv>STRING</span><span class=o>=</span><span class=nv>$1</span>
<a id=__codelineno-59-652 name=__codelineno-59-652 href=#__codelineno-59-652></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;</span><span class=nv>$STRING</span><span class=s2> &quot;</span>
<a id=__codelineno-59-653 name=__codelineno-59-653 href=#__codelineno-59-653></a><span class=w>    </span><span class=nb>shift</span>
<a id=__codelineno-59-654 name=__codelineno-59-654 href=#__codelineno-59-654></a><span class=w>    </span><span class=s2>&quot;</span><span class=nv>$@</span><span class=s2>&quot;</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>success<span class=w> </span>$<span class=s2>&quot;</span><span class=nv>$STRING</span><span class=s2>&quot;</span><span class=w> </span><span class=o>||</span><span class=w> </span>failure<span class=w> </span>$<span class=s2>&quot;</span><span class=nv>$STRING</span><span class=s2>&quot;</span>
<a id=__codelineno-59-655 name=__codelineno-59-655 href=#__codelineno-59-655></a><span class=w>    </span><span class=nv>rc</span><span class=o>=</span><span class=nv>$?</span>
<a id=__codelineno-59-656 name=__codelineno-59-656 href=#__codelineno-59-656></a><span class=w>    </span><span class=nb>echo</span>
<a id=__codelineno-59-657 name=__codelineno-59-657 href=#__codelineno-59-657></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nv>$rc</span>
<a id=__codelineno-59-658 name=__codelineno-59-658 href=#__codelineno-59-658></a><span class=o>}</span>
<a id=__codelineno-59-659 name=__codelineno-59-659 href=#__codelineno-59-659></a>
<a id=__codelineno-59-660 name=__codelineno-59-660 href=#__codelineno-59-660></a><span class=c1># returns OK if $1 contains $2</span>
<a id=__codelineno-59-661 name=__codelineno-59-661 href=#__codelineno-59-661></a>strstr<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-59-662 name=__codelineno-59-662 href=#__codelineno-59-662></a><span class=w>    </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>1</span><span class=p>#*</span><span class=nv>$2</span><span class=p>*</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-59-663 name=__codelineno-59-663 href=#__codelineno-59-663></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-59-664 name=__codelineno-59-664 href=#__codelineno-59-664></a><span class=o>}</span>
<a id=__codelineno-59-665 name=__codelineno-59-665 href=#__codelineno-59-665></a>
<a id=__codelineno-59-666 name=__codelineno-59-666 href=#__codelineno-59-666></a><span class=c1># Check whether file $1 is a backup or rpm-generated file and should be ignored</span>
<a id=__codelineno-59-667 name=__codelineno-59-667 href=#__codelineno-59-667></a>is_ignored_file<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-59-668 name=__codelineno-59-668 href=#__codelineno-59-668></a><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=k>in</span>
<a id=__codelineno-59-669 name=__codelineno-59-669 href=#__codelineno-59-669></a><span class=w>    </span>*~<span class=w> </span><span class=p>|</span><span class=w> </span>*.bak<span class=w> </span><span class=p>|</span><span class=w> </span>*.orig<span class=w> </span><span class=p>|</span><span class=w> </span>*.rpmnew<span class=w> </span><span class=p>|</span><span class=w> </span>*.rpmorig<span class=w> </span><span class=p>|</span><span class=w> </span>*.rpmsave<span class=o>)</span>
<a id=__codelineno-59-670 name=__codelineno-59-670 href=#__codelineno-59-670></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-59-671 name=__codelineno-59-671 href=#__codelineno-59-671></a><span class=w>        </span><span class=p>;;</span>
<a id=__codelineno-59-672 name=__codelineno-59-672 href=#__codelineno-59-672></a><span class=w>    </span><span class=k>esac</span>
<a id=__codelineno-59-673 name=__codelineno-59-673 href=#__codelineno-59-673></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-59-674 name=__codelineno-59-674 href=#__codelineno-59-674></a><span class=o>}</span>
<a id=__codelineno-59-675 name=__codelineno-59-675 href=#__codelineno-59-675></a>
<a id=__codelineno-59-676 name=__codelineno-59-676 href=#__codelineno-59-676></a><span class=c1># Evaluate shvar-style booleans</span>
<a id=__codelineno-59-677 name=__codelineno-59-677 href=#__codelineno-59-677></a>is_true<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-59-678 name=__codelineno-59-678 href=#__codelineno-59-678></a><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=k>in</span>
<a id=__codelineno-59-679 name=__codelineno-59-679 href=#__codelineno-59-679></a><span class=w>    </span><span class=o>[</span>tT<span class=o>]</span><span class=w> </span><span class=p>|</span><span class=w> </span><span class=o>[</span>yY<span class=o>]</span><span class=w> </span><span class=p>|</span><span class=w> </span><span class=o>[</span>yY<span class=o>][</span>eE<span class=o>][</span>sS<span class=o>]</span><span class=w> </span><span class=p>|</span><span class=w> </span><span class=o>[</span>tT<span class=o>][</span>rR<span class=o>][</span>uU<span class=o>][</span>eE<span class=o>]</span><span class=w> </span><span class=p>|</span><span class=w> </span><span class=m>1</span><span class=o>)</span>
<a id=__codelineno-59-680 name=__codelineno-59-680 href=#__codelineno-59-680></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-59-681 name=__codelineno-59-681 href=#__codelineno-59-681></a><span class=w>        </span><span class=p>;;</span>
<a id=__codelineno-59-682 name=__codelineno-59-682 href=#__codelineno-59-682></a><span class=w>    </span><span class=k>esac</span>
<a id=__codelineno-59-683 name=__codelineno-59-683 href=#__codelineno-59-683></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-59-684 name=__codelineno-59-684 href=#__codelineno-59-684></a><span class=o>}</span>
<a id=__codelineno-59-685 name=__codelineno-59-685 href=#__codelineno-59-685></a>
<a id=__codelineno-59-686 name=__codelineno-59-686 href=#__codelineno-59-686></a><span class=c1># Evaluate shvar-style booleans</span>
<a id=__codelineno-59-687 name=__codelineno-59-687 href=#__codelineno-59-687></a>is_false<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-59-688 name=__codelineno-59-688 href=#__codelineno-59-688></a><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=k>in</span>
<a id=__codelineno-59-689 name=__codelineno-59-689 href=#__codelineno-59-689></a><span class=w>    </span><span class=o>[</span>fF<span class=o>]</span><span class=w> </span><span class=p>|</span><span class=w> </span><span class=o>[</span>nN<span class=o>]</span><span class=w> </span><span class=p>|</span><span class=w> </span><span class=o>[</span>nN<span class=o>][</span>oO<span class=o>]</span><span class=w> </span><span class=p>|</span><span class=w> </span><span class=o>[</span>fF<span class=o>][</span>aA<span class=o>][</span>lL<span class=o>][</span>sS<span class=o>][</span>eE<span class=o>]</span><span class=w> </span><span class=p>|</span><span class=w> </span><span class=m>0</span><span class=o>)</span>
<a id=__codelineno-59-690 name=__codelineno-59-690 href=#__codelineno-59-690></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-59-691 name=__codelineno-59-691 href=#__codelineno-59-691></a><span class=w>        </span><span class=p>;;</span>
<a id=__codelineno-59-692 name=__codelineno-59-692 href=#__codelineno-59-692></a><span class=w>    </span><span class=k>esac</span>
<a id=__codelineno-59-693 name=__codelineno-59-693 href=#__codelineno-59-693></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-59-694 name=__codelineno-59-694 href=#__codelineno-59-694></a><span class=o>}</span>
<a id=__codelineno-59-695 name=__codelineno-59-695 href=#__codelineno-59-695></a>
<a id=__codelineno-59-696 name=__codelineno-59-696 href=#__codelineno-59-696></a><span class=c1># Apply sysctl settings, including files in /etc/sysctl.d</span>
<a id=__codelineno-59-697 name=__codelineno-59-697 href=#__codelineno-59-697></a>apply_sysctl<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-59-698 name=__codelineno-59-698 href=#__codelineno-59-698></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-x<span class=w> </span>/lib/systemd/systemd-sysctl<span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-59-699 name=__codelineno-59-699 href=#__codelineno-59-699></a><span class=w>    </span>/lib/systemd/systemd-sysctl
<a id=__codelineno-59-700 name=__codelineno-59-700 href=#__codelineno-59-700></a><span class=w>    </span><span class=k>else</span>
<a id=__codelineno-59-701 name=__codelineno-59-701 href=#__codelineno-59-701></a><span class=w>        </span><span class=k>for</span><span class=w> </span>file<span class=w> </span><span class=k>in</span><span class=w> </span>/usr/lib/sysctl.d/*.conf<span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>do</span>
<a id=__codelineno-59-702 name=__codelineno-59-702 href=#__codelineno-59-702></a><span class=w>            </span>is_ignored_file<span class=w> </span><span class=s2>&quot;</span><span class=nv>$file</span><span class=s2>&quot;</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>continue</span>
<a id=__codelineno-59-703 name=__codelineno-59-703 href=#__codelineno-59-703></a><span class=w>            </span><span class=o>[</span><span class=w> </span>-f<span class=w> </span>/run/sysctl.d/<span class=si>${</span><span class=nv>file</span><span class=p>##*/</span><span class=si>}</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>continue</span>
<a id=__codelineno-59-704 name=__codelineno-59-704 href=#__codelineno-59-704></a><span class=w>            </span><span class=o>[</span><span class=w> </span>-f<span class=w> </span>/etc/sysctl.d/<span class=si>${</span><span class=nv>file</span><span class=p>##*/</span><span class=si>}</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>continue</span>
<a id=__codelineno-59-705 name=__codelineno-59-705 href=#__codelineno-59-705></a><span class=w>            </span><span class=nb>test</span><span class=w> </span>-f<span class=w> </span><span class=s2>&quot;</span><span class=nv>$file</span><span class=s2>&quot;</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>sysctl<span class=w> </span>-e<span class=w> </span>-p<span class=w> </span><span class=s2>&quot;</span><span class=nv>$file</span><span class=s2>&quot;</span><span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-59-706 name=__codelineno-59-706 href=#__codelineno-59-706></a><span class=w>        </span><span class=k>done</span>
<a id=__codelineno-59-707 name=__codelineno-59-707 href=#__codelineno-59-707></a><span class=w>        </span><span class=k>for</span><span class=w> </span>file<span class=w> </span><span class=k>in</span><span class=w> </span>/run/sysctl.d/*.conf<span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>do</span>
<a id=__codelineno-59-708 name=__codelineno-59-708 href=#__codelineno-59-708></a><span class=w>            </span>is_ignored_file<span class=w> </span><span class=s2>&quot;</span><span class=nv>$file</span><span class=s2>&quot;</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>continue</span>
<a id=__codelineno-59-709 name=__codelineno-59-709 href=#__codelineno-59-709></a><span class=w>            </span><span class=o>[</span><span class=w> </span>-f<span class=w> </span>/etc/sysctl.d/<span class=si>${</span><span class=nv>file</span><span class=p>##*/</span><span class=si>}</span><span class=w> </span><span class=o>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>continue</span>
<a id=__codelineno-59-710 name=__codelineno-59-710 href=#__codelineno-59-710></a><span class=w>            </span><span class=nb>test</span><span class=w> </span>-f<span class=w> </span><span class=s2>&quot;</span><span class=nv>$file</span><span class=s2>&quot;</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>sysctl<span class=w> </span>-e<span class=w> </span>-p<span class=w> </span><span class=s2>&quot;</span><span class=nv>$file</span><span class=s2>&quot;</span><span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-59-711 name=__codelineno-59-711 href=#__codelineno-59-711></a><span class=w>        </span><span class=k>done</span>
<a id=__codelineno-59-712 name=__codelineno-59-712 href=#__codelineno-59-712></a><span class=w>        </span><span class=k>for</span><span class=w> </span>file<span class=w> </span><span class=k>in</span><span class=w> </span>/etc/sysctl.d/*.conf<span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>do</span>
<a id=__codelineno-59-713 name=__codelineno-59-713 href=#__codelineno-59-713></a><span class=w>            </span>is_ignored_file<span class=w> </span><span class=s2>&quot;</span><span class=nv>$file</span><span class=s2>&quot;</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>continue</span>
<a id=__codelineno-59-714 name=__codelineno-59-714 href=#__codelineno-59-714></a><span class=w>            </span><span class=nb>test</span><span class=w> </span>-f<span class=w> </span><span class=s2>&quot;</span><span class=nv>$file</span><span class=s2>&quot;</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>sysctl<span class=w> </span>-e<span class=w> </span>-p<span class=w> </span><span class=s2>&quot;</span><span class=nv>$file</span><span class=s2>&quot;</span><span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-59-715 name=__codelineno-59-715 href=#__codelineno-59-715></a><span class=w>        </span><span class=k>done</span>
<a id=__codelineno-59-716 name=__codelineno-59-716 href=#__codelineno-59-716></a><span class=w>        </span>sysctl<span class=w> </span>-e<span class=w> </span>-p<span class=w> </span>/etc/sysctl.conf<span class=w> </span>&gt;/dev/null<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-59-717 name=__codelineno-59-717 href=#__codelineno-59-717></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-59-718 name=__codelineno-59-718 href=#__codelineno-59-718></a><span class=o>}</span>
<a id=__codelineno-59-719 name=__codelineno-59-719 href=#__codelineno-59-719></a>
<a id=__codelineno-59-720 name=__codelineno-59-720 href=#__codelineno-59-720></a><span class=c1># A sed expression to filter out the files that is_ignored_file recognizes</span>
<a id=__codelineno-59-721 name=__codelineno-59-721 href=#__codelineno-59-721></a><span class=nv>__sed_discard_ignored_files</span><span class=o>=</span><span class=s1>&#39;/\(~\|\.bak\|\.orig\|\.rpmnew\|\.rpmorig\|\.rpmsave\)$/d&#39;</span>
<a id=__codelineno-59-722 name=__codelineno-59-722 href=#__codelineno-59-722></a>
<a id=__codelineno-59-723 name=__codelineno-59-723 href=#__codelineno-59-723></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$_use_systemctl</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;1&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-59-724 name=__codelineno-59-724 href=#__codelineno-59-724></a><span class=w>        </span><span class=k>if</span><span class=w>  </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;x</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span>xstart<span class=w> </span>-o<span class=w> </span><span class=se>\</span>
<a id=__codelineno-59-725 name=__codelineno-59-725 href=#__codelineno-59-725></a><span class=w>              </span><span class=s2>&quot;x</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span>xstop<span class=w> </span>-o<span class=w> </span><span class=se>\</span>
<a id=__codelineno-59-726 name=__codelineno-59-726 href=#__codelineno-59-726></a><span class=w>              </span><span class=s2>&quot;x</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span>xrestart<span class=w> </span>-o<span class=w> </span><span class=se>\</span>
<a id=__codelineno-59-727 name=__codelineno-59-727 href=#__codelineno-59-727></a><span class=w>              </span><span class=s2>&quot;x</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span>xreload<span class=w> </span>-o<span class=w> </span><span class=se>\</span>
<a id=__codelineno-59-728 name=__codelineno-59-728 href=#__codelineno-59-728></a><span class=w>              </span><span class=s2>&quot;x</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span>xtry-restart<span class=w> </span>-o<span class=w> </span><span class=se>\</span>
<a id=__codelineno-59-729 name=__codelineno-59-729 href=#__codelineno-59-729></a><span class=w>              </span><span class=s2>&quot;x</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span>xforce-reload<span class=w> </span>-o<span class=w> </span><span class=se>\</span>
<a id=__codelineno-59-730 name=__codelineno-59-730 href=#__codelineno-59-730></a><span class=w>              </span><span class=s2>&quot;x</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span>xcondrestart<span class=w> </span><span class=o>]</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-59-731 name=__codelineno-59-731 href=#__codelineno-59-731></a>
<a id=__codelineno-59-732 name=__codelineno-59-732 href=#__codelineno-59-732></a><span class=w>        </span>systemctl_redirect<span class=w> </span><span class=nv>$0</span><span class=w> </span><span class=nv>$1</span>
<a id=__codelineno-59-733 name=__codelineno-59-733 href=#__codelineno-59-733></a><span class=w>        </span><span class=nb>exit</span><span class=w> </span><span class=nv>$?</span>
<a id=__codelineno-59-734 name=__codelineno-59-734 href=#__codelineno-59-734></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-59-735 name=__codelineno-59-735 href=#__codelineno-59-735></a><span class=k>fi</span>
<a id=__codelineno-59-736 name=__codelineno-59-736 href=#__codelineno-59-736></a>
<a id=__codelineno-59-737 name=__codelineno-59-737 href=#__codelineno-59-737></a>strstr<span class=w> </span><span class=s2>&quot;</span><span class=k>$(</span>cat<span class=w> </span>/proc/cmdline<span class=k>)</span><span class=s2>&quot;</span><span class=w> </span><span class=s2>&quot;rc.debug&quot;</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nb>set</span><span class=w> </span>-x
<a id=__codelineno-59-738 name=__codelineno-59-738 href=#__codelineno-59-738></a><span class=k>return</span><span class=w> </span><span class=m>0</span>
</code></pre></div> <hr> <div class=md-source-file> <small> 最后更新: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime">April 18, 2023 19:18:19</span> <br> 创建日期: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime">April 18, 2023 18:29:24</span> </small> </div> <form class=md-feedback name=feedback hidden> <fieldset> <legend class=md-feedback__title> Was this page helpful? </legend> <div class=md-feedback__inner> <div class=md-feedback__list> <button class="md-feedback__icon md-icon" type=submit title="This page was helpful" data-md-value=1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m7 0c0 .8-.7 1.5-1.5 1.5S14 10.3 14 9.5 14.7 8 15.5 8s1.5.7 1.5 1.5m-5 7.73c-1.75 0-3.29-.73-4.19-1.81L9.23 14c.45.72 1.52 1.23 2.77 1.23s2.32-.51 2.77-1.23l1.42 1.42c-.9 1.08-2.44 1.81-4.19 1.81Z"/></svg> </button> <button class="md-feedback__icon md-icon" type=submit title="This page could be improved" data-md-value=0> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10m-6.5-4c.8 0 1.5.7 1.5 1.5s-.7 1.5-1.5 1.5-1.5-.7-1.5-1.5.7-1.5 1.5-1.5M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m2 4.5c1.75 0 3.29.72 4.19 1.81l-1.42 1.42C14.32 16.5 13.25 16 12 16s-2.32.5-2.77 1.23l-1.42-1.42C8.71 14.72 10.25 14 12 14Z"/></svg> </button> </div> <div class=md-feedback__note> <div data-md-value=1 hidden> Thanks for your feedback! </div> <div data-md-value=0 hidden> Thanks for your feedback! Help us improve this page by using our <a href="https://github.com/hujianli94/hujianli94.github.io/issues/new/?title=[Feedback]+17.Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B+-+/Linux/shell/17.Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/" target=_blank>feedback form</a>. </div> </div> </div> </fieldset> </form> </article> </div> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> 回到页面顶部 </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=页脚> <a href=../16.Shell%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/ class="md-footer__link md-footer__link--prev" aria-label="上一页: 16.Shell实战项目" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> 上一页 </span> <div class=md-ellipsis> 16.Shell实战项目 </div> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2023 - 2024 hujainli94 </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/hujianli94 target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> <a href=https://kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com/blog_img/20220125122524.png target=_blank rel=noopener title=kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 576 512"><!-- Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M385.2 167.6c6.4 0 12.6.3 18.8 1.1C387.4 90.3 303.3 32 207.7 32 100.5 32 13 104.8 13 197.4c0 53.4 29.3 97.5 77.9 131.6l-19.3 58.6 68-34.1c24.4 4.8 43.8 9.7 68.2 9.7 6.2 0 12.1-.3 18.3-.8-4-12.9-6.2-26.6-6.2-40.8-.1-84.9 72.9-154 165.3-154zm-104.5-52.9c14.5 0 24.2 9.7 24.2 24.4 0 14.5-9.7 24.2-24.2 24.2-14.8 0-29.3-9.7-29.3-24.2.1-14.7 14.6-24.4 29.3-24.4zm-136.4 48.6c-14.5 0-29.3-9.7-29.3-24.2 0-14.8 14.8-24.4 29.3-24.4 14.8 0 24.4 9.7 24.4 24.4 0 14.6-9.6 24.2-24.4 24.2zM563 319.4c0-77.9-77.9-141.3-165.4-141.3-92.7 0-165.4 63.4-165.4 141.3S305 460.7 397.6 460.7c19.3 0 38.9-5.1 58.6-9.9l53.4 29.3-14.8-48.6C534 402.1 563 363.2 563 319.4zm-219.1-24.5c-9.7 0-19.3-9.7-19.3-19.6 0-9.7 9.7-19.3 19.3-19.3 14.8 0 24.4 9.7 24.4 19.3 0 10-9.7 19.6-24.4 19.6zm107.1 0c-9.7 0-19.3-9.7-19.3-19.6 0-9.7 9.7-19.3 19.3-19.3 14.5 0 24.4 9.7 24.4 19.3.1 10-9.9 19.6-24.4 19.6z"/></svg> </a> <a href="mailto:<1879324764@qq.com>" target=_blank rel=noopener title=发送邮件 class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M498.1 5.6c10.1 7 15.4 19.1 13.5 31.2l-64 416c-1.5 9.7-7.4 18.2-16 23s-18.9 5.4-28 1.6L284 427.7l-68.5 74.1c-8.9 9.7-22.9 12.9-35.2 8.1S160 493.2 160 480v-83.6c0-4 1.5-7.8 4.2-10.7l167.6-182.9c5.8-6.3 5.6-16-.4-22s-15.7-6.4-22-.7L106 360.8l-88.3-44.2C7.1 311.3.3 300.7 0 288.9s5.9-22.8 16.1-28.7l448-256c10.7-6.1 23.9-5.5 34 1.4z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-consent data-md-component=consent id=__consent hidden> <div class=md-consent__overlay></div> <aside class=md-consent__inner> <form class="md-consent__form md-grid md-typeset" name=consent> <h4>Cookie consent</h4> <p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p> <input class=md-toggle type=checkbox id=__settings> <div class=md-consent__settings> <ul class=task-list> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=analytics checked> <span class=task-list-indicator></span> Google Analytics </label> </li> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=github checked> <span class=task-list-indicator></span> GitHub </label> </li> </ul> </div> <div class=md-consent__controls> <button class="md-button md-button--primary">同意</button> <label class=md-button for=__settings>管理设定</label> </div> </form> </aside> </div> <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout(function(){document.querySelector("[data-md-component=consent]").hidden=!1},250);var action,form=document.forms.consent;for(action of["submit","reset"])form.addEventListener(action,function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map(function(e){return[e,!0]}))),location.hash="",location.reload()})</script> <script id=__config type=application/json>{"base": "../../..", "features": ["content.action.edit", "content.action.view", "content.code.copy", "content.code.annotate", "navigation.indexes", "navigation.footer", "navigation.indexes", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest"], "search": "../../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script> <script src=../../../assets/javascripts/bundle.51198bba.min.js></script> <script src=../../../javascripts/extra.js></script> <script src=https://file.cdn.shafish.cn/blog/js/video.min.js></script> </body> </html>